var $r=Object.defineProperty;var Wr=(a,e,t)=>e in a?$r(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var oe=(a,e,t)=>(Wr(a,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const app="";function noop(){}function run(a){return a()}function blank_object(){return Object.create(null)}function run_all(a){a.forEach(run)}function is_function(a){return typeof a=="function"}function safe_not_equal(a,e){return a!=a?e==e:a!==e||a&&typeof a=="object"||typeof a=="function"}function is_empty(a){return Object.keys(a).length===0}function append$3(a,e){a.appendChild(e)}function insert(a,e,t){a.insertBefore(e,t||null)}function detach(a){a.parentNode&&a.parentNode.removeChild(a)}function element(a){return document.createElement(a)}function text$1(a){return document.createTextNode(a)}function space(){return text$1(" ")}function listen(a,e,t,s){return a.addEventListener(e,t,s),()=>a.removeEventListener(e,t,s)}function attr(a,e,t){t==null?a.removeAttribute(e):a.getAttribute(e)!==t&&a.setAttribute(e,t)}function children(a){return Array.from(a.childNodes)}function set_data(a,e){e=""+e,a.data!==e&&(a.data=e)}let current_component;function set_current_component(a){current_component=a}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function onMount(a){get_current_component().$$.on_mount.push(a)}const dirty_components=[],binding_callbacks=[];let render_callbacks=[];const flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function add_render_callback(a){render_callbacks.push(a)}function add_flush_callback(a){flush_callbacks.push(a)}const seen_callbacks=new Set;let flushidx=0;function flush(){if(flushidx!==0)return;const a=current_component;do{try{for(;flushidx<dirty_components.length;){const e=dirty_components[flushidx];flushidx++,set_current_component(e),update(e.$$)}}catch(e){throw dirty_components.length=0,flushidx=0,e}for(set_current_component(null),dirty_components.length=0,flushidx=0;binding_callbacks.length;)binding_callbacks.pop()();for(let e=0;e<render_callbacks.length;e+=1){const t=render_callbacks[e];seen_callbacks.has(t)||(seen_callbacks.add(t),t())}render_callbacks.length=0}while(dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,seen_callbacks.clear(),set_current_component(a)}function update(a){if(a.fragment!==null){a.update(),run_all(a.before_update);const e=a.dirty;a.dirty=[-1],a.fragment&&a.fragment.p(a.ctx,e),a.after_update.forEach(add_render_callback)}}function flush_render_callbacks(a){const e=[],t=[];render_callbacks.forEach(s=>a.indexOf(s)===-1?e.push(s):t.push(s)),t.forEach(s=>s()),render_callbacks=e}const outroing=new Set;let outros;function transition_in(a,e){a&&a.i&&(outroing.delete(a),a.i(e))}function transition_out(a,e,t,s){if(a&&a.o){if(outroing.has(a))return;outroing.add(a),outros.c.push(()=>{outroing.delete(a),s&&(t&&a.d(1),s())}),a.o(e)}else s&&s()}function bind(a,e,t){const s=a.$$.props[e];s!==void 0&&(a.$$.bound[s]=t,t(a.$$.ctx[s]))}function create_component(a){a&&a.c()}function mount_component(a,e,t,s){const{fragment:o,after_update:r}=a.$$;o&&o.m(e,t),s||add_render_callback(()=>{const l=a.$$.on_mount.map(run).filter(is_function);a.$$.on_destroy?a.$$.on_destroy.push(...l):run_all(l),a.$$.on_mount=[]}),r.forEach(add_render_callback)}function destroy_component(a,e){const t=a.$$;t.fragment!==null&&(flush_render_callbacks(t.after_update),run_all(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function make_dirty(a,e){a.$$.dirty[0]===-1&&(dirty_components.push(a),schedule_update(),a.$$.dirty.fill(0)),a.$$.dirty[e/31|0]|=1<<e%31}function init(a,e,t,s,o,r,l,c=[-1]){const d=current_component;set_current_component(a);const u=a.$$={fragment:null,ctx:[],props:r,update:noop,not_equal:o,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:blank_object(),dirty:c,skip_bound:!1,root:e.target||d.$$.root};l&&l(u.root);let g=!1;if(u.ctx=t?t(a,e.props||{},(f,p,...m)=>{const _=m.length?m[0]:p;return u.ctx&&o(u.ctx[f],u.ctx[f]=_)&&(!u.skip_bound&&u.bound[f]&&u.bound[f](_),g&&make_dirty(a,f)),p}):[],u.update(),g=!0,run_all(u.before_update),u.fragment=s?s(u.ctx):!1,e.target){if(e.hydrate){const f=children(e.target);u.fragment&&u.fragment.l(f),f.forEach(detach)}else u.fragment&&u.fragment.c();e.intro&&transition_in(a.$$.fragment),mount_component(a,e.target,e.anchor,e.customElement),flush()}set_current_component(d)}class SvelteComponent{$destroy(){destroy_component(this,1),this.$destroy=noop}$on(e,t){if(!is_function(t))return noop;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(t),()=>{const o=s.indexOf(t);o!==-1&&s.splice(o,1)}}$set(e){this.$$set&&!is_empty(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function getNLSMessages(){return globalThis._VSCODE_NLS_MESSAGES}function getNLSLanguage(){return globalThis._VSCODE_NLS_LANGUAGE}const isPseudo=getNLSLanguage()==="pseudo"||typeof document<"u"&&document.location&&typeof document.location.hash=="string"&&document.location.hash.indexOf("pseudo=true")>=0;function _format$1(a,e){let t;return e.length===0?t=a:t=a.replace(/\{(\d+)\}/g,(s,o)=>{const r=o[0],l=e[r];let c=s;return typeof l=="string"?c=l:(typeof l=="number"||typeof l=="boolean"||l===void 0||l===null)&&(c=String(l)),c}),isPseudo&&(t="［"+t.replace(/[aouei]/g,"$&$&")+"］"),t}function localize(a,e,...t){return _format$1(typeof a=="number"?lookupMessage(a,e):e,t)}function lookupMessage(a,e){var s;const t=(s=getNLSMessages())==null?void 0:s[a];if(typeof t!="string"){if(typeof e=="string")return e;throw new Error(`!!! NLS MISSING: ${a} !!!`)}return t}function localize2(a,e,...t){let s;typeof a=="number"?s=lookupMessage(a,e):s=e;const o=_format$1(s,t);return{value:o,original:e===s?o:_format$1(e,t)}}function ensureCodeWindow(a,e){const t=a;typeof t.vscodeWindowId!="number"&&Object.defineProperty(t,"vscodeWindowId",{get:()=>e})}const mainWindow=window,Zn=class Zn{constructor(){this.mapWindowIdToZoomFactor=new Map}getZoomFactor(e){return this.mapWindowIdToZoomFactor.get(this.getWindowId(e))??1}getWindowId(e){return e.vscodeWindowId}};Zn.INSTANCE=new Zn;let WindowManager=Zn;function addMatchMediaChangeListener(a,e,t){typeof e=="string"&&(e=a.matchMedia(e)),e.addEventListener("change",t)}function getZoomFactor(a){return WindowManager.INSTANCE.getZoomFactor(a)}const userAgent$1=navigator.userAgent,isFirefox$1=userAgent$1.indexOf("Firefox")>=0,isWebKit=userAgent$1.indexOf("AppleWebKit")>=0,isChrome$1=userAgent$1.indexOf("Chrome")>=0,isSafari$1=!isChrome$1&&userAgent$1.indexOf("Safari")>=0,isWebkitWebView=!isChrome$1&&!isSafari$1&&isWebKit;userAgent$1.indexOf("Electron/")>=0;const isAndroid$1=userAgent$1.indexOf("Android")>=0;let standalone=!1;if(typeof mainWindow.matchMedia=="function"){const a=mainWindow.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),e=mainWindow.matchMedia("(display-mode: fullscreen)");standalone=a.matches,addMatchMediaChangeListener(mainWindow,a,({matches:t})=>{standalone&&e.matches||(standalone=t)})}function isStandalone(){return standalone}class ErrorHandler{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?ErrorNoTelemetry.isErrorNoTelemetry(e)?new ErrorNoTelemetry(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}emit(e){this.listeners.forEach(t=>{t(e)})}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}}const errorHandler=new ErrorHandler;function onBugIndicatingError(a){errorHandler.onUnexpectedError(a)}function onUnexpectedError(a){isCancellationError(a)||errorHandler.onUnexpectedError(a)}function onUnexpectedExternalError(a){isCancellationError(a)||errorHandler.onUnexpectedExternalError(a)}function transformErrorForSerialization(a){if(a instanceof Error){const{name:e,message:t,cause:s}=a,o=a.stacktrace||a.stack;return{$isError:!0,name:e,message:t,stack:o,noTelemetry:ErrorNoTelemetry.isErrorNoTelemetry(a),cause:s?transformErrorForSerialization(s):void 0,code:a.code}}return a}const canceledName="Canceled";function isCancellationError(a){return a instanceof CancellationError?!0:a instanceof Error&&a.name===canceledName&&a.message===canceledName}class CancellationError extends Error{constructor(){super(canceledName),this.name=this.message}}function canceled(){const a=new Error(canceledName);return a.name=a.message,a}function illegalArgument(a){return a?new Error(`Illegal argument: ${a}`):new Error("Illegal argument")}function illegalState(a){return a?new Error(`Illegal state: ${a}`):new Error("Illegal state")}class NotSupportedError extends Error{constructor(e){super("NotSupported"),e&&(this.message=e)}}class ErrorNoTelemetry extends Error{constructor(e){super(e),this.name="CodeExpectedError"}static fromError(e){if(e instanceof ErrorNoTelemetry)return e;const t=new ErrorNoTelemetry;return t.message=e.message,t.stack=e.stack,t}static isErrorNoTelemetry(e){return e.name==="CodeExpectedError"}}class BugIndicatingError extends Error{constructor(e){super(e||"An unexpected bug occurred."),Object.setPrototypeOf(this,BugIndicatingError.prototype)}}function ok(a,e){if(!a)throw new Error(e?`Assertion failed (${e})`:"Assertion Failed")}function assertNever(a,e="Unreachable"){throw new Error(e)}function assert(a,e="unexpected state"){if(!a)throw typeof e=="string"?new BugIndicatingError(`Assertion Failed: ${e}`):e}function softAssert(a,e="Soft Assertion Failed"){a||onUnexpectedError(new BugIndicatingError(e))}function assertFn(a){if(!a()){debugger;a(),onUnexpectedError(new BugIndicatingError("Assertion Failed"))}}function checkAdjacentItems(a,e){let t=0;for(;t<a.length-1;){const s=a[t],o=a[t+1];if(!e(s,o))return!1;t++}return!0}function isString$1(a){return typeof a=="string"}function isObject(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)&&!(a instanceof RegExp)&&!(a instanceof Date)}function isTypedArray(a){const e=Object.getPrototypeOf(Uint8Array);return typeof a=="object"&&a instanceof e}function isNumber$1(a){return typeof a=="number"&&!isNaN(a)}function isIterable(a){return!!a&&typeof a[Symbol.iterator]=="function"}function isBoolean(a){return a===!0||a===!1}function isUndefined(a){return typeof a>"u"}function isDefined(a){return!isUndefinedOrNull(a)}function isUndefinedOrNull(a){return isUndefined(a)||a===null}function assertType(a,e){if(!a)throw new Error(e?`Unexpected type, expected '${e}'`:"Unexpected type")}function assertReturnsDefined(a){return assert(a!=null,"Argument is `undefined` or `null`."),a}function isFunction(a){return typeof a=="function"}function validateConstraints(a,e){const t=Math.min(a.length,e.length);for(let s=0;s<t;s++)validateConstraint(a[s],e[s])}function validateConstraint(a,e){if(isString$1(e)){if(typeof a!==e)throw new Error(`argument does not match constraint: typeof ${e}`)}else if(isFunction(e)){try{if(a instanceof e)return}catch{}if(!isUndefinedOrNull(a)&&a.constructor===e||e.length===1&&e.call(void 0,a)===!0)return;throw new Error("argument does not match one of these constraints: arg instanceof constraint, arg.constructor === constraint, nor constraint(arg) === true")}}function upcast(a){return a}const LANGUAGE_DEFAULT="en";let _isWindows=!1,_isMacintosh=!1,_isLinux=!1,_isNative=!1,_isWeb=!1,_isIOS=!1,_isMobile=!1,_locale,_language=LANGUAGE_DEFAULT,_platformLocale=LANGUAGE_DEFAULT,_translationsConfigFile,_userAgent;const $globalThis=globalThis;let nodeProcess;var yr;typeof $globalThis.vscode<"u"&&typeof $globalThis.vscode.process<"u"?nodeProcess=$globalThis.vscode.process:typeof process<"u"&&typeof((yr=process==null?void 0:process.versions)==null?void 0:yr.node)=="string"&&(nodeProcess=process);var Lr;const isElectronProcess=typeof((Lr=nodeProcess==null?void 0:nodeProcess.versions)==null?void 0:Lr.electron)=="string",isElectronRenderer=isElectronProcess&&(nodeProcess==null?void 0:nodeProcess.type)==="renderer";var Er;if(typeof nodeProcess=="object"){_isWindows=nodeProcess.platform==="win32",_isMacintosh=nodeProcess.platform==="darwin",_isLinux=nodeProcess.platform==="linux",_isLinux&&nodeProcess.env.SNAP&&nodeProcess.env.SNAP_REVISION,nodeProcess.env.CI||nodeProcess.env.BUILD_ARTIFACTSTAGINGDIRECTORY||nodeProcess.env.GITHUB_WORKSPACE,_locale=LANGUAGE_DEFAULT,_language=LANGUAGE_DEFAULT;const a=nodeProcess.env.VSCODE_NLS_CONFIG;if(a)try{const e=JSON.parse(a);_locale=e.userLocale,_platformLocale=e.osLocale,_language=e.resolvedLanguage||LANGUAGE_DEFAULT,_translationsConfigFile=(Er=e.languagePack)==null?void 0:Er.translationsConfigFile}catch{}_isNative=!0}else typeof navigator=="object"&&!isElectronRenderer?(_userAgent=navigator.userAgent,_isWindows=_userAgent.indexOf("Windows")>=0,_isMacintosh=_userAgent.indexOf("Macintosh")>=0,_isIOS=(_userAgent.indexOf("Macintosh")>=0||_userAgent.indexOf("iPad")>=0||_userAgent.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,_isLinux=_userAgent.indexOf("Linux")>=0,_isMobile=(_userAgent==null?void 0:_userAgent.indexOf("Mobi"))>=0,_isWeb=!0,_language=getNLSLanguage()||LANGUAGE_DEFAULT,_locale=navigator.language.toLowerCase(),_platformLocale=_locale):console.error("Unable to resolve platform.");let _platform=0;_isMacintosh?_platform=1:_isWindows?_platform=3:_isLinux&&(_platform=2);const isWindows=_isWindows,isMacintosh=_isMacintosh,isLinux=_isLinux,isNative=_isNative,isWeb=_isWeb,isWebWorker=_isWeb&&typeof $globalThis.importScripts=="function",webWorkerOrigin=isWebWorker?$globalThis.origin:void 0,isIOS=_isIOS,isMobile=_isMobile,platform$1=_platform,userAgent=_userAgent,language=_language,setTimeout0IsFaster=typeof $globalThis.postMessage=="function"&&!$globalThis.importScripts,setTimeout0=(()=>{if(setTimeout0IsFaster){const a=[];$globalThis.addEventListener("message",t=>{if(t.data&&t.data.vscodeScheduleAsyncWork)for(let s=0,o=a.length;s<o;s++){const r=a[s];if(r.id===t.data.vscodeScheduleAsyncWork){a.splice(s,1),r.callback();return}}});let e=0;return t=>{const s=++e;a.push({id:s,callback:t}),$globalThis.postMessage({vscodeScheduleAsyncWork:s},"*")}}return a=>setTimeout(a)})(),OS=_isMacintosh||_isIOS?2:_isWindows?1:3;let _isLittleEndian=!0,_isLittleEndianComputed=!1;function isLittleEndian(){if(!_isLittleEndianComputed){_isLittleEndianComputed=!0;const a=new Uint8Array(2);a[0]=1,a[1]=2,_isLittleEndian=new Uint16Array(a.buffer)[0]===512+1}return _isLittleEndian}const isChrome=!!(userAgent&&userAgent.indexOf("Chrome")>=0),isFirefox=!!(userAgent&&userAgent.indexOf("Firefox")>=0),isSafari=!!(!isChrome&&userAgent&&userAgent.indexOf("Safari")>=0),isEdge=!!(userAgent&&userAgent.indexOf("Edg/")>=0),isAndroid=!!(userAgent&&userAgent.indexOf("Android")>=0),BrowserFeatures={clipboard:{writeText:isNative||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(navigator&&navigator.clipboard&&navigator.clipboard.writeText),readText:isNative||!!(navigator&&navigator.clipboard&&navigator.clipboard.readText)},keyboard:(()=>isNative||isStandalone()?0:navigator.keyboard||isSafari$1?1:2)(),touch:"ontouchstart"in mainWindow||navigator.maxTouchPoints>0,pointerEvents:mainWindow.PointerEvent&&("ontouchstart"in mainWindow||navigator.maxTouchPoints>0)};class KeyCodeStrMap{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(e,t){this._keyCodeToStr[e]=t,this._strToKeyCode[t.toLowerCase()]=e}keyCodeToStr(e){return this._keyCodeToStr[e]}strToKeyCode(e){return this._strToKeyCode[e.toLowerCase()]||0}}const uiMap=new KeyCodeStrMap,userSettingsUSMap=new KeyCodeStrMap,userSettingsGeneralMap=new KeyCodeStrMap,EVENT_KEY_CODE_MAP=new Array(230),scanCodeStrToInt=Object.create(null),scanCodeLowerCaseStrToInt=Object.create(null),IMMUTABLE_CODE_TO_KEY_CODE=[];for(let a=0;a<=193;a++)IMMUTABLE_CODE_TO_KEY_CODE[a]=-1;(function(){const a="",e=[[1,0,"None",0,"unknown",0,"VK_UNKNOWN",a,a],[1,1,"Hyper",0,a,0,a,a,a],[1,2,"Super",0,a,0,a,a,a],[1,3,"Fn",0,a,0,a,a,a],[1,4,"FnLock",0,a,0,a,a,a],[1,5,"Suspend",0,a,0,a,a,a],[1,6,"Resume",0,a,0,a,a,a],[1,7,"Turbo",0,a,0,a,a,a],[1,8,"Sleep",0,a,0,"VK_SLEEP",a,a],[1,9,"WakeUp",0,a,0,a,a,a],[0,10,"KeyA",31,"A",65,"VK_A",a,a],[0,11,"KeyB",32,"B",66,"VK_B",a,a],[0,12,"KeyC",33,"C",67,"VK_C",a,a],[0,13,"KeyD",34,"D",68,"VK_D",a,a],[0,14,"KeyE",35,"E",69,"VK_E",a,a],[0,15,"KeyF",36,"F",70,"VK_F",a,a],[0,16,"KeyG",37,"G",71,"VK_G",a,a],[0,17,"KeyH",38,"H",72,"VK_H",a,a],[0,18,"KeyI",39,"I",73,"VK_I",a,a],[0,19,"KeyJ",40,"J",74,"VK_J",a,a],[0,20,"KeyK",41,"K",75,"VK_K",a,a],[0,21,"KeyL",42,"L",76,"VK_L",a,a],[0,22,"KeyM",43,"M",77,"VK_M",a,a],[0,23,"KeyN",44,"N",78,"VK_N",a,a],[0,24,"KeyO",45,"O",79,"VK_O",a,a],[0,25,"KeyP",46,"P",80,"VK_P",a,a],[0,26,"KeyQ",47,"Q",81,"VK_Q",a,a],[0,27,"KeyR",48,"R",82,"VK_R",a,a],[0,28,"KeyS",49,"S",83,"VK_S",a,a],[0,29,"KeyT",50,"T",84,"VK_T",a,a],[0,30,"KeyU",51,"U",85,"VK_U",a,a],[0,31,"KeyV",52,"V",86,"VK_V",a,a],[0,32,"KeyW",53,"W",87,"VK_W",a,a],[0,33,"KeyX",54,"X",88,"VK_X",a,a],[0,34,"KeyY",55,"Y",89,"VK_Y",a,a],[0,35,"KeyZ",56,"Z",90,"VK_Z",a,a],[0,36,"Digit1",22,"1",49,"VK_1",a,a],[0,37,"Digit2",23,"2",50,"VK_2",a,a],[0,38,"Digit3",24,"3",51,"VK_3",a,a],[0,39,"Digit4",25,"4",52,"VK_4",a,a],[0,40,"Digit5",26,"5",53,"VK_5",a,a],[0,41,"Digit6",27,"6",54,"VK_6",a,a],[0,42,"Digit7",28,"7",55,"VK_7",a,a],[0,43,"Digit8",29,"8",56,"VK_8",a,a],[0,44,"Digit9",30,"9",57,"VK_9",a,a],[0,45,"Digit0",21,"0",48,"VK_0",a,a],[1,46,"Enter",3,"Enter",13,"VK_RETURN",a,a],[1,47,"Escape",9,"Escape",27,"VK_ESCAPE",a,a],[1,48,"Backspace",1,"Backspace",8,"VK_BACK",a,a],[1,49,"Tab",2,"Tab",9,"VK_TAB",a,a],[1,50,"Space",10,"Space",32,"VK_SPACE",a,a],[0,51,"Minus",88,"-",189,"VK_OEM_MINUS","-","OEM_MINUS"],[0,52,"Equal",86,"=",187,"VK_OEM_PLUS","=","OEM_PLUS"],[0,53,"BracketLeft",92,"[",219,"VK_OEM_4","[","OEM_4"],[0,54,"BracketRight",94,"]",221,"VK_OEM_6","]","OEM_6"],[0,55,"Backslash",93,"\\",220,"VK_OEM_5","\\","OEM_5"],[0,56,"IntlHash",0,a,0,a,a,a],[0,57,"Semicolon",85,";",186,"VK_OEM_1",";","OEM_1"],[0,58,"Quote",95,"'",222,"VK_OEM_7","'","OEM_7"],[0,59,"Backquote",91,"`",192,"VK_OEM_3","`","OEM_3"],[0,60,"Comma",87,",",188,"VK_OEM_COMMA",",","OEM_COMMA"],[0,61,"Period",89,".",190,"VK_OEM_PERIOD",".","OEM_PERIOD"],[0,62,"Slash",90,"/",191,"VK_OEM_2","/","OEM_2"],[1,63,"CapsLock",8,"CapsLock",20,"VK_CAPITAL",a,a],[1,64,"F1",59,"F1",112,"VK_F1",a,a],[1,65,"F2",60,"F2",113,"VK_F2",a,a],[1,66,"F3",61,"F3",114,"VK_F3",a,a],[1,67,"F4",62,"F4",115,"VK_F4",a,a],[1,68,"F5",63,"F5",116,"VK_F5",a,a],[1,69,"F6",64,"F6",117,"VK_F6",a,a],[1,70,"F7",65,"F7",118,"VK_F7",a,a],[1,71,"F8",66,"F8",119,"VK_F8",a,a],[1,72,"F9",67,"F9",120,"VK_F9",a,a],[1,73,"F10",68,"F10",121,"VK_F10",a,a],[1,74,"F11",69,"F11",122,"VK_F11",a,a],[1,75,"F12",70,"F12",123,"VK_F12",a,a],[1,76,"PrintScreen",0,a,0,a,a,a],[1,77,"ScrollLock",84,"ScrollLock",145,"VK_SCROLL",a,a],[1,78,"Pause",7,"PauseBreak",19,"VK_PAUSE",a,a],[1,79,"Insert",19,"Insert",45,"VK_INSERT",a,a],[1,80,"Home",14,"Home",36,"VK_HOME",a,a],[1,81,"PageUp",11,"PageUp",33,"VK_PRIOR",a,a],[1,82,"Delete",20,"Delete",46,"VK_DELETE",a,a],[1,83,"End",13,"End",35,"VK_END",a,a],[1,84,"PageDown",12,"PageDown",34,"VK_NEXT",a,a],[1,85,"ArrowRight",17,"RightArrow",39,"VK_RIGHT","Right",a],[1,86,"ArrowLeft",15,"LeftArrow",37,"VK_LEFT","Left",a],[1,87,"ArrowDown",18,"DownArrow",40,"VK_DOWN","Down",a],[1,88,"ArrowUp",16,"UpArrow",38,"VK_UP","Up",a],[1,89,"NumLock",83,"NumLock",144,"VK_NUMLOCK",a,a],[1,90,"NumpadDivide",113,"NumPad_Divide",111,"VK_DIVIDE",a,a],[1,91,"NumpadMultiply",108,"NumPad_Multiply",106,"VK_MULTIPLY",a,a],[1,92,"NumpadSubtract",111,"NumPad_Subtract",109,"VK_SUBTRACT",a,a],[1,93,"NumpadAdd",109,"NumPad_Add",107,"VK_ADD",a,a],[1,94,"NumpadEnter",3,a,0,a,a,a],[1,95,"Numpad1",99,"NumPad1",97,"VK_NUMPAD1",a,a],[1,96,"Numpad2",100,"NumPad2",98,"VK_NUMPAD2",a,a],[1,97,"Numpad3",101,"NumPad3",99,"VK_NUMPAD3",a,a],[1,98,"Numpad4",102,"NumPad4",100,"VK_NUMPAD4",a,a],[1,99,"Numpad5",103,"NumPad5",101,"VK_NUMPAD5",a,a],[1,100,"Numpad6",104,"NumPad6",102,"VK_NUMPAD6",a,a],[1,101,"Numpad7",105,"NumPad7",103,"VK_NUMPAD7",a,a],[1,102,"Numpad8",106,"NumPad8",104,"VK_NUMPAD8",a,a],[1,103,"Numpad9",107,"NumPad9",105,"VK_NUMPAD9",a,a],[1,104,"Numpad0",98,"NumPad0",96,"VK_NUMPAD0",a,a],[1,105,"NumpadDecimal",112,"NumPad_Decimal",110,"VK_DECIMAL",a,a],[0,106,"IntlBackslash",97,"OEM_102",226,"VK_OEM_102",a,a],[1,107,"ContextMenu",58,"ContextMenu",93,a,a,a],[1,108,"Power",0,a,0,a,a,a],[1,109,"NumpadEqual",0,a,0,a,a,a],[1,110,"F13",71,"F13",124,"VK_F13",a,a],[1,111,"F14",72,"F14",125,"VK_F14",a,a],[1,112,"F15",73,"F15",126,"VK_F15",a,a],[1,113,"F16",74,"F16",127,"VK_F16",a,a],[1,114,"F17",75,"F17",128,"VK_F17",a,a],[1,115,"F18",76,"F18",129,"VK_F18",a,a],[1,116,"F19",77,"F19",130,"VK_F19",a,a],[1,117,"F20",78,"F20",131,"VK_F20",a,a],[1,118,"F21",79,"F21",132,"VK_F21",a,a],[1,119,"F22",80,"F22",133,"VK_F22",a,a],[1,120,"F23",81,"F23",134,"VK_F23",a,a],[1,121,"F24",82,"F24",135,"VK_F24",a,a],[1,122,"Open",0,a,0,a,a,a],[1,123,"Help",0,a,0,a,a,a],[1,124,"Select",0,a,0,a,a,a],[1,125,"Again",0,a,0,a,a,a],[1,126,"Undo",0,a,0,a,a,a],[1,127,"Cut",0,a,0,a,a,a],[1,128,"Copy",0,a,0,a,a,a],[1,129,"Paste",0,a,0,a,a,a],[1,130,"Find",0,a,0,a,a,a],[1,131,"AudioVolumeMute",117,"AudioVolumeMute",173,"VK_VOLUME_MUTE",a,a],[1,132,"AudioVolumeUp",118,"AudioVolumeUp",175,"VK_VOLUME_UP",a,a],[1,133,"AudioVolumeDown",119,"AudioVolumeDown",174,"VK_VOLUME_DOWN",a,a],[1,134,"NumpadComma",110,"NumPad_Separator",108,"VK_SEPARATOR",a,a],[0,135,"IntlRo",115,"ABNT_C1",193,"VK_ABNT_C1",a,a],[1,136,"KanaMode",0,a,0,a,a,a],[0,137,"IntlYen",0,a,0,a,a,a],[1,138,"Convert",0,a,0,a,a,a],[1,139,"NonConvert",0,a,0,a,a,a],[1,140,"Lang1",0,a,0,a,a,a],[1,141,"Lang2",0,a,0,a,a,a],[1,142,"Lang3",0,a,0,a,a,a],[1,143,"Lang4",0,a,0,a,a,a],[1,144,"Lang5",0,a,0,a,a,a],[1,145,"Abort",0,a,0,a,a,a],[1,146,"Props",0,a,0,a,a,a],[1,147,"NumpadParenLeft",0,a,0,a,a,a],[1,148,"NumpadParenRight",0,a,0,a,a,a],[1,149,"NumpadBackspace",0,a,0,a,a,a],[1,150,"NumpadMemoryStore",0,a,0,a,a,a],[1,151,"NumpadMemoryRecall",0,a,0,a,a,a],[1,152,"NumpadMemoryClear",0,a,0,a,a,a],[1,153,"NumpadMemoryAdd",0,a,0,a,a,a],[1,154,"NumpadMemorySubtract",0,a,0,a,a,a],[1,155,"NumpadClear",131,"Clear",12,"VK_CLEAR",a,a],[1,156,"NumpadClearEntry",0,a,0,a,a,a],[1,0,a,5,"Ctrl",17,"VK_CONTROL",a,a],[1,0,a,4,"Shift",16,"VK_SHIFT",a,a],[1,0,a,6,"Alt",18,"VK_MENU",a,a],[1,0,a,57,"Meta",91,"VK_COMMAND",a,a],[1,157,"ControlLeft",5,a,0,"VK_LCONTROL",a,a],[1,158,"ShiftLeft",4,a,0,"VK_LSHIFT",a,a],[1,159,"AltLeft",6,a,0,"VK_LMENU",a,a],[1,160,"MetaLeft",57,a,0,"VK_LWIN",a,a],[1,161,"ControlRight",5,a,0,"VK_RCONTROL",a,a],[1,162,"ShiftRight",4,a,0,"VK_RSHIFT",a,a],[1,163,"AltRight",6,a,0,"VK_RMENU",a,a],[1,164,"MetaRight",57,a,0,"VK_RWIN",a,a],[1,165,"BrightnessUp",0,a,0,a,a,a],[1,166,"BrightnessDown",0,a,0,a,a,a],[1,167,"MediaPlay",0,a,0,a,a,a],[1,168,"MediaRecord",0,a,0,a,a,a],[1,169,"MediaFastForward",0,a,0,a,a,a],[1,170,"MediaRewind",0,a,0,a,a,a],[1,171,"MediaTrackNext",124,"MediaTrackNext",176,"VK_MEDIA_NEXT_TRACK",a,a],[1,172,"MediaTrackPrevious",125,"MediaTrackPrevious",177,"VK_MEDIA_PREV_TRACK",a,a],[1,173,"MediaStop",126,"MediaStop",178,"VK_MEDIA_STOP",a,a],[1,174,"Eject",0,a,0,a,a,a],[1,175,"MediaPlayPause",127,"MediaPlayPause",179,"VK_MEDIA_PLAY_PAUSE",a,a],[1,176,"MediaSelect",128,"LaunchMediaPlayer",181,"VK_MEDIA_LAUNCH_MEDIA_SELECT",a,a],[1,177,"LaunchMail",129,"LaunchMail",180,"VK_MEDIA_LAUNCH_MAIL",a,a],[1,178,"LaunchApp2",130,"LaunchApp2",183,"VK_MEDIA_LAUNCH_APP2",a,a],[1,179,"LaunchApp1",0,a,0,"VK_MEDIA_LAUNCH_APP1",a,a],[1,180,"SelectTask",0,a,0,a,a,a],[1,181,"LaunchScreenSaver",0,a,0,a,a,a],[1,182,"BrowserSearch",120,"BrowserSearch",170,"VK_BROWSER_SEARCH",a,a],[1,183,"BrowserHome",121,"BrowserHome",172,"VK_BROWSER_HOME",a,a],[1,184,"BrowserBack",122,"BrowserBack",166,"VK_BROWSER_BACK",a,a],[1,185,"BrowserForward",123,"BrowserForward",167,"VK_BROWSER_FORWARD",a,a],[1,186,"BrowserStop",0,a,0,"VK_BROWSER_STOP",a,a],[1,187,"BrowserRefresh",0,a,0,"VK_BROWSER_REFRESH",a,a],[1,188,"BrowserFavorites",0,a,0,"VK_BROWSER_FAVORITES",a,a],[1,189,"ZoomToggle",0,a,0,a,a,a],[1,190,"MailReply",0,a,0,a,a,a],[1,191,"MailForward",0,a,0,a,a,a],[1,192,"MailSend",0,a,0,a,a,a],[1,0,a,114,"KeyInComposition",229,a,a,a],[1,0,a,116,"ABNT_C2",194,"VK_ABNT_C2",a,a],[1,0,a,96,"OEM_8",223,"VK_OEM_8",a,a],[1,0,a,0,a,0,"VK_KANA",a,a],[1,0,a,0,a,0,"VK_HANGUL",a,a],[1,0,a,0,a,0,"VK_JUNJA",a,a],[1,0,a,0,a,0,"VK_FINAL",a,a],[1,0,a,0,a,0,"VK_HANJA",a,a],[1,0,a,0,a,0,"VK_KANJI",a,a],[1,0,a,0,a,0,"VK_CONVERT",a,a],[1,0,a,0,a,0,"VK_NONCONVERT",a,a],[1,0,a,0,a,0,"VK_ACCEPT",a,a],[1,0,a,0,a,0,"VK_MODECHANGE",a,a],[1,0,a,0,a,0,"VK_SELECT",a,a],[1,0,a,0,a,0,"VK_PRINT",a,a],[1,0,a,0,a,0,"VK_EXECUTE",a,a],[1,0,a,0,a,0,"VK_SNAPSHOT",a,a],[1,0,a,0,a,0,"VK_HELP",a,a],[1,0,a,0,a,0,"VK_APPS",a,a],[1,0,a,0,a,0,"VK_PROCESSKEY",a,a],[1,0,a,0,a,0,"VK_PACKET",a,a],[1,0,a,0,a,0,"VK_DBE_SBCSCHAR",a,a],[1,0,a,0,a,0,"VK_DBE_DBCSCHAR",a,a],[1,0,a,0,a,0,"VK_ATTN",a,a],[1,0,a,0,a,0,"VK_CRSEL",a,a],[1,0,a,0,a,0,"VK_EXSEL",a,a],[1,0,a,0,a,0,"VK_EREOF",a,a],[1,0,a,0,a,0,"VK_PLAY",a,a],[1,0,a,0,a,0,"VK_ZOOM",a,a],[1,0,a,0,a,0,"VK_NONAME",a,a],[1,0,a,0,a,0,"VK_PA1",a,a],[1,0,a,0,a,0,"VK_OEM_CLEAR",a,a]],t=[],s=[];for(const o of e){const[r,l,c,d,u,g,f,p,m]=o;if(s[l]||(s[l]=!0,scanCodeStrToInt[c]=l,scanCodeLowerCaseStrToInt[c.toLowerCase()]=l,r&&(IMMUTABLE_CODE_TO_KEY_CODE[l]=d)),!t[d]){if(t[d]=!0,!u)throw new Error(`String representation missing for key code ${d} around scan code ${c}`);uiMap.define(d,u),userSettingsUSMap.define(d,p||u),userSettingsGeneralMap.define(d,m||p||u)}g&&(EVENT_KEY_CODE_MAP[g]=d)}})();var KeyCodeUtils;(function(a){function e(c){return uiMap.keyCodeToStr(c)}a.toString=e;function t(c){return uiMap.strToKeyCode(c)}a.fromString=t;function s(c){return userSettingsUSMap.keyCodeToStr(c)}a.toUserSettingsUS=s;function o(c){return userSettingsGeneralMap.keyCodeToStr(c)}a.toUserSettingsGeneral=o;function r(c){return userSettingsUSMap.strToKeyCode(c)||userSettingsGeneralMap.strToKeyCode(c)}a.fromUserSettings=r;function l(c){if(c>=98&&c<=113)return null;switch(c){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return uiMap.keyCodeToStr(c)}a.toElectronAccelerator=l})(KeyCodeUtils||(KeyCodeUtils={}));function KeyChord(a,e){const t=(e&65535)<<16>>>0;return(a|t)>>>0}function decodeKeybinding(a,e){if(typeof a=="number"){if(a===0)return null;const t=(a&65535)>>>0,s=(a&4294901760)>>>16;return s!==0?new Keybinding([createSimpleKeybinding(t,e),createSimpleKeybinding(s,e)]):new Keybinding([createSimpleKeybinding(t,e)])}else{const t=[];for(let s=0;s<a.length;s++)t.push(createSimpleKeybinding(a[s],e));return new Keybinding(t)}}function createSimpleKeybinding(a,e){const t=!!(a&2048),s=!!(a&256),o=e===2?s:t,r=!!(a&1024),l=!!(a&512),c=e===2?t:s,d=a&255;return new KeyCodeChord(o,r,l,c,d)}class KeyCodeChord{constructor(e,t,s,o,r){this.ctrlKey=e,this.shiftKey=t,this.altKey=s,this.metaKey=o,this.keyCode=r}equals(e){return e instanceof KeyCodeChord&&this.ctrlKey===e.ctrlKey&&this.shiftKey===e.shiftKey&&this.altKey===e.altKey&&this.metaKey===e.metaKey&&this.keyCode===e.keyCode}isModifierKey(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}isDuplicateModifierCase(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}}class Keybinding{constructor(e){if(e.length===0)throw illegalArgument("chords");this.chords=e}}class ResolvedChord{constructor(e,t,s,o,r,l){this.ctrlKey=e,this.shiftKey=t,this.altKey=s,this.metaKey=o,this.keyLabel=r,this.keyAriaLabel=l}}class ResolvedKeybinding{}function extractKeyCode(a){if(a.charCode){const t=String.fromCharCode(a.charCode).toUpperCase();return KeyCodeUtils.fromString(t)}const e=a.keyCode;if(e===3)return 7;if(isFirefox$1)switch(e){case 59:return 85;case 60:if(isLinux)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(isMacintosh)return 57;break}else if(isWebKit){if(isMacintosh&&e===93)return 57;if(!isMacintosh&&e===92)return 57}return EVENT_KEY_CODE_MAP[e]||0}const ctrlKeyMod$2=isMacintosh?256:2048,altKeyMod=512,shiftKeyMod=1024,metaKeyMod=isMacintosh?2048:256;class StandardKeyboardEvent{constructor(e){var s;this._standardKeyboardEventBrand=!0;const t=e;this.browserEvent=t,this.target=t.target,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.altGraphKey=(s=t.getModifierState)==null?void 0:s.call(t,"AltGraph"),this.keyCode=extractKeyCode(t),this.code=t.code,this.ctrlKey=this.ctrlKey||this.keyCode===5,this.altKey=this.altKey||this.keyCode===6,this.shiftKey=this.shiftKey||this.keyCode===4,this.metaKey=this.metaKey||this.keyCode===57,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals(e){return this._asKeybinding===e}_computeKeybinding(){let e=0;this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode);let t=0;return this.ctrlKey&&(t|=ctrlKeyMod$2),this.altKey&&(t|=altKeyMod),this.shiftKey&&(t|=shiftKeyMod),this.metaKey&&(t|=metaKeyMod),t|=e,t}_computeKeyCodeChord(){let e=0;return this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode),new KeyCodeChord(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,e)}}const sameOriginWindowChainCache=new WeakMap;function getParentWindowIfSameOrigin(a){if(!a.parent||a.parent===a)return null;try{const e=a.location,t=a.parent.location;if(e.origin!=="null"&&t.origin!=="null"&&e.origin!==t.origin)return null}catch{return null}return a.parent}class IframeUtils{static getSameOriginWindowChain(e){let t=sameOriginWindowChainCache.get(e);if(!t){t=[],sameOriginWindowChainCache.set(e,t);let s=e,o;do o=getParentWindowIfSameOrigin(s),o?t.push({window:new WeakRef(s),iframeElement:s.frameElement||null}):t.push({window:new WeakRef(s),iframeElement:null}),s=o;while(s)}return t.slice(0)}static getPositionOfChildWindowRelativeToAncestorWindow(e,t){if(!t||e===t)return{top:0,left:0};let s=0,o=0;const r=this.getSameOriginWindowChain(e);for(const l of r){const c=l.window.deref();if(s+=(c==null?void 0:c.scrollY)??0,o+=(c==null?void 0:c.scrollX)??0,c===t||!l.iframeElement)break;const d=l.iframeElement.getBoundingClientRect();s+=d.top,o+=d.left}return{top:s,left:o}}}class StandardMouseEvent{constructor(e,t){this.timestamp=Date.now(),this.browserEvent=t,this.leftButton=t.button===0,this.middleButton=t.button===1,this.rightButton=t.button===2,this.buttons=t.buttons,this.defaultPrevented=t.defaultPrevented,this.target=t.target,this.detail=t.detail||1,t.type==="dblclick"&&(this.detail=2),this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,typeof t.pageX=="number"?(this.posx=t.pageX,this.posy=t.pageY):(this.posx=t.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=t.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);const s=IframeUtils.getPositionOfChildWindowRelativeToAncestorWindow(e,t.view);this.posx-=s.left,this.posy-=s.top}preventDefault(){this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent.stopPropagation()}}class StandardWheelEvent{constructor(e,t=0,s=0){var r;this.browserEvent=e||null,this.target=e?e.target||e.targetNode||e.srcElement:null,this.deltaY=s,this.deltaX=t;let o=!1;if(isChrome$1){const l=navigator.userAgent.match(/Chrome\/(\d+)/);o=(l?parseInt(l[1]):123)<=122}if(e){const l=e,c=e,d=((r=e.view)==null?void 0:r.devicePixelRatio)||1;if(typeof l.wheelDeltaY<"u")o?this.deltaY=l.wheelDeltaY/(120*d):this.deltaY=l.wheelDeltaY/120;else if(typeof c.VERTICAL_AXIS<"u"&&c.axis===c.VERTICAL_AXIS)this.deltaY=-c.detail/3;else if(e.type==="wheel"){const u=e;u.deltaMode===u.DOM_DELTA_LINE?isFirefox$1&&!isMacintosh?this.deltaY=-e.deltaY/3:this.deltaY=-e.deltaY:this.deltaY=-e.deltaY/40}if(typeof l.wheelDeltaX<"u")isSafari$1&&isWindows?this.deltaX=-(l.wheelDeltaX/120):o?this.deltaX=l.wheelDeltaX/(120*d):this.deltaX=l.wheelDeltaX/120;else if(typeof c.HORIZONTAL_AXIS<"u"&&c.axis===c.HORIZONTAL_AXIS)this.deltaX=-e.detail/3;else if(e.type==="wheel"){const u=e;u.deltaMode===u.DOM_DELTA_LINE?isFirefox$1&&!isMacintosh?this.deltaX=-e.deltaX/3:this.deltaX=-e.deltaX:this.deltaX=-e.deltaX/40}this.deltaY===0&&this.deltaX===0&&e.wheelDelta&&(o?this.deltaY=e.wheelDelta/(120*d):this.deltaY=e.wheelDelta/120)}}preventDefault(){var e;(e=this.browserEvent)==null||e.preventDefault()}stopPropagation(){var e;(e=this.browserEvent)==null||e.stopPropagation()}}function createSingleCallFunction(a,e){const t=this;let s=!1,o;return function(){if(s)return o;if(s=!0,e)try{o=a.apply(t,arguments)}finally{e()}else o=a.apply(t,arguments);return o}}var Iterable;(function(a){function e(E){return!!E&&typeof E=="object"&&typeof E[Symbol.iterator]=="function"}a.is=e;const t=Object.freeze([]);function s(){return t}a.empty=s;function*o(E){yield E}a.single=o;function r(E){return e(E)?E:o(E)}a.wrap=r;function l(E){return E||t}a.from=l;function*c(E){for(let I=E.length-1;I>=0;I--)yield E[I]}a.reverse=c;function d(E){return!E||E[Symbol.iterator]().next().done===!0}a.isEmpty=d;function u(E){return E[Symbol.iterator]().next().value}a.first=u;function g(E,I){let D=0;for(const k of E)if(I(k,D++))return!0;return!1}a.some=g;function f(E,I){let D=0;for(const k of E)if(!I(k,D++))return!1;return!0}a.every=f;function p(E,I){for(const D of E)if(I(D))return D}a.find=p;function*m(E,I){for(const D of E)I(D)&&(yield D)}a.filter=m;function*_(E,I){let D=0;for(const k of E)yield I(k,D++)}a.map=_;function*C(E,I){let D=0;for(const k of E)yield*I(k,D++)}a.flatMap=C;function*b(...E){for(const I of E)isIterable(I)?yield*I:yield I}a.concat=b;function v(E,I,D){let k=D;for(const N of E)k=I(k,N);return k}a.reduce=v;function S(E){let I=0;for(const D of E)I++;return I}a.length=S;function*y(E,I,D=E.length){for(I<-E.length&&(I=0),I<0&&(I+=E.length),D<0?D+=E.length:D>E.length&&(D=E.length);I<D;I++)yield E[I]}a.slice=y;function w(E,I=Number.POSITIVE_INFINITY){const D=[];if(I===0)return[D,E];const k=E[Symbol.iterator]();for(let N=0;N<I;N++){const R=k.next();if(R.done)return[D,a.empty()];D.push(R.value)}return[D,{[Symbol.iterator](){return k}}]}a.consume=w;async function L(E){const I=[];for await(const D of E)I.push(D);return I}a.asyncToArray=L;async function x(E){let I=[];for await(const D of E)I=I.concat(D);return I}a.asyncToArrayFlat=x})(Iterable||(Iterable={}));function setParentOfDisposable(a,e){}function markAsSingleton(a){return a}function isDisposable(a){return typeof a=="object"&&a!==null&&typeof a.dispose=="function"&&a.dispose.length===0}function dispose(a){if(Iterable.is(a)){const e=[];for(const t of a)if(t)try{t.dispose()}catch(s){e.push(s)}if(e.length===1)throw e[0];if(e.length>1)throw new AggregateError(e,"Encountered errors while disposing of store");return Array.isArray(a)?[]:a}else if(a)return a.dispose(),a}function combinedDisposable(...a){return toDisposable(()=>dispose(a))}class FunctionDisposable{constructor(e){this._isDisposed=!1,this._fn=e}dispose(){if(!this._isDisposed){if(!this._fn)throw new Error("Unbound disposable context: Need to use an arrow function to preserve the value of this");this._isDisposed=!0,this._fn()}}}function toDisposable(a){return new FunctionDisposable(a)}const Qn=class Qn{constructor(){this._toDispose=new Set,this._isDisposed=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{dispose(this._toDispose)}finally{this._toDispose.clear()}}add(e){if(!e||e===Disposable.None)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?Qn.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(e),e}delete(e){if(e){if(e===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(e),e.dispose()}}};Qn.DISABLE_DISPOSED_WARNING=!1;let DisposableStore=Qn;const Ho=class Ho{constructor(){this._store=new DisposableStore,this._store}dispose(){this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};Ho.None=Object.freeze({dispose(){}});let Disposable=Ho;class MutableDisposable{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(e){var t;this._isDisposed||e===this._value||((t=this._value)==null||t.dispose(),this._value=e)}clear(){this.value=void 0}dispose(){var e;this._isDisposed=!0,(e=this._value)==null||e.dispose(),this._value=void 0}}class RefCountedDisposable{constructor(e){this._disposable=e,this._counter=1}acquire(){return this._counter++,this}release(){return--this._counter===0&&this._disposable.dispose(),this}}class ImmortalReference{constructor(e){this.object=e}dispose(){}}class DisposableMap{constructor(){this._store=new Map,this._isDisposed=!1}dispose(){this._isDisposed=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this._store.size)try{dispose(this._store.values())}finally{this._store.clear()}}get(e){return this._store.get(e)}set(e,t,s=!1){var o;this._isDisposed&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),s||(o=this._store.get(e))==null||o.dispose(),this._store.set(e,t)}deleteAndDispose(e){var t;(t=this._store.get(e))==null||t.dispose(),this._store.delete(e)}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}}var rt;let Node$2=(rt=class{constructor(e){this.element=e,this.next=rt.Undefined,this.prev=rt.Undefined}},rt.Undefined=new rt(void 0),rt);class LinkedList{constructor(){this._first=Node$2.Undefined,this._last=Node$2.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===Node$2.Undefined}clear(){let e=this._first;for(;e!==Node$2.Undefined;){const t=e.next;e.prev=Node$2.Undefined,e.next=Node$2.Undefined,e=t}this._first=Node$2.Undefined,this._last=Node$2.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,t){const s=new Node$2(e);if(this._first===Node$2.Undefined)this._first=s,this._last=s;else if(t){const r=this._last;this._last=s,s.prev=r,r.next=s}else{const r=this._first;this._first=s,s.next=r,r.prev=s}this._size+=1;let o=!1;return()=>{o||(o=!0,this._remove(s))}}shift(){if(this._first!==Node$2.Undefined){const e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==Node$2.Undefined){const e=this._last.element;return this._remove(this._last),e}}_remove(e){if(e.prev!==Node$2.Undefined&&e.next!==Node$2.Undefined){const t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===Node$2.Undefined&&e.next===Node$2.Undefined?(this._first=Node$2.Undefined,this._last=Node$2.Undefined):e.next===Node$2.Undefined?(this._last=this._last.prev,this._last.next=Node$2.Undefined):e.prev===Node$2.Undefined&&(this._first=this._first.next,this._first.prev=Node$2.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==Node$2.Undefined;)yield e.element,e=e.next}}const performanceNow=globalThis.performance.now.bind(globalThis.performance);class StopWatch{static create(e){return new StopWatch(e)}constructor(e){this._now=e===!1?Date.now:performanceNow,this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}}var Event$1;(function(a){a.None=()=>Disposable.None;function e(R,M){return p(R,()=>{},0,void 0,!0,void 0,M)}a.defer=e;function t(R){return(M,A=null,O)=>{let P=!1,W;return W=R(B=>{if(!P)return W?W.dispose():P=!0,M.call(A,B)},null,O),P&&W.dispose(),W}}a.once=t;function s(R,M){return a.once(a.filter(R,M))}a.onceIf=s;function o(R,M,A){return g((O,P=null,W)=>R(B=>O.call(P,M(B)),null,W),A)}a.map=o;function r(R,M,A){return g((O,P=null,W)=>R(B=>{M(B),O.call(P,B)},null,W),A)}a.forEach=r;function l(R,M,A){return g((O,P=null,W)=>R(B=>M(B)&&O.call(P,B),null,W),A)}a.filter=l;function c(R){return R}a.signal=c;function d(...R){return(M,A=null,O)=>{const P=combinedDisposable(...R.map(W=>W(B=>M.call(A,B))));return f(P,O)}}a.any=d;function u(R,M,A,O){let P=A;return o(R,W=>(P=M(P,W),P),O)}a.reduce=u;function g(R,M){let A;const O={onWillAddFirstListener(){A=R(P.fire,P)},onDidRemoveLastListener(){A==null||A.dispose()}},P=new Emitter$1(O);return M==null||M.add(P),P.event}function f(R,M){return M instanceof Array?M.push(R):M&&M.add(R),R}function p(R,M,A=100,O=!1,P=!1,W,B){let H,V,K,z=0,G;const X={leakWarningThreshold:W,onWillAddFirstListener(){H=R(ee=>{z++,V=M(V,ee),O&&!K&&(Y.fire(V),V=void 0),G=()=>{const le=V;V=void 0,K=void 0,(!O||z>1)&&Y.fire(le),z=0},typeof A=="number"?(K&&clearTimeout(K),K=setTimeout(G,A)):K===void 0&&(K=null,queueMicrotask(G))})},onWillRemoveListener(){P&&z>0&&(G==null||G())},onDidRemoveLastListener(){G=void 0,H.dispose()}},Y=new Emitter$1(X);return B==null||B.add(Y),Y.event}a.debounce=p;function m(R,M=0,A){return a.debounce(R,(O,P)=>O?(O.push(P),O):[P],M,void 0,!0,void 0,A)}a.accumulate=m;function _(R,M=(O,P)=>O===P,A){let O=!0,P;return l(R,W=>{const B=O||!M(W,P);return O=!1,P=W,B},A)}a.latch=_;function C(R,M,A){return[a.filter(R,M,A),a.filter(R,O=>!M(O),A)]}a.split=C;function b(R,M=!1,A=[],O){let P=A.slice(),W=R(V=>{P?P.push(V):H.fire(V)});O&&O.add(W);const B=()=>{P==null||P.forEach(V=>H.fire(V)),P=null},H=new Emitter$1({onWillAddFirstListener(){W||(W=R(V=>H.fire(V)),O&&O.add(W))},onDidAddFirstListener(){P&&(M?setTimeout(B):B())},onDidRemoveLastListener(){W&&W.dispose(),W=null}});return O&&O.add(H),H.event}a.buffer=b;function v(R,M){return(O,P,W)=>{const B=M(new y);return R(function(H){const V=B.evaluate(H);V!==S&&O.call(P,V)},void 0,W)}}a.chain=v;const S=Symbol("HaltChainable");class y{constructor(){this.steps=[]}map(M){return this.steps.push(M),this}forEach(M){return this.steps.push(A=>(M(A),A)),this}filter(M){return this.steps.push(A=>M(A)?A:S),this}reduce(M,A){let O=A;return this.steps.push(P=>(O=M(O,P),O)),this}latch(M=(A,O)=>A===O){let A=!0,O;return this.steps.push(P=>{const W=A||!M(P,O);return A=!1,O=P,W?P:S}),this}evaluate(M){for(const A of this.steps)if(M=A(M),M===S)break;return M}}function w(R,M,A=O=>O){const O=(...H)=>B.fire(A(...H)),P=()=>R.on(M,O),W=()=>R.removeListener(M,O),B=new Emitter$1({onWillAddFirstListener:P,onDidRemoveLastListener:W});return B.event}a.fromNodeEventEmitter=w;function L(R,M,A=O=>O){const O=(...H)=>B.fire(A(...H)),P=()=>R.addEventListener(M,O),W=()=>R.removeEventListener(M,O),B=new Emitter$1({onWillAddFirstListener:P,onDidRemoveLastListener:W});return B.event}a.fromDOMEventEmitter=L;function x(R,M){let A;const O=new Promise((P,W)=>{const B=t(R)(P,null,M);A=()=>B.dispose()});return O.cancel=A,O}a.toPromise=x;function E(R,M){return R(A=>M.fire(A))}a.forward=E;function I(R,M,A){return M(A),R(O=>M(O))}a.runAndSubscribe=I;class D{constructor(M,A){this._observable=M,this._counter=0,this._hasChanged=!1;const O={onWillAddFirstListener:()=>{M.addObserver(this),this._observable.reportChanges()},onDidRemoveLastListener:()=>{M.removeObserver(this)}};this.emitter=new Emitter$1(O),A&&A.add(this.emitter)}beginUpdate(M){this._counter++}handlePossibleChange(M){}handleChange(M,A){this._hasChanged=!0}endUpdate(M){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function k(R,M){return new D(R,M).emitter.event}a.fromObservable=k;function N(R){return(M,A,O)=>{let P=0,W=!1;const B={beginUpdate(){P++},endUpdate(){P--,P===0&&(R.reportChanges(),W&&(W=!1,M.call(A)))},handlePossibleChange(){},handleChange(){W=!0}};R.addObserver(B),R.reportChanges();const H={dispose(){R.removeObserver(B)}};return O instanceof DisposableStore?O.add(H):Array.isArray(O)&&O.push(H),H}}a.fromObservableLight=N})(Event$1||(Event$1={}));const Qt=class Qt{constructor(e){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${e}_${Qt._idPool++}`,Qt.all.add(this)}start(e){this._stopWatch=new StopWatch,this.listenerCount=e}stop(){if(this._stopWatch){const e=this._stopWatch.elapsed();this.durations.push(e),this.elapsedOverall+=e,this.invocationCount+=1,this._stopWatch=void 0}}};Qt.all=new Set,Qt._idPool=0;let EventProfiling=Qt,_globalLeakWarningThreshold=-1;const Yn=class Yn{constructor(e,t,s=(Yn._idPool++).toString(16).padStart(3,"0")){this._errorHandler=e,this.threshold=t,this.name=s,this._warnCountdown=0}dispose(){var e;(e=this._stacks)==null||e.clear()}check(e,t){const s=this.threshold;if(s<=0||t<s)return;this._stacks||(this._stacks=new Map);const o=this._stacks.get(e.value)||0;if(this._stacks.set(e.value,o+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=s*.5;const[r,l]=this.getMostFrequentStack(),c=`[${this.name}] potential listener LEAK detected, having ${t} listeners already. MOST frequent listener (${l}):`;console.warn(c),console.warn(r);const d=new ListenerLeakError(c,r);this._errorHandler(d)}return()=>{const r=this._stacks.get(e.value)||0;this._stacks.set(e.value,r-1)}}getMostFrequentStack(){if(!this._stacks)return;let e,t=0;for(const[s,o]of this._stacks)(!e||t<o)&&(e=[s,o],t=o);return e}};Yn._idPool=1;let LeakageMonitor=Yn;class Stacktrace{static create(){const e=new Error;return new Stacktrace(e.stack??"")}constructor(e){this.value=e}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}}class ListenerLeakError extends Error{constructor(e,t){super(e),this.name="ListenerLeakError",this.stack=t}}class ListenerRefusalError extends Error{constructor(e,t){super(e),this.name="ListenerRefusalError",this.stack=t}}class UniqueContainer{constructor(e){this.value=e}}const compactionThreshold=2;let Emitter$1=class{constructor(e){var t,s,o,r;this._size=0,this._options=e,this._leakageMon=(t=this._options)!=null&&t.leakWarningThreshold?new LeakageMonitor((e==null?void 0:e.onListenerError)??onUnexpectedError,((s=this._options)==null?void 0:s.leakWarningThreshold)??_globalLeakWarningThreshold):void 0,this._perfMon=(o=this._options)!=null&&o._profName?new EventProfiling(this._options._profName):void 0,this._deliveryQueue=(r=this._options)==null?void 0:r.deliveryQueue}dispose(){var e,t,s,o;this._disposed||(this._disposed=!0,((e=this._deliveryQueue)==null?void 0:e.current)===this&&this._deliveryQueue.reset(),this._listeners&&(this._listeners=void 0,this._size=0),(s=(t=this._options)==null?void 0:t.onDidRemoveLastListener)==null||s.call(t),(o=this._leakageMon)==null||o.dispose())}get event(){return this._event??(this._event=(e,t,s)=>{var c,d,u,g,f,p,m;if(this._leakageMon&&this._size>this._leakageMon.threshold**2){const _=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(_);const C=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],b=new ListenerRefusalError(`${_}. HINT: Stack shows most frequent listener (${C[1]}-times)`,C[0]);return(((c=this._options)==null?void 0:c.onListenerError)||onUnexpectedError)(b),Disposable.None}if(this._disposed)return Disposable.None;t&&(e=e.bind(t));const o=new UniqueContainer(e);let r;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(o.stack=Stacktrace.create(),r=this._leakageMon.check(o.stack,this._size+1)),this._listeners?this._listeners instanceof UniqueContainer?(this._deliveryQueue??(this._deliveryQueue=new EventDeliveryQueuePrivate),this._listeners=[this._listeners,o]):this._listeners.push(o):((u=(d=this._options)==null?void 0:d.onWillAddFirstListener)==null||u.call(d,this),this._listeners=o,(f=(g=this._options)==null?void 0:g.onDidAddFirstListener)==null||f.call(g,this)),(m=(p=this._options)==null?void 0:p.onDidAddListener)==null||m.call(p,this),this._size++;const l=toDisposable(()=>{r==null||r(),this._removeListener(o)});return s instanceof DisposableStore?s.add(l):Array.isArray(s)&&s.push(l),l}),this._event}_removeListener(e){var r,l,c,d;if((l=(r=this._options)==null?void 0:r.onWillRemoveListener)==null||l.call(r,this),!this._listeners)return;if(this._size===1){this._listeners=void 0,(d=(c=this._options)==null?void 0:c.onDidRemoveLastListener)==null||d.call(c,this),this._size=0;return}const t=this._listeners,s=t.indexOf(e);if(s===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,t[s]=void 0;const o=this._deliveryQueue.current===this;if(this._size*compactionThreshold<=t.length){let u=0;for(let g=0;g<t.length;g++)t[g]?t[u++]=t[g]:o&&u<this._deliveryQueue.end&&(this._deliveryQueue.end--,u<this._deliveryQueue.i&&this._deliveryQueue.i--);t.length=u}}_deliver(e,t){var o;if(!e)return;const s=((o=this._options)==null?void 0:o.onListenerError)||onUnexpectedError;if(!s){e.value(t);return}try{e.value(t)}catch(r){s(r)}}_deliverQueue(e){const t=e.current._listeners;for(;e.i<e.end;)this._deliver(t[e.i++],e.value);e.reset()}fire(e){var t,s,o,r;if((t=this._deliveryQueue)!=null&&t.current&&(this._deliverQueue(this._deliveryQueue),(s=this._perfMon)==null||s.stop()),(o=this._perfMon)==null||o.start(this._size),this._listeners)if(this._listeners instanceof UniqueContainer)this._deliver(this._listeners,e);else{const l=this._deliveryQueue;l.enqueue(this,e,this._listeners.length),this._deliverQueue(l)}(r=this._perfMon)==null||r.stop()}hasListeners(){return this._size>0}};const createEventDeliveryQueue=()=>new EventDeliveryQueuePrivate;class EventDeliveryQueuePrivate{constructor(){this.i=-1,this.end=0}enqueue(e,t,s){this.i=0,this.end=s,this.current=e,this.value=t}reset(){this.i=this.end,this.current=void 0,this.value=void 0}}class PauseableEmitter extends Emitter$1{constructor(e){super(e),this._isPaused=0,this._eventQueue=new LinkedList,this._mergeFn=e==null?void 0:e.merge}pause(){this._isPaused++}resume(){if(this._isPaused!==0&&--this._isPaused===0)if(this._mergeFn){if(this._eventQueue.size>0){const e=Array.from(this._eventQueue);this._eventQueue.clear(),super.fire(this._mergeFn(e))}}else for(;!this._isPaused&&this._eventQueue.size!==0;)super.fire(this._eventQueue.shift())}fire(e){this._size&&(this._isPaused!==0?this._eventQueue.push(e):super.fire(e))}}class DebounceEmitter extends PauseableEmitter{constructor(e){super(e),this._delay=e.delay??100}fire(e){this._handle||(this.pause(),this._handle=setTimeout(()=>{this._handle=void 0,this.resume()},this._delay)),super.fire(e)}}class MicrotaskEmitter extends Emitter$1{constructor(e){super(e),this._queuedEvents=[],this._mergeFn=e==null?void 0:e.merge}fire(e){this.hasListeners()&&(this._queuedEvents.push(e),this._queuedEvents.length===1&&queueMicrotask(()=>{this._mergeFn?super.fire(this._mergeFn(this._queuedEvents)):this._queuedEvents.forEach(t=>super.fire(t)),this._queuedEvents=[]}))}}class EventMultiplexer{constructor(){this.hasListeners=!1,this.events=[],this.emitter=new Emitter$1({onWillAddFirstListener:()=>this.onFirstListenerAdd(),onDidRemoveLastListener:()=>this.onLastListenerRemove()})}get event(){return this.emitter.event}add(e){const t={event:e,listener:null};return this.events.push(t),this.hasListeners&&this.hook(t),toDisposable(createSingleCallFunction(()=>{this.hasListeners&&this.unhook(t);const o=this.events.indexOf(t);this.events.splice(o,1)}))}onFirstListenerAdd(){this.hasListeners=!0,this.events.forEach(e=>this.hook(e))}onLastListenerRemove(){this.hasListeners=!1,this.events.forEach(e=>this.unhook(e))}hook(e){e.listener=e.event(t=>this.emitter.fire(t))}unhook(e){var t;(t=e.listener)==null||t.dispose(),e.listener=null}dispose(){var e;this.emitter.dispose();for(const t of this.events)(e=t.listener)==null||e.dispose();this.events=[]}}class EventBufferer{constructor(){this.data=[]}wrapEvent(e,t,s){return(o,r,l)=>e(c=>{const d=this.data[this.data.length-1];if(!t){d?d.buffers.push(()=>o.call(r,c)):o.call(r,c);return}const u=d;if(!u){o.call(r,t(s,c));return}u.items??(u.items=[]),u.items.push(c),u.buffers.length===0&&d.buffers.push(()=>{u.reducedResult??(u.reducedResult=s?u.items.reduce(t,s):u.items.reduce(t)),o.call(r,u.reducedResult)})},void 0,l)}bufferEvents(e){const t={buffers:new Array};this.data.push(t);const s=e();return this.data.pop(),t.buffers.forEach(o=>o()),s}}class Relay{constructor(){this.listening=!1,this.inputEvent=Event$1.None,this.inputEventListener=Disposable.None,this.emitter=new Emitter$1({onDidAddFirstListener:()=>{this.listening=!0,this.inputEventListener=this.inputEvent(this.emitter.fire,this.emitter)},onDidRemoveLastListener:()=>{this.listening=!1,this.inputEventListener.dispose()}}),this.event=this.emitter.event}set input(e){this.inputEvent=e,this.listening&&(this.inputEventListener.dispose(),this.inputEventListener=e(this.emitter.fire,this.emitter))}dispose(){this.inputEventListener.dispose(),this.emitter.dispose()}}const shortcutEvent=Object.freeze(function(a,e){const t=setTimeout(a.bind(e),0);return{dispose(){clearTimeout(t)}}});var CancellationToken;(function(a){function e(t){return t===a.None||t===a.Cancelled||t instanceof MutableToken?!0:!t||typeof t!="object"?!1:typeof t.isCancellationRequested=="boolean"&&typeof t.onCancellationRequested=="function"}a.isCancellationToken=e,a.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Event$1.None}),a.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:shortcutEvent})})(CancellationToken||(CancellationToken={}));class MutableToken{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?shortcutEvent:(this._emitter||(this._emitter=new Emitter$1),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}}let CancellationTokenSource$1=class{constructor(e){this._token=void 0,this._parentListener=void 0,this._parentListener=e&&e.onCancellationRequested(this.cancel,this)}get token(){return this._token||(this._token=new MutableToken),this._token}cancel(){this._token?this._token instanceof MutableToken&&this._token.cancel():this._token=CancellationToken.Cancelled}dispose(e=!1){var t;e&&this.cancel(),(t=this._parentListener)==null||t.dispose(),this._token?this._token instanceof MutableToken&&this._token.dispose():this._token=CancellationToken.None}};function cancelOnDispose(a){const e=new CancellationTokenSource$1;return a.add({dispose(){e.cancel()}}),e.token}const MicrotaskDelay=Symbol("MicrotaskDelay");function isThenable$1(a){return!!a&&typeof a.then=="function"}function createCancelablePromise(a){const e=new CancellationTokenSource$1,t=a(e.token);let s=!1;const o=new Promise((r,l)=>{const c=e.token.onCancellationRequested(()=>{s=!0,c.dispose(),l(new CancellationError)});Promise.resolve(t).then(d=>{c.dispose(),e.dispose(),s?isDisposable(d)&&d.dispose():r(d)},d=>{c.dispose(),e.dispose(),l(d)})});return new class{cancel(){e.cancel(),e.dispose()}then(r,l){return o.then(r,l)}catch(r){return this.then(void 0,r)}finally(r){return o.finally(r)}}}function raceCancellation(a,e,t){return new Promise((s,o)=>{const r=e.onCancellationRequested(()=>{r.dispose(),s(t)});a.then(s,o).finally(()=>r.dispose())})}function raceCancellationError(a,e){return new Promise((t,s)=>{const o=e.onCancellationRequested(()=>{o.dispose(),s(new CancellationError)});a.then(t,s).finally(()=>o.dispose())})}let Throttler$1=class{constructor(){this.isDisposed=!1,this.activePromise=null,this.queuedPromise=null,this.queuedPromiseFactory=null}queue(e){if(this.isDisposed)return Promise.reject(new Error("Throttler is disposed"));if(this.activePromise){if(this.queuedPromiseFactory=e,!this.queuedPromise){const t=()=>{if(this.queuedPromise=null,this.isDisposed)return;const s=this.queue(this.queuedPromiseFactory);return this.queuedPromiseFactory=null,s};this.queuedPromise=new Promise(s=>{this.activePromise.then(t,t).then(s)})}return new Promise((t,s)=>{this.queuedPromise.then(t,s)})}return this.activePromise=e(),new Promise((t,s)=>{this.activePromise.then(o=>{this.activePromise=null,t(o)},o=>{this.activePromise=null,s(o)})})}dispose(){this.isDisposed=!0}};const timeoutDeferred=(a,e)=>{let t=!0;const s=setTimeout(()=>{t=!1,e()},a);return{isTriggered:()=>t,dispose:()=>{clearTimeout(s),t=!1}}},microtaskDeferred=a=>{let e=!0;return queueMicrotask(()=>{e&&(e=!1,a())}),{isTriggered:()=>e,dispose:()=>{e=!1}}};class Delayer{constructor(e){this.defaultDelay=e,this.deferred=null,this.completionPromise=null,this.doResolve=null,this.doReject=null,this.task=null}trigger(e,t=this.defaultDelay){this.task=e,this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise((o,r)=>{this.doResolve=o,this.doReject=r}).then(()=>{if(this.completionPromise=null,this.doResolve=null,this.task){const o=this.task;return this.task=null,o()}}));const s=()=>{var o;this.deferred=null,(o=this.doResolve)==null||o.call(this,null)};return this.deferred=t===MicrotaskDelay?microtaskDeferred(s):timeoutDeferred(t,s),this.completionPromise}isTriggered(){var e;return!!((e=this.deferred)!=null&&e.isTriggered())}cancel(){var e;this.cancelTimeout(),this.completionPromise&&((e=this.doReject)==null||e.call(this,new CancellationError),this.completionPromise=null)}cancelTimeout(){var e;(e=this.deferred)==null||e.dispose(),this.deferred=null}dispose(){this.cancel()}}class ThrottledDelayer{constructor(e){this.delayer=new Delayer(e),this.throttler=new Throttler$1}trigger(e,t){return this.delayer.trigger(()=>this.throttler.queue(e),t)}cancel(){this.delayer.cancel()}dispose(){this.delayer.dispose(),this.throttler.dispose()}}function timeout(a,e){return e?new Promise((t,s)=>{const o=setTimeout(()=>{r.dispose(),t()},a),r=e.onCancellationRequested(()=>{clearTimeout(o),r.dispose(),s(new CancellationError)})}):createCancelablePromise(t=>timeout(a,t))}function disposableTimeout(a,e=0,t){const s=setTimeout(()=>{a(),t&&o.dispose()},e),o=toDisposable(()=>{clearTimeout(s),t==null||t.delete(o)});return t==null||t.add(o),o}function first(a,e=s=>!!s,t=null){let s=0;const o=a.length,r=()=>{if(s>=o)return Promise.resolve(t);const l=a[s++];return Promise.resolve(l()).then(d=>e(d)?Promise.resolve(d):r())};return r()}let TaskQueue$1=class{constructor(){this._runningTask=void 0,this._pendingTasks=[]}schedule(e){const t=new DeferredPromise;return this._pendingTasks.push({task:e,deferred:t,setUndefinedWhenCleared:!1}),this._runIfNotRunning(),t.p}_runIfNotRunning(){this._runningTask===void 0&&this._processQueue()}async _processQueue(){if(this._pendingTasks.length===0)return;const e=this._pendingTasks.shift();if(e){if(this._runningTask)throw new BugIndicatingError;this._runningTask=e.task;try{const t=await e.task();e.deferred.complete(t)}catch(t){e.deferred.error(t)}finally{this._runningTask=void 0,this._processQueue()}}}clearPending(){const e=this._pendingTasks;this._pendingTasks=[];for(const t of e)t.setUndefinedWhenCleared?t.deferred.complete(void 0):t.deferred.error(new CancellationError)}};class TimeoutTimer{constructor(e,t){this._isDisposed=!1,this._token=void 0,typeof e=="function"&&typeof t=="number"&&this.setIfNotSet(e,t)}dispose(){this.cancel(),this._isDisposed=!0}cancel(){this._token!==void 0&&(clearTimeout(this._token),this._token=void 0)}cancelAndSet(e,t){if(this._isDisposed)throw new BugIndicatingError("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(()=>{this._token=void 0,e()},t)}setIfNotSet(e,t){if(this._isDisposed)throw new BugIndicatingError("Calling 'setIfNotSet' on a disposed TimeoutTimer");this._token===void 0&&(this._token=setTimeout(()=>{this._token=void 0,e()},t))}}class IntervalTimer{constructor(){this.disposable=void 0,this.isDisposed=!1}cancel(){var e;(e=this.disposable)==null||e.dispose(),this.disposable=void 0}cancelAndSet(e,t,s=globalThis){if(this.isDisposed)throw new BugIndicatingError("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();const o=s.setInterval(()=>{e()},t);this.disposable=toDisposable(()=>{s.clearInterval(o),this.disposable=void 0})}dispose(){this.cancel(),this.isDisposed=!0}}class RunOnceScheduler{constructor(e,t){this.timeoutToken=void 0,this.runner=e,this.timeout=t,this.timeoutHandler=this.onTimeout.bind(this)}dispose(){this.cancel(),this.runner=null}cancel(){this.isScheduled()&&(clearTimeout(this.timeoutToken),this.timeoutToken=void 0)}schedule(e=this.timeout){this.cancel(),this.timeoutToken=setTimeout(this.timeoutHandler,e)}get delay(){return this.timeout}set delay(e){this.timeout=e}isScheduled(){return this.timeoutToken!==void 0}onTimeout(){this.timeoutToken=void 0,this.runner&&this.doRun()}doRun(){var e;(e=this.runner)==null||e.call(this)}}let runWhenGlobalIdle,_runWhenIdle;(function(){const a=globalThis;typeof a.requestIdleCallback!="function"||typeof a.cancelIdleCallback!="function"?_runWhenIdle=(e,t,s)=>{setTimeout0(()=>{if(o)return;const r=Date.now()+15;t(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,r-Date.now())}}))});let o=!1;return{dispose(){o||(o=!0)}}}:_runWhenIdle=(e,t,s)=>{const o=e.requestIdleCallback(t,typeof s=="number"?{timeout:s}:void 0);let r=!1;return{dispose(){r||(r=!0,e.cancelIdleCallback(o))}}},runWhenGlobalIdle=(e,t)=>_runWhenIdle(globalThis,e,t)})();class AbstractIdleValue{constructor(e,t){this._didRun=!1,this._executor=()=>{try{this._value=t()}catch(s){this._error=s}finally{this._didRun=!0}},this._handle=_runWhenIdle(e,()=>this._executor())}dispose(){this._handle.dispose()}get value(){if(this._didRun||(this._handle.dispose(),this._executor()),this._error)throw this._error;return this._value}get isInitialized(){return this._didRun}}class GlobalIdleValue extends AbstractIdleValue{constructor(e){super(globalThis,e)}}class DeferredPromise{get isRejected(){var e;return((e=this.outcome)==null?void 0:e.outcome)===1}get isSettled(){return!!this.outcome}constructor(){this.p=new Promise((e,t)=>{this.completeCallback=e,this.errorCallback=t})}complete(e){return this.isSettled?Promise.resolve():new Promise(t=>{this.completeCallback(e),this.outcome={outcome:0,value:e},t()})}error(e){return this.isSettled?Promise.resolve():new Promise(t=>{this.errorCallback(e),this.outcome={outcome:1,value:e},t()})}cancel(){return this.error(new CancellationError)}}var Promises;(function(a){async function e(s){let o;const r=await Promise.all(s.map(l=>l.then(c=>c,c=>{o||(o=c)})));if(typeof o<"u")throw o;return r}a.settled=e;function t(s){return new Promise(async(o,r)=>{try{await s(o,r)}catch(l){r(l)}})}a.withAsyncBody=t})(Promises||(Promises={}));function createCancelableAsyncIterableProducer(a){const e=new CancellationTokenSource$1,t=a(e.token);return new CancelableAsyncIterableProducer(e,async s=>{const o=e.token.onCancellationRequested(()=>{o.dispose(),e.dispose(),s.reject(new CancellationError)});try{for await(const r of t){if(e.token.isCancellationRequested)return;s.emitOne(r)}o.dispose(),e.dispose()}catch(r){o.dispose(),e.dispose(),s.reject(r)}})}class ProducerConsumer{constructor(){this._unsatisfiedConsumers=[],this._unconsumedValues=[]}get hasFinalValue(){return!!this._finalValue}produce(e){if(this._ensureNoFinalValue(),this._unsatisfiedConsumers.length>0){const t=this._unsatisfiedConsumers.shift();this._resolveOrRejectDeferred(t,e)}else this._unconsumedValues.push(e)}produceFinal(e){this._ensureNoFinalValue(),this._finalValue=e;for(const t of this._unsatisfiedConsumers)this._resolveOrRejectDeferred(t,e);this._unsatisfiedConsumers.length=0}_ensureNoFinalValue(){if(this._finalValue)throw new BugIndicatingError("ProducerConsumer: cannot produce after final value has been set")}_resolveOrRejectDeferred(e,t){t.ok?e.complete(t.value):e.error(t.error)}consume(){if(this._unconsumedValues.length>0||this._finalValue){const e=this._unconsumedValues.length>0?this._unconsumedValues.shift():this._finalValue;return e.ok?Promise.resolve(e.value):Promise.reject(e.error)}else{const e=new DeferredPromise;return this._unsatisfiedConsumers.push(e),e.p}}}const be=class be{constructor(e,t){this._onReturn=t,this._producerConsumer=new ProducerConsumer,this._iterator={next:()=>this._producerConsumer.consume(),return:()=>{var s;return(s=this._onReturn)==null||s.call(this),Promise.resolve({done:!0,value:void 0})},throw:async s=>(this._finishError(s),{done:!0,value:void 0})},queueMicrotask(async()=>{const s=e({emitOne:o=>this._producerConsumer.produce({ok:!0,value:{done:!1,value:o}}),emitMany:o=>{for(const r of o)this._producerConsumer.produce({ok:!0,value:{done:!1,value:r}})},reject:o=>this._finishError(o)});if(!this._producerConsumer.hasFinalValue)try{await s,this._finishOk()}catch(o){this._finishError(o)}})}static fromArray(e){return new be(t=>{t.emitMany(e)})}static fromPromise(e){return new be(async t=>{t.emitMany(await e)})}static fromPromisesResolveOrder(e){return new be(async t=>{await Promise.all(e.map(async s=>t.emitOne(await s)))})}static merge(e){return new be(async t=>{await Promise.all(e.map(async s=>{for await(const o of s)t.emitOne(o)}))})}static map(e,t){return new be(async s=>{for await(const o of e)s.emitOne(t(o))})}map(e){return be.map(this,e)}static coalesce(e){return be.filter(e,t=>!!t)}coalesce(){return be.coalesce(this)}static filter(e,t){return new be(async s=>{for await(const o of e)t(o)&&s.emitOne(o)})}filter(e){return be.filter(this,e)}_finishOk(){this._producerConsumer.hasFinalValue||this._producerConsumer.produceFinal({ok:!0,value:{done:!0,value:void 0}})}_finishError(e){this._producerConsumer.hasFinalValue||this._producerConsumer.produceFinal({ok:!1,error:e})}[Symbol.asyncIterator](){return this._iterator}};be.EMPTY=be.fromArray([]);let AsyncIterableProducer=be;class CancelableAsyncIterableProducer extends AsyncIterableProducer{constructor(e,t){super(t),this._source=e}cancel(){this._source.cancel()}}function identity(a){return a}class LRUCachedFunction{constructor(e,t){this.lastCache=void 0,this.lastArgKey=void 0,typeof e=="function"?(this._fn=e,this._computeKey=identity):(this._fn=t,this._computeKey=e.getCacheKey)}get(e){const t=this._computeKey(e);return this.lastArgKey!==t&&(this.lastArgKey=t,this.lastCache=this._fn(e)),this.lastCache}}class CachedFunction{get cachedValues(){return this._map}constructor(e,t){this._map=new Map,this._map2=new Map,typeof e=="function"?(this._fn=e,this._computeKey=identity):(this._fn=t,this._computeKey=e.getCacheKey)}get(e){const t=this._computeKey(e);if(this._map2.has(t))return this._map2.get(t);const s=this._fn(e);return this._map.set(e,s),this._map2.set(t,s),s}}var LazyValueState;(function(a){a[a.Uninitialized=0]="Uninitialized",a[a.Running=1]="Running",a[a.Completed=2]="Completed"})(LazyValueState||(LazyValueState={}));class Lazy{constructor(e){this.executor=e,this._state=LazyValueState.Uninitialized}get value(){if(this._state===LazyValueState.Uninitialized){this._state=LazyValueState.Running;try{this._value=this.executor()}catch(e){this._error=e}finally{this._state=LazyValueState.Completed}}else if(this._state===LazyValueState.Running)throw new Error("Cannot read the value of a lazy that is being initialized");if(this._error)throw this._error;return this._value}get rawValue(){return this._value}}function isFalsyOrWhitespace(a){return!a||typeof a!="string"?!0:a.trim().length===0}const _formatRegexp=/{(\d+)}/g;function format(a,...e){return e.length===0?a:a.replace(_formatRegexp,function(t,s){const o=parseInt(s,10);return isNaN(o)||o<0||o>=e.length?t:e[o]})}function htmlAttributeEncodeValue(a){return a.replace(/[<>"'&]/g,e=>{switch(e){case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&apos;";case"&":return"&amp;"}return e})}function escape$2(a){return a.replace(/[<>&]/g,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";default:return e}})}function escapeRegExpCharacters(a){return a.replace(/[\\\{\}\*\+\?\|\^\$\.\[\]\(\)]/g,"\\$&")}function ltrim(a,e){if(!a||!e)return a;const t=e.length;if(t===0||a.length===0)return a;let s=0;for(;a.indexOf(e,s)===s;)s=s+t;return a.substring(s)}function rtrim$1(a,e){if(!a||!e)return a;const t=e.length,s=a.length;if(t===0||s===0)return a;let o=s,r=-1;for(;r=a.lastIndexOf(e,o-1),!(r===-1||r+t!==o);){if(r===0)return"";o=r}return a.substring(0,o)}function convertSimple2RegExpPattern(a){return a.replace(/[\-\\\{\}\+\?\|\^\$\.\,\[\]\(\)\#\s]/g,"\\$&").replace(/[\*]/g,".*")}function createRegExp(a,e,t={}){if(!a)throw new Error("Cannot create regex from empty string");e||(a=escapeRegExpCharacters(a)),t.wholeWord&&(/\B/.test(a.charAt(0))||(a="\\b"+a),/\B/.test(a.charAt(a.length-1))||(a=a+"\\b"));let s="";return t.global&&(s+="g"),t.matchCase||(s+="i"),t.multiline&&(s+="m"),t.unicode&&(s+="u"),new RegExp(a,s)}function regExpLeadsToEndlessLoop(a){return a.source==="^"||a.source==="^$"||a.source==="$"||a.source==="^\\s*$"?!1:!!(a.exec("")&&a.lastIndex===0)}function splitLines(a){return a.split(/\r\n|\r|\n/)}function firstNonWhitespaceIndex(a){for(let e=0,t=a.length;e<t;e++){const s=a.charCodeAt(e);if(s!==32&&s!==9)return e}return-1}function getLeadingWhitespace(a,e=0,t=a.length){for(let s=e;s<t;s++){const o=a.charCodeAt(s);if(o!==32&&o!==9)return a.substring(e,s)}return a.substring(e,t)}function lastNonWhitespaceIndex(a,e=a.length-1){for(let t=e;t>=0;t--){const s=a.charCodeAt(t);if(s!==32&&s!==9)return t}return-1}function compare(a,e){return a<e?-1:a>e?1:0}function compareSubstring(a,e,t=0,s=a.length,o=0,r=e.length){for(;t<s&&o<r;t++,o++){const d=a.charCodeAt(t),u=e.charCodeAt(o);if(d<u)return-1;if(d>u)return 1}const l=s-t,c=r-o;return l<c?-1:l>c?1:0}function compareIgnoreCase(a,e){return compareSubstringIgnoreCase(a,e,0,a.length,0,e.length)}function compareSubstringIgnoreCase(a,e,t=0,s=a.length,o=0,r=e.length){for(;t<s&&o<r;t++,o++){let d=a.charCodeAt(t),u=e.charCodeAt(o);if(d===u)continue;if(d>=128||u>=128)return compareSubstring(a.toLowerCase(),e.toLowerCase(),t,s,o,r);isLowerAsciiLetter(d)&&(d-=32),isLowerAsciiLetter(u)&&(u-=32);const g=d-u;if(g!==0)return g}const l=s-t,c=r-o;return l<c?-1:l>c?1:0}function isAsciiDigit(a){return a>=48&&a<=57}function isLowerAsciiLetter(a){return a>=97&&a<=122}function isUpperAsciiLetter(a){return a>=65&&a<=90}function equalsIgnoreCase(a,e){return a.length===e.length&&compareSubstringIgnoreCase(a,e)===0}function startsWithIgnoreCase(a,e){const t=e.length;return e.length>a.length?!1:compareSubstringIgnoreCase(a,e,0,t)===0}function commonPrefixLength(a,e){const t=Math.min(a.length,e.length);let s;for(s=0;s<t;s++)if(a.charCodeAt(s)!==e.charCodeAt(s))return s;return t}function commonSuffixLength(a,e){const t=Math.min(a.length,e.length);let s;const o=a.length-1,r=e.length-1;for(s=0;s<t;s++)if(a.charCodeAt(o-s)!==e.charCodeAt(r-s))return s;return t}function isHighSurrogate(a){return 55296<=a&&a<=56319}function isLowSurrogate(a){return 56320<=a&&a<=57343}function computeCodePoint(a,e){return(a-55296<<10)+(e-56320)+65536}function getNextCodePoint(a,e,t){const s=a.charCodeAt(t);if(isHighSurrogate(s)&&t+1<e){const o=a.charCodeAt(t+1);if(isLowSurrogate(o))return computeCodePoint(s,o)}return s}function getPrevCodePoint(a,e){const t=a.charCodeAt(e-1);if(isLowSurrogate(t)&&e>1){const s=a.charCodeAt(e-2);if(isHighSurrogate(s))return computeCodePoint(s,t)}return t}class CodePointIterator{get offset(){return this._offset}constructor(e,t=0){this._str=e,this._len=e.length,this._offset=t}setOffset(e){this._offset=e}prevCodePoint(){const e=getPrevCodePoint(this._str,this._offset);return this._offset-=e>=65536?2:1,e}nextCodePoint(){const e=getNextCodePoint(this._str,this._len,this._offset);return this._offset+=e>=65536?2:1,e}eol(){return this._offset>=this._len}}class GraphemeIterator{get offset(){return this._iterator.offset}constructor(e,t=0){this._iterator=new CodePointIterator(e,t)}nextGraphemeLength(){const e=GraphemeBreakTree.getInstance(),t=this._iterator,s=t.offset;let o=e.getGraphemeBreakType(t.nextCodePoint());for(;!t.eol();){const r=t.offset,l=e.getGraphemeBreakType(t.nextCodePoint());if(breakBetweenGraphemeBreakType(o,l)){t.setOffset(r);break}o=l}return t.offset-s}prevGraphemeLength(){const e=GraphemeBreakTree.getInstance(),t=this._iterator,s=t.offset;let o=e.getGraphemeBreakType(t.prevCodePoint());for(;t.offset>0;){const r=t.offset,l=e.getGraphemeBreakType(t.prevCodePoint());if(breakBetweenGraphemeBreakType(l,o)){t.setOffset(r);break}o=l}return s-t.offset}eol(){return this._iterator.eol()}}function nextCharLength(a,e){return new GraphemeIterator(a,e).nextGraphemeLength()}function prevCharLength(a,e){return new GraphemeIterator(a,e).prevGraphemeLength()}function getCharContainingOffset(a,e){e>0&&isLowSurrogate(a.charCodeAt(e))&&e--;const t=e+nextCharLength(a,e);return[t-prevCharLength(a,t),t]}let CONTAINS_RTL;function makeContainsRtl(){return/(?:[\u05BE\u05C0\u05C3\u05C6\u05D0-\u05F4\u0608\u060B\u060D\u061B-\u064A\u066D-\u066F\u0671-\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u0710\u0712-\u072F\u074D-\u07A5\u07B1-\u07EA\u07F4\u07F5\u07FA\u07FE-\u0815\u081A\u0824\u0828\u0830-\u0858\u085E-\u088E\u08A0-\u08C9\u200F\uFB1D\uFB1F-\uFB28\uFB2A-\uFD3D\uFD50-\uFDC7\uFDF0-\uFDFC\uFE70-\uFEFC]|\uD802[\uDC00-\uDD1B\uDD20-\uDE00\uDE10-\uDE35\uDE40-\uDEE4\uDEEB-\uDF35\uDF40-\uDFFF]|\uD803[\uDC00-\uDD23\uDE80-\uDEA9\uDEAD-\uDF45\uDF51-\uDF81\uDF86-\uDFF6]|\uD83A[\uDC00-\uDCCF\uDD00-\uDD43\uDD4B-\uDFFF]|\uD83B[\uDC00-\uDEBB])/}function containsRTL(a){return CONTAINS_RTL||(CONTAINS_RTL=makeContainsRtl()),CONTAINS_RTL.test(a)}const IS_BASIC_ASCII=/^[\t\n\r\x20-\x7E]*$/;function isBasicASCII(a){return IS_BASIC_ASCII.test(a)}const UNUSUAL_LINE_TERMINATORS=/[\u2028\u2029]/;function containsUnusualLineTerminators(a){return UNUSUAL_LINE_TERMINATORS.test(a)}function isFullWidthCharacter(a){return a>=11904&&a<=55215||a>=63744&&a<=64255||a>=65281&&a<=65374}function isEmojiImprecise(a){return a>=127462&&a<=127487||a===8986||a===8987||a===9200||a===9203||a>=9728&&a<=10175||a===11088||a===11093||a>=127744&&a<=128591||a>=128640&&a<=128764||a>=128992&&a<=129008||a>=129280&&a<=129535||a>=129648&&a<=129782}const UTF8_BOM_CHARACTER=String.fromCharCode(65279);function startsWithUTF8BOM(a){return!!(a&&a.length>0&&a.charCodeAt(0)===65279)}function containsUppercaseCharacter(a,e=!1){return a?(e&&(a=a.replace(/\\./g,"")),a.toLowerCase()!==a):!1}function singleLetterHash(a){return a=a%(2*26),a<26?String.fromCharCode(97+a):String.fromCharCode(65+a-26)}function breakBetweenGraphemeBreakType(a,e){return a===0?e!==5&&e!==7:a===2&&e===3?!1:a===4||a===2||a===3||e===4||e===2||e===3?!0:!(a===8&&(e===8||e===9||e===11||e===12)||(a===11||a===9)&&(e===9||e===10)||(a===12||a===10)&&e===10||e===5||e===13||e===7||a===1||a===13&&e===14||a===6&&e===6)}const _t=class _t{static getInstance(){return _t._INSTANCE||(_t._INSTANCE=new _t),_t._INSTANCE}constructor(){this._data=getGraphemeBreakRawData()}getGraphemeBreakType(e){if(e<32)return e===10?3:e===13?2:4;if(e<127)return 0;const t=this._data,s=t.length/3;let o=1;for(;o<=s;)if(e<t[3*o])o=2*o;else if(e>t[3*o+1])o=2*o+1;else return t[3*o+2];return 0}};_t._INSTANCE=null;let GraphemeBreakTree=_t;function getGraphemeBreakRawData(){return JSON.parse("[0,0,0,51229,51255,12,44061,44087,12,127462,127487,6,7083,7085,5,47645,47671,12,54813,54839,12,128678,128678,14,3270,3270,5,9919,9923,14,45853,45879,12,49437,49463,12,53021,53047,12,71216,71218,7,128398,128399,14,129360,129374,14,2519,2519,5,4448,4519,9,9742,9742,14,12336,12336,14,44957,44983,12,46749,46775,12,48541,48567,12,50333,50359,12,52125,52151,12,53917,53943,12,69888,69890,5,73018,73018,5,127990,127990,14,128558,128559,14,128759,128760,14,129653,129655,14,2027,2035,5,2891,2892,7,3761,3761,5,6683,6683,5,8293,8293,4,9825,9826,14,9999,9999,14,43452,43453,5,44509,44535,12,45405,45431,12,46301,46327,12,47197,47223,12,48093,48119,12,48989,49015,12,49885,49911,12,50781,50807,12,51677,51703,12,52573,52599,12,53469,53495,12,54365,54391,12,65279,65279,4,70471,70472,7,72145,72147,7,119173,119179,5,127799,127818,14,128240,128244,14,128512,128512,14,128652,128652,14,128721,128722,14,129292,129292,14,129445,129450,14,129734,129743,14,1476,1477,5,2366,2368,7,2750,2752,7,3076,3076,5,3415,3415,5,4141,4144,5,6109,6109,5,6964,6964,5,7394,7400,5,9197,9198,14,9770,9770,14,9877,9877,14,9968,9969,14,10084,10084,14,43052,43052,5,43713,43713,5,44285,44311,12,44733,44759,12,45181,45207,12,45629,45655,12,46077,46103,12,46525,46551,12,46973,46999,12,47421,47447,12,47869,47895,12,48317,48343,12,48765,48791,12,49213,49239,12,49661,49687,12,50109,50135,12,50557,50583,12,51005,51031,12,51453,51479,12,51901,51927,12,52349,52375,12,52797,52823,12,53245,53271,12,53693,53719,12,54141,54167,12,54589,54615,12,55037,55063,12,69506,69509,5,70191,70193,5,70841,70841,7,71463,71467,5,72330,72342,5,94031,94031,5,123628,123631,5,127763,127765,14,127941,127941,14,128043,128062,14,128302,128317,14,128465,128467,14,128539,128539,14,128640,128640,14,128662,128662,14,128703,128703,14,128745,128745,14,129004,129007,14,129329,129330,14,129402,129402,14,129483,129483,14,129686,129704,14,130048,131069,14,173,173,4,1757,1757,1,2200,2207,5,2434,2435,7,2631,2632,5,2817,2817,5,3008,3008,5,3201,3201,5,3387,3388,5,3542,3542,5,3902,3903,7,4190,4192,5,6002,6003,5,6439,6440,5,6765,6770,7,7019,7027,5,7154,7155,7,8205,8205,13,8505,8505,14,9654,9654,14,9757,9757,14,9792,9792,14,9852,9853,14,9890,9894,14,9937,9937,14,9981,9981,14,10035,10036,14,11035,11036,14,42654,42655,5,43346,43347,7,43587,43587,5,44006,44007,7,44173,44199,12,44397,44423,12,44621,44647,12,44845,44871,12,45069,45095,12,45293,45319,12,45517,45543,12,45741,45767,12,45965,45991,12,46189,46215,12,46413,46439,12,46637,46663,12,46861,46887,12,47085,47111,12,47309,47335,12,47533,47559,12,47757,47783,12,47981,48007,12,48205,48231,12,48429,48455,12,48653,48679,12,48877,48903,12,49101,49127,12,49325,49351,12,49549,49575,12,49773,49799,12,49997,50023,12,50221,50247,12,50445,50471,12,50669,50695,12,50893,50919,12,51117,51143,12,51341,51367,12,51565,51591,12,51789,51815,12,52013,52039,12,52237,52263,12,52461,52487,12,52685,52711,12,52909,52935,12,53133,53159,12,53357,53383,12,53581,53607,12,53805,53831,12,54029,54055,12,54253,54279,12,54477,54503,12,54701,54727,12,54925,54951,12,55149,55175,12,68101,68102,5,69762,69762,7,70067,70069,7,70371,70378,5,70720,70721,7,71087,71087,5,71341,71341,5,71995,71996,5,72249,72249,7,72850,72871,5,73109,73109,5,118576,118598,5,121505,121519,5,127245,127247,14,127568,127569,14,127777,127777,14,127872,127891,14,127956,127967,14,128015,128016,14,128110,128172,14,128259,128259,14,128367,128368,14,128424,128424,14,128488,128488,14,128530,128532,14,128550,128551,14,128566,128566,14,128647,128647,14,128656,128656,14,128667,128673,14,128691,128693,14,128715,128715,14,128728,128732,14,128752,128752,14,128765,128767,14,129096,129103,14,129311,129311,14,129344,129349,14,129394,129394,14,129413,129425,14,129466,129471,14,129511,129535,14,129664,129666,14,129719,129722,14,129760,129767,14,917536,917631,5,13,13,2,1160,1161,5,1564,1564,4,1807,1807,1,2085,2087,5,2307,2307,7,2382,2383,7,2497,2500,5,2563,2563,7,2677,2677,5,2763,2764,7,2879,2879,5,2914,2915,5,3021,3021,5,3142,3144,5,3263,3263,5,3285,3286,5,3398,3400,7,3530,3530,5,3633,3633,5,3864,3865,5,3974,3975,5,4155,4156,7,4229,4230,5,5909,5909,7,6078,6085,7,6277,6278,5,6451,6456,7,6744,6750,5,6846,6846,5,6972,6972,5,7074,7077,5,7146,7148,7,7222,7223,5,7416,7417,5,8234,8238,4,8417,8417,5,9000,9000,14,9203,9203,14,9730,9731,14,9748,9749,14,9762,9763,14,9776,9783,14,9800,9811,14,9831,9831,14,9872,9873,14,9882,9882,14,9900,9903,14,9929,9933,14,9941,9960,14,9974,9974,14,9989,9989,14,10006,10006,14,10062,10062,14,10160,10160,14,11647,11647,5,12953,12953,14,43019,43019,5,43232,43249,5,43443,43443,5,43567,43568,7,43696,43696,5,43765,43765,7,44013,44013,5,44117,44143,12,44229,44255,12,44341,44367,12,44453,44479,12,44565,44591,12,44677,44703,12,44789,44815,12,44901,44927,12,45013,45039,12,45125,45151,12,45237,45263,12,45349,45375,12,45461,45487,12,45573,45599,12,45685,45711,12,45797,45823,12,45909,45935,12,46021,46047,12,46133,46159,12,46245,46271,12,46357,46383,12,46469,46495,12,46581,46607,12,46693,46719,12,46805,46831,12,46917,46943,12,47029,47055,12,47141,47167,12,47253,47279,12,47365,47391,12,47477,47503,12,47589,47615,12,47701,47727,12,47813,47839,12,47925,47951,12,48037,48063,12,48149,48175,12,48261,48287,12,48373,48399,12,48485,48511,12,48597,48623,12,48709,48735,12,48821,48847,12,48933,48959,12,49045,49071,12,49157,49183,12,49269,49295,12,49381,49407,12,49493,49519,12,49605,49631,12,49717,49743,12,49829,49855,12,49941,49967,12,50053,50079,12,50165,50191,12,50277,50303,12,50389,50415,12,50501,50527,12,50613,50639,12,50725,50751,12,50837,50863,12,50949,50975,12,51061,51087,12,51173,51199,12,51285,51311,12,51397,51423,12,51509,51535,12,51621,51647,12,51733,51759,12,51845,51871,12,51957,51983,12,52069,52095,12,52181,52207,12,52293,52319,12,52405,52431,12,52517,52543,12,52629,52655,12,52741,52767,12,52853,52879,12,52965,52991,12,53077,53103,12,53189,53215,12,53301,53327,12,53413,53439,12,53525,53551,12,53637,53663,12,53749,53775,12,53861,53887,12,53973,53999,12,54085,54111,12,54197,54223,12,54309,54335,12,54421,54447,12,54533,54559,12,54645,54671,12,54757,54783,12,54869,54895,12,54981,55007,12,55093,55119,12,55243,55291,10,66045,66045,5,68325,68326,5,69688,69702,5,69817,69818,5,69957,69958,7,70089,70092,5,70198,70199,5,70462,70462,5,70502,70508,5,70750,70750,5,70846,70846,7,71100,71101,5,71230,71230,7,71351,71351,5,71737,71738,5,72000,72000,7,72160,72160,5,72273,72278,5,72752,72758,5,72882,72883,5,73031,73031,5,73461,73462,7,94192,94193,7,119149,119149,7,121403,121452,5,122915,122916,5,126980,126980,14,127358,127359,14,127535,127535,14,127759,127759,14,127771,127771,14,127792,127793,14,127825,127867,14,127897,127899,14,127945,127945,14,127985,127986,14,128000,128007,14,128021,128021,14,128066,128100,14,128184,128235,14,128249,128252,14,128266,128276,14,128335,128335,14,128379,128390,14,128407,128419,14,128444,128444,14,128481,128481,14,128499,128499,14,128526,128526,14,128536,128536,14,128543,128543,14,128556,128556,14,128564,128564,14,128577,128580,14,128643,128645,14,128649,128649,14,128654,128654,14,128660,128660,14,128664,128664,14,128675,128675,14,128686,128689,14,128695,128696,14,128705,128709,14,128717,128719,14,128725,128725,14,128736,128741,14,128747,128748,14,128755,128755,14,128762,128762,14,128981,128991,14,129009,129023,14,129160,129167,14,129296,129304,14,129320,129327,14,129340,129342,14,129356,129356,14,129388,129392,14,129399,129400,14,129404,129407,14,129432,129442,14,129454,129455,14,129473,129474,14,129485,129487,14,129648,129651,14,129659,129660,14,129671,129679,14,129709,129711,14,129728,129730,14,129751,129753,14,129776,129782,14,917505,917505,4,917760,917999,5,10,10,3,127,159,4,768,879,5,1471,1471,5,1536,1541,1,1648,1648,5,1767,1768,5,1840,1866,5,2070,2073,5,2137,2139,5,2274,2274,1,2363,2363,7,2377,2380,7,2402,2403,5,2494,2494,5,2507,2508,7,2558,2558,5,2622,2624,7,2641,2641,5,2691,2691,7,2759,2760,5,2786,2787,5,2876,2876,5,2881,2884,5,2901,2902,5,3006,3006,5,3014,3016,7,3072,3072,5,3134,3136,5,3157,3158,5,3260,3260,5,3266,3266,5,3274,3275,7,3328,3329,5,3391,3392,7,3405,3405,5,3457,3457,5,3536,3537,7,3551,3551,5,3636,3642,5,3764,3772,5,3895,3895,5,3967,3967,7,3993,4028,5,4146,4151,5,4182,4183,7,4226,4226,5,4253,4253,5,4957,4959,5,5940,5940,7,6070,6070,7,6087,6088,7,6158,6158,4,6432,6434,5,6448,6449,7,6679,6680,5,6742,6742,5,6754,6754,5,6783,6783,5,6912,6915,5,6966,6970,5,6978,6978,5,7042,7042,7,7080,7081,5,7143,7143,7,7150,7150,7,7212,7219,5,7380,7392,5,7412,7412,5,8203,8203,4,8232,8232,4,8265,8265,14,8400,8412,5,8421,8432,5,8617,8618,14,9167,9167,14,9200,9200,14,9410,9410,14,9723,9726,14,9733,9733,14,9745,9745,14,9752,9752,14,9760,9760,14,9766,9766,14,9774,9774,14,9786,9786,14,9794,9794,14,9823,9823,14,9828,9828,14,9833,9850,14,9855,9855,14,9875,9875,14,9880,9880,14,9885,9887,14,9896,9897,14,9906,9916,14,9926,9927,14,9935,9935,14,9939,9939,14,9962,9962,14,9972,9972,14,9978,9978,14,9986,9986,14,9997,9997,14,10002,10002,14,10017,10017,14,10055,10055,14,10071,10071,14,10133,10135,14,10548,10549,14,11093,11093,14,12330,12333,5,12441,12442,5,42608,42610,5,43010,43010,5,43045,43046,5,43188,43203,7,43302,43309,5,43392,43394,5,43446,43449,5,43493,43493,5,43571,43572,7,43597,43597,7,43703,43704,5,43756,43757,5,44003,44004,7,44009,44010,7,44033,44059,12,44089,44115,12,44145,44171,12,44201,44227,12,44257,44283,12,44313,44339,12,44369,44395,12,44425,44451,12,44481,44507,12,44537,44563,12,44593,44619,12,44649,44675,12,44705,44731,12,44761,44787,12,44817,44843,12,44873,44899,12,44929,44955,12,44985,45011,12,45041,45067,12,45097,45123,12,45153,45179,12,45209,45235,12,45265,45291,12,45321,45347,12,45377,45403,12,45433,45459,12,45489,45515,12,45545,45571,12,45601,45627,12,45657,45683,12,45713,45739,12,45769,45795,12,45825,45851,12,45881,45907,12,45937,45963,12,45993,46019,12,46049,46075,12,46105,46131,12,46161,46187,12,46217,46243,12,46273,46299,12,46329,46355,12,46385,46411,12,46441,46467,12,46497,46523,12,46553,46579,12,46609,46635,12,46665,46691,12,46721,46747,12,46777,46803,12,46833,46859,12,46889,46915,12,46945,46971,12,47001,47027,12,47057,47083,12,47113,47139,12,47169,47195,12,47225,47251,12,47281,47307,12,47337,47363,12,47393,47419,12,47449,47475,12,47505,47531,12,47561,47587,12,47617,47643,12,47673,47699,12,47729,47755,12,47785,47811,12,47841,47867,12,47897,47923,12,47953,47979,12,48009,48035,12,48065,48091,12,48121,48147,12,48177,48203,12,48233,48259,12,48289,48315,12,48345,48371,12,48401,48427,12,48457,48483,12,48513,48539,12,48569,48595,12,48625,48651,12,48681,48707,12,48737,48763,12,48793,48819,12,48849,48875,12,48905,48931,12,48961,48987,12,49017,49043,12,49073,49099,12,49129,49155,12,49185,49211,12,49241,49267,12,49297,49323,12,49353,49379,12,49409,49435,12,49465,49491,12,49521,49547,12,49577,49603,12,49633,49659,12,49689,49715,12,49745,49771,12,49801,49827,12,49857,49883,12,49913,49939,12,49969,49995,12,50025,50051,12,50081,50107,12,50137,50163,12,50193,50219,12,50249,50275,12,50305,50331,12,50361,50387,12,50417,50443,12,50473,50499,12,50529,50555,12,50585,50611,12,50641,50667,12,50697,50723,12,50753,50779,12,50809,50835,12,50865,50891,12,50921,50947,12,50977,51003,12,51033,51059,12,51089,51115,12,51145,51171,12,51201,51227,12,51257,51283,12,51313,51339,12,51369,51395,12,51425,51451,12,51481,51507,12,51537,51563,12,51593,51619,12,51649,51675,12,51705,51731,12,51761,51787,12,51817,51843,12,51873,51899,12,51929,51955,12,51985,52011,12,52041,52067,12,52097,52123,12,52153,52179,12,52209,52235,12,52265,52291,12,52321,52347,12,52377,52403,12,52433,52459,12,52489,52515,12,52545,52571,12,52601,52627,12,52657,52683,12,52713,52739,12,52769,52795,12,52825,52851,12,52881,52907,12,52937,52963,12,52993,53019,12,53049,53075,12,53105,53131,12,53161,53187,12,53217,53243,12,53273,53299,12,53329,53355,12,53385,53411,12,53441,53467,12,53497,53523,12,53553,53579,12,53609,53635,12,53665,53691,12,53721,53747,12,53777,53803,12,53833,53859,12,53889,53915,12,53945,53971,12,54001,54027,12,54057,54083,12,54113,54139,12,54169,54195,12,54225,54251,12,54281,54307,12,54337,54363,12,54393,54419,12,54449,54475,12,54505,54531,12,54561,54587,12,54617,54643,12,54673,54699,12,54729,54755,12,54785,54811,12,54841,54867,12,54897,54923,12,54953,54979,12,55009,55035,12,55065,55091,12,55121,55147,12,55177,55203,12,65024,65039,5,65520,65528,4,66422,66426,5,68152,68154,5,69291,69292,5,69633,69633,5,69747,69748,5,69811,69814,5,69826,69826,5,69932,69932,7,70016,70017,5,70079,70080,7,70095,70095,5,70196,70196,5,70367,70367,5,70402,70403,7,70464,70464,5,70487,70487,5,70709,70711,7,70725,70725,7,70833,70834,7,70843,70844,7,70849,70849,7,71090,71093,5,71103,71104,5,71227,71228,7,71339,71339,5,71344,71349,5,71458,71461,5,71727,71735,5,71985,71989,7,71998,71998,5,72002,72002,7,72154,72155,5,72193,72202,5,72251,72254,5,72281,72283,5,72344,72345,5,72766,72766,7,72874,72880,5,72885,72886,5,73023,73029,5,73104,73105,5,73111,73111,5,92912,92916,5,94095,94098,5,113824,113827,4,119142,119142,7,119155,119162,4,119362,119364,5,121476,121476,5,122888,122904,5,123184,123190,5,125252,125258,5,127183,127183,14,127340,127343,14,127377,127386,14,127491,127503,14,127548,127551,14,127744,127756,14,127761,127761,14,127769,127769,14,127773,127774,14,127780,127788,14,127796,127797,14,127820,127823,14,127869,127869,14,127894,127895,14,127902,127903,14,127943,127943,14,127947,127950,14,127972,127972,14,127988,127988,14,127992,127994,14,128009,128011,14,128019,128019,14,128023,128041,14,128064,128064,14,128102,128107,14,128174,128181,14,128238,128238,14,128246,128247,14,128254,128254,14,128264,128264,14,128278,128299,14,128329,128330,14,128348,128359,14,128371,128377,14,128392,128393,14,128401,128404,14,128421,128421,14,128433,128434,14,128450,128452,14,128476,128478,14,128483,128483,14,128495,128495,14,128506,128506,14,128519,128520,14,128528,128528,14,128534,128534,14,128538,128538,14,128540,128542,14,128544,128549,14,128552,128555,14,128557,128557,14,128560,128563,14,128565,128565,14,128567,128576,14,128581,128591,14,128641,128642,14,128646,128646,14,128648,128648,14,128650,128651,14,128653,128653,14,128655,128655,14,128657,128659,14,128661,128661,14,128663,128663,14,128665,128666,14,128674,128674,14,128676,128677,14,128679,128685,14,128690,128690,14,128694,128694,14,128697,128702,14,128704,128704,14,128710,128714,14,128716,128716,14,128720,128720,14,128723,128724,14,128726,128727,14,128733,128735,14,128742,128744,14,128746,128746,14,128749,128751,14,128753,128754,14,128756,128758,14,128761,128761,14,128763,128764,14,128884,128895,14,128992,129003,14,129008,129008,14,129036,129039,14,129114,129119,14,129198,129279,14,129293,129295,14,129305,129310,14,129312,129319,14,129328,129328,14,129331,129338,14,129343,129343,14,129351,129355,14,129357,129359,14,129375,129387,14,129393,129393,14,129395,129398,14,129401,129401,14,129403,129403,14,129408,129412,14,129426,129431,14,129443,129444,14,129451,129453,14,129456,129465,14,129472,129472,14,129475,129482,14,129484,129484,14,129488,129510,14,129536,129647,14,129652,129652,14,129656,129658,14,129661,129663,14,129667,129670,14,129680,129685,14,129705,129708,14,129712,129718,14,129723,129727,14,129731,129733,14,129744,129750,14,129754,129759,14,129768,129775,14,129783,129791,14,917504,917504,4,917506,917535,4,917632,917759,4,918000,921599,4,0,9,4,11,12,4,14,31,4,169,169,14,174,174,14,1155,1159,5,1425,1469,5,1473,1474,5,1479,1479,5,1552,1562,5,1611,1631,5,1750,1756,5,1759,1764,5,1770,1773,5,1809,1809,5,1958,1968,5,2045,2045,5,2075,2083,5,2089,2093,5,2192,2193,1,2250,2273,5,2275,2306,5,2362,2362,5,2364,2364,5,2369,2376,5,2381,2381,5,2385,2391,5,2433,2433,5,2492,2492,5,2495,2496,7,2503,2504,7,2509,2509,5,2530,2531,5,2561,2562,5,2620,2620,5,2625,2626,5,2635,2637,5,2672,2673,5,2689,2690,5,2748,2748,5,2753,2757,5,2761,2761,7,2765,2765,5,2810,2815,5,2818,2819,7,2878,2878,5,2880,2880,7,2887,2888,7,2893,2893,5,2903,2903,5,2946,2946,5,3007,3007,7,3009,3010,7,3018,3020,7,3031,3031,5,3073,3075,7,3132,3132,5,3137,3140,7,3146,3149,5,3170,3171,5,3202,3203,7,3262,3262,7,3264,3265,7,3267,3268,7,3271,3272,7,3276,3277,5,3298,3299,5,3330,3331,7,3390,3390,5,3393,3396,5,3402,3404,7,3406,3406,1,3426,3427,5,3458,3459,7,3535,3535,5,3538,3540,5,3544,3550,7,3570,3571,7,3635,3635,7,3655,3662,5,3763,3763,7,3784,3789,5,3893,3893,5,3897,3897,5,3953,3966,5,3968,3972,5,3981,3991,5,4038,4038,5,4145,4145,7,4153,4154,5,4157,4158,5,4184,4185,5,4209,4212,5,4228,4228,7,4237,4237,5,4352,4447,8,4520,4607,10,5906,5908,5,5938,5939,5,5970,5971,5,6068,6069,5,6071,6077,5,6086,6086,5,6089,6099,5,6155,6157,5,6159,6159,5,6313,6313,5,6435,6438,7,6441,6443,7,6450,6450,5,6457,6459,5,6681,6682,7,6741,6741,7,6743,6743,7,6752,6752,5,6757,6764,5,6771,6780,5,6832,6845,5,6847,6862,5,6916,6916,7,6965,6965,5,6971,6971,7,6973,6977,7,6979,6980,7,7040,7041,5,7073,7073,7,7078,7079,7,7082,7082,7,7142,7142,5,7144,7145,5,7149,7149,5,7151,7153,5,7204,7211,7,7220,7221,7,7376,7378,5,7393,7393,7,7405,7405,5,7415,7415,7,7616,7679,5,8204,8204,5,8206,8207,4,8233,8233,4,8252,8252,14,8288,8292,4,8294,8303,4,8413,8416,5,8418,8420,5,8482,8482,14,8596,8601,14,8986,8987,14,9096,9096,14,9193,9196,14,9199,9199,14,9201,9202,14,9208,9210,14,9642,9643,14,9664,9664,14,9728,9729,14,9732,9732,14,9735,9741,14,9743,9744,14,9746,9746,14,9750,9751,14,9753,9756,14,9758,9759,14,9761,9761,14,9764,9765,14,9767,9769,14,9771,9773,14,9775,9775,14,9784,9785,14,9787,9791,14,9793,9793,14,9795,9799,14,9812,9822,14,9824,9824,14,9827,9827,14,9829,9830,14,9832,9832,14,9851,9851,14,9854,9854,14,9856,9861,14,9874,9874,14,9876,9876,14,9878,9879,14,9881,9881,14,9883,9884,14,9888,9889,14,9895,9895,14,9898,9899,14,9904,9905,14,9917,9918,14,9924,9925,14,9928,9928,14,9934,9934,14,9936,9936,14,9938,9938,14,9940,9940,14,9961,9961,14,9963,9967,14,9970,9971,14,9973,9973,14,9975,9977,14,9979,9980,14,9982,9985,14,9987,9988,14,9992,9996,14,9998,9998,14,10000,10001,14,10004,10004,14,10013,10013,14,10024,10024,14,10052,10052,14,10060,10060,14,10067,10069,14,10083,10083,14,10085,10087,14,10145,10145,14,10175,10175,14,11013,11015,14,11088,11088,14,11503,11505,5,11744,11775,5,12334,12335,5,12349,12349,14,12951,12951,14,42607,42607,5,42612,42621,5,42736,42737,5,43014,43014,5,43043,43044,7,43047,43047,7,43136,43137,7,43204,43205,5,43263,43263,5,43335,43345,5,43360,43388,8,43395,43395,7,43444,43445,7,43450,43451,7,43454,43456,7,43561,43566,5,43569,43570,5,43573,43574,5,43596,43596,5,43644,43644,5,43698,43700,5,43710,43711,5,43755,43755,7,43758,43759,7,43766,43766,5,44005,44005,5,44008,44008,5,44012,44012,7,44032,44032,11,44060,44060,11,44088,44088,11,44116,44116,11,44144,44144,11,44172,44172,11,44200,44200,11,44228,44228,11,44256,44256,11,44284,44284,11,44312,44312,11,44340,44340,11,44368,44368,11,44396,44396,11,44424,44424,11,44452,44452,11,44480,44480,11,44508,44508,11,44536,44536,11,44564,44564,11,44592,44592,11,44620,44620,11,44648,44648,11,44676,44676,11,44704,44704,11,44732,44732,11,44760,44760,11,44788,44788,11,44816,44816,11,44844,44844,11,44872,44872,11,44900,44900,11,44928,44928,11,44956,44956,11,44984,44984,11,45012,45012,11,45040,45040,11,45068,45068,11,45096,45096,11,45124,45124,11,45152,45152,11,45180,45180,11,45208,45208,11,45236,45236,11,45264,45264,11,45292,45292,11,45320,45320,11,45348,45348,11,45376,45376,11,45404,45404,11,45432,45432,11,45460,45460,11,45488,45488,11,45516,45516,11,45544,45544,11,45572,45572,11,45600,45600,11,45628,45628,11,45656,45656,11,45684,45684,11,45712,45712,11,45740,45740,11,45768,45768,11,45796,45796,11,45824,45824,11,45852,45852,11,45880,45880,11,45908,45908,11,45936,45936,11,45964,45964,11,45992,45992,11,46020,46020,11,46048,46048,11,46076,46076,11,46104,46104,11,46132,46132,11,46160,46160,11,46188,46188,11,46216,46216,11,46244,46244,11,46272,46272,11,46300,46300,11,46328,46328,11,46356,46356,11,46384,46384,11,46412,46412,11,46440,46440,11,46468,46468,11,46496,46496,11,46524,46524,11,46552,46552,11,46580,46580,11,46608,46608,11,46636,46636,11,46664,46664,11,46692,46692,11,46720,46720,11,46748,46748,11,46776,46776,11,46804,46804,11,46832,46832,11,46860,46860,11,46888,46888,11,46916,46916,11,46944,46944,11,46972,46972,11,47000,47000,11,47028,47028,11,47056,47056,11,47084,47084,11,47112,47112,11,47140,47140,11,47168,47168,11,47196,47196,11,47224,47224,11,47252,47252,11,47280,47280,11,47308,47308,11,47336,47336,11,47364,47364,11,47392,47392,11,47420,47420,11,47448,47448,11,47476,47476,11,47504,47504,11,47532,47532,11,47560,47560,11,47588,47588,11,47616,47616,11,47644,47644,11,47672,47672,11,47700,47700,11,47728,47728,11,47756,47756,11,47784,47784,11,47812,47812,11,47840,47840,11,47868,47868,11,47896,47896,11,47924,47924,11,47952,47952,11,47980,47980,11,48008,48008,11,48036,48036,11,48064,48064,11,48092,48092,11,48120,48120,11,48148,48148,11,48176,48176,11,48204,48204,11,48232,48232,11,48260,48260,11,48288,48288,11,48316,48316,11,48344,48344,11,48372,48372,11,48400,48400,11,48428,48428,11,48456,48456,11,48484,48484,11,48512,48512,11,48540,48540,11,48568,48568,11,48596,48596,11,48624,48624,11,48652,48652,11,48680,48680,11,48708,48708,11,48736,48736,11,48764,48764,11,48792,48792,11,48820,48820,11,48848,48848,11,48876,48876,11,48904,48904,11,48932,48932,11,48960,48960,11,48988,48988,11,49016,49016,11,49044,49044,11,49072,49072,11,49100,49100,11,49128,49128,11,49156,49156,11,49184,49184,11,49212,49212,11,49240,49240,11,49268,49268,11,49296,49296,11,49324,49324,11,49352,49352,11,49380,49380,11,49408,49408,11,49436,49436,11,49464,49464,11,49492,49492,11,49520,49520,11,49548,49548,11,49576,49576,11,49604,49604,11,49632,49632,11,49660,49660,11,49688,49688,11,49716,49716,11,49744,49744,11,49772,49772,11,49800,49800,11,49828,49828,11,49856,49856,11,49884,49884,11,49912,49912,11,49940,49940,11,49968,49968,11,49996,49996,11,50024,50024,11,50052,50052,11,50080,50080,11,50108,50108,11,50136,50136,11,50164,50164,11,50192,50192,11,50220,50220,11,50248,50248,11,50276,50276,11,50304,50304,11,50332,50332,11,50360,50360,11,50388,50388,11,50416,50416,11,50444,50444,11,50472,50472,11,50500,50500,11,50528,50528,11,50556,50556,11,50584,50584,11,50612,50612,11,50640,50640,11,50668,50668,11,50696,50696,11,50724,50724,11,50752,50752,11,50780,50780,11,50808,50808,11,50836,50836,11,50864,50864,11,50892,50892,11,50920,50920,11,50948,50948,11,50976,50976,11,51004,51004,11,51032,51032,11,51060,51060,11,51088,51088,11,51116,51116,11,51144,51144,11,51172,51172,11,51200,51200,11,51228,51228,11,51256,51256,11,51284,51284,11,51312,51312,11,51340,51340,11,51368,51368,11,51396,51396,11,51424,51424,11,51452,51452,11,51480,51480,11,51508,51508,11,51536,51536,11,51564,51564,11,51592,51592,11,51620,51620,11,51648,51648,11,51676,51676,11,51704,51704,11,51732,51732,11,51760,51760,11,51788,51788,11,51816,51816,11,51844,51844,11,51872,51872,11,51900,51900,11,51928,51928,11,51956,51956,11,51984,51984,11,52012,52012,11,52040,52040,11,52068,52068,11,52096,52096,11,52124,52124,11,52152,52152,11,52180,52180,11,52208,52208,11,52236,52236,11,52264,52264,11,52292,52292,11,52320,52320,11,52348,52348,11,52376,52376,11,52404,52404,11,52432,52432,11,52460,52460,11,52488,52488,11,52516,52516,11,52544,52544,11,52572,52572,11,52600,52600,11,52628,52628,11,52656,52656,11,52684,52684,11,52712,52712,11,52740,52740,11,52768,52768,11,52796,52796,11,52824,52824,11,52852,52852,11,52880,52880,11,52908,52908,11,52936,52936,11,52964,52964,11,52992,52992,11,53020,53020,11,53048,53048,11,53076,53076,11,53104,53104,11,53132,53132,11,53160,53160,11,53188,53188,11,53216,53216,11,53244,53244,11,53272,53272,11,53300,53300,11,53328,53328,11,53356,53356,11,53384,53384,11,53412,53412,11,53440,53440,11,53468,53468,11,53496,53496,11,53524,53524,11,53552,53552,11,53580,53580,11,53608,53608,11,53636,53636,11,53664,53664,11,53692,53692,11,53720,53720,11,53748,53748,11,53776,53776,11,53804,53804,11,53832,53832,11,53860,53860,11,53888,53888,11,53916,53916,11,53944,53944,11,53972,53972,11,54000,54000,11,54028,54028,11,54056,54056,11,54084,54084,11,54112,54112,11,54140,54140,11,54168,54168,11,54196,54196,11,54224,54224,11,54252,54252,11,54280,54280,11,54308,54308,11,54336,54336,11,54364,54364,11,54392,54392,11,54420,54420,11,54448,54448,11,54476,54476,11,54504,54504,11,54532,54532,11,54560,54560,11,54588,54588,11,54616,54616,11,54644,54644,11,54672,54672,11,54700,54700,11,54728,54728,11,54756,54756,11,54784,54784,11,54812,54812,11,54840,54840,11,54868,54868,11,54896,54896,11,54924,54924,11,54952,54952,11,54980,54980,11,55008,55008,11,55036,55036,11,55064,55064,11,55092,55092,11,55120,55120,11,55148,55148,11,55176,55176,11,55216,55238,9,64286,64286,5,65056,65071,5,65438,65439,5,65529,65531,4,66272,66272,5,68097,68099,5,68108,68111,5,68159,68159,5,68900,68903,5,69446,69456,5,69632,69632,7,69634,69634,7,69744,69744,5,69759,69761,5,69808,69810,7,69815,69816,7,69821,69821,1,69837,69837,1,69927,69931,5,69933,69940,5,70003,70003,5,70018,70018,7,70070,70078,5,70082,70083,1,70094,70094,7,70188,70190,7,70194,70195,7,70197,70197,7,70206,70206,5,70368,70370,7,70400,70401,5,70459,70460,5,70463,70463,7,70465,70468,7,70475,70477,7,70498,70499,7,70512,70516,5,70712,70719,5,70722,70724,5,70726,70726,5,70832,70832,5,70835,70840,5,70842,70842,5,70845,70845,5,70847,70848,5,70850,70851,5,71088,71089,7,71096,71099,7,71102,71102,7,71132,71133,5,71219,71226,5,71229,71229,5,71231,71232,5,71340,71340,7,71342,71343,7,71350,71350,7,71453,71455,5,71462,71462,7,71724,71726,7,71736,71736,7,71984,71984,5,71991,71992,7,71997,71997,7,71999,71999,1,72001,72001,1,72003,72003,5,72148,72151,5,72156,72159,7,72164,72164,7,72243,72248,5,72250,72250,1,72263,72263,5,72279,72280,7,72324,72329,1,72343,72343,7,72751,72751,7,72760,72765,5,72767,72767,5,72873,72873,7,72881,72881,7,72884,72884,7,73009,73014,5,73020,73021,5,73030,73030,1,73098,73102,7,73107,73108,7,73110,73110,7,73459,73460,5,78896,78904,4,92976,92982,5,94033,94087,7,94180,94180,5,113821,113822,5,118528,118573,5,119141,119141,5,119143,119145,5,119150,119154,5,119163,119170,5,119210,119213,5,121344,121398,5,121461,121461,5,121499,121503,5,122880,122886,5,122907,122913,5,122918,122922,5,123566,123566,5,125136,125142,5,126976,126979,14,126981,127182,14,127184,127231,14,127279,127279,14,127344,127345,14,127374,127374,14,127405,127461,14,127489,127490,14,127514,127514,14,127538,127546,14,127561,127567,14,127570,127743,14,127757,127758,14,127760,127760,14,127762,127762,14,127766,127768,14,127770,127770,14,127772,127772,14,127775,127776,14,127778,127779,14,127789,127791,14,127794,127795,14,127798,127798,14,127819,127819,14,127824,127824,14,127868,127868,14,127870,127871,14,127892,127893,14,127896,127896,14,127900,127901,14,127904,127940,14,127942,127942,14,127944,127944,14,127946,127946,14,127951,127955,14,127968,127971,14,127973,127984,14,127987,127987,14,127989,127989,14,127991,127991,14,127995,127999,5,128008,128008,14,128012,128014,14,128017,128018,14,128020,128020,14,128022,128022,14,128042,128042,14,128063,128063,14,128065,128065,14,128101,128101,14,128108,128109,14,128173,128173,14,128182,128183,14,128236,128237,14,128239,128239,14,128245,128245,14,128248,128248,14,128253,128253,14,128255,128258,14,128260,128263,14,128265,128265,14,128277,128277,14,128300,128301,14,128326,128328,14,128331,128334,14,128336,128347,14,128360,128366,14,128369,128370,14,128378,128378,14,128391,128391,14,128394,128397,14,128400,128400,14,128405,128406,14,128420,128420,14,128422,128423,14,128425,128432,14,128435,128443,14,128445,128449,14,128453,128464,14,128468,128475,14,128479,128480,14,128482,128482,14,128484,128487,14,128489,128494,14,128496,128498,14,128500,128505,14,128507,128511,14,128513,128518,14,128521,128525,14,128527,128527,14,128529,128529,14,128533,128533,14,128535,128535,14,128537,128537,14]")}function getLeftDeleteOffset(a,e){if(a===0)return 0;const t=getOffsetBeforeLastEmojiComponent(a,e);if(t!==void 0)return t;const s=new CodePointIterator(e,a);return s.prevCodePoint(),s.offset}function getOffsetBeforeLastEmojiComponent(a,e){const t=new CodePointIterator(e,a);let s=t.prevCodePoint();for(;isEmojiModifier(s)||s===65039||s===8419;){if(t.offset===0)return;s=t.prevCodePoint()}if(!isEmojiImprecise(s))return;let o=t.offset;return o>0&&t.prevCodePoint()===8205&&(o=t.offset),o}function isEmojiModifier(a){return 127995<=a&&a<=127999}const noBreakWhitespace=" ",Oe=class Oe{static getInstance(e){return Oe.cache.get(Array.from(e))}static getLocales(){return Oe._locales.value}constructor(e){this.confusableDictionary=e}isAmbiguous(e){return this.confusableDictionary.has(e)}getPrimaryConfusable(e){return this.confusableDictionary.get(e)}getConfusableCodePoints(){return new Set(this.confusableDictionary.keys())}};Oe.ambiguousCharacterData=new Lazy(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,1523,96,8242,96,1370,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,118002,50,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,118003,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,118004,52,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,118005,53,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,118006,54,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,118007,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,118008,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,118009,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,117974,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,117975,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71913,67,71922,67,65315,67,8557,67,8450,67,8493,67,117976,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,117977,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,117978,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,117979,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,117980,71,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,117981,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,117983,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,117984,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,118001,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,117982,108,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,117985,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,117986,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,117987,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,118000,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,117988,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,117989,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,117990,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,117991,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,117992,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,117993,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,117994,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,117995,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71910,87,71919,87,117996,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,117997,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,117998,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,71909,90,66293,90,65338,90,8484,90,8488,90,117999,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65283,35,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125,119846,109],"_default":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"cs":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"es":[8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"fr":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"it":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"ja":[8211,45,8218,44,65281,33,8216,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65292,44,65297,49,65307,59],"ko":[8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"pt-BR":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"ru":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"zh-hans":[160,32,65374,126,8218,44,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65297,49],"zh-hant":[8211,45,65374,126,8218,44,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89]}')),Oe.cache=new LRUCachedFunction({getCacheKey:JSON.stringify},e=>{function t(g){const f=new Map;for(let p=0;p<g.length;p+=2)f.set(g[p],g[p+1]);return f}function s(g,f){const p=new Map(g);for(const[m,_]of f)p.set(m,_);return p}function o(g,f){if(!g)return f;const p=new Map;for(const[m,_]of g)f.has(m)&&p.set(m,_);return p}const r=Oe.ambiguousCharacterData.value;let l=e.filter(g=>!g.startsWith("_")&&g in r);l.length===0&&(l=["_default"]);let c;for(const g of l){const f=t(r[g]);c=o(c,f)}const d=t(r._common),u=s(d,c);return new Oe(u)}),Oe._locales=new Lazy(()=>Object.keys(Oe.ambiguousCharacterData.value).filter(e=>!e.startsWith("_")));let AmbiguousCharacters=Oe;const Yt=class Yt{static getRawData(){return JSON.parse('{"_common":[11,12,13,127,847,1564,4447,4448,6068,6069,6155,6156,6157,6158,7355,7356,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8204,8205,8206,8207,8234,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,8293,8294,8295,8296,8297,8298,8299,8300,8301,8302,8303,10240,12644,65024,65025,65026,65027,65028,65029,65030,65031,65032,65033,65034,65035,65036,65037,65038,65039,65279,65440,65520,65521,65522,65523,65524,65525,65526,65527,65528,65532,78844,119155,119156,119157,119158,119159,119160,119161,119162,917504,917505,917506,917507,917508,917509,917510,917511,917512,917513,917514,917515,917516,917517,917518,917519,917520,917521,917522,917523,917524,917525,917526,917527,917528,917529,917530,917531,917532,917533,917534,917535,917536,917537,917538,917539,917540,917541,917542,917543,917544,917545,917546,917547,917548,917549,917550,917551,917552,917553,917554,917555,917556,917557,917558,917559,917560,917561,917562,917563,917564,917565,917566,917567,917568,917569,917570,917571,917572,917573,917574,917575,917576,917577,917578,917579,917580,917581,917582,917583,917584,917585,917586,917587,917588,917589,917590,917591,917592,917593,917594,917595,917596,917597,917598,917599,917600,917601,917602,917603,917604,917605,917606,917607,917608,917609,917610,917611,917612,917613,917614,917615,917616,917617,917618,917619,917620,917621,917622,917623,917624,917625,917626,917627,917628,917629,917630,917631,917760,917761,917762,917763,917764,917765,917766,917767,917768,917769,917770,917771,917772,917773,917774,917775,917776,917777,917778,917779,917780,917781,917782,917783,917784,917785,917786,917787,917788,917789,917790,917791,917792,917793,917794,917795,917796,917797,917798,917799,917800,917801,917802,917803,917804,917805,917806,917807,917808,917809,917810,917811,917812,917813,917814,917815,917816,917817,917818,917819,917820,917821,917822,917823,917824,917825,917826,917827,917828,917829,917830,917831,917832,917833,917834,917835,917836,917837,917838,917839,917840,917841,917842,917843,917844,917845,917846,917847,917848,917849,917850,917851,917852,917853,917854,917855,917856,917857,917858,917859,917860,917861,917862,917863,917864,917865,917866,917867,917868,917869,917870,917871,917872,917873,917874,917875,917876,917877,917878,917879,917880,917881,917882,917883,917884,917885,917886,917887,917888,917889,917890,917891,917892,917893,917894,917895,917896,917897,917898,917899,917900,917901,917902,917903,917904,917905,917906,917907,917908,917909,917910,917911,917912,917913,917914,917915,917916,917917,917918,917919,917920,917921,917922,917923,917924,917925,917926,917927,917928,917929,917930,917931,917932,917933,917934,917935,917936,917937,917938,917939,917940,917941,917942,917943,917944,917945,917946,917947,917948,917949,917950,917951,917952,917953,917954,917955,917956,917957,917958,917959,917960,917961,917962,917963,917964,917965,917966,917967,917968,917969,917970,917971,917972,917973,917974,917975,917976,917977,917978,917979,917980,917981,917982,917983,917984,917985,917986,917987,917988,917989,917990,917991,917992,917993,917994,917995,917996,917997,917998,917999],"cs":[173,8203,12288],"de":[173,8203,12288],"es":[8203,12288],"fr":[173,8203,12288],"it":[160,173,12288],"ja":[173],"ko":[173,12288],"pl":[173,8203,12288],"pt-BR":[173,8203,12288],"qps-ploc":[160,173,8203,12288],"ru":[173,12288],"tr":[160,173,8203,12288],"zh-hans":[160,173,8203,12288],"zh-hant":[173,12288]}')}static getData(){return this._data||(this._data=new Set([...Object.values(Yt.getRawData())].flat())),this._data}static isInvisibleCharacter(e){return Yt.getData().has(e)}static get codePoints(){return Yt.getData()}};Yt._data=void 0;let InvisibleCharacters=Yt,safeProcess;const vscodeGlobal=globalThis.vscode;var xr;if(typeof vscodeGlobal<"u"&&typeof vscodeGlobal.process<"u"){const a=vscodeGlobal.process;safeProcess={get platform(){return a.platform},get arch(){return a.arch},get env(){return a.env},cwd(){return a.cwd()}}}else typeof process<"u"&&typeof((xr=process==null?void 0:process.versions)==null?void 0:xr.node)=="string"?safeProcess={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:safeProcess={get platform(){return isWindows?"win32":isMacintosh?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};const cwd=safeProcess.cwd,env=safeProcess.env,platform=safeProcess.platform,CHAR_UPPERCASE_A=65,CHAR_LOWERCASE_A=97,CHAR_UPPERCASE_Z=90,CHAR_LOWERCASE_Z=122,CHAR_DOT=46,CHAR_FORWARD_SLASH=47,CHAR_BACKWARD_SLASH=92,CHAR_COLON=58,CHAR_QUESTION_MARK=63;class ErrorInvalidArgType extends Error{constructor(e,t,s){let o;typeof t=="string"&&t.indexOf("not ")===0?(o="must not be",t=t.replace(/^not /,"")):o="must be";const r=e.indexOf(".")!==-1?"property":"argument";let l=`The "${e}" ${r} ${o} of type ${t}`;l+=`. Received type ${typeof s}`,super(l),this.code="ERR_INVALID_ARG_TYPE"}}function validateObject(a,e){if(a===null||typeof a!="object")throw new ErrorInvalidArgType(e,"Object",a)}function validateString(a,e){if(typeof a!="string")throw new ErrorInvalidArgType(e,"string",a)}const platformIsWin32=platform==="win32";function isPathSeparator$1(a){return a===CHAR_FORWARD_SLASH||a===CHAR_BACKWARD_SLASH}function isPosixPathSeparator(a){return a===CHAR_FORWARD_SLASH}function isWindowsDeviceRoot(a){return a>=CHAR_UPPERCASE_A&&a<=CHAR_UPPERCASE_Z||a>=CHAR_LOWERCASE_A&&a<=CHAR_LOWERCASE_Z}function normalizeString(a,e,t,s){let o="",r=0,l=-1,c=0,d=0;for(let u=0;u<=a.length;++u){if(u<a.length)d=a.charCodeAt(u);else{if(s(d))break;d=CHAR_FORWARD_SLASH}if(s(d)){if(!(l===u-1||c===1))if(c===2){if(o.length<2||r!==2||o.charCodeAt(o.length-1)!==CHAR_DOT||o.charCodeAt(o.length-2)!==CHAR_DOT){if(o.length>2){const g=o.lastIndexOf(t);g===-1?(o="",r=0):(o=o.slice(0,g),r=o.length-1-o.lastIndexOf(t)),l=u,c=0;continue}else if(o.length!==0){o="",r=0,l=u,c=0;continue}}e&&(o+=o.length>0?`${t}..`:"..",r=2)}else o.length>0?o+=`${t}${a.slice(l+1,u)}`:o=a.slice(l+1,u),r=u-l-1;l=u,c=0}else d===CHAR_DOT&&c!==-1?++c:c=-1}return o}function formatExt(a){return a?`${a[0]==="."?"":"."}${a}`:""}function _format(a,e){validateObject(e,"pathObject");const t=e.dir||e.root,s=e.base||`${e.name||""}${formatExt(e.ext)}`;return t?t===e.root?`${t}${s}`:`${t}${a}${s}`:s}const win32={resolve(...a){let e="",t="",s=!1;for(let o=a.length-1;o>=-1;o--){let r;if(o>=0){if(r=a[o],validateString(r,`paths[${o}]`),r.length===0)continue}else e.length===0?r=cwd():(r=env[`=${e}`]||cwd(),(r===void 0||r.slice(0,2).toLowerCase()!==e.toLowerCase()&&r.charCodeAt(2)===CHAR_BACKWARD_SLASH)&&(r=`${e}\\`));const l=r.length;let c=0,d="",u=!1;const g=r.charCodeAt(0);if(l===1)isPathSeparator$1(g)&&(c=1,u=!0);else if(isPathSeparator$1(g))if(u=!0,isPathSeparator$1(r.charCodeAt(1))){let f=2,p=f;for(;f<l&&!isPathSeparator$1(r.charCodeAt(f));)f++;if(f<l&&f!==p){const m=r.slice(p,f);for(p=f;f<l&&isPathSeparator$1(r.charCodeAt(f));)f++;if(f<l&&f!==p){for(p=f;f<l&&!isPathSeparator$1(r.charCodeAt(f));)f++;(f===l||f!==p)&&(d=`\\\\${m}\\${r.slice(p,f)}`,c=f)}}}else c=1;else isWindowsDeviceRoot(g)&&r.charCodeAt(1)===CHAR_COLON&&(d=r.slice(0,2),c=2,l>2&&isPathSeparator$1(r.charCodeAt(2))&&(u=!0,c=3));if(d.length>0)if(e.length>0){if(d.toLowerCase()!==e.toLowerCase())continue}else e=d;if(s){if(e.length>0)break}else if(t=`${r.slice(c)}\\${t}`,s=u,u&&e.length>0)break}return t=normalizeString(t,!s,"\\",isPathSeparator$1),s?`${e}\\${t}`:`${e}${t}`||"."},normalize(a){validateString(a,"path");const e=a.length;if(e===0)return".";let t=0,s,o=!1;const r=a.charCodeAt(0);if(e===1)return isPosixPathSeparator(r)?"\\":a;if(isPathSeparator$1(r))if(o=!0,isPathSeparator$1(a.charCodeAt(1))){let c=2,d=c;for(;c<e&&!isPathSeparator$1(a.charCodeAt(c));)c++;if(c<e&&c!==d){const u=a.slice(d,c);for(d=c;c<e&&isPathSeparator$1(a.charCodeAt(c));)c++;if(c<e&&c!==d){for(d=c;c<e&&!isPathSeparator$1(a.charCodeAt(c));)c++;if(c===e)return`\\\\${u}\\${a.slice(d)}\\`;c!==d&&(s=`\\\\${u}\\${a.slice(d,c)}`,t=c)}}}else t=1;else isWindowsDeviceRoot(r)&&a.charCodeAt(1)===CHAR_COLON&&(s=a.slice(0,2),t=2,e>2&&isPathSeparator$1(a.charCodeAt(2))&&(o=!0,t=3));let l=t<e?normalizeString(a.slice(t),!o,"\\",isPathSeparator$1):"";if(l.length===0&&!o&&(l="."),l.length>0&&isPathSeparator$1(a.charCodeAt(e-1))&&(l+="\\"),!o&&s===void 0&&a.includes(":")){if(l.length>=2&&isWindowsDeviceRoot(l.charCodeAt(0))&&l.charCodeAt(1)===CHAR_COLON)return`.\\${l}`;let c=a.indexOf(":");do if(c===e-1||isPathSeparator$1(a.charCodeAt(c+1)))return`.\\${l}`;while((c=a.indexOf(":",c+1))!==-1)}return s===void 0?o?`\\${l}`:l:o?`${s}\\${l}`:`${s}${l}`},isAbsolute(a){validateString(a,"path");const e=a.length;if(e===0)return!1;const t=a.charCodeAt(0);return isPathSeparator$1(t)||e>2&&isWindowsDeviceRoot(t)&&a.charCodeAt(1)===CHAR_COLON&&isPathSeparator$1(a.charCodeAt(2))},join(...a){if(a.length===0)return".";let e,t;for(let r=0;r<a.length;++r){const l=a[r];validateString(l,"path"),l.length>0&&(e===void 0?e=t=l:e+=`\\${l}`)}if(e===void 0)return".";let s=!0,o=0;if(typeof t=="string"&&isPathSeparator$1(t.charCodeAt(0))){++o;const r=t.length;r>1&&isPathSeparator$1(t.charCodeAt(1))&&(++o,r>2&&(isPathSeparator$1(t.charCodeAt(2))?++o:s=!1))}if(s){for(;o<e.length&&isPathSeparator$1(e.charCodeAt(o));)o++;o>=2&&(e=`\\${e.slice(o)}`)}return win32.normalize(e)},relative(a,e){if(validateString(a,"from"),validateString(e,"to"),a===e)return"";const t=win32.resolve(a),s=win32.resolve(e);if(t===s||(a=t.toLowerCase(),e=s.toLowerCase(),a===e))return"";if(t.length!==a.length||s.length!==e.length){const _=t.split("\\"),C=s.split("\\");_[_.length-1]===""&&_.pop(),C[C.length-1]===""&&C.pop();const b=_.length,v=C.length,S=b<v?b:v;let y;for(y=0;y<S&&_[y].toLowerCase()===C[y].toLowerCase();y++);return y===0?s:y===S?v>S?C.slice(y).join("\\"):b>S?"..\\".repeat(b-1-y)+"..":"":"..\\".repeat(b-y)+C.slice(y).join("\\")}let o=0;for(;o<a.length&&a.charCodeAt(o)===CHAR_BACKWARD_SLASH;)o++;let r=a.length;for(;r-1>o&&a.charCodeAt(r-1)===CHAR_BACKWARD_SLASH;)r--;const l=r-o;let c=0;for(;c<e.length&&e.charCodeAt(c)===CHAR_BACKWARD_SLASH;)c++;let d=e.length;for(;d-1>c&&e.charCodeAt(d-1)===CHAR_BACKWARD_SLASH;)d--;const u=d-c,g=l<u?l:u;let f=-1,p=0;for(;p<g;p++){const _=a.charCodeAt(o+p);if(_!==e.charCodeAt(c+p))break;_===CHAR_BACKWARD_SLASH&&(f=p)}if(p!==g){if(f===-1)return s}else{if(u>g){if(e.charCodeAt(c+p)===CHAR_BACKWARD_SLASH)return s.slice(c+p+1);if(p===2)return s.slice(c+p)}l>g&&(a.charCodeAt(o+p)===CHAR_BACKWARD_SLASH?f=p:p===2&&(f=3)),f===-1&&(f=0)}let m="";for(p=o+f+1;p<=r;++p)(p===r||a.charCodeAt(p)===CHAR_BACKWARD_SLASH)&&(m+=m.length===0?"..":"\\..");return c+=f,m.length>0?`${m}${s.slice(c,d)}`:(s.charCodeAt(c)===CHAR_BACKWARD_SLASH&&++c,s.slice(c,d))},toNamespacedPath(a){if(typeof a!="string"||a.length===0)return a;const e=win32.resolve(a);if(e.length<=2)return a;if(e.charCodeAt(0)===CHAR_BACKWARD_SLASH){if(e.charCodeAt(1)===CHAR_BACKWARD_SLASH){const t=e.charCodeAt(2);if(t!==CHAR_QUESTION_MARK&&t!==CHAR_DOT)return`\\\\?\\UNC\\${e.slice(2)}`}}else if(isWindowsDeviceRoot(e.charCodeAt(0))&&e.charCodeAt(1)===CHAR_COLON&&e.charCodeAt(2)===CHAR_BACKWARD_SLASH)return`\\\\?\\${e}`;return e},dirname(a){validateString(a,"path");const e=a.length;if(e===0)return".";let t=-1,s=0;const o=a.charCodeAt(0);if(e===1)return isPathSeparator$1(o)?a:".";if(isPathSeparator$1(o)){if(t=s=1,isPathSeparator$1(a.charCodeAt(1))){let c=2,d=c;for(;c<e&&!isPathSeparator$1(a.charCodeAt(c));)c++;if(c<e&&c!==d){for(d=c;c<e&&isPathSeparator$1(a.charCodeAt(c));)c++;if(c<e&&c!==d){for(d=c;c<e&&!isPathSeparator$1(a.charCodeAt(c));)c++;if(c===e)return a;c!==d&&(t=s=c+1)}}}}else isWindowsDeviceRoot(o)&&a.charCodeAt(1)===CHAR_COLON&&(t=e>2&&isPathSeparator$1(a.charCodeAt(2))?3:2,s=t);let r=-1,l=!0;for(let c=e-1;c>=s;--c)if(isPathSeparator$1(a.charCodeAt(c))){if(!l){r=c;break}}else l=!1;if(r===-1){if(t===-1)return".";r=t}return a.slice(0,r)},basename(a,e){e!==void 0&&validateString(e,"suffix"),validateString(a,"path");let t=0,s=-1,o=!0,r;if(a.length>=2&&isWindowsDeviceRoot(a.charCodeAt(0))&&a.charCodeAt(1)===CHAR_COLON&&(t=2),e!==void 0&&e.length>0&&e.length<=a.length){if(e===a)return"";let l=e.length-1,c=-1;for(r=a.length-1;r>=t;--r){const d=a.charCodeAt(r);if(isPathSeparator$1(d)){if(!o){t=r+1;break}}else c===-1&&(o=!1,c=r+1),l>=0&&(d===e.charCodeAt(l)?--l===-1&&(s=r):(l=-1,s=c))}return t===s?s=c:s===-1&&(s=a.length),a.slice(t,s)}for(r=a.length-1;r>=t;--r)if(isPathSeparator$1(a.charCodeAt(r))){if(!o){t=r+1;break}}else s===-1&&(o=!1,s=r+1);return s===-1?"":a.slice(t,s)},extname(a){validateString(a,"path");let e=0,t=-1,s=0,o=-1,r=!0,l=0;a.length>=2&&a.charCodeAt(1)===CHAR_COLON&&isWindowsDeviceRoot(a.charCodeAt(0))&&(e=s=2);for(let c=a.length-1;c>=e;--c){const d=a.charCodeAt(c);if(isPathSeparator$1(d)){if(!r){s=c+1;break}continue}o===-1&&(r=!1,o=c+1),d===CHAR_DOT?t===-1?t=c:l!==1&&(l=1):t!==-1&&(l=-1)}return t===-1||o===-1||l===0||l===1&&t===o-1&&t===s+1?"":a.slice(t,o)},format:_format.bind(null,"\\"),parse(a){validateString(a,"path");const e={root:"",dir:"",base:"",ext:"",name:""};if(a.length===0)return e;const t=a.length;let s=0,o=a.charCodeAt(0);if(t===1)return isPathSeparator$1(o)?(e.root=e.dir=a,e):(e.base=e.name=a,e);if(isPathSeparator$1(o)){if(s=1,isPathSeparator$1(a.charCodeAt(1))){let f=2,p=f;for(;f<t&&!isPathSeparator$1(a.charCodeAt(f));)f++;if(f<t&&f!==p){for(p=f;f<t&&isPathSeparator$1(a.charCodeAt(f));)f++;if(f<t&&f!==p){for(p=f;f<t&&!isPathSeparator$1(a.charCodeAt(f));)f++;f===t?s=f:f!==p&&(s=f+1)}}}}else if(isWindowsDeviceRoot(o)&&a.charCodeAt(1)===CHAR_COLON){if(t<=2)return e.root=e.dir=a,e;if(s=2,isPathSeparator$1(a.charCodeAt(2))){if(t===3)return e.root=e.dir=a,e;s=3}}s>0&&(e.root=a.slice(0,s));let r=-1,l=s,c=-1,d=!0,u=a.length-1,g=0;for(;u>=s;--u){if(o=a.charCodeAt(u),isPathSeparator$1(o)){if(!d){l=u+1;break}continue}c===-1&&(d=!1,c=u+1),o===CHAR_DOT?r===-1?r=u:g!==1&&(g=1):r!==-1&&(g=-1)}return c!==-1&&(r===-1||g===0||g===1&&r===c-1&&r===l+1?e.base=e.name=a.slice(l,c):(e.name=a.slice(l,r),e.base=a.slice(l,c),e.ext=a.slice(r,c))),l>0&&l!==s?e.dir=a.slice(0,l-1):e.dir=e.root,e},sep:"\\",delimiter:";",win32:null,posix:null},posixCwd=(()=>{if(platformIsWin32){const a=/\\/g;return()=>{const e=cwd().replace(a,"/");return e.slice(e.indexOf("/"))}}return()=>cwd()})(),posix={resolve(...a){let e="",t=!1;for(let s=a.length-1;s>=0&&!t;s--){const o=a[s];validateString(o,`paths[${s}]`),o.length!==0&&(e=`${o}/${e}`,t=o.charCodeAt(0)===CHAR_FORWARD_SLASH)}if(!t){const s=posixCwd();e=`${s}/${e}`,t=s.charCodeAt(0)===CHAR_FORWARD_SLASH}return e=normalizeString(e,!t,"/",isPosixPathSeparator),t?`/${e}`:e.length>0?e:"."},normalize(a){if(validateString(a,"path"),a.length===0)return".";const e=a.charCodeAt(0)===CHAR_FORWARD_SLASH,t=a.charCodeAt(a.length-1)===CHAR_FORWARD_SLASH;return a=normalizeString(a,!e,"/",isPosixPathSeparator),a.length===0?e?"/":t?"./":".":(t&&(a+="/"),e?`/${a}`:a)},isAbsolute(a){return validateString(a,"path"),a.length>0&&a.charCodeAt(0)===CHAR_FORWARD_SLASH},join(...a){if(a.length===0)return".";const e=[];for(let t=0;t<a.length;++t){const s=a[t];validateString(s,"path"),s.length>0&&e.push(s)}return e.length===0?".":posix.normalize(e.join("/"))},relative(a,e){if(validateString(a,"from"),validateString(e,"to"),a===e||(a=posix.resolve(a),e=posix.resolve(e),a===e))return"";const t=1,s=a.length,o=s-t,r=1,l=e.length-r,c=o<l?o:l;let d=-1,u=0;for(;u<c;u++){const f=a.charCodeAt(t+u);if(f!==e.charCodeAt(r+u))break;f===CHAR_FORWARD_SLASH&&(d=u)}if(u===c)if(l>c){if(e.charCodeAt(r+u)===CHAR_FORWARD_SLASH)return e.slice(r+u+1);if(u===0)return e.slice(r+u)}else o>c&&(a.charCodeAt(t+u)===CHAR_FORWARD_SLASH?d=u:u===0&&(d=0));let g="";for(u=t+d+1;u<=s;++u)(u===s||a.charCodeAt(u)===CHAR_FORWARD_SLASH)&&(g+=g.length===0?"..":"/..");return`${g}${e.slice(r+d)}`},toNamespacedPath(a){return a},dirname(a){if(validateString(a,"path"),a.length===0)return".";const e=a.charCodeAt(0)===CHAR_FORWARD_SLASH;let t=-1,s=!0;for(let o=a.length-1;o>=1;--o)if(a.charCodeAt(o)===CHAR_FORWARD_SLASH){if(!s){t=o;break}}else s=!1;return t===-1?e?"/":".":e&&t===1?"//":a.slice(0,t)},basename(a,e){e!==void 0&&validateString(e,"suffix"),validateString(a,"path");let t=0,s=-1,o=!0,r;if(e!==void 0&&e.length>0&&e.length<=a.length){if(e===a)return"";let l=e.length-1,c=-1;for(r=a.length-1;r>=0;--r){const d=a.charCodeAt(r);if(d===CHAR_FORWARD_SLASH){if(!o){t=r+1;break}}else c===-1&&(o=!1,c=r+1),l>=0&&(d===e.charCodeAt(l)?--l===-1&&(s=r):(l=-1,s=c))}return t===s?s=c:s===-1&&(s=a.length),a.slice(t,s)}for(r=a.length-1;r>=0;--r)if(a.charCodeAt(r)===CHAR_FORWARD_SLASH){if(!o){t=r+1;break}}else s===-1&&(o=!1,s=r+1);return s===-1?"":a.slice(t,s)},extname(a){validateString(a,"path");let e=-1,t=0,s=-1,o=!0,r=0;for(let l=a.length-1;l>=0;--l){const c=a[l];if(c==="/"){if(!o){t=l+1;break}continue}s===-1&&(o=!1,s=l+1),c==="."?e===-1?e=l:r!==1&&(r=1):e!==-1&&(r=-1)}return e===-1||s===-1||r===0||r===1&&e===s-1&&e===t+1?"":a.slice(e,s)},format:_format.bind(null,"/"),parse(a){validateString(a,"path");const e={root:"",dir:"",base:"",ext:"",name:""};if(a.length===0)return e;const t=a.charCodeAt(0)===CHAR_FORWARD_SLASH;let s;t?(e.root="/",s=1):s=0;let o=-1,r=0,l=-1,c=!0,d=a.length-1,u=0;for(;d>=s;--d){const g=a.charCodeAt(d);if(g===CHAR_FORWARD_SLASH){if(!c){r=d+1;break}continue}l===-1&&(c=!1,l=d+1),g===CHAR_DOT?o===-1?o=d:u!==1&&(u=1):o!==-1&&(u=-1)}if(l!==-1){const g=r===0&&t?1:r;o===-1||u===0||u===1&&o===l-1&&o===r+1?e.base=e.name=a.slice(g,l):(e.name=a.slice(g,o),e.base=a.slice(g,l),e.ext=a.slice(o,l))}return r>0?e.dir=a.slice(0,r-1):t&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};posix.win32=win32.win32=win32;posix.posix=win32.posix=posix;const normalize=platformIsWin32?win32.normalize:posix.normalize,resolve$1=platformIsWin32?win32.resolve:posix.resolve,relative=platformIsWin32?win32.relative:posix.relative,dirname$1=platformIsWin32?win32.dirname:posix.dirname,basename$1=platformIsWin32?win32.basename:posix.basename,extname$1=platformIsWin32?win32.extname:posix.extname,sep=platformIsWin32?win32.sep:posix.sep,_schemePattern=/^\w[\w\d+.-]*$/,_singleSlashStart=/^\//,_doubleSlashStart=/^\/\//;function _validateUri(a,e){if(!a.scheme&&e)throw new Error(`[UriError]: Scheme is missing: {scheme: "", authority: "${a.authority}", path: "${a.path}", query: "${a.query}", fragment: "${a.fragment}"}`);if(a.scheme&&!_schemePattern.test(a.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(a.path){if(a.authority){if(!_singleSlashStart.test(a.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(_doubleSlashStart.test(a.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}}function _schemeFix(a,e){return!a&&!e?"file":a}function _referenceResolution(a,e){switch(a){case"https":case"http":case"file":e?e[0]!==_slash&&(e=_slash+e):e=_slash;break}return e}const _empty="",_slash="/",_regexp=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;class URI{static isUri(e){return e instanceof URI?!0:!e||typeof e!="object"?!1:typeof e.authority=="string"&&typeof e.fragment=="string"&&typeof e.path=="string"&&typeof e.query=="string"&&typeof e.scheme=="string"&&typeof e.fsPath=="string"&&typeof e.with=="function"&&typeof e.toString=="function"}constructor(e,t,s,o,r,l=!1){typeof e=="object"?(this.scheme=e.scheme||_empty,this.authority=e.authority||_empty,this.path=e.path||_empty,this.query=e.query||_empty,this.fragment=e.fragment||_empty):(this.scheme=_schemeFix(e,l),this.authority=t||_empty,this.path=_referenceResolution(this.scheme,s||_empty),this.query=o||_empty,this.fragment=r||_empty,_validateUri(this,l))}get fsPath(){return uriToFsPath(this,!1)}with(e){if(!e)return this;let{scheme:t,authority:s,path:o,query:r,fragment:l}=e;return t===void 0?t=this.scheme:t===null&&(t=_empty),s===void 0?s=this.authority:s===null&&(s=_empty),o===void 0?o=this.path:o===null&&(o=_empty),r===void 0?r=this.query:r===null&&(r=_empty),l===void 0?l=this.fragment:l===null&&(l=_empty),t===this.scheme&&s===this.authority&&o===this.path&&r===this.query&&l===this.fragment?this:new Uri$1(t,s,o,r,l)}static parse(e,t=!1){const s=_regexp.exec(e);return s?new Uri$1(s[2]||_empty,percentDecode(s[4]||_empty),percentDecode(s[5]||_empty),percentDecode(s[7]||_empty),percentDecode(s[9]||_empty),t):new Uri$1(_empty,_empty,_empty,_empty,_empty)}static file(e){let t=_empty;if(isWindows&&(e=e.replace(/\\/g,_slash)),e[0]===_slash&&e[1]===_slash){const s=e.indexOf(_slash,2);s===-1?(t=e.substring(2),e=_slash):(t=e.substring(2,s),e=e.substring(s)||_slash)}return new Uri$1("file",t,e,_empty,_empty)}static from(e,t){return new Uri$1(e.scheme,e.authority,e.path,e.query,e.fragment,t)}static joinPath(e,...t){if(!e.path)throw new Error("[UriError]: cannot call joinPath on URI without path");let s;return isWindows&&e.scheme==="file"?s=URI.file(win32.join(uriToFsPath(e,!0),...t)).path:s=posix.join(e.path,...t),e.with({path:s})}toString(e=!1){return _asFormatted(this,e)}toJSON(){return this}static revive(e){if(e){if(e instanceof URI)return e;{const t=new Uri$1(e);return t._formatted=e.external??null,t._fsPath=e._sep===_pathSepMarker?e.fsPath??null:null,t}}else return e}}const _pathSepMarker=isWindows?1:void 0;let Uri$1=class extends URI{constructor(){super(...arguments),this._formatted=null,this._fsPath=null}get fsPath(){return this._fsPath||(this._fsPath=uriToFsPath(this,!1)),this._fsPath}toString(e=!1){return e?_asFormatted(this,!0):(this._formatted||(this._formatted=_asFormatted(this,!1)),this._formatted)}toJSON(){const e={$mid:1};return this._fsPath&&(e.fsPath=this._fsPath,e._sep=_pathSepMarker),this._formatted&&(e.external=this._formatted),this.path&&(e.path=this.path),this.scheme&&(e.scheme=this.scheme),this.authority&&(e.authority=this.authority),this.query&&(e.query=this.query),this.fragment&&(e.fragment=this.fragment),e}};const encodeTable={58:"%3A",47:"%2F",63:"%3F",35:"%23",91:"%5B",93:"%5D",64:"%40",33:"%21",36:"%24",38:"%26",39:"%27",40:"%28",41:"%29",42:"%2A",43:"%2B",44:"%2C",59:"%3B",61:"%3D",32:"%20"};function encodeURIComponentFast(a,e,t){let s,o=-1;for(let r=0;r<a.length;r++){const l=a.charCodeAt(r);if(l>=97&&l<=122||l>=65&&l<=90||l>=48&&l<=57||l===45||l===46||l===95||l===126||e&&l===47||t&&l===91||t&&l===93||t&&l===58)o!==-1&&(s+=encodeURIComponent(a.substring(o,r)),o=-1),s!==void 0&&(s+=a.charAt(r));else{s===void 0&&(s=a.substr(0,r));const c=encodeTable[l];c!==void 0?(o!==-1&&(s+=encodeURIComponent(a.substring(o,r)),o=-1),s+=c):o===-1&&(o=r)}}return o!==-1&&(s+=encodeURIComponent(a.substring(o))),s!==void 0?s:a}function encodeURIComponentMinimal(a){let e;for(let t=0;t<a.length;t++){const s=a.charCodeAt(t);s===35||s===63?(e===void 0&&(e=a.substr(0,t)),e+=encodeTable[s]):e!==void 0&&(e+=a[t])}return e!==void 0?e:a}function uriToFsPath(a,e){let t;return a.authority&&a.path.length>1&&a.scheme==="file"?t=`//${a.authority}${a.path}`:a.path.charCodeAt(0)===47&&(a.path.charCodeAt(1)>=65&&a.path.charCodeAt(1)<=90||a.path.charCodeAt(1)>=97&&a.path.charCodeAt(1)<=122)&&a.path.charCodeAt(2)===58?e?t=a.path.substr(1):t=a.path[1].toLowerCase()+a.path.substr(2):t=a.path,isWindows&&(t=t.replace(/\//g,"\\")),t}function _asFormatted(a,e){const t=e?encodeURIComponentMinimal:encodeURIComponentFast;let s="",{scheme:o,authority:r,path:l,query:c,fragment:d}=a;if(o&&(s+=o,s+=":"),(r||o==="file")&&(s+=_slash,s+=_slash),r){let u=r.indexOf("@");if(u!==-1){const g=r.substr(0,u);r=r.substr(u+1),u=g.lastIndexOf(":"),u===-1?s+=t(g,!1,!1):(s+=t(g.substr(0,u),!1,!1),s+=":",s+=t(g.substr(u+1),!1,!0)),s+="@"}r=r.toLowerCase(),u=r.lastIndexOf(":"),u===-1?s+=t(r,!1,!0):(s+=t(r.substr(0,u),!1,!0),s+=r.substr(u))}if(l){if(l.length>=3&&l.charCodeAt(0)===47&&l.charCodeAt(2)===58){const u=l.charCodeAt(1);u>=65&&u<=90&&(l=`/${String.fromCharCode(u+32)}:${l.substr(3)}`)}else if(l.length>=2&&l.charCodeAt(1)===58){const u=l.charCodeAt(0);u>=65&&u<=90&&(l=`${String.fromCharCode(u+32)}:${l.substr(2)}`)}s+=t(l,!0,!1)}return c&&(s+="?",s+=t(c,!1,!1)),d&&(s+="#",s+=e?d:encodeURIComponentFast(d,!1,!1)),s}function decodeURIComponentGraceful(a){try{return decodeURIComponent(a)}catch{return a.length>3?a.substr(0,3)+decodeURIComponentGraceful(a.substr(3)):a}}const _rEncodedAsHex=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function percentDecode(a){return a.match(_rEncodedAsHex)?a.replace(_rEncodedAsHex,e=>decodeURIComponentGraceful(e)):a}var Schemas;(function(a){a.inMemory="inmemory",a.vscode="vscode",a.internal="private",a.walkThrough="walkThrough",a.walkThroughSnippet="walkThroughSnippet",a.http="http",a.https="https",a.file="file",a.mailto="mailto",a.untitled="untitled",a.data="data",a.command="command",a.vscodeRemote="vscode-remote",a.vscodeRemoteResource="vscode-remote-resource",a.vscodeManagedRemoteResource="vscode-managed-remote-resource",a.vscodeUserData="vscode-userdata",a.vscodeCustomEditor="vscode-custom-editor",a.vscodeNotebookCell="vscode-notebook-cell",a.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",a.vscodeNotebookCellMetadataDiff="vscode-notebook-cell-metadata-diff",a.vscodeNotebookCellOutput="vscode-notebook-cell-output",a.vscodeNotebookCellOutputDiff="vscode-notebook-cell-output-diff",a.vscodeNotebookMetadata="vscode-notebook-metadata",a.vscodeInteractiveInput="vscode-interactive-input",a.vscodeSettings="vscode-settings",a.vscodeWorkspaceTrust="vscode-workspace-trust",a.vscodeTerminal="vscode-terminal",a.vscodeChatCodeBlock="vscode-chat-code-block",a.vscodeChatCodeCompareBlock="vscode-chat-code-compare-block",a.vscodeChatEditor="vscode-chat-editor",a.vscodeChatInput="chatSessionInput",a.vscodeChatSession="vscode-chat-session",a.webviewPanel="webview-panel",a.vscodeWebview="vscode-webview",a.extension="extension",a.vscodeFileResource="vscode-file",a.tmp="tmp",a.vsls="vsls",a.vscodeSourceControl="vscode-scm",a.commentsInput="comment",a.codeSetting="code-setting",a.outputChannel="output",a.accessibleView="accessible-view",a.chatEditingSnapshotScheme="chat-editing-snapshot-text-model",a.chatEditingModel="chat-editing-text-model"})(Schemas||(Schemas={}));function matchesScheme(a,e){return URI.isUri(a)?equalsIgnoreCase(a.scheme,e):startsWithIgnoreCase(a,e+":")}function matchesSomeScheme(a,...e){return e.some(t=>matchesScheme(a,t))}const connectionTokenQueryName="tkn";class RemoteAuthoritiesImpl{constructor(){this._hosts=Object.create(null),this._ports=Object.create(null),this._connectionTokens=Object.create(null),this._preferredWebSchema="http",this._delegate=null,this._serverRootPath="/"}setPreferredWebSchema(e){this._preferredWebSchema=e}get _remoteResourcesPath(){return posix.join(this._serverRootPath,Schemas.vscodeRemoteResource)}rewrite(e){if(this._delegate)try{return this._delegate(e)}catch(c){return onUnexpectedError(c),e}const t=e.authority;let s=this._hosts[t];s&&s.indexOf(":")!==-1&&s.indexOf("[")===-1&&(s=`[${s}]`);const o=this._ports[t],r=this._connectionTokens[t];let l=`path=${encodeURIComponent(e.path)}`;return typeof r=="string"&&(l+=`&${connectionTokenQueryName}=${encodeURIComponent(r)}`),URI.from({scheme:isWeb?this._preferredWebSchema:Schemas.vscodeRemoteResource,authority:`${s}:${o}`,path:this._remoteResourcesPath,query:l})}}const RemoteAuthorities=new RemoteAuthoritiesImpl,VSCODE_AUTHORITY="vscode-app",hn=class hn{uriToBrowserUri(e){return e.scheme===Schemas.vscodeRemote?RemoteAuthorities.rewrite(e):e.scheme===Schemas.file&&(isNative||webWorkerOrigin===`${Schemas.vscodeFileResource}://${hn.FALLBACK_AUTHORITY}`)?e.with({scheme:Schemas.vscodeFileResource,authority:e.authority||hn.FALLBACK_AUTHORITY,query:null,fragment:null}):e}};hn.FALLBACK_AUTHORITY=VSCODE_AUTHORITY;let FileAccessImpl=hn;const FileAccess=new FileAccessImpl;var COI;(function(a){const e=new Map([["1",{"Cross-Origin-Opener-Policy":"same-origin"}],["2",{"Cross-Origin-Embedder-Policy":"require-corp"}],["3",{"Cross-Origin-Opener-Policy":"same-origin","Cross-Origin-Embedder-Policy":"require-corp"}]]);a.CoopAndCoep=Object.freeze(e.get("3"));const t="vscode-coi";function s(r){let l;typeof r=="string"?l=new URL(r).searchParams:r instanceof URL?l=r.searchParams:URI.isUri(r)&&(l=new URL(r.toString(!0)).searchParams);const c=l==null?void 0:l.get(t);if(c)return e.get(c)}a.getHeadersFromQuery=s;function o(r,l,c){if(!globalThis.crossOriginIsolated)return;const d=l&&c?"3":c?"2":"1";r instanceof URLSearchParams?r.set(t,d):r[t]=d}a.addSearchParam=o})(COI||(COI={}));const hasBuffer=typeof Buffer<"u";new Lazy(()=>new Uint8Array(256));let textDecoder;class VSBuffer{static wrap(e){return hasBuffer&&!Buffer.isBuffer(e)&&(e=Buffer.from(e.buffer,e.byteOffset,e.byteLength)),new VSBuffer(e)}constructor(e){this.buffer=e,this.byteLength=this.buffer.byteLength}toString(){return hasBuffer?this.buffer.toString():(textDecoder||(textDecoder=new TextDecoder),textDecoder.decode(this.buffer))}}function readUInt16LE(a,e){return a[e+0]<<0>>>0|a[e+1]<<8>>>0}function writeUInt16LE(a,e,t){a[t+0]=e&255,e=e>>>8,a[t+1]=e&255}function readUInt32BE(a,e){return a[e]*2**24+a[e+1]*2**16+a[e+2]*2**8+a[e+3]}function writeUInt32BE(a,e,t){a[t+3]=e,e=e>>>8,a[t+2]=e,e=e>>>8,a[t+1]=e,e=e>>>8,a[t]=e}function readUInt8(a,e){return a[e]}function writeUInt8(a,e,t){a[t]=e}const hexChars="0123456789abcdef";function encodeHex({buffer:a}){let e="";for(let t=0;t<a.length;t++){const s=a[t];e+=hexChars[s>>>4],e+=hexChars[s&15]}return e}function hash(a){return doHash(a,0)}function doHash(a,e){switch(typeof a){case"object":return a===null?numberHash(349,e):Array.isArray(a)?arrayHash(a,e):objectHash(a,e);case"string":return stringHash(a,e);case"boolean":return booleanHash(a,e);case"number":return numberHash(a,e);case"undefined":return numberHash(937,e);default:return numberHash(617,e)}}function numberHash(a,e){return(e<<5)-e+a|0}function booleanHash(a,e){return numberHash(a?433:863,e)}function stringHash(a,e){e=numberHash(149417,e);for(let t=0,s=a.length;t<s;t++)e=numberHash(a.charCodeAt(t),e);return e}function arrayHash(a,e){return e=numberHash(104579,e),a.reduce((t,s)=>doHash(s,t),e)}function objectHash(a,e){return e=numberHash(181387,e),Object.keys(a).sort().reduce((t,s)=>(t=stringHash(s,t),doHash(a[s],t)),e)}function leftRotate$2(a,e,t=32){const s=t-e,o=~((1<<s)-1);return(a<<e|(o&a)>>>s)>>>0}function toHexString(a,e=32){return a instanceof ArrayBuffer?encodeHex(VSBuffer.wrap(new Uint8Array(a))):(a>>>0).toString(16).padStart(e/4,"0")}const Xn=class Xn{constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(64+3),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(e){const t=e.length;if(t===0)return;const s=this._buff;let o=this._buffLen,r=this._leftoverHighSurrogate,l,c;for(r!==0?(l=r,c=-1,r=0):(l=e.charCodeAt(0),c=0);;){let d=l;if(isHighSurrogate(l))if(c+1<t){const u=e.charCodeAt(c+1);isLowSurrogate(u)?(c++,d=computeCodePoint(l,u)):d=65533}else{r=l;break}else isLowSurrogate(l)&&(d=65533);if(o=this._push(s,o,d),c++,c<t)l=e.charCodeAt(c);else break}this._buffLen=o,this._leftoverHighSurrogate=r}_push(e,t,s){return s<128?e[t++]=s:s<2048?(e[t++]=192|(s&1984)>>>6,e[t++]=128|(s&63)>>>0):s<65536?(e[t++]=224|(s&61440)>>>12,e[t++]=128|(s&4032)>>>6,e[t++]=128|(s&63)>>>0):(e[t++]=240|(s&1835008)>>>18,e[t++]=128|(s&258048)>>>12,e[t++]=128|(s&4032)>>>6,e[t++]=128|(s&63)>>>0),t>=64&&(this._step(),t-=64,this._totalLen+=64,e[0]=e[64+0],e[1]=e[64+1],e[2]=e[64+2]),t}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),toHexString(this._h0)+toHexString(this._h1)+toHexString(this._h2)+toHexString(this._h3)+toHexString(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,this._buff.subarray(this._buffLen).fill(0),this._buffLen>56&&(this._step(),this._buff.fill(0));const e=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(e/4294967296),!1),this._buffDV.setUint32(60,e%4294967296,!1),this._step()}_step(){const e=Xn._bigBlock32,t=this._buffDV;for(let f=0;f<64;f+=4)e.setUint32(f,t.getUint32(f,!1),!1);for(let f=64;f<320;f+=4)e.setUint32(f,leftRotate$2(e.getUint32(f-12,!1)^e.getUint32(f-32,!1)^e.getUint32(f-56,!1)^e.getUint32(f-64,!1),1),!1);let s=this._h0,o=this._h1,r=this._h2,l=this._h3,c=this._h4,d,u,g;for(let f=0;f<80;f++)f<20?(d=o&r|~o&l,u=1518500249):f<40?(d=o^r^l,u=1859775393):f<60?(d=o&r|o&l|r&l,u=2400959708):(d=o^r^l,u=3395469782),g=leftRotate$2(s,5)+d+c+u+e.getUint32(f*4,!1)&4294967295,c=l,l=r,r=leftRotate$2(o,30),o=s,s=g;this._h0=this._h0+s&4294967295,this._h1=this._h1+o&4294967295,this._h2=this._h2+r&4294967295,this._h3=this._h3+l&4294967295,this._h4=this._h4+c&4294967295}};Xn._bigBlock32=new DataView(new ArrayBuffer(320));let StringSHA1=Xn;class DebugNameData{constructor(e,t,s){this.owner=e,this.debugNameSource=t,this.referenceFn=s}getDebugName(e){return getDebugName(e,this)}}const countPerName=new Map,cachedDebugName=new WeakMap;function getDebugName(a,e){const t=cachedDebugName.get(a);if(t)return t;const s=computeDebugName(a,e);if(s){let o=countPerName.get(s)??0;o++,countPerName.set(s,o);const r=o===1?s:`${s}#${o}`;return cachedDebugName.set(a,r),r}}function computeDebugName(a,e){const t=cachedDebugName.get(a);if(t)return t;const s=e.owner?formatOwner(e.owner)+".":"";let o;const r=e.debugNameSource;if(r!==void 0)if(typeof r=="function"){if(o=r(),o!==void 0)return s+o}else return s+r;const l=e.referenceFn;if(l!==void 0&&(o=getFunctionName(l),o!==void 0))return s+o;if(e.owner!==void 0){const c=findKey(e.owner,a);if(c!==void 0)return s+c}}function findKey(a,e){for(const t in a)if(a[t]===e)return t}const countPerClassName=new Map,ownerId=new WeakMap;function formatOwner(a){const e=ownerId.get(a);if(e)return e;const t=getClassName$1(a)??"Object";let s=countPerClassName.get(t)??0;s++,countPerClassName.set(t,s);const o=s===1?t:`${t}#${s}`;return ownerId.set(a,o),o}function getClassName$1(a){const e=a.constructor;if(e)return e.name==="Object"?void 0:e.name}function getFunctionName(a){const e=a.toString(),s=/\/\*\*\s*@description\s*([^*]*)\*\//.exec(e),o=s?s[1]:void 0;return o==null?void 0:o.trim()}function tail(a){if(a.length===0)throw new Error("Invalid tail call");return[a.slice(0,a.length-1),a[a.length-1]]}function equals$1(a,e,t=(s,o)=>s===o){if(a===e)return!0;if(!a||!e||a.length!==e.length)return!1;for(let s=0,o=a.length;s<o;s++)if(!t(a[s],e[s]))return!1;return!0}function removeFastWithoutKeepingOrder(a,e){const t=a.length-1;e<t&&(a[e]=a[t]),a.pop()}function binarySearch(a,e,t){return binarySearch2(a.length,s=>t(a[s],e))}function binarySearch2(a,e){let t=0,s=a-1;for(;t<=s;){const o=(t+s)/2|0,r=e(o);if(r<0)t=o+1;else if(r>0)s=o-1;else return o}return-(t+1)}function quickSelect(a,e,t){if(a=a|0,a>=e.length)throw new TypeError("invalid index");const s=e[Math.floor(e.length*Math.random())],o=[],r=[],l=[];for(const c of e){const d=t(c,s);d<0?o.push(c):d>0?r.push(c):l.push(c)}return a<o.length?quickSelect(a,o,t):a<o.length+l.length?l[0]:quickSelect(a-(o.length+l.length),r,t)}function groupBy(a,e){const t=[];let s;for(const o of a.slice(0).sort(e))!s||e(s[0],o)!==0?(s=[o],t.push(s)):s.push(o);return t}function*groupAdjacentBy(a,e){let t,s;for(const o of a)s!==void 0&&e(s,o)?t.push(o):(t&&(yield t),t=[o]),s=o;t&&(yield t)}function forEachAdjacent(a,e){for(let t=0;t<=a.length;t++)e(t===0?void 0:a[t-1],t===a.length?void 0:a[t])}function forEachWithNeighbors(a,e){for(let t=0;t<a.length;t++)e(t===0?void 0:a[t-1],a[t],t+1===a.length?void 0:a[t+1])}function coalesce(a){return a.filter(e=>!!e)}function coalesceInPlace(a){let e=0;for(let t=0;t<a.length;t++)a[t]&&(a[e]=a[t],e+=1);a.length=e}function isFalsyOrEmpty(a){return!Array.isArray(a)||a.length===0}function isNonEmptyArray(a){return Array.isArray(a)&&a.length>0}function distinct(a,e=t=>t){const t=new Set;return a.filter(s=>{const o=e(s);return t.has(o)?!1:(t.add(o),!0)})}function range(a,e){let t=typeof e=="number"?a:0;typeof e=="number"?t=a:(t=0,e=a);const s=[];if(t<=e)for(let o=t;o<e;o++)s.push(o);else for(let o=t;o>e;o--)s.push(o);return s}function arrayInsert(a,e,t){const s=a.slice(0,e),o=a.slice(e);return s.concat(t,o)}function pushToStart(a,e){const t=a.indexOf(e);t>-1&&(a.splice(t,1),a.unshift(e))}function pushToEnd(a,e){const t=a.indexOf(e);t>-1&&(a.splice(t,1),a.push(e))}function pushMany(a,e){for(const t of e)a.push(t)}function asArray(a){return Array.isArray(a)?a:[a]}function insertInto(a,e,t){const s=getActualStartIndex(a,e),o=a.length,r=t.length;a.length=o+r;for(let l=o-1;l>=s;l--)a[l+r]=a[l];for(let l=0;l<r;l++)a[l+s]=t[l]}function splice$1(a,e,t,s){const o=getActualStartIndex(a,e);let r=a.splice(o,t);return r===void 0&&(r=[]),insertInto(a,o,s),r}function getActualStartIndex(a,e){return e<0?Math.max(e+a.length,0):Math.min(e,a.length)}var CompareResult;(function(a){function e(r){return r<0}a.isLessThan=e;function t(r){return r<=0}a.isLessThanOrEqual=t;function s(r){return r>0}a.isGreaterThan=s;function o(r){return r===0}a.isNeitherLessOrGreaterThan=o,a.greaterThan=1,a.lessThan=-1,a.neitherLessOrGreaterThan=0})(CompareResult||(CompareResult={}));function compareBy(a,e){return(t,s)=>e(a(t),a(s))}function tieBreakComparators(...a){return(e,t)=>{for(const s of a){const o=s(e,t);if(!CompareResult.isNeitherLessOrGreaterThan(o))return o}return CompareResult.neitherLessOrGreaterThan}}const numberComparator=(a,e)=>a-e,booleanComparator=(a,e)=>numberComparator(a?1:0,e?1:0);function reverseOrder(a){return(e,t)=>-a(e,t)}function compareUndefinedSmallest(a){return(e,t)=>e===void 0?t===void 0?CompareResult.neitherLessOrGreaterThan:CompareResult.lessThan:t===void 0?CompareResult.greaterThan:a(e,t)}class ArrayQueue{constructor(e){this.firstIdx=0,this.items=e,this.lastIdx=this.items.length-1}get length(){return this.lastIdx-this.firstIdx+1}takeWhile(e){let t=this.firstIdx;for(;t<this.items.length&&e(this.items[t]);)t++;const s=t===this.firstIdx?null:this.items.slice(this.firstIdx,t);return this.firstIdx=t,s}takeFromEndWhile(e){let t=this.lastIdx;for(;t>=0&&e(this.items[t]);)t--;const s=t===this.lastIdx?null:this.items.slice(t+1,this.lastIdx+1);return this.lastIdx=t,s}peek(){if(this.length!==0)return this.items[this.firstIdx]}dequeue(){const e=this.items[this.firstIdx];return this.firstIdx++,e}takeCount(e){const t=this.items.slice(this.firstIdx,this.firstIdx+e);return this.firstIdx+=e,t}}const Xt=class Xt{constructor(e){this.iterate=e}toArray(){const e=[];return this.iterate(t=>(e.push(t),!0)),e}filter(e){return new Xt(t=>this.iterate(s=>e(s)?t(s):!0))}map(e){return new Xt(t=>this.iterate(s=>t(e(s))))}findLast(e){let t;return this.iterate(s=>(e(s)&&(t=s),!0)),t}findLastMaxBy(e){let t,s=!0;return this.iterate(o=>((s||CompareResult.isGreaterThan(e(o,t)))&&(s=!1,t=o),!0)),t}};Xt.empty=new Xt(e=>{});let CallbackIterable=Xt;class Permutation{constructor(e){this._indexMap=e}static createSortPermutation(e,t){const s=Array.from(e.keys()).sort((o,r)=>t(e[o],e[r]));return new Permutation(s)}apply(e){return e.map((t,s)=>e[this._indexMap[s]])}inverse(){const e=this._indexMap.slice();for(let t=0;t<this._indexMap.length;t++)e[this._indexMap[t]]=t;return new Permutation(e)}}function sum(a){return a.reduce((e,t)=>e+t,0)}const strictEquals=(a,e)=>a===e;function itemsEquals(a=strictEquals){return(e,t)=>equals$1(e,t,a)}function itemEquals(){return(a,e)=>a.equals(e)}function equalsIfDefined(a,e,t){if(t!==void 0){const s=a;return s==null||e===void 0||e===null?e===s:t(s,e)}else{const s=a;return(o,r)=>o==null||r===void 0||r===null?r===o:s(o,r)}}function structuralEquals(a,e){if(a===e)return!0;if(Array.isArray(a)&&Array.isArray(e)){if(a.length!==e.length)return!1;for(let t=0;t<a.length;t++)if(!structuralEquals(a[t],e[t]))return!1;return!0}if(a&&typeof a=="object"&&e&&typeof e=="object"&&Object.getPrototypeOf(a)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){const t=a,s=e,o=Object.keys(t),r=Object.keys(s),l=new Set(r);if(o.length!==r.length)return!1;for(const c of o)if(!l.has(c)||!structuralEquals(t[c],s[c]))return!1;return!0}return!1}function handleBugIndicatingErrorRecovery(a){const e=new Error("BugIndicatingErrorRecovery: "+a);onUnexpectedError(e),console.error("recovered from an error that indicates a bug",e)}let globalObservableLogger;function addLogger(a){globalObservableLogger?globalObservableLogger instanceof ComposedLogger?globalObservableLogger.loggers.push(a):globalObservableLogger=new ComposedLogger([globalObservableLogger,a]):globalObservableLogger=a}function getLogger(){return globalObservableLogger}class ComposedLogger{constructor(e){this.loggers=e}handleObservableCreated(e,t){for(const s of this.loggers)s.handleObservableCreated(e,t)}handleOnListenerCountChanged(e,t){for(const s of this.loggers)s.handleOnListenerCountChanged(e,t)}handleObservableUpdated(e,t){for(const s of this.loggers)s.handleObservableUpdated(e,t)}handleAutorunCreated(e,t){for(const s of this.loggers)s.handleAutorunCreated(e,t)}handleAutorunDisposed(e){for(const t of this.loggers)t.handleAutorunDisposed(e)}handleAutorunDependencyChanged(e,t,s){for(const o of this.loggers)o.handleAutorunDependencyChanged(e,t,s)}handleAutorunStarted(e){for(const t of this.loggers)t.handleAutorunStarted(e)}handleAutorunFinished(e){for(const t of this.loggers)t.handleAutorunFinished(e)}handleDerivedDependencyChanged(e,t,s){for(const o of this.loggers)o.handleDerivedDependencyChanged(e,t,s)}handleDerivedCleared(e){for(const t of this.loggers)t.handleDerivedCleared(e)}handleBeginTransaction(e){for(const t of this.loggers)t.handleBeginTransaction(e)}handleEndTransaction(e){for(const t of this.loggers)t.handleEndTransaction(e)}}function transaction(a,e){const t=new TransactionImpl(a,e);try{a(t)}finally{t.finish()}}let _globalTransaction;function globalTransaction(a){if(_globalTransaction)a(_globalTransaction);else{const e=new TransactionImpl(a,void 0);_globalTransaction=e;try{a(e)}finally{e.finish(),_globalTransaction=void 0}}}async function asyncTransaction(a,e){const t=new TransactionImpl(a,e);try{await a(t)}finally{t.finish()}}function subtransaction(a,e,t){a?e(a):transaction(e,t)}class TransactionImpl{constructor(e,t){var s;this._fn=e,this._getDebugName=t,this._updatingObservers=[],(s=getLogger())==null||s.handleBeginTransaction(this)}getDebugName(){return this._getDebugName?this._getDebugName():getFunctionName(this._fn)}updateObserver(e,t){if(!this._updatingObservers){handleBugIndicatingErrorRecovery("Transaction already finished!"),transaction(s=>{s.updateObserver(e,t)});return}this._updatingObservers.push({observer:e,observable:t}),e.beginUpdate(t)}finish(){var t;const e=this._updatingObservers;if(!e){handleBugIndicatingErrorRecovery("transaction.finish() has already been called!");return}for(let s=0;s<e.length;s++){const{observer:o,observable:r}=e[s];o.endUpdate(r)}this._updatingObservers=null,(t=getLogger())==null||t.handleEndTransaction(this)}debugGetUpdatingObservers(){return this._updatingObservers}}var DebugLocation;(function(a){let e=!1;function t(){e=!0}a.enable=t;function s(){if(!e)return;const o=Error,r=o.stackTraceLimit;o.stackTraceLimit=3;const l=new Error().stack;return o.stackTraceLimit=r,DebugLocationImpl.fromStack(l,2)}a.ofCaller=s})(DebugLocation||(DebugLocation={}));class DebugLocationImpl{static fromStack(e,t){const s=e.split(`
`),o=parseLine(s[t+1]);if(o)return new DebugLocationImpl(o.fileName,o.line,o.column,o.id)}constructor(e,t,s,o){this.fileName=e,this.line=t,this.column=s,this.id=o}}function parseLine(a){const e=a.match(/\((.*):(\d+):(\d+)\)/);if(e)return{fileName:e[1],line:parseInt(e[2]),column:parseInt(e[3]),id:a};const t=a.match(/at ([^\(\)]*):(\d+):(\d+)/);if(t)return{fileName:t[1],line:parseInt(t[2]),column:parseInt(t[3]),id:a}}let _derived;function _setDerivedOpts(a){_derived=a}let _recomputeInitiallyAndOnChange;function _setRecomputeInitiallyAndOnChange(a){_recomputeInitiallyAndOnChange=a}class ConvenientObservable{get TChange(){return null}reportChanges(){this.get()}read(e){return e?e.readObservable(this):this.get()}map(e,t,s=DebugLocation.ofCaller()){const o=t===void 0?void 0:e,r=t===void 0?e:t;return _derived({owner:o,debugName:()=>{const l=getFunctionName(r);if(l!==void 0)return l;const d=/^\s*\(?\s*([a-zA-Z_$][a-zA-Z_$0-9]*)\s*\)?\s*=>\s*\1(?:\??)\.([a-zA-Z_$][a-zA-Z_$0-9]*)\s*$/.exec(r.toString());if(d)return`${this.debugName}.${d[2]}`;if(!o)return`${this.debugName} (mapped)`},debugReferenceFn:r},l=>r(this.read(l),l),s)}flatten(){return _derived({owner:void 0,debugName:()=>`${this.debugName} (flattened)`},e=>this.read(e).read(e))}recomputeInitiallyAndOnChange(e,t){return e.add(_recomputeInitiallyAndOnChange(this,t)),this}}class BaseObservable extends ConvenientObservable{constructor(e){var t;super(),this._observers=new Set,(t=getLogger())==null||t.handleObservableCreated(this,e)}addObserver(e){var s;const t=this._observers.size;this._observers.add(e),t===0&&this.onFirstObserverAdded(),t!==this._observers.size&&((s=getLogger())==null||s.handleOnListenerCountChanged(this,this._observers.size))}removeObserver(e){var s;const t=this._observers.delete(e);t&&this._observers.size===0&&this.onLastObserverRemoved(),t&&((s=getLogger())==null||s.handleOnListenerCountChanged(this,this._observers.size))}onFirstObserverAdded(){}onLastObserverRemoved(){}debugGetObservers(){return this._observers}}function observableValue(a,e,t=DebugLocation.ofCaller()){let s;return typeof a=="string"?s=new DebugNameData(void 0,a,void 0):s=new DebugNameData(a,void 0,void 0),new ObservableValue(s,e,strictEquals,t)}class ObservableValue extends BaseObservable{get debugName(){return this._debugNameData.getDebugName(this)??"ObservableValue"}constructor(e,t,s,o){var r;super(o),this._debugNameData=e,this._equalityComparator=s,this._value=t,(r=getLogger())==null||r.handleObservableUpdated(this,{hadValue:!1,newValue:t,change:void 0,didChange:!0,oldValue:void 0})}get(){return this._value}set(e,t,s){var r;if(s===void 0&&this._equalityComparator(this._value,e))return;let o;t||(t=o=new TransactionImpl(()=>{},()=>`Setting ${this.debugName}`));try{const l=this._value;this._setValue(e),(r=getLogger())==null||r.handleObservableUpdated(this,{oldValue:l,newValue:e,change:s,didChange:!0,hadValue:!0});for(const c of this._observers)t.updateObserver(c,this),c.handleChange(this,s)}finally{o&&o.finish()}}toString(){return`${this.debugName}: ${this._value}`}_setValue(e){this._value=e}debugGetState(){return{value:this._value}}debugSetValue(e){this._value=e}}function disposableObservableValue(a,e,t=DebugLocation.ofCaller()){let s;return typeof a=="string"?s=new DebugNameData(void 0,a,void 0):s=new DebugNameData(a,void 0,void 0),new DisposableObservableValue(s,e,strictEquals,t)}class DisposableObservableValue extends ObservableValue{_setValue(e){this._value!==e&&(this._value&&this._value.dispose(),this._value=e)}dispose(){var e;(e=this._value)==null||e.dispose()}}class LazyObservableValue extends BaseObservable{get debugName(){return this._debugNameData.getDebugName(this)??"LazyObservableValue"}constructor(e,t,s,o){super(o),this._debugNameData=e,this._equalityComparator=s,this._isUpToDate=!0,this._deltas=[],this._updateCounter=0,this._value=t}get(){return this._update(),this._value}_update(){var e,t;if(!this._isUpToDate)if(this._isUpToDate=!0,this._deltas.length>0){for(const s of this._deltas){(e=getLogger())==null||e.handleObservableUpdated(this,{change:s,didChange:!0,oldValue:"(unknown)",newValue:this._value,hadValue:!0});for(const o of this._observers)o.handleChange(this,s)}this._deltas.length=0}else{(t=getLogger())==null||t.handleObservableUpdated(this,{change:void 0,didChange:!0,oldValue:"(unknown)",newValue:this._value,hadValue:!0});for(const s of this._observers)s.handleChange(this,void 0)}}_beginUpdate(){if(this._updateCounter++,this._updateCounter===1)for(const e of this._observers)e.beginUpdate(this)}_endUpdate(){if(this._updateCounter--,this._updateCounter===0){this._update();const e=[...this._observers];for(const t of e)t.endUpdate(this)}}addObserver(e){const t=!this._observers.has(e)&&this._updateCounter>0;super.addObserver(e),t&&e.beginUpdate(this)}removeObserver(e){const t=this._observers.has(e)&&this._updateCounter>0;super.removeObserver(e),t&&e.endUpdate(this)}set(e,t,s){if(s===void 0&&this._equalityComparator(this._value,e))return;let o;t||(t=o=new TransactionImpl(()=>{},()=>`Setting ${this.debugName}`));try{if(this._isUpToDate=!1,this._setValue(e),s!==void 0&&this._deltas.push(s),t.updateObserver({beginUpdate:()=>this._beginUpdate(),endUpdate:()=>this._endUpdate(),handleChange:(r,l)=>{},handlePossibleChange:r=>{}},this),this._updateCounter>1)for(const r of this._observers)r.handlePossibleChange(this)}finally{o&&o.finish()}}toString(){return`${this.debugName}: ${this._value}`}_setValue(e){this._value=e}}function observableValueOpts(a,e,t=DebugLocation.ofCaller()){return a.lazy?new LazyObservableValue(new DebugNameData(a.owner,a.debugName,void 0),e,a.equalsFn??strictEquals,t):new ObservableValue(new DebugNameData(a.owner,a.debugName,void 0),e,a.equalsFn??strictEquals,t)}function autorunStateToString(a){switch(a){case 1:return"dependenciesMightHaveChanged";case 2:return"stale";case 3:return"upToDate";default:return"<unknown>"}}class AutorunObserver{get debugName(){return this._debugNameData.getDebugName(this)??"(anonymous)"}constructor(e,t,s,o){var r,l;this._debugNameData=e,this._runFn=t,this._changeTracker=s,this._state=2,this._updateCount=0,this._disposed=!1,this._dependencies=new Set,this._dependenciesToBeRemoved=new Set,this._isRunning=!1,this._store=void 0,this._delayedStore=void 0,this._changeSummary=(r=this._changeTracker)==null?void 0:r.createChangeSummary(void 0),(l=getLogger())==null||l.handleAutorunCreated(this,o),this._run()}dispose(){var e;if(!this._disposed){this._disposed=!0;for(const t of this._dependencies)t.removeObserver(this);this._dependencies.clear(),this._store!==void 0&&this._store.dispose(),this._delayedStore!==void 0&&this._delayedStore.dispose(),(e=getLogger())==null||e.handleAutorunDisposed(this)}}_run(){var t,s,o,r;const e=this._dependenciesToBeRemoved;this._dependenciesToBeRemoved=this._dependencies,this._dependencies=e,this._state=3;try{if(!this._disposed){(t=getLogger())==null||t.handleAutorunStarted(this);const l=this._changeSummary,c=this._delayedStore;c!==void 0&&(this._delayedStore=void 0);try{this._isRunning=!0,this._changeTracker&&((o=(s=this._changeTracker).beforeUpdate)==null||o.call(s,this,l),this._changeSummary=this._changeTracker.createChangeSummary(l)),this._store!==void 0&&(this._store.dispose(),this._store=void 0),this._runFn(this,l)}catch(d){onBugIndicatingError(d)}finally{this._isRunning=!1,c!==void 0&&c.dispose()}}}finally{this._disposed||(r=getLogger())==null||r.handleAutorunFinished(this);for(const l of this._dependenciesToBeRemoved)l.removeObserver(this);this._dependenciesToBeRemoved.clear()}}toString(){return`Autorun<${this.debugName}>`}beginUpdate(e){this._state===3&&(this._state=1),this._updateCount++}endUpdate(e){try{if(this._updateCount===1)do{if(this._state===1){this._state=3;for(const t of this._dependencies)if(t.reportChanges(),this._state===2)break}this._state!==3&&this._run()}while(this._state!==3)}finally{this._updateCount--}assertFn(()=>this._updateCount>=0)}handlePossibleChange(e){this._state===3&&this._isDependency(e)&&(this._state=1)}handleChange(e,t){var s;if(this._isDependency(e)){(s=getLogger())==null||s.handleAutorunDependencyChanged(this,e,t);try{(this._changeTracker?this._changeTracker.handleChange({changedObservable:e,change:t,didChange:r=>r===e},this._changeSummary):!0)&&(this._state=2)}catch(o){onBugIndicatingError(o)}}}_isDependency(e){return this._dependencies.has(e)&&!this._dependenciesToBeRemoved.has(e)}_ensureNoRunning(){if(!this._isRunning)throw new BugIndicatingError("The reader object cannot be used outside its compute function!")}readObservable(e){if(this._ensureNoRunning(),this._disposed)return e.get();e.addObserver(this);const t=e.get();return this._dependencies.add(e),this._dependenciesToBeRemoved.delete(e),t}get store(){if(this._ensureNoRunning(),this._disposed)throw new BugIndicatingError("Cannot access store after dispose");return this._store===void 0&&(this._store=new DisposableStore),this._store}debugGetState(){return{isRunning:this._isRunning,updateCount:this._updateCount,dependencies:this._dependencies,state:this._state,stateStr:autorunStateToString(this._state)}}debugRerun(){this._isRunning?this._state=2:this._run()}}function autorun(a,e=DebugLocation.ofCaller()){return new AutorunObserver(new DebugNameData(void 0,void 0,a),a,void 0,e)}function autorunOpts(a,e,t=DebugLocation.ofCaller()){return new AutorunObserver(new DebugNameData(a.owner,a.debugName,a.debugReferenceFn??e),e,void 0,t)}function autorunHandleChanges(a,e,t=DebugLocation.ofCaller()){return new AutorunObserver(new DebugNameData(a.owner,a.debugName,a.debugReferenceFn??e),e,a.changeTracker,t)}function autorunWithStoreHandleChanges(a,e){const t=new DisposableStore,s=autorunHandleChanges({owner:a.owner,debugName:a.debugName,debugReferenceFn:a.debugReferenceFn??e,changeTracker:a.changeTracker},(o,r)=>{t.clear(),e(o,r,t)});return toDisposable(()=>{s.dispose(),t.dispose()})}function autorunWithStore(a){const e=new DisposableStore,t=autorunOpts({owner:void 0,debugName:void 0,debugReferenceFn:a},s=>{e.clear(),a(s,e)});return toDisposable(()=>{t.dispose(),e.dispose()})}function autorunDelta(a,e){let t;return autorunOpts({debugReferenceFn:e},s=>{const o=a.read(s),r=t;t=o,e({lastValue:r,newValue:o})})}function derivedStateToString(a){switch(a){case 0:return"initial";case 1:return"dependenciesMightHaveChanged";case 2:return"stale";case 3:return"upToDate";default:return"<unknown>"}}class Derived extends BaseObservable{get debugName(){return this._debugNameData.getDebugName(this)??"(anonymous)"}constructor(e,t,s,o=void 0,r,l){var c;super(l),this._debugNameData=e,this._computeFn=t,this._changeTracker=s,this._handleLastObserverRemoved=o,this._equalityComparator=r,this._state=0,this._value=void 0,this._updateCount=0,this._dependencies=new Set,this._dependenciesToBeRemoved=new Set,this._changeSummary=void 0,this._isUpdating=!1,this._isComputing=!1,this._didReportChange=!1,this._isInBeforeUpdate=!1,this._isReaderValid=!1,this._store=void 0,this._delayedStore=void 0,this._removedObserverToCallEndUpdateOn=null,this._changeSummary=(c=this._changeTracker)==null?void 0:c.createChangeSummary(void 0)}onLastObserverRemoved(){var e,t;this._state=0,this._value=void 0,(e=getLogger())==null||e.handleDerivedCleared(this);for(const s of this._dependencies)s.removeObserver(this);this._dependencies.clear(),this._store!==void 0&&(this._store.dispose(),this._store=void 0),this._delayedStore!==void 0&&(this._delayedStore.dispose(),this._delayedStore=void 0),(t=this._handleLastObserverRemoved)==null||t.call(this)}get(){var t,s;if(this._isComputing,this._observers.size===0){let o;try{this._isReaderValid=!0;let r;this._changeTracker&&(r=this._changeTracker.createChangeSummary(void 0),(s=(t=this._changeTracker).beforeUpdate)==null||s.call(t,this,r)),o=this._computeFn(this,r)}finally{this._isReaderValid=!1}return this.onLastObserverRemoved(),o}else{do{if(this._state===1){for(const o of this._dependencies)if(o.reportChanges(),this._state===2)break}this._state===1&&(this._state=3),this._state!==3&&this._recompute()}while(this._state!==3);return this._value}}_recompute(){var s,o,r,l;let e=!1;this._isComputing=!0,this._didReportChange=!1;const t=this._dependenciesToBeRemoved;this._dependenciesToBeRemoved=this._dependencies,this._dependencies=t;try{const c=this._changeSummary;this._isReaderValid=!0,this._changeTracker&&(this._isInBeforeUpdate=!0,(o=(s=this._changeTracker).beforeUpdate)==null||o.call(s,this,c),this._isInBeforeUpdate=!1,this._changeSummary=(r=this._changeTracker)==null?void 0:r.createChangeSummary(c));const d=this._state!==0,u=this._value;this._state=3;const g=this._delayedStore;g!==void 0&&(this._delayedStore=void 0);try{this._store!==void 0&&(this._store.dispose(),this._store=void 0),this._value=this._computeFn(this,c)}finally{this._isReaderValid=!1;for(const f of this._dependenciesToBeRemoved)f.removeObserver(this);this._dependenciesToBeRemoved.clear(),g!==void 0&&g.dispose()}e=this._didReportChange||d&&!this._equalityComparator(u,this._value),(l=getLogger())==null||l.handleObservableUpdated(this,{oldValue:u,newValue:this._value,change:void 0,didChange:e,hadValue:d})}catch(c){onBugIndicatingError(c)}if(this._isComputing=!1,!this._didReportChange&&e)for(const c of this._observers)c.handleChange(this,void 0);else this._didReportChange=!1}toString(){return`LazyDerived<${this.debugName}>`}beginUpdate(e){if(this._isUpdating)throw new BugIndicatingError("Cyclic deriveds are not supported yet!");this._updateCount++,this._isUpdating=!0;try{const t=this._updateCount===1;if(this._state===3&&(this._state=1,!t))for(const s of this._observers)s.handlePossibleChange(this);if(t)for(const s of this._observers)s.beginUpdate(this)}finally{this._isUpdating=!1}}endUpdate(e){if(this._updateCount--,this._updateCount===0){const t=[...this._observers];for(const s of t)s.endUpdate(this);if(this._removedObserverToCallEndUpdateOn){const s=[...this._removedObserverToCallEndUpdateOn];this._removedObserverToCallEndUpdateOn=null;for(const o of s)o.endUpdate(this)}}assertFn(()=>this._updateCount>=0)}handlePossibleChange(e){if(this._state===3&&this._dependencies.has(e)&&!this._dependenciesToBeRemoved.has(e)){this._state=1;for(const t of this._observers)t.handlePossibleChange(this)}}handleChange(e,t){var s;if(this._dependencies.has(e)&&!this._dependenciesToBeRemoved.has(e)||this._isInBeforeUpdate){(s=getLogger())==null||s.handleDerivedDependencyChanged(this,e,t);let o=!1;try{o=this._changeTracker?this._changeTracker.handleChange({changedObservable:e,change:t,didChange:l=>l===e},this._changeSummary):!0}catch(l){onBugIndicatingError(l)}const r=this._state===3;if(o&&(this._state===1||r)&&(this._state=2,r))for(const l of this._observers)l.handlePossibleChange(this)}}_ensureReaderValid(){if(!this._isReaderValid)throw new BugIndicatingError("The reader object cannot be used outside its compute function!")}readObservable(e){this._ensureReaderValid(),e.addObserver(this);const t=e.get();return this._dependencies.add(e),this._dependenciesToBeRemoved.delete(e),t}get store(){return this._ensureReaderValid(),this._store===void 0&&(this._store=new DisposableStore),this._store}addObserver(e){const t=!this._observers.has(e)&&this._updateCount>0;super.addObserver(e),t&&(this._removedObserverToCallEndUpdateOn&&this._removedObserverToCallEndUpdateOn.has(e)?this._removedObserverToCallEndUpdateOn.delete(e):e.beginUpdate(this))}removeObserver(e){this._observers.has(e)&&this._updateCount>0&&(this._removedObserverToCallEndUpdateOn||(this._removedObserverToCallEndUpdateOn=new Set),this._removedObserverToCallEndUpdateOn.add(e)),super.removeObserver(e)}debugGetState(){return{state:this._state,stateStr:derivedStateToString(this._state),updateCount:this._updateCount,isComputing:this._isComputing,dependencies:this._dependencies,value:this._value}}debugSetValue(e){this._value=e}debugRecompute(){this._isComputing?this._state=2:this._recompute()}setValue(e,t,s){this._value=e;const o=this._observers;t.updateObserver(this,this);for(const r of o)r.handleChange(this,s)}}class DerivedWithSetter extends Derived{constructor(e,t,s,o=void 0,r,l,c){super(e,t,s,o,r,c),this.set=l}}function derived(a,e,t=DebugLocation.ofCaller()){return e!==void 0?new Derived(new DebugNameData(a,void 0,e),e,void 0,void 0,strictEquals,t):new Derived(new DebugNameData(void 0,void 0,a),a,void 0,void 0,strictEquals,t)}function derivedWithSetter(a,e,t,s=DebugLocation.ofCaller()){return new DerivedWithSetter(new DebugNameData(a,void 0,e),e,void 0,void 0,strictEquals,t,s)}function derivedOpts(a,e,t=DebugLocation.ofCaller()){return new Derived(new DebugNameData(a.owner,a.debugName,a.debugReferenceFn),e,void 0,a.onLastObserverRemoved,a.equalsFn??strictEquals,t)}_setDerivedOpts(derivedOpts);function derivedHandleChanges(a,e,t=DebugLocation.ofCaller()){return new Derived(new DebugNameData(a.owner,a.debugName,void 0),e,a.changeTracker,void 0,a.equalityComparer??strictEquals,t)}function derivedDisposable(a,e,t=DebugLocation.ofCaller()){let s,o;e===void 0?(s=a,o=void 0):(o=a,s=e);let r;return new Derived(new DebugNameData(o,void 0,s),l=>{r?r.clear():r=new DisposableStore;const c=s(l);return c&&r.add(c),c},void 0,()=>{r&&(r.dispose(),r=void 0)},strictEquals,t)}class ObservablePromise{constructor(e){this._value=observableValue(this,void 0),this.promiseResult=this._value,this.promise=e.then(t=>(transaction(s=>{this._value.set(new PromiseResult(t,void 0),s)}),t),t=>{throw transaction(s=>{this._value.set(new PromiseResult(void 0,t),s)}),t})}}class PromiseResult{constructor(e,t){this.data=e,this.error=t}getDataOrThrow(){if(this.error)throw this.error;return this.data}}function waitForState(a,e,t,s){return e||(e=o=>o!=null),new Promise((o,r)=>{let l=!0,c=!1;const d=a.map(g=>({isFinished:e(g),error:t?t(g):!1,state:g})),u=autorun(g=>{const{isFinished:f,error:p,state:m}=d.read(g);(f||p)&&(l?c=!0:u.dispose(),p?r(p===!0?m:p):o(m))});if(s){const g=s.onCancellationRequested(()=>{u.dispose(),g.dispose(),r(new CancellationError)});if(s.isCancellationRequested){u.dispose(),g.dispose(),r(new CancellationError);return}}l=!1,c&&u.dispose()})}function observableFromEvent(...a){let e,t,s,o;return a.length===2?[t,s]=a:[e,t,s,o]=a,new FromEventObservable(new DebugNameData(e,void 0,s),t,s,()=>FromEventObservable.globalTransaction,strictEquals,o??DebugLocation.ofCaller())}function observableFromEventOpts(a,e,t,s=DebugLocation.ofCaller()){return new FromEventObservable(new DebugNameData(a.owner,a.debugName,a.debugReferenceFn??t),e,t,()=>FromEventObservable.globalTransaction,a.equalsFn??strictEquals,s)}class FromEventObservable extends BaseObservable{constructor(e,t,s,o,r,l){super(l),this._debugNameData=e,this.event=t,this._getValue=s,this._getTransaction=o,this._equalityComparator=r,this._hasValue=!1,this.handleEvent=c=>{var p;const d=this._getValue(c),u=this._value,g=!this._hasValue||!this._equalityComparator(u,d);let f=!1;g&&(this._value=d,this._hasValue&&(f=!0,subtransaction(this._getTransaction(),m=>{var _;(_=getLogger())==null||_.handleObservableUpdated(this,{oldValue:u,newValue:d,change:void 0,didChange:g,hadValue:this._hasValue});for(const C of this._observers)m.updateObserver(C,this),C.handleChange(this,void 0)},()=>{const m=this.getDebugName();return"Event fired"+(m?`: ${m}`:"")})),this._hasValue=!0),f||(p=getLogger())==null||p.handleObservableUpdated(this,{oldValue:u,newValue:d,change:void 0,didChange:g,hadValue:this._hasValue})}}getDebugName(){return this._debugNameData.getDebugName(this)}get debugName(){const e=this.getDebugName();return"From Event"+(e?`: ${e}`:"")}onFirstObserverAdded(){this._subscription=this.event(this.handleEvent)}onLastObserverRemoved(){this._subscription.dispose(),this._subscription=void 0,this._hasValue=!1,this._value=void 0}get(){return this._subscription?(this._hasValue||this.handleEvent(void 0),this._value):this._getValue(void 0)}debugSetValue(e){this._value=e}debugGetState(){return{value:this._value,hasValue:this._hasValue}}}(function(a){a.Observer=FromEventObservable;function e(t,s){let o=!1;FromEventObservable.globalTransaction===void 0&&(FromEventObservable.globalTransaction=t,o=!0);try{s()}finally{o&&(FromEventObservable.globalTransaction=void 0)}}a.batchEventsGlobally=e})(observableFromEvent||(observableFromEvent={}));function observableSignal(a,e=DebugLocation.ofCaller()){return typeof a=="string"?new ObservableSignal(a,void 0,e):new ObservableSignal(void 0,a,e)}class ObservableSignal extends BaseObservable{get debugName(){return new DebugNameData(this._owner,this._debugName,void 0).getDebugName(this)??"Observable Signal"}toString(){return this.debugName}constructor(e,t,s){super(s),this._debugName=e,this._owner=t}trigger(e,t){if(!e){transaction(s=>{this.trigger(s,t)},()=>`Trigger signal ${this.debugName}`);return}for(const s of this._observers)e.updateObserver(s,this),s.handleChange(this,t)}get(){}}function debouncedObservable(a,e){let t=!1,s,o;return observableFromEvent(r=>{const l=autorun(c=>{const d=a.read(c);t?(o&&clearTimeout(o),o=setTimeout(()=>{s=d,r()},e)):(t=!0,s=d)});return{dispose(){l.dispose(),t=!1,s=void 0}}},()=>t?s:a.get())}function recomputeInitiallyAndOnChange(a,e){const t=new KeepAliveObserver(!0,e);a.addObserver(t);try{t.beginUpdate(a)}finally{t.endUpdate(a)}return toDisposable(()=>{a.removeObserver(t)})}_setRecomputeInitiallyAndOnChange(recomputeInitiallyAndOnChange);class KeepAliveObserver{constructor(e,t){this._forceRecompute=e,this._handleValue=t,this._counter=0}beginUpdate(e){this._counter++}endUpdate(e){this._counter===1&&this._forceRecompute&&(this._handleValue?this._handleValue(e.get()):e.reportChanges()),this._counter--}handlePossibleChange(e){}handleChange(e,t){}}function derivedObservableWithCache(a,e){let t;return derivedOpts({owner:a,debugReferenceFn:e},o=>(t=e(o,t),t))}function mapObservableArrayCached(a,e,t,s){let o=new ArrayMap$1(t,s);return derivedOpts({debugReferenceFn:t,owner:a,onLastObserverRemoved:()=>{o.dispose(),o=new ArrayMap$1(t)}},l=>(o.setItems(e.read(l)),o.getItems()))}let ArrayMap$1=class{constructor(e,t){this._map=e,this._keySelector=t,this._cache=new Map,this._items=[]}dispose(){this._cache.forEach(e=>e.store.dispose()),this._cache.clear()}setItems(e){const t=[],s=new Set(this._cache.keys());for(const o of e){const r=this._keySelector?this._keySelector(o):o;let l=this._cache.get(r);if(l)s.delete(r);else{const c=new DisposableStore;l={out:this._map(o,c),store:c},this._cache.set(r,l)}t.push(l.out)}for(const o of s)this._cache.get(o).store.dispose(),this._cache.delete(o);this._items=t}getItems(){return this._items}};function recordChanges(a){return{createChangeSummary:e=>({changes:[]}),handleChange(e,t){for(const s in a)e.didChange(a[s])&&t.changes.push({key:s,change:e.change});return!0},beforeUpdate(e,t){for(const s in a){if(s==="changes")throw new BugIndicatingError('property name "changes" is reserved for change tracking');t[s]=a[s].read(e)}}}}function recordChangesLazy(a){let e;return{createChangeSummary:t=>({changes:[]}),handleChange(t,s){e||(e=a());for(const o in e)t.didChange(e[o])&&s.changes.push({key:o,change:t.change});return!0},beforeUpdate(t,s){e||(e=a());for(const o in e){if(o==="changes")throw new BugIndicatingError('property name "changes" is reserved for change tracking');s[o]=e[o].read(t)}}}}function constObservable(a){return new ConstObservable(a)}class ConstObservable extends ConvenientObservable{constructor(e){super(),this.value=e}get debugName(){return this.toString()}get(){return this.value}addObserver(e){}removeObserver(e){}toString(){return`Const: ${this.value}`}}function observableSignalFromEvent(a,e,t=DebugLocation.ofCaller()){return new FromEventObservableSignal(typeof a=="string"?a:new DebugNameData(a,void 0,void 0),e,t)}class FromEventObservableSignal extends BaseObservable{constructor(e,t,s){super(s),this.event=t,this.handleEvent=()=>{transaction(o=>{for(const r of this._observers)o.updateObserver(r,this),r.handleChange(this,void 0)},()=>this.debugName)},this.debugName=typeof e=="string"?e:e.getDebugName(this)??"Observable Signal From Event"}onFirstObserverAdded(){this.subscription=this.event(this.handleEvent)}onLastObserverRemoved(){this.subscription.dispose(),this.subscription=void 0}get(){}}function runOnChange(a,e){let t,s=!0;return autorunWithStoreHandleChanges({changeTracker:{createChangeSummary:()=>({deltas:[],didChange:!1}),handleChange:(o,r)=>{if(o.didChange(a)){const l=o.change;l!==void 0&&r.deltas.push(l),r.didChange=!0}return!0}}},(o,r)=>{const l=a.read(o),c=t;r.didChange&&(t=l,e(l,c,r.deltas)),s&&(s=!1,t=l)})}function runOnChangeWithStore(a,e){const t=new DisposableStore,s=runOnChange(a,(o,r,l)=>{t.clear(),e(o,r,l,t)});return{dispose(){s.dispose(),t.dispose()}}}function runOnChangeWithCancellationToken(a,e){return runOnChangeWithStore(a,(t,s,o,r)=>{e(t,s,o,cancelOnDispose(r))})}function derivedConstOnceDefined(a,e){return derivedObservableWithCache(a,(t,s)=>s??e(t))}function formatValue(a,e){switch(typeof a){case"number":return""+a;case"string":return a.length+2<=e?`"${a}"`:`"${a.substr(0,e-7)}"+...`;case"boolean":return a?"true":"false";case"undefined":return"undefined";case"object":return a===null?"null":Array.isArray(a)?formatArray(a,e):formatObject(a,e);case"symbol":return a.toString();case"function":return`[[Function${a.name?" "+a.name:""}]]`;default:return""+a}}function formatArray(a,e){let t="[ ",s=!0;for(const o of a){if(s||(t+=", "),t.length-5>e){t+="...";break}s=!1,t+=`${formatValue(o,e-t.length)}`}return t+=" ]",t}function formatObject(a,e){if(typeof a.toString=="function"&&a.toString!==Object.prototype.toString){const r=a.toString();return r.length<=e?r:r.substring(0,e-3)+"..."}const t=getClassName$1(a);let s=t?t+"(":"{ ",o=!0;for(const[r,l]of Object.entries(a)){if(o||(s+=", "),s.length-5>e){s+="...";break}o=!1,s+=`${r}: ${formatValue(l,e-s.length)}`}return s+=t?")":" }",s}class SimpleTypedRpcConnection{static createClient(e,t){return new SimpleTypedRpcConnection(e,t)}constructor(e,t){this._channelFactory=e,this._getHandler=t,this._channel=this._channelFactory({handleNotification:r=>{const l=r,c=this._getHandler().notifications[l[0]];if(!c)throw new Error(`Unknown notification "${l[0]}"!`);c(...l[1])},handleRequest:r=>{const l=r;try{return{type:"result",value:this._getHandler().requests[l[0]](...l[1])}}catch(c){return{type:"error",value:c}}}});const s=new Proxy({},{get:(r,l)=>async(...c)=>{const d=await this._channel.sendRequest([l,c]);if(d.type==="error")throw d.value;return d.value}}),o=new Proxy({},{get:(r,l)=>(...c)=>{this._channel.sendNotification([l,c])}});this.api={notifications:o,requests:s}}}function registerDebugChannel(a,e){const t=globalThis;let s=[],o;const{channel:r,handler:l}=createChannelFactoryFromDebugChannel({sendNotification:d=>{o?o.sendNotification(d):s.push(d)}});let c;return(t.$$debugValueEditor_debugChannels??(t.$$debugValueEditor_debugChannels={}))[a]=d=>{c=e(),o=d;for(const u of s)d.sendNotification(u);return s=[],l},SimpleTypedRpcConnection.createClient(r,()=>{if(!c)throw new Error("Not supported");return c})}function createChannelFactoryFromDebugChannel(a){let e;return{channel:s=>(e=s,{sendNotification:o=>{a.sendNotification(o)},sendRequest:o=>{throw new Error("not supported")}}),handler:{handleRequest:s=>s.type==="notification"?e==null?void 0:e.handleNotification(s.data):e==null?void 0:e.handleRequest(s.data)}}}class Throttler{constructor(){this._timeout=void 0}throttle(e,t){this._timeout===void 0&&(this._timeout=setTimeout(()=>{this._timeout=void 0,e()},t))}dispose(){this._timeout!==void 0&&clearTimeout(this._timeout)}}function deepAssign(a,e){for(const t in e)a[t]&&typeof a[t]=="object"&&e[t]&&typeof e[t]=="object"?deepAssign(a[t],e[t]):a[t]=e[t]}function deepAssignDeleteNulls(a,e){for(const t in e)e[t]===null?delete a[t]:a[t]&&typeof a[t]=="object"&&e[t]&&typeof e[t]=="object"?deepAssignDeleteNulls(a[t],e[t]):a[t]=e[t]}const Ct=class Ct{static getInstance(){return Ct._instance===void 0&&(Ct._instance=new Ct),Ct._instance}getTransactionState(){const e=[],t=[...this._activeTransactions];if(t.length===0)return;const s=t.flatMap(r=>r.debugGetUpdatingObservers()??[]).map(r=>r.observer),o=new Set;for(;s.length>0;){const r=s.shift();if(o.has(r))continue;o.add(r);const l=this._getInfo(r,c=>{o.has(c)||s.push(c)});l&&e.push(l)}return{names:t.map(r=>r.getDebugName()??"tx"),affected:e}}_getObservableInfo(e){const t=this._instanceInfos.get(e);if(!t){onUnexpectedError(new BugIndicatingError("No info found"));return}return t}_getAutorunInfo(e){const t=this._instanceInfos.get(e);if(!t){onUnexpectedError(new BugIndicatingError("No info found"));return}return t}_getInfo(e,t){if(e instanceof Derived){const s=[...e.debugGetObservers()];for(const d of s)t(d);const o=this._getObservableInfo(e);if(!o)return;const r=e.debugGetState(),l={name:e.debugName,instanceId:o.instanceId,updateCount:r.updateCount},c=[...o.changedObservables].map(d=>{var u;return(u=this._instanceInfos.get(d))==null?void 0:u.instanceId}).filter(isDefined);if(r.isComputing)return{...l,type:"observable/derived",state:"updating",changedDependencies:c,initialComputation:!1};switch(r.state){case 0:return{...l,type:"observable/derived",state:"noValue"};case 3:return{...l,type:"observable/derived",state:"upToDate"};case 2:return{...l,type:"observable/derived",state:"stale",changedDependencies:c};case 1:return{...l,type:"observable/derived",state:"possiblyStale"}}}else if(e instanceof AutorunObserver){const s=this._getAutorunInfo(e);if(!s)return;const o={name:e.debugName,instanceId:s.instanceId,updateCount:s.updateCount},r=[...s.changedObservables].map(l=>this._instanceInfos.get(l).instanceId);if(e.debugGetState().isRunning)return{...o,type:"autorun",state:"updating",changedDependencies:r};switch(e.debugGetState().state){case 3:return{...o,type:"autorun",state:"upToDate"};case 2:return{...o,type:"autorun",state:"stale",changedDependencies:r};case 1:return{...o,type:"autorun",state:"possiblyStale"}}}}_formatObservable(e){const t=this._getObservableInfo(e);if(t)return{name:e.debugName,instanceId:t.instanceId}}_formatObserver(e){var s;if(e instanceof Derived)return{name:e.toString(),instanceId:(s=this._getObservableInfo(e))==null?void 0:s.instanceId};const t=this._getAutorunInfo(e);if(t)return{name:e.toString(),instanceId:t.instanceId}}constructor(){this._declarationId=0,this._instanceId=0,this._declarations=new Map,this._instanceInfos=new WeakMap,this._aliveInstances=new Map,this._activeTransactions=new Set,this._channel=registerDebugChannel("observableDevTools",()=>({notifications:{setDeclarationIdFilter:e=>{},logObservableValue:e=>{console.log("logObservableValue",e)},flushUpdates:()=>{this._flushUpdates()},resetUpdates:()=>{this._pendingChanges=null,this._channel.api.notifications.handleChange(this._fullState,!0)}},requests:{getDeclarations:()=>{const e={};for(const t of this._declarations.values())e[t.id]=t;return{decls:e}},getSummarizedInstances:()=>null,getObservableValueInfo:e=>({observers:[...this._aliveInstances.get(e).debugGetObservers()].map(s=>this._formatObserver(s)).filter(isDefined)}),getDerivedInfo:e=>{const t=this._aliveInstances.get(e);return{dependencies:[...t.debugGetState().dependencies].map(s=>this._formatObservable(s)).filter(isDefined),observers:[...t.debugGetObservers()].map(s=>this._formatObserver(s)).filter(isDefined)}},getAutorunInfo:e=>({dependencies:[...this._aliveInstances.get(e).debugGetState().dependencies].map(s=>this._formatObservable(s)).filter(isDefined)}),getTransactionState:()=>this.getTransactionState(),setValue:(e,t)=>{const s=this._aliveInstances.get(e);if(s instanceof Derived)s.debugSetValue(t);else if(s instanceof ObservableValue)s.debugSetValue(t);else if(s instanceof FromEventObservable)s.debugSetValue(t);else throw new BugIndicatingError("Observable is not supported");const o=[...s.debugGetObservers()];for(const r of o)r.beginUpdate(s);for(const r of o)r.handleChange(s,void 0);for(const r of o)r.endUpdate(s)},getValue:e=>{const t=this._aliveInstances.get(e);if(t instanceof Derived)return formatValue(t.debugGetState().value,200);if(t instanceof ObservableValue)return formatValue(t.debugGetState().value,200)},logValue:e=>{const t=this._aliveInstances.get(e);if(t&&"get"in t)console.log("Logged Value:",t.get());else throw new BugIndicatingError("Observable is not supported")},rerun:e=>{const t=this._aliveInstances.get(e);if(t instanceof Derived)t.debugRecompute();else if(t instanceof AutorunObserver)t.debugRerun();else throw new BugIndicatingError("Observable is not supported")}}})),this._pendingChanges=null,this._changeThrottler=new Throttler,this._fullState={},this._flushUpdates=()=>{this._pendingChanges!==null&&(this._channel.api.notifications.handleChange(this._pendingChanges,!1),this._pendingChanges=null)},DebugLocation.enable()}_handleChange(e){deepAssignDeleteNulls(this._fullState,e),this._pendingChanges===null?this._pendingChanges=e:deepAssign(this._pendingChanges,e),this._changeThrottler.throttle(this._flushUpdates,10)}_getDeclarationId(e,t){if(!t)return-1;let s=this._declarations.get(t.id);return s===void 0&&(s={id:this._declarationId++,type:e,url:t.fileName,line:t.line,column:t.column},this._declarations.set(t.id,s),this._handleChange({decls:{[s.id]:s}})),s.id}handleObservableCreated(e,t){const o={declarationId:this._getDeclarationId("observable/value",t),instanceId:this._instanceId++,listenerCount:0,lastValue:void 0,updateCount:0,changedObservables:new Set};this._instanceInfos.set(e,o)}handleOnListenerCountChanged(e,t){const s=this._getObservableInfo(e);if(s){if(s.listenerCount===0&&t>0){const o=e instanceof Derived?"observable/derived":"observable/value";this._aliveInstances.set(s.instanceId,e),this._handleChange({instances:{[s.instanceId]:{instanceId:s.instanceId,declarationId:s.declarationId,formattedValue:s.lastValue,type:o,name:e.debugName}}})}else s.listenerCount>0&&t===0&&(this._handleChange({instances:{[s.instanceId]:null}}),this._aliveInstances.delete(s.instanceId));s.listenerCount=t}}handleObservableUpdated(e,t){if(e instanceof Derived){this._handleDerivedRecomputed(e,t);return}const s=this._getObservableInfo(e);s&&t.didChange&&(s.lastValue=formatValue(t.newValue,30),s.listenerCount>0&&this._handleChange({instances:{[s.instanceId]:{formattedValue:s.lastValue}}}))}handleAutorunCreated(e,t){const o={declarationId:this._getDeclarationId("autorun",t),instanceId:this._instanceId++,updateCount:0,changedObservables:new Set};this._instanceInfos.set(e,o),this._aliveInstances.set(o.instanceId,e),o&&this._handleChange({instances:{[o.instanceId]:{instanceId:o.instanceId,declarationId:o.declarationId,runCount:0,type:"autorun",name:e.debugName}}})}handleAutorunDisposed(e){const t=this._getAutorunInfo(e);t&&(this._handleChange({instances:{[t.instanceId]:null}}),this._instanceInfos.delete(e),this._aliveInstances.delete(t.instanceId))}handleAutorunDependencyChanged(e,t,s){const o=this._getAutorunInfo(e);o&&o.changedObservables.add(t)}handleAutorunStarted(e){}handleAutorunFinished(e){const t=this._getAutorunInfo(e);t&&(t.changedObservables.clear(),t.updateCount++,this._handleChange({instances:{[t.instanceId]:{runCount:t.updateCount}}}))}handleDerivedDependencyChanged(e,t,s){const o=this._getObservableInfo(e);o&&o.changedObservables.add(t)}_handleDerivedRecomputed(e,t){const s=this._getObservableInfo(e);if(!s)return;const o=formatValue(t.newValue,30);s.updateCount++,s.changedObservables.clear(),s.lastValue=o,s.listenerCount>0&&this._handleChange({instances:{[s.instanceId]:{formattedValue:o,recomputationCount:s.updateCount}}})}handleDerivedCleared(e){const t=this._getObservableInfo(e);t&&(t.lastValue=void 0,t.changedObservables.clear(),t.listenerCount>0&&this._handleChange({instances:{[t.instanceId]:{formattedValue:void 0}}}))}handleBeginTransaction(e){this._activeTransactions.add(e)}handleEndTransaction(e){this._activeTransactions.delete(e)}};Ct._instance=void 0;let DevToolsLogger=Ct;env&&env.VSCODE_DEV_DEBUG_OBSERVABLES&&addLogger(DevToolsLogger.getInstance());const{registerWindow,getWindow,getDocument,getWindows,getWindowsCount,getWindowId,getWindowById,hasWindow,onDidRegisterWindow,onWillUnregisterWindow,onDidUnregisterWindow}=function(){const a=new Map;ensureCodeWindow(mainWindow,1);const e={window:mainWindow,disposables:new DisposableStore};a.set(mainWindow.vscodeWindowId,e);const t=new Emitter$1,s=new Emitter$1,o=new Emitter$1;function r(l,c){return(typeof l=="number"?a.get(l):void 0)??(c?e:void 0)}return{onDidRegisterWindow:t.event,onWillUnregisterWindow:o.event,onDidUnregisterWindow:s.event,registerWindow(l){if(a.has(l.vscodeWindowId))return Disposable.None;const c=new DisposableStore,d={window:l,disposables:c.add(new DisposableStore)};return a.set(l.vscodeWindowId,d),c.add(toDisposable(()=>{a.delete(l.vscodeWindowId),s.fire(l)})),c.add(addDisposableListener(l,EventType$1.BEFORE_UNLOAD,()=>{o.fire(l)})),t.fire(d),c},getWindows(){return a.values()},getWindowsCount(){return a.size},getWindowId(l){return l.vscodeWindowId},hasWindow(l){return a.has(l)},getWindowById:r,getWindow(l){var u;const c=l;if((u=c==null?void 0:c.ownerDocument)!=null&&u.defaultView)return c.ownerDocument.defaultView.window;const d=l;return d!=null&&d.view?d.view.window:mainWindow},getDocument(l){return getWindow(l).document}}}();function clearNode(a){for(;a.firstChild;)a.firstChild.remove()}class DomListener{constructor(e,t,s,o){this._node=e,this._type=t,this._handler=s,this._options=o||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}}function addDisposableListener(a,e,t,s){return new DomListener(a,e,t,s)}function _wrapAsStandardMouseEvent(a,e){return function(t){return e(new StandardMouseEvent(a,t))}}function _wrapAsStandardKeyboardEvent(a){return function(e){return a(new StandardKeyboardEvent(e))}}const addStandardDisposableListener=function(e,t,s,o){let r=s;return t==="click"||t==="mousedown"||t==="contextmenu"?r=_wrapAsStandardMouseEvent(getWindow(e),s):(t==="keydown"||t==="keypress"||t==="keyup")&&(r=_wrapAsStandardKeyboardEvent(s)),addDisposableListener(e,t,r,o)},addStandardDisposableGenericMouseDownListener=function(e,t,s){const o=_wrapAsStandardMouseEvent(getWindow(e),t);return addDisposableGenericMouseDownListener(e,o,s)};function addDisposableGenericMouseDownListener(a,e,t){return addDisposableListener(a,isIOS&&BrowserFeatures.pointerEvents?EventType$1.POINTER_DOWN:EventType$1.MOUSE_DOWN,e,t)}function addDisposableGenericMouseMoveListener(a,e,t){return addDisposableListener(a,isIOS&&BrowserFeatures.pointerEvents?EventType$1.POINTER_MOVE:EventType$1.MOUSE_MOVE,e,t)}function addDisposableGenericMouseUpListener(a,e,t){return addDisposableListener(a,isIOS&&BrowserFeatures.pointerEvents?EventType$1.POINTER_UP:EventType$1.MOUSE_UP,e,t)}function runWhenWindowIdle(a,e,t){return _runWhenIdle(a,e,t)}class WindowIdleValue extends AbstractIdleValue{constructor(e,t){super(e,t)}}let runAtThisOrScheduleAtNextAnimationFrame,scheduleAtNextAnimationFrame;class WindowIntervalTimer extends IntervalTimer{constructor(e){super(),this.defaultTarget=e&&getWindow(e)}cancelAndSet(e,t,s){return super.cancelAndSet(e,t,s??this.defaultTarget)}}class AnimationFrameQueueItem{constructor(e,t=0){this._runner=e,this.priority=t,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(e){onUnexpectedError(e)}}static sort(e,t){return t.priority-e.priority}}(function(){const a=new Map,e=new Map,t=new Map,s=new Map,o=r=>{t.set(r,!1);const l=a.get(r)??[];for(e.set(r,l),a.set(r,[]),s.set(r,!0);l.length>0;)l.sort(AnimationFrameQueueItem.sort),l.shift().execute();s.set(r,!1)};scheduleAtNextAnimationFrame=(r,l,c=0)=>{const d=getWindowId(r),u=new AnimationFrameQueueItem(l,c);let g=a.get(d);return g||(g=[],a.set(d,g)),g.push(u),t.get(d)||(t.set(d,!0),r.requestAnimationFrame(()=>o(d))),u},runAtThisOrScheduleAtNextAnimationFrame=(r,l,c)=>{const d=getWindowId(r);if(s.get(d)){const u=new AnimationFrameQueueItem(l,c);let g=e.get(d);return g||(g=[],e.set(d,g)),g.push(u),u}else return scheduleAtNextAnimationFrame(r,l,c)}})();function getComputedStyle(a){return getWindow(a).getComputedStyle(a,null)}function getClientArea(a,e,t){const s=getWindow(a),o=s.document;if(a!==o.body)return new Dimension(a.clientWidth,a.clientHeight);if(isIOS&&(s!=null&&s.visualViewport))return new Dimension(s.visualViewport.width,s.visualViewport.height);if(s!=null&&s.innerWidth&&s.innerHeight)return new Dimension(s.innerWidth,s.innerHeight);if(o.body&&o.body.clientWidth&&o.body.clientHeight)return new Dimension(o.body.clientWidth,o.body.clientHeight);if(o.documentElement&&o.documentElement.clientWidth&&o.documentElement.clientHeight)return new Dimension(o.documentElement.clientWidth,o.documentElement.clientHeight);if(t)return getClientArea(t,e);if(e)return e;throw new Error("Unable to figure out browser width and height")}class SizeUtils{static convertToPixels(e,t){return parseFloat(t)||0}static getDimension(e,t){const s=getComputedStyle(e),o=s?s.getPropertyValue(t):"0";return SizeUtils.convertToPixels(e,o)}static getBorderLeftWidth(e){return SizeUtils.getDimension(e,"border-left-width")}static getBorderRightWidth(e){return SizeUtils.getDimension(e,"border-right-width")}static getBorderTopWidth(e){return SizeUtils.getDimension(e,"border-top-width")}static getBorderBottomWidth(e){return SizeUtils.getDimension(e,"border-bottom-width")}static getPaddingLeft(e){return SizeUtils.getDimension(e,"padding-left")}static getPaddingRight(e){return SizeUtils.getDimension(e,"padding-right")}static getPaddingTop(e){return SizeUtils.getDimension(e,"padding-top")}static getPaddingBottom(e){return SizeUtils.getDimension(e,"padding-bottom")}static getMarginLeft(e){return SizeUtils.getDimension(e,"margin-left")}static getMarginTop(e){return SizeUtils.getDimension(e,"margin-top")}static getMarginRight(e){return SizeUtils.getDimension(e,"margin-right")}static getMarginBottom(e){return SizeUtils.getDimension(e,"margin-bottom")}}const bt=class bt{constructor(e,t){this.width=e,this.height=t}with(e=this.width,t=this.height){return e!==this.width||t!==this.height?new bt(e,t):this}static is(e){return typeof e=="object"&&typeof e.height=="number"&&typeof e.width=="number"}static lift(e){return e instanceof bt?e:new bt(e.width,e.height)}static equals(e,t){return e===t?!0:!e||!t?!1:e.width===t.width&&e.height===t.height}};bt.None=new bt(0,0);let Dimension=bt;function getTopLeftOffset(a){let e=a.offsetParent,t=a.offsetTop,s=a.offsetLeft;for(;(a=a.parentNode)!==null&&a!==a.ownerDocument.body&&a!==a.ownerDocument.documentElement;){t-=a.scrollTop;const o=isShadowRoot(a)?null:getComputedStyle(a);o&&(s-=o.direction!=="rtl"?a.scrollLeft:-a.scrollLeft),a===e&&(s+=SizeUtils.getBorderLeftWidth(a),t+=SizeUtils.getBorderTopWidth(a),t+=a.offsetTop,s+=a.offsetLeft,e=a.offsetParent)}return{left:s,top:t}}function size(a,e,t){typeof e=="number"&&(a.style.width=`${e}px`),typeof t=="number"&&(a.style.height=`${t}px`)}function getDomNodePagePosition(a){const e=a.getBoundingClientRect(),t=getWindow(a);return{left:e.left+t.scrollX,top:e.top+t.scrollY,width:e.width,height:e.height}}function getDomNodeZoomLevel(a){let e=a,t=1;do{const s=getComputedStyle(e).zoom;s!=null&&s!=="1"&&(t*=s),e=e.parentElement}while(e!==null&&e!==e.ownerDocument.documentElement);return t}function getTotalWidth(a){const e=SizeUtils.getMarginLeft(a)+SizeUtils.getMarginRight(a);return a.offsetWidth+e}function getContentWidth(a){const e=SizeUtils.getBorderLeftWidth(a)+SizeUtils.getBorderRightWidth(a),t=SizeUtils.getPaddingLeft(a)+SizeUtils.getPaddingRight(a);return a.offsetWidth-e-t}function getContentHeight(a){const e=SizeUtils.getBorderTopWidth(a)+SizeUtils.getBorderBottomWidth(a),t=SizeUtils.getPaddingTop(a)+SizeUtils.getPaddingBottom(a);return a.offsetHeight-e-t}function getTotalHeight(a){const e=SizeUtils.getMarginTop(a)+SizeUtils.getMarginBottom(a);return a.offsetHeight+e}function isAncestor$1(a,e){return!!(e!=null&&e.contains(a))}function findParentWithClass(a,e,t){for(;a&&a.nodeType===a.ELEMENT_NODE;){if(a.classList.contains(e))return a;if(t){if(typeof t=="string"){if(a.classList.contains(t))return null}else if(a===t)return null}a=a.parentNode}return null}function hasParentWithClass(a,e,t){return!!findParentWithClass(a,e,t)}function isShadowRoot(a){return a&&!!a.host&&!!a.mode}function isInShadowDOM(a){return!!getShadowRoot(a)}function getShadowRoot(a){var e;for(;a.parentNode;){if(a===((e=a.ownerDocument)==null?void 0:e.body))return null;a=a.parentNode}return isShadowRoot(a)?a:null}function getActiveElement(){let a=getActiveDocument().activeElement;for(;a!=null&&a.shadowRoot;)a=a.shadowRoot.activeElement;return a}function isActiveElement(a){return getActiveElement()===a}function isAncestorOfActiveElement(a){return isAncestor$1(getActiveElement(),a)}function getActiveDocument(){return getWindowsCount()<=1?mainWindow.document:Array.from(getWindows()).map(({window:e})=>e.document).find(e=>e.hasFocus())??mainWindow.document}function getActiveWindow(){var e;return((e=getActiveDocument().defaultView)==null?void 0:e.window)??mainWindow}const sharedMutationObserver=new class{constructor(){this.mutationObservers=new Map}observe(a,e,t){let s=this.mutationObservers.get(a);s||(s=new Map,this.mutationObservers.set(a,s));const o=hash(t);let r=s.get(o);if(r)r.users+=1;else{const l=new Emitter$1,c=new MutationObserver(u=>l.fire(u));c.observe(a,t);const d=r={users:1,observer:c,onDidMutate:l.event};e.add(toDisposable(()=>{d.users-=1,d.users===0&&(l.dispose(),c.disconnect(),s==null||s.delete(o),(s==null?void 0:s.size)===0&&this.mutationObservers.delete(a))})),s.set(o,r)}return r.onDidMutate}};function isHTMLElement(a){return a instanceof HTMLElement||a instanceof getWindow(a).HTMLElement}function isHTMLAnchorElement(a){return a instanceof HTMLAnchorElement||a instanceof getWindow(a).HTMLAnchorElement}function isSVGElement(a){return a instanceof SVGElement||a instanceof getWindow(a).SVGElement}function isMouseEvent(a){return a instanceof MouseEvent||a instanceof getWindow(a).MouseEvent}function isKeyboardEvent(a){return a instanceof KeyboardEvent||a instanceof getWindow(a).KeyboardEvent}const EventType$1={CLICK:"click",AUXCLICK:"auxclick",DBLCLICK:"dblclick",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",POINTER_LEAVE:"pointerleave",CONTEXT_MENU:"contextmenu",WHEEL:"wheel",KEY_DOWN:"keydown",KEY_PRESS:"keypress",KEY_UP:"keyup",LOAD:"load",BEFORE_UNLOAD:"beforeunload",UNLOAD:"unload",PAGE_SHOW:"pageshow",PAGE_HIDE:"pagehide",PASTE:"paste",ABORT:"abort",ERROR:"error",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_CHANGE:"fullscreenchange",WK_FULLSCREEN_CHANGE:"webkitfullscreenchange",SELECT:"select",CHANGE:"change",SUBMIT:"submit",RESET:"reset",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",BLUR:"blur",INPUT:"input",STORAGE:"storage",DRAG_START:"dragstart",DRAG:"drag",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop",DRAG_END:"dragend",ANIMATION_START:isWebKit?"webkitAnimationStart":"animationstart",ANIMATION_END:isWebKit?"webkitAnimationEnd":"animationend",ANIMATION_ITERATION:isWebKit?"webkitAnimationIteration":"animationiteration"};function isEventLike(a){const e=a;return!!(e&&typeof e.preventDefault=="function"&&typeof e.stopPropagation=="function")}const EventHelper={stop:(a,e)=>(a.preventDefault(),e&&a.stopPropagation(),a)};function saveParentsScrollTop(a){const e=[];for(let t=0;a&&a.nodeType===a.ELEMENT_NODE;t++)e[t]=a.scrollTop,a=a.parentNode;return e}function restoreParentsScrollTop(a,e){for(let t=0;a&&a.nodeType===a.ELEMENT_NODE;t++)a.scrollTop!==e[t]&&(a.scrollTop=e[t]),a=a.parentNode}let FocusTracker$1=class Wo extends Disposable{get onDidFocus(){return this._onDidFocus.event}get onDidBlur(){return this._onDidBlur.event}static hasFocusWithin(e){if(isHTMLElement(e)){const t=getShadowRoot(e),s=t?t.activeElement:e.ownerDocument.activeElement;return isAncestor$1(s,e)}else{const t=e;return isAncestor$1(t.document.activeElement,t.document)}}constructor(e){super(),this._onDidFocus=this._register(new Emitter$1),this._onDidBlur=this._register(new Emitter$1);let t=Wo.hasFocusWithin(e),s=!1;const o=()=>{s=!1,t||(t=!0,this._onDidFocus.fire())},r=()=>{t&&(s=!0,(isHTMLElement(e)?getWindow(e):e).setTimeout(()=>{s&&(s=!1,t=!1,this._onDidBlur.fire())},0))};this._refreshStateHandler=()=>{Wo.hasFocusWithin(e)!==t&&(t?r():o())},this._register(addDisposableListener(e,EventType$1.FOCUS,o,!0)),this._register(addDisposableListener(e,EventType$1.BLUR,r,!0)),isHTMLElement(e)&&(this._register(addDisposableListener(e,EventType$1.FOCUS_IN,()=>this._refreshStateHandler())),this._register(addDisposableListener(e,EventType$1.FOCUS_OUT,()=>this._refreshStateHandler())))}};function trackFocus(a){return new FocusTracker$1(a)}function after(a,e){return a.after(e),e}function append$2(a,...e){if(a.append(...e),e.length===1&&typeof e[0]!="string")return e[0]}function prepend$2(a,e){return a.insertBefore(e,a.firstChild),e}function reset(a,...e){a.textContent="",append$2(a,...e)}const SELECTOR_REGEX=/([\w\-]+)?(#([\w\-]+))?((\.([\w\-]+))*)/;var Namespace;(function(a){a.HTML="http://www.w3.org/1999/xhtml",a.SVG="http://www.w3.org/2000/svg"})(Namespace||(Namespace={}));function _$(a,e,t,...s){const o=SELECTOR_REGEX.exec(e);if(!o)throw new Error("Bad use of emmet");const r=o[1]||"div";let l;return a!==Namespace.HTML?l=document.createElementNS(a,r):l=document.createElement(r),o[3]&&(l.id=o[3]),o[4]&&(l.className=o[4].replace(/\./g," ").trim()),t&&Object.entries(t).forEach(([c,d])=>{typeof d>"u"||(/^on\w+$/.test(c)?l[c]=d:c==="selected"?d&&l.setAttribute(c,"true"):l.setAttribute(c,d))}),l.append(...s),l}function $$l(a,e,...t){return _$(Namespace.HTML,a,e,...t)}$$l.SVG=function(a,e,...t){return _$(Namespace.SVG,a,e,...t)};function setVisibility(a,...e){a?show(...e):hide(...e)}function show(...a){for(const e of a)e.style.display="",e.removeAttribute("aria-hidden")}function hide(...a){for(const e of a)e.style.display="none",e.setAttribute("aria-hidden","true")}function computeScreenAwareSize(a,e){const t=a.devicePixelRatio*e;return Math.max(1,Math.floor(t))/a.devicePixelRatio}function windowOpenNoOpener(a){mainWindow.open(a,"_blank","noopener")}function animate(a,e){const t=()=>{e(),s=scheduleAtNextAnimationFrame(a,t)};let s=scheduleAtNextAnimationFrame(a,t);return toDisposable(()=>s.dispose())}RemoteAuthorities.setPreferredWebSchema(/^https:/.test(mainWindow.location.href)?"https":"http");class ModifierKeyEmitter extends Emitter$1{constructor(){super(),this._subscriptions=new DisposableStore,this._keyStatus={altKey:!1,shiftKey:!1,ctrlKey:!1,metaKey:!1},this._subscriptions.add(Event$1.runAndSubscribe(onDidRegisterWindow,({window:e,disposables:t})=>this.registerListeners(e,t),{window:mainWindow,disposables:this._subscriptions}))}registerListeners(e,t){t.add(addDisposableListener(e,"keydown",s=>{if(s.defaultPrevented)return;const o=new StandardKeyboardEvent(s);if(!(o.keyCode===6&&s.repeat)){if(s.altKey&&!this._keyStatus.altKey)this._keyStatus.lastKeyPressed="alt";else if(s.ctrlKey&&!this._keyStatus.ctrlKey)this._keyStatus.lastKeyPressed="ctrl";else if(s.metaKey&&!this._keyStatus.metaKey)this._keyStatus.lastKeyPressed="meta";else if(s.shiftKey&&!this._keyStatus.shiftKey)this._keyStatus.lastKeyPressed="shift";else if(o.keyCode!==6)this._keyStatus.lastKeyPressed=void 0;else return;this._keyStatus.altKey=s.altKey,this._keyStatus.ctrlKey=s.ctrlKey,this._keyStatus.metaKey=s.metaKey,this._keyStatus.shiftKey=s.shiftKey,this._keyStatus.lastKeyPressed&&(this._keyStatus.event=s,this.fire(this._keyStatus))}},!0)),t.add(addDisposableListener(e,"keyup",s=>{s.defaultPrevented||(!s.altKey&&this._keyStatus.altKey?this._keyStatus.lastKeyReleased="alt":!s.ctrlKey&&this._keyStatus.ctrlKey?this._keyStatus.lastKeyReleased="ctrl":!s.metaKey&&this._keyStatus.metaKey?this._keyStatus.lastKeyReleased="meta":!s.shiftKey&&this._keyStatus.shiftKey?this._keyStatus.lastKeyReleased="shift":this._keyStatus.lastKeyReleased=void 0,this._keyStatus.lastKeyPressed!==this._keyStatus.lastKeyReleased&&(this._keyStatus.lastKeyPressed=void 0),this._keyStatus.altKey=s.altKey,this._keyStatus.ctrlKey=s.ctrlKey,this._keyStatus.metaKey=s.metaKey,this._keyStatus.shiftKey=s.shiftKey,this._keyStatus.lastKeyReleased&&(this._keyStatus.event=s,this.fire(this._keyStatus)))},!0)),t.add(addDisposableListener(e.document.body,"mousedown",()=>{this._keyStatus.lastKeyPressed=void 0},!0)),t.add(addDisposableListener(e.document.body,"mouseup",()=>{this._keyStatus.lastKeyPressed=void 0},!0)),t.add(addDisposableListener(e.document.body,"mousemove",s=>{s.buttons&&(this._keyStatus.lastKeyPressed=void 0)},!0)),t.add(addDisposableListener(e,"blur",()=>{this.resetKeyStatus()}))}get keyStatus(){return this._keyStatus}resetKeyStatus(){this.doResetKeyStatus(),this.fire(this._keyStatus)}doResetKeyStatus(){this._keyStatus={altKey:!1,shiftKey:!1,ctrlKey:!1,metaKey:!1}}static getInstance(){return ModifierKeyEmitter.instance||(ModifierKeyEmitter.instance=new ModifierKeyEmitter),ModifierKeyEmitter.instance}dispose(){super.dispose(),this._subscriptions.dispose()}}class DragAndDropObserver extends Disposable{constructor(e,t){super(),this.element=e,this.callbacks=t,this.counter=0,this.dragStartTime=0,this.registerListeners()}registerListeners(){this.callbacks.onDragStart&&this._register(addDisposableListener(this.element,EventType$1.DRAG_START,e=>{var t,s;(s=(t=this.callbacks).onDragStart)==null||s.call(t,e)})),this.callbacks.onDrag&&this._register(addDisposableListener(this.element,EventType$1.DRAG,e=>{var t,s;(s=(t=this.callbacks).onDrag)==null||s.call(t,e)})),this._register(addDisposableListener(this.element,EventType$1.DRAG_ENTER,e=>{var t,s;this.counter++,this.dragStartTime=e.timeStamp,(s=(t=this.callbacks).onDragEnter)==null||s.call(t,e)})),this._register(addDisposableListener(this.element,EventType$1.DRAG_OVER,e=>{var t,s;e.preventDefault(),(s=(t=this.callbacks).onDragOver)==null||s.call(t,e,e.timeStamp-this.dragStartTime)})),this._register(addDisposableListener(this.element,EventType$1.DRAG_LEAVE,e=>{var t,s;this.counter--,this.counter===0&&(this.dragStartTime=0,(s=(t=this.callbacks).onDragLeave)==null||s.call(t,e))})),this._register(addDisposableListener(this.element,EventType$1.DRAG_END,e=>{var t,s;this.counter=0,this.dragStartTime=0,(s=(t=this.callbacks).onDragEnd)==null||s.call(t,e)})),this._register(addDisposableListener(this.element,EventType$1.DROP,e=>{var t,s;this.counter=0,this.dragStartTime=0,(s=(t=this.callbacks).onDrop)==null||s.call(t,e)}))}}const H_REGEX=/(?<tag>[\w\-]+)?(?:#(?<id>[\w\-]+))?(?<class>(?:\.(?:[\w\-]+))*)(?:@(?<name>(?:[\w\_])+))?/;function h(a,...e){let t,s;Array.isArray(e[0])?(t={},s=e[0]):(t=e[0]||{},s=e[1]);const o=H_REGEX.exec(a);if(!o||!o.groups)throw new Error("Bad use of h");const r=o.groups.tag||"div",l=document.createElement(r);o.groups.id&&(l.id=o.groups.id);const c=[];if(o.groups.class)for(const u of o.groups.class.split("."))u!==""&&c.push(u);if(t.className!==void 0)for(const u of t.className.split("."))u!==""&&c.push(u);c.length>0&&(l.className=c.join(" "));const d={};if(o.groups.name&&(d[o.groups.name]=l),s)for(const u of s)isHTMLElement(u)?l.appendChild(u):typeof u=="string"?l.append(u):"root"in u&&(Object.assign(d,u),l.appendChild(u.root));for(const[u,g]of Object.entries(t))if(u!=="className")if(u==="style")for(const[f,p]of Object.entries(g))l.style.setProperty(camelCaseToHyphenCase(f),typeof p=="number"?p+"px":""+p);else u==="tabIndex"?l.tabIndex=g:l.setAttribute(camelCaseToHyphenCase(u),g.toString());return d.root=l,d}function camelCaseToHyphenCase(a){return a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function isEditableElement(a){return a.tagName.toLowerCase()==="input"||a.tagName.toLowerCase()==="textarea"||isHTMLElement(a)&&!!a.editContext}var n;(function(a){function e(o=void 0){return(r,l,c)=>{const d=l.class;delete l.class;const u=l.ref;delete l.ref;const g=l.obsRef;return delete l.obsRef,new ObserverNodeWithElement(r,u,g,o,d,l,c)}}function t(o,r=void 0){const l=e(r);return(c,d)=>l(o,c,d)}a.div=t("div"),a.elem=e(void 0),a.svg=t("svg","http://www.w3.org/2000/svg"),a.svgElem=e("http://www.w3.org/2000/svg");function s(){let o;const r=function(l){o=l};return Object.defineProperty(r,"element",{get(){if(!o)throw new BugIndicatingError("Make sure the ref is set before accessing the element. Maybe wrong initialization order?");return o}}),r}a.ref=s})(n||(n={}));class ObserverNode{constructor(e,t,s,o,r,l,c){this._deriveds=[],this._element=o?document.createElementNS(o,e):document.createElement(e),t&&t(this._element),s&&this._deriveds.push(derived(d=>{s(this),d.store.add({dispose:()=>{s(null)}})})),r&&(hasObservable(r)?this._deriveds.push(derived(this,d=>{setClassName(this._element,getClassName(r,d))})):setClassName(this._element,getClassName(r,void 0)));for(const[d,u]of Object.entries(l))if(d==="style")for(const[g,f]of Object.entries(u)){const p=camelCaseToHyphenCase(g);isObservable(f)?this._deriveds.push(derivedOpts({owner:this,debugName:()=>`set.style.${p}`},m=>{this._element.style.setProperty(p,convertCssValue(f.read(m)))})):this._element.style.setProperty(p,convertCssValue(f))}else d==="tabIndex"?isObservable(u)?this._deriveds.push(derived(this,g=>{this._element.tabIndex=u.read(g)})):this._element.tabIndex=u:d.startsWith("on")?this._element[d]=u:isObservable(u)?this._deriveds.push(derivedOpts({owner:this,debugName:()=>`set.${d}`},g=>{setOrRemoveAttribute(this._element,d,u.read(g))})):setOrRemoveAttribute(this._element,d,u);if(c){let d=function(g,f){return isObservable(f)?d(g,f.read(g)):Array.isArray(f)?f.flatMap(p=>d(g,p)):f instanceof ObserverNode?(g&&f.readEffect(g),[f._element]):f?[f]:[]};const u=derived(this,g=>{this._element.replaceChildren(...d(g,c))});this._deriveds.push(u),childrenIsObservable(c)||u.get()}}readEffect(e){for(const t of this._deriveds)t.read(e)}keepUpdated(e){return derived(t=>{this.readEffect(t)}).recomputeInitiallyAndOnChange(e),this}toDisposableLiveElement(){const e=new DisposableStore;return this.keepUpdated(e),new LiveElement(this._element,e)}}function setClassName(a,e){isSVGElement(a)?a.setAttribute("class",e):a.className=e}function resolve(a,e,t){if(isObservable(a)){t(a.read(e));return}if(Array.isArray(a)){for(const s of a)resolve(s,e,t);return}t(a)}function getClassName(a,e){let t="";return resolve(a,e,s=>{s&&(t.length===0?t=s:t+=" "+s)}),t}function hasObservable(a){return isObservable(a)?!0:Array.isArray(a)?a.some(e=>hasObservable(e)):!1}function convertCssValue(a){return typeof a=="number"?a+"px":a}function childrenIsObservable(a){return isObservable(a)?!0:Array.isArray(a)?a.some(e=>childrenIsObservable(e)):!1}class LiveElement{constructor(e,t){this.element=e,this._disposable=t}dispose(){this._disposable.dispose()}}class ObserverNodeWithElement extends ObserverNode{constructor(){super(...arguments),this._isHovered=void 0,this._didMouseMoveDuringHover=void 0}get element(){return this._element}get isHovered(){if(!this._isHovered){const e=observableValue("hovered",!1);this._element.addEventListener("mouseenter",t=>e.set(!0,void 0)),this._element.addEventListener("mouseleave",t=>e.set(!1,void 0)),this._isHovered=e}return this._isHovered}get didMouseMoveDuringHover(){if(!this._didMouseMoveDuringHover){let e=!1;const t=observableValue("didMouseMoveDuringHover",!1);this._element.addEventListener("mouseenter",s=>{e=!0}),this._element.addEventListener("mousemove",s=>{e&&t.set(!0,void 0)}),this._element.addEventListener("mouseleave",s=>{e=!1,t.set(!1,void 0)}),this._didMouseMoveDuringHover=t}return this._didMouseMoveDuringHover}}function setOrRemoveAttribute(a,e,t){t==null?a.removeAttribute(camelCaseToHyphenCase(e)):a.setAttribute(camelCaseToHyphenCase(e),String(t))}function isObservable(a){return!!a&&a.read!==void 0&&a.reportChanges!==void 0}const aria="",MAX_MESSAGE_LENGTH=2e4;let ariaContainer,alertContainer,alertContainer2,statusContainer,statusContainer2;function setARIAContainer(a){ariaContainer=document.createElement("div"),ariaContainer.className="monaco-aria-container";const e=()=>{const s=document.createElement("div");return s.className="monaco-alert",s.setAttribute("role","alert"),s.setAttribute("aria-atomic","true"),ariaContainer.appendChild(s),s};alertContainer=e(),alertContainer2=e();const t=()=>{const s=document.createElement("div");return s.className="monaco-status",s.setAttribute("aria-live","polite"),s.setAttribute("aria-atomic","true"),ariaContainer.appendChild(s),s};statusContainer=t(),statusContainer2=t(),a.appendChild(ariaContainer)}function alert$1(a){ariaContainer&&(alertContainer.textContent!==a?(clearNode(alertContainer2),insertMessage(alertContainer,a)):(clearNode(alertContainer),insertMessage(alertContainer2,a)))}function status(a){ariaContainer&&(statusContainer.textContent!==a?(clearNode(statusContainer2),insertMessage(statusContainer,a)):(clearNode(statusContainer),insertMessage(statusContainer2,a)))}function insertMessage(a,e){clearNode(a),e.length>MAX_MESSAGE_LENGTH&&(e=e.substr(0,MAX_MESSAGE_LENGTH)),a.textContent=e,a.style.visibility="hidden",a.style.visibility="visible"}var _util;(function(a){a.serviceIds=new Map,a.DI_TARGET="$di$target",a.DI_DEPENDENCIES="$di$dependencies";function e(t){return t[a.DI_DEPENDENCIES]||[]}a.getServiceDependencies=e})(_util||(_util={}));const IInstantiationService=createDecorator("instantiationService");function storeServiceDependency(a,e,t){e[_util.DI_TARGET]===e?e[_util.DI_DEPENDENCIES].push({id:a,index:t}):(e[_util.DI_DEPENDENCIES]=[{id:a,index:t}],e[_util.DI_TARGET]=e)}function createDecorator(a){if(_util.serviceIds.has(a))return _util.serviceIds.get(a);const e=function(t,s,o){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");storeServiceDependency(e,t,o)};return e.toString=()=>a,_util.serviceIds.set(a,e),e}const ICodeEditorService=createDecorator("codeEditorService");let Position$1=class mt{constructor(e,t){this.lineNumber=e,this.column=t}with(e=this.lineNumber,t=this.column){return e===this.lineNumber&&t===this.column?this:new mt(e,t)}delta(e=0,t=0){return this.with(Math.max(1,this.lineNumber+e),Math.max(1,this.column+t))}equals(e){return mt.equals(this,e)}static equals(e,t){return!e&&!t?!0:!!e&&!!t&&e.lineNumber===t.lineNumber&&e.column===t.column}isBefore(e){return mt.isBefore(this,e)}static isBefore(e,t){return e.lineNumber<t.lineNumber?!0:t.lineNumber<e.lineNumber?!1:e.column<t.column}isBeforeOrEqual(e){return mt.isBeforeOrEqual(this,e)}static isBeforeOrEqual(e,t){return e.lineNumber<t.lineNumber?!0:t.lineNumber<e.lineNumber?!1:e.column<=t.column}static compare(e,t){const s=e.lineNumber|0,o=t.lineNumber|0;if(s===o){const r=e.column|0,l=t.column|0;return r-l}return s-o}clone(){return new mt(this.lineNumber,this.column)}toString(){return"("+this.lineNumber+","+this.column+")"}static lift(e){return new mt(e.lineNumber,e.column)}static isIPosition(e){return e&&typeof e.lineNumber=="number"&&typeof e.column=="number"}toJSON(){return{lineNumber:this.lineNumber,column:this.column}}};const IModelService=createDecorator("modelService"),ITextModelService=createDecorator("textModelService");class Action extends Disposable{get onDidChange(){return this._onDidChange.event}constructor(e,t="",s="",o=!0,r){super(),this._onDidChange=this._register(new Emitter$1),this._enabled=!0,this._id=e,this._label=t,this._cssClass=s,this._enabled=o,this._actionCallback=r}get id(){return this._id}get label(){return this._label}set label(e){this._setLabel(e)}_setLabel(e){this._label!==e&&(this._label=e,this._onDidChange.fire({label:e}))}get tooltip(){return this._tooltip||""}set tooltip(e){this._setTooltip(e)}_setTooltip(e){this._tooltip!==e&&(this._tooltip=e,this._onDidChange.fire({tooltip:e}))}get class(){return this._cssClass}set class(e){this._setClass(e)}_setClass(e){this._cssClass!==e&&(this._cssClass=e,this._onDidChange.fire({class:e}))}get enabled(){return this._enabled}set enabled(e){this._setEnabled(e)}_setEnabled(e){this._enabled!==e&&(this._enabled=e,this._onDidChange.fire({enabled:e}))}get checked(){return this._checked}set checked(e){this._setChecked(e)}_setChecked(e){this._checked!==e&&(this._checked=e,this._onDidChange.fire({checked:e}))}async run(e,t){this._actionCallback&&await this._actionCallback(e)}}class ActionRunner extends Disposable{constructor(){super(...arguments),this._onWillRun=this._register(new Emitter$1),this._onDidRun=this._register(new Emitter$1)}get onWillRun(){return this._onWillRun.event}get onDidRun(){return this._onDidRun.event}async run(e,t){if(!e.enabled)return;this._onWillRun.fire({action:e});let s;try{await this.runAction(e,t)}catch(o){s=o}this._onDidRun.fire({action:e,error:s})}async runAction(e,t){await e.run(t)}}const un=class un{constructor(){this.id=un.ID,this.label="",this.tooltip="",this.class="separator",this.enabled=!1,this.checked=!1}static join(...e){let t=[];for(const s of e)s.length&&(t.length?t=[...t,new un,...s]:t=s);return t}async run(){}};un.ID="vs.actions.separator";let Separator=un;class SubmenuAction{get actions(){return this._actions}constructor(e,t,s,o){this.tooltip="",this.enabled=!0,this.checked=void 0,this.id=e,this.label=t,this.class=o,this._actions=s}async run(){}}const Jn=class Jn extends Action{constructor(){super(Jn.ID,localize(28,"(empty)"),void 0,!1)}};Jn.ID="vs.actions.empty";let EmptySubmenuAction=Jn;function toAction(a){return{id:a.id,label:a.label,tooltip:a.tooltip??a.label,class:a.class,enabled:a.enabled??!0,checked:a.checked,run:async(...e)=>a.run(...e)}}const _codiconFontCharacters=Object.create(null);function register$2(a,e){if(isString$1(e)){const t=_codiconFontCharacters[e];if(t===void 0)throw new Error(`${a} references an unknown codicon: ${e}`);e=t}return _codiconFontCharacters[a]=e,{id:a}}function getCodiconFontCharacters(){return _codiconFontCharacters}const codiconsLibrary={add:register$2("add",6e4),plus:register$2("plus",6e4),gistNew:register$2("gist-new",6e4),repoCreate:register$2("repo-create",6e4),lightbulb:register$2("lightbulb",60001),lightBulb:register$2("light-bulb",60001),repo:register$2("repo",60002),repoDelete:register$2("repo-delete",60002),gistFork:register$2("gist-fork",60003),repoForked:register$2("repo-forked",60003),gitPullRequest:register$2("git-pull-request",60004),gitPullRequestAbandoned:register$2("git-pull-request-abandoned",60004),recordKeys:register$2("record-keys",60005),keyboard:register$2("keyboard",60005),tag:register$2("tag",60006),gitPullRequestLabel:register$2("git-pull-request-label",60006),tagAdd:register$2("tag-add",60006),tagRemove:register$2("tag-remove",60006),person:register$2("person",60007),personFollow:register$2("person-follow",60007),personOutline:register$2("person-outline",60007),personFilled:register$2("person-filled",60007),gitBranch:register$2("git-branch",60008),gitBranchCreate:register$2("git-branch-create",60008),gitBranchDelete:register$2("git-branch-delete",60008),sourceControl:register$2("source-control",60008),mirror:register$2("mirror",60009),mirrorPublic:register$2("mirror-public",60009),star:register$2("star",60010),starAdd:register$2("star-add",60010),starDelete:register$2("star-delete",60010),starEmpty:register$2("star-empty",60010),comment:register$2("comment",60011),commentAdd:register$2("comment-add",60011),alert:register$2("alert",60012),warning:register$2("warning",60012),search:register$2("search",60013),searchSave:register$2("search-save",60013),logOut:register$2("log-out",60014),signOut:register$2("sign-out",60014),logIn:register$2("log-in",60015),signIn:register$2("sign-in",60015),eye:register$2("eye",60016),eyeUnwatch:register$2("eye-unwatch",60016),eyeWatch:register$2("eye-watch",60016),circleFilled:register$2("circle-filled",60017),primitiveDot:register$2("primitive-dot",60017),closeDirty:register$2("close-dirty",60017),debugBreakpoint:register$2("debug-breakpoint",60017),debugBreakpointDisabled:register$2("debug-breakpoint-disabled",60017),debugHint:register$2("debug-hint",60017),terminalDecorationSuccess:register$2("terminal-decoration-success",60017),primitiveSquare:register$2("primitive-square",60018),edit:register$2("edit",60019),pencil:register$2("pencil",60019),info:register$2("info",60020),issueOpened:register$2("issue-opened",60020),gistPrivate:register$2("gist-private",60021),gitForkPrivate:register$2("git-fork-private",60021),lock:register$2("lock",60021),mirrorPrivate:register$2("mirror-private",60021),close:register$2("close",60022),removeClose:register$2("remove-close",60022),x:register$2("x",60022),repoSync:register$2("repo-sync",60023),sync:register$2("sync",60023),clone:register$2("clone",60024),desktopDownload:register$2("desktop-download",60024),beaker:register$2("beaker",60025),microscope:register$2("microscope",60025),vm:register$2("vm",60026),deviceDesktop:register$2("device-desktop",60026),file:register$2("file",60027),fileText:register$2("file-text",60027),more:register$2("more",60028),ellipsis:register$2("ellipsis",60028),kebabHorizontal:register$2("kebab-horizontal",60028),mailReply:register$2("mail-reply",60029),reply:register$2("reply",60029),organization:register$2("organization",60030),organizationFilled:register$2("organization-filled",60030),organizationOutline:register$2("organization-outline",60030),newFile:register$2("new-file",60031),fileAdd:register$2("file-add",60031),newFolder:register$2("new-folder",60032),fileDirectoryCreate:register$2("file-directory-create",60032),trash:register$2("trash",60033),trashcan:register$2("trashcan",60033),history:register$2("history",60034),clock:register$2("clock",60034),folder:register$2("folder",60035),fileDirectory:register$2("file-directory",60035),symbolFolder:register$2("symbol-folder",60035),logoGithub:register$2("logo-github",60036),markGithub:register$2("mark-github",60036),github:register$2("github",60036),terminal:register$2("terminal",60037),console:register$2("console",60037),repl:register$2("repl",60037),zap:register$2("zap",60038),symbolEvent:register$2("symbol-event",60038),error:register$2("error",60039),stop:register$2("stop",60039),variable:register$2("variable",60040),symbolVariable:register$2("symbol-variable",60040),array:register$2("array",60042),symbolArray:register$2("symbol-array",60042),symbolModule:register$2("symbol-module",60043),symbolPackage:register$2("symbol-package",60043),symbolNamespace:register$2("symbol-namespace",60043),symbolObject:register$2("symbol-object",60043),symbolMethod:register$2("symbol-method",60044),symbolFunction:register$2("symbol-function",60044),symbolConstructor:register$2("symbol-constructor",60044),symbolBoolean:register$2("symbol-boolean",60047),symbolNull:register$2("symbol-null",60047),symbolNumeric:register$2("symbol-numeric",60048),symbolNumber:register$2("symbol-number",60048),symbolStructure:register$2("symbol-structure",60049),symbolStruct:register$2("symbol-struct",60049),symbolParameter:register$2("symbol-parameter",60050),symbolTypeParameter:register$2("symbol-type-parameter",60050),symbolKey:register$2("symbol-key",60051),symbolText:register$2("symbol-text",60051),symbolReference:register$2("symbol-reference",60052),goToFile:register$2("go-to-file",60052),symbolEnum:register$2("symbol-enum",60053),symbolValue:register$2("symbol-value",60053),symbolRuler:register$2("symbol-ruler",60054),symbolUnit:register$2("symbol-unit",60054),activateBreakpoints:register$2("activate-breakpoints",60055),archive:register$2("archive",60056),arrowBoth:register$2("arrow-both",60057),arrowDown:register$2("arrow-down",60058),arrowLeft:register$2("arrow-left",60059),arrowRight:register$2("arrow-right",60060),arrowSmallDown:register$2("arrow-small-down",60061),arrowSmallLeft:register$2("arrow-small-left",60062),arrowSmallRight:register$2("arrow-small-right",60063),arrowSmallUp:register$2("arrow-small-up",60064),arrowUp:register$2("arrow-up",60065),bell:register$2("bell",60066),bold:register$2("bold",60067),book:register$2("book",60068),bookmark:register$2("bookmark",60069),debugBreakpointConditionalUnverified:register$2("debug-breakpoint-conditional-unverified",60070),debugBreakpointConditional:register$2("debug-breakpoint-conditional",60071),debugBreakpointConditionalDisabled:register$2("debug-breakpoint-conditional-disabled",60071),debugBreakpointDataUnverified:register$2("debug-breakpoint-data-unverified",60072),debugBreakpointData:register$2("debug-breakpoint-data",60073),debugBreakpointDataDisabled:register$2("debug-breakpoint-data-disabled",60073),debugBreakpointLogUnverified:register$2("debug-breakpoint-log-unverified",60074),debugBreakpointLog:register$2("debug-breakpoint-log",60075),debugBreakpointLogDisabled:register$2("debug-breakpoint-log-disabled",60075),briefcase:register$2("briefcase",60076),broadcast:register$2("broadcast",60077),browser:register$2("browser",60078),bug:register$2("bug",60079),calendar:register$2("calendar",60080),caseSensitive:register$2("case-sensitive",60081),check:register$2("check",60082),checklist:register$2("checklist",60083),chevronDown:register$2("chevron-down",60084),chevronLeft:register$2("chevron-left",60085),chevronRight:register$2("chevron-right",60086),chevronUp:register$2("chevron-up",60087),chromeClose:register$2("chrome-close",60088),chromeMaximize:register$2("chrome-maximize",60089),chromeMinimize:register$2("chrome-minimize",60090),chromeRestore:register$2("chrome-restore",60091),circleOutline:register$2("circle-outline",60092),circle:register$2("circle",60092),debugBreakpointUnverified:register$2("debug-breakpoint-unverified",60092),terminalDecorationIncomplete:register$2("terminal-decoration-incomplete",60092),circleSlash:register$2("circle-slash",60093),circuitBoard:register$2("circuit-board",60094),clearAll:register$2("clear-all",60095),clippy:register$2("clippy",60096),closeAll:register$2("close-all",60097),cloudDownload:register$2("cloud-download",60098),cloudUpload:register$2("cloud-upload",60099),code:register$2("code",60100),collapseAll:register$2("collapse-all",60101),colorMode:register$2("color-mode",60102),commentDiscussion:register$2("comment-discussion",60103),creditCard:register$2("credit-card",60105),dash:register$2("dash",60108),dashboard:register$2("dashboard",60109),database:register$2("database",60110),debugContinue:register$2("debug-continue",60111),debugDisconnect:register$2("debug-disconnect",60112),debugPause:register$2("debug-pause",60113),debugRestart:register$2("debug-restart",60114),debugStart:register$2("debug-start",60115),debugStepInto:register$2("debug-step-into",60116),debugStepOut:register$2("debug-step-out",60117),debugStepOver:register$2("debug-step-over",60118),debugStop:register$2("debug-stop",60119),debug:register$2("debug",60120),deviceCameraVideo:register$2("device-camera-video",60121),deviceCamera:register$2("device-camera",60122),deviceMobile:register$2("device-mobile",60123),diffAdded:register$2("diff-added",60124),diffIgnored:register$2("diff-ignored",60125),diffModified:register$2("diff-modified",60126),diffRemoved:register$2("diff-removed",60127),diffRenamed:register$2("diff-renamed",60128),diff:register$2("diff",60129),diffSidebyside:register$2("diff-sidebyside",60129),discard:register$2("discard",60130),editorLayout:register$2("editor-layout",60131),emptyWindow:register$2("empty-window",60132),exclude:register$2("exclude",60133),extensions:register$2("extensions",60134),eyeClosed:register$2("eye-closed",60135),fileBinary:register$2("file-binary",60136),fileCode:register$2("file-code",60137),fileMedia:register$2("file-media",60138),filePdf:register$2("file-pdf",60139),fileSubmodule:register$2("file-submodule",60140),fileSymlinkDirectory:register$2("file-symlink-directory",60141),fileSymlinkFile:register$2("file-symlink-file",60142),fileZip:register$2("file-zip",60143),files:register$2("files",60144),filter:register$2("filter",60145),flame:register$2("flame",60146),foldDown:register$2("fold-down",60147),foldUp:register$2("fold-up",60148),fold:register$2("fold",60149),folderActive:register$2("folder-active",60150),folderOpened:register$2("folder-opened",60151),gear:register$2("gear",60152),gift:register$2("gift",60153),gistSecret:register$2("gist-secret",60154),gist:register$2("gist",60155),gitCommit:register$2("git-commit",60156),gitCompare:register$2("git-compare",60157),compareChanges:register$2("compare-changes",60157),gitMerge:register$2("git-merge",60158),githubAction:register$2("github-action",60159),githubAlt:register$2("github-alt",60160),globe:register$2("globe",60161),grabber:register$2("grabber",60162),graph:register$2("graph",60163),gripper:register$2("gripper",60164),heart:register$2("heart",60165),home:register$2("home",60166),horizontalRule:register$2("horizontal-rule",60167),hubot:register$2("hubot",60168),inbox:register$2("inbox",60169),issueReopened:register$2("issue-reopened",60171),issues:register$2("issues",60172),italic:register$2("italic",60173),jersey:register$2("jersey",60174),json:register$2("json",60175),kebabVertical:register$2("kebab-vertical",60176),key:register$2("key",60177),law:register$2("law",60178),lightbulbAutofix:register$2("lightbulb-autofix",60179),linkExternal:register$2("link-external",60180),link:register$2("link",60181),listOrdered:register$2("list-ordered",60182),listUnordered:register$2("list-unordered",60183),liveShare:register$2("live-share",60184),loading:register$2("loading",60185),location:register$2("location",60186),mailRead:register$2("mail-read",60187),mail:register$2("mail",60188),markdown:register$2("markdown",60189),megaphone:register$2("megaphone",60190),mention:register$2("mention",60191),milestone:register$2("milestone",60192),gitPullRequestMilestone:register$2("git-pull-request-milestone",60192),mortarBoard:register$2("mortar-board",60193),move:register$2("move",60194),multipleWindows:register$2("multiple-windows",60195),mute:register$2("mute",60196),noNewline:register$2("no-newline",60197),note:register$2("note",60198),octoface:register$2("octoface",60199),openPreview:register$2("open-preview",60200),package:register$2("package",60201),paintcan:register$2("paintcan",60202),pin:register$2("pin",60203),play:register$2("play",60204),run:register$2("run",60204),plug:register$2("plug",60205),preserveCase:register$2("preserve-case",60206),preview:register$2("preview",60207),project:register$2("project",60208),pulse:register$2("pulse",60209),question:register$2("question",60210),quote:register$2("quote",60211),radioTower:register$2("radio-tower",60212),reactions:register$2("reactions",60213),references:register$2("references",60214),refresh:register$2("refresh",60215),regex:register$2("regex",60216),remoteExplorer:register$2("remote-explorer",60217),remote:register$2("remote",60218),remove:register$2("remove",60219),replaceAll:register$2("replace-all",60220),replace:register$2("replace",60221),repoClone:register$2("repo-clone",60222),repoForcePush:register$2("repo-force-push",60223),repoPull:register$2("repo-pull",60224),repoPush:register$2("repo-push",60225),report:register$2("report",60226),requestChanges:register$2("request-changes",60227),rocket:register$2("rocket",60228),rootFolderOpened:register$2("root-folder-opened",60229),rootFolder:register$2("root-folder",60230),rss:register$2("rss",60231),ruby:register$2("ruby",60232),saveAll:register$2("save-all",60233),saveAs:register$2("save-as",60234),save:register$2("save",60235),screenFull:register$2("screen-full",60236),screenNormal:register$2("screen-normal",60237),searchStop:register$2("search-stop",60238),server:register$2("server",60240),settingsGear:register$2("settings-gear",60241),settings:register$2("settings",60242),shield:register$2("shield",60243),smiley:register$2("smiley",60244),sortPrecedence:register$2("sort-precedence",60245),splitHorizontal:register$2("split-horizontal",60246),splitVertical:register$2("split-vertical",60247),squirrel:register$2("squirrel",60248),starFull:register$2("star-full",60249),starHalf:register$2("star-half",60250),symbolClass:register$2("symbol-class",60251),symbolColor:register$2("symbol-color",60252),symbolConstant:register$2("symbol-constant",60253),symbolEnumMember:register$2("symbol-enum-member",60254),symbolField:register$2("symbol-field",60255),symbolFile:register$2("symbol-file",60256),symbolInterface:register$2("symbol-interface",60257),symbolKeyword:register$2("symbol-keyword",60258),symbolMisc:register$2("symbol-misc",60259),symbolOperator:register$2("symbol-operator",60260),symbolProperty:register$2("symbol-property",60261),wrench:register$2("wrench",60261),wrenchSubaction:register$2("wrench-subaction",60261),symbolSnippet:register$2("symbol-snippet",60262),tasklist:register$2("tasklist",60263),telescope:register$2("telescope",60264),textSize:register$2("text-size",60265),threeBars:register$2("three-bars",60266),thumbsdown:register$2("thumbsdown",60267),thumbsup:register$2("thumbsup",60268),tools:register$2("tools",60269),triangleDown:register$2("triangle-down",60270),triangleLeft:register$2("triangle-left",60271),triangleRight:register$2("triangle-right",60272),triangleUp:register$2("triangle-up",60273),twitter:register$2("twitter",60274),unfold:register$2("unfold",60275),unlock:register$2("unlock",60276),unmute:register$2("unmute",60277),unverified:register$2("unverified",60278),verified:register$2("verified",60279),versions:register$2("versions",60280),vmActive:register$2("vm-active",60281),vmOutline:register$2("vm-outline",60282),vmRunning:register$2("vm-running",60283),watch:register$2("watch",60284),whitespace:register$2("whitespace",60285),wholeWord:register$2("whole-word",60286),window:register$2("window",60287),wordWrap:register$2("word-wrap",60288),zoomIn:register$2("zoom-in",60289),zoomOut:register$2("zoom-out",60290),listFilter:register$2("list-filter",60291),listFlat:register$2("list-flat",60292),listSelection:register$2("list-selection",60293),selection:register$2("selection",60293),listTree:register$2("list-tree",60294),debugBreakpointFunctionUnverified:register$2("debug-breakpoint-function-unverified",60295),debugBreakpointFunction:register$2("debug-breakpoint-function",60296),debugBreakpointFunctionDisabled:register$2("debug-breakpoint-function-disabled",60296),debugStackframeActive:register$2("debug-stackframe-active",60297),circleSmallFilled:register$2("circle-small-filled",60298),debugStackframeDot:register$2("debug-stackframe-dot",60298),terminalDecorationMark:register$2("terminal-decoration-mark",60298),debugStackframe:register$2("debug-stackframe",60299),debugStackframeFocused:register$2("debug-stackframe-focused",60299),debugBreakpointUnsupported:register$2("debug-breakpoint-unsupported",60300),symbolString:register$2("symbol-string",60301),debugReverseContinue:register$2("debug-reverse-continue",60302),debugStepBack:register$2("debug-step-back",60303),debugRestartFrame:register$2("debug-restart-frame",60304),debugAlt:register$2("debug-alt",60305),callIncoming:register$2("call-incoming",60306),callOutgoing:register$2("call-outgoing",60307),menu:register$2("menu",60308),expandAll:register$2("expand-all",60309),feedback:register$2("feedback",60310),gitPullRequestReviewer:register$2("git-pull-request-reviewer",60310),groupByRefType:register$2("group-by-ref-type",60311),ungroupByRefType:register$2("ungroup-by-ref-type",60312),account:register$2("account",60313),gitPullRequestAssignee:register$2("git-pull-request-assignee",60313),bellDot:register$2("bell-dot",60314),debugConsole:register$2("debug-console",60315),library:register$2("library",60316),output:register$2("output",60317),runAll:register$2("run-all",60318),syncIgnored:register$2("sync-ignored",60319),pinned:register$2("pinned",60320),githubInverted:register$2("github-inverted",60321),serverProcess:register$2("server-process",60322),serverEnvironment:register$2("server-environment",60323),pass:register$2("pass",60324),issueClosed:register$2("issue-closed",60324),stopCircle:register$2("stop-circle",60325),playCircle:register$2("play-circle",60326),record:register$2("record",60327),debugAltSmall:register$2("debug-alt-small",60328),vmConnect:register$2("vm-connect",60329),cloud:register$2("cloud",60330),merge:register$2("merge",60331),export:register$2("export",60332),graphLeft:register$2("graph-left",60333),magnet:register$2("magnet",60334),notebook:register$2("notebook",60335),redo:register$2("redo",60336),checkAll:register$2("check-all",60337),pinnedDirty:register$2("pinned-dirty",60338),passFilled:register$2("pass-filled",60339),circleLargeFilled:register$2("circle-large-filled",60340),circleLarge:register$2("circle-large",60341),circleLargeOutline:register$2("circle-large-outline",60341),combine:register$2("combine",60342),gather:register$2("gather",60342),table:register$2("table",60343),variableGroup:register$2("variable-group",60344),typeHierarchy:register$2("type-hierarchy",60345),typeHierarchySub:register$2("type-hierarchy-sub",60346),typeHierarchySuper:register$2("type-hierarchy-super",60347),gitPullRequestCreate:register$2("git-pull-request-create",60348),runAbove:register$2("run-above",60349),runBelow:register$2("run-below",60350),notebookTemplate:register$2("notebook-template",60351),debugRerun:register$2("debug-rerun",60352),workspaceTrusted:register$2("workspace-trusted",60353),workspaceUntrusted:register$2("workspace-untrusted",60354),workspaceUnknown:register$2("workspace-unknown",60355),terminalCmd:register$2("terminal-cmd",60356),terminalDebian:register$2("terminal-debian",60357),terminalLinux:register$2("terminal-linux",60358),terminalPowershell:register$2("terminal-powershell",60359),terminalTmux:register$2("terminal-tmux",60360),terminalUbuntu:register$2("terminal-ubuntu",60361),terminalBash:register$2("terminal-bash",60362),arrowSwap:register$2("arrow-swap",60363),copy:register$2("copy",60364),personAdd:register$2("person-add",60365),filterFilled:register$2("filter-filled",60366),wand:register$2("wand",60367),debugLineByLine:register$2("debug-line-by-line",60368),inspect:register$2("inspect",60369),layers:register$2("layers",60370),layersDot:register$2("layers-dot",60371),layersActive:register$2("layers-active",60372),compass:register$2("compass",60373),compassDot:register$2("compass-dot",60374),compassActive:register$2("compass-active",60375),azure:register$2("azure",60376),issueDraft:register$2("issue-draft",60377),gitPullRequestClosed:register$2("git-pull-request-closed",60378),gitPullRequestDraft:register$2("git-pull-request-draft",60379),debugAll:register$2("debug-all",60380),debugCoverage:register$2("debug-coverage",60381),runErrors:register$2("run-errors",60382),folderLibrary:register$2("folder-library",60383),debugContinueSmall:register$2("debug-continue-small",60384),beakerStop:register$2("beaker-stop",60385),graphLine:register$2("graph-line",60386),graphScatter:register$2("graph-scatter",60387),pieChart:register$2("pie-chart",60388),bracket:register$2("bracket",60175),bracketDot:register$2("bracket-dot",60389),bracketError:register$2("bracket-error",60390),lockSmall:register$2("lock-small",60391),azureDevops:register$2("azure-devops",60392),verifiedFilled:register$2("verified-filled",60393),newline:register$2("newline",60394),layout:register$2("layout",60395),layoutActivitybarLeft:register$2("layout-activitybar-left",60396),layoutActivitybarRight:register$2("layout-activitybar-right",60397),layoutPanelLeft:register$2("layout-panel-left",60398),layoutPanelCenter:register$2("layout-panel-center",60399),layoutPanelJustify:register$2("layout-panel-justify",60400),layoutPanelRight:register$2("layout-panel-right",60401),layoutPanel:register$2("layout-panel",60402),layoutSidebarLeft:register$2("layout-sidebar-left",60403),layoutSidebarRight:register$2("layout-sidebar-right",60404),layoutStatusbar:register$2("layout-statusbar",60405),layoutMenubar:register$2("layout-menubar",60406),layoutCentered:register$2("layout-centered",60407),target:register$2("target",60408),indent:register$2("indent",60409),recordSmall:register$2("record-small",60410),errorSmall:register$2("error-small",60411),terminalDecorationError:register$2("terminal-decoration-error",60411),arrowCircleDown:register$2("arrow-circle-down",60412),arrowCircleLeft:register$2("arrow-circle-left",60413),arrowCircleRight:register$2("arrow-circle-right",60414),arrowCircleUp:register$2("arrow-circle-up",60415),layoutSidebarRightOff:register$2("layout-sidebar-right-off",60416),layoutPanelOff:register$2("layout-panel-off",60417),layoutSidebarLeftOff:register$2("layout-sidebar-left-off",60418),blank:register$2("blank",60419),heartFilled:register$2("heart-filled",60420),map:register$2("map",60421),mapHorizontal:register$2("map-horizontal",60421),foldHorizontal:register$2("fold-horizontal",60421),mapFilled:register$2("map-filled",60422),mapHorizontalFilled:register$2("map-horizontal-filled",60422),foldHorizontalFilled:register$2("fold-horizontal-filled",60422),circleSmall:register$2("circle-small",60423),bellSlash:register$2("bell-slash",60424),bellSlashDot:register$2("bell-slash-dot",60425),commentUnresolved:register$2("comment-unresolved",60426),gitPullRequestGoToChanges:register$2("git-pull-request-go-to-changes",60427),gitPullRequestNewChanges:register$2("git-pull-request-new-changes",60428),searchFuzzy:register$2("search-fuzzy",60429),commentDraft:register$2("comment-draft",60430),send:register$2("send",60431),sparkle:register$2("sparkle",60432),insert:register$2("insert",60433),mic:register$2("mic",60434),thumbsdownFilled:register$2("thumbsdown-filled",60435),thumbsupFilled:register$2("thumbsup-filled",60436),coffee:register$2("coffee",60437),snake:register$2("snake",60438),game:register$2("game",60439),vr:register$2("vr",60440),chip:register$2("chip",60441),piano:register$2("piano",60442),music:register$2("music",60443),micFilled:register$2("mic-filled",60444),repoFetch:register$2("repo-fetch",60445),copilot:register$2("copilot",60446),lightbulbSparkle:register$2("lightbulb-sparkle",60447),robot:register$2("robot",60448),sparkleFilled:register$2("sparkle-filled",60449),diffSingle:register$2("diff-single",60450),diffMultiple:register$2("diff-multiple",60451),surroundWith:register$2("surround-with",60452),share:register$2("share",60453),gitStash:register$2("git-stash",60454),gitStashApply:register$2("git-stash-apply",60455),gitStashPop:register$2("git-stash-pop",60456),vscode:register$2("vscode",60457),vscodeInsiders:register$2("vscode-insiders",60458),codeOss:register$2("code-oss",60459),runCoverage:register$2("run-coverage",60460),runAllCoverage:register$2("run-all-coverage",60461),coverage:register$2("coverage",60462),githubProject:register$2("github-project",60463),mapVertical:register$2("map-vertical",60464),foldVertical:register$2("fold-vertical",60464),mapVerticalFilled:register$2("map-vertical-filled",60465),foldVerticalFilled:register$2("fold-vertical-filled",60465),goToSearch:register$2("go-to-search",60466),percentage:register$2("percentage",60467),sortPercentage:register$2("sort-percentage",60467),attach:register$2("attach",60468),goToEditingSession:register$2("go-to-editing-session",60469),editSession:register$2("edit-session",60470),codeReview:register$2("code-review",60471),copilotWarning:register$2("copilot-warning",60472),python:register$2("python",60473),copilotLarge:register$2("copilot-large",60474),copilotWarningLarge:register$2("copilot-warning-large",60475),keyboardTab:register$2("keyboard-tab",60476),copilotBlocked:register$2("copilot-blocked",60477),copilotNotConnected:register$2("copilot-not-connected",60478),flag:register$2("flag",60479),lightbulbEmpty:register$2("lightbulb-empty",60480),symbolMethodArrow:register$2("symbol-method-arrow",60481),copilotUnavailable:register$2("copilot-unavailable",60482),repoPinned:register$2("repo-pinned",60483),keyboardTabAbove:register$2("keyboard-tab-above",60484),keyboardTabBelow:register$2("keyboard-tab-below",60485),gitPullRequestDone:register$2("git-pull-request-done",60486),mcp:register$2("mcp",60487),extensionsLarge:register$2("extensions-large",60488),layoutPanelDock:register$2("layout-panel-dock",60489),layoutSidebarLeftDock:register$2("layout-sidebar-left-dock",60490),layoutSidebarRightDock:register$2("layout-sidebar-right-dock",60491),copilotInProgress:register$2("copilot-in-progress",60492),copilotError:register$2("copilot-error",60493),copilotSuccess:register$2("copilot-success",60494),chatSparkle:register$2("chat-sparkle",60495),searchSparkle:register$2("search-sparkle",60496),editSparkle:register$2("edit-sparkle",60497),copilotSnooze:register$2("copilot-snooze",60498),sendToRemoteAgent:register$2("send-to-remote-agent",60499),commentDiscussionSparkle:register$2("comment-discussion-sparkle",60500),chatSparkleWarning:register$2("chat-sparkle-warning",60501),chatSparkleError:register$2("chat-sparkle-error",60502),collection:register$2("collection",60503),newCollection:register$2("new-collection",60504),thinking:register$2("thinking",60505)},codiconsDerived={dialogError:register$2("dialog-error","error"),dialogWarning:register$2("dialog-warning","warning"),dialogInfo:register$2("dialog-info","info"),dialogClose:register$2("dialog-close","close"),treeItemExpanded:register$2("tree-item-expanded","chevron-down"),treeFilterOnTypeOn:register$2("tree-filter-on-type-on","list-filter"),treeFilterOnTypeOff:register$2("tree-filter-on-type-off","list-selection"),treeFilterClear:register$2("tree-filter-clear","close"),treeItemLoading:register$2("tree-item-loading","loading"),menuSelection:register$2("menu-selection","check"),menuSubmenu:register$2("menu-submenu","chevron-right"),menuBarMore:register$2("menubar-more","more"),scrollbarButtonLeft:register$2("scrollbar-button-left","triangle-left"),scrollbarButtonRight:register$2("scrollbar-button-right","triangle-right"),scrollbarButtonUp:register$2("scrollbar-button-up","triangle-up"),scrollbarButtonDown:register$2("scrollbar-button-down","triangle-down"),toolBarMore:register$2("toolbar-more","more"),quickInputBack:register$2("quick-input-back","arrow-left"),dropDownButton:register$2("drop-down-button",60084),symbolCustomColor:register$2("symbol-customcolor",60252),exportIcon:register$2("export",60332),workspaceUnspecified:register$2("workspace-unspecified",60355),newLine:register$2("newline",60394),thumbsDownFilled:register$2("thumbsdown-filled",60435),thumbsUpFilled:register$2("thumbsup-filled",60436),gitFetch:register$2("git-fetch",60445),lightbulbSparkleAutofix:register$2("lightbulb-sparkle-autofix",60447),debugBreakpointPending:register$2("debug-breakpoint-pending",60377)},Codicon={...codiconsLibrary,...codiconsDerived};var ThemeColor;(function(a){function e(t){return!!t&&typeof t=="object"&&typeof t.id=="string"}a.isThemeColor=e})(ThemeColor||(ThemeColor={}));var ThemeIcon;(function(a){a.iconNameSegment="[A-Za-z0-9]+",a.iconNameExpression="[A-Za-z0-9-]+",a.iconModifierExpression="~[A-Za-z]+",a.iconNameCharacter="[A-Za-z0-9~-]";const e=new RegExp(`^(${a.iconNameExpression})(${a.iconModifierExpression})?$`);function t(p){const m=e.exec(p.id);if(!m)return t(Codicon.error);const[,_,C]=m,b=["codicon","codicon-"+_];return C&&b.push("codicon-modifier-"+C.substring(1)),b}a.asClassNameArray=t;function s(p){return t(p).join(" ")}a.asClassName=s;function o(p){return"."+t(p).join(".")}a.asCSSSelector=o;function r(p){return!!p&&typeof p=="object"&&typeof p.id=="string"&&(typeof p.color>"u"||ThemeColor.isThemeColor(p.color))}a.isThemeIcon=r;const l=new RegExp(`^\\$\\((${a.iconNameExpression}(?:${a.iconModifierExpression})?)\\)$`);function c(p){const m=l.exec(p);if(!m)return;const[,_]=m;return{id:_}}a.fromString=c;function d(p){return{id:p}}a.fromId=d;function u(p,m){let _=p.id;const C=_.lastIndexOf("~");return C!==-1&&(_=_.substring(0,C)),m&&(_=`${_}~${m}`),{id:_}}a.modify=u;function g(p){const m=p.id.lastIndexOf("~");if(m!==-1)return p.id.substring(m+1)}a.getModifier=g;function f(p,m){var _,C;return p.id===m.id&&((_=p.color)==null?void 0:_.id)===((C=m.color)==null?void 0:C.id)}a.isEqual=f})(ThemeIcon||(ThemeIcon={}));const ICommandService=createDecorator("commandService"),CommandsRegistry=new class{constructor(){this._commands=new Map,this._onDidRegisterCommand=new Emitter$1,this.onDidRegisterCommand=this._onDidRegisterCommand.event}registerCommand(a,e){if(!a)throw new Error("invalid command");if(typeof a=="string"){if(!e)throw new Error("invalid command");return this.registerCommand({id:a,handler:e})}if(a.metadata&&Array.isArray(a.metadata.args)){const l=[];for(const d of a.metadata.args)l.push(d.constraint);const c=a.handler;a.handler=function(d,...u){return validateConstraints(u,l),c(d,...u)}}const{id:t}=a;let s=this._commands.get(t);s||(s=new LinkedList,this._commands.set(t,s));const o=s.unshift(a),r=toDisposable(()=>{o();const l=this._commands.get(t);l!=null&&l.isEmpty()&&this._commands.delete(t)});return this._onDidRegisterCommand.fire(t),r}registerCommandAlias(a,e){return CommandsRegistry.registerCommand(a,(t,...s)=>t.get(ICommandService).executeCommand(e,...s))}getCommand(a){const e=this._commands.get(a);if(!(!e||e.isEmpty()))return Iterable.first(e)}getCommands(){const a=new Map;for(const e of this._commands.keys()){const t=this.getCommand(e);t&&a.set(e,t)}return a}};CommandsRegistry.registerCommand("noop",()=>{});function hintDidYouMean(...a){switch(a.length){case 1:return localize(1678,"Did you mean {0}?",a[0]);case 2:return localize(1679,"Did you mean {0} or {1}?",a[0],a[1]);case 3:return localize(1680,"Did you mean {0}, {1} or {2}?",a[0],a[1],a[2]);default:return}}const hintDidYouForgetToOpenOrCloseQuote=localize(1681,"Did you forget to open or close the quote?"),hintDidYouForgetToEscapeSlash=localize(1682,"Did you forget to escape the '/' (slash) character? Put two backslashes before it to escape, e.g., '\\\\/'.");var at;let Scanner$1=(at=class{constructor(){this._input="",this._start=0,this._current=0,this._tokens=[],this._errors=[],this.stringRe=/[a-zA-Z0-9_<>\-\./\\:\*\?\+\[\]\^,#@;"%\$\p{L}-]+/uy}static getLexeme(e){switch(e.type){case 0:return"(";case 1:return")";case 2:return"!";case 3:return e.isTripleEq?"===":"==";case 4:return e.isTripleEq?"!==":"!=";case 5:return"<";case 6:return"<=";case 7:return">=";case 8:return">=";case 9:return"=~";case 10:return e.lexeme;case 11:return"true";case 12:return"false";case 13:return"in";case 14:return"not";case 15:return"&&";case 16:return"||";case 17:return e.lexeme;case 18:return e.lexeme;case 19:return e.lexeme;case 20:return"EOF";default:throw illegalState(`unhandled token type: ${JSON.stringify(e)}; have you forgotten to add a case?`)}}reset(e){return this._input=e,this._start=0,this._current=0,this._tokens=[],this._errors=[],this}scan(){for(;!this._isAtEnd();)switch(this._start=this._current,this._advance()){case 40:this._addToken(0);break;case 41:this._addToken(1);break;case 33:if(this._match(61)){const t=this._match(61);this._tokens.push({type:4,offset:this._start,isTripleEq:t})}else this._addToken(2);break;case 39:this._quotedString();break;case 47:this._regex();break;case 61:if(this._match(61)){const t=this._match(61);this._tokens.push({type:3,offset:this._start,isTripleEq:t})}else this._match(126)?this._addToken(9):this._error(hintDidYouMean("==","=~"));break;case 60:this._addToken(this._match(61)?6:5);break;case 62:this._addToken(this._match(61)?8:7);break;case 38:this._match(38)?this._addToken(15):this._error(hintDidYouMean("&&"));break;case 124:this._match(124)?this._addToken(16):this._error(hintDidYouMean("||"));break;case 32:case 13:case 9:case 10:case 160:break;default:this._string()}return this._start=this._current,this._addToken(20),Array.from(this._tokens)}_match(e){return this._isAtEnd()||this._input.charCodeAt(this._current)!==e?!1:(this._current++,!0)}_advance(){return this._input.charCodeAt(this._current++)}_peek(){return this._isAtEnd()?0:this._input.charCodeAt(this._current)}_addToken(e){this._tokens.push({type:e,offset:this._start})}_error(e){const t=this._start,s=this._input.substring(this._start,this._current),o={type:19,offset:this._start,lexeme:s};this._errors.push({offset:t,lexeme:s,additionalInfo:e}),this._tokens.push(o)}_string(){this.stringRe.lastIndex=this._start;const e=this.stringRe.exec(this._input);if(e){this._current=this._start+e[0].length;const t=this._input.substring(this._start,this._current),s=at._keywords.get(t);s?this._addToken(s):this._tokens.push({type:17,lexeme:t,offset:this._start})}}_quotedString(){for(;this._peek()!==39&&!this._isAtEnd();)this._advance();if(this._isAtEnd()){this._error(hintDidYouForgetToOpenOrCloseQuote);return}this._advance(),this._tokens.push({type:18,lexeme:this._input.substring(this._start+1,this._current-1),offset:this._start+1})}_regex(){let e=this._current,t=!1,s=!1;for(;;){if(e>=this._input.length){this._current=e,this._error(hintDidYouForgetToEscapeSlash);return}const r=this._input.charCodeAt(e);if(t)t=!1;else if(r===47&&!s){e++;break}else r===91?s=!0:r===92?t=!0:r===93&&(s=!1);e++}for(;e<this._input.length&&at._regexFlags.has(this._input.charCodeAt(e));)e++;this._current=e;const o=this._input.substring(this._start,this._current);this._tokens.push({type:10,lexeme:o,offset:this._start})}_isAtEnd(){return this._current>=this._input.length}},at._regexFlags=new Set(["i","g","s","m","y","u"].map(e=>e.charCodeAt(0))),at._keywords=new Map([["not",14],["in",13],["false",12],["true",11]]),at);const CONSTANT_VALUES=new Map;CONSTANT_VALUES.set("false",!1);CONSTANT_VALUES.set("true",!0);CONSTANT_VALUES.set("isMac",isMacintosh);CONSTANT_VALUES.set("isLinux",isLinux);CONSTANT_VALUES.set("isWindows",isWindows);CONSTANT_VALUES.set("isWeb",isWeb);CONSTANT_VALUES.set("isMacNative",isMacintosh&&!isWeb);CONSTANT_VALUES.set("isEdge",isEdge);CONSTANT_VALUES.set("isFirefox",isFirefox);CONSTANT_VALUES.set("isChrome",isChrome);CONSTANT_VALUES.set("isSafari",isSafari);const hasOwnProperty$1=Object.prototype.hasOwnProperty,defaultConfig={regexParsingWithErrorRecovery:!0},errorEmptyString=localize(1660,"Empty context key expression"),hintEmptyString=localize(1661,"Did you forget to write an expression? You can also put 'false' or 'true' to always evaluate to false or true, respectively."),errorNoInAfterNot=localize(1662,"'in' after 'not'."),errorClosingParenthesis=localize(1663,"closing parenthesis ')'"),errorUnexpectedToken=localize(1664,"Unexpected token"),hintUnexpectedToken=localize(1665,"Did you forget to put && or || before the token?"),errorUnexpectedEOF=localize(1666,"Unexpected end of expression"),hintUnexpectedEOF=localize(1667,"Did you forget to put a context key?");var Ye;let Parser$1=(Ye=class{constructor(e=defaultConfig){this._config=e,this._scanner=new Scanner$1,this._tokens=[],this._current=0,this._parsingErrors=[],this._flagsGYRe=/g|y/g}parse(e){if(e===""){this._parsingErrors.push({message:errorEmptyString,offset:0,lexeme:"",additionalInfo:hintEmptyString});return}this._tokens=this._scanner.reset(e).scan(),this._current=0,this._parsingErrors=[];try{const t=this._expr();if(!this._isAtEnd()){const s=this._peek(),o=s.type===17?hintUnexpectedToken:void 0;throw this._parsingErrors.push({message:errorUnexpectedToken,offset:s.offset,lexeme:Scanner$1.getLexeme(s),additionalInfo:o}),Ye._parseError}return t}catch(t){if(t!==Ye._parseError)throw t;return}}_expr(){return this._or()}_or(){const e=[this._and()];for(;this._matchOne(16);){const t=this._and();e.push(t)}return e.length===1?e[0]:ContextKeyExpr.or(...e)}_and(){const e=[this._term()];for(;this._matchOne(15);){const t=this._term();e.push(t)}return e.length===1?e[0]:ContextKeyExpr.and(...e)}_term(){if(this._matchOne(2)){const e=this._peek();switch(e.type){case 11:return this._advance(),ContextKeyFalseExpr.INSTANCE;case 12:return this._advance(),ContextKeyTrueExpr.INSTANCE;case 0:{this._advance();const t=this._expr();return this._consume(1,errorClosingParenthesis),t==null?void 0:t.negate()}case 17:return this._advance(),ContextKeyNotExpr.create(e.lexeme);default:throw this._errExpectedButGot("KEY | true | false | '(' expression ')'",e)}}return this._primary()}_primary(){const e=this._peek();switch(e.type){case 11:return this._advance(),ContextKeyExpr.true();case 12:return this._advance(),ContextKeyExpr.false();case 0:{this._advance();const t=this._expr();return this._consume(1,errorClosingParenthesis),t}case 17:{const t=e.lexeme;if(this._advance(),this._matchOne(9)){const o=this._peek();if(!this._config.regexParsingWithErrorRecovery){if(this._advance(),o.type!==10)throw this._errExpectedButGot("REGEX",o);const r=o.lexeme,l=r.lastIndexOf("/"),c=l===r.length-1?void 0:this._removeFlagsGY(r.substring(l+1));let d;try{d=new RegExp(r.substring(1,l),c)}catch{throw this._errExpectedButGot("REGEX",o)}return ContextKeyRegexExpr.create(t,d)}switch(o.type){case 10:case 19:{const r=[o.lexeme];this._advance();let l=this._peek(),c=0;for(let p=0;p<o.lexeme.length;p++)o.lexeme.charCodeAt(p)===40?c++:o.lexeme.charCodeAt(p)===41&&c--;for(;!this._isAtEnd()&&l.type!==15&&l.type!==16;){switch(l.type){case 0:c++;break;case 1:c--;break;case 10:case 18:for(let p=0;p<l.lexeme.length;p++)l.lexeme.charCodeAt(p)===40?c++:o.lexeme.charCodeAt(p)===41&&c--}if(c<0)break;r.push(Scanner$1.getLexeme(l)),this._advance(),l=this._peek()}const d=r.join(""),u=d.lastIndexOf("/"),g=u===d.length-1?void 0:this._removeFlagsGY(d.substring(u+1));let f;try{f=new RegExp(d.substring(1,u),g)}catch{throw this._errExpectedButGot("REGEX",o)}return ContextKeyExpr.regex(t,f)}case 18:{const r=o.lexeme;this._advance();let l=null;if(!isFalsyOrWhitespace(r)){const c=r.indexOf("/"),d=r.lastIndexOf("/");if(c!==d&&c>=0){const u=r.slice(c+1,d),g=r[d+1]==="i"?"i":"";try{l=new RegExp(u,g)}catch{throw this._errExpectedButGot("REGEX",o)}}}if(l===null)throw this._errExpectedButGot("REGEX",o);return ContextKeyRegexExpr.create(t,l)}default:throw this._errExpectedButGot("REGEX",this._peek())}}if(this._matchOne(14)){this._consume(13,errorNoInAfterNot);const o=this._value();return ContextKeyExpr.notIn(t,o)}switch(this._peek().type){case 3:{this._advance();const o=this._value();if(this._previous().type===18)return ContextKeyExpr.equals(t,o);switch(o){case"true":return ContextKeyExpr.has(t);case"false":return ContextKeyExpr.not(t);default:return ContextKeyExpr.equals(t,o)}}case 4:{this._advance();const o=this._value();if(this._previous().type===18)return ContextKeyExpr.notEquals(t,o);switch(o){case"true":return ContextKeyExpr.not(t);case"false":return ContextKeyExpr.has(t);default:return ContextKeyExpr.notEquals(t,o)}}case 5:return this._advance(),ContextKeySmallerExpr.create(t,this._value());case 6:return this._advance(),ContextKeySmallerEqualsExpr.create(t,this._value());case 7:return this._advance(),ContextKeyGreaterExpr.create(t,this._value());case 8:return this._advance(),ContextKeyGreaterEqualsExpr.create(t,this._value());case 13:return this._advance(),ContextKeyExpr.in(t,this._value());default:return ContextKeyExpr.has(t)}}case 20:throw this._parsingErrors.push({message:errorUnexpectedEOF,offset:e.offset,lexeme:"",additionalInfo:hintUnexpectedEOF}),Ye._parseError;default:throw this._errExpectedButGot(`true | false | KEY 
	| KEY '=~' REGEX 
	| KEY ('==' | '!=' | '<' | '<=' | '>' | '>=' | 'in' | 'not' 'in') value`,this._peek())}}_value(){const e=this._peek();switch(e.type){case 17:case 18:return this._advance(),e.lexeme;case 11:return this._advance(),"true";case 12:return this._advance(),"false";case 13:return this._advance(),"in";default:return""}}_removeFlagsGY(e){return e.replaceAll(this._flagsGYRe,"")}_previous(){return this._tokens[this._current-1]}_matchOne(e){return this._check(e)?(this._advance(),!0):!1}_advance(){return this._isAtEnd()||this._current++,this._previous()}_consume(e,t){if(this._check(e))return this._advance();throw this._errExpectedButGot(t,this._peek())}_errExpectedButGot(e,t,s){const o=localize(1668,`Expected: {0}
Received: '{1}'.`,e,Scanner$1.getLexeme(t)),r=t.offset,l=Scanner$1.getLexeme(t);return this._parsingErrors.push({message:o,offset:r,lexeme:l,additionalInfo:s}),Ye._parseError}_check(e){return this._peek().type===e}_peek(){return this._tokens[this._current]}_isAtEnd(){return this._peek().type===20}},Ye._parseError=new Error,Ye);const Vo=class Vo{static false(){return ContextKeyFalseExpr.INSTANCE}static true(){return ContextKeyTrueExpr.INSTANCE}static has(e){return ContextKeyDefinedExpr.create(e)}static equals(e,t){return ContextKeyEqualsExpr.create(e,t)}static notEquals(e,t){return ContextKeyNotEqualsExpr.create(e,t)}static regex(e,t){return ContextKeyRegexExpr.create(e,t)}static in(e,t){return ContextKeyInExpr.create(e,t)}static notIn(e,t){return ContextKeyNotInExpr.create(e,t)}static not(e){return ContextKeyNotExpr.create(e)}static and(...e){return ContextKeyAndExpr.create(e,null,!0)}static or(...e){return ContextKeyOrExpr.create(e,null,!0)}static deserialize(e){return e==null?void 0:this._parser.parse(e)}};Vo._parser=new Parser$1({regexParsingWithErrorRecovery:!1});let ContextKeyExpr=Vo;function expressionsAreEqualWithConstantSubstitution(a,e){const t=a?a.substituteConstants():void 0,s=e?e.substituteConstants():void 0;return!t&&!s?!0:!t||!s?!1:t.equals(s)}function cmp(a,e){return a.cmp(e)}const es=class es{constructor(){this.type=0}cmp(e){return this.type-e.type}equals(e){return e.type===this.type}substituteConstants(){return this}evaluate(e){return!1}serialize(){return"false"}keys(){return[]}negate(){return ContextKeyTrueExpr.INSTANCE}};es.INSTANCE=new es;let ContextKeyFalseExpr=es;const ts=class ts{constructor(){this.type=1}cmp(e){return this.type-e.type}equals(e){return e.type===this.type}substituteConstants(){return this}evaluate(e){return!0}serialize(){return"true"}keys(){return[]}negate(){return ContextKeyFalseExpr.INSTANCE}};ts.INSTANCE=new ts;let ContextKeyTrueExpr=ts;class ContextKeyDefinedExpr{static create(e,t=null){const s=CONSTANT_VALUES.get(e);return typeof s=="boolean"?s?ContextKeyTrueExpr.INSTANCE:ContextKeyFalseExpr.INSTANCE:new ContextKeyDefinedExpr(e,t)}constructor(e,t){this.key=e,this.negated=t,this.type=2}cmp(e){return e.type!==this.type?this.type-e.type:cmp1(this.key,e.key)}equals(e){return e.type===this.type?this.key===e.key:!1}substituteConstants(){const e=CONSTANT_VALUES.get(this.key);return typeof e=="boolean"?e?ContextKeyTrueExpr.INSTANCE:ContextKeyFalseExpr.INSTANCE:this}evaluate(e){return!!e.getValue(this.key)}serialize(){return this.key}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeyNotExpr.create(this.key,this)),this.negated}}class ContextKeyEqualsExpr{static create(e,t,s=null){if(typeof t=="boolean")return t?ContextKeyDefinedExpr.create(e,s):ContextKeyNotExpr.create(e,s);const o=CONSTANT_VALUES.get(e);return typeof o=="boolean"?t===(o?"true":"false")?ContextKeyTrueExpr.INSTANCE:ContextKeyFalseExpr.INSTANCE:new ContextKeyEqualsExpr(e,t,s)}constructor(e,t,s){this.key=e,this.value=t,this.negated=s,this.type=4}cmp(e){return e.type!==this.type?this.type-e.type:cmp2(this.key,this.value,e.key,e.value)}equals(e){return e.type===this.type?this.key===e.key&&this.value===e.value:!1}substituteConstants(){const e=CONSTANT_VALUES.get(this.key);if(typeof e=="boolean"){const t=e?"true":"false";return this.value===t?ContextKeyTrueExpr.INSTANCE:ContextKeyFalseExpr.INSTANCE}return this}evaluate(e){return e.getValue(this.key)==this.value}serialize(){return`${this.key} == '${this.value}'`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeyNotEqualsExpr.create(this.key,this.value,this)),this.negated}}class ContextKeyInExpr{static create(e,t){return new ContextKeyInExpr(e,t)}constructor(e,t){this.key=e,this.valueKey=t,this.type=10,this.negated=null}cmp(e){return e.type!==this.type?this.type-e.type:cmp2(this.key,this.valueKey,e.key,e.valueKey)}equals(e){return e.type===this.type?this.key===e.key&&this.valueKey===e.valueKey:!1}substituteConstants(){return this}evaluate(e){const t=e.getValue(this.valueKey),s=e.getValue(this.key);return Array.isArray(t)?t.includes(s):typeof s=="string"&&typeof t=="object"&&t!==null?hasOwnProperty$1.call(t,s):!1}serialize(){return`${this.key} in '${this.valueKey}'`}keys(){return[this.key,this.valueKey]}negate(){return this.negated||(this.negated=ContextKeyNotInExpr.create(this.key,this.valueKey)),this.negated}}class ContextKeyNotInExpr{static create(e,t){return new ContextKeyNotInExpr(e,t)}constructor(e,t){this.key=e,this.valueKey=t,this.type=11,this._negated=ContextKeyInExpr.create(e,t)}cmp(e){return e.type!==this.type?this.type-e.type:this._negated.cmp(e._negated)}equals(e){return e.type===this.type?this._negated.equals(e._negated):!1}substituteConstants(){return this}evaluate(e){return!this._negated.evaluate(e)}serialize(){return`${this.key} not in '${this.valueKey}'`}keys(){return this._negated.keys()}negate(){return this._negated}}class ContextKeyNotEqualsExpr{static create(e,t,s=null){if(typeof t=="boolean")return t?ContextKeyNotExpr.create(e,s):ContextKeyDefinedExpr.create(e,s);const o=CONSTANT_VALUES.get(e);return typeof o=="boolean"?t===(o?"true":"false")?ContextKeyFalseExpr.INSTANCE:ContextKeyTrueExpr.INSTANCE:new ContextKeyNotEqualsExpr(e,t,s)}constructor(e,t,s){this.key=e,this.value=t,this.negated=s,this.type=5}cmp(e){return e.type!==this.type?this.type-e.type:cmp2(this.key,this.value,e.key,e.value)}equals(e){return e.type===this.type?this.key===e.key&&this.value===e.value:!1}substituteConstants(){const e=CONSTANT_VALUES.get(this.key);if(typeof e=="boolean"){const t=e?"true":"false";return this.value===t?ContextKeyFalseExpr.INSTANCE:ContextKeyTrueExpr.INSTANCE}return this}evaluate(e){return e.getValue(this.key)!=this.value}serialize(){return`${this.key} != '${this.value}'`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeyEqualsExpr.create(this.key,this.value,this)),this.negated}}class ContextKeyNotExpr{static create(e,t=null){const s=CONSTANT_VALUES.get(e);return typeof s=="boolean"?s?ContextKeyFalseExpr.INSTANCE:ContextKeyTrueExpr.INSTANCE:new ContextKeyNotExpr(e,t)}constructor(e,t){this.key=e,this.negated=t,this.type=3}cmp(e){return e.type!==this.type?this.type-e.type:cmp1(this.key,e.key)}equals(e){return e.type===this.type?this.key===e.key:!1}substituteConstants(){const e=CONSTANT_VALUES.get(this.key);return typeof e=="boolean"?e?ContextKeyFalseExpr.INSTANCE:ContextKeyTrueExpr.INSTANCE:this}evaluate(e){return!e.getValue(this.key)}serialize(){return`!${this.key}`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeyDefinedExpr.create(this.key,this)),this.negated}}function withFloatOrStr(a,e){if(typeof a=="string"){const t=parseFloat(a);isNaN(t)||(a=t)}return typeof a=="string"||typeof a=="number"?e(a):ContextKeyFalseExpr.INSTANCE}class ContextKeyGreaterExpr{static create(e,t,s=null){return withFloatOrStr(t,o=>new ContextKeyGreaterExpr(e,o,s))}constructor(e,t,s){this.key=e,this.value=t,this.negated=s,this.type=12}cmp(e){return e.type!==this.type?this.type-e.type:cmp2(this.key,this.value,e.key,e.value)}equals(e){return e.type===this.type?this.key===e.key&&this.value===e.value:!1}substituteConstants(){return this}evaluate(e){return typeof this.value=="string"?!1:parseFloat(e.getValue(this.key))>this.value}serialize(){return`${this.key} > ${this.value}`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeySmallerEqualsExpr.create(this.key,this.value,this)),this.negated}}class ContextKeyGreaterEqualsExpr{static create(e,t,s=null){return withFloatOrStr(t,o=>new ContextKeyGreaterEqualsExpr(e,o,s))}constructor(e,t,s){this.key=e,this.value=t,this.negated=s,this.type=13}cmp(e){return e.type!==this.type?this.type-e.type:cmp2(this.key,this.value,e.key,e.value)}equals(e){return e.type===this.type?this.key===e.key&&this.value===e.value:!1}substituteConstants(){return this}evaluate(e){return typeof this.value=="string"?!1:parseFloat(e.getValue(this.key))>=this.value}serialize(){return`${this.key} >= ${this.value}`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeySmallerExpr.create(this.key,this.value,this)),this.negated}}class ContextKeySmallerExpr{static create(e,t,s=null){return withFloatOrStr(t,o=>new ContextKeySmallerExpr(e,o,s))}constructor(e,t,s){this.key=e,this.value=t,this.negated=s,this.type=14}cmp(e){return e.type!==this.type?this.type-e.type:cmp2(this.key,this.value,e.key,e.value)}equals(e){return e.type===this.type?this.key===e.key&&this.value===e.value:!1}substituteConstants(){return this}evaluate(e){return typeof this.value=="string"?!1:parseFloat(e.getValue(this.key))<this.value}serialize(){return`${this.key} < ${this.value}`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeyGreaterEqualsExpr.create(this.key,this.value,this)),this.negated}}class ContextKeySmallerEqualsExpr{static create(e,t,s=null){return withFloatOrStr(t,o=>new ContextKeySmallerEqualsExpr(e,o,s))}constructor(e,t,s){this.key=e,this.value=t,this.negated=s,this.type=15}cmp(e){return e.type!==this.type?this.type-e.type:cmp2(this.key,this.value,e.key,e.value)}equals(e){return e.type===this.type?this.key===e.key&&this.value===e.value:!1}substituteConstants(){return this}evaluate(e){return typeof this.value=="string"?!1:parseFloat(e.getValue(this.key))<=this.value}serialize(){return`${this.key} <= ${this.value}`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeyGreaterExpr.create(this.key,this.value,this)),this.negated}}class ContextKeyRegexExpr{static create(e,t){return new ContextKeyRegexExpr(e,t)}constructor(e,t){this.key=e,this.regexp=t,this.type=7,this.negated=null}cmp(e){if(e.type!==this.type)return this.type-e.type;if(this.key<e.key)return-1;if(this.key>e.key)return 1;const t=this.regexp?this.regexp.source:"",s=e.regexp?e.regexp.source:"";return t<s?-1:t>s?1:0}equals(e){if(e.type===this.type){const t=this.regexp?this.regexp.source:"",s=e.regexp?e.regexp.source:"";return this.key===e.key&&t===s}return!1}substituteConstants(){return this}evaluate(e){const t=e.getValue(this.key);return this.regexp?this.regexp.test(t):!1}serialize(){const e=this.regexp?`/${this.regexp.source}/${this.regexp.flags}`:"/invalid/";return`${this.key} =~ ${e}`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeyNotRegexExpr.create(this)),this.negated}}class ContextKeyNotRegexExpr{static create(e){return new ContextKeyNotRegexExpr(e)}constructor(e){this._actual=e,this.type=8}cmp(e){return e.type!==this.type?this.type-e.type:this._actual.cmp(e._actual)}equals(e){return e.type===this.type?this._actual.equals(e._actual):!1}substituteConstants(){return this}evaluate(e){return!this._actual.evaluate(e)}serialize(){return`!(${this._actual.serialize()})`}keys(){return this._actual.keys()}negate(){return this._actual}}function eliminateConstantsInArray(a){let e=null;for(let t=0,s=a.length;t<s;t++){const o=a[t].substituteConstants();if(a[t]!==o&&e===null){e=[];for(let r=0;r<t;r++)e[r]=a[r]}e!==null&&(e[t]=o)}return e===null?a:e}class ContextKeyAndExpr{static create(e,t,s){return ContextKeyAndExpr._normalizeArr(e,t,s)}constructor(e,t){this.expr=e,this.negated=t,this.type=6}cmp(e){if(e.type!==this.type)return this.type-e.type;if(this.expr.length<e.expr.length)return-1;if(this.expr.length>e.expr.length)return 1;for(let t=0,s=this.expr.length;t<s;t++){const o=cmp(this.expr[t],e.expr[t]);if(o!==0)return o}return 0}equals(e){if(e.type===this.type){if(this.expr.length!==e.expr.length)return!1;for(let t=0,s=this.expr.length;t<s;t++)if(!this.expr[t].equals(e.expr[t]))return!1;return!0}return!1}substituteConstants(){const e=eliminateConstantsInArray(this.expr);return e===this.expr?this:ContextKeyAndExpr.create(e,this.negated,!1)}evaluate(e){for(let t=0,s=this.expr.length;t<s;t++)if(!this.expr[t].evaluate(e))return!1;return!0}static _normalizeArr(e,t,s){const o=[];let r=!1;for(const l of e)if(l){if(l.type===1){r=!0;continue}if(l.type===0)return ContextKeyFalseExpr.INSTANCE;if(l.type===6){o.push(...l.expr);continue}o.push(l)}if(o.length===0&&r)return ContextKeyTrueExpr.INSTANCE;if(o.length!==0){if(o.length===1)return o[0];o.sort(cmp);for(let l=1;l<o.length;l++)o[l-1].equals(o[l])&&(o.splice(l,1),l--);if(o.length===1)return o[0];for(;o.length>1;){const l=o[o.length-1];if(l.type!==9)break;o.pop();const c=o.pop(),d=o.length===0,u=ContextKeyOrExpr.create(l.expr.map(g=>ContextKeyAndExpr.create([g,c],null,s)),null,d);u&&(o.push(u),o.sort(cmp))}if(o.length===1)return o[0];if(s){for(let l=0;l<o.length;l++)for(let c=l+1;c<o.length;c++)if(o[l].negate().equals(o[c]))return ContextKeyFalseExpr.INSTANCE;if(o.length===1)return o[0]}return new ContextKeyAndExpr(o,t)}}serialize(){return this.expr.map(e=>e.serialize()).join(" && ")}keys(){const e=[];for(const t of this.expr)e.push(...t.keys());return e}negate(){if(!this.negated){const e=[];for(const t of this.expr)e.push(t.negate());this.negated=ContextKeyOrExpr.create(e,this,!0)}return this.negated}}class ContextKeyOrExpr{static create(e,t,s){return ContextKeyOrExpr._normalizeArr(e,t,s)}constructor(e,t){this.expr=e,this.negated=t,this.type=9}cmp(e){if(e.type!==this.type)return this.type-e.type;if(this.expr.length<e.expr.length)return-1;if(this.expr.length>e.expr.length)return 1;for(let t=0,s=this.expr.length;t<s;t++){const o=cmp(this.expr[t],e.expr[t]);if(o!==0)return o}return 0}equals(e){if(e.type===this.type){if(this.expr.length!==e.expr.length)return!1;for(let t=0,s=this.expr.length;t<s;t++)if(!this.expr[t].equals(e.expr[t]))return!1;return!0}return!1}substituteConstants(){const e=eliminateConstantsInArray(this.expr);return e===this.expr?this:ContextKeyOrExpr.create(e,this.negated,!1)}evaluate(e){for(let t=0,s=this.expr.length;t<s;t++)if(this.expr[t].evaluate(e))return!0;return!1}static _normalizeArr(e,t,s){let o=[],r=!1;if(e){for(let l=0,c=e.length;l<c;l++){const d=e[l];if(d){if(d.type===0){r=!0;continue}if(d.type===1)return ContextKeyTrueExpr.INSTANCE;if(d.type===9){o=o.concat(d.expr);continue}o.push(d)}}if(o.length===0&&r)return ContextKeyFalseExpr.INSTANCE;o.sort(cmp)}if(o.length!==0){if(o.length===1)return o[0];for(let l=1;l<o.length;l++)o[l-1].equals(o[l])&&(o.splice(l,1),l--);if(o.length===1)return o[0];if(s){for(let l=0;l<o.length;l++)for(let c=l+1;c<o.length;c++)if(o[l].negate().equals(o[c]))return ContextKeyTrueExpr.INSTANCE;if(o.length===1)return o[0]}return new ContextKeyOrExpr(o,t)}}serialize(){return this.expr.map(e=>e.serialize()).join(" || ")}keys(){const e=[];for(const t of this.expr)e.push(...t.keys());return e}negate(){if(!this.negated){const e=[];for(const t of this.expr)e.push(t.negate());for(;e.length>1;){const t=e.shift(),s=e.shift(),o=[];for(const r of getTerminals(t))for(const l of getTerminals(s))o.push(ContextKeyAndExpr.create([r,l],null,!1));e.unshift(ContextKeyOrExpr.create(o,null,!1))}this.negated=ContextKeyOrExpr.create(e,this,!0)}return this.negated}}const Jt=class Jt extends ContextKeyDefinedExpr{static all(){return Jt._info.values()}constructor(e,t,s){super(e,null),this._defaultValue=t,typeof s=="object"?Jt._info.push({...s,key:e}):s!==!0&&Jt._info.push({key:e,description:s,type:t!=null?typeof t:void 0})}bindTo(e){return e.createKey(this.key,this._defaultValue)}getValue(e){return e.getContextKeyValue(this.key)}toNegated(){return this.negate()}isEqualTo(e){return ContextKeyEqualsExpr.create(this.key,e)}};Jt._info=[];let RawContextKey=Jt;const IContextKeyService=createDecorator("contextKeyService");function cmp1(a,e){return a<e?-1:a>e?1:0}function cmp2(a,e,t,s){return a<t?-1:a>t?1:e<s?-1:e>s?1:0}function implies(a,e){if(a.type===0||e.type===1)return!0;if(a.type===9)return e.type===9?allElementsIncluded(a.expr,e.expr):!1;if(e.type===9){for(const t of e.expr)if(implies(a,t))return!0;return!1}if(a.type===6){if(e.type===6)return allElementsIncluded(e.expr,a.expr);for(const t of a.expr)if(implies(t,e))return!0;return!1}return a.equals(e)}function allElementsIncluded(a,e){let t=0,s=0;for(;t<a.length&&s<e.length;){const o=a[t].cmp(e[s]);if(o<0)return!1;o===0&&t++,s++}return t===a.length}function getTerminals(a){return a.type===9?a.expr:[a]}class RegistryImpl{constructor(){this.data=new Map}add(e,t){ok(isString$1(e)),ok(isObject(t)),ok(!this.data.has(e),"There is already an extension with this id"),this.data.set(e,t)}as(e){return this.data.get(e)||null}dispose(){this.data.forEach(e=>{isFunction(e.dispose)&&e.dispose()}),this.data.clear()}}const Registry=new RegistryImpl;class KeybindingsRegistryImpl{constructor(){this._coreKeybindings=new LinkedList,this._extensionKeybindings=[],this._cachedMergedKeybindings=null}static bindToCurrentPlatform(e){if(OS===1){if(e&&e.win)return e.win}else if(OS===2){if(e&&e.mac)return e.mac}else if(e&&e.linux)return e.linux;return e}registerKeybindingRule(e){const t=KeybindingsRegistryImpl.bindToCurrentPlatform(e),s=new DisposableStore;if(t&&t.primary){const o=decodeKeybinding(t.primary,OS);o&&s.add(this._registerDefaultKeybinding(o,e.id,e.args,e.weight,0,e.when))}if(t&&Array.isArray(t.secondary))for(let o=0,r=t.secondary.length;o<r;o++){const l=t.secondary[o],c=decodeKeybinding(l,OS);c&&s.add(this._registerDefaultKeybinding(c,e.id,e.args,e.weight,-o-1,e.when))}return s}registerCommandAndKeybindingRule(e){return combinedDisposable(this.registerKeybindingRule(e),CommandsRegistry.registerCommand(e))}_registerDefaultKeybinding(e,t,s,o,r,l){const c=this._coreKeybindings.push({keybinding:e,command:t,commandArgs:s,when:l,weight1:o,weight2:r,extensionId:null,isBuiltinExtension:!1});return this._cachedMergedKeybindings=null,toDisposable(()=>{c(),this._cachedMergedKeybindings=null})}getDefaultKeybindings(){return this._cachedMergedKeybindings||(this._cachedMergedKeybindings=Array.from(this._coreKeybindings).concat(this._extensionKeybindings),this._cachedMergedKeybindings.sort(sorter)),this._cachedMergedKeybindings.slice(0)}}const KeybindingsRegistry=new KeybindingsRegistryImpl,Extensions$9={EditorModes:"platform.keybindingsRegistry"};Registry.add(Extensions$9.EditorModes,KeybindingsRegistry);function sorter(a,e){if(a.weight1!==e.weight1)return a.weight1-e.weight1;if(a.command&&e.command){if(a.command<e.command)return-1;if(a.command>e.command)return 1}return a.weight2-e.weight2}var __decorate$2Z=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2S=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},MenuItemAction_1;function isIMenuItem(a){return a.command!==void 0}function isISubmenuItem(a){return a.submenu!==void 0}const T=class T{constructor(e){if(T._instances.has(e))throw new TypeError(`MenuId with identifier '${e}' already exists. Use MenuId.for(ident) or a unique identifier`);T._instances.set(e,this),this.id=e}};T._instances=new Map,T.CommandPalette=new T("CommandPalette"),T.DebugBreakpointsContext=new T("DebugBreakpointsContext"),T.DebugCallStackContext=new T("DebugCallStackContext"),T.DebugConsoleContext=new T("DebugConsoleContext"),T.DebugVariablesContext=new T("DebugVariablesContext"),T.NotebookVariablesContext=new T("NotebookVariablesContext"),T.DebugHoverContext=new T("DebugHoverContext"),T.DebugWatchContext=new T("DebugWatchContext"),T.DebugToolBar=new T("DebugToolBar"),T.DebugToolBarStop=new T("DebugToolBarStop"),T.DebugDisassemblyContext=new T("DebugDisassemblyContext"),T.DebugCallStackToolbar=new T("DebugCallStackToolbar"),T.DebugCreateConfiguration=new T("DebugCreateConfiguration"),T.EditorContext=new T("EditorContext"),T.SimpleEditorContext=new T("SimpleEditorContext"),T.EditorContent=new T("EditorContent"),T.EditorLineNumberContext=new T("EditorLineNumberContext"),T.EditorContextCopy=new T("EditorContextCopy"),T.EditorContextPeek=new T("EditorContextPeek"),T.EditorContextShare=new T("EditorContextShare"),T.EditorTitle=new T("EditorTitle"),T.CompactWindowEditorTitle=new T("CompactWindowEditorTitle"),T.EditorTitleRun=new T("EditorTitleRun"),T.EditorTitleContext=new T("EditorTitleContext"),T.EditorTitleContextShare=new T("EditorTitleContextShare"),T.EmptyEditorGroup=new T("EmptyEditorGroup"),T.EmptyEditorGroupContext=new T("EmptyEditorGroupContext"),T.EditorTabsBarContext=new T("EditorTabsBarContext"),T.EditorTabsBarShowTabsSubmenu=new T("EditorTabsBarShowTabsSubmenu"),T.EditorTabsBarShowTabsZenModeSubmenu=new T("EditorTabsBarShowTabsZenModeSubmenu"),T.EditorActionsPositionSubmenu=new T("EditorActionsPositionSubmenu"),T.EditorSplitMoveSubmenu=new T("EditorSplitMoveSubmenu"),T.ExplorerContext=new T("ExplorerContext"),T.ExplorerContextShare=new T("ExplorerContextShare"),T.ExtensionContext=new T("ExtensionContext"),T.ExtensionEditorContextMenu=new T("ExtensionEditorContextMenu"),T.GlobalActivity=new T("GlobalActivity"),T.CommandCenter=new T("CommandCenter"),T.CommandCenterCenter=new T("CommandCenterCenter"),T.LayoutControlMenuSubmenu=new T("LayoutControlMenuSubmenu"),T.LayoutControlMenu=new T("LayoutControlMenu"),T.MenubarMainMenu=new T("MenubarMainMenu"),T.MenubarAppearanceMenu=new T("MenubarAppearanceMenu"),T.MenubarDebugMenu=new T("MenubarDebugMenu"),T.MenubarEditMenu=new T("MenubarEditMenu"),T.MenubarCopy=new T("MenubarCopy"),T.MenubarFileMenu=new T("MenubarFileMenu"),T.MenubarGoMenu=new T("MenubarGoMenu"),T.MenubarHelpMenu=new T("MenubarHelpMenu"),T.MenubarLayoutMenu=new T("MenubarLayoutMenu"),T.MenubarNewBreakpointMenu=new T("MenubarNewBreakpointMenu"),T.PanelAlignmentMenu=new T("PanelAlignmentMenu"),T.PanelPositionMenu=new T("PanelPositionMenu"),T.ActivityBarPositionMenu=new T("ActivityBarPositionMenu"),T.MenubarPreferencesMenu=new T("MenubarPreferencesMenu"),T.MenubarRecentMenu=new T("MenubarRecentMenu"),T.MenubarSelectionMenu=new T("MenubarSelectionMenu"),T.MenubarShare=new T("MenubarShare"),T.MenubarSwitchEditorMenu=new T("MenubarSwitchEditorMenu"),T.MenubarSwitchGroupMenu=new T("MenubarSwitchGroupMenu"),T.MenubarTerminalMenu=new T("MenubarTerminalMenu"),T.MenubarTerminalSuggestStatusMenu=new T("MenubarTerminalSuggestStatusMenu"),T.MenubarViewMenu=new T("MenubarViewMenu"),T.MenubarHomeMenu=new T("MenubarHomeMenu"),T.OpenEditorsContext=new T("OpenEditorsContext"),T.OpenEditorsContextShare=new T("OpenEditorsContextShare"),T.ProblemsPanelContext=new T("ProblemsPanelContext"),T.SCMInputBox=new T("SCMInputBox"),T.SCMChangeContext=new T("SCMChangeContext"),T.SCMResourceContext=new T("SCMResourceContext"),T.SCMResourceContextShare=new T("SCMResourceContextShare"),T.SCMResourceFolderContext=new T("SCMResourceFolderContext"),T.SCMResourceGroupContext=new T("SCMResourceGroupContext"),T.SCMSourceControl=new T("SCMSourceControl"),T.SCMSourceControlInline=new T("SCMSourceControlInline"),T.SCMSourceControlTitle=new T("SCMSourceControlTitle"),T.SCMHistoryTitle=new T("SCMHistoryTitle"),T.SCMHistoryItemContext=new T("SCMHistoryItemContext"),T.SCMHistoryItemChangeContext=new T("SCMHistoryItemChangeContext"),T.SCMHistoryItemHover=new T("SCMHistoryItemHover"),T.SCMHistoryItemRefContext=new T("SCMHistoryItemRefContext"),T.SCMQuickDiffDecorations=new T("SCMQuickDiffDecorations"),T.SCMTitle=new T("SCMTitle"),T.SearchContext=new T("SearchContext"),T.SearchActionMenu=new T("SearchActionContext"),T.StatusBarWindowIndicatorMenu=new T("StatusBarWindowIndicatorMenu"),T.StatusBarRemoteIndicatorMenu=new T("StatusBarRemoteIndicatorMenu"),T.StickyScrollContext=new T("StickyScrollContext"),T.TestItem=new T("TestItem"),T.TestItemGutter=new T("TestItemGutter"),T.TestProfilesContext=new T("TestProfilesContext"),T.TestMessageContext=new T("TestMessageContext"),T.TestMessageContent=new T("TestMessageContent"),T.TestPeekElement=new T("TestPeekElement"),T.TestPeekTitle=new T("TestPeekTitle"),T.TestCallStack=new T("TestCallStack"),T.TestCoverageFilterItem=new T("TestCoverageFilterItem"),T.TouchBarContext=new T("TouchBarContext"),T.TitleBar=new T("TitleBar"),T.TitleBarContext=new T("TitleBarContext"),T.TitleBarTitleContext=new T("TitleBarTitleContext"),T.TunnelContext=new T("TunnelContext"),T.TunnelPrivacy=new T("TunnelPrivacy"),T.TunnelProtocol=new T("TunnelProtocol"),T.TunnelPortInline=new T("TunnelInline"),T.TunnelTitle=new T("TunnelTitle"),T.TunnelLocalAddressInline=new T("TunnelLocalAddressInline"),T.TunnelOriginInline=new T("TunnelOriginInline"),T.ViewItemContext=new T("ViewItemContext"),T.ViewContainerTitle=new T("ViewContainerTitle"),T.ViewContainerTitleContext=new T("ViewContainerTitleContext"),T.ViewTitle=new T("ViewTitle"),T.ViewTitleContext=new T("ViewTitleContext"),T.CommentEditorActions=new T("CommentEditorActions"),T.CommentThreadTitle=new T("CommentThreadTitle"),T.CommentThreadActions=new T("CommentThreadActions"),T.CommentThreadAdditionalActions=new T("CommentThreadAdditionalActions"),T.CommentThreadTitleContext=new T("CommentThreadTitleContext"),T.CommentThreadCommentContext=new T("CommentThreadCommentContext"),T.CommentTitle=new T("CommentTitle"),T.CommentActions=new T("CommentActions"),T.CommentsViewThreadActions=new T("CommentsViewThreadActions"),T.InteractiveToolbar=new T("InteractiveToolbar"),T.InteractiveCellTitle=new T("InteractiveCellTitle"),T.InteractiveCellDelete=new T("InteractiveCellDelete"),T.InteractiveCellExecute=new T("InteractiveCellExecute"),T.InteractiveInputExecute=new T("InteractiveInputExecute"),T.InteractiveInputConfig=new T("InteractiveInputConfig"),T.ReplInputExecute=new T("ReplInputExecute"),T.IssueReporter=new T("IssueReporter"),T.NotebookToolbar=new T("NotebookToolbar"),T.NotebookToolbarContext=new T("NotebookToolbarContext"),T.NotebookStickyScrollContext=new T("NotebookStickyScrollContext"),T.NotebookCellTitle=new T("NotebookCellTitle"),T.NotebookCellDelete=new T("NotebookCellDelete"),T.NotebookCellInsert=new T("NotebookCellInsert"),T.NotebookCellBetween=new T("NotebookCellBetween"),T.NotebookCellListTop=new T("NotebookCellTop"),T.NotebookCellExecute=new T("NotebookCellExecute"),T.NotebookCellExecuteGoTo=new T("NotebookCellExecuteGoTo"),T.NotebookCellExecutePrimary=new T("NotebookCellExecutePrimary"),T.NotebookDiffCellInputTitle=new T("NotebookDiffCellInputTitle"),T.NotebookDiffDocumentMetadata=new T("NotebookDiffDocumentMetadata"),T.NotebookDiffCellMetadataTitle=new T("NotebookDiffCellMetadataTitle"),T.NotebookDiffCellOutputsTitle=new T("NotebookDiffCellOutputsTitle"),T.NotebookOutputToolbar=new T("NotebookOutputToolbar"),T.NotebookOutlineFilter=new T("NotebookOutlineFilter"),T.NotebookOutlineActionMenu=new T("NotebookOutlineActionMenu"),T.NotebookEditorLayoutConfigure=new T("NotebookEditorLayoutConfigure"),T.NotebookKernelSource=new T("NotebookKernelSource"),T.BulkEditTitle=new T("BulkEditTitle"),T.BulkEditContext=new T("BulkEditContext"),T.TimelineItemContext=new T("TimelineItemContext"),T.TimelineTitle=new T("TimelineTitle"),T.TimelineTitleContext=new T("TimelineTitleContext"),T.TimelineFilterSubMenu=new T("TimelineFilterSubMenu"),T.AccountsContext=new T("AccountsContext"),T.SidebarTitle=new T("SidebarTitle"),T.PanelTitle=new T("PanelTitle"),T.AuxiliaryBarTitle=new T("AuxiliaryBarTitle"),T.TerminalInstanceContext=new T("TerminalInstanceContext"),T.TerminalEditorInstanceContext=new T("TerminalEditorInstanceContext"),T.TerminalNewDropdownContext=new T("TerminalNewDropdownContext"),T.TerminalTabContext=new T("TerminalTabContext"),T.TerminalTabEmptyAreaContext=new T("TerminalTabEmptyAreaContext"),T.TerminalStickyScrollContext=new T("TerminalStickyScrollContext"),T.WebviewContext=new T("WebviewContext"),T.InlineCompletionsActions=new T("InlineCompletionsActions"),T.InlineEditsActions=new T("InlineEditsActions"),T.NewFile=new T("NewFile"),T.MergeInput1Toolbar=new T("MergeToolbar1Toolbar"),T.MergeInput2Toolbar=new T("MergeToolbar2Toolbar"),T.MergeBaseToolbar=new T("MergeBaseToolbar"),T.MergeInputResultToolbar=new T("MergeToolbarResultToolbar"),T.InlineSuggestionToolbar=new T("InlineSuggestionToolbar"),T.InlineEditToolbar=new T("InlineEditToolbar"),T.ChatContext=new T("ChatContext"),T.ChatCodeBlock=new T("ChatCodeblock"),T.ChatCompareBlock=new T("ChatCompareBlock"),T.ChatMessageTitle=new T("ChatMessageTitle"),T.ChatHistory=new T("ChatHistory"),T.ChatWelcomeHistoryContext=new T("ChatWelcomeHistoryContext"),T.ChatMessageFooter=new T("ChatMessageFooter"),T.ChatExecute=new T("ChatExecute"),T.ChatExecuteSecondary=new T("ChatExecuteSecondary"),T.ChatInput=new T("ChatInput"),T.ChatInputSide=new T("ChatInputSide"),T.ChatModePicker=new T("ChatModePicker"),T.ChatEditingWidgetToolbar=new T("ChatEditingWidgetToolbar"),T.ChatEditingEditorContent=new T("ChatEditingEditorContent"),T.ChatEditingEditorHunk=new T("ChatEditingEditorHunk"),T.ChatEditingDeletedNotebookCell=new T("ChatEditingDeletedNotebookCell"),T.ChatInputAttachmentToolbar=new T("ChatInputAttachmentToolbar"),T.ChatEditingWidgetModifiedFilesToolbar=new T("ChatEditingWidgetModifiedFilesToolbar"),T.ChatInputResourceAttachmentContext=new T("ChatInputResourceAttachmentContext"),T.ChatInputSymbolAttachmentContext=new T("ChatInputSymbolAttachmentContext"),T.ChatInlineResourceAnchorContext=new T("ChatInlineResourceAnchorContext"),T.ChatInlineSymbolAnchorContext=new T("ChatInlineSymbolAnchorContext"),T.ChatMessageCheckpoint=new T("ChatMessageCheckpoint"),T.ChatMessageRestoreCheckpoint=new T("ChatMessageRestoreCheckpoint"),T.ChatEditingCodeBlockContext=new T("ChatEditingCodeBlockContext"),T.ChatTitleBarMenu=new T("ChatTitleBarMenu"),T.ChatAttachmentsContext=new T("ChatAttachmentsContext"),T.ChatToolOutputResourceToolbar=new T("ChatToolOutputResourceToolbar"),T.ChatTextEditorMenu=new T("ChatTextEditorMenu"),T.ChatToolOutputResourceContext=new T("ChatToolOutputResourceContext"),T.ChatMultiDiffContext=new T("ChatMultiDiffContext"),T.ChatSessionsMenu=new T("ChatSessionsMenu"),T.ChatConfirmationMenu=new T("ChatConfirmationMenu"),T.AccessibleView=new T("AccessibleView"),T.MultiDiffEditorFileToolbar=new T("MultiDiffEditorFileToolbar"),T.DiffEditorHunkToolbar=new T("DiffEditorHunkToolbar"),T.DiffEditorSelectionToolbar=new T("DiffEditorSelectionToolbar");let MenuId=T;const IMenuService=createDecorator("menuService"),gn=class gn{static for(e){let t=this._all.get(e);return t||(t=new gn(e),this._all.set(e,t)),t}static merge(e){const t=new Set;for(const s of e)s instanceof gn&&t.add(s.id);return t}constructor(e){this.id=e,this.has=t=>t===e}};gn._all=new Map;let MenuRegistryChangeEvent=gn;const MenuRegistry=new class{constructor(){this._commands=new Map,this._menuItems=new Map,this._onDidChangeMenu=new MicrotaskEmitter({merge:MenuRegistryChangeEvent.merge}),this.onDidChangeMenu=this._onDidChangeMenu.event}addCommand(a){return this._commands.set(a.id,a),this._onDidChangeMenu.fire(MenuRegistryChangeEvent.for(MenuId.CommandPalette)),toDisposable(()=>{this._commands.delete(a.id)&&this._onDidChangeMenu.fire(MenuRegistryChangeEvent.for(MenuId.CommandPalette))})}getCommand(a){return this._commands.get(a)}getCommands(){const a=new Map;return this._commands.forEach((e,t)=>a.set(t,e)),a}appendMenuItem(a,e){let t=this._menuItems.get(a);t||(t=new LinkedList,this._menuItems.set(a,t));const s=t.push(e);return this._onDidChangeMenu.fire(MenuRegistryChangeEvent.for(a)),toDisposable(()=>{s(),this._onDidChangeMenu.fire(MenuRegistryChangeEvent.for(a))})}appendMenuItems(a){const e=new DisposableStore;for(const{id:t,item:s}of a)e.add(this.appendMenuItem(t,s));return e}getMenuItems(a){let e;return this._menuItems.has(a)?e=[...this._menuItems.get(a)]:e=[],a===MenuId.CommandPalette&&this._appendImplicitItems(e),e}_appendImplicitItems(a){const e=new Set;for(const t of a)isIMenuItem(t)&&(e.add(t.command.id),t.alt&&e.add(t.alt.id));this._commands.forEach((t,s)=>{e.has(s)||a.push({command:t})})}};class SubmenuItemAction extends SubmenuAction{constructor(e,t,s){super(`submenuitem.${e.submenu.id}`,typeof e.title=="string"?e.title:e.title.value,s,"submenu"),this.item=e,this.hideActions=t}}let MenuItemAction=MenuItemAction_1=class{static label(e,t){return t!=null&&t.renderShortTitle&&e.shortTitle?typeof e.shortTitle=="string"?e.shortTitle:e.shortTitle.value:typeof e.title=="string"?e.title:e.title.value}constructor(e,t,s,o,r,l,c){var u;this.hideActions=o,this.menuKeybinding=r,this._commandService=c,this.id=e.id,this.label=MenuItemAction_1.label(e,s),this.tooltip=(typeof e.tooltip=="string"?e.tooltip:(u=e.tooltip)==null?void 0:u.value)??"",this.enabled=!e.precondition||l.contextMatchesRules(e.precondition),this.checked=void 0;let d;if(e.toggled){const g=e.toggled.condition?e.toggled:{condition:e.toggled};this.checked=l.contextMatchesRules(g.condition),this.checked&&g.tooltip&&(this.tooltip=typeof g.tooltip=="string"?g.tooltip:g.tooltip.value),this.checked&&ThemeIcon.isThemeIcon(g.icon)&&(d=g.icon),this.checked&&g.title&&(this.label=typeof g.title=="string"?g.title:g.title.value)}d||(d=ThemeIcon.isThemeIcon(e.icon)?e.icon:void 0),this.item=e,this.alt=t?new MenuItemAction_1(t,void 0,s,o,void 0,l,c):void 0,this._options=s,this.class=d&&ThemeIcon.asClassName(d)}run(...e){var s,o;let t=[];return(s=this._options)!=null&&s.arg&&(t=[...t,this._options.arg]),(o=this._options)!=null&&o.shouldForwardArgs&&(t=[...t,...e]),this._commandService.executeCommand(this.id,...t)}};MenuItemAction=MenuItemAction_1=__decorate$2Z([__param$2S(5,IContextKeyService),__param$2S(6,ICommandService)],MenuItemAction);class Action2{constructor(e){this.desc=e}}function registerAction2(a){const e=[],t=new a,{f1:s,menu:o,keybinding:r,...l}=t.desc;if(CommandsRegistry.getCommand(l.id))throw new Error(`Cannot register two commands with the same id: ${l.id}`);if(e.push(CommandsRegistry.registerCommand({id:l.id,handler:(c,...d)=>t.run(c,...d),metadata:l.metadata??{description:t.desc.title}})),Array.isArray(o))for(const c of o)e.push(MenuRegistry.appendMenuItem(c.id,{command:{...l,precondition:c.precondition===null?void 0:l.precondition},...c}));else o&&e.push(MenuRegistry.appendMenuItem(o.id,{command:{...l,precondition:o.precondition===null?void 0:l.precondition},...o}));if(s&&(e.push(MenuRegistry.appendMenuItem(MenuId.CommandPalette,{command:l,when:l.precondition})),e.push(MenuRegistry.addCommand(l))),Array.isArray(r))for(const c of r)e.push(KeybindingsRegistry.registerKeybindingRule({...c,id:l.id,when:l.precondition?ContextKeyExpr.and(l.precondition,c.when):c.when}));else r&&e.push(KeybindingsRegistry.registerKeybindingRule({...r,id:l.id,when:l.precondition?ContextKeyExpr.and(l.precondition,r.when):r.when}));return{dispose(){dispose(e)}}}const ITelemetryService=createDecorator("telemetryService");var _a$1,_b,_c;class ResourceMapEntry{constructor(e,t){this.uri=e,this.value=t}}function isEntries(a){return Array.isArray(a)}const vt=class vt{constructor(e,t){if(this[_a$1]="ResourceMap",e instanceof vt)this.map=new Map(e.map),this.toKey=t??vt.defaultToKey;else if(isEntries(e)){this.map=new Map,this.toKey=t??vt.defaultToKey;for(const[s,o]of e)this.set(s,o)}else this.map=new Map,this.toKey=e??vt.defaultToKey}set(e,t){return this.map.set(this.toKey(e),new ResourceMapEntry(e,t)),this}get(e){var t;return(t=this.map.get(this.toKey(e)))==null?void 0:t.value}has(e){return this.map.has(this.toKey(e))}get size(){return this.map.size}clear(){this.map.clear()}delete(e){return this.map.delete(this.toKey(e))}forEach(e,t){typeof t<"u"&&(e=e.bind(t));for(const[s,o]of this.map)e(o.value,o.uri,this)}*values(){for(const e of this.map.values())yield e.value}*keys(){for(const e of this.map.values())yield e.uri}*entries(){for(const e of this.map.values())yield[e.uri,e.value]}*[(_a$1=Symbol.toStringTag,Symbol.iterator)](){for(const[,e]of this.map)yield[e.uri,e.value]}};vt.defaultToKey=e=>e.toString();let ResourceMap=vt;class ResourceSet{constructor(e,t){this[_b]="ResourceSet",!e||typeof e=="function"?this._map=new ResourceMap(e):(this._map=new ResourceMap(t),e.forEach(this.add,this))}get size(){return this._map.size}add(e){return this._map.set(e,e),this}clear(){this._map.clear()}delete(e){return this._map.delete(e)}forEach(e,t){this._map.forEach((s,o)=>e.call(t,o,o,this))}has(e){return this._map.has(e)}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.keys()}[(_b=Symbol.toStringTag,Symbol.iterator)](){return this.keys()}}class LinkedMap{constructor(){this[_c]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){var e;return(e=this._head)==null?void 0:e.value}get last(){var e;return(e=this._tail)==null?void 0:e.value}has(e){return this._map.has(e)}get(e,t=0){const s=this._map.get(e);if(s)return t!==0&&this.touch(s,t),s.value}set(e,t,s=0){let o=this._map.get(e);if(o)o.value=t,s!==0&&this.touch(o,s);else{switch(o={key:e,value:t,next:void 0,previous:void 0},s){case 0:this.addItemLast(o);break;case 1:this.addItemFirst(o);break;case 2:this.addItemLast(o);break;default:this.addItemLast(o);break}this._map.set(e,o),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){const t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){const s=this._state;let o=this._head;for(;o;){if(t?e.bind(t)(o.value,o.key,this):e(o.value,o.key,this),this._state!==s)throw new Error("LinkedMap got modified during iteration.");o=o.next}}keys(){const e=this,t=this._state;let s=this._head;const o={[Symbol.iterator](){return o},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(s){const r={value:s.key,done:!1};return s=s.next,r}else return{value:void 0,done:!0}}};return o}values(){const e=this,t=this._state;let s=this._head;const o={[Symbol.iterator](){return o},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(s){const r={value:s.value,done:!1};return s=s.next,r}else return{value:void 0,done:!0}}};return o}entries(){const e=this,t=this._state;let s=this._head;const o={[Symbol.iterator](){return o},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(s){const r={value:[s.key,s.value],done:!1};return s=s.next,r}else return{value:void 0,done:!0}}};return o}[(_c=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,s=this.size;for(;t&&s>e;)this._map.delete(t.key),t=t.next,s--;this._head=t,this._size=s,t&&(t.previous=void 0),this._state++}trimNew(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._tail,s=this.size;for(;t&&s>e;)this._map.delete(t.key),t=t.previous,s--;this._tail=t,this._size=s,t&&(t.next=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{const t=e.next,s=e.previous;if(!t||!s)throw new Error("Invalid list");t.previous=s,s.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==1&&t!==2)){if(t===1){if(e===this._head)return;const s=e.next,o=e.previous;e===this._tail?(o.next=void 0,this._tail=o):(s.previous=o,o.next=s),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===2){if(e===this._tail)return;const s=e.next,o=e.previous;e===this._head?(s.previous=void 0,this._head=s):(s.previous=o,o.next=s),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){const e=[];return this.forEach((t,s)=>{e.push([s,t])}),e}fromJSON(e){this.clear();for(const[t,s]of e)this.set(t,s)}}class Cache extends LinkedMap{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get(e,t=2){return super.get(e,t)}peek(e){return super.get(e,0)}set(e,t){return super.set(e,t,2),this}checkTrim(){this.size>this._limit&&this.trim(Math.round(this._limit*this._ratio))}}class LRUCache extends Cache{constructor(e,t=1){super(e,t)}trim(e){this.trimOld(e)}set(e,t){return super.set(e,t),this.checkTrim(),this}}class BidirectionalMap{constructor(e){if(this._m1=new Map,this._m2=new Map,e)for(const[t,s]of e)this.set(t,s)}clear(){this._m1.clear(),this._m2.clear()}set(e,t){this._m1.set(e,t),this._m2.set(t,e)}get(e){return this._m1.get(e)}getKey(e){return this._m2.get(e)}delete(e){const t=this._m1.get(e);return t===void 0?!1:(this._m1.delete(e),this._m2.delete(t),!0)}keys(){return this._m1.keys()}values(){return this._m1.values()}}class SetMap{constructor(){this.map=new Map}add(e,t){let s=this.map.get(e);s||(s=new Set,this.map.set(e,s)),s.add(t)}delete(e,t){const s=this.map.get(e);s&&(s.delete(t),s.size===0&&this.map.delete(e))}forEach(e,t){const s=this.map.get(e);s&&s.forEach(t)}}class NKeyMap{constructor(){this._data=new Map}set(e,...t){let s=this._data;for(let o=0;o<t.length-1;o++)s.has(t[o])||s.set(t[o],new Map),s=s.get(t[o]);s.set(t[t.length-1],e)}get(...e){let t=this._data;for(let s=0;s<e.length-1;s++){if(!t.has(e[s]))return;t=t.get(e[s])}return t.get(e[e.length-1])}clear(){this._data.clear()}toString(){const e=(t,s)=>{let o="";for(const[r,l]of t)o+=`${"  ".repeat(s)}${r}: `,l instanceof Map?o+=`
`+e(l,s+1):o+=`${l}
`;return o};return e(this._data,0)}}function isPathSeparator(a){return a===47||a===92}function toSlashes(a){return a.replace(/[\\/]/g,posix.sep)}function toPosixPath(a){return a.indexOf("/")===-1&&(a=toSlashes(a)),/^[a-zA-Z]:(\/|$)/.test(a)&&(a="/"+a),a}function getRoot(a,e=posix.sep){if(!a)return"";const t=a.length,s=a.charCodeAt(0);if(isPathSeparator(s)){if(isPathSeparator(a.charCodeAt(1))&&!isPathSeparator(a.charCodeAt(2))){let r=3;const l=r;for(;r<t&&!isPathSeparator(a.charCodeAt(r));r++);if(l!==r&&!isPathSeparator(a.charCodeAt(r+1))){for(r+=1;r<t;r++)if(isPathSeparator(a.charCodeAt(r)))return a.slice(0,r+1).replace(/[\\/]/g,e)}}return e}else if(isWindowsDriveLetter(s)&&a.charCodeAt(1)===58)return isPathSeparator(a.charCodeAt(2))?a.slice(0,2)+e:a.slice(0,2);let o=a.indexOf("://");if(o!==-1){for(o+=3;o<t;o++)if(isPathSeparator(a.charCodeAt(o)))return a.slice(0,o+1)}return""}function isEqualOrParent(a,e,t,s=sep){if(a===e)return!0;if(!a||!e||e.length>a.length)return!1;if(t){if(!startsWithIgnoreCase(a,e))return!1;if(e.length===a.length)return!0;let r=e.length;return e.charAt(e.length-1)===s&&r--,a.charAt(r)===s}return e.charAt(e.length-1)!==s&&(e+=s),a.indexOf(e)===0}function isWindowsDriveLetter(a){return a>=65&&a<=90||a>=97&&a<=122}function hasDriveLetter(a,e=isWindows){return e?isWindowsDriveLetter(a.charCodeAt(0))&&a.charCodeAt(1)===58:!1}function originalFSPath(a){return uriToFsPath(a,!0)}class ExtUri{constructor(e){this._ignorePathCasing=e}compare(e,t,s=!1){return e===t?0:compare(this.getComparisonKey(e,s),this.getComparisonKey(t,s))}isEqual(e,t,s=!1){return e===t?!0:!e||!t?!1:this.getComparisonKey(e,s)===this.getComparisonKey(t,s)}getComparisonKey(e,t=!1){return e.with({path:this._ignorePathCasing(e)?e.path.toLowerCase():void 0,fragment:t?null:void 0}).toString()}isEqualOrParent(e,t,s=!1){if(e.scheme===t.scheme){if(e.scheme===Schemas.file)return isEqualOrParent(originalFSPath(e),originalFSPath(t),this._ignorePathCasing(e))&&e.query===t.query&&(s||e.fragment===t.fragment);if(isEqualAuthority(e.authority,t.authority))return isEqualOrParent(e.path,t.path,this._ignorePathCasing(e),"/")&&e.query===t.query&&(s||e.fragment===t.fragment)}return!1}joinPath(e,...t){return URI.joinPath(e,...t)}basenameOrAuthority(e){return basename(e)||e.authority}basename(e){return posix.basename(e.path)}extname(e){return posix.extname(e.path)}dirname(e){if(e.path.length===0)return e;let t;return e.scheme===Schemas.file?t=URI.file(dirname$1(originalFSPath(e))).path:(t=posix.dirname(e.path),e.authority&&t.length&&t.charCodeAt(0)!==47&&(console.error(`dirname("${e.toString})) resulted in a relative path`),t="/")),e.with({path:t})}normalizePath(e){if(!e.path.length)return e;let t;return e.scheme===Schemas.file?t=URI.file(normalize(originalFSPath(e))).path:t=posix.normalize(e.path),e.with({path:t})}relativePath(e,t){if(e.scheme!==t.scheme||!isEqualAuthority(e.authority,t.authority))return;if(e.scheme===Schemas.file){const r=relative(originalFSPath(e),originalFSPath(t));return isWindows?toSlashes(r):r}let s=e.path||"/";const o=t.path||"/";if(this._ignorePathCasing(e)){let r=0;for(const l=Math.min(s.length,o.length);r<l&&!(s.charCodeAt(r)!==o.charCodeAt(r)&&s.charAt(r).toLowerCase()!==o.charAt(r).toLowerCase());r++);s=o.substr(0,r)+s.substr(r)}return posix.relative(s,o)}resolvePath(e,t){if(e.scheme===Schemas.file){const s=URI.file(resolve$1(originalFSPath(e),t));return e.with({authority:s.authority,path:s.path})}return t=toPosixPath(t),e.with({path:posix.resolve(e.path,t)})}isAbsolutePath(e){return!!e.path&&e.path[0]==="/"}isEqualAuthority(e,t){return e===t||e!==void 0&&t!==void 0&&equalsIgnoreCase(e,t)}hasTrailingPathSeparator(e,t=sep){if(e.scheme===Schemas.file){const s=originalFSPath(e);return s.length>getRoot(s).length&&s[s.length-1]===t}else{const s=e.path;return s.length>1&&s.charCodeAt(s.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(e.fsPath)}}removeTrailingPathSeparator(e,t=sep){return hasTrailingPathSeparator(e,t)?e.with({path:e.path.substr(0,e.path.length-1)}):e}addTrailingPathSeparator(e,t=sep){let s=!1;if(e.scheme===Schemas.file){const o=originalFSPath(e);s=o!==void 0&&o.length===getRoot(o).length&&o[o.length-1]===t}else{t="/";const o=e.path;s=o.length===1&&o.charCodeAt(o.length-1)===47}return!s&&!hasTrailingPathSeparator(e,t)?e.with({path:e.path+"/"}):e}}const extUri=new ExtUri(()=>!1),isEqual=extUri.isEqual.bind(extUri);extUri.isEqualOrParent.bind(extUri);extUri.getComparisonKey.bind(extUri);const basenameOrAuthority=extUri.basenameOrAuthority.bind(extUri),basename=extUri.basename.bind(extUri),extname=extUri.extname.bind(extUri),dirname=extUri.dirname.bind(extUri),joinPath=extUri.joinPath.bind(extUri),normalizePath=extUri.normalizePath.bind(extUri),relativePath=extUri.relativePath.bind(extUri),resolvePath=extUri.resolvePath.bind(extUri);extUri.isAbsolutePath.bind(extUri);const isEqualAuthority=extUri.isEqualAuthority.bind(extUri),hasTrailingPathSeparator=extUri.hasTrailingPathSeparator.bind(extUri);extUri.removeTrailingPathSeparator.bind(extUri);extUri.addTrailingPathSeparator.bind(extUri);var DataUri;(function(a){a.META_DATA_LABEL="label",a.META_DATA_DESCRIPTION="description",a.META_DATA_SIZE="size",a.META_DATA_MIME="mime";function e(t){const s=new Map;t.path.substring(t.path.indexOf(";")+1,t.path.lastIndexOf(";")).split(";").forEach(l=>{const[c,d]=l.split(":");c&&d&&s.set(c,d)});const r=t.path.substring(0,t.path.indexOf(";"));return r&&s.set(a.META_DATA_MIME,r),s}a.parseMetaData=e})(DataUri||(DataUri={}));const ILogService=createDecorator("logService"),ILoggerService=createDecorator("loggerService");var LogLevel;(function(a){a[a.Off=0]="Off",a[a.Trace=1]="Trace",a[a.Debug=2]="Debug",a[a.Info=3]="Info",a[a.Warning=4]="Warning",a[a.Error=5]="Error"})(LogLevel||(LogLevel={}));const DEFAULT_LOG_LEVEL=LogLevel.Info;function canLog(a,e){return a!==LogLevel.Off&&a<=e}class AbstractLogger extends Disposable{constructor(){super(...arguments),this.level=DEFAULT_LOG_LEVEL,this._onDidChangeLogLevel=this._register(new Emitter$1)}get onDidChangeLogLevel(){return this._onDidChangeLogLevel.event}setLevel(e){this.level!==e&&(this.level=e,this._onDidChangeLogLevel.fire(this.level))}getLevel(){return this.level}checkLogLevel(e){return canLog(this.level,e)}canLog(e){return this._store.isDisposed?!1:this.checkLogLevel(e)}}class ConsoleLogger extends AbstractLogger{constructor(e=DEFAULT_LOG_LEVEL,t=!0){super(),this.useColors=t,this.setLevel(e)}trace(e,...t){this.canLog(LogLevel.Trace)&&(this.useColors?console.log("%cTRACE","color: #888",e,...t):console.log(e,...t))}debug(e,...t){this.canLog(LogLevel.Debug)&&(this.useColors?console.log("%cDEBUG","background: #eee; color: #888",e,...t):console.log(e,...t))}info(e,...t){this.canLog(LogLevel.Info)&&(this.useColors?console.log("%c INFO","color: #33f",e,...t):console.log(e,...t))}warn(e,...t){this.canLog(LogLevel.Warning)&&(this.useColors?console.warn("%c WARN","color: #993",e,...t):console.log(e,...t))}error(e,...t){this.canLog(LogLevel.Error)&&(this.useColors?console.error("%c  ERR","color: #f33",e,...t):console.error(e,...t))}}class MultiplexLogger extends AbstractLogger{constructor(e){super(),this.loggers=e,e.length&&this.setLevel(e[0].getLevel())}setLevel(e){for(const t of this.loggers)t.setLevel(e);super.setLevel(e)}trace(e,...t){for(const s of this.loggers)s.trace(e,...t)}debug(e,...t){for(const s of this.loggers)s.debug(e,...t)}info(e,...t){for(const s of this.loggers)s.info(e,...t)}warn(e,...t){for(const s of this.loggers)s.warn(e,...t)}error(e,...t){for(const s of this.loggers)s.error(e,...t)}dispose(){for(const e of this.loggers)e.dispose();super.dispose()}}class AbstractLoggerService extends Disposable{constructor(e,t,s){if(super(),this.logLevel=e,this.logsHome=t,this._loggers=new ResourceMap,this._onDidChangeLoggers=this._register(new Emitter$1),this._onDidChangeVisibility=this._register(new Emitter$1),s)for(const o of s)this._loggers.set(o.resource,{logger:void 0,info:o})}getLoggerEntry(e){return isString$1(e)?[...this._loggers.values()].find(t=>t.info.id===e):this._loggers.get(e)}createLogger(e,t){var d;const s=this.toResource(e),o=isString$1(e)?e:(t==null?void 0:t.id)??hash(s.toString()).toString(16);let r=(d=this._loggers.get(s))==null?void 0:d.logger;const l=(t==null?void 0:t.logLevel)==="always"?LogLevel.Trace:t==null?void 0:t.logLevel;r||(r=this.doCreateLogger(s,l??this.getLogLevel(s)??this.logLevel,{...t,id:o}));const c={logger:r,info:{resource:s,id:o,logLevel:l,name:t==null?void 0:t.name,hidden:t==null?void 0:t.hidden,group:t==null?void 0:t.group,extensionId:t==null?void 0:t.extensionId,when:t==null?void 0:t.when}};return this.registerLogger(c.info),this._loggers.set(s,c),r}toResource(e){return isString$1(e)?joinPath(this.logsHome,`${e}.log`):e}setVisibility(e,t){const s=this.getLoggerEntry(e);s&&t!==!s.info.hidden&&(s.info.hidden=!t,this._loggers.set(s.info.resource,s),this._onDidChangeVisibility.fire([s.info.resource,t]))}getLogLevel(e){var s;let t;return e&&(t=(s=this._loggers.get(e))==null?void 0:s.info.logLevel),t??this.logLevel}registerLogger(e){const t=this._loggers.get(e.resource);t?t.info.hidden!==e.hidden&&this.setVisibility(e.resource,!e.hidden):(this._loggers.set(e.resource,{info:e,logger:void 0}),this._onDidChangeLoggers.fire({added:[e],removed:[]}))}dispose(){this._loggers.forEach(e=>{var t;return(t=e.logger)==null?void 0:t.dispose()}),this._loggers.clear(),super.dispose()}}class NullLogger{constructor(){this.onDidChangeLogLevel=new Emitter$1().event}setLevel(e){}getLevel(){return LogLevel.Info}trace(e,...t){}debug(e,...t){}info(e,...t){}warn(e,...t){}error(e,...t){}dispose(){}}class NullLoggerService extends AbstractLoggerService{constructor(){super(LogLevel.Off,URI.parse("log:///log"))}doCreateLogger(e,t,s){return new NullLogger}}function LogLevelToString(a){switch(a){case LogLevel.Trace:return"trace";case LogLevel.Debug:return"debug";case LogLevel.Info:return"info";case LogLevel.Warning:return"warn";case LogLevel.Error:return"error";case LogLevel.Off:return"off"}}new RawContextKey("logLevel",LogLevelToString(LogLevel.Info));let Command$1=class{constructor(e){this.id=e.id,this.precondition=e.precondition,this._kbOpts=e.kbOpts,this._menuOpts=e.menuOpts,this.metadata=e.metadata}register(){if(Array.isArray(this._menuOpts)?this._menuOpts.forEach(this._registerMenuItem,this):this._menuOpts&&this._registerMenuItem(this._menuOpts),this._kbOpts){const e=Array.isArray(this._kbOpts)?this._kbOpts:[this._kbOpts];for(const t of e){let s=t.kbExpr;this.precondition&&(s?s=ContextKeyExpr.and(s,this.precondition):s=this.precondition);const o={id:this.id,weight:t.weight,args:t.args,when:s,primary:t.primary,secondary:t.secondary,win:t.win,linux:t.linux,mac:t.mac};KeybindingsRegistry.registerKeybindingRule(o)}}CommandsRegistry.registerCommand({id:this.id,handler:(e,t)=>this.runCommand(e,t),metadata:this.metadata})}_registerMenuItem(e){MenuRegistry.appendMenuItem(e.menuId,{group:e.group,command:{id:this.id,title:e.title,icon:e.icon,precondition:this.precondition},when:e.when,order:e.order})}};class MultiCommand extends Command$1{constructor(){super(...arguments),this._implementations=[]}addImplementation(e,t,s,o){return this._implementations.push({priority:e,name:t,implementation:s,when:o}),this._implementations.sort((r,l)=>l.priority-r.priority),{dispose:()=>{for(let r=0;r<this._implementations.length;r++)if(this._implementations[r].implementation===s){this._implementations.splice(r,1);return}}}}runCommand(e,t){const s=e.get(ILogService),o=e.get(IContextKeyService);s.trace(`Executing Command '${this.id}' which has ${this._implementations.length} bound.`);for(const r of this._implementations){if(r.when){const c=o.getContext(getActiveElement());if(!r.when.evaluate(c))continue}const l=r.implementation(e,t);if(l)return s.trace(`Command '${this.id}' was handled by '${r.name}'.`),typeof l=="boolean"?void 0:l}s.trace(`The Command '${this.id}' was not handled by any implementation.`)}}class ProxyCommand extends Command$1{constructor(e,t){super(t),this.command=e}runCommand(e,t){return this.command.runCommand(e,t)}}class EditorCommand extends Command$1{static bindToContribution(e){return class extends EditorCommand{constructor(s){super(s),this._callback=s.handler}runEditorCommand(s,o,r){const l=e(o);l&&this._callback(l,r)}}}static runEditorCommand(e,t,s,o){const r=e.get(ICodeEditorService),l=r.getFocusedCodeEditor()||r.getActiveCodeEditor();if(l)return l.invokeWithinContext(c=>{if(c.get(IContextKeyService).contextMatchesRules(s??void 0))return o(c,l,t)})}runCommand(e,t){return EditorCommand.runEditorCommand(e,t,this.precondition,(s,o,r)=>this.runEditorCommand(s,o,r))}}class EditorAction extends EditorCommand{static convertOptions(e){let t;Array.isArray(e.menuOpts)?t=e.menuOpts:e.menuOpts?t=[e.menuOpts]:t=[];function s(o){return o.menuId||(o.menuId=MenuId.EditorContext),o.title||(o.title=typeof e.label=="string"?e.label:e.label.value),o.when=ContextKeyExpr.and(e.precondition,o.when),o}return Array.isArray(e.contextMenuOpts)?t.push(...e.contextMenuOpts.map(s)):e.contextMenuOpts&&t.push(s(e.contextMenuOpts)),e.menuOpts=t,e}constructor(e){super(EditorAction.convertOptions(e)),typeof e.label=="string"?(this.label=e.label,this.alias=e.alias??e.label):(this.label=e.label.value,this.alias=e.alias??e.label.original)}runEditorCommand(e,t,s){return this.reportTelemetry(e,t),this.run(e,t,s||{})}reportTelemetry(e,t){e.get(ITelemetryService).publicLog2("editorActionInvoked",{name:this.label,id:this.id})}}class MultiEditorAction extends EditorAction{constructor(){super(...arguments),this._implementations=[]}addImplementation(e,t){return this._implementations.push([e,t]),this._implementations.sort((s,o)=>o[0]-s[0]),{dispose:()=>{for(let s=0;s<this._implementations.length;s++)if(this._implementations[s][1]===t){this._implementations.splice(s,1);return}}}}run(e,t,s){for(const o of this._implementations){const r=o[1](e,t,s);if(r)return typeof r=="boolean"?void 0:r}}}class EditorAction2 extends Action2{run(e,...t){const s=e.get(ICodeEditorService),o=s.getFocusedCodeEditor()||s.getActiveCodeEditor();if(o)return o.invokeWithinContext(r=>{var u;const l=r.get(IContextKeyService),c=r.get(ILogService);if(!l.contextMatchesRules(this.desc.precondition??void 0)){c.debug("[EditorAction2] NOT running command because its precondition is FALSE",this.desc.id,(u=this.desc.precondition)==null?void 0:u.serialize());return}return this.runEditorCommand(r,o,...t)})}}function registerModelAndPositionCommand(a,e){CommandsRegistry.registerCommand(a,function(t,...s){const o=t.get(IInstantiationService),[r,l]=s;assertType(URI.isUri(r)),assertType(Position$1.isIPosition(l));const c=t.get(IModelService).getModel(r);if(c){const d=Position$1.lift(l);return o.invokeFunction(e,c,d,...s.slice(2))}return t.get(ITextModelService).createModelReference(r).then(d=>new Promise((u,g)=>{try{const f=o.invokeFunction(e,d.object.textEditorModel,Position$1.lift(l),s.slice(2));u(f)}catch(f){g(f)}}).finally(()=>{d.dispose()}))})}function registerEditorCommand(a){return EditorContributionRegistry.INSTANCE.registerEditorCommand(a),a}function registerEditorAction(a){const e=new a;return EditorContributionRegistry.INSTANCE.registerEditorAction(e),e}function registerMultiEditorAction(a){return EditorContributionRegistry.INSTANCE.registerEditorAction(a),a}function registerInstantiatedEditorAction(a){EditorContributionRegistry.INSTANCE.registerEditorAction(a)}function registerEditorContribution(a,e,t){EditorContributionRegistry.INSTANCE.registerEditorContribution(a,e,t)}var EditorExtensionsRegistry;(function(a){function e(l){return EditorContributionRegistry.INSTANCE.getEditorCommand(l)}a.getEditorCommand=e;function t(){return EditorContributionRegistry.INSTANCE.getEditorActions()}a.getEditorActions=t;function s(){return EditorContributionRegistry.INSTANCE.getEditorContributions()}a.getEditorContributions=s;function o(l){return EditorContributionRegistry.INSTANCE.getEditorContributions().filter(c=>l.indexOf(c.id)>=0)}a.getSomeEditorContributions=o;function r(){return EditorContributionRegistry.INSTANCE.getDiffEditorContributions()}a.getDiffEditorContributions=r})(EditorExtensionsRegistry||(EditorExtensionsRegistry={}));const Extensions$8={EditorCommonContributions:"editor.contributions"},is=class is{constructor(){this.editorContributions=[],this.diffEditorContributions=[],this.editorActions=[],this.editorCommands=Object.create(null)}registerEditorContribution(e,t,s){this.editorContributions.push({id:e,ctor:t,instantiation:s})}getEditorContributions(){return this.editorContributions.slice(0)}getDiffEditorContributions(){return this.diffEditorContributions.slice(0)}registerEditorAction(e){e.register(),this.editorActions.push(e)}getEditorActions(){return this.editorActions}registerEditorCommand(e){e.register(),this.editorCommands[e.id]=e}getEditorCommand(e){return this.editorCommands[e]||null}};is.INSTANCE=new is;let EditorContributionRegistry=is;Registry.add(Extensions$8.EditorCommonContributions,EditorContributionRegistry.INSTANCE);function registerCommand$3(a){return a.register(),a}const UndoCommand=registerCommand$3(new MultiCommand({id:"undo",precondition:void 0,kbOpts:{weight:0,primary:2104},menuOpts:[{menuId:MenuId.MenubarEditMenu,group:"1_do",title:localize(64,"&&Undo"),order:1},{menuId:MenuId.CommandPalette,group:"",title:localize(65,"Undo"),order:1},{menuId:MenuId.SimpleEditorContext,group:"1_do",title:localize(66,"Undo"),order:1}]}));registerCommand$3(new ProxyCommand(UndoCommand,{id:"default:undo",precondition:void 0}));const RedoCommand=registerCommand$3(new MultiCommand({id:"redo",precondition:void 0,kbOpts:{weight:0,primary:2103,secondary:[3128],mac:{primary:3128}},menuOpts:[{menuId:MenuId.MenubarEditMenu,group:"1_do",title:localize(67,"&&Redo"),order:2},{menuId:MenuId.CommandPalette,group:"",title:localize(68,"Redo"),order:1},{menuId:MenuId.SimpleEditorContext,group:"1_do",title:localize(69,"Redo"),order:2}]}));registerCommand$3(new ProxyCommand(RedoCommand,{id:"default:redo",precondition:void 0}));const SelectAllCommand=registerCommand$3(new MultiCommand({id:"editor.action.selectAll",precondition:void 0,kbOpts:{weight:0,kbExpr:null,primary:2079},menuOpts:[{menuId:MenuId.MenubarSelectionMenu,group:"1_basic",title:localize(70,"&&Select All"),order:1},{menuId:MenuId.CommandPalette,group:"",title:localize(71,"Select All"),order:1},{menuId:MenuId.SimpleEditorContext,group:"9_select",title:localize(72,"Select All"),order:1}]}));let Range$2=class ae{constructor(e,t,s,o){e>s||e===s&&t>o?(this.startLineNumber=s,this.startColumn=o,this.endLineNumber=e,this.endColumn=t):(this.startLineNumber=e,this.startColumn=t,this.endLineNumber=s,this.endColumn=o)}isEmpty(){return ae.isEmpty(this)}static isEmpty(e){return e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn}containsPosition(e){return ae.containsPosition(this,e)}static containsPosition(e,t){return!(t.lineNumber<e.startLineNumber||t.lineNumber>e.endLineNumber||t.lineNumber===e.startLineNumber&&t.column<e.startColumn||t.lineNumber===e.endLineNumber&&t.column>e.endColumn)}static strictContainsPosition(e,t){return!(t.lineNumber<e.startLineNumber||t.lineNumber>e.endLineNumber||t.lineNumber===e.startLineNumber&&t.column<=e.startColumn||t.lineNumber===e.endLineNumber&&t.column>=e.endColumn)}containsRange(e){return ae.containsRange(this,e)}static containsRange(e,t){return!(t.startLineNumber<e.startLineNumber||t.endLineNumber<e.startLineNumber||t.startLineNumber>e.endLineNumber||t.endLineNumber>e.endLineNumber||t.startLineNumber===e.startLineNumber&&t.startColumn<e.startColumn||t.endLineNumber===e.endLineNumber&&t.endColumn>e.endColumn)}strictContainsRange(e){return ae.strictContainsRange(this,e)}static strictContainsRange(e,t){return!(t.startLineNumber<e.startLineNumber||t.endLineNumber<e.startLineNumber||t.startLineNumber>e.endLineNumber||t.endLineNumber>e.endLineNumber||t.startLineNumber===e.startLineNumber&&t.startColumn<=e.startColumn||t.endLineNumber===e.endLineNumber&&t.endColumn>=e.endColumn)}plusRange(e){return ae.plusRange(this,e)}static plusRange(e,t){let s,o,r,l;return t.startLineNumber<e.startLineNumber?(s=t.startLineNumber,o=t.startColumn):t.startLineNumber===e.startLineNumber?(s=t.startLineNumber,o=Math.min(t.startColumn,e.startColumn)):(s=e.startLineNumber,o=e.startColumn),t.endLineNumber>e.endLineNumber?(r=t.endLineNumber,l=t.endColumn):t.endLineNumber===e.endLineNumber?(r=t.endLineNumber,l=Math.max(t.endColumn,e.endColumn)):(r=e.endLineNumber,l=e.endColumn),new ae(s,o,r,l)}intersectRanges(e){return ae.intersectRanges(this,e)}static intersectRanges(e,t){let s=e.startLineNumber,o=e.startColumn,r=e.endLineNumber,l=e.endColumn;const c=t.startLineNumber,d=t.startColumn,u=t.endLineNumber,g=t.endColumn;return s<c?(s=c,o=d):s===c&&(o=Math.max(o,d)),r>u?(r=u,l=g):r===u&&(l=Math.min(l,g)),s>r||s===r&&o>l?null:new ae(s,o,r,l)}equalsRange(e){return ae.equalsRange(this,e)}static equalsRange(e,t){return!e&&!t?!0:!!e&&!!t&&e.startLineNumber===t.startLineNumber&&e.startColumn===t.startColumn&&e.endLineNumber===t.endLineNumber&&e.endColumn===t.endColumn}getEndPosition(){return ae.getEndPosition(this)}static getEndPosition(e){return new Position$1(e.endLineNumber,e.endColumn)}getStartPosition(){return ae.getStartPosition(this)}static getStartPosition(e){return new Position$1(e.startLineNumber,e.startColumn)}toString(){return"["+this.startLineNumber+","+this.startColumn+" -> "+this.endLineNumber+","+this.endColumn+"]"}setEndPosition(e,t){return new ae(this.startLineNumber,this.startColumn,e,t)}setStartPosition(e,t){return new ae(e,t,this.endLineNumber,this.endColumn)}collapseToStart(){return ae.collapseToStart(this)}static collapseToStart(e){return new ae(e.startLineNumber,e.startColumn,e.startLineNumber,e.startColumn)}collapseToEnd(){return ae.collapseToEnd(this)}static collapseToEnd(e){return new ae(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn)}delta(e){return new ae(this.startLineNumber+e,this.startColumn,this.endLineNumber+e,this.endColumn)}isSingleLine(){return this.startLineNumber===this.endLineNumber}static fromPositions(e,t=e){return new ae(e.lineNumber,e.column,t.lineNumber,t.column)}static lift(e){return e?new ae(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn):null}static isIRange(e){return e&&typeof e.startLineNumber=="number"&&typeof e.startColumn=="number"&&typeof e.endLineNumber=="number"&&typeof e.endColumn=="number"}static areIntersectingOrTouching(e,t){return!(e.endLineNumber<t.startLineNumber||e.endLineNumber===t.startLineNumber&&e.endColumn<t.startColumn||t.endLineNumber<e.startLineNumber||t.endLineNumber===e.startLineNumber&&t.endColumn<e.startColumn)}static areIntersecting(e,t){return!(e.endLineNumber<t.startLineNumber||e.endLineNumber===t.startLineNumber&&e.endColumn<=t.startColumn||t.endLineNumber<e.startLineNumber||t.endLineNumber===e.startLineNumber&&t.endColumn<=e.startColumn)}static areOnlyIntersecting(e,t){return!(e.endLineNumber<t.startLineNumber-1||e.endLineNumber===t.startLineNumber&&e.endColumn<t.startColumn-1||t.endLineNumber<e.startLineNumber-1||t.endLineNumber===e.startLineNumber&&t.endColumn<e.startColumn-1)}static compareRangesUsingStarts(e,t){if(e&&t){const r=e.startLineNumber|0,l=t.startLineNumber|0;if(r===l){const c=e.startColumn|0,d=t.startColumn|0;if(c===d){const u=e.endLineNumber|0,g=t.endLineNumber|0;if(u===g){const f=e.endColumn|0,p=t.endColumn|0;return f-p}return u-g}return c-d}return r-l}return(e?1:0)-(t?1:0)}static compareRangesUsingEnds(e,t){return e.endLineNumber===t.endLineNumber?e.endColumn===t.endColumn?e.startLineNumber===t.startLineNumber?e.startColumn-t.startColumn:e.startLineNumber-t.startLineNumber:e.endColumn-t.endColumn:e.endLineNumber-t.endLineNumber}static spansMultipleLines(e){return e.endLineNumber>e.startLineNumber}toJSON(){return this}},Selection$1=class Ie extends Range$2{constructor(e,t,s,o){super(e,t,s,o),this.selectionStartLineNumber=e,this.selectionStartColumn=t,this.positionLineNumber=s,this.positionColumn=o}toString(){return"["+this.selectionStartLineNumber+","+this.selectionStartColumn+" -> "+this.positionLineNumber+","+this.positionColumn+"]"}equalsSelection(e){return Ie.selectionsEqual(this,e)}static selectionsEqual(e,t){return e.selectionStartLineNumber===t.selectionStartLineNumber&&e.selectionStartColumn===t.selectionStartColumn&&e.positionLineNumber===t.positionLineNumber&&e.positionColumn===t.positionColumn}getDirection(){return this.selectionStartLineNumber===this.startLineNumber&&this.selectionStartColumn===this.startColumn?0:1}setEndPosition(e,t){return this.getDirection()===0?new Ie(this.startLineNumber,this.startColumn,e,t):new Ie(e,t,this.startLineNumber,this.startColumn)}getPosition(){return new Position$1(this.positionLineNumber,this.positionColumn)}getSelectionStart(){return new Position$1(this.selectionStartLineNumber,this.selectionStartColumn)}setStartPosition(e,t){return this.getDirection()===0?new Ie(e,t,this.endLineNumber,this.endColumn):new Ie(this.endLineNumber,this.endColumn,e,t)}static fromPositions(e,t=e){return new Ie(e.lineNumber,e.column,t.lineNumber,t.column)}static fromRange(e,t){return t===0?new Ie(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn):new Ie(e.endLineNumber,e.endColumn,e.startLineNumber,e.startColumn)}static liftSelection(e){return new Ie(e.selectionStartLineNumber,e.selectionStartColumn,e.positionLineNumber,e.positionColumn)}static selectionsArrEqual(e,t){if(e&&!t||!e&&t)return!1;if(!e&&!t)return!0;if(e.length!==t.length)return!1;for(let s=0,o=e.length;s<o;s++)if(!this.selectionsEqual(e[s],t[s]))return!1;return!0}static isISelection(e){return e&&typeof e.selectionStartLineNumber=="number"&&typeof e.selectionStartColumn=="number"&&typeof e.positionLineNumber=="number"&&typeof e.positionColumn=="number"}static createWithDirection(e,t,s,o,r){return r===0?new Ie(e,t,s,o):new Ie(s,o,e,t)}};function createScopedLineTokens(a,e){const t=a.getCount(),s=a.findTokenIndexAtOffset(e),o=a.getLanguageId(s);let r=s;for(;r+1<t&&a.getLanguageId(r+1)===o;)r++;let l=s;for(;l>0&&a.getLanguageId(l-1)===o;)l--;return new ScopedLineTokens(a,o,l,r+1,a.getStartOffset(l),a.getEndOffset(r))}class ScopedLineTokens{constructor(e,t,s,o,r,l){this._scopedLineTokensBrand=void 0,this._actual=e,this.languageId=t,this._firstTokenIndex=s,this._lastTokenIndex=o,this.firstCharOffset=r,this._lastCharOffset=l,this.languageIdCodec=e.languageIdCodec}getLineContent(){return this._actual.getLineContent().substring(this.firstCharOffset,this._lastCharOffset)}getLineLength(){return this._lastCharOffset-this.firstCharOffset}getActualLineContentBefore(e){return this._actual.getLineContent().substring(0,this.firstCharOffset+e)}getTokenCount(){return this._lastTokenIndex-this._firstTokenIndex}findTokenIndexAtOffset(e){return this._actual.findTokenIndexAtOffset(e+this.firstCharOffset)-this._firstTokenIndex}getStandardTokenType(e){return this._actual.getStandardTokenType(e+this._firstTokenIndex)}toIViewLineTokens(){return this._actual.sliceAndInflate(this.firstCharOffset,this._lastCharOffset,0)}}function ignoreBracketsInToken(a){return(a&3)!==0}class CursorColumns{static _nextVisibleColumn(e,t,s){return e===9?CursorColumns.nextRenderTabStop(t,s):isFullWidthCharacter(e)||isEmojiImprecise(e)?t+2:t+1}static visibleColumnFromColumn(e,t,s){const o=Math.min(t-1,e.length),r=e.substring(0,o),l=new GraphemeIterator(r);let c=0;for(;!l.eol();){const d=getNextCodePoint(r,o,l.offset);l.nextGraphemeLength(),c=this._nextVisibleColumn(d,c,s)}return c}static columnFromVisibleColumn(e,t,s){if(t<=0)return 1;const o=e.length,r=new GraphemeIterator(e);let l=0,c=1;for(;!r.eol();){const d=getNextCodePoint(e,o,r.offset);r.nextGraphemeLength();const u=this._nextVisibleColumn(d,l,s),g=r.offset+1;if(u>=t){const f=t-l;return u-t<f?g:c}l=u,c=g}return o+1}static nextRenderTabStop(e,t){return e+t-e%t}static nextIndentTabStop(e,t){return CursorColumns.nextRenderTabStop(e,t)}static prevRenderTabStop(e,t){return Math.max(0,e-1-(e-1)%t)}static prevIndentTabStop(e,t){return CursorColumns.prevRenderTabStop(e,t)}}function _normalizeIndentationFromWhitespace(a,e,t){let s=0;for(let r=0;r<a.length;r++)a.charAt(r)==="	"?s=CursorColumns.nextIndentTabStop(s,e):s++;let o="";if(!t){const r=Math.floor(s/e);s=s%e;for(let l=0;l<r;l++)o+="	"}for(let r=0;r<s;r++)o+=" ";return o}function normalizeIndentation(a,e,t){let s=firstNonWhitespaceIndex(a);return s===-1&&(s=a.length),_normalizeIndentationFromWhitespace(a.substring(0,s),e,t)+a.substring(s)}class InputModeImpl{constructor(){this._inputMode="insert",this._onDidChangeInputMode=new Emitter$1,this.onDidChangeInputMode=this._onDidChangeInputMode.event}getInputMode(){return this._inputMode}}const InputMode=new InputModeImpl,autoCloseAlways=()=>!0,autoCloseNever=()=>!1,autoCloseBeforeWhitespace=a=>a===" "||a==="	";class CursorConfiguration{static shouldRecreate(e){return e.hasChanged(165)||e.hasChanged(148)||e.hasChanged(45)||e.hasChanged(85)||e.hasChanged(88)||e.hasChanged(89)||e.hasChanged(10)||e.hasChanged(11)||e.hasChanged(15)||e.hasChanged(13)||e.hasChanged(14)||e.hasChanged(20)||e.hasChanged(145)||e.hasChanged(141)||e.hasChanged(59)||e.hasChanged(104)||e.hasChanged(147)||e.hasChanged(93)}constructor(e,t,s,o){this.languageConfigurationService=o,this._cursorMoveConfigurationBrand=void 0,this._languageId=e;const r=s.options,l=r.get(165),c=r.get(59);this.readOnly=r.get(104),this.tabSize=t.tabSize,this.indentSize=t.indentSize,this.insertSpaces=t.insertSpaces,this.stickyTabStops=r.get(132),this.lineHeight=c.lineHeight,this.typicalHalfwidthCharacterWidth=c.typicalHalfwidthCharacterWidth,this.pageSize=Math.max(1,Math.floor(l.height/this.lineHeight)-2),this.useTabStops=r.get(145),this.trimWhitespaceOnDelete=r.get(141),this.wordSeparators=r.get(148),this.emptySelectionClipboard=r.get(45),this.copyWithSyntaxHighlighting=r.get(31),this.multiCursorMergeOverlapping=r.get(85),this.multiCursorPaste=r.get(88),this.multiCursorLimit=r.get(89),this.autoClosingBrackets=r.get(10),this.autoClosingComments=r.get(11),this.autoClosingQuotes=r.get(15),this.autoClosingDelete=r.get(13),this.autoClosingOvertype=r.get(14),this.autoSurround=r.get(20),this.autoIndent=r.get(16),this.wordSegmenterLocales=r.get(147),this.overtypeOnPaste=r.get(93),this.surroundingPairs={},this._electricChars=null,this.shouldAutoCloseBefore={quote:this._getShouldAutoClose(e,this.autoClosingQuotes,!0),comment:this._getShouldAutoClose(e,this.autoClosingComments,!1),bracket:this._getShouldAutoClose(e,this.autoClosingBrackets,!1)},this.autoClosingPairs=this.languageConfigurationService.getLanguageConfiguration(e).getAutoClosingPairs();const d=this.languageConfigurationService.getLanguageConfiguration(e).getSurroundingPairs();if(d)for(const g of d)this.surroundingPairs[g.open]=g.close;const u=this.languageConfigurationService.getLanguageConfiguration(e).comments;this.blockCommentStartToken=(u==null?void 0:u.blockCommentStartToken)??null}get electricChars(){var e;if(!this._electricChars){this._electricChars={};const t=(e=this.languageConfigurationService.getLanguageConfiguration(this._languageId).electricCharacter)==null?void 0:e.getElectricCharacters();if(t)for(const s of t)this._electricChars[s]=!0}return this._electricChars}get inputMode(){return InputMode.getInputMode()}onElectricCharacter(e,t,s){const o=createScopedLineTokens(t,s-1),r=this.languageConfigurationService.getLanguageConfiguration(o.languageId).electricCharacter;return r?r.onElectricCharacter(e,o,s-o.firstCharOffset):null}normalizeIndentation(e){return normalizeIndentation(e,this.indentSize,this.insertSpaces)}_getShouldAutoClose(e,t,s){switch(t){case"beforeWhitespace":return autoCloseBeforeWhitespace;case"languageDefined":return this._getLanguageDefinedShouldAutoClose(e,s);case"always":return autoCloseAlways;case"never":return autoCloseNever}}_getLanguageDefinedShouldAutoClose(e,t){const s=this.languageConfigurationService.getLanguageConfiguration(e).getAutoCloseBeforeSet(t);return o=>s.indexOf(o)!==-1}visibleColumnFromColumn(e,t){return CursorColumns.visibleColumnFromColumn(e.getLineContent(t.lineNumber),t.column,this.tabSize)}columnFromVisibleColumn(e,t,s){const o=CursorColumns.columnFromVisibleColumn(e.getLineContent(t),s,this.tabSize),r=e.getLineMinColumn(t);if(o<r)return r;const l=e.getLineMaxColumn(t);return o>l?l:o}}let CursorState$1=class Ir{static fromModelState(e){return new PartialModelCursorState(e)}static fromViewState(e){return new PartialViewCursorState(e)}static fromModelSelection(e){const t=Selection$1.liftSelection(e),s=new SingleCursorState(Range$2.fromPositions(t.getSelectionStart()),0,0,t.getPosition(),0);return Ir.fromModelState(s)}static fromModelSelections(e){const t=[];for(let s=0,o=e.length;s<o;s++)t[s]=this.fromModelSelection(e[s]);return t}constructor(e,t){this._cursorStateBrand=void 0,this.modelState=e,this.viewState=t}equals(e){return this.viewState.equals(e.viewState)&&this.modelState.equals(e.modelState)}};class PartialModelCursorState{constructor(e){this.modelState=e,this.viewState=null}}class PartialViewCursorState{constructor(e){this.modelState=null,this.viewState=e}}class SingleCursorState{constructor(e,t,s,o,r){this.selectionStart=e,this.selectionStartKind=t,this.selectionStartLeftoverVisibleColumns=s,this.position=o,this.leftoverVisibleColumns=r,this._singleCursorStateBrand=void 0,this.selection=SingleCursorState._computeSelection(this.selectionStart,this.position)}equals(e){return this.selectionStartLeftoverVisibleColumns===e.selectionStartLeftoverVisibleColumns&&this.leftoverVisibleColumns===e.leftoverVisibleColumns&&this.selectionStartKind===e.selectionStartKind&&this.position.equals(e.position)&&this.selectionStart.equalsRange(e.selectionStart)}hasSelection(){return!this.selection.isEmpty()||!this.selectionStart.isEmpty()}move(e,t,s,o){return e?new SingleCursorState(this.selectionStart,this.selectionStartKind,this.selectionStartLeftoverVisibleColumns,new Position$1(t,s),o):new SingleCursorState(new Range$2(t,s,t,s),0,o,new Position$1(t,s),o)}static _computeSelection(e,t){return e.isEmpty()||!t.isBeforeOrEqual(e.getStartPosition())?Selection$1.fromPositions(e.getStartPosition(),t):Selection$1.fromPositions(e.getEndPosition(),t)}}class EditOperationResult{constructor(e,t,s){this._editOperationResultBrand=void 0,this.type=e,this.commands=t,this.shouldPushStackElementBefore=s.shouldPushStackElementBefore,this.shouldPushStackElementAfter=s.shouldPushStackElementAfter}}function isQuote(a){return a==="'"||a==='"'||a==="`"}class ColumnSelection{static columnSelect(e,t,s,o,r,l){const c=Math.abs(r-s)+1,d=s>r,u=o>l,g=o<l,f=[];for(let p=0;p<c;p++){const m=s+(d?-p:p),_=e.columnFromVisibleColumn(t,m,o),C=e.columnFromVisibleColumn(t,m,l),b=e.visibleColumnFromColumn(t,new Position$1(m,_)),v=e.visibleColumnFromColumn(t,new Position$1(m,C));g&&(b>l||v<o)||u&&(v>o||b<l)||f.push(new SingleCursorState(new Range$2(m,_,m,_),0,0,new Position$1(m,C),0))}if(f.length===0)for(let p=0;p<c;p++){const m=s+(d?-p:p),_=t.getLineMaxColumn(m);f.push(new SingleCursorState(new Range$2(m,_,m,_),0,0,new Position$1(m,_),0))}return{viewStates:f,reversed:d,fromLineNumber:s,fromVisualColumn:o,toLineNumber:r,toVisualColumn:l}}static columnSelectLeft(e,t,s){let o=s.toViewVisualColumn;return o>0&&o--,ColumnSelection.columnSelect(e,t,s.fromViewLineNumber,s.fromViewVisualColumn,s.toViewLineNumber,o)}static columnSelectRight(e,t,s){let o=0;const r=Math.min(s.fromViewLineNumber,s.toViewLineNumber),l=Math.max(s.fromViewLineNumber,s.toViewLineNumber);for(let d=r;d<=l;d++){const u=t.getLineMaxColumn(d),g=e.visibleColumnFromColumn(t,new Position$1(d,u));o=Math.max(o,g)}let c=s.toViewVisualColumn;return c<o&&c++,this.columnSelect(e,t,s.fromViewLineNumber,s.fromViewVisualColumn,s.toViewLineNumber,c)}static columnSelectUp(e,t,s,o){const r=o?e.pageSize:1,l=Math.max(1,s.toViewLineNumber-r);return this.columnSelect(e,t,s.fromViewLineNumber,s.fromViewVisualColumn,l,s.toViewVisualColumn)}static columnSelectDown(e,t,s,o){const r=o?e.pageSize:1,l=Math.min(t.getLineCount(),s.toViewLineNumber+r);return this.columnSelect(e,t,s.fromViewLineNumber,s.fromViewVisualColumn,l,s.toViewVisualColumn)}}class ReplaceCommand{constructor(e,t,s=!1){this._range=e,this._text=t,this.insertsAutoWhitespace=s}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text)}computeCursorState(e,t){const o=t.getInverseEditOperations()[0].range;return Selection$1.fromPositions(o.getEndPosition())}}class ReplaceOvertypeCommand{constructor(e,t,s=!1){this._range=e,this._text=t,this.insertsAutoWhitespace=s}getEditOperations(e,t){const s=this._range.getStartPosition(),o=this._range.getEndPosition(),r=o.lineNumber,l=this._text.length+(this._range.isEmpty()?0:-1);let c=addPositiveOffsetToModelPosition(e,o,l);c.lineNumber>r&&(c=new Position$1(r,e.getLineMaxColumn(r)));const d=Range$2.fromPositions(s,c);t.addTrackedEditOperation(d,this._text)}computeCursorState(e,t){const o=t.getInverseEditOperations()[0].range;return Selection$1.fromPositions(o.getEndPosition())}}class ReplaceCommandThatSelectsText{constructor(e,t){this._range=e,this._text=t}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text)}computeCursorState(e,t){const o=t.getInverseEditOperations()[0].range;return Selection$1.fromRange(o,0)}}class ReplaceCommandWithoutChangingPosition{constructor(e,t,s=!1){this._range=e,this._text=t,this.insertsAutoWhitespace=s}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text)}computeCursorState(e,t){const o=t.getInverseEditOperations()[0].range;return Selection$1.fromPositions(o.getStartPosition())}}class ReplaceCommandWithOffsetCursorState{constructor(e,t,s,o,r=!1){this._range=e,this._text=t,this._columnDeltaOffset=o,this._lineNumberDeltaOffset=s,this.insertsAutoWhitespace=r}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text)}computeCursorState(e,t){const o=t.getInverseEditOperations()[0].range;return Selection$1.fromPositions(o.getEndPosition().delta(this._lineNumberDeltaOffset,this._columnDeltaOffset))}}class ReplaceOvertypeCommandOnCompositionEnd{constructor(e){this._range=e}getEditOperations(e,t){const s=e.getValueInRange(this._range),o=this._range.getEndPosition(),r=o.lineNumber;let l=addPositiveOffsetToModelPosition(e,o,s.length);l.lineNumber>r&&(l=new Position$1(r,e.getLineMaxColumn(r)));const c=Range$2.fromPositions(o,l);t.addTrackedEditOperation(c,"")}computeCursorState(e,t){const o=t.getInverseEditOperations()[0].range;return Selection$1.fromPositions(o.getEndPosition())}}class ReplaceCommandThatPreservesSelection{constructor(e,t,s,o=!1){this._range=e,this._text=t,this._initialSelection=s,this._forceMoveMarkers=o,this._selectionId=null}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text,this._forceMoveMarkers),this._selectionId=t.trackSelection(this._initialSelection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}}function addPositiveOffsetToModelPosition(a,e,t){if(t<0)throw new Error("Unexpected negative delta");const s=a.getLineCount();let o=new Position$1(s,a.getLineMaxColumn(s));for(let r=e.lineNumber;r<=s;r++)if(r===e.lineNumber){const l=t-a.getLineMaxColumn(e.lineNumber)+e.column;if(l<=0){o=new Position$1(e.lineNumber,e.column+t);break}t=l}else{const l=t-a.getLineMaxColumn(r);if(l<=0){o=new Position$1(r,t);break}t=l}return o}class AtomicTabMoveOperations{static whitespaceVisibleColumn(e,t,s){const o=e.length;let r=0,l=-1,c=-1;for(let d=0;d<o;d++){if(d===t)return[l,c,r];switch(r%s===0&&(l=d,c=r),e.charCodeAt(d)){case 32:r+=1;break;case 9:r=CursorColumns.nextRenderTabStop(r,s);break;default:return[-1,-1,-1]}}return t===o?[l,c,r]:[-1,-1,-1]}static atomicPosition(e,t,s,o){const r=e.length,[l,c,d]=AtomicTabMoveOperations.whitespaceVisibleColumn(e,t,s);if(d===-1)return-1;let u;switch(o){case 0:u=!0;break;case 1:u=!1;break;case 2:if(d%s===0)return t;u=d%s<=s/2;break}if(u){if(l===-1)return-1;let p=c;for(let m=l;m<r;++m){if(p===c+s)return l;switch(e.charCodeAt(m)){case 32:p+=1;break;case 9:p=CursorColumns.nextRenderTabStop(p,s);break;default:return-1}}return p===c+s?l:-1}const g=CursorColumns.nextRenderTabStop(d,s);let f=d;for(let p=t;p<r;p++){if(f===g)return p;switch(e.charCodeAt(p)){case 32:f+=1;break;case 9:f=CursorColumns.nextRenderTabStop(f,s);break;default:return-1}}return f===g?r:-1}}class CursorPosition{constructor(e,t,s){this._cursorPositionBrand=void 0,this.lineNumber=e,this.column=t,this.leftoverVisibleColumns=s}}class MoveOperations{static leftPosition(e,t){if(t.column>e.getLineMinColumn(t.lineNumber))return t.delta(void 0,-prevCharLength(e.getLineContent(t.lineNumber),t.column-1));if(t.lineNumber>1){const s=t.lineNumber-1;return new Position$1(s,e.getLineMaxColumn(s))}else return t}static leftPositionAtomicSoftTabs(e,t,s){if(t.column<=e.getLineIndentColumn(t.lineNumber)){const o=e.getLineMinColumn(t.lineNumber),r=e.getLineContent(t.lineNumber),l=AtomicTabMoveOperations.atomicPosition(r,t.column-1,s,0);if(l!==-1&&l+1>=o)return new Position$1(t.lineNumber,l+1)}return this.leftPosition(e,t)}static left(e,t,s){const o=e.stickyTabStops?MoveOperations.leftPositionAtomicSoftTabs(t,s,e.tabSize):MoveOperations.leftPosition(t,s);return new CursorPosition(o.lineNumber,o.column,0)}static moveLeft(e,t,s,o,r){let l,c;if(s.hasSelection()&&!o)l=s.selection.startLineNumber,c=s.selection.startColumn;else{const d=s.position.delta(void 0,-(r-1)),u=t.normalizePosition(MoveOperations.clipPositionColumn(d,t),0),g=MoveOperations.left(e,t,u);l=g.lineNumber,c=g.column}return s.move(o,l,c,0)}static clipPositionColumn(e,t){return new Position$1(e.lineNumber,MoveOperations.clipRange(e.column,t.getLineMinColumn(e.lineNumber),t.getLineMaxColumn(e.lineNumber)))}static clipRange(e,t,s){return e<t?t:e>s?s:e}static rightPosition(e,t,s){return s<e.getLineMaxColumn(t)?s=s+nextCharLength(e.getLineContent(t),s-1):t<e.getLineCount()&&(t=t+1,s=e.getLineMinColumn(t)),new Position$1(t,s)}static rightPositionAtomicSoftTabs(e,t,s,o,r){if(s<e.getLineIndentColumn(t)){const l=e.getLineContent(t),c=AtomicTabMoveOperations.atomicPosition(l,s-1,o,1);if(c!==-1)return new Position$1(t,c+1)}return this.rightPosition(e,t,s)}static right(e,t,s){const o=e.stickyTabStops?MoveOperations.rightPositionAtomicSoftTabs(t,s.lineNumber,s.column,e.tabSize,e.indentSize):MoveOperations.rightPosition(t,s.lineNumber,s.column);return new CursorPosition(o.lineNumber,o.column,0)}static moveRight(e,t,s,o,r){let l,c;if(s.hasSelection()&&!o)l=s.selection.endLineNumber,c=s.selection.endColumn;else{const d=s.position.delta(void 0,r-1),u=t.normalizePosition(MoveOperations.clipPositionColumn(d,t),1),g=MoveOperations.right(e,t,u);l=g.lineNumber,c=g.column}return s.move(o,l,c,0)}static vertical(e,t,s,o,r,l,c,d){const u=CursorColumns.visibleColumnFromColumn(t.getLineContent(s),o,e.tabSize)+r,g=t.getLineCount(),f=s===1&&o===1,p=s===g&&o===t.getLineMaxColumn(s),m=l<s?f:p;if(s=l,s<1?(s=1,c?o=t.getLineMinColumn(s):o=Math.min(t.getLineMaxColumn(s),o)):s>g?(s=g,c?o=t.getLineMaxColumn(s):o=Math.min(t.getLineMaxColumn(s),o)):o=e.columnFromVisibleColumn(t,s,u),m?r=0:r=u-CursorColumns.visibleColumnFromColumn(t.getLineContent(s),o,e.tabSize),d!==void 0){const _=new Position$1(s,o),C=t.normalizePosition(_,d);r=r+(o-C.column),s=C.lineNumber,o=C.column}return new CursorPosition(s,o,r)}static down(e,t,s,o,r,l,c){return this.vertical(e,t,s,o,r,s+l,c,4)}static moveDown(e,t,s,o,r){let l,c;s.hasSelection()&&!o?(l=s.selection.endLineNumber,c=s.selection.endColumn):(l=s.position.lineNumber,c=s.position.column);let d=0,u;do if(u=MoveOperations.down(e,t,l+d,c,s.leftoverVisibleColumns,r,!0),t.normalizePosition(new Position$1(u.lineNumber,u.column),2).lineNumber>l)break;while(d++<10&&l+d<t.getLineCount());return s.move(o,u.lineNumber,u.column,u.leftoverVisibleColumns)}static translateDown(e,t,s){const o=s.selection,r=MoveOperations.down(e,t,o.selectionStartLineNumber,o.selectionStartColumn,s.selectionStartLeftoverVisibleColumns,1,!1),l=MoveOperations.down(e,t,o.positionLineNumber,o.positionColumn,s.leftoverVisibleColumns,1,!1);return new SingleCursorState(new Range$2(r.lineNumber,r.column,r.lineNumber,r.column),0,r.leftoverVisibleColumns,new Position$1(l.lineNumber,l.column),l.leftoverVisibleColumns)}static up(e,t,s,o,r,l,c){return this.vertical(e,t,s,o,r,s-l,c,3)}static moveUp(e,t,s,o,r){let l,c;s.hasSelection()&&!o?(l=s.selection.startLineNumber,c=s.selection.startColumn):(l=s.position.lineNumber,c=s.position.column);const d=MoveOperations.up(e,t,l,c,s.leftoverVisibleColumns,r,!0);return s.move(o,d.lineNumber,d.column,d.leftoverVisibleColumns)}static translateUp(e,t,s){const o=s.selection,r=MoveOperations.up(e,t,o.selectionStartLineNumber,o.selectionStartColumn,s.selectionStartLeftoverVisibleColumns,1,!1),l=MoveOperations.up(e,t,o.positionLineNumber,o.positionColumn,s.leftoverVisibleColumns,1,!1);return new SingleCursorState(new Range$2(r.lineNumber,r.column,r.lineNumber,r.column),0,r.leftoverVisibleColumns,new Position$1(l.lineNumber,l.column),l.leftoverVisibleColumns)}static _isBlankLine(e,t){return e.getLineFirstNonWhitespaceColumn(t)===0}static moveToPrevBlankLine(e,t,s,o){let r=s.position.lineNumber;for(;r>1&&this._isBlankLine(t,r);)r--;for(;r>1&&!this._isBlankLine(t,r);)r--;return s.move(o,r,t.getLineMinColumn(r),0)}static moveToNextBlankLine(e,t,s,o){const r=t.getLineCount();let l=s.position.lineNumber;for(;l<r&&this._isBlankLine(t,l);)l++;for(;l<r&&!this._isBlankLine(t,l);)l++;return s.move(o,l,t.getLineMinColumn(l),0)}static moveToBeginningOfLine(e,t,s,o){const r=s.position.lineNumber,l=t.getLineMinColumn(r),c=t.getLineFirstNonWhitespaceColumn(r)||l;let d;return s.position.column===c?d=l:d=c,s.move(o,r,d,0)}static moveToEndOfLine(e,t,s,o,r){const l=s.position.lineNumber,c=t.getLineMaxColumn(l);return s.move(o,l,c,r?1073741824-c:0)}static moveToBeginningOfBuffer(e,t,s,o){return s.move(o,1,1,0)}static moveToEndOfBuffer(e,t,s,o){const r=t.getLineCount(),l=t.getLineMaxColumn(r);return s.move(o,r,l,0)}}class DeleteOperations{static deleteRight(e,t,s,o){const r=[];let l=e!==3;for(let c=0,d=o.length;c<d;c++){const u=o[c],g=this.getDeleteRightRange(u,s,t);if(g.isEmpty()){r[c]=null;continue}g.startLineNumber!==g.endLineNumber&&(l=!0),r[c]=new ReplaceCommand(g,"")}return[l,r]}static getDeleteRightRange(e,t,s){if(!e.isEmpty())return e;const o=e.getPosition(),r=MoveOperations.right(s,t,o);if(s.trimWhitespaceOnDelete&&r.lineNumber!==o.lineNumber){const l=t.getLineFirstNonWhitespaceColumn(o.lineNumber)>0,c=t.getLineFirstNonWhitespaceColumn(r.lineNumber);if(l&&c>0)return new Range$2(r.lineNumber,c,o.lineNumber,o.column)}return new Range$2(r.lineNumber,r.column,o.lineNumber,o.column)}static isAutoClosingPairDelete(e,t,s,o,r,l,c){if(t==="never"&&s==="never"||e==="never")return!1;for(let d=0,u=l.length;d<u;d++){const g=l[d],f=g.getPosition();if(!g.isEmpty())return!1;const p=r.getLineContent(f.lineNumber);if(f.column<2||f.column>=p.length+1)return!1;const m=p.charAt(f.column-2),_=o.get(m);if(!_)return!1;if(isQuote(m)){if(s==="never")return!1}else if(t==="never")return!1;const C=p.charAt(f.column-1);let b=!1;for(const v of _)v.open===m&&v.close===C&&(b=!0);if(!b)return!1;if(e==="auto"){let v=!1;for(let S=0,y=c.length;S<y;S++){const w=c[S];if(f.lineNumber===w.startLineNumber&&f.column===w.startColumn){v=!0;break}}if(!v)return!1}}return!0}static _runAutoClosingPairDelete(e,t,s){const o=[];for(let r=0,l=s.length;r<l;r++){const c=s[r].getPosition(),d=new Range$2(c.lineNumber,c.column-1,c.lineNumber,c.column+1);o[r]=new ReplaceCommand(d,"")}return[!0,o]}static deleteLeft(e,t,s,o,r){if(this.isAutoClosingPairDelete(t.autoClosingDelete,t.autoClosingBrackets,t.autoClosingQuotes,t.autoClosingPairs.autoClosingPairsOpenByEnd,s,o,r))return this._runAutoClosingPairDelete(t,s,o);const l=[];let c=e!==2;for(let d=0,u=o.length;d<u;d++){const g=DeleteOperations.getDeleteLeftRange(o[d],s,t);if(g.isEmpty()){l[d]=null;continue}g.startLineNumber!==g.endLineNumber&&(c=!0),l[d]=new ReplaceCommand(g,"")}return[c,l]}static getDeleteLeftRange(e,t,s){if(!e.isEmpty())return e;const o=e.getPosition();if(s.useTabStops&&o.column>1){const r=t.getLineContent(o.lineNumber),l=firstNonWhitespaceIndex(r),c=l===-1?r.length+1:l+1;if(o.column<=c){const d=s.visibleColumnFromColumn(t,o),u=CursorColumns.prevIndentTabStop(d,s.indentSize),g=s.columnFromVisibleColumn(t,o.lineNumber,u);return new Range$2(o.lineNumber,g,o.lineNumber,o.column)}}return Range$2.fromPositions(DeleteOperations.getPositionAfterDeleteLeft(o,t),o)}static getPositionAfterDeleteLeft(e,t){if(e.column>1){const s=getLeftDeleteOffset(e.column-1,t.getLineContent(e.lineNumber));return e.with(void 0,s+1)}else if(e.lineNumber>1){const s=e.lineNumber-1;return new Position$1(s,t.getLineMaxColumn(s))}else return e}static cut(e,t,s){const o=[];let r=null;s.sort((l,c)=>Position$1.compare(l.getStartPosition(),c.getEndPosition()));for(let l=0,c=s.length;l<c;l++){const d=s[l];if(d.isEmpty())if(e.emptySelectionClipboard){const u=d.getPosition();let g,f,p,m;u.lineNumber<t.getLineCount()?(g=u.lineNumber,f=1,p=u.lineNumber+1,m=1):u.lineNumber>1&&(r==null?void 0:r.endLineNumber)!==u.lineNumber?(g=u.lineNumber-1,f=t.getLineMaxColumn(u.lineNumber-1),p=u.lineNumber,m=t.getLineMaxColumn(u.lineNumber)):(g=u.lineNumber,f=1,p=u.lineNumber,m=t.getLineMaxColumn(u.lineNumber));const _=new Range$2(g,f,p,m);r=_,_.isEmpty()?o[l]=null:o[l]=new ReplaceCommand(_,"")}else o[l]=null;else o[l]=new ReplaceCommand(d,"")}return new EditOperationResult(0,o,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}}const safeIntl={DateTimeFormat(a,e){return new Lazy(()=>{try{return new Intl.DateTimeFormat(a,e)}catch{return new Intl.DateTimeFormat(void 0,e)}})},Collator(a,e){return new Lazy(()=>{try{return new Intl.Collator(a,e)}catch{return new Intl.Collator(void 0,e)}})},Segmenter(a,e){return new Lazy(()=>{try{return new Intl.Segmenter(a,e)}catch{return new Intl.Segmenter(void 0,e)}})},Locale(a,e){return new Lazy(()=>{try{return new Intl.Locale(a,e)}catch{return new Intl.Locale(LANGUAGE_DEFAULT,e)}})},NumberFormat(a,e){return new Lazy(()=>{try{return new Intl.NumberFormat(a,e)}catch{return new Intl.NumberFormat(void 0,e)}})}};function toUint8(a){return a<0?0:a>255?255:a|0}function toUint32(a){return a<0?0:a>4294967295?4294967295:a|0}class CharacterClassifier{constructor(e){const t=toUint8(e);this._defaultValue=t,this._asciiMap=CharacterClassifier._createAsciiMap(t),this._map=new Map}static _createAsciiMap(e){const t=new Uint8Array(256);return t.fill(e),t}set(e,t){const s=toUint8(t);e>=0&&e<256?this._asciiMap[e]=s:this._map.set(e,s)}get(e){return e>=0&&e<256?this._asciiMap[e]:this._map.get(e)||this._defaultValue}clear(){this._asciiMap.fill(this._defaultValue),this._map.clear()}}class CharacterSet{constructor(){this._actual=new CharacterClassifier(0)}add(e){this._actual.set(e,1)}has(e){return this._actual.get(e)===1}clear(){return this._actual.clear()}}class WordCharacterClassifier extends CharacterClassifier{constructor(e,t){super(0),this._segmenter=null,this._cachedLine=null,this._cachedSegments=[],this.intlSegmenterLocales=t,this.intlSegmenterLocales.length>0?this._segmenter=safeIntl.Segmenter(this.intlSegmenterLocales,{granularity:"word"}):this._segmenter=null;for(let s=0,o=e.length;s<o;s++)this.set(e.charCodeAt(s),2);this.set(32,1),this.set(9,1)}findPrevIntlWordBeforeOrAtOffset(e,t){let s=null;for(const o of this._getIntlSegmenterWordsOnLine(e)){if(o.index>t)break;s=o}return s}findNextIntlWordAtOrAfterOffset(e,t){for(const s of this._getIntlSegmenterWordsOnLine(e))if(!(s.index<t))return s;return null}_getIntlSegmenterWordsOnLine(e){return this._segmenter?this._cachedLine===e?this._cachedSegments:(this._cachedLine=e,this._cachedSegments=this._filterWordSegments(this._segmenter.value.segment(e)),this._cachedSegments):[]}_filterWordSegments(e){const t=[];for(const s of e)this._isWordLike(s)&&t.push(s);return t}_isWordLike(e){return!!e.isWordLike}}const wordClassifierCache=new LRUCache(10);function getMapForWordSeparators(a,e){const t=`${a}/${e.join(",")}`;let s=wordClassifierCache.get(t);return s||(s=new WordCharacterClassifier(a,e),wordClassifierCache.set(t,s)),s}class WordOperations{static _createWord(e,t,s,o,r){return{start:o,end:r,wordType:t,nextCharClass:s}}static _createIntlWord(e,t){return{start:e.index,end:e.index+e.segment.length,wordType:1,nextCharClass:t}}static _findPreviousWordOnLine(e,t,s){const o=t.getLineContent(s.lineNumber);return this._doFindPreviousWordOnLine(o,e,s)}static _doFindPreviousWordOnLine(e,t,s){let o=0;const r=t.findPrevIntlWordBeforeOrAtOffset(e,s.column-2);for(let l=s.column-2;l>=0;l--){const c=e.charCodeAt(l),d=t.get(c);if(r&&l===r.index)return this._createIntlWord(r,d);if(d===0){if(o===2)return this._createWord(e,o,d,l+1,this._findEndOfWord(e,t,o,l+1));o=1}else if(d===2){if(o===1)return this._createWord(e,o,d,l+1,this._findEndOfWord(e,t,o,l+1));o=2}else if(d===1&&o!==0)return this._createWord(e,o,d,l+1,this._findEndOfWord(e,t,o,l+1))}return o!==0?this._createWord(e,o,1,0,this._findEndOfWord(e,t,o,0)):null}static _findEndOfWord(e,t,s,o){const r=t.findNextIntlWordAtOrAfterOffset(e,o),l=e.length;for(let c=o;c<l;c++){const d=e.charCodeAt(c),u=t.get(d);if(r&&c===r.index+r.segment.length||u===1||s===1&&u===2||s===2&&u===0)return c}return l}static _findNextWordOnLine(e,t,s){const o=t.getLineContent(s.lineNumber);return this._doFindNextWordOnLine(o,e,s)}static _doFindNextWordOnLine(e,t,s){let o=0;const r=e.length,l=t.findNextIntlWordAtOrAfterOffset(e,s.column-1);for(let c=s.column-1;c<r;c++){const d=e.charCodeAt(c),u=t.get(d);if(l&&c===l.index)return this._createIntlWord(l,u);if(u===0){if(o===2)return this._createWord(e,o,u,this._findStartOfWord(e,t,o,c-1),c);o=1}else if(u===2){if(o===1)return this._createWord(e,o,u,this._findStartOfWord(e,t,o,c-1),c);o=2}else if(u===1&&o!==0)return this._createWord(e,o,u,this._findStartOfWord(e,t,o,c-1),c)}return o!==0?this._createWord(e,o,1,this._findStartOfWord(e,t,o,r-1),r):null}static _findStartOfWord(e,t,s,o){const r=t.findPrevIntlWordBeforeOrAtOffset(e,o);for(let l=o;l>=0;l--){const c=e.charCodeAt(l),d=t.get(c);if(r&&l===r.index)return l;if(d===1||s===1&&d===2||s===2&&d===0)return l+1}return 0}static moveWordLeft(e,t,s,o,r){let l=s.lineNumber,c=s.column;c===1&&l>1&&(l=l-1,c=t.getLineMaxColumn(l));let d=WordOperations._findPreviousWordOnLine(e,t,new Position$1(l,c));if(o===0)return new Position$1(l,d?d.start+1:1);if(o===1)return!r&&d&&d.wordType===2&&d.end-d.start===1&&d.nextCharClass===0&&(d=WordOperations._findPreviousWordOnLine(e,t,new Position$1(l,d.start+1))),new Position$1(l,d?d.start+1:1);if(o===3){for(;d&&d.wordType===2;)d=WordOperations._findPreviousWordOnLine(e,t,new Position$1(l,d.start+1));return new Position$1(l,d?d.start+1:1)}return d&&c<=d.end+1&&(d=WordOperations._findPreviousWordOnLine(e,t,new Position$1(l,d.start+1))),new Position$1(l,d?d.end+1:1)}static _moveWordPartLeft(e,t){const s=t.lineNumber,o=e.getLineMaxColumn(s);if(t.column===1)return s>1?new Position$1(s-1,e.getLineMaxColumn(s-1)):t;const r=e.getLineContent(s);for(let l=t.column-1;l>1;l--){const c=r.charCodeAt(l-2),d=r.charCodeAt(l-1);if(c===95&&d!==95)return new Position$1(s,l);if(c===45&&d!==45)return new Position$1(s,l);if((isLowerAsciiLetter(c)||isAsciiDigit(c))&&isUpperAsciiLetter(d))return new Position$1(s,l);if(isUpperAsciiLetter(c)&&isUpperAsciiLetter(d)&&l+1<o){const u=r.charCodeAt(l);if(isLowerAsciiLetter(u)||isAsciiDigit(u))return new Position$1(s,l)}}return new Position$1(s,1)}static moveWordRight(e,t,s,o){let r=s.lineNumber,l=s.column,c=!1;l===t.getLineMaxColumn(r)&&r<t.getLineCount()&&(c=!0,r=r+1,l=1);let d=WordOperations._findNextWordOnLine(e,t,new Position$1(r,l));if(o===2)d&&d.wordType===2&&d.end-d.start===1&&d.nextCharClass===0&&(d=WordOperations._findNextWordOnLine(e,t,new Position$1(r,d.end+1))),d?l=d.end+1:l=t.getLineMaxColumn(r);else if(o===3){for(c&&(l=0);d&&(d.wordType===2||d.start+1<=l);)d=WordOperations._findNextWordOnLine(e,t,new Position$1(r,d.end+1));d?l=d.start+1:l=t.getLineMaxColumn(r)}else d&&!c&&l>=d.start+1&&(d=WordOperations._findNextWordOnLine(e,t,new Position$1(r,d.end+1))),d?l=d.start+1:l=t.getLineMaxColumn(r);return new Position$1(r,l)}static _moveWordPartRight(e,t){const s=t.lineNumber,o=e.getLineMaxColumn(s);if(t.column===o)return s<e.getLineCount()?new Position$1(s+1,1):t;const r=e.getLineContent(s);for(let l=t.column+1;l<o;l++){const c=r.charCodeAt(l-2),d=r.charCodeAt(l-1);if(c!==95&&d===95)return new Position$1(s,l);if(c!==45&&d===45)return new Position$1(s,l);if((isLowerAsciiLetter(c)||isAsciiDigit(c))&&isUpperAsciiLetter(d))return new Position$1(s,l);if(isUpperAsciiLetter(c)&&isUpperAsciiLetter(d)&&l+1<o){const u=r.charCodeAt(l);if(isLowerAsciiLetter(u)||isAsciiDigit(u))return new Position$1(s,l)}}return new Position$1(s,o)}static _deleteWordLeftWhitespace(e,t){const s=e.getLineContent(t.lineNumber),o=t.column-2,r=lastNonWhitespaceIndex(s,o);return r+1<o?new Range$2(t.lineNumber,r+2,t.lineNumber,t.column):null}static deleteWordLeft(e,t){const s=e.wordSeparators,o=e.model,r=e.selection,l=e.whitespaceHeuristics;if(!r.isEmpty())return r;if(DeleteOperations.isAutoClosingPairDelete(e.autoClosingDelete,e.autoClosingBrackets,e.autoClosingQuotes,e.autoClosingPairs.autoClosingPairsOpenByEnd,e.model,[e.selection],e.autoClosedCharacters)){const f=e.selection.getPosition();return new Range$2(f.lineNumber,f.column-1,f.lineNumber,f.column+1)}const c=new Position$1(r.positionLineNumber,r.positionColumn);let d=c.lineNumber,u=c.column;if(d===1&&u===1)return null;if(l){const f=this._deleteWordLeftWhitespace(o,c);if(f)return f}let g=WordOperations._findPreviousWordOnLine(s,o,c);return t===0?g?u=g.start+1:u>1?u=1:(d--,u=o.getLineMaxColumn(d)):(g&&u<=g.end+1&&(g=WordOperations._findPreviousWordOnLine(s,o,new Position$1(d,g.start+1))),g?u=g.end+1:u>1?u=1:(d--,u=o.getLineMaxColumn(d))),new Range$2(d,u,c.lineNumber,c.column)}static deleteInsideWord(e,t,s){if(!s.isEmpty())return s;const o=new Position$1(s.positionLineNumber,s.positionColumn),r=this._deleteInsideWordWhitespace(t,o);return r||this._deleteInsideWordDetermineDeleteRange(e,t,o)}static _charAtIsWhitespace(e,t){const s=e.charCodeAt(t);return s===32||s===9}static _deleteInsideWordWhitespace(e,t){const s=e.getLineContent(t.lineNumber),o=s.length;if(o===0)return null;let r=Math.max(t.column-2,0);if(!this._charAtIsWhitespace(s,r))return null;let l=Math.min(t.column-1,o-1);if(!this._charAtIsWhitespace(s,l))return null;for(;r>0&&this._charAtIsWhitespace(s,r-1);)r--;for(;l+1<o&&this._charAtIsWhitespace(s,l+1);)l++;return new Range$2(t.lineNumber,r+1,t.lineNumber,l+2)}static _deleteInsideWordDetermineDeleteRange(e,t,s){const o=t.getLineContent(s.lineNumber),r=o.length;if(r===0)return s.lineNumber>1?new Range$2(s.lineNumber-1,t.getLineMaxColumn(s.lineNumber-1),s.lineNumber,1):s.lineNumber<t.getLineCount()?new Range$2(s.lineNumber,1,s.lineNumber+1,1):new Range$2(s.lineNumber,1,s.lineNumber,1);const l=f=>f.start+1<=s.column&&s.column<=f.end+1,c=(f,p)=>(f=Math.min(f,s.column),p=Math.max(p,s.column),new Range$2(s.lineNumber,f,s.lineNumber,p)),d=f=>{let p=f.start+1,m=f.end+1,_=!1;for(;m-1<r&&this._charAtIsWhitespace(o,m-1);)_=!0,m++;if(!_)for(;p>1&&this._charAtIsWhitespace(o,p-2);)p--;return c(p,m)},u=WordOperations._findPreviousWordOnLine(e,t,s);if(u&&l(u))return d(u);const g=WordOperations._findNextWordOnLine(e,t,s);return g&&l(g)?d(g):u&&g?c(u.end+1,g.start+1):u?c(u.start+1,u.end+1):g?c(g.start+1,g.end+1):c(1,r+1)}static _deleteWordPartLeft(e,t){if(!t.isEmpty())return t;const s=t.getPosition(),o=WordOperations._moveWordPartLeft(e,s);return new Range$2(s.lineNumber,s.column,o.lineNumber,o.column)}static _findFirstNonWhitespaceChar(e,t){const s=e.length;for(let o=t;o<s;o++){const r=e.charAt(o);if(r!==" "&&r!=="	")return o}return s}static _deleteWordRightWhitespace(e,t){const s=e.getLineContent(t.lineNumber),o=t.column-1,r=this._findFirstNonWhitespaceChar(s,o);return o+1<r?new Range$2(t.lineNumber,t.column,t.lineNumber,r+1):null}static deleteWordRight(e,t){const s=e.wordSeparators,o=e.model,r=e.selection,l=e.whitespaceHeuristics;if(!r.isEmpty())return r;const c=new Position$1(r.positionLineNumber,r.positionColumn);let d=c.lineNumber,u=c.column;const g=o.getLineCount(),f=o.getLineMaxColumn(d);if(d===g&&u===f)return null;if(l){const m=this._deleteWordRightWhitespace(o,c);if(m)return m}let p=WordOperations._findNextWordOnLine(s,o,c);return t===2?p?u=p.end+1:u<f||d===g?u=f:(d++,p=WordOperations._findNextWordOnLine(s,o,new Position$1(d,1)),p?u=p.start+1:u=o.getLineMaxColumn(d)):(p&&u>=p.start+1&&(p=WordOperations._findNextWordOnLine(s,o,new Position$1(d,p.end+1))),p?u=p.start+1:u<f||d===g?u=f:(d++,p=WordOperations._findNextWordOnLine(s,o,new Position$1(d,1)),p?u=p.start+1:u=o.getLineMaxColumn(d))),new Range$2(d,u,c.lineNumber,c.column)}static _deleteWordPartRight(e,t){if(!t.isEmpty())return t;const s=t.getPosition(),o=WordOperations._moveWordPartRight(e,s);return new Range$2(s.lineNumber,s.column,o.lineNumber,o.column)}static _createWordAtPosition(e,t,s){const o=new Range$2(t,s.start+1,t,s.end+1);return{word:e.getValueInRange(o),startColumn:o.startColumn,endColumn:o.endColumn}}static getWordAtPosition(e,t,s,o){const r=getMapForWordSeparators(t,s),l=WordOperations._findPreviousWordOnLine(r,e,o);if(l&&l.wordType===1&&l.start<=o.column-1&&o.column-1<=l.end)return WordOperations._createWordAtPosition(e,o.lineNumber,l);const c=WordOperations._findNextWordOnLine(r,e,o);return c&&c.wordType===1&&c.start<=o.column-1&&o.column-1<=c.end?WordOperations._createWordAtPosition(e,o.lineNumber,c):null}static word(e,t,s,o,r){const l=getMapForWordSeparators(e.wordSeparators,e.wordSegmenterLocales),c=WordOperations._findPreviousWordOnLine(l,t,r),d=WordOperations._findNextWordOnLine(l,t,r);if(!o){let m,_;return c&&c.wordType===1&&c.start<=r.column-1&&r.column-1<=c.end?(m=c.start+1,_=c.end+1):d&&d.wordType===1&&d.start<=r.column-1&&r.column-1<=d.end?(m=d.start+1,_=d.end+1):(c?m=c.end+1:m=1,d?_=d.start+1:_=t.getLineMaxColumn(r.lineNumber)),new SingleCursorState(new Range$2(r.lineNumber,m,r.lineNumber,_),1,0,new Position$1(r.lineNumber,_),0)}let u,g;c&&c.wordType===1&&c.start<r.column-1&&r.column-1<c.end?(u=c.start+1,g=c.end+1):d&&d.wordType===1&&d.start<r.column-1&&r.column-1<d.end?(u=d.start+1,g=d.end+1):(u=r.column,g=r.column);const f=r.lineNumber;let p;if(s.selectionStart.containsPosition(r))p=s.selectionStart.endColumn;else if(r.isBeforeOrEqual(s.selectionStart.getStartPosition())){p=u;const m=new Position$1(f,p);s.selectionStart.containsPosition(m)&&(p=s.selectionStart.endColumn)}else{p=g;const m=new Position$1(f,p);s.selectionStart.containsPosition(m)&&(p=s.selectionStart.startColumn)}return s.move(!0,f,p,0)}}class WordPartOperations extends WordOperations{static deleteWordPartLeft(e){const t=enforceDefined([WordOperations.deleteWordLeft(e,0),WordOperations.deleteWordLeft(e,2),WordOperations._deleteWordPartLeft(e.model,e.selection)]);return t.sort(Range$2.compareRangesUsingEnds),t[2]}static deleteWordPartRight(e){const t=enforceDefined([WordOperations.deleteWordRight(e,0),WordOperations.deleteWordRight(e,2),WordOperations._deleteWordPartRight(e.model,e.selection)]);return t.sort(Range$2.compareRangesUsingStarts),t[0]}static moveWordPartLeft(e,t,s,o){const r=enforceDefined([WordOperations.moveWordLeft(e,t,s,0,o),WordOperations.moveWordLeft(e,t,s,2,o),WordOperations._moveWordPartLeft(t,s)]);return r.sort(Position$1.compare),r[2]}static moveWordPartRight(e,t,s){const o=enforceDefined([WordOperations.moveWordRight(e,t,s,0),WordOperations.moveWordRight(e,t,s,2),WordOperations._moveWordPartRight(t,s)]);return o.sort(Position$1.compare),o[0]}}function enforceDefined(a){return a.filter(e=>!!e)}function deepClone(a){if(!a||typeof a!="object"||a instanceof RegExp)return a;const e=Array.isArray(a)?[]:{};return Object.entries(a).forEach(([t,s])=>{e[t]=s&&typeof s=="object"?deepClone(s):s}),e}function deepFreeze(a){if(!a||typeof a!="object")return a;const e=[a];for(;e.length>0;){const t=e.shift();Object.freeze(t);for(const s in t)if(_hasOwnProperty.call(t,s)){const o=t[s];typeof o=="object"&&!Object.isFrozen(o)&&!isTypedArray(o)&&e.push(o)}}return a}const _hasOwnProperty=Object.prototype.hasOwnProperty;function cloneAndChange(a,e){return _cloneAndChange(a,e,new Set)}function _cloneAndChange(a,e,t){if(isUndefinedOrNull(a))return a;const s=e(a);if(typeof s<"u")return s;if(Array.isArray(a)){const o=[];for(const r of a)o.push(_cloneAndChange(r,e,t));return o}if(isObject(a)){if(t.has(a))throw new Error("Cannot clone recursive data-structure");t.add(a);const o={};for(const r in a)_hasOwnProperty.call(a,r)&&(o[r]=_cloneAndChange(a[r],e,t));return t.delete(a),o}return a}function mixin(a,e,t=!0){return isObject(a)?(isObject(e)&&Object.keys(e).forEach(s=>{s in a?t&&(isObject(a[s])&&isObject(e[s])?mixin(a[s],e[s],t):a[s]=e[s]):a[s]=e[s]}),a):e}function equals(a,e){if(a===e)return!0;if(a==null||e===null||e===void 0||typeof a!=typeof e||typeof a!="object"||Array.isArray(a)!==Array.isArray(e))return!1;let t,s;if(Array.isArray(a)){if(a.length!==e.length)return!1;for(t=0;t<a.length;t++)if(!equals(a[t],e[t]))return!1}else{const o=[];for(s in a)o.push(s);o.sort();const r=[];for(s in e)r.push(s);if(r.sort(),!equals(o,r))return!1;for(t=0;t<o.length;t++)if(!equals(a[o[t]],e[o[t]]))return!1}return!0}var OverviewRulerLane$1;(function(a){a[a.Left=1]="Left",a[a.Center=2]="Center",a[a.Right=4]="Right",a[a.Full=7]="Full"})(OverviewRulerLane$1||(OverviewRulerLane$1={}));var GlyphMarginLane$1;(function(a){a[a.Left=1]="Left",a[a.Center=2]="Center",a[a.Right=3]="Right"})(GlyphMarginLane$1||(GlyphMarginLane$1={}));var TextDirection$1;(function(a){a[a.LTR=0]="LTR",a[a.RTL=1]="RTL"})(TextDirection$1||(TextDirection$1={}));var InjectedTextCursorStops$1;(function(a){a[a.Both=0]="Both",a[a.Right=1]="Right",a[a.Left=2]="Left",a[a.None=3]="None"})(InjectedTextCursorStops$1||(InjectedTextCursorStops$1={}));class TextModelResolvedOptions{get originalIndentSize(){return this._indentSizeIsTabSize?"tabSize":this.indentSize}constructor(e){this._textModelResolvedOptionsBrand=void 0,this.tabSize=Math.max(1,e.tabSize|0),e.indentSize==="tabSize"?(this.indentSize=this.tabSize,this._indentSizeIsTabSize=!0):(this.indentSize=Math.max(1,e.indentSize|0),this._indentSizeIsTabSize=!1),this.insertSpaces=!!e.insertSpaces,this.defaultEOL=e.defaultEOL|0,this.trimAutoWhitespace=!!e.trimAutoWhitespace,this.bracketPairColorizationOptions=e.bracketPairColorizationOptions}equals(e){return this.tabSize===e.tabSize&&this._indentSizeIsTabSize===e._indentSizeIsTabSize&&this.indentSize===e.indentSize&&this.insertSpaces===e.insertSpaces&&this.defaultEOL===e.defaultEOL&&this.trimAutoWhitespace===e.trimAutoWhitespace&&equals(this.bracketPairColorizationOptions,e.bracketPairColorizationOptions)}createChangeEvent(e){return{tabSize:this.tabSize!==e.tabSize,indentSize:this.indentSize!==e.indentSize,insertSpaces:this.insertSpaces!==e.insertSpaces,trimAutoWhitespace:this.trimAutoWhitespace!==e.trimAutoWhitespace}}}class FindMatch{constructor(e,t){this._findMatchBrand=void 0,this.range=e,this.matches=t}}function isITextSnapshot(a){return a&&typeof a.read=="function"}class ValidAnnotatedEditOperation{constructor(e,t,s,o,r,l){this.identifier=e,this.range=t,this.text=s,this.forceMoveMarkers=o,this.isAutoWhitespaceEdit=r,this._isTracked=l}}class SearchData{constructor(e,t,s){this.regex=e,this.wordSeparators=t,this.simpleSearch=s}}class ApplyEditsResult{constructor(e,t,s){this.reverseEdits=e,this.changes=t,this.trimAutoWhitespaceLineNumbers=s}}function shouldSynchronizeModel(a){return!a.isTooLargeForSyncing()&&!a.isForSimpleWidget}class CursorMoveCommands{static addCursorDown(e,t,s){const o=[];let r=0;for(let l=0,c=t.length;l<c;l++){const d=t[l];o[r++]=new CursorState$1(d.modelState,d.viewState),s?o[r++]=CursorState$1.fromModelState(MoveOperations.translateDown(e.cursorConfig,e.model,d.modelState)):o[r++]=CursorState$1.fromViewState(MoveOperations.translateDown(e.cursorConfig,e,d.viewState))}return o}static addCursorUp(e,t,s){const o=[];let r=0;for(let l=0,c=t.length;l<c;l++){const d=t[l];o[r++]=new CursorState$1(d.modelState,d.viewState),s?o[r++]=CursorState$1.fromModelState(MoveOperations.translateUp(e.cursorConfig,e.model,d.modelState)):o[r++]=CursorState$1.fromViewState(MoveOperations.translateUp(e.cursorConfig,e,d.viewState))}return o}static moveToBeginningOfLine(e,t,s){const o=[];for(let r=0,l=t.length;r<l;r++){const c=t[r];o[r]=this._moveToLineStart(e,c,s)}return o}static _moveToLineStart(e,t,s){const o=t.viewState.position.column,r=t.modelState.position.column,l=o===r,c=t.viewState.position.lineNumber,d=e.getLineFirstNonWhitespaceColumn(c);return!l&&!(o===d)?this._moveToLineStartByView(e,t,s):this._moveToLineStartByModel(e,t,s)}static _moveToLineStartByView(e,t,s){return CursorState$1.fromViewState(MoveOperations.moveToBeginningOfLine(e.cursorConfig,e,t.viewState,s))}static _moveToLineStartByModel(e,t,s){return CursorState$1.fromModelState(MoveOperations.moveToBeginningOfLine(e.cursorConfig,e.model,t.modelState,s))}static moveToEndOfLine(e,t,s,o){const r=[];for(let l=0,c=t.length;l<c;l++){const d=t[l];r[l]=this._moveToLineEnd(e,d,s,o)}return r}static _moveToLineEnd(e,t,s,o){const r=t.viewState.position,l=e.getLineMaxColumn(r.lineNumber),c=r.column===l,d=t.modelState.position,u=e.model.getLineMaxColumn(d.lineNumber),g=l-r.column===u-d.column;return c||g?this._moveToLineEndByModel(e,t,s,o):this._moveToLineEndByView(e,t,s,o)}static _moveToLineEndByView(e,t,s,o){return CursorState$1.fromViewState(MoveOperations.moveToEndOfLine(e.cursorConfig,e,t.viewState,s,o))}static _moveToLineEndByModel(e,t,s,o){return CursorState$1.fromModelState(MoveOperations.moveToEndOfLine(e.cursorConfig,e.model,t.modelState,s,o))}static expandLineSelection(e,t){const s=[];for(let o=0,r=t.length;o<r;o++){const l=t[o],c=l.modelState.selection.startLineNumber,d=e.model.getLineCount();let u=l.modelState.selection.endLineNumber,g;u===d?g=e.model.getLineMaxColumn(d):(u++,g=1),s[o]=CursorState$1.fromModelState(new SingleCursorState(new Range$2(c,1,c,1),0,0,new Position$1(u,g),0))}return s}static moveToBeginningOfBuffer(e,t,s){const o=[];for(let r=0,l=t.length;r<l;r++){const c=t[r];o[r]=CursorState$1.fromModelState(MoveOperations.moveToBeginningOfBuffer(e.cursorConfig,e.model,c.modelState,s))}return o}static moveToEndOfBuffer(e,t,s){const o=[];for(let r=0,l=t.length;r<l;r++){const c=t[r];o[r]=CursorState$1.fromModelState(MoveOperations.moveToEndOfBuffer(e.cursorConfig,e.model,c.modelState,s))}return o}static selectAll(e,t){const s=e.model.getLineCount(),o=e.model.getLineMaxColumn(s);return CursorState$1.fromModelState(new SingleCursorState(new Range$2(1,1,1,1),0,0,new Position$1(s,o),0))}static line(e,t,s,o,r){const l=e.model.validatePosition(o),c=r?e.coordinatesConverter.validateViewPosition(new Position$1(r.lineNumber,r.column),l):e.coordinatesConverter.convertModelPositionToViewPosition(l);if(!s){const u=e.model.getLineCount();let g=l.lineNumber+1,f=1;return g>u&&(g=u,f=e.model.getLineMaxColumn(g)),CursorState$1.fromModelState(new SingleCursorState(new Range$2(l.lineNumber,1,g,f),2,0,new Position$1(g,f),0))}const d=t.modelState.selectionStart.getStartPosition().lineNumber;if(l.lineNumber<d)return CursorState$1.fromViewState(t.viewState.move(!0,c.lineNumber,1,0));if(l.lineNumber>d){const u=e.getLineCount();let g=c.lineNumber+1,f=1;return g>u&&(g=u,f=e.getLineMaxColumn(g)),CursorState$1.fromViewState(t.viewState.move(!0,g,f,0))}else{const u=t.modelState.selectionStart.getEndPosition();return CursorState$1.fromModelState(t.modelState.move(!0,u.lineNumber,u.column,0))}}static word(e,t,s,o){const r=e.model.validatePosition(o);return CursorState$1.fromModelState(WordOperations.word(e.cursorConfig,e.model,t.modelState,s,r))}static cancelSelection(e,t){if(!t.modelState.hasSelection())return new CursorState$1(t.modelState,t.viewState);const s=t.viewState.position.lineNumber,o=t.viewState.position.column;return CursorState$1.fromViewState(new SingleCursorState(new Range$2(s,o,s,o),0,0,new Position$1(s,o),0))}static moveTo(e,t,s,o,r){if(s){if(t.modelState.selectionStartKind===1)return this.word(e,t,s,o);if(t.modelState.selectionStartKind===2)return this.line(e,t,s,o,r)}const l=e.model.validatePosition(o),c=r?e.coordinatesConverter.validateViewPosition(new Position$1(r.lineNumber,r.column),l):e.coordinatesConverter.convertModelPositionToViewPosition(l);return CursorState$1.fromViewState(t.viewState.move(s,c.lineNumber,c.column,0))}static simpleMove(e,t,s,o,r,l){switch(s){case 0:return l===4?this._moveHalfLineLeft(e,t,o):this._moveLeft(e,t,o,r);case 1:return l===4?this._moveHalfLineRight(e,t,o):this._moveRight(e,t,o,r);case 2:return l===2?this._moveUpByViewLines(e,t,o,r):this._moveUpByModelLines(e,t,o,r);case 3:return l===2?this._moveDownByViewLines(e,t,o,r):this._moveDownByModelLines(e,t,o,r);case 4:return l===2?t.map(c=>CursorState$1.fromViewState(MoveOperations.moveToPrevBlankLine(e.cursorConfig,e,c.viewState,o))):t.map(c=>CursorState$1.fromModelState(MoveOperations.moveToPrevBlankLine(e.cursorConfig,e.model,c.modelState,o)));case 5:return l===2?t.map(c=>CursorState$1.fromViewState(MoveOperations.moveToNextBlankLine(e.cursorConfig,e,c.viewState,o))):t.map(c=>CursorState$1.fromModelState(MoveOperations.moveToNextBlankLine(e.cursorConfig,e.model,c.modelState,o)));case 6:return this._moveToViewMinColumn(e,t,o);case 7:return this._moveToViewFirstNonWhitespaceColumn(e,t,o);case 8:return this._moveToViewCenterColumn(e,t,o);case 9:return this._moveToViewMaxColumn(e,t,o);case 10:return this._moveToViewLastNonWhitespaceColumn(e,t,o);default:return null}}static viewportMove(e,t,s,o,r){const l=e.getCompletelyVisibleViewRange(),c=e.coordinatesConverter.convertViewRangeToModelRange(l);switch(s){case 11:{const d=this._firstLineNumberInRange(e.model,c,r),u=e.model.getLineFirstNonWhitespaceColumn(d);return[this._moveToModelPosition(e,t[0],o,d,u)]}case 13:{const d=this._lastLineNumberInRange(e.model,c,r),u=e.model.getLineFirstNonWhitespaceColumn(d);return[this._moveToModelPosition(e,t[0],o,d,u)]}case 12:{const d=Math.round((c.startLineNumber+c.endLineNumber)/2),u=e.model.getLineFirstNonWhitespaceColumn(d);return[this._moveToModelPosition(e,t[0],o,d,u)]}case 14:{const d=[];for(let u=0,g=t.length;u<g;u++){const f=t[u];d[u]=this.findPositionInViewportIfOutside(e,f,l,o)}return d}default:return null}}static findPositionInViewportIfOutside(e,t,s,o){const r=t.viewState.position.lineNumber;if(s.startLineNumber<=r&&r<=s.endLineNumber-1)return new CursorState$1(t.modelState,t.viewState);{let l;r>s.endLineNumber-1?l=s.endLineNumber-1:r<s.startLineNumber?l=s.startLineNumber:l=r;const c=MoveOperations.vertical(e.cursorConfig,e,r,t.viewState.position.column,t.viewState.leftoverVisibleColumns,l,!1);return CursorState$1.fromViewState(t.viewState.move(o,c.lineNumber,c.column,c.leftoverVisibleColumns))}}static _firstLineNumberInRange(e,t,s){let o=t.startLineNumber;return t.startColumn!==e.getLineMinColumn(o)&&o++,Math.min(t.endLineNumber,o+s-1)}static _lastLineNumberInRange(e,t,s){let o=t.startLineNumber;return t.startColumn!==e.getLineMinColumn(o)&&o++,Math.max(o,t.endLineNumber-s+1)}static _moveLeft(e,t,s,o){return t.map(r=>{const c=e.getTextDirection(r.viewState.position.lineNumber)===TextDirection$1.RTL;return CursorState$1.fromViewState(c?MoveOperations.moveRight(e.cursorConfig,e,r.viewState,s,o):MoveOperations.moveLeft(e.cursorConfig,e,r.viewState,s,o))})}static _moveHalfLineLeft(e,t,s){const o=[];for(let r=0,l=t.length;r<l;r++){const c=t[r],d=c.viewState.position.lineNumber,u=Math.round(e.getLineLength(d)/2);o[r]=CursorState$1.fromViewState(MoveOperations.moveLeft(e.cursorConfig,e,c.viewState,s,u))}return o}static _moveRight(e,t,s,o){return t.map(r=>{const c=e.getTextDirection(r.viewState.position.lineNumber)===TextDirection$1.RTL;return CursorState$1.fromViewState(c?MoveOperations.moveLeft(e.cursorConfig,e,r.viewState,s,o):MoveOperations.moveRight(e.cursorConfig,e,r.viewState,s,o))})}static _moveHalfLineRight(e,t,s){const o=[];for(let r=0,l=t.length;r<l;r++){const c=t[r],d=c.viewState.position.lineNumber,u=Math.round(e.getLineLength(d)/2);o[r]=CursorState$1.fromViewState(MoveOperations.moveRight(e.cursorConfig,e,c.viewState,s,u))}return o}static _moveDownByViewLines(e,t,s,o){const r=[];for(let l=0,c=t.length;l<c;l++){const d=t[l];r[l]=CursorState$1.fromViewState(MoveOperations.moveDown(e.cursorConfig,e,d.viewState,s,o))}return r}static _moveDownByModelLines(e,t,s,o){const r=[];for(let l=0,c=t.length;l<c;l++){const d=t[l];r[l]=CursorState$1.fromModelState(MoveOperations.moveDown(e.cursorConfig,e.model,d.modelState,s,o))}return r}static _moveUpByViewLines(e,t,s,o){const r=[];for(let l=0,c=t.length;l<c;l++){const d=t[l];r[l]=CursorState$1.fromViewState(MoveOperations.moveUp(e.cursorConfig,e,d.viewState,s,o))}return r}static _moveUpByModelLines(e,t,s,o){const r=[];for(let l=0,c=t.length;l<c;l++){const d=t[l];r[l]=CursorState$1.fromModelState(MoveOperations.moveUp(e.cursorConfig,e.model,d.modelState,s,o))}return r}static _moveToViewPosition(e,t,s,o,r){return CursorState$1.fromViewState(t.viewState.move(s,o,r,0))}static _moveToModelPosition(e,t,s,o,r){return CursorState$1.fromModelState(t.modelState.move(s,o,r,0))}static _moveToViewMinColumn(e,t,s){const o=[];for(let r=0,l=t.length;r<l;r++){const c=t[r],d=c.viewState.position.lineNumber,u=e.getLineMinColumn(d);o[r]=this._moveToViewPosition(e,c,s,d,u)}return o}static _moveToViewFirstNonWhitespaceColumn(e,t,s){const o=[];for(let r=0,l=t.length;r<l;r++){const c=t[r],d=c.viewState.position.lineNumber,u=e.getLineFirstNonWhitespaceColumn(d);o[r]=this._moveToViewPosition(e,c,s,d,u)}return o}static _moveToViewCenterColumn(e,t,s){const o=[];for(let r=0,l=t.length;r<l;r++){const c=t[r],d=c.viewState.position.lineNumber,u=Math.round((e.getLineMaxColumn(d)+e.getLineMinColumn(d))/2);o[r]=this._moveToViewPosition(e,c,s,d,u)}return o}static _moveToViewMaxColumn(e,t,s){const o=[];for(let r=0,l=t.length;r<l;r++){const c=t[r],d=c.viewState.position.lineNumber,u=e.getLineMaxColumn(d);o[r]=this._moveToViewPosition(e,c,s,d,u)}return o}static _moveToViewLastNonWhitespaceColumn(e,t,s){const o=[];for(let r=0,l=t.length;r<l;r++){const c=t[r],d=c.viewState.position.lineNumber,u=e.getLineLastNonWhitespaceColumn(d);o[r]=this._moveToViewPosition(e,c,s,d,u)}return o}}var CursorMove;(function(a){const e=function(s){if(!isObject(s))return!1;const o=s;return!(!isString$1(o.to)||!isUndefined(o.select)&&!isBoolean(o.select)||!isUndefined(o.by)&&!isString$1(o.by)||!isUndefined(o.value)&&!isNumber$1(o.value))};a.metadata={description:"Move cursor to a logical position in the view",args:[{name:"Cursor move argument object",description:`Property-value pairs that can be passed through this argument:
					* 'to': A mandatory logical position value providing where to move the cursor.
						\`\`\`
						'left', 'right', 'up', 'down', 'prevBlankLine', 'nextBlankLine',
						'wrappedLineStart', 'wrappedLineEnd', 'wrappedLineColumnCenter'
						'wrappedLineFirstNonWhitespaceCharacter', 'wrappedLineLastNonWhitespaceCharacter'
						'viewPortTop', 'viewPortCenter', 'viewPortBottom', 'viewPortIfOutside'
						\`\`\`
					* 'by': Unit to move. Default is computed based on 'to' value.
						\`\`\`
						'line', 'wrappedLine', 'character', 'halfLine'
						\`\`\`
					* 'value': Number of units to move. Default is '1'.
					* 'select': If 'true' makes the selection. Default is 'false'.
				`,constraint:e,schema:{type:"object",required:["to"],properties:{to:{type:"string",enum:["left","right","up","down","prevBlankLine","nextBlankLine","wrappedLineStart","wrappedLineEnd","wrappedLineColumnCenter","wrappedLineFirstNonWhitespaceCharacter","wrappedLineLastNonWhitespaceCharacter","viewPortTop","viewPortCenter","viewPortBottom","viewPortIfOutside"]},by:{type:"string",enum:["line","wrappedLine","character","halfLine"]},value:{type:"number",default:1},select:{type:"boolean",default:!1}}}}]},a.RawDirection={Left:"left",Right:"right",Up:"up",Down:"down",PrevBlankLine:"prevBlankLine",NextBlankLine:"nextBlankLine",WrappedLineStart:"wrappedLineStart",WrappedLineFirstNonWhitespaceCharacter:"wrappedLineFirstNonWhitespaceCharacter",WrappedLineColumnCenter:"wrappedLineColumnCenter",WrappedLineEnd:"wrappedLineEnd",WrappedLineLastNonWhitespaceCharacter:"wrappedLineLastNonWhitespaceCharacter",ViewPortTop:"viewPortTop",ViewPortCenter:"viewPortCenter",ViewPortBottom:"viewPortBottom",ViewPortIfOutside:"viewPortIfOutside"},a.RawUnit={Line:"line",WrappedLine:"wrappedLine",Character:"character",HalfLine:"halfLine"};function t(s){if(!s.to)return null;let o;switch(s.to){case a.RawDirection.Left:o=0;break;case a.RawDirection.Right:o=1;break;case a.RawDirection.Up:o=2;break;case a.RawDirection.Down:o=3;break;case a.RawDirection.PrevBlankLine:o=4;break;case a.RawDirection.NextBlankLine:o=5;break;case a.RawDirection.WrappedLineStart:o=6;break;case a.RawDirection.WrappedLineFirstNonWhitespaceCharacter:o=7;break;case a.RawDirection.WrappedLineColumnCenter:o=8;break;case a.RawDirection.WrappedLineEnd:o=9;break;case a.RawDirection.WrappedLineLastNonWhitespaceCharacter:o=10;break;case a.RawDirection.ViewPortTop:o=11;break;case a.RawDirection.ViewPortBottom:o=13;break;case a.RawDirection.ViewPortCenter:o=12;break;case a.RawDirection.ViewPortIfOutside:o=14;break;default:return null}let r=0;switch(s.by){case a.RawUnit.Line:r=1;break;case a.RawUnit.WrappedLine:r=2;break;case a.RawUnit.Character:r=3;break;case a.RawUnit.HalfLine:r=4;break}return{direction:o,unit:r,select:!!s.select,value:s.value||1}}a.parse=t})(CursorMove||(CursorMove={}));var IndentAction$1;(function(a){a[a.None=0]="None",a[a.Indent=1]="Indent",a[a.IndentOutdent=2]="IndentOutdent",a[a.Outdent=3]="Outdent"})(IndentAction$1||(IndentAction$1={}));class StandardAutoClosingPairConditional{constructor(e){if(this._neutralCharacter=null,this._neutralCharacterSearched=!1,this.open=e.open,this.close=e.close,this._inString=!0,this._inComment=!0,this._inRegEx=!0,Array.isArray(e.notIn))for(let t=0,s=e.notIn.length;t<s;t++)switch(e.notIn[t]){case"string":this._inString=!1;break;case"comment":this._inComment=!1;break;case"regex":this._inRegEx=!1;break}}isOK(e){switch(e){case 0:return!0;case 1:return this._inComment;case 2:return this._inString;case 3:return this._inRegEx}}shouldAutoClose(e,t){if(e.getTokenCount()===0)return!0;const s=e.findTokenIndexAtOffset(t-2),o=e.getStandardTokenType(s);return this.isOK(o)}_findNeutralCharacterInRange(e,t){for(let s=e;s<=t;s++){const o=String.fromCharCode(s);if(!this.open.includes(o)&&!this.close.includes(o))return o}return null}findNeutralCharacter(){return this._neutralCharacterSearched||(this._neutralCharacterSearched=!0,this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(48,57)),this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(97,122)),this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(65,90))),this._neutralCharacter}}class AutoClosingPairs{constructor(e){this.autoClosingPairsOpenByStart=new Map,this.autoClosingPairsOpenByEnd=new Map,this.autoClosingPairsCloseByStart=new Map,this.autoClosingPairsCloseByEnd=new Map,this.autoClosingPairsCloseSingleChar=new Map;for(const t of e)appendEntry(this.autoClosingPairsOpenByStart,t.open.charAt(0),t),appendEntry(this.autoClosingPairsOpenByEnd,t.open.charAt(t.open.length-1),t),appendEntry(this.autoClosingPairsCloseByStart,t.close.charAt(0),t),appendEntry(this.autoClosingPairsCloseByEnd,t.close.charAt(t.close.length-1),t),t.close.length===1&&t.open.length===1&&appendEntry(this.autoClosingPairsCloseSingleChar,t.close,t)}}function appendEntry(a,e,t){a.has(e)?a.get(e).push(t):a.set(e,[t])}const USUAL_WORD_SEPARATORS="`~!@#$%^&*()-=+[{]}\\|;:'\",.<>/?";function createWordRegExp(a=""){let e="(-?\\d*\\.\\d\\w*)|([^";for(const t of USUAL_WORD_SEPARATORS)a.indexOf(t)>=0||(e+="\\"+t);return e+="\\s]+)",new RegExp(e,"g")}const DEFAULT_WORD_REGEXP=createWordRegExp();function ensureValidWordDefinition(a){let e=DEFAULT_WORD_REGEXP;if(a&&a instanceof RegExp)if(a.global)e=a;else{let t="g";a.ignoreCase&&(t+="i"),a.multiline&&(t+="m"),a.unicode&&(t+="u"),e=new RegExp(a.source,t)}return e.lastIndex=0,e}const _defaultConfig=new LinkedList;_defaultConfig.unshift({maxLen:1e3,windowSize:15,timeBudget:150});function getWordAtText(a,e,t,s,o){if(e=ensureValidWordDefinition(e),o||(o=Iterable.first(_defaultConfig)),t.length>o.maxLen){let u=a-o.maxLen/2;return u<0?u=0:s+=u,t=t.substring(u,a+o.maxLen/2),getWordAtText(a,e,t,s,o)}const r=Date.now(),l=a-1-s;let c=-1,d=null;for(let u=1;!(Date.now()-r>=o.timeBudget);u++){const g=l-o.windowSize*u;e.lastIndex=Math.max(0,g);const f=_findRegexMatchEnclosingPosition(e,t,l,c);if(!f&&d||(d=f,g<=0))break;c=g}if(d){const u={word:d[0],startColumn:s+1+d.index,endColumn:s+1+d.index+d[0].length};return e.lastIndex=0,u}return null}function _findRegexMatchEnclosingPosition(a,e,t,s){let o;for(;o=a.exec(e);){const r=o.index||0;if(r<=t&&a.lastIndex>=t)return o;if(s>0&&r>s)return null}return null}const ei=class ei{constructor(e){if(e.autoClosingPairs?this._autoClosingPairs=e.autoClosingPairs.map(t=>new StandardAutoClosingPairConditional(t)):e.brackets?this._autoClosingPairs=e.brackets.map(t=>new StandardAutoClosingPairConditional({open:t[0],close:t[1]})):this._autoClosingPairs=[],e.__electricCharacterSupport&&e.__electricCharacterSupport.docComment){const t=e.__electricCharacterSupport.docComment;this._autoClosingPairs.push(new StandardAutoClosingPairConditional({open:t.open,close:t.close||""}))}this._autoCloseBeforeForQuotes=typeof e.autoCloseBefore=="string"?e.autoCloseBefore:ei.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_QUOTES,this._autoCloseBeforeForBrackets=typeof e.autoCloseBefore=="string"?e.autoCloseBefore:ei.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_BRACKETS,this._surroundingPairs=e.surroundingPairs||this._autoClosingPairs}getAutoClosingPairs(){return this._autoClosingPairs}getAutoCloseBeforeSet(e){return e?this._autoCloseBeforeForQuotes:this._autoCloseBeforeForBrackets}getSurroundingPairs(){return this._surroundingPairs}};ei.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_QUOTES=`;:.,=}])> 
	`,ei.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_BRACKETS=`'"\`;:.,=}])> 
	`;let CharacterPairSupport=ei,_utf16LE_TextDecoder;function getUTF16LE_TextDecoder(){return _utf16LE_TextDecoder||(_utf16LE_TextDecoder=new TextDecoder("UTF-16LE")),_utf16LE_TextDecoder}let _utf16BE_TextDecoder;function getUTF16BE_TextDecoder(){return _utf16BE_TextDecoder||(_utf16BE_TextDecoder=new TextDecoder("UTF-16BE")),_utf16BE_TextDecoder}let _platformTextDecoder;function getPlatformTextDecoder(){return _platformTextDecoder||(_platformTextDecoder=isLittleEndian()?getUTF16LE_TextDecoder():getUTF16BE_TextDecoder()),_platformTextDecoder}function decodeUTF16LE(a,e,t){const s=new Uint16Array(a.buffer,e,t);return t>0&&(s[0]===65279||s[0]===65534)?compatDecodeUTF16LE(a,e,t):getUTF16LE_TextDecoder().decode(s)}function compatDecodeUTF16LE(a,e,t){const s=[];let o=0;for(let r=0;r<t;r++){const l=readUInt16LE(a,e);e+=2,s[o++]=String.fromCharCode(l)}return s.join("")}class StringBuilder{constructor(e){this._capacity=e|0,this._buffer=new Uint16Array(this._capacity),this._completedStrings=null,this._bufferLength=0}reset(){this._completedStrings=null,this._bufferLength=0}build(){return this._completedStrings!==null?(this._flushBuffer(),this._completedStrings.join("")):this._buildBuffer()}_buildBuffer(){if(this._bufferLength===0)return"";const e=new Uint16Array(this._buffer.buffer,0,this._bufferLength);return getPlatformTextDecoder().decode(e)}_flushBuffer(){const e=this._buildBuffer();this._bufferLength=0,this._completedStrings===null?this._completedStrings=[e]:this._completedStrings[this._completedStrings.length]=e}appendCharCode(e){const t=this._capacity-this._bufferLength;t<=1&&(t===0||isHighSurrogate(e))&&this._flushBuffer(),this._buffer[this._bufferLength++]=e}appendASCIICharCode(e){this._bufferLength===this._capacity&&this._flushBuffer(),this._buffer[this._bufferLength++]=e}appendString(e){const t=e.length;if(this._bufferLength+t>=this._capacity){this._flushBuffer(),this._completedStrings[this._completedStrings.length]=e;return}for(let s=0;s<t;s++)this._buffer[this._bufferLength++]=e.charCodeAt(s)}}class RichEditBracket{constructor(e,t,s,o,r,l){this._richEditBracketBrand=void 0,this.languageId=e,this.index=t,this.open=s,this.close=o,this.forwardRegex=r,this.reversedRegex=l,this._openSet=RichEditBracket._toSet(this.open),this._closeSet=RichEditBracket._toSet(this.close)}isOpen(e){return this._openSet.has(e)}isClose(e){return this._closeSet.has(e)}static _toSet(e){const t=new Set;for(const s of e)t.add(s);return t}}function groupFuzzyBrackets(a){const e=a.length;a=a.map(l=>[l[0].toLowerCase(),l[1].toLowerCase()]);const t=[];for(let l=0;l<e;l++)t[l]=l;const s=(l,c)=>{const[d,u]=l,[g,f]=c;return d===g||d===f||u===g||u===f},o=(l,c)=>{const d=Math.min(l,c),u=Math.max(l,c);for(let g=0;g<e;g++)t[g]===u&&(t[g]=d)};for(let l=0;l<e;l++){const c=a[l];for(let d=l+1;d<e;d++){const u=a[d];s(c,u)&&o(t[l],t[d])}}const r=[];for(let l=0;l<e;l++){const c=[],d=[];for(let u=0;u<e;u++)if(t[u]===l){const[g,f]=a[u];c.push(g),d.push(f)}c.length>0&&r.push({open:c,close:d})}return r}class RichEditBrackets{constructor(e,t){this._richEditBracketsBrand=void 0;const s=groupFuzzyBrackets(t);this.brackets=s.map((o,r)=>new RichEditBracket(e,r,o.open,o.close,getRegexForBracketPair(o.open,o.close,s,r),getReversedRegexForBracketPair(o.open,o.close,s,r))),this.forwardRegex=getRegexForBrackets(this.brackets),this.reversedRegex=getReversedRegexForBrackets(this.brackets),this.textIsBracket={},this.textIsOpenBracket={},this.maxBracketLength=0;for(const o of this.brackets){for(const r of o.open)this.textIsBracket[r]=o,this.textIsOpenBracket[r]=!0,this.maxBracketLength=Math.max(this.maxBracketLength,r.length);for(const r of o.close)this.textIsBracket[r]=o,this.textIsOpenBracket[r]=!1,this.maxBracketLength=Math.max(this.maxBracketLength,r.length)}}}function collectSuperstrings(a,e,t,s){for(let o=0,r=e.length;o<r;o++){if(o===t)continue;const l=e[o];for(const c of l.open)c.indexOf(a)>=0&&s.push(c);for(const c of l.close)c.indexOf(a)>=0&&s.push(c)}}function lengthcmp(a,e){return a.length-e.length}function unique(a){if(a.length<=1)return a;const e=[],t=new Set;for(const s of a)t.has(s)||(e.push(s),t.add(s));return e}function getRegexForBracketPair(a,e,t,s){let o=[];o=o.concat(a),o=o.concat(e);for(let r=0,l=o.length;r<l;r++)collectSuperstrings(o[r],t,s,o);return o=unique(o),o.sort(lengthcmp),o.reverse(),createBracketOrRegExp(o)}function getReversedRegexForBracketPair(a,e,t,s){let o=[];o=o.concat(a),o=o.concat(e);for(let r=0,l=o.length;r<l;r++)collectSuperstrings(o[r],t,s,o);return o=unique(o),o.sort(lengthcmp),o.reverse(),createBracketOrRegExp(o.map(toReversedString))}function getRegexForBrackets(a){let e=[];for(const t of a){for(const s of t.open)e.push(s);for(const s of t.close)e.push(s)}return e=unique(e),createBracketOrRegExp(e)}function getReversedRegexForBrackets(a){let e=[];for(const t of a){for(const s of t.open)e.push(s);for(const s of t.close)e.push(s)}return e=unique(e),createBracketOrRegExp(e.map(toReversedString))}function prepareBracketForRegExp$1(a){const e=/^[\w ]+$/.test(a);return a=escapeRegExpCharacters(a),e?`\\b${a}\\b`:a}function createBracketOrRegExp(a,e){const t=`(${a.map(prepareBracketForRegExp$1).join(")|(")})`;return createRegExp(t,!0,e)}const toReversedString=function(){function a(s){const o=new Uint16Array(s.length);let r=0;for(let l=s.length-1;l>=0;l--)o[r++]=s.charCodeAt(l);return getPlatformTextDecoder().decode(o)}let e=null,t=null;return function(o){return e!==o&&(e=o,t=a(e)),t}}();class BracketsUtils{static _findPrevBracketInText(e,t,s,o){const r=s.match(e);if(!r)return null;const l=s.length-(r.index||0),c=r[0].length,d=o+l;return new Range$2(t,d-c+1,t,d+1)}static findPrevBracketInRange(e,t,s,o,r){const c=toReversedString(s).substring(s.length-r,s.length-o);return this._findPrevBracketInText(e,t,c,o)}static findNextBracketInText(e,t,s,o){const r=s.match(e);if(!r)return null;const l=r.index||0,c=r[0].length;if(c===0)return null;const d=o+l;return new Range$2(t,d+1,t,d+1+c)}static findNextBracketInRange(e,t,s,o,r){const l=s.substring(o,r);return this.findNextBracketInText(e,t,l,o)}}class BracketElectricCharacterSupport{constructor(e){this._richEditBrackets=e}getElectricCharacters(){const e=[];if(this._richEditBrackets)for(const t of this._richEditBrackets.brackets)for(const s of t.close){const o=s.charAt(s.length-1);e.push(o)}return distinct(e)}onElectricCharacter(e,t,s){if(!this._richEditBrackets||this._richEditBrackets.brackets.length===0)return null;const o=t.findTokenIndexAtOffset(s-1);if(ignoreBracketsInToken(t.getStandardTokenType(o)))return null;const r=this._richEditBrackets.reversedRegex,l=t.getLineContent().substring(0,s-1)+e,c=BracketsUtils.findPrevBracketInRange(r,1,l,0,l.length);if(!c)return null;const d=l.substring(c.startColumn-1,c.endColumn-1).toLowerCase();if(this._richEditBrackets.textIsOpenBracket[d])return null;const g=t.getActualLineContentBefore(c.startColumn-1);return/^\s*$/.test(g)?{matchOpenBracket:d}:null}}function resetGlobalRegex(a){return a.global&&(a.lastIndex=0),!0}class IndentRulesSupport{constructor(e){this._indentationRules=e}shouldIncrease(e){return!!(this._indentationRules&&this._indentationRules.increaseIndentPattern&&resetGlobalRegex(this._indentationRules.increaseIndentPattern)&&this._indentationRules.increaseIndentPattern.test(e))}shouldDecrease(e){return!!(this._indentationRules&&this._indentationRules.decreaseIndentPattern&&resetGlobalRegex(this._indentationRules.decreaseIndentPattern)&&this._indentationRules.decreaseIndentPattern.test(e))}shouldIndentNextLine(e){return!!(this._indentationRules&&this._indentationRules.indentNextLinePattern&&resetGlobalRegex(this._indentationRules.indentNextLinePattern)&&this._indentationRules.indentNextLinePattern.test(e))}shouldIgnore(e){return!!(this._indentationRules&&this._indentationRules.unIndentedLinePattern&&resetGlobalRegex(this._indentationRules.unIndentedLinePattern)&&this._indentationRules.unIndentedLinePattern.test(e))}getIndentMetadata(e){let t=0;return this.shouldIncrease(e)&&(t+=1),this.shouldDecrease(e)&&(t+=2),this.shouldIndentNextLine(e)&&(t+=4),this.shouldIgnore(e)&&(t+=8),t}}class OnEnterSupport{constructor(e){e=e||{},e.brackets=e.brackets||[["(",")"],["{","}"],["[","]"]],this._brackets=[],e.brackets.forEach(t=>{const s=OnEnterSupport._createOpenBracketRegExp(t[0]),o=OnEnterSupport._createCloseBracketRegExp(t[1]);s&&o&&this._brackets.push({open:t[0],openRegExp:s,close:t[1],closeRegExp:o})}),this._regExpRules=e.onEnterRules||[]}onEnter(e,t,s,o){if(e>=3)for(let r=0,l=this._regExpRules.length;r<l;r++){const c=this._regExpRules[r];if([{reg:c.beforeText,text:s},{reg:c.afterText,text:o},{reg:c.previousLineText,text:t}].every(u=>u.reg?(u.reg.lastIndex=0,u.reg.test(u.text)):!0))return c.action}if(e>=2&&s.length>0&&o.length>0)for(let r=0,l=this._brackets.length;r<l;r++){const c=this._brackets[r];if(c.openRegExp.test(s)&&c.closeRegExp.test(o))return{indentAction:IndentAction$1.IndentOutdent}}if(e>=2&&s.length>0){for(let r=0,l=this._brackets.length;r<l;r++)if(this._brackets[r].openRegExp.test(s))return{indentAction:IndentAction$1.Indent}}return null}static _createOpenBracketRegExp(e){let t=escapeRegExpCharacters(e);return/\B/.test(t.charAt(0))||(t="\\b"+t),t+="\\s*$",OnEnterSupport._safeRegExp(t)}static _createCloseBracketRegExp(e){let t=escapeRegExpCharacters(e);return/\B/.test(t.charAt(t.length-1))||(t=t+"\\b"),t="^\\s*"+t,OnEnterSupport._safeRegExp(t)}static _safeRegExp(e){try{return new RegExp(e)}catch(t){return onUnexpectedError(t),null}}}const IConfigurationService=createDecorator("configurationService");function toValuesTree(a,e){const t=Object.create(null);for(const s in a)addToValueTree(t,s,a[s],e);return t}function addToValueTree(a,e,t,s){const o=e.split("."),r=o.pop();let l=a;for(let c=0;c<o.length;c++){const d=o[c];let u=l[d];switch(typeof u){case"undefined":u=l[d]=Object.create(null);break;case"object":if(u===null){s(`Ignoring ${e} as ${o.slice(0,c+1).join(".")} is null`);return}break;default:s(`Ignoring ${e} as ${o.slice(0,c+1).join(".")} is ${JSON.stringify(u)}`);return}l=u}if(typeof l=="object"&&l!==null)try{l[r]=t}catch{s(`Ignoring ${e} as ${o.join(".")} is ${JSON.stringify(l)}`)}else s(`Ignoring ${e} as ${o.join(".")} is ${JSON.stringify(l)}`)}function removeFromValueTree(a,e){const t=e.split(".");doRemoveFromValueTree(a,t)}function doRemoveFromValueTree(a,e){if(!a)return;const t=e.shift();if(e.length===0){delete a[t];return}if(Object.keys(a).indexOf(t)!==-1){const s=a[t];typeof s=="object"&&!Array.isArray(s)&&(doRemoveFromValueTree(s,e),Object.keys(s).length===0&&delete a[t])}}function getConfigurationValue(a,e,t){function s(l,c){let d=l;for(const u of c){if(typeof d!="object"||d===null)return;d=d[u]}return d}const o=e.split("."),r=s(a,o);return typeof r>"u"?t:r}function getLanguageTagSettingPlainKey(a){return a.replace(/^\[/,"").replace(/]$/g,"").replace(/\]\[/g,", ")}const ILanguageService=createDecorator("languageService");class SyncDescriptor{constructor(e,t=[],s=!1){this.ctor=e,this.staticArguments=t,this.supportsDelayedInstantiation=s}}const _registry=[];function registerSingleton(a,e,t){e instanceof SyncDescriptor||(e=new SyncDescriptor(e,[],!!t)),_registry.push([a,e])}function getSingletonServiceDescriptors(){return _registry}const Mimes=Object.freeze({text:"text/plain",binary:"application/octet-stream",unknown:"application/unknown",markdown:"text/markdown",latex:"text/latex",uriList:"text/uri-list",html:"text/html"}),Extensions$7={JSONContribution:"base.contributions.json"};function normalizeId(a){return a.length>0&&a.charAt(a.length-1)==="#"?a.substring(0,a.length-1):a}class JSONContributionRegistry extends Disposable{constructor(){super(...arguments),this.schemasById={},this._onDidChangeSchema=this._register(new Emitter$1)}registerSchema(e,t,s){const o=normalizeId(e);this.schemasById[o]=t,this._onDidChangeSchema.fire(e),s&&s.add(toDisposable(()=>{delete this.schemasById[o],this._onDidChangeSchema.fire(e)}))}notifySchemaChanged(e){this._onDidChangeSchema.fire(e)}}const jsonContributionRegistry=new JSONContributionRegistry;Registry.add(Extensions$7.JSONContribution,jsonContributionRegistry);const Extensions$6={Configuration:"base.contributions.configuration"},resourceLanguageSettingsSchemaId="vscode://schemas/settings/resourceLanguage",contributionRegistry=Registry.as(Extensions$7.JSONContribution);class ConfigurationRegistry extends Disposable{constructor(){super(),this.registeredConfigurationDefaults=[],this.overrideIdentifiers=new Set,this._onDidSchemaChange=this._register(new Emitter$1),this._onDidUpdateConfiguration=this._register(new Emitter$1),this.configurationDefaultsOverrides=new Map,this.defaultLanguageConfigurationOverridesNode={id:"defaultOverrides",title:localize(1649,"Default Language Configuration Overrides"),properties:{}},this.configurationContributors=[this.defaultLanguageConfigurationOverridesNode],this.resourceLanguageSettingsSchema={properties:{},patternProperties:{},additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},this.configurationProperties={},this.policyConfigurations=new Map,this.excludedConfigurationProperties={},contributionRegistry.registerSchema(resourceLanguageSettingsSchemaId,this.resourceLanguageSettingsSchema),this.registerOverridePropertyPatternKey()}registerConfiguration(e,t=!0){return this.registerConfigurations([e],t),e}registerConfigurations(e,t=!0){const s=new Set;this.doRegisterConfigurations(e,t,s),contributionRegistry.registerSchema(resourceLanguageSettingsSchemaId,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:s})}registerDefaultConfigurations(e){const t=new Set;this.doRegisterDefaultConfigurations(e,t),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:t,defaultsOverrides:!0})}doRegisterDefaultConfigurations(e,t){this.registeredConfigurationDefaults.push(...e);const s=[];for(const{overrides:o,source:r}of e)for(const l in o){t.add(l);const c=this.configurationDefaultsOverrides.get(l)??this.configurationDefaultsOverrides.set(l,{configurationDefaultOverrides:[]}).get(l),d=o[l];if(c.configurationDefaultOverrides.push({value:d,source:r}),OVERRIDE_PROPERTY_REGEX.test(l)){const u=this.mergeDefaultConfigurationsForOverrideIdentifier(l,d,r,c.configurationDefaultOverrideValue);if(!u)continue;c.configurationDefaultOverrideValue=u,this.updateDefaultOverrideProperty(l,u,r),s.push(...overrideIdentifiersFromKey(l))}else{const u=this.mergeDefaultConfigurationsForConfigurationProperty(l,d,r,c.configurationDefaultOverrideValue);if(!u)continue;c.configurationDefaultOverrideValue=u;const g=this.configurationProperties[l];g&&(this.updatePropertyDefaultValue(l,g),this.updateSchema(l,g))}}this.doRegisterOverrideIdentifiers(s)}updateDefaultOverrideProperty(e,t,s){const o={type:"object",default:t.value,description:localize(1650,"Configure settings to be overridden for {0}.",getLanguageTagSettingPlainKey(e)),$ref:resourceLanguageSettingsSchemaId,defaultDefaultValue:t.value,source:s,defaultValueSource:s};this.configurationProperties[e]=o,this.defaultLanguageConfigurationOverridesNode.properties[e]=o}mergeDefaultConfigurationsForOverrideIdentifier(e,t,s,o){const r=(o==null?void 0:o.value)||{},l=(o==null?void 0:o.source)??new Map;if(!(l instanceof Map)){console.error("objectConfigurationSources is not a Map");return}for(const c of Object.keys(t)){const d=t[c];if(isObject(d)&&(isUndefined(r[c])||isObject(r[c]))){if(r[c]={...r[c]??{},...d},s)for(const g in d)l.set(`${c}.${g}`,s)}else r[c]=d,s?l.set(c,s):l.delete(c)}return{value:r,source:l}}mergeDefaultConfigurationsForConfigurationProperty(e,t,s,o){const r=this.configurationProperties[e],l=(o==null?void 0:o.value)??(r==null?void 0:r.defaultDefaultValue);let c=s;if(isObject(t)&&(r!==void 0&&r.type==="object"||r===void 0&&(isUndefined(l)||isObject(l)))){if(c=(o==null?void 0:o.source)??new Map,!(c instanceof Map)){console.error("defaultValueSource is not a Map");return}for(const u in t)s&&c.set(`${e}.${u}`,s);t={...isObject(l)?l:{},...t}}return{value:t,source:c}}registerOverrideIdentifiers(e){this.doRegisterOverrideIdentifiers(e),this._onDidSchemaChange.fire()}doRegisterOverrideIdentifiers(e){for(const t of e)this.overrideIdentifiers.add(t);this.updateOverridePropertyPatternKey()}doRegisterConfigurations(e,t,s){e.forEach(o=>{this.validateAndRegisterProperties(o,t,o.extensionInfo,o.restrictedProperties,void 0,s),this.configurationContributors.push(o),this.registerJSONConfiguration(o)})}validateAndRegisterProperties(e,t=!0,s,o,r=4,l){var u,g,f;r=isUndefinedOrNull(e.scope)?r:e.scope;const c=e.properties;if(c)for(const p in c){const m=c[p];if(t&&validateProperty(p,m)){delete c[p];continue}m.source=s,m.defaultDefaultValue=c[p].default,this.updatePropertyDefaultValue(p,m),OVERRIDE_PROPERTY_REGEX.test(p)?m.scope=void 0:(m.scope=isUndefinedOrNull(m.scope)?r:m.scope,m.restricted=isUndefinedOrNull(m.restricted)?!!(o!=null&&o.includes(p)):m.restricted),m.experiment?(u=m.tags)!=null&&u.some(b=>b.toLowerCase()==="onexp")||(m.tags=m.tags??[],m.tags.push("onExP")):(g=m.tags)!=null&&g.some(b=>b.toLowerCase()==="onexp")&&(console.error(`Invalid tag 'onExP' found for property '${p}'. Please use 'experiment' property instead.`),m.experiment={mode:"startup"});const _=c[p].hasOwnProperty("included")&&!c[p].included,C=(f=c[p].policy)==null?void 0:f.name;_?(this.excludedConfigurationProperties[p]=c[p],C&&(this.policyConfigurations.set(C,p),l.add(p)),delete c[p]):(l.add(p),C&&this.policyConfigurations.set(C,p),this.configurationProperties[p]=c[p],!c[p].deprecationMessage&&c[p].markdownDeprecationMessage&&(c[p].deprecationMessage=c[p].markdownDeprecationMessage))}const d=e.allOf;if(d)for(const p of d)this.validateAndRegisterProperties(p,t,s,o,r,l)}getConfigurationProperties(){return this.configurationProperties}getPolicyConfigurations(){return this.policyConfigurations}getExcludedConfigurationProperties(){return this.excludedConfigurationProperties}registerJSONConfiguration(e){const t=s=>{const o=s.properties;if(o)for(const l in o)this.updateSchema(l,o[l]);const r=s.allOf;r==null||r.forEach(t)};t(e)}updateSchema(e,t){switch(t.scope){case 1:break;case 2:break;case 3:break;case 7:break;case 4:break;case 5:break;case 6:this.resourceLanguageSettingsSchema.properties[e]=t;break}}updateOverridePropertyPatternKey(){for(const e of this.overrideIdentifiers.values()){const t=`[${e}]`,s={type:"object",description:localize(1651,"Configure editor settings to be overridden for a language."),errorMessage:localize(1652,"This setting does not support per-language configuration."),$ref:resourceLanguageSettingsSchemaId};this.updatePropertyDefaultValue(t,s)}}registerOverridePropertyPatternKey(){localize(1653,"Configure editor settings to be overridden for a language."),localize(1654,"This setting does not support per-language configuration."),this._onDidSchemaChange.fire()}updatePropertyDefaultValue(e,t){var l;const s=(l=this.configurationDefaultsOverrides.get(e))==null?void 0:l.configurationDefaultOverrideValue;let o,r;s&&(!t.disallowConfigurationDefault||!s.source)&&(o=s.value,r=s.source),isUndefined(o)&&(o=t.defaultDefaultValue,r=void 0),isUndefined(o)&&(o=getDefaultValue(t.type)),t.default=o,t.defaultValueSource=r}}const OVERRIDE_IDENTIFIER_PATTERN="\\[([^\\]]+)\\]",OVERRIDE_IDENTIFIER_REGEX=new RegExp(OVERRIDE_IDENTIFIER_PATTERN,"g"),OVERRIDE_PROPERTY_PATTERN=`^(${OVERRIDE_IDENTIFIER_PATTERN})+$`,OVERRIDE_PROPERTY_REGEX=new RegExp(OVERRIDE_PROPERTY_PATTERN);function overrideIdentifiersFromKey(a){const e=[];if(OVERRIDE_PROPERTY_REGEX.test(a)){let t=OVERRIDE_IDENTIFIER_REGEX.exec(a);for(;t!=null&&t.length;){const s=t[1].trim();s&&e.push(s),t=OVERRIDE_IDENTIFIER_REGEX.exec(a)}}return distinct(e)}function getDefaultValue(a){switch(Array.isArray(a)?a[0]:a){case"boolean":return!1;case"integer":case"number":return 0;case"string":return"";case"array":return[];case"object":return{};default:return null}}const configurationRegistry$2=new ConfigurationRegistry;Registry.add(Extensions$6.Configuration,configurationRegistry$2);function validateProperty(a,e){var t,s,o,r;return a.trim()?OVERRIDE_PROPERTY_REGEX.test(a)?localize(1656,"Cannot register '{0}'. This matches property pattern '\\\\[.*\\\\]$' for describing language specific editor settings. Use 'configurationDefaults' contribution.",a):configurationRegistry$2.getConfigurationProperties()[a]!==void 0?localize(1657,"Cannot register '{0}'. This property is already registered.",a):(t=e.policy)!=null&&t.name&&configurationRegistry$2.getPolicyConfigurations().get((s=e.policy)==null?void 0:s.name)!==void 0?localize(1658,"Cannot register '{0}'. The associated policy {1} is already registered with {2}.",a,(o=e.policy)==null?void 0:o.name,configurationRegistry$2.getPolicyConfigurations().get((r=e.policy)==null?void 0:r.name)):null:localize(1655,"Cannot register an empty property")}const Extensions$5={ModesRegistry:"editor.modesRegistry"};class EditorModesRegistry extends Disposable{constructor(){super(),this._onDidChangeLanguages=this._register(new Emitter$1),this.onDidChangeLanguages=this._onDidChangeLanguages.event,this._languages=[]}registerLanguage(e){return this._languages.push(e),this._onDidChangeLanguages.fire(void 0),{dispose:()=>{for(let t=0,s=this._languages.length;t<s;t++)if(this._languages[t]===e){this._languages.splice(t,1);return}}}}getLanguages(){return this._languages}}const ModesRegistry=new EditorModesRegistry;Registry.add(Extensions$5.ModesRegistry,ModesRegistry);const PLAINTEXT_LANGUAGE_ID="plaintext",PLAINTEXT_EXTENSION=".txt";ModesRegistry.registerLanguage({id:PLAINTEXT_LANGUAGE_ID,extensions:[PLAINTEXT_EXTENSION],aliases:[localize(780,"Plain Text"),"text"],mimetypes:[Mimes.text]});Registry.as(Extensions$6.Configuration).registerDefaultConfigurations([{overrides:{"[plaintext]":{"editor.unicodeHighlight.ambiguousCharacters":!1,"editor.unicodeHighlight.invisibleCharacters":!1},"[go]":{"editor.insertSpaces":!1},"[makefile]":{"editor.insertSpaces":!1},"[shellscript]":{"files.eol":`
`},"[yaml]":{"editor.insertSpaces":!0,"editor.tabSize":2}}}]);class LanguageBracketsConfiguration{constructor(e,t){this.languageId=e;const s=t.brackets?filterValidBrackets(t.brackets):[],o=new CachedFunction(c=>{const d=new Set;return{info:new OpeningBracketKind(this,c,d),closing:d}}),r=new CachedFunction(c=>{const d=new Set,u=new Set;return{info:new ClosingBracketKind(this,c,d,u),opening:d,openingColorized:u}});for(const[c,d]of s){const u=o.get(c),g=r.get(d);u.closing.add(g.info),g.opening.add(u.info)}const l=t.colorizedBracketPairs?filterValidBrackets(t.colorizedBracketPairs):s.filter(c=>!(c[0]==="<"&&c[1]===">"));for(const[c,d]of l){const u=o.get(c),g=r.get(d);u.closing.add(g.info),g.openingColorized.add(u.info),g.opening.add(u.info)}this._openingBrackets=new Map([...o.cachedValues].map(([c,d])=>[c,d.info])),this._closingBrackets=new Map([...r.cachedValues].map(([c,d])=>[c,d.info]))}get openingBrackets(){return[...this._openingBrackets.values()]}get closingBrackets(){return[...this._closingBrackets.values()]}getOpeningBracketInfo(e){return this._openingBrackets.get(e)}getClosingBracketInfo(e){return this._closingBrackets.get(e)}getBracketInfo(e){return this.getOpeningBracketInfo(e)||this.getClosingBracketInfo(e)}getBracketRegExp(e){const t=Array.from([...this._openingBrackets.keys(),...this._closingBrackets.keys()]);return createBracketOrRegExp(t,e)}}function filterValidBrackets(a){return a.filter(([e,t])=>e!==""&&t!=="")}class BracketKindBase{constructor(e,t){this.config=e,this.bracketText=t}get languageId(){return this.config.languageId}}class OpeningBracketKind extends BracketKindBase{constructor(e,t,s){super(e,t),this.openedBrackets=s,this.isOpeningBracket=!0}}class ClosingBracketKind extends BracketKindBase{constructor(e,t,s,o){super(e,t),this.openingBrackets=s,this.openingColorizedBrackets=o,this.isOpeningBracket=!1}closes(e){return e.config!==this.config?!1:this.openingBrackets.has(e)}closesColorized(e){return e.config!==this.config?!1:this.openingColorizedBrackets.has(e)}getOpeningBrackets(){return[...this.openingBrackets]}}var __decorate$2Y=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2R=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class LanguageConfigurationServiceChangeEvent{constructor(e){this.languageId=e}affects(e){return this.languageId?this.languageId===e:!0}}const ILanguageConfigurationService=createDecorator("languageConfigurationService");let LanguageConfigurationService=class extends Disposable{constructor(e,t){super(),this.configurationService=e,this.languageService=t,this._registry=this._register(new LanguageConfigurationRegistry),this.onDidChangeEmitter=this._register(new Emitter$1),this.onDidChange=this.onDidChangeEmitter.event,this.configurations=new Map;const s=new Set(Object.values(customizedLanguageConfigKeys));this._register(this.configurationService.onDidChangeConfiguration(o=>{const r=o.change.keys.some(c=>s.has(c)),l=o.change.overrides.filter(([c,d])=>d.some(u=>s.has(u))).map(([c])=>c);if(r)this.configurations.clear(),this.onDidChangeEmitter.fire(new LanguageConfigurationServiceChangeEvent(void 0));else for(const c of l)this.languageService.isRegisteredLanguageId(c)&&(this.configurations.delete(c),this.onDidChangeEmitter.fire(new LanguageConfigurationServiceChangeEvent(c)))})),this._register(this._registry.onDidChange(o=>{this.configurations.delete(o.languageId),this.onDidChangeEmitter.fire(new LanguageConfigurationServiceChangeEvent(o.languageId))}))}register(e,t,s){return this._registry.register(e,t,s)}getLanguageConfiguration(e){let t=this.configurations.get(e);return t||(t=computeConfig(e,this._registry,this.configurationService,this.languageService),this.configurations.set(e,t)),t}};LanguageConfigurationService=__decorate$2Y([__param$2R(0,IConfigurationService),__param$2R(1,ILanguageService)],LanguageConfigurationService);function computeConfig(a,e,t,s){let o=e.getLanguageConfiguration(a);if(!o){if(!s.isRegisteredLanguageId(a))return new ResolvedLanguageConfiguration(a,{});o=new ResolvedLanguageConfiguration(a,{})}const r=getCustomizedLanguageConfig(o.languageId,t),l=combineLanguageConfigurations([o.underlyingConfig,r]);return new ResolvedLanguageConfiguration(o.languageId,l)}const customizedLanguageConfigKeys={brackets:"editor.language.brackets",colorizedBracketPairs:"editor.language.colorizedBracketPairs"};function getCustomizedLanguageConfig(a,e){const t=e.getValue(customizedLanguageConfigKeys.brackets,{overrideIdentifier:a}),s=e.getValue(customizedLanguageConfigKeys.colorizedBracketPairs,{overrideIdentifier:a});return{brackets:validateBracketPairs(t),colorizedBracketPairs:validateBracketPairs(s)}}function validateBracketPairs(a){if(Array.isArray(a))return a.map(e=>{if(!(!Array.isArray(e)||e.length!==2))return[e[0],e[1]]}).filter(e=>!!e)}function getIndentationAtPosition(a,e,t){const s=a.getLineContent(e);let o=getLeadingWhitespace(s);return o.length>t-1&&(o=o.substring(0,t-1)),o}class ComposedLanguageConfiguration{constructor(e){this.languageId=e,this._resolved=null,this._entries=[],this._order=0,this._resolved=null}register(e,t){const s=new LanguageConfigurationContribution(e,t,++this._order);return this._entries.push(s),this._resolved=null,toDisposable(()=>{for(let o=0;o<this._entries.length;o++)if(this._entries[o]===s){this._entries.splice(o,1),this._resolved=null;break}})}getResolvedConfiguration(){if(!this._resolved){const e=this._resolve();e&&(this._resolved=new ResolvedLanguageConfiguration(this.languageId,e))}return this._resolved}_resolve(){return this._entries.length===0?null:(this._entries.sort(LanguageConfigurationContribution.cmp),combineLanguageConfigurations(this._entries.map(e=>e.configuration)))}}function combineLanguageConfigurations(a){let e={comments:void 0,brackets:void 0,wordPattern:void 0,indentationRules:void 0,onEnterRules:void 0,autoClosingPairs:void 0,surroundingPairs:void 0,autoCloseBefore:void 0,folding:void 0,colorizedBracketPairs:void 0,__electricCharacterSupport:void 0};for(const t of a)e={comments:t.comments||e.comments,brackets:t.brackets||e.brackets,wordPattern:t.wordPattern||e.wordPattern,indentationRules:t.indentationRules||e.indentationRules,onEnterRules:t.onEnterRules||e.onEnterRules,autoClosingPairs:t.autoClosingPairs||e.autoClosingPairs,surroundingPairs:t.surroundingPairs||e.surroundingPairs,autoCloseBefore:t.autoCloseBefore||e.autoCloseBefore,folding:t.folding||e.folding,colorizedBracketPairs:t.colorizedBracketPairs||e.colorizedBracketPairs,__electricCharacterSupport:t.__electricCharacterSupport||e.__electricCharacterSupport};return e}class LanguageConfigurationContribution{constructor(e,t,s){this.configuration=e,this.priority=t,this.order=s}static cmp(e,t){return e.priority===t.priority?e.order-t.order:e.priority-t.priority}}class LanguageConfigurationChangeEvent{constructor(e){this.languageId=e}}class LanguageConfigurationRegistry extends Disposable{constructor(){super(),this._entries=new Map,this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,this._register(this.register(PLAINTEXT_LANGUAGE_ID,{brackets:[["(",")"],["[","]"],["{","}"]],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:"<",close:">"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}],colorizedBracketPairs:[],folding:{offSide:!0}},0))}register(e,t,s=0){let o=this._entries.get(e);o||(o=new ComposedLanguageConfiguration(e),this._entries.set(e,o));const r=o.register(t,s);return this._onDidChange.fire(new LanguageConfigurationChangeEvent(e)),toDisposable(()=>{r.dispose(),this._onDidChange.fire(new LanguageConfigurationChangeEvent(e))})}getLanguageConfiguration(e){const t=this._entries.get(e);return(t==null?void 0:t.getResolvedConfiguration())||null}}class ResolvedLanguageConfiguration{constructor(e,t){this.languageId=e,this.underlyingConfig=t,this._brackets=null,this._electricCharacter=null,this._onEnterSupport=this.underlyingConfig.brackets||this.underlyingConfig.indentationRules||this.underlyingConfig.onEnterRules?new OnEnterSupport(this.underlyingConfig):null,this.comments=ResolvedLanguageConfiguration._handleComments(this.underlyingConfig),this.characterPair=new CharacterPairSupport(this.underlyingConfig),this.wordDefinition=this.underlyingConfig.wordPattern||DEFAULT_WORD_REGEXP,this.indentationRules=this.underlyingConfig.indentationRules,this.underlyingConfig.indentationRules?this.indentRulesSupport=new IndentRulesSupport(this.underlyingConfig.indentationRules):this.indentRulesSupport=null,this.foldingRules=this.underlyingConfig.folding||{},this.bracketsNew=new LanguageBracketsConfiguration(e,this.underlyingConfig)}getWordDefinition(){return ensureValidWordDefinition(this.wordDefinition)}get brackets(){return!this._brackets&&this.underlyingConfig.brackets&&(this._brackets=new RichEditBrackets(this.languageId,this.underlyingConfig.brackets)),this._brackets}get electricCharacter(){return this._electricCharacter||(this._electricCharacter=new BracketElectricCharacterSupport(this.brackets)),this._electricCharacter}onEnter(e,t,s,o){return this._onEnterSupport?this._onEnterSupport.onEnter(e,t,s,o):null}getAutoClosingPairs(){return new AutoClosingPairs(this.characterPair.getAutoClosingPairs())}getAutoCloseBeforeSet(e){return this.characterPair.getAutoCloseBeforeSet(e)}getSurroundingPairs(){return this.characterPair.getSurroundingPairs()}static _handleComments(e){const t=e.comments;if(!t)return null;const s={};if(t.lineComment&&(typeof t.lineComment=="string"?s.lineCommentToken=t.lineComment:(s.lineCommentToken=t.lineComment.comment,s.lineCommentNoIndent=t.lineComment.noIndent)),t.blockComment){const[o,r]=t.blockComment;s.blockCommentStartToken=o,s.blockCommentEndToken=r}return s}}registerSingleton(ILanguageConfigurationService,LanguageConfigurationService,1);class TokenMetadata{static getLanguageId(e){return(e&255)>>>0}static getTokenType(e){return(e&768)>>>8}static containsBalancedBrackets(e){return(e&1024)!==0}static getFontStyle(e){return(e&30720)>>>11}static getForeground(e){return(e&16744448)>>>15}static getBackground(e){return(e&4278190080)>>>24}static getClassNameFromMetadata(e){let s="mtk"+this.getForeground(e);const o=this.getFontStyle(e);return o&1&&(s+=" mtki"),o&2&&(s+=" mtkb"),o&4&&(s+=" mtku"),o&8&&(s+=" mtks"),s}static getInlineStyleFromMetadata(e,t){const s=this.getForeground(e),o=this.getFontStyle(e);let r=`color: ${t[s]};`;o&1&&(r+="font-style: italic;"),o&2&&(r+="font-weight: bold;");let l="";return o&4&&(l+=" underline"),o&8&&(l+=" line-through"),l&&(r+=`text-decoration:${l};`),r}static getPresentationFromMetadata(e){const t=this.getForeground(e),s=this.getFontStyle(e);return{foreground:t,italic:!!(s&1),bold:!!(s&2),underline:!!(s&4),strikethrough:!!(s&8)}}}class OffsetRange{static fromTo(e,t){return new OffsetRange(e,t)}static addRange(e,t){let s=0;for(;s<t.length&&t[s].endExclusive<e.start;)s++;let o=s;for(;o<t.length&&t[o].start<=e.endExclusive;)o++;if(s===o)t.splice(s,0,e);else{const r=Math.min(e.start,t[s].start),l=Math.max(e.endExclusive,t[o-1].endExclusive);t.splice(s,o-s,new OffsetRange(r,l))}}static tryCreate(e,t){if(!(e>t))return new OffsetRange(e,t)}static ofLength(e){return new OffsetRange(0,e)}static ofStartAndLength(e,t){return new OffsetRange(e,e+t)}static emptyAt(e){return new OffsetRange(e,e)}constructor(e,t){if(this.start=e,this.endExclusive=t,e>t)throw new BugIndicatingError(`Invalid range: ${this.toString()}`)}get isEmpty(){return this.start===this.endExclusive}delta(e){return new OffsetRange(this.start+e,this.endExclusive+e)}deltaStart(e){return new OffsetRange(this.start+e,this.endExclusive)}deltaEnd(e){return new OffsetRange(this.start,this.endExclusive+e)}get length(){return this.endExclusive-this.start}toString(){return`[${this.start}, ${this.endExclusive})`}equals(e){return this.start===e.start&&this.endExclusive===e.endExclusive}contains(e){return this.start<=e&&e<this.endExclusive}join(e){return new OffsetRange(Math.min(this.start,e.start),Math.max(this.endExclusive,e.endExclusive))}intersect(e){const t=Math.max(this.start,e.start),s=Math.min(this.endExclusive,e.endExclusive);if(t<=s)return new OffsetRange(t,s)}intersectionLength(e){const t=Math.max(this.start,e.start),s=Math.min(this.endExclusive,e.endExclusive);return Math.max(0,s-t)}intersects(e){const t=Math.max(this.start,e.start),s=Math.min(this.endExclusive,e.endExclusive);return t<s}intersectsOrTouches(e){const t=Math.max(this.start,e.start),s=Math.min(this.endExclusive,e.endExclusive);return t<=s}isBefore(e){return this.endExclusive<=e.start}isAfter(e){return this.start>=e.endExclusive}slice(e){return e.slice(this.start,this.endExclusive)}substring(e){return e.substring(this.start,this.endExclusive)}clip(e){if(this.isEmpty)throw new BugIndicatingError(`Invalid clipping range: ${this.toString()}`);return Math.max(this.start,Math.min(this.endExclusive-1,e))}clipCyclic(e){if(this.isEmpty)throw new BugIndicatingError(`Invalid clipping range: ${this.toString()}`);return e<this.start?this.endExclusive-(this.start-e)%this.length:e>=this.endExclusive?this.start+(e-this.start)%this.length:e}forEach(e){for(let t=this.start;t<this.endExclusive;t++)e(t)}joinRightTouching(e){if(this.endExclusive!==e.start)throw new BugIndicatingError(`Invalid join: ${this.toString()} and ${e.toString()}`);return new OffsetRange(this.start,e.endExclusive)}}class OffsetRangeSet{constructor(){this._sortedRanges=[]}addRange(e){let t=0;for(;t<this._sortedRanges.length&&this._sortedRanges[t].endExclusive<e.start;)t++;let s=t;for(;s<this._sortedRanges.length&&this._sortedRanges[s].start<=e.endExclusive;)s++;if(t===s)this._sortedRanges.splice(t,0,e);else{const o=Math.min(e.start,this._sortedRanges[t].start),r=Math.max(e.endExclusive,this._sortedRanges[s-1].endExclusive);this._sortedRanges.splice(t,s-t,new OffsetRange(o,r))}}toString(){return this._sortedRanges.map(e=>e.toString()).join(", ")}intersectsStrict(e){let t=0;for(;t<this._sortedRanges.length&&this._sortedRanges[t].endExclusive<=e.start;)t++;return t<this._sortedRanges.length&&this._sortedRanges[t].start<e.endExclusive}intersectWithRange(e){const t=new OffsetRangeSet;for(const s of this._sortedRanges){const o=s.intersect(e);o&&t.addRange(o)}return t}intersectWithRangeLength(e){return this.intersectWithRange(e).length}get length(){return this._sortedRanges.reduce((e,t)=>e+t.length,0)}}const Ge=class Ge{static createEmpty(e,t){const s=Ge.defaultTokenMetadata,o=new Uint32Array(2);return o[0]=e.length,o[1]=s,new Ge(o,e,t)}static createFromTextAndMetadata(e,t){let s=0,o="";const r=new Array;for(const{text:l,metadata:c}of e)r.push(s+l.length,c),s+=l.length,o+=l;return new Ge(new Uint32Array(r),o,t)}static convertToEndOffset(e,t){const o=(e.length>>>1)-1;for(let r=0;r<o;r++)e[r<<1]=e[r+1<<1];e[o<<1]=t}static findIndexInTokensArray(e,t){if(e.length<=2)return 0;let s=0,o=(e.length>>>1)-1;for(;s<o;){const r=s+Math.floor((o-s)/2),l=e[r<<1];if(l===t)return r+1;l<t?s=r+1:l>t&&(o=r)}return s}constructor(e,t,s){this._lineTokensBrand=void 0,(e.length>1?e[e.length-2]:0)!==t.length&&onUnexpectedError(new Error("Token length and text length do not match!")),this._tokens=e,this._tokensCount=this._tokens.length>>>1,this._text=t,this.languageIdCodec=s}getTextLength(){return this._text.length}equals(e){return e instanceof Ge?this.slicedEquals(e,0,this._tokensCount):!1}slicedEquals(e,t,s){if(this._text!==e._text||this._tokensCount!==e._tokensCount)return!1;const o=t<<1,r=o+(s<<1);for(let l=o;l<r;l++)if(this._tokens[l]!==e._tokens[l])return!1;return!0}getLineContent(){return this._text}getCount(){return this._tokensCount}getStartOffset(e){return e>0?this._tokens[e-1<<1]:0}getMetadata(e){return this._tokens[(e<<1)+1]}getLanguageId(e){const t=this._tokens[(e<<1)+1],s=TokenMetadata.getLanguageId(t);return this.languageIdCodec.decodeLanguageId(s)}getStandardTokenType(e){const t=this._tokens[(e<<1)+1];return TokenMetadata.getTokenType(t)}getForeground(e){const t=this._tokens[(e<<1)+1];return TokenMetadata.getForeground(t)}getClassName(e){const t=this._tokens[(e<<1)+1];return TokenMetadata.getClassNameFromMetadata(t)}getInlineStyle(e,t){const s=this._tokens[(e<<1)+1];return TokenMetadata.getInlineStyleFromMetadata(s,t)}getPresentation(e){const t=this._tokens[(e<<1)+1];return TokenMetadata.getPresentationFromMetadata(t)}getEndOffset(e){return this._tokens[e<<1]}findTokenIndexAtOffset(e){return Ge.findIndexInTokensArray(this._tokens,e)}inflate(){return this}sliceAndInflate(e,t,s){return new SliceLineTokens(this,e,t,s)}sliceZeroCopy(e){return this.sliceAndInflate(e.start,e.endExclusive,0)}withInserted(e){if(e.length===0)return this;let t=0,s=0,o="";const r=new Array;let l=0;for(;;){const c=t<this._tokensCount?this._tokens[t<<1]:-1,d=s<e.length?e[s]:null;if(c!==-1&&(d===null||c<=d.offset)){o+=this._text.substring(l,c);const u=this._tokens[(t<<1)+1];r.push(o.length,u),t++,l=c}else if(d){if(d.offset>l){o+=this._text.substring(l,d.offset);const u=this._tokens[(t<<1)+1];r.push(o.length,u),l=d.offset}o+=d.text,r.push(o.length,d.tokenMetadata),s++}else break}return new Ge(new Uint32Array(r),o,this.languageIdCodec)}getTokensInRange(e){const t=new TokenArrayBuilder,s=this.findTokenIndexAtOffset(e.start),o=this.findTokenIndexAtOffset(e.endExclusive);for(let r=s;r<=o;r++){const c=new OffsetRange(this.getStartOffset(r),this.getEndOffset(r)).intersectionLength(e);c>0&&t.add(c,this.getMetadata(r))}return t.build()}getTokenText(e){const t=this.getStartOffset(e),s=this.getEndOffset(e);return this._text.substring(t,s)}forEach(e){const t=this.getCount();for(let s=0;s<t;s++)e(s)}toString(){let e="";return this.forEach(t=>{e+=`[${this.getTokenText(t)}]{${this.getClassName(t)}}`}),e}};Ge.defaultTokenMetadata=(32768|2<<24)>>>0;let LineTokens=Ge;class SliceLineTokens{constructor(e,t,s,o){this._source=e,this._startOffset=t,this._endOffset=s,this._deltaOffset=o,this._firstTokenIndex=e.findTokenIndexAtOffset(t),this.languageIdCodec=e.languageIdCodec,this._tokensCount=0;for(let r=this._firstTokenIndex,l=e.getCount();r<l&&!(e.getStartOffset(r)>=s);r++)this._tokensCount++}getMetadata(e){return this._source.getMetadata(this._firstTokenIndex+e)}getLanguageId(e){return this._source.getLanguageId(this._firstTokenIndex+e)}getLineContent(){return this._source.getLineContent().substring(this._startOffset,this._endOffset)}equals(e){return e instanceof SliceLineTokens?this._startOffset===e._startOffset&&this._endOffset===e._endOffset&&this._deltaOffset===e._deltaOffset&&this._source.slicedEquals(e._source,this._firstTokenIndex,this._tokensCount):!1}getCount(){return this._tokensCount}getStandardTokenType(e){return this._source.getStandardTokenType(this._firstTokenIndex+e)}getForeground(e){return this._source.getForeground(this._firstTokenIndex+e)}getEndOffset(e){const t=this._source.getEndOffset(this._firstTokenIndex+e);return Math.min(this._endOffset,t)-this._startOffset+this._deltaOffset}getClassName(e){return this._source.getClassName(this._firstTokenIndex+e)}getInlineStyle(e,t){return this._source.getInlineStyle(this._firstTokenIndex+e,t)}getPresentation(e){return this._source.getPresentation(this._firstTokenIndex+e)}findTokenIndexAtOffset(e){return this._source.findTokenIndexAtOffset(e+this._startOffset-this._deltaOffset)-this._firstTokenIndex}getTokenText(e){const t=this._firstTokenIndex+e,s=this._source.getStartOffset(t),o=this._source.getEndOffset(t);let r=this._source.getTokenText(t);return s<this._startOffset&&(r=r.substring(this._startOffset-s)),o>this._endOffset&&(r=r.substring(0,r.length-(o-this._endOffset))),r}forEach(e){for(let t=0;t<this.getCount();t++)e(t)}}function getStandardTokenTypeAtPosition(a,e){const t=e.lineNumber;if(!a.tokenization.isCheapToTokenize(t))return;a.tokenization.forceTokenization(t);const s=a.tokenization.getLineTokens(t),o=s.findTokenIndexAtOffset(e.column-1);return s.getStandardTokenType(o)}class TokenArray{static fromLineTokens(e){const t=[];for(let s=0;s<e.getCount();s++)t.push(new TokenInfo(e.getEndOffset(s)-e.getStartOffset(s),e.getMetadata(s)));return TokenArray.create(t)}static create(e){return new TokenArray(e)}constructor(e){this._tokenInfo=e}toLineTokens(e,t){return LineTokens.createFromTextAndMetadata(this.map((s,o)=>({text:s.substring(e),metadata:o.metadata})),t)}forEach(e){let t=0;for(const s of this._tokenInfo){const o=new OffsetRange(t,t+s.length);e(o,s),t+=s.length}}map(e){const t=[];let s=0;for(const o of this._tokenInfo){const r=new OffsetRange(s,s+o.length);t.push(e(r,o)),s+=o.length}return t}slice(e){const t=[];let s=0;for(const o of this._tokenInfo){const r=s,l=r+o.length;if(l>e.start){if(r>=e.endExclusive)break;const c=Math.max(0,e.start-r),d=Math.max(0,l-e.endExclusive);t.push(new TokenInfo(o.length-c-d,o.metadata))}s+=o.length}return TokenArray.create(t)}}class TokenInfo{constructor(e,t){this.length=e,this.metadata=t}}class TokenArrayBuilder{constructor(){this._tokens=[]}add(e,t){this._tokens.push(new TokenInfo(e,t))}build(){return TokenArray.create(this._tokens)}}class ProcessedIndentRulesSupport{constructor(e,t,s){this._indentRulesSupport=t,this._indentationLineProcessor=new IndentationLineProcessor(e,s)}shouldIncrease(e,t){const s=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldIncrease(s)}shouldDecrease(e,t){const s=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldDecrease(s)}shouldIgnore(e,t){const s=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldIgnore(s)}shouldIndentNextLine(e,t){const s=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldIndentNextLine(s)}}class IndentationContextProcessor{constructor(e,t){this.model=e,this.indentationLineProcessor=new IndentationLineProcessor(e,t)}getProcessedTokenContextAroundRange(e){const t=this._getProcessedTokensBeforeRange(e),s=this._getProcessedTokensAfterRange(e),o=this._getProcessedPreviousLineTokens(e);return{beforeRangeProcessedTokens:t,afterRangeProcessedTokens:s,previousLineProcessedTokens:o}}_getProcessedTokensBeforeRange(e){this.model.tokenization.forceTokenization(e.startLineNumber);const t=this.model.tokenization.getLineTokens(e.startLineNumber),s=createScopedLineTokens(t,e.startColumn-1);let o;if(isLanguageDifferentFromLineStart(this.model,e.getStartPosition())){const l=e.startColumn-1-s.firstCharOffset,c=s.firstCharOffset,d=c+l;o=t.sliceAndInflate(c,d,0)}else{const l=e.startColumn-1;o=t.sliceAndInflate(0,l,0)}return this.indentationLineProcessor.getProcessedTokens(o)}_getProcessedTokensAfterRange(e){const t=e.isEmpty()?e.getStartPosition():e.getEndPosition();this.model.tokenization.forceTokenization(t.lineNumber);const s=this.model.tokenization.getLineTokens(t.lineNumber),o=createScopedLineTokens(s,t.column-1),r=t.column-1-o.firstCharOffset,l=o.firstCharOffset+r,c=o.firstCharOffset+o.getLineLength(),d=s.sliceAndInflate(l,c,0);return this.indentationLineProcessor.getProcessedTokens(d)}_getProcessedPreviousLineTokens(e){const t=m=>{this.model.tokenization.forceTokenization(m);const _=this.model.tokenization.getLineTokens(m),C=this.model.getLineMaxColumn(m)-1;return createScopedLineTokens(_,C)};this.model.tokenization.forceTokenization(e.startLineNumber);const s=this.model.tokenization.getLineTokens(e.startLineNumber),o=createScopedLineTokens(s,e.startColumn-1),r=LineTokens.createEmpty("",o.languageIdCodec),l=e.startLineNumber-1;if(l===0||!(o.firstCharOffset===0))return r;const u=t(l);if(!(o.languageId===u.languageId))return r;const f=u.toIViewLineTokens();return this.indentationLineProcessor.getProcessedTokens(f)}}class IndentationLineProcessor{constructor(e,t){this.model=e,this.languageConfigurationService=t}getProcessedLine(e,t){var l,c;const s=(d,u)=>{const g=getLeadingWhitespace(d);return u+d.substring(g.length)};(c=(l=this.model.tokenization).forceTokenization)==null||c.call(l,e);const o=this.model.tokenization.getLineTokens(e);let r=this.getProcessedTokens(o).getLineContent();return t!==void 0&&(r=s(r,t)),r}getProcessedTokens(e){const t=d=>d===2||d===3||d===1,s=e.getLanguageId(0),r=this.languageConfigurationService.getLanguageConfiguration(s).bracketsNew.getBracketRegExp({global:!0}),l=[];return e.forEach(d=>{const u=e.getStandardTokenType(d);let g=e.getTokenText(d);t(u)&&(g=g.replace(r,""));const f=e.getMetadata(d);l.push({text:g,metadata:f})}),LineTokens.createFromTextAndMetadata(l,e.languageIdCodec)}}function isLanguageDifferentFromLineStart(a,e){a.tokenization.forceTokenization(e.lineNumber);const t=a.tokenization.getLineTokens(e.lineNumber),s=createScopedLineTokens(t,e.column-1),o=s.firstCharOffset===0,r=t.getLanguageId(0)===s.languageId;return!o&&!r}function getEnterAction(a,e,t,s){e.tokenization.forceTokenization(t.startLineNumber);const o=e.getLanguageIdAtPosition(t.startLineNumber,t.startColumn),r=s.getLanguageConfiguration(o);if(!r)return null;const c=new IndentationContextProcessor(e,s).getProcessedTokenContextAroundRange(t),d=c.previousLineProcessedTokens.getLineContent(),u=c.beforeRangeProcessedTokens.getLineContent(),g=c.afterRangeProcessedTokens.getLineContent(),f=r.onEnter(a,d,u,g);if(!f)return null;const p=f.indentAction;let m=f.appendText;const _=f.removeText||0;m?p===IndentAction$1.Indent&&(m="	"+m):p===IndentAction$1.Indent||p===IndentAction$1.IndentOutdent?m="	":m="";let C=getIndentationAtPosition(e,t.startLineNumber,t.startColumn);return _&&(C=C.substring(0,C.length-_)),{indentAction:p,appendText:m,removeText:_,indentation:C}}var __decorate$2X=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2Q=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},ShiftCommand_1;const repeatCache=Object.create(null);function cachedStringRepeat(a,e){if(e<=0)return"";repeatCache[a]||(repeatCache[a]=["",a]);const t=repeatCache[a];for(let s=t.length;s<=e;s++)t[s]=t[s-1]+a;return t[e]}let ShiftCommand=ShiftCommand_1=class{static unshiftIndent(e,t,s,o,r){const l=CursorColumns.visibleColumnFromColumn(e,t,s);if(r){const c=cachedStringRepeat(" ",o),u=CursorColumns.prevIndentTabStop(l,o)/o;return cachedStringRepeat(c,u)}else{const c="	",u=CursorColumns.prevRenderTabStop(l,s)/s;return cachedStringRepeat(c,u)}}static shiftIndent(e,t,s,o,r){const l=CursorColumns.visibleColumnFromColumn(e,t,s);if(r){const c=cachedStringRepeat(" ",o),u=CursorColumns.nextIndentTabStop(l,o)/o;return cachedStringRepeat(c,u)}else{const c="	",u=CursorColumns.nextRenderTabStop(l,s)/s;return cachedStringRepeat(c,u)}}constructor(e,t,s){this._languageConfigurationService=s,this._opts=t,this._selection=e,this._selectionId=null,this._useLastEditRangeForCursorEndPosition=!1,this._selectionStartColumnStaysPut=!1}_addEditOperation(e,t,s){this._useLastEditRangeForCursorEndPosition?e.addTrackedEditOperation(t,s):e.addEditOperation(t,s)}getEditOperations(e,t){const s=this._selection.startLineNumber;let o=this._selection.endLineNumber;this._selection.endColumn===1&&s!==o&&(o=o-1);const{tabSize:r,indentSize:l,insertSpaces:c}=this._opts,d=s===o;if(this._opts.useTabStops){this._selection.isEmpty()&&/^\s*$/.test(e.getLineContent(s))&&(this._useLastEditRangeForCursorEndPosition=!0);let u=0,g=0;for(let f=s;f<=o;f++,u=g){g=0;const p=e.getLineContent(f);let m=firstNonWhitespaceIndex(p);if(this._opts.isUnshift&&(p.length===0||m===0)||!d&&!this._opts.isUnshift&&p.length===0)continue;if(m===-1&&(m=p.length),f>1&&CursorColumns.visibleColumnFromColumn(p,m+1,r)%l!==0&&e.tokenization.isCheapToTokenize(f-1)){const b=getEnterAction(this._opts.autoIndent,e,new Range$2(f-1,e.getLineMaxColumn(f-1),f-1,e.getLineMaxColumn(f-1)),this._languageConfigurationService);if(b){if(g=u,b.appendText)for(let v=0,S=b.appendText.length;v<S&&g<l&&b.appendText.charCodeAt(v)===32;v++)g++;b.removeText&&(g=Math.max(0,g-b.removeText));for(let v=0;v<g&&!(m===0||p.charCodeAt(m-1)!==32);v++)m--}}if(this._opts.isUnshift&&m===0)continue;let _;this._opts.isUnshift?_=ShiftCommand_1.unshiftIndent(p,m+1,r,l,c):_=ShiftCommand_1.shiftIndent(p,m+1,r,l,c),this._addEditOperation(t,new Range$2(f,1,f,m+1),_),f===s&&!this._selection.isEmpty()&&(this._selectionStartColumnStaysPut=this._selection.startColumn<=m+1)}}else{!this._opts.isUnshift&&this._selection.isEmpty()&&e.getLineLength(s)===0&&(this._useLastEditRangeForCursorEndPosition=!0);const u=c?cachedStringRepeat(" ",l):"	";for(let g=s;g<=o;g++){const f=e.getLineContent(g);let p=firstNonWhitespaceIndex(f);if(!(this._opts.isUnshift&&(f.length===0||p===0))&&!(!d&&!this._opts.isUnshift&&f.length===0)&&(p===-1&&(p=f.length),!(this._opts.isUnshift&&p===0)))if(this._opts.isUnshift){p=Math.min(p,l);for(let m=0;m<p;m++)if(f.charCodeAt(m)===9){p=m+1;break}this._addEditOperation(t,new Range$2(g,1,g,p+1),"")}else this._addEditOperation(t,new Range$2(g,1,g,1),u),g===s&&!this._selection.isEmpty()&&(this._selectionStartColumnStaysPut=this._selection.startColumn===1)}}this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){if(this._useLastEditRangeForCursorEndPosition){const o=t.getInverseEditOperations()[0];return new Selection$1(o.range.endLineNumber,o.range.endColumn,o.range.endLineNumber,o.range.endColumn)}const s=t.getTrackedSelection(this._selectionId);if(this._selectionStartColumnStaysPut){const o=this._selection.startColumn;return s.startColumn<=o?s:s.getDirection()===0?new Selection$1(s.startLineNumber,o,s.endLineNumber,s.endColumn):new Selection$1(s.endLineNumber,s.endColumn,s.startLineNumber,o)}return s}};ShiftCommand=ShiftCommand_1=__decorate$2X([__param$2Q(2,ILanguageConfigurationService)],ShiftCommand);class SurroundSelectionCommand{constructor(e,t,s){this._range=e,this._charBeforeSelection=t,this._charAfterSelection=s}getEditOperations(e,t){t.addTrackedEditOperation(new Range$2(this._range.startLineNumber,this._range.startColumn,this._range.startLineNumber,this._range.startColumn),this._charBeforeSelection),t.addTrackedEditOperation(new Range$2(this._range.endLineNumber,this._range.endColumn,this._range.endLineNumber,this._range.endColumn),this._charAfterSelection||null)}computeCursorState(e,t){const s=t.getInverseEditOperations(),o=s[0].range,r=s[1].range;return new Selection$1(o.endLineNumber,o.endColumn,r.endLineNumber,r.endColumn-this._charAfterSelection.length)}}class CompositionSurroundSelectionCommand{constructor(e,t,s){this._position=e,this._text=t,this._charAfter=s}getEditOperations(e,t){t.addTrackedEditOperation(new Range$2(this._position.lineNumber,this._position.column,this._position.lineNumber,this._position.column),this._text+this._charAfter)}computeCursorState(e,t){const o=t.getInverseEditOperations()[0].range;return new Selection$1(o.endLineNumber,o.startColumn,o.endLineNumber,o.endColumn-this._charAfter.length)}}function getPrecedingValidLine(a,e,t){const s=a.tokenization.getLanguageIdAtPosition(e,0);if(e>1){let o,r=-1;for(o=e-1;o>=1;o--){if(a.tokenization.getLanguageIdAtPosition(o,0)!==s)return r;const l=a.getLineContent(o);if(t.shouldIgnore(o)||/^\s+$/.test(l)||l===""){r=o;continue}return o}}return-1}function getInheritIndentForLine(a,e,t,s=!0,o){if(a<4)return null;const r=o.getLanguageConfiguration(e.tokenization.getLanguageId()).indentRulesSupport;if(!r)return null;const l=new ProcessedIndentRulesSupport(e,r,o);if(t<=1)return{indentation:"",action:null};for(let d=t-1;d>0&&e.getLineContent(d)==="";d--)if(d===1)return{indentation:"",action:null};const c=getPrecedingValidLine(e,t,l);if(c<0)return null;if(c<1)return{indentation:"",action:null};if(l.shouldIncrease(c)||l.shouldIndentNextLine(c)){const d=e.getLineContent(c);return{indentation:getLeadingWhitespace(d),action:IndentAction$1.Indent,line:c}}else if(l.shouldDecrease(c)){const d=e.getLineContent(c);return{indentation:getLeadingWhitespace(d),action:null,line:c}}else{if(c===1)return{indentation:getLeadingWhitespace(e.getLineContent(c)),action:null,line:c};const d=c-1,u=r.getIndentMetadata(e.getLineContent(d));if(!(u&3)&&u&4){let g=0;for(let f=d-1;f>0;f--)if(!l.shouldIndentNextLine(f)){g=f;break}return{indentation:getLeadingWhitespace(e.getLineContent(g+1)),action:null,line:g+1}}if(s)return{indentation:getLeadingWhitespace(e.getLineContent(c)),action:null,line:c};for(let g=c;g>0;g--){if(l.shouldIncrease(g))return{indentation:getLeadingWhitespace(e.getLineContent(g)),action:IndentAction$1.Indent,line:g};if(l.shouldIndentNextLine(g)){let f=0;for(let p=g-1;p>0;p--)if(!l.shouldIndentNextLine(g)){f=p;break}return{indentation:getLeadingWhitespace(e.getLineContent(f+1)),action:null,line:f+1}}else if(l.shouldDecrease(g))return{indentation:getLeadingWhitespace(e.getLineContent(g)),action:null,line:g}}return{indentation:getLeadingWhitespace(e.getLineContent(1)),action:null,line:1}}}function getGoodIndentForLine(a,e,t,s,o,r){if(a<4)return null;const l=r.getLanguageConfiguration(t);if(!l)return null;const c=r.getLanguageConfiguration(t).indentRulesSupport;if(!c)return null;const d=new ProcessedIndentRulesSupport(e,c,r),u=getInheritIndentForLine(a,e,s,void 0,r);if(u){const g=u.line;if(g!==void 0){let f=!0;for(let p=g;p<s-1;p++)if(!/^\s*$/.test(e.getLineContent(p))){f=!1;break}if(f){const p=l.onEnter(a,"",e.getLineContent(g),"");if(p){let m=getLeadingWhitespace(e.getLineContent(g));return p.removeText&&(m=m.substring(0,m.length-p.removeText)),p.indentAction===IndentAction$1.Indent||p.indentAction===IndentAction$1.IndentOutdent?m=o.shiftIndent(m):p.indentAction===IndentAction$1.Outdent&&(m=o.unshiftIndent(m)),d.shouldDecrease(s)&&(m=o.unshiftIndent(m)),p.appendText&&(m+=p.appendText),getLeadingWhitespace(m)}}}return d.shouldDecrease(s)?u.action===IndentAction$1.Indent?u.indentation:o.unshiftIndent(u.indentation):u.action===IndentAction$1.Indent?o.shiftIndent(u.indentation):u.indentation}return null}function getIndentForEnter(a,e,t,s,o){if(a<4)return null;const r=e.getLanguageIdAtPosition(t.startLineNumber,t.startColumn),l=o.getLanguageConfiguration(r).indentRulesSupport;if(!l)return null;e.tokenization.forceTokenization(t.startLineNumber);const d=new IndentationContextProcessor(e,o).getProcessedTokenContextAroundRange(t),u=d.afterRangeProcessedTokens,g=d.beforeRangeProcessedTokens,f=getLeadingWhitespace(g.getLineContent()),p=createVirtualModelWithModifiedTokensAtLine(e,t.startLineNumber,g),m=isLanguageDifferentFromLineStart(e,t.getStartPosition()),_=e.getLineContent(t.startLineNumber),C=getLeadingWhitespace(_),b=getInheritIndentForLine(a,p,t.startLineNumber+1,void 0,o);if(!b){const S=m?C:f;return{beforeEnter:S,afterEnter:S}}let v=m?C:b.indentation;return b.action===IndentAction$1.Indent&&(v=s.shiftIndent(v)),l.shouldDecrease(u.getLineContent())&&(v=s.unshiftIndent(v)),{beforeEnter:m?C:f,afterEnter:v}}function getIndentActionForType(a,e,t,s,o,r){const l=a.autoIndent;if(l<4||isLanguageDifferentFromLineStart(e,t.getStartPosition()))return null;const d=e.getLanguageIdAtPosition(t.startLineNumber,t.startColumn),u=r.getLanguageConfiguration(d).indentRulesSupport;if(!u)return null;const f=new IndentationContextProcessor(e,r).getProcessedTokenContextAroundRange(t),p=f.beforeRangeProcessedTokens.getLineContent(),m=f.afterRangeProcessedTokens.getLineContent(),_=p+m,C=p+s+m;if(!u.shouldDecrease(_)&&u.shouldDecrease(C)){const v=getInheritIndentForLine(l,e,t.startLineNumber,!1,r);if(!v)return null;let S=v.indentation;return v.action!==IndentAction$1.Indent&&(S=o.unshiftIndent(S)),S}const b=t.startLineNumber-1;if(b>0){const v=e.getLineContent(b);if(u.shouldIndentNextLine(v)&&u.shouldIncrease(C)){const S=getInheritIndentForLine(l,e,t.startLineNumber,!1,r),y=S==null?void 0:S.indentation;if(y!==void 0){const w=e.getLineContent(t.startLineNumber),L=getLeadingWhitespace(w),E=o.shiftIndent(y)===L,I=/^\s*$/.test(_),D=a.autoClosingPairs.autoClosingPairsOpenByEnd.get(s),N=D&&D.length>0&&I;if(E&&N)return y}}}return null}function getIndentMetadata(a,e,t){const s=t.getLanguageConfiguration(a.getLanguageId()).indentRulesSupport;return!s||e<1||e>a.getLineCount()?null:s.getIndentMetadata(a.getLineContent(e))}function createVirtualModelWithModifiedTokensAtLine(a,e,t){return{tokenization:{getLineTokens:o=>o===e?t:a.tokenization.getLineTokens(o),getLanguageId:()=>a.getLanguageId(),getLanguageIdAtPosition:(o,r)=>a.getLanguageIdAtPosition(o,r)},getLineContent:o=>o===e?t.getLineContent():a.getLineContent(o)}}class AutoIndentOperation{static getEdits(e,t,s,o,r){if(!r&&this._isAutoIndentType(e,t,s)){const l=[];for(const d of s){const u=this._findActualIndentationForSelection(e,t,d,o);if(u===null)return;l.push({selection:d,indentation:u})}const c=AutoClosingOpenCharTypeOperation.getAutoClosingPairClose(e,t,s,o,!1);return this._getIndentationAndAutoClosingPairEdits(e,t,l,o,c)}}static _isAutoIndentType(e,t,s){if(e.autoIndent<4)return!1;for(let o=0,r=s.length;o<r;o++)if(!t.tokenization.isCheapToTokenize(s[o].getEndPosition().lineNumber))return!1;return!0}static _findActualIndentationForSelection(e,t,s,o){const r=getIndentActionForType(e,t,s,o,{shiftIndent:c=>shiftIndent(e,c),unshiftIndent:c=>unshiftIndent(e,c)},e.languageConfigurationService);if(r===null)return null;const l=getIndentationAtPosition(t,s.startLineNumber,s.startColumn);return r===e.normalizeIndentation(l)?null:r}static _getIndentationAndAutoClosingPairEdits(e,t,s,o,r){const l=s.map(({selection:d,indentation:u})=>{if(r!==null){const g=this._getEditFromIndentationAndSelection(e,t,u,d,o,!1);return new TypeWithIndentationAndAutoClosingCommand(g,d,o,r)}else{const g=this._getEditFromIndentationAndSelection(e,t,u,d,o,!0);return typeCommand(g.range,g.text,!1)}}),c={shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1};return new EditOperationResult(4,l,c)}static _getEditFromIndentationAndSelection(e,t,s,o,r,l=!0){const c=o.startLineNumber,d=t.getLineFirstNonWhitespaceColumn(c);let u=e.normalizeIndentation(s);if(d!==0){const f=t.getLineContent(c);u+=f.substring(d-1,o.startColumn-1)}return u+=l?r:"",{range:new Range$2(c,1,o.endLineNumber,o.endColumn),text:u}}}class AutoClosingOvertypeOperation{static getEdits(e,t,s,o,r,l){if(isAutoClosingOvertype(t,s,o,r,l))return this._runAutoClosingOvertype(e,o,l)}static _runAutoClosingOvertype(e,t,s){const o=[];for(let r=0,l=t.length;r<l;r++){const d=t[r].getPosition(),u=new Range$2(d.lineNumber,d.column,d.lineNumber,d.column+1);o[r]=new ReplaceCommand(u,s)}return new EditOperationResult(4,o,{shouldPushStackElementBefore:shouldPushStackElementBetween(e,4),shouldPushStackElementAfter:!1})}}class AutoClosingOvertypeWithInterceptorsOperation{static getEdits(e,t,s,o,r){if(isAutoClosingOvertype(e,t,s,o,r)){const l=s.map(c=>new ReplaceCommand(new Range$2(c.positionLineNumber,c.positionColumn,c.positionLineNumber,c.positionColumn+1),"",!1));return new EditOperationResult(4,l,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}}}class AutoClosingOpenCharTypeOperation{static getEdits(e,t,s,o,r,l){if(!l){const c=this.getAutoClosingPairClose(e,t,s,o,r);if(c!==null)return this._runAutoClosingOpenCharType(s,o,r,c)}}static _runAutoClosingOpenCharType(e,t,s,o){const r=[];for(let l=0,c=e.length;l<c;l++){const d=e[l];r[l]=new TypeWithAutoClosingCommand(d,t,!s,o)}return new EditOperationResult(4,r,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}static getAutoClosingPairClose(e,t,s,o,r){for(const _ of s)if(!_.isEmpty())return null;const l=s.map(_=>{const C=_.getPosition();return r?{lineNumber:C.lineNumber,beforeColumn:C.column-o.length,afterColumn:C.column}:{lineNumber:C.lineNumber,beforeColumn:C.column,afterColumn:C.column}}),c=this._findAutoClosingPairOpen(e,t,l.map(_=>new Position$1(_.lineNumber,_.beforeColumn)),o);if(!c)return null;let d,u;if(isQuote(o)?(d=e.autoClosingQuotes,u=e.shouldAutoCloseBefore.quote):(e.blockCommentStartToken?c.open.includes(e.blockCommentStartToken):!1)?(d=e.autoClosingComments,u=e.shouldAutoCloseBefore.comment):(d=e.autoClosingBrackets,u=e.shouldAutoCloseBefore.bracket),d==="never")return null;const f=this._findContainedAutoClosingPair(e,c),p=f?f.close:"";let m=!0;for(const _ of l){const{lineNumber:C,beforeColumn:b,afterColumn:v}=_,S=t.getLineContent(C),y=S.substring(0,b-1),w=S.substring(v-1);if(w.startsWith(p)||(m=!1),w.length>0){const I=w.charAt(0);if(!this._isBeforeClosingBrace(e,w)&&!u(I))return null}if(c.open.length===1&&(o==="'"||o==='"')&&d!=="always"){const I=getMapForWordSeparators(e.wordSeparators,[]);if(y.length>0){const D=y.charCodeAt(y.length-1);if(I.get(D)===0)return null}}if(!t.tokenization.isCheapToTokenize(C))return null;t.tokenization.forceTokenization(C);const L=t.tokenization.getLineTokens(C),x=createScopedLineTokens(L,b-1);if(!c.shouldAutoClose(x,b-x.firstCharOffset))return null;const E=c.findNeutralCharacter();if(E){const I=t.tokenization.getTokenTypeIfInsertingCharacter(C,b,E);if(!c.isOK(I))return null}}return m?c.close.substring(0,c.close.length-p.length):c.close}static _findContainedAutoClosingPair(e,t){if(t.open.length<=1)return null;const s=t.close.charAt(t.close.length-1),o=e.autoClosingPairs.autoClosingPairsCloseByEnd.get(s)||[];let r=null;for(const l of o)l.open!==t.open&&t.open.includes(l.open)&&t.close.endsWith(l.close)&&(!r||l.open.length>r.open.length)&&(r=l);return r}static _findAutoClosingPairOpen(e,t,s,o){const r=e.autoClosingPairs.autoClosingPairsOpenByEnd.get(o);if(!r)return null;let l=null;for(const c of r)if(l===null||c.open.length>l.open.length){let d=!0;for(const u of s)if(t.getValueInRange(new Range$2(u.lineNumber,u.column-c.open.length+1,u.lineNumber,u.column))+o!==c.open){d=!1;break}d&&(l=c)}return l}static _isBeforeClosingBrace(e,t){const s=t.charAt(0),o=e.autoClosingPairs.autoClosingPairsOpenByStart.get(s)||[],r=e.autoClosingPairs.autoClosingPairsCloseByStart.get(s)||[],l=o.some(d=>t.startsWith(d.open)),c=r.some(d=>t.startsWith(d.close));return!l&&c}}class CompositionEndOvertypeOperation{static getEdits(e,t){if(!(e.inputMode==="overtype"))return null;const o=t.map(r=>new ReplaceOvertypeCommandOnCompositionEnd(r.insertedTextRange));return new EditOperationResult(4,o,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}}class SurroundSelectionOperation{static getEdits(e,t,s,o,r){if(!r&&this._isSurroundSelectionType(e,t,s,o))return this._runSurroundSelectionType(e,s,o)}static _runSurroundSelectionType(e,t,s){const o=[];for(let r=0,l=t.length;r<l;r++){const c=t[r],d=e.surroundingPairs[s];o[r]=new SurroundSelectionCommand(c,s,d)}return new EditOperationResult(0,o,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}static _isSurroundSelectionType(e,t,s,o){if(!shouldSurroundChar(e,o)||!e.surroundingPairs.hasOwnProperty(o))return!1;const r=isQuote(o);for(const l of s){if(l.isEmpty())return!1;let c=!0;for(let d=l.startLineNumber;d<=l.endLineNumber;d++){const u=t.getLineContent(d),g=d===l.startLineNumber?l.startColumn-1:0,f=d===l.endLineNumber?l.endColumn-1:u.length,p=u.substring(g,f);if(/[^ \t]/.test(p)){c=!1;break}}if(c)return!1;if(r&&l.startLineNumber===l.endLineNumber&&l.startColumn+1===l.endColumn){const d=t.getValueInRange(l);if(isQuote(d))return!1}}return!0}}class InterceptorElectricCharOperation{static getEdits(e,t,s,o,r,l){if(!l&&this._isTypeInterceptorElectricChar(t,s,o)){const c=this._typeInterceptorElectricChar(e,t,s,o[0],r);if(c)return c}}static _isTypeInterceptorElectricChar(e,t,s){return!!(s.length===1&&t.tokenization.isCheapToTokenize(s[0].getEndPosition().lineNumber))}static _typeInterceptorElectricChar(e,t,s,o,r){if(!t.electricChars.hasOwnProperty(r)||!o.isEmpty())return null;const l=o.getPosition();s.tokenization.forceTokenization(l.lineNumber);const c=s.tokenization.getLineTokens(l.lineNumber);let d;try{d=t.onElectricCharacter(r,c,l.column)}catch(u){return onUnexpectedError(u),null}if(!d)return null;if(d.matchOpenBracket){const u=(c.getLineContent()+r).lastIndexOf(d.matchOpenBracket)+1,g=s.bracketPairs.findMatchingBracketUp(d.matchOpenBracket,{lineNumber:l.lineNumber,column:u},500);if(g){if(g.startLineNumber===l.lineNumber)return null;const f=s.getLineContent(g.startLineNumber),p=getLeadingWhitespace(f),m=t.normalizeIndentation(p),_=s.getLineContent(l.lineNumber),C=s.getLineFirstNonWhitespaceColumn(l.lineNumber)||l.column,b=_.substring(C-1,l.column-1),v=m+b+r,S=new Range$2(l.lineNumber,1,l.lineNumber,l.column),y=new ReplaceCommand(S,v);return new EditOperationResult(getTypingOperation(v,e),[y],{shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!0})}}return null}}class SimpleCharacterTypeOperation{static getEdits(e,t,s,o,r){const l=[];for(let d=0,u=s.length;d<u;d++){const g=e.inputMode==="overtype"&&!r?ReplaceOvertypeCommand:ReplaceCommand;l[d]=new g(s[d],o)}const c=getTypingOperation(o,t);return new EditOperationResult(c,l,{shouldPushStackElementBefore:shouldPushStackElementBetween(t,c),shouldPushStackElementAfter:!1})}}class EnterOperation{static getEdits(e,t,s,o,r){if(!r&&o===`
`){const l=[];for(let c=0,d=s.length;c<d;c++)l[c]=this._enter(e,t,!1,s[c]);return new EditOperationResult(4,l,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}}static _enter(e,t,s,o){if(e.autoIndent===0)return typeCommand(o,`
`,s);if(!t.tokenization.isCheapToTokenize(o.getStartPosition().lineNumber)||e.autoIndent===1){const d=t.getLineContent(o.startLineNumber),u=getLeadingWhitespace(d).substring(0,o.startColumn-1);return typeCommand(o,`
`+e.normalizeIndentation(u),s)}const r=getEnterAction(e.autoIndent,t,o,e.languageConfigurationService);if(r){if(r.indentAction===IndentAction$1.None)return typeCommand(o,`
`+e.normalizeIndentation(r.indentation+r.appendText),s);if(r.indentAction===IndentAction$1.Indent)return typeCommand(o,`
`+e.normalizeIndentation(r.indentation+r.appendText),s);if(r.indentAction===IndentAction$1.IndentOutdent){const d=e.normalizeIndentation(r.indentation),u=e.normalizeIndentation(r.indentation+r.appendText),g=`
`+u+`
`+d;return s?new ReplaceCommandWithoutChangingPosition(o,g,!0):new ReplaceCommandWithOffsetCursorState(o,g,-1,u.length-d.length,!0)}else if(r.indentAction===IndentAction$1.Outdent){const d=unshiftIndent(e,r.indentation);return typeCommand(o,`
`+e.normalizeIndentation(d+r.appendText),s)}}const l=t.getLineContent(o.startLineNumber),c=getLeadingWhitespace(l).substring(0,o.startColumn-1);if(e.autoIndent>=4){const d=getIndentForEnter(e.autoIndent,t,o,{unshiftIndent:u=>unshiftIndent(e,u),shiftIndent:u=>shiftIndent(e,u),normalizeIndentation:u=>e.normalizeIndentation(u)},e.languageConfigurationService);if(d){let u=e.visibleColumnFromColumn(t,o.getEndPosition());const g=o.endColumn,f=t.getLineContent(o.endLineNumber),p=firstNonWhitespaceIndex(f);if(p>=0?o=o.setEndPosition(o.endLineNumber,Math.max(o.endColumn,p+1)):o=o.setEndPosition(o.endLineNumber,t.getLineMaxColumn(o.endLineNumber)),s)return new ReplaceCommandWithoutChangingPosition(o,`
`+e.normalizeIndentation(d.afterEnter),!0);{let m=0;return g<=p+1&&(e.insertSpaces||(u=Math.ceil(u/e.indentSize)),m=Math.min(u+1-e.normalizeIndentation(d.afterEnter).length-1,0)),new ReplaceCommandWithOffsetCursorState(o,`
`+e.normalizeIndentation(d.afterEnter),0,m,!0)}}}return typeCommand(o,`
`+e.normalizeIndentation(c),s)}static lineInsertBefore(e,t,s){if(t===null||s===null)return[];const o=[];for(let r=0,l=s.length;r<l;r++){let c=s[r].positionLineNumber;if(c===1)o[r]=new ReplaceCommandWithoutChangingPosition(new Range$2(1,1,1,1),`
`);else{c--;const d=t.getLineMaxColumn(c);o[r]=this._enter(e,t,!1,new Range$2(c,d,c,d))}}return o}static lineInsertAfter(e,t,s){if(t===null||s===null)return[];const o=[];for(let r=0,l=s.length;r<l;r++){const c=s[r].positionLineNumber,d=t.getLineMaxColumn(c);o[r]=this._enter(e,t,!1,new Range$2(c,d,c,d))}return o}static lineBreakInsert(e,t,s){const o=[];for(let r=0,l=s.length;r<l;r++)o[r]=this._enter(e,t,!0,s[r]);return o}}class PasteOperation{static getEdits(e,t,s,o,r,l){const c=this._distributePasteToCursors(e,s,o,r,l);return c?(s=s.sort(Range$2.compareRangesUsingStarts),this._distributedPaste(e,t,s,c)):this._simplePaste(e,t,s,o,r)}static _distributePasteToCursors(e,t,s,o,r){if(o||t.length===1)return null;if(r&&r.length===t.length)return r;if(e.multiCursorPaste==="spread"){s.charCodeAt(s.length-1)===10&&(s=s.substring(0,s.length-1)),s.charCodeAt(s.length-1)===13&&(s=s.substring(0,s.length-1));const l=splitLines(s);if(l.length===t.length)return l}return null}static _distributedPaste(e,t,s,o){const r=[];for(let l=0,c=s.length;l<c;l++){const u=e.overtypeOnPaste&&e.inputMode==="overtype"?ReplaceOvertypeCommand:ReplaceCommand;r[l]=new u(s[l],o[l])}return new EditOperationResult(0,r,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}static _simplePaste(e,t,s,o,r){const l=[];for(let c=0,d=s.length;c<d;c++){const u=s[c],g=u.getPosition();if(r&&!u.isEmpty()&&(r=!1),r&&o.indexOf(`
`)!==o.length-1&&(r=!1),r){const f=new Range$2(g.lineNumber,1,g.lineNumber,1);l[c]=new ReplaceCommandThatPreservesSelection(f,o,u,!0)}else{const p=e.overtypeOnPaste&&e.inputMode==="overtype"?ReplaceOvertypeCommand:ReplaceCommand;l[c]=new p(u,o)}}return new EditOperationResult(0,l,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}}class CompositionOperation{static getEdits(e,t,s,o,r,l,c,d){const u=o.map(g=>this._compositionType(s,g,r,l,c,d));return new EditOperationResult(4,u,{shouldPushStackElementBefore:shouldPushStackElementBetween(e,4),shouldPushStackElementAfter:!1})}static _compositionType(e,t,s,o,r,l){if(!t.isEmpty())return null;const c=t.getPosition(),d=Math.max(1,c.column-o),u=Math.min(e.getLineMaxColumn(c.lineNumber),c.column+r),g=new Range$2(c.lineNumber,d,c.lineNumber,u);return new ReplaceCommandWithOffsetCursorState(g,s,0,l)}}class TypeWithoutInterceptorsOperation{static getEdits(e,t,s){const o=[];for(let l=0,c=t.length;l<c;l++)o[l]=new ReplaceCommand(t[l],s);const r=getTypingOperation(s,e);return new EditOperationResult(r,o,{shouldPushStackElementBefore:shouldPushStackElementBetween(e,r),shouldPushStackElementAfter:!1})}}class TabOperation{static getCommands(e,t,s){const o=[];for(let r=0,l=s.length;r<l;r++){const c=s[r];if(c.isEmpty()){const d=t.getLineContent(c.startLineNumber);if(/^\s*$/.test(d)&&t.tokenization.isCheapToTokenize(c.startLineNumber)){let u=this._goodIndentForLine(e,t,c.startLineNumber);u=u||"	";const g=e.normalizeIndentation(u);if(!d.startsWith(g)){o[r]=new ReplaceCommand(new Range$2(c.startLineNumber,1,c.startLineNumber,d.length+1),g,!0);continue}}o[r]=this._replaceJumpToNextIndent(e,t,c,!0)}else{if(c.startLineNumber===c.endLineNumber){const d=t.getLineMaxColumn(c.startLineNumber);if(c.startColumn!==1||c.endColumn!==d){o[r]=this._replaceJumpToNextIndent(e,t,c,!1);continue}}o[r]=new ShiftCommand(c,{isUnshift:!1,tabSize:e.tabSize,indentSize:e.indentSize,insertSpaces:e.insertSpaces,useTabStops:e.useTabStops,autoIndent:e.autoIndent},e.languageConfigurationService)}}return o}static _goodIndentForLine(e,t,s){let o=null,r="";const l=getInheritIndentForLine(e.autoIndent,t,s,!1,e.languageConfigurationService);if(l)o=l.action,r=l.indentation;else if(s>1){let c;for(c=s-1;c>=1;c--){const g=t.getLineContent(c);if(lastNonWhitespaceIndex(g)>=0)break}if(c<1)return null;const d=t.getLineMaxColumn(c),u=getEnterAction(e.autoIndent,t,new Range$2(c,d,c,d),e.languageConfigurationService);u&&(r=u.indentation+u.appendText)}return o&&(o===IndentAction$1.Indent&&(r=shiftIndent(e,r)),o===IndentAction$1.Outdent&&(r=unshiftIndent(e,r)),r=e.normalizeIndentation(r)),r||null}static _replaceJumpToNextIndent(e,t,s,o){let r="";const l=s.getStartPosition();if(e.insertSpaces){const c=e.visibleColumnFromColumn(t,l),d=e.indentSize,u=d-c%d;for(let g=0;g<u;g++)r+=" "}else r="	";return new ReplaceCommand(s,r,o)}}class BaseTypeWithAutoClosingCommand extends ReplaceCommandWithOffsetCursorState{constructor(e,t,s,o,r,l){super(e,t,s,o),this._openCharacter=r,this._closeCharacter=l,this.closeCharacterRange=null,this.enclosingRange=null}_computeCursorStateWithRange(e,t,s){return this.closeCharacterRange=new Range$2(t.startLineNumber,t.endColumn-this._closeCharacter.length,t.endLineNumber,t.endColumn),this.enclosingRange=new Range$2(t.startLineNumber,t.endColumn-this._openCharacter.length-this._closeCharacter.length,t.endLineNumber,t.endColumn),super.computeCursorState(e,s)}}class TypeWithAutoClosingCommand extends BaseTypeWithAutoClosingCommand{constructor(e,t,s,o){const r=(s?t:"")+o,l=0,c=-o.length;super(e,r,l,c,t,o)}computeCursorState(e,t){const o=t.getInverseEditOperations()[0].range;return this._computeCursorStateWithRange(e,o,t)}}class TypeWithIndentationAndAutoClosingCommand extends BaseTypeWithAutoClosingCommand{constructor(e,t,s,o){const r=s+o,l=0,c=s.length;super(t,r,l,c,s,o),this._autoIndentationEdit=e,this._autoClosingEdit={range:t,text:r}}getEditOperations(e,t){t.addTrackedEditOperation(this._autoIndentationEdit.range,this._autoIndentationEdit.text),t.addTrackedEditOperation(this._autoClosingEdit.range,this._autoClosingEdit.text)}computeCursorState(e,t){const s=t.getInverseEditOperations();if(s.length!==2)throw new Error("There should be two inverse edit operations!");const o=s[0].range,r=s[1].range,l=o.plusRange(r);return this._computeCursorStateWithRange(e,l,t)}}function getTypingOperation(a,e){return a===" "?e===5||e===6?6:5:4}function shouldPushStackElementBetween(a,e){return isTypingOperation(a)&&!isTypingOperation(e)?!0:a===5?!1:normalizeOperationType(a)!==normalizeOperationType(e)}function normalizeOperationType(a){return a===6||a===5?"space":a}function isTypingOperation(a){return a===4||a===5||a===6}function isAutoClosingOvertype(a,e,t,s,o){if(a.autoClosingOvertype==="never"||!a.autoClosingPairs.autoClosingPairsCloseSingleChar.has(o))return!1;for(let r=0,l=t.length;r<l;r++){const c=t[r];if(!c.isEmpty())return!1;const d=c.getPosition(),u=e.getLineContent(d.lineNumber);if(u.charAt(d.column-1)!==o)return!1;const f=isQuote(o);if((d.column>2?u.charCodeAt(d.column-2):0)===92&&f)return!1;if(a.autoClosingOvertype==="auto"){let m=!1;for(let _=0,C=s.length;_<C;_++){const b=s[_];if(d.lineNumber===b.startLineNumber&&d.column===b.startColumn){m=!0;break}}if(!m)return!1}}return!0}function typeCommand(a,e,t){return t?new ReplaceCommandWithoutChangingPosition(a,e,!0):new ReplaceCommand(a,e,!0)}function shiftIndent(a,e,t){return t=t||1,ShiftCommand.shiftIndent(e,e.length+t,a.tabSize,a.indentSize,a.insertSpaces)}function unshiftIndent(a,e,t){return t=t||1,ShiftCommand.unshiftIndent(e,e.length+t,a.tabSize,a.indentSize,a.insertSpaces)}function shouldSurroundChar(a,e){return isQuote(e)?a.autoSurround==="quotes"||a.autoSurround==="languageDefined":a.autoSurround==="brackets"||a.autoSurround==="languageDefined"}class TypeOperations{static indent(e,t,s){if(t===null||s===null)return[];const o=[];for(let r=0,l=s.length;r<l;r++)o[r]=new ShiftCommand(s[r],{isUnshift:!1,tabSize:e.tabSize,indentSize:e.indentSize,insertSpaces:e.insertSpaces,useTabStops:e.useTabStops,autoIndent:e.autoIndent},e.languageConfigurationService);return o}static outdent(e,t,s){const o=[];for(let r=0,l=s.length;r<l;r++)o[r]=new ShiftCommand(s[r],{isUnshift:!0,tabSize:e.tabSize,indentSize:e.indentSize,insertSpaces:e.insertSpaces,useTabStops:e.useTabStops,autoIndent:e.autoIndent},e.languageConfigurationService);return o}static paste(e,t,s,o,r,l){return PasteOperation.getEdits(e,t,s,o,r,l)}static tab(e,t,s){return TabOperation.getCommands(e,t,s)}static compositionType(e,t,s,o,r,l,c,d){return CompositionOperation.getEdits(e,t,s,o,r,l,c,d)}static compositionEndWithInterceptors(e,t,s,o,r,l){if(!o)return null;let c=null;for(const p of o)if(c===null)c=p.insertedText;else if(c!==p.insertedText)return null;if(!c||c.length!==1)return CompositionEndOvertypeOperation.getEdits(t,o);const d=c;let u=!1;for(const p of o)if(p.deletedText.length!==0){u=!0;break}if(u){if(!shouldSurroundChar(t,d)||!t.surroundingPairs.hasOwnProperty(d))return null;const p=isQuote(d);for(const C of o)if(C.deletedSelectionStart!==0||C.deletedSelectionEnd!==C.deletedText.length||/^[ \t]+$/.test(C.deletedText)||p&&isQuote(C.deletedText))return null;const m=[];for(const C of r){if(!C.isEmpty())return null;m.push(C.getPosition())}if(m.length!==o.length)return null;const _=[];for(let C=0,b=m.length;C<b;C++)_.push(new CompositionSurroundSelectionCommand(m[C],o[C].deletedText,t.surroundingPairs[d]));return new EditOperationResult(4,_,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}const g=AutoClosingOvertypeWithInterceptorsOperation.getEdits(t,s,r,l,d);if(g!==void 0)return g;const f=AutoClosingOpenCharTypeOperation.getEdits(t,s,r,d,!0,!1);return f!==void 0?f:CompositionEndOvertypeOperation.getEdits(t,o)}static typeWithInterceptors(e,t,s,o,r,l,c){const d=EnterOperation.getEdits(s,o,r,c,e);if(d!==void 0)return d;const u=AutoIndentOperation.getEdits(s,o,r,c,e);if(u!==void 0)return u;const g=AutoClosingOvertypeOperation.getEdits(t,s,o,r,l,c);if(g!==void 0)return g;const f=AutoClosingOpenCharTypeOperation.getEdits(s,o,r,c,!1,e);if(f!==void 0)return f;const p=SurroundSelectionOperation.getEdits(s,o,r,c,e);if(p!==void 0)return p;const m=InterceptorElectricCharOperation.getEdits(t,s,o,r,c,e);return m!==void 0?m:SimpleCharacterTypeOperation.getEdits(s,t,r,c,e)}static typeWithoutInterceptors(e,t,s,o,r){return TypeWithoutInterceptorsOperation.getEdits(e,o,r)}}class CompositionOutcome{constructor(e,t,s,o,r,l,c){this.deletedText=e,this.deletedSelectionStart=t,this.deletedSelectionEnd=s,this.insertedText=o,this.insertedSelectionStart=r,this.insertedSelectionEnd=l,this.insertedTextRange=c}}var EditorContextKeys;(function(a){a.editorSimpleInput=new RawContextKey("editorSimpleInput",!1,!0),a.editorTextFocus=new RawContextKey("editorTextFocus",!1,localize(678,"Whether the editor text has focus (cursor is blinking)")),a.focus=new RawContextKey("editorFocus",!1,localize(679,"Whether the editor or an editor widget has focus (e.g. focus is in the find widget)")),a.textInputFocus=new RawContextKey("textInputFocus",!1,localize(680,"Whether an editor or a rich text input has focus (cursor is blinking)")),a.readOnly=new RawContextKey("editorReadonly",!1,localize(681,"Whether the editor is read-only")),a.inDiffEditor=new RawContextKey("inDiffEditor",!1,localize(682,"Whether the context is a diff editor")),a.isEmbeddedDiffEditor=new RawContextKey("isEmbeddedDiffEditor",!1,localize(683,"Whether the context is an embedded diff editor")),a.multiDiffEditorAllCollapsed=new RawContextKey("multiDiffEditorAllCollapsed",void 0,localize(684,"Whether all files in multi diff editor are collapsed")),a.hasChanges=new RawContextKey("diffEditorHasChanges",!1,localize(685,"Whether the diff editor has changes")),a.comparingMovedCode=new RawContextKey("comparingMovedCode",!1,localize(686,"Whether a moved code block is selected for comparison")),a.accessibleDiffViewerVisible=new RawContextKey("accessibleDiffViewerVisible",!1,localize(687,"Whether the accessible diff viewer is visible")),a.diffEditorRenderSideBySideInlineBreakpointReached=new RawContextKey("diffEditorRenderSideBySideInlineBreakpointReached",!1,localize(688,"Whether the diff editor render side by side inline breakpoint is reached")),a.diffEditorInlineMode=new RawContextKey("diffEditorInlineMode",!1,localize(689,"Whether inline mode is active")),a.diffEditorOriginalWritable=new RawContextKey("diffEditorOriginalWritable",!1,localize(690,"Whether modified is writable in the diff editor")),a.diffEditorModifiedWritable=new RawContextKey("diffEditorModifiedWritable",!1,localize(691,"Whether modified is writable in the diff editor")),a.diffEditorOriginalUri=new RawContextKey("diffEditorOriginalUri","",localize(692,"The uri of the original document")),a.diffEditorModifiedUri=new RawContextKey("diffEditorModifiedUri","",localize(693,"The uri of the modified document")),a.columnSelection=new RawContextKey("editorColumnSelection",!1,localize(694,"Whether `editor.columnSelection` is enabled")),a.writable=a.readOnly.toNegated(),a.hasNonEmptySelection=new RawContextKey("editorHasSelection",!1,localize(695,"Whether the editor has text selected")),a.hasOnlyEmptySelection=a.hasNonEmptySelection.toNegated(),a.hasMultipleSelections=new RawContextKey("editorHasMultipleSelections",!1,localize(696,"Whether the editor has multiple selections")),a.hasSingleSelection=a.hasMultipleSelections.toNegated(),a.tabMovesFocus=new RawContextKey("editorTabMovesFocus",!1,localize(697,"Whether `Tab` will move focus out of the editor")),a.tabDoesNotMoveFocus=a.tabMovesFocus.toNegated(),a.isInEmbeddedEditor=new RawContextKey("isInEmbeddedEditor",!1,!0),a.canUndo=new RawContextKey("canUndo",!1,!0),a.canRedo=new RawContextKey("canRedo",!1,!0),a.hoverVisible=new RawContextKey("editorHoverVisible",!1,localize(698,"Whether the editor hover is visible")),a.hoverFocused=new RawContextKey("editorHoverFocused",!1,localize(699,"Whether the editor hover is focused")),a.stickyScrollFocused=new RawContextKey("stickyScrollFocused",!1,localize(700,"Whether the sticky scroll is focused")),a.stickyScrollVisible=new RawContextKey("stickyScrollVisible",!1,localize(701,"Whether the sticky scroll is visible")),a.standaloneColorPickerVisible=new RawContextKey("standaloneColorPickerVisible",!1,localize(702,"Whether the standalone color picker is visible")),a.standaloneColorPickerFocused=new RawContextKey("standaloneColorPickerFocused",!1,localize(703,"Whether the standalone color picker is focused")),a.inCompositeEditor=new RawContextKey("inCompositeEditor",void 0,localize(704,"Whether the editor is part of a larger editor (e.g. notebooks)")),a.notInCompositeEditor=a.inCompositeEditor.toNegated(),a.languageId=new RawContextKey("editorLangId","",localize(705,"The language identifier of the editor")),a.hasCompletionItemProvider=new RawContextKey("editorHasCompletionItemProvider",!1,localize(706,"Whether the editor has a completion item provider")),a.hasCodeActionsProvider=new RawContextKey("editorHasCodeActionsProvider",!1,localize(707,"Whether the editor has a code actions provider")),a.hasCodeLensProvider=new RawContextKey("editorHasCodeLensProvider",!1,localize(708,"Whether the editor has a code lens provider")),a.hasDefinitionProvider=new RawContextKey("editorHasDefinitionProvider",!1,localize(709,"Whether the editor has a definition provider")),a.hasDeclarationProvider=new RawContextKey("editorHasDeclarationProvider",!1,localize(710,"Whether the editor has a declaration provider")),a.hasImplementationProvider=new RawContextKey("editorHasImplementationProvider",!1,localize(711,"Whether the editor has an implementation provider")),a.hasTypeDefinitionProvider=new RawContextKey("editorHasTypeDefinitionProvider",!1,localize(712,"Whether the editor has a type definition provider")),a.hasHoverProvider=new RawContextKey("editorHasHoverProvider",!1,localize(713,"Whether the editor has a hover provider")),a.hasDocumentHighlightProvider=new RawContextKey("editorHasDocumentHighlightProvider",!1,localize(714,"Whether the editor has a document highlight provider")),a.hasDocumentSymbolProvider=new RawContextKey("editorHasDocumentSymbolProvider",!1,localize(715,"Whether the editor has a document symbol provider")),a.hasReferenceProvider=new RawContextKey("editorHasReferenceProvider",!1,localize(716,"Whether the editor has a reference provider")),a.hasRenameProvider=new RawContextKey("editorHasRenameProvider",!1,localize(717,"Whether the editor has a rename provider")),a.hasSignatureHelpProvider=new RawContextKey("editorHasSignatureHelpProvider",!1,localize(718,"Whether the editor has a signature help provider")),a.hasInlayHintsProvider=new RawContextKey("editorHasInlayHintsProvider",!1,localize(719,"Whether the editor has an inline hints provider")),a.hasDocumentFormattingProvider=new RawContextKey("editorHasDocumentFormattingProvider",!1,localize(720,"Whether the editor has a document formatting provider")),a.hasDocumentSelectionFormattingProvider=new RawContextKey("editorHasDocumentSelectionFormattingProvider",!1,localize(721,"Whether the editor has a document selection formatting provider")),a.hasMultipleDocumentFormattingProvider=new RawContextKey("editorHasMultipleDocumentFormattingProvider",!1,localize(722,"Whether the editor has multiple document formatting providers")),a.hasMultipleDocumentSelectionFormattingProvider=new RawContextKey("editorHasMultipleDocumentSelectionFormattingProvider",!1,localize(723,"Whether the editor has multiple document selection formatting providers"))})(EditorContextKeys||(EditorContextKeys={}));const CORE_WEIGHT=0;class CoreEditorCommand extends EditorCommand{runEditorCommand(e,t,s){const o=t._getViewModel();o&&this.runCoreEditorCommand(o,s||{})}}var EditorScroll_;(function(a){const e=function(s){if(!isObject(s))return!1;const o=s;return!(!isString$1(o.to)||!isUndefined(o.by)&&!isString$1(o.by)||!isUndefined(o.value)&&!isNumber$1(o.value)||!isUndefined(o.revealCursor)&&!isBoolean(o.revealCursor))};a.metadata={description:"Scroll editor in the given direction",args:[{name:"Editor scroll argument object",description:"Property-value pairs that can be passed through this argument:\n					* 'to': A mandatory direction value.\n						```\n						'up', 'down'\n						```\n					* 'by': Unit to move. Default is computed based on 'to' value.\n						```\n						'line', 'wrappedLine', 'page', 'halfPage', 'editor'\n						```\n					* 'value': Number of units to move. Default is '1'.\n					* 'revealCursor': If 'true' reveals the cursor if it is outside view port.\n				",constraint:e,schema:{type:"object",required:["to"],properties:{to:{type:"string",enum:["up","down"]},by:{type:"string",enum:["line","wrappedLine","page","halfPage","editor"]},value:{type:"number",default:1},revealCursor:{type:"boolean"}}}}]},a.RawDirection={Up:"up",Right:"right",Down:"down",Left:"left"},a.RawUnit={Line:"line",WrappedLine:"wrappedLine",Page:"page",HalfPage:"halfPage",Editor:"editor",Column:"column"};function t(s){let o;switch(s.to){case a.RawDirection.Up:o=1;break;case a.RawDirection.Right:o=2;break;case a.RawDirection.Down:o=3;break;case a.RawDirection.Left:o=4;break;default:return null}let r;switch(s.by){case a.RawUnit.Line:r=1;break;case a.RawUnit.WrappedLine:r=2;break;case a.RawUnit.Page:r=3;break;case a.RawUnit.HalfPage:r=4;break;case a.RawUnit.Editor:r=5;break;case a.RawUnit.Column:r=6;break;default:r=2}const l=Math.floor(s.value||1),c=!!s.revealCursor;return{direction:o,unit:r,value:l,revealCursor:c,select:!!s.select}}a.parse=t})(EditorScroll_||(EditorScroll_={}));var RevealLine_;(function(a){const e=function(t){if(!isObject(t))return!1;const s=t;return!(!isNumber$1(s.lineNumber)&&!isString$1(s.lineNumber)||!isUndefined(s.at)&&!isString$1(s.at))};a.metadata={description:"Reveal the given line at the given logical position",args:[{name:"Reveal line argument object",description:"Property-value pairs that can be passed through this argument:\n					* 'lineNumber': A mandatory line number value.\n					* 'at': Logical position at which line has to be revealed.\n						```\n						'top', 'center', 'bottom'\n						```\n				",constraint:e,schema:{type:"object",required:["lineNumber"],properties:{lineNumber:{type:["number","string"]},at:{type:"string",enum:["top","center","bottom"]}}}}]},a.RawAtArgument={Top:"top",Center:"center",Bottom:"bottom"}})(RevealLine_||(RevealLine_={}));class EditorOrNativeTextInputCommand{constructor(e){e.addImplementation(1e4,"code-editor",(t,s)=>{const o=t.get(ICodeEditorService).getFocusedCodeEditor();return o&&o.hasTextFocus()?this._runEditorCommand(t,o,s):!1}),e.addImplementation(1e3,"generic-dom-input-textarea",(t,s)=>{const o=getActiveElement();return o&&isEditableElement(o)?(this.runDOMCommand(o),!0):!1}),e.addImplementation(0,"generic-dom",(t,s)=>{const o=t.get(ICodeEditorService).getActiveCodeEditor();return o?(o.focus(),this._runEditorCommand(t,o,s)):!1})}_runEditorCommand(e,t,s){const o=this.runEditorCommand(e,t,s);return o||!0}}var CoreNavigationCommands;(function(a){class e extends CoreEditorCommand{constructor(S){super(S),this._inSelectionMode=S.inSelectionMode}runCoreEditorCommand(S,y){if(!y.position)return;S.model.pushStackElement(),S.setCursorStates(y.source,3,[CursorMoveCommands.moveTo(S,S.getPrimaryCursorState(),this._inSelectionMode,y.position,y.viewPosition)])&&y.revealType!==2&&S.revealAllCursors(y.source,!0,!0)}}a.MoveTo=registerEditorCommand(new e({id:"_moveTo",inSelectionMode:!1,precondition:void 0})),a.MoveToSelect=registerEditorCommand(new e({id:"_moveToSelect",inSelectionMode:!0,precondition:void 0}));class t extends CoreEditorCommand{runCoreEditorCommand(S,y){S.model.pushStackElement();const w=this._getColumnSelectResult(S,S.getPrimaryCursorState(),S.getCursorColumnSelectData(),y);w!==null&&(S.setCursorStates(y.source,3,w.viewStates.map(L=>CursorState$1.fromViewState(L))),S.setCursorColumnSelectData({isReal:!0,fromViewLineNumber:w.fromLineNumber,fromViewVisualColumn:w.fromVisualColumn,toViewLineNumber:w.toLineNumber,toViewVisualColumn:w.toVisualColumn}),w.reversed?S.revealTopMostCursor(y.source):S.revealBottomMostCursor(y.source))}}a.ColumnSelect=registerEditorCommand(new class extends t{constructor(){super({id:"columnSelect",precondition:void 0})}_getColumnSelectResult(v,S,y,w){if(typeof w.position>"u"||typeof w.viewPosition>"u"||typeof w.mouseColumn>"u")return null;const L=v.model.validatePosition(w.position),x=v.coordinatesConverter.validateViewPosition(new Position$1(w.viewPosition.lineNumber,w.viewPosition.column),L),E=w.doColumnSelect?y.fromViewLineNumber:x.lineNumber,I=w.doColumnSelect?y.fromViewVisualColumn:w.mouseColumn-1;return ColumnSelection.columnSelect(v.cursorConfig,v,E,I,x.lineNumber,w.mouseColumn-1)}}),a.CursorColumnSelectLeft=registerEditorCommand(new class extends t{constructor(){super({id:"cursorColumnSelectLeft",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3599,linux:{primary:0}}})}_getColumnSelectResult(v,S,y,w){return ColumnSelection.columnSelectLeft(v.cursorConfig,v,y)}}),a.CursorColumnSelectRight=registerEditorCommand(new class extends t{constructor(){super({id:"cursorColumnSelectRight",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3601,linux:{primary:0}}})}_getColumnSelectResult(v,S,y,w){return ColumnSelection.columnSelectRight(v.cursorConfig,v,y)}});class s extends t{constructor(S){super(S),this._isPaged=S.isPaged}_getColumnSelectResult(S,y,w,L){return ColumnSelection.columnSelectUp(S.cursorConfig,S,w,this._isPaged)}}a.CursorColumnSelectUp=registerEditorCommand(new s({isPaged:!1,id:"cursorColumnSelectUp",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3600,linux:{primary:0}}})),a.CursorColumnSelectPageUp=registerEditorCommand(new s({isPaged:!0,id:"cursorColumnSelectPageUp",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3595,linux:{primary:0}}}));class o extends t{constructor(S){super(S),this._isPaged=S.isPaged}_getColumnSelectResult(S,y,w,L){return ColumnSelection.columnSelectDown(S.cursorConfig,S,w,this._isPaged)}}a.CursorColumnSelectDown=registerEditorCommand(new o({isPaged:!1,id:"cursorColumnSelectDown",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3602,linux:{primary:0}}})),a.CursorColumnSelectPageDown=registerEditorCommand(new o({isPaged:!0,id:"cursorColumnSelectPageDown",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3596,linux:{primary:0}}}));class r extends CoreEditorCommand{constructor(){super({id:"cursorMove",precondition:void 0,metadata:CursorMove.metadata})}runCoreEditorCommand(S,y){const w=CursorMove.parse(y);w&&this._runCursorMove(S,y.source,w)}_runCursorMove(S,y,w){S.model.pushStackElement(),S.setCursorStates(y,3,r._move(S,S.getCursorStates(),w)),S.revealAllCursors(y,!0)}static _move(S,y,w){const L=w.select,x=w.value;switch(w.direction){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:return CursorMoveCommands.simpleMove(S,y,w.direction,L,x,w.unit);case 11:case 13:case 12:case 14:return CursorMoveCommands.viewportMove(S,y,w.direction,L,x);default:return null}}}a.CursorMoveImpl=r,a.CursorMove=registerEditorCommand(new r);class l extends CoreEditorCommand{constructor(S){super(S),this._staticArgs=S.args}runCoreEditorCommand(S,y){let w=this._staticArgs;this._staticArgs.value===-1&&(w={direction:this._staticArgs.direction,unit:this._staticArgs.unit,select:this._staticArgs.select,value:y.pageSize||S.cursorConfig.pageSize}),S.model.pushStackElement(),S.setCursorStates(y.source,3,CursorMoveCommands.simpleMove(S,S.getCursorStates(),w.direction,w.select,w.value,w.unit)),S.revealAllCursors(y.source,!0)}}a.CursorLeft=registerEditorCommand(new l({args:{direction:0,unit:0,select:!1,value:1},id:"cursorLeft",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:15,mac:{primary:15,secondary:[288]}}})),a.CursorLeftSelect=registerEditorCommand(new l({args:{direction:0,unit:0,select:!0,value:1},id:"cursorLeftSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1039}})),a.CursorRight=registerEditorCommand(new l({args:{direction:1,unit:0,select:!1,value:1},id:"cursorRight",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:17,mac:{primary:17,secondary:[292]}}})),a.CursorRightSelect=registerEditorCommand(new l({args:{direction:1,unit:0,select:!0,value:1},id:"cursorRightSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1041}})),a.CursorUp=registerEditorCommand(new l({args:{direction:2,unit:2,select:!1,value:1},id:"cursorUp",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:16,mac:{primary:16,secondary:[302]}}})),a.CursorUpSelect=registerEditorCommand(new l({args:{direction:2,unit:2,select:!0,value:1},id:"cursorUpSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1040,secondary:[3088],mac:{primary:1040},linux:{primary:1040}}})),a.CursorPageUp=registerEditorCommand(new l({args:{direction:2,unit:2,select:!1,value:-1},id:"cursorPageUp",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:11}})),a.CursorPageUpSelect=registerEditorCommand(new l({args:{direction:2,unit:2,select:!0,value:-1},id:"cursorPageUpSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1035}})),a.CursorDown=registerEditorCommand(new l({args:{direction:3,unit:2,select:!1,value:1},id:"cursorDown",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:18,mac:{primary:18,secondary:[300]}}})),a.CursorDownSelect=registerEditorCommand(new l({args:{direction:3,unit:2,select:!0,value:1},id:"cursorDownSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1042,secondary:[3090],mac:{primary:1042},linux:{primary:1042}}})),a.CursorPageDown=registerEditorCommand(new l({args:{direction:3,unit:2,select:!1,value:-1},id:"cursorPageDown",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:12}})),a.CursorPageDownSelect=registerEditorCommand(new l({args:{direction:3,unit:2,select:!0,value:-1},id:"cursorPageDownSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1036}})),a.CreateCursor=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"createCursor",precondition:void 0})}runCoreEditorCommand(v,S){if(!S.position)return;let y;S.wholeLine?y=CursorMoveCommands.line(v,v.getPrimaryCursorState(),!1,S.position,S.viewPosition):y=CursorMoveCommands.moveTo(v,v.getPrimaryCursorState(),!1,S.position,S.viewPosition);const w=v.getCursorStates();if(w.length>1){const L=y.modelState?y.modelState.position:null,x=y.viewState?y.viewState.position:null;for(let E=0,I=w.length;E<I;E++){const D=w[E];if(!(L&&!D.modelState.selection.containsPosition(L))&&!(x&&!D.viewState.selection.containsPosition(x))){w.splice(E,1),v.model.pushStackElement(),v.setCursorStates(S.source,3,w);return}}}w.push(y),v.model.pushStackElement(),v.setCursorStates(S.source,3,w)}}),a.LastCursorMoveToSelect=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"_lastCursorMoveToSelect",precondition:void 0})}runCoreEditorCommand(v,S){if(!S.position)return;const y=v.getLastAddedCursorIndex(),w=v.getCursorStates(),L=w.slice(0);L[y]=CursorMoveCommands.moveTo(v,w[y],!0,S.position,S.viewPosition),v.model.pushStackElement(),v.setCursorStates(S.source,3,L)}});class c extends CoreEditorCommand{constructor(S){super(S),this._inSelectionMode=S.inSelectionMode}runCoreEditorCommand(S,y){S.model.pushStackElement(),S.setCursorStates(y.source,3,CursorMoveCommands.moveToBeginningOfLine(S,S.getCursorStates(),this._inSelectionMode)),S.revealAllCursors(y.source,!0)}}a.CursorHome=registerEditorCommand(new c({inSelectionMode:!1,id:"cursorHome",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:14,mac:{primary:14,secondary:[2063]}}})),a.CursorHomeSelect=registerEditorCommand(new c({inSelectionMode:!0,id:"cursorHomeSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1038,mac:{primary:1038,secondary:[3087]}}}));class d extends CoreEditorCommand{constructor(S){super(S),this._inSelectionMode=S.inSelectionMode}runCoreEditorCommand(S,y){S.model.pushStackElement(),S.setCursorStates(y.source,3,this._exec(S.getCursorStates())),S.revealAllCursors(y.source,!0)}_exec(S){const y=[];for(let w=0,L=S.length;w<L;w++){const x=S[w],E=x.modelState.position.lineNumber;y[w]=CursorState$1.fromModelState(x.modelState.move(this._inSelectionMode,E,1,0))}return y}}a.CursorLineStart=registerEditorCommand(new d({inSelectionMode:!1,id:"cursorLineStart",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:287}}})),a.CursorLineStartSelect=registerEditorCommand(new d({inSelectionMode:!0,id:"cursorLineStartSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:1311}}}));class u extends CoreEditorCommand{constructor(S){super(S),this._inSelectionMode=S.inSelectionMode}runCoreEditorCommand(S,y){S.model.pushStackElement(),S.setCursorStates(y.source,3,CursorMoveCommands.moveToEndOfLine(S,S.getCursorStates(),this._inSelectionMode,y.sticky||!1)),S.revealAllCursors(y.source,!0)}}a.CursorEnd=registerEditorCommand(new u({inSelectionMode:!1,id:"cursorEnd",precondition:void 0,kbOpts:{args:{sticky:!1},weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:13,mac:{primary:13,secondary:[2065]}},metadata:{description:"Go to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:localize(61,"Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}})),a.CursorEndSelect=registerEditorCommand(new u({inSelectionMode:!0,id:"cursorEndSelect",precondition:void 0,kbOpts:{args:{sticky:!1},weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1037,mac:{primary:1037,secondary:[3089]}},metadata:{description:"Select to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:localize(62,"Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}}));class g extends CoreEditorCommand{constructor(S){super(S),this._inSelectionMode=S.inSelectionMode}runCoreEditorCommand(S,y){S.model.pushStackElement(),S.setCursorStates(y.source,3,this._exec(S,S.getCursorStates())),S.revealAllCursors(y.source,!0)}_exec(S,y){const w=[];for(let L=0,x=y.length;L<x;L++){const E=y[L],I=E.modelState.position.lineNumber,D=S.model.getLineMaxColumn(I);w[L]=CursorState$1.fromModelState(E.modelState.move(this._inSelectionMode,I,D,0))}return w}}a.CursorLineEnd=registerEditorCommand(new g({inSelectionMode:!1,id:"cursorLineEnd",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:291}}})),a.CursorLineEndSelect=registerEditorCommand(new g({inSelectionMode:!0,id:"cursorLineEndSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:1315}}}));class f extends CoreEditorCommand{constructor(S){super(S),this._inSelectionMode=S.inSelectionMode}runCoreEditorCommand(S,y){S.model.pushStackElement(),S.setCursorStates(y.source,3,CursorMoveCommands.moveToBeginningOfBuffer(S,S.getCursorStates(),this._inSelectionMode)),S.revealAllCursors(y.source,!0)}}a.CursorTop=registerEditorCommand(new f({inSelectionMode:!1,id:"cursorTop",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:2062,mac:{primary:2064}}})),a.CursorTopSelect=registerEditorCommand(new f({inSelectionMode:!0,id:"cursorTopSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3086,mac:{primary:3088}}}));class p extends CoreEditorCommand{constructor(S){super(S),this._inSelectionMode=S.inSelectionMode}runCoreEditorCommand(S,y){S.model.pushStackElement(),S.setCursorStates(y.source,3,CursorMoveCommands.moveToEndOfBuffer(S,S.getCursorStates(),this._inSelectionMode)),S.revealAllCursors(y.source,!0)}}a.CursorBottom=registerEditorCommand(new p({inSelectionMode:!1,id:"cursorBottom",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:2061,mac:{primary:2066}}})),a.CursorBottomSelect=registerEditorCommand(new p({inSelectionMode:!0,id:"cursorBottomSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3085,mac:{primary:3090}}}));class m extends CoreEditorCommand{constructor(){super({id:"editorScroll",precondition:void 0,metadata:EditorScroll_.metadata})}determineScrollMethod(S){const y=[6],w=[1,2,3,4,5,6],L=[4,2],x=[1,3];return y.includes(S.unit)&&L.includes(S.direction)?this._runHorizontalEditorScroll.bind(this):w.includes(S.unit)&&x.includes(S.direction)?this._runVerticalEditorScroll.bind(this):null}runCoreEditorCommand(S,y){const w=EditorScroll_.parse(y);if(!w)return;const L=this.determineScrollMethod(w);L&&L(S,y.source,w)}_runVerticalEditorScroll(S,y,w){const L=this._computeDesiredScrollTop(S,w);if(w.revealCursor){const x=S.getCompletelyVisibleViewRangeAtScrollTop(L);S.setCursorStates(y,3,[CursorMoveCommands.findPositionInViewportIfOutside(S,S.getPrimaryCursorState(),x,w.select)])}S.viewLayout.setScrollPosition({scrollTop:L},0)}_computeDesiredScrollTop(S,y){if(y.unit===1){const x=S.viewLayout.getFutureViewport(),E=S.getCompletelyVisibleViewRangeAtScrollTop(x.top),I=S.coordinatesConverter.convertViewRangeToModelRange(E);let D;y.direction===1?D=Math.max(1,I.startLineNumber-y.value):D=Math.min(S.model.getLineCount(),I.startLineNumber+y.value);const k=S.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(D,1));return S.viewLayout.getVerticalOffsetForLineNumber(k.lineNumber)}if(y.unit===5){let x=0;return y.direction===3&&(x=S.model.getLineCount()-S.cursorConfig.pageSize),S.viewLayout.getVerticalOffsetForLineNumber(x)}let w;y.unit===3?w=S.cursorConfig.pageSize*y.value:y.unit===4?w=Math.round(S.cursorConfig.pageSize/2)*y.value:w=y.value;const L=(y.direction===1?-1:1)*w;return S.viewLayout.getCurrentScrollTop()+L*S.cursorConfig.lineHeight}_runHorizontalEditorScroll(S,y,w){const L=this._computeDesiredScrollLeft(S,w);S.viewLayout.setScrollPosition({scrollLeft:L},0)}_computeDesiredScrollLeft(S,y){const w=(y.direction===4?-1:1)*y.value;return S.viewLayout.getCurrentScrollLeft()+w*S.cursorConfig.typicalHalfwidthCharacterWidth}}a.EditorScrollImpl=m,a.EditorScroll=registerEditorCommand(new m),a.ScrollLineUp=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollLineUp",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:2064,mac:{primary:267}}})}runCoreEditorCommand(v,S){a.EditorScroll.runCoreEditorCommand(v,{to:EditorScroll_.RawDirection.Up,by:EditorScroll_.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:S.source})}}),a.ScrollPageUp=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollPageUp",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:2059,win:{primary:523},linux:{primary:523}}})}runCoreEditorCommand(v,S){a.EditorScroll.runCoreEditorCommand(v,{to:EditorScroll_.RawDirection.Up,by:EditorScroll_.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:S.source})}}),a.ScrollEditorTop=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollEditorTop",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus}})}runCoreEditorCommand(v,S){a.EditorScroll.runCoreEditorCommand(v,{to:EditorScroll_.RawDirection.Up,by:EditorScroll_.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:S.source})}}),a.ScrollLineDown=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollLineDown",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:2066,mac:{primary:268}}})}runCoreEditorCommand(v,S){a.EditorScroll.runCoreEditorCommand(v,{to:EditorScroll_.RawDirection.Down,by:EditorScroll_.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:S.source})}}),a.ScrollPageDown=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollPageDown",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:2060,win:{primary:524},linux:{primary:524}}})}runCoreEditorCommand(v,S){a.EditorScroll.runCoreEditorCommand(v,{to:EditorScroll_.RawDirection.Down,by:EditorScroll_.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:S.source})}}),a.ScrollEditorBottom=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollEditorBottom",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus}})}runCoreEditorCommand(v,S){a.EditorScroll.runCoreEditorCommand(v,{to:EditorScroll_.RawDirection.Down,by:EditorScroll_.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:S.source})}}),a.ScrollLeft=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollLeft",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus}})}runCoreEditorCommand(v,S){a.EditorScroll.runCoreEditorCommand(v,{to:EditorScroll_.RawDirection.Left,by:EditorScroll_.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:S.source})}}),a.ScrollRight=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollRight",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus}})}runCoreEditorCommand(v,S){a.EditorScroll.runCoreEditorCommand(v,{to:EditorScroll_.RawDirection.Right,by:EditorScroll_.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:S.source})}});class _ extends CoreEditorCommand{constructor(S){super(S),this._inSelectionMode=S.inSelectionMode}runCoreEditorCommand(S,y){y.position&&(S.model.pushStackElement(),S.setCursorStates(y.source,3,[CursorMoveCommands.word(S,S.getPrimaryCursorState(),this._inSelectionMode,y.position)]),y.revealType!==2&&S.revealAllCursors(y.source,!0,!0))}}a.WordSelect=registerEditorCommand(new _({inSelectionMode:!1,id:"_wordSelect",precondition:void 0})),a.WordSelectDrag=registerEditorCommand(new _({inSelectionMode:!0,id:"_wordSelectDrag",precondition:void 0})),a.LastCursorWordSelect=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"lastCursorWordSelect",precondition:void 0})}runCoreEditorCommand(v,S){if(!S.position)return;const y=v.getLastAddedCursorIndex(),w=v.getCursorStates(),L=w.slice(0),x=w[y];L[y]=CursorMoveCommands.word(v,x,x.modelState.hasSelection(),S.position),v.model.pushStackElement(),v.setCursorStates(S.source,3,L)}});class C extends CoreEditorCommand{constructor(S){super(S),this._inSelectionMode=S.inSelectionMode}runCoreEditorCommand(S,y){y.position&&(S.model.pushStackElement(),S.setCursorStates(y.source,3,[CursorMoveCommands.line(S,S.getPrimaryCursorState(),this._inSelectionMode,y.position,y.viewPosition)]),y.revealType!==2&&S.revealAllCursors(y.source,!1,!0))}}a.LineSelect=registerEditorCommand(new C({inSelectionMode:!1,id:"_lineSelect",precondition:void 0})),a.LineSelectDrag=registerEditorCommand(new C({inSelectionMode:!0,id:"_lineSelectDrag",precondition:void 0}));class b extends CoreEditorCommand{constructor(S){super(S),this._inSelectionMode=S.inSelectionMode}runCoreEditorCommand(S,y){if(!y.position)return;const w=S.getLastAddedCursorIndex(),L=S.getCursorStates(),x=L.slice(0);x[w]=CursorMoveCommands.line(S,L[w],this._inSelectionMode,y.position,y.viewPosition),S.model.pushStackElement(),S.setCursorStates(y.source,3,x)}}a.LastCursorLineSelect=registerEditorCommand(new b({inSelectionMode:!1,id:"lastCursorLineSelect",precondition:void 0})),a.LastCursorLineSelectDrag=registerEditorCommand(new b({inSelectionMode:!0,id:"lastCursorLineSelectDrag",precondition:void 0})),a.CancelSelection=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"cancelSelection",precondition:EditorContextKeys.hasNonEmptySelection,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:9,secondary:[1033]}})}runCoreEditorCommand(v,S){v.model.pushStackElement(),v.setCursorStates(S.source,3,[CursorMoveCommands.cancelSelection(v,v.getPrimaryCursorState())]),v.revealAllCursors(S.source,!0)}}),a.RemoveSecondaryCursors=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"removeSecondaryCursors",precondition:EditorContextKeys.hasMultipleSelections,kbOpts:{weight:CORE_WEIGHT+1,kbExpr:EditorContextKeys.textInputFocus,primary:9,secondary:[1033]}})}runCoreEditorCommand(v,S){v.model.pushStackElement(),v.setCursorStates(S.source,3,[v.getPrimaryCursorState()]),v.revealAllCursors(S.source,!0),status(localize(63,"Removed secondary cursors"))}}),a.RevealLine=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"revealLine",precondition:void 0,metadata:RevealLine_.metadata})}runCoreEditorCommand(v,S){const y=S,w=y.lineNumber||0;let L=typeof w=="number"?w+1:parseInt(w)+1;L<1&&(L=1);const x=v.model.getLineCount();L>x&&(L=x);const E=new Range$2(L,1,L,v.model.getLineMaxColumn(L));let I=0;if(y.at)switch(y.at){case RevealLine_.RawAtArgument.Top:I=3;break;case RevealLine_.RawAtArgument.Center:I=1;break;case RevealLine_.RawAtArgument.Bottom:I=4;break}const D=v.coordinatesConverter.convertModelRangeToViewRange(E);v.revealRange(S.source,!1,D,I,0)}}),a.SelectAll=new class extends EditorOrNativeTextInputCommand{constructor(){super(SelectAllCommand)}runDOMCommand(v){isFirefox$1&&(v.focus(),v.select()),v.ownerDocument.execCommand("selectAll")}runEditorCommand(v,S,y){const w=S._getViewModel();w&&this.runCoreEditorCommand(w,y)}runCoreEditorCommand(v,S){v.model.pushStackElement(),v.setCursorStates("keyboard",3,[CursorMoveCommands.selectAll(v,v.getPrimaryCursorState())])}},a.SetSelection=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"setSelection",precondition:void 0})}runCoreEditorCommand(v,S){S.selection&&(v.model.pushStackElement(),v.setCursorStates(S.source,3,[CursorState$1.fromModelSelection(S.selection)]))}})})(CoreNavigationCommands||(CoreNavigationCommands={}));const columnSelectionCondition=ContextKeyExpr.and(EditorContextKeys.textInputFocus,EditorContextKeys.columnSelection);function registerColumnSelection(a,e){KeybindingsRegistry.registerKeybindingRule({id:a,primary:e,when:columnSelectionCondition,weight:CORE_WEIGHT+1})}registerColumnSelection(CoreNavigationCommands.CursorColumnSelectLeft.id,1039);registerColumnSelection(CoreNavigationCommands.CursorColumnSelectRight.id,1041);registerColumnSelection(CoreNavigationCommands.CursorColumnSelectUp.id,1040);registerColumnSelection(CoreNavigationCommands.CursorColumnSelectPageUp.id,1035);registerColumnSelection(CoreNavigationCommands.CursorColumnSelectDown.id,1042);registerColumnSelection(CoreNavigationCommands.CursorColumnSelectPageDown.id,1036);function registerCommand$2(a){return a.register(),a}var CoreEditingCommands;(function(a){class e extends EditorCommand{runEditorCommand(s,o,r){const l=o._getViewModel();l&&this.runCoreEditingCommand(o,l,r||{})}}a.CoreEditingCommand=e,a.LineBreakInsert=registerEditorCommand(new class extends e{constructor(){super({id:"lineBreakInsert",precondition:EditorContextKeys.writable,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:301}}})}runCoreEditingCommand(t,s,o){t.pushUndoStop(),t.executeCommands(this.id,EnterOperation.lineBreakInsert(s.cursorConfig,s.model,s.getCursorStates().map(r=>r.modelState.selection)))}}),a.Outdent=registerEditorCommand(new class extends e{constructor(){super({id:"outdent",precondition:EditorContextKeys.writable,kbOpts:{weight:CORE_WEIGHT,kbExpr:ContextKeyExpr.and(EditorContextKeys.editorTextFocus,EditorContextKeys.tabDoesNotMoveFocus),primary:1026}})}runCoreEditingCommand(t,s,o){t.pushUndoStop(),t.executeCommands(this.id,TypeOperations.outdent(s.cursorConfig,s.model,s.getCursorStates().map(r=>r.modelState.selection))),t.pushUndoStop()}}),a.Tab=registerEditorCommand(new class extends e{constructor(){super({id:"tab",precondition:EditorContextKeys.writable,kbOpts:{weight:CORE_WEIGHT,kbExpr:ContextKeyExpr.and(EditorContextKeys.editorTextFocus,EditorContextKeys.tabDoesNotMoveFocus),primary:2}})}runCoreEditingCommand(t,s,o){t.pushUndoStop(),t.executeCommands(this.id,TypeOperations.tab(s.cursorConfig,s.model,s.getCursorStates().map(r=>r.modelState.selection))),t.pushUndoStop()}}),a.DeleteLeft=registerEditorCommand(new class extends e{constructor(){super({id:"deleteLeft",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1,secondary:[1025],mac:{primary:1,secondary:[1025,294,257]}}})}runCoreEditingCommand(t,s,o){const[r,l]=DeleteOperations.deleteLeft(s.getPrevEditOperationType(),s.cursorConfig,s.model,s.getCursorStates().map(c=>c.modelState.selection),s.getCursorAutoClosedCharacters());r&&t.pushUndoStop(),t.executeCommands(this.id,l),s.setPrevEditOperationType(2)}}),a.DeleteRight=registerEditorCommand(new class extends e{constructor(){super({id:"deleteRight",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:20,mac:{primary:20,secondary:[290,276]}}})}runCoreEditingCommand(t,s,o){const[r,l]=DeleteOperations.deleteRight(s.getPrevEditOperationType(),s.cursorConfig,s.model,s.getCursorStates().map(c=>c.modelState.selection));r&&t.pushUndoStop(),t.executeCommands(this.id,l),s.setPrevEditOperationType(3)}}),a.Undo=new class extends EditorOrNativeTextInputCommand{constructor(){super(UndoCommand)}runDOMCommand(t){t.ownerDocument.execCommand("undo")}runEditorCommand(t,s,o){if(!(!s.hasModel()||s.getOption(104)===!0))return s.getModel().undo()}},a.Redo=new class extends EditorOrNativeTextInputCommand{constructor(){super(RedoCommand)}runDOMCommand(t){t.ownerDocument.execCommand("redo")}runEditorCommand(t,s,o){if(!(!s.hasModel()||s.getOption(104)===!0))return s.getModel().redo()}}})(CoreEditingCommands||(CoreEditingCommands={}));class EditorHandlerCommand extends Command$1{constructor(e,t,s){super({id:e,precondition:void 0,metadata:s}),this._handlerId=t}runCommand(e,t){const s=e.get(ICodeEditorService).getFocusedCodeEditor();s&&s.trigger("keyboard",this._handlerId,t)}}function registerOverwritableCommand(a,e){registerCommand$2(new EditorHandlerCommand("default:"+a,a)),registerCommand$2(new EditorHandlerCommand(a,a,e))}registerOverwritableCommand("type",{description:"Type",args:[{name:"args",schema:{type:"object",required:["text"],properties:{text:{type:"string"}}}}]});registerOverwritableCommand("replacePreviousChar");registerOverwritableCommand("compositionType");registerOverwritableCommand("compositionStart");registerOverwritableCommand("compositionEnd");registerOverwritableCommand("paste");registerOverwritableCommand("cut");const IMarkerDecorationsService=createDecorator("markerDecorationsService");var __decorate$2W=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2P=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},Tn;let MarkerDecorationsContribution=(Tn=class{constructor(e,t){}dispose(){}},Tn.ID="editor.contrib.markerDecorations",Tn);MarkerDecorationsContribution=__decorate$2W([__param$2P(1,IMarkerDecorationsService)],MarkerDecorationsContribution);registerEditorContribution(MarkerDecorationsContribution.ID,MarkerDecorationsContribution,0);const editor$1="";class FastDomNode{constructor(e){this.domNode=e,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingLeft="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}focus(){this.domNode.focus()}setMaxWidth(e){const t=numberAsPixels(e);this._maxWidth!==t&&(this._maxWidth=t,this.domNode.style.maxWidth=this._maxWidth)}setWidth(e){const t=numberAsPixels(e);this._width!==t&&(this._width=t,this.domNode.style.width=this._width)}setHeight(e){const t=numberAsPixels(e);this._height!==t&&(this._height=t,this.domNode.style.height=this._height)}setTop(e){const t=numberAsPixels(e);this._top!==t&&(this._top=t,this.domNode.style.top=this._top)}setLeft(e){const t=numberAsPixels(e);this._left!==t&&(this._left=t,this.domNode.style.left=this._left)}setBottom(e){const t=numberAsPixels(e);this._bottom!==t&&(this._bottom=t,this.domNode.style.bottom=this._bottom)}setRight(e){const t=numberAsPixels(e);this._right!==t&&(this._right=t,this.domNode.style.right=this._right)}setPaddingLeft(e){const t=numberAsPixels(e);this._paddingLeft!==t&&(this._paddingLeft=t,this.domNode.style.paddingLeft=this._paddingLeft)}setFontFamily(e){this._fontFamily!==e&&(this._fontFamily=e,this.domNode.style.fontFamily=this._fontFamily)}setFontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.domNode.style.fontWeight=this._fontWeight)}setFontSize(e){const t=numberAsPixels(e);this._fontSize!==t&&(this._fontSize=t,this.domNode.style.fontSize=this._fontSize)}setFontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.domNode.style.fontStyle=this._fontStyle)}setFontFeatureSettings(e){this._fontFeatureSettings!==e&&(this._fontFeatureSettings=e,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}setFontVariationSettings(e){this._fontVariationSettings!==e&&(this._fontVariationSettings=e,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}setTextDecoration(e){this._textDecoration!==e&&(this._textDecoration=e,this.domNode.style.textDecoration=this._textDecoration)}setLineHeight(e){const t=numberAsPixels(e);this._lineHeight!==t&&(this._lineHeight=t,this.domNode.style.lineHeight=this._lineHeight)}setLetterSpacing(e){const t=numberAsPixels(e);this._letterSpacing!==t&&(this._letterSpacing=t,this.domNode.style.letterSpacing=this._letterSpacing)}setClassName(e){this._className!==e&&(this._className=e,this.domNode.className=this._className)}toggleClassName(e,t){this.domNode.classList.toggle(e,t),this._className=this.domNode.className}setDisplay(e){this._display!==e&&(this._display=e,this.domNode.style.display=this._display)}setPosition(e){this._position!==e&&(this._position=e,this.domNode.style.position=this._position)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this.domNode.style.visibility=this._visibility)}setColor(e){this._color!==e&&(this._color=e,this.domNode.style.color=this._color)}setBackgroundColor(e){this._backgroundColor!==e&&(this._backgroundColor=e,this.domNode.style.backgroundColor=this._backgroundColor)}setLayerHinting(e){this._layerHint!==e&&(this._layerHint=e,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}setBoxShadow(e){this._boxShadow!==e&&(this._boxShadow=e,this.domNode.style.boxShadow=e)}setContain(e){this._contain!==e&&(this._contain=e,this.domNode.style.contain=this._contain)}setAttribute(e,t){this.domNode.setAttribute(e,t)}removeAttribute(e){this.domNode.removeAttribute(e)}appendChild(e){this.domNode.appendChild(e.domNode)}removeChild(e){this.domNode.removeChild(e.domNode)}}function numberAsPixels(a){return typeof a=="number"?`${a}px`:a}function createFastDomNode(a){return new FastDomNode(a)}function applyFontInfo(a,e){a instanceof FastDomNode?(a.setFontFamily(e.getMassagedFontFamily()),a.setFontWeight(e.fontWeight),a.setFontSize(e.fontSize),a.setFontFeatureSettings(e.fontFeatureSettings),a.setFontVariationSettings(e.fontVariationSettings),a.setLineHeight(e.lineHeight),a.setLetterSpacing(e.letterSpacing)):(a.style.fontFamily=e.getMassagedFontFamily(),a.style.fontWeight=e.fontWeight,a.style.fontSize=e.fontSize+"px",a.style.fontFeatureSettings=e.fontFeatureSettings,a.style.fontVariationSettings=e.fontVariationSettings,a.style.lineHeight=e.lineHeight+"px",a.style.letterSpacing=e.letterSpacing+"px")}class ElementSizeObserver extends Disposable{constructor(e,t){super(),this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,this._referenceDomElement=e,this._width=-1,this._height=-1,this._resizeObserver=null,this.measureReferenceDomElement(!1,t)}dispose(){this.stopObserving(),super.dispose()}getWidth(){return this._width}getHeight(){return this._height}startObserving(){if(!this._resizeObserver&&this._referenceDomElement){let e=null;const t=()=>{e?this.observe({width:e.width,height:e.height}):this.observe()};let s=!1,o=!1;const r=()=>{if(s&&!o)try{s=!1,o=!0,t()}finally{scheduleAtNextAnimationFrame(getWindow(this._referenceDomElement),()=>{o=!1,r()})}};this._resizeObserver=new ResizeObserver(l=>{l&&l[0]&&l[0].contentRect?e={width:l[0].contentRect.width,height:l[0].contentRect.height}:e=null,s=!0,r()}),this._resizeObserver.observe(this._referenceDomElement)}}stopObserving(){this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null)}observe(e){this.measureReferenceDomElement(!0,e)}measureReferenceDomElement(e,t){let s=0,o=0;t?(s=t.width,o=t.height):this._referenceDomElement&&(s=this._referenceDomElement.clientWidth,o=this._referenceDomElement.clientHeight),s=Math.max(5,s),o=Math.max(5,o),(this._width!==s||this._height!==o)&&(this._width=s,this._height=o,e&&this._onDidChange.fire())}}class DevicePixelRatioMonitor extends Disposable{constructor(e){super(),this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,this._listener=()=>this._handleChange(e,!0),this._mediaQueryList=null,this._handleChange(e,!1)}_handleChange(e,t){var s;(s=this._mediaQueryList)==null||s.removeEventListener("change",this._listener),this._mediaQueryList=e.matchMedia(`(resolution: ${e.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener("change",this._listener),t&&this._onDidChange.fire()}}class PixelRatioMonitorImpl extends Disposable{get value(){return this._value}constructor(e){super(),this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,this._value=this._getPixelRatio(e);const t=this._register(new DevicePixelRatioMonitor(e));this._register(t.onDidChange(()=>{this._value=this._getPixelRatio(e),this._onDidChange.fire(this._value)}))}_getPixelRatio(e){const t=document.createElement("canvas").getContext("2d"),s=e.devicePixelRatio||1,o=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return s/o}}class PixelRatioMonitorFacade{constructor(){this.mapWindowIdToPixelRatioMonitor=new Map}_getOrCreatePixelRatioMonitor(e){const t=getWindowId(e);let s=this.mapWindowIdToPixelRatioMonitor.get(t);return s||(s=new PixelRatioMonitorImpl(e),this.mapWindowIdToPixelRatioMonitor.set(t,s),Event$1.once(onDidUnregisterWindow)(({vscodeWindowId:o})=>{o===t&&(s==null||s.dispose(),this.mapWindowIdToPixelRatioMonitor.delete(t))})),s}getInstance(e){return this._getOrCreatePixelRatioMonitor(e)}}const PixelRatio=new PixelRatioMonitorFacade;class CharWidthRequest{constructor(e,t){this.chr=e,this.type=t,this.width=0}fulfill(e){this.width=e}}class DomCharWidthReader{constructor(e,t){this._bareFontInfo=e,this._requests=t,this._container=null,this._testElements=null}read(e){var t;this._createDomElements(),e.document.body.appendChild(this._container),this._readFromDomElements(),(t=this._container)==null||t.remove(),this._container=null,this._testElements=null}_createDomElements(){const e=document.createElement("div");e.style.position="absolute",e.style.top="-50000px",e.style.width="50000px";const t=document.createElement("div");applyFontInfo(t,this._bareFontInfo),e.appendChild(t);const s=document.createElement("div");applyFontInfo(s,this._bareFontInfo),s.style.fontWeight="bold",e.appendChild(s);const o=document.createElement("div");applyFontInfo(o,this._bareFontInfo),o.style.fontStyle="italic",e.appendChild(o);const r=[];for(const l of this._requests){let c;l.type===0&&(c=t),l.type===2&&(c=s),l.type===1&&(c=o),c.appendChild(document.createElement("br"));const d=document.createElement("span");DomCharWidthReader._render(d,l),c.appendChild(d),r.push(d)}this._container=e,this._testElements=r}static _render(e,t){if(t.chr===" "){let s=" ";for(let o=0;o<8;o++)s+=s;e.innerText=s}else{let s=t.chr;for(let o=0;o<8;o++)s+=s;e.textContent=s}}_readFromDomElements(){for(let e=0,t=this._requests.length;e<t;e++){const s=this._requests[e],o=this._testElements[e];s.fulfill(o.offsetWidth/256)}}}function readCharWidths(a,e,t){new DomCharWidthReader(e,t).read(a)}const EDITOR_MODEL_DEFAULTS={tabSize:4,indentSize:4,insertSpaces:!0,detectIndentation:!0,trimAutoWhitespace:!0,largeFileOptimizations:!0,bracketPairColorizationOptions:{enabled:!0,independentColorPoolPerBracketType:!1}},MINIMAP_GUTTER_WIDTH=8;class ConfigurationChangedEvent{constructor(e){this._values=e}hasChanged(e){return this._values[e]}}class ComputeOptionsMemory{constructor(){this.stableMinimapLayoutInput=null,this.stableFitMaxMinimapScale=0,this.stableFitRemainingWidth=0}}class BaseEditorOption{constructor(e,t,s,o){this.id=e,this.name=t,this.defaultValue=s,this.schema=o}applyUpdate(e,t){return applyUpdate(e,t)}compute(e,t,s){return s}}class ApplyUpdateResult{constructor(e,t){this.newValue=e,this.didChange=t}}function applyUpdate(a,e){if(typeof a!="object"||typeof e!="object"||!a||!e)return new ApplyUpdateResult(e,a!==e);if(Array.isArray(a)||Array.isArray(e)){const s=Array.isArray(a)&&Array.isArray(e)&&equals$1(a,e);return new ApplyUpdateResult(e,!s)}let t=!1;for(const s in e)if(e.hasOwnProperty(s)){const o=applyUpdate(a[s],e[s]);o.didChange&&(a[s]=o.newValue,t=!0)}return new ApplyUpdateResult(a,t)}class ComputedEditorOption{constructor(e){this.schema=void 0,this.id=e,this.name="_never_",this.defaultValue=void 0}applyUpdate(e,t){return applyUpdate(e,t)}validate(e){return this.defaultValue}}class SimpleEditorOption{constructor(e,t,s,o){this.id=e,this.name=t,this.defaultValue=s,this.schema=o}applyUpdate(e,t){return applyUpdate(e,t)}validate(e){return typeof e>"u"?this.defaultValue:e}compute(e,t,s){return s}}function boolean(a,e){return typeof a>"u"?e:a==="false"?!1:!!a}class EditorBooleanOption extends SimpleEditorOption{constructor(e,t,s,o=void 0){typeof o<"u"&&(o.type="boolean",o.default=s),super(e,t,s,o)}validate(e){return boolean(e,this.defaultValue)}}function clampedInt(a,e,t,s){if(typeof a>"u")return e;let o=parseInt(a,10);return isNaN(o)?e:(o=Math.max(t,o),o=Math.min(s,o),o|0)}class EditorIntOption extends SimpleEditorOption{static clampedInt(e,t,s,o){return clampedInt(e,t,s,o)}constructor(e,t,s,o,r,l=void 0){typeof l<"u"&&(l.type="integer",l.default=s,l.minimum=o,l.maximum=r),super(e,t,s,l),this.minimum=o,this.maximum=r}validate(e){return EditorIntOption.clampedInt(e,this.defaultValue,this.minimum,this.maximum)}}function clampedFloat(a,e,t,s){if(typeof a>"u")return e;const o=EditorFloatOption.float(a,e);return EditorFloatOption.clamp(o,t,s)}class EditorFloatOption extends SimpleEditorOption{static clamp(e,t,s){return e<t?t:e>s?s:e}static float(e,t){if(typeof e=="number")return e;if(typeof e>"u")return t;const s=parseFloat(e);return isNaN(s)?t:s}constructor(e,t,s,o,r,l,c){typeof r<"u"&&(r.type="number",r.default=s,r.minimum=l,r.maximum=c),super(e,t,s,r),this.validationFn=o,this.minimum=l,this.maximum=c}validate(e){return this.validationFn(EditorFloatOption.float(e,this.defaultValue))}}class EditorStringOption extends SimpleEditorOption{static string(e,t){return typeof e!="string"?t:e}constructor(e,t,s,o=void 0){typeof o<"u"&&(o.type="string",o.default=s),super(e,t,s,o)}validate(e){return EditorStringOption.string(e,this.defaultValue)}}function stringSet(a,e,t,s){return typeof a!="string"?e:s&&a in s?s[a]:t.indexOf(a)===-1?e:a}class EditorStringEnumOption extends SimpleEditorOption{constructor(e,t,s,o,r=void 0){typeof r<"u"&&(r.type="string",r.enum=o,r.default=s),super(e,t,s,r),this._allowedValues=o}validate(e){return stringSet(e,this.defaultValue,this._allowedValues)}}class EditorEnumOption extends BaseEditorOption{constructor(e,t,s,o,r,l,c=void 0){typeof c<"u"&&(c.type="string",c.enum=r,c.default=o),super(e,t,s,c),this._allowedValues=r,this._convert=l}validate(e){return typeof e!="string"?this.defaultValue:this._allowedValues.indexOf(e)===-1?this.defaultValue:this._convert(e)}}function _autoIndentFromString(a){switch(a){case"none":return 0;case"keep":return 1;case"brackets":return 2;case"advanced":return 3;case"full":return 4}}class EditorAccessibilitySupport extends BaseEditorOption{constructor(){super(2,"accessibilitySupport",0,{type:"string",enum:["auto","on","off"],enumDescriptions:[localize(198,"Use platform APIs to detect when a Screen Reader is attached."),localize(199,"Optimize for usage with a Screen Reader."),localize(200,"Assume a screen reader is not attached.")],default:"auto",tags:["accessibility"],description:localize(201,"Controls if the UI should run in a mode where it is optimized for screen readers.")})}validate(e){switch(e){case"auto":return 0;case"off":return 1;case"on":return 2}return this.defaultValue}compute(e,t,s){return s===0?e.accessibilitySupport:s}}class EditorComments extends BaseEditorOption{constructor(){const e={insertSpace:!0,ignoreEmptyLines:!0};super(29,"comments",e,{"editor.comments.insertSpace":{type:"boolean",default:e.insertSpace,description:localize(202,"Controls whether a space character is inserted when commenting.")},"editor.comments.ignoreEmptyLines":{type:"boolean",default:e.ignoreEmptyLines,description:localize(203,"Controls if empty lines should be ignored with toggle, add or remove actions for line comments.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{insertSpace:boolean(t.insertSpace,this.defaultValue.insertSpace),ignoreEmptyLines:boolean(t.ignoreEmptyLines,this.defaultValue.ignoreEmptyLines)}}}function cursorBlinkingStyleFromString(a){switch(a){case"blink":return 1;case"smooth":return 2;case"phase":return 3;case"expand":return 4;case"solid":return 5}}var TextEditorCursorStyle$1;(function(a){a[a.Line=1]="Line",a[a.Block=2]="Block",a[a.Underline=3]="Underline",a[a.LineThin=4]="LineThin",a[a.BlockOutline=5]="BlockOutline",a[a.UnderlineThin=6]="UnderlineThin"})(TextEditorCursorStyle$1||(TextEditorCursorStyle$1={}));function cursorStyleFromString(a){switch(a){case"line":return TextEditorCursorStyle$1.Line;case"block":return TextEditorCursorStyle$1.Block;case"underline":return TextEditorCursorStyle$1.Underline;case"line-thin":return TextEditorCursorStyle$1.LineThin;case"block-outline":return TextEditorCursorStyle$1.BlockOutline;case"underline-thin":return TextEditorCursorStyle$1.UnderlineThin}}class EditorClassName extends ComputedEditorOption{constructor(){super(162)}compute(e,t,s){const o=["monaco-editor"];return t.get(48)&&o.push(t.get(48)),e.extraEditorClassName&&o.push(e.extraEditorClassName),t.get(82)==="default"?o.push("mouse-default"):t.get(82)==="copy"&&o.push("mouse-copy"),t.get(127)&&o.push("showUnused"),t.get(157)&&o.push("showDeprecated"),o.join(" ")}}class EditorEmptySelectionClipboard extends EditorBooleanOption{constructor(){super(45,"emptySelectionClipboard",!0,{description:localize(204,"Controls whether copying without a selection copies the current line.")})}compute(e,t,s){return s&&e.emptySelectionClipboard}}class EditorFind extends BaseEditorOption{constructor(){const e={cursorMoveOnType:!0,findOnType:!0,seedSearchStringFromSelection:"always",autoFindInSelection:"never",globalFindClipboard:!1,addExtraSpaceOnTop:!0,loop:!0,history:"workspace",replaceHistory:"workspace"};super(50,"find",e,{"editor.find.cursorMoveOnType":{type:"boolean",default:e.cursorMoveOnType,description:localize(205,"Controls whether the cursor should jump to find matches while typing.")},"editor.find.seedSearchStringFromSelection":{type:"string",enum:["never","always","selection"],default:e.seedSearchStringFromSelection,enumDescriptions:[localize(206,"Never seed search string from the editor selection."),localize(207,"Always seed search string from the editor selection, including word at cursor position."),localize(208,"Only seed search string from the editor selection.")],description:localize(209,"Controls whether the search string in the Find Widget is seeded from the editor selection.")},"editor.find.autoFindInSelection":{type:"string",enum:["never","always","multiline"],default:e.autoFindInSelection,enumDescriptions:[localize(210,"Never turn on Find in Selection automatically (default)."),localize(211,"Always turn on Find in Selection automatically."),localize(212,"Turn on Find in Selection automatically when multiple lines of content are selected.")],description:localize(213,"Controls the condition for turning on Find in Selection automatically.")},"editor.find.globalFindClipboard":{type:"boolean",default:e.globalFindClipboard,description:localize(214,"Controls whether the Find Widget should read or modify the shared find clipboard on macOS."),included:isMacintosh},"editor.find.addExtraSpaceOnTop":{type:"boolean",default:e.addExtraSpaceOnTop,description:localize(215,"Controls whether the Find Widget should add extra lines on top of the editor. When true, you can scroll beyond the first line when the Find Widget is visible.")},"editor.find.loop":{type:"boolean",default:e.loop,description:localize(216,"Controls whether the search automatically restarts from the beginning (or the end) when no further matches can be found.")},"editor.find.history":{type:"string",enum:["never","workspace"],default:"workspace",enumDescriptions:[localize(217,"Do not store search history from the find widget."),localize(218,"Store search history across the active workspace")],description:localize(219,"Controls how the find widget history should be stored")},"editor.find.replaceHistory":{type:"string",enum:["never","workspace"],default:"workspace",enumDescriptions:[localize(220,"Do not store history from the replace widget."),localize(221,"Store replace history across the active workspace")],description:localize(222,"Controls how the replace widget history should be stored")},"editor.find.findOnType":{type:"boolean",default:e.findOnType,description:localize(223,"Controls whether the Find Widget should search as you type.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{cursorMoveOnType:boolean(t.cursorMoveOnType,this.defaultValue.cursorMoveOnType),findOnType:boolean(t.findOnType,this.defaultValue.findOnType),seedSearchStringFromSelection:typeof e.seedSearchStringFromSelection=="boolean"?e.seedSearchStringFromSelection?"always":"never":stringSet(t.seedSearchStringFromSelection,this.defaultValue.seedSearchStringFromSelection,["never","always","selection"]),autoFindInSelection:typeof e.autoFindInSelection=="boolean"?e.autoFindInSelection?"always":"never":stringSet(t.autoFindInSelection,this.defaultValue.autoFindInSelection,["never","always","multiline"]),globalFindClipboard:boolean(t.globalFindClipboard,this.defaultValue.globalFindClipboard),addExtraSpaceOnTop:boolean(t.addExtraSpaceOnTop,this.defaultValue.addExtraSpaceOnTop),loop:boolean(t.loop,this.defaultValue.loop),history:stringSet(t.history,this.defaultValue.history,["never","workspace"]),replaceHistory:stringSet(t.replaceHistory,this.defaultValue.replaceHistory,["never","workspace"])}}}const je=class je extends BaseEditorOption{constructor(){super(60,"fontLigatures",je.OFF,{anyOf:[{type:"boolean",description:localize(224,"Enables/Disables font ligatures ('calt' and 'liga' font features). Change this to a string for fine-grained control of the 'font-feature-settings' CSS property.")},{type:"string",description:localize(225,"Explicit 'font-feature-settings' CSS property. A boolean can be passed instead if one only needs to turn on/off ligatures.")}],description:localize(226,"Configures font ligatures or font features. Can be either a boolean to enable/disable ligatures or a string for the value of the CSS 'font-feature-settings' property."),default:!1})}validate(e){return typeof e>"u"?this.defaultValue:typeof e=="string"?e==="false"||e.length===0?je.OFF:e==="true"?je.ON:e:e?je.ON:je.OFF}};je.OFF='"liga" off, "calt" off',je.ON='"liga" on, "calt" on';let EditorFontLigatures=je;const qe=class qe extends BaseEditorOption{constructor(){super(63,"fontVariations",qe.OFF,{anyOf:[{type:"boolean",description:localize(227,"Enables/Disables the translation from font-weight to font-variation-settings. Change this to a string for fine-grained control of the 'font-variation-settings' CSS property.")},{type:"string",description:localize(228,"Explicit 'font-variation-settings' CSS property. A boolean can be passed instead if one only needs to translate font-weight to font-variation-settings.")}],description:localize(229,"Configures font variations. Can be either a boolean to enable/disable the translation from font-weight to font-variation-settings or a string for the value of the CSS 'font-variation-settings' property."),default:!1})}validate(e){return typeof e>"u"?this.defaultValue:typeof e=="string"?e==="false"?qe.OFF:e==="true"?qe.TRANSLATE:e:e?qe.TRANSLATE:qe.OFF}compute(e,t,s){return e.fontInfo.fontVariationSettings}};qe.OFF="normal",qe.TRANSLATE="translate";let EditorFontVariations=qe;class EditorFontInfo extends ComputedEditorOption{constructor(){super(59)}compute(e,t,s){return e.fontInfo}}class EffectiveCursorStyle extends ComputedEditorOption{constructor(){super(161)}compute(e,t,s){return e.inputMode==="overtype"?t.get(92):t.get(34)}}class EffectiveEditContextEnabled extends ComputedEditorOption{constructor(){super(170)}compute(e,t){return e.editContextSupported&&t.get(44)}}class EffectiveAllowVariableFonts extends ComputedEditorOption{constructor(){super(172)}compute(e,t){return e.accessibilitySupport===2?t.get(7):t.get(6)}}class EditorFontSize extends SimpleEditorOption{constructor(){super(61,"fontSize",EDITOR_FONT_DEFAULTS.fontSize,{type:"number",minimum:6,maximum:100,default:EDITOR_FONT_DEFAULTS.fontSize,description:localize(230,"Controls the font size in pixels.")})}validate(e){const t=EditorFloatOption.float(e,this.defaultValue);return t===0?EDITOR_FONT_DEFAULTS.fontSize:EditorFloatOption.clamp(t,6,100)}compute(e,t,s){return e.fontInfo.fontSize}}const Pe=class Pe extends BaseEditorOption{constructor(){super(62,"fontWeight",EDITOR_FONT_DEFAULTS.fontWeight,{anyOf:[{type:"number",minimum:Pe.MINIMUM_VALUE,maximum:Pe.MAXIMUM_VALUE,errorMessage:localize(231,'Only "normal" and "bold" keywords or numbers between 1 and 1000 are allowed.')},{type:"string",pattern:"^(normal|bold|1000|[1-9][0-9]{0,2})$"},{enum:Pe.SUGGESTION_VALUES}],default:EDITOR_FONT_DEFAULTS.fontWeight,description:localize(232,'Controls the font weight. Accepts "normal" and "bold" keywords or numbers between 1 and 1000.')})}validate(e){return e==="normal"||e==="bold"?e:String(EditorIntOption.clampedInt(e,EDITOR_FONT_DEFAULTS.fontWeight,Pe.MINIMUM_VALUE,Pe.MAXIMUM_VALUE))}};Pe.SUGGESTION_VALUES=["normal","bold","100","200","300","400","500","600","700","800","900"],Pe.MINIMUM_VALUE=1,Pe.MAXIMUM_VALUE=1e3;let EditorFontWeight=Pe;class EditorGoToLocation extends BaseEditorOption{constructor(){const e={multiple:"peek",multipleDefinitions:"peek",multipleTypeDefinitions:"peek",multipleDeclarations:"peek",multipleImplementations:"peek",multipleReferences:"peek",multipleTests:"peek",alternativeDefinitionCommand:"editor.action.goToReferences",alternativeTypeDefinitionCommand:"editor.action.goToReferences",alternativeDeclarationCommand:"editor.action.goToReferences",alternativeImplementationCommand:"",alternativeReferenceCommand:"",alternativeTestsCommand:""},t={type:"string",enum:["peek","gotoAndPeek","goto"],default:e.multiple,enumDescriptions:[localize(233,"Show Peek view of the results (default)"),localize(234,"Go to the primary result and show a Peek view"),localize(235,"Go to the primary result and enable Peek-less navigation to others")]},s=["","editor.action.referenceSearch.trigger","editor.action.goToReferences","editor.action.peekImplementation","editor.action.goToImplementation","editor.action.peekTypeDefinition","editor.action.goToTypeDefinition","editor.action.peekDeclaration","editor.action.revealDeclaration","editor.action.peekDefinition","editor.action.revealDefinitionAside","editor.action.revealDefinition"];super(67,"gotoLocation",e,{"editor.gotoLocation.multiple":{deprecationMessage:localize(236,"This setting is deprecated, please use separate settings like 'editor.editor.gotoLocation.multipleDefinitions' or 'editor.editor.gotoLocation.multipleImplementations' instead.")},"editor.gotoLocation.multipleDefinitions":{description:localize(237,"Controls the behavior the 'Go to Definition'-command when multiple target locations exist."),...t},"editor.gotoLocation.multipleTypeDefinitions":{description:localize(238,"Controls the behavior the 'Go to Type Definition'-command when multiple target locations exist."),...t},"editor.gotoLocation.multipleDeclarations":{description:localize(239,"Controls the behavior the 'Go to Declaration'-command when multiple target locations exist."),...t},"editor.gotoLocation.multipleImplementations":{description:localize(240,"Controls the behavior the 'Go to Implementations'-command when multiple target locations exist."),...t},"editor.gotoLocation.multipleReferences":{description:localize(241,"Controls the behavior the 'Go to References'-command when multiple target locations exist."),...t},"editor.gotoLocation.alternativeDefinitionCommand":{type:"string",default:e.alternativeDefinitionCommand,enum:s,description:localize(242,"Alternative command id that is being executed when the result of 'Go to Definition' is the current location.")},"editor.gotoLocation.alternativeTypeDefinitionCommand":{type:"string",default:e.alternativeTypeDefinitionCommand,enum:s,description:localize(243,"Alternative command id that is being executed when the result of 'Go to Type Definition' is the current location.")},"editor.gotoLocation.alternativeDeclarationCommand":{type:"string",default:e.alternativeDeclarationCommand,enum:s,description:localize(244,"Alternative command id that is being executed when the result of 'Go to Declaration' is the current location.")},"editor.gotoLocation.alternativeImplementationCommand":{type:"string",default:e.alternativeImplementationCommand,enum:s,description:localize(245,"Alternative command id that is being executed when the result of 'Go to Implementation' is the current location.")},"editor.gotoLocation.alternativeReferenceCommand":{type:"string",default:e.alternativeReferenceCommand,enum:s,description:localize(246,"Alternative command id that is being executed when the result of 'Go to Reference' is the current location.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{multiple:stringSet(t.multiple,this.defaultValue.multiple,["peek","gotoAndPeek","goto"]),multipleDefinitions:t.multipleDefinitions??stringSet(t.multipleDefinitions,"peek",["peek","gotoAndPeek","goto"]),multipleTypeDefinitions:t.multipleTypeDefinitions??stringSet(t.multipleTypeDefinitions,"peek",["peek","gotoAndPeek","goto"]),multipleDeclarations:t.multipleDeclarations??stringSet(t.multipleDeclarations,"peek",["peek","gotoAndPeek","goto"]),multipleImplementations:t.multipleImplementations??stringSet(t.multipleImplementations,"peek",["peek","gotoAndPeek","goto"]),multipleReferences:t.multipleReferences??stringSet(t.multipleReferences,"peek",["peek","gotoAndPeek","goto"]),multipleTests:t.multipleTests??stringSet(t.multipleTests,"peek",["peek","gotoAndPeek","goto"]),alternativeDefinitionCommand:EditorStringOption.string(t.alternativeDefinitionCommand,this.defaultValue.alternativeDefinitionCommand),alternativeTypeDefinitionCommand:EditorStringOption.string(t.alternativeTypeDefinitionCommand,this.defaultValue.alternativeTypeDefinitionCommand),alternativeDeclarationCommand:EditorStringOption.string(t.alternativeDeclarationCommand,this.defaultValue.alternativeDeclarationCommand),alternativeImplementationCommand:EditorStringOption.string(t.alternativeImplementationCommand,this.defaultValue.alternativeImplementationCommand),alternativeReferenceCommand:EditorStringOption.string(t.alternativeReferenceCommand,this.defaultValue.alternativeReferenceCommand),alternativeTestsCommand:EditorStringOption.string(t.alternativeTestsCommand,this.defaultValue.alternativeTestsCommand)}}}class EditorHover extends BaseEditorOption{constructor(){const e={enabled:!0,delay:300,hidingDelay:300,sticky:!0,above:!0};super(69,"hover",e,{"editor.hover.enabled":{type:"boolean",default:e.enabled,description:localize(247,"Controls whether the hover is shown.")},"editor.hover.delay":{type:"number",default:e.delay,minimum:0,maximum:1e4,description:localize(248,"Controls the delay in milliseconds after which the hover is shown.")},"editor.hover.sticky":{type:"boolean",default:e.sticky,description:localize(249,"Controls whether the hover should remain visible when mouse is moved over it.")},"editor.hover.hidingDelay":{type:"integer",minimum:0,default:e.hidingDelay,markdownDescription:localize(250,"Controls the delay in milliseconds after which the hover is hidden. Requires `#editor.hover.sticky#` to be enabled.")},"editor.hover.above":{type:"boolean",default:e.above,description:localize(251,"Prefer showing hovers above the line, if there's space.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:boolean(t.enabled,this.defaultValue.enabled),delay:EditorIntOption.clampedInt(t.delay,this.defaultValue.delay,0,1e4),sticky:boolean(t.sticky,this.defaultValue.sticky),hidingDelay:EditorIntOption.clampedInt(t.hidingDelay,this.defaultValue.hidingDelay,0,6e5),above:boolean(t.above,this.defaultValue.above)}}}class EditorLayoutInfoComputer extends ComputedEditorOption{constructor(){super(165)}compute(e,t,s){return EditorLayoutInfoComputer.computeLayout(t,{memory:e.memory,outerWidth:e.outerWidth,outerHeight:e.outerHeight,isDominatedByLongLines:e.isDominatedByLongLines,lineHeight:e.fontInfo.lineHeight,viewLineCount:e.viewLineCount,lineNumbersDigitCount:e.lineNumbersDigitCount,typicalHalfwidthCharacterWidth:e.fontInfo.typicalHalfwidthCharacterWidth,maxDigitWidth:e.fontInfo.maxDigitWidth,pixelRatio:e.pixelRatio,glyphMarginDecorationLaneCount:e.glyphMarginDecorationLaneCount})}static computeContainedMinimapLineCount(e){const t=e.height/e.lineHeight,s=Math.floor(e.paddingTop/e.lineHeight);let o=Math.floor(e.paddingBottom/e.lineHeight);e.scrollBeyondLastLine&&(o=Math.max(o,t-1));const r=(s+e.viewLineCount+o)/(e.pixelRatio*e.height),l=Math.floor(e.viewLineCount/r);return{typicalViewportLineCount:t,extraLinesBeforeFirstLine:s,extraLinesBeyondLastLine:o,desiredRatio:r,minimapLineCount:l}}static _computeMinimapLayout(e,t){const s=e.outerWidth,o=e.outerHeight,r=e.pixelRatio;if(!e.minimap.enabled)return{renderMinimap:0,minimapLeft:0,minimapWidth:0,minimapHeightIsEditorHeight:!1,minimapIsSampling:!1,minimapScale:1,minimapLineHeight:1,minimapCanvasInnerWidth:0,minimapCanvasInnerHeight:Math.floor(r*o),minimapCanvasOuterWidth:0,minimapCanvasOuterHeight:o};const l=t.stableMinimapLayoutInput,c=l&&e.outerHeight===l.outerHeight&&e.lineHeight===l.lineHeight&&e.typicalHalfwidthCharacterWidth===l.typicalHalfwidthCharacterWidth&&e.pixelRatio===l.pixelRatio&&e.scrollBeyondLastLine===l.scrollBeyondLastLine&&e.paddingTop===l.paddingTop&&e.paddingBottom===l.paddingBottom&&e.minimap.enabled===l.minimap.enabled&&e.minimap.side===l.minimap.side&&e.minimap.size===l.minimap.size&&e.minimap.showSlider===l.minimap.showSlider&&e.minimap.renderCharacters===l.minimap.renderCharacters&&e.minimap.maxColumn===l.minimap.maxColumn&&e.minimap.scale===l.minimap.scale&&e.verticalScrollbarWidth===l.verticalScrollbarWidth&&e.isViewportWrapping===l.isViewportWrapping,d=e.lineHeight,u=e.typicalHalfwidthCharacterWidth,g=e.scrollBeyondLastLine,f=e.minimap.renderCharacters;let p=r>=2?Math.round(e.minimap.scale*2):e.minimap.scale;const m=e.minimap.maxColumn,_=e.minimap.size,C=e.minimap.side,b=e.verticalScrollbarWidth,v=e.viewLineCount,S=e.remainingWidth,y=e.isViewportWrapping,w=f?2:3;let L=Math.floor(r*o);const x=L/r;let E=!1,I=!1,D=w*p,k=p/r,N=1;if(_==="fill"||_==="fit"){const{typicalViewportLineCount:B,extraLinesBeforeFirstLine:H,extraLinesBeyondLastLine:V,desiredRatio:K,minimapLineCount:z}=EditorLayoutInfoComputer.computeContainedMinimapLineCount({viewLineCount:v,scrollBeyondLastLine:g,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,height:o,lineHeight:d,pixelRatio:r});if(v/z>1)E=!0,I=!0,p=1,D=1,k=p/r;else{let X=!1,Y=p+1;if(_==="fit"){const ee=Math.ceil((H+v+V)*D);y&&c&&S<=t.stableFitRemainingWidth?(X=!0,Y=t.stableFitMaxMinimapScale):X=ee>L}if(_==="fill"||X){E=!0;const ee=p;D=Math.min(d*r,Math.max(1,Math.floor(1/K))),y&&c&&S<=t.stableFitRemainingWidth&&(Y=t.stableFitMaxMinimapScale),p=Math.min(Y,Math.max(1,Math.floor(D/w))),p>ee&&(N=Math.min(2,p/ee)),k=p/r/N,L=Math.ceil(Math.max(B,H+v+V)*D),y?(t.stableMinimapLayoutInput=e,t.stableFitRemainingWidth=S,t.stableFitMaxMinimapScale=p):(t.stableMinimapLayoutInput=null,t.stableFitRemainingWidth=0)}}}const R=Math.floor(m*k),M=Math.min(R,Math.max(0,Math.floor((S-b-2)*k/(u+k)))+MINIMAP_GUTTER_WIDTH);let A=Math.floor(r*M);const O=A/r;A=Math.floor(A*N);const P=f?1:2,W=C==="left"?0:s-M-b;return{renderMinimap:P,minimapLeft:W,minimapWidth:M,minimapHeightIsEditorHeight:E,minimapIsSampling:I,minimapScale:p,minimapLineHeight:D,minimapCanvasInnerWidth:A,minimapCanvasInnerHeight:L,minimapCanvasOuterWidth:O,minimapCanvasOuterHeight:x}}static computeLayout(e,t){const s=t.outerWidth|0,o=t.outerHeight|0,r=t.lineHeight|0,l=t.lineNumbersDigitCount|0,c=t.typicalHalfwidthCharacterWidth,d=t.maxDigitWidth,u=t.pixelRatio,g=t.viewLineCount,f=e.get(154),p=f==="inherit"?e.get(153):f,m=p==="inherit"?e.get(149):p,_=e.get(152),C=t.isDominatedByLongLines,b=e.get(66),v=e.get(76).renderType!==0,S=e.get(77),y=e.get(119),w=e.get(96),L=e.get(81),x=e.get(117),E=x.verticalScrollbarSize,I=x.verticalHasArrows,D=x.arrowSize,k=x.horizontalScrollbarSize,N=e.get(52),R=e.get(126)!=="never";let M=e.get(74);N&&R&&(M+=16);let A=0;if(v){const ne=Math.max(l,S);A=Math.round(ne*d)}let O=0;b&&(O=r*t.glyphMarginDecorationLaneCount);let P=0,W=P+O,B=W+A,H=B+M;const V=s-O-A-M;let K=!1,z=!1,G=-1;e.get(2)===2&&p==="inherit"&&C?(K=!0,z=!0):m==="on"||m==="bounded"?z=!0:m==="wordWrapColumn"&&(G=_);const X=EditorLayoutInfoComputer._computeMinimapLayout({outerWidth:s,outerHeight:o,lineHeight:r,typicalHalfwidthCharacterWidth:c,pixelRatio:u,scrollBeyondLastLine:y,paddingTop:w.top,paddingBottom:w.bottom,minimap:L,verticalScrollbarWidth:E,viewLineCount:g,remainingWidth:V,isViewportWrapping:z},t.memory||new ComputeOptionsMemory);X.renderMinimap!==0&&X.minimapLeft===0&&(P+=X.minimapWidth,W+=X.minimapWidth,B+=X.minimapWidth,H+=X.minimapWidth);const Y=V-X.minimapWidth,ee=Math.max(1,Math.floor((Y-E-2)/c)),le=I?D:0;return z&&(G=Math.max(1,ee),m==="bounded"&&(G=Math.min(G,_))),{width:s,height:o,glyphMarginLeft:P,glyphMarginWidth:O,glyphMarginDecorationLaneCount:t.glyphMarginDecorationLaneCount,lineNumbersLeft:W,lineNumbersWidth:A,decorationsLeft:B,decorationsWidth:M,contentLeft:H,contentWidth:Y,minimap:X,viewportColumn:ee,isWordWrapMinified:K,isViewportWrapping:z,wrappingColumn:G,verticalScrollbarWidth:E,horizontalScrollbarHeight:k,overviewRuler:{top:le,width:E,height:o-2*le,right:0}}}}class WrappingStrategy extends BaseEditorOption{constructor(){super(156,"wrappingStrategy","simple",{"editor.wrappingStrategy":{enumDescriptions:[localize(252,"Assumes that all characters are of the same width. This is a fast algorithm that works correctly for monospace fonts and certain scripts (like Latin characters) where glyphs are of equal width."),localize(253,"Delegates wrapping points computation to the browser. This is a slow algorithm, that might cause freezes for large files, but it works correctly in all cases.")],type:"string",enum:["simple","advanced"],default:"simple",description:localize(254,"Controls the algorithm that computes wrapping points. Note that when in accessibility mode, advanced will be used for the best experience.")}})}validate(e){return stringSet(e,"simple",["simple","advanced"])}compute(e,t,s){return t.get(2)===2?"advanced":s}}var ShowLightbulbIconMode$1;(function(a){a.Off="off",a.OnCode="onCode",a.On="on"})(ShowLightbulbIconMode$1||(ShowLightbulbIconMode$1={}));class EditorLightbulb extends BaseEditorOption{constructor(){const e={enabled:ShowLightbulbIconMode$1.OnCode};super(73,"lightbulb",e,{"editor.lightbulb.enabled":{type:"string",enum:[ShowLightbulbIconMode$1.Off,ShowLightbulbIconMode$1.OnCode,ShowLightbulbIconMode$1.On],default:e.enabled,enumDescriptions:[localize(255,"Disable the code action menu."),localize(256,"Show the code action menu when the cursor is on lines with code."),localize(257,"Show the code action menu when the cursor is on lines with code or on empty lines.")],description:localize(258,"Enables the Code Action lightbulb in the editor.")}})}validate(e){return!e||typeof e!="object"?this.defaultValue:{enabled:stringSet(e.enabled,this.defaultValue.enabled,[ShowLightbulbIconMode$1.Off,ShowLightbulbIconMode$1.OnCode,ShowLightbulbIconMode$1.On])}}}class EditorStickyScroll extends BaseEditorOption{constructor(){const e={enabled:!0,maxLineCount:5,defaultModel:"outlineModel",scrollWithEditor:!0};super(131,"stickyScroll",e,{"editor.stickyScroll.enabled":{type:"boolean",default:e.enabled,description:localize(259,"Shows the nested current scopes during the scroll at the top of the editor.")},"editor.stickyScroll.maxLineCount":{type:"number",default:e.maxLineCount,minimum:1,maximum:20,description:localize(260,"Defines the maximum number of sticky lines to show.")},"editor.stickyScroll.defaultModel":{type:"string",enum:["outlineModel","foldingProviderModel","indentationModel"],default:e.defaultModel,description:localize(261,"Defines the model to use for determining which lines to stick. If the outline model does not exist, it will fall back on the folding provider model which falls back on the indentation model. This order is respected in all three cases.")},"editor.stickyScroll.scrollWithEditor":{type:"boolean",default:e.scrollWithEditor,description:localize(262,"Enable scrolling of Sticky Scroll with the editor's horizontal scrollbar.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:boolean(t.enabled,this.defaultValue.enabled),maxLineCount:EditorIntOption.clampedInt(t.maxLineCount,this.defaultValue.maxLineCount,1,20),defaultModel:stringSet(t.defaultModel,this.defaultValue.defaultModel,["outlineModel","foldingProviderModel","indentationModel"]),scrollWithEditor:boolean(t.scrollWithEditor,this.defaultValue.scrollWithEditor)}}}class EditorInlayHints extends BaseEditorOption{constructor(){const e={enabled:"on",fontSize:0,fontFamily:"",padding:!1,maximumLength:43};super(159,"inlayHints",e,{"editor.inlayHints.enabled":{type:"string",default:e.enabled,description:localize(263,"Enables the inlay hints in the editor."),enum:["on","onUnlessPressed","offUnlessPressed","off"],markdownEnumDescriptions:[localize(264,"Inlay hints are enabled"),localize(265,"Inlay hints are showing by default and hide when holding {0}",isMacintosh?"Ctrl+Option":"Ctrl+Alt"),localize(266,"Inlay hints are hidden by default and show when holding {0}",isMacintosh?"Ctrl+Option":"Ctrl+Alt"),localize(267,"Inlay hints are disabled")]},"editor.inlayHints.fontSize":{type:"number",default:e.fontSize,markdownDescription:localize(268,"Controls font size of inlay hints in the editor. As default the {0} is used when the configured value is less than {1} or greater than the editor font size.","`#editor.fontSize#`","`5`")},"editor.inlayHints.fontFamily":{type:"string",default:e.fontFamily,markdownDescription:localize(269,"Controls font family of inlay hints in the editor. When set to empty, the {0} is used.","`#editor.fontFamily#`")},"editor.inlayHints.padding":{type:"boolean",default:e.padding,description:localize(270,"Enables the padding around the inlay hints in the editor.")},"editor.inlayHints.maximumLength":{type:"number",default:e.maximumLength,markdownDescription:localize(271,"Maximum overall length of inlay hints, for a single line, before they get truncated by the editor. Set to `0` to never truncate")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return typeof t.enabled=="boolean"&&(t.enabled=t.enabled?"on":"off"),{enabled:stringSet(t.enabled,this.defaultValue.enabled,["on","off","offUnlessPressed","onUnlessPressed"]),fontSize:EditorIntOption.clampedInt(t.fontSize,this.defaultValue.fontSize,0,100),fontFamily:EditorStringOption.string(t.fontFamily,this.defaultValue.fontFamily),padding:boolean(t.padding,this.defaultValue.padding),maximumLength:EditorIntOption.clampedInt(t.maximumLength,this.defaultValue.maximumLength,0,Number.MAX_SAFE_INTEGER)}}}class EditorLineDecorationsWidth extends BaseEditorOption{constructor(){super(74,"lineDecorationsWidth",10)}validate(e){return typeof e=="string"&&/^\d+(\.\d+)?ch$/.test(e)?-parseFloat(e.substring(0,e.length-2)):EditorIntOption.clampedInt(e,this.defaultValue,0,1e3)}compute(e,t,s){return s<0?EditorIntOption.clampedInt(-s*e.fontInfo.typicalHalfwidthCharacterWidth,this.defaultValue,0,1e3):s}}class EditorLineHeight extends EditorFloatOption{constructor(){super(75,"lineHeight",EDITOR_FONT_DEFAULTS.lineHeight,e=>EditorFloatOption.clamp(e,0,150),{markdownDescription:localize(272,`Controls the line height. 
 - Use 0 to automatically compute the line height from the font size.
 - Values between 0 and 8 will be used as a multiplier with the font size.
 - Values greater than or equal to 8 will be used as effective values.`)},0,150)}compute(e,t,s){return e.fontInfo.lineHeight}}class EditorMinimap extends BaseEditorOption{constructor(){const e={enabled:!0,size:"proportional",side:"right",showSlider:"mouseover",autohide:"none",renderCharacters:!0,maxColumn:120,scale:1,showRegionSectionHeaders:!0,showMarkSectionHeaders:!0,markSectionHeaderRegex:"\\bMARK:\\s*(?<separator>-?)\\s*(?<label>.*)$",sectionHeaderFontSize:9,sectionHeaderLetterSpacing:1};super(81,"minimap",e,{"editor.minimap.enabled":{type:"boolean",default:e.enabled,description:localize(273,"Controls whether the minimap is shown.")},"editor.minimap.autohide":{type:"string",enum:["none","mouseover","scroll"],enumDescriptions:[localize(274,"The minimap is always shown."),localize(275,"The minimap is hidden when mouse is not over the minimap and shown when mouse is over the minimap."),localize(276,"The minimap is only shown when the editor is scrolled")],default:e.autohide,description:localize(277,"Controls whether the minimap is hidden automatically.")},"editor.minimap.size":{type:"string",enum:["proportional","fill","fit"],enumDescriptions:[localize(278,"The minimap has the same size as the editor contents (and might scroll)."),localize(279,"The minimap will stretch or shrink as necessary to fill the height of the editor (no scrolling)."),localize(280,"The minimap will shrink as necessary to never be larger than the editor (no scrolling).")],default:e.size,description:localize(281,"Controls the size of the minimap.")},"editor.minimap.side":{type:"string",enum:["left","right"],default:e.side,description:localize(282,"Controls the side where to render the minimap.")},"editor.minimap.showSlider":{type:"string",enum:["always","mouseover"],default:e.showSlider,description:localize(283,"Controls when the minimap slider is shown.")},"editor.minimap.scale":{type:"number",default:e.scale,minimum:1,maximum:3,enum:[1,2,3],description:localize(284,"Scale of content drawn in the minimap: 1, 2 or 3.")},"editor.minimap.renderCharacters":{type:"boolean",default:e.renderCharacters,description:localize(285,"Render the actual characters on a line as opposed to color blocks.")},"editor.minimap.maxColumn":{type:"number",default:e.maxColumn,description:localize(286,"Limit the width of the minimap to render at most a certain number of columns.")},"editor.minimap.showRegionSectionHeaders":{type:"boolean",default:e.showRegionSectionHeaders,description:localize(287,"Controls whether named regions are shown as section headers in the minimap.")},"editor.minimap.showMarkSectionHeaders":{type:"boolean",default:e.showMarkSectionHeaders,description:localize(288,"Controls whether MARK: comments are shown as section headers in the minimap.")},"editor.minimap.markSectionHeaderRegex":{type:"string",default:e.markSectionHeaderRegex,description:localize(289,"Defines the regular expression used to find section headers in comments. The regex must contain a named match group `label` (written as `(?<label>.+)`) that encapsulates the section header, otherwise it will not work. Optionally you can include another match group named `separator`. Use \\n in the pattern to match multi-line headers.")},"editor.minimap.sectionHeaderFontSize":{type:"number",default:e.sectionHeaderFontSize,description:localize(290,"Controls the font size of section headers in the minimap.")},"editor.minimap.sectionHeaderLetterSpacing":{type:"number",default:e.sectionHeaderLetterSpacing,description:localize(291,"Controls the amount of space (in pixels) between characters of section header. This helps the readability of the header in small font sizes.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;let s=this.defaultValue.markSectionHeaderRegex;const o=e.markSectionHeaderRegex;if(typeof o=="string")try{new RegExp(o,"d"),s=o}catch{}return{enabled:boolean(t.enabled,this.defaultValue.enabled),autohide:stringSet(t.autohide,this.defaultValue.autohide,["none","mouseover","scroll"]),size:stringSet(t.size,this.defaultValue.size,["proportional","fill","fit"]),side:stringSet(t.side,this.defaultValue.side,["right","left"]),showSlider:stringSet(t.showSlider,this.defaultValue.showSlider,["always","mouseover"]),renderCharacters:boolean(t.renderCharacters,this.defaultValue.renderCharacters),scale:EditorIntOption.clampedInt(t.scale,1,1,3),maxColumn:EditorIntOption.clampedInt(t.maxColumn,this.defaultValue.maxColumn,1,1e4),showRegionSectionHeaders:boolean(t.showRegionSectionHeaders,this.defaultValue.showRegionSectionHeaders),showMarkSectionHeaders:boolean(t.showMarkSectionHeaders,this.defaultValue.showMarkSectionHeaders),markSectionHeaderRegex:s,sectionHeaderFontSize:EditorFloatOption.clamp(t.sectionHeaderFontSize??this.defaultValue.sectionHeaderFontSize,4,32),sectionHeaderLetterSpacing:EditorFloatOption.clamp(t.sectionHeaderLetterSpacing??this.defaultValue.sectionHeaderLetterSpacing,0,5)}}}function _multiCursorModifierFromString(a){return a==="ctrlCmd"?isMacintosh?"metaKey":"ctrlKey":"altKey"}class EditorPadding extends BaseEditorOption{constructor(){super(96,"padding",{top:0,bottom:0},{"editor.padding.top":{type:"number",default:0,minimum:0,maximum:1e3,description:localize(292,"Controls the amount of space between the top edge of the editor and the first line.")},"editor.padding.bottom":{type:"number",default:0,minimum:0,maximum:1e3,description:localize(293,"Controls the amount of space between the bottom edge of the editor and the last line.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{top:EditorIntOption.clampedInt(t.top,0,0,1e3),bottom:EditorIntOption.clampedInt(t.bottom,0,0,1e3)}}}class EditorParameterHints extends BaseEditorOption{constructor(){const e={enabled:!0,cycle:!0};super(98,"parameterHints",e,{"editor.parameterHints.enabled":{type:"boolean",default:e.enabled,description:localize(294,"Enables a pop-up that shows parameter documentation and type information as you type.")},"editor.parameterHints.cycle":{type:"boolean",default:e.cycle,description:localize(295,"Controls whether the parameter hints menu cycles or closes when reaching the end of the list.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:boolean(t.enabled,this.defaultValue.enabled),cycle:boolean(t.cycle,this.defaultValue.cycle)}}}class EditorPixelRatio extends ComputedEditorOption{constructor(){super(163)}compute(e,t,s){return e.pixelRatio}}class PlaceholderOption extends BaseEditorOption{constructor(){super(100,"placeholder",void 0)}validate(e){return typeof e>"u"?this.defaultValue:typeof e=="string"?e:this.defaultValue}}class EditorQuickSuggestions extends BaseEditorOption{constructor(){const e={other:"on",comments:"off",strings:"off"},t=[{type:"boolean"},{type:"string",enum:["on","inline","off"],enumDescriptions:[localize(296,"Quick suggestions show inside the suggest widget"),localize(297,"Quick suggestions show as ghost text"),localize(298,"Quick suggestions are disabled")]}];super(102,"quickSuggestions",e,{type:"object",additionalProperties:!1,properties:{strings:{anyOf:t,default:e.strings,description:localize(299,"Enable quick suggestions inside strings.")},comments:{anyOf:t,default:e.comments,description:localize(300,"Enable quick suggestions inside comments.")},other:{anyOf:t,default:e.other,description:localize(301,"Enable quick suggestions outside of strings and comments.")}},default:e,markdownDescription:localize(302,"Controls whether suggestions should automatically show up while typing. This can be controlled for typing in comments, strings, and other code. Quick suggestion can be configured to show as ghost text or with the suggest widget. Also be aware of the {0}-setting which controls if suggestions are triggered by special characters.","`#editor.suggestOnTriggerCharacters#`")}),this.defaultValue=e}validate(e){if(typeof e=="boolean"){const u=e?"on":"off";return{comments:u,strings:u,other:u}}if(!e||typeof e!="object")return this.defaultValue;const{other:t,comments:s,strings:o}=e,r=["on","inline","off"];let l,c,d;return typeof t=="boolean"?l=t?"on":"off":l=stringSet(t,this.defaultValue.other,r),typeof s=="boolean"?c=s?"on":"off":c=stringSet(s,this.defaultValue.comments,r),typeof o=="boolean"?d=o?"on":"off":d=stringSet(o,this.defaultValue.strings,r),{other:l,comments:c,strings:d}}}class EditorRenderLineNumbersOption extends BaseEditorOption{constructor(){super(76,"lineNumbers",{renderType:1,renderFn:null},{type:"string",enum:["off","on","relative","interval"],enumDescriptions:[localize(303,"Line numbers are not rendered."),localize(304,"Line numbers are rendered as absolute number."),localize(305,"Line numbers are rendered as distance in lines to cursor position."),localize(306,"Line numbers are rendered every 10 lines.")],default:"on",description:localize(307,"Controls the display of line numbers.")})}validate(e){let t=this.defaultValue.renderType,s=this.defaultValue.renderFn;return typeof e<"u"&&(typeof e=="function"?(t=4,s=e):e==="interval"?t=3:e==="relative"?t=2:e==="on"?t=1:t=0),{renderType:t,renderFn:s}}}function filterValidationDecorations(a){const e=a.get(112);return e==="editable"?a.get(104):e!=="on"}function filterFontDecorations(a){return!a.get(172)}class EditorRulers extends BaseEditorOption{constructor(){const e=[],t={type:"number",description:localize(308,"Number of monospace characters at which this editor ruler will render.")};super(116,"rulers",e,{type:"array",items:{anyOf:[t,{type:["object"],properties:{column:t,color:{type:"string",description:localize(309,"Color of this editor ruler."),format:"color-hex"}}}]},default:e,description:localize(310,"Render vertical rulers after a certain number of monospace characters. Use multiple values for multiple rulers. No rulers are drawn if array is empty.")})}validate(e){if(Array.isArray(e)){const t=[];for(const s of e)if(typeof s=="number")t.push({column:EditorIntOption.clampedInt(s,0,0,1e4),color:null});else if(s&&typeof s=="object"){const o=s;t.push({column:EditorIntOption.clampedInt(o.column,0,0,1e4),color:o.color})}return t.sort((s,o)=>s.column-o.column),t}return this.defaultValue}}class ReadonlyMessage extends BaseEditorOption{constructor(){super(105,"readOnlyMessage",void 0)}validate(e){return!e||typeof e!="object"?this.defaultValue:e}}function _scrollbarVisibilityFromString(a,e){if(typeof a!="string")return e;switch(a){case"hidden":return 2;case"visible":return 3;default:return 1}}let EditorScrollbar$1=class extends BaseEditorOption{constructor(){const e={vertical:1,horizontal:1,arrowSize:11,useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,horizontalScrollbarSize:12,horizontalSliderSize:12,verticalScrollbarSize:14,verticalSliderSize:14,handleMouseWheel:!0,alwaysConsumeMouseWheel:!0,scrollByPage:!1,ignoreHorizontalScrollbarInContentHeight:!1};super(117,"scrollbar",e,{"editor.scrollbar.vertical":{type:"string",enum:["auto","visible","hidden"],enumDescriptions:[localize(311,"The vertical scrollbar will be visible only when necessary."),localize(312,"The vertical scrollbar will always be visible."),localize(313,"The vertical scrollbar will always be hidden.")],default:"auto",description:localize(314,"Controls the visibility of the vertical scrollbar.")},"editor.scrollbar.horizontal":{type:"string",enum:["auto","visible","hidden"],enumDescriptions:[localize(315,"The horizontal scrollbar will be visible only when necessary."),localize(316,"The horizontal scrollbar will always be visible."),localize(317,"The horizontal scrollbar will always be hidden.")],default:"auto",description:localize(318,"Controls the visibility of the horizontal scrollbar.")},"editor.scrollbar.verticalScrollbarSize":{type:"number",default:e.verticalScrollbarSize,description:localize(319,"The width of the vertical scrollbar.")},"editor.scrollbar.horizontalScrollbarSize":{type:"number",default:e.horizontalScrollbarSize,description:localize(320,"The height of the horizontal scrollbar.")},"editor.scrollbar.scrollByPage":{type:"boolean",default:e.scrollByPage,description:localize(321,"Controls whether clicks scroll by page or jump to click position.")},"editor.scrollbar.ignoreHorizontalScrollbarInContentHeight":{type:"boolean",default:e.ignoreHorizontalScrollbarInContentHeight,description:localize(322,"When set, the horizontal scrollbar will not increase the size of the editor's content.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e,s=EditorIntOption.clampedInt(t.horizontalScrollbarSize,this.defaultValue.horizontalScrollbarSize,0,1e3),o=EditorIntOption.clampedInt(t.verticalScrollbarSize,this.defaultValue.verticalScrollbarSize,0,1e3);return{arrowSize:EditorIntOption.clampedInt(t.arrowSize,this.defaultValue.arrowSize,0,1e3),vertical:_scrollbarVisibilityFromString(t.vertical,this.defaultValue.vertical),horizontal:_scrollbarVisibilityFromString(t.horizontal,this.defaultValue.horizontal),useShadows:boolean(t.useShadows,this.defaultValue.useShadows),verticalHasArrows:boolean(t.verticalHasArrows,this.defaultValue.verticalHasArrows),horizontalHasArrows:boolean(t.horizontalHasArrows,this.defaultValue.horizontalHasArrows),handleMouseWheel:boolean(t.handleMouseWheel,this.defaultValue.handleMouseWheel),alwaysConsumeMouseWheel:boolean(t.alwaysConsumeMouseWheel,this.defaultValue.alwaysConsumeMouseWheel),horizontalScrollbarSize:s,horizontalSliderSize:EditorIntOption.clampedInt(t.horizontalSliderSize,s,0,1e3),verticalScrollbarSize:o,verticalSliderSize:EditorIntOption.clampedInt(t.verticalSliderSize,o,0,1e3),scrollByPage:boolean(t.scrollByPage,this.defaultValue.scrollByPage),ignoreHorizontalScrollbarInContentHeight:boolean(t.ignoreHorizontalScrollbarInContentHeight,this.defaultValue.ignoreHorizontalScrollbarInContentHeight)}}};const inUntrustedWorkspace="inUntrustedWorkspace",unicodeHighlightConfigKeys={allowedCharacters:"editor.unicodeHighlight.allowedCharacters",invisibleCharacters:"editor.unicodeHighlight.invisibleCharacters",nonBasicASCII:"editor.unicodeHighlight.nonBasicASCII",ambiguousCharacters:"editor.unicodeHighlight.ambiguousCharacters",includeComments:"editor.unicodeHighlight.includeComments",includeStrings:"editor.unicodeHighlight.includeStrings",allowedLocales:"editor.unicodeHighlight.allowedLocales"};class UnicodeHighlight extends BaseEditorOption{constructor(){const e={nonBasicASCII:inUntrustedWorkspace,invisibleCharacters:!0,ambiguousCharacters:!0,includeComments:inUntrustedWorkspace,includeStrings:!0,allowedCharacters:{},allowedLocales:{_os:!0,_vscode:!0}};super(142,"unicodeHighlight",e,{[unicodeHighlightConfigKeys.nonBasicASCII]:{restricted:!0,type:["boolean","string"],enum:[!0,!1,inUntrustedWorkspace],default:e.nonBasicASCII,description:localize(323,"Controls whether all non-basic ASCII characters are highlighted. Only characters between U+0020 and U+007E, tab, line-feed and carriage-return are considered basic ASCII.")},[unicodeHighlightConfigKeys.invisibleCharacters]:{restricted:!0,type:"boolean",default:e.invisibleCharacters,description:localize(324,"Controls whether characters that just reserve space or have no width at all are highlighted.")},[unicodeHighlightConfigKeys.ambiguousCharacters]:{restricted:!0,type:"boolean",default:e.ambiguousCharacters,description:localize(325,"Controls whether characters are highlighted that can be confused with basic ASCII characters, except those that are common in the current user locale.")},[unicodeHighlightConfigKeys.includeComments]:{restricted:!0,type:["boolean","string"],enum:[!0,!1,inUntrustedWorkspace],default:e.includeComments,description:localize(326,"Controls whether characters in comments should also be subject to Unicode highlighting.")},[unicodeHighlightConfigKeys.includeStrings]:{restricted:!0,type:["boolean","string"],enum:[!0,!1,inUntrustedWorkspace],default:e.includeStrings,description:localize(327,"Controls whether characters in strings should also be subject to Unicode highlighting.")},[unicodeHighlightConfigKeys.allowedCharacters]:{restricted:!0,type:"object",default:e.allowedCharacters,description:localize(328,"Defines allowed characters that are not being highlighted."),additionalProperties:{type:"boolean"}},[unicodeHighlightConfigKeys.allowedLocales]:{restricted:!0,type:"object",additionalProperties:{type:"boolean"},default:e.allowedLocales,description:localize(329,"Unicode characters that are common in allowed locales are not being highlighted.")}})}applyUpdate(e,t){let s=!1;t.allowedCharacters&&e&&(equals(e.allowedCharacters,t.allowedCharacters)||(e={...e,allowedCharacters:t.allowedCharacters},s=!0)),t.allowedLocales&&e&&(equals(e.allowedLocales,t.allowedLocales)||(e={...e,allowedLocales:t.allowedLocales},s=!0));const o=super.applyUpdate(e,t);return s?new ApplyUpdateResult(o.newValue,!0):o}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{nonBasicASCII:primitiveSet(t.nonBasicASCII,inUntrustedWorkspace,[!0,!1,inUntrustedWorkspace]),invisibleCharacters:boolean(t.invisibleCharacters,this.defaultValue.invisibleCharacters),ambiguousCharacters:boolean(t.ambiguousCharacters,this.defaultValue.ambiguousCharacters),includeComments:primitiveSet(t.includeComments,inUntrustedWorkspace,[!0,!1,inUntrustedWorkspace]),includeStrings:primitiveSet(t.includeStrings,inUntrustedWorkspace,[!0,!1,inUntrustedWorkspace]),allowedCharacters:this.validateBooleanMap(e.allowedCharacters,this.defaultValue.allowedCharacters),allowedLocales:this.validateBooleanMap(e.allowedLocales,this.defaultValue.allowedLocales)}}validateBooleanMap(e,t){if(typeof e!="object"||!e)return t;const s={};for(const[o,r]of Object.entries(e))r===!0&&(s[o]=!0);return s}}class InlineEditorSuggest extends BaseEditorOption{constructor(){const e={enabled:!0,mode:"subwordSmart",showToolbar:"onHover",suppressSuggestions:!1,keepOnBlur:!1,fontFamily:"default",syntaxHighlightingEnabled:!0,minShowDelay:0,suppressInSnippetMode:!1,edits:{enabled:!0,showCollapsed:!1,renderSideBySide:"auto",allowCodeShifting:"always"},triggerCommandOnProviderChange:!0,experimental:{suppressInlineSuggestions:"",showOnSuggestConflict:"never",emptyResponseInformation:!0}};super(71,"inlineSuggest",e,{"editor.inlineSuggest.enabled":{type:"boolean",default:e.enabled,description:localize(330,"Controls whether to automatically show inline suggestions in the editor.")},"editor.inlineSuggest.showToolbar":{type:"string",default:e.showToolbar,enum:["always","onHover","never"],enumDescriptions:[localize(331,"Show the inline suggestion toolbar whenever an inline suggestion is shown."),localize(332,"Show the inline suggestion toolbar when hovering over an inline suggestion."),localize(333,"Never show the inline suggestion toolbar.")],description:localize(334,"Controls when to show the inline suggestion toolbar.")},"editor.inlineSuggest.syntaxHighlightingEnabled":{type:"boolean",default:e.syntaxHighlightingEnabled,description:localize(335,"Controls whether to show syntax highlighting for inline suggestions in the editor.")},"editor.inlineSuggest.suppressSuggestions":{type:"boolean",default:e.suppressSuggestions,description:localize(336,"Controls how inline suggestions interact with the suggest widget. If enabled, the suggest widget is not shown automatically when inline suggestions are available.")},"editor.inlineSuggest.suppressInSnippetMode":{type:"boolean",default:e.suppressInSnippetMode,description:localize(337,"Controls whether inline suggestions are suppressed when in snippet mode.")},"editor.inlineSuggest.minShowDelay":{type:"number",default:0,minimum:0,maximum:1e4,description:localize(338,"Controls the minimal delay in milliseconds after which inline suggestions are shown after typing.")},"editor.inlineSuggest.experimental.suppressInlineSuggestions":{type:"string",default:e.experimental.suppressInlineSuggestions,tags:["experimental"],description:localize(339,"Suppresses inline completions for specified extension IDs -- comma separated."),experiment:{mode:"auto"}},"editor.inlineSuggest.experimental.emptyResponseInformation":{type:"boolean",default:e.experimental.emptyResponseInformation,tags:["experimental"],description:localize(340,"Controls whether to send request information from the inline suggestion provider."),experiment:{mode:"auto"}},"editor.inlineSuggest.triggerCommandOnProviderChange":{type:"boolean",default:e.triggerCommandOnProviderChange,tags:["experimental"],description:localize(341,"Controls whether to trigger a command when the inline suggestion provider changes."),experiment:{mode:"auto"}},"editor.inlineSuggest.experimental.showOnSuggestConflict":{type:"string",default:e.experimental.showOnSuggestConflict,tags:["experimental"],enum:["always","never","whenSuggestListIsIncomplete"],description:localize(342,"Controls whether to show inline suggestions when there is a suggest conflict."),experiment:{mode:"auto"}},"editor.inlineSuggest.fontFamily":{type:"string",default:e.fontFamily,description:localize(343,"Controls the font family of the inline suggestions.")},"editor.inlineSuggest.edits.allowCodeShifting":{type:"string",default:e.edits.allowCodeShifting,description:localize(344,"Controls whether showing a suggestion will shift the code to make space for the suggestion inline."),enum:["always","horizontal","never"],tags:["nextEditSuggestions"]},"editor.inlineSuggest.edits.renderSideBySide":{type:"string",default:e.edits.renderSideBySide,description:localize(345,"Controls whether larger suggestions can be shown side by side."),enum:["auto","never"],enumDescriptions:[localize(346,"Larger suggestions will show side by side if there is enough space, otherwise they will be shown below."),localize(347,"Larger suggestions are never shown side by side and will always be shown below.")],tags:["nextEditSuggestions"]},"editor.inlineSuggest.edits.showCollapsed":{type:"boolean",default:e.edits.showCollapsed,description:localize(348,"Controls whether the suggestion will show as collapsed until jumping to it."),tags:["nextEditSuggestions"]}})}validate(e){var s,o,r,l,c,d,u;if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:boolean(t.enabled,this.defaultValue.enabled),mode:stringSet(t.mode,this.defaultValue.mode,["prefix","subword","subwordSmart"]),showToolbar:stringSet(t.showToolbar,this.defaultValue.showToolbar,["always","onHover","never"]),suppressSuggestions:boolean(t.suppressSuggestions,this.defaultValue.suppressSuggestions),keepOnBlur:boolean(t.keepOnBlur,this.defaultValue.keepOnBlur),fontFamily:EditorStringOption.string(t.fontFamily,this.defaultValue.fontFamily),syntaxHighlightingEnabled:boolean(t.syntaxHighlightingEnabled,this.defaultValue.syntaxHighlightingEnabled),minShowDelay:EditorIntOption.clampedInt(t.minShowDelay,0,0,1e4),suppressInSnippetMode:boolean(t.suppressInSnippetMode,this.defaultValue.suppressInSnippetMode),edits:{enabled:boolean((s=t.edits)==null?void 0:s.enabled,this.defaultValue.edits.enabled),showCollapsed:boolean((o=t.edits)==null?void 0:o.showCollapsed,this.defaultValue.edits.showCollapsed),allowCodeShifting:stringSet((r=t.edits)==null?void 0:r.allowCodeShifting,this.defaultValue.edits.allowCodeShifting,["always","horizontal","never"]),renderSideBySide:stringSet((l=t.edits)==null?void 0:l.renderSideBySide,this.defaultValue.edits.renderSideBySide,["never","auto"])},triggerCommandOnProviderChange:boolean(t.triggerCommandOnProviderChange,this.defaultValue.triggerCommandOnProviderChange),experimental:{suppressInlineSuggestions:EditorStringOption.string((c=t.experimental)==null?void 0:c.suppressInlineSuggestions,this.defaultValue.experimental.suppressInlineSuggestions),showOnSuggestConflict:stringSet((d=t.experimental)==null?void 0:d.showOnSuggestConflict,this.defaultValue.experimental.showOnSuggestConflict,["always","never","whenSuggestListIsIncomplete"]),emptyResponseInformation:boolean((u=t.experimental)==null?void 0:u.emptyResponseInformation,this.defaultValue.experimental.emptyResponseInformation)}}}}class BracketPairColorization extends BaseEditorOption{constructor(){const e={enabled:EDITOR_MODEL_DEFAULTS.bracketPairColorizationOptions.enabled,independentColorPoolPerBracketType:EDITOR_MODEL_DEFAULTS.bracketPairColorizationOptions.independentColorPoolPerBracketType};super(21,"bracketPairColorization",e,{"editor.bracketPairColorization.enabled":{type:"boolean",default:e.enabled,markdownDescription:localize(349,"Controls whether bracket pair colorization is enabled or not. Use {0} to override the bracket highlight colors.","`#workbench.colorCustomizations#`")},"editor.bracketPairColorization.independentColorPoolPerBracketType":{type:"boolean",default:e.independentColorPoolPerBracketType,description:localize(350,"Controls whether each bracket type has its own independent color pool.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:boolean(t.enabled,this.defaultValue.enabled),independentColorPoolPerBracketType:boolean(t.independentColorPoolPerBracketType,this.defaultValue.independentColorPoolPerBracketType)}}}class GuideOptions extends BaseEditorOption{constructor(){const e={bracketPairs:!1,bracketPairsHorizontal:"active",highlightActiveBracketPair:!0,indentation:!0,highlightActiveIndentation:!0};super(22,"guides",e,{"editor.guides.bracketPairs":{type:["boolean","string"],enum:[!0,"active",!1],enumDescriptions:[localize(351,"Enables bracket pair guides."),localize(352,"Enables bracket pair guides only for the active bracket pair."),localize(353,"Disables bracket pair guides.")],default:e.bracketPairs,description:localize(354,"Controls whether bracket pair guides are enabled or not.")},"editor.guides.bracketPairsHorizontal":{type:["boolean","string"],enum:[!0,"active",!1],enumDescriptions:[localize(355,"Enables horizontal guides as addition to vertical bracket pair guides."),localize(356,"Enables horizontal guides only for the active bracket pair."),localize(357,"Disables horizontal bracket pair guides.")],default:e.bracketPairsHorizontal,description:localize(358,"Controls whether horizontal bracket pair guides are enabled or not.")},"editor.guides.highlightActiveBracketPair":{type:"boolean",default:e.highlightActiveBracketPair,description:localize(359,"Controls whether the editor should highlight the active bracket pair.")},"editor.guides.indentation":{type:"boolean",default:e.indentation,description:localize(360,"Controls whether the editor should render indent guides.")},"editor.guides.highlightActiveIndentation":{type:["boolean","string"],enum:[!0,"always",!1],enumDescriptions:[localize(361,"Highlights the active indent guide."),localize(362,"Highlights the active indent guide even if bracket guides are highlighted."),localize(363,"Do not highlight the active indent guide.")],default:e.highlightActiveIndentation,description:localize(364,"Controls whether the editor should highlight the active indent guide.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{bracketPairs:primitiveSet(t.bracketPairs,this.defaultValue.bracketPairs,[!0,!1,"active"]),bracketPairsHorizontal:primitiveSet(t.bracketPairsHorizontal,this.defaultValue.bracketPairsHorizontal,[!0,!1,"active"]),highlightActiveBracketPair:boolean(t.highlightActiveBracketPair,this.defaultValue.highlightActiveBracketPair),indentation:boolean(t.indentation,this.defaultValue.indentation),highlightActiveIndentation:primitiveSet(t.highlightActiveIndentation,this.defaultValue.highlightActiveIndentation,[!0,!1,"always"])}}}function primitiveSet(a,e,t){const s=t.indexOf(a);return s===-1?e:t[s]}class EditorSuggest extends BaseEditorOption{constructor(){const e={insertMode:"insert",filterGraceful:!0,snippetsPreventQuickSuggestions:!1,localityBonus:!1,shareSuggestSelections:!1,selectionMode:"always",showIcons:!0,showStatusBar:!1,preview:!1,previewMode:"subwordSmart",showInlineDetails:!0,showMethods:!0,showFunctions:!0,showConstructors:!0,showDeprecated:!0,matchOnWordStartOnly:!0,showFields:!0,showVariables:!0,showClasses:!0,showStructs:!0,showInterfaces:!0,showModules:!0,showProperties:!0,showEvents:!0,showOperators:!0,showUnits:!0,showValues:!0,showConstants:!0,showEnums:!0,showEnumMembers:!0,showKeywords:!0,showWords:!0,showColors:!0,showFiles:!0,showReferences:!0,showFolders:!0,showTypeParameters:!0,showSnippets:!0,showUsers:!0,showIssues:!0};super(134,"suggest",e,{"editor.suggest.insertMode":{type:"string",enum:["insert","replace"],enumDescriptions:[localize(365,"Insert suggestion without overwriting text right of the cursor."),localize(366,"Insert suggestion and overwrite text right of the cursor.")],default:e.insertMode,description:localize(367,"Controls whether words are overwritten when accepting completions. Note that this depends on extensions opting into this feature.")},"editor.suggest.filterGraceful":{type:"boolean",default:e.filterGraceful,description:localize(368,"Controls whether filtering and sorting suggestions accounts for small typos.")},"editor.suggest.localityBonus":{type:"boolean",default:e.localityBonus,description:localize(369,"Controls whether sorting favors words that appear close to the cursor.")},"editor.suggest.shareSuggestSelections":{type:"boolean",default:e.shareSuggestSelections,markdownDescription:localize(370,"Controls whether remembered suggestion selections are shared between multiple workspaces and windows (needs `#editor.suggestSelection#`).")},"editor.suggest.selectionMode":{type:"string",enum:["always","never","whenTriggerCharacter","whenQuickSuggestion"],enumDescriptions:[localize(371,"Always select a suggestion when automatically triggering IntelliSense."),localize(372,"Never select a suggestion when automatically triggering IntelliSense."),localize(373,"Select a suggestion only when triggering IntelliSense from a trigger character."),localize(374,"Select a suggestion only when triggering IntelliSense as you type.")],default:e.selectionMode,markdownDescription:localize(375,"Controls whether a suggestion is selected when the widget shows. Note that this only applies to automatically triggered suggestions ({0} and {1}) and that a suggestion is always selected when explicitly invoked, e.g via `Ctrl+Space`.","`#editor.quickSuggestions#`","`#editor.suggestOnTriggerCharacters#`")},"editor.suggest.snippetsPreventQuickSuggestions":{type:"boolean",default:e.snippetsPreventQuickSuggestions,description:localize(376,"Controls whether an active snippet prevents quick suggestions.")},"editor.suggest.showIcons":{type:"boolean",default:e.showIcons,description:localize(377,"Controls whether to show or hide icons in suggestions.")},"editor.suggest.showStatusBar":{type:"boolean",default:e.showStatusBar,description:localize(378,"Controls the visibility of the status bar at the bottom of the suggest widget.")},"editor.suggest.preview":{type:"boolean",default:e.preview,description:localize(379,"Controls whether to preview the suggestion outcome in the editor.")},"editor.suggest.showInlineDetails":{type:"boolean",default:e.showInlineDetails,description:localize(380,"Controls whether suggest details show inline with the label or only in the details widget.")},"editor.suggest.maxVisibleSuggestions":{type:"number",deprecationMessage:localize(381,"This setting is deprecated. The suggest widget can now be resized.")},"editor.suggest.filteredTypes":{type:"object",deprecationMessage:localize(382,"This setting is deprecated, please use separate settings like 'editor.suggest.showKeywords' or 'editor.suggest.showSnippets' instead.")},"editor.suggest.showMethods":{type:"boolean",default:!0,markdownDescription:localize(383,"When enabled IntelliSense shows `method`-suggestions.")},"editor.suggest.showFunctions":{type:"boolean",default:!0,markdownDescription:localize(384,"When enabled IntelliSense shows `function`-suggestions.")},"editor.suggest.showConstructors":{type:"boolean",default:!0,markdownDescription:localize(385,"When enabled IntelliSense shows `constructor`-suggestions.")},"editor.suggest.showDeprecated":{type:"boolean",default:!0,markdownDescription:localize(386,"When enabled IntelliSense shows `deprecated`-suggestions.")},"editor.suggest.matchOnWordStartOnly":{type:"boolean",default:!0,markdownDescription:localize(387,"When enabled IntelliSense filtering requires that the first character matches on a word start. For example, `c` on `Console` or `WebContext` but _not_ on `description`. When disabled IntelliSense will show more results but still sorts them by match quality.")},"editor.suggest.showFields":{type:"boolean",default:!0,markdownDescription:localize(388,"When enabled IntelliSense shows `field`-suggestions.")},"editor.suggest.showVariables":{type:"boolean",default:!0,markdownDescription:localize(389,"When enabled IntelliSense shows `variable`-suggestions.")},"editor.suggest.showClasses":{type:"boolean",default:!0,markdownDescription:localize(390,"When enabled IntelliSense shows `class`-suggestions.")},"editor.suggest.showStructs":{type:"boolean",default:!0,markdownDescription:localize(391,"When enabled IntelliSense shows `struct`-suggestions.")},"editor.suggest.showInterfaces":{type:"boolean",default:!0,markdownDescription:localize(392,"When enabled IntelliSense shows `interface`-suggestions.")},"editor.suggest.showModules":{type:"boolean",default:!0,markdownDescription:localize(393,"When enabled IntelliSense shows `module`-suggestions.")},"editor.suggest.showProperties":{type:"boolean",default:!0,markdownDescription:localize(394,"When enabled IntelliSense shows `property`-suggestions.")},"editor.suggest.showEvents":{type:"boolean",default:!0,markdownDescription:localize(395,"When enabled IntelliSense shows `event`-suggestions.")},"editor.suggest.showOperators":{type:"boolean",default:!0,markdownDescription:localize(396,"When enabled IntelliSense shows `operator`-suggestions.")},"editor.suggest.showUnits":{type:"boolean",default:!0,markdownDescription:localize(397,"When enabled IntelliSense shows `unit`-suggestions.")},"editor.suggest.showValues":{type:"boolean",default:!0,markdownDescription:localize(398,"When enabled IntelliSense shows `value`-suggestions.")},"editor.suggest.showConstants":{type:"boolean",default:!0,markdownDescription:localize(399,"When enabled IntelliSense shows `constant`-suggestions.")},"editor.suggest.showEnums":{type:"boolean",default:!0,markdownDescription:localize(400,"When enabled IntelliSense shows `enum`-suggestions.")},"editor.suggest.showEnumMembers":{type:"boolean",default:!0,markdownDescription:localize(401,"When enabled IntelliSense shows `enumMember`-suggestions.")},"editor.suggest.showKeywords":{type:"boolean",default:!0,markdownDescription:localize(402,"When enabled IntelliSense shows `keyword`-suggestions.")},"editor.suggest.showWords":{type:"boolean",default:!0,markdownDescription:localize(403,"When enabled IntelliSense shows `text`-suggestions.")},"editor.suggest.showColors":{type:"boolean",default:!0,markdownDescription:localize(404,"When enabled IntelliSense shows `color`-suggestions.")},"editor.suggest.showFiles":{type:"boolean",default:!0,markdownDescription:localize(405,"When enabled IntelliSense shows `file`-suggestions.")},"editor.suggest.showReferences":{type:"boolean",default:!0,markdownDescription:localize(406,"When enabled IntelliSense shows `reference`-suggestions.")},"editor.suggest.showCustomcolors":{type:"boolean",default:!0,markdownDescription:localize(407,"When enabled IntelliSense shows `customcolor`-suggestions.")},"editor.suggest.showFolders":{type:"boolean",default:!0,markdownDescription:localize(408,"When enabled IntelliSense shows `folder`-suggestions.")},"editor.suggest.showTypeParameters":{type:"boolean",default:!0,markdownDescription:localize(409,"When enabled IntelliSense shows `typeParameter`-suggestions.")},"editor.suggest.showSnippets":{type:"boolean",default:!0,markdownDescription:localize(410,"When enabled IntelliSense shows `snippet`-suggestions.")},"editor.suggest.showUsers":{type:"boolean",default:!0,markdownDescription:localize(411,"When enabled IntelliSense shows `user`-suggestions.")},"editor.suggest.showIssues":{type:"boolean",default:!0,markdownDescription:localize(412,"When enabled IntelliSense shows `issues`-suggestions.")}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{insertMode:stringSet(t.insertMode,this.defaultValue.insertMode,["insert","replace"]),filterGraceful:boolean(t.filterGraceful,this.defaultValue.filterGraceful),snippetsPreventQuickSuggestions:boolean(t.snippetsPreventQuickSuggestions,this.defaultValue.filterGraceful),localityBonus:boolean(t.localityBonus,this.defaultValue.localityBonus),shareSuggestSelections:boolean(t.shareSuggestSelections,this.defaultValue.shareSuggestSelections),selectionMode:stringSet(t.selectionMode,this.defaultValue.selectionMode,["always","never","whenQuickSuggestion","whenTriggerCharacter"]),showIcons:boolean(t.showIcons,this.defaultValue.showIcons),showStatusBar:boolean(t.showStatusBar,this.defaultValue.showStatusBar),preview:boolean(t.preview,this.defaultValue.preview),previewMode:stringSet(t.previewMode,this.defaultValue.previewMode,["prefix","subword","subwordSmart"]),showInlineDetails:boolean(t.showInlineDetails,this.defaultValue.showInlineDetails),showMethods:boolean(t.showMethods,this.defaultValue.showMethods),showFunctions:boolean(t.showFunctions,this.defaultValue.showFunctions),showConstructors:boolean(t.showConstructors,this.defaultValue.showConstructors),showDeprecated:boolean(t.showDeprecated,this.defaultValue.showDeprecated),matchOnWordStartOnly:boolean(t.matchOnWordStartOnly,this.defaultValue.matchOnWordStartOnly),showFields:boolean(t.showFields,this.defaultValue.showFields),showVariables:boolean(t.showVariables,this.defaultValue.showVariables),showClasses:boolean(t.showClasses,this.defaultValue.showClasses),showStructs:boolean(t.showStructs,this.defaultValue.showStructs),showInterfaces:boolean(t.showInterfaces,this.defaultValue.showInterfaces),showModules:boolean(t.showModules,this.defaultValue.showModules),showProperties:boolean(t.showProperties,this.defaultValue.showProperties),showEvents:boolean(t.showEvents,this.defaultValue.showEvents),showOperators:boolean(t.showOperators,this.defaultValue.showOperators),showUnits:boolean(t.showUnits,this.defaultValue.showUnits),showValues:boolean(t.showValues,this.defaultValue.showValues),showConstants:boolean(t.showConstants,this.defaultValue.showConstants),showEnums:boolean(t.showEnums,this.defaultValue.showEnums),showEnumMembers:boolean(t.showEnumMembers,this.defaultValue.showEnumMembers),showKeywords:boolean(t.showKeywords,this.defaultValue.showKeywords),showWords:boolean(t.showWords,this.defaultValue.showWords),showColors:boolean(t.showColors,this.defaultValue.showColors),showFiles:boolean(t.showFiles,this.defaultValue.showFiles),showReferences:boolean(t.showReferences,this.defaultValue.showReferences),showFolders:boolean(t.showFolders,this.defaultValue.showFolders),showTypeParameters:boolean(t.showTypeParameters,this.defaultValue.showTypeParameters),showSnippets:boolean(t.showSnippets,this.defaultValue.showSnippets),showUsers:boolean(t.showUsers,this.defaultValue.showUsers),showIssues:boolean(t.showIssues,this.defaultValue.showIssues)}}}class SmartSelect extends BaseEditorOption{constructor(){super(129,"smartSelect",{selectLeadingAndTrailingWhitespace:!0,selectSubwords:!0},{"editor.smartSelect.selectLeadingAndTrailingWhitespace":{description:localize(413,"Whether leading and trailing whitespace should always be selected."),default:!0,type:"boolean"},"editor.smartSelect.selectSubwords":{description:localize(414,"Whether subwords (like 'foo' in 'fooBar' or 'foo_bar') should be selected."),default:!0,type:"boolean"}})}validate(e){return!e||typeof e!="object"?this.defaultValue:{selectLeadingAndTrailingWhitespace:boolean(e.selectLeadingAndTrailingWhitespace,this.defaultValue.selectLeadingAndTrailingWhitespace),selectSubwords:boolean(e.selectSubwords,this.defaultValue.selectSubwords)}}}class WordSegmenterLocales extends BaseEditorOption{constructor(){const e=[];super(147,"wordSegmenterLocales",e,{anyOf:[{type:"string"},{type:"array",items:{type:"string"}}],description:localize(415,"Locales to be used for word segmentation when doing word related navigations or operations. Specify the BCP 47 language tag of the word you wish to recognize (e.g., ja, zh-CN, zh-Hant-TW, etc.)."),type:"array",items:{type:"string"},default:e})}validate(e){if(typeof e=="string"&&(e=[e]),Array.isArray(e)){const t=[];for(const s of e)if(typeof s=="string")try{Intl.Segmenter.supportedLocalesOf(s).length>0&&t.push(s)}catch{}return t}return this.defaultValue}}class WrappingIndentOption extends BaseEditorOption{constructor(){super(155,"wrappingIndent",1,{"editor.wrappingIndent":{type:"string",enum:["none","same","indent","deepIndent"],enumDescriptions:[localize(416,"No indentation. Wrapped lines begin at column 1."),localize(417,"Wrapped lines get the same indentation as the parent."),localize(418,"Wrapped lines get +1 indentation toward the parent."),localize(419,"Wrapped lines get +2 indentation toward the parent.")],description:localize(420,"Controls the indentation of wrapped lines."),default:"same"}})}validate(e){switch(e){case"none":return 0;case"same":return 1;case"indent":return 2;case"deepIndent":return 3}return 1}compute(e,t,s){return t.get(2)===2?0:s}}class EditorWrappingInfoComputer extends ComputedEditorOption{constructor(){super(166)}compute(e,t,s){const o=t.get(165);return{isDominatedByLongLines:e.isDominatedByLongLines,isWordWrapMinified:o.isWordWrapMinified,isViewportWrapping:o.isViewportWrapping,wrappingColumn:o.wrappingColumn}}}class EditorDropIntoEditor extends BaseEditorOption{constructor(){const e={enabled:!0,showDropSelector:"afterDrop"};super(43,"dropIntoEditor",e,{"editor.dropIntoEditor.enabled":{type:"boolean",default:e.enabled,markdownDescription:localize(421,"Controls whether you can drag and drop a file into a text editor by holding down the `Shift` key (instead of opening the file in an editor).")},"editor.dropIntoEditor.showDropSelector":{type:"string",markdownDescription:localize(422,"Controls if a widget is shown when dropping files into the editor. This widget lets you control how the file is dropped."),enum:["afterDrop","never"],enumDescriptions:[localize(423,"Show the drop selector widget after a file is dropped into the editor."),localize(424,"Never show the drop selector widget. Instead the default drop provider is always used.")],default:"afterDrop"}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:boolean(t.enabled,this.defaultValue.enabled),showDropSelector:stringSet(t.showDropSelector,this.defaultValue.showDropSelector,["afterDrop","never"])}}}class EditorPasteAs extends BaseEditorOption{constructor(){const e={enabled:!0,showPasteSelector:"afterPaste"};super(97,"pasteAs",e,{"editor.pasteAs.enabled":{type:"boolean",default:e.enabled,markdownDescription:localize(425,"Controls whether you can paste content in different ways.")},"editor.pasteAs.showPasteSelector":{type:"string",markdownDescription:localize(426,"Controls if a widget is shown when pasting content in to the editor. This widget lets you control how the file is pasted."),enum:["afterPaste","never"],enumDescriptions:[localize(427,"Show the paste selector widget after content is pasted into the editor."),localize(428,"Never show the paste selector widget. Instead the default pasting behavior is always used.")],default:"afterPaste"}})}validate(e){if(!e||typeof e!="object")return this.defaultValue;const t=e;return{enabled:boolean(t.enabled,this.defaultValue.enabled),showPasteSelector:stringSet(t.showPasteSelector,this.defaultValue.showPasteSelector,["afterPaste","never"])}}}const DEFAULT_WINDOWS_FONT_FAMILY="Consolas, 'Courier New', monospace",DEFAULT_MAC_FONT_FAMILY="Menlo, Monaco, 'Courier New', monospace",DEFAULT_LINUX_FONT_FAMILY="'Droid Sans Mono', 'monospace', monospace",EDITOR_FONT_DEFAULTS={fontFamily:isMacintosh?DEFAULT_MAC_FONT_FAMILY:isWindows?DEFAULT_WINDOWS_FONT_FAMILY:DEFAULT_LINUX_FONT_FAMILY,fontWeight:"normal",fontSize:isMacintosh?12:14,lineHeight:0,letterSpacing:0},editorOptionsRegistry=[];function register$1(a){return editorOptionsRegistry[a.id]=a,a}const EditorOptions={acceptSuggestionOnCommitCharacter:register$1(new EditorBooleanOption(0,"acceptSuggestionOnCommitCharacter",!0,{markdownDescription:localize(429,"Controls whether suggestions should be accepted on commit characters. For example, in JavaScript, the semi-colon (`;`) can be a commit character that accepts a suggestion and types that character.")})),acceptSuggestionOnEnter:register$1(new EditorStringEnumOption(1,"acceptSuggestionOnEnter","on",["on","smart","off"],{markdownEnumDescriptions:["",localize(430,"Only accept a suggestion with `Enter` when it makes a textual change."),""],markdownDescription:localize(431,"Controls whether suggestions should be accepted on `Enter`, in addition to `Tab`. Helps to avoid ambiguity between inserting new lines or accepting suggestions.")})),accessibilitySupport:register$1(new EditorAccessibilitySupport),accessibilityPageSize:register$1(new EditorIntOption(3,"accessibilityPageSize",500,1,1073741824,{description:localize(432,"Controls the number of lines in the editor that can be read out by a screen reader at once. When we detect a screen reader we automatically set the default to be 500. Warning: this has a performance implication for numbers larger than the default."),tags:["accessibility"]})),allowOverflow:register$1(new EditorBooleanOption(4,"allowOverflow",!0)),allowVariableLineHeights:register$1(new EditorBooleanOption(5,"allowVariableLineHeights",!0,{description:localize(433,"Controls whether to allow using variable line heights in the editor.")})),allowVariableFonts:register$1(new EditorBooleanOption(6,"allowVariableFonts",!0,{description:localize(434,"Controls whether to allow using variable fonts in the editor.")})),allowVariableFontsInAccessibilityMode:register$1(new EditorBooleanOption(7,"allowVariableFontsInAccessibilityMode",!1,{description:localize(435,"Controls whether to allow using variable fonts in the editor in the accessibility mode."),tags:["accessibility"]})),ariaLabel:register$1(new EditorStringOption(8,"ariaLabel",localize(436,"Editor content"))),ariaRequired:register$1(new EditorBooleanOption(9,"ariaRequired",!1,void 0)),screenReaderAnnounceInlineSuggestion:register$1(new EditorBooleanOption(12,"screenReaderAnnounceInlineSuggestion",!0,{description:localize(437,"Control whether inline suggestions are announced by a screen reader."),tags:["accessibility"]})),autoClosingBrackets:register$1(new EditorStringEnumOption(10,"autoClosingBrackets","languageDefined",["always","languageDefined","beforeWhitespace","never"],{enumDescriptions:["",localize(438,"Use language configurations to determine when to autoclose brackets."),localize(439,"Autoclose brackets only when the cursor is to the left of whitespace."),""],description:localize(440,"Controls whether the editor should automatically close brackets after the user adds an opening bracket.")})),autoClosingComments:register$1(new EditorStringEnumOption(11,"autoClosingComments","languageDefined",["always","languageDefined","beforeWhitespace","never"],{enumDescriptions:["",localize(441,"Use language configurations to determine when to autoclose comments."),localize(442,"Autoclose comments only when the cursor is to the left of whitespace."),""],description:localize(443,"Controls whether the editor should automatically close comments after the user adds an opening comment.")})),autoClosingDelete:register$1(new EditorStringEnumOption(13,"autoClosingDelete","auto",["always","auto","never"],{enumDescriptions:["",localize(444,"Remove adjacent closing quotes or brackets only if they were automatically inserted."),""],description:localize(445,"Controls whether the editor should remove adjacent closing quotes or brackets when deleting.")})),autoClosingOvertype:register$1(new EditorStringEnumOption(14,"autoClosingOvertype","auto",["always","auto","never"],{enumDescriptions:["",localize(446,"Type over closing quotes or brackets only if they were automatically inserted."),""],description:localize(447,"Controls whether the editor should type over closing quotes or brackets.")})),autoClosingQuotes:register$1(new EditorStringEnumOption(15,"autoClosingQuotes","languageDefined",["always","languageDefined","beforeWhitespace","never"],{enumDescriptions:["",localize(448,"Use language configurations to determine when to autoclose quotes."),localize(449,"Autoclose quotes only when the cursor is to the left of whitespace."),""],description:localize(450,"Controls whether the editor should automatically close quotes after the user adds an opening quote.")})),autoIndent:register$1(new EditorEnumOption(16,"autoIndent",4,"full",["none","keep","brackets","advanced","full"],_autoIndentFromString,{enumDescriptions:[localize(451,"The editor will not insert indentation automatically."),localize(452,"The editor will keep the current line's indentation."),localize(453,"The editor will keep the current line's indentation and honor language defined brackets."),localize(454,"The editor will keep the current line's indentation, honor language defined brackets and invoke special onEnterRules defined by languages."),localize(455,"The editor will keep the current line's indentation, honor language defined brackets, invoke special onEnterRules defined by languages, and honor indentationRules defined by languages.")],description:localize(456,"Controls whether the editor should automatically adjust the indentation when users type, paste, move or indent lines.")})),autoIndentOnPaste:register$1(new EditorBooleanOption(17,"autoIndentOnPaste",!1,{description:localize(457,"Controls whether the editor should automatically auto-indent the pasted content.")})),autoIndentOnPasteWithinString:register$1(new EditorBooleanOption(18,"autoIndentOnPasteWithinString",!0,{description:localize(458,"Controls whether the editor should automatically auto-indent the pasted content when pasted within a string. This takes effect when autoIndentOnPaste is true.")})),automaticLayout:register$1(new EditorBooleanOption(19,"automaticLayout",!1)),autoSurround:register$1(new EditorStringEnumOption(20,"autoSurround","languageDefined",["languageDefined","quotes","brackets","never"],{enumDescriptions:[localize(459,"Use language configurations to determine when to automatically surround selections."),localize(460,"Surround with quotes but not brackets."),localize(461,"Surround with brackets but not quotes."),""],description:localize(462,"Controls whether the editor should automatically surround selections when typing quotes or brackets.")})),bracketPairColorization:register$1(new BracketPairColorization),bracketPairGuides:register$1(new GuideOptions),stickyTabStops:register$1(new EditorBooleanOption(132,"stickyTabStops",!1,{description:localize(463,"Emulate selection behavior of tab characters when using spaces for indentation. Selection will stick to tab stops.")})),codeLens:register$1(new EditorBooleanOption(23,"codeLens",!0,{description:localize(464,"Controls whether the editor shows CodeLens.")})),codeLensFontFamily:register$1(new EditorStringOption(24,"codeLensFontFamily","",{description:localize(465,"Controls the font family for CodeLens.")})),codeLensFontSize:register$1(new EditorIntOption(25,"codeLensFontSize",0,0,100,{type:"number",default:0,minimum:0,maximum:100,markdownDescription:localize(466,"Controls the font size in pixels for CodeLens. When set to 0, 90% of `#editor.fontSize#` is used.")})),colorDecorators:register$1(new EditorBooleanOption(26,"colorDecorators",!0,{description:localize(467,"Controls whether the editor should render the inline color decorators and color picker.")})),colorDecoratorActivatedOn:register$1(new EditorStringEnumOption(168,"colorDecoratorsActivatedOn","clickAndHover",["clickAndHover","hover","click"],{enumDescriptions:[localize(468,"Make the color picker appear both on click and hover of the color decorator"),localize(469,"Make the color picker appear on hover of the color decorator"),localize(470,"Make the color picker appear on click of the color decorator")],description:localize(471,"Controls the condition to make a color picker appear from a color decorator.")})),colorDecoratorsLimit:register$1(new EditorIntOption(27,"colorDecoratorsLimit",500,1,1e6,{markdownDescription:localize(472,"Controls the max number of color decorators that can be rendered in an editor at once.")})),columnSelection:register$1(new EditorBooleanOption(28,"columnSelection",!1,{description:localize(473,"Enable that the selection with the mouse and keys is doing column selection.")})),comments:register$1(new EditorComments),contextmenu:register$1(new EditorBooleanOption(30,"contextmenu",!0)),copyWithSyntaxHighlighting:register$1(new EditorBooleanOption(31,"copyWithSyntaxHighlighting",!0,{description:localize(474,"Controls whether syntax highlighting should be copied into the clipboard.")})),cursorBlinking:register$1(new EditorEnumOption(32,"cursorBlinking",1,"blink",["blink","smooth","phase","expand","solid"],cursorBlinkingStyleFromString,{description:localize(475,"Control the cursor animation style.")})),cursorSmoothCaretAnimation:register$1(new EditorStringEnumOption(33,"cursorSmoothCaretAnimation","off",["off","explicit","on"],{enumDescriptions:[localize(476,"Smooth caret animation is disabled."),localize(477,"Smooth caret animation is enabled only when the user moves the cursor with an explicit gesture."),localize(478,"Smooth caret animation is always enabled.")],description:localize(479,"Controls whether the smooth caret animation should be enabled.")})),cursorStyle:register$1(new EditorEnumOption(34,"cursorStyle",TextEditorCursorStyle$1.Line,"line",["line","block","underline","line-thin","block-outline","underline-thin"],cursorStyleFromString,{description:localize(480,"Controls the cursor style in insert input mode.")})),overtypeCursorStyle:register$1(new EditorEnumOption(92,"overtypeCursorStyle",TextEditorCursorStyle$1.Block,"block",["line","block","underline","line-thin","block-outline","underline-thin"],cursorStyleFromString,{description:localize(481,"Controls the cursor style in overtype input mode.")})),cursorSurroundingLines:register$1(new EditorIntOption(35,"cursorSurroundingLines",0,0,1073741824,{description:localize(482,"Controls the minimal number of visible leading lines (minimum 0) and trailing lines (minimum 1) surrounding the cursor. Known as 'scrollOff' or 'scrollOffset' in some other editors.")})),cursorSurroundingLinesStyle:register$1(new EditorStringEnumOption(36,"cursorSurroundingLinesStyle","default",["default","all"],{enumDescriptions:[localize(483,"`cursorSurroundingLines` is enforced only when triggered via the keyboard or API."),localize(484,"`cursorSurroundingLines` is enforced always.")],markdownDescription:localize(485,"Controls when `#editor.cursorSurroundingLines#` should be enforced.")})),cursorWidth:register$1(new EditorIntOption(37,"cursorWidth",0,0,1073741824,{markdownDescription:localize(486,"Controls the width of the cursor when `#editor.cursorStyle#` is set to `line`.")})),cursorHeight:register$1(new EditorIntOption(38,"cursorHeight",0,0,1073741824,{markdownDescription:localize(487,"Controls the height of the cursor when `#editor.cursorStyle#` is set to `line`. Cursor's max height depends on line height.")})),disableLayerHinting:register$1(new EditorBooleanOption(39,"disableLayerHinting",!1)),disableMonospaceOptimizations:register$1(new EditorBooleanOption(40,"disableMonospaceOptimizations",!1)),domReadOnly:register$1(new EditorBooleanOption(41,"domReadOnly",!1)),dragAndDrop:register$1(new EditorBooleanOption(42,"dragAndDrop",!0,{description:localize(488,"Controls whether the editor should allow moving selections via drag and drop.")})),emptySelectionClipboard:register$1(new EditorEmptySelectionClipboard),dropIntoEditor:register$1(new EditorDropIntoEditor),editContext:register$1(new EditorBooleanOption(44,"editContext",!0,{description:localize(489,"Sets whether the EditContext API should be used instead of the text area to power input in the editor."),included:isChrome||isEdge||isNative})),renderRichScreenReaderContent:register$1(new EditorBooleanOption(107,"renderRichScreenReaderContent",!1,{markdownDescription:localize(490,"Whether to render rich screen reader content when the `#editor.editContext#` setting is enabled.")})),stickyScroll:register$1(new EditorStickyScroll),experimentalGpuAcceleration:register$1(new EditorStringEnumOption(46,"experimentalGpuAcceleration","off",["off","on"],{tags:["experimental"],enumDescriptions:[localize(491,"Use regular DOM-based rendering."),localize(492,"Use GPU acceleration.")],description:localize(493,"Controls whether to use the experimental GPU acceleration to render the editor.")})),experimentalWhitespaceRendering:register$1(new EditorStringEnumOption(47,"experimentalWhitespaceRendering","svg",["svg","font","off"],{enumDescriptions:[localize(494,"Use a new rendering method with svgs."),localize(495,"Use a new rendering method with font characters."),localize(496,"Use the stable rendering method.")],description:localize(497,"Controls whether whitespace is rendered with a new, experimental method.")})),extraEditorClassName:register$1(new EditorStringOption(48,"extraEditorClassName","")),fastScrollSensitivity:register$1(new EditorFloatOption(49,"fastScrollSensitivity",5,a=>a<=0?5:a,{markdownDescription:localize(498,"Scrolling speed multiplier when pressing `Alt`.")})),find:register$1(new EditorFind),fixedOverflowWidgets:register$1(new EditorBooleanOption(51,"fixedOverflowWidgets",!1)),folding:register$1(new EditorBooleanOption(52,"folding",!0,{description:localize(499,"Controls whether the editor has code folding enabled.")})),foldingStrategy:register$1(new EditorStringEnumOption(53,"foldingStrategy","auto",["auto","indentation"],{enumDescriptions:[localize(500,"Use a language-specific folding strategy if available, else the indentation-based one."),localize(501,"Use the indentation-based folding strategy.")],description:localize(502,"Controls the strategy for computing folding ranges.")})),foldingHighlight:register$1(new EditorBooleanOption(54,"foldingHighlight",!0,{description:localize(503,"Controls whether the editor should highlight folded ranges.")})),foldingImportsByDefault:register$1(new EditorBooleanOption(55,"foldingImportsByDefault",!1,{description:localize(504,"Controls whether the editor automatically collapses import ranges.")})),foldingMaximumRegions:register$1(new EditorIntOption(56,"foldingMaximumRegions",5e3,10,65e3,{description:localize(505,"The maximum number of foldable regions. Increasing this value may result in the editor becoming less responsive when the current source has a large number of foldable regions.")})),unfoldOnClickAfterEndOfLine:register$1(new EditorBooleanOption(57,"unfoldOnClickAfterEndOfLine",!1,{description:localize(506,"Controls whether clicking on the empty content after a folded line will unfold the line.")})),fontFamily:register$1(new EditorStringOption(58,"fontFamily",EDITOR_FONT_DEFAULTS.fontFamily,{description:localize(507,"Controls the font family.")})),fontInfo:register$1(new EditorFontInfo),fontLigatures2:register$1(new EditorFontLigatures),fontSize:register$1(new EditorFontSize),fontWeight:register$1(new EditorFontWeight),fontVariations:register$1(new EditorFontVariations),formatOnPaste:register$1(new EditorBooleanOption(64,"formatOnPaste",!1,{description:localize(508,"Controls whether the editor should automatically format the pasted content. A formatter must be available and the formatter should be able to format a range in a document.")})),formatOnType:register$1(new EditorBooleanOption(65,"formatOnType",!1,{description:localize(509,"Controls whether the editor should automatically format the line after typing.")})),glyphMargin:register$1(new EditorBooleanOption(66,"glyphMargin",!0,{description:localize(510,"Controls whether the editor should render the vertical glyph margin. Glyph margin is mostly used for debugging.")})),gotoLocation:register$1(new EditorGoToLocation),hideCursorInOverviewRuler:register$1(new EditorBooleanOption(68,"hideCursorInOverviewRuler",!1,{description:localize(511,"Controls whether the cursor should be hidden in the overview ruler.")})),hover:register$1(new EditorHover),inDiffEditor:register$1(new EditorBooleanOption(70,"inDiffEditor",!1)),inertialScroll:register$1(new EditorBooleanOption(158,"inertialScroll",!1,{description:localize(512,"Make scrolling inertial - mostly useful with touchpad on linux.")})),letterSpacing:register$1(new EditorFloatOption(72,"letterSpacing",EDITOR_FONT_DEFAULTS.letterSpacing,a=>EditorFloatOption.clamp(a,-5,20),{description:localize(513,"Controls the letter spacing in pixels.")})),lightbulb:register$1(new EditorLightbulb),lineDecorationsWidth:register$1(new EditorLineDecorationsWidth),lineHeight:register$1(new EditorLineHeight),lineNumbers:register$1(new EditorRenderLineNumbersOption),lineNumbersMinChars:register$1(new EditorIntOption(77,"lineNumbersMinChars",5,1,300)),linkedEditing:register$1(new EditorBooleanOption(78,"linkedEditing",!1,{description:localize(514,"Controls whether the editor has linked editing enabled. Depending on the language, related symbols such as HTML tags, are updated while editing.")})),links:register$1(new EditorBooleanOption(79,"links",!0,{description:localize(515,"Controls whether the editor should detect links and make them clickable.")})),matchBrackets:register$1(new EditorStringEnumOption(80,"matchBrackets","always",["always","near","never"],{description:localize(516,"Highlight matching brackets.")})),minimap:register$1(new EditorMinimap),mouseStyle:register$1(new EditorStringEnumOption(82,"mouseStyle","text",["text","default","copy"])),mouseWheelScrollSensitivity:register$1(new EditorFloatOption(83,"mouseWheelScrollSensitivity",1,a=>a===0?1:a,{markdownDescription:localize(517,"A multiplier to be used on the `deltaX` and `deltaY` of mouse wheel scroll events.")})),mouseWheelZoom:register$1(new EditorBooleanOption(84,"mouseWheelZoom",!1,{markdownDescription:isMacintosh?localize(518,"Zoom the font of the editor when using mouse wheel and holding `Cmd`."):localize(519,"Zoom the font of the editor when using mouse wheel and holding `Ctrl`.")})),multiCursorMergeOverlapping:register$1(new EditorBooleanOption(85,"multiCursorMergeOverlapping",!0,{description:localize(520,"Merge multiple cursors when they are overlapping.")})),multiCursorModifier:register$1(new EditorEnumOption(86,"multiCursorModifier","altKey","alt",["ctrlCmd","alt"],_multiCursorModifierFromString,{markdownEnumDescriptions:[localize(521,"Maps to `Control` on Windows and Linux and to `Command` on macOS."),localize(522,"Maps to `Alt` on Windows and Linux and to `Option` on macOS.")],markdownDescription:localize(523,"The modifier to be used to add multiple cursors with the mouse. The Go to Definition and Open Link mouse gestures will adapt such that they do not conflict with the [multicursor modifier](https://code.visualstudio.com/docs/editor/codebasics#_multicursor-modifier).")})),mouseMiddleClickAction:register$1(new EditorStringEnumOption(87,"mouseMiddleClickAction","default",["default","openLink","ctrlLeftClick"],{description:localize(524,"Controls what happens when middle mouse button is clicked in the editor.")})),multiCursorPaste:register$1(new EditorStringEnumOption(88,"multiCursorPaste","spread",["spread","full"],{markdownEnumDescriptions:[localize(525,"Each cursor pastes a single line of the text."),localize(526,"Each cursor pastes the full text.")],markdownDescription:localize(527,"Controls pasting when the line count of the pasted text matches the cursor count.")})),multiCursorLimit:register$1(new EditorIntOption(89,"multiCursorLimit",1e4,1,1e5,{markdownDescription:localize(528,"Controls the max number of cursors that can be in an active editor at once.")})),occurrencesHighlight:register$1(new EditorStringEnumOption(90,"occurrencesHighlight","singleFile",["off","singleFile","multiFile"],{markdownEnumDescriptions:[localize(529,"Does not highlight occurrences."),localize(530,"Highlights occurrences only in the current file."),localize(531,"Experimental: Highlights occurrences across all valid open files.")],markdownDescription:localize(532,"Controls whether occurrences should be highlighted across open files.")})),occurrencesHighlightDelay:register$1(new EditorIntOption(91,"occurrencesHighlightDelay",0,0,2e3,{description:localize(533,"Controls the delay in milliseconds after which occurrences are highlighted."),tags:["preview"]})),overtypeOnPaste:register$1(new EditorBooleanOption(93,"overtypeOnPaste",!0,{description:localize(534,"Controls whether pasting should overtype.")})),overviewRulerBorder:register$1(new EditorBooleanOption(94,"overviewRulerBorder",!0,{description:localize(535,"Controls whether a border should be drawn around the overview ruler.")})),overviewRulerLanes:register$1(new EditorIntOption(95,"overviewRulerLanes",3,0,3)),padding:register$1(new EditorPadding),pasteAs:register$1(new EditorPasteAs),parameterHints:register$1(new EditorParameterHints),peekWidgetDefaultFocus:register$1(new EditorStringEnumOption(99,"peekWidgetDefaultFocus","tree",["tree","editor"],{enumDescriptions:[localize(536,"Focus the tree when opening peek"),localize(537,"Focus the editor when opening peek")],description:localize(538,"Controls whether to focus the inline editor or the tree in the peek widget.")})),placeholder:register$1(new PlaceholderOption),definitionLinkOpensInPeek:register$1(new EditorBooleanOption(101,"definitionLinkOpensInPeek",!1,{description:localize(539,"Controls whether the Go to Definition mouse gesture always opens the peek widget.")})),quickSuggestions:register$1(new EditorQuickSuggestions),quickSuggestionsDelay:register$1(new EditorIntOption(103,"quickSuggestionsDelay",10,0,1073741824,{description:localize(540,"Controls the delay in milliseconds after which quick suggestions will show up."),experiment:{mode:"auto"}})),readOnly:register$1(new EditorBooleanOption(104,"readOnly",!1)),readOnlyMessage:register$1(new ReadonlyMessage),renameOnType:register$1(new EditorBooleanOption(106,"renameOnType",!1,{description:localize(541,"Controls whether the editor auto renames on type."),markdownDeprecationMessage:localize(542,"Deprecated, use `#editor.linkedEditing#` instead.")})),renderControlCharacters:register$1(new EditorBooleanOption(108,"renderControlCharacters",!0,{description:localize(543,"Controls whether the editor should render control characters."),restricted:!0})),renderFinalNewline:register$1(new EditorStringEnumOption(109,"renderFinalNewline",isLinux?"dimmed":"on",["off","on","dimmed"],{description:localize(544,"Render last line number when the file ends with a newline.")})),renderLineHighlight:register$1(new EditorStringEnumOption(110,"renderLineHighlight","line",["none","gutter","line","all"],{enumDescriptions:["","","",localize(545,"Highlights both the gutter and the current line.")],description:localize(546,"Controls how the editor should render the current line highlight.")})),renderLineHighlightOnlyWhenFocus:register$1(new EditorBooleanOption(111,"renderLineHighlightOnlyWhenFocus",!1,{description:localize(547,"Controls if the editor should render the current line highlight only when the editor is focused.")})),renderValidationDecorations:register$1(new EditorStringEnumOption(112,"renderValidationDecorations","editable",["editable","on","off"])),renderWhitespace:register$1(new EditorStringEnumOption(113,"renderWhitespace","selection",["none","boundary","selection","trailing","all"],{enumDescriptions:["",localize(548,"Render whitespace characters except for single spaces between words."),localize(549,"Render whitespace characters only on selected text."),localize(550,"Render only trailing whitespace characters."),""],description:localize(551,"Controls how the editor should render whitespace characters.")})),revealHorizontalRightPadding:register$1(new EditorIntOption(114,"revealHorizontalRightPadding",15,0,1e3)),roundedSelection:register$1(new EditorBooleanOption(115,"roundedSelection",!0,{description:localize(552,"Controls whether selections should have rounded corners.")})),rulers:register$1(new EditorRulers),scrollbar:register$1(new EditorScrollbar$1),scrollBeyondLastColumn:register$1(new EditorIntOption(118,"scrollBeyondLastColumn",4,0,1073741824,{description:localize(553,"Controls the number of extra characters beyond which the editor will scroll horizontally.")})),scrollBeyondLastLine:register$1(new EditorBooleanOption(119,"scrollBeyondLastLine",!0,{description:localize(554,"Controls whether the editor will scroll beyond the last line.")})),scrollOnMiddleClick:register$1(new EditorBooleanOption(171,"scrollOnMiddleClick",!1,{description:localize(555,"Controls whether the editor will scroll when the middle button is pressed.")})),scrollPredominantAxis:register$1(new EditorBooleanOption(120,"scrollPredominantAxis",!0,{description:localize(556,"Scroll only along the predominant axis when scrolling both vertically and horizontally at the same time. Prevents horizontal drift when scrolling vertically on a trackpad.")})),selectionClipboard:register$1(new EditorBooleanOption(121,"selectionClipboard",!0,{description:localize(557,"Controls whether the Linux primary clipboard should be supported."),included:isLinux})),selectionHighlight:register$1(new EditorBooleanOption(122,"selectionHighlight",!0,{description:localize(558,"Controls whether the editor should highlight matches similar to the selection.")})),selectionHighlightMaxLength:register$1(new EditorIntOption(123,"selectionHighlightMaxLength",200,0,1073741824,{description:localize(559,"Controls how many characters can be in the selection before similiar matches are not highlighted. Set to zero for unlimited.")})),selectionHighlightMultiline:register$1(new EditorBooleanOption(124,"selectionHighlightMultiline",!1,{description:localize(560,"Controls whether the editor should highlight selection matches that span multiple lines.")})),selectOnLineNumbers:register$1(new EditorBooleanOption(125,"selectOnLineNumbers",!0)),showFoldingControls:register$1(new EditorStringEnumOption(126,"showFoldingControls","mouseover",["always","never","mouseover"],{enumDescriptions:[localize(561,"Always show the folding controls."),localize(562,"Never show the folding controls and reduce the gutter size."),localize(563,"Only show the folding controls when the mouse is over the gutter.")],description:localize(564,"Controls when the folding controls on the gutter are shown.")})),showUnused:register$1(new EditorBooleanOption(127,"showUnused",!0,{description:localize(565,"Controls fading out of unused code.")})),showDeprecated:register$1(new EditorBooleanOption(157,"showDeprecated",!0,{description:localize(566,"Controls strikethrough deprecated variables.")})),inlayHints:register$1(new EditorInlayHints),snippetSuggestions:register$1(new EditorStringEnumOption(128,"snippetSuggestions","inline",["top","bottom","inline","none"],{enumDescriptions:[localize(567,"Show snippet suggestions on top of other suggestions."),localize(568,"Show snippet suggestions below other suggestions."),localize(569,"Show snippets suggestions with other suggestions."),localize(570,"Do not show snippet suggestions.")],description:localize(571,"Controls whether snippets are shown with other suggestions and how they are sorted.")})),smartSelect:register$1(new SmartSelect),smoothScrolling:register$1(new EditorBooleanOption(130,"smoothScrolling",!1,{description:localize(572,"Controls whether the editor will scroll using an animation.")})),stopRenderingLineAfter:register$1(new EditorIntOption(133,"stopRenderingLineAfter",1e4,-1,1073741824)),suggest:register$1(new EditorSuggest),inlineSuggest:register$1(new InlineEditorSuggest),inlineCompletionsAccessibilityVerbose:register$1(new EditorBooleanOption(169,"inlineCompletionsAccessibilityVerbose",!1,{description:localize(573,"Controls whether the accessibility hint should be provided to screen reader users when an inline completion is shown.")})),suggestFontSize:register$1(new EditorIntOption(135,"suggestFontSize",0,0,1e3,{markdownDescription:localize(574,"Font size for the suggest widget. When set to {0}, the value of {1} is used.","`0`","`#editor.fontSize#`")})),suggestLineHeight:register$1(new EditorIntOption(136,"suggestLineHeight",0,0,1e3,{markdownDescription:localize(575,"Line height for the suggest widget. When set to {0}, the value of {1} is used. The minimum value is 8.","`0`","`#editor.lineHeight#`")})),suggestOnTriggerCharacters:register$1(new EditorBooleanOption(137,"suggestOnTriggerCharacters",!0,{description:localize(576,"Controls whether suggestions should automatically show up when typing trigger characters.")})),suggestSelection:register$1(new EditorStringEnumOption(138,"suggestSelection","first",["first","recentlyUsed","recentlyUsedByPrefix"],{markdownEnumDescriptions:[localize(577,"Always select the first suggestion."),localize(578,"Select recent suggestions unless further typing selects one, e.g. `console.| -> console.log` because `log` has been completed recently."),localize(579,"Select suggestions based on previous prefixes that have completed those suggestions, e.g. `co -> console` and `con -> const`.")],description:localize(580,"Controls how suggestions are pre-selected when showing the suggest list.")})),tabCompletion:register$1(new EditorStringEnumOption(139,"tabCompletion","off",["on","off","onlySnippets"],{enumDescriptions:[localize(581,"Tab complete will insert the best matching suggestion when pressing tab."),localize(582,"Disable tab completions."),localize(583,"Tab complete snippets when their prefix match. Works best when 'quickSuggestions' aren't enabled.")],description:localize(584,"Enables tab completions.")})),tabIndex:register$1(new EditorIntOption(140,"tabIndex",0,-1,1073741824)),trimWhitespaceOnDelete:register$1(new EditorBooleanOption(141,"trimWhitespaceOnDelete",!1,{description:localize(585,"Controls whether the editor will also delete the next line's indentation whitespace when deleting a newline.")})),unicodeHighlight:register$1(new UnicodeHighlight),unusualLineTerminators:register$1(new EditorStringEnumOption(143,"unusualLineTerminators","prompt",["auto","off","prompt"],{enumDescriptions:[localize(586,"Unusual line terminators are automatically removed."),localize(587,"Unusual line terminators are ignored."),localize(588,"Unusual line terminators prompt to be removed.")],description:localize(589,"Remove unusual line terminators that might cause problems.")})),useShadowDOM:register$1(new EditorBooleanOption(144,"useShadowDOM",!0)),useTabStops:register$1(new EditorBooleanOption(145,"useTabStops",!0,{description:localize(590,"Spaces and tabs are inserted and deleted in alignment with tab stops.")})),wordBreak:register$1(new EditorStringEnumOption(146,"wordBreak","normal",["normal","keepAll"],{markdownEnumDescriptions:[localize(591,"Use the default line break rule."),localize(592,"Word breaks should not be used for Chinese/Japanese/Korean (CJK) text. Non-CJK text behavior is the same as for normal.")],description:localize(593,"Controls the word break rules used for Chinese/Japanese/Korean (CJK) text.")})),wordSegmenterLocales:register$1(new WordSegmenterLocales),wordSeparators:register$1(new EditorStringOption(148,"wordSeparators",USUAL_WORD_SEPARATORS,{description:localize(594,"Characters that will be used as word separators when doing word related navigations or operations.")})),wordWrap:register$1(new EditorStringEnumOption(149,"wordWrap","off",["off","on","wordWrapColumn","bounded"],{markdownEnumDescriptions:[localize(595,"Lines will never wrap."),localize(596,"Lines will wrap at the viewport width."),localize(597,"Lines will wrap at `#editor.wordWrapColumn#`."),localize(598,"Lines will wrap at the minimum of viewport and `#editor.wordWrapColumn#`.")],description:localize(599,"Controls how lines should wrap.")})),wordWrapBreakAfterCharacters:register$1(new EditorStringOption(150,"wordWrapBreakAfterCharacters"," 	})]?|/&.,;¢°′″‰℃、。｡､￠，．：；？！％・･ゝゞヽヾーァィゥェォッャュョヮヵヶぁぃぅぇぉっゃゅょゎゕゖㇰㇱㇲㇳㇴㇵㇶㇷㇸㇹㇺㇻㇼㇽㇾㇿ々〻ｧｨｩｪｫｬｭｮｯｰ”〉》」』】〕）］｝｣")),wordWrapBreakBeforeCharacters:register$1(new EditorStringOption(151,"wordWrapBreakBeforeCharacters","([{‘“〈《「『【〔（［｛｢£¥＄￡￥+＋")),wordWrapColumn:register$1(new EditorIntOption(152,"wordWrapColumn",80,1,1073741824,{markdownDescription:localize(600,"Controls the wrapping column of the editor when `#editor.wordWrap#` is `wordWrapColumn` or `bounded`.")})),wordWrapOverride1:register$1(new EditorStringEnumOption(153,"wordWrapOverride1","inherit",["off","on","inherit"])),wordWrapOverride2:register$1(new EditorStringEnumOption(154,"wordWrapOverride2","inherit",["off","on","inherit"])),wrapOnEscapedLineFeeds:register$1(new EditorBooleanOption(160,"wrapOnEscapedLineFeeds",!1,{markdownDescription:localize(601,'Controls whether literal `\\n` shall trigger a wordWrap when `#editor.wordWrap#` is enabled.\n\nFor example:\n```c\nchar* str="hello\\nworld"\n```\nwill be displayed as\n```c\nchar* str="hello\\n\n           world"\n```')})),effectiveCursorStyle:register$1(new EffectiveCursorStyle),editorClassName:register$1(new EditorClassName),defaultColorDecorators:register$1(new EditorStringEnumOption(167,"defaultColorDecorators","auto",["auto","always","never"],{enumDescriptions:[localize(602,"Show default color decorators only when no extension provides colors decorators."),localize(603,"Always show default color decorators."),localize(604,"Never show default color decorators.")],description:localize(605,"Controls whether inline color decorations should be shown using the default document color provider.")})),pixelRatio:register$1(new EditorPixelRatio),tabFocusMode:register$1(new EditorBooleanOption(164,"tabFocusMode",!1,{markdownDescription:localize(606,"Controls whether the editor receives tabs or defers them to the workbench for navigation.")})),layoutInfo:register$1(new EditorLayoutInfoComputer),wrappingInfo:register$1(new EditorWrappingInfoComputer),wrappingIndent:register$1(new WrappingIndentOption),wrappingStrategy:register$1(new WrappingStrategy),effectiveEditContextEnabled:register$1(new EffectiveEditContextEnabled),effectiveAllowVariableFonts:register$1(new EffectiveAllowVariableFonts)},EditorZoom=new class{constructor(){this._zoomLevel=0,this._onDidChangeZoomLevel=new Emitter$1,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event}getZoomLevel(){return this._zoomLevel}setZoomLevel(a){a=Math.min(Math.max(-5,a),20),this._zoomLevel!==a&&(this._zoomLevel=a,this._onDidChangeZoomLevel.fire(this._zoomLevel))}},GOLDEN_LINE_HEIGHT_RATIO=isMacintosh?1.5:1.35,MINIMUM_LINE_HEIGHT=8;class BareFontInfo{static createFromValidatedSettings(e,t,s){const o=e.get(58),r=e.get(62),l=e.get(61),c=e.get(60),d=e.get(63),u=e.get(75),g=e.get(72);return BareFontInfo._create(o,r,l,c,d,u,g,t,s)}static _create(e,t,s,o,r,l,c,d,u){l===0?l=GOLDEN_LINE_HEIGHT_RATIO*s:l<MINIMUM_LINE_HEIGHT&&(l=l*s),l=Math.round(l),l<MINIMUM_LINE_HEIGHT&&(l=MINIMUM_LINE_HEIGHT);const g=1+(u?0:EditorZoom.getZoomLevel()*.1);return s*=g,l*=g,r===EditorFontVariations.TRANSLATE&&(t==="normal"||t==="bold"?r=EditorFontVariations.OFF:(r=`'wght' ${parseInt(t,10)}`,t="normal")),new BareFontInfo({pixelRatio:d,fontFamily:e,fontWeight:t,fontSize:s,fontFeatureSettings:o,fontVariationSettings:r,lineHeight:l,letterSpacing:c})}constructor(e){this._bareFontInfoBrand=void 0,this.pixelRatio=e.pixelRatio,this.fontFamily=String(e.fontFamily),this.fontWeight=String(e.fontWeight),this.fontSize=e.fontSize,this.fontFeatureSettings=e.fontFeatureSettings,this.fontVariationSettings=e.fontVariationSettings,this.lineHeight=e.lineHeight|0,this.letterSpacing=e.letterSpacing}getId(){return`${this.pixelRatio}-${this.fontFamily}-${this.fontWeight}-${this.fontSize}-${this.fontFeatureSettings}-${this.fontVariationSettings}-${this.lineHeight}-${this.letterSpacing}`}getMassagedFontFamily(){const e=EDITOR_FONT_DEFAULTS.fontFamily,t=BareFontInfo._wrapInQuotes(this.fontFamily);return e&&this.fontFamily!==e?`${t}, ${e}`:t}static _wrapInQuotes(e){return/[,"']/.test(e)?e:/[+ ]/.test(e)?`"${e}"`:e}}const SERIALIZED_FONT_INFO_VERSION=2;class FontInfo extends BareFontInfo{constructor(e,t){super(e),this._editorStylingBrand=void 0,this.version=SERIALIZED_FONT_INFO_VERSION,this.isTrusted=t,this.isMonospace=e.isMonospace,this.typicalHalfwidthCharacterWidth=e.typicalHalfwidthCharacterWidth,this.typicalFullwidthCharacterWidth=e.typicalFullwidthCharacterWidth,this.canUseHalfwidthRightwardsArrow=e.canUseHalfwidthRightwardsArrow,this.spaceWidth=e.spaceWidth,this.middotWidth=e.middotWidth,this.wsmiddotWidth=e.wsmiddotWidth,this.maxDigitWidth=e.maxDigitWidth}equals(e){return this.fontFamily===e.fontFamily&&this.fontWeight===e.fontWeight&&this.fontSize===e.fontSize&&this.fontFeatureSettings===e.fontFeatureSettings&&this.fontVariationSettings===e.fontVariationSettings&&this.lineHeight===e.lineHeight&&this.letterSpacing===e.letterSpacing&&this.typicalHalfwidthCharacterWidth===e.typicalHalfwidthCharacterWidth&&this.typicalFullwidthCharacterWidth===e.typicalFullwidthCharacterWidth&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.spaceWidth===e.spaceWidth&&this.middotWidth===e.middotWidth&&this.wsmiddotWidth===e.wsmiddotWidth&&this.maxDigitWidth===e.maxDigitWidth}}class FontMeasurementsImpl extends Disposable{constructor(){super(...arguments),this._cache=new Map,this._evictUntrustedReadingsTimeout=-1,this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event}dispose(){this._evictUntrustedReadingsTimeout!==-1&&(clearTimeout(this._evictUntrustedReadingsTimeout),this._evictUntrustedReadingsTimeout=-1),super.dispose()}clearAllFontInfos(){this._cache.clear(),this._onDidChange.fire()}_ensureCache(e){const t=getWindowId(e);let s=this._cache.get(t);return s||(s=new FontMeasurementsCache,this._cache.set(t,s)),s}_writeToCache(e,t,s){this._ensureCache(e).put(t,s),!s.isTrusted&&this._evictUntrustedReadingsTimeout===-1&&(this._evictUntrustedReadingsTimeout=e.setTimeout(()=>{this._evictUntrustedReadingsTimeout=-1,this._evictUntrustedReadings(e)},5e3))}_evictUntrustedReadings(e){const t=this._ensureCache(e),s=t.getValues();let o=!1;for(const r of s)r.isTrusted||(o=!0,t.remove(r));o&&this._onDidChange.fire()}readFontInfo(e,t){const s=this._ensureCache(e);if(!s.has(t)){let o=this._actualReadFontInfo(e,t);(o.typicalHalfwidthCharacterWidth<=2||o.typicalFullwidthCharacterWidth<=2||o.spaceWidth<=2||o.maxDigitWidth<=2)&&(o=new FontInfo({pixelRatio:PixelRatio.getInstance(e).value,fontFamily:o.fontFamily,fontWeight:o.fontWeight,fontSize:o.fontSize,fontFeatureSettings:o.fontFeatureSettings,fontVariationSettings:o.fontVariationSettings,lineHeight:o.lineHeight,letterSpacing:o.letterSpacing,isMonospace:o.isMonospace,typicalHalfwidthCharacterWidth:Math.max(o.typicalHalfwidthCharacterWidth,5),typicalFullwidthCharacterWidth:Math.max(o.typicalFullwidthCharacterWidth,5),canUseHalfwidthRightwardsArrow:o.canUseHalfwidthRightwardsArrow,spaceWidth:Math.max(o.spaceWidth,5),middotWidth:Math.max(o.middotWidth,5),wsmiddotWidth:Math.max(o.wsmiddotWidth,5),maxDigitWidth:Math.max(o.maxDigitWidth,5)},!1)),this._writeToCache(e,t,o)}return s.get(t)}_createRequest(e,t,s,o){const r=new CharWidthRequest(e,t);return s.push(r),o==null||o.push(r),r}_actualReadFontInfo(e,t){const s=[],o=[],r=this._createRequest("n",0,s,o),l=this._createRequest("ｍ",0,s,null),c=this._createRequest(" ",0,s,o),d=this._createRequest("0",0,s,o),u=this._createRequest("1",0,s,o),g=this._createRequest("2",0,s,o),f=this._createRequest("3",0,s,o),p=this._createRequest("4",0,s,o),m=this._createRequest("5",0,s,o),_=this._createRequest("6",0,s,o),C=this._createRequest("7",0,s,o),b=this._createRequest("8",0,s,o),v=this._createRequest("9",0,s,o),S=this._createRequest("→",0,s,o),y=this._createRequest("￫",0,s,null),w=this._createRequest("·",0,s,o),L=this._createRequest(String.fromCharCode(11825),0,s,null),x="|/-_ilm%";for(let N=0,R=x.length;N<R;N++)this._createRequest(x.charAt(N),0,s,o),this._createRequest(x.charAt(N),1,s,o),this._createRequest(x.charAt(N),2,s,o);readCharWidths(e,t,s);const E=Math.max(d.width,u.width,g.width,f.width,p.width,m.width,_.width,C.width,b.width,v.width);let I=t.fontFeatureSettings===EditorFontLigatures.OFF;const D=o[0].width;for(let N=1,R=o.length;I&&N<R;N++){const M=D-o[N].width;if(M<-.001||M>.001){I=!1;break}}let k=!0;return I&&y.width!==D&&(k=!1),y.width>S.width&&(k=!1),new FontInfo({pixelRatio:PixelRatio.getInstance(e).value,fontFamily:t.fontFamily,fontWeight:t.fontWeight,fontSize:t.fontSize,fontFeatureSettings:t.fontFeatureSettings,fontVariationSettings:t.fontVariationSettings,lineHeight:t.lineHeight,letterSpacing:t.letterSpacing,isMonospace:I,typicalHalfwidthCharacterWidth:r.width,typicalFullwidthCharacterWidth:l.width,canUseHalfwidthRightwardsArrow:k,spaceWidth:c.width,middotWidth:w.width,wsmiddotWidth:L.width,maxDigitWidth:E},!0)}}class FontMeasurementsCache{constructor(){this._keys=Object.create(null),this._values=Object.create(null)}has(e){const t=e.getId();return!!this._values[t]}get(e){const t=e.getId();return this._values[t]}put(e,t){const s=e.getId();this._keys[s]=e,this._values[s]=t}remove(e){const t=e.getId();delete this._keys[t],delete this._values[t]}getValues(){return Object.keys(this._keys).map(e=>this._values[e])}}const FontMeasurements=new FontMeasurementsImpl,ti=class ti{constructor(e,t){this.key=e,this.migrate=t}apply(e){const t=ti._read(e,this.key),s=r=>ti._read(e,r),o=(r,l)=>ti._write(e,r,l);this.migrate(t,s,o)}static _read(e,t){if(typeof e>"u")return;const s=t.indexOf(".");if(s>=0){const o=t.substring(0,s);return this._read(e[o],t.substring(s+1))}return e[t]}static _write(e,t,s){const o=t.indexOf(".");if(o>=0){const r=t.substring(0,o);e[r]=e[r]||{},this._write(e[r],t.substring(o+1),s);return}e[t]=s}};ti.items=[];let EditorSettingMigration=ti;function registerEditorSettingMigration(a,e){EditorSettingMigration.items.push(new EditorSettingMigration(a,e))}function registerSimpleEditorSettingMigration(a,e){registerEditorSettingMigration(a,(t,s,o)=>{if(typeof t<"u"){for(const[r,l]of e)if(t===r){o(a,l);return}}})}function migrateOptions(a){EditorSettingMigration.items.forEach(e=>e.apply(a))}registerSimpleEditorSettingMigration("wordWrap",[[!0,"on"],[!1,"off"]]);registerSimpleEditorSettingMigration("lineNumbers",[[!0,"on"],[!1,"off"]]);registerSimpleEditorSettingMigration("cursorBlinking",[["visible","solid"]]);registerSimpleEditorSettingMigration("renderWhitespace",[[!0,"boundary"],[!1,"none"]]);registerSimpleEditorSettingMigration("renderLineHighlight",[[!0,"line"],[!1,"none"]]);registerSimpleEditorSettingMigration("acceptSuggestionOnEnter",[[!0,"on"],[!1,"off"]]);registerSimpleEditorSettingMigration("tabCompletion",[[!1,"off"],[!0,"onlySnippets"]]);registerSimpleEditorSettingMigration("hover",[[!0,{enabled:!0}],[!1,{enabled:!1}]]);registerSimpleEditorSettingMigration("parameterHints",[[!0,{enabled:!0}],[!1,{enabled:!1}]]);registerSimpleEditorSettingMigration("autoIndent",[[!1,"advanced"],[!0,"full"]]);registerSimpleEditorSettingMigration("matchBrackets",[[!0,"always"],[!1,"never"]]);registerSimpleEditorSettingMigration("renderFinalNewline",[[!0,"on"],[!1,"off"]]);registerSimpleEditorSettingMigration("cursorSmoothCaretAnimation",[[!0,"on"],[!1,"off"]]);registerSimpleEditorSettingMigration("occurrencesHighlight",[[!0,"singleFile"],[!1,"off"]]);registerSimpleEditorSettingMigration("wordBasedSuggestions",[[!0,"matchingDocuments"],[!1,"off"]]);registerSimpleEditorSettingMigration("defaultColorDecorators",[[!0,"auto"],[!1,"never"]]);registerSimpleEditorSettingMigration("minimap.autohide",[[!0,"mouseover"],[!1,"none"]]);registerEditorSettingMigration("autoClosingBrackets",(a,e,t)=>{a===!1&&(t("autoClosingBrackets","never"),typeof e("autoClosingQuotes")>"u"&&t("autoClosingQuotes","never"),typeof e("autoSurround")>"u"&&t("autoSurround","never"))});registerEditorSettingMigration("renderIndentGuides",(a,e,t)=>{typeof a<"u"&&(t("renderIndentGuides",void 0),typeof e("guides.indentation")>"u"&&t("guides.indentation",!!a))});registerEditorSettingMigration("highlightActiveIndentGuide",(a,e,t)=>{typeof a<"u"&&(t("highlightActiveIndentGuide",void 0),typeof e("guides.highlightActiveIndentation")>"u"&&t("guides.highlightActiveIndentation",!!a))});const suggestFilteredTypesMapping={method:"showMethods",function:"showFunctions",constructor:"showConstructors",deprecated:"showDeprecated",field:"showFields",variable:"showVariables",class:"showClasses",struct:"showStructs",interface:"showInterfaces",module:"showModules",property:"showProperties",event:"showEvents",operator:"showOperators",unit:"showUnits",value:"showValues",constant:"showConstants",enum:"showEnums",enumMember:"showEnumMembers",keyword:"showKeywords",text:"showWords",color:"showColors",file:"showFiles",reference:"showReferences",folder:"showFolders",typeParameter:"showTypeParameters",snippet:"showSnippets"};registerEditorSettingMigration("suggest.filteredTypes",(a,e,t)=>{if(a&&typeof a=="object"){for(const s of Object.entries(suggestFilteredTypesMapping))a[s[0]]===!1&&typeof e(`suggest.${s[1]}`)>"u"&&t(`suggest.${s[1]}`,!1);t("suggest.filteredTypes",void 0)}});registerEditorSettingMigration("quickSuggestions",(a,e,t)=>{if(typeof a=="boolean"){const s=a?"on":"off";t("quickSuggestions",{comments:s,strings:s,other:s})}});registerEditorSettingMigration("experimental.stickyScroll.enabled",(a,e,t)=>{typeof a=="boolean"&&(t("experimental.stickyScroll.enabled",void 0),typeof e("stickyScroll.enabled")>"u"&&t("stickyScroll.enabled",a))});registerEditorSettingMigration("experimental.stickyScroll.maxLineCount",(a,e,t)=>{typeof a=="number"&&(t("experimental.stickyScroll.maxLineCount",void 0),typeof e("stickyScroll.maxLineCount")>"u"&&t("stickyScroll.maxLineCount",a))});registerEditorSettingMigration("editor.experimentalEditContextEnabled",(a,e,t)=>{typeof a=="boolean"&&(t("editor.experimentalEditContextEnabled",void 0),typeof e("editor.editContext")>"u"&&t("editor.editContext",a))});registerEditorSettingMigration("codeActionsOnSave",(a,e,t)=>{if(a&&typeof a=="object"){let s=!1;const o={};for(const r of Object.entries(a))typeof r[1]=="boolean"?(s=!0,o[r[0]]=r[1]?"explicit":"never"):o[r[0]]=r[1];s&&t("codeActionsOnSave",o)}});registerEditorSettingMigration("codeActionWidget.includeNearbyQuickfixes",(a,e,t)=>{typeof a=="boolean"&&(t("codeActionWidget.includeNearbyQuickfixes",void 0),typeof e("codeActionWidget.includeNearbyQuickFixes")>"u"&&t("codeActionWidget.includeNearbyQuickFixes",a))});registerEditorSettingMigration("lightbulb.enabled",(a,e,t)=>{typeof a=="boolean"&&t("lightbulb.enabled",a?void 0:"off")});registerEditorSettingMigration("inlineSuggest.edits.codeShifting",(a,e,t)=>{typeof a=="boolean"&&(t("inlineSuggest.edits.codeShifting",void 0),t("inlineSuggest.edits.allowCodeShifting",a?"always":"never"))});class TabFocusImpl{constructor(){this._tabFocus=!1,this._onDidChangeTabFocus=new Emitter$1,this.onDidChangeTabFocus=this._onDidChangeTabFocus.event}getTabFocusMode(){return this._tabFocus}setTabFocusMode(e){this._tabFocus=e,this._onDidChangeTabFocus.fire(this._tabFocus)}}const TabFocus=new TabFocusImpl,IAccessibilityService=createDecorator("accessibilityService"),CONTEXT_ACCESSIBILITY_MODE_ENABLED=new RawContextKey("accessibilityModeEnabled",!1);var __decorate$2V=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2O=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let EditorConfiguration=class extends Disposable{constructor(e,t,s,o,r){super(),this._accessibilityService=r,this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,this._onDidChangeFast=this._register(new Emitter$1),this.onDidChangeFast=this._onDidChangeFast.event,this._isDominatedByLongLines=!1,this._viewLineCount=1,this._lineNumbersDigitCount=1,this._reservedHeight=0,this._glyphMarginDecorationLaneCount=1,this._computeOptionsMemory=new ComputeOptionsMemory,this.isSimpleWidget=e,this.contextMenuId=t,this._containerObserver=this._register(new ElementSizeObserver(o,s.dimension)),this._targetWindowId=getWindow(o).vscodeWindowId,this._rawOptions=deepCloneAndMigrateOptions(s),this._validatedOptions=EditorOptionsUtil.validateOptions(this._rawOptions),this.options=this._computeOptions(),this.options.get(19)&&this._containerObserver.startObserving(),this._register(EditorZoom.onDidChangeZoomLevel(()=>this._recomputeOptions())),this._register(TabFocus.onDidChangeTabFocus(()=>this._recomputeOptions())),this._register(this._containerObserver.onDidChange(()=>this._recomputeOptions())),this._register(FontMeasurements.onDidChange(()=>this._recomputeOptions())),this._register(PixelRatio.getInstance(getWindow(o)).onDidChange(()=>this._recomputeOptions())),this._register(this._accessibilityService.onDidChangeScreenReaderOptimized(()=>this._recomputeOptions())),this._register(InputMode.onDidChangeInputMode(()=>this._recomputeOptions()))}_recomputeOptions(){const e=this._computeOptions(),t=EditorOptionsUtil.checkEquals(this.options,e);t!==null&&(this.options=e,this._onDidChangeFast.fire(t),this._onDidChange.fire(t))}_computeOptions(){const e=this._readEnvConfiguration(),t=BareFontInfo.createFromValidatedSettings(this._validatedOptions,e.pixelRatio,this.isSimpleWidget),s=this._readFontInfo(t),o={memory:this._computeOptionsMemory,outerWidth:e.outerWidth,outerHeight:e.outerHeight-this._reservedHeight,fontInfo:s,extraEditorClassName:e.extraEditorClassName,isDominatedByLongLines:this._isDominatedByLongLines,viewLineCount:this._viewLineCount,lineNumbersDigitCount:this._lineNumbersDigitCount,emptySelectionClipboard:e.emptySelectionClipboard,pixelRatio:e.pixelRatio,tabFocusMode:this._validatedOptions.get(164)||TabFocus.getTabFocusMode(),inputMode:InputMode.getInputMode(),accessibilitySupport:e.accessibilitySupport,glyphMarginDecorationLaneCount:this._glyphMarginDecorationLaneCount,editContextSupported:e.editContextSupported};return EditorOptionsUtil.computeOptions(this._validatedOptions,o)}_readEnvConfiguration(){return{extraEditorClassName:getExtraEditorClassName(),outerWidth:this._containerObserver.getWidth(),outerHeight:this._containerObserver.getHeight(),emptySelectionClipboard:isWebKit||isFirefox$1,pixelRatio:PixelRatio.getInstance(getWindowById(this._targetWindowId,!0).window).value,editContextSupported:typeof globalThis.EditContext=="function",accessibilitySupport:this._accessibilityService.isScreenReaderOptimized()?2:this._accessibilityService.getAccessibilitySupport()}}_readFontInfo(e){return FontMeasurements.readFontInfo(getWindowById(this._targetWindowId,!0).window,e)}getRawOptions(){return this._rawOptions}updateOptions(e){const t=deepCloneAndMigrateOptions(e);EditorOptionsUtil.applyUpdate(this._rawOptions,t)&&(this._validatedOptions=EditorOptionsUtil.validateOptions(this._rawOptions),this._recomputeOptions())}observeContainer(e){this._containerObserver.observe(e)}setIsDominatedByLongLines(e){this._isDominatedByLongLines!==e&&(this._isDominatedByLongLines=e,this._recomputeOptions())}setModelLineCount(e){const t=digitCount(e);this._lineNumbersDigitCount!==t&&(this._lineNumbersDigitCount=t,this._recomputeOptions())}setViewLineCount(e){this._viewLineCount!==e&&(this._viewLineCount=e,this._recomputeOptions())}setReservedHeight(e){this._reservedHeight!==e&&(this._reservedHeight=e,this._recomputeOptions())}setGlyphMarginDecorationLaneCount(e){this._glyphMarginDecorationLaneCount!==e&&(this._glyphMarginDecorationLaneCount=e,this._recomputeOptions())}};EditorConfiguration=__decorate$2V([__param$2O(4,IAccessibilityService)],EditorConfiguration);function digitCount(a){let e=0;for(;a;)a=Math.floor(a/10),e++;return e||1}function getExtraEditorClassName(){let a="";return isSafari$1||isWebkitWebView?(a+="no-minimap-shadow ",a+="enable-user-select "):a+="no-user-select ",isMacintosh&&(a+="mac "),a}class ValidatedEditorOptions{constructor(){this._values=[]}_read(e){return this._values[e]}get(e){return this._values[e]}_write(e,t){this._values[e]=t}}class ComputedEditorOptions{constructor(){this._values=[]}_read(e){if(e>=this._values.length)throw new Error("Cannot read uninitialized value");return this._values[e]}get(e){return this._read(e)}_write(e,t){this._values[e]=t}}class EditorOptionsUtil{static validateOptions(e){const t=new ValidatedEditorOptions;for(const s of editorOptionsRegistry){const o=s.name==="_never_"?void 0:e[s.name];t._write(s.id,s.validate(o))}return t}static computeOptions(e,t){const s=new ComputedEditorOptions;for(const o of editorOptionsRegistry)s._write(o.id,o.compute(t,s,e._read(o.id)));return s}static _deepEquals(e,t){if(typeof e!="object"||typeof t!="object"||!e||!t)return e===t;if(Array.isArray(e)||Array.isArray(t))return Array.isArray(e)&&Array.isArray(t)?equals$1(e,t):!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(!EditorOptionsUtil._deepEquals(e[s],t[s]))return!1;return!0}static checkEquals(e,t){const s=[];let o=!1;for(const r of editorOptionsRegistry){const l=!EditorOptionsUtil._deepEquals(e._read(r.id),t._read(r.id));s[r.id]=l,l&&(o=!0)}return o?new ConfigurationChangedEvent(s):null}static applyUpdate(e,t){let s=!1;for(const o of editorOptionsRegistry)if(t.hasOwnProperty(o.name)){const r=o.applyUpdate(e[o.name],t[o.name]);e[o.name]=r.newValue,s=s||r.didChange}return s}}function deepCloneAndMigrateOptions(a){const e=deepClone(a);return migrateOptions(e),e}var inputLatency;(function(a){const e={total:0,min:Number.MAX_VALUE,max:0},t={...e},s={...e},o={...e};let r=0;const l={keydown:0,input:0,render:0};function c(){v(),performance.mark("inputlatency/start"),performance.mark("keydown/start"),l.keydown=1,queueMicrotask(d)}a.onKeyDown=c;function d(){l.keydown===1&&(performance.mark("keydown/end"),l.keydown=2)}function u(){performance.mark("input/start"),l.input=1,b()}a.onBeforeInput=u;function g(){l.input===0&&u(),queueMicrotask(f)}a.onInput=g;function f(){l.input===1&&(performance.mark("input/end"),l.input=2)}function p(){v()}a.onKeyUp=p;function m(){v()}a.onSelectionChange=m;function _(){l.keydown===2&&l.input===2&&l.render===0&&(performance.mark("render/start"),l.render=1,queueMicrotask(C),b())}a.onRenderStart=_;function C(){l.render===1&&(performance.mark("render/end"),l.render=2)}function b(){setTimeout(v)}function v(){l.keydown===2&&l.input===2&&l.render===2&&(performance.mark("inputlatency/end"),performance.measure("keydown","keydown/start","keydown/end"),performance.measure("input","input/start","input/end"),performance.measure("render","render/start","render/end"),performance.measure("inputlatency","inputlatency/start","inputlatency/end"),S("keydown",e),S("input",t),S("render",s),S("inputlatency",o),r++,y())}function S(E,I){const D=performance.getEntriesByName(E)[0].duration;I.total+=D,I.min=Math.min(I.min,D),I.max=Math.max(I.max,D)}function y(){performance.clearMarks("keydown/start"),performance.clearMarks("keydown/end"),performance.clearMarks("input/start"),performance.clearMarks("input/end"),performance.clearMarks("render/start"),performance.clearMarks("render/end"),performance.clearMarks("inputlatency/start"),performance.clearMarks("inputlatency/end"),performance.clearMeasures("keydown"),performance.clearMeasures("input"),performance.clearMeasures("render"),performance.clearMeasures("inputlatency"),l.keydown=0,l.input=0,l.render=0}function w(){if(r===0)return;const E={keydown:L(e),input:L(t),render:L(s),total:L(o),sampleCount:r};return x(e),x(t),x(s),x(o),r=0,E}a.getAndClearMeasurements=w;function L(E){return{average:E.total/r,max:E.max,min:E.min}}function x(E){E.total=0,E.min=Number.MAX_VALUE,E.max=0}})(inputLatency||(inputLatency={}));const globalStylesheets=new Map;function createStyleSheet2(){return new WrappedStyleElement}class WrappedStyleElement{constructor(){this._currentCssStyle="",this._styleSheet=void 0}setStyle(e){e!==this._currentCssStyle&&(this._currentCssStyle=e,this._styleSheet?this._styleSheet.textContent=e:this._styleSheet=createStyleSheet(mainWindow.document.head,t=>t.textContent=e))}dispose(){this._styleSheet&&(this._styleSheet.remove(),this._styleSheet=void 0)}}function createStyleSheet(a=mainWindow.document.head,e,t){const s=document.createElement("style");if(s.type="text/css",s.media="screen",e==null||e(s),a.appendChild(s),t&&t.add(toDisposable(()=>s.remove())),a===mainWindow.document.head){const o=new Set;globalStylesheets.set(s,o),t&&t.add(toDisposable(()=>globalStylesheets.delete(s)));for(const{window:r,disposables:l}of getWindows()){if(r===mainWindow)continue;const c=l.add(cloneGlobalStyleSheet(s,o,r));t==null||t.add(c)}}return s}function cloneGlobalStyleSheet(a,e,t){var r,l;const s=new DisposableStore,o=a.cloneNode(!0);t.document.head.appendChild(o),s.add(toDisposable(()=>o.remove()));for(const c of getDynamicStyleSheetRules(a))(l=o.sheet)==null||l.insertRule(c.cssText,(r=o.sheet)==null?void 0:r.cssRules.length);return s.add(sharedMutationObserver.observe(a,s,{childList:!0,subtree:isFirefox$1,characterData:isFirefox$1})(()=>{o.textContent=a.textContent})),e.add(o),s.add(toDisposable(()=>e.delete(o))),s}let _sharedStyleSheet=null;function getSharedStyleSheet(){return _sharedStyleSheet||(_sharedStyleSheet=createStyleSheet()),_sharedStyleSheet}function getDynamicStyleSheetRules(a){var e,t;return(e=a==null?void 0:a.sheet)!=null&&e.rules?a.sheet.rules:(t=a==null?void 0:a.sheet)!=null&&t.cssRules?a.sheet.cssRules:[]}function createCSSRule(a,e,t=getSharedStyleSheet()){var s;if(!(!t||!e)){(s=t.sheet)==null||s.insertRule(`${a} {${e}}`,0);for(const o of globalStylesheets.get(t)??[])createCSSRule(a,e,o)}}function removeCSSRulesContainingSelector(a,e=getSharedStyleSheet()){var o;if(!e)return;const t=getDynamicStyleSheetRules(e),s=[];for(let r=0;r<t.length;r++){const l=t[r];isCSSStyleRule(l)&&l.selectorText.indexOf(a)!==-1&&s.push(r)}for(let r=s.length-1;r>=0;r--)(o=e.sheet)==null||o.deleteRule(s[r]);for(const r of globalStylesheets.get(e)??[])removeCSSRulesContainingSelector(a,r)}function isCSSStyleRule(a){return typeof a.selectorText=="string"}function createStyleSheetFromObservable(a){const e=new DisposableStore,t=e.add(createStyleSheet2());return e.add(autorun(s=>{t.setStyle(a.read(s))})),e}class GlobalPointerMoveMonitor{constructor(){this._hooks=new DisposableStore,this._pointerMoveCallback=null,this._onStopCallback=null}dispose(){this.stopMonitoring(!1),this._hooks.dispose()}stopMonitoring(e,t){if(!this.isMonitoring())return;this._hooks.clear(),this._pointerMoveCallback=null;const s=this._onStopCallback;this._onStopCallback=null,e&&s&&s(t)}isMonitoring(){return!!this._pointerMoveCallback}startMonitoring(e,t,s,o,r){this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=o,this._onStopCallback=r;let l=e;try{e.setPointerCapture(t),this._hooks.add(toDisposable(()=>{try{e.releasePointerCapture(t)}catch{}}))}catch{l=getWindow(e)}this._hooks.add(addDisposableListener(l,EventType$1.POINTER_MOVE,c=>{if(c.buttons!==s){this.stopMonitoring(!0);return}c.preventDefault(),this._pointerMoveCallback(c)})),this._hooks.add(addDisposableListener(l,EventType$1.POINTER_UP,c=>this.stopMonitoring(!0)))}}function roundFloat(a,e){const t=Math.pow(10,e);return Math.round(a*t)/t}class RGBA{constructor(e,t,s,o=1){this._rgbaBrand=void 0,this.r=Math.min(255,Math.max(0,e))|0,this.g=Math.min(255,Math.max(0,t))|0,this.b=Math.min(255,Math.max(0,s))|0,this.a=roundFloat(Math.max(Math.min(1,o),0),3)}static equals(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}}class HSLA{constructor(e,t,s,o){this._hslaBrand=void 0,this.h=Math.max(Math.min(360,e),0)|0,this.s=roundFloat(Math.max(Math.min(1,t),0),3),this.l=roundFloat(Math.max(Math.min(1,s),0),3),this.a=roundFloat(Math.max(Math.min(1,o),0),3)}static equals(e,t){return e.h===t.h&&e.s===t.s&&e.l===t.l&&e.a===t.a}static fromRGBA(e){const t=e.r/255,s=e.g/255,o=e.b/255,r=e.a,l=Math.max(t,s,o),c=Math.min(t,s,o);let d=0,u=0;const g=(c+l)/2,f=l-c;if(f>0){switch(u=Math.min(g<=.5?f/(2*g):f/(2-2*g),1),l){case t:d=(s-o)/f+(s<o?6:0);break;case s:d=(o-t)/f+2;break;case o:d=(t-s)/f+4;break}d*=60,d=Math.round(d)}return new HSLA(d,u,g,r)}static _hue2rgb(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+(t-e)*6*s:s<1/2?t:s<2/3?e+(t-e)*(2/3-s)*6:e}static toRGBA(e){const t=e.h/360,{s,l:o,a:r}=e;let l,c,d;if(s===0)l=c=d=o;else{const u=o<.5?o*(1+s):o+s-o*s,g=2*o-u;l=HSLA._hue2rgb(g,u,t+1/3),c=HSLA._hue2rgb(g,u,t),d=HSLA._hue2rgb(g,u,t-1/3)}return new RGBA(Math.round(l*255),Math.round(c*255),Math.round(d*255),r)}}class HSVA{constructor(e,t,s,o){this._hsvaBrand=void 0,this.h=Math.max(Math.min(360,e),0)|0,this.s=roundFloat(Math.max(Math.min(1,t),0),3),this.v=roundFloat(Math.max(Math.min(1,s),0),3),this.a=roundFloat(Math.max(Math.min(1,o),0),3)}static equals(e,t){return e.h===t.h&&e.s===t.s&&e.v===t.v&&e.a===t.a}static fromRGBA(e){const t=e.r/255,s=e.g/255,o=e.b/255,r=Math.max(t,s,o),l=Math.min(t,s,o),c=r-l,d=r===0?0:c/r;let u;return c===0?u=0:r===t?u=((s-o)/c%6+6)%6:r===s?u=(o-t)/c+2:u=(t-s)/c+4,new HSVA(Math.round(u*60),d,r,e.a)}static toRGBA(e){const{h:t,s,v:o,a:r}=e,l=o*s,c=l*(1-Math.abs(t/60%2-1)),d=o-l;let[u,g,f]=[0,0,0];return t<60?(u=l,g=c):t<120?(u=c,g=l):t<180?(g=l,f=c):t<240?(g=c,f=l):t<300?(u=c,f=l):t<=360&&(u=l,f=c),u=Math.round((u+d)*255),g=Math.round((g+d)*255),f=Math.round((f+d)*255),new RGBA(u,g,f,r)}}const te=class te{static fromHex(e){return te.Format.CSS.parseHex(e)||te.red}static equals(e,t){return!e&&!t?!0:!e||!t?!1:e.equals(t)}get hsla(){return this._hsla?this._hsla:HSLA.fromRGBA(this.rgba)}get hsva(){return this._hsva?this._hsva:HSVA.fromRGBA(this.rgba)}constructor(e){if(e)if(e instanceof RGBA)this.rgba=e;else if(e instanceof HSLA)this._hsla=e,this.rgba=HSLA.toRGBA(e);else if(e instanceof HSVA)this._hsva=e,this.rgba=HSVA.toRGBA(e);else throw new Error("Invalid color ctor argument");else throw new Error("Color needs a value")}equals(e){return!!e&&RGBA.equals(this.rgba,e.rgba)&&HSLA.equals(this.hsla,e.hsla)&&HSVA.equals(this.hsva,e.hsva)}getRelativeLuminance(){const e=te._relativeLuminanceForComponent(this.rgba.r),t=te._relativeLuminanceForComponent(this.rgba.g),s=te._relativeLuminanceForComponent(this.rgba.b),o=.2126*e+.7152*t+.0722*s;return roundFloat(o,4)}static _relativeLuminanceForComponent(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}isLighter(){return(this.rgba.r*299+this.rgba.g*587+this.rgba.b*114)/1e3>=128}isLighterThan(e){const t=this.getRelativeLuminance(),s=e.getRelativeLuminance();return t>s}isDarkerThan(e){const t=this.getRelativeLuminance(),s=e.getRelativeLuminance();return t<s}lighten(e){return new te(new HSLA(this.hsla.h,this.hsla.s,this.hsla.l+this.hsla.l*e,this.hsla.a))}darken(e){return new te(new HSLA(this.hsla.h,this.hsla.s,this.hsla.l-this.hsla.l*e,this.hsla.a))}transparent(e){const{r:t,g:s,b:o,a:r}=this.rgba;return new te(new RGBA(t,s,o,r*e))}isTransparent(){return this.rgba.a===0}isOpaque(){return this.rgba.a===1}opposite(){return new te(new RGBA(255-this.rgba.r,255-this.rgba.g,255-this.rgba.b,this.rgba.a))}mix(e,t=.5){const s=Math.min(Math.max(t,0),1),o=this.rgba,r=e.rgba,l=o.r+(r.r-o.r)*s,c=o.g+(r.g-o.g)*s,d=o.b+(r.b-o.b)*s,u=o.a+(r.a-o.a)*s;return new te(new RGBA(l,c,d,u))}makeOpaque(e){if(this.isOpaque()||e.rgba.a!==1)return this;const{r:t,g:s,b:o,a:r}=this.rgba;return new te(new RGBA(e.rgba.r-r*(e.rgba.r-t),e.rgba.g-r*(e.rgba.g-s),e.rgba.b-r*(e.rgba.b-o),1))}toString(){return this._toString||(this._toString=te.Format.CSS.format(this)),this._toString}toNumber32Bit(){return this._toNumber32Bit||(this._toNumber32Bit=(this.rgba.r<<24|this.rgba.g<<16|this.rgba.b<<8|this.rgba.a*255<<0)>>>0),this._toNumber32Bit}static getLighterColor(e,t,s){if(e.isLighterThan(t))return e;s=s||.5;const o=e.getRelativeLuminance(),r=t.getRelativeLuminance();return s=s*(r-o)/r,e.lighten(s)}static getDarkerColor(e,t,s){if(e.isDarkerThan(t))return e;s=s||.5;const o=e.getRelativeLuminance(),r=t.getRelativeLuminance();return s=s*(o-r)/o,e.darken(s)}};te.white=new te(new RGBA(255,255,255,1)),te.black=new te(new RGBA(0,0,0,1)),te.red=new te(new RGBA(255,0,0,1)),te.blue=new te(new RGBA(0,0,255,1)),te.green=new te(new RGBA(0,255,0,1)),te.cyan=new te(new RGBA(0,255,255,1)),te.lightgrey=new te(new RGBA(211,211,211,1)),te.transparent=new te(new RGBA(0,0,0,0));let Color=te;(function(a){(function(e){(function(t){function s(C){return C.rgba.a===1?`rgb(${C.rgba.r}, ${C.rgba.g}, ${C.rgba.b})`:a.Format.CSS.formatRGBA(C)}t.formatRGB=s;function o(C){return`rgba(${C.rgba.r}, ${C.rgba.g}, ${C.rgba.b}, ${+C.rgba.a.toFixed(2)})`}t.formatRGBA=o;function r(C){return C.hsla.a===1?`hsl(${C.hsla.h}, ${Math.round(C.hsla.s*100)}%, ${Math.round(C.hsla.l*100)}%)`:a.Format.CSS.formatHSLA(C)}t.formatHSL=r;function l(C){return`hsla(${C.hsla.h}, ${Math.round(C.hsla.s*100)}%, ${Math.round(C.hsla.l*100)}%, ${C.hsla.a.toFixed(2)})`}t.formatHSLA=l;function c(C){const b=C.toString(16);return b.length!==2?"0"+b:b}function d(C){return`#${c(C.rgba.r)}${c(C.rgba.g)}${c(C.rgba.b)}`}t.formatHex=d;function u(C,b=!1){return b&&C.rgba.a===1?a.Format.CSS.formatHex(C):`#${c(C.rgba.r)}${c(C.rgba.g)}${c(C.rgba.b)}${c(Math.round(C.rgba.a*255))}`}t.formatHexA=u;function g(C){return C.isOpaque()?a.Format.CSS.formatHex(C):a.Format.CSS.formatRGBA(C)}t.format=g;function f(C){var b,v,S,y,w,L,x;if(C==="transparent")return a.transparent;if(C.startsWith("#"))return m(C);if(C.startsWith("rgba(")){const E=C.match(/rgba\((?<r>(?:\+|-)?\d+), *(?<g>(?:\+|-)?\d+), *(?<b>(?:\+|-)?\d+), *(?<a>(?:\+|-)?\d+(\.\d+)?)\)/);if(!E)throw new Error("Invalid color format "+C);const I=parseInt(((b=E.groups)==null?void 0:b.r)??"0"),D=parseInt(((v=E.groups)==null?void 0:v.g)??"0"),k=parseInt(((S=E.groups)==null?void 0:S.b)??"0"),N=parseFloat(((y=E.groups)==null?void 0:y.a)??"0");return new a(new RGBA(I,D,k,N))}if(C.startsWith("rgb(")){const E=C.match(/rgb\((?<r>(?:\+|-)?\d+), *(?<g>(?:\+|-)?\d+), *(?<b>(?:\+|-)?\d+)\)/);if(!E)throw new Error("Invalid color format "+C);const I=parseInt(((w=E.groups)==null?void 0:w.r)??"0"),D=parseInt(((L=E.groups)==null?void 0:L.g)??"0"),k=parseInt(((x=E.groups)==null?void 0:x.b)??"0");return new a(new RGBA(I,D,k))}return p(C)}t.parse=f;function p(C){switch(C){case"aliceblue":return new a(new RGBA(240,248,255,1));case"antiquewhite":return new a(new RGBA(250,235,215,1));case"aqua":return new a(new RGBA(0,255,255,1));case"aquamarine":return new a(new RGBA(127,255,212,1));case"azure":return new a(new RGBA(240,255,255,1));case"beige":return new a(new RGBA(245,245,220,1));case"bisque":return new a(new RGBA(255,228,196,1));case"black":return new a(new RGBA(0,0,0,1));case"blanchedalmond":return new a(new RGBA(255,235,205,1));case"blue":return new a(new RGBA(0,0,255,1));case"blueviolet":return new a(new RGBA(138,43,226,1));case"brown":return new a(new RGBA(165,42,42,1));case"burlywood":return new a(new RGBA(222,184,135,1));case"cadetblue":return new a(new RGBA(95,158,160,1));case"chartreuse":return new a(new RGBA(127,255,0,1));case"chocolate":return new a(new RGBA(210,105,30,1));case"coral":return new a(new RGBA(255,127,80,1));case"cornflowerblue":return new a(new RGBA(100,149,237,1));case"cornsilk":return new a(new RGBA(255,248,220,1));case"crimson":return new a(new RGBA(220,20,60,1));case"cyan":return new a(new RGBA(0,255,255,1));case"darkblue":return new a(new RGBA(0,0,139,1));case"darkcyan":return new a(new RGBA(0,139,139,1));case"darkgoldenrod":return new a(new RGBA(184,134,11,1));case"darkgray":return new a(new RGBA(169,169,169,1));case"darkgreen":return new a(new RGBA(0,100,0,1));case"darkgrey":return new a(new RGBA(169,169,169,1));case"darkkhaki":return new a(new RGBA(189,183,107,1));case"darkmagenta":return new a(new RGBA(139,0,139,1));case"darkolivegreen":return new a(new RGBA(85,107,47,1));case"darkorange":return new a(new RGBA(255,140,0,1));case"darkorchid":return new a(new RGBA(153,50,204,1));case"darkred":return new a(new RGBA(139,0,0,1));case"darksalmon":return new a(new RGBA(233,150,122,1));case"darkseagreen":return new a(new RGBA(143,188,143,1));case"darkslateblue":return new a(new RGBA(72,61,139,1));case"darkslategray":return new a(new RGBA(47,79,79,1));case"darkslategrey":return new a(new RGBA(47,79,79,1));case"darkturquoise":return new a(new RGBA(0,206,209,1));case"darkviolet":return new a(new RGBA(148,0,211,1));case"deeppink":return new a(new RGBA(255,20,147,1));case"deepskyblue":return new a(new RGBA(0,191,255,1));case"dimgray":return new a(new RGBA(105,105,105,1));case"dimgrey":return new a(new RGBA(105,105,105,1));case"dodgerblue":return new a(new RGBA(30,144,255,1));case"firebrick":return new a(new RGBA(178,34,34,1));case"floralwhite":return new a(new RGBA(255,250,240,1));case"forestgreen":return new a(new RGBA(34,139,34,1));case"fuchsia":return new a(new RGBA(255,0,255,1));case"gainsboro":return new a(new RGBA(220,220,220,1));case"ghostwhite":return new a(new RGBA(248,248,255,1));case"gold":return new a(new RGBA(255,215,0,1));case"goldenrod":return new a(new RGBA(218,165,32,1));case"gray":return new a(new RGBA(128,128,128,1));case"green":return new a(new RGBA(0,128,0,1));case"greenyellow":return new a(new RGBA(173,255,47,1));case"grey":return new a(new RGBA(128,128,128,1));case"honeydew":return new a(new RGBA(240,255,240,1));case"hotpink":return new a(new RGBA(255,105,180,1));case"indianred":return new a(new RGBA(205,92,92,1));case"indigo":return new a(new RGBA(75,0,130,1));case"ivory":return new a(new RGBA(255,255,240,1));case"khaki":return new a(new RGBA(240,230,140,1));case"lavender":return new a(new RGBA(230,230,250,1));case"lavenderblush":return new a(new RGBA(255,240,245,1));case"lawngreen":return new a(new RGBA(124,252,0,1));case"lemonchiffon":return new a(new RGBA(255,250,205,1));case"lightblue":return new a(new RGBA(173,216,230,1));case"lightcoral":return new a(new RGBA(240,128,128,1));case"lightcyan":return new a(new RGBA(224,255,255,1));case"lightgoldenrodyellow":return new a(new RGBA(250,250,210,1));case"lightgray":return new a(new RGBA(211,211,211,1));case"lightgreen":return new a(new RGBA(144,238,144,1));case"lightgrey":return new a(new RGBA(211,211,211,1));case"lightpink":return new a(new RGBA(255,182,193,1));case"lightsalmon":return new a(new RGBA(255,160,122,1));case"lightseagreen":return new a(new RGBA(32,178,170,1));case"lightskyblue":return new a(new RGBA(135,206,250,1));case"lightslategray":return new a(new RGBA(119,136,153,1));case"lightslategrey":return new a(new RGBA(119,136,153,1));case"lightsteelblue":return new a(new RGBA(176,196,222,1));case"lightyellow":return new a(new RGBA(255,255,224,1));case"lime":return new a(new RGBA(0,255,0,1));case"limegreen":return new a(new RGBA(50,205,50,1));case"linen":return new a(new RGBA(250,240,230,1));case"magenta":return new a(new RGBA(255,0,255,1));case"maroon":return new a(new RGBA(128,0,0,1));case"mediumaquamarine":return new a(new RGBA(102,205,170,1));case"mediumblue":return new a(new RGBA(0,0,205,1));case"mediumorchid":return new a(new RGBA(186,85,211,1));case"mediumpurple":return new a(new RGBA(147,112,219,1));case"mediumseagreen":return new a(new RGBA(60,179,113,1));case"mediumslateblue":return new a(new RGBA(123,104,238,1));case"mediumspringgreen":return new a(new RGBA(0,250,154,1));case"mediumturquoise":return new a(new RGBA(72,209,204,1));case"mediumvioletred":return new a(new RGBA(199,21,133,1));case"midnightblue":return new a(new RGBA(25,25,112,1));case"mintcream":return new a(new RGBA(245,255,250,1));case"mistyrose":return new a(new RGBA(255,228,225,1));case"moccasin":return new a(new RGBA(255,228,181,1));case"navajowhite":return new a(new RGBA(255,222,173,1));case"navy":return new a(new RGBA(0,0,128,1));case"oldlace":return new a(new RGBA(253,245,230,1));case"olive":return new a(new RGBA(128,128,0,1));case"olivedrab":return new a(new RGBA(107,142,35,1));case"orange":return new a(new RGBA(255,165,0,1));case"orangered":return new a(new RGBA(255,69,0,1));case"orchid":return new a(new RGBA(218,112,214,1));case"palegoldenrod":return new a(new RGBA(238,232,170,1));case"palegreen":return new a(new RGBA(152,251,152,1));case"paleturquoise":return new a(new RGBA(175,238,238,1));case"palevioletred":return new a(new RGBA(219,112,147,1));case"papayawhip":return new a(new RGBA(255,239,213,1));case"peachpuff":return new a(new RGBA(255,218,185,1));case"peru":return new a(new RGBA(205,133,63,1));case"pink":return new a(new RGBA(255,192,203,1));case"plum":return new a(new RGBA(221,160,221,1));case"powderblue":return new a(new RGBA(176,224,230,1));case"purple":return new a(new RGBA(128,0,128,1));case"rebeccapurple":return new a(new RGBA(102,51,153,1));case"red":return new a(new RGBA(255,0,0,1));case"rosybrown":return new a(new RGBA(188,143,143,1));case"royalblue":return new a(new RGBA(65,105,225,1));case"saddlebrown":return new a(new RGBA(139,69,19,1));case"salmon":return new a(new RGBA(250,128,114,1));case"sandybrown":return new a(new RGBA(244,164,96,1));case"seagreen":return new a(new RGBA(46,139,87,1));case"seashell":return new a(new RGBA(255,245,238,1));case"sienna":return new a(new RGBA(160,82,45,1));case"silver":return new a(new RGBA(192,192,192,1));case"skyblue":return new a(new RGBA(135,206,235,1));case"slateblue":return new a(new RGBA(106,90,205,1));case"slategray":return new a(new RGBA(112,128,144,1));case"slategrey":return new a(new RGBA(112,128,144,1));case"snow":return new a(new RGBA(255,250,250,1));case"springgreen":return new a(new RGBA(0,255,127,1));case"steelblue":return new a(new RGBA(70,130,180,1));case"tan":return new a(new RGBA(210,180,140,1));case"teal":return new a(new RGBA(0,128,128,1));case"thistle":return new a(new RGBA(216,191,216,1));case"tomato":return new a(new RGBA(255,99,71,1));case"turquoise":return new a(new RGBA(64,224,208,1));case"violet":return new a(new RGBA(238,130,238,1));case"wheat":return new a(new RGBA(245,222,179,1));case"white":return new a(new RGBA(255,255,255,1));case"whitesmoke":return new a(new RGBA(245,245,245,1));case"yellow":return new a(new RGBA(255,255,0,1));case"yellowgreen":return new a(new RGBA(154,205,50,1));default:return null}}function m(C){const b=C.length;if(b===0||C.charCodeAt(0)!==35)return null;if(b===7){const v=16*_(C.charCodeAt(1))+_(C.charCodeAt(2)),S=16*_(C.charCodeAt(3))+_(C.charCodeAt(4)),y=16*_(C.charCodeAt(5))+_(C.charCodeAt(6));return new a(new RGBA(v,S,y,1))}if(b===9){const v=16*_(C.charCodeAt(1))+_(C.charCodeAt(2)),S=16*_(C.charCodeAt(3))+_(C.charCodeAt(4)),y=16*_(C.charCodeAt(5))+_(C.charCodeAt(6)),w=16*_(C.charCodeAt(7))+_(C.charCodeAt(8));return new a(new RGBA(v,S,y,w/255))}if(b===4){const v=_(C.charCodeAt(1)),S=_(C.charCodeAt(2)),y=_(C.charCodeAt(3));return new a(new RGBA(16*v+v,16*S+S,16*y+y))}if(b===5){const v=_(C.charCodeAt(1)),S=_(C.charCodeAt(2)),y=_(C.charCodeAt(3)),w=_(C.charCodeAt(4));return new a(new RGBA(16*v+v,16*S+S,16*y+y,(16*w+w)/255))}return null}t.parseHex=m;function _(C){switch(C){case 48:return 0;case 49:return 1;case 50:return 2;case 51:return 3;case 52:return 4;case 53:return 5;case 54:return 6;case 55:return 7;case 56:return 8;case 57:return 9;case 97:return 10;case 65:return 10;case 98:return 11;case 66:return 11;case 99:return 12;case 67:return 12;case 100:return 13;case 68:return 13;case 101:return 14;case 69:return 14;case 102:return 15;case 70:return 15}return 0}})(e.CSS||(e.CSS={}))})(a.Format||(a.Format={}))})(Color||(Color={}));function asCssVariableName(a){return`--vscode-${a.replace(/\./g,"-")}`}function asCssVariable(a){return`var(${asCssVariableName(a)})`}function asCssVariableWithDefault(a,e){return`var(${asCssVariableName(a)}, ${e})`}function isColorDefaults(a){return a!==null&&typeof a=="object"&&"light"in a&&"dark"in a}const Extensions$4={ColorContribution:"base.contributions.colors"},DEFAULT_COLOR_CONFIG_VALUE="default";class ColorRegistry extends Disposable{constructor(){super(),this._onDidChangeSchema=this._register(new Emitter$1),this.onDidChangeSchema=this._onDidChangeSchema.event,this.colorSchema={type:"object",properties:{}},this.colorReferenceSchema={type:"string",enum:[],enumDescriptions:[]},this.colorsById={}}registerColor(e,t,s,o=!1,r){const l={id:e,description:s,defaults:t,needsTransparency:o,deprecationMessage:r};this.colorsById[e]=l;const c={type:"string",format:"color-hex",defaultSnippets:[{body:"${1:#ff0000}"}]};return r&&(c.deprecationMessage=r),o&&(c.pattern="^#(?:(?<rgba>[0-9a-fA-f]{3}[0-9a-eA-E])|(?:[0-9a-fA-F]{6}(?:(?![fF]{2})(?:[0-9a-fA-F]{2}))))?$",c.patternErrorMessage=localize(2004,"This color must be transparent or it will obscure content")),this.colorSchema.properties[e]={description:s,oneOf:[c,{type:"string",const:DEFAULT_COLOR_CONFIG_VALUE,description:localize(2005,"Use the default color.")}]},this.colorReferenceSchema.enum.push(e),this.colorReferenceSchema.enumDescriptions.push(s),this._onDidChangeSchema.fire(),e}getColors(){return Object.keys(this.colorsById).map(e=>this.colorsById[e])}resolveDefaultColor(e,t){const s=this.colorsById[e];if(s!=null&&s.defaults){const o=isColorDefaults(s.defaults)?s.defaults[t.type]:s.defaults;return resolveColorValue(o,t)}}getColorSchema(){return this.colorSchema}toString(){const e=(t,s)=>{const o=t.indexOf(".")===-1?0:1,r=s.indexOf(".")===-1?0:1;return o!==r?o-r:t.localeCompare(s)};return Object.keys(this.colorsById).sort(e).map(t=>`- \`${t}\`: ${this.colorsById[t].description}`).join(`
`)}}const colorRegistry$1=new ColorRegistry;Registry.add(Extensions$4.ColorContribution,colorRegistry$1);function registerColor(a,e,t,s,o){return colorRegistry$1.registerColor(a,e,t,s,o)}function executeTransform(a,e){var t,s,o,r;switch(a.op){case 0:return(t=resolveColorValue(a.value,e))==null?void 0:t.darken(a.factor);case 1:return(s=resolveColorValue(a.value,e))==null?void 0:s.lighten(a.factor);case 2:return(o=resolveColorValue(a.value,e))==null?void 0:o.transparent(a.factor);case 7:{const l=resolveColorValue(a.color,e)||Color.transparent,c=resolveColorValue(a.with,e)||Color.transparent;return l.mix(c,a.ratio)}case 3:{const l=resolveColorValue(a.background,e);return l?(r=resolveColorValue(a.value,e))==null?void 0:r.makeOpaque(l):resolveColorValue(a.value,e)}case 4:for(const l of a.values){const c=resolveColorValue(l,e);if(c)return c}return;case 6:return resolveColorValue(e.defines(a.if)?a.then:a.else,e);case 5:{const l=resolveColorValue(a.value,e);if(!l)return;const c=resolveColorValue(a.background,e);return c?l.isDarkerThan(c)?Color.getLighterColor(l,c,a.factor).transparent(a.transparency):Color.getDarkerColor(l,c,a.factor).transparent(a.transparency):l.transparent(a.factor*a.transparency)}default:throw assertNever()}}function darken(a,e){return{op:0,value:a,factor:e}}function lighten(a,e){return{op:1,value:a,factor:e}}function transparent(a,e){return{op:2,value:a,factor:e}}function oneOf(...a){return{op:4,values:a}}function ifDefinedThenElse(a,e,t){return{op:6,if:a,then:e,else:t}}function lessProminent(a,e,t,s){return{op:5,value:a,background:e,factor:t,transparency:s}}function resolveColorValue(a,e){if(a!==null){if(typeof a=="string")return a[0]==="#"?Color.fromHex(a):e.getColor(a);if(a instanceof Color)return a;if(typeof a=="object")return executeTransform(a,e)}}const workbenchColorsSchemaId="vscode://schemas/workbench-colors",schemaRegistry$1=Registry.as(Extensions$7.JSONContribution);schemaRegistry$1.registerSchema(workbenchColorsSchemaId,colorRegistry$1.getColorSchema());const delayer$1=new RunOnceScheduler(()=>schemaRegistry$1.notifySchemaChanged(workbenchColorsSchemaId),200);colorRegistry$1.onDidChangeSchema(()=>{delayer$1.isScheduled()||delayer$1.schedule()});const foreground=registerColor("foreground",{dark:"#CCCCCC",light:"#616161",hcDark:"#FFFFFF",hcLight:"#292929"},localize(1756,"Overall foreground color. This color is only used if not overridden by a component."));registerColor("disabledForeground",{dark:"#CCCCCC80",light:"#61616180",hcDark:"#A5A5A5",hcLight:"#7F7F7F"},localize(1757,"Overall foreground for disabled elements. This color is only used if not overridden by a component."));registerColor("errorForeground",{dark:"#F48771",light:"#A1260D",hcDark:"#F48771",hcLight:"#B5200D"},localize(1758,"Overall foreground color for error messages. This color is only used if not overridden by a component."));const descriptionForeground=registerColor("descriptionForeground",{light:"#717171",dark:transparent(foreground,.7),hcDark:transparent(foreground,.7),hcLight:transparent(foreground,.7)},localize(1759,"Foreground color for description text providing additional information, for example for a label.")),iconForeground=registerColor("icon.foreground",{dark:"#C5C5C5",light:"#424242",hcDark:"#FFFFFF",hcLight:"#292929"},localize(1760,"The default color for icons in the workbench.")),focusBorder=registerColor("focusBorder",{dark:"#007FD4",light:"#0090F1",hcDark:"#F38518",hcLight:"#006BBD"},localize(1761,"Overall border color for focused elements. This color is only used if not overridden by a component.")),contrastBorder=registerColor("contrastBorder",{light:null,dark:null,hcDark:"#6FC3DF",hcLight:"#0F4A85"},localize(1762,"An extra border around elements to separate them from others for greater contrast.")),activeContrastBorder=registerColor("contrastActiveBorder",{light:null,dark:null,hcDark:focusBorder,hcLight:focusBorder},localize(1763,"An extra border around active elements to separate them from others for greater contrast."));registerColor("selection.background",null,localize(1764,"The background color of text selections in the workbench (e.g. for input fields or text areas). Note that this does not apply to selections within the editor."));const textLinkForeground=registerColor("textLink.foreground",{light:"#006AB1",dark:"#3794FF",hcDark:"#21A6FF",hcLight:"#0F4A85"},localize(1765,"Foreground color for links in text."));registerColor("textLink.activeForeground",{light:"#006AB1",dark:"#3794FF",hcDark:"#21A6FF",hcLight:"#0F4A85"},localize(1766,"Foreground color for links in text when clicked on and on mouse hover."));registerColor("textSeparator.foreground",{light:"#0000002e",dark:"#ffffff2e",hcDark:Color.black,hcLight:"#292929"},localize(1767,"Color for text separators."));registerColor("textPreformat.foreground",{light:"#A31515",dark:"#D7BA7D",hcDark:"#000000",hcLight:"#FFFFFF"},localize(1768,"Foreground color for preformatted text segments."));registerColor("textPreformat.background",{light:"#0000001A",dark:"#FFFFFF1A",hcDark:"#FFFFFF",hcLight:"#09345f"},localize(1769,"Background color for preformatted text segments."));registerColor("textBlockQuote.background",{light:"#f2f2f2",dark:"#222222",hcDark:null,hcLight:"#F2F2F2"},localize(1770,"Background color for block quotes in text."));registerColor("textBlockQuote.border",{light:"#007acc80",dark:"#007acc80",hcDark:Color.white,hcLight:"#292929"},localize(1771,"Border color for block quotes in text."));registerColor("textCodeBlock.background",{light:"#dcdcdc66",dark:"#0a0a0a66",hcDark:Color.black,hcLight:"#F2F2F2"},localize(1772,"Background color for code blocks in text."));registerColor("sash.hoverBorder",focusBorder,localize(1977,"Border color of active sashes."));const badgeBackground=registerColor("badge.background",{dark:"#4D4D4D",light:"#C4C4C4",hcDark:Color.black,hcLight:"#0F4A85"},localize(1978,"Badge background color. Badges are small information labels, e.g. for search results count.")),badgeForeground=registerColor("badge.foreground",{dark:Color.white,light:"#333",hcDark:Color.white,hcLight:Color.white},localize(1979,"Badge foreground color. Badges are small information labels, e.g. for search results count."));registerColor("activityWarningBadge.foreground",{dark:Color.black.lighten(.2),light:Color.white,hcDark:null,hcLight:Color.black.lighten(.2)},localize(1980,"Foreground color of the warning activity badge"));registerColor("activityWarningBadge.background",{dark:"#CCA700",light:"#BF8803",hcDark:null,hcLight:"#CCA700"},localize(1981,"Background color of the warning activity badge"));registerColor("activityErrorBadge.foreground",{dark:Color.black.lighten(.2),light:Color.white,hcDark:null,hcLight:Color.black.lighten(.2)},localize(1982,"Foreground color of the error activity badge"));registerColor("activityErrorBadge.background",{dark:"#F14C4C",light:"#E51400",hcDark:null,hcLight:"#F14C4C"},localize(1983,"Background color of the error activity badge"));const scrollbarShadow=registerColor("scrollbar.shadow",{dark:"#000000",light:"#DDDDDD",hcDark:null,hcLight:null},localize(1984,"Scrollbar shadow to indicate that the view is scrolled.")),scrollbarSliderBackground=registerColor("scrollbarSlider.background",{dark:Color.fromHex("#797979").transparent(.4),light:Color.fromHex("#646464").transparent(.4),hcDark:transparent(contrastBorder,.6),hcLight:transparent(contrastBorder,.4)},localize(1985,"Scrollbar slider background color.")),scrollbarSliderHoverBackground=registerColor("scrollbarSlider.hoverBackground",{dark:Color.fromHex("#646464").transparent(.7),light:Color.fromHex("#646464").transparent(.7),hcDark:transparent(contrastBorder,.8),hcLight:transparent(contrastBorder,.8)},localize(1986,"Scrollbar slider background color when hovering.")),scrollbarSliderActiveBackground=registerColor("scrollbarSlider.activeBackground",{dark:Color.fromHex("#BFBFBF").transparent(.4),light:Color.fromHex("#000000").transparent(.6),hcDark:contrastBorder,hcLight:contrastBorder},localize(1987,"Scrollbar slider background color when clicked on.")),progressBarBackground=registerColor("progressBar.background",{dark:Color.fromHex("#0E70C0"),light:Color.fromHex("#0E70C0"),hcDark:contrastBorder,hcLight:contrastBorder},localize(1988,"Background color of the progress bar that can show for long running operations."));registerColor("chart.line",{dark:"#236B8E",light:"#236B8E",hcDark:"#236B8E",hcLight:"#236B8E"},localize(1989,"Line color for the chart."));registerColor("chart.axis",{dark:Color.fromHex("#BFBFBF").transparent(.4),light:Color.fromHex("#000000").transparent(.6),hcDark:contrastBorder,hcLight:contrastBorder},localize(1990,"Axis color for the chart."));registerColor("chart.guide",{dark:Color.fromHex("#BFBFBF").transparent(.2),light:Color.fromHex("#000000").transparent(.2),hcDark:contrastBorder,hcLight:contrastBorder},localize(1991,"Guide line for the chart."));const editorBackground=registerColor("editor.background",{light:"#ffffff",dark:"#1E1E1E",hcDark:Color.black,hcLight:Color.white},localize(1781,"Editor background color.")),editorForeground=registerColor("editor.foreground",{light:"#333333",dark:"#BBBBBB",hcDark:Color.white,hcLight:foreground},localize(1782,"Editor default foreground color."));registerColor("editorStickyScroll.background",editorBackground,localize(1783,"Background color of sticky scroll in the editor"));registerColor("editorStickyScrollGutter.background",editorBackground,localize(1784,"Background color of the gutter part of sticky scroll in the editor"));registerColor("editorStickyScrollHover.background",{dark:"#2A2D2E",light:"#F0F0F0",hcDark:null,hcLight:Color.fromHex("#0F4A85").transparent(.1)},localize(1785,"Background color of sticky scroll on hover in the editor"));registerColor("editorStickyScroll.border",{dark:null,light:null,hcDark:contrastBorder,hcLight:contrastBorder},localize(1786,"Border color of sticky scroll in the editor"));registerColor("editorStickyScroll.shadow",scrollbarShadow,localize(1787," Shadow color of sticky scroll in the editor"));const editorWidgetBackground=registerColor("editorWidget.background",{dark:"#252526",light:"#F3F3F3",hcDark:"#0C141F",hcLight:Color.white},localize(1788,"Background color of editor widgets, such as find/replace.")),editorWidgetForeground=registerColor("editorWidget.foreground",foreground,localize(1789,"Foreground color of editor widgets, such as find/replace.")),editorWidgetBorder=registerColor("editorWidget.border",{dark:"#454545",light:"#C8C8C8",hcDark:contrastBorder,hcLight:contrastBorder},localize(1790,"Border color of editor widgets. The color is only used if the widget chooses to have a border and if the color is not overridden by a widget."));registerColor("editorWidget.resizeBorder",null,localize(1791,"Border color of the resize bar of editor widgets. The color is only used if the widget chooses to have a resize border and if the color is not overridden by a widget."));registerColor("editorError.background",null,localize(1792,"Background color of error text in the editor. The color must not be opaque so as not to hide underlying decorations."),!0);const editorErrorForeground=registerColor("editorError.foreground",{dark:"#F14C4C",light:"#E51400",hcDark:"#F48771",hcLight:"#B5200D"},localize(1793,"Foreground color of error squigglies in the editor.")),editorErrorBorder=registerColor("editorError.border",{dark:null,light:null,hcDark:Color.fromHex("#E47777").transparent(.8),hcLight:"#B5200D"},localize(1794,"If set, color of double underlines for errors in the editor.")),editorWarningBackground=registerColor("editorWarning.background",null,localize(1795,"Background color of warning text in the editor. The color must not be opaque so as not to hide underlying decorations."),!0),editorWarningForeground=registerColor("editorWarning.foreground",{dark:"#CCA700",light:"#BF8803",hcDark:"#FFD370",hcLight:"#895503"},localize(1796,"Foreground color of warning squigglies in the editor.")),editorWarningBorder=registerColor("editorWarning.border",{dark:null,light:null,hcDark:Color.fromHex("#FFCC00").transparent(.8),hcLight:Color.fromHex("#FFCC00").transparent(.8)},localize(1797,"If set, color of double underlines for warnings in the editor."));registerColor("editorInfo.background",null,localize(1798,"Background color of info text in the editor. The color must not be opaque so as not to hide underlying decorations."),!0);const editorInfoForeground=registerColor("editorInfo.foreground",{dark:"#3794FF",light:"#1a85ff",hcDark:"#3794FF",hcLight:"#1a85ff"},localize(1799,"Foreground color of info squigglies in the editor.")),editorInfoBorder=registerColor("editorInfo.border",{dark:null,light:null,hcDark:Color.fromHex("#3794FF").transparent(.8),hcLight:"#292929"},localize(1800,"If set, color of double underlines for infos in the editor.")),editorHintForeground=registerColor("editorHint.foreground",{dark:Color.fromHex("#eeeeee").transparent(.7),light:"#6c6c6c",hcDark:null,hcLight:null},localize(1801,"Foreground color of hint squigglies in the editor."));registerColor("editorHint.border",{dark:null,light:null,hcDark:Color.fromHex("#eeeeee").transparent(.8),hcLight:"#292929"},localize(1802,"If set, color of double underlines for hints in the editor."));const editorActiveLinkForeground=registerColor("editorLink.activeForeground",{dark:"#4E94CE",light:Color.blue,hcDark:Color.cyan,hcLight:"#292929"},localize(1803,"Color of active links.")),editorSelectionBackground=registerColor("editor.selectionBackground",{light:"#ADD6FF",dark:"#264F78",hcDark:"#f3f518",hcLight:"#0F4A85"},localize(1804,"Color of the editor selection.")),editorSelectionForeground=registerColor("editor.selectionForeground",{light:null,dark:null,hcDark:"#000000",hcLight:Color.white},localize(1805,"Color of the selected text for high contrast.")),editorInactiveSelection=registerColor("editor.inactiveSelectionBackground",{light:transparent(editorSelectionBackground,.5),dark:transparent(editorSelectionBackground,.5),hcDark:transparent(editorSelectionBackground,.7),hcLight:transparent(editorSelectionBackground,.5)},localize(1806,"Color of the selection in an inactive editor. The color must not be opaque so as not to hide underlying decorations."),!0),editorSelectionHighlight=registerColor("editor.selectionHighlightBackground",{light:lessProminent(editorSelectionBackground,editorBackground,.3,.6),dark:lessProminent(editorSelectionBackground,editorBackground,.3,.6),hcDark:null,hcLight:null},localize(1807,"Color for regions with the same content as the selection. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("editor.selectionHighlightBorder",{light:null,dark:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize(1808,"Border color for regions with the same content as the selection."));registerColor("editor.compositionBorder",{light:"#000000",dark:"#ffffff",hcLight:"#000000",hcDark:"#ffffff"},localize(1809,"The border color for an IME composition."));registerColor("editor.findMatchBackground",{light:"#A8AC94",dark:"#515C6A",hcDark:null,hcLight:null},localize(1810,"Color of the current search match."));const editorFindMatchForeground=registerColor("editor.findMatchForeground",null,localize(1811,"Text color of the current search match.")),editorFindMatchHighlight=registerColor("editor.findMatchHighlightBackground",{light:"#EA5C0055",dark:"#EA5C0055",hcDark:null,hcLight:null},localize(1812,"Color of the other search matches. The color must not be opaque so as not to hide underlying decorations."),!0),editorFindMatchHighlightForeground=registerColor("editor.findMatchHighlightForeground",null,localize(1813,"Foreground color of the other search matches."),!0);registerColor("editor.findRangeHighlightBackground",{dark:"#3a3d4166",light:"#b4b4b44d",hcDark:null,hcLight:null},localize(1814,"Color of the range limiting the search. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("editor.findMatchBorder",{light:null,dark:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize(1815,"Border color of the current search match."));const editorFindMatchHighlightBorder=registerColor("editor.findMatchHighlightBorder",{light:null,dark:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize(1816,"Border color of the other search matches.")),editorFindRangeHighlightBorder=registerColor("editor.findRangeHighlightBorder",{dark:null,light:null,hcDark:transparent(activeContrastBorder,.4),hcLight:transparent(activeContrastBorder,.4)},localize(1817,"Border color of the range limiting the search. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("editor.hoverHighlightBackground",{light:"#ADD6FF26",dark:"#264f7840",hcDark:"#ADD6FF26",hcLight:null},localize(1818,"Highlight below the word for which a hover is shown. The color must not be opaque so as not to hide underlying decorations."),!0);const editorHoverBackground=registerColor("editorHoverWidget.background",editorWidgetBackground,localize(1819,"Background color of the editor hover.")),editorHoverForeground=registerColor("editorHoverWidget.foreground",editorWidgetForeground,localize(1820,"Foreground color of the editor hover.")),editorHoverBorder=registerColor("editorHoverWidget.border",editorWidgetBorder,localize(1821,"Border color of the editor hover."));registerColor("editorHoverWidget.statusBarBackground",{dark:lighten(editorHoverBackground,.2),light:darken(editorHoverBackground,.05),hcDark:editorWidgetBackground,hcLight:editorWidgetBackground},localize(1822,"Background color of the editor hover status bar."));const editorInlayHintForeground=registerColor("editorInlayHint.foreground",{dark:"#969696",light:"#969696",hcDark:Color.white,hcLight:Color.black},localize(1823,"Foreground color of inline hints")),editorInlayHintBackground=registerColor("editorInlayHint.background",{dark:transparent(badgeBackground,.1),light:transparent(badgeBackground,.1),hcDark:transparent(Color.white,.1),hcLight:transparent(badgeBackground,.1)},localize(1824,"Background color of inline hints")),editorInlayHintTypeForeground=registerColor("editorInlayHint.typeForeground",editorInlayHintForeground,localize(1825,"Foreground color of inline hints for types")),editorInlayHintTypeBackground=registerColor("editorInlayHint.typeBackground",editorInlayHintBackground,localize(1826,"Background color of inline hints for types")),editorInlayHintParameterForeground=registerColor("editorInlayHint.parameterForeground",editorInlayHintForeground,localize(1827,"Foreground color of inline hints for parameters")),editorInlayHintParameterBackground=registerColor("editorInlayHint.parameterBackground",editorInlayHintBackground,localize(1828,"Background color of inline hints for parameters")),editorLightBulbForeground=registerColor("editorLightBulb.foreground",{dark:"#FFCC00",light:"#DDB100",hcDark:"#FFCC00",hcLight:"#007ACC"},localize(1829,"The color used for the lightbulb actions icon."));registerColor("editorLightBulbAutoFix.foreground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},localize(1830,"The color used for the lightbulb auto fix actions icon."));registerColor("editorLightBulbAi.foreground",editorLightBulbForeground,localize(1831,"The color used for the lightbulb AI icon."));registerColor("editor.snippetTabstopHighlightBackground",{dark:new Color(new RGBA(124,124,124,.3)),light:new Color(new RGBA(10,50,100,.2)),hcDark:new Color(new RGBA(124,124,124,.3)),hcLight:new Color(new RGBA(10,50,100,.2))},localize(1832,"Highlight background color of a snippet tabstop."));registerColor("editor.snippetTabstopHighlightBorder",null,localize(1833,"Highlight border color of a snippet tabstop."));registerColor("editor.snippetFinalTabstopHighlightBackground",null,localize(1834,"Highlight background color of the final tabstop of a snippet."));registerColor("editor.snippetFinalTabstopHighlightBorder",{dark:"#525252",light:new Color(new RGBA(10,50,100,.5)),hcDark:"#525252",hcLight:"#292929"},localize(1835,"Highlight border color of the final tabstop of a snippet."));const defaultInsertColor=new Color(new RGBA(155,185,85,.2)),defaultRemoveColor=new Color(new RGBA(255,0,0,.2)),diffInserted=registerColor("diffEditor.insertedTextBackground",{dark:"#9ccc2c33",light:"#9ccc2c40",hcDark:null,hcLight:null},localize(1836,"Background color for text that got inserted. The color must not be opaque so as not to hide underlying decorations."),!0),diffRemoved=registerColor("diffEditor.removedTextBackground",{dark:"#ff000033",light:"#ff000033",hcDark:null,hcLight:null},localize(1837,"Background color for text that got removed. The color must not be opaque so as not to hide underlying decorations."),!0),diffInsertedLine=registerColor("diffEditor.insertedLineBackground",{dark:defaultInsertColor,light:defaultInsertColor,hcDark:null,hcLight:null},localize(1838,"Background color for lines that got inserted. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("diffEditor.removedLineBackground",{dark:defaultRemoveColor,light:defaultRemoveColor,hcDark:null,hcLight:null},localize(1839,"Background color for lines that got removed. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("diffEditorGutter.insertedLineBackground",null,localize(1840,"Background color for the margin where lines got inserted."));registerColor("diffEditorGutter.removedLineBackground",null,localize(1841,"Background color for the margin where lines got removed."));const diffOverviewRulerInserted=registerColor("diffEditorOverview.insertedForeground",null,localize(1842,"Diff overview ruler foreground for inserted content.")),diffOverviewRulerRemoved=registerColor("diffEditorOverview.removedForeground",null,localize(1843,"Diff overview ruler foreground for removed content."));registerColor("diffEditor.insertedTextBorder",{dark:null,light:null,hcDark:"#33ff2eff",hcLight:"#374E06"},localize(1844,"Outline color for the text that got inserted."));registerColor("diffEditor.removedTextBorder",{dark:null,light:null,hcDark:"#FF008F",hcLight:"#AD0707"},localize(1845,"Outline color for text that got removed."));registerColor("diffEditor.border",{dark:null,light:null,hcDark:contrastBorder,hcLight:contrastBorder},localize(1846,"Border color between the two text editors."));registerColor("diffEditor.diagonalFill",{dark:"#cccccc33",light:"#22222233",hcDark:null,hcLight:null},localize(1847,"Color of the diff editor's diagonal fill. The diagonal fill is used in side-by-side diff views."));registerColor("diffEditor.unchangedRegionBackground","sideBar.background",localize(1848,"The background color of unchanged blocks in the diff editor."));registerColor("diffEditor.unchangedRegionForeground","foreground",localize(1849,"The foreground color of unchanged blocks in the diff editor."));registerColor("diffEditor.unchangedCodeBackground",{dark:"#74747429",light:"#b8b8b829",hcDark:null,hcLight:null},localize(1850,"The background color of unchanged code in the diff editor."));const widgetShadow=registerColor("widget.shadow",{dark:transparent(Color.black,.36),light:transparent(Color.black,.16),hcDark:null,hcLight:null},localize(1851,"Shadow color of widgets such as find/replace inside the editor.")),widgetBorder=registerColor("widget.border",{dark:null,light:null,hcDark:contrastBorder,hcLight:contrastBorder},localize(1852,"Border color of widgets such as find/replace inside the editor.")),toolbarHoverBackground=registerColor("toolbar.hoverBackground",{dark:"#5a5d5e50",light:"#b8b8b850",hcDark:null,hcLight:null},localize(1853,"Toolbar background when hovering over actions using the mouse"));registerColor("toolbar.hoverOutline",{dark:null,light:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize(1854,"Toolbar outline when hovering over actions using the mouse"));registerColor("toolbar.activeBackground",{dark:lighten(toolbarHoverBackground,.1),light:darken(toolbarHoverBackground,.1),hcDark:null,hcLight:null},localize(1855,"Toolbar background when holding the mouse over actions"));const breadcrumbsForeground=registerColor("breadcrumb.foreground",transparent(foreground,.8),localize(1856,"Color of focused breadcrumb items.")),breadcrumbsBackground=registerColor("breadcrumb.background",editorBackground,localize(1857,"Background color of breadcrumb items.")),breadcrumbsFocusForeground=registerColor("breadcrumb.focusForeground",{light:darken(foreground,.2),dark:lighten(foreground,.1),hcDark:lighten(foreground,.1),hcLight:lighten(foreground,.1)},localize(1858,"Color of focused breadcrumb items.")),breadcrumbsActiveSelectionForeground=registerColor("breadcrumb.activeSelectionForeground",{light:darken(foreground,.2),dark:lighten(foreground,.1),hcDark:lighten(foreground,.1),hcLight:lighten(foreground,.1)},localize(1859,"Color of selected breadcrumb items."));registerColor("breadcrumbPicker.background",editorWidgetBackground,localize(1860,"Background color of breadcrumb item picker."));const headerTransparency=.5,currentBaseColor=Color.fromHex("#40C8AE").transparent(headerTransparency),incomingBaseColor=Color.fromHex("#40A6FF").transparent(headerTransparency),commonBaseColor=Color.fromHex("#606060").transparent(.4),contentTransparency=.4,rulerTransparency=1,mergeCurrentHeaderBackground=registerColor("merge.currentHeaderBackground",{dark:currentBaseColor,light:currentBaseColor,hcDark:null,hcLight:null},localize(1861,"Current header background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("merge.currentContentBackground",transparent(mergeCurrentHeaderBackground,contentTransparency),localize(1862,"Current content background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0);const mergeIncomingHeaderBackground=registerColor("merge.incomingHeaderBackground",{dark:incomingBaseColor,light:incomingBaseColor,hcDark:null,hcLight:null},localize(1863,"Incoming header background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("merge.incomingContentBackground",transparent(mergeIncomingHeaderBackground,contentTransparency),localize(1864,"Incoming content background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0);const mergeCommonHeaderBackground=registerColor("merge.commonHeaderBackground",{dark:commonBaseColor,light:commonBaseColor,hcDark:null,hcLight:null},localize(1865,"Common ancestor header background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("merge.commonContentBackground",transparent(mergeCommonHeaderBackground,contentTransparency),localize(1866,"Common ancestor content background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0);const mergeBorder=registerColor("merge.border",{dark:null,light:null,hcDark:"#C3DF6F",hcLight:"#007ACC"},localize(1867,"Border color on headers and the splitter in inline merge-conflicts."));registerColor("editorOverviewRuler.currentContentForeground",{dark:transparent(mergeCurrentHeaderBackground,rulerTransparency),light:transparent(mergeCurrentHeaderBackground,rulerTransparency),hcDark:mergeBorder,hcLight:mergeBorder},localize(1868,"Current overview ruler foreground for inline merge-conflicts."));registerColor("editorOverviewRuler.incomingContentForeground",{dark:transparent(mergeIncomingHeaderBackground,rulerTransparency),light:transparent(mergeIncomingHeaderBackground,rulerTransparency),hcDark:mergeBorder,hcLight:mergeBorder},localize(1869,"Incoming overview ruler foreground for inline merge-conflicts."));registerColor("editorOverviewRuler.commonContentForeground",{dark:transparent(mergeCommonHeaderBackground,rulerTransparency),light:transparent(mergeCommonHeaderBackground,rulerTransparency),hcDark:mergeBorder,hcLight:mergeBorder},localize(1870,"Common ancestor overview ruler foreground for inline merge-conflicts."));const overviewRulerFindMatchForeground=registerColor("editorOverviewRuler.findMatchForeground",{dark:"#d186167e",light:"#d186167e",hcDark:"#AB5A00",hcLight:"#AB5A00"},localize(1871,"Overview ruler marker color for find matches. The color must not be opaque so as not to hide underlying decorations."),!0),overviewRulerSelectionHighlightForeground=registerColor("editorOverviewRuler.selectionHighlightForeground","#A0A0A0CC",localize(1872,"Overview ruler marker color for selection highlights. The color must not be opaque so as not to hide underlying decorations."),!0),problemsErrorIconForeground=registerColor("problemsErrorIcon.foreground",editorErrorForeground,localize(1873,"The color used for the problems error icon.")),problemsWarningIconForeground=registerColor("problemsWarningIcon.foreground",editorWarningForeground,localize(1874,"The color used for the problems warning icon.")),problemsInfoIconForeground=registerColor("problemsInfoIcon.foreground",editorInfoForeground,localize(1875,"The color used for the problems info icon.")),minimapFindMatch=registerColor("minimap.findMatchHighlight",{light:"#d18616",dark:"#d18616",hcDark:"#AB5A00",hcLight:"#0F4A85"},localize(1966,"Minimap marker color for find matches."),!0),minimapSelectionOccurrenceHighlight=registerColor("minimap.selectionOccurrenceHighlight",{light:"#c9c9c9",dark:"#676767",hcDark:"#ffffff",hcLight:"#0F4A85"},localize(1967,"Minimap marker color for repeating editor selections."),!0),minimapSelection=registerColor("minimap.selectionHighlight",{light:"#ADD6FF",dark:"#264F78",hcDark:"#ffffff",hcLight:"#0F4A85"},localize(1968,"Minimap marker color for the editor selection."),!0),minimapInfo=registerColor("minimap.infoHighlight",{dark:editorInfoForeground,light:editorInfoForeground,hcDark:editorInfoBorder,hcLight:editorInfoBorder},localize(1969,"Minimap marker color for infos.")),minimapWarning=registerColor("minimap.warningHighlight",{dark:editorWarningForeground,light:editorWarningForeground,hcDark:editorWarningBorder,hcLight:editorWarningBorder},localize(1970,"Minimap marker color for warnings.")),minimapError=registerColor("minimap.errorHighlight",{dark:new Color(new RGBA(255,18,18,.7)),light:new Color(new RGBA(255,18,18,.7)),hcDark:new Color(new RGBA(255,50,50,1)),hcLight:"#B5200D"},localize(1971,"Minimap marker color for errors.")),minimapBackground=registerColor("minimap.background",null,localize(1972,"Minimap background color.")),minimapForegroundOpacity=registerColor("minimap.foregroundOpacity",Color.fromHex("#000f"),localize(1973,'Opacity of foreground elements rendered in the minimap. For example, "#000000c0" will render the elements with 75% opacity.'));registerColor("minimapSlider.background",transparent(scrollbarSliderBackground,.5),localize(1974,"Minimap slider background color."));registerColor("minimapSlider.hoverBackground",transparent(scrollbarSliderHoverBackground,.5),localize(1975,"Minimap slider background color when hovering."));registerColor("minimapSlider.activeBackground",transparent(scrollbarSliderActiveBackground,.5),localize(1976,"Minimap slider background color when clicked on."));registerColor("charts.foreground",foreground,localize(1773,"The foreground color used in charts."));registerColor("charts.lines",transparent(foreground,.5),localize(1774,"The color used for horizontal lines in charts."));registerColor("charts.red",editorErrorForeground,localize(1775,"The red color used in chart visualizations."));registerColor("charts.blue",editorInfoForeground,localize(1776,"The blue color used in chart visualizations."));registerColor("charts.yellow",editorWarningForeground,localize(1777,"The yellow color used in chart visualizations."));registerColor("charts.orange",minimapFindMatch,localize(1778,"The orange color used in chart visualizations."));registerColor("charts.green",{dark:"#89D185",light:"#388A34",hcDark:"#89D185",hcLight:"#374e06"},localize(1779,"The green color used in chart visualizations."));registerColor("charts.purple",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},localize(1780,"The purple color used in chart visualizations."));const inputBackground=registerColor("input.background",{dark:"#3C3C3C",light:Color.white,hcDark:Color.black,hcLight:Color.white},localize(1876,"Input box background.")),inputForeground=registerColor("input.foreground",foreground,localize(1877,"Input box foreground.")),inputBorder=registerColor("input.border",{dark:null,light:null,hcDark:contrastBorder,hcLight:contrastBorder},localize(1878,"Input box border.")),inputActiveOptionBorder=registerColor("inputOption.activeBorder",{dark:"#007ACC",light:"#007ACC",hcDark:contrastBorder,hcLight:contrastBorder},localize(1879,"Border color of activated options in input fields.")),inputActiveOptionHoverBackground=registerColor("inputOption.hoverBackground",{dark:"#5a5d5e80",light:"#b8b8b850",hcDark:null,hcLight:null},localize(1880,"Background color of activated options in input fields.")),inputActiveOptionBackground=registerColor("inputOption.activeBackground",{dark:transparent(focusBorder,.4),light:transparent(focusBorder,.2),hcDark:Color.transparent,hcLight:Color.transparent},localize(1881,"Background hover color of options in input fields.")),inputActiveOptionForeground=registerColor("inputOption.activeForeground",{dark:Color.white,light:Color.black,hcDark:foreground,hcLight:foreground},localize(1882,"Foreground color of activated options in input fields."));registerColor("input.placeholderForeground",{light:transparent(foreground,.5),dark:transparent(foreground,.5),hcDark:transparent(foreground,.7),hcLight:transparent(foreground,.7)},localize(1883,"Input box foreground color for placeholder text."));const inputValidationInfoBackground=registerColor("inputValidation.infoBackground",{dark:"#063B49",light:"#D6ECF2",hcDark:Color.black,hcLight:Color.white},localize(1884,"Input validation background color for information severity.")),inputValidationInfoForeground=registerColor("inputValidation.infoForeground",{dark:null,light:null,hcDark:null,hcLight:foreground},localize(1885,"Input validation foreground color for information severity.")),inputValidationInfoBorder=registerColor("inputValidation.infoBorder",{dark:"#007acc",light:"#007acc",hcDark:contrastBorder,hcLight:contrastBorder},localize(1886,"Input validation border color for information severity.")),inputValidationWarningBackground=registerColor("inputValidation.warningBackground",{dark:"#352A05",light:"#F6F5D2",hcDark:Color.black,hcLight:Color.white},localize(1887,"Input validation background color for warning severity.")),inputValidationWarningForeground=registerColor("inputValidation.warningForeground",{dark:null,light:null,hcDark:null,hcLight:foreground},localize(1888,"Input validation foreground color for warning severity.")),inputValidationWarningBorder=registerColor("inputValidation.warningBorder",{dark:"#B89500",light:"#B89500",hcDark:contrastBorder,hcLight:contrastBorder},localize(1889,"Input validation border color for warning severity.")),inputValidationErrorBackground=registerColor("inputValidation.errorBackground",{dark:"#5A1D1D",light:"#F2DEDE",hcDark:Color.black,hcLight:Color.white},localize(1890,"Input validation background color for error severity.")),inputValidationErrorForeground=registerColor("inputValidation.errorForeground",{dark:null,light:null,hcDark:null,hcLight:foreground},localize(1891,"Input validation foreground color for error severity.")),inputValidationErrorBorder=registerColor("inputValidation.errorBorder",{dark:"#BE1100",light:"#BE1100",hcDark:contrastBorder,hcLight:contrastBorder},localize(1892,"Input validation border color for error severity.")),selectBackground=registerColor("dropdown.background",{dark:"#3C3C3C",light:Color.white,hcDark:Color.black,hcLight:Color.white},localize(1893,"Dropdown background.")),selectListBackground=registerColor("dropdown.listBackground",{dark:null,light:null,hcDark:Color.black,hcLight:Color.white},localize(1894,"Dropdown list background.")),selectForeground=registerColor("dropdown.foreground",{dark:"#F0F0F0",light:foreground,hcDark:Color.white,hcLight:foreground},localize(1895,"Dropdown foreground.")),selectBorder=registerColor("dropdown.border",{dark:selectBackground,light:"#CECECE",hcDark:contrastBorder,hcLight:contrastBorder},localize(1896,"Dropdown border.")),buttonForeground=registerColor("button.foreground",Color.white,localize(1897,"Button foreground color.")),buttonSeparator=registerColor("button.separator",transparent(buttonForeground,.4),localize(1898,"Button separator color.")),buttonBackground=registerColor("button.background",{dark:"#0E639C",light:"#007ACC",hcDark:null,hcLight:"#0F4A85"},localize(1899,"Button background color.")),buttonHoverBackground=registerColor("button.hoverBackground",{dark:lighten(buttonBackground,.2),light:darken(buttonBackground,.2),hcDark:buttonBackground,hcLight:buttonBackground},localize(1900,"Button background color when hovering.")),buttonBorder=registerColor("button.border",contrastBorder,localize(1901,"Button border color.")),buttonSecondaryForeground=registerColor("button.secondaryForeground",{dark:Color.white,light:Color.white,hcDark:Color.white,hcLight:foreground},localize(1902,"Secondary button foreground color.")),buttonSecondaryBackground=registerColor("button.secondaryBackground",{dark:"#3A3D41",light:"#5F6A79",hcDark:null,hcLight:Color.white},localize(1903,"Secondary button background color.")),buttonSecondaryHoverBackground=registerColor("button.secondaryHoverBackground",{dark:lighten(buttonSecondaryBackground,.2),light:darken(buttonSecondaryBackground,.2),hcDark:null,hcLight:null},localize(1904,"Secondary button background color when hovering.")),radioActiveForeground=registerColor("radio.activeForeground",inputActiveOptionForeground,localize(1905,"Foreground color of active radio option.")),radioActiveBackground=registerColor("radio.activeBackground",inputActiveOptionBackground,localize(1906,"Background color of active radio option.")),radioActiveBorder=registerColor("radio.activeBorder",inputActiveOptionBorder,localize(1907,"Border color of the active radio option.")),radioInactiveForeground=registerColor("radio.inactiveForeground",null,localize(1908,"Foreground color of inactive radio option.")),radioInactiveBackground=registerColor("radio.inactiveBackground",null,localize(1909,"Background color of inactive radio option.")),radioInactiveBorder=registerColor("radio.inactiveBorder",{light:transparent(radioActiveForeground,.2),dark:transparent(radioActiveForeground,.2),hcDark:transparent(radioActiveForeground,.4),hcLight:transparent(radioActiveForeground,.2)},localize(1910,"Border color of the inactive radio option.")),radioInactiveHoverBackground=registerColor("radio.inactiveHoverBackground",inputActiveOptionHoverBackground,localize(1911,"Background color of inactive active radio option when hovering.")),checkboxBackground=registerColor("checkbox.background",selectBackground,localize(1912,"Background color of checkbox widget."));registerColor("checkbox.selectBackground",editorWidgetBackground,localize(1913,"Background color of checkbox widget when the element it's in is selected."));const checkboxForeground=registerColor("checkbox.foreground",selectForeground,localize(1914,"Foreground color of checkbox widget.")),checkboxBorder=registerColor("checkbox.border",selectBorder,localize(1915,"Border color of checkbox widget."));registerColor("checkbox.selectBorder",iconForeground,localize(1916,"Border color of checkbox widget when the element it's in is selected."));const checkboxDisabledBackground=registerColor("checkbox.disabled.background",{op:7,color:checkboxBackground,with:checkboxForeground,ratio:.33},localize(1917,"Background of a disabled checkbox.")),checkboxDisabledForeground=registerColor("checkbox.disabled.foreground",{op:7,color:checkboxForeground,with:checkboxBackground,ratio:.33},localize(1918,"Foreground of a disabled checkbox.")),keybindingLabelBackground=registerColor("keybindingLabel.background",{dark:new Color(new RGBA(128,128,128,.17)),light:new Color(new RGBA(221,221,221,.4)),hcDark:Color.transparent,hcLight:Color.transparent},localize(1919,"Keybinding label background color. The keybinding label is used to represent a keyboard shortcut.")),keybindingLabelForeground=registerColor("keybindingLabel.foreground",{dark:Color.fromHex("#CCCCCC"),light:Color.fromHex("#555555"),hcDark:Color.white,hcLight:foreground},localize(1920,"Keybinding label foreground color. The keybinding label is used to represent a keyboard shortcut.")),keybindingLabelBorder=registerColor("keybindingLabel.border",{dark:new Color(new RGBA(51,51,51,.6)),light:new Color(new RGBA(204,204,204,.4)),hcDark:new Color(new RGBA(111,195,223)),hcLight:contrastBorder},localize(1921,"Keybinding label border color. The keybinding label is used to represent a keyboard shortcut.")),keybindingLabelBottomBorder=registerColor("keybindingLabel.bottomBorder",{dark:new Color(new RGBA(68,68,68,.6)),light:new Color(new RGBA(187,187,187,.4)),hcDark:new Color(new RGBA(111,195,223)),hcLight:foreground},localize(1922,"Keybinding label border bottom color. The keybinding label is used to represent a keyboard shortcut.")),listFocusBackground=registerColor("list.focusBackground",null,localize(1923,"List/Tree background color for the focused item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),listFocusForeground=registerColor("list.focusForeground",null,localize(1924,"List/Tree foreground color for the focused item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),listFocusOutline=registerColor("list.focusOutline",{dark:focusBorder,light:focusBorder,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize(1925,"List/Tree outline color for the focused item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),listFocusAndSelectionOutline=registerColor("list.focusAndSelectionOutline",null,localize(1926,"List/Tree outline color for the focused item when the list/tree is active and selected. An active list/tree has keyboard focus, an inactive does not.")),listActiveSelectionBackground=registerColor("list.activeSelectionBackground",{dark:"#04395E",light:"#0060C0",hcDark:null,hcLight:Color.fromHex("#0F4A85").transparent(.1)},localize(1927,"List/Tree background color for the selected item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),listActiveSelectionForeground=registerColor("list.activeSelectionForeground",{dark:Color.white,light:Color.white,hcDark:null,hcLight:null},localize(1928,"List/Tree foreground color for the selected item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),listActiveSelectionIconForeground=registerColor("list.activeSelectionIconForeground",null,localize(1929,"List/Tree icon foreground color for the selected item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),listInactiveSelectionBackground=registerColor("list.inactiveSelectionBackground",{dark:"#37373D",light:"#E4E6F1",hcDark:null,hcLight:Color.fromHex("#0F4A85").transparent(.1)},localize(1930,"List/Tree background color for the selected item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),listInactiveSelectionForeground=registerColor("list.inactiveSelectionForeground",null,localize(1931,"List/Tree foreground color for the selected item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),listInactiveSelectionIconForeground=registerColor("list.inactiveSelectionIconForeground",null,localize(1932,"List/Tree icon foreground color for the selected item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),listInactiveFocusBackground=registerColor("list.inactiveFocusBackground",null,localize(1933,"List/Tree background color for the focused item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),listInactiveFocusOutline=registerColor("list.inactiveFocusOutline",null,localize(1934,"List/Tree outline color for the focused item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),listHoverBackground=registerColor("list.hoverBackground",{dark:"#2A2D2E",light:"#F0F0F0",hcDark:Color.white.transparent(.1),hcLight:Color.fromHex("#0F4A85").transparent(.1)},localize(1935,"List/Tree background when hovering over items using the mouse.")),listHoverForeground=registerColor("list.hoverForeground",null,localize(1936,"List/Tree foreground when hovering over items using the mouse.")),listDropOverBackground=registerColor("list.dropBackground",{dark:"#062F4A",light:"#D6EBFF",hcDark:null,hcLight:null},localize(1937,"List/Tree drag and drop background when moving items over other items when using the mouse.")),listDropBetweenBackground=registerColor("list.dropBetweenBackground",{dark:iconForeground,light:iconForeground,hcDark:null,hcLight:null},localize(1938,"List/Tree drag and drop border color when moving items between items when using the mouse.")),listHighlightForeground=registerColor("list.highlightForeground",{dark:"#2AAAFF",light:"#0066BF",hcDark:focusBorder,hcLight:focusBorder},localize(1939,"List/Tree foreground color of the match highlights when searching inside the list/tree.")),listFocusHighlightForeground=registerColor("list.focusHighlightForeground",{dark:listHighlightForeground,light:ifDefinedThenElse(listActiveSelectionBackground,listHighlightForeground,"#BBE7FF"),hcDark:listHighlightForeground,hcLight:listHighlightForeground},localize(1940,"List/Tree foreground color of the match highlights on actively focused items when searching inside the list/tree."));registerColor("list.invalidItemForeground",{dark:"#B89500",light:"#B89500",hcDark:"#B89500",hcLight:"#B5200D"},localize(1941,"List/Tree foreground color for invalid items, for example an unresolved root in explorer."));registerColor("list.errorForeground",{dark:"#F88070",light:"#B01011",hcDark:null,hcLight:null},localize(1942,"Foreground color of list items containing errors."));registerColor("list.warningForeground",{dark:"#CCA700",light:"#855F00",hcDark:null,hcLight:null},localize(1943,"Foreground color of list items containing warnings."));const listFilterWidgetBackground=registerColor("listFilterWidget.background",{light:darken(editorWidgetBackground,0),dark:lighten(editorWidgetBackground,0),hcDark:editorWidgetBackground,hcLight:editorWidgetBackground},localize(1944,"Background color of the type filter widget in lists and trees.")),listFilterWidgetOutline=registerColor("listFilterWidget.outline",{dark:Color.transparent,light:Color.transparent,hcDark:"#f38518",hcLight:"#007ACC"},localize(1945,"Outline color of the type filter widget in lists and trees.")),listFilterWidgetNoMatchesOutline=registerColor("listFilterWidget.noMatchesOutline",{dark:"#BE1100",light:"#BE1100",hcDark:contrastBorder,hcLight:contrastBorder},localize(1946,"Outline color of the type filter widget in lists and trees, when there are no matches.")),listFilterWidgetShadow=registerColor("listFilterWidget.shadow",widgetShadow,localize(1947,"Shadow color of the type filter widget in lists and trees."));registerColor("list.filterMatchBackground",{dark:editorFindMatchHighlight,light:editorFindMatchHighlight,hcDark:null,hcLight:null},localize(1948,"Background color of the filtered match."));registerColor("list.filterMatchBorder",{dark:editorFindMatchHighlightBorder,light:editorFindMatchHighlightBorder,hcDark:contrastBorder,hcLight:activeContrastBorder},localize(1949,"Border color of the filtered match."));registerColor("list.deemphasizedForeground",{dark:"#8C8C8C",light:"#8E8E90",hcDark:"#A7A8A9",hcLight:"#666666"},localize(1950,"List/Tree foreground color for items that are deemphasized."));const treeIndentGuidesStroke=registerColor("tree.indentGuidesStroke",{dark:"#585858",light:"#a9a9a9",hcDark:"#a9a9a9",hcLight:"#a5a5a5"},localize(1951,"Tree stroke color for the indentation guides.")),treeInactiveIndentGuidesStroke=registerColor("tree.inactiveIndentGuidesStroke",transparent(treeIndentGuidesStroke,.4),localize(1952,"Tree stroke color for the indentation guides that are not active.")),tableColumnsBorder=registerColor("tree.tableColumnsBorder",{dark:"#CCCCCC20",light:"#61616120",hcDark:null,hcLight:null},localize(1953,"Table border color between columns.")),tableOddRowsBackgroundColor=registerColor("tree.tableOddRowsBackground",{dark:transparent(foreground,.04),light:transparent(foreground,.04),hcDark:null,hcLight:null},localize(1954,"Background color for odd table rows."));registerColor("editorActionList.background",editorWidgetBackground,localize(1955,"Action List background color."));const editorActionListForeground=registerColor("editorActionList.foreground",editorWidgetForeground,localize(1956,"Action List foreground color."));registerColor("editorActionList.focusForeground",listActiveSelectionForeground,localize(1957,"Action List foreground color for the focused item."));registerColor("editorActionList.focusBackground",listActiveSelectionBackground,localize(1958,"Action List background color for the focused item."));const menuBorder=registerColor("menu.border",{dark:null,light:null,hcDark:contrastBorder,hcLight:contrastBorder},localize(1959,"Border color of menus.")),menuForeground=registerColor("menu.foreground",selectForeground,localize(1960,"Foreground color of menu items.")),menuBackground=registerColor("menu.background",selectBackground,localize(1961,"Background color of menu items.")),menuSelectionForeground=registerColor("menu.selectionForeground",listActiveSelectionForeground,localize(1962,"Foreground color of the selected menu item in menus.")),menuSelectionBackground=registerColor("menu.selectionBackground",listActiveSelectionBackground,localize(1963,"Background color of the selected menu item in menus.")),menuSelectionBorder=registerColor("menu.selectionBorder",{dark:null,light:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize(1964,"Border color of the selected menu item in menus.")),menuSeparatorBackground=registerColor("menu.separatorBackground",{dark:"#606060",light:"#D4D4D4",hcDark:contrastBorder,hcLight:contrastBorder},localize(1965,"Color of a separator menu item in menus.")),quickInputBackground=registerColor("quickInput.background",editorWidgetBackground,localize(1992,"Quick picker background color. The quick picker widget is the container for pickers like the command palette.")),quickInputForeground=registerColor("quickInput.foreground",editorWidgetForeground,localize(1993,"Quick picker foreground color. The quick picker widget is the container for pickers like the command palette.")),quickInputTitleBackground=registerColor("quickInputTitle.background",{dark:new Color(new RGBA(255,255,255,.105)),light:new Color(new RGBA(0,0,0,.06)),hcDark:"#000000",hcLight:Color.white},localize(1994,"Quick picker title background color. The quick picker widget is the container for pickers like the command palette.")),pickerGroupForeground=registerColor("pickerGroup.foreground",{dark:"#3794FF",light:"#0066BF",hcDark:Color.white,hcLight:"#0F4A85"},localize(1995,"Quick picker color for grouping labels.")),pickerGroupBorder=registerColor("pickerGroup.border",{dark:"#3F3F46",light:"#CCCEDB",hcDark:Color.white,hcLight:"#0F4A85"},localize(1996,"Quick picker color for grouping borders.")),_deprecatedQuickInputListFocusBackground=registerColor("quickInput.list.focusBackground",null,"",void 0,localize(1997,"Please use quickInputList.focusBackground instead")),quickInputListFocusForeground=registerColor("quickInputList.focusForeground",listActiveSelectionForeground,localize(1998,"Quick picker foreground color for the focused item.")),quickInputListFocusIconForeground=registerColor("quickInputList.focusIconForeground",listActiveSelectionIconForeground,localize(1999,"Quick picker icon foreground color for the focused item.")),quickInputListFocusBackground=registerColor("quickInputList.focusBackground",{dark:oneOf(_deprecatedQuickInputListFocusBackground,listActiveSelectionBackground),light:oneOf(_deprecatedQuickInputListFocusBackground,listActiveSelectionBackground),hcDark:null,hcLight:null},localize(2e3,"Quick picker background color for the focused item."));registerColor("search.resultsInfoForeground",{light:foreground,dark:transparent(foreground,.65),hcDark:foreground,hcLight:foreground},localize(2001,"Color of the text in the search viewlet's completion message."));registerColor("searchEditor.findMatchBackground",{light:transparent(editorFindMatchHighlight,.66),dark:transparent(editorFindMatchHighlight,.66),hcDark:editorFindMatchHighlight,hcLight:editorFindMatchHighlight},localize(2002,"Color of the Search Editor query matches."));registerColor("searchEditor.findMatchBorder",{light:transparent(editorFindMatchHighlightBorder,.66),dark:transparent(editorFindMatchHighlightBorder,.66),hcDark:editorFindMatchHighlightBorder,hcLight:editorFindMatchHighlightBorder},localize(2003,"Border color of the Search Editor query matches."));class PageCoordinates{constructor(e,t){this.x=e,this.y=t,this._pageCoordinatesBrand=void 0}toClientCoordinates(e){return new ClientCoordinates(this.x-e.scrollX,this.y-e.scrollY)}}class ClientCoordinates{constructor(e,t){this.clientX=e,this.clientY=t,this._clientCoordinatesBrand=void 0}toPageCoordinates(e){return new PageCoordinates(this.clientX+e.scrollX,this.clientY+e.scrollY)}}class EditorPagePosition{constructor(e,t,s,o){this.x=e,this.y=t,this.width=s,this.height=o,this._editorPagePositionBrand=void 0}}class CoordinatesRelativeToEditor{constructor(e,t){this.x=e,this.y=t,this._positionRelativeToEditorBrand=void 0}}function createEditorPagePosition(a){const e=getDomNodePagePosition(a);return new EditorPagePosition(e.left,e.top,e.width,e.height)}function createCoordinatesRelativeToEditor(a,e,t){const s=e.width/a.offsetWidth,o=e.height/a.offsetHeight,r=(t.x-e.x)/s,l=(t.y-e.y)/o;return new CoordinatesRelativeToEditor(r,l)}class EditorMouseEvent extends StandardMouseEvent{constructor(e,t,s){super(getWindow(s),e),this._editorMouseEventBrand=void 0,this.isFromPointerCapture=t,this.pos=new PageCoordinates(this.posx,this.posy),this.editorPos=createEditorPagePosition(s),this.relativePos=createCoordinatesRelativeToEditor(s,this.editorPos,this.pos)}}class EditorMouseEventFactory{constructor(e){this._editorViewDomNode=e}_create(e){return new EditorMouseEvent(e,!1,this._editorViewDomNode)}onContextMenu(e,t){return addDisposableListener(e,EventType$1.CONTEXT_MENU,s=>{t(this._create(s))})}onMouseUp(e,t){return addDisposableListener(e,EventType$1.MOUSE_UP,s=>{t(this._create(s))})}onMouseDown(e,t){return addDisposableListener(e,EventType$1.MOUSE_DOWN,s=>{t(this._create(s))})}onPointerDown(e,t){return addDisposableListener(e,EventType$1.POINTER_DOWN,s=>{t(this._create(s),s.pointerId)})}onMouseLeave(e,t){return addDisposableListener(e,EventType$1.MOUSE_LEAVE,s=>{t(this._create(s))})}onMouseMove(e,t){return addDisposableListener(e,EventType$1.MOUSE_MOVE,s=>t(this._create(s)))}}class EditorPointerEventFactory{constructor(e){this._editorViewDomNode=e}_create(e){return new EditorMouseEvent(e,!1,this._editorViewDomNode)}onPointerUp(e,t){return addDisposableListener(e,"pointerup",s=>{t(this._create(s))})}onPointerDown(e,t){return addDisposableListener(e,EventType$1.POINTER_DOWN,s=>{t(this._create(s),s.pointerId)})}onPointerLeave(e,t){return addDisposableListener(e,EventType$1.POINTER_LEAVE,s=>{t(this._create(s))})}onPointerMove(e,t){return addDisposableListener(e,"pointermove",s=>t(this._create(s)))}}class GlobalEditorPointerMoveMonitor extends Disposable{constructor(e){super(),this._editorViewDomNode=e,this._globalPointerMoveMonitor=this._register(new GlobalPointerMoveMonitor),this._keydownListener=null}startMonitoring(e,t,s,o,r){this._keydownListener=addStandardDisposableListener(e.ownerDocument,"keydown",l=>{l.toKeyCodeChord().isModifierKey()||this._globalPointerMoveMonitor.stopMonitoring(!0,l.browserEvent)},!0),this._globalPointerMoveMonitor.startMonitoring(e,t,s,l=>{o(new EditorMouseEvent(l,!0,this._editorViewDomNode))},l=>{this._keydownListener.dispose(),r(l)})}stopMonitoring(){this._globalPointerMoveMonitor.stopMonitoring(!0)}}const ns=class ns{constructor(e){this._editor=e,this._instanceId=++ns._idPool,this._counter=0,this._rules=new DisposableMap,this._garbageCollectionScheduler=new RunOnceScheduler(()=>this.garbageCollect(),1e3)}dispose(){this._rules.dispose(),this._garbageCollectionScheduler.dispose()}createClassNameRef(e){const t=this.getOrCreateRule(e);return t.increaseRefCount(),{className:t.className,dispose:()=>{t.decreaseRefCount(),this._garbageCollectionScheduler.schedule()}}}getOrCreateRule(e){const t=this.computeUniqueKey(e);let s=this._rules.get(t);if(!s){const o=this._counter++;s=new RefCountedCssRule(t,`dyn-rule-${this._instanceId}-${o}`,isInShadowDOM(this._editor.getContainerDomNode())?this._editor.getContainerDomNode():void 0,e),this._rules.set(t,s)}return s}computeUniqueKey(e){return JSON.stringify(e)}garbageCollect(){for(const e of this._rules.values())e.hasReferences()||this._rules.deleteAndDispose(e.key)}};ns._idPool=0;let DynamicCssRules=ns;class RefCountedCssRule{constructor(e,t,s,o){this.key=e,this.className=t,this.properties=o,this._referenceCount=0,this._styleElementDisposables=new DisposableStore,this._styleElement=createStyleSheet(s,void 0,this._styleElementDisposables),this._styleElement.textContent=this.getCssText(this.className,this.properties)}getCssText(e,t){let s=`.${e} {`;for(const o in t){const r=t[o];let l;typeof r=="object"?l=asCssVariable(r.id):l=r;const c=camelToDashes(o);s+=`
	${c}: ${l};`}return s+=`
}`,s}dispose(){this._styleElementDisposables.dispose(),this._styleElement=void 0}increaseRefCount(){this._referenceCount++}decreaseRefCount(){this._referenceCount--}hasReferences(){return this._referenceCount>0}}function camelToDashes(a){return a.replace(/(^[A-Z])/,([e])=>e.toLowerCase()).replace(/([A-Z])/g,([e])=>`-${e.toLowerCase()}`)}class ViewEventHandler extends Disposable{constructor(){super(),this._shouldRender=!0}shouldRender(){return this._shouldRender}forceShouldRender(){this._shouldRender=!0}setShouldRender(){this._shouldRender=!0}onDidRender(){this._shouldRender=!1}onCompositionStart(e){return!1}onCompositionEnd(e){return!1}onConfigurationChanged(e){return!1}onCursorStateChanged(e){return!1}onDecorationsChanged(e){return!1}onFlushed(e){return!1}onFocusChanged(e){return!1}onLanguageConfigurationChanged(e){return!1}onLineMappingChanged(e){return!1}onLinesChanged(e){return!1}onLinesDeleted(e){return!1}onLinesInserted(e){return!1}onRevealRangeRequest(e){return!1}onScrollChanged(e){return!1}onThemeChanged(e){return!1}onTokensChanged(e){return!1}onTokensColorsChanged(e){return!1}onZonesChanged(e){return!1}handleEvents(e){let t=!1;for(let s=0,o=e.length;s<o;s++){const r=e[s];switch(r.type){case 0:this.onCompositionStart(r)&&(t=!0);break;case 1:this.onCompositionEnd(r)&&(t=!0);break;case 2:this.onConfigurationChanged(r)&&(t=!0);break;case 3:this.onCursorStateChanged(r)&&(t=!0);break;case 4:this.onDecorationsChanged(r)&&(t=!0);break;case 5:this.onFlushed(r)&&(t=!0);break;case 6:this.onFocusChanged(r)&&(t=!0);break;case 7:this.onLanguageConfigurationChanged(r)&&(t=!0);break;case 8:this.onLineMappingChanged(r)&&(t=!0);break;case 9:this.onLinesChanged(r)&&(t=!0);break;case 10:this.onLinesDeleted(r)&&(t=!0);break;case 11:this.onLinesInserted(r)&&(t=!0);break;case 12:this.onRevealRangeRequest(r)&&(t=!0);break;case 13:this.onScrollChanged(r)&&(t=!0);break;case 15:this.onTokensChanged(r)&&(t=!0);break;case 14:this.onThemeChanged(r)&&(t=!0);break;case 16:this.onTokensColorsChanged(r)&&(t=!0);break;case 17:this.onZonesChanged(r)&&(t=!0);break;default:console.info("View received unknown event: "),console.info(r)}}t&&(this._shouldRender=!0)}}class ViewPart extends ViewEventHandler{constructor(e){super(),this._context=e,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}}class PartFingerprints{static write(e,t){e.setAttribute("data-mprt",String(t))}static read(e){const t=e.getAttribute("data-mprt");return t===null?0:parseInt(t,10)}static collect(e,t){const s=[];let o=0;for(;e&&e!==e.ownerDocument.body&&e!==t;)e.nodeType===e.ELEMENT_NODE&&(s[o++]=this.read(e)),e=e.parentElement;const r=new Uint8Array(o);for(let l=0;l<o;l++)r[l]=s[o-l-1];return r}}class RestrictedRenderingContext{constructor(e,t){this._restrictedRenderingContextBrand=void 0,this._viewLayout=e,this.viewportData=t,this.scrollWidth=this._viewLayout.getScrollWidth(),this.scrollHeight=this._viewLayout.getScrollHeight(),this.visibleRange=this.viewportData.visibleRange,this.bigNumbersDelta=this.viewportData.bigNumbersDelta;const s=this._viewLayout.getCurrentViewport();this.scrollTop=s.top,this.scrollLeft=s.left,this.viewportWidth=s.width,this.viewportHeight=s.height}getScrolledTopFromAbsoluteTop(e){return e-this.scrollTop}getVerticalOffsetForLineNumber(e,t){return this._viewLayout.getVerticalOffsetForLineNumber(e,t)}getVerticalOffsetAfterLineNumber(e,t){return this._viewLayout.getVerticalOffsetAfterLineNumber(e,t)}getLineHeightForLineNumber(e){return this._viewLayout.getLineHeightForLineNumber(e)}getDecorationsInViewport(){return this.viewportData.getDecorationsInViewport()}}class RenderingContext extends RestrictedRenderingContext{constructor(e,t,s,o){super(e,t),this._renderingContextBrand=void 0,this._viewLines=s,this._viewLinesGpu=o}linesVisibleRangesForRange(e,t){const s=this._viewLines.linesVisibleRangesForRange(e,t);if(!this._viewLinesGpu)return s??null;const o=this._viewLinesGpu.linesVisibleRangesForRange(e,t);return s?o?s.concat(o).sort((r,l)=>r.lineNumber-l.lineNumber):s:o}visibleRangeForPosition(e){var t;return this._viewLines.visibleRangeForPosition(e)??((t=this._viewLinesGpu)==null?void 0:t.visibleRangeForPosition(e))??null}}class LineVisibleRanges{constructor(e,t,s,o){this.outsideRenderedLine=e,this.lineNumber=t,this.ranges=s,this.continuesOnNextLine=o}}class HorizontalRange{static from(e){const t=new Array(e.length);for(let s=0,o=e.length;s<o;s++){const r=e[s];t[s]=new HorizontalRange(r.left,r.width)}return t}constructor(e,t){this._horizontalRangeBrand=void 0,this.left=Math.round(e),this.width=Math.round(t)}toString(){return`[${this.left},${this.width}]`}}class FloatHorizontalRange{constructor(e,t){this._floatHorizontalRangeBrand=void 0,this.left=e,this.width=t}toString(){return`[${this.left},${this.width}]`}static compare(e,t){return e.left-t.left}}class HorizontalPosition{constructor(e,t){this.outsideRenderedLine=e,this.originalLeft=t,this.left=Math.round(this.originalLeft)}}class VisibleRanges{constructor(e,t){this.outsideRenderedLine=e,this.ranges=t}}class RangeUtil{static _createRange(){return this._handyReadyRange||(this._handyReadyRange=document.createRange()),this._handyReadyRange}static _detachRange(e,t){e.selectNodeContents(t)}static _readClientRects(e,t,s,o,r){const l=this._createRange();try{return l.setStart(e,t),l.setEnd(s,o),l.getClientRects()}catch{return null}finally{this._detachRange(l,r)}}static _mergeAdjacentRanges(e){if(e.length===1)return e;e.sort(FloatHorizontalRange.compare);const t=[];let s=0,o=e[0];for(let r=1,l=e.length;r<l;r++){const c=e[r];o.left+o.width+.9>=c.left?o.width=Math.max(o.width,c.left+c.width-o.left):(t[s++]=o,o=c)}return t[s++]=o,t}static _createHorizontalRangesFromClientRects(e,t,s){if(!e||e.length===0)return null;const o=[];for(let r=0,l=e.length;r<l;r++){const c=e[r];o[r]=new FloatHorizontalRange(Math.max(0,(c.left-t)/s),c.width/s)}return this._mergeAdjacentRanges(o)}static readHorizontalRanges(e,t,s,o,r,l){const d=e.children.length-1;if(0>d)return null;if(t=Math.min(d,Math.max(0,t)),o=Math.min(d,Math.max(0,o)),t===o&&s===r&&s===0&&!e.children[t].firstChild){const p=e.children[t].getClientRects();return l.markDidDomLayout(),this._createHorizontalRangesFromClientRects(p,l.clientRectDeltaLeft,l.clientRectScale)}t!==o&&o>0&&r===0&&(o--,r=1073741824);let u=e.children[t].firstChild,g=e.children[o].firstChild;if((!u||!g)&&(!u&&s===0&&t>0&&(u=e.children[t-1].firstChild,s=1073741824),!g&&r===0&&o>0&&(g=e.children[o-1].firstChild,r=1073741824)),!u||!g)return null;s=Math.min(u.textContent.length,Math.max(0,s)),r=Math.min(g.textContent.length,Math.max(0,r));const f=this._readClientRects(u,s,g,r,l.endNode);return l.markDidDomLayout(),this._createHorizontalRangesFromClientRects(f,l.clientRectDeltaLeft,l.clientRectScale)}}class LineDecoration{constructor(e,t,s,o){this.startColumn=e,this.endColumn=t,this.className=s,this.type=o,this._lineDecorationBrand=void 0}static _equals(e,t){return e.startColumn===t.startColumn&&e.endColumn===t.endColumn&&e.className===t.className&&e.type===t.type}static equalsArr(e,t){const s=e.length,o=t.length;if(s!==o)return!1;for(let r=0;r<s;r++)if(!LineDecoration._equals(e[r],t[r]))return!1;return!0}static extractWrapped(e,t,s){if(e.length===0)return e;const o=t+1,r=s+1,l=s-t,c=[];let d=0;for(const u of e)u.endColumn<=o||u.startColumn>=r||(c[d++]=new LineDecoration(Math.max(1,u.startColumn-o+1),Math.min(l+1,u.endColumn-o+1),u.className,u.type));return c}static filter(e,t,s,o){if(e.length===0)return[];const r=[];let l=0;for(let c=0,d=e.length;c<d;c++){const u=e[c],g=u.range;if(g.endLineNumber<t||g.startLineNumber>t||g.isEmpty()&&(u.type===0||u.type===3))continue;const f=g.startLineNumber===t?g.startColumn:s,p=g.endLineNumber===t?g.endColumn:o;r[l++]=new LineDecoration(f,p,u.inlineClassName,u.type)}return r}static _typeCompare(e,t){const s=[2,0,1,3];return s[e]-s[t]}static compare(e,t){if(e.startColumn!==t.startColumn)return e.startColumn-t.startColumn;if(e.endColumn!==t.endColumn)return e.endColumn-t.endColumn;const s=LineDecoration._typeCompare(e.type,t.type);return s!==0?s:e.className!==t.className?e.className<t.className?-1:1:0}}class DecorationSegment{constructor(e,t,s,o){this.startOffset=e,this.endOffset=t,this.className=s,this.metadata=o}}class Stack{constructor(){this.stopOffsets=[],this.classNames=[],this.metadata=[],this.count=0}static _metadata(e){let t=0;for(let s=0,o=e.length;s<o;s++)t|=e[s];return t}consumeLowerThan(e,t,s){for(;this.count>0&&this.stopOffsets[0]<e;){let o=0;for(;o+1<this.count&&this.stopOffsets[o]===this.stopOffsets[o+1];)o++;s.push(new DecorationSegment(t,this.stopOffsets[o],this.classNames.join(" "),Stack._metadata(this.metadata))),t=this.stopOffsets[o]+1,this.stopOffsets.splice(0,o+1),this.classNames.splice(0,o+1),this.metadata.splice(0,o+1),this.count-=o+1}return this.count>0&&t<e&&(s.push(new DecorationSegment(t,e-1,this.classNames.join(" "),Stack._metadata(this.metadata))),t=e),t}insert(e,t,s){if(this.count===0||this.stopOffsets[this.count-1]<=e)this.stopOffsets.push(e),this.classNames.push(t),this.metadata.push(s);else for(let o=0;o<this.count;o++)if(this.stopOffsets[o]>=e){this.stopOffsets.splice(o,0,e),this.classNames.splice(o,0,t),this.metadata.splice(o,0,s);break}this.count++}}class LineDecorationsNormalizer{static normalize(e,t){if(t.length===0)return[];const s=[],o=new Stack;let r=0;for(let l=0,c=t.length;l<c;l++){const d=t[l];let u=d.startColumn,g=d.endColumn;const f=d.className,p=d.type===1?2:d.type===2?4:0;if(u>1){const C=e.charCodeAt(u-2);isHighSurrogate(C)&&u--}if(g>1){const C=e.charCodeAt(g-2);isHighSurrogate(C)&&g--}const m=u-1,_=g-2;r=o.consumeLowerThan(m,r,s),o.count===0&&(r=m),o.insert(_,f,p)}return o.consumeLowerThan(1073741824,r,s),s}}class LinePart{constructor(e,t,s,o){this.endIndex=e,this.type=t,this.metadata=s,this.containsRTL=o,this._linePartBrand=void 0}isWhitespace(){return!!(this.metadata&1)}isPseudoAfter(){return!!(this.metadata&4)}}class RenderLineInput{get isLTR(){return!this.containsRTL&&this.textDirection!==TextDirection$1.RTL}constructor(e,t,s,o,r,l,c,d,u,g,f,p,m,_,C,b,v,S,y,w,L,x=!1){this.useMonospaceOptimizations=e,this.canUseHalfwidthRightwardsArrow=t,this.lineContent=s,this.continuesWithWrappedLine=o,this.isBasicASCII=r,this.containsRTL=l,this.fauxIndentLength=c,this.lineTokens=d,this.lineDecorations=u.sort(LineDecoration.compare),this.tabSize=g,this.startVisibleColumn=f,this.spaceWidth=p,this.stopRenderingLineAfter=C,this.renderWhitespace=b==="all"?4:b==="boundary"?1:b==="selection"?2:b==="trailing"?3:0,this.renderControlCharacters=v,this.fontLigatures=S,this.selectionsOnLine=y&&y.sort((D,k)=>D.start<k.start?-1:1),this.renderNewLineWhenEmpty=x,this.textDirection=w,this.verticalScrollbarSize=L;const E=Math.abs(_-p),I=Math.abs(m-p);E<I?(this.renderSpaceWidth=_,this.renderSpaceCharCode=11825):(this.renderSpaceWidth=m,this.renderSpaceCharCode=183)}sameSelection(e){if(this.selectionsOnLine===null)return e===null;if(e===null||e.length!==this.selectionsOnLine.length)return!1;for(let t=0;t<this.selectionsOnLine.length;t++)if(!this.selectionsOnLine[t].equals(e[t]))return!1;return!0}equals(e){return this.useMonospaceOptimizations===e.useMonospaceOptimizations&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.lineContent===e.lineContent&&this.continuesWithWrappedLine===e.continuesWithWrappedLine&&this.isBasicASCII===e.isBasicASCII&&this.containsRTL===e.containsRTL&&this.fauxIndentLength===e.fauxIndentLength&&this.tabSize===e.tabSize&&this.startVisibleColumn===e.startVisibleColumn&&this.spaceWidth===e.spaceWidth&&this.renderSpaceWidth===e.renderSpaceWidth&&this.renderSpaceCharCode===e.renderSpaceCharCode&&this.stopRenderingLineAfter===e.stopRenderingLineAfter&&this.renderWhitespace===e.renderWhitespace&&this.renderControlCharacters===e.renderControlCharacters&&this.fontLigatures===e.fontLigatures&&LineDecoration.equalsArr(this.lineDecorations,e.lineDecorations)&&this.lineTokens.equals(e.lineTokens)&&this.sameSelection(e.selectionsOnLine)&&this.textDirection===e.textDirection&&this.verticalScrollbarSize===e.verticalScrollbarSize&&this.renderNewLineWhenEmpty===e.renderNewLineWhenEmpty}}class DomPosition{constructor(e,t){this.partIndex=e,this.charIndex=t}}class CharacterMapping{static getPartIndex(e){return(e&4294901760)>>>16}static getCharIndex(e){return(e&65535)>>>0}constructor(e,t){this.length=e,this._data=new Uint32Array(this.length),this._horizontalOffset=new Uint32Array(this.length)}setColumnInfo(e,t,s,o){const r=(t<<16|s<<0)>>>0;this._data[e-1]=r,this._horizontalOffset[e-1]=o}getHorizontalOffset(e){return this._horizontalOffset.length===0?0:this._horizontalOffset[e-1]}charOffsetToPartData(e){return this.length===0?0:e<0?this._data[0]:e>=this.length?this._data[this.length-1]:this._data[e]}getDomPosition(e){const t=this.charOffsetToPartData(e-1),s=CharacterMapping.getPartIndex(t),o=CharacterMapping.getCharIndex(t);return new DomPosition(s,o)}getColumn(e,t){return this.partDataToCharOffset(e.partIndex,t,e.charIndex)+1}partDataToCharOffset(e,t,s){if(this.length===0)return 0;const o=(e<<16|s<<0)>>>0;let r=0,l=this.length-1;for(;r+1<l;){const C=r+l>>>1,b=this._data[C];if(b===o)return C;b>o?l=C:r=C}if(r===l)return r;const c=this._data[r],d=this._data[l];if(c===o)return r;if(d===o)return l;const u=CharacterMapping.getPartIndex(c),g=CharacterMapping.getCharIndex(c),f=CharacterMapping.getPartIndex(d);let p;u!==f?p=t:p=CharacterMapping.getCharIndex(d);const m=s-g,_=p-s;return m<=_?r:l}}class RenderLineOutput{constructor(e,t){this._renderLineOutputBrand=void 0,this.characterMapping=e,this.containsForeignElements=t}}function renderViewLine(a,e){if(a.lineContent.length===0){if(a.lineDecorations.length>0){e.appendString("<span>");let t=0,s=0,o=0;for(const l of a.lineDecorations)(l.type===1||l.type===2)&&(e.appendString('<span class="'),e.appendString(l.className),e.appendString('"></span>'),l.type===1&&(o|=1,t++),l.type===2&&(o|=2,s++));e.appendString("</span>");const r=new CharacterMapping(1,t+s);return r.setColumnInfo(1,t,0,0),new RenderLineOutput(r,o)}return a.renderNewLineWhenEmpty?e.appendString(`<span><span>
</span></span>`):e.appendString("<span><span></span></span>"),new RenderLineOutput(new CharacterMapping(0,0),0)}return _renderLine(resolveRenderLineInput(a),e)}class RenderLineOutput2{constructor(e,t,s){this.characterMapping=e,this.html=t,this.containsForeignElements=s}}function renderViewLine2(a){const e=new StringBuilder(1e4),t=renderViewLine(a,e);return new RenderLineOutput2(t.characterMapping,e.build(),t.containsForeignElements)}class ResolvedRenderLineInput{constructor(e,t,s,o,r,l,c,d,u,g,f,p,m,_,C){this.fontIsMonospace=e,this.canUseHalfwidthRightwardsArrow=t,this.lineContent=s,this.len=o,this.isOverflowing=r,this.overflowingCharCount=l,this.parts=c,this.containsForeignElements=d,this.fauxIndentLength=u,this.tabSize=g,this.startVisibleColumn=f,this.spaceWidth=p,this.renderSpaceCharCode=m,this.renderWhitespace=_,this.renderControlCharacters=C}}function resolveRenderLineInput(a){const e=a.lineContent;let t,s,o;a.stopRenderingLineAfter!==-1&&a.stopRenderingLineAfter<e.length?(t=!0,s=e.length-a.stopRenderingLineAfter,o=a.stopRenderingLineAfter):(t=!1,s=0,o=e.length);let r=transformAndRemoveOverflowing(e,a.containsRTL,a.lineTokens,a.fauxIndentLength,o);a.renderControlCharacters&&!a.isBasicASCII&&(r=extractControlCharacters(e,r)),(a.renderWhitespace===4||a.renderWhitespace===1||a.renderWhitespace===2&&a.selectionsOnLine||a.renderWhitespace===3&&!a.continuesWithWrappedLine)&&(r=_applyRenderWhitespace(a,e,o,r));let l=0;if(a.lineDecorations.length>0){for(let c=0,d=a.lineDecorations.length;c<d;c++){const u=a.lineDecorations[c];u.type===3||u.type===1?l|=1:u.type===2&&(l|=2)}r=_applyInlineDecorations(e,o,r,a.lineDecorations)}return a.containsRTL||(r=splitLargeTokens(e,r,!a.isBasicASCII||a.fontLigatures)),new ResolvedRenderLineInput(a.useMonospaceOptimizations,a.canUseHalfwidthRightwardsArrow,e,o,t,s,r,l,a.fauxIndentLength,a.tabSize,a.startVisibleColumn,a.spaceWidth,a.renderSpaceCharCode,a.renderWhitespace,a.renderControlCharacters)}function transformAndRemoveOverflowing(a,e,t,s,o){const r=[];let l=0;s>0&&(r[l++]=new LinePart(s,"",0,!1));let c=s;for(let d=0,u=t.getCount();d<u;d++){const g=t.getEndOffset(d);if(g<=s)continue;const f=t.getClassName(d);if(g>=o){const m=e?containsRTL(a.substring(c,o)):!1;r[l++]=new LinePart(o,f,0,m);break}const p=e?containsRTL(a.substring(c,g)):!1;r[l++]=new LinePart(g,f,0,p),c=g}return r}function splitLargeTokens(a,e,t){let s=0;const o=[];let r=0;if(t)for(let l=0,c=e.length;l<c;l++){const d=e[l],u=d.endIndex;if(s+50<u){const g=d.type,f=d.metadata,p=d.containsRTL;let m=-1,_=s;for(let C=s;C<u;C++)a.charCodeAt(C)===32&&(m=C),m!==-1&&C-_>=50&&(o[r++]=new LinePart(m+1,g,f,p),_=m+1,m=-1);_!==u&&(o[r++]=new LinePart(u,g,f,p))}else o[r++]=d;s=u}else for(let l=0,c=e.length;l<c;l++){const d=e[l],u=d.endIndex,g=u-s;if(g>50){const f=d.type,p=d.metadata,m=d.containsRTL,_=Math.ceil(g/50);for(let C=1;C<_;C++){const b=s+C*50;o[r++]=new LinePart(b,f,p,m)}o[r++]=new LinePart(u,f,p,m)}else o[r++]=d;s=u}return o}function isControlCharacter(a){return a<32?a!==9:a===127||a>=8234&&a<=8238||a>=8294&&a<=8297||a>=8206&&a<=8207||a===1564}function extractControlCharacters(a,e){const t=[];let s=new LinePart(0,"",0,!1),o=0;for(const r of e){const l=r.endIndex;for(;o<l;o++){const c=a.charCodeAt(o);isControlCharacter(c)&&(o>s.endIndex&&(s=new LinePart(o,r.type,r.metadata,r.containsRTL),t.push(s)),s=new LinePart(o+1,"mtkcontrol",r.metadata,!1),t.push(s))}o>s.endIndex&&(s=new LinePart(l,r.type,r.metadata,r.containsRTL),t.push(s))}return t}function _applyRenderWhitespace(a,e,t,s){const o=a.continuesWithWrappedLine,r=a.fauxIndentLength,l=a.tabSize,c=a.startVisibleColumn,d=a.useMonospaceOptimizations,u=a.selectionsOnLine,g=a.renderWhitespace===1,f=a.renderWhitespace===3,p=a.renderSpaceWidth!==a.spaceWidth,m=[];let _=0,C=0,b=s[C].type,v=s[C].containsRTL,S=s[C].endIndex;const y=s.length;let w=!1,L=firstNonWhitespaceIndex(e),x;L===-1?(w=!0,L=t,x=t):x=lastNonWhitespaceIndex(e);let E=!1,I=0,D=u&&u[I],k=c%l;for(let R=r;R<t;R++){const M=e.charCodeAt(R);D&&D.endExclusive<=R&&(I++,D=u&&u[I]);let A;if(R<L||R>x)A=!0;else if(M===9)A=!0;else if(M===32)if(g)if(E)A=!0;else{const O=R+1<t?e.charCodeAt(R+1):0;A=O===32||O===9}else A=!0;else A=!1;if(A&&u&&(A=!!D&&D.start<=R&&R<D.endExclusive),A&&f&&(A=w||R>x),A&&v&&R>=L&&R<=x&&(A=!1),E){if(!A||!d&&k>=l){if(p){const O=_>0?m[_-1].endIndex:r;for(let P=O+1;P<=R;P++)m[_++]=new LinePart(P,"mtkw",1,!1)}else m[_++]=new LinePart(R,"mtkw",1,!1);k=k%l}}else(R===S||A&&R>r)&&(m[_++]=new LinePart(R,b,0,v),k=k%l);for(M===9?k=l:isFullWidthCharacter(M)?k+=2:k++,E=A;R===S&&(C++,C<y);)b=s[C].type,v=s[C].containsRTL,S=s[C].endIndex}let N=!1;if(E)if(o&&g){const R=t>0?e.charCodeAt(t-1):0,M=t>1?e.charCodeAt(t-2):0;R===32&&M!==32&&M!==9||(N=!0)}else N=!0;if(N)if(p){const R=_>0?m[_-1].endIndex:r;for(let M=R+1;M<=t;M++)m[_++]=new LinePart(M,"mtkw",1,!1)}else m[_++]=new LinePart(t,"mtkw",1,!1);else m[_++]=new LinePart(t,b,0,v);return m}function _applyInlineDecorations(a,e,t,s){s.sort(LineDecoration.compare);const o=LineDecorationsNormalizer.normalize(a,s),r=o.length;let l=0;const c=[];let d=0,u=0;for(let f=0,p=t.length;f<p;f++){const m=t[f],_=m.endIndex,C=m.type,b=m.metadata,v=m.containsRTL;for(;l<r&&o[l].startOffset<_;){const S=o[l];if(S.startOffset>u&&(u=S.startOffset,c[d++]=new LinePart(u,C,b,v)),S.endOffset+1<=_)u=S.endOffset+1,c[d++]=new LinePart(u,C+" "+S.className,b|S.metadata,v),l++;else{u=_,c[d++]=new LinePart(u,C+" "+S.className,b|S.metadata,v);break}}_>u&&(u=_,c[d++]=new LinePart(u,C,b,v))}const g=t[t.length-1].endIndex;if(l<r&&o[l].startOffset===g)for(;l<r&&o[l].startOffset===g;){const f=o[l];c[d++]=new LinePart(u,f.className,f.metadata,!1),l++}return c}function _renderLine(a,e){const t=a.fontIsMonospace,s=a.canUseHalfwidthRightwardsArrow,o=a.containsForeignElements,r=a.lineContent,l=a.len,c=a.isOverflowing,d=a.overflowingCharCount,u=a.parts,g=a.fauxIndentLength,f=a.tabSize,p=a.startVisibleColumn,m=a.spaceWidth,_=a.renderSpaceCharCode,C=a.renderWhitespace,b=a.renderControlCharacters,v=new CharacterMapping(l+1,u.length);let S=!1,y=0,w=p,L=0,x=0,E=0;e.appendString("<span>");for(let I=0,D=u.length;I<D;I++){const k=u[I],N=k.endIndex,R=k.type,M=k.containsRTL,A=C!==0&&k.isWhitespace(),O=A&&!t&&(R==="mtkw"||!o),P=y===N&&k.isPseudoAfter();if(L=0,e.appendString("<span "),M&&e.appendString('style="unicode-bidi:isolate" '),e.appendString('class="'),e.appendString(O?"mtkz":R),e.appendASCIICharCode(34),A){let W=0;{let B=y,H=w;for(;B<N;B++){const K=(r.charCodeAt(B)===9?f-H%f:1)|0;W+=K,B>=g&&(H+=K)}}for(O&&(e.appendString(' style="width:'),e.appendString(String(m*W)),e.appendString('px"')),e.appendASCIICharCode(62);y<N;y++){v.setColumnInfo(y+1,I-E,L,x),E=0;const B=r.charCodeAt(y);let H,V;if(B===9){H=f-w%f|0,V=H,!s||V>1?e.appendCharCode(8594):e.appendCharCode(65515);for(let K=2;K<=V;K++)e.appendCharCode(160)}else H=2,V=1,e.appendCharCode(_),e.appendCharCode(8204);L+=H,x+=V,y>=g&&(w+=V)}}else for(e.appendASCIICharCode(62);y<N;y++){v.setColumnInfo(y+1,I-E,L,x),E=0;const W=r.charCodeAt(y);let B=1,H=1;switch(W){case 9:B=f-w%f,H=B;for(let V=1;V<=B;V++)e.appendCharCode(160);break;case 32:e.appendCharCode(160);break;case 60:e.appendString("&lt;");break;case 62:e.appendString("&gt;");break;case 38:e.appendString("&amp;");break;case 0:b?e.appendCharCode(9216):e.appendString("&#00;");break;case 65279:case 8232:case 8233:case 133:e.appendCharCode(65533);break;default:isFullWidthCharacter(W)&&H++,b&&W<32?e.appendCharCode(9216+W):b&&W===127?e.appendCharCode(9249):b&&isControlCharacter(W)?(e.appendString("[U+"),e.appendString(to4CharHex(W)),e.appendString("]"),B=8,H=B):e.appendCharCode(W)}L+=B,x+=H,y>=g&&(w+=H)}P?E++:E=0,y>=l&&!S&&k.isPseudoAfter()&&(S=!0,v.setColumnInfo(y+1,I,L,x)),e.appendString("</span>")}return S||v.setColumnInfo(l+1,u.length-1,L,x),c&&(e.appendString('<span class="mtkoverflow">'),e.appendString(localize(792,"Show more ({0})",renderOverflowingCharCount(d))),e.appendString("</span>")),e.appendString("</span>"),new RenderLineOutput(v,o)}function to4CharHex(a){return a.toString(16).toUpperCase().padStart(4,"0")}function renderOverflowingCharCount(a){return a<1024?localize(793,"{0} chars",a):a<1024*1024?`${(a/1024).toFixed(1)} KB`:`${(a/1024/1024).toFixed(1)} MB`}var ColorScheme;(function(a){a.DARK="dark",a.LIGHT="light",a.HIGH_CONTRAST_DARK="hcDark",a.HIGH_CONTRAST_LIGHT="hcLight"})(ColorScheme||(ColorScheme={}));var ThemeTypeSelector;(function(a){a.VS="vs",a.VS_DARK="vs-dark",a.HC_BLACK="hc-black",a.HC_LIGHT="hc-light"})(ThemeTypeSelector||(ThemeTypeSelector={}));function isHighContrast(a){return a===ColorScheme.HIGH_CONTRAST_DARK||a===ColorScheme.HIGH_CONTRAST_LIGHT}function isDark(a){return a===ColorScheme.DARK||a===ColorScheme.HIGH_CONTRAST_DARK}const canUseFastRenderedViewLine=function(){return isNative?!0:!(isLinux||isFirefox$1||isSafari$1)}();let monospaceAssumptionsAreValid=!0;const ss=class ss{constructor(e,t){this._viewGpuContext=e,this._options=t,this._isMaybeInvalid=!0,this._renderedViewLine=null}getDomNode(){return this._renderedViewLine&&this._renderedViewLine.domNode?this._renderedViewLine.domNode.domNode:null}setDomNode(e){if(this._renderedViewLine)this._renderedViewLine.domNode=createFastDomNode(e);else throw new Error("I have no rendered view line to set the dom node to...")}onContentChanged(){this._isMaybeInvalid=!0}onTokensChanged(){this._isMaybeInvalid=!0}onDecorationsChanged(){this._isMaybeInvalid=!0}onOptionsChanged(e){this._isMaybeInvalid=!0,this._options=e}onSelectionChanged(){var e;return isHighContrast(this._options.themeType)||((e=this._renderedViewLine)==null?void 0:e.input.renderWhitespace)===2?(this._isMaybeInvalid=!0,!0):!1}renderLine(e,t,s,o,r){var C,b,v;if(this._options.useGpu&&((C=this._viewGpuContext)!=null&&C.canRender(this._options,o,e)))return(v=(b=this._renderedViewLine)==null?void 0:b.domNode)==null||v.domNode.remove(),this._renderedViewLine=null,!1;if(this._isMaybeInvalid===!1)return!1;this._isMaybeInvalid=!1;const l=o.getViewLineRenderingData(e),c=this._options,d=LineDecoration.filter(l.inlineDecorations,e,l.minColumn,l.maxColumn),u=l.hasVariableFonts||c.experimentalWhitespaceRendering==="off"?c.renderWhitespace:"none",g=!l.hasVariableFonts;let f=null;if(isHighContrast(c.themeType)||u==="selection"){const S=o.selections;for(const y of S){if(y.endLineNumber<e||y.startLineNumber>e)continue;const w=y.startLineNumber===e?y.startColumn:l.minColumn,L=y.endLineNumber===e?y.endColumn:l.maxColumn;w<L&&(isHighContrast(c.themeType)&&d.push(new LineDecoration(w,L,"inline-selected-text",0)),u==="selection"&&(f||(f=[]),f.push(new OffsetRange(w-1,L-1))))}}const p=new RenderLineInput(c.useMonospaceOptimizations,c.canUseHalfwidthRightwardsArrow,l.content,l.continuesWithWrappedLine,l.isBasicASCII,l.containsRTL,l.minColumn-1,l.tokens,d,l.tabSize,l.startVisibleColumn,c.spaceWidth,c.middotWidth,c.wsmiddotWidth,c.stopRenderingLineAfter,u,c.renderControlCharacters,c.fontLigatures!==EditorFontLigatures.OFF,f,l.textDirection,c.verticalScrollbarSize);if(this._renderedViewLine&&this._renderedViewLine.input.equals(p))return!1;r.appendString("<div "),l.textDirection===TextDirection$1.RTL?r.appendString('dir="rtl" '):l.containsRTL&&r.appendString('dir="ltr" '),r.appendString('style="top:'),r.appendString(String(t)),r.appendString("px;height:"),r.appendString(String(s)),r.appendString("px;line-height:"),r.appendString(String(s)),l.textDirection===TextDirection$1.RTL&&(r.appendString("px;padding-right:"),r.appendString(String(c.verticalScrollbarSize))),r.appendString('px;" class="'),r.appendString(ss.CLASS_NAME),r.appendString('">');const m=renderViewLine(p,r);r.appendString("</div>");let _=null;return g&&monospaceAssumptionsAreValid&&canUseFastRenderedViewLine&&l.isBasicASCII&&p.isLTR&&c.useMonospaceOptimizations&&m.containsForeignElements===0&&(_=new FastRenderedViewLine(this._renderedViewLine?this._renderedViewLine.domNode:null,p,m.characterMapping)),_||(_=createRenderedLine(this._renderedViewLine?this._renderedViewLine.domNode:null,p,m.characterMapping,m.containsForeignElements)),this._renderedViewLine=_,!0}layoutLine(e,t,s){this._renderedViewLine&&this._renderedViewLine.domNode&&(this._renderedViewLine.domNode.setTop(t),this._renderedViewLine.domNode.setHeight(s),this._renderedViewLine.domNode.setLineHeight(s))}isRenderedRTL(){return this._renderedViewLine?this._renderedViewLine.input.textDirection===TextDirection$1.RTL:!1}getWidth(e){return this._renderedViewLine?this._renderedViewLine.getWidth(e):0}getWidthIsFast(){return this._renderedViewLine?this._renderedViewLine.getWidthIsFast():!0}needsMonospaceFontCheck(){return this._renderedViewLine?this._renderedViewLine instanceof FastRenderedViewLine:!1}monospaceAssumptionsAreValid(){return this._renderedViewLine&&this._renderedViewLine instanceof FastRenderedViewLine?this._renderedViewLine.monospaceAssumptionsAreValid():monospaceAssumptionsAreValid}onMonospaceAssumptionsInvalidated(){this._renderedViewLine&&this._renderedViewLine instanceof FastRenderedViewLine&&(this._renderedViewLine=this._renderedViewLine.toSlowRenderedLine())}getVisibleRangesForRange(e,t,s,o){if(!this._renderedViewLine)return null;t=Math.min(this._renderedViewLine.input.lineContent.length+1,Math.max(1,t)),s=Math.min(this._renderedViewLine.input.lineContent.length+1,Math.max(1,s));const r=this._renderedViewLine.input.stopRenderingLineAfter;if(r!==-1&&t>r+1&&s>r+1)return new VisibleRanges(!0,[new FloatHorizontalRange(this.getWidth(o),0)]);r!==-1&&t>r+1&&(t=r+1),r!==-1&&s>r+1&&(s=r+1);const l=this._renderedViewLine.getVisibleRangesForRange(e,t,s,o);return l&&l.length>0?new VisibleRanges(!1,l):null}getColumnOfNodeOffset(e,t){return this._renderedViewLine?this._renderedViewLine.getColumnOfNodeOffset(e,t):1}};ss.CLASS_NAME="view-line";let ViewLine=ss;class FastRenderedViewLine{constructor(e,t,s){this._cachedWidth=-1,this.domNode=e,this.input=t;const o=Math.floor(t.lineContent.length/300);if(o>0){this._keyColumnPixelOffsetCache=new Float32Array(o);for(let r=0;r<o;r++)this._keyColumnPixelOffsetCache[r]=-1}else this._keyColumnPixelOffsetCache=null;this._characterMapping=s,this._charWidth=t.spaceWidth}getWidth(e){if(!this.domNode||this.input.lineContent.length<300){const t=this._characterMapping.getHorizontalOffset(this._characterMapping.length);return Math.round(this._charWidth*t)}return this._cachedWidth===-1&&(this._cachedWidth=this._getReadingTarget(this.domNode).offsetWidth,e==null||e.markDidDomLayout()),this._cachedWidth}getWidthIsFast(){return this.input.lineContent.length<300||this._cachedWidth!==-1}monospaceAssumptionsAreValid(){if(!this.domNode)return monospaceAssumptionsAreValid;if(this.input.lineContent.length<300){const e=this.getWidth(null),t=this.domNode.domNode.firstChild.offsetWidth;Math.abs(e-t)>=2&&(console.warn("monospace assumptions have been violated, therefore disabling monospace optimizations!"),monospaceAssumptionsAreValid=!1)}return monospaceAssumptionsAreValid}toSlowRenderedLine(){return createRenderedLine(this.domNode,this.input,this._characterMapping,0)}getVisibleRangesForRange(e,t,s,o){const r=this._getColumnPixelOffset(e,t,o),l=this._getColumnPixelOffset(e,s,o);return[new FloatHorizontalRange(r,l-r)]}_getColumnPixelOffset(e,t,s){if(t<=300){const u=this._characterMapping.getHorizontalOffset(t);return this._charWidth*u}const o=Math.floor((t-1)/300)-1,r=(o+1)*300+1;let l=-1;if(this._keyColumnPixelOffsetCache&&(l=this._keyColumnPixelOffsetCache[o],l===-1&&(l=this._actualReadPixelOffset(e,r,s),this._keyColumnPixelOffsetCache[o]=l)),l===-1){const u=this._characterMapping.getHorizontalOffset(t);return this._charWidth*u}const c=this._characterMapping.getHorizontalOffset(r),d=this._characterMapping.getHorizontalOffset(t);return l+this._charWidth*(d-c)}_getReadingTarget(e){return e.domNode.firstChild}_actualReadPixelOffset(e,t,s){if(!this.domNode)return-1;const o=this._characterMapping.getDomPosition(t),r=RangeUtil.readHorizontalRanges(this._getReadingTarget(this.domNode),o.partIndex,o.charIndex,o.partIndex,o.charIndex,s);return!r||r.length===0?-1:r[0].left}getColumnOfNodeOffset(e,t){return getColumnOfNodeOffset(this._characterMapping,e,t)}}class RenderedViewLine{constructor(e,t,s,o){if(this.domNode=e,this.input=t,this._characterMapping=s,this._isWhitespaceOnly=/^\s*$/.test(t.lineContent),this._containsForeignElements=o,this._cachedWidth=-1,this._pixelOffsetCache=null,t.isLTR){this._pixelOffsetCache=new Float32Array(Math.max(2,this._characterMapping.length+1));for(let r=0,l=this._characterMapping.length;r<=l;r++)this._pixelOffsetCache[r]=-1}}_getReadingTarget(e){return e.domNode.firstChild}getWidth(e){return this.domNode?(this._cachedWidth===-1&&(this._cachedWidth=this._getReadingTarget(this.domNode).offsetWidth,e==null||e.markDidDomLayout()),this._cachedWidth):0}getWidthIsFast(){return this._cachedWidth!==-1}getVisibleRangesForRange(e,t,s,o){if(!this.domNode)return null;if(this._pixelOffsetCache!==null){const r=this._readPixelOffset(this.domNode,e,t,o);if(r===-1)return null;const l=this._readPixelOffset(this.domNode,e,s,o);return l===-1?null:[new FloatHorizontalRange(r,l-r)]}return this._readVisibleRangesForRange(this.domNode,e,t,s,o)}_readVisibleRangesForRange(e,t,s,o,r){if(s===o){const l=this._readPixelOffset(e,t,s,r);return l===-1?null:[new FloatHorizontalRange(l,0)]}else return this._readRawVisibleRangesForRange(e,s,o,r)}_readPixelOffset(e,t,s,o){if(this.input.isLTR&&this._characterMapping.length===0){if(this._containsForeignElements===0||this._containsForeignElements===2)return 0;if(this._containsForeignElements===1)return this.getWidth(o);const r=this._getReadingTarget(e);return r.firstChild?(o.markDidDomLayout(),r.firstChild.offsetWidth):0}if(this._pixelOffsetCache!==null){const r=this._pixelOffsetCache[s];if(r!==-1)return r;const l=this._actualReadPixelOffset(e,t,s,o);return this._pixelOffsetCache[s]=l,l}return this._actualReadPixelOffset(e,t,s,o)}_actualReadPixelOffset(e,t,s,o){if(this._characterMapping.length===0){const d=RangeUtil.readHorizontalRanges(this._getReadingTarget(e),0,0,0,0,o);return!d||d.length===0?-1:d[0].left}if(this.input.isLTR&&s===this._characterMapping.length&&this._isWhitespaceOnly&&this._containsForeignElements===0)return this.getWidth(o);const r=this._characterMapping.getDomPosition(s),l=RangeUtil.readHorizontalRanges(this._getReadingTarget(e),r.partIndex,r.charIndex,r.partIndex,r.charIndex,o);if(!l||l.length===0)return-1;const c=l[0].left;if(this.input.isBasicASCII){const d=this._characterMapping.getHorizontalOffset(s),u=Math.round(this.input.spaceWidth*d);if(Math.abs(u-c)<=1)return u}return c}_readRawVisibleRangesForRange(e,t,s,o){if(this.input.isLTR&&t===1&&s===this._characterMapping.length)return[new FloatHorizontalRange(0,this.getWidth(o))];const r=this._characterMapping.getDomPosition(t),l=this._characterMapping.getDomPosition(s);return RangeUtil.readHorizontalRanges(this._getReadingTarget(e),r.partIndex,r.charIndex,l.partIndex,l.charIndex,o)}getColumnOfNodeOffset(e,t){return getColumnOfNodeOffset(this._characterMapping,e,t)}}class WebKitRenderedViewLine extends RenderedViewLine{_readVisibleRangesForRange(e,t,s,o,r){const l=super._readVisibleRangesForRange(e,t,s,o,r);if(!l||l.length===0||s===o||s===1&&o===this._characterMapping.length)return l;if(this.input.isLTR){const c=this._readPixelOffset(e,t,o,r);if(c!==-1){const d=l[l.length-1];d.left<c&&(d.width=c-d.left)}}return l}}const createRenderedLine=function(){return isWebKit?createWebKitRenderedLine:createNormalRenderedLine}();function createWebKitRenderedLine(a,e,t,s){return new WebKitRenderedViewLine(a,e,t,s)}function createNormalRenderedLine(a,e,t,s){return new RenderedViewLine(a,e,t,s)}function getColumnOfNodeOffset(a,e,t){const s=e.textContent.length;let o=-1;for(;e;)e=e.previousSibling,o++;return a.getColumn(new DomPosition(o,t),s)}class UnknownHitTestResult{constructor(e=null){this.hitTarget=e,this.type=0}}class ContentHitTestResult{get hitTarget(){return this.spanNode}constructor(e,t,s){this.position=e,this.spanNode=t,this.injectedText=s,this.type=1}}var HitTestResult;(function(a){function e(t,s,o){const r=t.getPositionFromDOMInfo(s,o);return r?new ContentHitTestResult(r,s,null):new UnknownHitTestResult(s)}a.createFromDOMInfo=e})(HitTestResult||(HitTestResult={}));class PointerHandlerLastRenderData{constructor(e,t){this.lastViewCursorsRenderData=e,this.lastTextareaPosition=t}}class MouseTarget{static _deduceRage(e,t=null){return!t&&e?new Range$2(e.lineNumber,e.column,e.lineNumber,e.column):t??null}static createUnknown(e,t,s){return{type:0,element:e,mouseColumn:t,position:s,range:this._deduceRage(s)}}static createTextarea(e,t){return{type:1,element:e,mouseColumn:t,position:null,range:null}}static createMargin(e,t,s,o,r,l){return{type:e,element:t,mouseColumn:s,position:o,range:r,detail:l}}static createViewZone(e,t,s,o,r){return{type:e,element:t,mouseColumn:s,position:o,range:this._deduceRage(o),detail:r}}static createContentText(e,t,s,o,r){return{type:6,element:e,mouseColumn:t,position:s,range:this._deduceRage(s,o),detail:r}}static createContentEmpty(e,t,s,o){return{type:7,element:e,mouseColumn:t,position:s,range:this._deduceRage(s),detail:o}}static createContentWidget(e,t,s){return{type:9,element:e,mouseColumn:t,position:null,range:null,detail:s}}static createScrollbar(e,t,s){return{type:11,element:e,mouseColumn:t,position:s,range:this._deduceRage(s)}}static createOverlayWidget(e,t,s){return{type:12,element:e,mouseColumn:t,position:null,range:null,detail:s}}static createOutsideEditor(e,t,s,o){return{type:13,element:null,mouseColumn:e,position:t,range:this._deduceRage(t),outsidePosition:s,outsideDistance:o}}static _typeToString(e){return e===1?"TEXTAREA":e===2?"GUTTER_GLYPH_MARGIN":e===3?"GUTTER_LINE_NUMBERS":e===4?"GUTTER_LINE_DECORATIONS":e===5?"GUTTER_VIEW_ZONE":e===6?"CONTENT_TEXT":e===7?"CONTENT_EMPTY":e===8?"CONTENT_VIEW_ZONE":e===9?"CONTENT_WIDGET":e===10?"OVERVIEW_RULER":e===11?"SCROLLBAR":e===12?"OVERLAY_WIDGET":"UNKNOWN"}static toString(e){return this._typeToString(e.type)+": "+e.position+" - "+e.range+" - "+JSON.stringify(e.detail)}}class ElementPath{static isTextArea(e){return e.length===2&&e[0]===3&&e[1]===7}static isChildOfViewLines(e){return e.length>=4&&e[0]===3&&e[3]===8}static isStrictChildOfViewLines(e){return e.length>4&&e[0]===3&&e[3]===8}static isChildOfScrollableElement(e){return e.length>=2&&e[0]===3&&e[1]===6}static isChildOfMinimap(e){return e.length>=2&&e[0]===3&&e[1]===9}static isChildOfContentWidgets(e){return e.length>=4&&e[0]===3&&e[3]===1}static isChildOfOverflowGuard(e){return e.length>=1&&e[0]===3}static isChildOfOverflowingContentWidgets(e){return e.length>=1&&e[0]===2}static isChildOfOverlayWidgets(e){return e.length>=2&&e[0]===3&&e[1]===4}static isChildOfOverflowingOverlayWidgets(e){return e.length>=1&&e[0]===5}}class HitTestContext{constructor(e,t,s){this.viewModel=e.viewModel;const o=e.configuration.options;this.layoutInfo=o.get(165),this.viewDomNode=t.viewDomNode,this.viewLinesGpu=t.viewLinesGpu,this.lineHeight=o.get(75),this.stickyTabStops=o.get(132),this.typicalHalfwidthCharacterWidth=o.get(59).typicalHalfwidthCharacterWidth,this.lastRenderData=s,this._context=e,this._viewHelper=t}getZoneAtCoord(e){return HitTestContext.getZoneAtCoord(this._context,e)}static getZoneAtCoord(e,t){const s=e.viewLayout.getWhitespaceAtVerticalOffset(t);if(s){const o=s.verticalOffset+s.height/2,r=e.viewModel.getLineCount();let l=null,c,d=null;return s.afterLineNumber!==r&&(d=new Position$1(s.afterLineNumber+1,1)),s.afterLineNumber>0&&(l=new Position$1(s.afterLineNumber,e.viewModel.getLineMaxColumn(s.afterLineNumber))),d===null?c=l:l===null?c=d:t<o?c=l:c=d,{viewZoneId:s.id,afterLineNumber:s.afterLineNumber,positionBefore:l,positionAfter:d,position:c}}return null}getFullLineRangeAtCoord(e){if(this._context.viewLayout.isAfterLines(e)){const o=this._context.viewModel.getLineCount(),r=this._context.viewModel.getLineMaxColumn(o);return{range:new Range$2(o,r,o,r),isAfterLines:!0}}const t=this._context.viewLayout.getLineNumberAtVerticalOffset(e),s=this._context.viewModel.getLineMaxColumn(t);return{range:new Range$2(t,1,t,s),isAfterLines:!1}}getLineNumberAtVerticalOffset(e){return this._context.viewLayout.getLineNumberAtVerticalOffset(e)}isAfterLines(e){return this._context.viewLayout.isAfterLines(e)}isInTopPadding(e){return this._context.viewLayout.isInTopPadding(e)}isInBottomPadding(e){return this._context.viewLayout.isInBottomPadding(e)}getVerticalOffsetForLineNumber(e){return this._context.viewLayout.getVerticalOffsetForLineNumber(e)}findAttribute(e,t){return HitTestContext._findAttribute(e,t,this._viewHelper.viewDomNode)}static _findAttribute(e,t,s){for(;e&&e!==e.ownerDocument.body;){if(e.hasAttribute&&e.hasAttribute(t))return e.getAttribute(t);if(e===s)return null;e=e.parentNode}return null}getLineWidth(e){return this._viewHelper.getLineWidth(e)}isRtl(e){return this.viewModel.getTextDirection(e)===TextDirection$1.RTL}visibleRangeForPosition(e,t){return this._viewHelper.visibleRangeForPosition(e,t)}getPositionFromDOMInfo(e,t){return this._viewHelper.getPositionFromDOMInfo(e,t)}getCurrentScrollTop(){return this._context.viewLayout.getCurrentScrollTop()}getCurrentScrollLeft(){return this._context.viewLayout.getCurrentScrollLeft()}}class BareHitTestRequest{constructor(e,t,s,o){this.editorPos=t,this.pos=s,this.relativePos=o,this.mouseVerticalOffset=Math.max(0,e.getCurrentScrollTop()+this.relativePos.y),this.mouseContentHorizontalOffset=e.getCurrentScrollLeft()+this.relativePos.x-e.layoutInfo.contentLeft,this.isInMarginArea=this.relativePos.x<e.layoutInfo.contentLeft&&this.relativePos.x>=e.layoutInfo.glyphMarginLeft,this.isInContentArea=!this.isInMarginArea,this.mouseColumn=Math.max(0,MouseTargetFactory._getMouseColumn(this.mouseContentHorizontalOffset,e.typicalHalfwidthCharacterWidth))}}class HitTestRequest extends BareHitTestRequest{get target(){return this._useHitTestTarget?this.hitTestResult.value.hitTarget:this._eventTarget}get targetPath(){return this._targetPathCacheElement!==this.target&&(this._targetPathCacheElement=this.target,this._targetPathCacheValue=PartFingerprints.collect(this.target,this._ctx.viewDomNode)),this._targetPathCacheValue}constructor(e,t,s,o,r){super(e,t,s,o),this.hitTestResult=new Lazy(()=>MouseTargetFactory.doHitTest(this._ctx,this)),this._targetPathCacheElement=null,this._targetPathCacheValue=new Uint8Array(0),this._ctx=e,this._eventTarget=r;const l=!!this._eventTarget;this._useHitTestTarget=!l}toString(){return`pos(${this.pos.x},${this.pos.y}), editorPos(${this.editorPos.x},${this.editorPos.y}), relativePos(${this.relativePos.x},${this.relativePos.y}), mouseVerticalOffset: ${this.mouseVerticalOffset}, mouseContentHorizontalOffset: ${this.mouseContentHorizontalOffset}
	target: ${this.target?this.target.outerHTML:null}`}get wouldBenefitFromHitTestTargetSwitch(){return!this._useHitTestTarget&&this.hitTestResult.value.hitTarget!==null&&this.target!==this.hitTestResult.value.hitTarget}switchToHitTestTarget(){this._useHitTestTarget=!0}_getMouseColumn(e=null){return e&&e.column<this._ctx.viewModel.getLineMaxColumn(e.lineNumber)?CursorColumns.visibleColumnFromColumn(this._ctx.viewModel.getLineContent(e.lineNumber),e.column,this._ctx.viewModel.model.getOptions().tabSize)+1:this.mouseColumn}fulfillUnknown(e=null){return MouseTarget.createUnknown(this.target,this._getMouseColumn(e),e)}fulfillTextarea(){return MouseTarget.createTextarea(this.target,this._getMouseColumn())}fulfillMargin(e,t,s,o){return MouseTarget.createMargin(e,this.target,this._getMouseColumn(t),t,s,o)}fulfillViewZone(e,t,s){return MouseTarget.createViewZone(e,this.target,this._getMouseColumn(t),t,s)}fulfillContentText(e,t,s){return MouseTarget.createContentText(this.target,this._getMouseColumn(e),e,t,s)}fulfillContentEmpty(e,t){return MouseTarget.createContentEmpty(this.target,this._getMouseColumn(e),e,t)}fulfillContentWidget(e){return MouseTarget.createContentWidget(this.target,this._getMouseColumn(),e)}fulfillScrollbar(e){return MouseTarget.createScrollbar(this.target,this._getMouseColumn(e),e)}fulfillOverlayWidget(e){return MouseTarget.createOverlayWidget(this.target,this._getMouseColumn(),e)}}const EMPTY_CONTENT_AFTER_LINES={isAfterLines:!0};function createEmptyContentDataInLines(a){return{isAfterLines:!1,horizontalDistanceToText:a}}class MouseTargetFactory{constructor(e,t){this._context=e,this._viewHelper=t}mouseTargetIsWidget(e){const t=e.target,s=PartFingerprints.collect(t,this._viewHelper.viewDomNode);return!!(ElementPath.isChildOfContentWidgets(s)||ElementPath.isChildOfOverflowingContentWidgets(s)||ElementPath.isChildOfOverlayWidgets(s)||ElementPath.isChildOfOverflowingOverlayWidgets(s))}createMouseTarget(e,t,s,o,r){const l=new HitTestContext(this._context,this._viewHelper,e),c=new HitTestRequest(l,t,s,o,r);try{const d=MouseTargetFactory._createMouseTarget(l,c);if(d.type===6&&l.stickyTabStops&&d.position!==null){const u=MouseTargetFactory._snapToSoftTabBoundary(d.position,l.viewModel),g=Range$2.fromPositions(u,u).plusRange(d.range);return c.fulfillContentText(u,g,d.detail)}return d}catch{return c.fulfillUnknown()}}static _createMouseTarget(e,t){if(t.target===null)return t.fulfillUnknown();const s=t;let o=null;return!ElementPath.isChildOfOverflowGuard(t.targetPath)&&!ElementPath.isChildOfOverflowingContentWidgets(t.targetPath)&&!ElementPath.isChildOfOverflowingOverlayWidgets(t.targetPath)&&(o=o||t.fulfillUnknown()),o=o||MouseTargetFactory._hitTestContentWidget(e,s),o=o||MouseTargetFactory._hitTestOverlayWidget(e,s),o=o||MouseTargetFactory._hitTestMinimap(e,s),o=o||MouseTargetFactory._hitTestScrollbarSlider(e,s),o=o||MouseTargetFactory._hitTestViewZone(e,s),o=o||MouseTargetFactory._hitTestMargin(e,s),o=o||MouseTargetFactory._hitTestViewCursor(e,s),o=o||MouseTargetFactory._hitTestTextArea(e,s),o=o||MouseTargetFactory._hitTestViewLines(e,s),o=o||MouseTargetFactory._hitTestScrollbar(e,s),o||t.fulfillUnknown()}static _hitTestContentWidget(e,t){if(ElementPath.isChildOfContentWidgets(t.targetPath)||ElementPath.isChildOfOverflowingContentWidgets(t.targetPath)){const s=e.findAttribute(t.target,"widgetId");return s?t.fulfillContentWidget(s):t.fulfillUnknown()}return null}static _hitTestOverlayWidget(e,t){if(ElementPath.isChildOfOverlayWidgets(t.targetPath)||ElementPath.isChildOfOverflowingOverlayWidgets(t.targetPath)){const s=e.findAttribute(t.target,"widgetId");return s?t.fulfillOverlayWidget(s):t.fulfillUnknown()}return null}static _hitTestViewCursor(e,t){if(t.target){const s=e.lastRenderData.lastViewCursorsRenderData;for(const o of s)if(t.target===o.domNode)return t.fulfillContentText(o.position,null,{mightBeForeignElement:!1,injectedText:null})}if(t.isInContentArea){const s=e.lastRenderData.lastViewCursorsRenderData,o=t.mouseContentHorizontalOffset,r=t.mouseVerticalOffset;for(const l of s){if(o<l.contentLeft||o>l.contentLeft+l.width)continue;const c=e.getVerticalOffsetForLineNumber(l.position.lineNumber);if(c<=r&&r<=c+l.height)return t.fulfillContentText(l.position,null,{mightBeForeignElement:!1,injectedText:null})}}return null}static _hitTestViewZone(e,t){const s=e.getZoneAtCoord(t.mouseVerticalOffset);if(s){const o=t.isInContentArea?8:5;return t.fulfillViewZone(o,s.position,s)}return null}static _hitTestTextArea(e,t){return ElementPath.isTextArea(t.targetPath)?e.lastRenderData.lastTextareaPosition?t.fulfillContentText(e.lastRenderData.lastTextareaPosition,null,{mightBeForeignElement:!1,injectedText:null}):t.fulfillTextarea():null}static _hitTestMargin(e,t){if(t.isInMarginArea){const s=e.getFullLineRangeAtCoord(t.mouseVerticalOffset),o=s.range.getStartPosition();let r=Math.abs(t.relativePos.x);const l={isAfterLines:s.isAfterLines,glyphMarginLeft:e.layoutInfo.glyphMarginLeft,glyphMarginWidth:e.layoutInfo.glyphMarginWidth,lineNumbersWidth:e.layoutInfo.lineNumbersWidth,offsetX:r};if(r-=e.layoutInfo.glyphMarginLeft,r<=e.layoutInfo.glyphMarginWidth){const c=e.viewModel.coordinatesConverter.convertViewPositionToModelPosition(s.range.getStartPosition()),d=e.viewModel.glyphLanes.getLanesAtLine(c.lineNumber);return l.glyphMarginLane=d[Math.floor(r/e.lineHeight)],t.fulfillMargin(2,o,s.range,l)}return r-=e.layoutInfo.glyphMarginWidth,r<=e.layoutInfo.lineNumbersWidth?t.fulfillMargin(3,o,s.range,l):(r-=e.layoutInfo.lineNumbersWidth,t.fulfillMargin(4,o,s.range,l))}return null}static _hitTestViewLines(e,t){if(!ElementPath.isChildOfViewLines(t.targetPath))return null;if(e.isInTopPadding(t.mouseVerticalOffset))return t.fulfillContentEmpty(new Position$1(1,1),EMPTY_CONTENT_AFTER_LINES);if(e.isAfterLines(t.mouseVerticalOffset)||e.isInBottomPadding(t.mouseVerticalOffset)){const o=e.viewModel.getLineCount(),r=e.viewModel.getLineMaxColumn(o);return t.fulfillContentEmpty(new Position$1(o,r),EMPTY_CONTENT_AFTER_LINES)}if(ElementPath.isStrictChildOfViewLines(t.targetPath)){const o=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),r=e.viewModel.getLineLength(o),l=e.getLineWidth(o);if(r===0){const d=createEmptyContentDataInLines(t.mouseContentHorizontalOffset-l);return t.fulfillContentEmpty(new Position$1(o,1),d)}if(e.isRtl(o)){if(t.mouseContentHorizontalOffset+l<=e.layoutInfo.contentWidth-e.layoutInfo.verticalScrollbarWidth){const d=createEmptyContentDataInLines(t.mouseContentHorizontalOffset-l),u=new Position$1(o,e.viewModel.getLineMaxColumn(o));return t.fulfillContentEmpty(u,d)}}else if(t.mouseContentHorizontalOffset>=l){const d=createEmptyContentDataInLines(t.mouseContentHorizontalOffset-l),u=new Position$1(o,e.viewModel.getLineMaxColumn(o));return t.fulfillContentEmpty(u,d)}}else if(e.viewLinesGpu){const o=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset);if(e.viewModel.getLineLength(o)===0){const d=e.getLineWidth(o),u=createEmptyContentDataInLines(t.mouseContentHorizontalOffset-d);return t.fulfillContentEmpty(new Position$1(o,1),u)}const r=e.getLineWidth(o);if(e.isRtl(o)){if(t.mouseContentHorizontalOffset+r<=e.layoutInfo.contentWidth-e.layoutInfo.verticalScrollbarWidth){const d=createEmptyContentDataInLines(t.mouseContentHorizontalOffset-r),u=new Position$1(o,e.viewModel.getLineMaxColumn(o));return t.fulfillContentEmpty(u,d)}}else if(t.mouseContentHorizontalOffset>=r){const d=createEmptyContentDataInLines(t.mouseContentHorizontalOffset-r),u=new Position$1(o,e.viewModel.getLineMaxColumn(o));return t.fulfillContentEmpty(u,d)}const c=e.viewLinesGpu.getPositionAtCoordinate(o,t.mouseContentHorizontalOffset);if(c){const d={injectedText:null,mightBeForeignElement:!1};return t.fulfillContentText(c,Range$2.fromPositions(c,c),d)}}const s=t.hitTestResult.value;return s.type===1?MouseTargetFactory.createMouseTargetFromHitTestPosition(e,t,s.spanNode,s.position,s.injectedText):t.wouldBenefitFromHitTestTargetSwitch?(t.switchToHitTestTarget(),this._createMouseTarget(e,t)):t.fulfillUnknown()}static _hitTestMinimap(e,t){if(ElementPath.isChildOfMinimap(t.targetPath)){const s=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),o=e.viewModel.getLineMaxColumn(s);return t.fulfillScrollbar(new Position$1(s,o))}return null}static _hitTestScrollbarSlider(e,t){if(ElementPath.isChildOfScrollableElement(t.targetPath)&&t.target&&t.target.nodeType===1){const s=t.target.className;if(s&&/\b(slider|scrollbar)\b/.test(s)){const o=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),r=e.viewModel.getLineMaxColumn(o);return t.fulfillScrollbar(new Position$1(o,r))}}return null}static _hitTestScrollbar(e,t){if(ElementPath.isChildOfScrollableElement(t.targetPath)){const s=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),o=e.viewModel.getLineMaxColumn(s);return t.fulfillScrollbar(new Position$1(s,o))}return null}getMouseColumn(e){const t=this._context.configuration.options,s=t.get(165),o=this._context.viewLayout.getCurrentScrollLeft()+e.x-s.contentLeft;return MouseTargetFactory._getMouseColumn(o,t.get(59).typicalHalfwidthCharacterWidth)}static _getMouseColumn(e,t){return e<0?1:Math.round(e/t)+1}static createMouseTargetFromHitTestPosition(e,t,s,o,r){const l=o.lineNumber,c=o.column,d=e.getLineWidth(l);if(t.mouseContentHorizontalOffset>d){const v=createEmptyContentDataInLines(t.mouseContentHorizontalOffset-d);return t.fulfillContentEmpty(o,v)}const u=e.visibleRangeForPosition(l,c);if(!u)return t.fulfillUnknown(o);const g=u.left;if(Math.abs(t.mouseContentHorizontalOffset-g)<1)return t.fulfillContentText(o,null,{mightBeForeignElement:!!r,injectedText:r});const f=[];if(f.push({offset:u.left,column:c}),c>1){const v=e.visibleRangeForPosition(l,c-1);v&&f.push({offset:v.left,column:c-1})}const p=e.viewModel.getLineMaxColumn(l);if(c<p){const v=e.visibleRangeForPosition(l,c+1);v&&f.push({offset:v.left,column:c+1})}f.sort((v,S)=>v.offset-S.offset);const m=t.pos.toClientCoordinates(getWindow(e.viewDomNode)),_=s.getBoundingClientRect(),C=_.left<=m.clientX&&m.clientX<=_.right;let b=null;for(let v=1;v<f.length;v++){const S=f[v-1],y=f[v];if(S.offset<=t.mouseContentHorizontalOffset&&t.mouseContentHorizontalOffset<=y.offset){b=new Range$2(l,S.column,l,y.column);const w=Math.abs(S.offset-t.mouseContentHorizontalOffset),L=Math.abs(y.offset-t.mouseContentHorizontalOffset);o=w<L?new Position$1(l,S.column):new Position$1(l,y.column);break}}return t.fulfillContentText(o,b,{mightBeForeignElement:!C||!!r,injectedText:r})}static _doHitTestWithCaretRangeFromPoint(e,t){const s=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),o=e.getVerticalOffsetForLineNumber(s),r=o+e.lineHeight;if(!(s===e.viewModel.getLineCount()&&t.mouseVerticalOffset>r)){const c=Math.floor((o+r)/2);let d=t.pos.y+(c-t.mouseVerticalOffset);d<=t.editorPos.y&&(d=t.editorPos.y+1),d>=t.editorPos.y+t.editorPos.height&&(d=t.editorPos.y+t.editorPos.height-1);const u=new PageCoordinates(t.pos.x,d),g=this._actualDoHitTestWithCaretRangeFromPoint(e,u.toClientCoordinates(getWindow(e.viewDomNode)));if(g.type===1)return g}return this._actualDoHitTestWithCaretRangeFromPoint(e,t.pos.toClientCoordinates(getWindow(e.viewDomNode)))}static _actualDoHitTestWithCaretRangeFromPoint(e,t){const s=getShadowRoot(e.viewDomNode);let o;if(s?typeof s.caretRangeFromPoint>"u"?o=shadowCaretRangeFromPoint(s,t.clientX,t.clientY):o=s.caretRangeFromPoint(t.clientX,t.clientY):o=e.viewDomNode.ownerDocument.caretRangeFromPoint(t.clientX,t.clientY),!o||!o.startContainer)return new UnknownHitTestResult;const r=o.startContainer;if(r.nodeType===r.TEXT_NODE){const l=r.parentNode,c=l?l.parentNode:null,d=c?c.parentNode:null;return(d&&d.nodeType===d.ELEMENT_NODE?d.className:null)===ViewLine.CLASS_NAME?HitTestResult.createFromDOMInfo(e,l,o.startOffset):new UnknownHitTestResult(r.parentNode)}else if(r.nodeType===r.ELEMENT_NODE){const l=r.parentNode,c=l?l.parentNode:null;return(c&&c.nodeType===c.ELEMENT_NODE?c.className:null)===ViewLine.CLASS_NAME?HitTestResult.createFromDOMInfo(e,r,r.textContent.length):new UnknownHitTestResult(r)}return new UnknownHitTestResult}static _doHitTestWithCaretPositionFromPoint(e,t){const s=e.viewDomNode.ownerDocument.caretPositionFromPoint(t.clientX,t.clientY);if(s.offsetNode.nodeType===s.offsetNode.TEXT_NODE){const o=s.offsetNode.parentNode,r=o?o.parentNode:null,l=r?r.parentNode:null;return(l&&l.nodeType===l.ELEMENT_NODE?l.className:null)===ViewLine.CLASS_NAME?HitTestResult.createFromDOMInfo(e,s.offsetNode.parentNode,s.offset):new UnknownHitTestResult(s.offsetNode.parentNode)}if(s.offsetNode.nodeType===s.offsetNode.ELEMENT_NODE){const o=s.offsetNode.parentNode,r=o&&o.nodeType===o.ELEMENT_NODE?o.className:null,l=o?o.parentNode:null,c=l&&l.nodeType===l.ELEMENT_NODE?l.className:null;if(r===ViewLine.CLASS_NAME){const d=s.offsetNode.childNodes[Math.min(s.offset,s.offsetNode.childNodes.length-1)];if(d)return HitTestResult.createFromDOMInfo(e,d,0)}else if(c===ViewLine.CLASS_NAME)return HitTestResult.createFromDOMInfo(e,s.offsetNode,0)}return new UnknownHitTestResult(s.offsetNode)}static _snapToSoftTabBoundary(e,t){const s=t.getLineContent(e.lineNumber),{tabSize:o}=t.model.getOptions(),r=AtomicTabMoveOperations.atomicPosition(s,e.column-1,o,2);return r!==-1?new Position$1(e.lineNumber,r+1):e}static doHitTest(e,t){let s=new UnknownHitTestResult;if(typeof e.viewDomNode.ownerDocument.caretRangeFromPoint=="function"?s=this._doHitTestWithCaretRangeFromPoint(e,t):e.viewDomNode.ownerDocument.caretPositionFromPoint&&(s=this._doHitTestWithCaretPositionFromPoint(e,t.pos.toClientCoordinates(getWindow(e.viewDomNode)))),s.type===1){const o=e.viewModel.getInjectedTextAt(s.position),r=e.viewModel.normalizePosition(s.position,2);(o||!r.equals(s.position))&&(s=new ContentHitTestResult(r,s.spanNode,o))}return s}}function shadowCaretRangeFromPoint(a,e,t){const s=document.createRange();let o=a.elementFromPoint(e,t);if(o!=null&&o.hasChildNodes()){for(;o&&o.firstChild&&o.firstChild.nodeType!==o.firstChild.TEXT_NODE&&o.lastChild&&o.lastChild.firstChild;)o=o.lastChild;const r=o.getBoundingClientRect(),l=getWindow(o),c=l.getComputedStyle(o,null).getPropertyValue("font-style"),d=l.getComputedStyle(o,null).getPropertyValue("font-variant"),u=l.getComputedStyle(o,null).getPropertyValue("font-weight"),g=l.getComputedStyle(o,null).getPropertyValue("font-size"),f=l.getComputedStyle(o,null).getPropertyValue("line-height"),p=l.getComputedStyle(o,null).getPropertyValue("font-family"),m=`${c} ${d} ${u} ${g}/${f} ${p}`,_=o.innerText;let C=r.left,b=0,v;if(e>r.left+r.width)b=_.length;else{const S=CharWidthReader.getInstance();for(let y=0;y<_.length+1;y++){if(v=S.getCharWidth(_.charAt(y),m)/2,C+=v,e<C){b=y;break}C+=v}}s.setStart(o.firstChild,b),s.setEnd(o.firstChild,b)}return s}const St=class St{static getInstance(){return St._INSTANCE||(St._INSTANCE=new St),St._INSTANCE}constructor(){this._cache={},this._canvas=document.createElement("canvas")}getCharWidth(e,t){const s=e+t;if(this._cache[s])return this._cache[s];const o=this._canvas.getContext("2d");o.font=t;const l=o.measureText(e).width;return this._cache[s]=l,l}};St._INSTANCE=null;let CharWidthReader=St;function memoize(a,e,t){let s=null,o=null;if(typeof t.value=="function"?(s="value",o=t.value,o.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof t.get=="function"&&(s="get",o=t.get),!o)throw new Error("not supported");const r=`$memoize$${e}`;t[s]=function(...l){return this.hasOwnProperty(r)||Object.defineProperty(this,r,{configurable:!1,enumerable:!1,writable:!1,value:o.apply(this,l)}),this[r]}}var __decorate$2U=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},EventType;(function(a){a.Tap="-monaco-gesturetap",a.Change="-monaco-gesturechange",a.Start="-monaco-gesturestart",a.End="-monaco-gesturesend",a.Contextmenu="-monaco-gesturecontextmenu"})(EventType||(EventType={}));const ce=class ce extends Disposable{constructor(){super(),this.dispatched=!1,this.targets=new LinkedList,this.ignoreTargets=new LinkedList,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register(Event$1.runAndSubscribe(onDidRegisterWindow,({window:e,disposables:t})=>{t.add(addDisposableListener(e.document,"touchstart",s=>this.onTouchStart(s),{passive:!1})),t.add(addDisposableListener(e.document,"touchend",s=>this.onTouchEnd(e,s))),t.add(addDisposableListener(e.document,"touchmove",s=>this.onTouchMove(s),{passive:!1}))},{window:mainWindow,disposables:this._store}))}static addTarget(e){if(!ce.isTouchDevice())return Disposable.None;ce.INSTANCE||(ce.INSTANCE=new ce);const t=ce.INSTANCE.targets.push(e);return toDisposable(t)}static ignoreTarget(e){if(!ce.isTouchDevice())return Disposable.None;ce.INSTANCE||(ce.INSTANCE=new ce);const t=ce.INSTANCE.ignoreTargets.push(e);return toDisposable(t)}static isTouchDevice(){return"ontouchstart"in mainWindow||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(e){const t=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let s=0,o=e.targetTouches.length;s<o;s++){const r=e.targetTouches.item(s);this.activeTouches[r.identifier]={id:r.identifier,initialTarget:r.target,initialTimeStamp:t,initialPageX:r.pageX,initialPageY:r.pageY,rollingTimestamps:[t],rollingPageX:[r.pageX],rollingPageY:[r.pageY]};const l=this.newGestureEvent(EventType.Start,r.target);l.pageX=r.pageX,l.pageY=r.pageY,this.dispatchEvent(l)}this.dispatched&&(e.preventDefault(),e.stopPropagation(),this.dispatched=!1)}onTouchEnd(e,t){const s=Date.now(),o=Object.keys(this.activeTouches).length;for(let r=0,l=t.changedTouches.length;r<l;r++){const c=t.changedTouches.item(r);if(!this.activeTouches.hasOwnProperty(String(c.identifier))){console.warn("move of an UNKNOWN touch",c);continue}const d=this.activeTouches[c.identifier],u=Date.now()-d.initialTimeStamp;if(u<ce.HOLD_DELAY&&Math.abs(d.initialPageX-d.rollingPageX.at(-1))<30&&Math.abs(d.initialPageY-d.rollingPageY.at(-1))<30){const g=this.newGestureEvent(EventType.Tap,d.initialTarget);g.pageX=d.rollingPageX.at(-1),g.pageY=d.rollingPageY.at(-1),this.dispatchEvent(g)}else if(u>=ce.HOLD_DELAY&&Math.abs(d.initialPageX-d.rollingPageX.at(-1))<30&&Math.abs(d.initialPageY-d.rollingPageY.at(-1))<30){const g=this.newGestureEvent(EventType.Contextmenu,d.initialTarget);g.pageX=d.rollingPageX.at(-1),g.pageY=d.rollingPageY.at(-1),this.dispatchEvent(g)}else if(o===1){const g=d.rollingPageX.at(-1),f=d.rollingPageY.at(-1),p=d.rollingTimestamps.at(-1)-d.rollingTimestamps[0],m=g-d.rollingPageX[0],_=f-d.rollingPageY[0],C=[...this.targets].filter(b=>d.initialTarget instanceof Node&&b.contains(d.initialTarget));this.inertia(e,C,s,Math.abs(m)/p,m>0?1:-1,g,Math.abs(_)/p,_>0?1:-1,f)}this.dispatchEvent(this.newGestureEvent(EventType.End,d.initialTarget)),delete this.activeTouches[c.identifier]}this.dispatched&&(t.preventDefault(),t.stopPropagation(),this.dispatched=!1)}newGestureEvent(e,t){const s=document.createEvent("CustomEvent");return s.initEvent(e,!1,!0),s.initialTarget=t,s.tapCount=0,s}dispatchEvent(e){if(e.type===EventType.Tap){const t=new Date().getTime();let s=0;t-this._lastSetTapCountTime>ce.CLEAR_TAP_COUNT_TIME?s=1:s=2,this._lastSetTapCountTime=t,e.tapCount=s}else(e.type===EventType.Change||e.type===EventType.Contextmenu)&&(this._lastSetTapCountTime=0);if(e.initialTarget instanceof Node){for(const s of this.ignoreTargets)if(s.contains(e.initialTarget))return;const t=[];for(const s of this.targets)if(s.contains(e.initialTarget)){let o=0,r=e.initialTarget;for(;r&&r!==s;)o++,r=r.parentElement;t.push([o,s])}t.sort((s,o)=>s[0]-o[0]);for(const[s,o]of t)o.dispatchEvent(e),this.dispatched=!0}}inertia(e,t,s,o,r,l,c,d,u){this.handle=scheduleAtNextAnimationFrame(e,()=>{const g=Date.now(),f=g-s;let p=0,m=0,_=!0;o+=ce.SCROLL_FRICTION*f,c+=ce.SCROLL_FRICTION*f,o>0&&(_=!1,p=r*o*f),c>0&&(_=!1,m=d*c*f);const C=this.newGestureEvent(EventType.Change);C.translationX=p,C.translationY=m,t.forEach(b=>b.dispatchEvent(C)),_||this.inertia(e,t,g,o,r,l+p,c,d,u+m)})}onTouchMove(e){const t=Date.now();for(let s=0,o=e.changedTouches.length;s<o;s++){const r=e.changedTouches.item(s);if(!this.activeTouches.hasOwnProperty(String(r.identifier))){console.warn("end of an UNKNOWN touch",r);continue}const l=this.activeTouches[r.identifier],c=this.newGestureEvent(EventType.Change,l.initialTarget);c.translationX=r.pageX-l.rollingPageX.at(-1),c.translationY=r.pageY-l.rollingPageY.at(-1),c.pageX=r.pageX,c.pageY=r.pageY,this.dispatchEvent(c),l.rollingPageX.length>3&&(l.rollingPageX.shift(),l.rollingPageY.shift(),l.rollingTimestamps.shift()),l.rollingPageX.push(r.pageX),l.rollingPageY.push(r.pageY),l.rollingTimestamps.push(t)}this.dispatched&&(e.preventDefault(),e.stopPropagation(),this.dispatched=!1)}};ce.SCROLL_FRICTION=-.005,ce.HOLD_DELAY=700,ce.CLEAR_TAP_COUNT_TIME=400;let Gesture=ce;__decorate$2U([memoize],Gesture,"isTouchDevice",null);let Widget$1=class extends Disposable{onclick(e,t){this._register(addDisposableListener(e,EventType$1.CLICK,s=>t(new StandardMouseEvent(getWindow(e),s))))}onmousedown(e,t){this._register(addDisposableListener(e,EventType$1.MOUSE_DOWN,s=>t(new StandardMouseEvent(getWindow(e),s))))}onmouseover(e,t){this._register(addDisposableListener(e,EventType$1.MOUSE_OVER,s=>t(new StandardMouseEvent(getWindow(e),s))))}onmouseleave(e,t){this._register(addDisposableListener(e,EventType$1.MOUSE_LEAVE,s=>t(new StandardMouseEvent(getWindow(e),s))))}onkeydown(e,t){this._register(addDisposableListener(e,EventType$1.KEY_DOWN,s=>t(new StandardKeyboardEvent(s))))}onkeyup(e,t){this._register(addDisposableListener(e,EventType$1.KEY_UP,s=>t(new StandardKeyboardEvent(s))))}oninput(e,t){this._register(addDisposableListener(e,EventType$1.INPUT,t))}onblur(e,t){this._register(addDisposableListener(e,EventType$1.BLUR,t))}onfocus(e,t){this._register(addDisposableListener(e,EventType$1.FOCUS,t))}ignoreGesture(e){return Gesture.ignoreTarget(e)}};const ARROW_IMG_SIZE=11;class ScrollbarArrow extends Widget$1{constructor(e){super(),this._onActivate=e.onActivate,this.bgDomNode=document.createElement("div"),this.bgDomNode.className="arrow-background",this.bgDomNode.style.position="absolute",this.bgDomNode.style.width=e.bgWidth+"px",this.bgDomNode.style.height=e.bgHeight+"px",typeof e.top<"u"&&(this.bgDomNode.style.top="0px"),typeof e.left<"u"&&(this.bgDomNode.style.left="0px"),typeof e.bottom<"u"&&(this.bgDomNode.style.bottom="0px"),typeof e.right<"u"&&(this.bgDomNode.style.right="0px"),this.domNode=document.createElement("div"),this.domNode.className=e.className,this.domNode.classList.add(...ThemeIcon.asClassNameArray(e.icon)),this.domNode.style.position="absolute",this.domNode.style.width=ARROW_IMG_SIZE+"px",this.domNode.style.height=ARROW_IMG_SIZE+"px",typeof e.top<"u"&&(this.domNode.style.top=e.top+"px"),typeof e.left<"u"&&(this.domNode.style.left=e.left+"px"),typeof e.bottom<"u"&&(this.domNode.style.bottom=e.bottom+"px"),typeof e.right<"u"&&(this.domNode.style.right=e.right+"px"),this._pointerMoveMonitor=this._register(new GlobalPointerMoveMonitor),this._register(addStandardDisposableListener(this.bgDomNode,EventType$1.POINTER_DOWN,t=>this._arrowPointerDown(t))),this._register(addStandardDisposableListener(this.domNode,EventType$1.POINTER_DOWN,t=>this._arrowPointerDown(t))),this._pointerdownRepeatTimer=this._register(new WindowIntervalTimer),this._pointerdownScheduleRepeatTimer=this._register(new TimeoutTimer)}_arrowPointerDown(e){if(!e.target||!(e.target instanceof Element))return;const t=()=>{this._pointerdownRepeatTimer.cancelAndSet(()=>this._onActivate(),1e3/24,getWindow(e))};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(t,200),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,s=>{},()=>{this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancel()}),e.preventDefault()}}class ScrollbarVisibilityController extends Disposable{constructor(e,t,s){super(),this._visibility=e,this._visibleClassName=t,this._invisibleClassName=s,this._domNode=null,this._isVisible=!1,this._isNeeded=!1,this._rawShouldBeVisible=!1,this._shouldBeVisible=!1,this._revealTimer=this._register(new TimeoutTimer)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this._updateShouldBeVisible())}setShouldBeVisible(e){this._rawShouldBeVisible=e,this._updateShouldBeVisible()}_applyVisibilitySetting(){return this._visibility===2?!1:this._visibility===3?!0:this._rawShouldBeVisible}_updateShouldBeVisible(){const e=this._applyVisibilitySetting();this._shouldBeVisible!==e&&(this._shouldBeVisible=e,this.ensureVisibility())}setIsNeeded(e){this._isNeeded!==e&&(this._isNeeded=e,this.ensureVisibility())}setDomNode(e){this._domNode=e,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}ensureVisibility(){if(!this._isNeeded){this._hide(!1);return}this._shouldBeVisible?this._reveal():this._hide(!0)}_reveal(){this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(()=>{var e;(e=this._domNode)==null||e.setClassName(this._visibleClassName)},0))}_hide(e){var t;this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,(t=this._domNode)==null||t.setClassName(this._invisibleClassName+(e?" fade":"")))}}const POINTER_DRAG_RESET_DISTANCE$1=140;class AbstractScrollbar extends Widget$1{constructor(e){super(),this._lazyRender=e.lazyRender,this._host=e.host,this._scrollable=e.scrollable,this._scrollByPage=e.scrollByPage,this._scrollbarState=e.scrollbarState,this._visibilityController=this._register(new ScrollbarVisibilityController(e.visibility,"visible scrollbar "+e.extraScrollbarClassName,"invisible scrollbar "+e.extraScrollbarClassName)),this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._pointerMoveMonitor=this._register(new GlobalPointerMoveMonitor),this._shouldRender=!0,this.domNode=createFastDomNode(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._visibilityController.setDomNode(this.domNode),this.domNode.setPosition("absolute"),this._register(addDisposableListener(this.domNode.domNode,EventType$1.POINTER_DOWN,t=>this._domNodePointerDown(t)))}_createArrow(e){const t=this._register(new ScrollbarArrow(e));this.domNode.domNode.appendChild(t.bgDomNode),this.domNode.domNode.appendChild(t.domNode)}_createSlider(e,t,s,o){this.slider=createFastDomNode(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop(e),this.slider.setLeft(t),typeof s=="number"&&this.slider.setWidth(s),typeof o=="number"&&this.slider.setHeight(o),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(addDisposableListener(this.slider.domNode,EventType$1.POINTER_DOWN,r=>{r.button===0&&(r.preventDefault(),this._sliderPointerDown(r))})),this.onclick(this.slider.domNode,r=>{r.leftButton&&r.stopPropagation()})}_onElementSize(e){return this._scrollbarState.setVisibleSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollSize(e){return this._scrollbarState.setScrollSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollPosition(e){return this._scrollbarState.setScrollPosition(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}beginReveal(){this._visibilityController.setShouldBeVisible(!0)}beginHide(){this._visibilityController.setShouldBeVisible(!1)}render(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}_domNodePointerDown(e){e.target===this.domNode.domNode&&this._onPointerDown(e)}delegatePointerDown(e){const t=this.domNode.domNode.getClientRects()[0].top,s=t+this._scrollbarState.getSliderPosition(),o=t+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),r=this._sliderPointerPosition(e);s<=r&&r<=o?e.button===0&&(e.preventDefault(),this._sliderPointerDown(e)):this._onPointerDown(e)}_onPointerDown(e){let t,s;if(e.target===this.domNode.domNode&&typeof e.offsetX=="number"&&typeof e.offsetY=="number")t=e.offsetX,s=e.offsetY;else{const l=getDomNodePagePosition(this.domNode.domNode);t=e.pageX-l.left,s=e.pageY-l.top}const o=e.pointerType==="mouse",r=e.button===0;if(r||!o){const l=this._pointerDownRelativePosition(t,s);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(l):this._scrollbarState.getDesiredScrollPositionFromOffset(l))}r&&(e.preventDefault(),this._sliderPointerDown(e))}_sliderPointerDown(e){if(!e.target||!(e.target instanceof Element))return;const t=this._sliderPointerPosition(e),s=this._sliderOrthogonalPointerPosition(e),o=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,r=>{const l=this._sliderOrthogonalPointerPosition(r),c=Math.abs(l-s);if(isWindows&&c>POINTER_DRAG_RESET_DISTANCE$1){this._setDesiredScrollPositionNow(o.getScrollPosition());return}const u=this._sliderPointerPosition(r)-t;this._setDesiredScrollPositionNow(o.getDesiredScrollPositionFromDelta(u))},()=>{this.slider.toggleClassName("active",!1),this._host.onDragEnd()}),this._host.onDragStart()}_setDesiredScrollPositionNow(e){const t={};this.writeScrollPosition(t,e),this._scrollable.setScrollPositionNow(t)}updateScrollbarSize(e){this._updateScrollbarSize(e),this._scrollbarState.setScrollbarSize(e),this._shouldRender=!0,this._lazyRender||this.render()}isNeeded(){return this._scrollbarState.isNeeded()}}const MINIMUM_SLIDER_SIZE=20;class ScrollbarState{constructor(e,t,s,o,r,l){this._scrollbarSize=Math.round(t),this._oppositeScrollbarSize=Math.round(s),this._arrowSize=Math.round(e),this._visibleSize=o,this._scrollSize=r,this._scrollPosition=l,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}clone(){return new ScrollbarState(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}setVisibleSize(e){const t=Math.round(e);return this._visibleSize!==t?(this._visibleSize=t,this._refreshComputedValues(),!0):!1}setScrollSize(e){const t=Math.round(e);return this._scrollSize!==t?(this._scrollSize=t,this._refreshComputedValues(),!0):!1}setScrollPosition(e){const t=Math.round(e);return this._scrollPosition!==t?(this._scrollPosition=t,this._refreshComputedValues(),!0):!1}setScrollbarSize(e){this._scrollbarSize=Math.round(e)}setOppositeScrollbarSize(e){this._oppositeScrollbarSize=Math.round(e)}static _computeValues(e,t,s,o,r){const l=Math.max(0,s-e),c=Math.max(0,l-2*t),d=o>0&&o>s;if(!d)return{computedAvailableSize:Math.round(l),computedIsNeeded:d,computedSliderSize:Math.round(c),computedSliderRatio:0,computedSliderPosition:0};const u=Math.round(Math.max(MINIMUM_SLIDER_SIZE,Math.floor(s*c/o))),g=(c-u)/(o-s),f=r*g;return{computedAvailableSize:Math.round(l),computedIsNeeded:d,computedSliderSize:Math.round(u),computedSliderRatio:g,computedSliderPosition:Math.round(f)}}_refreshComputedValues(){const e=ScrollbarState._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=e.computedAvailableSize,this._computedIsNeeded=e.computedIsNeeded,this._computedSliderSize=e.computedSliderSize,this._computedSliderRatio=e.computedSliderRatio,this._computedSliderPosition=e.computedSliderPosition}getArrowSize(){return this._arrowSize}getScrollPosition(){return this._scrollPosition}getRectangleLargeSize(){return this._computedAvailableSize}getRectangleSmallSize(){return this._scrollbarSize}isNeeded(){return this._computedIsNeeded}getSliderSize(){return this._computedSliderSize}getSliderPosition(){return this._computedSliderPosition}getDesiredScrollPositionFromOffset(e){if(!this._computedIsNeeded)return 0;const t=e-this._arrowSize-this._computedSliderSize/2;return Math.round(t/this._computedSliderRatio)}getDesiredScrollPositionFromOffsetPaged(e){if(!this._computedIsNeeded)return 0;const t=e-this._arrowSize;let s=this._scrollPosition;return t<this._computedSliderPosition?s-=this._visibleSize:s+=this._visibleSize,s}getDesiredScrollPositionFromDelta(e){if(!this._computedIsNeeded)return 0;const t=this._computedSliderPosition+e;return Math.round(t/this._computedSliderRatio)}}class HorizontalScrollbar extends AbstractScrollbar{constructor(e,t,s){const o=e.getScrollDimensions(),r=e.getCurrentScrollPosition();if(super({lazyRender:t.lazyRender,host:s,scrollbarState:new ScrollbarState(t.horizontalHasArrows?t.arrowSize:0,t.horizontal===2?0:t.horizontalScrollbarSize,t.vertical===2?0:t.verticalScrollbarSize,o.width,o.scrollWidth,r.scrollLeft),visibility:t.horizontal,extraScrollbarClassName:"horizontal",scrollable:e,scrollByPage:t.scrollByPage}),t.horizontalHasArrows){const l=(t.arrowSize-ARROW_IMG_SIZE)/2,c=(t.horizontalScrollbarSize-ARROW_IMG_SIZE)/2;this._createArrow({className:"scra",icon:Codicon.scrollbarButtonLeft,top:c,left:l,bottom:void 0,right:void 0,bgWidth:t.arrowSize,bgHeight:t.horizontalScrollbarSize,onActivate:()=>this._host.onMouseWheel(new StandardWheelEvent(null,1,0))}),this._createArrow({className:"scra",icon:Codicon.scrollbarButtonRight,top:c,left:void 0,bottom:void 0,right:l,bgWidth:t.arrowSize,bgHeight:t.horizontalScrollbarSize,onActivate:()=>this._host.onMouseWheel(new StandardWheelEvent(null,-1,0))})}this._createSlider(Math.floor((t.horizontalScrollbarSize-t.horizontalSliderSize)/2),0,void 0,t.horizontalSliderSize)}_updateSlider(e,t){this.slider.setWidth(e),this.slider.setLeft(t)}_renderDomNode(e,t){this.domNode.setWidth(e),this.domNode.setHeight(t),this.domNode.setLeft(0),this.domNode.setBottom(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize(e.width)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,t){return e}_sliderPointerPosition(e){return e.pageX}_sliderOrthogonalPointerPosition(e){return e.pageY}_updateScrollbarSize(e){this.slider.setHeight(e)}writeScrollPosition(e,t){e.scrollLeft=t}updateOptions(e){this.updateScrollbarSize(e.horizontal===2?0:e.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._visibilityController.setVisibility(e.horizontal),this._scrollByPage=e.scrollByPage}}class VerticalScrollbar extends AbstractScrollbar{constructor(e,t,s){const o=e.getScrollDimensions(),r=e.getCurrentScrollPosition();if(super({lazyRender:t.lazyRender,host:s,scrollbarState:new ScrollbarState(t.verticalHasArrows?t.arrowSize:0,t.vertical===2?0:t.verticalScrollbarSize,0,o.height,o.scrollHeight,r.scrollTop),visibility:t.vertical,extraScrollbarClassName:"vertical",scrollable:e,scrollByPage:t.scrollByPage}),t.verticalHasArrows){const l=(t.arrowSize-ARROW_IMG_SIZE)/2,c=(t.verticalScrollbarSize-ARROW_IMG_SIZE)/2;this._createArrow({className:"scra",icon:Codicon.scrollbarButtonUp,top:l,left:c,bottom:void 0,right:void 0,bgWidth:t.verticalScrollbarSize,bgHeight:t.arrowSize,onActivate:()=>this._host.onMouseWheel(new StandardWheelEvent(null,0,1))}),this._createArrow({className:"scra",icon:Codicon.scrollbarButtonDown,top:void 0,left:c,bottom:l,right:void 0,bgWidth:t.verticalScrollbarSize,bgHeight:t.arrowSize,onActivate:()=>this._host.onMouseWheel(new StandardWheelEvent(null,0,-1))})}this._createSlider(0,Math.floor((t.verticalScrollbarSize-t.verticalSliderSize)/2),t.verticalSliderSize,void 0)}_updateSlider(e,t){this.slider.setHeight(e),this.slider.setTop(t)}_renderDomNode(e,t){this.domNode.setWidth(t),this.domNode.setHeight(e),this.domNode.setRight(0),this.domNode.setTop(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize(e.height)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,t){return t}_sliderPointerPosition(e){return e.pageY}_sliderOrthogonalPointerPosition(e){return e.pageX}_updateScrollbarSize(e){this.slider.setWidth(e)}writeScrollPosition(e,t){e.scrollTop=t}updateOptions(e){this.updateScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility(e.vertical),this._scrollByPage=e.scrollByPage}}class ScrollState{constructor(e,t,s,o,r,l,c){this._forceIntegerValues=e,this._scrollStateBrand=void 0,this._forceIntegerValues&&(t=t|0,s=s|0,o=o|0,r=r|0,l=l|0,c=c|0),this.rawScrollLeft=o,this.rawScrollTop=c,t<0&&(t=0),o+t>s&&(o=s-t),o<0&&(o=0),r<0&&(r=0),c+r>l&&(c=l-r),c<0&&(c=0),this.width=t,this.scrollWidth=s,this.scrollLeft=o,this.height=r,this.scrollHeight=l,this.scrollTop=c}equals(e){return this.rawScrollLeft===e.rawScrollLeft&&this.rawScrollTop===e.rawScrollTop&&this.width===e.width&&this.scrollWidth===e.scrollWidth&&this.scrollLeft===e.scrollLeft&&this.height===e.height&&this.scrollHeight===e.scrollHeight&&this.scrollTop===e.scrollTop}withScrollDimensions(e,t){return new ScrollState(this._forceIntegerValues,typeof e.width<"u"?e.width:this.width,typeof e.scrollWidth<"u"?e.scrollWidth:this.scrollWidth,t?this.rawScrollLeft:this.scrollLeft,typeof e.height<"u"?e.height:this.height,typeof e.scrollHeight<"u"?e.scrollHeight:this.scrollHeight,t?this.rawScrollTop:this.scrollTop)}withScrollPosition(e){return new ScrollState(this._forceIntegerValues,this.width,this.scrollWidth,typeof e.scrollLeft<"u"?e.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,typeof e.scrollTop<"u"?e.scrollTop:this.rawScrollTop)}createScrollEvent(e,t){const s=this.width!==e.width,o=this.scrollWidth!==e.scrollWidth,r=this.scrollLeft!==e.scrollLeft,l=this.height!==e.height,c=this.scrollHeight!==e.scrollHeight,d=this.scrollTop!==e.scrollTop;return{inSmoothScrolling:t,oldWidth:e.width,oldScrollWidth:e.scrollWidth,oldScrollLeft:e.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:e.height,oldScrollHeight:e.scrollHeight,oldScrollTop:e.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:s,scrollWidthChanged:o,scrollLeftChanged:r,heightChanged:l,scrollHeightChanged:c,scrollTopChanged:d}}}class Scrollable extends Disposable{constructor(e){super(),this._scrollableBrand=void 0,this._onScroll=this._register(new Emitter$1),this.onScroll=this._onScroll.event,this._smoothScrollDuration=e.smoothScrollDuration,this._scheduleAtNextAnimationFrame=e.scheduleAtNextAnimationFrame,this._state=new ScrollState(e.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration(e){this._smoothScrollDuration=e}validateScrollPosition(e){return this._state.withScrollPosition(e)}getScrollDimensions(){return this._state}setScrollDimensions(e,t){var o;const s=this._state.withScrollDimensions(e,t);this._setState(s,!!this._smoothScrolling),(o=this._smoothScrolling)==null||o.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow(e){const t=this._state.withScrollPosition(e);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(t,!1)}setScrollPositionSmooth(e,t){if(this._smoothScrollDuration===0)return this.setScrollPositionNow(e);if(this._smoothScrolling){e={scrollLeft:typeof e.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:e.scrollLeft,scrollTop:typeof e.scrollTop>"u"?this._smoothScrolling.to.scrollTop:e.scrollTop};const s=this._state.withScrollPosition(e);if(this._smoothScrolling.to.scrollLeft===s.scrollLeft&&this._smoothScrolling.to.scrollTop===s.scrollTop)return;let o;t?o=new SmoothScrollingOperation(this._smoothScrolling.from,s,this._smoothScrolling.startTime,this._smoothScrolling.duration):o=this._smoothScrolling.combine(this._state,s,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=o}else{const s=this._state.withScrollPosition(e);this._smoothScrolling=SmoothScrollingOperation.start(this._state,s,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;const e=this._smoothScrolling.tick(),t=this._state.withScrollPosition(e);if(this._setState(t,!0),!!this._smoothScrolling){if(e.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState(e,t){const s=this._state;s.equals(e)||(this._state=e,this._onScroll.fire(this._state.createScrollEvent(s,t)))}}class SmoothScrollingUpdate{constructor(e,t,s){this.scrollLeft=e,this.scrollTop=t,this.isDone=s}}function createEaseOutCubic(a,e){const t=e-a;return function(s){return a+t*easeOutCubic$1(s)}}function createComposed(a,e,t){return function(s){return s<t?a(s/t):e((s-t)/(1-t))}}class SmoothScrollingOperation{constructor(e,t,s,o){this.from=e,this.to=t,this.duration=o,this.startTime=s,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(e,t,s){if(Math.abs(e-t)>2.5*s){let r,l;return e<t?(r=e+.75*s,l=t-.75*s):(r=e-.75*s,l=t+.75*s),createComposed(createEaseOutCubic(e,r),createEaseOutCubic(l,t),.33)}return createEaseOutCubic(e,t)}dispose(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(e){this.to=e.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(e){const t=(e-this.startTime)/this.duration;if(t<1){const s=this.scrollLeft(t),o=this.scrollTop(t);return new SmoothScrollingUpdate(s,o,!1)}return new SmoothScrollingUpdate(this.to.scrollLeft,this.to.scrollTop,!0)}combine(e,t,s){return SmoothScrollingOperation.start(e,t,s)}static start(e,t,s){s=s+10;const o=Date.now()-10;return new SmoothScrollingOperation(e,t,o,s)}}function easeInCubic(a){return Math.pow(a,3)}function easeOutCubic$1(a){return 1-easeInCubic(1-a)}const scrollbars="",HIDE_TIMEOUT=500,SCROLL_WHEEL_SENSITIVITY=50;class MouseWheelClassifierItem{constructor(e,t,s){this.timestamp=e,this.deltaX=t,this.deltaY=s,this.score=0}}const os=class os{constructor(){this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}isPhysicalMouseWheel(){if(this._front===-1&&this._rear===-1)return!1;let e=1,t=0,s=1,o=this._rear;do{const r=o===this._front?e:Math.pow(2,-s);if(e-=r,t+=this._memory[o].score*r,o===this._front)break;o=(this._capacity+o-1)%this._capacity,s++}while(!0);return t<=.5}acceptStandardWheelEvent(e){if(isChrome$1){const t=getWindow(e.browserEvent),s=getZoomFactor(t);this.accept(Date.now(),e.deltaX*s,e.deltaY*s)}else this.accept(Date.now(),e.deltaX,e.deltaY)}accept(e,t,s){let o=null;const r=new MouseWheelClassifierItem(e,t,s);this._front===-1&&this._rear===-1?(this._memory[0]=r,this._front=0,this._rear=0):(o=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=r),r.score=this._computeScore(r,o)}_computeScore(e,t){if(Math.abs(e.deltaX)>0&&Math.abs(e.deltaY)>0)return 1;let s=.5;if((!this._isAlmostInt(e.deltaX)||!this._isAlmostInt(e.deltaY))&&(s+=.25),t){const o=Math.abs(e.deltaX),r=Math.abs(e.deltaY),l=Math.abs(t.deltaX),c=Math.abs(t.deltaY),d=Math.max(Math.min(o,l),1),u=Math.max(Math.min(r,c),1),g=Math.max(o,l),f=Math.max(r,c);g%d===0&&f%u===0&&(s-=.5)}return Math.min(Math.max(s,0),1)}_isAlmostInt(e){const t=Number.EPSILON*100;return Math.abs(Math.round(e)-e)<.01+t}};os.INSTANCE=new os;let MouseWheelClassifier=os;class AbstractScrollableElement extends Widget$1{get onScroll(){return this._onScroll.event}get options(){return this._options}constructor(e,t,s){super(),this._inertialTimeout=null,this._inertialSpeed={X:0,Y:0},this._onScroll=this._register(new Emitter$1),this._onWillScroll=this._register(new Emitter$1),e.style.overflow="hidden",this._options=resolveOptions$1(t),this._scrollable=s,this._register(this._scrollable.onScroll(r=>{this._onWillScroll.fire(r),this._onDidScroll(r),this._onScroll.fire(r)}));const o={onMouseWheel:r=>this._onMouseWheel(r),onDragStart:()=>this._onDragStart(),onDragEnd:()=>this._onDragEnd()};this._verticalScrollbar=this._register(new VerticalScrollbar(this._scrollable,this._options,o)),this._horizontalScrollbar=this._register(new HorizontalScrollbar(this._scrollable,this._options,o)),this._domNode=document.createElement("div"),this._domNode.className="monaco-scrollable-element "+this._options.className,this._domNode.setAttribute("role","presentation"),this._domNode.style.position="relative",this._domNode.style.overflow="hidden",this._domNode.appendChild(e),this._domNode.appendChild(this._horizontalScrollbar.domNode.domNode),this._domNode.appendChild(this._verticalScrollbar.domNode.domNode),this._options.useShadows?(this._leftShadowDomNode=createFastDomNode(document.createElement("div")),this._leftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._leftShadowDomNode.domNode),this._topShadowDomNode=createFastDomNode(document.createElement("div")),this._topShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topShadowDomNode.domNode),this._topLeftShadowDomNode=createFastDomNode(document.createElement("div")),this._topLeftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topLeftShadowDomNode.domNode)):(this._leftShadowDomNode=null,this._topShadowDomNode=null,this._topLeftShadowDomNode=null),this._listenOnDomNode=this._options.listenOnDomNode||this._domNode,this._mouseWheelToDispose=[],this._setListeningToMouseWheel(this._options.handleMouseWheel),this.onmouseover(this._listenOnDomNode,r=>this._onMouseOver(r)),this.onmouseleave(this._listenOnDomNode,r=>this._onMouseLeave(r)),this._hideTimeout=this._register(new TimeoutTimer),this._isDragging=!1,this._mouseIsOver=!1,this._shouldRender=!0,this._revealOnScroll=!0}dispose(){this._mouseWheelToDispose=dispose(this._mouseWheelToDispose),this._inertialTimeout&&(this._inertialTimeout.dispose(),this._inertialTimeout=null),super.dispose()}getDomNode(){return this._domNode}getOverviewRulerLayoutInfo(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}delegateVerticalScrollbarPointerDown(e){this._verticalScrollbar.delegatePointerDown(e)}getScrollDimensions(){return this._scrollable.getScrollDimensions()}setScrollDimensions(e){this._scrollable.setScrollDimensions(e,!1)}updateClassName(e){this._options.className=e,isMacintosh&&(this._options.className+=" mac"),this._domNode.className="monaco-scrollable-element "+this._options.className}updateOptions(e){typeof e.handleMouseWheel<"u"&&(this._options.handleMouseWheel=e.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),typeof e.mouseWheelScrollSensitivity<"u"&&(this._options.mouseWheelScrollSensitivity=e.mouseWheelScrollSensitivity),typeof e.fastScrollSensitivity<"u"&&(this._options.fastScrollSensitivity=e.fastScrollSensitivity),typeof e.scrollPredominantAxis<"u"&&(this._options.scrollPredominantAxis=e.scrollPredominantAxis),typeof e.horizontal<"u"&&(this._options.horizontal=e.horizontal),typeof e.vertical<"u"&&(this._options.vertical=e.vertical),typeof e.horizontalScrollbarSize<"u"&&(this._options.horizontalScrollbarSize=e.horizontalScrollbarSize),typeof e.verticalScrollbarSize<"u"&&(this._options.verticalScrollbarSize=e.verticalScrollbarSize),typeof e.scrollByPage<"u"&&(this._options.scrollByPage=e.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}delegateScrollFromMouseWheelEvent(e){this._onMouseWheel(new StandardWheelEvent(e))}async _periodicSync(){var t;let e=!1;(this._inertialSpeed.X!==0||this._inertialSpeed.Y!==0)&&(this._scrollable.setScrollPositionNow({scrollTop:this._scrollable.getCurrentScrollPosition().scrollTop-this._inertialSpeed.Y*100,scrollLeft:this._scrollable.getCurrentScrollPosition().scrollLeft-this._inertialSpeed.X*100}),this._inertialSpeed.X*=.9,this._inertialSpeed.Y*=.9,Math.abs(this._inertialSpeed.X)<.01&&(this._inertialSpeed.X=0),Math.abs(this._inertialSpeed.Y)<.01&&(this._inertialSpeed.Y=0),e=this._inertialSpeed.X!==0||this._inertialSpeed.Y!==0),e?(this._inertialTimeout||(this._inertialTimeout=new TimeoutTimer),this._inertialTimeout.cancelAndSet(()=>this._periodicSync(),1e3/60)):((t=this._inertialTimeout)==null||t.dispose(),this._inertialTimeout=null)}_setListeningToMouseWheel(e){if(this._mouseWheelToDispose.length>0!==e&&(this._mouseWheelToDispose=dispose(this._mouseWheelToDispose),e)){const s=o=>{this._onMouseWheel(new StandardWheelEvent(o))};this._mouseWheelToDispose.push(addDisposableListener(this._listenOnDomNode,EventType$1.MOUSE_WHEEL,s,{passive:!1}))}}_onMouseWheel(e){var r;if((r=e.browserEvent)!=null&&r.defaultPrevented)return;const t=MouseWheelClassifier.INSTANCE;t.acceptStandardWheelEvent(e);let s=!1;if(e.deltaY||e.deltaX){let l=e.deltaY*this._options.mouseWheelScrollSensitivity,c=e.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&c+l===0?c=l=0:Math.abs(l)>=Math.abs(c)?c=0:l=0),this._options.flipAxes&&([l,c]=[c,l]);const d=!isMacintosh&&e.browserEvent&&e.browserEvent.shiftKey;(this._options.scrollYToX||d)&&!c&&(c=l,l=0),e.browserEvent&&e.browserEvent.altKey&&(c=c*this._options.fastScrollSensitivity,l=l*this._options.fastScrollSensitivity);const u=this._scrollable.getFutureScrollPosition();let g={};if(l){const f=SCROLL_WHEEL_SENSITIVITY*l,p=u.scrollTop-(f<0?Math.floor(f):Math.ceil(f));this._verticalScrollbar.writeScrollPosition(g,p)}if(c){const f=SCROLL_WHEEL_SENSITIVITY*c,p=u.scrollLeft-(f<0?Math.floor(f):Math.ceil(f));this._horizontalScrollbar.writeScrollPosition(g,p)}if(g=this._scrollable.validateScrollPosition(g),this._options.inertialScroll&&(c||l)){let f=!1;this._inertialSpeed.X===0&&this._inertialSpeed.Y===0&&(f=!0),this._inertialSpeed.Y=(l<0?-1:1)*Math.abs(l)**1.02,this._inertialSpeed.X=(c<0?-1:1)*Math.abs(c)**1.02,f&&this._periodicSync()}(u.scrollLeft!==g.scrollLeft||u.scrollTop!==g.scrollTop)&&(this._options.mouseWheelSmoothScroll&&t.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(g):this._scrollable.setScrollPositionNow(g),s=!0)}let o=s;!o&&this._options.alwaysConsumeMouseWheel&&(o=!0),!o&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(o=!0),o&&(e.preventDefault(),e.stopPropagation())}_onDidScroll(e){this._shouldRender=this._horizontalScrollbar.onDidScroll(e)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll(e)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}renderNow(){if(!this._options.lazyRender)throw new Error("Please use `lazyRender` together with `renderNow`!");this._render()}_render(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){const e=this._scrollable.getCurrentScrollPosition(),t=e.scrollTop>0,s=e.scrollLeft>0,o=s?" left":"",r=t?" top":"",l=s||t?" top-left-corner":"";this._leftShadowDomNode.setClassName(`shadow${o}`),this._topShadowDomNode.setClassName(`shadow${r}`),this._topLeftShadowDomNode.setClassName(`shadow${l}${r}${o}`)}}_onDragStart(){this._isDragging=!0,this._reveal()}_onDragEnd(){this._isDragging=!1,this._hide()}_onMouseLeave(e){this._mouseIsOver=!1,this._hide()}_onMouseOver(e){this._mouseIsOver=!0,this._reveal()}_reveal(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}_hide(){!this._mouseIsOver&&!this._isDragging&&(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}_scheduleHide(){!this._mouseIsOver&&!this._isDragging&&this._hideTimeout.cancelAndSet(()=>this._hide(),HIDE_TIMEOUT)}}class ScrollableElement extends AbstractScrollableElement{constructor(e,t){t=t||{},t.mouseWheelSmoothScroll=!1;const s=new Scrollable({forceIntegerValues:!0,smoothScrollDuration:0,scheduleAtNextAnimationFrame:o=>scheduleAtNextAnimationFrame(getWindow(e),o)});super(e,t,s),this._register(s)}setScrollPosition(e){this._scrollable.setScrollPositionNow(e)}}class SmoothScrollableElement extends AbstractScrollableElement{constructor(e,t,s){super(e,t,s)}setScrollPosition(e){e.reuseAnimation?this._scrollable.setScrollPositionSmooth(e,e.reuseAnimation):this._scrollable.setScrollPositionNow(e)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}}class DomScrollableElement extends AbstractScrollableElement{constructor(e,t){t=t||{},t.mouseWheelSmoothScroll=!1;const s=new Scrollable({forceIntegerValues:!1,smoothScrollDuration:0,scheduleAtNextAnimationFrame:o=>scheduleAtNextAnimationFrame(getWindow(e),o)});super(e,t,s),this._register(s),this._element=e,this._register(this.onScroll(o=>{o.scrollTopChanged&&(this._element.scrollTop=o.scrollTop),o.scrollLeftChanged&&(this._element.scrollLeft=o.scrollLeft)})),this.scanDomNode()}setScrollPosition(e){this._scrollable.setScrollPositionNow(e)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}scanDomNode(){this.setScrollDimensions({width:this._element.clientWidth,scrollWidth:this._element.scrollWidth,height:this._element.clientHeight,scrollHeight:this._element.scrollHeight}),this.setScrollPosition({scrollLeft:this._element.scrollLeft,scrollTop:this._element.scrollTop})}}function resolveOptions$1(a){const e={lazyRender:typeof a.lazyRender<"u"?a.lazyRender:!1,className:typeof a.className<"u"?a.className:"",useShadows:typeof a.useShadows<"u"?a.useShadows:!0,handleMouseWheel:typeof a.handleMouseWheel<"u"?a.handleMouseWheel:!0,flipAxes:typeof a.flipAxes<"u"?a.flipAxes:!1,consumeMouseWheelIfScrollbarIsNeeded:typeof a.consumeMouseWheelIfScrollbarIsNeeded<"u"?a.consumeMouseWheelIfScrollbarIsNeeded:!1,alwaysConsumeMouseWheel:typeof a.alwaysConsumeMouseWheel<"u"?a.alwaysConsumeMouseWheel:!1,scrollYToX:typeof a.scrollYToX<"u"?a.scrollYToX:!1,mouseWheelScrollSensitivity:typeof a.mouseWheelScrollSensitivity<"u"?a.mouseWheelScrollSensitivity:1,fastScrollSensitivity:typeof a.fastScrollSensitivity<"u"?a.fastScrollSensitivity:5,scrollPredominantAxis:typeof a.scrollPredominantAxis<"u"?a.scrollPredominantAxis:!0,mouseWheelSmoothScroll:typeof a.mouseWheelSmoothScroll<"u"?a.mouseWheelSmoothScroll:!0,inertialScroll:typeof a.inertialScroll<"u"?a.inertialScroll:!1,arrowSize:typeof a.arrowSize<"u"?a.arrowSize:11,listenOnDomNode:typeof a.listenOnDomNode<"u"?a.listenOnDomNode:null,horizontal:typeof a.horizontal<"u"?a.horizontal:1,horizontalScrollbarSize:typeof a.horizontalScrollbarSize<"u"?a.horizontalScrollbarSize:10,horizontalSliderSize:typeof a.horizontalSliderSize<"u"?a.horizontalSliderSize:0,horizontalHasArrows:typeof a.horizontalHasArrows<"u"?a.horizontalHasArrows:!1,vertical:typeof a.vertical<"u"?a.vertical:1,verticalScrollbarSize:typeof a.verticalScrollbarSize<"u"?a.verticalScrollbarSize:10,verticalHasArrows:typeof a.verticalHasArrows<"u"?a.verticalHasArrows:!1,verticalSliderSize:typeof a.verticalSliderSize<"u"?a.verticalSliderSize:0,scrollByPage:typeof a.scrollByPage<"u"?a.scrollByPage:!1};return e.horizontalSliderSize=typeof a.horizontalSliderSize<"u"?a.horizontalSliderSize:e.horizontalScrollbarSize,e.verticalSliderSize=typeof a.verticalSliderSize<"u"?a.verticalSliderSize:e.verticalScrollbarSize,isMacintosh&&(e.className+=" mac"),e}class DragScrolling extends Disposable{constructor(e,t,s,o){super(),this._context=e,this._viewHelper=t,this._mouseTargetFactory=s,this._dispatchMouse=o,this._operation=null}dispose(){super.dispose(),this.stop()}start(e,t){this._operation?this._operation.setPosition(e,t):this._operation=this._createDragScrollingOperation(e,t)}stop(){this._operation&&(this._operation.dispose(),this._operation=null)}}class DragScrollingOperation extends Disposable{constructor(e,t,s,o,r,l){super(),this._context=e,this._viewHelper=t,this._mouseTargetFactory=s,this._dispatchMouse=o,this._position=r,this._mouseEvent=l,this._lastTime=Date.now(),this._animationFrameDisposable=scheduleAtNextAnimationFrame(getWindow(l.browserEvent),()=>this._execute())}dispose(){this._animationFrameDisposable.dispose(),super.dispose()}setPosition(e,t){this._position=e,this._mouseEvent=t}_tick(){const e=Date.now(),t=e-this._lastTime;return this._lastTime=e,t}}class TopBottomDragScrolling extends DragScrolling{_createDragScrollingOperation(e,t){return new TopBottomDragScrollingOperation(this._context,this._viewHelper,this._mouseTargetFactory,this._dispatchMouse,e,t)}}class TopBottomDragScrollingOperation extends DragScrollingOperation{_getScrollSpeed(){const e=this._context.configuration.options.get(75),t=this._context.configuration.options.get(165).height/e,s=this._position.outsideDistance/e;return s<=1.5?Math.max(30,t*(1+s)):s<=3?Math.max(60,t*(2+s)):Math.max(200,t*(7+s))}_execute(){const e=this._context.configuration.options.get(75),t=this._getScrollSpeed(),s=this._tick(),o=t*(s/1e3)*e,r=this._position.outsidePosition==="above"?-o:o;this._context.viewModel.viewLayout.deltaScrollNow(0,r),this._viewHelper.renderNow();const l=this._context.viewLayout.getLinesViewportData(),c=this._position.outsidePosition==="above"?l.startLineNumber:l.endLineNumber;let d;{const u=createEditorPagePosition(this._viewHelper.viewDomNode),g=this._context.configuration.options.get(165).horizontalScrollbarHeight,f=new PageCoordinates(this._mouseEvent.pos.x,u.y+u.height-g-.1),p=createCoordinatesRelativeToEditor(this._viewHelper.viewDomNode,u,f);d=this._mouseTargetFactory.createMouseTarget(this._viewHelper.getLastRenderData(),u,f,p,null)}(!d.position||d.position.lineNumber!==c)&&(this._position.outsidePosition==="above"?d=MouseTarget.createOutsideEditor(this._position.mouseColumn,new Position$1(c,1),"above",this._position.outsideDistance):d=MouseTarget.createOutsideEditor(this._position.mouseColumn,new Position$1(c,this._context.viewModel.getLineMaxColumn(c)),"below",this._position.outsideDistance)),this._dispatchMouse(d,!0,2),this._animationFrameDisposable=scheduleAtNextAnimationFrame(getWindow(d.element),()=>this._execute())}}class LeftRightDragScrolling extends DragScrolling{_createDragScrollingOperation(e,t){return new LeftRightDragScrollingOperation(this._context,this._viewHelper,this._mouseTargetFactory,this._dispatchMouse,e,t)}}class LeftRightDragScrollingOperation extends DragScrollingOperation{_getScrollSpeed(){const e=this._context.configuration.options.get(59).typicalFullwidthCharacterWidth,t=this._context.configuration.options.get(165).contentWidth/e,s=this._position.outsideDistance/e;return s<=1.5?Math.max(30,t*(1+s)):s<=3?Math.max(60,t*(2+s)):Math.max(200,t*(7+s))}_execute(){const e=this._context.configuration.options.get(59).typicalFullwidthCharacterWidth,t=this._getScrollSpeed(),s=this._tick(),o=t*(s/1e3)*e*.5,r=this._position.outsidePosition==="left"?-o:o;if(this._context.viewModel.viewLayout.deltaScrollNow(r,0),this._viewHelper.renderNow(),!this._position.position)return;const l=this._position.position.lineNumber;let c;{const d=createEditorPagePosition(this._viewHelper.viewDomNode),u=this._context.configuration.options.get(165).horizontalScrollbarHeight,g=new PageCoordinates(this._mouseEvent.pos.x,d.y+d.height-u-.1),f=createCoordinatesRelativeToEditor(this._viewHelper.viewDomNode,d,g);c=this._mouseTargetFactory.createMouseTarget(this._viewHelper.getLastRenderData(),d,g,f,null)}this._position.outsidePosition==="left"?c=MouseTarget.createOutsideEditor(c.mouseColumn,new Position$1(l,c.mouseColumn),"left",this._position.outsideDistance):c=MouseTarget.createOutsideEditor(c.mouseColumn,new Position$1(l,c.mouseColumn),"right",this._position.outsideDistance),this._dispatchMouse(c,!0,2),this._animationFrameDisposable=scheduleAtNextAnimationFrame(getWindow(c.element),()=>this._execute())}}class MouseHandler extends ViewEventHandler{constructor(e,t,s){super(),this._mouseLeaveMonitor=null,this._context=e,this.viewController=t,this.viewHelper=s,this.mouseTargetFactory=new MouseTargetFactory(this._context,s),this._mouseDownOperation=this._register(new MouseDownOperation(this._context,this.viewController,this.viewHelper,this.mouseTargetFactory,(l,c)=>this._createMouseTarget(l,c),l=>this._getMouseColumn(l))),this.lastMouseLeaveTime=-1,this._height=this._context.configuration.options.get(165).height;const o=new EditorMouseEventFactory(this.viewHelper.viewDomNode);this._register(o.onContextMenu(this.viewHelper.viewDomNode,l=>this._onContextMenu(l,!0))),this._register(o.onMouseMove(this.viewHelper.viewDomNode,l=>{this._onMouseMove(l),this._mouseLeaveMonitor||(this._mouseLeaveMonitor=addDisposableListener(this.viewHelper.viewDomNode.ownerDocument,"mousemove",c=>{this.viewHelper.viewDomNode.contains(c.target)||this._onMouseLeave(new EditorMouseEvent(c,!1,this.viewHelper.viewDomNode))}))})),this._register(o.onMouseUp(this.viewHelper.viewDomNode,l=>this._onMouseUp(l))),this._register(o.onMouseLeave(this.viewHelper.viewDomNode,l=>this._onMouseLeave(l)));let r=0;this._register(o.onPointerDown(this.viewHelper.viewDomNode,(l,c)=>{r=c})),this._register(addDisposableListener(this.viewHelper.viewDomNode,EventType$1.POINTER_UP,l=>{this._mouseDownOperation.onPointerUp()})),this._register(o.onMouseDown(this.viewHelper.viewDomNode,l=>this._onMouseDown(l,r))),this._setupMouseWheelZoomListener(),this._context.addEventHandler(this)}_setupMouseWheelZoomListener(){const e=MouseWheelClassifier.INSTANCE;let t=0,s=EditorZoom.getZoomLevel(),o=!1,r=0;const l=d=>{if(this.viewController.emitMouseWheel(d),!this._context.configuration.options.get(84))return;const u=new StandardWheelEvent(d);if(e.acceptStandardWheelEvent(u),e.isPhysicalMouseWheel()){if(c(d)){const g=EditorZoom.getZoomLevel(),f=u.deltaY>0?1:-1;EditorZoom.setZoomLevel(g+f),u.preventDefault(),u.stopPropagation()}}else Date.now()-t>50&&(s=EditorZoom.getZoomLevel(),o=c(d),r=0),t=Date.now(),r+=u.deltaY,o&&(EditorZoom.setZoomLevel(s+r/5),u.preventDefault(),u.stopPropagation())};this._register(addDisposableListener(this.viewHelper.viewDomNode,EventType$1.MOUSE_WHEEL,l,{capture:!0,passive:!1}));function c(d){return isMacintosh?(d.metaKey||d.ctrlKey)&&!d.shiftKey&&!d.altKey:d.ctrlKey&&!d.metaKey&&!d.shiftKey&&!d.altKey}}dispose(){this._context.removeEventHandler(this),this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),super.dispose()}onConfigurationChanged(e){if(e.hasChanged(165)){const t=this._context.configuration.options.get(165).height;this._height!==t&&(this._height=t,this._mouseDownOperation.onHeightChanged())}return!1}onCursorStateChanged(e){return this._mouseDownOperation.onCursorStateChanged(e),!1}onFocusChanged(e){return!1}getTargetAtClientPoint(e,t){const o=new ClientCoordinates(e,t).toPageCoordinates(getWindow(this.viewHelper.viewDomNode)),r=createEditorPagePosition(this.viewHelper.viewDomNode);if(o.y<r.y||o.y>r.y+r.height||o.x<r.x||o.x>r.x+r.width)return null;const l=createCoordinatesRelativeToEditor(this.viewHelper.viewDomNode,r,o);return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),r,o,l,null)}_createMouseTarget(e,t){let s=e.target;if(!this.viewHelper.viewDomNode.contains(s)){const o=getShadowRoot(this.viewHelper.viewDomNode);o&&(s=o.elementsFromPoint(e.posx,e.posy).find(r=>this.viewHelper.viewDomNode.contains(r)))}return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),e.editorPos,e.pos,e.relativePos,t?s:null)}_getMouseColumn(e){return this.mouseTargetFactory.getMouseColumn(e.relativePos)}_onContextMenu(e,t){this.viewController.emitContextMenu({event:e,target:this._createMouseTarget(e,t)})}_onMouseMove(e){this.mouseTargetFactory.mouseTargetIsWidget(e)||e.preventDefault(),!(this._mouseDownOperation.isActive()||e.timestamp<this.lastMouseLeaveTime)&&this.viewController.emitMouseMove({event:e,target:this._createMouseTarget(e,!0)})}_onMouseLeave(e){this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),this.lastMouseLeaveTime=new Date().getTime(),this.viewController.emitMouseLeave({event:e,target:null})}_onMouseUp(e){this.viewController.emitMouseUp({event:e,target:this._createMouseTarget(e,!0)})}_onMouseDown(e,t){const s=this._createMouseTarget(e,!0),o=s.type===6||s.type===7,r=s.type===2||s.type===3||s.type===4,l=s.type===3,c=this._context.configuration.options.get(125),d=s.type===8||s.type===5,u=s.type===9;let g=e.leftButton||e.middleButton;isMacintosh&&e.leftButton&&e.ctrlKey&&(g=!1);const f=()=>{e.preventDefault(),this.viewHelper.focusTextArea()};if(g&&(o||l&&c))f(),this._mouseDownOperation.start(s.type,e,t);else if(r)e.preventDefault();else if(d){const p=s.detail;g&&this.viewHelper.shouldSuppressMouseDownOnViewZone(p.viewZoneId)&&(f(),this._mouseDownOperation.start(s.type,e,t),e.preventDefault())}else u&&this.viewHelper.shouldSuppressMouseDownOnWidget(s.detail)&&(f(),e.preventDefault());this.viewController.emitMouseDown({event:e,target:s})}}class MouseDownOperation extends Disposable{constructor(e,t,s,o,r,l){super(),this._context=e,this._viewController=t,this._viewHelper=s,this._mouseTargetFactory=o,this._createMouseTarget=r,this._getMouseColumn=l,this._mouseMoveMonitor=this._register(new GlobalEditorPointerMoveMonitor(this._viewHelper.viewDomNode)),this._topBottomDragScrolling=this._register(new TopBottomDragScrolling(this._context,this._viewHelper,this._mouseTargetFactory,(c,d,u)=>this._dispatchMouse(c,d,u))),this._leftRightDragScrolling=this._register(new LeftRightDragScrolling(this._context,this._viewHelper,this._mouseTargetFactory,(c,d,u)=>this._dispatchMouse(c,d,u))),this._mouseState=new MouseDownState,this._currentSelection=new Selection$1(1,1,1,1),this._isActive=!1,this._lastMouseEvent=null}dispose(){super.dispose()}isActive(){return this._isActive}_onMouseDownThenMove(e){this._lastMouseEvent=e,this._mouseState.setModifiers(e);const t=this._findMousePosition(e,!1);t&&(this._mouseState.isDragAndDrop?this._viewController.emitMouseDrag({event:e,target:t}):t.type===13?t.outsidePosition==="above"||t.outsidePosition==="below"?(this._topBottomDragScrolling.start(t,e),this._leftRightDragScrolling.stop()):(this._leftRightDragScrolling.start(t,e),this._topBottomDragScrolling.stop()):(this._topBottomDragScrolling.stop(),this._leftRightDragScrolling.stop(),this._dispatchMouse(t,!0,1)))}start(e,t,s){this._lastMouseEvent=t,this._mouseState.setStartedOnLineNumbers(e===3),this._mouseState.setStartButtons(t),this._mouseState.setModifiers(t);const o=this._findMousePosition(t,!0);if(!o||!o.position)return;this._mouseState.trySetCount(t.detail,o.position),t.detail=this._mouseState.count;const r=this._context.configuration.options;if(!r.get(104)&&r.get(42)&&!r.get(28)&&!this._mouseState.altKey&&t.detail<2&&!this._isActive&&!this._currentSelection.isEmpty()&&o.type===6&&o.position&&this._currentSelection.containsPosition(o.position)){this._mouseState.isDragAndDrop=!0,this._isActive=!0,this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,s,t.buttons,l=>this._onMouseDownThenMove(l),l=>{const c=this._findMousePosition(this._lastMouseEvent,!1);isKeyboardEvent(l)?this._viewController.emitMouseDropCanceled():this._viewController.emitMouseDrop({event:this._lastMouseEvent,target:c?this._createMouseTarget(this._lastMouseEvent,!0):null}),this._stop()});return}this._mouseState.isDragAndDrop=!1,this._dispatchMouse(o,t.shiftKey,1),this._isActive||(this._isActive=!0,this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,s,t.buttons,l=>this._onMouseDownThenMove(l),()=>this._stop()))}_stop(){this._isActive=!1,this._topBottomDragScrolling.stop(),this._leftRightDragScrolling.stop()}onHeightChanged(){this._mouseMoveMonitor.stopMonitoring()}onPointerUp(){this._mouseMoveMonitor.stopMonitoring()}onCursorStateChanged(e){this._currentSelection=e.selections[0]}_getPositionOutsideEditor(e){const t=e.editorPos,s=this._context.viewModel,o=this._context.viewLayout,r=this._getMouseColumn(e);if(e.posy<t.y){const f=t.y-e.posy,p=Math.max(o.getCurrentScrollTop()-f,0),m=HitTestContext.getZoneAtCoord(this._context,p);if(m){const C=this._helpPositionJumpOverViewZone(m);if(C)return MouseTarget.createOutsideEditor(r,C,"above",f)}const _=o.getLineNumberAtVerticalOffset(p);return MouseTarget.createOutsideEditor(r,new Position$1(_,1),"above",f)}if(e.posy>t.y+t.height){const f=e.posy-t.y-t.height,p=o.getCurrentScrollTop()+e.relativePos.y,m=HitTestContext.getZoneAtCoord(this._context,p);if(m){const C=this._helpPositionJumpOverViewZone(m);if(C)return MouseTarget.createOutsideEditor(r,C,"below",f)}const _=o.getLineNumberAtVerticalOffset(p);return MouseTarget.createOutsideEditor(r,new Position$1(_,s.getLineMaxColumn(_)),"below",f)}const l=o.getLineNumberAtVerticalOffset(o.getCurrentScrollTop()+e.relativePos.y),c=this._context.configuration.options.get(165),d=c.contentLeft;if(e.relativePos.x<=d){const f=d-e.relativePos.x;return MouseTarget.createOutsideEditor(r,new Position$1(l,1),"left",f)}const g=c.minimap.minimapLeft===0?c.width-c.verticalScrollbarWidth:c.minimap.minimapLeft;if(e.relativePos.x>=g){const f=e.relativePos.x-g;return MouseTarget.createOutsideEditor(r,new Position$1(l,s.getLineMaxColumn(l)),"right",f)}return null}_findMousePosition(e,t){const s=this._getPositionOutsideEditor(e);if(s)return s;const o=this._createMouseTarget(e,t);if(!o.position)return null;if(o.type===8||o.type===5){const l=this._helpPositionJumpOverViewZone(o.detail);if(l)return MouseTarget.createViewZone(o.type,o.element,o.mouseColumn,l,o.detail)}return o}_helpPositionJumpOverViewZone(e){const t=new Position$1(this._currentSelection.selectionStartLineNumber,this._currentSelection.selectionStartColumn),s=e.positionBefore,o=e.positionAfter;return s&&o?s.isBefore(t)?s:o:null}_dispatchMouse(e,t,s){e.position&&this._viewController.dispatchMouse({position:e.position,mouseColumn:e.mouseColumn,startedOnLineNumbers:this._mouseState.startedOnLineNumbers,revealType:s,inSelectionMode:t,mouseDownCount:this._mouseState.count,altKey:this._mouseState.altKey,ctrlKey:this._mouseState.ctrlKey,metaKey:this._mouseState.metaKey,shiftKey:this._mouseState.shiftKey,leftButton:this._mouseState.leftButton,middleButton:this._mouseState.middleButton,onInjectedText:e.type===6&&e.detail.injectedText!==null})}}const rs=class rs{get altKey(){return this._altKey}get ctrlKey(){return this._ctrlKey}get metaKey(){return this._metaKey}get shiftKey(){return this._shiftKey}get leftButton(){return this._leftButton}get middleButton(){return this._middleButton}get startedOnLineNumbers(){return this._startedOnLineNumbers}constructor(){this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._leftButton=!1,this._middleButton=!1,this._startedOnLineNumbers=!1,this._lastMouseDownPosition=null,this._lastMouseDownPositionEqualCount=0,this._lastMouseDownCount=0,this._lastSetMouseDownCountTime=0,this.isDragAndDrop=!1}get count(){return this._lastMouseDownCount}setModifiers(e){this._altKey=e.altKey,this._ctrlKey=e.ctrlKey,this._metaKey=e.metaKey,this._shiftKey=e.shiftKey}setStartButtons(e){this._leftButton=e.leftButton,this._middleButton=e.middleButton}setStartedOnLineNumbers(e){this._startedOnLineNumbers=e}trySetCount(e,t){const s=new Date().getTime();s-this._lastSetMouseDownCountTime>rs.CLEAR_MOUSE_DOWN_COUNT_TIME&&(e=1),this._lastSetMouseDownCountTime=s,e>this._lastMouseDownCount+1&&(e=this._lastMouseDownCount+1),this._lastMouseDownPosition&&this._lastMouseDownPosition.equals(t)?this._lastMouseDownPositionEqualCount++:this._lastMouseDownPositionEqualCount=1,this._lastMouseDownPosition=t,this._lastMouseDownCount=Math.min(e,this._lastMouseDownPositionEqualCount)}};rs.CLEAR_MOUSE_DOWN_COUNT_TIME=400;let MouseDownState=rs;class DomEmitter{get event(){return this.emitter.event}constructor(e,t,s){const o=r=>this.emitter.fire(r);this.emitter=new Emitter$1({onWillAddFirstListener:()=>e.addEventListener(t,o,s),onDidRemoveLastListener:()=>e.removeEventListener(t,o,s)})}dispose(){this.emitter.dispose()}}function getDataToCopy(a,e,t,s){const o=a.getPlainTextToCopy(e,t,isWindows),r=a.model.getEOL(),l=t&&e.length===1&&e[0].isEmpty(),c=Array.isArray(o)?o:null,d=Array.isArray(o)?o.join(r):o;let u,g=null;if(CopyOptions.forceCopyWithSyntaxHighlighting||s&&d.length<65536){const p=a.getRichTextToCopy(e,t);p&&(u=p.html,g=p.mode)}return{isFromEmptySelection:l,multicursorText:c,text:d,html:u,mode:g}}const as=class as{constructor(){this._lastState=null}set(e,t){this._lastState={lastCopiedValue:e,data:t}}get(e){return this._lastState&&this._lastState.lastCopiedValue===e?this._lastState.data:(this._lastState=null,null)}};as.INSTANCE=new as;let InMemoryClipboardMetadataManager=as;const CopyOptions={forceCopyWithSyntaxHighlighting:!1},ClipboardEventUtils={getTextData(a){const e=a.getData(Mimes.text);let t=null;const s=a.getData("vscode-editor-data");if(typeof s=="string")try{t=JSON.parse(s),t.version!==1&&(t=null)}catch{}return e.length===0&&t===null&&a.files.length>0?[Array.prototype.slice.call(a.files,0).map(r=>r.name).join(`
`),null]:[e,t]},setTextData(a,e,t,s){a.setData(Mimes.text,e),typeof t=="string"&&a.setData("text/html",t),a.setData("vscode-editor-data",JSON.stringify(s))}},wt=class wt{constructor(e,t,s,o,r){this.value=e,this.selectionStart=t,this.selectionEnd=s,this.selection=o,this.newlineCountBeforeSelection=r}toString(){return`[ <${this.value}>, selectionStart: ${this.selectionStart}, selectionEnd: ${this.selectionEnd}]`}static readFromTextArea(e,t){const s=e.getValue(),o=e.getSelectionStart(),r=e.getSelectionEnd();let l;if(t){const c=s.substring(0,o),d=t.value.substring(0,t.selectionStart);c===d&&(l=t.newlineCountBeforeSelection)}return new wt(s,o,r,null,l)}collapseSelection(){return this.selectionStart===this.value.length?this:new wt(this.value,this.value.length,this.value.length,null,void 0)}isWrittenToTextArea(e,t){const s=this.value===e.getValue();return t?this.selectionStart===e.getSelectionStart()&&this.selectionEnd===e.getSelectionEnd()&&s:s}writeToTextArea(e,t,s){t.setValue(e,this.value),s&&t.setSelectionRange(e,this.selectionStart,this.selectionEnd)}deduceEditorPosition(e){var o,r,l,c;if(e<=this.selectionStart){const d=this.value.substring(e,this.selectionStart);return this._finishDeduceEditorPosition(((o=this.selection)==null?void 0:o.getStartPosition())??null,d,-1)}if(e>=this.selectionEnd){const d=this.value.substring(this.selectionEnd,e);return this._finishDeduceEditorPosition(((r=this.selection)==null?void 0:r.getEndPosition())??null,d,1)}const t=this.value.substring(this.selectionStart,e);if(t.indexOf(String.fromCharCode(8230))===-1)return this._finishDeduceEditorPosition(((l=this.selection)==null?void 0:l.getStartPosition())??null,t,1);const s=this.value.substring(e,this.selectionEnd);return this._finishDeduceEditorPosition(((c=this.selection)==null?void 0:c.getEndPosition())??null,s,-1)}_finishDeduceEditorPosition(e,t,s){let o=0,r=-1;for(;(r=t.indexOf(`
`,r+1))!==-1;)o++;return[e,s*t.length,o]}static deduceInput(e,t,s){if(!e)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0};const o=Math.min(commonPrefixLength(e.value,t.value),e.selectionStart,t.selectionStart),r=Math.min(commonSuffixLength(e.value,t.value),e.value.length-e.selectionEnd,t.value.length-t.selectionEnd);e.value.substring(o,e.value.length-r);const l=t.value.substring(o,t.value.length-r),c=e.selectionStart-o,d=e.selectionEnd-o,u=t.selectionStart-o,g=t.selectionEnd-o;if(u===g){const p=e.selectionStart-o;return{text:l,replacePrevCharCnt:p,replaceNextCharCnt:0,positionDelta:0}}const f=d-c;return{text:l,replacePrevCharCnt:f,replaceNextCharCnt:0,positionDelta:0}}static deduceAndroidCompositionInput(e,t){if(!e)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0};if(e.value===t.value)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:t.selectionEnd-e.selectionEnd};const s=Math.min(commonPrefixLength(e.value,t.value),e.selectionEnd),o=Math.min(commonSuffixLength(e.value,t.value),e.value.length-e.selectionEnd),r=e.value.substring(s,e.value.length-o),l=t.value.substring(s,t.value.length-o);e.selectionStart-s;const c=e.selectionEnd-s;t.selectionStart-s;const d=t.selectionEnd-s;return{text:l,replacePrevCharCnt:c,replaceNextCharCnt:r.length-c,positionDelta:d-l.length}}static fromScreenReaderContentState(e){return new wt(e.value,e.selectionStart,e.selectionEnd,e.selection,e.newlineCountBeforeSelection)}};wt.EMPTY=new wt("",0,0,null,void 0);let TextAreaState=wt;const generateUuid=function(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID.bind(crypto);const a=new Uint8Array(16),e=[];for(let t=0;t<256;t++)e.push(t.toString(16).padStart(2,"0"));return function(){crypto.getRandomValues(a),a[6]=a[6]&15|64,a[8]=a[8]&63|128;let s=0,o="";return o+=e[a[s++]],o+=e[a[s++]],o+=e[a[s++]],o+=e[a[s++]],o+="-",o+=e[a[s++]],o+=e[a[s++]],o+="-",o+=e[a[s++]],o+=e[a[s++]],o+="-",o+=e[a[s++]],o+=e[a[s++]],o+="-",o+=e[a[s++]],o+=e[a[s++]],o+=e[a[s++]],o+=e[a[s++]],o+=e[a[s++]],o+=e[a[s++]],o}}();function prefixedUuid(a){return`${a}-${generateUuid()}`}var __decorate$2T=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2N=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},TextAreaSyntethicEvents;(function(a){a.Tap="-monaco-textarea-synthetic-tap"})(TextAreaSyntethicEvents||(TextAreaSyntethicEvents={}));class CompositionContext{constructor(){this._lastTypeTextLength=0}handleCompositionUpdate(e){e=e||"";const t={text:e,replacePrevCharCnt:this._lastTypeTextLength,replaceNextCharCnt:0,positionDelta:0};return this._lastTypeTextLength=e.length,t}}let TextAreaInput=class extends Disposable{get textAreaState(){return this._textAreaState}constructor(e,t,s,o,r,l){super(),this._host=e,this._textArea=t,this._OS=s,this._browser=o,this._accessibilityService=r,this._logService=l,this._onFocus=this._register(new Emitter$1),this.onFocus=this._onFocus.event,this._onBlur=this._register(new Emitter$1),this.onBlur=this._onBlur.event,this._onKeyDown=this._register(new Emitter$1),this.onKeyDown=this._onKeyDown.event,this._onKeyUp=this._register(new Emitter$1),this.onKeyUp=this._onKeyUp.event,this._onCut=this._register(new Emitter$1),this.onCut=this._onCut.event,this._onPaste=this._register(new Emitter$1),this.onPaste=this._onPaste.event,this._onType=this._register(new Emitter$1),this.onType=this._onType.event,this._onCompositionStart=this._register(new Emitter$1),this.onCompositionStart=this._onCompositionStart.event,this._onCompositionUpdate=this._register(new Emitter$1),this.onCompositionUpdate=this._onCompositionUpdate.event,this._onCompositionEnd=this._register(new Emitter$1),this.onCompositionEnd=this._onCompositionEnd.event,this._onSelectionChangeRequest=this._register(new Emitter$1),this.onSelectionChangeRequest=this._onSelectionChangeRequest.event,this._asyncFocusGainWriteScreenReaderContent=this._register(new MutableDisposable),this._asyncTriggerCut=this._register(new RunOnceScheduler(()=>this._onCut.fire(),0)),this._textAreaState=TextAreaState.EMPTY,this._selectionChangeListener=null,this._accessibilityService.isScreenReaderOptimized()&&this.writeNativeTextAreaContent("ctor"),this._register(Event$1.runAndSubscribe(this._accessibilityService.onDidChangeScreenReaderOptimized,()=>{this._accessibilityService.isScreenReaderOptimized()&&!this._asyncFocusGainWriteScreenReaderContent.value?this._asyncFocusGainWriteScreenReaderContent.value=this._register(new RunOnceScheduler(()=>this.writeNativeTextAreaContent("asyncFocusGain"),0)):this._asyncFocusGainWriteScreenReaderContent.clear()})),this._hasFocus=!1,this._currentComposition=null;let c=null;this._register(this._textArea.onKeyDown(d=>{const u=new StandardKeyboardEvent(d);(u.keyCode===114||this._currentComposition&&u.keyCode===1)&&u.stopPropagation(),u.equals(9)&&u.preventDefault(),c=u,this._onKeyDown.fire(u)})),this._register(this._textArea.onKeyUp(d=>{const u=new StandardKeyboardEvent(d);this._onKeyUp.fire(u)})),this._register(this._textArea.onCompositionStart(d=>{const u=new CompositionContext;if(this._currentComposition){this._currentComposition=u;return}if(this._currentComposition=u,this._OS===2&&c&&c.equals(114)&&this._textAreaState.selectionStart===this._textAreaState.selectionEnd&&this._textAreaState.selectionStart>0&&this._textAreaState.value.substr(this._textAreaState.selectionStart-1,1)===d.data&&(c.code==="ArrowRight"||c.code==="ArrowLeft")){u.handleCompositionUpdate("x"),this._onCompositionStart.fire({data:d.data});return}if(this._browser.isAndroid){this._onCompositionStart.fire({data:d.data});return}this._onCompositionStart.fire({data:d.data})})),this._register(this._textArea.onCompositionUpdate(d=>{const u=this._currentComposition;if(!u)return;if(this._browser.isAndroid){const f=TextAreaState.readFromTextArea(this._textArea,this._textAreaState),p=TextAreaState.deduceAndroidCompositionInput(this._textAreaState,f);this._textAreaState=f,this._onType.fire(p),this._onCompositionUpdate.fire(d);return}const g=u.handleCompositionUpdate(d.data);this._textAreaState=TextAreaState.readFromTextArea(this._textArea,this._textAreaState),this._onType.fire(g),this._onCompositionUpdate.fire(d)})),this._register(this._textArea.onCompositionEnd(d=>{const u=this._currentComposition;if(!u)return;if(this._currentComposition=null,this._browser.isAndroid){const f=TextAreaState.readFromTextArea(this._textArea,this._textAreaState),p=TextAreaState.deduceAndroidCompositionInput(this._textAreaState,f);this._textAreaState=f,this._onType.fire(p),this._onCompositionEnd.fire();return}const g=u.handleCompositionUpdate(d.data);this._textAreaState=TextAreaState.readFromTextArea(this._textArea,this._textAreaState),this._onType.fire(g),this._onCompositionEnd.fire()})),this._register(this._textArea.onInput(d=>{if(this._textArea.setIgnoreSelectionChangeTime("received input event"),this._currentComposition)return;const u=TextAreaState.readFromTextArea(this._textArea,this._textAreaState),g=TextAreaState.deduceInput(this._textAreaState,u,this._OS===2);g.replacePrevCharCnt===0&&g.text.length===1&&(isHighSurrogate(g.text.charCodeAt(0))||g.text.charCodeAt(0)===127)||(this._textAreaState=u,(g.text!==""||g.replacePrevCharCnt!==0||g.replaceNextCharCnt!==0||g.positionDelta!==0)&&(d.inputType==="insertFromPaste"?this._onPaste.fire({text:g.text,metadata:InMemoryClipboardMetadataManager.INSTANCE.get(g.text)}):this._onType.fire(g)))})),this._register(this._textArea.onCut(d=>{this._logService.trace("TextAreaInput#onCut",d),this._textArea.setIgnoreSelectionChangeTime("received cut event"),this._ensureClipboardGetsEditorSelection(d),this._asyncTriggerCut.schedule()})),this._register(this._textArea.onCopy(d=>{this._logService.trace("TextAreaInput#onCopy",d),this._ensureClipboardGetsEditorSelection(d)})),this._register(this._textArea.onPaste(d=>{if(this._logService.trace("TextAreaInput#onPaste",d),this._textArea.setIgnoreSelectionChangeTime("received paste event"),d.preventDefault(),!d.clipboardData)return;let[u,g]=ClipboardEventUtils.getTextData(d.clipboardData);this._logService.trace("TextAreaInput#onPaste with id : ",g==null?void 0:g.id," with text.length: ",u.length),u&&(g=g||InMemoryClipboardMetadataManager.INSTANCE.get(u),this._logService.trace("TextAreaInput#onPaste (before onPaste)"),this._onPaste.fire({text:u,metadata:g}))})),this._register(this._textArea.onFocus(()=>{const d=this._hasFocus;this._setHasFocus(!0),this._accessibilityService.isScreenReaderOptimized()&&this._browser.isSafari&&!d&&this._hasFocus&&(this._asyncFocusGainWriteScreenReaderContent.value||(this._asyncFocusGainWriteScreenReaderContent.value=new RunOnceScheduler(()=>this.writeNativeTextAreaContent("asyncFocusGain"),0)),this._asyncFocusGainWriteScreenReaderContent.value.schedule())})),this._register(this._textArea.onBlur(()=>{this._currentComposition&&(this._currentComposition=null,this.writeNativeTextAreaContent("blurWithoutCompositionEnd"),this._onCompositionEnd.fire()),this._setHasFocus(!1)})),this._register(this._textArea.onSyntheticTap(()=>{this._browser.isAndroid&&this._currentComposition&&(this._currentComposition=null,this.writeNativeTextAreaContent("tapWithoutCompositionEnd"),this._onCompositionEnd.fire())}))}_installSelectionChangeListener(){let e=0;return addDisposableListener(this._textArea.ownerDocument,"selectionchange",t=>{if(inputLatency.onSelectionChange(),!this._hasFocus||this._currentComposition||!this._browser.isChrome)return;const s=Date.now(),o=s-e;if(e=s,o<5)return;const r=s-this._textArea.getIgnoreSelectionChangeTime();if(this._textArea.resetSelectionChangeTime(),r<100||!this._textAreaState.selection)return;const l=this._textArea.getValue();if(this._textAreaState.value!==l)return;const c=this._textArea.getSelectionStart(),d=this._textArea.getSelectionEnd();if(this._textAreaState.selectionStart===c&&this._textAreaState.selectionEnd===d)return;const u=this._textAreaState.deduceEditorPosition(c),g=this._host.deduceModelPosition(u[0],u[1],u[2]),f=this._textAreaState.deduceEditorPosition(d),p=this._host.deduceModelPosition(f[0],f[1],f[2]),m=new Selection$1(g.lineNumber,g.column,p.lineNumber,p.column);this._onSelectionChangeRequest.fire(m)})}dispose(){super.dispose(),this._selectionChangeListener&&(this._selectionChangeListener.dispose(),this._selectionChangeListener=null)}focusTextArea(){this._setHasFocus(!0),this.refreshFocusState()}isFocused(){return this._hasFocus}refreshFocusState(){this._setHasFocus(this._textArea.hasFocus())}_setHasFocus(e){this._hasFocus!==e&&(this._hasFocus=e,this._selectionChangeListener&&(this._selectionChangeListener.dispose(),this._selectionChangeListener=null),this._hasFocus&&(this._selectionChangeListener=this._installSelectionChangeListener()),this._hasFocus&&this.writeNativeTextAreaContent("focusgain"),this._hasFocus?this._onFocus.fire():this._onBlur.fire())}_setAndWriteTextAreaState(e,t){this._hasFocus||(t=t.collapseSelection()),t.isWrittenToTextArea(this._textArea,this._hasFocus)||this._logService.trace(`writeTextAreaState(reason: ${e})`),t.writeToTextArea(e,this._textArea,this._hasFocus),this._textAreaState=t}writeNativeTextAreaContent(e){!this._accessibilityService.isScreenReaderOptimized()&&e==="render"||this._currentComposition||this._setAndWriteTextAreaState(e,this._host.getScreenReaderContent())}_ensureClipboardGetsEditorSelection(e){const t=this._host.getDataToCopy();let s;this._logService.getLevel()===LogLevel.Trace&&(s=generateUuid());const o={version:1,id:s,isFromEmptySelection:t.isFromEmptySelection,multicursorText:t.multicursorText,mode:t.mode};InMemoryClipboardMetadataManager.INSTANCE.set(this._browser.isFirefox?t.text.replace(/\r\n/g,`
`):t.text,o),e.preventDefault(),e.clipboardData&&ClipboardEventUtils.setTextData(e.clipboardData,t.text,t.html,o),this._logService.trace("TextAreaEditContextInput#_ensureClipboardGetsEditorSelection with id : ",s," with text.length: ",t.text.length)}};TextAreaInput=__decorate$2T([__param$2N(4,IAccessibilityService),__param$2N(5,ILogService)],TextAreaInput);class TextAreaWrapper extends Disposable{get ownerDocument(){return this._actual.ownerDocument}constructor(e){super(),this._actual=e,this._onSyntheticTap=this._register(new Emitter$1),this.onSyntheticTap=this._onSyntheticTap.event,this._ignoreSelectionChangeTime=0,this.onKeyDown=this._register(new DomEmitter(this._actual,"keydown")).event,this.onKeyPress=this._register(new DomEmitter(this._actual,"keypress")).event,this.onKeyUp=this._register(new DomEmitter(this._actual,"keyup")).event,this.onCompositionStart=this._register(new DomEmitter(this._actual,"compositionstart")).event,this.onCompositionUpdate=this._register(new DomEmitter(this._actual,"compositionupdate")).event,this.onCompositionEnd=this._register(new DomEmitter(this._actual,"compositionend")).event,this.onBeforeInput=this._register(new DomEmitter(this._actual,"beforeinput")).event,this.onInput=this._register(new DomEmitter(this._actual,"input")).event,this.onCut=this._register(new DomEmitter(this._actual,"cut")).event,this.onCopy=this._register(new DomEmitter(this._actual,"copy")).event,this.onPaste=this._register(new DomEmitter(this._actual,"paste")).event,this.onFocus=this._register(new DomEmitter(this._actual,"focus")).event,this.onBlur=this._register(new DomEmitter(this._actual,"blur")).event,this._register(this.onKeyDown(()=>inputLatency.onKeyDown())),this._register(this.onBeforeInput(()=>inputLatency.onBeforeInput())),this._register(this.onInput(()=>inputLatency.onInput())),this._register(this.onKeyUp(()=>inputLatency.onKeyUp())),this._register(addDisposableListener(this._actual,TextAreaSyntethicEvents.Tap,()=>this._onSyntheticTap.fire()))}hasFocus(){const e=getShadowRoot(this._actual);return e?e.activeElement===this._actual:this._actual.isConnected?getActiveElement()===this._actual:!1}setIgnoreSelectionChangeTime(e){this._ignoreSelectionChangeTime=Date.now()}getIgnoreSelectionChangeTime(){return this._ignoreSelectionChangeTime}resetSelectionChangeTime(){this._ignoreSelectionChangeTime=0}getValue(){return this._actual.value}setValue(e,t){const s=this._actual;s.value!==t&&(this.setIgnoreSelectionChangeTime("setValue"),s.value=t)}getSelectionStart(){return this._actual.selectionDirection==="backward"?this._actual.selectionEnd:this._actual.selectionStart}getSelectionEnd(){return this._actual.selectionDirection==="backward"?this._actual.selectionStart:this._actual.selectionEnd}setSelectionRange(e,t,s){const o=this._actual;let r=null;const l=getShadowRoot(o);l?r=l.activeElement:r=getActiveElement();const c=getWindow(r),d=r===o,u=o.selectionStart,g=o.selectionEnd;if(d&&u===t&&g===s){isFirefox$1&&c.parent!==c&&o.focus();return}if(d){this.setIgnoreSelectionChangeTime("setSelectionRange"),o.setSelectionRange(t,s),isFirefox$1&&c.parent!==c&&o.focus();return}try{const f=saveParentsScrollTop(o);this.setIgnoreSelectionChangeTime("setSelectionRange"),o.focus(),o.setSelectionRange(t,s),restoreParentsScrollTop(o,f)}catch{}}}class PointerEventHandler extends MouseHandler{constructor(e,t,s){super(e,t,s),this._register(Gesture.addTarget(this.viewHelper.linesContentDomNode)),this._register(addDisposableListener(this.viewHelper.linesContentDomNode,EventType.Tap,r=>this.onTap(r))),this._register(addDisposableListener(this.viewHelper.linesContentDomNode,EventType.Change,r=>this.onChange(r))),this._register(addDisposableListener(this.viewHelper.linesContentDomNode,EventType.Contextmenu,r=>this._onContextMenu(new EditorMouseEvent(r,!1,this.viewHelper.viewDomNode),!1))),this._lastPointerType="mouse",this._register(addDisposableListener(this.viewHelper.linesContentDomNode,"pointerdown",r=>{const l=r.pointerType;if(l==="mouse"){this._lastPointerType="mouse";return}else l==="touch"?this._lastPointerType="touch":this._lastPointerType="pen"}));const o=new EditorPointerEventFactory(this.viewHelper.viewDomNode);this._register(o.onPointerMove(this.viewHelper.viewDomNode,r=>this._onMouseMove(r))),this._register(o.onPointerUp(this.viewHelper.viewDomNode,r=>this._onMouseUp(r))),this._register(o.onPointerLeave(this.viewHelper.viewDomNode,r=>this._onMouseLeave(r))),this._register(o.onPointerDown(this.viewHelper.viewDomNode,(r,l)=>this._onMouseDown(r,l)))}onTap(e){!e.initialTarget||!this.viewHelper.linesContentDomNode.contains(e.initialTarget)||(e.preventDefault(),this.viewHelper.focusTextArea(),this._dispatchGesture(e,!1))}onChange(e){this._lastPointerType==="touch"&&this._context.viewModel.viewLayout.deltaScrollNow(-e.translationX,-e.translationY),this._lastPointerType==="pen"&&this._dispatchGesture(e,!0)}_dispatchGesture(e,t){const s=this._createMouseTarget(new EditorMouseEvent(e,!1,this.viewHelper.viewDomNode),!1);s.position&&this.viewController.dispatchMouse({position:s.position,mouseColumn:s.position.column,startedOnLineNumbers:!1,revealType:1,mouseDownCount:e.tapCount,inSelectionMode:t,altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,leftButton:!1,middleButton:!1,onInjectedText:s.type===6&&s.detail.injectedText!==null})}_onMouseDown(e,t){e.browserEvent.pointerType!=="touch"&&super._onMouseDown(e,t)}}class TouchHandler extends MouseHandler{constructor(e,t,s){super(e,t,s),this._register(Gesture.addTarget(this.viewHelper.linesContentDomNode)),this._register(addDisposableListener(this.viewHelper.linesContentDomNode,EventType.Tap,o=>this.onTap(o))),this._register(addDisposableListener(this.viewHelper.linesContentDomNode,EventType.Change,o=>this.onChange(o))),this._register(addDisposableListener(this.viewHelper.linesContentDomNode,EventType.Contextmenu,o=>this._onContextMenu(new EditorMouseEvent(o,!1,this.viewHelper.viewDomNode),!1)))}onTap(e){e.preventDefault(),this.viewHelper.focusTextArea();const t=this._createMouseTarget(new EditorMouseEvent(e,!1,this.viewHelper.viewDomNode),!1);if(t.position){const s=document.createEvent("CustomEvent");s.initEvent(TextAreaSyntethicEvents.Tap,!1,!0),this.viewHelper.dispatchTextAreaEvent(s),this.viewController.moveTo(t.position,1)}}onChange(e){this._context.viewModel.viewLayout.deltaScrollNow(-e.translationX,-e.translationY)}}class PointerHandler extends Disposable{constructor(e,t,s){super(),(isIOS||isAndroid&&isMobile)&&BrowserFeatures.pointerEvents?this.handler=this._register(new PointerEventHandler(e,t,s)):mainWindow.TouchEvent?this.handler=this._register(new TouchHandler(e,t,s)):this.handler=this._register(new MouseHandler(e,t,s))}getTargetAtClientPoint(e,t){return this.handler.getTargetAtClientPoint(e,t)}}class ViewController{constructor(e,t,s,o){this.configuration=e,this.viewModel=t,this.userInputEvents=s,this.commandDelegate=o}paste(e,t,s,o){this.commandDelegate.paste(e,t,s,o)}type(e){this.commandDelegate.type(e)}compositionType(e,t,s,o){this.commandDelegate.compositionType(e,t,s,o)}compositionStart(){this.commandDelegate.startComposition()}compositionEnd(){this.commandDelegate.endComposition()}cut(){this.commandDelegate.cut()}setSelection(e){CoreNavigationCommands.SetSelection.runCoreEditorCommand(this.viewModel,{source:"keyboard",selection:e})}_validateViewColumn(e){const t=this.viewModel.getLineMinColumn(e.lineNumber);return e.column<t?new Position$1(e.lineNumber,t):e}_hasMulticursorModifier(e){switch(this.configuration.options.get(86)){case"altKey":return e.altKey;case"ctrlKey":return e.ctrlKey;case"metaKey":return e.metaKey;default:return!1}}_hasNonMulticursorModifier(e){switch(this.configuration.options.get(86)){case"altKey":return e.ctrlKey||e.metaKey;case"ctrlKey":return e.altKey||e.metaKey;case"metaKey":return e.ctrlKey||e.altKey;default:return!1}}dispatchMouse(e){const t=this.configuration.options,s=isLinux&&t.get(121),o=t.get(28),r=t.get(171);e.middleButton&&!s?r||this._columnSelect(e.position,e.mouseColumn,e.inSelectionMode):e.startedOnLineNumbers?this._hasMulticursorModifier(e)?e.inSelectionMode?this._lastCursorLineSelect(e.position,e.revealType):this._createCursor(e.position,!0):e.inSelectionMode?this._lineSelectDrag(e.position,e.revealType):this._lineSelect(e.position,e.revealType):e.mouseDownCount>=4?this._selectAll():e.mouseDownCount===3?this._hasMulticursorModifier(e)?e.inSelectionMode?this._lastCursorLineSelectDrag(e.position,e.revealType):this._lastCursorLineSelect(e.position,e.revealType):e.inSelectionMode?this._lineSelectDrag(e.position,e.revealType):this._lineSelect(e.position,e.revealType):e.mouseDownCount===2?e.onInjectedText||(this._hasMulticursorModifier(e)?this._lastCursorWordSelect(e.position,e.revealType):e.inSelectionMode?this._wordSelectDrag(e.position,e.revealType):this._wordSelect(e.position,e.revealType)):this._hasMulticursorModifier(e)?this._hasNonMulticursorModifier(e)||(e.shiftKey?this._columnSelect(e.position,e.mouseColumn,!0):e.inSelectionMode?this._lastCursorMoveToSelect(e.position,e.revealType):this._createCursor(e.position,!1)):e.inSelectionMode?e.altKey?this._columnSelect(e.position,e.mouseColumn,!0):o?this._columnSelect(e.position,e.mouseColumn,!0):this._moveToSelect(e.position,e.revealType):this.moveTo(e.position,e.revealType)}_usualArgs(e,t){return e=this._validateViewColumn(e),{source:"mouse",position:this._convertViewToModelPosition(e),viewPosition:e,revealType:t}}moveTo(e,t){CoreNavigationCommands.MoveTo.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_moveToSelect(e,t){CoreNavigationCommands.MoveToSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_columnSelect(e,t,s){e=this._validateViewColumn(e),CoreNavigationCommands.ColumnSelect.runCoreEditorCommand(this.viewModel,{source:"mouse",position:this._convertViewToModelPosition(e),viewPosition:e,mouseColumn:t,doColumnSelect:s})}_createCursor(e,t){e=this._validateViewColumn(e),CoreNavigationCommands.CreateCursor.runCoreEditorCommand(this.viewModel,{source:"mouse",position:this._convertViewToModelPosition(e),viewPosition:e,wholeLine:t})}_lastCursorMoveToSelect(e,t){CoreNavigationCommands.LastCursorMoveToSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_wordSelect(e,t){CoreNavigationCommands.WordSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_wordSelectDrag(e,t){CoreNavigationCommands.WordSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lastCursorWordSelect(e,t){CoreNavigationCommands.LastCursorWordSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lineSelect(e,t){CoreNavigationCommands.LineSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lineSelectDrag(e,t){CoreNavigationCommands.LineSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lastCursorLineSelect(e,t){CoreNavigationCommands.LastCursorLineSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lastCursorLineSelectDrag(e,t){CoreNavigationCommands.LastCursorLineSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_selectAll(){CoreNavigationCommands.SelectAll.runCoreEditorCommand(this.viewModel,{source:"mouse"})}_convertViewToModelPosition(e){return this.viewModel.coordinatesConverter.convertViewPositionToModelPosition(e)}emitKeyDown(e){this.userInputEvents.emitKeyDown(e)}emitKeyUp(e){this.userInputEvents.emitKeyUp(e)}emitContextMenu(e){this.userInputEvents.emitContextMenu(e)}emitMouseMove(e){this.userInputEvents.emitMouseMove(e)}emitMouseLeave(e){this.userInputEvents.emitMouseLeave(e)}emitMouseUp(e){this.userInputEvents.emitMouseUp(e)}emitMouseDown(e){this.userInputEvents.emitMouseDown(e)}emitMouseDrag(e){this.userInputEvents.emitMouseDrag(e)}emitMouseDrop(e){this.userInputEvents.emitMouseDrop(e)}emitMouseDropCanceled(){this.userInputEvents.emitMouseDropCanceled()}emitMouseWheel(e){this.userInputEvents.emitMouseWheel(e)}}function createTrustedTypesPolicy$1(a,e){var s;const t=globalThis.MonacoEnvironment;if(t!=null&&t.createTrustedTypesPolicy)try{return t.createTrustedTypesPolicy(a,e)}catch(o){onUnexpectedError(o);return}try{return(s=globalThis.trustedTypes)==null?void 0:s.createPolicy(a,e)}catch(o){onUnexpectedError(o);return}}class RenderedLinesCollection{constructor(e){this._lineFactory=e,this._set(1,[])}flush(){this._set(1,[])}_set(e,t){this._lines=t,this._rendLineNumberStart=e}_get(){return{rendLineNumberStart:this._rendLineNumberStart,lines:this._lines}}getStartLineNumber(){return this._rendLineNumberStart}getEndLineNumber(){return this._rendLineNumberStart+this._lines.length-1}getCount(){return this._lines.length}getLine(e){const t=e-this._rendLineNumberStart;if(t<0||t>=this._lines.length)throw new BugIndicatingError("Illegal value for lineNumber");return this._lines[t]}onLinesDeleted(e,t){if(this.getCount()===0)return null;const s=this.getStartLineNumber(),o=this.getEndLineNumber();if(t<s){const d=t-e+1;return this._rendLineNumberStart-=d,null}if(e>o)return null;let r=0,l=0;for(let d=s;d<=o;d++){const u=d-this._rendLineNumberStart;e<=d&&d<=t&&(l===0?(r=u,l=1):l++)}if(e<s){let d=0;t<s?d=t-e+1:d=s-e,this._rendLineNumberStart-=d}return this._lines.splice(r,l)}onLinesChanged(e,t){const s=e+t-1;if(this.getCount()===0)return!1;const o=this.getStartLineNumber(),r=this.getEndLineNumber();let l=!1;for(let c=e;c<=s;c++)c>=o&&c<=r&&(this._lines[c-this._rendLineNumberStart].onContentChanged(),l=!0);return l}onLinesInserted(e,t){if(this.getCount()===0)return null;const s=t-e+1,o=this.getStartLineNumber(),r=this.getEndLineNumber();if(e<=o)return this._rendLineNumberStart+=s,null;if(e>r)return null;if(s+e>r)return this._lines.splice(e-this._rendLineNumberStart,r-e+1);const l=[];for(let f=0;f<s;f++)l[f]=this._lineFactory.createLine();const c=e-this._rendLineNumberStart,d=this._lines.slice(0,c),u=this._lines.slice(c,this._lines.length-s),g=this._lines.slice(this._lines.length-s,this._lines.length);return this._lines=d.concat(l).concat(u),g}onTokensChanged(e){if(this.getCount()===0)return!1;const t=this.getStartLineNumber(),s=this.getEndLineNumber();let o=!1;for(let r=0,l=e.length;r<l;r++){const c=e[r];if(c.toLineNumber<t||c.fromLineNumber>s)continue;const d=Math.max(t,c.fromLineNumber),u=Math.min(s,c.toLineNumber);for(let g=d;g<=u;g++){const f=g-this._rendLineNumberStart;this._lines[f].onTokensChanged(),o=!0}}return o}}class VisibleLinesCollection{constructor(e,t){this._viewContext=e,this._lineFactory=t,this.domNode=this._createDomNode(),this._linesCollection=new RenderedLinesCollection(this._lineFactory)}_createDomNode(){const e=createFastDomNode(document.createElement("div"));return e.setClassName("view-layer"),e.setPosition("absolute"),e.domNode.setAttribute("role","presentation"),e.domNode.setAttribute("aria-hidden","true"),e}onConfigurationChanged(e){return!!e.hasChanged(165)}onFlushed(e,t){var s;if(t){const o=this._linesCollection.getStartLineNumber(),r=this._linesCollection.getEndLineNumber();for(let l=o;l<=r;l++)(s=this._linesCollection.getLine(l).getDomNode())==null||s.remove()}return this._linesCollection.flush(),!0}onLinesChanged(e){return this._linesCollection.onLinesChanged(e.fromLineNumber,e.count)}onLinesDeleted(e){const t=this._linesCollection.onLinesDeleted(e.fromLineNumber,e.toLineNumber);if(t)for(let s=0,o=t.length;s<o;s++){const r=t[s].getDomNode();r==null||r.remove()}return!0}onLinesInserted(e){const t=this._linesCollection.onLinesInserted(e.fromLineNumber,e.toLineNumber);if(t)for(let s=0,o=t.length;s<o;s++){const r=t[s].getDomNode();r==null||r.remove()}return!0}onScrollChanged(e){return e.scrollTopChanged}onTokensChanged(e){return this._linesCollection.onTokensChanged(e.ranges)}onZonesChanged(e){return!0}getStartLineNumber(){return this._linesCollection.getStartLineNumber()}getEndLineNumber(){return this._linesCollection.getEndLineNumber()}getVisibleLine(e){return this._linesCollection.getLine(e)}renderLines(e){const t=this._linesCollection._get(),s=new ViewLayerRenderer(this.domNode.domNode,this._lineFactory,e,this._viewContext),o={rendLineNumberStart:t.rendLineNumberStart,lines:t.lines,linesLength:t.lines.length},r=s.render(o,e.startLineNumber,e.endLineNumber,e.relativeVerticalOffset);this._linesCollection._set(r.rendLineNumberStart,r.lines)}}const Ze=class Ze{constructor(e,t,s,o){this._domNode=e,this._lineFactory=t,this._viewportData=s,this._viewContext=o}render(e,t,s,o){const r={rendLineNumberStart:e.rendLineNumberStart,lines:e.lines.slice(0),linesLength:e.linesLength};if(r.rendLineNumberStart+r.linesLength-1<t||s<r.rendLineNumberStart){r.rendLineNumberStart=t,r.linesLength=s-t+1,r.lines=[];for(let l=t;l<=s;l++)r.lines[l-t]=this._lineFactory.createLine();return this._finishRendering(r,!0,o),r}if(this._renderUntouchedLines(r,Math.max(t-r.rendLineNumberStart,0),Math.min(s-r.rendLineNumberStart,r.linesLength-1),o,t),r.rendLineNumberStart>t){const l=t,c=Math.min(s,r.rendLineNumberStart-1);l<=c&&(this._insertLinesBefore(r,l,c,o,t),r.linesLength+=c-l+1)}else if(r.rendLineNumberStart<t){const l=Math.min(r.linesLength,t-r.rendLineNumberStart);l>0&&(this._removeLinesBefore(r,l),r.linesLength-=l)}if(r.rendLineNumberStart=t,r.rendLineNumberStart+r.linesLength-1<s){const l=r.rendLineNumberStart+r.linesLength,c=s;l<=c&&(this._insertLinesAfter(r,l,c,o,t),r.linesLength+=c-l+1)}else if(r.rendLineNumberStart+r.linesLength-1>s){const l=Math.max(0,s-r.rendLineNumberStart+1),d=r.linesLength-1-l+1;d>0&&(this._removeLinesAfter(r,d),r.linesLength-=d)}return this._finishRendering(r,!1,o),r}_renderUntouchedLines(e,t,s,o,r){const l=e.rendLineNumberStart,c=e.lines;for(let d=t;d<=s;d++){const u=l+d;c[d].layoutLine(u,o[u-r],this._lineHeightForLineNumber(u))}}_insertLinesBefore(e,t,s,o,r){const l=[];let c=0;for(let d=t;d<=s;d++)l[c++]=this._lineFactory.createLine();e.lines=l.concat(e.lines)}_removeLinesBefore(e,t){for(let s=0;s<t;s++){const o=e.lines[s].getDomNode();o==null||o.remove()}e.lines.splice(0,t)}_insertLinesAfter(e,t,s,o,r){const l=[];let c=0;for(let d=t;d<=s;d++)l[c++]=this._lineFactory.createLine();e.lines=e.lines.concat(l)}_removeLinesAfter(e,t){const s=e.linesLength-t;for(let o=0;o<t;o++){const r=e.lines[s+o].getDomNode();r==null||r.remove()}e.lines.splice(s,t)}_finishRenderingNewLines(e,t,s,o){Ze._ttPolicy&&(s=Ze._ttPolicy.createHTML(s));const r=this._domNode.lastChild;t||!r?this._domNode.innerHTML=s:r.insertAdjacentHTML("afterend",s);let l=this._domNode.lastChild;for(let c=e.linesLength-1;c>=0;c--){const d=e.lines[c];o[c]&&(d.setDomNode(l),l=l.previousSibling)}}_finishRenderingInvalidLines(e,t,s){const o=document.createElement("div");Ze._ttPolicy&&(t=Ze._ttPolicy.createHTML(t)),o.innerHTML=t;for(let r=0;r<e.linesLength;r++){const l=e.lines[r];if(s[r]){const c=o.firstChild,d=l.getDomNode();d.parentNode.replaceChild(c,d),l.setDomNode(c)}}}_finishRendering(e,t,s){const o=Ze._sb,r=e.linesLength,l=e.lines,c=e.rendLineNumberStart,d=[];{o.reset();let u=!1;for(let g=0;g<r;g++){const f=l[g];if(d[g]=!1,f.getDomNode())continue;const m=g+c;f.renderLine(m,s[g],this._lineHeightForLineNumber(m),this._viewportData,o)&&(d[g]=!0,u=!0)}u&&this._finishRenderingNewLines(e,t,o.build(),d)}{o.reset();let u=!1;const g=[];for(let f=0;f<r;f++){const p=l[f];if(g[f]=!1,d[f])continue;const m=f+c;p.renderLine(m,s[f],this._lineHeightForLineNumber(m),this._viewportData,o)&&(g[f]=!0,u=!0)}u&&this._finishRenderingInvalidLines(e,o.build(),g)}}_lineHeightForLineNumber(e){return this._viewContext.viewLayout.getLineHeightForLineNumber(e)}};Ze._ttPolicy=createTrustedTypesPolicy$1("editorViewLayer",{createHTML:e=>e}),Ze._sb=new StringBuilder(1e5);let ViewLayerRenderer=Ze;class ViewOverlays extends ViewPart{constructor(e){super(e),this._dynamicOverlays=[],this._isFocused=!1,this._visibleLines=new VisibleLinesCollection(this._context,{createLine:()=>new ViewOverlayLine(this._dynamicOverlays)}),this.domNode=this._visibleLines.domNode;const s=this._context.configuration.options.get(59);applyFontInfo(this.domNode,s),this.domNode.setClassName("view-overlays")}shouldRender(){if(super.shouldRender())return!0;for(let e=0,t=this._dynamicOverlays.length;e<t;e++)if(this._dynamicOverlays[e].shouldRender())return!0;return!1}dispose(){super.dispose();for(let e=0,t=this._dynamicOverlays.length;e<t;e++)this._dynamicOverlays[e].dispose();this._dynamicOverlays=[]}getDomNode(){return this.domNode}addDynamicOverlay(e){this._dynamicOverlays.push(e)}onConfigurationChanged(e){this._visibleLines.onConfigurationChanged(e);const s=this._context.configuration.options.get(59);return applyFontInfo(this.domNode,s),!0}onFlushed(e){return this._visibleLines.onFlushed(e)}onFocusChanged(e){return this._isFocused=e.isFocused,!0}onLinesChanged(e){return this._visibleLines.onLinesChanged(e)}onLinesDeleted(e){return this._visibleLines.onLinesDeleted(e)}onLinesInserted(e){return this._visibleLines.onLinesInserted(e)}onScrollChanged(e){return this._visibleLines.onScrollChanged(e)||!0}onTokensChanged(e){return this._visibleLines.onTokensChanged(e)}onZonesChanged(e){return this._visibleLines.onZonesChanged(e)}prepareRender(e){const t=this._dynamicOverlays.filter(s=>s.shouldRender());for(let s=0,o=t.length;s<o;s++){const r=t[s];r.prepareRender(e),r.onDidRender()}}render(e){this._viewOverlaysRender(e),this.domNode.toggleClassName("focused",this._isFocused)}_viewOverlaysRender(e){this._visibleLines.renderLines(e.viewportData)}}class ViewOverlayLine{constructor(e){this._dynamicOverlays=e,this._domNode=null,this._renderedContent=null}getDomNode(){return this._domNode?this._domNode.domNode:null}setDomNode(e){this._domNode=createFastDomNode(e)}onContentChanged(){}onTokensChanged(){}renderLine(e,t,s,o,r){let l="";for(let c=0,d=this._dynamicOverlays.length;c<d;c++){const u=this._dynamicOverlays[c];l+=u.render(o.startLineNumber,e)}return this._renderedContent===l?!1:(this._renderedContent=l,r.appendString('<div style="top:'),r.appendString(String(t)),r.appendString("px;height:"),r.appendString(String(s)),r.appendString("px;line-height:"),r.appendString(String(s)),r.appendString('px;">'),r.appendString(l),r.appendString("</div>"),!0)}layoutLine(e,t,s){this._domNode&&(this._domNode.setTop(t),this._domNode.setHeight(s),this._domNode.setLineHeight(s))}}class ContentViewOverlays extends ViewOverlays{constructor(e){super(e);const s=this._context.configuration.options.get(165);this._contentWidth=s.contentWidth,this.domNode.setHeight(0)}onConfigurationChanged(e){const s=this._context.configuration.options.get(165);return this._contentWidth=s.contentWidth,super.onConfigurationChanged(e)||!0}onScrollChanged(e){return super.onScrollChanged(e)||e.scrollWidthChanged}_viewOverlaysRender(e){super._viewOverlaysRender(e),this.domNode.setWidth(Math.max(e.scrollWidth,this._contentWidth))}}class MarginViewOverlays extends ViewOverlays{constructor(e){super(e);const t=this._context.configuration.options,s=t.get(165);this._contentLeft=s.contentLeft,this.domNode.setClassName("margin-view-overlays"),this.domNode.setWidth(1),applyFontInfo(this.domNode,t.get(59))}onConfigurationChanged(e){const t=this._context.configuration.options;applyFontInfo(this.domNode,t.get(59));const s=t.get(165);return this._contentLeft=s.contentLeft,super.onConfigurationChanged(e)||!0}onScrollChanged(e){return super.onScrollChanged(e)||e.scrollHeightChanged}_viewOverlaysRender(e){super._viewOverlaysRender(e);const t=Math.min(e.scrollHeight,1e6);this.domNode.setHeight(t),this.domNode.setWidth(this._contentLeft)}}class ViewUserInputEvents{constructor(e){this.onKeyDown=null,this.onKeyUp=null,this.onContextMenu=null,this.onMouseMove=null,this.onMouseLeave=null,this.onMouseDown=null,this.onMouseUp=null,this.onMouseDrag=null,this.onMouseDrop=null,this.onMouseDropCanceled=null,this.onMouseWheel=null,this._coordinatesConverter=e}emitKeyDown(e){var t;(t=this.onKeyDown)==null||t.call(this,e)}emitKeyUp(e){var t;(t=this.onKeyUp)==null||t.call(this,e)}emitContextMenu(e){var t;(t=this.onContextMenu)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseMove(e){var t;(t=this.onMouseMove)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseLeave(e){var t;(t=this.onMouseLeave)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDown(e){var t;(t=this.onMouseDown)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseUp(e){var t;(t=this.onMouseUp)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDrag(e){var t;(t=this.onMouseDrag)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDrop(e){var t;(t=this.onMouseDrop)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDropCanceled(){var e;(e=this.onMouseDropCanceled)==null||e.call(this)}emitMouseWheel(e){var t;(t=this.onMouseWheel)==null||t.call(this,e)}_convertViewToModelMouseEvent(e){return e.target?{event:e.event,target:this._convertViewToModelMouseTarget(e.target)}:e}_convertViewToModelMouseTarget(e){return ViewUserInputEvents.convertViewToModelMouseTarget(e,this._coordinatesConverter)}static convertViewToModelMouseTarget(e,t){const s={...e};return s.position&&(s.position=t.convertViewPositionToModelPosition(s.position)),s.range&&(s.range=t.convertViewRangeToModelRange(s.range)),(s.type===5||s.type===8)&&(s.detail=this.convertViewToModelViewZoneData(s.detail,t)),s}static convertViewToModelViewZoneData(e,t){return{viewZoneId:e.viewZoneId,positionBefore:e.positionBefore?t.convertViewPositionToModelPosition(e.positionBefore):e.positionBefore,positionAfter:e.positionAfter?t.convertViewPositionToModelPosition(e.positionAfter):e.positionAfter,position:t.convertViewPositionToModelPosition(e.position),afterLineNumber:t.convertViewPositionToModelPosition(new Position$1(e.afterLineNumber,1)).lineNumber}}}const blockDecorations="";class BlockDecorations extends ViewPart{constructor(e){super(e),this.blocks=[],this.contentWidth=-1,this.contentLeft=0,this.domNode=createFastDomNode(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.domNode.setClassName("blockDecorations-container"),this.update()}update(){let e=!1;const s=this._context.configuration.options.get(165),o=s.contentWidth-s.verticalScrollbarWidth;this.contentWidth!==o&&(this.contentWidth=o,e=!0);const r=s.contentLeft;return this.contentLeft!==r&&(this.contentLeft=r,e=!0),e}dispose(){super.dispose()}onConfigurationChanged(e){return this.update()}onScrollChanged(e){return e.scrollTopChanged||e.scrollLeftChanged}onDecorationsChanged(e){return!0}onZonesChanged(e){return!0}prepareRender(e){}render(e){let t=0;const s=e.getDecorationsInViewport();for(const o of s){if(!o.options.blockClassName)continue;let r=this.blocks[t];r||(r=this.blocks[t]=createFastDomNode(document.createElement("div")),this.domNode.appendChild(r));let l,c;o.options.blockIsAfterEnd?(l=e.getVerticalOffsetAfterLineNumber(o.range.endLineNumber,!1),c=e.getVerticalOffsetAfterLineNumber(o.range.endLineNumber,!0)):(l=e.getVerticalOffsetForLineNumber(o.range.startLineNumber,!0),c=o.range.isEmpty()&&!o.options.blockDoesNotCollapse?e.getVerticalOffsetForLineNumber(o.range.startLineNumber,!1):e.getVerticalOffsetAfterLineNumber(o.range.endLineNumber,!0));const[d,u,g,f]=o.options.blockPadding??[0,0,0,0];r.setClassName("blockDecorations-block "+o.options.blockClassName),r.setLeft(this.contentLeft-f),r.setWidth(this.contentWidth+f+u),r.setTop(l-e.scrollTop-d),r.setHeight(c-l+d+g),t++}for(let o=t;o<this.blocks.length;o++)this.blocks[o].domNode.remove();this.blocks.length=t}}class ViewContentWidgets extends ViewPart{constructor(e,t){super(e),this._viewDomNode=t,this._widgets={},this.domNode=createFastDomNode(document.createElement("div")),PartFingerprints.write(this.domNode,1),this.domNode.setClassName("contentWidgets"),this.domNode.setPosition("absolute"),this.domNode.setTop(0),this.overflowingContentWidgetsDomNode=createFastDomNode(document.createElement("div")),PartFingerprints.write(this.overflowingContentWidgetsDomNode,2),this.overflowingContentWidgetsDomNode.setClassName("overflowingContentWidgets")}dispose(){super.dispose(),this._widgets={}}onConfigurationChanged(e){const t=Object.keys(this._widgets);for(const s of t)this._widgets[s].onConfigurationChanged(e);return!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLineMappingChanged(e){return this._updateAnchorsViewPositions(),!0}onLinesChanged(e){return this._updateAnchorsViewPositions(),!0}onLinesDeleted(e){return this._updateAnchorsViewPositions(),!0}onLinesInserted(e){return this._updateAnchorsViewPositions(),!0}onScrollChanged(e){return!0}onZonesChanged(e){return!0}_updateAnchorsViewPositions(){const e=Object.keys(this._widgets);for(const t of e)this._widgets[t].updateAnchorViewPosition()}addWidget(e){const t=new Widget(this._context,this._viewDomNode,e);this._widgets[t.id]=t,t.allowEditorOverflow?this.overflowingContentWidgetsDomNode.appendChild(t.domNode):this.domNode.appendChild(t.domNode),this.setShouldRender()}setWidgetPosition(e,t,s,o,r){this._widgets[e.getId()].setPosition(t,s,o,r),this.setShouldRender()}removeWidget(e){const t=e.getId();if(this._widgets.hasOwnProperty(t)){const s=this._widgets[t];delete this._widgets[t];const o=s.domNode.domNode;o.remove(),o.removeAttribute("monaco-visible-content-widget"),this.setShouldRender()}}shouldSuppressMouseDownOnWidget(e){return this._widgets.hasOwnProperty(e)?this._widgets[e].suppressMouseDown:!1}onBeforeRender(e){const t=Object.keys(this._widgets);for(const s of t)this._widgets[s].onBeforeRender(e)}prepareRender(e){const t=Object.keys(this._widgets);for(const s of t)this._widgets[s].prepareRender(e)}render(e){const t=Object.keys(this._widgets);for(const s of t)this._widgets[s].render(e)}}class Widget{constructor(e,t,s){this._primaryAnchor=new PositionPair(null,null),this._secondaryAnchor=new PositionPair(null,null),this._context=e,this._viewDomNode=t,this._actual=s;const o=this._context.configuration.options,r=o.get(165),l=o.get(4);this.domNode=createFastDomNode(this._actual.getDomNode()),this.id=this._actual.getId(),this.allowEditorOverflow=(this._actual.allowEditorOverflow||!1)&&l,this.suppressMouseDown=this._actual.suppressMouseDown||!1,this._fixedOverflowWidgets=o.get(51),this._contentWidth=r.contentWidth,this._contentLeft=r.contentLeft,this._affinity=null,this._preference=[],this._cachedDomNodeOffsetWidth=-1,this._cachedDomNodeOffsetHeight=-1,this._maxWidth=this._getMaxWidth(),this._isVisible=!1,this._renderData=null,this.domNode.setPosition(this._fixedOverflowWidgets&&this.allowEditorOverflow?"fixed":"absolute"),this.domNode.setDisplay("none"),this.domNode.setVisibility("hidden"),this.domNode.setAttribute("widgetId",this.id),this.domNode.setMaxWidth(this._maxWidth)}onConfigurationChanged(e){const t=this._context.configuration.options;if(e.hasChanged(165)){const s=t.get(165);this._contentLeft=s.contentLeft,this._contentWidth=s.contentWidth,this._maxWidth=this._getMaxWidth()}}updateAnchorViewPosition(){this._setPosition(this._affinity,this._primaryAnchor.modelPosition,this._secondaryAnchor.modelPosition)}_setPosition(e,t,s){this._affinity=e,this._primaryAnchor=o(t,this._context.viewModel,this._affinity),this._secondaryAnchor=o(s,this._context.viewModel,this._affinity);function o(r,l,c){if(!r)return new PositionPair(null,null);const d=l.model.validatePosition(r);if(l.coordinatesConverter.modelPositionIsVisible(d)){const u=l.coordinatesConverter.convertModelPositionToViewPosition(d,c??void 0);return new PositionPair(r,u)}return new PositionPair(r,null)}}_getMaxWidth(){const e=this.domNode.domNode.ownerDocument,t=e.defaultView;return this.allowEditorOverflow?(t==null?void 0:t.innerWidth)||e.documentElement.offsetWidth||e.body.offsetWidth:this._contentWidth}setPosition(e,t,s,o){this._setPosition(o,e,t),this._preference=s,this._primaryAnchor.viewPosition&&this._preference&&this._preference.length>0?this.domNode.setDisplay("block"):this.domNode.setDisplay("none"),this._cachedDomNodeOffsetWidth=-1,this._cachedDomNodeOffsetHeight=-1}_layoutBoxInViewport(e,t,s,o){const r=e.top,l=r,c=e.top+e.height,d=o.viewportHeight-c,u=r-s,g=l>=s,f=c,p=d>=s;let m=e.left;return m+t>o.scrollLeft+o.viewportWidth&&(m=o.scrollLeft+o.viewportWidth-t),m<o.scrollLeft&&(m=o.scrollLeft),{fitsAbove:g,aboveTop:u,fitsBelow:p,belowTop:f,left:m}}_layoutHorizontalSegmentInPage(e,t,s,o){const c=Math.max(15,t.left-o),d=Math.min(t.left+t.width+o,e.width-15),g=this._viewDomNode.domNode.ownerDocument.defaultView;let f=t.left+s-((g==null?void 0:g.scrollX)??0);if(f+o>d){const p=f-(d-o);f-=p,s-=p}if(f<c){const p=f-c;f-=p,s-=p}return[s,f]}_layoutBoxInPage(e,t,s,o){const r=e.top-s,l=e.top+e.height,c=getDomNodePagePosition(this._viewDomNode.domNode),d=this._viewDomNode.domNode.ownerDocument,u=d.defaultView,g=c.top+r-((u==null?void 0:u.scrollY)??0),f=c.top+l-((u==null?void 0:u.scrollY)??0),p=getClientArea(d.body),[m,_]=this._layoutHorizontalSegmentInPage(p,c,e.left-o.scrollLeft+this._contentLeft,t),C=22,b=22,v=g>=C,S=f+s<=p.height-b;return this._fixedOverflowWidgets?{fitsAbove:v,aboveTop:Math.max(g,C),fitsBelow:S,belowTop:f,left:_}:{fitsAbove:v,aboveTop:r,fitsBelow:S,belowTop:l,left:m}}_prepareRenderWidgetAtExactPositionOverflowing(e){return new Coordinate(e.top,e.left+this._contentLeft)}_getAnchorsCoordinates(e){var l,c;const t=r(this._primaryAnchor.viewPosition,this._affinity),s=((l=this._secondaryAnchor.viewPosition)==null?void 0:l.lineNumber)===((c=this._primaryAnchor.viewPosition)==null?void 0:c.lineNumber)?this._secondaryAnchor.viewPosition:null,o=r(s,this._affinity);return{primary:t,secondary:o};function r(d,u){if(!d)return null;const g=e.visibleRangeForPosition(d);if(!g)return null;const f=d.column===1&&u===3?0:g.left,p=e.getVerticalOffsetForLineNumber(d.lineNumber)-e.scrollTop,m=e.getLineHeightForLineNumber(d.lineNumber);return new AnchorCoordinate(p,f,m)}}_reduceAnchorCoordinates(e,t,s){if(!t)return e;const o=this._context.configuration.options.get(59);let r=t.left;return r<e.left?r=Math.max(r,e.left-s+o.typicalFullwidthCharacterWidth):r=Math.min(r,e.left+s-o.typicalFullwidthCharacterWidth),new AnchorCoordinate(e.top,r,e.height)}_prepareRenderWidget(e){if(!this._preference||this._preference.length===0)return null;const{primary:t,secondary:s}=this._getAnchorsCoordinates(e);if(!t)return{kind:"offViewport",preserveFocus:this.domNode.domNode.contains(this.domNode.domNode.ownerDocument.activeElement)};if(this._cachedDomNodeOffsetWidth===-1||this._cachedDomNodeOffsetHeight===-1){let l=null;if(typeof this._actual.beforeRender=="function"&&(l=safeInvoke(this._actual.beforeRender,this._actual)),l)this._cachedDomNodeOffsetWidth=l.width,this._cachedDomNodeOffsetHeight=l.height;else{const d=this.domNode.domNode.getBoundingClientRect();this._cachedDomNodeOffsetWidth=Math.round(d.width),this._cachedDomNodeOffsetHeight=Math.round(d.height)}}const o=this._reduceAnchorCoordinates(t,s,this._cachedDomNodeOffsetWidth);let r;this.allowEditorOverflow?r=this._layoutBoxInPage(o,this._cachedDomNodeOffsetWidth,this._cachedDomNodeOffsetHeight,e):r=this._layoutBoxInViewport(o,this._cachedDomNodeOffsetWidth,this._cachedDomNodeOffsetHeight,e);for(let l=1;l<=2;l++)for(const c of this._preference)if(c===1){if(!r)return null;if(l===2||r.fitsAbove)return{kind:"inViewport",coordinate:new Coordinate(r.aboveTop,r.left),position:1}}else if(c===2){if(!r)return null;if(l===2||r.fitsBelow)return{kind:"inViewport",coordinate:new Coordinate(r.belowTop,r.left),position:2}}else return this.allowEditorOverflow?{kind:"inViewport",coordinate:this._prepareRenderWidgetAtExactPositionOverflowing(new Coordinate(o.top,o.left)),position:0}:{kind:"inViewport",coordinate:new Coordinate(o.top,o.left),position:0};return null}onBeforeRender(e){!this._primaryAnchor.viewPosition||!this._preference||this._primaryAnchor.viewPosition.lineNumber<e.startLineNumber||this._primaryAnchor.viewPosition.lineNumber>e.endLineNumber||this.domNode.setMaxWidth(this._maxWidth)}prepareRender(e){this._renderData=this._prepareRenderWidget(e)}render(e){var t;if(!this._renderData||this._renderData.kind==="offViewport"){this._isVisible&&(this.domNode.removeAttribute("monaco-visible-content-widget"),this._isVisible=!1,((t=this._renderData)==null?void 0:t.kind)==="offViewport"&&this._renderData.preserveFocus?this.domNode.setTop(-1e3):this.domNode.setVisibility("hidden")),typeof this._actual.afterRender=="function"&&safeInvoke(this._actual.afterRender,this._actual,null,null);return}this.allowEditorOverflow?(this.domNode.setTop(this._renderData.coordinate.top),this.domNode.setLeft(this._renderData.coordinate.left)):(this.domNode.setTop(this._renderData.coordinate.top+e.scrollTop-e.bigNumbersDelta),this.domNode.setLeft(this._renderData.coordinate.left)),this._isVisible||(this.domNode.setVisibility("inherit"),this.domNode.setAttribute("monaco-visible-content-widget","true"),this._isVisible=!0),typeof this._actual.afterRender=="function"&&safeInvoke(this._actual.afterRender,this._actual,this._renderData.position,this._renderData.coordinate)}}class PositionPair{constructor(e,t){this.modelPosition=e,this.viewPosition=t}}class Coordinate{constructor(e,t){this.top=e,this.left=t,this._coordinateBrand=void 0}}class AnchorCoordinate{constructor(e,t,s){this.top=e,this.left=t,this.height=s,this._anchorCoordinateBrand=void 0}}function safeInvoke(a,e,...t){try{return a.call(e,...t)}catch{return null}}const currentLineHighlight="";class DynamicViewOverlay extends ViewEventHandler{}const IThemeService=createDecorator("themeService");function themeColorFromId(a){return{id:a}}function getThemeTypeSelector(a){switch(a){case ColorScheme.DARK:return ThemeTypeSelector.VS_DARK;case ColorScheme.HIGH_CONTRAST_DARK:return ThemeTypeSelector.HC_BLACK;case ColorScheme.HIGH_CONTRAST_LIGHT:return ThemeTypeSelector.HC_LIGHT;default:return ThemeTypeSelector.VS}}const Extensions$3={ThemingContribution:"base.contributions.theming"};class ThemingRegistry extends Disposable{constructor(){super(),this.themingParticipants=[],this.themingParticipants=[],this.onThemingParticipantAddedEmitter=this._register(new Emitter$1)}onColorThemeChange(e){return this.themingParticipants.push(e),this.onThemingParticipantAddedEmitter.fire(e),toDisposable(()=>{const t=this.themingParticipants.indexOf(e);this.themingParticipants.splice(t,1)})}getThemingParticipants(){return this.themingParticipants}}const themingRegistry$1=new ThemingRegistry;Registry.add(Extensions$3.ThemingContribution,themingRegistry$1);function registerThemingParticipant(a){return themingRegistry$1.onColorThemeChange(a)}class Themable extends Disposable{constructor(e){super(),this.themeService=e,this.theme=e.getColorTheme(),this._register(this.themeService.onDidColorThemeChange(t=>this.onThemeChange(t)))}onThemeChange(e){this.theme=e,this.updateStyles()}updateStyles(){}}const editorLineHighlight=registerColor("editor.lineHighlightBackground",null,localize(607,"Background color for the highlight of line at the cursor position.")),editorLineHighlightBorder=registerColor("editor.lineHighlightBorder",{dark:"#282828",light:"#eeeeee",hcDark:"#f38518",hcLight:contrastBorder},localize(608,"Background color for the border around the line at the cursor position."));registerColor("editor.rangeHighlightBackground",{dark:"#ffffff0b",light:"#fdff0033",hcDark:null,hcLight:null},localize(609,"Background color of highlighted ranges, like by quick open and find features. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("editor.rangeHighlightBorder",{dark:null,light:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize(610,"Background color of the border around highlighted ranges."));registerColor("editor.symbolHighlightBackground",{dark:editorFindMatchHighlight,light:editorFindMatchHighlight,hcDark:null,hcLight:null},localize(611,"Background color of highlighted symbol, like for go to definition or go next/previous symbol. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("editor.symbolHighlightBorder",{dark:null,light:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize(612,"Background color of the border around highlighted symbols."));const editorCursorForeground=registerColor("editorCursor.foreground",{dark:"#AEAFAD",light:Color.black,hcDark:Color.white,hcLight:"#0F4A85"},localize(613,"Color of the editor cursor.")),editorCursorBackground=registerColor("editorCursor.background",null,localize(614,"The background color of the editor cursor. Allows customizing the color of a character overlapped by a block cursor.")),editorMultiCursorPrimaryForeground=registerColor("editorMultiCursor.primary.foreground",editorCursorForeground,localize(615,"Color of the primary editor cursor when multiple cursors are present.")),editorMultiCursorPrimaryBackground=registerColor("editorMultiCursor.primary.background",editorCursorBackground,localize(616,"The background color of the primary editor cursor when multiple cursors are present. Allows customizing the color of a character overlapped by a block cursor.")),editorMultiCursorSecondaryForeground=registerColor("editorMultiCursor.secondary.foreground",editorCursorForeground,localize(617,"Color of secondary editor cursors when multiple cursors are present.")),editorMultiCursorSecondaryBackground=registerColor("editorMultiCursor.secondary.background",editorCursorBackground,localize(618,"The background color of secondary editor cursors when multiple cursors are present. Allows customizing the color of a character overlapped by a block cursor.")),editorWhitespaces=registerColor("editorWhitespace.foreground",{dark:"#e3e4e229",light:"#33333333",hcDark:"#e3e4e229",hcLight:"#CCCCCC"},localize(619,"Color of whitespace characters in the editor.")),editorLineNumbers=registerColor("editorLineNumber.foreground",{dark:"#858585",light:"#237893",hcDark:Color.white,hcLight:"#292929"},localize(620,"Color of editor line numbers.")),deprecatedEditorIndentGuides=registerColor("editorIndentGuide.background",editorWhitespaces,localize(621,"Color of the editor indentation guides."),!1,localize(622,"'editorIndentGuide.background' is deprecated. Use 'editorIndentGuide.background1' instead.")),deprecatedEditorActiveIndentGuides=registerColor("editorIndentGuide.activeBackground",editorWhitespaces,localize(623,"Color of the active editor indentation guides."),!1,localize(624,"'editorIndentGuide.activeBackground' is deprecated. Use 'editorIndentGuide.activeBackground1' instead.")),editorIndentGuide1=registerColor("editorIndentGuide.background1",deprecatedEditorIndentGuides,localize(625,"Color of the editor indentation guides (1).")),editorIndentGuide2=registerColor("editorIndentGuide.background2","#00000000",localize(626,"Color of the editor indentation guides (2).")),editorIndentGuide3=registerColor("editorIndentGuide.background3","#00000000",localize(627,"Color of the editor indentation guides (3).")),editorIndentGuide4=registerColor("editorIndentGuide.background4","#00000000",localize(628,"Color of the editor indentation guides (4).")),editorIndentGuide5=registerColor("editorIndentGuide.background5","#00000000",localize(629,"Color of the editor indentation guides (5).")),editorIndentGuide6=registerColor("editorIndentGuide.background6","#00000000",localize(630,"Color of the editor indentation guides (6).")),editorActiveIndentGuide1=registerColor("editorIndentGuide.activeBackground1",deprecatedEditorActiveIndentGuides,localize(631,"Color of the active editor indentation guides (1).")),editorActiveIndentGuide2=registerColor("editorIndentGuide.activeBackground2","#00000000",localize(632,"Color of the active editor indentation guides (2).")),editorActiveIndentGuide3=registerColor("editorIndentGuide.activeBackground3","#00000000",localize(633,"Color of the active editor indentation guides (3).")),editorActiveIndentGuide4=registerColor("editorIndentGuide.activeBackground4","#00000000",localize(634,"Color of the active editor indentation guides (4).")),editorActiveIndentGuide5=registerColor("editorIndentGuide.activeBackground5","#00000000",localize(635,"Color of the active editor indentation guides (5).")),editorActiveIndentGuide6=registerColor("editorIndentGuide.activeBackground6","#00000000",localize(636,"Color of the active editor indentation guides (6).")),deprecatedEditorActiveLineNumber=registerColor("editorActiveLineNumber.foreground",{dark:"#c6c6c6",light:"#0B216F",hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize(637,"Color of editor active line number"),!1,localize(638,"Id is deprecated. Use 'editorLineNumber.activeForeground' instead."));registerColor("editorLineNumber.activeForeground",deprecatedEditorActiveLineNumber,localize(639,"Color of editor active line number"));const editorDimmedLineNumber=registerColor("editorLineNumber.dimmedForeground",null,localize(640,"Color of the final editor line when editor.renderFinalNewline is set to dimmed.")),editorRuler=registerColor("editorRuler.foreground",{dark:"#5A5A5A",light:Color.lightgrey,hcDark:Color.white,hcLight:"#292929"},localize(641,"Color of the editor rulers."));registerColor("editorCodeLens.foreground",{dark:"#999999",light:"#919191",hcDark:"#999999",hcLight:"#292929"},localize(642,"Foreground color of editor CodeLens"));registerColor("editorBracketMatch.background",{dark:"#0064001a",light:"#0064001a",hcDark:"#0064001a",hcLight:"#0000"},localize(643,"Background color behind matching brackets"));registerColor("editorBracketMatch.border",{dark:"#888",light:"#B9B9B9",hcDark:contrastBorder,hcLight:contrastBorder},localize(644,"Color for matching brackets boxes"));const editorOverviewRulerBorder=registerColor("editorOverviewRuler.border",{dark:"#7f7f7f4d",light:"#7f7f7f4d",hcDark:"#7f7f7f4d",hcLight:"#666666"},localize(645,"Color of the overview ruler border.")),editorOverviewRulerBackground=registerColor("editorOverviewRuler.background",null,localize(646,"Background color of the editor overview ruler."));registerColor("editorGutter.background",editorBackground,localize(647,"Background color of the editor gutter. The gutter contains the glyph margins and the line numbers."));registerColor("editorUnnecessaryCode.border",{dark:null,light:null,hcDark:Color.fromHex("#fff").transparent(.8),hcLight:contrastBorder},localize(648,"Border color of unnecessary (unused) source code in the editor."));const editorUnnecessaryCodeOpacity=registerColor("editorUnnecessaryCode.opacity",{dark:Color.fromHex("#000a"),light:Color.fromHex("#0007"),hcDark:null,hcLight:null},localize(649,`Opacity of unnecessary (unused) source code in the editor. For example, "#000000c0" will render the code with 75% opacity. For high contrast themes, use the  'editorUnnecessaryCode.border' theme color to underline unnecessary code instead of fading it out.`));registerColor("editorGhostText.border",{dark:null,light:null,hcDark:Color.fromHex("#fff").transparent(.8),hcLight:Color.fromHex("#292929").transparent(.8)},localize(650,"Border color of ghost text in the editor."));const ghostTextForeground=registerColor("editorGhostText.foreground",{dark:Color.fromHex("#ffffff56"),light:Color.fromHex("#0007"),hcDark:null,hcLight:null},localize(651,"Foreground color of the ghost text in the editor."));registerColor("editorGhostText.background",null,localize(652,"Background color of the ghost text in the editor."));const rulerRangeDefault=new Color(new RGBA(0,122,204,.6)),overviewRulerRangeHighlight=registerColor("editorOverviewRuler.rangeHighlightForeground",rulerRangeDefault,localize(653,"Overview ruler marker color for range highlights. The color must not be opaque so as not to hide underlying decorations."),!0),overviewRulerError=registerColor("editorOverviewRuler.errorForeground",{dark:new Color(new RGBA(255,18,18,.7)),light:new Color(new RGBA(255,18,18,.7)),hcDark:new Color(new RGBA(255,50,50,1)),hcLight:"#B5200D"},localize(654,"Overview ruler marker color for errors.")),overviewRulerWarning=registerColor("editorOverviewRuler.warningForeground",{dark:editorWarningForeground,light:editorWarningForeground,hcDark:editorWarningBorder,hcLight:editorWarningBorder},localize(655,"Overview ruler marker color for warnings.")),overviewRulerInfo=registerColor("editorOverviewRuler.infoForeground",{dark:editorInfoForeground,light:editorInfoForeground,hcDark:editorInfoBorder,hcLight:editorInfoBorder},localize(656,"Overview ruler marker color for infos.")),editorBracketHighlightingForeground1=registerColor("editorBracketHighlight.foreground1",{dark:"#FFD700",light:"#0431FAFF",hcDark:"#FFD700",hcLight:"#0431FAFF"},localize(657,"Foreground color of brackets (1). Requires enabling bracket pair colorization.")),editorBracketHighlightingForeground2=registerColor("editorBracketHighlight.foreground2",{dark:"#DA70D6",light:"#319331FF",hcDark:"#DA70D6",hcLight:"#319331FF"},localize(658,"Foreground color of brackets (2). Requires enabling bracket pair colorization.")),editorBracketHighlightingForeground3=registerColor("editorBracketHighlight.foreground3",{dark:"#179FFF",light:"#7B3814FF",hcDark:"#87CEFA",hcLight:"#7B3814FF"},localize(659,"Foreground color of brackets (3). Requires enabling bracket pair colorization.")),editorBracketHighlightingForeground4=registerColor("editorBracketHighlight.foreground4","#00000000",localize(660,"Foreground color of brackets (4). Requires enabling bracket pair colorization.")),editorBracketHighlightingForeground5=registerColor("editorBracketHighlight.foreground5","#00000000",localize(661,"Foreground color of brackets (5). Requires enabling bracket pair colorization.")),editorBracketHighlightingForeground6=registerColor("editorBracketHighlight.foreground6","#00000000",localize(662,"Foreground color of brackets (6). Requires enabling bracket pair colorization.")),editorBracketHighlightingUnexpectedBracketForeground=registerColor("editorBracketHighlight.unexpectedBracket.foreground",{dark:new Color(new RGBA(255,18,18,.8)),light:new Color(new RGBA(255,18,18,.8)),hcDark:new Color(new RGBA(255,50,50,1)),hcLight:"#B5200D"},localize(663,"Foreground color of unexpected brackets.")),editorBracketPairGuideBackground1=registerColor("editorBracketPairGuide.background1","#00000000",localize(664,"Background color of inactive bracket pair guides (1). Requires enabling bracket pair guides.")),editorBracketPairGuideBackground2=registerColor("editorBracketPairGuide.background2","#00000000",localize(665,"Background color of inactive bracket pair guides (2). Requires enabling bracket pair guides.")),editorBracketPairGuideBackground3=registerColor("editorBracketPairGuide.background3","#00000000",localize(666,"Background color of inactive bracket pair guides (3). Requires enabling bracket pair guides.")),editorBracketPairGuideBackground4=registerColor("editorBracketPairGuide.background4","#00000000",localize(667,"Background color of inactive bracket pair guides (4). Requires enabling bracket pair guides.")),editorBracketPairGuideBackground5=registerColor("editorBracketPairGuide.background5","#00000000",localize(668,"Background color of inactive bracket pair guides (5). Requires enabling bracket pair guides.")),editorBracketPairGuideBackground6=registerColor("editorBracketPairGuide.background6","#00000000",localize(669,"Background color of inactive bracket pair guides (6). Requires enabling bracket pair guides.")),editorBracketPairGuideActiveBackground1=registerColor("editorBracketPairGuide.activeBackground1","#00000000",localize(670,"Background color of active bracket pair guides (1). Requires enabling bracket pair guides.")),editorBracketPairGuideActiveBackground2=registerColor("editorBracketPairGuide.activeBackground2","#00000000",localize(671,"Background color of active bracket pair guides (2). Requires enabling bracket pair guides.")),editorBracketPairGuideActiveBackground3=registerColor("editorBracketPairGuide.activeBackground3","#00000000",localize(672,"Background color of active bracket pair guides (3). Requires enabling bracket pair guides.")),editorBracketPairGuideActiveBackground4=registerColor("editorBracketPairGuide.activeBackground4","#00000000",localize(673,"Background color of active bracket pair guides (4). Requires enabling bracket pair guides.")),editorBracketPairGuideActiveBackground5=registerColor("editorBracketPairGuide.activeBackground5","#00000000",localize(674,"Background color of active bracket pair guides (5). Requires enabling bracket pair guides.")),editorBracketPairGuideActiveBackground6=registerColor("editorBracketPairGuide.activeBackground6","#00000000",localize(675,"Background color of active bracket pair guides (6). Requires enabling bracket pair guides."));registerColor("editorUnicodeHighlight.border",editorWarningForeground,localize(676,"Border color used to highlight unicode characters."));registerColor("editorUnicodeHighlight.background",editorWarningBackground,localize(677,"Background color used to highlight unicode characters."));registerThemingParticipant((a,e)=>{const t=a.getColor(editorBackground),s=a.getColor(editorLineHighlight),o=s&&!s.isTransparent()?s:t;o&&e.addRule(`.monaco-editor .inputarea.ime-input { background-color: ${o}; }`)});class AbstractLineHighlightOverlay extends DynamicViewOverlay{constructor(e){super(),this._context=e;const t=this._context.configuration.options,s=t.get(165);this._renderLineHighlight=t.get(110),this._renderLineHighlightOnlyWhenFocus=t.get(111),this._wordWrap=s.isViewportWrapping,this._contentLeft=s.contentLeft,this._contentWidth=s.contentWidth,this._selectionIsEmpty=!0,this._focused=!1,this._cursorLineNumbers=[1],this._selections=[new Selection$1(1,1,1,1)],this._renderData=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}_readFromSelections(){let e=!1;const t=new Set;for(const r of this._selections)t.add(r.positionLineNumber);const s=Array.from(t);s.sort((r,l)=>r-l),equals$1(this._cursorLineNumbers,s)||(this._cursorLineNumbers=s,e=!0);const o=this._selections.every(r=>r.isEmpty());return this._selectionIsEmpty!==o&&(this._selectionIsEmpty=o,e=!0),e}onThemeChanged(e){return this._readFromSelections()}onConfigurationChanged(e){const t=this._context.configuration.options,s=t.get(165);return this._renderLineHighlight=t.get(110),this._renderLineHighlightOnlyWhenFocus=t.get(111),this._wordWrap=s.isViewportWrapping,this._contentLeft=s.contentLeft,this._contentWidth=s.contentWidth,!0}onCursorStateChanged(e){return this._selections=e.selections,this._readFromSelections()}onFlushed(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollWidthChanged||e.scrollTopChanged}onZonesChanged(e){return!0}onFocusChanged(e){return this._renderLineHighlightOnlyWhenFocus?(this._focused=e.isFocused,!0):!1}prepareRender(e){if(!this._shouldRenderThis()){this._renderData=null;return}const t=e.visibleRange.startLineNumber,s=e.visibleRange.endLineNumber,o=[];for(let l=t;l<=s;l++){const c=l-t;o[c]=""}if(this._wordWrap){const l=this._renderOne(e,!1);for(const c of this._cursorLineNumbers){const d=this._context.viewModel.coordinatesConverter,u=d.convertViewPositionToModelPosition(new Position$1(c,1)).lineNumber,g=d.convertModelPositionToViewPosition(new Position$1(u,1)).lineNumber,f=d.convertModelPositionToViewPosition(new Position$1(u,this._context.viewModel.model.getLineMaxColumn(u))).lineNumber,p=Math.max(g,t),m=Math.min(f,s);for(let _=p;_<=m;_++){const C=_-t;o[C]=l}}}const r=this._renderOne(e,!0);for(const l of this._cursorLineNumbers){if(l<t||l>s)continue;const c=l-t;o[c]=r}this._renderData=o}render(e,t){if(!this._renderData)return"";const s=t-e;return s>=this._renderData.length?"":this._renderData[s]}_shouldRenderInMargin(){return(this._renderLineHighlight==="gutter"||this._renderLineHighlight==="all")&&(!this._renderLineHighlightOnlyWhenFocus||this._focused)}_shouldRenderInContent(){return(this._renderLineHighlight==="line"||this._renderLineHighlight==="all")&&this._selectionIsEmpty&&(!this._renderLineHighlightOnlyWhenFocus||this._focused)}}class CurrentLineHighlightOverlay extends AbstractLineHighlightOverlay{_renderOne(e,t){return`<div class="${"current-line"+(this._shouldRenderInMargin()?" current-line-both":"")+(t?" current-line-exact":"")}" style="width:${Math.max(e.scrollWidth,this._contentWidth)}px;"></div>`}_shouldRenderThis(){return this._shouldRenderInContent()}_shouldRenderOther(){return this._shouldRenderInMargin()}}class CurrentLineMarginHighlightOverlay extends AbstractLineHighlightOverlay{_renderOne(e,t){return`<div class="${"current-line"+(this._shouldRenderInMargin()?" current-line-margin":"")+(this._shouldRenderOther()?" current-line-margin-both":"")+(this._shouldRenderInMargin()&&t?" current-line-exact-margin":"")}" style="width:${this._contentLeft}px"></div>`}_shouldRenderThis(){return!0}_shouldRenderOther(){return this._shouldRenderInContent()}}registerThemingParticipant((a,e)=>{const t=a.getColor(editorLineHighlight);if(t&&(e.addRule(`.monaco-editor .view-overlays .current-line { background-color: ${t}; }`),e.addRule(`.monaco-editor .margin-view-overlays .current-line-margin { background-color: ${t}; border: none; }`)),!t||t.isTransparent()||a.defines(editorLineHighlightBorder)){const s=a.getColor(editorLineHighlightBorder);s&&(e.addRule(`.monaco-editor .view-overlays .current-line-exact { border: 2px solid ${s}; }`),e.addRule(`.monaco-editor .margin-view-overlays .current-line-exact-margin { border: 2px solid ${s}; }`),isHighContrast(a.type)&&(e.addRule(".monaco-editor .view-overlays .current-line-exact { border-width: 1px; }"),e.addRule(".monaco-editor .margin-view-overlays .current-line-exact-margin { border-width: 1px; }")))}});const decorations="";class DecorationsOverlay extends DynamicViewOverlay{constructor(e){super(),this._context=e;const t=this._context.configuration.options;this._typicalHalfwidthCharacterWidth=t.get(59).typicalHalfwidthCharacterWidth,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return this._typicalHalfwidthCharacterWidth=t.get(59).typicalHalfwidthCharacterWidth,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged||e.scrollWidthChanged}onZonesChanged(e){return!0}prepareRender(e){const t=e.getDecorationsInViewport();let s=[],o=0;for(let d=0,u=t.length;d<u;d++){const g=t[d];g.options.className&&(s[o++]=g)}s=s.sort((d,u)=>{if(d.options.zIndex<u.options.zIndex)return-1;if(d.options.zIndex>u.options.zIndex)return 1;const g=d.options.className,f=u.options.className;return g<f?-1:g>f?1:Range$2.compareRangesUsingStarts(d.range,u.range)});const r=e.visibleRange.startLineNumber,l=e.visibleRange.endLineNumber,c=[];for(let d=r;d<=l;d++){const u=d-r;c[u]=""}this._renderWholeLineDecorations(e,s,c),this._renderNormalDecorations(e,s,c),this._renderResult=c}_renderWholeLineDecorations(e,t,s){const o=e.visibleRange.startLineNumber,r=e.visibleRange.endLineNumber;for(let l=0,c=t.length;l<c;l++){const d=t[l];if(!d.options.isWholeLine)continue;const u='<div class="cdr '+d.options.className+'" style="left:0;width:100%;"></div>',g=Math.max(d.range.startLineNumber,o),f=Math.min(d.range.endLineNumber,r);for(let p=g;p<=f;p++){const m=p-o;s[m]+=u}}}_renderNormalDecorations(e,t,s){const o=e.visibleRange.startLineNumber;let r=null,l=!1,c=null,d=!1;for(let u=0,g=t.length;u<g;u++){const f=t[u];if(f.options.isWholeLine)continue;const p=f.options.className,m=!!f.options.showIfCollapsed;let _=f.range;if(m&&_.endColumn===1&&_.endLineNumber!==_.startLineNumber&&(_=new Range$2(_.startLineNumber,_.startColumn,_.endLineNumber-1,this._context.viewModel.getLineMaxColumn(_.endLineNumber-1))),r===p&&l===m&&Range$2.areIntersectingOrTouching(c,_)){c=Range$2.plusRange(c,_);continue}r!==null&&this._renderNormalDecoration(e,c,r,d,l,o,s),r=p,l=m,c=_,d=f.options.shouldFillLineOnLineBreak??!1}r!==null&&this._renderNormalDecoration(e,c,r,d,l,o,s)}_renderNormalDecoration(e,t,s,o,r,l,c){const d=e.linesVisibleRangesForRange(t,s==="findMatch");if(d)for(let u=0,g=d.length;u<g;u++){const f=d[u];if(f.outsideRenderedLine)continue;const p=f.lineNumber-l;if(r&&f.ranges.length===1){const m=f.ranges[0];if(m.width<this._typicalHalfwidthCharacterWidth){const _=Math.round(m.left+m.width/2),C=Math.max(0,Math.round(_-this._typicalHalfwidthCharacterWidth/2));f.ranges[0]=new HorizontalRange(C,this._typicalHalfwidthCharacterWidth)}}for(let m=0,_=f.ranges.length;m<_;m++){const C=o&&f.continuesOnNextLine&&_===1,b=f.ranges[m],v='<div class="cdr '+s+'" style="left:'+String(b.left)+"px;width:"+(C?"100%;":String(b.width)+"px;")+'"></div>';c[p]+=v}}}render(e,t){if(!this._renderResult)return"";const s=t-e;return s<0||s>=this._renderResult.length?"":this._renderResult[s]}}class EditorScrollbar extends ViewPart{constructor(e,t,s,o){super(e);const r=this._context.configuration.options,l=r.get(117),c=r.get(83),d=r.get(49),u=r.get(120),g=r.get(158),f={listenOnDomNode:s.domNode,className:"editor-scrollable "+getThemeTypeSelector(e.theme.type),useShadows:!1,lazyRender:!0,vertical:l.vertical,horizontal:l.horizontal,verticalHasArrows:l.verticalHasArrows,horizontalHasArrows:l.horizontalHasArrows,verticalScrollbarSize:l.verticalScrollbarSize,verticalSliderSize:l.verticalSliderSize,horizontalScrollbarSize:l.horizontalScrollbarSize,horizontalSliderSize:l.horizontalSliderSize,handleMouseWheel:l.handleMouseWheel,alwaysConsumeMouseWheel:l.alwaysConsumeMouseWheel,arrowSize:l.arrowSize,mouseWheelScrollSensitivity:c,fastScrollSensitivity:d,scrollPredominantAxis:u,scrollByPage:l.scrollByPage,inertialScroll:g};this.scrollbar=this._register(new SmoothScrollableElement(t.domNode,f,this._context.viewLayout.getScrollable())),PartFingerprints.write(this.scrollbar.getDomNode(),6),this.scrollbarDomNode=createFastDomNode(this.scrollbar.getDomNode()),this.scrollbarDomNode.setPosition("absolute"),this._setLayout();const p=(m,_,C)=>{const b={};if(_){const v=m.scrollTop;v&&(b.scrollTop=this._context.viewLayout.getCurrentScrollTop()+v,m.scrollTop=0)}if(C){const v=m.scrollLeft;v&&(b.scrollLeft=this._context.viewLayout.getCurrentScrollLeft()+v,m.scrollLeft=0)}this._context.viewModel.viewLayout.setScrollPosition(b,1)};this._register(addDisposableListener(s.domNode,"scroll",m=>p(s.domNode,!0,!0))),this._register(addDisposableListener(t.domNode,"scroll",m=>p(t.domNode,!0,!1))),this._register(addDisposableListener(o.domNode,"scroll",m=>p(o.domNode,!0,!1))),this._register(addDisposableListener(this.scrollbarDomNode.domNode,"scroll",m=>p(this.scrollbarDomNode.domNode,!0,!1)))}dispose(){super.dispose()}_setLayout(){const e=this._context.configuration.options,t=e.get(165);this.scrollbarDomNode.setLeft(t.contentLeft),e.get(81).side==="right"?this.scrollbarDomNode.setWidth(t.contentWidth+t.minimap.minimapWidth):this.scrollbarDomNode.setWidth(t.contentWidth),this.scrollbarDomNode.setHeight(t.height)}getOverviewRulerLayoutInfo(){return this.scrollbar.getOverviewRulerLayoutInfo()}getDomNode(){return this.scrollbarDomNode}delegateVerticalScrollbarPointerDown(e){this.scrollbar.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){this.scrollbar.delegateScrollFromMouseWheelEvent(e)}onConfigurationChanged(e){if(e.hasChanged(117)||e.hasChanged(83)||e.hasChanged(49)){const t=this._context.configuration.options,s=t.get(117),o=t.get(83),r=t.get(49),l=t.get(120),c={vertical:s.vertical,horizontal:s.horizontal,verticalScrollbarSize:s.verticalScrollbarSize,horizontalScrollbarSize:s.horizontalScrollbarSize,scrollByPage:s.scrollByPage,handleMouseWheel:s.handleMouseWheel,mouseWheelScrollSensitivity:o,fastScrollSensitivity:r,scrollPredominantAxis:l};this.scrollbar.updateOptions(c)}return e.hasChanged(165)&&this._setLayout(),!0}onScrollChanged(e){return!0}onThemeChanged(e){return this.scrollbar.updateClassName("editor-scrollable "+getThemeTypeSelector(this._context.theme.type)),!0}prepareRender(e){}render(e){this.scrollbar.renderNow()}}const glyphMargin="";class DecorationToRender{constructor(e,t,s,o,r){this.startLineNumber=e,this.endLineNumber=t,this.className=s,this.tooltip=o,this._decorationToRenderBrand=void 0,this.zIndex=r??0}}class LineDecorationToRender{constructor(e,t,s){this.className=e,this.zIndex=t,this.tooltip=s}}class VisibleLineDecorationsToRender{constructor(){this.decorations=[]}add(e){this.decorations.push(e)}getDecorations(){return this.decorations}}class DedupOverlay extends DynamicViewOverlay{_render(e,t,s){const o=[];for(let c=e;c<=t;c++){const d=c-e;o[d]=new VisibleLineDecorationsToRender}if(s.length===0)return o;s.sort((c,d)=>c.className===d.className?c.startLineNumber===d.startLineNumber?c.endLineNumber-d.endLineNumber:c.startLineNumber-d.startLineNumber:c.className<d.className?-1:1);let r=null,l=0;for(let c=0,d=s.length;c<d;c++){const u=s[c],g=u.className,f=u.zIndex;let p=Math.max(u.startLineNumber,e)-e;const m=Math.min(u.endLineNumber,t)-e;r===g?(p=Math.max(l+1,p),l=Math.max(l,m)):(r=g,l=m);for(let _=p;_<=l;_++)o[_].add(new LineDecorationToRender(g,f,u.tooltip))}return o}}class GlyphMarginWidgets extends ViewPart{constructor(e){super(e),this._widgets={},this._context=e;const t=this._context.configuration.options,s=t.get(165);this.domNode=createFastDomNode(document.createElement("div")),this.domNode.setClassName("glyph-margin-widgets"),this.domNode.setPosition("absolute"),this.domNode.setTop(0),this._lineHeight=t.get(75),this._glyphMargin=t.get(66),this._glyphMarginLeft=s.glyphMarginLeft,this._glyphMarginWidth=s.glyphMarginWidth,this._glyphMarginDecorationLaneCount=s.glyphMarginDecorationLaneCount,this._managedDomNodes=[],this._decorationGlyphsToRender=[]}dispose(){this._managedDomNodes=[],this._decorationGlyphsToRender=[],this._widgets={},super.dispose()}getWidgets(){return Object.values(this._widgets)}onConfigurationChanged(e){const t=this._context.configuration.options,s=t.get(165);return this._lineHeight=t.get(75),this._glyphMargin=t.get(66),this._glyphMarginLeft=s.glyphMarginLeft,this._glyphMarginWidth=s.glyphMarginWidth,this._glyphMarginDecorationLaneCount=s.glyphMarginDecorationLaneCount,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}addWidget(e){const t=createFastDomNode(e.getDomNode());this._widgets[e.getId()]={widget:e,preference:e.getPosition(),domNode:t,renderInfo:null},t.setPosition("absolute"),t.setDisplay("none"),t.setAttribute("widgetId",e.getId()),this.domNode.appendChild(t),this.setShouldRender()}setWidgetPosition(e,t){const s=this._widgets[e.getId()];return s.preference.lane===t.lane&&s.preference.zIndex===t.zIndex&&Range$2.equalsRange(s.preference.range,t.range)?!1:(s.preference=t,this.setShouldRender(),!0)}removeWidget(e){const t=e.getId();if(this._widgets[t]){const o=this._widgets[t].domNode.domNode;delete this._widgets[t],o.remove(),this.setShouldRender()}}_collectDecorationBasedGlyphRenderRequest(e,t){var l;const s=e.visibleRange.startLineNumber,o=e.visibleRange.endLineNumber,r=e.getDecorationsInViewport();for(const c of r){const d=c.options.glyphMarginClassName;if(!d)continue;const u=Math.max(c.range.startLineNumber,s),g=Math.min(c.range.endLineNumber,o),f=((l=c.options.glyphMargin)==null?void 0:l.position)??GlyphMarginLane$1.Center,p=c.options.zIndex??0;for(let m=u;m<=g;m++){const _=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new Position$1(m,0)),C=this._context.viewModel.glyphLanes.getLanesAtLine(_.lineNumber).indexOf(f);t.push(new DecorationBasedGlyphRenderRequest(m,C,p,d))}}}_collectWidgetBasedGlyphRenderRequest(e,t){const s=e.visibleRange.startLineNumber,o=e.visibleRange.endLineNumber;for(const r of Object.values(this._widgets)){const l=r.preference.range,{startLineNumber:c,endLineNumber:d}=this._context.viewModel.coordinatesConverter.convertModelRangeToViewRange(Range$2.lift(l));if(!c||!d||d<s||c>o)continue;const u=Math.max(c,s),g=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new Position$1(u,0)),f=this._context.viewModel.glyphLanes.getLanesAtLine(g.lineNumber).indexOf(r.preference.lane);t.push(new WidgetBasedGlyphRenderRequest(u,f,r.preference.zIndex,r))}}_collectSortedGlyphRenderRequests(e){const t=[];return this._collectDecorationBasedGlyphRenderRequest(e,t),this._collectWidgetBasedGlyphRenderRequest(e,t),t.sort((s,o)=>s.lineNumber===o.lineNumber?s.laneIndex===o.laneIndex?s.zIndex===o.zIndex?o.type===s.type?s.type===0&&o.type===0?s.className<o.className?-1:1:0:o.type-s.type:o.zIndex-s.zIndex:s.laneIndex-o.laneIndex:s.lineNumber-o.lineNumber),t}prepareRender(e){if(!this._glyphMargin){this._decorationGlyphsToRender=[];return}for(const o of Object.values(this._widgets))o.renderInfo=null;const t=new ArrayQueue(this._collectSortedGlyphRenderRequests(e)),s=[];for(;t.length>0;){const o=t.peek();if(!o)break;const r=t.takeWhile(c=>c.lineNumber===o.lineNumber&&c.laneIndex===o.laneIndex);if(!r||r.length===0)break;const l=r[0];if(l.type===0){const c=[];for(const d of r){if(d.zIndex!==l.zIndex||d.type!==l.type)break;(c.length===0||c[c.length-1]!==d.className)&&c.push(d.className)}s.push(l.accept(c.join(" ")))}else l.widget.renderInfo={lineNumber:l.lineNumber,laneIndex:l.laneIndex}}this._decorationGlyphsToRender=s}render(e){if(!this._glyphMargin){for(const s of Object.values(this._widgets))s.domNode.setDisplay("none");for(;this._managedDomNodes.length>0;){const s=this._managedDomNodes.pop();s==null||s.domNode.remove()}return}const t=Math.round(this._glyphMarginWidth/this._glyphMarginDecorationLaneCount);for(const s of Object.values(this._widgets))if(!s.renderInfo)s.domNode.setDisplay("none");else{const o=e.viewportData.relativeVerticalOffset[s.renderInfo.lineNumber-e.viewportData.startLineNumber],r=this._glyphMarginLeft+s.renderInfo.laneIndex*this._lineHeight;s.domNode.setDisplay("block"),s.domNode.setTop(o),s.domNode.setLeft(r),s.domNode.setWidth(t),s.domNode.setHeight(this._lineHeight)}for(let s=0;s<this._decorationGlyphsToRender.length;s++){const o=this._decorationGlyphsToRender[s],r=o.lineNumber,l=e.viewportData.relativeVerticalOffset[r-e.viewportData.startLineNumber],c=this._glyphMarginLeft+o.laneIndex*this._lineHeight;let d;s<this._managedDomNodes.length?d=this._managedDomNodes[s]:(d=createFastDomNode(document.createElement("div")),this._managedDomNodes.push(d),this.domNode.appendChild(d));const u=this._context.viewLayout.getLineHeightForLineNumber(r);d.setClassName("cgmr codicon "+o.combinedClassName),d.setPosition("absolute"),d.setTop(l),d.setLeft(c),d.setWidth(t),d.setHeight(u)}for(;this._managedDomNodes.length>this._decorationGlyphsToRender.length;){const s=this._managedDomNodes.pop();s==null||s.domNode.remove()}}}class DecorationBasedGlyphRenderRequest{constructor(e,t,s,o){this.lineNumber=e,this.laneIndex=t,this.zIndex=s,this.className=o,this.type=0}accept(e){return new DecorationBasedGlyph(this.lineNumber,this.laneIndex,e)}}class WidgetBasedGlyphRenderRequest{constructor(e,t,s,o){this.lineNumber=e,this.laneIndex=t,this.zIndex=s,this.widget=o,this.type=1}}class DecorationBasedGlyph{constructor(e,t,s){this.lineNumber=e,this.laneIndex=t,this.combinedClassName=s}}const indentGuides="";function findLast(a,e,t=a.length-1){const s=findLastIdx(a,e,t);if(s!==-1)return a[s]}function findLastIdx(a,e,t=a.length-1){for(let s=t;s>=0;s--){const o=a[s];if(e(o))return s}return-1}function findLastMonotonous(a,e){const t=findLastIdxMonotonous(a,e);return t===-1?void 0:a[t]}function findLastIdxMonotonous(a,e,t=0,s=a.length){let o=t,r=s;for(;o<r;){const l=Math.floor((o+r)/2);e(a[l])?o=l+1:r=l}return o-1}function findFirstMonotonous(a,e){const t=findFirstIdxMonotonousOrArrLen(a,e);return t===a.length?void 0:a[t]}function findFirstIdxMonotonousOrArrLen(a,e,t=0,s=a.length){let o=t,r=s;for(;o<r;){const l=Math.floor((o+r)/2);e(a[l])?r=l:o=l+1}return o}const ls=class ls{constructor(e){this._array=e,this._findLastMonotonousLastIdx=0}findLastMonotonous(e){if(ls.assertInvariants){if(this._prevFindLastPredicate){for(const s of this._array)if(this._prevFindLastPredicate(s)&&!e(s))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=e}const t=findLastIdxMonotonous(this._array,e,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=t+1,t===-1?void 0:this._array[t]}};ls.assertInvariants=!1;let MonotonousArray=ls;function findFirstMax(a,e){if(a.length===0)return;let t=a[0];for(let s=1;s<a.length;s++){const o=a[s];e(o,t)>0&&(t=o)}return t}function findLastMax(a,e){if(a.length===0)return;let t=a[0];for(let s=1;s<a.length;s++){const o=a[s];e(o,t)>=0&&(t=o)}return t}function findFirstMin(a,e){return findFirstMax(a,(t,s)=>-e(t,s))}function findMaxIdx(a,e){if(a.length===0)return-1;let t=0;for(let s=1;s<a.length;s++){const o=a[s];e(o,a[t])>0&&(t=s)}return t}function mapFindFirst(a,e){for(const t of a){const s=e(t);if(s!==void 0)return s}}class TextModelPart extends Disposable{constructor(){super(...arguments),this._isDisposed=!1}dispose(){super.dispose(),this._isDisposed=!0}assertNotDisposed(){if(this._isDisposed)throw new Error("TextModelPart is disposed!")}}function computeIndentLevel(a,e){let t=0,s=0;const o=a.length;for(;s<o;){const r=a.charCodeAt(s);if(r===32)t++;else if(r===9)t=t-t%e+e;else break;s++}return s===o?-1:t}var HorizontalGuidesState;(function(a){a[a.Disabled=0]="Disabled",a[a.EnabledForActive=1]="EnabledForActive",a[a.Enabled=2]="Enabled"})(HorizontalGuidesState||(HorizontalGuidesState={}));class IndentGuide{constructor(e,t,s,o,r,l){if(this.visibleColumn=e,this.column=t,this.className=s,this.horizontalLine=o,this.forWrappedLinesAfterColumn=r,this.forWrappedLinesBeforeOrAtColumn=l,e!==-1==(t!==-1))throw new Error}}class IndentGuideHorizontalLine{constructor(e,t){this.top=e,this.endColumn=t}}class GuidesTextModelPart extends TextModelPart{constructor(e,t){super(),this.textModel=e,this.languageConfigurationService=t}getLanguageConfiguration(e){return this.languageConfigurationService.getLanguageConfiguration(e)}_computeIndentLevel(e){return computeIndentLevel(this.textModel.getLineContent(e+1),this.textModel.getOptions().tabSize)}getActiveIndentGuide(e,t,s){this.assertNotDisposed();const o=this.textModel.getLineCount();if(e<1||e>o)throw new BugIndicatingError("Illegal value for lineNumber");const r=this.getLanguageConfiguration(this.textModel.getLanguageId()).foldingRules,l=!!(r&&r.offSide);let c=-2,d=-1,u=-2,g=-1;const f=E=>{if(c!==-1&&(c===-2||c>E-1)){c=-1,d=-1;for(let I=E-2;I>=0;I--){const D=this._computeIndentLevel(I);if(D>=0){c=I,d=D;break}}}if(u===-2){u=-1,g=-1;for(let I=E;I<o;I++){const D=this._computeIndentLevel(I);if(D>=0){u=I,g=D;break}}}};let p=-2,m=-1,_=-2,C=-1;const b=E=>{if(p===-2){p=-1,m=-1;for(let I=E-2;I>=0;I--){const D=this._computeIndentLevel(I);if(D>=0){p=I,m=D;break}}}if(_!==-1&&(_===-2||_<E-1)){_=-1,C=-1;for(let I=E;I<o;I++){const D=this._computeIndentLevel(I);if(D>=0){_=I,C=D;break}}}};let v=0,S=!0,y=0,w=!0,L=0,x=0;for(let E=0;S||w;E++){const I=e-E,D=e+E;E>1&&(I<1||I<t)&&(S=!1),E>1&&(D>o||D>s)&&(w=!1),E>5e4&&(S=!1,w=!1);let k=-1;if(S&&I>=1){const R=this._computeIndentLevel(I-1);R>=0?(u=I-1,g=R,k=Math.ceil(R/this.textModel.getOptions().indentSize)):(f(I),k=this._getIndentLevelForWhitespaceLine(l,d,g))}let N=-1;if(w&&D<=o){const R=this._computeIndentLevel(D-1);R>=0?(p=D-1,m=R,N=Math.ceil(R/this.textModel.getOptions().indentSize)):(b(D),N=this._getIndentLevelForWhitespaceLine(l,m,C))}if(E===0){x=k;continue}if(E===1){if(D<=o&&N>=0&&x+1===N){S=!1,v=D,y=D,L=N;continue}if(I>=1&&k>=0&&k-1===x){w=!1,v=I,y=I,L=k;continue}if(v=e,y=e,L=x,L===0)return{startLineNumber:v,endLineNumber:y,indent:L}}S&&(k>=L?v=I:S=!1),w&&(N>=L?y=D:w=!1)}return{startLineNumber:v,endLineNumber:y,indent:L}}getLinesBracketGuides(e,t,s,o){var f;const r=[];for(let p=e;p<=t;p++)r.push([]);const l=!0,c=this.textModel.bracketPairs.getBracketPairsInRangeWithMinIndentation(new Range$2(e,1,t,this.textModel.getLineMaxColumn(t))).toArray();let d;if(s&&c.length>0){const p=(e<=s.lineNumber&&s.lineNumber<=t?c:this.textModel.bracketPairs.getBracketPairsInRange(Range$2.fromPositions(s)).toArray()).filter(m=>Range$2.strictContainsPosition(m.range,s));d=(f=findLast(p,m=>l))==null?void 0:f.range}const u=this.textModel.getOptions().bracketPairColorizationOptions.independentColorPoolPerBracketType,g=new BracketPairGuidesClassNames;for(const p of c){if(!p.closingBracketRange)continue;const m=d&&p.range.equalsRange(d);if(!m&&!o.includeInactive)continue;const _=g.getInlineClassName(p.nestingLevel,p.nestingLevelOfEqualBracketType,u)+(o.highlightActive&&m?" "+g.activeClassName:""),C=p.openingBracketRange.getStartPosition(),b=p.closingBracketRange.getStartPosition(),v=o.horizontalGuides===HorizontalGuidesState.Enabled||o.horizontalGuides===HorizontalGuidesState.EnabledForActive&&m;if(p.range.startLineNumber===p.range.endLineNumber){v&&r[p.range.startLineNumber-e].push(new IndentGuide(-1,p.openingBracketRange.getEndPosition().column,_,new IndentGuideHorizontalLine(!1,b.column),-1,-1));continue}const S=this.getVisibleColumnFromPosition(b),y=this.getVisibleColumnFromPosition(p.openingBracketRange.getStartPosition()),w=Math.min(y,S,p.minVisibleColumnIndentation+1);let L=!1;firstNonWhitespaceIndex(this.textModel.getLineContent(p.closingBracketRange.startLineNumber))<p.closingBracketRange.startColumn-1&&(L=!0);const I=Math.max(C.lineNumber,e),D=Math.min(b.lineNumber,t),k=L?1:0;for(let N=I;N<D+k;N++)r[N-e].push(new IndentGuide(w,-1,_,null,N===C.lineNumber?C.column:-1,N===b.lineNumber?b.column:-1));v&&(C.lineNumber>=e&&y>w&&r[C.lineNumber-e].push(new IndentGuide(w,-1,_,new IndentGuideHorizontalLine(!1,C.column),-1,-1)),b.lineNumber<=t&&S>w&&r[b.lineNumber-e].push(new IndentGuide(w,-1,_,new IndentGuideHorizontalLine(!L,b.column),-1,-1)))}for(const p of r)p.sort((m,_)=>m.visibleColumn-_.visibleColumn);return r}getVisibleColumnFromPosition(e){return CursorColumns.visibleColumnFromColumn(this.textModel.getLineContent(e.lineNumber),e.column,this.textModel.getOptions().tabSize)+1}getLinesIndentGuides(e,t){this.assertNotDisposed();const s=this.textModel.getLineCount();if(e<1||e>s)throw new Error("Illegal value for startLineNumber");if(t<1||t>s)throw new Error("Illegal value for endLineNumber");const o=this.textModel.getOptions(),r=this.getLanguageConfiguration(this.textModel.getLanguageId()).foldingRules,l=!!(r&&r.offSide),c=new Array(t-e+1);let d=-2,u=-1,g=-2,f=-1;for(let p=e;p<=t;p++){const m=p-e,_=this._computeIndentLevel(p-1);if(_>=0){d=p-1,u=_,c[m]=Math.ceil(_/o.indentSize);continue}if(d===-2){d=-1,u=-1;for(let C=p-2;C>=0;C--){const b=this._computeIndentLevel(C);if(b>=0){d=C,u=b;break}}}if(g!==-1&&(g===-2||g<p-1)){g=-1,f=-1;for(let C=p;C<s;C++){const b=this._computeIndentLevel(C);if(b>=0){g=C,f=b;break}}}c[m]=this._getIndentLevelForWhitespaceLine(l,u,f)}return c}_getIndentLevelForWhitespaceLine(e,t,s){const o=this.textModel.getOptions();return t===-1||s===-1?0:t<s?1+Math.floor(t/o.indentSize):t===s||e?Math.ceil(s/o.indentSize):1+Math.floor(s/o.indentSize)}}class BracketPairGuidesClassNames{constructor(){this.activeClassName="indent-active"}getInlineClassName(e,t,s){return this.getInlineClassNameOfLevel(s?t:e)}getInlineClassNameOfLevel(e){return`bracket-indent-guide lvl-${e%30}`}}class IndentGuidesOverlay extends DynamicViewOverlay{constructor(e){super(),this._context=e,this._primaryPosition=null;const t=this._context.configuration.options,s=t.get(166),o=t.get(59);this._spaceWidth=o.spaceWidth,this._maxIndentLeft=s.wrappingColumn===-1?-1:s.wrappingColumn*o.typicalHalfwidthCharacterWidth,this._bracketPairGuideOptions=t.get(22),this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options,s=t.get(166),o=t.get(59);return this._spaceWidth=o.spaceWidth,this._maxIndentLeft=s.wrappingColumn===-1?-1:s.wrappingColumn*o.typicalHalfwidthCharacterWidth,this._bracketPairGuideOptions=t.get(22),!0}onCursorStateChanged(e){var o;const s=e.selections[0].getPosition();return(o=this._primaryPosition)!=null&&o.equals(s)?!1:(this._primaryPosition=s,!0)}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}onLanguageConfigurationChanged(e){return!0}prepareRender(e){var d,u;if(!this._bracketPairGuideOptions.indentation&&this._bracketPairGuideOptions.bracketPairs===!1){this._renderResult=null;return}const t=e.visibleRange.startLineNumber,s=e.visibleRange.endLineNumber,o=e.scrollWidth,r=this._primaryPosition,l=this.getGuidesByLine(t,Math.min(s+1,this._context.viewModel.getLineCount()),r),c=[];for(let g=t;g<=s;g++){const f=g-t,p=l[f];let m="";const _=((d=e.visibleRangeForPosition(new Position$1(g,1)))==null?void 0:d.left)??0;for(const C of p){const b=C.column===-1?_+(C.visibleColumn-1)*this._spaceWidth:e.visibleRangeForPosition(new Position$1(g,C.column)).left;if(b>o||this._maxIndentLeft>0&&b>this._maxIndentLeft)break;const v=C.horizontalLine?C.horizontalLine.top?"horizontal-top":"horizontal-bottom":"vertical",S=C.horizontalLine?(((u=e.visibleRangeForPosition(new Position$1(g,C.horizontalLine.endColumn)))==null?void 0:u.left)??b+this._spaceWidth)-b:this._spaceWidth;m+=`<div class="core-guide ${C.className} ${v}" style="left:${b}px;width:${S}px"></div>`}c[f]=m}this._renderResult=c}getGuidesByLine(e,t,s){const o=this._bracketPairGuideOptions.bracketPairs!==!1?this._context.viewModel.getBracketGuidesInRangeByLine(e,t,s,{highlightActive:this._bracketPairGuideOptions.highlightActiveBracketPair,horizontalGuides:this._bracketPairGuideOptions.bracketPairsHorizontal===!0?HorizontalGuidesState.Enabled:this._bracketPairGuideOptions.bracketPairsHorizontal==="active"?HorizontalGuidesState.EnabledForActive:HorizontalGuidesState.Disabled,includeInactive:this._bracketPairGuideOptions.bracketPairs===!0}):null,r=this._bracketPairGuideOptions.indentation?this._context.viewModel.getLinesIndentGuides(e,t):null;let l=0,c=0,d=0;if(this._bracketPairGuideOptions.highlightActiveIndentation!==!1&&s){const f=this._context.viewModel.getActiveIndentGuide(s.lineNumber,e,t);l=f.startLineNumber,c=f.endLineNumber,d=f.indent}const{indentSize:u}=this._context.viewModel.model.getOptions(),g=[];for(let f=e;f<=t;f++){const p=new Array;g.push(p);const m=o?o[f-e]:[],_=new ArrayQueue(m),C=r?r[f-e]:0;for(let b=1;b<=C;b++){const v=(b-1)*u+1,S=(this._bracketPairGuideOptions.highlightActiveIndentation==="always"||m.length===0)&&l<=f&&f<=c&&b===d;p.push(..._.takeWhile(w=>w.visibleColumn<v)||[]);const y=_.peek();(!y||y.visibleColumn!==v||y.horizontalLine)&&p.push(new IndentGuide(v,-1,`core-guide-indent lvl-${(b-1)%30}`+(S?" indent-active":""),null,-1,-1))}p.push(..._.takeWhile(b=>!0)||[])}return g}render(e,t){if(!this._renderResult)return"";const s=t-e;return s<0||s>=this._renderResult.length?"":this._renderResult[s]}}function transparentToUndefined(a){if(!(a&&a.isTransparent()))return a}registerThemingParticipant((a,e)=>{const t=[{bracketColor:editorBracketHighlightingForeground1,guideColor:editorBracketPairGuideBackground1,guideColorActive:editorBracketPairGuideActiveBackground1},{bracketColor:editorBracketHighlightingForeground2,guideColor:editorBracketPairGuideBackground2,guideColorActive:editorBracketPairGuideActiveBackground2},{bracketColor:editorBracketHighlightingForeground3,guideColor:editorBracketPairGuideBackground3,guideColorActive:editorBracketPairGuideActiveBackground3},{bracketColor:editorBracketHighlightingForeground4,guideColor:editorBracketPairGuideBackground4,guideColorActive:editorBracketPairGuideActiveBackground4},{bracketColor:editorBracketHighlightingForeground5,guideColor:editorBracketPairGuideBackground5,guideColorActive:editorBracketPairGuideActiveBackground5},{bracketColor:editorBracketHighlightingForeground6,guideColor:editorBracketPairGuideBackground6,guideColorActive:editorBracketPairGuideActiveBackground6}],s=new BracketPairGuidesClassNames,o=[{indentColor:editorIndentGuide1,indentColorActive:editorActiveIndentGuide1},{indentColor:editorIndentGuide2,indentColorActive:editorActiveIndentGuide2},{indentColor:editorIndentGuide3,indentColorActive:editorActiveIndentGuide3},{indentColor:editorIndentGuide4,indentColorActive:editorActiveIndentGuide4},{indentColor:editorIndentGuide5,indentColorActive:editorActiveIndentGuide5},{indentColor:editorIndentGuide6,indentColorActive:editorActiveIndentGuide6}],r=t.map(c=>{const d=a.getColor(c.bracketColor),u=a.getColor(c.guideColor),g=a.getColor(c.guideColorActive),f=transparentToUndefined(transparentToUndefined(u)??(d==null?void 0:d.transparent(.3))),p=transparentToUndefined(transparentToUndefined(g)??d);if(!(!f||!p))return{guideColor:f,guideColorActive:p}}).filter(isDefined),l=o.map(c=>{const d=a.getColor(c.indentColor),u=a.getColor(c.indentColorActive),g=transparentToUndefined(d),f=transparentToUndefined(u);if(!(!g||!f))return{indentColor:g,indentColorActive:f}}).filter(isDefined);if(r.length>0){for(let c=0;c<30;c++){const d=r[c%r.length];e.addRule(`.monaco-editor .${s.getInlineClassNameOfLevel(c).replace(/ /g,".")} { --guide-color: ${d.guideColor}; --guide-color-active: ${d.guideColorActive}; }`)}e.addRule(".monaco-editor .vertical { box-shadow: 1px 0 0 0 var(--guide-color) inset; }"),e.addRule(".monaco-editor .horizontal-top { border-top: 1px solid var(--guide-color); }"),e.addRule(".monaco-editor .horizontal-bottom { border-bottom: 1px solid var(--guide-color); }"),e.addRule(`.monaco-editor .vertical.${s.activeClassName} { box-shadow: 1px 0 0 0 var(--guide-color-active) inset; }`),e.addRule(`.monaco-editor .horizontal-top.${s.activeClassName} { border-top: 1px solid var(--guide-color-active); }`),e.addRule(`.monaco-editor .horizontal-bottom.${s.activeClassName} { border-bottom: 1px solid var(--guide-color-active); }`)}if(l.length>0){for(let c=0;c<30;c++){const d=l[c%l.length];e.addRule(`.monaco-editor .lines-content .core-guide-indent.lvl-${c} { --indent-color: ${d.indentColor}; --indent-color-active: ${d.indentColorActive}; }`)}e.addRule(".monaco-editor .lines-content .core-guide-indent { box-shadow: 1px 0 0 0 var(--indent-color) inset; }"),e.addRule(".monaco-editor .lines-content .core-guide-indent.indent-active { box-shadow: 1px 0 0 0 var(--indent-color-active) inset; }")}});const lineNumbers="",cs=class cs extends DynamicViewOverlay{constructor(e){super(),this._context=e,this._readConfig(),this._lastCursorModelPosition=new Position$1(1,1),this._renderResult=null,this._activeModelLineNumber=1,this._context.addEventHandler(this)}_readConfig(){const e=this._context.configuration.options;this._lineHeight=e.get(75);const t=e.get(76);this._renderLineNumbers=t.renderType,this._renderCustomLineNumbers=t.renderFn,this._renderFinalNewline=e.get(109);const s=e.get(165);this._lineNumbersLeft=s.lineNumbersLeft,this._lineNumbersWidth=s.lineNumbersWidth}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){return this._readConfig(),!0}onCursorStateChanged(e){const t=e.selections[0].getPosition();this._lastCursorModelPosition=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(t);let s=!1;return this._activeModelLineNumber!==this._lastCursorModelPosition.lineNumber&&(this._activeModelLineNumber=this._lastCursorModelPosition.lineNumber,s=!0),(this._renderLineNumbers===2||this._renderLineNumbers===3)&&(s=!0),s}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}onDecorationsChanged(e){return e.affectsLineNumber}_getLineRenderLineNumber(e){const t=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new Position$1(e,1));if(t.column!==1)return"";const s=t.lineNumber;if(this._renderCustomLineNumbers)return this._renderCustomLineNumbers(s);if(this._renderLineNumbers===2){const o=Math.abs(this._lastCursorModelPosition.lineNumber-s);return o===0?'<span class="relative-current-line-number">'+s+"</span>":String(o)}if(this._renderLineNumbers===3){if(this._lastCursorModelPosition.lineNumber===s||s%10===0)return String(s);const o=this._context.viewModel.getLineCount();return s===o?String(s):""}return String(s)}prepareRender(e){if(this._renderLineNumbers===0){this._renderResult=null;return}const t=isLinux?this._lineHeight%2===0?" lh-even":" lh-odd":"",s=e.visibleRange.startLineNumber,o=e.visibleRange.endLineNumber,r=this._context.viewModel.getDecorationsInViewport(e.visibleRange).filter(u=>!!u.options.lineNumberClassName);r.sort((u,g)=>Range$2.compareRangesUsingEnds(u.range,g.range));let l=0;const c=this._context.viewModel.getLineCount(),d=[];for(let u=s;u<=o;u++){const g=u-s,f=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new Position$1(u,1)).lineNumber;let p=this._getLineRenderLineNumber(u),m="";for(;l<r.length&&r[l].range.endLineNumber<u;)l++;for(let _=l;_<r.length;_++){const{range:C,options:b}=r[_];C.startLineNumber<=u&&(m+=" "+b.lineNumberClassName)}if(!p&&!m){d[g]="";continue}u===c&&this._context.viewModel.getLineLength(u)===0&&(this._renderFinalNewline==="off"&&(p=""),this._renderFinalNewline==="dimmed"&&(m+=" dimmed-line-number")),f===this._activeModelLineNumber&&(m+=" active-line-number"),d[g]=`<div class="${cs.CLASS_NAME}${t}${m}" style="left:${this._lineNumbersLeft}px;width:${this._lineNumbersWidth}px;">${p}</div>`}this._renderResult=d}render(e,t){if(!this._renderResult)return"";const s=t-e;return s<0||s>=this._renderResult.length?"":this._renderResult[s]}};cs.CLASS_NAME="line-numbers";let LineNumbersOverlay=cs;registerThemingParticipant((a,e)=>{const t=a.getColor(editorLineNumbers),s=a.getColor(editorDimmedLineNumber);s?e.addRule(`.monaco-editor .line-numbers.dimmed-line-number { color: ${s}; }`):t&&e.addRule(`.monaco-editor .line-numbers.dimmed-line-number { color: ${t.transparent(.4)}; }`)});const mouseCursor="",MOUSE_CURSOR_TEXT_CSS_CLASS_NAME="monaco-mouse-cursor-text",viewLines="";class DomReadingContext{get didDomLayout(){return this._didDomLayout}readClientRect(){if(!this._clientRectRead){this._clientRectRead=!0;const e=this._domNode.getBoundingClientRect();this.markDidDomLayout(),this._clientRectDeltaLeft=e.left,this._clientRectScale=e.width/this._domNode.offsetWidth}}get clientRectDeltaLeft(){return this._clientRectRead||this.readClientRect(),this._clientRectDeltaLeft}get clientRectScale(){return this._clientRectRead||this.readClientRect(),this._clientRectScale}constructor(e,t){this._domNode=e,this.endNode=t,this._didDomLayout=!1,this._clientRectDeltaLeft=0,this._clientRectScale=1,this._clientRectRead=!1}markDidDomLayout(){this._didDomLayout=!0}}class ViewLineOptions{constructor(e,t){this.themeType=t;const s=e.options,o=s.get(59);this.renderWhitespace=s.get(113),this.experimentalWhitespaceRendering=s.get(47),this.renderControlCharacters=s.get(108),this.spaceWidth=o.spaceWidth,this.middotWidth=o.middotWidth,this.wsmiddotWidth=o.wsmiddotWidth,this.useMonospaceOptimizations=o.isMonospace&&!s.get(40),this.canUseHalfwidthRightwardsArrow=o.canUseHalfwidthRightwardsArrow,this.lineHeight=s.get(75),this.stopRenderingLineAfter=s.get(133),this.fontLigatures=s.get(60),this.verticalScrollbarSize=s.get(117).verticalScrollbarSize,this.useGpu=s.get(46)==="on"}equals(e){return this.themeType===e.themeType&&this.renderWhitespace===e.renderWhitespace&&this.experimentalWhitespaceRendering===e.experimentalWhitespaceRendering&&this.renderControlCharacters===e.renderControlCharacters&&this.spaceWidth===e.spaceWidth&&this.middotWidth===e.middotWidth&&this.wsmiddotWidth===e.wsmiddotWidth&&this.useMonospaceOptimizations===e.useMonospaceOptimizations&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.lineHeight===e.lineHeight&&this.stopRenderingLineAfter===e.stopRenderingLineAfter&&this.fontLigatures===e.fontLigatures&&this.verticalScrollbarSize===e.verticalScrollbarSize&&this.useGpu===e.useGpu}}class LastRenderedData{constructor(){this._currentVisibleRange=new Range$2(1,1,1,1)}getCurrentVisibleRange(){return this._currentVisibleRange}setCurrentVisibleRange(e){this._currentVisibleRange=e}}class HorizontalRevealRangeRequest{constructor(e,t,s,o,r,l,c){this.minimalReveal=e,this.lineNumber=t,this.startColumn=s,this.endColumn=o,this.startScrollTop=r,this.stopScrollTop=l,this.scrollType=c,this.type="range",this.minLineNumber=t,this.maxLineNumber=t}}class HorizontalRevealSelectionsRequest{constructor(e,t,s,o,r){this.minimalReveal=e,this.selections=t,this.startScrollTop=s,this.stopScrollTop=o,this.scrollType=r,this.type="selections";let l=t[0].startLineNumber,c=t[0].endLineNumber;for(let d=1,u=t.length;d<u;d++){const g=t[d];l=Math.min(l,g.startLineNumber),c=Math.max(c,g.endLineNumber)}this.minLineNumber=l,this.maxLineNumber=c}}const ds=class ds extends ViewPart{constructor(e,t,s){super(e);const o=this._context.configuration,r=this._context.configuration.options,l=r.get(59),c=r.get(166);this._lineHeight=r.get(75),this._typicalHalfwidthCharacterWidth=l.typicalHalfwidthCharacterWidth,this._isViewportWrapping=c.isViewportWrapping,this._revealHorizontalRightPadding=r.get(114),this._cursorSurroundingLines=r.get(35),this._cursorSurroundingLinesStyle=r.get(36),this._canUseLayerHinting=!r.get(39),this._viewLineOptions=new ViewLineOptions(o,this._context.theme.type),this._linesContent=s,this._textRangeRestingSpot=document.createElement("div"),this._visibleLines=new VisibleLinesCollection(this._context,{createLine:()=>new ViewLine(t,this._viewLineOptions)}),this.domNode=this._visibleLines.domNode,PartFingerprints.write(this.domNode,8),this.domNode.setClassName(`view-lines ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`),applyFontInfo(this.domNode,l),this._maxLineWidth=0,this._asyncUpdateLineWidths=new RunOnceScheduler(()=>{this._updateLineWidthsSlow()},200),this._asyncCheckMonospaceFontAssumptions=new RunOnceScheduler(()=>{this._checkMonospaceFontAssumptions()},2e3),this._lastRenderedData=new LastRenderedData,this._horizontalRevealRequest=null,this._stickyScrollEnabled=r.get(131).enabled,this._maxNumberStickyLines=r.get(131).maxLineCount}dispose(){this._asyncUpdateLineWidths.dispose(),this._asyncCheckMonospaceFontAssumptions.dispose(),super.dispose()}getDomNode(){return this.domNode}onConfigurationChanged(e){this._visibleLines.onConfigurationChanged(e),e.hasChanged(166)&&(this._maxLineWidth=0);const t=this._context.configuration.options,s=t.get(59),o=t.get(166);return this._lineHeight=t.get(75),this._typicalHalfwidthCharacterWidth=s.typicalHalfwidthCharacterWidth,this._isViewportWrapping=o.isViewportWrapping,this._revealHorizontalRightPadding=t.get(114),this._cursorSurroundingLines=t.get(35),this._cursorSurroundingLinesStyle=t.get(36),this._canUseLayerHinting=!t.get(39),this._stickyScrollEnabled=t.get(131).enabled,this._maxNumberStickyLines=t.get(131).maxLineCount,applyFontInfo(this.domNode,s),this._onOptionsMaybeChanged(),e.hasChanged(165)&&(this._maxLineWidth=0),!0}_onOptionsMaybeChanged(){const e=this._context.configuration,t=new ViewLineOptions(e,this._context.theme.type);if(!this._viewLineOptions.equals(t)){this._viewLineOptions=t;const s=this._visibleLines.getStartLineNumber(),o=this._visibleLines.getEndLineNumber();for(let r=s;r<=o;r++)this._visibleLines.getVisibleLine(r).onOptionsChanged(this._viewLineOptions);return!0}return!1}onCursorStateChanged(e){const t=this._visibleLines.getStartLineNumber(),s=this._visibleLines.getEndLineNumber();let o=!1;for(let r=t;r<=s;r++)o=this._visibleLines.getVisibleLine(r).onSelectionChanged()||o;return o}onDecorationsChanged(e){{const t=this._visibleLines.getStartLineNumber(),s=this._visibleLines.getEndLineNumber();for(let o=t;o<=s;o++)this._visibleLines.getVisibleLine(o).onDecorationsChanged()}return!0}onFlushed(e){const t=this._visibleLines.onFlushed(e,this._viewLineOptions.useGpu);return this._maxLineWidth=0,t}onLinesChanged(e){return this._visibleLines.onLinesChanged(e)}onLinesDeleted(e){return this._visibleLines.onLinesDeleted(e)}onLinesInserted(e){return this._visibleLines.onLinesInserted(e)}onRevealRangeRequest(e){const t=this._computeScrollTopToRevealRange(this._context.viewLayout.getFutureViewport(),e.source,e.minimalReveal,e.range,e.selections,e.verticalType);if(t===-1)return!1;let s=this._context.viewLayout.validateScrollPosition({scrollTop:t});e.revealHorizontal?e.range&&e.range.startLineNumber!==e.range.endLineNumber?s={scrollTop:s.scrollTop,scrollLeft:0}:e.range?this._horizontalRevealRequest=new HorizontalRevealRangeRequest(e.minimalReveal,e.range.startLineNumber,e.range.startColumn,e.range.endColumn,this._context.viewLayout.getCurrentScrollTop(),s.scrollTop,e.scrollType):e.selections&&e.selections.length>0&&(this._horizontalRevealRequest=new HorizontalRevealSelectionsRequest(e.minimalReveal,e.selections,this._context.viewLayout.getCurrentScrollTop(),s.scrollTop,e.scrollType)):this._horizontalRevealRequest=null;const r=Math.abs(this._context.viewLayout.getCurrentScrollTop()-s.scrollTop)<=this._lineHeight?1:e.scrollType;return this._context.viewModel.viewLayout.setScrollPosition(s,r),!0}onScrollChanged(e){if(this._horizontalRevealRequest&&e.scrollLeftChanged&&(this._horizontalRevealRequest=null),this._horizontalRevealRequest&&e.scrollTopChanged){const t=Math.min(this._horizontalRevealRequest.startScrollTop,this._horizontalRevealRequest.stopScrollTop),s=Math.max(this._horizontalRevealRequest.startScrollTop,this._horizontalRevealRequest.stopScrollTop);(e.scrollTop<t||e.scrollTop>s)&&(this._horizontalRevealRequest=null)}return this.domNode.setWidth(e.scrollWidth),this._visibleLines.onScrollChanged(e)||!0}onTokensChanged(e){return this._visibleLines.onTokensChanged(e)}onZonesChanged(e){return this._context.viewModel.viewLayout.setMaxLineWidth(this._maxLineWidth),this._visibleLines.onZonesChanged(e)}onThemeChanged(e){return this._onOptionsMaybeChanged()}getPositionFromDOMInfo(e,t){const s=this._getViewLineDomNode(e);if(s===null)return null;const o=this._getLineNumberFor(s);if(o===-1||o<1||o>this._context.viewModel.getLineCount())return null;if(this._context.viewModel.getLineMaxColumn(o)===1)return new Position$1(o,1);const r=this._visibleLines.getStartLineNumber(),l=this._visibleLines.getEndLineNumber();if(o<r||o>l)return null;let c=this._visibleLines.getVisibleLine(o).getColumnOfNodeOffset(e,t);const d=this._context.viewModel.getLineMinColumn(o);return c<d&&(c=d),new Position$1(o,c)}_getViewLineDomNode(e){for(;e&&e.nodeType===1;){if(e.className===ViewLine.CLASS_NAME)return e;e=e.parentElement}return null}_getLineNumberFor(e){const t=this._visibleLines.getStartLineNumber(),s=this._visibleLines.getEndLineNumber();for(let o=t;o<=s;o++){const r=this._visibleLines.getVisibleLine(o);if(e===r.getDomNode())return o}return-1}getLineWidth(e){const t=this._visibleLines.getStartLineNumber(),s=this._visibleLines.getEndLineNumber();if(e<t||e>s)return-1;const o=new DomReadingContext(this.domNode.domNode,this._textRangeRestingSpot),r=this._visibleLines.getVisibleLine(e).getWidth(o);return this._updateLineWidthsSlowIfDomDidLayout(o),r}linesVisibleRangesForRange(e,t){if(this.shouldRender())return null;const s=e.endLineNumber,o=Range$2.intersectRanges(e,this._lastRenderedData.getCurrentVisibleRange());if(!o)return null;const r=[];let l=0;const c=new DomReadingContext(this.domNode.domNode,this._textRangeRestingSpot);let d=0;t&&(d=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new Position$1(o.startLineNumber,1)).lineNumber);const u=this._visibleLines.getStartLineNumber(),g=this._visibleLines.getEndLineNumber();for(let f=o.startLineNumber;f<=o.endLineNumber;f++){if(f<u||f>g)continue;const p=f===o.startLineNumber?o.startColumn:1,m=f!==s,_=m?this._context.viewModel.getLineMaxColumn(f):o.endColumn,b=this._visibleLines.getVisibleLine(f).getVisibleRangesForRange(f,p,_,c);if(b){if(t&&f<s){const v=d;if(d=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new Position$1(f+1,1)).lineNumber,v!==d){const S=b.ranges[b.ranges.length-1];S.width+=this._typicalHalfwidthCharacterWidth,this._context.viewModel.getTextDirection(v)===TextDirection$1.RTL&&(S.left-=this._typicalHalfwidthCharacterWidth)}}r[l++]=new LineVisibleRanges(b.outsideRenderedLine,f,HorizontalRange.from(b.ranges),m)}}return this._updateLineWidthsSlowIfDomDidLayout(c),l===0?null:r}_visibleRangesForLineRange(e,t,s){if(this.shouldRender()||e<this._visibleLines.getStartLineNumber()||e>this._visibleLines.getEndLineNumber())return null;const o=new DomReadingContext(this.domNode.domNode,this._textRangeRestingSpot),r=this._visibleLines.getVisibleLine(e).getVisibleRangesForRange(e,t,s,o);return this._updateLineWidthsSlowIfDomDidLayout(o),r}_lineIsRenderedRTL(e){return e<this._visibleLines.getStartLineNumber()||e>this._visibleLines.getEndLineNumber()?!1:this._visibleLines.getVisibleLine(e).isRenderedRTL()}visibleRangeForPosition(e){const t=this._visibleRangesForLineRange(e.lineNumber,e.column,e.column);return t?new HorizontalPosition(t.outsideRenderedLine,t.ranges[0].left):null}_updateLineWidthsFast(){return this._updateLineWidths(!0)}_updateLineWidthsSlow(){this._updateLineWidths(!1)}_updateLineWidthsSlowIfDomDidLayout(e){e.didDomLayout&&(this._asyncUpdateLineWidths.isScheduled()||(this._asyncUpdateLineWidths.cancel(),this._updateLineWidthsSlow()))}_updateLineWidths(e){const t=this._visibleLines.getStartLineNumber(),s=this._visibleLines.getEndLineNumber();let o=1,r=!0;for(let l=t;l<=s;l++){const c=this._visibleLines.getVisibleLine(l);if(e&&!c.getWidthIsFast()){r=!1;continue}o=Math.max(o,c.getWidth(null))}return r&&t===1&&s===this._context.viewModel.getLineCount()&&(this._maxLineWidth=0),this._ensureMaxLineWidth(o),r}_checkMonospaceFontAssumptions(){let e=-1,t=-1;const s=this._visibleLines.getStartLineNumber(),o=this._visibleLines.getEndLineNumber();for(let r=s;r<=o;r++){const l=this._visibleLines.getVisibleLine(r);if(l.needsMonospaceFontCheck()){const c=l.getWidth(null);c>t&&(t=c,e=r)}}if(e!==-1&&!this._visibleLines.getVisibleLine(e).monospaceAssumptionsAreValid())for(let r=s;r<=o;r++)this._visibleLines.getVisibleLine(r).onMonospaceAssumptionsInvalidated()}prepareRender(){throw new Error("Not supported")}render(){throw new Error("Not supported")}renderText(e){if(this._visibleLines.renderLines(e),this._lastRenderedData.setCurrentVisibleRange(e.visibleRange),this.domNode.setWidth(this._context.viewLayout.getScrollWidth()),this.domNode.setHeight(Math.min(this._context.viewLayout.getScrollHeight(),1e6)),this._horizontalRevealRequest){const s=this._horizontalRevealRequest;if(e.startLineNumber<=s.minLineNumber&&s.maxLineNumber<=e.endLineNumber){this._horizontalRevealRequest=null,this.onDidRender();const o=this._computeScrollLeftToReveal(s);o&&(!this._isViewportWrapping&&!o.hasRTL&&this._ensureMaxLineWidth(o.maxHorizontalOffset),this._context.viewModel.viewLayout.setScrollPosition({scrollLeft:o.scrollLeft},s.scrollType))}}if(this._updateLineWidthsFast()?this._asyncUpdateLineWidths.cancel():this._asyncUpdateLineWidths.schedule(),isLinux&&!this._asyncCheckMonospaceFontAssumptions.isScheduled()){const s=this._visibleLines.getStartLineNumber(),o=this._visibleLines.getEndLineNumber();for(let r=s;r<=o;r++)if(this._visibleLines.getVisibleLine(r).needsMonospaceFontCheck()){this._asyncCheckMonospaceFontAssumptions.schedule();break}}this._linesContent.setLayerHinting(this._canUseLayerHinting),this._linesContent.setContain("strict");const t=this._context.viewLayout.getCurrentScrollTop()-e.bigNumbersDelta;this._linesContent.setTop(-t),this._linesContent.setLeft(-this._context.viewLayout.getCurrentScrollLeft())}_ensureMaxLineWidth(e){const t=Math.ceil(e);this._maxLineWidth<t&&(this._maxLineWidth=t,this._context.viewModel.viewLayout.setMaxLineWidth(this._maxLineWidth))}_computeScrollTopToRevealRange(e,t,s,o,r,l){const c=e.top,d=e.height,u=c+d;let g,f,p;if(r&&r.length>0){let v=r[0].startLineNumber,S=r[0].endLineNumber;for(let y=1,w=r.length;y<w;y++){const L=r[y];v=Math.min(v,L.startLineNumber),S=Math.max(S,L.endLineNumber)}g=!1,f=this._context.viewLayout.getVerticalOffsetForLineNumber(v),p=this._context.viewLayout.getVerticalOffsetForLineNumber(S)+this._lineHeight}else if(o)g=!0,f=this._context.viewLayout.getVerticalOffsetForLineNumber(o.startLineNumber),p=this._context.viewLayout.getVerticalOffsetForLineNumber(o.endLineNumber)+this._lineHeight;else return-1;const m=(t==="mouse"||s)&&this._cursorSurroundingLinesStyle==="default";let _=0,C=0;if(m)s||(_=this._lineHeight);else{const v=d/this._lineHeight,S=Math.max(this._cursorSurroundingLines,this._stickyScrollEnabled?this._maxNumberStickyLines:0),y=Math.min(v/2,S);_=y*this._lineHeight,C=Math.max(0,y-1)*this._lineHeight}s||(l===0||l===4)&&(C+=this._lineHeight),f-=_,p+=C;let b;if(p-f>d){if(!g)return-1;b=f}else if(l===5||l===6)if(l===6&&c<=f&&p<=u)b=c;else{const v=Math.max(5*this._lineHeight,d*.2),S=f-v,y=p-d;b=Math.max(y,S)}else if(l===1||l===2)if(l===2&&c<=f&&p<=u)b=c;else{const v=(f+p)/2;b=Math.max(0,v-d/2)}else b=this._computeMinimumScrolling(c,u,f,p,l===3,l===4);return b}_computeScrollLeftToReveal(e){const t=this._context.viewLayout.getCurrentViewport(),s=this._context.configuration.options.get(165),o=t.left,r=o+t.width-s.verticalScrollbarWidth;let l=1073741824,c=0,d=!1;if(e.type==="range"){d=this._lineIsRenderedRTL(e.lineNumber);const g=this._visibleRangesForLineRange(e.lineNumber,e.startColumn,e.endColumn);if(!g)return null;for(const f of g.ranges)l=Math.min(l,Math.round(f.left)),c=Math.max(c,Math.round(f.left+f.width))}else for(const g of e.selections){if(g.startLineNumber!==g.endLineNumber)return null;const f=this._visibleRangesForLineRange(g.startLineNumber,g.startColumn,g.endColumn);if(d||(d=this._lineIsRenderedRTL(g.startLineNumber)),!f)return null;for(const p of f.ranges)l=Math.min(l,Math.round(p.left)),c=Math.max(c,Math.round(p.left+p.width))}return e.minimalReveal||(l=Math.max(0,l-ds.HORIZONTAL_EXTRA_PX),c+=this._revealHorizontalRightPadding),e.type==="selections"&&c-l>t.width?null:{scrollLeft:this._computeMinimumScrolling(o,r,l,c),maxHorizontalOffset:c,hasRTL:d}}_computeMinimumScrolling(e,t,s,o,r,l){e=e|0,t=t|0,s=s|0,o=o|0,r=!!r,l=!!l;const c=t-e;if(o-s<c){if(r)return s;if(l)return Math.max(0,o-c);if(s<e)return s;if(o>t)return Math.max(0,o-c)}else return s;return e}};ds.HORIZONTAL_EXTRA_PX=30;let ViewLines=ds;const linesDecorations="";class LinesDecorationsOverlay extends DedupOverlay{constructor(e){super(),this._context=e;const s=this._context.configuration.options.get(165);this._decorationsLeft=s.decorationsLeft,this._decorationsWidth=s.decorationsWidth,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const s=this._context.configuration.options.get(165);return this._decorationsLeft=s.decorationsLeft,this._decorationsWidth=s.decorationsWidth,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_getDecorations(e){const t=e.getDecorationsInViewport(),s=[];let o=0;for(let r=0,l=t.length;r<l;r++){const c=t[r],d=c.options.linesDecorationsClassName,u=c.options.zIndex;d&&(s[o++]=new DecorationToRender(c.range.startLineNumber,c.range.endLineNumber,d,c.options.linesDecorationsTooltip??null,u));const g=c.options.firstLineDecorationClassName;g&&(s[o++]=new DecorationToRender(c.range.startLineNumber,c.range.startLineNumber,g,c.options.linesDecorationsTooltip??null,u))}return s}prepareRender(e){const t=e.visibleRange.startLineNumber,s=e.visibleRange.endLineNumber,o=this._render(t,s,this._getDecorations(e)),r=this._decorationsLeft.toString(),l=this._decorationsWidth.toString(),c='" style="left:'+r+"px;width:"+l+'px;"></div>',d=[];for(let u=t;u<=s;u++){const g=u-t,f=o[g].getDecorations();let p="";for(const m of f){let _='<div class="cldr '+m.className;m.tooltip!==null&&(_+='" title="'+m.tooltip),_+=c,p+=_}d[g]=p}this._renderResult=d}render(e,t){return this._renderResult?this._renderResult[t-e]:""}}const margin="",ii=class ii extends ViewPart{constructor(e){super(e);const t=this._context.configuration.options,s=t.get(165);this._canUseLayerHinting=!t.get(39),this._contentLeft=s.contentLeft,this._glyphMarginLeft=s.glyphMarginLeft,this._glyphMarginWidth=s.glyphMarginWidth,this._domNode=createFastDomNode(document.createElement("div")),this._domNode.setClassName(ii.OUTER_CLASS_NAME),this._domNode.setPosition("absolute"),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._glyphMarginBackgroundDomNode=createFastDomNode(document.createElement("div")),this._glyphMarginBackgroundDomNode.setClassName(ii.CLASS_NAME),this._domNode.appendChild(this._glyphMarginBackgroundDomNode)}dispose(){super.dispose()}getDomNode(){return this._domNode}onConfigurationChanged(e){const t=this._context.configuration.options,s=t.get(165);return this._canUseLayerHinting=!t.get(39),this._contentLeft=s.contentLeft,this._glyphMarginLeft=s.glyphMarginLeft,this._glyphMarginWidth=s.glyphMarginWidth,!0}onScrollChanged(e){return super.onScrollChanged(e)||e.scrollTopChanged}prepareRender(e){}render(e){this._domNode.setLayerHinting(this._canUseLayerHinting),this._domNode.setContain("strict");const t=e.scrollTop-e.bigNumbersDelta;this._domNode.setTop(-t);const s=Math.min(e.scrollHeight,1e6);this._domNode.setHeight(s),this._domNode.setWidth(this._contentLeft),this._glyphMarginBackgroundDomNode.setLeft(this._glyphMarginLeft),this._glyphMarginBackgroundDomNode.setWidth(this._glyphMarginWidth),this._glyphMarginBackgroundDomNode.setHeight(s)}};ii.CLASS_NAME="glyph-margin",ii.OUTER_CLASS_NAME="margin";let Margin=ii;const marginDecorations="";class MarginViewLineDecorationsOverlay extends DedupOverlay{constructor(e){super(),this._context=e,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){return!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_getDecorations(e){const t=e.getDecorationsInViewport(),s=[];let o=0;for(let r=0,l=t.length;r<l;r++){const c=t[r],d=c.options.marginClassName,u=c.options.zIndex;d&&(s[o++]=new DecorationToRender(c.range.startLineNumber,c.range.endLineNumber,d,null,u))}return s}prepareRender(e){const t=e.visibleRange.startLineNumber,s=e.visibleRange.endLineNumber,o=this._render(t,s,this._getDecorations(e)),r=[];for(let l=t;l<=s;l++){const c=l-t,d=o[c].getDecorations();let u="";for(const g of d)u+='<div class="cmdr '+g.className+'" style=""></div>';r[c]=u}this._renderResult=r}render(e,t){return this._renderResult?this._renderResult[t-e]:""}}const minimap="",Je=class Je{constructor(e,t,s,o){this._rgba8Brand=void 0,this.r=Je._clamp(e),this.g=Je._clamp(t),this.b=Je._clamp(s),this.a=Je._clamp(o)}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}static _clamp(e){return e<0?0:e>255?255:e|0}};Je.Empty=new Je(0,0,0,0);let RGBA8=Je,TokenizationRegistry$1=class{constructor(){this._tokenizationSupports=new Map,this._factories=new Map,this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._colorMap=null}handleChange(e){this._onDidChange.fire({changedLanguages:e,changedColorMap:!1})}register(e,t){return this._tokenizationSupports.set(e,t),this.handleChange([e]),toDisposable(()=>{this._tokenizationSupports.get(e)===t&&(this._tokenizationSupports.delete(e),this.handleChange([e]))})}get(e){return this._tokenizationSupports.get(e)||null}registerFactory(e,t){var o;(o=this._factories.get(e))==null||o.dispose();const s=new TokenizationSupportFactoryData(this,e,t);return this._factories.set(e,s),toDisposable(()=>{const r=this._factories.get(e);!r||r!==s||(this._factories.delete(e),r.dispose())})}async getOrCreate(e){const t=this.get(e);if(t)return t;const s=this._factories.get(e);return!s||s.isResolved?null:(await s.resolve(),this.get(e))}isResolved(e){if(this.get(e))return!0;const s=this._factories.get(e);return!!(!s||s.isResolved)}setColorMap(e){this._colorMap=e,this._onDidChange.fire({changedLanguages:Array.from(this._tokenizationSupports.keys()),changedColorMap:!0})}getColorMap(){return this._colorMap}getDefaultBackground(){return this._colorMap&&this._colorMap.length>2?this._colorMap[2]:null}};class TokenizationSupportFactoryData extends Disposable{get isResolved(){return this._isResolved}constructor(e,t,s){super(),this._registry=e,this._languageId=t,this._factory=s,this._isDisposed=!1,this._resolvePromise=null,this._isResolved=!1}dispose(){this._isDisposed=!0,super.dispose()}async resolve(){return this._resolvePromise||(this._resolvePromise=this._create()),this._resolvePromise}async _create(){const e=await this._factory.tokenizationSupport;this._isResolved=!0,e&&!this._isDisposed&&this._register(this._registry.register(this._languageId,e))}}let Token$2=class{constructor(e,t,s){this.offset=e,this.type=t,this.language=s,this._tokenBrand=void 0}toString(){return"("+this.offset+", "+this.type+")"}};class TokenizationResult{constructor(e,t){this.tokens=e,this.endState=t,this._tokenizationResultBrand=void 0}}class EncodedTokenizationResult{constructor(e,t){this.tokens=e,this.endState=t,this._encodedTokenizationResultBrand=void 0}}var HoverVerbosityAction$1;(function(a){a[a.Increase=0]="Increase",a[a.Decrease=1]="Decrease"})(HoverVerbosityAction$1||(HoverVerbosityAction$1={}));var CompletionItemKinds;(function(a){const e=new Map;e.set(0,Codicon.symbolMethod),e.set(1,Codicon.symbolFunction),e.set(2,Codicon.symbolConstructor),e.set(3,Codicon.symbolField),e.set(4,Codicon.symbolVariable),e.set(5,Codicon.symbolClass),e.set(6,Codicon.symbolStruct),e.set(7,Codicon.symbolInterface),e.set(8,Codicon.symbolModule),e.set(9,Codicon.symbolProperty),e.set(10,Codicon.symbolEvent),e.set(11,Codicon.symbolOperator),e.set(12,Codicon.symbolUnit),e.set(13,Codicon.symbolValue),e.set(15,Codicon.symbolEnum),e.set(14,Codicon.symbolConstant),e.set(15,Codicon.symbolEnum),e.set(16,Codicon.symbolEnumMember),e.set(17,Codicon.symbolKeyword),e.set(28,Codicon.symbolSnippet),e.set(18,Codicon.symbolText),e.set(19,Codicon.symbolColor),e.set(20,Codicon.symbolFile),e.set(21,Codicon.symbolReference),e.set(22,Codicon.symbolCustomColor),e.set(23,Codicon.symbolFolder),e.set(24,Codicon.symbolTypeParameter),e.set(25,Codicon.account),e.set(26,Codicon.issues),e.set(27,Codicon.tools);function t(l){let c=e.get(l);return c||(console.info("No codicon found for CompletionItemKind "+l),c=Codicon.symbolProperty),c}a.toIcon=t;function s(l){switch(l){case 0:return localize(724,"Method");case 1:return localize(725,"Function");case 2:return localize(726,"Constructor");case 3:return localize(727,"Field");case 4:return localize(728,"Variable");case 5:return localize(729,"Class");case 6:return localize(730,"Struct");case 7:return localize(731,"Interface");case 8:return localize(732,"Module");case 9:return localize(733,"Property");case 10:return localize(734,"Event");case 11:return localize(735,"Operator");case 12:return localize(736,"Unit");case 13:return localize(737,"Value");case 14:return localize(738,"Constant");case 15:return localize(739,"Enum");case 16:return localize(740,"Enum Member");case 17:return localize(741,"Keyword");case 18:return localize(742,"Text");case 19:return localize(743,"Color");case 20:return localize(744,"File");case 21:return localize(745,"Reference");case 22:return localize(746,"Custom Color");case 23:return localize(747,"Folder");case 24:return localize(748,"Type Parameter");case 25:return localize(749,"User");case 26:return localize(750,"Issue");case 27:return localize(751,"Tool");case 28:return localize(752,"Snippet");default:return""}}a.toLabel=s;const o=new Map;o.set("method",0),o.set("function",1),o.set("constructor",2),o.set("field",3),o.set("variable",4),o.set("class",5),o.set("struct",6),o.set("interface",7),o.set("module",8),o.set("property",9),o.set("event",10),o.set("operator",11),o.set("unit",12),o.set("value",13),o.set("constant",14),o.set("enum",15),o.set("enum-member",16),o.set("enumMember",16),o.set("keyword",17),o.set("snippet",28),o.set("text",18),o.set("color",19),o.set("file",20),o.set("reference",21),o.set("customcolor",22),o.set("folder",23),o.set("type-parameter",24),o.set("typeParameter",24),o.set("account",25),o.set("issue",26),o.set("tool",27);function r(l,c){let d=o.get(l);return typeof d>"u"&&!c&&(d=9),d}a.fromString=r})(CompletionItemKinds||(CompletionItemKinds={}));var InlineCompletionTriggerKind$1;(function(a){a[a.Automatic=0]="Automatic",a[a.Explicit=1]="Explicit"})(InlineCompletionTriggerKind$1||(InlineCompletionTriggerKind$1={}));class SelectedSuggestionInfo{constructor(e,t,s,o){this.range=e,this.text=t,this.completionKind=s,this.isSnippetText=o}equals(e){return Range$2.lift(this.range).equalsRange(e.range)&&this.text===e.text&&this.completionKind===e.completionKind&&this.isSnippetText===e.isSnippetText}}var InlineCompletionDisplayLocationKind$1;(function(a){a[a.Code=1]="Code",a[a.Label=2]="Label"})(InlineCompletionDisplayLocationKind$1||(InlineCompletionDisplayLocationKind$1={}));class ProviderId{static fromExtensionId(e){return new ProviderId(e,void 0,void 0)}constructor(e,t,s){this.extensionId=e,this.extensionVersion=t,this.providerId=s}toString(){let e="";return this.extensionId&&(e+=this.extensionId),this.extensionVersion&&(e+=`@${this.extensionVersion}`),this.providerId&&(e+=`:${this.providerId}`),e.length===0&&(e="unknown"),e}}var InlineCompletionEndOfLifeReasonKind$1;(function(a){a[a.Accepted=0]="Accepted",a[a.Rejected=1]="Rejected",a[a.Ignored=2]="Ignored"})(InlineCompletionEndOfLifeReasonKind$1||(InlineCompletionEndOfLifeReasonKind$1={}));var DocumentPasteTriggerKind;(function(a){a[a.Automatic=0]="Automatic",a[a.PasteAs=1]="PasteAs"})(DocumentPasteTriggerKind||(DocumentPasteTriggerKind={}));var SignatureHelpTriggerKind$1;(function(a){a[a.Invoke=1]="Invoke",a[a.TriggerCharacter=2]="TriggerCharacter",a[a.ContentChange=3]="ContentChange"})(SignatureHelpTriggerKind$1||(SignatureHelpTriggerKind$1={}));var DocumentHighlightKind$1;(function(a){a[a.Text=0]="Text",a[a.Read=1]="Read",a[a.Write=2]="Write"})(DocumentHighlightKind$1||(DocumentHighlightKind$1={}));function isLocationLink(a){return a&&URI.isUri(a.uri)&&Range$2.isIRange(a.range)&&(Range$2.isIRange(a.originSelectionRange)||Range$2.isIRange(a.targetSelectionRange))}localize(753,"array"),localize(754,"boolean"),localize(755,"class"),localize(756,"constant"),localize(757,"constructor"),localize(758,"enumeration"),localize(759,"enumeration member"),localize(760,"event"),localize(761,"field"),localize(762,"file"),localize(763,"function"),localize(764,"interface"),localize(765,"key"),localize(766,"method"),localize(767,"module"),localize(768,"namespace"),localize(769,"null"),localize(770,"number"),localize(771,"object"),localize(772,"operator"),localize(773,"package"),localize(774,"property"),localize(775,"string"),localize(776,"struct"),localize(777,"type parameter"),localize(778,"variable");var SymbolKinds;(function(a){const e=new Map;e.set(0,Codicon.symbolFile),e.set(1,Codicon.symbolModule),e.set(2,Codicon.symbolNamespace),e.set(3,Codicon.symbolPackage),e.set(4,Codicon.symbolClass),e.set(5,Codicon.symbolMethod),e.set(6,Codicon.symbolProperty),e.set(7,Codicon.symbolField),e.set(8,Codicon.symbolConstructor),e.set(9,Codicon.symbolEnum),e.set(10,Codicon.symbolInterface),e.set(11,Codicon.symbolFunction),e.set(12,Codicon.symbolVariable),e.set(13,Codicon.symbolConstant),e.set(14,Codicon.symbolString),e.set(15,Codicon.symbolNumber),e.set(16,Codicon.symbolBoolean),e.set(17,Codicon.symbolArray),e.set(18,Codicon.symbolObject),e.set(19,Codicon.symbolKey),e.set(20,Codicon.symbolNull),e.set(21,Codicon.symbolEnumMember),e.set(22,Codicon.symbolStruct),e.set(23,Codicon.symbolEvent),e.set(24,Codicon.symbolOperator),e.set(25,Codicon.symbolTypeParameter);function t(r){let l=e.get(r);return l||(console.info("No codicon found for SymbolKind "+r),l=Codicon.symbolProperty),l}a.toIcon=t;const s=new Map;s.set(0,20),s.set(1,8),s.set(2,8),s.set(3,8),s.set(4,5),s.set(5,0),s.set(6,9),s.set(7,3),s.set(8,2),s.set(9,15),s.set(10,7),s.set(11,1),s.set(12,4),s.set(13,14),s.set(14,18),s.set(15,13),s.set(16,13),s.set(17,13),s.set(18,13),s.set(19,17),s.set(20,13),s.set(21,16),s.set(22,6),s.set(23,10),s.set(24,11),s.set(25,24);function o(r){let l=s.get(r);return l===void 0&&(console.info("No completion kind found for SymbolKind "+r),l=20),l}a.toCompletionKind=o})(SymbolKinds||(SymbolKinds={}));const De=class De{static fromValue(e){switch(e){case"comment":return De.Comment;case"imports":return De.Imports;case"region":return De.Region}return new De(e)}constructor(e){this.value=e}};De.Comment=new De("comment"),De.Imports=new De("imports"),De.Region=new De("region");let FoldingRangeKind=De;var NewSymbolNameTag$1;(function(a){a[a.AIGenerated=1]="AIGenerated"})(NewSymbolNameTag$1||(NewSymbolNameTag$1={}));var NewSymbolNameTriggerKind$1;(function(a){a[a.Invoke=0]="Invoke",a[a.Automatic=1]="Automatic"})(NewSymbolNameTriggerKind$1||(NewSymbolNameTriggerKind$1={}));var Command;(function(a){function e(t){return!t||typeof t!="object"?!1:typeof t.id=="string"&&typeof t.title=="string"}a.is=e})(Command||(Command={}));var InlayHintKind$1;(function(a){a[a.Type=1]="Type",a[a.Parameter=2]="Parameter"})(InlayHintKind$1||(InlayHintKind$1={}));class LazyTokenizationSupport{constructor(e){this.createSupport=e,this._tokenizationSupport=null}dispose(){this._tokenizationSupport&&this._tokenizationSupport.then(e=>{e&&e.dispose()})}get tokenizationSupport(){return this._tokenizationSupport||(this._tokenizationSupport=this.createSupport()),this._tokenizationSupport}}const TokenizationRegistry=new TokenizationRegistry$1,hs=class hs extends Disposable{static getInstance(){return this._INSTANCE||(this._INSTANCE=new hs),this._INSTANCE}constructor(){super(),this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._updateColorMap(),this._register(TokenizationRegistry.onDidChange(e=>{e.changedColorMap&&this._updateColorMap()}))}_updateColorMap(){const e=TokenizationRegistry.getColorMap();if(!e){this._colors=[RGBA8.Empty],this._backgroundIsLight=!0;return}this._colors=[RGBA8.Empty];for(let s=1;s<e.length;s++){const o=e[s].rgba;this._colors[s]=new RGBA8(o.r,o.g,o.b,Math.round(o.a*255))}const t=e[2].getRelativeLuminance();this._backgroundIsLight=t>=.5,this._onDidChange.fire(void 0)}getColor(e){return(e<1||e>=this._colors.length)&&(e=2),this._colors[e]}backgroundIsLight(){return this._backgroundIsLight}};hs._INSTANCE=null;let MinimapTokensColorTracker=hs;const allCharCodes=(()=>{const a=[];for(let e=32;e<=126;e++)a.push(e);return a.push(65533),a})(),getCharIndex=(a,e)=>(a-=32,a<0||a>96?e<=2?(a+96)%96:96-1:a);class MinimapCharRenderer{constructor(e,t){this.scale=t,this._minimapCharRendererBrand=void 0,this.charDataNormal=MinimapCharRenderer.soften(e,12/15),this.charDataLight=MinimapCharRenderer.soften(e,50/60)}static soften(e,t){const s=new Uint8ClampedArray(e.length);for(let o=0,r=e.length;o<r;o++)s[o]=toUint8(e[o]*t);return s}renderChar(e,t,s,o,r,l,c,d,u,g,f){const p=1*this.scale,m=2*this.scale,_=f?1:m;if(t+p>e.width||s+_>e.height){console.warn("bad render request outside image data");return}const C=g?this.charDataLight:this.charDataNormal,b=getCharIndex(o,u),v=e.width*4,S=c.r,y=c.g,w=c.b,L=r.r-S,x=r.g-y,E=r.b-w,I=Math.max(l,d),D=e.data;let k=b*p*m,N=s*v+t*4;for(let R=0;R<_;R++){let M=N;for(let A=0;A<p;A++){const O=C[k++]/255*(l/255);D[M++]=S+L*O,D[M++]=y+x*O,D[M++]=w+E*O,D[M++]=I}N+=v}}blockRenderChar(e,t,s,o,r,l,c,d){const u=1*this.scale,g=2*this.scale,f=d?1:g;if(t+u>e.width||s+f>e.height){console.warn("bad render request outside image data");return}const p=e.width*4,m=.5*(r/255),_=l.r,C=l.g,b=l.b,v=o.r-_,S=o.g-C,y=o.b-b,w=_+v*m,L=C+S*m,x=b+y*m,E=Math.max(r,c),I=e.data;let D=s*p+t*4;for(let k=0;k<f;k++){let N=D;for(let R=0;R<u;R++)I[N++]=w,I[N++]=L,I[N++]=x,I[N++]=E;D+=p}}}const charTable={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15},decodeData=a=>{const e=new Uint8ClampedArray(a.length/2);for(let t=0;t<a.length;t+=2)e[t>>1]=charTable[a[t]]<<4|charTable[a[t+1]]&15;return e},prebakedMiniMaps={1:createSingleCallFunction(()=>decodeData("0000511D6300CF609C709645A78432005642574171487021003C451900274D35D762755E8B629C5BA856AF57BA649530C167D1512A272A3F6038604460398526BCA2A968DB6F8957C768BE5FBE2FB467CF5D8D5B795DC7625B5DFF50DE64C466DB2FC47CD860A65E9A2EB96CB54CE06DA763AB2EA26860524D3763536601005116008177A8705E53AB738E6A982F88BAA35B5F5B626D9C636B449B737E5B7B678598869A662F6B5B8542706C704C80736A607578685B70594A49715A4522E792")),2:createSingleCallFunction(()=>decodeData("000000000000000055394F383D2800008B8B1F210002000081B1CBCBCC820000847AAF6B9AAF2119BE08B8881AD60000A44FD07DCCF107015338130C00000000385972265F390B406E2437634B4B48031B12B8A0847000001E15B29A402F0000000000004B33460B00007A752C2A0000000000004D3900000084394B82013400ABA5CFC7AD9C0302A45A3E5A98AB000089A43382D97900008BA54AA087A70A0248A6A7AE6DBE0000BF6F94987EA40A01A06DCFA7A7A9030496C32F77891D0000A99FB1A0AFA80603B29AB9CA75930D010C0948354D3900000C0948354F37460D0028BE673D8400000000AF9D7B6E00002B007AA8933400007AA642675C2700007984CFB9C3985B768772A8A6B7B20000CAAECAAFC4B700009F94A6009F840009D09F9BA4CA9C0000CC8FC76DC87F0000C991C472A2000000A894A48CA7B501079BA2C9C69BA20000B19A5D3FA89000005CA6009DA2960901B0A7F0669FB200009D009E00B7890000DAD0F5D092820000D294D4C48BD10000B5A7A4A3B1A50402CAB6CBA6A2000000B5A7A4A3B1A8044FCDADD19D9CB00000B7778F7B8AAE0803C9AB5D3F5D3F00009EA09EA0BAB006039EA0989A8C7900009B9EF4D6B7C00000A9A7816CACA80000ABAC84705D3F000096DA635CDC8C00006F486F266F263D4784006124097B00374F6D2D6D2D6D4A3A95872322000000030000000000008D8939130000000000002E22A5C9CBC70600AB25C0B5C9B400061A2DB04CA67001082AA6BEBEBFC606002321DACBC19E03087AA08B6768380000282FBAC0B8CA7A88AD25BBA5A29900004C396C5894A6000040485A6E356E9442A32CD17EADA70000B4237923628600003E2DE9C1D7B500002F25BBA5A2990000231DB6AFB4A804023025C0B5CAB588062B2CBDBEC0C706882435A75CA20000002326BD6A82A908048B4B9A5A668000002423A09CB4BB060025259C9D8A7900001C1FCAB2C7C700002A2A9387ABA200002626A4A47D6E9D14333163A0C87500004B6F9C2D643A257049364936493647358A34438355497F1A0000A24C1D590000D38DFFBDD4CD3126"))};class MinimapCharRendererFactory{static create(e,t){if(this.lastCreated&&e===this.lastCreated.scale&&t===this.lastFontFamily)return this.lastCreated;let s;return prebakedMiniMaps[e]?s=new MinimapCharRenderer(prebakedMiniMaps[e](),e):s=MinimapCharRendererFactory.createFromSampleData(MinimapCharRendererFactory.createSampleData(t).data,e),this.lastFontFamily=t,this.lastCreated=s,s}static createSampleData(e){const t=document.createElement("canvas"),s=t.getContext("2d");t.style.height="16px",t.height=16,t.width=96*10,t.style.width=96*10+"px",s.fillStyle="#ffffff",s.font=`bold 16px ${e}`,s.textBaseline="middle";let o=0;for(const r of allCharCodes)s.fillText(String.fromCharCode(r),o,16/2),o+=10;return s.getImageData(0,0,96*10,16)}static createFromSampleData(e,t){if(e.length!==61440)throw new Error("Unexpected source in MinimapCharRenderer");const o=MinimapCharRendererFactory._downsample(e,t);return new MinimapCharRenderer(o,t)}static _downsampleChar(e,t,s,o,r){const l=1*r,c=2*r;let d=o,u=0;for(let g=0;g<c;g++){const f=g/c*16,p=(g+1)/c*16;for(let m=0;m<l;m++){const _=m/l*10,C=(m+1)/l*10;let b=0,v=0;for(let y=f;y<p;y++){const w=t+Math.floor(y)*3840,L=1-(y-Math.floor(y));for(let x=_;x<C;x++){const E=1-(x-Math.floor(x)),I=w+Math.floor(x)*4,D=E*L;v+=D,b+=e[I]*e[I+3]/255*D}}const S=b/v;u=Math.max(u,S),s[d++]=toUint8(S)}}return u}static _downsample(e,t){const s=2*t*1*t,o=s*96,r=new Uint8ClampedArray(o);let l=0,c=0,d=0;for(let u=0;u<96;u++)d=Math.max(d,this._downsampleChar(e,c,r,l,t)),l+=s,c+=10*4;if(d>0){const u=255/d;for(let g=0;g<o;g++)r[g]*=u}return r}}const DEFAULT_FONT_FAMILY=isWindows?'"Segoe WPC", "Segoe UI", sans-serif':isMacintosh?"-apple-system, BlinkMacSystemFont, sans-serif":'system-ui, "Ubuntu", "Droid Sans", sans-serif';class ViewModelDecoration{constructor(e,t){this._viewModelDecorationBrand=void 0,this.range=e,this.options=t}}function isModelDecorationVisible(a,e){return!(e.options.hideInCommentTokens&&isModelDecorationInComment(a,e)||e.options.hideInStringTokens&&isModelDecorationInString(a,e))}function isModelDecorationInComment(a,e){return testTokensInRange(a,e.range,t=>t===1)}function isModelDecorationInString(a,e){return testTokensInRange(a,e.range,t=>t===2)}function testTokensInRange(a,e,t){for(let s=e.startLineNumber;s<=e.endLineNumber;s++){const o=a.tokenization.getLineTokens(s),r=s===e.startLineNumber,l=s===e.endLineNumber;let c=r?o.findTokenIndexAtOffset(e.startColumn-1):0;for(;c<o.getCount()&&!(l&&o.getStartOffset(c)>e.endColumn-1);){if(!t(o.getStandardTokenType(c)))return!1;c++}}return!0}const POINTER_DRAG_RESET_DISTANCE=140,GUTTER_DECORATION_WIDTH=2;class MinimapOptions{constructor(e,t,s){const o=e.options,r=o.get(163),l=o.get(165),c=l.minimap,d=o.get(59),u=o.get(81);this.renderMinimap=c.renderMinimap,this.size=u.size,this.minimapHeightIsEditorHeight=c.minimapHeightIsEditorHeight,this.scrollBeyondLastLine=o.get(119),this.paddingTop=o.get(96).top,this.paddingBottom=o.get(96).bottom,this.showSlider=u.showSlider,this.autohide=u.autohide,this.pixelRatio=r,this.typicalHalfwidthCharacterWidth=d.typicalHalfwidthCharacterWidth,this.lineHeight=o.get(75),this.minimapLeft=c.minimapLeft,this.minimapWidth=c.minimapWidth,this.minimapHeight=l.height,this.canvasInnerWidth=c.minimapCanvasInnerWidth,this.canvasInnerHeight=c.minimapCanvasInnerHeight,this.canvasOuterWidth=c.minimapCanvasOuterWidth,this.canvasOuterHeight=c.minimapCanvasOuterHeight,this.isSampling=c.minimapIsSampling,this.editorHeight=l.height,this.fontScale=c.minimapScale,this.minimapLineHeight=c.minimapLineHeight,this.minimapCharWidth=1*this.fontScale,this.sectionHeaderFontFamily=DEFAULT_FONT_FAMILY,this.sectionHeaderFontSize=u.sectionHeaderFontSize*r,this.sectionHeaderLetterSpacing=u.sectionHeaderLetterSpacing,this.sectionHeaderFontColor=MinimapOptions._getSectionHeaderColor(t,s.getColor(1)),this.charRenderer=createSingleCallFunction(()=>MinimapCharRendererFactory.create(this.fontScale,d.fontFamily)),this.defaultBackgroundColor=s.getColor(2),this.backgroundColor=MinimapOptions._getMinimapBackground(t,this.defaultBackgroundColor),this.foregroundAlpha=MinimapOptions._getMinimapForegroundOpacity(t)}static _getMinimapBackground(e,t){const s=e.getColor(minimapBackground);return s?new RGBA8(s.rgba.r,s.rgba.g,s.rgba.b,Math.round(255*s.rgba.a)):t}static _getMinimapForegroundOpacity(e){const t=e.getColor(minimapForegroundOpacity);return t?RGBA8._clamp(Math.round(255*t.rgba.a)):255}static _getSectionHeaderColor(e,t){const s=e.getColor(editorForeground);return s?new RGBA8(s.rgba.r,s.rgba.g,s.rgba.b,Math.round(255*s.rgba.a)):t}equals(e){return this.renderMinimap===e.renderMinimap&&this.size===e.size&&this.minimapHeightIsEditorHeight===e.minimapHeightIsEditorHeight&&this.scrollBeyondLastLine===e.scrollBeyondLastLine&&this.paddingTop===e.paddingTop&&this.paddingBottom===e.paddingBottom&&this.showSlider===e.showSlider&&this.autohide===e.autohide&&this.pixelRatio===e.pixelRatio&&this.typicalHalfwidthCharacterWidth===e.typicalHalfwidthCharacterWidth&&this.lineHeight===e.lineHeight&&this.minimapLeft===e.minimapLeft&&this.minimapWidth===e.minimapWidth&&this.minimapHeight===e.minimapHeight&&this.canvasInnerWidth===e.canvasInnerWidth&&this.canvasInnerHeight===e.canvasInnerHeight&&this.canvasOuterWidth===e.canvasOuterWidth&&this.canvasOuterHeight===e.canvasOuterHeight&&this.isSampling===e.isSampling&&this.editorHeight===e.editorHeight&&this.fontScale===e.fontScale&&this.minimapLineHeight===e.minimapLineHeight&&this.minimapCharWidth===e.minimapCharWidth&&this.sectionHeaderFontSize===e.sectionHeaderFontSize&&this.sectionHeaderLetterSpacing===e.sectionHeaderLetterSpacing&&this.defaultBackgroundColor&&this.defaultBackgroundColor.equals(e.defaultBackgroundColor)&&this.backgroundColor&&this.backgroundColor.equals(e.backgroundColor)&&this.foregroundAlpha===e.foregroundAlpha}}class MinimapLayout{constructor(e,t,s,o,r,l,c,d,u){this.scrollTop=e,this.scrollHeight=t,this.sliderNeeded=s,this._computedSliderRatio=o,this.sliderTop=r,this.sliderHeight=l,this.topPaddingLineCount=c,this.startLineNumber=d,this.endLineNumber=u}getDesiredScrollTopFromDelta(e){return Math.round(this.scrollTop+e/this._computedSliderRatio)}getDesiredScrollTopFromTouchLocation(e){return Math.round((e-this.sliderHeight/2)/this._computedSliderRatio)}intersectWithViewport(e){const t=Math.max(this.startLineNumber,e.startLineNumber),s=Math.min(this.endLineNumber,e.endLineNumber);return t>s?null:[t,s]}getYForLineNumber(e,t){return+(e-this.startLineNumber+this.topPaddingLineCount)*t}static create(e,t,s,o,r,l,c,d,u,g,f){const p=e.pixelRatio,m=e.minimapLineHeight,_=Math.floor(e.canvasInnerHeight/m),C=e.lineHeight;if(e.minimapHeightIsEditorHeight){let x=d*e.lineHeight+e.paddingTop+e.paddingBottom;e.scrollBeyondLastLine&&(x+=Math.max(0,r-e.lineHeight-e.paddingBottom));const E=Math.max(1,Math.floor(r*r/x)),I=Math.max(0,e.minimapHeight-E),D=I/(g-r),k=u*D,N=I>0,R=Math.floor(e.canvasInnerHeight/e.minimapLineHeight),M=Math.floor(e.paddingTop/e.lineHeight);return new MinimapLayout(u,g,N,D,k,E,M,1,Math.min(c,R))}let b;if(l&&s!==c){const x=s-t+1;b=Math.floor(x*m/p)}else{const x=r/C;b=Math.floor(x*m/p)}const v=Math.floor(e.paddingTop/C);let S=Math.floor(e.paddingBottom/C);if(e.scrollBeyondLastLine){const x=r/C;S=Math.max(S,x-1)}let y;if(S>0){const x=r/C;y=(v+c+S-x-1)*m/p}else y=Math.max(0,(v+c)*m/p-b);y=Math.min(e.minimapHeight-b,y);const w=y/(g-r),L=u*w;if(_>=v+c+S){const x=y>0;return new MinimapLayout(u,g,x,w,L,b,v,1,c)}else{let x;t>1?x=t+v:x=Math.max(1,u/C);let E,I=Math.max(1,Math.floor(x-L*p/m));I<v?(E=v-I+1,I=1):(E=0,I=Math.max(1,I-v)),f&&f.scrollHeight===g&&(f.scrollTop>u&&(I=Math.min(I,f.startLineNumber),E=Math.max(E,f.topPaddingLineCount)),f.scrollTop<u&&(I=Math.max(I,f.startLineNumber),E=Math.min(E,f.topPaddingLineCount)));const D=Math.min(c,I-E+_-1),k=(u-o)/C;let N;return u>=e.paddingTop?N=(t-I+E+k)*m/p:N=u/e.paddingTop*(E+k)*m/p,new MinimapLayout(u,g,!0,w,N,b,E,I,D)}}}const us=class us{constructor(e){this.dy=e}onContentChanged(){this.dy=-1}onTokensChanged(){this.dy=-1}};us.INVALID=new us(-1);let MinimapLine=us;class RenderData{constructor(e,t,s){this.renderedLayout=e,this._imageData=t,this._renderedLines=new RenderedLinesCollection({createLine:()=>MinimapLine.INVALID}),this._renderedLines._set(e.startLineNumber,s)}linesEquals(e){if(!this.scrollEquals(e))return!1;const s=this._renderedLines._get().lines;for(let o=0,r=s.length;o<r;o++)if(s[o].dy===-1)return!1;return!0}scrollEquals(e){return this.renderedLayout.startLineNumber===e.startLineNumber&&this.renderedLayout.endLineNumber===e.endLineNumber}_get(){const e=this._renderedLines._get();return{imageData:this._imageData,rendLineNumberStart:e.rendLineNumberStart,lines:e.lines}}onLinesChanged(e,t){return this._renderedLines.onLinesChanged(e,t)}onLinesDeleted(e,t){this._renderedLines.onLinesDeleted(e,t)}onLinesInserted(e,t){this._renderedLines.onLinesInserted(e,t)}onTokensChanged(e){return this._renderedLines.onTokensChanged(e)}}class MinimapBuffers{constructor(e,t,s,o){this._backgroundFillData=MinimapBuffers._createBackgroundFillData(t,s,o),this._buffers=[e.createImageData(t,s),e.createImageData(t,s)],this._lastUsedBuffer=0}getBuffer(){this._lastUsedBuffer=1-this._lastUsedBuffer;const e=this._buffers[this._lastUsedBuffer];return e.data.set(this._backgroundFillData),e}static _createBackgroundFillData(e,t,s){const o=s.r,r=s.g,l=s.b,c=s.a,d=new Uint8ClampedArray(e*t*4);let u=0;for(let g=0;g<t;g++)for(let f=0;f<e;f++)d[u]=o,d[u+1]=r,d[u+2]=l,d[u+3]=c,u+=4;return d}}class MinimapSamplingState{static compute(e,t,s){if(e.renderMinimap===0||!e.isSampling)return[null,[]];const{minimapLineCount:o}=EditorLayoutInfoComputer.computeContainedMinimapLineCount({viewLineCount:t,scrollBeyondLastLine:e.scrollBeyondLastLine,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,height:e.editorHeight,lineHeight:e.lineHeight,pixelRatio:e.pixelRatio}),r=t/o,l=r/2;if(!s||s.minimapLines.length===0){const b=[];if(b[0]=1,o>1){for(let v=0,S=o-1;v<S;v++)b[v]=Math.round(v*r+l);b[o-1]=t}return[new MinimapSamplingState(r,b),[]]}const c=s.minimapLines,d=c.length,u=[];let g=0,f=0,p=1;const m=10;let _=[],C=null;for(let b=0;b<o;b++){const v=Math.max(p,Math.round(b*r)),S=Math.max(v,Math.round((b+1)*r));for(;g<d&&c[g]<v;){if(_.length<m){const w=g+1+f;C&&C.type==="deleted"&&C._oldIndex===g-1?C.deleteToLineNumber++:(C={type:"deleted",_oldIndex:g,deleteFromLineNumber:w,deleteToLineNumber:w},_.push(C)),f--}g++}let y;if(g<d&&c[g]<=S)y=c[g],g++;else if(b===0?y=1:b+1===o?y=t:y=Math.round(b*r+l),_.length<m){const w=g+1+f;C&&C.type==="inserted"&&C._i===b-1?C.insertToLineNumber++:(C={type:"inserted",_i:b,insertFromLineNumber:w,insertToLineNumber:w},_.push(C)),f++}u[b]=y,p=y}if(_.length<m)for(;g<d;){const b=g+1+f;C&&C.type==="deleted"&&C._oldIndex===g-1?C.deleteToLineNumber++:(C={type:"deleted",_oldIndex:g,deleteFromLineNumber:b,deleteToLineNumber:b},_.push(C)),f--,g++}else _=[{type:"flush"}];return[new MinimapSamplingState(r,u),_]}constructor(e,t){this.samplingRatio=e,this.minimapLines=t}modelLineToMinimapLine(e){return Math.min(this.minimapLines.length,Math.max(1,Math.round(e/this.samplingRatio)))}modelLineRangeToMinimapLineRange(e,t){let s=this.modelLineToMinimapLine(e)-1;for(;s>0&&this.minimapLines[s-1]>=e;)s--;let o=this.modelLineToMinimapLine(t)-1;for(;o+1<this.minimapLines.length&&this.minimapLines[o+1]<=t;)o++;if(s===o){const r=this.minimapLines[s];if(r<e||r>t)return null}return[s+1,o+1]}decorationLineRangeToMinimapLineRange(e,t){let s=this.modelLineToMinimapLine(e),o=this.modelLineToMinimapLine(t);return e!==t&&o===s&&(o===this.minimapLines.length?s>1&&s--:o++),[s,o]}onLinesDeleted(e){const t=e.toLineNumber-e.fromLineNumber+1;let s=this.minimapLines.length,o=0;for(let r=this.minimapLines.length-1;r>=0&&!(this.minimapLines[r]<e.fromLineNumber);r--)this.minimapLines[r]<=e.toLineNumber?(this.minimapLines[r]=Math.max(1,e.fromLineNumber-1),s=Math.min(s,r),o=Math.max(o,r)):this.minimapLines[r]-=t;return[s,o]}onLinesInserted(e){const t=e.toLineNumber-e.fromLineNumber+1;for(let s=this.minimapLines.length-1;s>=0&&!(this.minimapLines[s]<e.fromLineNumber);s--)this.minimapLines[s]+=t}}class Minimap extends ViewPart{constructor(e){super(e),this._sectionHeaderCache=new LRUCache(10,1.5),this.tokensColorTracker=MinimapTokensColorTracker.getInstance(),this._selections=[],this._minimapSelections=null,this.options=new MinimapOptions(this._context.configuration,this._context.theme,this.tokensColorTracker);const[t]=MinimapSamplingState.compute(this.options,this._context.viewModel.getLineCount(),null);this._samplingState=t,this._shouldCheckSampling=!1,this._actual=new InnerMinimap(e.theme,this)}dispose(){this._actual.dispose(),super.dispose()}getDomNode(){return this._actual.getDomNode()}_onOptionsMaybeChanged(){const e=new MinimapOptions(this._context.configuration,this._context.theme,this.tokensColorTracker);return this.options.equals(e)?!1:(this.options=e,this._recreateLineSampling(),this._actual.onDidChangeOptions(),!0)}onConfigurationChanged(e){return this._onOptionsMaybeChanged()}onCursorStateChanged(e){return this._selections=e.selections,this._minimapSelections=null,this._actual.onSelectionChanged()}onDecorationsChanged(e){return e.affectsMinimap?this._actual.onDecorationsChanged():!1}onFlushed(e){return this._samplingState&&(this._shouldCheckSampling=!0),this._actual.onFlushed()}onLinesChanged(e){if(this._samplingState){const t=this._samplingState.modelLineRangeToMinimapLineRange(e.fromLineNumber,e.fromLineNumber+e.count-1);return t?this._actual.onLinesChanged(t[0],t[1]-t[0]+1):!1}else return this._actual.onLinesChanged(e.fromLineNumber,e.count)}onLinesDeleted(e){if(this._samplingState){const[t,s]=this._samplingState.onLinesDeleted(e);return t<=s&&this._actual.onLinesChanged(t+1,s-t+1),this._shouldCheckSampling=!0,!0}else return this._actual.onLinesDeleted(e.fromLineNumber,e.toLineNumber)}onLinesInserted(e){return this._samplingState?(this._samplingState.onLinesInserted(e),this._shouldCheckSampling=!0,!0):this._actual.onLinesInserted(e.fromLineNumber,e.toLineNumber)}onScrollChanged(e){return this._actual.onScrollChanged(e)}onThemeChanged(e){return this._actual.onThemeChanged(),this._onOptionsMaybeChanged(),!0}onTokensChanged(e){if(this._samplingState){const t=[];for(const s of e.ranges){const o=this._samplingState.modelLineRangeToMinimapLineRange(s.fromLineNumber,s.toLineNumber);o&&t.push({fromLineNumber:o[0],toLineNumber:o[1]})}return t.length?this._actual.onTokensChanged(t):!1}else return this._actual.onTokensChanged(e.ranges)}onTokensColorsChanged(e){return this._onOptionsMaybeChanged(),this._actual.onTokensColorsChanged()}onZonesChanged(e){return this._actual.onZonesChanged()}prepareRender(e){this._shouldCheckSampling&&(this._shouldCheckSampling=!1,this._recreateLineSampling())}render(e){let t=e.visibleRange.startLineNumber,s=e.visibleRange.endLineNumber;this._samplingState&&(t=this._samplingState.modelLineToMinimapLine(t),s=this._samplingState.modelLineToMinimapLine(s));const o={viewportContainsWhitespaceGaps:e.viewportData.whitespaceViewportData.length>0,scrollWidth:e.scrollWidth,scrollHeight:e.scrollHeight,viewportStartLineNumber:t,viewportEndLineNumber:s,viewportStartLineNumberVerticalOffset:e.getVerticalOffsetForLineNumber(t),scrollTop:e.scrollTop,scrollLeft:e.scrollLeft,viewportWidth:e.viewportWidth,viewportHeight:e.viewportHeight};this._actual.render(o)}_recreateLineSampling(){this._minimapSelections=null;const e=!!this._samplingState,[t,s]=MinimapSamplingState.compute(this.options,this._context.viewModel.getLineCount(),this._samplingState);if(this._samplingState=t,e&&this._samplingState)for(const o of s)switch(o.type){case"deleted":this._actual.onLinesDeleted(o.deleteFromLineNumber,o.deleteToLineNumber);break;case"inserted":this._actual.onLinesInserted(o.insertFromLineNumber,o.insertToLineNumber);break;case"flush":this._actual.onFlushed();break}}getLineCount(){return this._samplingState?this._samplingState.minimapLines.length:this._context.viewModel.getLineCount()}getRealLineCount(){return this._context.viewModel.getLineCount()}getLineContent(e){return this._samplingState?this._context.viewModel.getLineContent(this._samplingState.minimapLines[e-1]):this._context.viewModel.getLineContent(e)}getLineMaxColumn(e){return this._samplingState?this._context.viewModel.getLineMaxColumn(this._samplingState.minimapLines[e-1]):this._context.viewModel.getLineMaxColumn(e)}getMinimapLinesRenderingData(e,t,s){if(this._samplingState){const o=[];for(let r=0,l=t-e+1;r<l;r++)s[r]?o[r]=this._context.viewModel.getViewLineData(this._samplingState.minimapLines[e+r-1]):o[r]=null;return o}return this._context.viewModel.getMinimapLinesRenderingData(e,t,s).data}getSelections(){if(this._minimapSelections===null)if(this._samplingState){this._minimapSelections=[];for(const e of this._selections){const[t,s]=this._samplingState.decorationLineRangeToMinimapLineRange(e.startLineNumber,e.endLineNumber);this._minimapSelections.push(new Selection$1(t,e.startColumn,s,e.endColumn))}}else this._minimapSelections=this._selections;return this._minimapSelections}getMinimapDecorationsInViewport(e,t){return this._getMinimapDecorationsInViewport(e,t).filter(s=>{var o;return!((o=s.options.minimap)!=null&&o.sectionHeaderStyle)})}getSectionHeaderDecorationsInViewport(e,t){const s=this.options.sectionHeaderFontSize/this.options.minimapLineHeight;return e=Math.floor(Math.max(1,e-s)),this._getMinimapDecorationsInViewport(e,t).filter(o=>{var r;return!!((r=o.options.minimap)!=null&&r.sectionHeaderStyle)})}_getMinimapDecorationsInViewport(e,t){let s;if(this._samplingState){const r=this._samplingState.minimapLines[e-1],l=this._samplingState.minimapLines[t-1];s=new Range$2(r,1,l,this._context.viewModel.getLineMaxColumn(l))}else s=new Range$2(e,1,t,this._context.viewModel.getLineMaxColumn(t));const o=this._context.viewModel.getMinimapDecorationsInRange(s);if(this._samplingState){const r=[];for(const l of o){if(!l.options.minimap)continue;const c=l.range,d=this._samplingState.modelLineToMinimapLine(c.startLineNumber),u=this._samplingState.modelLineToMinimapLine(c.endLineNumber);r.push(new ViewModelDecoration(new Range$2(d,c.startColumn,u,c.endColumn),l.options))}return r}return o}getSectionHeaderText(e,t){var l;const s=(l=e.options.minimap)==null?void 0:l.sectionHeaderText;if(!s)return null;const o=this._sectionHeaderCache.get(s);if(o)return o;const r=t(s);return this._sectionHeaderCache.set(s,r),r}getOptions(){return this._context.viewModel.model.getOptions()}revealLineNumber(e){this._samplingState&&(e=this._samplingState.minimapLines[e-1]),this._context.viewModel.revealRange("mouse",!1,new Range$2(e,1,e,1),1,0)}setScrollTop(e){this._context.viewModel.viewLayout.setScrollPosition({scrollTop:e},1)}}class InnerMinimap extends Disposable{constructor(e,t){super(),this._renderDecorations=!1,this._gestureInProgress=!1,this._isMouseOverMinimap=!1,this._theme=e,this._model=t,this._lastRenderData=null,this._buffers=null,this._selectionColor=this._theme.getColor(minimapSelection),this._domNode=createFastDomNode(document.createElement("div")),PartFingerprints.write(this._domNode,9),this._domNode.setClassName(this._getMinimapDomNodeClassName()),this._domNode.setPosition("absolute"),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._shadow=createFastDomNode(document.createElement("div")),this._shadow.setClassName("minimap-shadow-hidden"),this._domNode.appendChild(this._shadow),this._canvas=createFastDomNode(document.createElement("canvas")),this._canvas.setPosition("absolute"),this._canvas.setLeft(0),this._domNode.appendChild(this._canvas),this._decorationsCanvas=createFastDomNode(document.createElement("canvas")),this._decorationsCanvas.setPosition("absolute"),this._decorationsCanvas.setClassName("minimap-decorations-layer"),this._decorationsCanvas.setLeft(0),this._domNode.appendChild(this._decorationsCanvas),this._slider=createFastDomNode(document.createElement("div")),this._slider.setPosition("absolute"),this._slider.setClassName("minimap-slider"),this._slider.setLayerHinting(!0),this._slider.setContain("strict"),this._domNode.appendChild(this._slider),this._sliderHorizontal=createFastDomNode(document.createElement("div")),this._sliderHorizontal.setPosition("absolute"),this._sliderHorizontal.setClassName("minimap-slider-horizontal"),this._slider.appendChild(this._sliderHorizontal),this._applyLayout(),this._hideDelayedScheduler=this._register(new RunOnceScheduler(()=>this._hideImmediatelyIfMouseIsOutside(),500)),this._register(addStandardDisposableListener(this._domNode.domNode,EventType$1.MOUSE_OVER,()=>{this._isMouseOverMinimap=!0})),this._register(addStandardDisposableListener(this._domNode.domNode,EventType$1.MOUSE_LEAVE,()=>{this._isMouseOverMinimap=!1})),this._pointerDownListener=addStandardDisposableListener(this._domNode.domNode,EventType$1.POINTER_DOWN,s=>{s.preventDefault();const o=s.pointerType==="mouse",r=s.button===0;if(this._model.options.renderMinimap!==0&&this._lastRenderData){if(this._model.options.size!=="proportional"){if(r&&this._lastRenderData){const c=getDomNodePagePosition(this._slider.domNode),d=c.top+c.height/2;this._startSliderDragging(s,d,this._lastRenderData.renderedLayout)}return}if(r||!o){const c=this._model.options.minimapLineHeight,d=this._model.options.canvasInnerHeight/this._model.options.canvasOuterHeight*s.offsetY;let g=Math.floor(d/c)+this._lastRenderData.renderedLayout.startLineNumber-this._lastRenderData.renderedLayout.topPaddingLineCount;g=Math.min(g,this._model.getLineCount()),this._model.revealLineNumber(g)}}}),this._sliderPointerMoveMonitor=new GlobalPointerMoveMonitor,this._sliderPointerDownListener=addStandardDisposableListener(this._slider.domNode,EventType$1.POINTER_DOWN,s=>{s.preventDefault(),s.stopPropagation(),s.button===0&&this._lastRenderData&&this._startSliderDragging(s,s.pageY,this._lastRenderData.renderedLayout)}),this._gestureDisposable=Gesture.addTarget(this._domNode.domNode),this._sliderTouchStartListener=addDisposableListener(this._domNode.domNode,EventType.Start,s=>{s.preventDefault(),s.stopPropagation(),this._lastRenderData&&(this._slider.toggleClassName("active",!0),this._gestureInProgress=!0,this.scrollDueToTouchEvent(s))},{passive:!1}),this._sliderTouchMoveListener=addDisposableListener(this._domNode.domNode,EventType.Change,s=>{s.preventDefault(),s.stopPropagation(),this._lastRenderData&&this._gestureInProgress&&this.scrollDueToTouchEvent(s)},{passive:!1}),this._sliderTouchEndListener=addStandardDisposableListener(this._domNode.domNode,EventType.End,s=>{s.preventDefault(),s.stopPropagation(),this._gestureInProgress=!1,this._slider.toggleClassName("active",!1)})}_hideSoon(){this._hideDelayedScheduler.cancel(),this._hideDelayedScheduler.schedule()}_hideImmediatelyIfMouseIsOutside(){if(this._isMouseOverMinimap){this._hideSoon();return}this._domNode.toggleClassName("active",!1)}_startSliderDragging(e,t,s){if(!e.target||!(e.target instanceof Element))return;const o=e.pageX;this._slider.toggleClassName("active",!0);const r=(l,c)=>{const d=getDomNodePagePosition(this._domNode.domNode),u=Math.min(Math.abs(c-o),Math.abs(c-d.left),Math.abs(c-d.left-d.width));if(isWindows&&u>POINTER_DRAG_RESET_DISTANCE){this._model.setScrollTop(s.scrollTop);return}const g=l-t;this._model.setScrollTop(s.getDesiredScrollTopFromDelta(g))};e.pageY!==t&&r(e.pageY,o),this._sliderPointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,l=>r(l.pageY,l.pageX),()=>{this._slider.toggleClassName("active",!1)})}scrollDueToTouchEvent(e){const t=this._domNode.domNode.getBoundingClientRect().top,s=this._lastRenderData.renderedLayout.getDesiredScrollTopFromTouchLocation(e.pageY-t);this._model.setScrollTop(s)}dispose(){this._pointerDownListener.dispose(),this._sliderPointerMoveMonitor.dispose(),this._sliderPointerDownListener.dispose(),this._gestureDisposable.dispose(),this._sliderTouchStartListener.dispose(),this._sliderTouchMoveListener.dispose(),this._sliderTouchEndListener.dispose(),super.dispose()}_getMinimapDomNodeClassName(){const e=["minimap"];return this._model.options.showSlider==="always"?e.push("slider-always"):e.push("slider-mouseover"),this._model.options.autohide==="mouseover"?e.push("minimap-autohide-mouseover"):this._model.options.autohide==="scroll"&&e.push("minimap-autohide-scroll"),e.join(" ")}getDomNode(){return this._domNode}_applyLayout(){this._domNode.setLeft(this._model.options.minimapLeft),this._domNode.setWidth(this._model.options.minimapWidth),this._domNode.setHeight(this._model.options.minimapHeight),this._shadow.setHeight(this._model.options.minimapHeight),this._canvas.setWidth(this._model.options.canvasOuterWidth),this._canvas.setHeight(this._model.options.canvasOuterHeight),this._canvas.domNode.width=this._model.options.canvasInnerWidth,this._canvas.domNode.height=this._model.options.canvasInnerHeight,this._decorationsCanvas.setWidth(this._model.options.canvasOuterWidth),this._decorationsCanvas.setHeight(this._model.options.canvasOuterHeight),this._decorationsCanvas.domNode.width=this._model.options.canvasInnerWidth,this._decorationsCanvas.domNode.height=this._model.options.canvasInnerHeight,this._slider.setWidth(this._model.options.minimapWidth)}_getBuffer(){return this._buffers||this._model.options.canvasInnerWidth>0&&this._model.options.canvasInnerHeight>0&&(this._buffers=new MinimapBuffers(this._canvas.domNode.getContext("2d"),this._model.options.canvasInnerWidth,this._model.options.canvasInnerHeight,this._model.options.backgroundColor)),this._buffers?this._buffers.getBuffer():null}onDidChangeOptions(){this._lastRenderData=null,this._buffers=null,this._applyLayout(),this._domNode.setClassName(this._getMinimapDomNodeClassName())}onSelectionChanged(){return this._renderDecorations=!0,!0}onDecorationsChanged(){return this._renderDecorations=!0,!0}onFlushed(){return this._lastRenderData=null,!0}onLinesChanged(e,t){return this._lastRenderData?this._lastRenderData.onLinesChanged(e,t):!1}onLinesDeleted(e,t){var s;return(s=this._lastRenderData)==null||s.onLinesDeleted(e,t),!0}onLinesInserted(e,t){var s;return(s=this._lastRenderData)==null||s.onLinesInserted(e,t),!0}onScrollChanged(e){return this._model.options.autohide==="scroll"&&(e.scrollTopChanged||e.scrollHeightChanged)&&(this._domNode.toggleClassName("active",!0),this._hideSoon()),this._renderDecorations=!0,!0}onThemeChanged(){return this._selectionColor=this._theme.getColor(minimapSelection),this._renderDecorations=!0,!0}onTokensChanged(e){return this._lastRenderData?this._lastRenderData.onTokensChanged(e):!1}onTokensColorsChanged(){return this._lastRenderData=null,this._buffers=null,!0}onZonesChanged(){return this._lastRenderData=null,!0}render(e){if(this._model.options.renderMinimap===0){this._shadow.setClassName("minimap-shadow-hidden"),this._sliderHorizontal.setWidth(0),this._sliderHorizontal.setHeight(0);return}e.scrollLeft+e.viewportWidth>=e.scrollWidth?this._shadow.setClassName("minimap-shadow-hidden"):this._shadow.setClassName("minimap-shadow-visible");const s=MinimapLayout.create(this._model.options,e.viewportStartLineNumber,e.viewportEndLineNumber,e.viewportStartLineNumberVerticalOffset,e.viewportHeight,e.viewportContainsWhitespaceGaps,this._model.getLineCount(),this._model.getRealLineCount(),e.scrollTop,e.scrollHeight,this._lastRenderData?this._lastRenderData.renderedLayout:null);this._slider.setDisplay(s.sliderNeeded?"block":"none"),this._slider.setTop(s.sliderTop),this._slider.setHeight(s.sliderHeight),this._sliderHorizontal.setLeft(0),this._sliderHorizontal.setWidth(this._model.options.minimapWidth),this._sliderHorizontal.setTop(0),this._sliderHorizontal.setHeight(s.sliderHeight),this.renderDecorations(s),this._lastRenderData=this.renderLines(s)}renderDecorations(e){if(this._renderDecorations){this._renderDecorations=!1;const t=this._model.getSelections();t.sort(Range$2.compareRangesUsingStarts);const s=this._model.getMinimapDecorationsInViewport(e.startLineNumber,e.endLineNumber);s.sort((p,m)=>(p.options.zIndex||0)-(m.options.zIndex||0));const{canvasInnerWidth:o,canvasInnerHeight:r}=this._model.options,l=this._model.options.minimapLineHeight,c=this._model.options.minimapCharWidth,d=this._model.getOptions().tabSize,u=this._decorationsCanvas.domNode.getContext("2d");u.clearRect(0,0,o,r);const g=new ContiguousLineMap(e.startLineNumber,e.endLineNumber,!1);this._renderSelectionLineHighlights(u,t,g,e,l),this._renderDecorationsLineHighlights(u,s,g,e,l);const f=new ContiguousLineMap(e.startLineNumber,e.endLineNumber,null);this._renderSelectionsHighlights(u,t,f,e,l,d,c,o),this._renderDecorationsHighlights(u,s,f,e,l,d,c,o),this._renderSectionHeaders(e)}}_renderSelectionLineHighlights(e,t,s,o,r){if(!this._selectionColor||this._selectionColor.isTransparent())return;e.fillStyle=this._selectionColor.transparent(.5).toString();let l=0,c=0;for(const d of t){const u=o.intersectWithViewport(d);if(!u)continue;const[g,f]=u;for(let _=g;_<=f;_++)s.set(_,!0);const p=o.getYForLineNumber(g,r),m=o.getYForLineNumber(f,r);c>=p||(c>l&&e.fillRect(MINIMAP_GUTTER_WIDTH,l,e.canvas.width,c-l),l=p),c=m}c>l&&e.fillRect(MINIMAP_GUTTER_WIDTH,l,e.canvas.width,c-l)}_renderDecorationsLineHighlights(e,t,s,o,r){const l=new Map;for(let c=t.length-1;c>=0;c--){const d=t[c],u=d.options.minimap;if(!u||u.position!==1)continue;const g=o.intersectWithViewport(d.range);if(!g)continue;const[f,p]=g,m=u.getColor(this._theme.value);if(!m||m.isTransparent())continue;let _=l.get(m.toString());_||(_=m.transparent(.5).toString(),l.set(m.toString(),_)),e.fillStyle=_;for(let C=f;C<=p;C++){if(s.has(C))continue;s.set(C,!0);const b=o.getYForLineNumber(f,r);e.fillRect(MINIMAP_GUTTER_WIDTH,b,e.canvas.width,r)}}}_renderSelectionsHighlights(e,t,s,o,r,l,c,d){if(!(!this._selectionColor||this._selectionColor.isTransparent()))for(const u of t){const g=o.intersectWithViewport(u);if(!g)continue;const[f,p]=g;for(let m=f;m<=p;m++)this.renderDecorationOnLine(e,s,u,this._selectionColor,o,m,r,r,l,c,d)}}_renderDecorationsHighlights(e,t,s,o,r,l,c,d){for(const u of t){const g=u.options.minimap;if(!g)continue;const f=o.intersectWithViewport(u.range);if(!f)continue;const[p,m]=f,_=g.getColor(this._theme.value);if(!(!_||_.isTransparent()))for(let C=p;C<=m;C++)switch(g.position){case 1:this.renderDecorationOnLine(e,s,u.range,_,o,C,r,r,l,c,d);continue;case 2:{const b=o.getYForLineNumber(C,r),v=2;this.renderDecoration(e,_,v,b,GUTTER_DECORATION_WIDTH,r);continue}}}}renderDecorationOnLine(e,t,s,o,r,l,c,d,u,g,f){const p=r.getYForLineNumber(l,d);if(p+c<0||p>this._model.options.canvasInnerHeight)return;const{startLineNumber:m,endLineNumber:_}=s,C=m===l?s.startColumn:1,b=_===l?s.endColumn:this._model.getLineMaxColumn(l),v=this.getXOffsetForPosition(t,l,C,u,g,f),S=this.getXOffsetForPosition(t,l,b,u,g,f);this.renderDecoration(e,o,v,p,S-v,c)}getXOffsetForPosition(e,t,s,o,r,l){if(s===1)return MINIMAP_GUTTER_WIDTH;if((s-1)*r>=l)return l;let d=e.get(t);if(!d){const u=this._model.getLineContent(t);d=[MINIMAP_GUTTER_WIDTH];let g=MINIMAP_GUTTER_WIDTH;for(let f=1;f<u.length+1;f++){const p=u.charCodeAt(f-1),m=p===9?o*r:isFullWidthCharacter(p)?2*r:r,_=g+m;if(_>=l){d[f]=l;break}d[f]=_,g=_}e.set(t,d)}return s-1<d.length?d[s-1]:l}renderDecoration(e,t,s,o,r,l){e.fillStyle=t&&t.toString()||"",e.fillRect(s,o,r,l)}_renderSectionHeaders(e){var C;const t=this._model.options.minimapLineHeight,s=this._model.options.sectionHeaderFontSize,o=this._model.options.sectionHeaderLetterSpacing,r=s*1.5,{canvasInnerWidth:l}=this._model.options,c=this._model.options.backgroundColor,d=`rgb(${c.r} ${c.g} ${c.b} / .7)`,u=this._model.options.sectionHeaderFontColor,g=`rgb(${u.r} ${u.g} ${u.b})`,f=g,p=this._decorationsCanvas.domNode.getContext("2d");p.letterSpacing=o+"px",p.font="500 "+s+"px "+this._model.options.sectionHeaderFontFamily,p.strokeStyle=f,p.lineWidth=.4;const m=this._model.getSectionHeaderDecorationsInViewport(e.startLineNumber,e.endLineNumber);m.sort((b,v)=>b.range.startLineNumber-v.range.startLineNumber);const _=InnerMinimap._fitSectionHeader.bind(null,p,l-MINIMAP_GUTTER_WIDTH);for(const b of m){const v=e.getYForLineNumber(b.range.startLineNumber,t)+s,S=v-s,y=S+2,w=this._model.getSectionHeaderText(b,_);InnerMinimap._renderSectionLabel(p,w,((C=b.options.minimap)==null?void 0:C.sectionHeaderStyle)===2,d,g,l,S,r,v,y)}}static _fitSectionHeader(e,t,s){if(!s)return s;const o="…",r=e.measureText(s).width,l=e.measureText(o).width;if(r<=t||r<=l)return s;const c=s.length,d=r/s.length,u=Math.floor((t-l)/d)-1;let g=Math.ceil(u/2);for(;g>0&&/\s/.test(s[g-1]);)--g;return s.substring(0,g)+o+s.substring(c-(u-g))}static _renderSectionLabel(e,t,s,o,r,l,c,d,u,g){t&&(e.fillStyle=o,e.fillRect(0,c,l,d),e.fillStyle=r,e.fillText(t,MINIMAP_GUTTER_WIDTH,u)),s&&(e.beginPath(),e.moveTo(0,g),e.lineTo(l,g),e.closePath(),e.stroke())}renderLines(e){const t=e.startLineNumber,s=e.endLineNumber,o=this._model.options.minimapLineHeight;if(this._lastRenderData&&this._lastRenderData.linesEquals(e)){const O=this._lastRenderData._get();return new RenderData(e,O.imageData,O.lines)}const r=this._getBuffer();if(!r)return null;const[l,c,d]=InnerMinimap._renderUntouchedLines(r,e.topPaddingLineCount,t,s,o,this._lastRenderData),u=this._model.getMinimapLinesRenderingData(t,s,d),g=this._model.getOptions().tabSize,f=this._model.options.defaultBackgroundColor,p=this._model.options.backgroundColor,m=this._model.options.foregroundAlpha,_=this._model.tokensColorTracker,C=_.backgroundIsLight(),b=this._model.options.renderMinimap,v=this._model.options.charRenderer(),S=this._model.options.fontScale,y=this._model.options.minimapCharWidth,L=(b===1?2:2+1)*S,x=o>L?Math.floor((o-L)/2):0,E=p.a/255,I=new RGBA8(Math.round((p.r-f.r)*E+f.r),Math.round((p.g-f.g)*E+f.g),Math.round((p.b-f.b)*E+f.b),255);let D=e.topPaddingLineCount*o;const k=[];for(let O=0,P=s-t+1;O<P;O++)d[O]&&InnerMinimap._renderLine(r,I,p.a,C,b,y,_,m,v,D,x,g,u[O],S,o),k[O]=new MinimapLine(D),D+=o;const N=l===-1?0:l,M=(c===-1?r.height:c)-N;return this._canvas.domNode.getContext("2d").putImageData(r,0,0,0,N,r.width,M),new RenderData(e,r,k)}static _renderUntouchedLines(e,t,s,o,r,l){const c=[];if(!l){for(let D=0,k=o-s+1;D<k;D++)c[D]=!0;return[-1,-1,c]}const d=l._get(),u=d.imageData.data,g=d.rendLineNumberStart,f=d.lines,p=f.length,m=e.width,_=e.data,C=(o-s+1)*r*m*4;let b=-1,v=-1,S=-1,y=-1,w=-1,L=-1,x=t*r;for(let D=s;D<=o;D++){const k=D-s,N=D-g,R=N>=0&&N<p?f[N].dy:-1;if(R===-1){c[k]=!0,x+=r;continue}const M=R*m*4,A=(R+r)*m*4,O=x*m*4,P=(x+r)*m*4;y===M&&L===O?(y=A,L=P):(S!==-1&&(_.set(u.subarray(S,y),w),b===-1&&S===0&&S===w&&(b=y),v===-1&&y===C&&S===w&&(v=S)),S=M,y=A,w=O,L=P),c[k]=!1,x+=r}S!==-1&&(_.set(u.subarray(S,y),w),b===-1&&S===0&&S===w&&(b=y),v===-1&&y===C&&S===w&&(v=S));const E=b===-1?-1:b/(m*4),I=v===-1?-1:v/(m*4);return[E,I,c]}static _renderLine(e,t,s,o,r,l,c,d,u,g,f,p,m,_,C){const b=m.content,v=m.tokens,S=e.width-l,y=C===1;let w=MINIMAP_GUTTER_WIDTH,L=0,x=0;for(let E=0,I=v.getCount();E<I;E++){const D=v.getEndOffset(E),k=v.getForeground(E),N=c.getColor(k);for(;L<D;L++){if(w>S)return;const R=b.charCodeAt(L);if(R===9){const M=p-(L+x)%p;x+=M-1,w+=M*l}else if(R===32)w+=l;else{const M=isFullWidthCharacter(R)?2:1;for(let A=0;A<M;A++)if(r===2?u.blockRenderChar(e,w,g+f,N,d,t,s,y):u.renderChar(e,w,g+f,R,N,d,t,s,_,o,y),w+=l,w>S)return}}}}}class ContiguousLineMap{constructor(e,t,s){this._startLineNumber=e,this._endLineNumber=t,this._defaultValue=s,this._values=[];for(let o=0,r=this._endLineNumber-this._startLineNumber+1;o<r;o++)this._values[o]=s}has(e){return this.get(e)!==this._defaultValue}set(e,t){e<this._startLineNumber||e>this._endLineNumber||(this._values[e-this._startLineNumber]=t)}get(e){return e<this._startLineNumber||e>this._endLineNumber?this._defaultValue:this._values[e-this._startLineNumber]}}const overlayWidgets="";class ViewOverlayWidgets extends ViewPart{constructor(e,t){super(e),this._viewDomNode=t;const o=this._context.configuration.options.get(165);this._widgets={},this._verticalScrollbarWidth=o.verticalScrollbarWidth,this._minimapWidth=o.minimap.minimapWidth,this._horizontalScrollbarHeight=o.horizontalScrollbarHeight,this._editorHeight=o.height,this._editorWidth=o.width,this._viewDomNodeRect={top:0,left:0,width:0,height:0},this._domNode=createFastDomNode(document.createElement("div")),PartFingerprints.write(this._domNode,4),this._domNode.setClassName("overlayWidgets"),this.overflowingOverlayWidgetsDomNode=createFastDomNode(document.createElement("div")),PartFingerprints.write(this.overflowingOverlayWidgetsDomNode,5),this.overflowingOverlayWidgetsDomNode.setClassName("overflowingOverlayWidgets")}dispose(){super.dispose(),this._widgets={}}getDomNode(){return this._domNode}onConfigurationChanged(e){const s=this._context.configuration.options.get(165);return this._verticalScrollbarWidth=s.verticalScrollbarWidth,this._minimapWidth=s.minimap.minimapWidth,this._horizontalScrollbarHeight=s.horizontalScrollbarHeight,this._editorHeight=s.height,this._editorWidth=s.width,!0}_widgetCanOverflow(e){const s=this._context.configuration.options.get(4);return(e.allowEditorOverflow||!1)&&s}addWidget(e){const t=createFastDomNode(e.getDomNode());this._widgets[e.getId()]={widget:e,preference:null,domNode:t},t.setPosition("absolute"),t.setAttribute("widgetId",e.getId()),this._widgetCanOverflow(e)?this.overflowingOverlayWidgetsDomNode.appendChild(t):this._domNode.appendChild(t),this.setShouldRender(),this._updateMaxMinWidth()}setWidgetPosition(e,t){const s=this._widgets[e.getId()],o=t?t.preference:null,r=t==null?void 0:t.stackOridinal;return s.preference===o&&s.stack===r?(this._updateMaxMinWidth(),!1):(s.preference=o,s.stack=r,this.setShouldRender(),this._updateMaxMinWidth(),!0)}removeWidget(e){const t=e.getId();if(this._widgets.hasOwnProperty(t)){const o=this._widgets[t].domNode.domNode;delete this._widgets[t],o.remove(),this.setShouldRender(),this._updateMaxMinWidth()}}_updateMaxMinWidth(){var s,o;let e=0;const t=Object.keys(this._widgets);for(let r=0,l=t.length;r<l;r++){const c=t[r],u=(o=(s=this._widgets[c].widget).getMinContentWidthInPx)==null?void 0:o.call(s);typeof u<"u"&&(e=Math.max(e,u))}this._context.viewLayout.setOverlayWidgetsMinWidth(e)}_renderWidget(e,t){const s=e.domNode;if(e.preference===null){s.setTop("");return}const o=2*this._verticalScrollbarWidth+this._minimapWidth;if(e.preference===0||e.preference===1){if(e.preference===1){const r=s.domNode.clientHeight;s.setTop(this._editorHeight-r-2*this._horizontalScrollbarHeight)}else s.setTop(0);e.stack!==void 0?(s.setTop(t[e.preference]),t[e.preference]+=s.domNode.clientWidth):s.setRight(o)}else if(e.preference===2)s.domNode.style.right="50%",e.stack!==void 0?(s.setTop(t[2]),t[2]+=s.domNode.clientHeight):s.setTop(0);else{const{top:r,left:l}=e.preference;if(this._context.configuration.options.get(51)&&this._widgetCanOverflow(e.widget)){const d=this._viewDomNodeRect;s.setTop(r+d.top),s.setLeft(l+d.left),s.setPosition("fixed")}else s.setTop(r),s.setLeft(l),s.setPosition("absolute")}}prepareRender(e){this._viewDomNodeRect=getDomNodePagePosition(this._viewDomNode.domNode)}render(e){this._domNode.setWidth(this._editorWidth);const t=Object.keys(this._widgets),s=Array.from({length:2+1},()=>0);t.sort((o,r)=>(this._widgets[o].stack||0)-(this._widgets[r].stack||0));for(let o=0,r=t.length;o<r;o++){const l=t[o];this._renderWidget(this._widgets[l],s)}}}class Viewport{constructor(e,t,s,o){this._viewportBrand=void 0,this.top=e|0,this.left=t|0,this.width=s|0,this.height=o|0}}class MinimapLinesRenderingData{constructor(e,t){this.tabSize=e,this.data=t}}class ViewLineData{constructor(e,t,s,o,r,l,c){this._viewLineDataBrand=void 0,this.content=e,this.continuesWithWrappedLine=t,this.minColumn=s,this.maxColumn=o,this.startVisibleColumn=r,this.tokens=l,this.inlineDecorations=c}}class ViewLineRenderingData{constructor(e,t,s,o,r,l,c,d,u,g,f,p){this.minColumn=e,this.maxColumn=t,this.content=s,this.continuesWithWrappedLine=o,this.isBasicASCII=ViewLineRenderingData.isBasicASCII(s,l),this.containsRTL=ViewLineRenderingData.containsRTL(s,this.isBasicASCII,r),this.tokens=c,this.inlineDecorations=d,this.tabSize=u,this.startVisibleColumn=g,this.textDirection=f,this.hasVariableFonts=p}static isBasicASCII(e,t){return t?isBasicASCII(e):!0}static containsRTL(e,t,s){return!t&&s?containsRTL(e):!1}}class OverviewRulerDecorationsGroup{constructor(e,t,s){this.color=e,this.zIndex=t,this.data=s}static compareByRenderingProps(e,t){return e.zIndex===t.zIndex?e.color<t.color?-1:e.color>t.color?1:0:e.zIndex-t.zIndex}static equals(e,t){return e.color===t.color&&e.zIndex===t.zIndex&&equals$1(e.data,t.data)}static equalsArr(e,t){return equals$1(e,t,OverviewRulerDecorationsGroup.equals)}}class Settings{constructor(e,t){const s=e.options;this.lineHeight=s.get(75),this.pixelRatio=s.get(163),this.overviewRulerLanes=s.get(95),this.renderBorder=s.get(94);const o=t.getColor(editorOverviewRulerBorder);this.borderColor=o?o.toString():null,this.hideCursor=s.get(68);const r=t.getColor(editorCursorForeground);this.cursorColorSingle=r?r.transparent(.7).toString():null;const l=t.getColor(editorMultiCursorPrimaryForeground);this.cursorColorPrimary=l?l.transparent(.7).toString():null;const c=t.getColor(editorMultiCursorSecondaryForeground);this.cursorColorSecondary=c?c.transparent(.7).toString():null,this.themeType=t.type;const d=s.get(81),u=d.enabled,g=d.side,f=t.getColor(editorOverviewRulerBackground),p=TokenizationRegistry.getDefaultBackground();f?this.backgroundColor=f:u&&g==="right"?this.backgroundColor=p:this.backgroundColor=null;const _=s.get(165).overviewRuler;this.top=_.top,this.right=_.right,this.domWidth=_.width,this.domHeight=_.height,this.overviewRulerLanes===0?(this.canvasWidth=0,this.canvasHeight=0):(this.canvasWidth=this.domWidth*this.pixelRatio|0,this.canvasHeight=this.domHeight*this.pixelRatio|0);const[C,b]=this._initLanes(1,this.canvasWidth,this.overviewRulerLanes);this.x=C,this.w=b}_initLanes(e,t,s){const o=t-e;if(s>=3){const r=Math.floor(o/3),l=Math.floor(o/3),c=o-r-l,d=e,u=d+r,g=d+r+c;return[[0,d,u,d,g,d,u,d],[0,r,c,r+c,l,r+c+l,c+l,r+c+l]]}else if(s===2){const r=Math.floor(o/2),l=o-r,c=e,d=c+r;return[[0,c,c,c,d,c,c,c],[0,r,r,r,l,r+l,r+l,r+l]]}else{const r=e,l=o;return[[0,r,r,r,r,r,r,r],[0,l,l,l,l,l,l,l]]}}equals(e){return this.lineHeight===e.lineHeight&&this.pixelRatio===e.pixelRatio&&this.overviewRulerLanes===e.overviewRulerLanes&&this.renderBorder===e.renderBorder&&this.borderColor===e.borderColor&&this.hideCursor===e.hideCursor&&this.cursorColorSingle===e.cursorColorSingle&&this.cursorColorPrimary===e.cursorColorPrimary&&this.cursorColorSecondary===e.cursorColorSecondary&&this.themeType===e.themeType&&Color.equals(this.backgroundColor,e.backgroundColor)&&this.top===e.top&&this.right===e.right&&this.domWidth===e.domWidth&&this.domHeight===e.domHeight&&this.canvasWidth===e.canvasWidth&&this.canvasHeight===e.canvasHeight}}class DecorationsOverviewRuler extends ViewPart{constructor(e){super(e),this._actualShouldRender=0,this._renderedDecorations=[],this._renderedCursorPositions=[],this._domNode=createFastDomNode(document.createElement("canvas")),this._domNode.setClassName("decorationsOverviewRuler"),this._domNode.setPosition("absolute"),this._domNode.setLayerHinting(!0),this._domNode.setContain("strict"),this._domNode.setAttribute("aria-hidden","true"),this._updateSettings(!1),this._tokensColorTrackerListener=TokenizationRegistry.onDidChange(t=>{t.changedColorMap&&this._updateSettings(!0)}),this._cursorPositions=[{position:new Position$1(1,1),color:this._settings.cursorColorSingle}]}dispose(){super.dispose(),this._tokensColorTrackerListener.dispose()}_updateSettings(e){const t=new Settings(this._context.configuration,this._context.theme);return this._settings&&this._settings.equals(t)?!1:(this._settings=t,this._domNode.setTop(this._settings.top),this._domNode.setRight(this._settings.right),this._domNode.setWidth(this._settings.domWidth),this._domNode.setHeight(this._settings.domHeight),this._domNode.domNode.width=this._settings.canvasWidth,this._domNode.domNode.height=this._settings.canvasHeight,e&&this._render(),!0)}_markRenderingIsNeeded(){return this._actualShouldRender=2,!0}_markRenderingIsMaybeNeeded(){return this._actualShouldRender=1,!0}onConfigurationChanged(e){return this._updateSettings(!1)?this._markRenderingIsNeeded():!1}onCursorStateChanged(e){this._cursorPositions=[];for(let t=0,s=e.selections.length;t<s;t++){let o=this._settings.cursorColorSingle;s>1&&(o=t===0?this._settings.cursorColorPrimary:this._settings.cursorColorSecondary),this._cursorPositions.push({position:e.selections[t].getPosition(),color:o})}return this._cursorPositions.sort((t,s)=>Position$1.compare(t.position,s.position)),this._markRenderingIsMaybeNeeded()}onDecorationsChanged(e){return e.affectsOverviewRuler?this._markRenderingIsMaybeNeeded():!1}onFlushed(e){return this._markRenderingIsNeeded()}onScrollChanged(e){return e.scrollHeightChanged?this._markRenderingIsNeeded():!1}onZonesChanged(e){return this._markRenderingIsNeeded()}onThemeChanged(e){return this._updateSettings(!1)?this._markRenderingIsNeeded():!1}getDomNode(){return this._domNode.domNode}prepareRender(e){}render(e){this._render(),this._actualShouldRender=0}_render(){const e=this._settings.backgroundColor;if(this._settings.overviewRulerLanes===0){this._domNode.setBackgroundColor(e?Color.Format.CSS.formatHexA(e):""),this._domNode.setDisplay("none");return}const t=this._context.viewModel.getAllOverviewRulerDecorations(this._context.theme);if(t.sort(OverviewRulerDecorationsGroup.compareByRenderingProps),this._actualShouldRender===1&&!OverviewRulerDecorationsGroup.equalsArr(this._renderedDecorations,t)&&(this._actualShouldRender=2),this._actualShouldRender===1&&!equals$1(this._renderedCursorPositions,this._cursorPositions,(_,C)=>_.position.lineNumber===C.position.lineNumber&&_.color===C.color)&&(this._actualShouldRender=2),this._actualShouldRender===1)return;this._renderedDecorations=t,this._renderedCursorPositions=this._cursorPositions,this._domNode.setDisplay("block");const s=this._settings.canvasWidth,o=this._settings.canvasHeight,r=this._settings.lineHeight,l=this._context.viewLayout,c=this._context.viewLayout.getScrollHeight(),d=o/c,u=6*this._settings.pixelRatio|0,g=u/2|0,f=this._domNode.domNode.getContext("2d");e?e.isOpaque()?(f.fillStyle=Color.Format.CSS.formatHexA(e),f.fillRect(0,0,s,o)):(f.clearRect(0,0,s,o),f.fillStyle=Color.Format.CSS.formatHexA(e),f.fillRect(0,0,s,o)):f.clearRect(0,0,s,o);const p=this._settings.x,m=this._settings.w;for(const _ of t){const C=_.color,b=_.data;f.fillStyle=C;let v=0,S=0,y=0;for(let w=0,L=b.length/3;w<L;w++){const x=b[3*w],E=b[3*w+1],I=b[3*w+2];let D=l.getVerticalOffsetForLineNumber(E)*d|0,k=(l.getVerticalOffsetForLineNumber(I)+r)*d|0;if(k-D<u){let R=(D+k)/2|0;R<g?R=g:R+g>o&&(R=o-g),D=R-g,k=R+g}D>y+1||x!==v?(w!==0&&f.fillRect(p[v],S,m[v],y-S),v=x,S=D,y=k):k>y&&(y=k)}f.fillRect(p[v],S,m[v],y-S)}if(!this._settings.hideCursor){const _=2*this._settings.pixelRatio|0,C=_/2|0,b=this._settings.x[7],v=this._settings.w[7];let S=-100,y=-100,w=null;for(let L=0,x=this._cursorPositions.length;L<x;L++){const E=this._cursorPositions[L].color;if(!E)continue;const I=this._cursorPositions[L].position;let D=l.getVerticalOffsetForLineNumber(I.lineNumber)*d|0;D<C?D=C:D+C>o&&(D=o-C);const k=D-C,N=k+_;k>y+1||E!==w?(L!==0&&w&&f.fillRect(b,S,v,y-S),S=k,y=N):N>y&&(y=N),w=E,f.fillStyle=E}w&&f.fillRect(b,S,v,y-S)}this._settings.renderBorder&&this._settings.borderColor&&this._settings.overviewRulerLanes>0&&(f.beginPath(),f.lineWidth=1,f.strokeStyle=this._settings.borderColor,f.moveTo(0,0),f.lineTo(0,o),f.moveTo(1,0),f.lineTo(s,0),f.stroke())}}class ColorZone{constructor(e,t,s){this._colorZoneBrand=void 0,this.from=e|0,this.to=t|0,this.colorId=s|0}static compare(e,t){return e.colorId===t.colorId?e.from===t.from?e.to-t.to:e.from-t.from:e.colorId-t.colorId}}class OverviewRulerZone{constructor(e,t,s,o){this._overviewRulerZoneBrand=void 0,this.startLineNumber=e,this.endLineNumber=t,this.heightInLines=s,this.color=o,this._colorZone=null}static compare(e,t){return e.color===t.color?e.startLineNumber===t.startLineNumber?e.heightInLines===t.heightInLines?e.endLineNumber-t.endLineNumber:e.heightInLines-t.heightInLines:e.startLineNumber-t.startLineNumber:e.color<t.color?-1:1}setColorZone(e){this._colorZone=e}getColorZones(){return this._colorZone}}class OverviewZoneManager{constructor(e){this._getVerticalOffsetForLine=e,this._zones=[],this._colorZonesInvalid=!1,this._lineHeight=0,this._domWidth=0,this._domHeight=0,this._outerHeight=0,this._pixelRatio=1,this._lastAssignedId=0,this._color2Id=Object.create(null),this._id2Color=[]}getId2Color(){return this._id2Color}setZones(e){this._zones=e,this._zones.sort(OverviewRulerZone.compare)}setLineHeight(e){return this._lineHeight===e?!1:(this._lineHeight=e,this._colorZonesInvalid=!0,!0)}setPixelRatio(e){this._pixelRatio=e,this._colorZonesInvalid=!0}getDOMWidth(){return this._domWidth}getCanvasWidth(){return this._domWidth*this._pixelRatio}setDOMWidth(e){return this._domWidth===e?!1:(this._domWidth=e,this._colorZonesInvalid=!0,!0)}getDOMHeight(){return this._domHeight}getCanvasHeight(){return this._domHeight*this._pixelRatio}setDOMHeight(e){return this._domHeight===e?!1:(this._domHeight=e,this._colorZonesInvalid=!0,!0)}getOuterHeight(){return this._outerHeight}setOuterHeight(e){return this._outerHeight===e?!1:(this._outerHeight=e,this._colorZonesInvalid=!0,!0)}resolveColorZones(){const e=this._colorZonesInvalid,t=Math.floor(this._lineHeight),s=Math.floor(this.getCanvasHeight()),o=Math.floor(this._outerHeight),r=s/o,l=Math.floor(4*this._pixelRatio/2),c=[];for(let d=0,u=this._zones.length;d<u;d++){const g=this._zones[d];if(!e){const w=g.getColorZones();if(w){c.push(w);continue}}const f=this._getVerticalOffsetForLine(g.startLineNumber),p=g.heightInLines===0?this._getVerticalOffsetForLine(g.endLineNumber)+t:f+g.heightInLines*t,m=Math.floor(r*f),_=Math.floor(r*p);let C=Math.floor((m+_)/2),b=_-C;b<l&&(b=l),C-b<0&&(C=b),C+b>s&&(C=s-b);const v=g.color;let S=this._color2Id[v];S||(S=++this._lastAssignedId,this._color2Id[v]=S,this._id2Color[S]=v);const y=new ColorZone(C-b,C+b,S);g.setColorZone(y),c.push(y)}return this._colorZonesInvalid=!1,c.sort(ColorZone.compare),c}}class OverviewRuler extends ViewEventHandler{constructor(e,t){super(),this._context=e;const s=this._context.configuration.options;this._domNode=createFastDomNode(document.createElement("canvas")),this._domNode.setClassName(t),this._domNode.setPosition("absolute"),this._domNode.setLayerHinting(!0),this._domNode.setContain("strict"),this._zoneManager=new OverviewZoneManager(o=>this._context.viewLayout.getVerticalOffsetForLineNumber(o)),this._zoneManager.setDOMWidth(0),this._zoneManager.setDOMHeight(0),this._zoneManager.setOuterHeight(this._context.viewLayout.getScrollHeight()),this._zoneManager.setLineHeight(s.get(75)),this._zoneManager.setPixelRatio(s.get(163)),this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return e.hasChanged(75)&&(this._zoneManager.setLineHeight(t.get(75)),this._render()),e.hasChanged(163)&&(this._zoneManager.setPixelRatio(t.get(163)),this._domNode.setWidth(this._zoneManager.getDOMWidth()),this._domNode.setHeight(this._zoneManager.getDOMHeight()),this._domNode.domNode.width=this._zoneManager.getCanvasWidth(),this._domNode.domNode.height=this._zoneManager.getCanvasHeight(),this._render()),!0}onFlushed(e){return this._render(),!0}onScrollChanged(e){return e.scrollHeightChanged&&(this._zoneManager.setOuterHeight(e.scrollHeight),this._render()),!0}onZonesChanged(e){return this._render(),!0}getDomNode(){return this._domNode.domNode}setLayout(e){this._domNode.setTop(e.top),this._domNode.setRight(e.right);let t=!1;t=this._zoneManager.setDOMWidth(e.width)||t,t=this._zoneManager.setDOMHeight(e.height)||t,t&&(this._domNode.setWidth(this._zoneManager.getDOMWidth()),this._domNode.setHeight(this._zoneManager.getDOMHeight()),this._domNode.domNode.width=this._zoneManager.getCanvasWidth(),this._domNode.domNode.height=this._zoneManager.getCanvasHeight(),this._render())}setZones(e){this._zoneManager.setZones(e),this._render()}_render(){if(this._zoneManager.getOuterHeight()===0)return!1;const e=this._zoneManager.getCanvasWidth(),t=this._zoneManager.getCanvasHeight(),s=this._zoneManager.resolveColorZones(),o=this._zoneManager.getId2Color(),r=this._domNode.domNode.getContext("2d");return r.clearRect(0,0,e,t),s.length>0&&this._renderOneLane(r,s,o,e),!0}_renderOneLane(e,t,s,o){let r=0,l=0,c=0;for(const d of t){const u=d.colorId,g=d.from,f=d.to;u!==r?(e.fillRect(0,l,o,c-l),r=u,e.fillStyle=s[r],l=g,c=f):c>=g?c=Math.max(c,f):(e.fillRect(0,l,o,c-l),l=g,c=f)}e.fillRect(0,l,o,c-l)}}const rulers="";class Rulers extends ViewPart{constructor(e){super(e),this.domNode=createFastDomNode(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.domNode.setClassName("view-rulers"),this._renderedRulers=[];const t=this._context.configuration.options;this._rulers=t.get(116),this._typicalHalfwidthCharacterWidth=t.get(59).typicalHalfwidthCharacterWidth}dispose(){super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return this._rulers=t.get(116),this._typicalHalfwidthCharacterWidth=t.get(59).typicalHalfwidthCharacterWidth,!0}onScrollChanged(e){return e.scrollHeightChanged}prepareRender(e){}_ensureRulersCount(){const e=this._renderedRulers.length,t=this._rulers.length;if(e===t)return;if(e<t){const{tabSize:o}=this._context.viewModel.model.getOptions(),r=o;let l=t-e;for(;l>0;){const c=createFastDomNode(document.createElement("div"));c.setClassName("view-ruler"),c.setWidth(r),this.domNode.appendChild(c),this._renderedRulers.push(c),l--}return}let s=e-t;for(;s>0;){const o=this._renderedRulers.pop();this.domNode.removeChild(o),s--}}render(e){this._ensureRulersCount();for(let t=0,s=this._rulers.length;t<s;t++){const o=this._renderedRulers[t],r=this._rulers[t];o.setBoxShadow(r.color?`1px 0 0 0 ${r.color} inset`:""),o.setHeight(Math.min(e.scrollHeight,1e6)),o.setLeft(r.column*this._typicalHalfwidthCharacterWidth)}}}const scrollDecoration="";class ScrollDecorationViewPart extends ViewPart{constructor(e){super(e),this._scrollTop=0,this._width=0,this._updateWidth(),this._shouldShow=!1;const s=this._context.configuration.options.get(117);this._useShadows=s.useShadows,this._domNode=createFastDomNode(document.createElement("div")),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true")}dispose(){super.dispose()}_updateShouldShow(){const e=this._useShadows&&this._scrollTop>0;return this._shouldShow!==e?(this._shouldShow=e,!0):!1}getDomNode(){return this._domNode}_updateWidth(){const t=this._context.configuration.options.get(165);t.minimap.renderMinimap===0||t.minimap.minimapWidth>0&&t.minimap.minimapLeft===0?this._width=t.width:this._width=t.width-t.verticalScrollbarWidth}onConfigurationChanged(e){const s=this._context.configuration.options.get(117);return this._useShadows=s.useShadows,this._updateWidth(),this._updateShouldShow(),!0}onScrollChanged(e){return this._scrollTop=e.scrollTop,this._updateShouldShow()}prepareRender(e){}render(e){this._domNode.setWidth(this._width),this._domNode.setClassName(this._shouldShow?"scroll-decoration":"")}}const selections="";class HorizontalRangeWithStyle{constructor(e){this.left=e.left,this.width=e.width,this.startStyle=null,this.endStyle=null}}class LineVisibleRangesWithStyle{constructor(e,t){this.lineNumber=e,this.ranges=t}}function toStyledRange(a){return new HorizontalRangeWithStyle(a)}function toStyled(a){return new LineVisibleRangesWithStyle(a.lineNumber,a.ranges.map(toStyledRange))}const ie=class ie extends DynamicViewOverlay{constructor(e){super(),this._previousFrameVisibleRangesWithStyle=[],this._context=e;const t=this._context.configuration.options;this._roundedSelection=t.get(115),this._typicalHalfwidthCharacterWidth=t.get(59).typicalHalfwidthCharacterWidth,this._selections=[],this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return this._roundedSelection=t.get(115),this._typicalHalfwidthCharacterWidth=t.get(59).typicalHalfwidthCharacterWidth,!0}onCursorStateChanged(e){return this._selections=e.selections.slice(0),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_visibleRangesHaveGaps(e){for(let t=0,s=e.length;t<s;t++)if(e[t].ranges.length>1)return!0;return!1}_enrichVisibleRangesWithStyle(e,t,s){const o=this._typicalHalfwidthCharacterWidth/4;let r=null,l=null;if(s&&s.length>0&&t.length>0){const c=t[0].lineNumber;if(c===e.startLineNumber)for(let u=0;!r&&u<s.length;u++)s[u].lineNumber===c&&(r=s[u].ranges[0]);const d=t[t.length-1].lineNumber;if(d===e.endLineNumber)for(let u=s.length-1;!l&&u>=0;u--)s[u].lineNumber===d&&(l=s[u].ranges[0]);r&&!r.startStyle&&(r=null),l&&!l.startStyle&&(l=null)}for(let c=0,d=t.length;c<d;c++){const u=t[c].ranges[0],g=u.left,f=u.left+u.width,p={top:0,bottom:0},m={top:0,bottom:0};if(c>0){const _=t[c-1].ranges[0].left,C=t[c-1].ranges[0].left+t[c-1].ranges[0].width;abs(g-_)<o?p.top=2:g>_&&(p.top=1),abs(f-C)<o?m.top=2:_<f&&f<C&&(m.top=1)}else r&&(p.top=r.startStyle.top,m.top=r.endStyle.top);if(c+1<d){const _=t[c+1].ranges[0].left,C=t[c+1].ranges[0].left+t[c+1].ranges[0].width;abs(g-_)<o?p.bottom=2:_<g&&g<C&&(p.bottom=1),abs(f-C)<o?m.bottom=2:f<C&&(m.bottom=1)}else l&&(p.bottom=l.startStyle.bottom,m.bottom=l.endStyle.bottom);u.startStyle=p,u.endStyle=m}}_getVisibleRangesWithStyle(e,t,s){const r=(t.linesVisibleRangesForRange(e,!0)||[]).map(toStyled);return!this._visibleRangesHaveGaps(r)&&this._roundedSelection&&this._enrichVisibleRangesWithStyle(t.visibleRange,r,s),r}_createSelectionPiece(e,t,s,o,r){return'<div class="cslr '+s+'" style="top:'+e.toString()+"px;bottom:"+t.toString()+"px;left:"+o.toString()+"px;width:"+r.toString()+'px;"></div>'}_actualRenderOneSelection(e,t,s,o){if(o.length===0)return;const r=!!o[0].ranges[0].startStyle,l=o[0].lineNumber,c=o[o.length-1].lineNumber;for(let d=0,u=o.length;d<u;d++){const g=o[d],f=g.lineNumber,p=f-t,m=s&&f===l?1:0,_=s&&f!==l&&f===c?1:0;let C="",b="";for(let v=0,S=g.ranges.length;v<S;v++){const y=g.ranges[v];if(r){const L=y.startStyle,x=y.endStyle;if(L.top===1||L.bottom===1){C+=this._createSelectionPiece(m,_,ie.SELECTION_CLASS_NAME,y.left-ie.ROUNDED_PIECE_WIDTH,ie.ROUNDED_PIECE_WIDTH);let E=ie.EDITOR_BACKGROUND_CLASS_NAME;L.top===1&&(E+=" "+ie.SELECTION_TOP_RIGHT),L.bottom===1&&(E+=" "+ie.SELECTION_BOTTOM_RIGHT),C+=this._createSelectionPiece(m,_,E,y.left-ie.ROUNDED_PIECE_WIDTH,ie.ROUNDED_PIECE_WIDTH)}if(x.top===1||x.bottom===1){C+=this._createSelectionPiece(m,_,ie.SELECTION_CLASS_NAME,y.left+y.width,ie.ROUNDED_PIECE_WIDTH);let E=ie.EDITOR_BACKGROUND_CLASS_NAME;x.top===1&&(E+=" "+ie.SELECTION_TOP_LEFT),x.bottom===1&&(E+=" "+ie.SELECTION_BOTTOM_LEFT),C+=this._createSelectionPiece(m,_,E,y.left+y.width,ie.ROUNDED_PIECE_WIDTH)}}let w=ie.SELECTION_CLASS_NAME;if(r){const L=y.startStyle,x=y.endStyle;L.top===0&&(w+=" "+ie.SELECTION_TOP_LEFT),L.bottom===0&&(w+=" "+ie.SELECTION_BOTTOM_LEFT),x.top===0&&(w+=" "+ie.SELECTION_TOP_RIGHT),x.bottom===0&&(w+=" "+ie.SELECTION_BOTTOM_RIGHT)}b+=this._createSelectionPiece(m,_,w,y.left,y.width)}e[p][0]+=C,e[p][1]+=b}}prepareRender(e){const t=[],s=e.visibleRange.startLineNumber,o=e.visibleRange.endLineNumber;for(let l=s;l<=o;l++){const c=l-s;t[c]=["",""]}const r=[];for(let l=0,c=this._selections.length;l<c;l++){const d=this._selections[l];if(d.isEmpty()){r[l]=null;continue}const u=this._getVisibleRangesWithStyle(d,e,this._previousFrameVisibleRangesWithStyle[l]);r[l]=u,this._actualRenderOneSelection(t,s,this._selections.length>1,u)}this._previousFrameVisibleRangesWithStyle=r,this._renderResult=t.map(([l,c])=>l+c)}render(e,t){if(!this._renderResult)return"";const s=t-e;return s<0||s>=this._renderResult.length?"":this._renderResult[s]}};ie.SELECTION_CLASS_NAME="selected-text",ie.SELECTION_TOP_LEFT="top-left-radius",ie.SELECTION_BOTTOM_LEFT="bottom-left-radius",ie.SELECTION_TOP_RIGHT="top-right-radius",ie.SELECTION_BOTTOM_RIGHT="bottom-right-radius",ie.EDITOR_BACKGROUND_CLASS_NAME="monaco-editor-background",ie.ROUNDED_PIECE_WIDTH=10;let SelectionsOverlay=ie;registerThemingParticipant((a,e)=>{const t=a.getColor(editorSelectionForeground);t&&!t.isTransparent()&&e.addRule(`.monaco-editor .view-line span.inline-selected-text { color: ${t}; }`)});function abs(a){return a<0?-a:a}const viewCursors="";class ViewCursorRenderData{constructor(e,t,s,o,r,l,c){this.top=e,this.left=t,this.paddingLeft=s,this.width=o,this.height=r,this.textContent=l,this.textContentClassName=c}}var CursorPlurality;(function(a){a[a.Single=0]="Single",a[a.MultiPrimary=1]="MultiPrimary",a[a.MultiSecondary=2]="MultiSecondary"})(CursorPlurality||(CursorPlurality={}));class ViewCursor{constructor(e,t){this._context=e;const s=this._context.configuration.options,o=s.get(59);this._cursorStyle=s.get(161),this._typicalHalfwidthCharacterWidth=o.typicalHalfwidthCharacterWidth,this._lineCursorWidth=Math.min(s.get(37),this._typicalHalfwidthCharacterWidth),this._lineCursorHeight=s.get(38),this._isVisible=!0,this._domNode=createFastDomNode(document.createElement("div")),this._domNode.setClassName(`cursor ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`),this._domNode.setHeight(this._context.viewLayout.getLineHeightForLineNumber(1)),this._domNode.setTop(0),this._domNode.setLeft(0),applyFontInfo(this._domNode,o),this._domNode.setDisplay("none"),this._position=new Position$1(1,1),this._pluralityClass="",this.setPlurality(t),this._lastRenderedContent="",this._renderData=null}getDomNode(){return this._domNode}getPosition(){return this._position}setPlurality(e){switch(e){default:case CursorPlurality.Single:this._pluralityClass="";break;case CursorPlurality.MultiPrimary:this._pluralityClass="cursor-primary";break;case CursorPlurality.MultiSecondary:this._pluralityClass="cursor-secondary";break}}show(){this._isVisible||(this._domNode.setVisibility("inherit"),this._isVisible=!0)}hide(){this._isVisible&&(this._domNode.setVisibility("hidden"),this._isVisible=!1)}onConfigurationChanged(e){const t=this._context.configuration.options,s=t.get(59);return this._cursorStyle=t.get(161),this._typicalHalfwidthCharacterWidth=s.typicalHalfwidthCharacterWidth,this._lineCursorWidth=Math.min(t.get(37),this._typicalHalfwidthCharacterWidth),this._lineCursorHeight=t.get(38),applyFontInfo(this._domNode,s),!0}onCursorPositionChanged(e,t){return t?this._domNode.domNode.style.transitionProperty="none":this._domNode.domNode.style.transitionProperty="",this._position=e,!0}_getGraphemeAwarePosition(){const{lineNumber:e,column:t}=this._position,s=this._context.viewModel.getLineContent(e),[o,r]=getCharContainingOffset(s,t-1);return[new Position$1(e,o+1),s.substring(o,r)]}_prepareRender(e){let t="",s="";const[o,r]=this._getGraphemeAwarePosition(),l=this._context.viewLayout.getLineHeightForLineNumber(o.lineNumber),c=this._lineCursorHeight===0?l:Math.min(l,this._lineCursorHeight),d=(l-c)/2;if(this._cursorStyle===TextEditorCursorStyle$1.Line||this._cursorStyle===TextEditorCursorStyle$1.LineThin){const C=e.visibleRangeForPosition(o);if(!C||C.outsideRenderedLine)return null;const b=getWindow(this._domNode.domNode);let v;this._cursorStyle===TextEditorCursorStyle$1.Line?(v=computeScreenAwareSize(b,this._lineCursorWidth>0?this._lineCursorWidth:2),v>2&&(t=r,s=this._getTokenClassName(o))):v=computeScreenAwareSize(b,1);let S=C.left,y=0;v>=2&&S>=1&&(y=1,S-=y);const w=e.getVerticalOffsetForLineNumber(o.lineNumber)-e.bigNumbersDelta+d;return new ViewCursorRenderData(w,S,y,v,c,t,s)}const u=e.linesVisibleRangesForRange(new Range$2(o.lineNumber,o.column,o.lineNumber,o.column+r.length),!1);if(!u||u.length===0)return null;const g=u[0];if(g.outsideRenderedLine||g.ranges.length===0)return null;const f=g.ranges[0],p=r==="	"?this._typicalHalfwidthCharacterWidth:f.width<1?this._typicalHalfwidthCharacterWidth:f.width;this._cursorStyle===TextEditorCursorStyle$1.Block&&(t=r,s=this._getTokenClassName(o));let m=e.getVerticalOffsetForLineNumber(o.lineNumber)-e.bigNumbersDelta,_=l;return(this._cursorStyle===TextEditorCursorStyle$1.Underline||this._cursorStyle===TextEditorCursorStyle$1.UnderlineThin)&&(m+=l-2,_=2),new ViewCursorRenderData(m,f.left,0,p,_,t,s)}_getTokenClassName(e){const t=this._context.viewModel.getViewLineData(e.lineNumber),s=t.tokens.findTokenIndexAtOffset(e.column-1);return t.tokens.getClassName(s)}prepareRender(e){this._renderData=this._prepareRender(e)}render(e){return this._renderData?(this._lastRenderedContent!==this._renderData.textContent&&(this._lastRenderedContent=this._renderData.textContent,this._domNode.domNode.textContent=this._lastRenderedContent),this._domNode.setClassName(`cursor ${this._pluralityClass} ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME} ${this._renderData.textContentClassName}`),this._domNode.setDisplay("block"),this._domNode.setTop(this._renderData.top),this._domNode.setLeft(this._renderData.left),this._domNode.setPaddingLeft(this._renderData.paddingLeft),this._domNode.setWidth(this._renderData.width),this._domNode.setLineHeight(this._renderData.height),this._domNode.setHeight(this._renderData.height),{domNode:this._domNode.domNode,position:this._position,contentLeft:this._renderData.left,height:this._renderData.height,width:2}):(this._domNode.setDisplay("none"),null)}}const fn=class fn extends ViewPart{constructor(e){super(e);const t=this._context.configuration.options;this._readOnly=t.get(104),this._cursorBlinking=t.get(32),this._cursorStyle=t.get(161),this._cursorSmoothCaretAnimation=t.get(33),this._editContextEnabled=t.get(170),this._selectionIsEmpty=!0,this._isComposingInput=!1,this._isVisible=!1,this._primaryCursor=new ViewCursor(this._context,CursorPlurality.Single),this._secondaryCursors=[],this._renderData=[],this._domNode=createFastDomNode(document.createElement("div")),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._updateDomClassName(),this._domNode.appendChild(this._primaryCursor.getDomNode()),this._startCursorBlinkAnimation=new TimeoutTimer,this._cursorFlatBlinkInterval=new WindowIntervalTimer,this._blinkingEnabled=!1,this._editorHasFocus=!1,this._updateBlinking()}dispose(){super.dispose(),this._startCursorBlinkAnimation.dispose(),this._cursorFlatBlinkInterval.dispose()}getDomNode(){return this._domNode}onCompositionStart(e){return this._isComposingInput=!0,this._updateBlinking(),!0}onCompositionEnd(e){return this._isComposingInput=!1,this._updateBlinking(),!0}onConfigurationChanged(e){const t=this._context.configuration.options;this._readOnly=t.get(104),this._cursorBlinking=t.get(32),this._cursorStyle=t.get(161),this._cursorSmoothCaretAnimation=t.get(33),this._editContextEnabled=t.get(170),this._updateBlinking(),this._updateDomClassName(),this._primaryCursor.onConfigurationChanged(e);for(let s=0,o=this._secondaryCursors.length;s<o;s++)this._secondaryCursors[s].onConfigurationChanged(e);return!0}_onCursorPositionChanged(e,t,s){const o=this._secondaryCursors.length!==t.length||this._cursorSmoothCaretAnimation==="explicit"&&s!==3;if(this._primaryCursor.setPlurality(t.length?CursorPlurality.MultiPrimary:CursorPlurality.Single),this._primaryCursor.onCursorPositionChanged(e,o),this._updateBlinking(),this._secondaryCursors.length<t.length){const r=t.length-this._secondaryCursors.length;for(let l=0;l<r;l++){const c=new ViewCursor(this._context,CursorPlurality.MultiSecondary);this._domNode.domNode.insertBefore(c.getDomNode().domNode,this._primaryCursor.getDomNode().domNode.nextSibling),this._secondaryCursors.push(c)}}else if(this._secondaryCursors.length>t.length){const r=this._secondaryCursors.length-t.length;for(let l=0;l<r;l++)this._domNode.removeChild(this._secondaryCursors[0].getDomNode()),this._secondaryCursors.splice(0,1)}for(let r=0;r<t.length;r++)this._secondaryCursors[r].onCursorPositionChanged(t[r],o)}onCursorStateChanged(e){const t=[];for(let o=0,r=e.selections.length;o<r;o++)t[o]=e.selections[o].getPosition();this._onCursorPositionChanged(t[0],t.slice(1),e.reason);const s=e.selections[0].isEmpty();return this._selectionIsEmpty!==s&&(this._selectionIsEmpty=s,this._updateDomClassName()),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onFocusChanged(e){return this._editorHasFocus=e.isFocused,this._updateBlinking(),!1}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return!0}onTokensChanged(e){const t=s=>{for(let o=0,r=e.ranges.length;o<r;o++)if(e.ranges[o].fromLineNumber<=s.lineNumber&&s.lineNumber<=e.ranges[o].toLineNumber)return!0;return!1};if(t(this._primaryCursor.getPosition()))return!0;for(const s of this._secondaryCursors)if(t(s.getPosition()))return!0;return!1}onZonesChanged(e){return!0}_getCursorBlinking(){return this._isComposingInput&&!this._editContextEnabled||!this._editorHasFocus?0:this._readOnly?5:this._cursorBlinking}_updateBlinking(){this._startCursorBlinkAnimation.cancel(),this._cursorFlatBlinkInterval.cancel();const e=this._getCursorBlinking(),t=e===0,s=e===5;t?this._hide():this._show(),this._blinkingEnabled=!1,this._updateDomClassName(),!t&&!s&&(e===1?this._cursorFlatBlinkInterval.cancelAndSet(()=>{this._isVisible?this._hide():this._show()},fn.BLINK_INTERVAL,getWindow(this._domNode.domNode)):this._startCursorBlinkAnimation.setIfNotSet(()=>{this._blinkingEnabled=!0,this._updateDomClassName()},fn.BLINK_INTERVAL))}_updateDomClassName(){this._domNode.setClassName(this._getClassName())}_getClassName(){let e="cursors-layer";switch(this._selectionIsEmpty||(e+=" has-selection"),this._cursorStyle){case TextEditorCursorStyle$1.Line:e+=" cursor-line-style";break;case TextEditorCursorStyle$1.Block:e+=" cursor-block-style";break;case TextEditorCursorStyle$1.Underline:e+=" cursor-underline-style";break;case TextEditorCursorStyle$1.LineThin:e+=" cursor-line-thin-style";break;case TextEditorCursorStyle$1.BlockOutline:e+=" cursor-block-outline-style";break;case TextEditorCursorStyle$1.UnderlineThin:e+=" cursor-underline-thin-style";break;default:e+=" cursor-line-style"}if(this._blinkingEnabled)switch(this._getCursorBlinking()){case 1:e+=" cursor-blink";break;case 2:e+=" cursor-smooth";break;case 3:e+=" cursor-phase";break;case 4:e+=" cursor-expand";break;case 5:e+=" cursor-solid";break;default:e+=" cursor-solid"}else e+=" cursor-solid";return(this._cursorSmoothCaretAnimation==="on"||this._cursorSmoothCaretAnimation==="explicit")&&(e+=" cursor-smooth-caret-animation"),e}_show(){this._primaryCursor.show();for(let e=0,t=this._secondaryCursors.length;e<t;e++)this._secondaryCursors[e].show();this._isVisible=!0}_hide(){this._primaryCursor.hide();for(let e=0,t=this._secondaryCursors.length;e<t;e++)this._secondaryCursors[e].hide();this._isVisible=!1}prepareRender(e){this._primaryCursor.prepareRender(e);for(let t=0,s=this._secondaryCursors.length;t<s;t++)this._secondaryCursors[t].prepareRender(e)}render(e){const t=[];let s=0;const o=this._primaryCursor.render(e);o&&(t[s++]=o);for(let r=0,l=this._secondaryCursors.length;r<l;r++){const c=this._secondaryCursors[r].render(e);c&&(t[s++]=c)}this._renderData=t}getLastRenderData(){return this._renderData}};fn.BLINK_INTERVAL=500;let ViewCursors=fn;registerThemingParticipant((a,e)=>{const t=[{class:".cursor",foreground:editorCursorForeground,background:editorCursorBackground},{class:".cursor-primary",foreground:editorMultiCursorPrimaryForeground,background:editorMultiCursorPrimaryBackground},{class:".cursor-secondary",foreground:editorMultiCursorSecondaryForeground,background:editorMultiCursorSecondaryBackground}];for(const s of t){const o=a.getColor(s.foreground);if(o){let r=a.getColor(s.background);r||(r=o.opposite()),e.addRule(`.monaco-editor .cursors-layer ${s.class} { background-color: ${o}; border-color: ${o}; color: ${r}; }`),isHighContrast(a.type)&&e.addRule(`.monaco-editor .cursors-layer.has-selection ${s.class} { border-left: 1px solid ${r}; border-right: 1px solid ${r}; }`)}}});const invalidFunc$1=()=>{throw new Error("Invalid change accessor")};class ViewZones extends ViewPart{constructor(e){super(e);const t=this._context.configuration.options,s=t.get(165);this._lineHeight=t.get(75),this._contentWidth=s.contentWidth,this._contentLeft=s.contentLeft,this.domNode=createFastDomNode(document.createElement("div")),this.domNode.setClassName("view-zones"),this.domNode.setPosition("absolute"),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.marginDomNode=createFastDomNode(document.createElement("div")),this.marginDomNode.setClassName("margin-view-zones"),this.marginDomNode.setPosition("absolute"),this.marginDomNode.setAttribute("role","presentation"),this.marginDomNode.setAttribute("aria-hidden","true"),this._zones={}}dispose(){super.dispose(),this._zones={}}_recomputeWhitespacesProps(){const e=this._context.viewLayout.getWhitespaces(),t=new Map;for(const o of e)t.set(o.id,o);let s=!1;return this._context.viewModel.changeWhitespace(o=>{const r=Object.keys(this._zones);for(let l=0,c=r.length;l<c;l++){const d=r[l],u=this._zones[d],g=this._computeWhitespaceProps(u.delegate);u.isInHiddenArea=g.isInHiddenArea;const f=t.get(d);f&&(f.afterLineNumber!==g.afterViewLineNumber||f.height!==g.heightInPx)&&(o.changeOneWhitespace(d,g.afterViewLineNumber,g.heightInPx),this._safeCallOnComputedHeight(u.delegate,g.heightInPx),s=!0)}}),s}onConfigurationChanged(e){const t=this._context.configuration.options,s=t.get(165);return this._lineHeight=t.get(75),this._contentWidth=s.contentWidth,this._contentLeft=s.contentLeft,e.hasChanged(75)&&this._recomputeWhitespacesProps(),!0}onLineMappingChanged(e){return this._recomputeWhitespacesProps()}onLinesDeleted(e){return!0}onScrollChanged(e){return e.scrollTopChanged||e.scrollWidthChanged}onZonesChanged(e){return!0}onLinesInserted(e){return!0}_getZoneOrdinal(e){return e.ordinal??e.afterColumn??1e4}_computeWhitespaceProps(e){if(e.afterLineNumber===0)return{isInHiddenArea:!1,afterViewLineNumber:0,heightInPx:this._heightInPixels(e),minWidthInPx:this._minWidthInPixels(e)};let t;if(typeof e.afterColumn<"u")t=this._context.viewModel.model.validatePosition({lineNumber:e.afterLineNumber,column:e.afterColumn});else{const l=this._context.viewModel.model.validatePosition({lineNumber:e.afterLineNumber,column:1}).lineNumber;t=new Position$1(l,this._context.viewModel.model.getLineMaxColumn(l))}let s;t.column===this._context.viewModel.model.getLineMaxColumn(t.lineNumber)?s=this._context.viewModel.model.validatePosition({lineNumber:t.lineNumber+1,column:1}):s=this._context.viewModel.model.validatePosition({lineNumber:t.lineNumber,column:t.column+1});const o=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(t,e.afterColumnAffinity,!0),r=e.showInHiddenAreas||this._context.viewModel.coordinatesConverter.modelPositionIsVisible(s);return{isInHiddenArea:!r,afterViewLineNumber:o.lineNumber,heightInPx:r?this._heightInPixels(e):0,minWidthInPx:this._minWidthInPixels(e)}}changeViewZones(e){let t=!1;return this._context.viewModel.changeWhitespace(s=>{const o={addZone:r=>(t=!0,this._addZone(s,r)),removeZone:r=>{r&&(t=this._removeZone(s,r)||t)},layoutZone:r=>{r&&(t=this._layoutZone(s,r)||t)}};safeInvoke1Arg(e,o),o.addZone=invalidFunc$1,o.removeZone=invalidFunc$1,o.layoutZone=invalidFunc$1}),t}_addZone(e,t){const s=this._computeWhitespaceProps(t),r={whitespaceId:e.insertWhitespace(s.afterViewLineNumber,this._getZoneOrdinal(t),s.heightInPx,s.minWidthInPx),delegate:t,isInHiddenArea:s.isInHiddenArea,isVisible:!1,domNode:createFastDomNode(t.domNode),marginDomNode:t.marginDomNode?createFastDomNode(t.marginDomNode):null};return this._safeCallOnComputedHeight(r.delegate,s.heightInPx),r.domNode.setPosition("absolute"),r.domNode.domNode.style.width="100%",r.domNode.setDisplay("none"),r.domNode.setAttribute("monaco-view-zone",r.whitespaceId),this.domNode.appendChild(r.domNode),r.marginDomNode&&(r.marginDomNode.setPosition("absolute"),r.marginDomNode.domNode.style.width="100%",r.marginDomNode.setDisplay("none"),r.marginDomNode.setAttribute("monaco-view-zone",r.whitespaceId),this.marginDomNode.appendChild(r.marginDomNode)),this._zones[r.whitespaceId]=r,this.setShouldRender(),r.whitespaceId}_removeZone(e,t){if(this._zones.hasOwnProperty(t)){const s=this._zones[t];return delete this._zones[t],e.removeWhitespace(s.whitespaceId),s.domNode.removeAttribute("monaco-visible-view-zone"),s.domNode.removeAttribute("monaco-view-zone"),s.domNode.domNode.remove(),s.marginDomNode&&(s.marginDomNode.removeAttribute("monaco-visible-view-zone"),s.marginDomNode.removeAttribute("monaco-view-zone"),s.marginDomNode.domNode.remove()),this.setShouldRender(),!0}return!1}_layoutZone(e,t){if(this._zones.hasOwnProperty(t)){const s=this._zones[t],o=this._computeWhitespaceProps(s.delegate);return s.isInHiddenArea=o.isInHiddenArea,e.changeOneWhitespace(s.whitespaceId,o.afterViewLineNumber,o.heightInPx),this._safeCallOnComputedHeight(s.delegate,o.heightInPx),this.setShouldRender(),!0}return!1}shouldSuppressMouseDownOnViewZone(e){return this._zones.hasOwnProperty(e)?!!this._zones[e].delegate.suppressMouseDown:!1}_heightInPixels(e){return typeof e.heightInPx=="number"?e.heightInPx:typeof e.heightInLines=="number"?this._lineHeight*e.heightInLines:this._lineHeight}_minWidthInPixels(e){return typeof e.minWidthInPx=="number"?e.minWidthInPx:0}_safeCallOnComputedHeight(e,t){if(typeof e.onComputedHeight=="function")try{e.onComputedHeight(t)}catch(s){onUnexpectedError(s)}}_safeCallOnDomNodeTop(e,t){if(typeof e.onDomNodeTop=="function")try{e.onDomNodeTop(t)}catch(s){onUnexpectedError(s)}}prepareRender(e){}render(e){const t=e.viewportData.whitespaceViewportData,s={};let o=!1;for(const l of t)this._zones[l.id].isInHiddenArea||(s[l.id]=l,o=!0);const r=Object.keys(this._zones);for(let l=0,c=r.length;l<c;l++){const d=r[l],u=this._zones[d];let g=0,f=0,p="none";s.hasOwnProperty(d)?(g=s[d].verticalOffset-e.bigNumbersDelta,f=s[d].height,p="block",u.isVisible||(u.domNode.setAttribute("monaco-visible-view-zone","true"),u.isVisible=!0),this._safeCallOnDomNodeTop(u.delegate,e.getScrolledTopFromAbsoluteTop(s[d].verticalOffset))):(u.isVisible&&(u.domNode.removeAttribute("monaco-visible-view-zone"),u.isVisible=!1),this._safeCallOnDomNodeTop(u.delegate,e.getScrolledTopFromAbsoluteTop(-1e6))),u.domNode.setTop(g),u.domNode.setHeight(f),u.domNode.setDisplay(p),u.marginDomNode&&(u.marginDomNode.setTop(g),u.marginDomNode.setHeight(f),u.marginDomNode.setDisplay(p))}o&&(this.domNode.setWidth(Math.max(e.scrollWidth,this._contentWidth)),this.marginDomNode.setWidth(this._contentLeft))}}function safeInvoke1Arg(a,e){try{return a(e)}catch(t){onUnexpectedError(t)}}const whitespace="";class WhitespaceOverlay extends DynamicViewOverlay{constructor(e){super(),this._context=e,this._options=new WhitespaceOptions(this._context.configuration),this._selection=[],this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=new WhitespaceOptions(this._context.configuration);return this._options.equals(t)?e.hasChanged(165):(this._options=t,!0)}onCursorStateChanged(e){return this._selection=e.selections,this._options.renderWhitespace==="selection"}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}prepareRender(e){if(this._options.renderWhitespace==="none"){this._renderResult=null;return}const t=e.visibleRange.startLineNumber,o=e.visibleRange.endLineNumber-t+1,r=new Array(o);for(let l=0;l<o;l++)r[l]=!0;this._renderResult=[];for(let l=e.viewportData.startLineNumber;l<=e.viewportData.endLineNumber;l++){const c=l-e.viewportData.startLineNumber,d=this._context.viewModel.getViewLineRenderingData(l);let u=null;if(this._options.renderWhitespace==="selection"){const g=this._selection;for(const f of g){if(f.endLineNumber<l||f.startLineNumber>l)continue;const p=f.startLineNumber===l?f.startColumn:d.minColumn,m=f.endLineNumber===l?f.endColumn:d.maxColumn;p<m&&(u||(u=[]),u.push(new OffsetRange(p-1,m-1)))}}this._renderResult[c]=this._applyRenderWhitespace(e,l,u,d)}}_applyRenderWhitespace(e,t,s,o){if(o.hasVariableFonts||this._options.renderWhitespace==="selection"&&!s||this._options.renderWhitespace==="trailing"&&o.continuesWithWrappedLine)return"";const r=this._context.theme.getColor(editorWhitespaces),l=this._options.renderWithSVG,c=o.content,d=this._options.stopRenderingLineAfter===-1?c.length:Math.min(this._options.stopRenderingLineAfter,c.length),u=o.continuesWithWrappedLine,g=o.minColumn-1,f=this._options.renderWhitespace==="boundary",p=this._options.renderWhitespace==="trailing",m=e.getLineHeightForLineNumber(t),_=this._options.middotWidth,C=this._options.wsmiddotWidth,b=this._options.spaceWidth,v=Math.abs(C-b),S=Math.abs(_-b),y=v<S?11825:183,w=this._options.canUseHalfwidthRightwardsArrow;let L="",x=!1,E=firstNonWhitespaceIndex(c),I;E===-1?(x=!0,E=d,I=d):I=lastNonWhitespaceIndex(c);let D=0,k=s&&s[D],N=0;for(let R=g;R<d;R++){const M=c.charCodeAt(R);if(k&&k.endExclusive<=R&&(D++,k=s&&s[D]),M!==9&&M!==32||p&&!x&&R<=I)continue;if(f&&R>=E&&R<=I&&M===32){const O=R-1>=0?c.charCodeAt(R-1):0,P=R+1<d?c.charCodeAt(R+1):0;if(O!==32&&P!==32)continue}if(f&&u&&R===d-1){const O=R-1>=0?c.charCodeAt(R-1):0;if(M===32&&O!==32&&O!==9)continue}if(s&&!(k&&k.start<=R&&R<k.endExclusive))continue;const A=e.visibleRangeForPosition(new Position$1(t,R+1));A&&(l?(N=Math.max(N,A.left),M===9?L+=this._renderArrow(m,b,A.left):L+=`<circle cx="${(A.left+b/2).toFixed(2)}" cy="${(m/2).toFixed(2)}" r="${(b/7).toFixed(2)}" />`):M===9?L+=`<div class="mwh" style="left:${A.left}px;height:${m}px;">${w?String.fromCharCode(65515):String.fromCharCode(8594)}</div>`:L+=`<div class="mwh" style="left:${A.left}px;height:${m}px;">${String.fromCharCode(y)}</div>`)}return l?(N=Math.round(N+b),`<svg style="bottom:0;position:absolute;width:${N}px;height:${m}px" viewBox="0 0 ${N} ${m}" xmlns="http://www.w3.org/2000/svg" fill="${r}">`+L+"</svg>"):L}_renderArrow(e,t,s){const o=t/7,r=t,l=e/2,c=s,d={x:0,y:o/2},u={x:100/125*r,y:d.y},g={x:u.x-.2*u.x,y:u.y+.2*u.x},f={x:g.x+.1*u.x,y:g.y+.1*u.x},p={x:f.x+.35*u.x,y:f.y-.35*u.x},m={x:p.x,y:-p.y},_={x:f.x,y:-f.y},C={x:g.x,y:-g.y},b={x:u.x,y:-u.y},v={x:d.x,y:-d.y};return`<path d="M ${[d,u,g,f,p,m,_,C,b,v].map(w=>`${(c+w.x).toFixed(2)} ${(l+w.y).toFixed(2)}`).join(" L ")}" />`}render(e,t){if(!this._renderResult)return"";const s=t-e;return s<0||s>=this._renderResult.length?"":this._renderResult[s]}}class WhitespaceOptions{constructor(e){const t=e.options,s=t.get(59),o=t.get(47);o==="off"?(this.renderWhitespace="none",this.renderWithSVG=!1):o==="svg"?(this.renderWhitespace=t.get(113),this.renderWithSVG=!0):(this.renderWhitespace=t.get(113),this.renderWithSVG=!1),this.spaceWidth=s.spaceWidth,this.middotWidth=s.middotWidth,this.wsmiddotWidth=s.wsmiddotWidth,this.canUseHalfwidthRightwardsArrow=s.canUseHalfwidthRightwardsArrow,this.lineHeight=t.get(75),this.stopRenderingLineAfter=t.get(133)}equals(e){return this.renderWhitespace===e.renderWhitespace&&this.renderWithSVG===e.renderWithSVG&&this.spaceWidth===e.spaceWidth&&this.middotWidth===e.middotWidth&&this.wsmiddotWidth===e.wsmiddotWidth&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.lineHeight===e.lineHeight&&this.stopRenderingLineAfter===e.stopRenderingLineAfter}}class ViewportData{constructor(e,t,s,o){this.selections=e,this.startLineNumber=t.startLineNumber|0,this.endLineNumber=t.endLineNumber|0,this.relativeVerticalOffset=t.relativeVerticalOffset,this.bigNumbersDelta=t.bigNumbersDelta|0,this.lineHeight=t.lineHeight|0,this.whitespaceViewportData=s,this._model=o,this.visibleRange=new Range$2(t.startLineNumber,this._model.getLineMinColumn(t.startLineNumber),t.endLineNumber,this._model.getLineMaxColumn(t.endLineNumber))}getViewLineRenderingData(e){return this._model.getViewportViewLineRenderingData(this.visibleRange,e)}getDecorationsInViewport(){return this._model.getDecorationsInViewport(this.visibleRange)}}class EditorTheme{get type(){return this._theme.type}get value(){return this._theme}constructor(e){this._theme=e}update(e){this._theme=e}getColor(e){return this._theme.getColor(e)}}class ViewContext{constructor(e,t,s){this.configuration=e,this.theme=new EditorTheme(t),this.viewModel=s,this.viewLayout=s.viewLayout}addEventHandler(e){this.viewModel.addViewEventHandler(e)}removeEventHandler(e){this.viewModel.removeViewEventHandler(e)}}const quadVertices=new Float32Array([1,0,1,1,0,1,0,0,0,1,1,0]);function ensureNonNullable(a){if(!a)throw new Error(`Value "${a}" cannot be null`);return a}function observeDevicePixelDimensions(a,e,t){let s=new e.ResizeObserver(o=>{const r=o.find(d=>d.target===a);if(!r)return;if(!("devicePixelContentBoxSize"in r)){s==null||s.disconnect(),s=void 0;return}const l=r.devicePixelContentBoxSize[0].inlineSize,c=r.devicePixelContentBoxSize[0].blockSize;l>0&&c>0&&t(l,c)});try{s.observe(a,{box:["device-pixel-content-box"]})}catch{throw s.disconnect(),s=void 0,new BugIndicatingError("Could not observe device pixel dimensions")}return toDisposable(()=>s==null?void 0:s.disconnect())}var __decorate$2S=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let nextId=0;class GlyphRasterizer extends Disposable{get cacheKey(){return`${this.fontFamily}_${this.fontSize}px`}constructor(e,t,s,o){super(),this.fontSize=e,this.fontFamily=t,this.devicePixelRatio=s,this._decorationStyleCache=o,this.id=nextId++,this._workGlyph={source:null,boundingBox:{left:0,bottom:0,right:0,top:0},originOffset:{x:0,y:0},fontBoundingBoxAscent:0,fontBoundingBoxDescent:0},this._workGlyphConfig={chars:void 0,tokenMetadata:0,decorationStyleSetId:0},this._antiAliasing=isMacintosh?"greyscale":"subpixel";const r=Math.ceil(this.fontSize*s);this._canvas=new OffscreenCanvas(r*3,r*3),this._ctx=ensureNonNullable(this._canvas.getContext("2d",{willReadFrequently:!0,alpha:this._antiAliasing==="greyscale"})),this._ctx.textBaseline="top",this._ctx.fillStyle="#FFFFFF",this._ctx.font=`${r}px ${this.fontFamily}`,this._textMetrics=this._ctx.measureText("A")}rasterizeGlyph(e,t,s,o){return e===""?{source:this._canvas,boundingBox:{top:0,left:0,bottom:-1,right:-1},originOffset:{x:0,y:0},fontBoundingBoxAscent:0,fontBoundingBoxDescent:0}:this._workGlyphConfig.chars===e&&this._workGlyphConfig.tokenMetadata===t&&this._workGlyphConfig.decorationStyleSetId===s?this._workGlyph:(this._workGlyphConfig.chars=e,this._workGlyphConfig.tokenMetadata=t,this._workGlyphConfig.decorationStyleSetId=s,this._rasterizeGlyph(e,t,s,o))}_rasterizeGlyph(e,t,s,o){const r=Math.ceil(this.fontSize*this.devicePixelRatio),l=r*3;this._canvas.width!==l&&(this._canvas.width=l,this._canvas.height=l),this._ctx.save();const c=(t&15)/10,d=TokenMetadata.getBackground(t),u=o[d],g=this._decorationStyleCache.getStyleSet(s);this._antiAliasing==="subpixel"?(this._ctx.fillStyle=u,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height)):this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height);const f=new StringBuilder(200),p=TokenMetadata.getFontStyle(t);p&1&&f.appendString("italic "),(g==null?void 0:g.bold)!==void 0?g.bold&&f.appendString("bold "):p&2&&f.appendString("bold "),f.appendString(`${r}px ${this.fontFamily}`),this._ctx.font=f.build();const m=r,_=r;(g==null?void 0:g.color)!==void 0?this._ctx.fillStyle=`#${g.color.toString(16).padStart(8,"0")}`:this._ctx.fillStyle=o[TokenMetadata.getForeground(t)],this._ctx.textBaseline="top",(g==null?void 0:g.opacity)!==void 0&&(this._ctx.globalAlpha=g.opacity),this._ctx.fillText(e,m+c,_),this._ctx.restore();const C=this._ctx.getImageData(0,0,this._canvas.width,this._canvas.height);if(this._antiAliasing==="subpixel"){const b=parseInt(u.substring(1,3),16),v=parseInt(u.substring(3,5),16),S=parseInt(u.substring(5,7),16);this._clearColor(C,b,v,S),this._ctx.putImageData(C,0,0)}return this._findGlyphBoundingBox(C,this._workGlyph.boundingBox),this._workGlyph.source=this._canvas,this._workGlyph.originOffset.x=this._workGlyph.boundingBox.left-m,this._workGlyph.originOffset.y=this._workGlyph.boundingBox.top-_,this._workGlyph.fontBoundingBoxAscent=this._textMetrics.fontBoundingBoxAscent,this._workGlyph.fontBoundingBoxDescent=this._textMetrics.fontBoundingBoxDescent,this._workGlyph}_clearColor(e,t,s,o){for(let r=0;r<e.data.length;r+=4)e.data[r]===t&&e.data[r+1]===s&&e.data[r+2]===o&&(e.data[r+3]=0)}_findGlyphBoundingBox(e,t){const s=this._canvas.height,o=this._canvas.width;let r=!1;for(let l=0;l<s;l++){for(let c=0;c<o;c++){const d=l*o*4+c*4+3;if(e.data[d]!==0){t.top=l,r=!0;break}}if(r)break}t.left=0,r=!1;for(let l=0;l<o;l++){for(let c=0;c<s;c++){const d=c*o*4+l*4+3;if(e.data[d]!==0){t.left=l,r=!0;break}}if(r)break}t.right=o,r=!1;for(let l=o-1;l>=t.left;l--){for(let c=0;c<s;c++){const d=c*o*4+l*4+3;if(e.data[d]!==0){t.right=l,r=!0;break}}if(r)break}t.bottom=t.top,r=!1;for(let l=s-1;l>=0;l--){for(let c=0;c<o;c++){const d=l*o*4+c*4+3;if(e.data[d]!==0){t.bottom=l,r=!0;break}}if(r)break}}getTextMetrics(e){return this._ctx.measureText(e)}}__decorate$2S([memoize],GlyphRasterizer.prototype,"cacheKey",null);var __decorate$2R=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2M=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let TaskQueue=class extends Disposable{constructor(e){super(),this._logService=e,this._tasks=[],this._i=0,this._register(toDisposable(()=>this.clear()))}enqueue(e){this._tasks.push(e),this._start()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,s=0,o=e.timeRemaining(),r=0;for(;this._i<this._tasks.length;){if(t=Date.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,Date.now()-t),s=Math.max(t,s),r=e.timeRemaining(),s*1.5>r){o-t<-20&&this._logService.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(o-t))}ms`),this._start();return}o=r}this.clear()}};TaskQueue=__decorate$2R([__param$2M(0,ILogService)],TaskQueue);class PriorityTaskQueue extends TaskQueue{_requestCallback(e){return getActiveWindow().setTimeout(()=>e(this._createDeadline(16)))}_cancelCallback(e){getActiveWindow().clearTimeout(e)}_createDeadline(e){const t=Date.now()+e;return{timeRemaining:()=>Math.max(0,t-Date.now())}}}class IdleTaskQueueInternal extends TaskQueue{_requestCallback(e){return getActiveWindow().requestIdleCallback(e)}_cancelCallback(e){getActiveWindow().cancelIdleCallback(e)}}const IdleTaskQueue="requestIdleCallback"in getActiveWindow()?IdleTaskQueueInternal:PriorityTaskQueue;class TextureAtlasShelfAllocator{constructor(e,t){this._canvas=e,this._textureIndex=t,this._currentRow={x:0,y:0,h:0},this._allocatedGlyphs=new Set,this._nextIndex=0,this._ctx=ensureNonNullable(this._canvas.getContext("2d",{willReadFrequently:!0}))}allocate(e){const t=e.boundingBox.right-e.boundingBox.left+1,s=e.boundingBox.bottom-e.boundingBox.top+1;if(t>this._canvas.width||s>this._canvas.height)throw new BugIndicatingError("Glyph is too large for the atlas page");if(e.boundingBox.right-e.boundingBox.left+1>this._canvas.width-this._currentRow.x&&(this._currentRow.x=0,this._currentRow.y+=this._currentRow.h,this._currentRow.h=1),this._currentRow.y+e.boundingBox.bottom-e.boundingBox.top+1>this._canvas.height)return;this._ctx.drawImage(e.source,e.boundingBox.left,e.boundingBox.top,t,s,this._currentRow.x,this._currentRow.y,t,s);const o={pageIndex:this._textureIndex,glyphIndex:this._nextIndex++,x:this._currentRow.x,y:this._currentRow.y,w:t,h:s,originOffsetX:e.originOffset.x,originOffsetY:e.originOffset.y,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent};return this._currentRow.x+=t,this._currentRow.h=Math.max(this._currentRow.h,s),this._allocatedGlyphs.add(o),o}getUsagePreview(){const e=this._canvas.width,t=this._canvas.height,s=new OffscreenCanvas(e,t),o=ensureNonNullable(s.getContext("2d"));o.fillStyle="#808080",o.fillRect(0,0,e,t);const r=new Map,l=new Map;for(const c of this._allocatedGlyphs)r.set(c.y,Math.max(r.get(c.y)??0,c.h)),l.set(c.y,Math.max(l.get(c.y)??0,c.x+c.w));for(const c of this._allocatedGlyphs)o.fillStyle="#4040FF",o.fillRect(c.x,c.y,c.w,c.h),o.fillStyle="#FF0000",o.fillRect(c.x,c.y+c.h,c.w,r.get(c.y)-c.h);for(const[c,d]of l.entries())c!==this._currentRow.y&&(o.fillStyle="#FF0000",o.fillRect(d,c,e-d,r.get(c)));return s.convertToBlob()}getStats(){const e=this._canvas.width,t=this._canvas.height;let s=0,o=0;const r=e*t,l=new Map,c=new Map;for(const d of this._allocatedGlyphs)l.set(d.y,Math.max(l.get(d.y)??0,d.h)),c.set(d.y,Math.max(c.get(d.y)??0,d.x+d.w));for(const d of this._allocatedGlyphs)s+=d.w*d.h,o+=d.w*(l.get(d.y)-d.h);for(const[d,u]of c.entries())d!==this._currentRow.y&&(o+=(e-u)*l.get(d));return[`page${this._textureIndex}:`,`     Total: ${r} (${e}x${t})`,`      Used: ${s} (${(s/r*100).toPrecision(2)}%)`,`    Wasted: ${o} (${(o/r*100).toPrecision(2)}%)`,`Efficiency: ${(s/(s+o)*100).toPrecision(2)}%`].join(`
`)}}class TextureAtlasSlabAllocator{constructor(e,t,s){this._canvas=e,this._textureIndex=t,this._slabs=[],this._activeSlabsByDims=new NKeyMap,this._unusedRects=[],this._openRegionsByHeight=new Map,this._openRegionsByWidth=new Map,this._allocatedGlyphs=new Set,this._nextIndex=0,this._ctx=ensureNonNullable(this._canvas.getContext("2d",{willReadFrequently:!0})),this._slabW=Math.min((s==null?void 0:s.slabW)??64<<Math.max(Math.floor(getActiveWindow().devicePixelRatio)-1,0),this._canvas.width),this._slabH=Math.min((s==null?void 0:s.slabH)??this._slabW,this._canvas.height),this._slabsPerRow=Math.floor(this._canvas.width/this._slabW),this._slabsPerColumn=Math.floor(this._canvas.height/this._slabH)}allocate(e){const t=e.boundingBox.right-e.boundingBox.left+1,s=e.boundingBox.bottom-e.boundingBox.top+1;if(t>this._canvas.width||s>this._canvas.height)throw new BugIndicatingError("Glyph is too large for the atlas page");if(t>this._slabW||s>this._slabH){if(this._allocatedGlyphs.size>0)return;let u=this._canvas.width;for(;t<u/2&&s<u/2;)u/=2;this._slabW=u,this._slabH=u,this._slabsPerRow=Math.floor(this._canvas.width/this._slabW),this._slabsPerColumn=Math.floor(this._canvas.height/this._slabH)}const o={w:t,h:s};let r=this._activeSlabsByDims.get(o.w,o.h);if(r){const u=Math.floor(this._slabW/r.entryW)*Math.floor(this._slabH/r.entryH);r.count>=u&&(r=void 0)}let l,c;if(!r)if(t<s){const u=this._openRegionsByWidth.get(t);if(u!=null&&u.length)for(let g=u.length-1;g>=0;g--){const f=u[g];if(f.w>=t&&f.h>=s){l=f.x,c=f.y,t<f.w&&this._unusedRects.push({x:f.x+t,y:f.y,w:f.w-t,h:s}),f.y+=s,f.h-=s,f.h===0&&(g===u.length-1?u.pop():this._unusedRects.splice(g,1));break}}}else{const u=this._openRegionsByHeight.get(s);if(u!=null&&u.length)for(let g=u.length-1;g>=0;g--){const f=u[g];if(f.w>=t&&f.h>=s){l=f.x,c=f.y,s<f.h&&this._unusedRects.push({x:f.x,y:f.y+s,w:t,h:f.h-s}),f.x+=t,f.w-=t,f.h===0&&(g===u.length-1?u.pop():this._unusedRects.splice(g,1));break}}}if(l===void 0||c===void 0){if(!r){if(this._slabs.length>=this._slabsPerRow*this._slabsPerColumn)return;r={x:Math.floor(this._slabs.length%this._slabsPerRow)*this._slabW,y:Math.floor(this._slabs.length/this._slabsPerRow)*this._slabH,entryW:o.w,entryH:o.h,count:0};const g=this._slabW%r.entryW,f=this._slabH%r.entryH;g&&addEntryToMapArray(this._openRegionsByWidth,g,{x:r.x+this._slabW-g,w:g,y:r.y,h:this._slabH-(f??0)}),f&&addEntryToMapArray(this._openRegionsByHeight,f,{x:r.x,w:this._slabW,y:r.y+this._slabH-f,h:f}),this._slabs.push(r),this._activeSlabsByDims.set(r,o.w,o.h)}const u=Math.floor(this._slabW/r.entryW);l=r.x+Math.floor(r.count%u)*r.entryW,c=r.y+Math.floor(r.count/u)*r.entryH,r.count++}this._ctx.drawImage(e.source,e.boundingBox.left,e.boundingBox.top,t,s,l,c,t,s);const d={pageIndex:this._textureIndex,glyphIndex:this._nextIndex++,x:l,y:c,w:t,h:s,originOffsetX:e.originOffset.x,originOffsetY:e.originOffset.y,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent};return this._allocatedGlyphs.add(d),d}getUsagePreview(){const e=this._canvas.width,t=this._canvas.height,s=new OffscreenCanvas(e,t),o=ensureNonNullable(s.getContext("2d"));o.fillStyle="#808080",o.fillRect(0,0,e,t);let r=0,l=0,c=0;const d=64<<Math.floor(getActiveWindow().devicePixelRatio)-1,u=d;for(const f of this._slabs){let p=0,m=0;for(let b=0;b<f.count;b++)p+f.entryW>d&&(p=0,m+=f.entryH),o.fillStyle="#FF0000",o.fillRect(f.x+p,f.y+m,f.entryW,f.entryH),r+=f.entryW*f.entryH,p+=f.entryW;const _=Math.floor(d/f.entryW),C=Math.floor(u/f.entryH);f.entryW*_*f.entryH*C}for(const f of this._allocatedGlyphs)l+=f.w*f.h,o.fillStyle="#4040FF",o.fillRect(f.x,f.y,f.w,f.h);const g=Array.from(this._openRegionsByWidth.values()).flat().concat(Array.from(this._openRegionsByHeight.values()).flat());for(const f of g)o.fillStyle="#FF000088",o.fillRect(f.x,f.y,f.w,f.h),c+=f.w*f.h;return o.globalAlpha=.5,o.drawImage(this._canvas,0,0),o.globalAlpha=1,s.convertToBlob()}getStats(){const e=this._canvas.width,t=this._canvas.height;let s=0,o=0,r=0,l=0,c=0;const d=e*t,u=64<<Math.floor(getActiveWindow().devicePixelRatio)-1,g=u;for(const _ of this._slabs){let C=0,b=0;for(let w=0;w<_.count;w++)C+_.entryW>u&&(C=0,b+=_.entryH),s+=_.entryW*_.entryH,C+=_.entryW;const v=Math.floor(u/_.entryW),S=Math.floor(g/_.entryH),y=_.entryW*v*_.entryH*S;r+=u*g-y}for(const _ of this._allocatedGlyphs)o+=_.w*_.h;const f=Array.from(this._openRegionsByWidth.values()).flat().concat(Array.from(this._openRegionsByHeight.values()).flat());for(const _ of f)c+=_.w*_.h;const p=r-c;l=s-(o-p);const m=o/(o+l+c);return[`page[${this._textureIndex}]:`,`     Total: ${d}px (${e}x${t})`,`      Used: ${o}px (${(o/d*100).toFixed(2)}%)`,`    Wasted: ${l}px (${(l/d*100).toFixed(2)}%)`,`Restricted: ${c}px (${(c/d*100).toFixed(2)}%) (hard to allocate)`,`Efficiency: ${m===1?"100":(m*100).toFixed(2)}%`,`     Slabs: ${this._slabs.length} of ${Math.floor(this._canvas.width/u)*Math.floor(this._canvas.height/g)}`].join(`
`)}}function addEntryToMapArray(a,e,t){let s=a.get(e);s||(s=[],a.set(e,s)),s.push(t)}var __decorate$2Q=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2L=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},TextureAtlasPage_1,ui;let TextureAtlasPage=(ui=class extends Disposable{get version(){return this._version}get usedArea(){return this._usedArea}get source(){return this._canvas}get glyphs(){return this._glyphInOrderSet.values()}constructor(e,t,s,o,r){switch(super(),this._logService=o,this._version=0,this._usedArea={left:0,top:0,right:0,bottom:0},this._glyphMap=new NKeyMap,this._glyphInOrderSet=new Set,this._canvas=new OffscreenCanvas(t,t),this._colorMap=r.getColorTheme().tokenColorMap,s){case"shelf":this._allocator=new TextureAtlasShelfAllocator(this._canvas,e);break;case"slab":this._allocator=new TextureAtlasSlabAllocator(this._canvas,e);break;default:this._allocator=s(this._canvas,e);break}this._register(toDisposable(()=>{this._canvas.width=1,this._canvas.height=1}))}getGlyph(e,t,s,o){return this._glyphMap.get(t,s,o,e.cacheKey)??this._createGlyph(e,t,s,o)}_createGlyph(e,t,s,o){if(this._glyphInOrderSet.size>=TextureAtlasPage_1.maximumGlyphCount)return;const r=e.rasterizeGlyph(t,s,o,this._colorMap),l=this._allocator.allocate(r);if(l!==void 0)return this._glyphMap.set(l,t,s,o,e.cacheKey),this._glyphInOrderSet.add(l),this._version++,this._usedArea.right=Math.max(this._usedArea.right,l.x+l.w-1),this._usedArea.bottom=Math.max(this._usedArea.bottom,l.y+l.h-1),this._logService.getLevel()===LogLevel.Trace&&this._logService.trace("New glyph",{chars:t,tokenMetadata:s,decorationStyleSetId:o,rasterizedGlyph:r,glyph:l}),l}getUsagePreview(){return this._allocator.getUsagePreview()}getStats(){return this._allocator.getStats()}},TextureAtlasPage_1=ui,ui.maximumGlyphCount=5e3,ui);TextureAtlasPage=TextureAtlasPage_1=__decorate$2Q([__param$2L(3,ILogService),__param$2L(4,IThemeService)],TextureAtlasPage);var __decorate$2P=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2K=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},TextureAtlas_1,gi;let TextureAtlas=(gi=class extends Disposable{get pages(){return this._pages}constructor(e,t,s,o,r){super(),this._maxTextureSize=e,this._decorationStyleCache=s,this._themeService=o,this._instantiationService=r,this._warmUpTask=this._register(new MutableDisposable),this._warmedUpRasterizers=new Set,this._pages=[],this._glyphPageIndex=new NKeyMap,this._onDidDeleteGlyphs=this._register(new Emitter$1),this.onDidDeleteGlyphs=this._onDidDeleteGlyphs.event,this._allocatorType=(t==null?void 0:t.allocatorType)??"slab",this._register(Event$1.runAndSubscribe(this._themeService.onDidColorThemeChange,()=>{this._colorMap&&this.clear(),this._colorMap=this._themeService.getColorTheme().tokenColorMap}));const l=Math.max(1,Math.floor(getActiveWindow().devicePixelRatio));this.pageSize=Math.min(1024*l,this._maxTextureSize),this._initFirstPage(),this._register(toDisposable(()=>dispose(this._pages)))}_initFirstPage(){const e=this._instantiationService.createInstance(TextureAtlasPage,0,this.pageSize,this._allocatorType);this._pages.push(e);const t=new GlyphRasterizer(1,"",1,this._decorationStyleCache);e.getGlyph(t,"",0,0),t.dispose()}clear(){for(const e of this._pages)e.dispose();this._pages.length=0,this._glyphPageIndex.clear(),this._warmedUpRasterizers.clear(),this._warmUpTask.clear(),this._initFirstPage(),this._onDidDeleteGlyphs.fire()}getGlyph(e,t,s,o,r){return s&=-2048,s|=Math.floor(r%1*10),this._warmedUpRasterizers.has(e.id)||(this._warmUpAtlas(e),this._warmedUpRasterizers.add(e.id)),this._tryGetGlyph(this._glyphPageIndex.get(t,s,o,e.cacheKey)??0,e,t,s,o)}_tryGetGlyph(e,t,s,o,r){return this._glyphPageIndex.set(e,s,o,r,t.cacheKey),this._pages[e].getGlyph(t,s,o,r)??(e+1<this._pages.length?this._tryGetGlyph(e+1,t,s,o,r):void 0)??this._getGlyphFromNewPage(t,s,o,r)}_getGlyphFromNewPage(e,t,s,o){if(this._pages.length>=TextureAtlas_1.maximumPageCount)throw new Error(`Attempt to create a texture atlas page past the limit ${TextureAtlas_1.maximumPageCount}`);return this._pages.push(this._instantiationService.createInstance(TextureAtlasPage,this._pages.length,this.pageSize,this._allocatorType)),this._glyphPageIndex.set(this._pages.length-1,t,s,o,e.cacheKey),this._pages[this._pages.length-1].getGlyph(e,t,s,o)}getStats(){return this._pages.map(e=>e.getStats())}_warmUpAtlas(e){var o;const t=this._colorMap;if(!t)throw new BugIndicatingError("Cannot warm atlas without color map");(o=this._warmUpTask.value)==null||o.clear();const s=this._warmUpTask.value=this._instantiationService.createInstance(IdleTaskQueue);for(let r=65;r<=90;r++)for(const l of t.keys())s.enqueue(()=>{for(let c=0;c<1;c+=.1)this.getGlyph(e,String.fromCharCode(r),l<<15&16744448,0,c)});for(let r=97;r<=122;r++)for(const l of t.keys())s.enqueue(()=>{for(let c=0;c<1;c+=.1)this.getGlyph(e,String.fromCharCode(r),l<<15&16744448,0,c)});for(let r=33;r<=126;r++)for(const l of t.keys())s.enqueue(()=>{for(let c=0;c<1;c+=.1)this.getGlyph(e,String.fromCharCode(r),l<<15&16744448,0,c)})}},TextureAtlas_1=gi,gi.maximumPageCount=16,gi);TextureAtlas=TextureAtlas_1=__decorate$2P([__param$2K(3,IThemeService),__param$2K(4,IInstantiationService)],TextureAtlas);var Severity$1;(function(a){a[a.Ignore=0]="Ignore",a[a.Info=1]="Info",a[a.Warning=2]="Warning",a[a.Error=3]="Error"})(Severity$1||(Severity$1={}));(function(a){const e="error",t="warning",s="warn",o="info",r="ignore";function l(d){return d?equalsIgnoreCase(e,d)?a.Error:equalsIgnoreCase(t,d)||equalsIgnoreCase(s,d)?a.Warning:equalsIgnoreCase(o,d)?a.Info:a.Ignore:a.Ignore}a.fromValue=l;function c(d){switch(d){case a.Error:return e;case a.Warning:return t;case a.Info:return o;default:return r}}a.toString=c})(Severity$1||(Severity$1={}));const Severity$2=Severity$1;var Severity=Severity$2;const INotificationService=createDecorator("notificationService");class NoOpNotification{}var GPULifecycle;(function(a){async function e(o){try{if(!navigator.gpu)throw new Error("This browser does not support WebGPU");const r=await navigator.gpu.requestAdapter();if(!r)throw new Error("This browser supports WebGPU but it appears to be disabled");return wrapDestroyableInDisposable(await r.requestDevice())}catch(r){throw o&&o(r.message),r}}a.requestDevice=e;function t(o,r,l){const c=o.createBuffer(r);return l&&o.queue.writeBuffer(c,0,isFunction(l)?l():l),wrapDestroyableInDisposable(c)}a.createBuffer=t;function s(o,r){return wrapDestroyableInDisposable(o.createTexture(r))}a.createTexture=s})(GPULifecycle||(GPULifecycle={}));function wrapDestroyableInDisposable(a){return{object:a,dispose:()=>a.destroy()}}class BufferDirtyTracker{get dataOffset(){return this._startIndex}get dirtySize(){if(!(this._startIndex===void 0||this._endIndex===void 0))return this._endIndex-this._startIndex+1}get isDirty(){return this._startIndex!==void 0}flag(e,t=1){return this._flag(e),t>1&&this._flag(e+t-1),e}_flag(e){(this._startIndex===void 0||e<this._startIndex)&&(this._startIndex=e),(this._endIndex===void 0||e>this._endIndex)&&(this._endIndex=e)}clear(){this._startIndex=void 0,this._endIndex=void 0}}function createObjectCollectionBuffer(a,e){return new ObjectCollectionBuffer(a,e)}class ObjectCollectionBuffer extends Disposable{get entryCount(){return this._entries.size}get dirtyTracker(){return this._dirtyTracker}constructor(e,t){super(),this.propertySpecs=e,this.capacity=t,this._dirtyTracker=new BufferDirtyTracker,this._propertySpecsMap=new Map,this._entries=new LinkedList,this._onDidChange=this._register(new Emitter$1),this._onDidChangeBuffer=this._register(new Emitter$1),this.onDidChangeBuffer=this._onDidChangeBuffer.event,this.view=new Float32Array(t*e.length),this.buffer=this.view.buffer,this._entrySize=e.length;for(let s=0;s<e.length;s++){const o={offset:s,...e[s]};this._propertySpecsMap.set(o.name,o)}this._register(toDisposable(()=>dispose(this._entries)))}createEntry(e){this._entries.size===this.capacity&&(this._expandBuffer(),this._onDidChangeBuffer.fire());const t=new ObjectCollectionBufferEntry(this.view,this._propertySpecsMap,this._dirtyTracker,this._entries.size,e),s=this._entries.push(t),o=[];return o.push(Event$1.forward(t.onDidChange,this._onDidChange)),o.push(t.onWillDispose(()=>{const r=t.i;s(),this.view.set(this.view.subarray(r*this._entrySize+2,this._entries.size*this._entrySize+2),r*this._entrySize);for(const l of this._entries)l.i>r&&l.i--;this._dirtyTracker.flag(r,(this._entries.size-r)*this._entrySize),dispose(o)})),t}_expandBuffer(){this.capacity*=2;const e=new Float32Array(this.capacity*this._entrySize);e.set(this.view),this.view=e,this.buffer=this.view.buffer}}class ObjectCollectionBufferEntry extends Disposable{constructor(e,t,s,o,r){super(),this._view=e,this._propertySpecsMap=t,this._dirtyTracker=s,this.i=o,this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,this._onWillDispose=this._register(new Emitter$1),this.onWillDispose=this._onWillDispose.event;for(const l of this._propertySpecsMap.values())this._view[this.i*this._propertySpecsMap.size+l.offset]=r[l.name];this._dirtyTracker.flag(this.i*this._propertySpecsMap.size,this._propertySpecsMap.size)}dispose(){this._onWillDispose.fire(),super.dispose()}setRaw(e){if(e.length!==this._propertySpecsMap.size)throw new Error(`Data length ${e.length} does not match the number of properties in the collection (${this._propertySpecsMap.size})`);this._view.set(e,this.i*this._propertySpecsMap.size),this._dirtyTracker.flag(this.i*this._propertySpecsMap.size,this._propertySpecsMap.size)}}const rectangleRendererWgsl=`

struct Vertex {
	@location(0) position: vec2f,
};

struct LayoutInfo {
	canvasDims: vec2f,
	viewportOffset: vec2f,
	viewportDims: vec2f,
}

struct ScrollOffset {
	offset: vec2f,
}

struct Shape {
	position: vec2f,
	size: vec2f,
	color: vec4f,
};

struct VSOutput {
	@builtin(position) position: vec4f,
	@location(1)       color:    vec4f,
};

// Uniforms
@group(0) @binding(1) var<uniform>       layoutInfo:      LayoutInfo;

// Storage buffers
@group(0) @binding(0)            var<storage, read> shapes:          array<Shape>;
@group(0) @binding(2)      var<uniform>       scrollOffset:    ScrollOffset;

@vertex fn vs(
	vert: Vertex,
	@builtin(instance_index) instanceIndex: u32,
	@builtin(vertex_index) vertexIndex : u32
) -> VSOutput {
	let shape = shapes[instanceIndex];

	var vsOut: VSOutput;
	vsOut.position = vec4f(
		(
			// Top left corner
			vec2f(-1,  1) +
			// Convert pixel position to clipspace
			vec2f( 2, -2) / layoutInfo.canvasDims *
			// Shape position and size
			(layoutInfo.viewportOffset - scrollOffset.offset + shape.position + vert.position * shape.size)
		),
		0.0,
		1.0
	);
	vsOut.color = shape.color;
	return vsOut;
}

@fragment fn fs(vsOut: VSOutput) -> @location(0) vec4f {
	return vsOut.color;
}
`;class RectangleRenderer extends ViewEventHandler{constructor(e,t,s,o,r,l){super(),this._context=e,this._contentLeft=t,this._devicePixelRatio=s,this._canvas=o,this._ctx=r,this._shapeBindBuffer=this._register(new MutableDisposable),this._initialized=!1,this._shapeCollection=this._register(createObjectCollectionBuffer([{name:"x"},{name:"y"},{name:"width"},{name:"height"},{name:"red"},{name:"green"},{name:"blue"},{name:"alpha"}],32)),this._context.addEventHandler(this),this._initWebgpu(l)}async _initWebgpu(e){if(this._device=await e,this._store.isDisposed)return;const t=navigator.gpu.getPreferredCanvasFormat();this._ctx.configure({device:this._device,format:t,alphaMode:"premultiplied"}),this._renderPassColorAttachment={view:null,loadOp:"load",storeOp:"store"},this._renderPassDescriptor={label:"Monaco rectangle renderer render pass",colorAttachments:[this._renderPassColorAttachment]};let s;{const c=new Float32Array(6),d=(u=this._canvas.width,g=this._canvas.height)=>(c[0]=u,c[1]=g,c[2]=Math.ceil(this._context.configuration.options.get(165).contentLeft*getActiveWindow().devicePixelRatio),c[3]=0,c[4]=c[0]-c[2],c[5]=c[1]-c[3],c);s=this._register(GPULifecycle.createBuffer(this._device,{label:"Monaco rectangle renderer uniform buffer",size:24,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST},()=>d())).object,this._register(observeDevicePixelDimensions(this._canvas,getActiveWindow(),(u,g)=>{this._device.queue.writeBuffer(s,0,d(u,g))}))}const o=2;this._scrollOffsetBindBuffer=this._register(GPULifecycle.createBuffer(this._device,{label:"Monaco rectangle renderer scroll offset buffer",size:o*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})).object,this._scrollOffsetValueBuffer=new Float32Array(o);const r=()=>GPULifecycle.createBuffer(this._device,{label:"Monaco rectangle renderer shape buffer",size:this._shapeCollection.buffer.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});this._shapeBindBuffer.value=r(),this._register(Event$1.runAndSubscribe(this._shapeCollection.onDidChangeBuffer,()=>{this._shapeBindBuffer.value=r(),this._pipeline&&this._updateBindGroup(this._pipeline,s)})),this._vertexBuffer=this._register(GPULifecycle.createBuffer(this._device,{label:"Monaco rectangle renderer vertex buffer",size:quadVertices.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST},quadVertices)).object;const l=this._device.createShaderModule({label:"Monaco rectangle renderer shader module",code:rectangleRendererWgsl});this._pipeline=this._device.createRenderPipeline({label:"Monaco rectangle renderer render pipeline",layout:"auto",vertex:{module:l,buffers:[{arrayStride:2*Float32Array.BYTES_PER_ELEMENT,attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]}]},fragment:{module:l,targets:[{format:t,blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]}}),this._updateBindGroup(this._pipeline,s),this._initialized=!0}_updateBindGroup(e,t){this._bindGroup=this._device.createBindGroup({label:"Monaco rectangle renderer bind group",layout:e.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this._shapeBindBuffer.value.object}},{binding:1,resource:{buffer:t}},{binding:2,resource:{buffer:this._scrollOffsetBindBuffer}}]})}register(e,t,s,o,r,l,c,d){return this._shapeCollection.createEntry({x:e,y:t,width:s,height:o,red:r,green:l,blue:c,alpha:d})}onScrollChanged(e){if(this._device){const t=getActiveWindow().devicePixelRatio;this._scrollOffsetValueBuffer[0]=this._context.viewLayout.getCurrentScrollLeft()*t,this._scrollOffsetValueBuffer[1]=this._context.viewLayout.getCurrentScrollTop()*t,this._device.queue.writeBuffer(this._scrollOffsetBindBuffer,0,this._scrollOffsetValueBuffer)}return!0}_update(){if(!this._device)return;const e=this._shapeCollection;e.dirtyTracker.isDirty&&(this._device.queue.writeBuffer(this._shapeBindBuffer.value.object,0,e.buffer,e.dirtyTracker.dataOffset,e.dirtyTracker.dirtySize*e.view.BYTES_PER_ELEMENT),e.dirtyTracker.clear())}draw(e){if(!this._initialized)return;this._update();const t=this._device.createCommandEncoder({label:"Monaco rectangle renderer command encoder"});this._renderPassColorAttachment.view=this._ctx.getCurrentTexture().createView();const s=t.beginRenderPass(this._renderPassDescriptor);s.setPipeline(this._pipeline),s.setVertexBuffer(0,this._vertexBuffer),s.setBindGroup(0,this._bindGroup);const o=Math.ceil(this._contentLeft.get()*this._devicePixelRatio.get());s.setScissorRect(o,0,this._canvas.width-o,this._canvas.height),s.draw(quadVertices.length/2,this._shapeCollection.entryCount),s.end();const r=t.finish();this._device.queue.submit([r])}}const decorationCssRuleExtractor="";class DecorationCssRuleExtractor extends Disposable{constructor(){super(),this._ruleCache=new Map,this._container=$$l("div.monaco-decoration-css-rule-extractor"),this._dummyElement=$$l("span"),this._container.appendChild(this._dummyElement),this._register(toDisposable(()=>this._container.remove()))}getStyleRules(e,t){const s=this._ruleCache.get(t);if(s)return s;this._dummyElement.className=t,e.appendChild(this._container);const o=this._getStyleRules(t);return this._ruleCache.set(t,o),e.removeChild(this._container),o}_getStyleRules(e){const t=[],o=[...getActiveDocument().styleSheets];for(let r=0;r<o.length;r++){const l=o[r];for(const c of l.cssRules)if(c instanceof CSSImportRule)c.styleSheet&&o.push(c.styleSheet);else if(c instanceof CSSStyleRule){const d=`.${e}`,u=c.selectorText.indexOf(d);if(u!==-1){const g=u+d.length;(c.selectorText.length===g||c.selectorText.substring(g,g+1).match(/[ :]/))&&t.push(c)}}}return t}}class DecorationStyleCache{constructor(){this._nextId=1,this._cacheById=new Map,this._cacheByStyle=new NKeyMap}getOrCreateEntry(e,t,s){if(e===void 0&&t===void 0&&s===void 0)return 0;const o=this._cacheByStyle.get(e??0,t?1:0,s===void 0?"":s.toFixed(2));if(o)return o.id;const r=this._nextId++,l={id:r,color:e,bold:t,opacity:s};return this._cacheById.set(r,l),this._cacheByStyle.set(l,e??0,t?1:0,s===void 0?"":s.toFixed(2)),r}getStyleSet(e){if(e!==0)return this._cacheById.get(e)}}var __decorate$2O=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2J=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},ViewGpuContext_1,It;let ViewGpuContext=(It=class extends Disposable{static get decorationCssRuleExtractor(){return ViewGpuContext_1._decorationCssRuleExtractor}static get decorationStyleCache(){return ViewGpuContext_1._decorationStyleCache}static get atlas(){if(!ViewGpuContext_1._atlas)throw new BugIndicatingError("Cannot call ViewGpuContext.textureAtlas before device is resolved");return ViewGpuContext_1._atlas}get atlas(){return ViewGpuContext_1.atlas}constructor(e,t,s,o){super(),this._instantiationService=t,this._notificationService=s,this.configurationService=o,this.maxGpuCols=2e3,this.canvas=createFastDomNode(document.createElement("canvas")),this.canvas.setClassName("editorCanvas"),this._register(Event$1.runAndSubscribe(o.onDidChangeConfiguration,d=>{var u;if(!d||d.affectsConfiguration("editor.scrollbar.verticalScrollbarSize")){const g=((u=o.getValue("editor").scrollbar)==null?void 0:u.verticalScrollbarSize)??14;this.canvas.domNode.style.boxSizing="border-box",this.canvas.domNode.style.paddingRight=`${g}px`}})),this.ctx=ensureNonNullable(this.canvas.domNode.getContext("webgpu")),ViewGpuContext_1.device||(ViewGpuContext_1.device=GPULifecycle.requestDevice(d=>{const u=[{label:localize(73,"Use DOM-based rendering"),run:()=>this.configurationService.updateValue("editor.experimentalGpuAcceleration","off")}];this._notificationService.prompt(Severity.Warning,d,u)}).then(d=>(ViewGpuContext_1.deviceSync=d.object,ViewGpuContext_1._atlas||(ViewGpuContext_1._atlas=this._instantiationService.createInstance(TextureAtlas,d.object.limits.maxTextureDimension2D,void 0,ViewGpuContext_1.decorationStyleCache)),d.object)));const r=observableValue(this,getActiveWindow().devicePixelRatio);this._register(addDisposableListener(getActiveWindow(),"resize",()=>{r.set(getActiveWindow().devicePixelRatio,void 0)})),this.devicePixelRatio=r,this._register(runOnChange(this.devicePixelRatio,()=>{var d;return(d=ViewGpuContext_1.atlas)==null?void 0:d.clear()}));const l=observableValue(this,{width:this.canvas.domNode.width,height:this.canvas.domNode.height});this._register(observeDevicePixelDimensions(this.canvas.domNode,getActiveWindow(),(d,u)=>{this.canvas.domNode.width=d,this.canvas.domNode.height=u,l.set({width:d,height:u},void 0)})),this.canvasDevicePixelDimensions=l;const c=observableValue(this,0);this._register(this.configurationService.onDidChangeConfiguration(d=>{c.set(e.configuration.options.get(165).contentLeft,void 0)})),this.contentLeft=c,this.rectangleRenderer=this._instantiationService.createInstance(RectangleRenderer,e,this.contentLeft,this.devicePixelRatio,this.canvas.domNode,this.ctx,ViewGpuContext_1.device)}canRender(e,t,s){const o=t.getViewLineRenderingData(s);if(o.containsRTL||o.maxColumn>this.maxGpuCols)return!1;if(o.inlineDecorations.length>0){let r=!0;for(const l of o.inlineDecorations){if(l.type!==0){r=!1;break}const c=ViewGpuContext_1._decorationCssRuleExtractor.getStyleRules(this.canvas.domNode,l.inlineClassName);if(r&&(r=c.every(d=>{if(d.selectorText.includes(":"))return!1;for(const u of d.style)if(!supportsCssRule(u,d.style))return!1;return!0})),!r)break}return r}return!0}canRenderDetailed(e,t,s){const o=t.getViewLineRenderingData(s),r=[];if(o.containsRTL&&r.push("containsRTL"),o.maxColumn>this.maxGpuCols&&r.push("maxColumn > maxGpuCols"),o.inlineDecorations.length>0){let l=!0;const c=[],d=[],u=[];for(const g of o.inlineDecorations){if(g.type!==0){c.push(g.type),l=!1;continue}const f=ViewGpuContext_1._decorationCssRuleExtractor.getStyleRules(this.canvas.domNode,g.inlineClassName);l&&(l=f.every(p=>{if(p.selectorText.includes(":"))return d.push(p.selectorText),!1;for(const m of p.style)if(!supportsCssRule(m,p.style))return u.push(`${m}: ${p.style[m]}`),!1;return!0}))}c.length>0&&r.push(`inlineDecorations with unsupported types (${c.map(g=>`\`${g}\``).join(", ")})`),u.length>0&&r.push(`inlineDecorations with unsupported CSS rules (${u.map(g=>`\`${g}\``).join(", ")})`),d.length>0&&r.push(`inlineDecorations with unsupported CSS selectors (${d.map(g=>`\`${g}\``).join(", ")})`)}return r}},ViewGpuContext_1=It,It._decorationCssRuleExtractor=new DecorationCssRuleExtractor,It._decorationStyleCache=new DecorationStyleCache,It);ViewGpuContext=ViewGpuContext_1=__decorate$2O([__param$2J(1,IInstantiationService),__param$2J(2,INotificationService),__param$2J(3,IConfigurationService)],ViewGpuContext);const gpuSupportedDecorationCssRules=["color","font-weight","opacity"];function supportsCssRule(a,e){if(!gpuSupportedDecorationCssRules.includes(a))return!1;switch(a){default:return!0}}function createContentSegmenter(a,e){return a.isBasicASCII&&e.useMonospaceOptimizations?new AsciiContentSegmenter(a):new GraphemeContentSegmenter(a)}class AsciiContentSegmenter{constructor(e){this._content=e.content}getSegmentAtIndex(e){return this._content[e]}}class GraphemeContentSegmenter{constructor(e){this._segments=[];const t=e.content,s=safeIntl.Segmenter(void 0,{granularity:"grapheme"}).value,o=Array.from(s.segment(t));let r=0;for(let l=0;l<t.length;l++){const c=o[r];if(!c)break;if(c.index!==l){this._segments.push(void 0);continue}r++,this._segments.push(c)}}getSegmentAtIndex(e){var t;return(t=this._segments[e])==null?void 0:t.segment}}class BaseRenderStrategy extends ViewEventHandler{get glyphRasterizer(){return this._glyphRasterizer.value}constructor(e,t,s,o){super(),this._context=e,this._viewGpuContext=t,this._device=s,this._glyphRasterizer=o,this._context.addEventHandler(this)}}const fullFileRenderStrategyWgsl=`
struct GlyphInfo {
	position: vec2f,
	size: vec2f,
	origin: vec2f,
};

struct Vertex {
	@location(0) position: vec2f,
};

struct Cell {
	position: vec2f,
	unused1: vec2f,
	glyphIndex: f32,
	textureIndex: f32
};

struct LayoutInfo {
	canvasDims: vec2f,
	viewportOffset: vec2f,
	viewportDims: vec2f,
}

struct ScrollOffset {
	offset: vec2f
}

struct VSOutput {
	@builtin(position) position:   vec4f,
	@location(1)       layerIndex: f32,
	@location(0)       texcoord:   vec2f,
};

// Uniforms
@group(0) @binding(4)       var<uniform>       layoutInfo:      LayoutInfo;
@group(0) @binding(5)  var<uniform>       atlasDims:       vec2f;
@group(0) @binding(6)            var<uniform>       scrollOffset:    ScrollOffset;

// Storage buffers
@group(0) @binding(0)               var<storage, read> glyphInfo:       array<array<GlyphInfo, ${TextureAtlasPage.maximumGlyphCount}>, ${TextureAtlas.maximumPageCount}>;
@group(0) @binding(1)                   var<storage, read> cells:           array<Cell>;

@vertex fn vs(
	vert: Vertex,
	@builtin(instance_index) instanceIndex: u32,
	@builtin(vertex_index) vertexIndex : u32
) -> VSOutput {
	let cell = cells[instanceIndex];
	var glyph = glyphInfo[u32(cell.textureIndex)][u32(cell.glyphIndex)];

	var vsOut: VSOutput;
	// Multiple vert.position by 2,-2 to get it into clipspace which ranged from -1 to 1
	vsOut.position = vec4f(
		// Make everything relative to top left instead of center
		vec2f(-1, 1) +
		((vert.position * vec2f(2, -2)) / layoutInfo.canvasDims) * glyph.size +
		((cell.position * vec2f(2, -2)) / layoutInfo.canvasDims) +
		((glyph.origin * vec2f(2, -2)) / layoutInfo.canvasDims) +
		(((layoutInfo.viewportOffset - scrollOffset.offset * vec2(1, -1)) * 2) / layoutInfo.canvasDims),
		0.0,
		1.0
	);

	vsOut.layerIndex = cell.textureIndex;
	// Textures are flipped from natural direction on the y-axis, so flip it back
	vsOut.texcoord = vert.position;
	vsOut.texcoord = (
		// Glyph offset (0-1)
		(glyph.position / atlasDims) +
		// Glyph coordinate (0-1)
		(vsOut.texcoord * (glyph.size / atlasDims))
	);

	return vsOut;
}

@group(0) @binding(2) var ourSampler: sampler;
@group(0) @binding(3)        var ourTexture: texture_2d_array<f32>;

@fragment fn fs(vsOut: VSOutput) -> @location(0) vec4f {
	return textureSample(ourTexture, ourSampler, vsOut.texcoord, u32(vsOut.layerIndex));
}
`,Fe=class Fe extends BaseRenderStrategy{get bindGroupEntries(){return[{binding:1,resource:{buffer:this._cellBindBuffer}},{binding:6,resource:{buffer:this._scrollOffsetBindBuffer}}]}constructor(e,t,s,o){super(e,t,s,o),this.type="viewport",this.wgsl=fullFileRenderStrategyWgsl,this._cellBindBufferLineCapacity=63,this._activeDoubleBufferIndex=0,this._visibleObjectCount=0,this._scrollInitialized=!1,this._onDidChangeBindGroupEntries=this._register(new Emitter$1),this.onDidChangeBindGroupEntries=this._onDidChangeBindGroupEntries.event,this._rebuildCellBuffer(this._cellBindBufferLineCapacity);const r=2;this._scrollOffsetBindBuffer=this._register(GPULifecycle.createBuffer(this._device,{label:"Monaco scroll offset buffer",size:r*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})).object,this._scrollOffsetValueBuffer=new Float32Array(r)}_rebuildCellBuffer(e){var o;(o=this._cellBindBuffer)==null||o.destroy();const t=(Math.floor(e/32)+1)*32,s=t*Fe.maxSupportedColumns*6*Float32Array.BYTES_PER_ELEMENT;this._cellBindBuffer=this._register(GPULifecycle.createBuffer(this._device,{label:"Monaco full file cell buffer",size:s,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST})).object,this._cellValueBuffers=[new ArrayBuffer(s),new ArrayBuffer(s)],this._cellBindBufferLineCapacity=t,this._onDidChangeBindGroupEntries.fire()}onConfigurationChanged(e){return!0}onDecorationsChanged(e){return!0}onTokensChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onLinesChanged(e){return!0}onScrollChanged(e){const t=getActiveWindow().devicePixelRatio;return this._scrollOffsetValueBuffer[0]=((e==null?void 0:e.scrollLeft)??this._context.viewLayout.getCurrentScrollLeft())*t,this._scrollOffsetValueBuffer[1]=((e==null?void 0:e.scrollTop)??this._context.viewLayout.getCurrentScrollTop())*t,this._device.queue.writeBuffer(this._scrollOffsetBindBuffer,0,this._scrollOffsetValueBuffer),!0}onThemeChanged(e){return!0}onLineMappingChanged(e){return!0}onZonesChanged(e){return!0}reset(){for(const e of[0,1]){const t=new Float32Array(this._cellValueBuffers[e]);t.fill(0,0,t.length),this._device.queue.writeBuffer(this._cellBindBuffer,0,t.buffer,0,t.byteLength)}}update(e,t){var M;let s="",o,r=0,l=0,c=0,d=0,u=0,g=0,f,p=0,m=0,_=0,C=0,b,v,S,y,w,L=0,x=0,E;const I=getActiveWindow().devicePixelRatio;let D;this._scrollInitialized||(this.onScrollChanged(),this._scrollInitialized=!0),this._cellBindBufferLineCapacity<e.endLineNumber-e.startLineNumber+1&&this._rebuildCellBuffer(e.endLineNumber-e.startLineNumber+1);const k=new Float32Array(this._cellValueBuffers[this._activeDoubleBufferIndex]);k.fill(0);const N=Fe.maxSupportedColumns*6;for(l=e.startLineNumber;l<=e.endLineNumber;l++)if(this._viewGpuContext.canRender(t,e,l)){y=e.getViewLineRenderingData(l),g=0,D=createContentSegmenter(y,t),r=t.spaceWidth*I,d=0,E=y.tokens,m=y.minColumn-1,_=0;for(let A=0,O=E.getCount();A<O;A++)if(_=E.getEndOffset(A),!(_<=m)){for(C=E.getMetadata(A),c=m;c<_&&!(c>Fe.maxSupportedColumns);c++){if(o=D.getSegmentAtIndex(c),o===void 0)continue;s=o,y.isBasicASCII&&t.useMonospaceOptimizations||(r=this.glyphRasterizer.getTextMetrics(s).width),v=void 0,b=void 0,S=void 0;for(w of y.inlineDecorations){if(l<w.range.startLineNumber||l>w.range.endLineNumber||l===w.range.startLineNumber&&c<w.range.startColumn-1||l===w.range.endLineNumber&&c>=w.range.endColumn-1)continue;const W=ViewGpuContext.decorationCssRuleExtractor.getStyleRules(this._viewGpuContext.canvas.domNode,w.inlineClassName);for(const B of W)for(const H of B.style){const V=((M=B.styleMap.get(H))==null?void 0:M.toString())??"";switch(H){case"color":{const K=Color.Format.CSS.parse(V);if(!K)throw new BugIndicatingError("Invalid color format "+V);v=K.toNumber32Bit();break}case"font-weight":{parseCssFontWeight$1(V)>=400?b=!0:b=!1;break}case"opacity":{S=parseCssOpacity$1(V);break}default:throw new BugIndicatingError("Unexpected inline decoration style")}}}if(s===" "||s==="	"){if(p=((l-1)*Fe.maxSupportedColumns+c)*6,k.fill(0,p,p+6),s==="	"){const W=c+g;g=CursorColumns.nextRenderTabStop(c+g,y.tabSize),d+=r*(g-W),g-=c+1}else d+=r;continue}const P=ViewGpuContext.decorationStyleCache.getOrCreateEntry(v,b,S);f=this._viewGpuContext.atlas.getGlyph(this.glyphRasterizer,s,C,P,d),u=Math.round(e.relativeVerticalOffset[l-e.startLineNumber]*I+Math.floor((e.lineHeight*I-(f.fontBoundingBoxAscent+f.fontBoundingBoxDescent))/2)+f.fontBoundingBoxAscent),p=((l-e.startLineNumber)*Fe.maxSupportedColumns+c)*6,k[p+0]=Math.floor(d),k[p+1]=u,k[p+4]=f.glyphIndex,k[p+5]=f.pageIndex,d+=r}m=_}L=((l-e.startLineNumber)*Fe.maxSupportedColumns+_)*6,x=(l-e.startLineNumber)*Fe.maxSupportedColumns*6,k.fill(0,L,x)}const R=(e.endLineNumber-e.startLineNumber+1)*N;return this._device.queue.writeBuffer(this._cellBindBuffer,0,k.buffer,0,(e.endLineNumber-e.startLineNumber)*N*Float32Array.BYTES_PER_ELEMENT),this._activeDoubleBufferIndex=this._activeDoubleBufferIndex?0:1,this._visibleObjectCount=R,R}draw(e,t){if(this._visibleObjectCount<=0)throw new BugIndicatingError("Attempt to draw 0 objects");e.draw(quadVertices.length/2,this._visibleObjectCount)}};Fe.maxSupportedColumns=2e3;let ViewportRenderStrategy=Fe;function parseCssFontWeight$1(a){switch(a){case"lighter":case"normal":return 400;case"bolder":case"bold":return 700}return parseInt(a)}function parseCssOpacity$1(a){return a.endsWith("%")?parseFloat(a.substring(0,a.length-1))/100:a.match(/^\d+(?:\.\d*)/)?parseFloat(a):1}const de=class de extends BaseRenderStrategy{get bindGroupEntries(){return[{binding:1,resource:{buffer:this._cellBindBuffer}},{binding:6,resource:{buffer:this._scrollOffsetBindBuffer}}]}constructor(e,t,s,o){super(e,t,s,o),this.type="fullfile",this.wgsl=fullFileRenderStrategyWgsl,this._activeDoubleBufferIndex=0,this._upToDateLines=[new Set,new Set],this._visibleObjectCount=0,this._finalRenderedLine=0,this._scrollInitialized=!1,this._queuedBufferUpdates=[[],[]];const r=de.maxSupportedLines*de.maxSupportedColumns*6*Float32Array.BYTES_PER_ELEMENT;this._cellBindBuffer=this._register(GPULifecycle.createBuffer(this._device,{label:"Monaco full file cell buffer",size:r,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST})).object,this._cellValueBuffers=[new ArrayBuffer(r),new ArrayBuffer(r)];const l=2;this._scrollOffsetBindBuffer=this._register(GPULifecycle.createBuffer(this._device,{label:"Monaco scroll offset buffer",size:l*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})).object,this._scrollOffsetValueBuffer=new Float32Array(l)}onConfigurationChanged(e){return this._invalidateAllLines(),this._queueBufferUpdate(e),!0}onDecorationsChanged(e){return this._invalidateAllLines(),!0}onTokensChanged(e){for(const t of e.ranges)this._invalidateLineRange(t.fromLineNumber,t.toLineNumber);return!0}onLinesDeleted(e){return this._invalidateLinesFrom(e.fromLineNumber),this._queueBufferUpdate(e),!0}onLinesInserted(e){return this._invalidateLinesFrom(e.fromLineNumber),!0}onLinesChanged(e){return this._invalidateLineRange(e.fromLineNumber,e.fromLineNumber+e.count),!0}onScrollChanged(e){const t=getActiveWindow().devicePixelRatio;return this._scrollOffsetValueBuffer[0]=((e==null?void 0:e.scrollLeft)??this._context.viewLayout.getCurrentScrollLeft())*t,this._scrollOffsetValueBuffer[1]=((e==null?void 0:e.scrollTop)??this._context.viewLayout.getCurrentScrollTop())*t,this._device.queue.writeBuffer(this._scrollOffsetBindBuffer,0,this._scrollOffsetValueBuffer),!0}onThemeChanged(e){return this._invalidateAllLines(),!0}onLineMappingChanged(e){return this._invalidateAllLines(),this._queueBufferUpdate(e),!0}onZonesChanged(e){return this._invalidateAllLines(),this._queueBufferUpdate(e),!0}_invalidateAllLines(){this._upToDateLines[0].clear(),this._upToDateLines[1].clear()}_invalidateLinesFrom(e){for(const t of[0,1]){const s=this._upToDateLines[t];for(const o of s)o>=e&&s.delete(o)}}_invalidateLineRange(e,t){for(let s=e;s<=t;s++)this._upToDateLines[0].delete(s),this._upToDateLines[1].delete(s)}reset(){this._invalidateAllLines();for(const e of[0,1]){const t=new Float32Array(this._cellValueBuffers[e]);t.fill(0,0,t.length),this._device.queue.writeBuffer(this._cellBindBuffer,0,t.buffer,0,t.byteLength)}this._finalRenderedLine=0}update(e,t){var W;let s="",o,r=0,l=0,c=0,d=0,u=0,g=0,f,p=0,m=0,_=0,C=0,b,v,S,y,w,L=0,x=0,E;const I=getActiveWindow().devicePixelRatio;let D;this._scrollInitialized||(this.onScrollChanged(),this._scrollInitialized=!0);const k=new Float32Array(this._cellValueBuffers[this._activeDoubleBufferIndex]),N=de.maxSupportedColumns*6,R=this._upToDateLines[this._activeDoubleBufferIndex];let M=3e3,A=0;const O=this._queuedBufferUpdates[this._activeDoubleBufferIndex];for(;O.length;){const B=O.shift();switch(B.type){case 2:case 8:case 17:{k.fill(0),M=1,A=Math.max(A,this._finalRenderedLine),this._finalRenderedLine=0;break}case 10:{const H=(B.fromLineNumber-1)*de.maxSupportedColumns*6,V=B.toLineNumber*de.maxSupportedColumns*6,K=(this._finalRenderedLine-(B.toLineNumber-B.fromLineNumber+1))*de.maxSupportedColumns*6;k.set(k.subarray(V),H),k.fill(0,K),M=Math.min(M,B.fromLineNumber),A=Math.max(A,this._finalRenderedLine),this._finalRenderedLine-=B.toLineNumber-B.fromLineNumber+1;break}}}for(l=e.startLineNumber;l<=e.endLineNumber;l++){if(!this._viewGpuContext.canRender(t,e,l)){L=(l-1)*de.maxSupportedColumns*6,x=l*de.maxSupportedColumns*6,k.fill(0,L,x),M=Math.min(M,l),A=Math.max(A,l);continue}if(!R.has(l)){M=Math.min(M,l),A=Math.max(A,l),y=e.getViewLineRenderingData(l),g=0,D=createContentSegmenter(y,t),r=t.spaceWidth*I,d=0,E=y.tokens,m=y.minColumn-1,_=0;for(let B=0,H=E.getCount();B<H;B++)if(_=E.getEndOffset(B),!(_<=m)){for(C=E.getMetadata(B),c=m;c<_&&!(c>de.maxSupportedColumns);c++){if(o=D.getSegmentAtIndex(c),o===void 0)continue;s=o,y.isBasicASCII&&t.useMonospaceOptimizations||(r=this.glyphRasterizer.getTextMetrics(s).width),v=void 0,b=void 0,S=void 0;for(w of y.inlineDecorations){if(l<w.range.startLineNumber||l>w.range.endLineNumber||l===w.range.startLineNumber&&c<w.range.startColumn-1||l===w.range.endLineNumber&&c>=w.range.endColumn-1)continue;const K=ViewGpuContext.decorationCssRuleExtractor.getStyleRules(this._viewGpuContext.canvas.domNode,w.inlineClassName);for(const z of K)for(const G of z.style){const X=((W=z.styleMap.get(G))==null?void 0:W.toString())??"";switch(G){case"color":{const Y=Color.Format.CSS.parse(X);if(!Y)throw new BugIndicatingError("Invalid color format "+X);v=Y.toNumber32Bit();break}case"font-weight":{parseCssFontWeight(X)>=400?b=!0:b=!1;break}case"opacity":{S=parseCssOpacity(X);break}default:throw new BugIndicatingError("Unexpected inline decoration style")}}}if(s===" "||s==="	"){if(p=((l-1)*de.maxSupportedColumns+c)*6,k.fill(0,p,p+6),s==="	"){const K=c+g;g=CursorColumns.nextRenderTabStop(c+g,y.tabSize),d+=r*(g-K),g-=c+1}else d+=r;continue}const V=ViewGpuContext.decorationStyleCache.getOrCreateEntry(v,b,S);f=this._viewGpuContext.atlas.getGlyph(this.glyphRasterizer,s,C,V,d),u=Math.round(e.relativeVerticalOffset[l-e.startLineNumber]*I+Math.floor((e.lineHeight*I-(f.fontBoundingBoxAscent+f.fontBoundingBoxDescent))/2)+f.fontBoundingBoxAscent),p=((l-1)*de.maxSupportedColumns+c)*6,k[p+0]=Math.floor(d),k[p+1]=u,k[p+4]=f.glyphIndex,k[p+5]=f.pageIndex,d+=r}m=_}L=((l-1)*de.maxSupportedColumns+_)*6,x=l*de.maxSupportedColumns*6,k.fill(0,L,x),R.add(l)}}const P=(e.endLineNumber-e.startLineNumber+1)*N;return M=Math.min(M,de.maxSupportedLines),A=Math.min(A,de.maxSupportedLines),M<=A&&this._device.queue.writeBuffer(this._cellBindBuffer,(M-1)*N*Float32Array.BYTES_PER_ELEMENT,k.buffer,(M-1)*N*Float32Array.BYTES_PER_ELEMENT,(A-M+1)*N*Float32Array.BYTES_PER_ELEMENT),this._finalRenderedLine=Math.max(this._finalRenderedLine,A),this._activeDoubleBufferIndex=this._activeDoubleBufferIndex?0:1,this._visibleObjectCount=P,P}draw(e,t){if(this._visibleObjectCount<=0)throw new BugIndicatingError("Attempt to draw 0 objects");e.draw(quadVertices.length/2,this._visibleObjectCount,void 0,(t.startLineNumber-1)*de.maxSupportedColumns)}_queueBufferUpdate(e){this._queuedBufferUpdates[0].push(e),this._queuedBufferUpdates[1].push(e)}};de.maxSupportedLines=3e3,de.maxSupportedColumns=200;let FullFileRenderStrategy=de;function parseCssFontWeight(a){switch(a){case"lighter":case"normal":return 400;case"bolder":case"bold":return 700}return parseInt(a)}function parseCssOpacity(a){return a.endsWith("%")?parseFloat(a.substring(0,a.length-1))/100:a.match(/^\d+(?:\.\d*)/)?parseFloat(a):1}var __decorate$2N=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2I=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let ViewLinesGpu=class extends ViewPart{constructor(e,t,s,o){super(e),this._viewGpuContext=t,this._instantiationService=s,this._logService=o,this._atlasGpuTextureVersions=[],this._initialized=!1,this._glyphRasterizer=this._register(new MutableDisposable),this._renderStrategy=this._register(new MutableDisposable),this.canvas=this._viewGpuContext.canvas.domNode,this._register(autorun(r=>{this._viewGpuContext.canvasDevicePixelDimensions.read(r);const l=this._lastViewportData;l&&setTimeout(()=>{l===this._lastViewportData&&this.renderText(l)})})),this.initWebgpu()}async initWebgpu(){if(this._device=ViewGpuContext.deviceSync||await ViewGpuContext.device,this._store.isDisposed)return;const e=ViewGpuContext.atlas;this._register(e.onDidDeleteGlyphs(()=>{this._atlasGpuTextureVersions.length=0,this._atlasGpuTextureVersions[0]=0,this._atlasGpuTextureVersions[1]=0,this._renderStrategy.value.reset()}));const t=navigator.gpu.getPreferredCanvasFormat();this._viewGpuContext.ctx.configure({device:this._device,format:t,alphaMode:"premultiplied"}),this._renderPassColorAttachment={view:null,loadOp:"load",storeOp:"store"},this._renderPassDescriptor={label:"Monaco render pass",colorAttachments:[this._renderPassColorAttachment]};let s;{const d=new Float32Array(6),u=(g=this.canvas.width,f=this.canvas.height)=>(d[0]=g,d[1]=f,d[2]=Math.ceil(this._context.configuration.options.get(165).contentLeft*getActiveWindow().devicePixelRatio),d[3]=0,d[4]=d[0]-d[2],d[5]=d[1]-d[3],d);s=this._register(GPULifecycle.createBuffer(this._device,{label:"Monaco uniform buffer",size:24,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST},()=>u())).object,this._register(runOnChange(this._viewGpuContext.canvasDevicePixelDimensions,({width:g,height:f})=>{this._device.queue.writeBuffer(s,0,u(g,f))})),this._register(runOnChange(this._viewGpuContext.contentLeft,()=>{this._device.queue.writeBuffer(s,0,u())}))}let o;o=this._register(GPULifecycle.createBuffer(this._device,{label:"Monaco atlas info uniform buffer",size:8,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST},()=>{const d=new Float32Array(2);return d[0]=e.pageSize,d[1]=e.pageSize,d})).object;const r=this._context.configuration.options.get(58),l=this._context.configuration.options.get(61);this._glyphRasterizer.value=this._register(new GlyphRasterizer(l,r,this._viewGpuContext.devicePixelRatio.get(),ViewGpuContext.decorationStyleCache)),this._register(runOnChange(this._viewGpuContext.devicePixelRatio,()=>{this._refreshGlyphRasterizer()})),this._renderStrategy.value=this._instantiationService.createInstance(FullFileRenderStrategy,this._context,this._viewGpuContext,this._device,this._glyphRasterizer),this._glyphStorageBuffer=this._register(GPULifecycle.createBuffer(this._device,{label:"Monaco glyph storage buffer",size:TextureAtlas.maximumPageCount*(TextureAtlasPage.maximumGlyphCount*24),usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST})).object,this._atlasGpuTextureVersions[0]=0,this._atlasGpuTextureVersions[1]=0,this._atlasGpuTexture=this._register(GPULifecycle.createTexture(this._device,{label:"Monaco atlas texture",format:"rgba8unorm",size:{width:e.pageSize,height:e.pageSize,depthOrArrayLayers:TextureAtlas.maximumPageCount},dimension:"2d",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT})).object,this._updateAtlasStorageBufferAndTexture(),this._vertexBuffer=this._register(GPULifecycle.createBuffer(this._device,{label:"Monaco vertex buffer",size:quadVertices.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST},quadVertices)).object;const c=this._device.createShaderModule({label:"Monaco shader module",code:this._renderStrategy.value.wgsl});if(this._pipeline=this._device.createRenderPipeline({label:"Monaco render pipeline",layout:"auto",vertex:{module:c,buffers:[{arrayStride:2*Float32Array.BYTES_PER_ELEMENT,attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]}]},fragment:{module:c,targets:[{format:t,blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]}}),this._rebuildBindGroup=()=>{this._bindGroup=this._device.createBindGroup({label:"Monaco bind group",layout:this._pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this._glyphStorageBuffer}},{binding:2,resource:this._device.createSampler({label:"Monaco atlas sampler",magFilter:"nearest",minFilter:"nearest"})},{binding:3,resource:this._atlasGpuTexture.createView()},{binding:4,resource:{buffer:s}},{binding:5,resource:{buffer:o}},...this._renderStrategy.value.bindGroupEntries]})},this._rebuildBindGroup(),this._initialized=!0,this._initViewportData){for(const d of this._initViewportData)this.renderText(d);this._initViewportData=void 0}}_refreshRenderStrategy(e){var s,o;if(((s=this._renderStrategy.value)==null?void 0:s.type)==="viewport"||e.endLineNumber<FullFileRenderStrategy.maxSupportedLines&&this._viewportMaxColumn(e)<FullFileRenderStrategy.maxSupportedColumns)return;this._logService.trace(`File is larger than ${FullFileRenderStrategy.maxSupportedLines} lines or ${FullFileRenderStrategy.maxSupportedColumns} columns, switching to viewport render strategy`);const t=this._instantiationService.createInstance(ViewportRenderStrategy,this._context,this._viewGpuContext,this._device,this._glyphRasterizer);this._renderStrategy.value=t,this._register(t.onDidChangeBindGroupEntries(()=>{var r;return(r=this._rebuildBindGroup)==null?void 0:r.call(this)})),(o=this._rebuildBindGroup)==null||o.call(this)}_viewportMaxColumn(e){let t=0,s;for(let o=e.startLineNumber;o<=e.endLineNumber;o++)s=e.getViewLineRenderingData(o),t=Math.max(t,s.maxColumn);return t}_updateAtlasStorageBufferAndTexture(){for(const[e,t]of ViewGpuContext.atlas.pages.entries()){if(e>=TextureAtlas.maximumPageCount){console.log(`Attempt to upload atlas page [${e}], only ${TextureAtlas.maximumPageCount} are supported currently`);continue}if(t.version===this._atlasGpuTextureVersions[e])continue;this._logService.trace("Updating atlas page[",e,"] from version ",this._atlasGpuTextureVersions[e]," to version ",t.version);const s=6*TextureAtlasPage.maximumGlyphCount,o=new Float32Array(s);let r=0;for(const l of t.glyphs)o[r+0]=l.x,o[r+0+1]=l.y,o[r+2]=l.w,o[r+2+1]=l.h,o[r+4]=l.originOffsetX,o[r+4+1]=l.originOffsetY,r+=6;if(r/6>TextureAtlasPage.maximumGlyphCount)throw new Error(`Attempting to write more glyphs (${r/6}) than the GPUBuffer can hold (${TextureAtlasPage.maximumGlyphCount})`);this._device.queue.writeBuffer(this._glyphStorageBuffer,e*6*TextureAtlasPage.maximumGlyphCount*Float32Array.BYTES_PER_ELEMENT,o,0,6*TextureAtlasPage.maximumGlyphCount),t.usedArea.right-t.usedArea.left>0&&t.usedArea.bottom-t.usedArea.top>0&&this._device.queue.copyExternalImageToTexture({source:t.source},{texture:this._atlasGpuTexture,origin:{x:t.usedArea.left,y:t.usedArea.top,z:e}},{width:t.usedArea.right-t.usedArea.left+1,height:t.usedArea.bottom-t.usedArea.top+1}),this._atlasGpuTextureVersions[e]=t.version}}prepareRender(e){throw new BugIndicatingError("Should not be called")}render(e){throw new BugIndicatingError("Should not be called")}onConfigurationChanged(e){return this._refreshGlyphRasterizer(),!0}onCursorStateChanged(e){return!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onLineMappingChanged(e){return!0}onRevealRangeRequest(e){return!0}onScrollChanged(e){return!0}onThemeChanged(e){return!0}onZonesChanged(e){return!0}_refreshGlyphRasterizer(){const e=this._glyphRasterizer.value;if(!e)return;const t=this._context.configuration.options.get(58),s=this._context.configuration.options.get(61),o=this._viewGpuContext.devicePixelRatio.get();(e.fontFamily!==t||e.fontSize!==s||e.devicePixelRatio!==o)&&(this._glyphRasterizer.value=new GlyphRasterizer(s,t,o,ViewGpuContext.decorationStyleCache))}renderText(e){if(this._initialized)return this._refreshRenderStrategy(e),this._renderText(e);this._initViewportData=this._initViewportData??[],this._initViewportData.push(e)}_renderText(e){this._viewGpuContext.rectangleRenderer.draw(e);const t=new ViewLineOptions(this._context.configuration,this._context.theme.type);this._renderStrategy.value.update(e,t),this._updateAtlasStorageBufferAndTexture();const s=this._device.createCommandEncoder({label:"Monaco command encoder"});this._renderPassColorAttachment.view=this._viewGpuContext.ctx.getCurrentTexture().createView({label:"Monaco canvas texture view"});const o=s.beginRenderPass(this._renderPassDescriptor);o.setPipeline(this._pipeline),o.setVertexBuffer(0,this._vertexBuffer);const r=Math.ceil(this._viewGpuContext.contentLeft.get()*this._viewGpuContext.devicePixelRatio.get());o.setScissorRect(r,0,this.canvas.width-r,this.canvas.height),o.setBindGroup(0,this._bindGroup),this._renderStrategy.value.draw(o,e),o.end();const l=s.finish();this._device.queue.submit([l]),this._lastViewportData=e,this._lastViewLineOptions=t}linesVisibleRangesForRange(e,t){if(!this._lastViewportData)return null;const s=e.endLineNumber,o=Range$2.intersectRanges(e,this._lastViewportData.visibleRange);if(!o)return null;const r=this._lastViewportData.startLineNumber,l=this._lastViewportData.endLineNumber,c=this._lastViewportData,d=this._lastViewLineOptions;if(!c||!d)return null;const u=[];let g=0;t&&(g=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new Position$1(o.startLineNumber,1)).lineNumber);for(let f=o.startLineNumber;f<=o.endLineNumber;f++){if(f<r||f>l)continue;const p=f===o.startLineNumber?o.startColumn:1,m=f!==s,_=m?this._context.viewModel.getLineMaxColumn(f):o.endColumn,C=this._visibleRangesForLineRange(f,p,_);if(C){if(t&&f<s){const b=g;g=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new Position$1(f+1,1)).lineNumber,b!==g&&(C.ranges[C.ranges.length-1].width+=d.spaceWidth)}u.push(new LineVisibleRanges(C.outsideRenderedLine,f,HorizontalRange.from(C.ranges),m))}}return u.length===0?null:u}_visibleRangesForLineRange(e,t,s){if(this.shouldRender())return null;const o=this._lastViewportData,r=this._lastViewLineOptions;if(!o||!r||e<o.startLineNumber||e>o.endLineNumber)return null;const l=o.getViewLineRenderingData(e),c=l.content;let d;l.isBasicASCII&&r.useMonospaceOptimizations||(d=createContentSegmenter(l,r));let u="",g=0,f=0;for(let C=0;C<t-1;C++){if(l.isBasicASCII&&r.useMonospaceOptimizations)u=c.charAt(C);else{if(u=d.getSegmentAtIndex(C),u===void 0)continue;f+=this._renderStrategy.value.glyphRasterizer.getTextMetrics(u).width/getActiveWindow().devicePixelRatio-r.spaceWidth}u==="	"?g=CursorColumns.nextRenderTabStop(g,l.tabSize):g++}let p=g,m=0;for(let C=t-1;C<s-1;C++){if(l.isBasicASCII&&r.useMonospaceOptimizations)u=c.charAt(C);else{if(u=d.getSegmentAtIndex(C),u===void 0)continue;m+=this._renderStrategy.value.glyphRasterizer.getTextMetrics(u).width/getActiveWindow().devicePixelRatio-r.spaceWidth}u==="	"?p=CursorColumns.nextRenderTabStop(p,l.tabSize):p++}return new VisibleRanges(!1,[new FloatHorizontalRange(g*r.spaceWidth+f,(p-g)*r.spaceWidth+m)])}visibleRangeForPosition(e){const t=this._visibleRangesForLineRange(e.lineNumber,e.column,e.column);return t?new HorizontalPosition(t.outsideRenderedLine,t.ranges[0].left):null}getLineWidth(e){if(!this._lastViewportData||!this._lastViewLineOptions||!this._viewGpuContext.canRender(this._lastViewLineOptions,this._lastViewportData,e))return;const t=this._lastViewportData.getViewLineRenderingData(e),s=this._visibleRangesForLineRange(e,1,t.maxColumn),o=s==null?void 0:s.ranges.at(-1);if(o)return o.width}getPositionAtCoordinate(e,t){if(!this._lastViewportData||!this._lastViewLineOptions||!this._viewGpuContext.canRender(this._lastViewLineOptions,this._lastViewportData,e))return;const s=this._lastViewportData.getViewLineRenderingData(e),o=s.content,r=getActiveWindow().devicePixelRatio,l=t*r,c=this._lastViewLineOptions.spaceWidth*r,d=createContentSegmenter(s,this._lastViewLineOptions);let u=0,g=0,f=0,p=0;for(let m=0;m<o.length;m++){const _=d.getSegmentAtIndex(m);if(_===void 0){p++;continue}if(_==="	"){const C=m+f;f=CursorColumns.nextRenderTabStop(m+f,s.tabSize),g=c*(f-C),f-=m+1}else s.isBasicASCII&&this._lastViewLineOptions.useMonospaceOptimizations?g=c:g=this._renderStrategy.value.glyphRasterizer.getTextMetrics(_).width;if(l<u+g/2)break;u+=g,p++}return new Position$1(e,p+1)}};ViewLinesGpu=__decorate$2N([__param$2I(2,IInstantiationService),__param$2I(3,ILogService)],ViewLinesGpu);const textAreaEditContext="";class IMEImpl{constructor(){this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._enabled=!0}get enabled(){return this._enabled}enable(){this._enabled=!0,this._onDidChange.fire()}disable(){this._enabled=!1,this._onDidChange.fire()}}const IME=new IMEImpl,IKeybindingService=createDecorator("keybindingService");class AbstractEditContext extends ViewPart{}class SimplePagedScreenReaderStrategy{_getPageOfLine(e,t){return Math.floor((e-1)/t)}_getRangeForPage(e,t){const s=e*t,o=s+1,r=s+t;return new Range$2(o,1,r+1,1)}fromEditorSelection(e,t,s,o){const l=this._getPageOfLine(t.startLineNumber,s),c=this._getRangeForPage(l,s),d=this._getPageOfLine(t.endLineNumber,s),u=this._getRangeForPage(d,s);let g=c.intersectRanges(new Range$2(1,1,t.startLineNumber,t.startColumn));if(o&&e.getValueLengthInRange(g,1)>500){const y=e.modifyPosition(g.getEndPosition(),-500);g=Range$2.fromPositions(y,g.getEndPosition())}const f=e.getValueInRange(g,1),p=e.getLineCount(),m=e.getLineMaxColumn(p);let _=u.intersectRanges(new Range$2(t.endLineNumber,t.endColumn,p,m));if(o&&e.getValueLengthInRange(_,1)>500){const y=e.modifyPosition(_.getStartPosition(),500);_=Range$2.fromPositions(_.getStartPosition(),y)}const C=e.getValueInRange(_,1);let b;if(l===d||l+1===d)b=e.getValueInRange(t,1);else{const y=c.intersectRanges(t),w=u.intersectRanges(t);b=e.getValueInRange(y,1)+String.fromCharCode(8230)+e.getValueInRange(w,1)}o&&b.length>2*500&&(b=b.substring(0,500)+String.fromCharCode(8230)+b.substring(b.length-500,b.length));let v,S;return t.getDirection()===0?(v=f.length,S=f.length+b.length):(S=f.length,v=f.length+b.length),{value:f+b+C,selection:t,selectionStart:v,selectionEnd:S,startPositionWithinEditor:g.getStartPosition(),newlineCountBeforeSelection:g.endLineNumber-g.startLineNumber}}}function ariaLabelForScreenReaderContent(a,e){var s,o,r;if(a.get(2)===1){const l=(s=e.lookupKeybinding("editor.action.toggleScreenReaderAccessibilityMode"))==null?void 0:s.getAriaLabel(),c=(o=e.lookupKeybinding("workbench.action.showCommands"))==null?void 0:o.getAriaLabel(),d=(r=e.lookupKeybinding("workbench.action.openGlobalKeybindings"))==null?void 0:r.getAriaLabel(),u=localize(56,"The editor is not accessible at this time.");return l?localize(57,"{0} To enable screen reader optimized mode, use {1}",u,l):c?localize(58,"{0} To enable screen reader optimized mode, open the quick pick with {1} and run the command Toggle Screen Reader Accessibility Mode, which is currently not triggerable via keyboard.",u,c):d?localize(59,"{0} Please assign a keybinding for the command Toggle Screen Reader Accessibility Mode by accessing the keybindings editor with {1} and run it.",u,d):u}return a.get(8)}function newlinecount(a){let e=0,t=-1;do{if(t=a.indexOf(`
`,t+1),t===-1)break;e++}while(!0);return e}var __decorate$2M=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2H=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class VisibleTextAreaData{constructor(e,t,s,o,r){this._context=e,this.modelLineNumber=t,this.distanceToModelLineStart=s,this.widthOfHiddenLineTextBefore=o,this.distanceToModelLineEnd=r,this._visibleTextAreaBrand=void 0,this.startPosition=null,this.endPosition=null,this.visibleTextareaStart=null,this.visibleTextareaEnd=null,this._previousPresentation=null}prepareRender(e){const t=new Position$1(this.modelLineNumber,this.distanceToModelLineStart+1),s=new Position$1(this.modelLineNumber,this._context.viewModel.model.getLineMaxColumn(this.modelLineNumber)-this.distanceToModelLineEnd);this.startPosition=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(t),this.endPosition=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(s),this.startPosition.lineNumber===this.endPosition.lineNumber?(this.visibleTextareaStart=e.visibleRangeForPosition(this.startPosition),this.visibleTextareaEnd=e.visibleRangeForPosition(this.endPosition)):(this.visibleTextareaStart=null,this.visibleTextareaEnd=null)}definePresentation(e){return this._previousPresentation||(e?this._previousPresentation=e:this._previousPresentation={foreground:1,italic:!1,bold:!1,underline:!1,strikethrough:!1}),this._previousPresentation}}const canUseZeroSizeTextarea=isFirefox$1;let TextAreaEditContext=class extends AbstractEditContext{constructor(e,t,s,o,r,l){super(e),this._keybindingService=r,this._instantiationService=l,this._primaryCursorPosition=new Position$1(1,1),this._primaryCursorVisibleRange=null,this._viewController=s,this._visibleRangeProvider=o,this._scrollLeft=0,this._scrollTop=0;const c=this._context.configuration.options,d=c.get(165);this._setAccessibilityOptions(c),this._contentLeft=d.contentLeft,this._contentWidth=d.contentWidth,this._contentHeight=d.height,this._fontInfo=c.get(59),this._emptySelectionClipboard=c.get(45),this._copyWithSyntaxHighlighting=c.get(31),this._visibleTextArea=null,this._selections=[new Selection$1(1,1,1,1)],this._modelSelections=[new Selection$1(1,1,1,1)],this._lastRenderPosition=null,this.textArea=createFastDomNode(document.createElement("textarea")),PartFingerprints.write(this.textArea,7),this.textArea.setClassName(`inputarea ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off");const{tabSize:u}=this._context.viewModel.model.getOptions();this.textArea.domNode.style.tabSize=`${u*this._fontInfo.spaceWidth}px`,this.textArea.setAttribute("autocorrect","off"),this.textArea.setAttribute("autocapitalize","off"),this.textArea.setAttribute("autocomplete","off"),this.textArea.setAttribute("spellcheck","false"),this.textArea.setAttribute("aria-label",ariaLabelForScreenReaderContent(c,this._keybindingService)),this.textArea.setAttribute("aria-required",c.get(9)?"true":"false"),this.textArea.setAttribute("tabindex",String(c.get(140))),this.textArea.setAttribute("role","textbox"),this.textArea.setAttribute("aria-roledescription",localize(60,"editor")),this.textArea.setAttribute("aria-multiline","true"),this.textArea.setAttribute("aria-autocomplete",c.get(104)?"none":"both"),this._ensureReadOnlyAttribute(),this.textAreaCover=createFastDomNode(document.createElement("div")),this.textAreaCover.setPosition("absolute"),t.appendChild(this.textArea),t.appendChild(this.textAreaCover);const g=new SimplePagedScreenReaderStrategy,f={getDataToCopy:()=>getDataToCopy(this._context.viewModel,this._modelSelections,this._emptySelectionClipboard,this._copyWithSyntaxHighlighting),getScreenReaderContent:()=>{if(this._accessibilitySupport===1){const _=this._selections[0];if(isMacintosh&&_.isEmpty()){const b=_.getStartPosition();let v=this._getWordBeforePosition(b);if(v.length===0&&(v=this._getCharacterBeforePosition(b)),v.length>0)return new TextAreaState(v,v.length,v.length,Range$2.fromPositions(b),0)}const C=500;if(isMacintosh&&!_.isEmpty()&&this._context.viewModel.getValueLengthInRange(_,0)<C){const b=this._context.viewModel.getValueInRange(_,0);return new TextAreaState(b,0,b.length,_,0)}if(isSafari$1&&!_.isEmpty()){const b="vscode-placeholder";return new TextAreaState(b,0,b.length,null,void 0)}return TextAreaState.EMPTY}if(isAndroid$1){const _=this._selections[0];if(_.isEmpty()){const C=_.getStartPosition(),[b,v]=this._getAndroidWordAtPosition(C);if(b.length>0)return new TextAreaState(b,v,v,Range$2.fromPositions(C),0)}return TextAreaState.EMPTY}const m=g.fromEditorSelection(this._context.viewModel,this._selections[0],this._accessibilityPageSize,this._accessibilitySupport===0);return TextAreaState.fromScreenReaderContentState(m)},deduceModelPosition:(m,_,C)=>this._context.viewModel.deduceModelPositionRelativeToViewPosition(m,_,C)},p=this._register(new TextAreaWrapper(this.textArea.domNode));this._textAreaInput=this._register(this._instantiationService.createInstance(TextAreaInput,f,p,OS,{isAndroid:isAndroid$1,isChrome:isChrome$1,isFirefox:isFirefox$1,isSafari:isSafari$1})),this._register(this._textAreaInput.onKeyDown(m=>{this._viewController.emitKeyDown(m)})),this._register(this._textAreaInput.onKeyUp(m=>{this._viewController.emitKeyUp(m)})),this._register(this._textAreaInput.onPaste(m=>{let _=!1,C=null,b=null;m.metadata&&(_=this._emptySelectionClipboard&&!!m.metadata.isFromEmptySelection,C=typeof m.metadata.multicursorText<"u"?m.metadata.multicursorText:null,b=m.metadata.mode),this._viewController.paste(m.text,_,C,b)})),this._register(this._textAreaInput.onCut(()=>{this._viewController.cut()})),this._register(this._textAreaInput.onType(m=>{m.replacePrevCharCnt||m.replaceNextCharCnt||m.positionDelta?this._viewController.compositionType(m.text,m.replacePrevCharCnt,m.replaceNextCharCnt,m.positionDelta):this._viewController.type(m.text)})),this._register(this._textAreaInput.onSelectionChangeRequest(m=>{this._viewController.setSelection(m)})),this._register(this._textAreaInput.onCompositionStart(m=>{const _=this.textArea.domNode,C=this._modelSelections[0],{distanceToModelLineStart:b,widthOfHiddenTextBefore:v}=(()=>{const y=_.value.substring(0,Math.min(_.selectionStart,_.selectionEnd)),w=y.lastIndexOf(`
`),L=y.substring(w+1),x=L.lastIndexOf("	"),E=L.length-x-1,I=C.getStartPosition(),D=Math.min(I.column-1,E),k=I.column-1-D,N=L.substring(0,L.length-D),{tabSize:R}=this._context.viewModel.model.getOptions(),M=measureText(this.textArea.domNode.ownerDocument,N,this._fontInfo,R);return{distanceToModelLineStart:k,widthOfHiddenTextBefore:M}})(),{distanceToModelLineEnd:S}=(()=>{const y=_.value.substring(Math.max(_.selectionStart,_.selectionEnd)),w=y.indexOf(`
`),L=w===-1?y:y.substring(0,w),x=L.indexOf("	"),E=x===-1?L.length:L.length-x-1,I=C.getEndPosition(),D=Math.min(this._context.viewModel.model.getLineMaxColumn(I.lineNumber)-I.column,E);return{distanceToModelLineEnd:this._context.viewModel.model.getLineMaxColumn(I.lineNumber)-I.column-D}})();this._context.viewModel.revealRange("keyboard",!0,Range$2.fromPositions(this._selections[0].getStartPosition()),0,1),this._visibleTextArea=new VisibleTextAreaData(this._context,C.startLineNumber,b,v,S),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off"),this._visibleTextArea.prepareRender(this._visibleRangeProvider),this._render(),this.textArea.setClassName(`inputarea ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME} ime-input`),this._viewController.compositionStart(),this._context.viewModel.onCompositionStart()})),this._register(this._textAreaInput.onCompositionUpdate(m=>{this._visibleTextArea&&(this._visibleTextArea.prepareRender(this._visibleRangeProvider),this._render())})),this._register(this._textAreaInput.onCompositionEnd(()=>{this._visibleTextArea=null,this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off"),this._render(),this.textArea.setClassName(`inputarea ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`),this._viewController.compositionEnd(),this._context.viewModel.onCompositionEnd()})),this._register(this._textAreaInput.onFocus(()=>{this._context.viewModel.setHasFocus(!0)})),this._register(this._textAreaInput.onBlur(()=>{this._context.viewModel.setHasFocus(!1)})),this._register(IME.onDidChange(()=>{this._ensureReadOnlyAttribute()}))}get domNode(){return this.textArea}writeScreenReaderContent(e){this._textAreaInput.writeNativeTextAreaContent(e)}dispose(){super.dispose(),this.textArea.domNode.remove(),this.textAreaCover.domNode.remove()}_getAndroidWordAtPosition(e){const t='`~!@#$%^&*()-=+[{]}\\|;:",.<>/?',s=this._context.viewModel.getLineContent(e.lineNumber),o=getMapForWordSeparators(t,[]);let r=!0,l=e.column,c=!0,d=e.column,u=0;for(;u<50&&(r||c);){if(r&&l<=1&&(r=!1),r){const g=s.charCodeAt(l-2);o.get(g)!==0?r=!1:l--}if(c&&d>s.length&&(c=!1),c){const g=s.charCodeAt(d-1);o.get(g)!==0?c=!1:d++}u++}return[s.substring(l-1,d-1),e.column-l]}_getWordBeforePosition(e){const t=this._context.viewModel.getLineContent(e.lineNumber),s=getMapForWordSeparators(this._context.configuration.options.get(148),[]);let o=e.column,r=0;for(;o>1;){const l=t.charCodeAt(o-2);if(s.get(l)!==0||r>50)return t.substring(o-1,e.column-1);r++,o--}return t.substring(0,e.column-1)}_getCharacterBeforePosition(e){if(e.column>1){const s=this._context.viewModel.getLineContent(e.lineNumber).charAt(e.column-2);if(!isHighSurrogate(s.charCodeAt(0)))return s}return""}_setAccessibilityOptions(e){this._accessibilitySupport=e.get(2);const t=e.get(3);this._accessibilitySupport===2&&t===EditorOptions.accessibilityPageSize.defaultValue?this._accessibilityPageSize=500:this._accessibilityPageSize=t;const o=e.get(165).wrappingColumn;if(o!==-1&&this._accessibilitySupport!==1){const r=e.get(59);this._textAreaWrapping=!0,this._textAreaWidth=Math.round(o*r.typicalHalfwidthCharacterWidth)}else this._textAreaWrapping=!1,this._textAreaWidth=canUseZeroSizeTextarea?0:1}onConfigurationChanged(e){const t=this._context.configuration.options,s=t.get(165);this._setAccessibilityOptions(t),this._contentLeft=s.contentLeft,this._contentWidth=s.contentWidth,this._contentHeight=s.height,this._fontInfo=t.get(59),this._emptySelectionClipboard=t.get(45),this._copyWithSyntaxHighlighting=t.get(31),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off");const{tabSize:o}=this._context.viewModel.model.getOptions();return this.textArea.domNode.style.tabSize=`${o*this._fontInfo.spaceWidth}px`,this.textArea.setAttribute("aria-label",ariaLabelForScreenReaderContent(t,this._keybindingService)),this.textArea.setAttribute("aria-required",t.get(9)?"true":"false"),this.textArea.setAttribute("tabindex",String(t.get(140))),(e.hasChanged(41)||e.hasChanged(104))&&this._ensureReadOnlyAttribute(),e.hasChanged(2)&&this._textAreaInput.writeNativeTextAreaContent("strategy changed"),!0}onCursorStateChanged(e){return this._selections=e.selections.slice(0),this._modelSelections=e.modelSelections.slice(0),this._textAreaInput.writeNativeTextAreaContent("selection changed"),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return this._scrollLeft=e.scrollLeft,this._scrollTop=e.scrollTop,!0}onZonesChanged(e){return!0}isFocused(){return this._textAreaInput.isFocused()}focus(){this._textAreaInput.focusTextArea()}refreshFocusState(){this._textAreaInput.refreshFocusState()}getLastRenderData(){return this._lastRenderPosition}setAriaOptions(e){e.activeDescendant?(this.textArea.setAttribute("aria-haspopup","true"),this.textArea.setAttribute("aria-autocomplete","list"),this.textArea.setAttribute("aria-activedescendant",e.activeDescendant)):(this.textArea.setAttribute("aria-haspopup","false"),this.textArea.setAttribute("aria-autocomplete","both"),this.textArea.removeAttribute("aria-activedescendant")),e.role&&this.textArea.setAttribute("role",e.role)}_ensureReadOnlyAttribute(){const e=this._context.configuration.options;!IME.enabled||e.get(41)&&e.get(104)?this.textArea.setAttribute("readonly","true"):this.textArea.removeAttribute("readonly")}prepareRender(e){var t;this._primaryCursorPosition=new Position$1(this._selections[0].positionLineNumber,this._selections[0].positionColumn),this._primaryCursorVisibleRange=e.visibleRangeForPosition(this._primaryCursorPosition),(t=this._visibleTextArea)==null||t.prepareRender(e)}render(e){this._textAreaInput.writeNativeTextAreaContent("render"),this._render()}_render(){if(this._visibleTextArea){const s=this._visibleTextArea.visibleTextareaStart,o=this._visibleTextArea.visibleTextareaEnd,r=this._visibleTextArea.startPosition,l=this._visibleTextArea.endPosition;if(r&&l&&s&&o&&o.left>=this._scrollLeft&&s.left<=this._scrollLeft+this._contentWidth){const c=this._context.viewLayout.getVerticalOffsetForLineNumber(this._primaryCursorPosition.lineNumber)-this._scrollTop,d=newlinecount(this.textArea.domNode.value.substr(0,this.textArea.domNode.selectionStart));let u=this._visibleTextArea.widthOfHiddenLineTextBefore,g=this._contentLeft+s.left-this._scrollLeft,f=o.left-s.left+1;if(g<this._contentLeft){const y=this._contentLeft-g;g+=y,u+=y,f-=y}f>this._contentWidth&&(f=this._contentWidth);const p=this._context.viewLayout.getLineHeightForLineNumber(r.lineNumber),m=this._context.viewModel.getFontSizeAtPosition(this._primaryCursorPosition),_=this._context.viewModel.getViewLineData(r.lineNumber),C=_.tokens.findTokenIndexAtOffset(r.column-1),b=_.tokens.findTokenIndexAtOffset(l.column-1),v=C===b,S=this._visibleTextArea.definePresentation(v?_.tokens.getPresentation(C):null);this.textArea.domNode.scrollTop=d*p,this.textArea.domNode.scrollLeft=u,this._doRender({lastRenderPosition:null,top:c,left:g,width:f,height:p,useCover:!1,color:(TokenizationRegistry.getColorMap()||[])[S.foreground],italic:S.italic,bold:S.bold,underline:S.underline,strikethrough:S.strikethrough,fontSize:m})}return}if(!this._primaryCursorVisibleRange){this._renderAtTopLeft();return}const e=this._contentLeft+this._primaryCursorVisibleRange.left-this._scrollLeft;if(e<this._contentLeft||e>this._contentLeft+this._contentWidth){this._renderAtTopLeft();return}const t=this._context.viewLayout.getVerticalOffsetForLineNumber(this._selections[0].positionLineNumber)-this._scrollTop;if(t<0||t>this._contentHeight){this._renderAtTopLeft();return}if(isMacintosh||this._accessibilitySupport===2){const s=this._primaryCursorPosition.lineNumber,o=this._context.viewLayout.getLineHeightForLineNumber(s);this._doRender({lastRenderPosition:this._primaryCursorPosition,top:t,left:this._textAreaWrapping?this._contentLeft:e,width:this._textAreaWidth,height:o,useCover:!1}),this.textArea.domNode.scrollLeft=this._primaryCursorVisibleRange.left;const r=this._textAreaInput.textAreaState.newlineCountBeforeSelection??newlinecount(this.textArea.domNode.value.substring(0,this.textArea.domNode.selectionStart));this.textArea.domNode.scrollTop=r*o;return}this._doRender({lastRenderPosition:this._primaryCursorPosition,top:t,left:this._textAreaWrapping?this._contentLeft:e,width:this._textAreaWidth,height:canUseZeroSizeTextarea?0:1,useCover:!1})}_renderAtTopLeft(){this._doRender({lastRenderPosition:null,top:0,left:0,width:this._textAreaWidth,height:canUseZeroSizeTextarea?0:1,useCover:!0})}_doRender(e){this._lastRenderPosition=e.lastRenderPosition;const t=this.textArea,s=this.textAreaCover;applyFontInfo(t,this._fontInfo),t.setTop(e.top),t.setLeft(e.left),t.setWidth(e.width),t.setHeight(e.height),t.setLineHeight(e.height),t.setFontSize(e.fontSize??this._fontInfo.fontSize),t.setColor(e.color?Color.Format.CSS.formatHex(e.color):""),t.setFontStyle(e.italic?"italic":""),e.bold&&t.setFontWeight("bold"),t.setTextDecoration(`${e.underline?" underline":""}${e.strikethrough?" line-through":""}`),s.setTop(e.useCover?e.top:0),s.setLeft(e.useCover?e.left:0),s.setWidth(e.useCover?e.width:0),s.setHeight(e.useCover?e.height:0);const o=this._context.configuration.options;o.get(66)?s.setClassName("monaco-editor-background textAreaCover "+Margin.OUTER_CLASS_NAME):o.get(76).renderType!==0?s.setClassName("monaco-editor-background textAreaCover "+LineNumbersOverlay.CLASS_NAME):s.setClassName("monaco-editor-background textAreaCover")}};TextAreaEditContext=__decorate$2M([__param$2H(4,IKeybindingService),__param$2H(5,IInstantiationService)],TextAreaEditContext);function measureText(a,e,t,s){if(e.length===0)return 0;const o=a.createElement("div");o.style.position="absolute",o.style.top="-50000px",o.style.width="50000px";const r=a.createElement("span");applyFontInfo(r,t),r.style.whiteSpace="pre",r.style.tabSize=`${s*t.spaceWidth}px`,r.append(e),o.appendChild(r),a.body.appendChild(o);const l=r.offsetWidth;return o.remove(),l}const nativeEditContext="";var __decorate$2L=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2G=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let FocusTracker=class extends Disposable{constructor(e,t,s){super(),this._domNode=t,this._onFocusChange=s,this._isFocused=!1,this._isPaused=!1,this._register(addDisposableListener(this._domNode,"focus",()=>{e.trace("NativeEditContext.focus"),!this._isPaused&&this.refreshFocusState()})),this._register(addDisposableListener(this._domNode,"blur",()=>{e.trace("NativeEditContext.blur"),!this._isPaused&&this._handleFocusedChanged(!1)}))}pause(){this._isPaused=!0}resume(){this._isPaused=!1,this.refreshFocusState()}_handleFocusedChanged(e){this._isFocused!==e&&(this._isFocused=e,this._onFocusChange(this._isFocused))}focus(){this._domNode.focus(),this.refreshFocusState()}refreshFocusState(){const e=getShadowRoot(this._domNode),t=e?e.activeElement:getActiveElement(),s=this._domNode===t;this._handleFocusedChanged(s)}get isFocused(){return this._isFocused}};FocusTracker=__decorate$2L([__param$2G(0,ILogService)],FocusTracker);function editContextAddDisposableListener(a,e,t,s){return a.addEventListener(e,t,s),{dispose(){a.removeEventListener(e,t)}}}var __decorate$2K=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2F=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const ttPolicy$6=createTrustedTypesPolicy$1("richScreenReaderContent",{createHTML:a=>a}),LINE_NUMBER_ATTRIBUTE="data-line-number";let RichScreenReaderContent=class extends Disposable{constructor(e,t,s,o){super(),this._domNode=e,this._context=t,this._viewController=s,this._accessibilityService=o,this._selectionChangeListener=this._register(new MutableDisposable),this._accessibilityPageSize=1,this._ignoreSelectionChangeTime=0,this._state=RichScreenReaderState.NULL,this._strategy=new RichPagedScreenReaderStrategy,this._renderedLines=new Map,this._renderedSelection=new Selection$1(1,1,1,1),this.onConfigurationChanged(this._context.configuration.options)}updateScreenReaderContent(e){const t=getActiveWindow().document.activeElement;if(!t||t!==this._domNode.domNode)return;if(this._accessibilityService.isScreenReaderOptimized()){const o=this._getScreenReaderContentLineIntervals(e);this._state.equals(o)||(this._state=o,this._renderedLines=this._renderScreenReaderContent(o)),this._renderedSelection.equalsSelection(e)||(this._renderedSelection=e,this._setSelectionOnScreenReaderContent(this._context,this._renderedLines,e))}else this._state=RichScreenReaderState.NULL,this._setIgnoreSelectionChangeTime("setValue"),this._domNode.domNode.textContent=""}updateScrollTop(e){const t=this._state.intervals;if(!t.length)return;const s=this._context.viewModel.viewLayout,o=t[0].startLine,r=s.getVerticalOffsetForLineNumber(o),l=s.getVerticalOffsetForLineNumber(e.positionLineNumber);this._domNode.domNode.scrollTop=l-r}onFocusChange(e){e?this._selectionChangeListener.value=this._setSelectionChangeListener():this._selectionChangeListener.value=void 0}onConfigurationChanged(e){this._accessibilityPageSize=e.get(3)}onWillCut(){this._setIgnoreSelectionChangeTime("onCut")}onWillPaste(){this._setIgnoreSelectionChangeTime("onWillPaste")}_setIgnoreSelectionChangeTime(e){this._ignoreSelectionChangeTime=Date.now()}_setSelectionChangeListener(){let e=0;return addDisposableListener(this._domNode.domNode.ownerDocument,"selectionchange",()=>{if(!(getActiveWindow().document.activeElement===this._domNode.domNode)||!this._accessibilityService.isScreenReaderOptimized()||!IME.enabled)return;const r=Date.now(),l=r-e;if(e=r,l<5)return;const c=r-this._ignoreSelectionChangeTime;if(this._ignoreSelectionChangeTime=0,c<100)return;const d=this._getEditorSelectionFromDomRange();d&&this._viewController.setSelection(d)})}_renderScreenReaderContent(e){const t=[],s=new Map;for(const o of e.intervals)for(let r=o.startLine;r<=o.endLine;r++){const l=this._renderLine(r);s.set(r,l),t.push(l.domNode)}return this._setIgnoreSelectionChangeTime("setValue"),this._domNode.domNode.replaceChildren(...t),s}_renderLine(e){const t=this._context.viewModel,s=t.getViewLineRenderingData(e),o=this._context.configuration.options,r=o.get(59),l=o.get(133),c=o.get(108),d=o.get(60),u=o.get(40),g=LineDecoration.filter(s.inlineDecorations,e,s.minColumn,s.maxColumn),f=r.isMonospace&&!u,p=d!==EditorFontLigatures.OFF;let m;o.get(47)==="off"?m=o.get(113):m="none";const C=new RenderLineInput(f,r.canUseHalfwidthRightwardsArrow,s.content,s.continuesWithWrappedLine,s.isBasicASCII,s.containsRTL,s.minColumn-1,s.tokens,g,s.tabSize,s.startVisibleColumn,r.spaceWidth,r.middotWidth,r.wsmiddotWidth,l,m,c,p,null,null,0,!0),b=new StringBuilder(1e4),v=renderViewLine(C,b),S=b.build(),y=(ttPolicy$6==null?void 0:ttPolicy$6.createHTML(S))??S,w=t.viewLayout.getLineHeightForLineNumber(e)+"px",L=document.createElement("div");return L.innerHTML=y,L.style.lineHeight=w,L.style.height=w,L.setAttribute(LINE_NUMBER_ATTRIBUTE,e.toString()),new RichRenderedScreenReaderLine(L,v.characterMapping)}_setSelectionOnScreenReaderContent(e,t,s){const r=getActiveWindow().document.getSelection();if(!r)return;const l=s.startLineNumber,c=s.endLineNumber,d=t.get(l),u=t.get(c);if(!d||!u)return;const g=e.viewModel,f=g.model,p=g.coordinatesConverter,m=new Range$2(l,1,l,s.selectionStartColumn),_=p.convertViewRangeToModelRange(m),C=f.getCharacterCountInRange(_),b=new Range$2(c,1,c,s.positionColumn),v=p.convertViewRangeToModelRange(b),S=f.getCharacterCountInRange(v),y=d.characterMapping.getDomPosition(C),w=u.characterMapping.getDomPosition(S),L=d.domNode.firstChild,x=u.domNode.firstChild,E=L.childNodes,I=x.childNodes,D=E.item(y.partIndex),k=I.item(w.partIndex);!D.firstChild||!k.firstChild||(this._setIgnoreSelectionChangeTime("setRange"),r.setBaseAndExtent(D.firstChild,s.startColumn===1?0:y.charIndex+1,k.firstChild,s.endColumn===1?0:w.charIndex+1))}_getScreenReaderContentLineIntervals(e){return this._strategy.fromEditorSelection(this._context.viewModel,e,this._accessibilityPageSize)}_getEditorSelectionFromDomRange(){var S,y,w,L;if(!this._renderedLines)return;const e=getActiveWindow().document.getSelection();if(!e||e.rangeCount===0)return;const s=e.getRangeAt(0),o=s.startContainer,r=s.endContainer,l=o.parentElement,c=r.parentElement;if(!l||!isHTMLElement(l)||!c||!isHTMLElement(c))return;const d=(S=l.parentElement)==null?void 0:S.parentElement,u=(y=c.parentElement)==null?void 0:y.parentElement;if(!d||!u)return;const g=d.getAttribute(LINE_NUMBER_ATTRIBUTE),f=u.getAttribute(LINE_NUMBER_ATTRIBUTE);if(!g||!f)return;const p=parseInt(g),m=parseInt(f),_=(w=this._renderedLines.get(p))==null?void 0:w.characterMapping,C=(L=this._renderedLines.get(m))==null?void 0:L.characterMapping;if(!_||!C)return;const b=getColumnOfNodeOffset(_,l,s.startOffset),v=getColumnOfNodeOffset(C,c,s.endOffset);return e.direction==="forward"?new Selection$1(p,b,m,v):new Selection$1(m,v,p,b)}};RichScreenReaderContent=__decorate$2K([__param$2F(3,IAccessibilityService)],RichScreenReaderContent);class RichRenderedScreenReaderLine{constructor(e,t){this.domNode=e,this.characterMapping=t}}class LineInterval{constructor(e,t){this.startLine=e,this.endLine=t}}class RichScreenReaderState{constructor(e,t){this.intervals=t;let s="";for(const o of t)for(let r=o.startLine;r<=o.endLine;r++)s+=e.getLineContent(r)+`
`;this.value=s}equals(e){return this.value===e.value}static get NULL(){const e={getLineContent:()=>"",getLineCount:()=>1,getLineMaxColumn:()=>1,getValueInRange:()=>"",getValueLengthInRange:()=>0,modifyPosition:(t,s)=>t};return new RichScreenReaderState(e,[])}}class RichPagedScreenReaderStrategy{constructor(){}_getPageOfLine(e,t){return Math.floor((e-1)/t)}_getRangeForPage(e,t,s){const o=t*s,r=o+1,l=Math.min(o+s,e.getLineCount());return new LineInterval(r,l)}fromEditorSelection(e,t,s){const o=this._getPageOfLine(t.startLineNumber,s),r=this._getRangeForPage(e,o,s),l=this._getPageOfLine(t.endLineNumber,s),c=this._getRangeForPage(e,l,s),d=[{startLine:r.startLine,endLine:r.endLine}];return o+1<l&&d.push({startLine:c.startLine,endLine:c.endLine}),new RichScreenReaderState(e,d)}}class BaseEdit{constructor(e){this.replacements=e;let t=-1;for(const s of e){if(!(s.replaceRange.start>=t))throw new BugIndicatingError(`Edits must be disjoint and sorted. Found ${s} after ${t}`);t=s.replaceRange.endExclusive}}toString(){return`[${this.replacements.map(t=>t.toString()).join(", ")}]`}normalize(){const e=[];let t;for(const s of this.replacements)if(!(s.getNewLength()===0&&s.replaceRange.length===0)){if(t&&t.replaceRange.endExclusive===s.replaceRange.start){const o=t.tryJoinTouching(s);if(o){t=o;continue}}t&&e.push(t),t=s}return t&&e.push(t),this._createNew(e)}compose(e){const t=this.normalize(),s=e.normalize();if(t.isEmpty())return s;if(s.isEmpty())return t;const o=[...t.replacements],r=[];let l=0;for(const c of s.replacements){for(;;){const f=o[0];if(!f||f.replaceRange.start+l+f.getNewLength()>=c.replaceRange.start)break;o.shift(),r.push(f),l+=f.getNewLength()-f.replaceRange.length}const d=l;let u,g;for(;;){const f=o[0];if(!f||f.replaceRange.start+l>c.replaceRange.endExclusive)break;u||(u=f),g=f,o.shift(),l+=f.getNewLength()-f.replaceRange.length}if(!u)r.push(c.delta(-l));else{const f=Math.min(u.replaceRange.start,c.replaceRange.start-d),p=c.replaceRange.start-(u.replaceRange.start+d);if(p>0){const b=u.slice(OffsetRange.emptyAt(f),new OffsetRange(0,p));r.push(b)}if(!g)throw new BugIndicatingError("Invariant violation: lastIntersecting is undefined");const m=g.replaceRange.endExclusive+l-c.replaceRange.endExclusive;if(m>0){const b=g.slice(OffsetRange.ofStartAndLength(g.replaceRange.endExclusive,0),new OffsetRange(g.getNewLength()-m,g.getNewLength()));o.unshift(b),l-=b.getNewLength()-b.replaceRange.length}const _=new OffsetRange(f,c.replaceRange.endExclusive-l),C=c.slice(_,new OffsetRange(0,c.getNewLength()));r.push(C)}}for(;;){const c=o.shift();if(!c)break;r.push(c)}return this._createNew(r).normalize()}getNewRanges(){const e=[];let t=0;for(const s of this.replacements)e.push(OffsetRange.ofStartAndLength(s.replaceRange.start+t,s.getNewLength())),t+=s.getLengthDelta();return e}isEmpty(){return this.replacements.length===0}}class BaseReplacement{constructor(e){this.replaceRange=e}delta(e){return this.slice(this.replaceRange.delta(e),new OffsetRange(0,this.getNewLength()))}getLengthDelta(){return this.getNewLength()-this.replaceRange.length}toString(){return`{ ${this.replaceRange.toString()} -> ${this.getNewLength()} }`}get isEmpty(){return this.getNewLength()===0&&this.replaceRange.length===0}getRangeAfterReplace(){return new OffsetRange(this.replaceRange.start,this.replaceRange.start+this.getNewLength())}}class BaseStringEdit extends BaseEdit{apply(e){const t=[];let s=0;for(const o of this.replacements)t.push(e.substring(s,o.replaceRange.start)),t.push(o.newText),s=o.replaceRange.endExclusive;return t.push(e.substring(s)),t.join("")}}class BaseStringReplacement extends BaseReplacement{constructor(e,t){super(e),this.newText=t}getNewLength(){return this.newText.length}toString(){return`${this.replaceRange} -> ${JSON.stringify(this.newText)}`}replace(e){return e.substring(0,this.replaceRange.start)+this.newText+e.substring(this.replaceRange.endExclusive)}removeCommonSuffixPrefix(e){const t=e.substring(this.replaceRange.start,this.replaceRange.endExclusive),s=commonPrefixLength(t,this.newText),o=Math.min(t.length-s,this.newText.length-s,commonSuffixLength(t,this.newText)),r=new OffsetRange(this.replaceRange.start+s,this.replaceRange.endExclusive-o),l=this.newText.substring(s,this.newText.length-o);return new StringReplacement(r,l)}removeCommonSuffixAndPrefix(e){return this.removeCommonSuffix(e).removeCommonPrefix(e)}removeCommonPrefix(e){const t=this.replaceRange.substring(e),s=commonPrefixLength(t,this.newText);return s===0?this:this.slice(this.replaceRange.deltaStart(s),new OffsetRange(s,this.newText.length))}removeCommonSuffix(e){const t=this.replaceRange.substring(e),s=commonSuffixLength(t,this.newText);return s===0?this:this.slice(this.replaceRange.deltaEnd(-s),new OffsetRange(0,this.newText.length-s))}toJson(){return{txt:this.newText,pos:this.replaceRange.start,len:this.replaceRange.length}}}const ni=class ni extends BaseStringEdit{static compose(e){if(e.length===0)return ni.empty;let t=e[0];for(let s=1;s<e.length;s++)t=t.compose(e[s]);return t}constructor(e){super(e)}_createNew(e){return new ni(e)}};ni.empty=new ni([]);let StringEdit=ni;class StringReplacement extends BaseStringReplacement{static insert(e,t){return new StringReplacement(OffsetRange.emptyAt(e),t)}static replace(e,t){return new StringReplacement(e,t)}equals(e){return this.replaceRange.equals(e.replaceRange)&&this.newText===e.newText}tryJoinTouching(e){return new StringReplacement(this.replaceRange.joinRightTouching(e.replaceRange),this.newText+e.newText)}slice(e,t){return new StringReplacement(e,t?t.substring(this.newText):this.newText)}}function applyEditsToRanges(a,e){a=a.slice();const t=[];let s=0;for(const o of e.replacements){for(;;){const l=a[0];if(!l||l.endExclusive>=o.replaceRange.start)break;a.shift(),t.push(l.delta(s))}const r=[];for(;;){const l=a[0];if(!l||!l.intersectsOrTouches(o.replaceRange))break;a.shift(),r.push(l)}for(let l=r.length-1;l>=0;l--){let c=r[l];const d=c.intersect(o.replaceRange).length;c=c.deltaEnd(-d+(l===0?o.newText.length:0));const u=c.start-o.replaceRange.start;u>0&&(c=c.delta(-u)),l!==0&&(c=c.delta(o.newText.length)),c=c.delta(-(o.newText.length-o.replaceRange.length)),a.unshift(c)}s+=o.newText.length-o.replaceRange.length}for(;;){const o=a[0];if(!o)break;a.shift(),t.push(o.delta(s))}return t}const ye=class ye{static ofLength(e,t){return new ye(e,e+t)}static fromRange(e){return new ye(e.startLineNumber,e.endLineNumber)}static fromRangeInclusive(e){return new ye(e.startLineNumber,e.endLineNumber+1)}static joinMany(e){if(e.length===0)return[];let t=new LineRangeSet(e[0].slice());for(let s=1;s<e.length;s++)t=t.getUnion(new LineRangeSet(e[s].slice()));return t.ranges}static join(e){if(e.length===0)throw new BugIndicatingError("lineRanges cannot be empty");let t=e[0].startLineNumber,s=e[0].endLineNumberExclusive;for(let o=1;o<e.length;o++)t=Math.min(t,e[o].startLineNumber),s=Math.max(s,e[o].endLineNumberExclusive);return new ye(t,s)}static deserialize(e){return new ye(e[0],e[1])}constructor(e,t){if(e>t)throw new BugIndicatingError(`startLineNumber ${e} cannot be after endLineNumberExclusive ${t}`);this.startLineNumber=e,this.endLineNumberExclusive=t}contains(e){return this.startLineNumber<=e&&e<this.endLineNumberExclusive}get isEmpty(){return this.startLineNumber===this.endLineNumberExclusive}delta(e){return new ye(this.startLineNumber+e,this.endLineNumberExclusive+e)}deltaLength(e){return new ye(this.startLineNumber,this.endLineNumberExclusive+e)}get length(){return this.endLineNumberExclusive-this.startLineNumber}join(e){return new ye(Math.min(this.startLineNumber,e.startLineNumber),Math.max(this.endLineNumberExclusive,e.endLineNumberExclusive))}toString(){return`[${this.startLineNumber},${this.endLineNumberExclusive})`}intersect(e){const t=Math.max(this.startLineNumber,e.startLineNumber),s=Math.min(this.endLineNumberExclusive,e.endLineNumberExclusive);if(t<=s)return new ye(t,s)}intersectsStrict(e){return this.startLineNumber<e.endLineNumberExclusive&&e.startLineNumber<this.endLineNumberExclusive}intersectsOrTouches(e){return this.startLineNumber<=e.endLineNumberExclusive&&e.startLineNumber<=this.endLineNumberExclusive}equals(e){return this.startLineNumber===e.startLineNumber&&this.endLineNumberExclusive===e.endLineNumberExclusive}toInclusiveRange(){return this.isEmpty?null:new Range$2(this.startLineNumber,1,this.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER)}toExclusiveRange(){return new Range$2(this.startLineNumber,1,this.endLineNumberExclusive,1)}mapToLineArray(e){const t=[];for(let s=this.startLineNumber;s<this.endLineNumberExclusive;s++)t.push(e(s));return t}forEach(e){for(let t=this.startLineNumber;t<this.endLineNumberExclusive;t++)e(t)}serialize(){return[this.startLineNumber,this.endLineNumberExclusive]}toOffsetRange(){return new OffsetRange(this.startLineNumber-1,this.endLineNumberExclusive-1)}addMargin(e,t){return new ye(this.startLineNumber-e,this.endLineNumberExclusive+t)}};ye.compareByStart=compareBy(e=>e.startLineNumber,numberComparator);let LineRange=ye;class LineRangeSet{constructor(e=[]){this._normalizedRanges=e}get ranges(){return this._normalizedRanges}addRange(e){if(e.length===0)return;const t=findFirstIdxMonotonousOrArrLen(this._normalizedRanges,o=>o.endLineNumberExclusive>=e.startLineNumber),s=findLastIdxMonotonous(this._normalizedRanges,o=>o.startLineNumber<=e.endLineNumberExclusive)+1;if(t===s)this._normalizedRanges.splice(t,0,e);else if(t===s-1){const o=this._normalizedRanges[t];this._normalizedRanges[t]=o.join(e)}else{const o=this._normalizedRanges[t].join(this._normalizedRanges[s-1]).join(e);this._normalizedRanges.splice(t,s-t,o)}}contains(e){const t=findLastMonotonous(this._normalizedRanges,s=>s.startLineNumber<=e);return!!t&&t.endLineNumberExclusive>e}intersects(e){const t=findLastMonotonous(this._normalizedRanges,s=>s.startLineNumber<e.endLineNumberExclusive);return!!t&&t.endLineNumberExclusive>e.startLineNumber}getUnion(e){if(this._normalizedRanges.length===0)return e;if(e._normalizedRanges.length===0)return this;const t=[];let s=0,o=0,r=null;for(;s<this._normalizedRanges.length||o<e._normalizedRanges.length;){let l=null;if(s<this._normalizedRanges.length&&o<e._normalizedRanges.length){const c=this._normalizedRanges[s],d=e._normalizedRanges[o];c.startLineNumber<d.startLineNumber?(l=c,s++):(l=d,o++)}else s<this._normalizedRanges.length?(l=this._normalizedRanges[s],s++):(l=e._normalizedRanges[o],o++);r===null?r=l:r.endLineNumberExclusive>=l.startLineNumber?r=new LineRange(r.startLineNumber,Math.max(r.endLineNumberExclusive,l.endLineNumberExclusive)):(t.push(r),r=l)}return r!==null&&t.push(r),new LineRangeSet(t)}subtractFrom(e){const t=findFirstIdxMonotonousOrArrLen(this._normalizedRanges,l=>l.endLineNumberExclusive>=e.startLineNumber),s=findLastIdxMonotonous(this._normalizedRanges,l=>l.startLineNumber<=e.endLineNumberExclusive)+1;if(t===s)return new LineRangeSet([e]);const o=[];let r=e.startLineNumber;for(let l=t;l<s;l++){const c=this._normalizedRanges[l];c.startLineNumber>r&&o.push(new LineRange(r,c.startLineNumber)),r=c.endLineNumberExclusive}return r<e.endLineNumberExclusive&&o.push(new LineRange(r,e.endLineNumberExclusive)),new LineRangeSet(o)}toString(){return this._normalizedRanges.map(e=>e.toString()).join(", ")}getIntersection(e){const t=[];let s=0,o=0;for(;s<this._normalizedRanges.length&&o<e._normalizedRanges.length;){const r=this._normalizedRanges[s],l=e._normalizedRanges[o],c=r.intersect(l);c&&!c.isEmpty&&t.push(c),r.endLineNumberExclusive<l.endLineNumberExclusive?s++:o++}return new LineRangeSet(t)}getWithDelta(e){return new LineRangeSet(this._normalizedRanges.map(t=>t.delta(e)))}}const Ne=class Ne{static betweenPositions(e,t){return e.lineNumber===t.lineNumber?new Ne(0,t.column-e.column):new Ne(t.lineNumber-e.lineNumber,t.column-1)}static fromPosition(e){return new Ne(e.lineNumber-1,e.column-1)}static ofRange(e){return Ne.betweenPositions(e.getStartPosition(),e.getEndPosition())}static ofText(e){let t=0,s=0;for(const o of e)o===`
`?(t++,s=0):s++;return new Ne(t,s)}constructor(e,t){this.lineCount=e,this.columnCount=t}isGreaterThanOrEqualTo(e){return this.lineCount!==e.lineCount?this.lineCount>e.lineCount:this.columnCount>=e.columnCount}add(e){return e.lineCount===0?new Ne(this.lineCount,this.columnCount+e.columnCount):new Ne(this.lineCount+e.lineCount,e.columnCount)}createRange(e){return this.lineCount===0?new Range$2(e.lineNumber,e.column,e.lineNumber,e.column+this.columnCount):new Range$2(e.lineNumber,e.column,e.lineNumber+this.lineCount,this.columnCount+1)}toRange(){return new Range$2(1,1,this.lineCount+1,this.columnCount+1)}toLineRange(){return LineRange.ofLength(1,this.lineCount+1)}addToPosition(e){return this.lineCount===0?new Position$1(e.lineNumber,e.column+this.columnCount):new Position$1(e.lineNumber+this.lineCount,this.columnCount+1)}toString(){return`${this.lineCount},${this.columnCount}`}};Ne.zero=new Ne(0,0);let TextLength=Ne;class PositionOffsetTransformerBase{getOffsetRange(e){return new OffsetRange(this.getOffset(e.getStartPosition()),this.getOffset(e.getEndPosition()))}getRange(e){return Range$2.fromPositions(this.getPosition(e.start),this.getPosition(e.endExclusive))}getStringReplacement(e){return new Deps.deps.StringReplacement(this.getOffsetRange(e.range),e.text)}getTextReplacement(e){return new Deps.deps.TextReplacement(this.getRange(e.replaceRange),e.newText)}getTextEdit(e){const t=e.replacements.map(s=>this.getTextReplacement(s));return new Deps.deps.TextEdit(t)}}const zo=class zo{static get deps(){if(!this._deps)throw new Error("Dependencies not set. Call _setDependencies first.");return this._deps}};zo._deps=void 0;let Deps=zo;function _setPositionOffsetTransformerDependencies(a){Deps._deps=a}class PositionOffsetTransformer extends PositionOffsetTransformerBase{constructor(e){super(),this.text=e,this.lineStartOffsetByLineIdx=[],this.lineEndOffsetByLineIdx=[],this.lineStartOffsetByLineIdx.push(0);for(let t=0;t<e.length;t++)e.charAt(t)===`
`&&(this.lineStartOffsetByLineIdx.push(t+1),t>0&&e.charAt(t-1)==="\r"?this.lineEndOffsetByLineIdx.push(t-1):this.lineEndOffsetByLineIdx.push(t));this.lineEndOffsetByLineIdx.push(e.length)}getOffset(e){const t=this._validatePosition(e);return this.lineStartOffsetByLineIdx[t.lineNumber-1]+t.column-1}_validatePosition(e){if(e.lineNumber<1)return new Position$1(1,1);const t=this.textLength.lineCount+1;if(e.lineNumber>t){const o=this.getLineLength(t);return new Position$1(t,o+1)}if(e.column<1)return new Position$1(e.lineNumber,1);const s=this.getLineLength(e.lineNumber);return e.column-1>s?new Position$1(e.lineNumber,s+1):e}getPosition(e){const t=findLastIdxMonotonous(this.lineStartOffsetByLineIdx,r=>r<=e),s=t+1,o=e-this.lineStartOffsetByLineIdx[t]+1;return new Position$1(s,o)}get textLength(){const e=this.lineStartOffsetByLineIdx.length-1;return new Deps.deps.TextLength(e,this.text.length-this.lineStartOffsetByLineIdx[e])}getLineLength(e){return this.lineEndOffsetByLineIdx[e-1]-this.lineStartOffsetByLineIdx[e-1]}}class AbstractText{constructor(){this._transformer=void 0}get endPositionExclusive(){return this.length.addToPosition(new Position$1(1,1))}get lineRange(){return this.length.toLineRange()}getValue(){return this.getValueOfRange(this.length.toRange())}getValueOfOffsetRange(e){return this.getValueOfRange(this.getTransformer().getRange(e))}getLineLength(e){return this.getValueOfRange(new Range$2(e,1,e,Number.MAX_SAFE_INTEGER)).length}getTransformer(){return this._transformer||(this._transformer=new PositionOffsetTransformer(this.getValue())),this._transformer}getLineAt(e){return this.getValueOfRange(new Range$2(e,1,e,Number.MAX_SAFE_INTEGER))}}class LineBasedText extends AbstractText{constructor(e,t){assert(t>=1),super(),this._getLineContent=e,this._lineCount=t}getValueOfRange(e){if(e.startLineNumber===e.endLineNumber)return this._getLineContent(e.startLineNumber).substring(e.startColumn-1,e.endColumn-1);let t=this._getLineContent(e.startLineNumber).substring(e.startColumn-1);for(let s=e.startLineNumber+1;s<e.endLineNumber;s++)t+=`
`+this._getLineContent(s);return t+=`
`+this._getLineContent(e.endLineNumber).substring(0,e.endColumn-1),t}getLineLength(e){return this._getLineContent(e).length}get length(){const e=this._getLineContent(this._lineCount);return new TextLength(this._lineCount-1,e.length)}}class ArrayText extends LineBasedText{constructor(e){super(t=>e[t-1],e.length)}}class StringText extends AbstractText{constructor(e){super(),this.value=e,this._t=new PositionOffsetTransformer(this.value)}getValueOfRange(e){return this._t.getOffsetRange(e).substring(this.value)}get length(){return this._t.textLength}}class TextEdit{static fromStringEdit(e,t){const s=e.replacements.map(o=>TextReplacement.fromStringReplacement(o,t));return new TextEdit(s)}static fromParallelReplacementsUnsorted(e){const t=e.slice().sort(compareBy(s=>s.range,Range$2.compareRangesUsingStarts));return new TextEdit(t)}constructor(e){this.replacements=e,assertFn(()=>checkAdjacentItems(e,(t,s)=>t.range.getEndPosition().isBeforeOrEqual(s.range.getStartPosition())))}mapPosition(e){let t=0,s=0,o=0;for(const r of this.replacements){const l=r.range.getStartPosition();if(e.isBeforeOrEqual(l))break;const c=r.range.getEndPosition(),d=TextLength.ofText(r.text);if(e.isBefore(c)){const u=new Position$1(l.lineNumber+t,l.column+(l.lineNumber+t===s?o:0)),g=d.addToPosition(u);return rangeFromPositions(u,g)}l.lineNumber+t!==s&&(o=0),t+=d.lineCount-(r.range.endLineNumber-r.range.startLineNumber),d.lineCount===0?c.lineNumber!==l.lineNumber?o+=d.columnCount-(c.column-1):o+=d.columnCount-(c.column-l.column):o=d.columnCount,s=c.lineNumber+t}return new Position$1(e.lineNumber+t,e.column+(e.lineNumber+t===s?o:0))}mapRange(e){function t(l){return l instanceof Position$1?l:l.getStartPosition()}function s(l){return l instanceof Position$1?l:l.getEndPosition()}const o=t(this.mapPosition(e.getStartPosition())),r=s(this.mapPosition(e.getEndPosition()));return rangeFromPositions(o,r)}apply(e){let t="",s=new Position$1(1,1);for(const r of this.replacements){const l=r.range,c=l.getStartPosition(),d=l.getEndPosition(),u=rangeFromPositions(s,c);u.isEmpty()||(t+=e.getValueOfRange(u)),t+=r.text,s=d}const o=rangeFromPositions(s,e.endPositionExclusive);return o.isEmpty()||(t+=e.getValueOfRange(o)),t}applyToString(e){const t=new StringText(e);return this.apply(t)}getNewRanges(){const e=[];let t=0,s=0,o=0;for(const r of this.replacements){const l=TextLength.ofText(r.text),c=Position$1.lift({lineNumber:r.range.startLineNumber+s,column:r.range.startColumn+(r.range.startLineNumber===t?o:0)}),d=l.createRange(c);e.push(d),s=d.endLineNumber-r.range.endLineNumber,o=d.endColumn-r.range.endColumn,t=r.range.endLineNumber}return e}toReplacement(e){if(this.replacements.length===0)throw new BugIndicatingError;if(this.replacements.length===1)return this.replacements[0];const t=this.replacements[0].range.getStartPosition(),s=this.replacements[this.replacements.length-1].range.getEndPosition();let o="";for(let r=0;r<this.replacements.length;r++){const l=this.replacements[r];if(o+=l.text,r<this.replacements.length-1){const c=this.replacements[r+1],d=Range$2.fromPositions(l.range.getEndPosition(),c.range.getStartPosition()),u=e.getValueOfRange(d);o+=u}}return new TextReplacement(Range$2.fromPositions(t,s),o)}toString(e){return e===void 0?this.replacements.map(t=>t.toString()).join(`
`):typeof e=="string"?this.toString(new StringText(e)):this.replacements.length===0?"":this.replacements.map(t=>{const o=e.getValueOfRange(t.range),r=Range$2.fromPositions(new Position$1(Math.max(1,t.range.startLineNumber-1),1),t.range.getStartPosition());let l=e.getValueOfRange(r);l.length>10&&(l="..."+l.substring(l.length-10));const c=Range$2.fromPositions(t.range.getEndPosition(),new Position$1(t.range.endLineNumber+1,1));let d=e.getValueOfRange(c);d.length>10&&(d=d.substring(0,10)+"...");let u=o;if(u.length>10){const f=Math.floor(5);u=u.substring(0,f)+"..."+u.substring(u.length-f)}let g=t.text;if(g.length>10){const f=Math.floor(5);g=g.substring(0,f)+"..."+g.substring(g.length-f)}return u.length===0?`${l}❰${g}❱${d}`:`${l}❰${u}↦${g}❱${d}`}).join(`
`)}}class TextReplacement{static joinReplacements(e,t){if(e.length===0)throw new BugIndicatingError;if(e.length===1)return e[0];const s=e[0].range.getStartPosition(),o=e[e.length-1].range.getEndPosition();let r="";for(let l=0;l<e.length;l++){const c=e[l];if(r+=c.text,l<e.length-1){const d=e[l+1],u=Range$2.fromPositions(c.range.getEndPosition(),d.range.getStartPosition()),g=t.getValueOfRange(u);r+=g}}return new TextReplacement(Range$2.fromPositions(s,o),r)}static fromStringReplacement(e,t){return new TextReplacement(t.getTransformer().getRange(e.replaceRange),e.newText)}static delete(e){return new TextReplacement(e,"")}constructor(e,t){this.range=e,this.text=t}get isEmpty(){return this.range.isEmpty()&&this.text.length===0}static equals(e,t){return e.range.equalsRange(t.range)&&e.text===t.text}equals(e){return TextReplacement.equals(this,e)}removeCommonPrefixAndSuffix(e){return this.removeCommonPrefix(e).removeCommonSuffix(e)}removeCommonPrefix(e){const t=e.getValueOfRange(this.range).replaceAll(`\r
`,`
`),s=this.text.replaceAll(`\r
`,`
`),o=commonPrefixLength(t,s),r=TextLength.ofText(t.substring(0,o)).addToPosition(this.range.getStartPosition()),l=s.substring(o),c=Range$2.fromPositions(r,this.range.getEndPosition());return new TextReplacement(c,l)}removeCommonSuffix(e){const t=e.getValueOfRange(this.range).replaceAll(`\r
`,`
`),s=this.text.replaceAll(`\r
`,`
`),o=commonSuffixLength(t,s),r=TextLength.ofText(t.substring(0,t.length-o)).addToPosition(this.range.getStartPosition()),l=s.substring(0,s.length-o),c=Range$2.fromPositions(this.range.getStartPosition(),r);return new TextReplacement(c,l)}toString(){const e=this.range.getStartPosition(),t=this.range.getEndPosition();return`(${e.lineNumber},${e.column} -> ${t.lineNumber},${t.column}): "${this.text}"`}}function rangeFromPositions(a,e){if(a.lineNumber===e.lineNumber&&a.column===Number.MAX_SAFE_INTEGER)return Range$2.fromPositions(e,e);if(!a.isBeforeOrEqual(e))throw new BugIndicatingError("start must be before end");return new Range$2(a.lineNumber,a.column,e.lineNumber,e.column)}_setPositionOffsetTransformerDependencies({StringEdit,StringReplacement,TextReplacement,TextEdit,TextLength});var __decorate$2J=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2E=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let SimpleScreenReaderContent=class extends Disposable{constructor(e,t,s,o){super(),this._domNode=e,this._context=t,this._viewController=s,this._accessibilityService=o,this._selectionChangeListener=this._register(new MutableDisposable),this._accessibilityPageSize=1,this._ignoreSelectionChangeTime=0,this._strategy=new SimplePagedScreenReaderStrategy,this.onConfigurationChanged(this._context.configuration.options)}updateScreenReaderContent(e){const t=this._domNode.domNode,s=getActiveWindow().document.activeElement;if(!s||s!==t)return;if(this._accessibilityService.isScreenReaderOptimized()){this._state=this._getScreenReaderContentState(e),t.textContent!==this._state.value&&(this._setIgnoreSelectionChangeTime("setValue"),t.textContent=this._state.value);const r=getActiveWindow().document.getSelection();if(!r)return;const l=this._getScreenReaderRange(this._state.selectionStart,this._state.selectionEnd);if(!l)return;this._setIgnoreSelectionChangeTime("setRange"),r.setBaseAndExtent(l.anchorNode,l.anchorOffset,l.focusNode,l.focusOffset)}else this._state=void 0,this._setIgnoreSelectionChangeTime("setValue"),this._domNode.domNode.textContent=""}updateScrollTop(e){if(!this._state)return;const t=this._context.viewModel.viewLayout,s=this._state.startPositionWithinEditor.lineNumber,o=t.getVerticalOffsetForLineNumber(s),r=t.getVerticalOffsetForLineNumber(e.positionLineNumber);this._domNode.domNode.scrollTop=r-o}onFocusChange(e){e?this._selectionChangeListener.value=this._setSelectionChangeListener():this._selectionChangeListener.value=void 0}onConfigurationChanged(e){this._accessibilityPageSize=e.get(3)}onWillCut(){this._setIgnoreSelectionChangeTime("onCut")}onWillPaste(){this._setIgnoreSelectionChangeTime("onWillPaste")}_setIgnoreSelectionChangeTime(e){this._ignoreSelectionChangeTime=Date.now()}_setSelectionChangeListener(){let e=0;return addDisposableListener(this._domNode.domNode.ownerDocument,"selectionchange",()=>{const t=this._accessibilityService.isScreenReaderOptimized();if(!this._state||!t||!IME.enabled||!(getActiveWindow().document.activeElement===this._domNode.domNode))return;const r=getActiveWindow().document.getSelection();if(!r||r.rangeCount===0)return;const c=r.getRangeAt(0),d=Date.now(),u=d-e;if(e=d,u<5)return;const g=d-this._ignoreSelectionChangeTime;this._ignoreSelectionChangeTime=0,!(g<100)&&this._viewController.setSelection(this._getEditorSelectionFromDomRange(this._context,this._state,r.direction,c))})}_getScreenReaderContentState(e){const t=this._strategy.fromEditorSelection(this._context.viewModel,e,this._accessibilityPageSize,this._accessibilityService.getAccessibilitySupport()===0),s=this._context.viewModel.model.getPositionAt(1/0);let o=t.value;return s.column===1&&e.getEndPosition().equals(s)&&(o+=`
`),t.value=o,t}_getScreenReaderRange(e,t){const s=this._domNode.domNode.firstChild;if(!s)return;const o=new globalThis.Range;return o.setStart(s,e),o.setEnd(s,t),{anchorNode:s,anchorOffset:e,focusNode:s,focusOffset:t}}_getEditorSelectionFromDomRange(e,t,s,o){const r=e.viewModel,l=r.model,d=r.coordinatesConverter.convertViewPositionToModelPosition(t.startPositionWithinEditor),u=l.getOffsetAt(d);let g=o.startOffset+u,f=o.endOffset+u;if(l.getEndOfLineSequence()===1){const v=t.value,S=new PositionOffsetTransformer(v),y=S.getPosition(o.startOffset),w=S.getPosition(o.endOffset);g+=y.lineNumber-1,f+=w.lineNumber-1}const m=l.getPositionAt(g),_=l.getPositionAt(f),C=s==="forward"?m:_,b=s==="forward"?_:m;return Selection$1.fromPositions(C,b)}};SimpleScreenReaderContent=__decorate$2J([__param$2E(3,IAccessibilityService)],SimpleScreenReaderContent);var __decorate$2I=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2D=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let ScreenReaderSupport=class extends Disposable{constructor(e,t,s,o,r){super(),this._domNode=e,this._context=t,this._viewController=s,this._keybindingService=o,this._accessibilityService=r,this._contentLeft=1,this._contentWidth=1,this._contentHeight=1,this._divWidth=1,this._primarySelection=new Selection$1(1,1,1,1),this._primaryCursorVisibleRange=null,this._state=this._register(new MutableDisposable),this._instantiateScreenReaderContent(),this._updateConfigurationSettings(),this._updateDomAttributes()}onWillPaste(){var e;(e=this._state.value)==null||e.onWillPaste()}onWillCut(){var e;(e=this._state.value)==null||e.onWillCut()}handleFocusChange(e){var t;(t=this._state.value)==null||t.onFocusChange(e),this.writeScreenReaderContent()}onConfigurationChanged(e){this._instantiateScreenReaderContent(),this._updateConfigurationSettings(),this._updateDomAttributes(),e.hasChanged(2)&&this.writeScreenReaderContent()}_instantiateScreenReaderContent(){const e=this._context.configuration.options.get(107);this._renderRichContent!==e&&(this._renderRichContent=e,this._state.value=this._createScreenReaderContent(e))}_createScreenReaderContent(e){return e?new RichScreenReaderContent(this._domNode,this._context,this._viewController,this._accessibilityService):new SimpleScreenReaderContent(this._domNode,this._context,this._viewController,this._accessibilityService)}_updateConfigurationSettings(){var o;const e=this._context.configuration.options,t=e.get(165),s=t.wrappingColumn;this._contentLeft=t.contentLeft,this._contentWidth=t.contentWidth,this._contentHeight=t.height,this._fontInfo=e.get(59),this._divWidth=Math.round(s*this._fontInfo.typicalHalfwidthCharacterWidth),(o=this._state.value)==null||o.onConfigurationChanged(e)}_updateDomAttributes(){const e=this._context.configuration.options;this._domNode.domNode.setAttribute("role","textbox"),this._domNode.domNode.setAttribute("aria-required",e.get(9)?"true":"false"),this._domNode.domNode.setAttribute("aria-multiline","true"),this._domNode.domNode.setAttribute("aria-autocomplete",e.get(104)?"none":"both"),this._domNode.domNode.setAttribute("aria-roledescription",localize(55,"editor")),this._domNode.domNode.setAttribute("aria-label",ariaLabelForScreenReaderContent(e,this._keybindingService));const t=this._context.viewModel.model.getOptions().tabSize,s=e.get(59).spaceWidth;this._domNode.domNode.style.tabSize=`${t*s}px`;const o=e.get(154),r=o==="inherit"?e.get(153):o,l=r==="inherit"?e.get(149):r;this._domNode.domNode.style.textWrap=l==="off"?"nowrap":"wrap"}onCursorStateChanged(e){this._primarySelection=e.selections[0]??new Selection$1(1,1,1,1)}prepareRender(e){this.writeScreenReaderContent(),this._primaryCursorVisibleRange=e.visibleRangeForPosition(this._primarySelection.getPosition())}render(e){var d;if(!this._primaryCursorVisibleRange){this._renderAtTopLeft();return}const t=this._context.viewLayout.getCurrentScrollLeft(),s=this._contentLeft+this._primaryCursorVisibleRange.left-t;if(s<this._contentLeft||s>this._contentLeft+this._contentWidth){this._renderAtTopLeft();return}const o=this._context.viewLayout.getCurrentScrollTop(),r=this._primarySelection.positionLineNumber,l=this._context.viewLayout.getVerticalOffsetForLineNumber(r)-o;if(l<0||l>this._contentHeight){this._renderAtTopLeft();return}const c=this._context.viewLayout.getLineHeightForLineNumber(r);this._doRender(l,this._contentLeft,this._divWidth,c),(d=this._state.value)==null||d.updateScrollTop(this._primarySelection)}_renderAtTopLeft(){this._doRender(0,0,this._contentWidth,1)}_doRender(e,t,s,o){applyFontInfo(this._domNode,this._fontInfo),this._domNode.setTop(e),this._domNode.setLeft(t),this._domNode.setWidth(s),this._domNode.setHeight(o),this._domNode.setLineHeight(o)}setAriaOptions(e){e.activeDescendant?(this._domNode.setAttribute("aria-haspopup","true"),this._domNode.setAttribute("aria-autocomplete","list"),this._domNode.setAttribute("aria-activedescendant",e.activeDescendant)):(this._domNode.setAttribute("aria-haspopup","false"),this._domNode.setAttribute("aria-autocomplete","both"),this._domNode.removeAttribute("aria-activedescendant")),e.role&&this._domNode.setAttribute("role",e.role)}writeScreenReaderContent(){var e;(e=this._state.value)==null||e.updateScreenReaderContent(this._primarySelection)}};ScreenReaderSupport=__decorate$2I([__param$2D(3,IKeybindingService),__param$2D(4,IAccessibilityService)],ScreenReaderSupport);var EditContext;(function(a){function e(t,s){return new t.EditContext(s)}a.create=e})(EditContext||(EditContext={}));class NativeEditContextRegistryImpl{constructor(){this._nativeEditContextMapping=new Map}register(e,t){return this._nativeEditContextMapping.set(e,t),{dispose:()=>{this._nativeEditContextMapping.delete(e)}}}get(e){return this._nativeEditContextMapping.get(e)}}const NativeEditContextRegistry=new NativeEditContextRegistryImpl;var __decorate$2H=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2C=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},CompositionClassName;(function(a){a.NONE="edit-context-composition-none",a.SECONDARY="edit-context-composition-secondary",a.PRIMARY="edit-context-composition-primary"})(CompositionClassName||(CompositionClassName={}));let NativeEditContext=class extends AbstractEditContext{constructor(e,t,s,o,r,l,c){super(t),this._viewController=o,this._visibleRangeProvider=r,this.logService=c,this._previousEditContextSelection=new OffsetRange(0,0),this._editContextPrimarySelection=new Selection$1(1,1,1,1),this._decorations=[],this._primarySelection=new Selection$1(1,1,1,1),this._targetWindowId=-1,this._scrollTop=0,this._scrollLeft=0,this.domNode=new FastDomNode(document.createElement("div")),this.domNode.setClassName("native-edit-context"),this._imeTextArea=new FastDomNode(document.createElement("textarea")),this._imeTextArea.setClassName("ime-text-area"),this._imeTextArea.setAttribute("readonly","true"),this._imeTextArea.setAttribute("tabindex","-1"),this._imeTextArea.setAttribute("aria-hidden","true"),this.domNode.setAttribute("autocorrect","off"),this.domNode.setAttribute("autocapitalize","off"),this.domNode.setAttribute("autocomplete","off"),this.domNode.setAttribute("spellcheck","false"),this._updateDomAttributes(),s.appendChild(this.domNode),s.appendChild(this._imeTextArea),this._parent=s.domNode,this._focusTracker=this._register(new FocusTracker(c,this.domNode.domNode,f=>{c.trace("NativeEditContext#handleFocusChange : ",f),this._screenReaderSupport.handleFocusChange(f),this._context.viewModel.setHasFocus(f)}));const d=getWindow(this.domNode.domNode);this._editContext=EditContext.create(d),this.setEditContextOnDomNode(),this._screenReaderSupport=this._register(l.createInstance(ScreenReaderSupport,this.domNode,t,this._viewController)),this._register(addDisposableListener(this.domNode.domNode,"copy",f=>{this.logService.trace("NativeEditContext#copy"),this._ensureClipboardGetsEditorSelection(f)})),this._register(addDisposableListener(this.domNode.domNode,"cut",f=>{this.logService.trace("NativeEditContext#cut"),this._screenReaderSupport.onWillCut(),this._ensureClipboardGetsEditorSelection(f),this.logService.trace("NativeEditContext#cut (before viewController.cut)"),this._viewController.cut()})),this._register(addDisposableListener(this.domNode.domNode,"keyup",f=>this._onKeyUp(f))),this._register(addDisposableListener(this.domNode.domNode,"keydown",async f=>this._onKeyDown(f))),this._register(addDisposableListener(this._imeTextArea.domNode,"keyup",f=>this._onKeyUp(f))),this._register(addDisposableListener(this._imeTextArea.domNode,"keydown",async f=>this._onKeyDown(f))),this._register(addDisposableListener(this.domNode.domNode,"beforeinput",async f=>{(f.inputType==="insertParagraph"||f.inputType==="insertLineBreak")&&this._onType(this._viewController,{text:`
`,replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0})})),this._register(addDisposableListener(this.domNode.domNode,"paste",f=>{if(this.logService.trace("NativeEditContext#paste"),f.preventDefault(),!f.clipboardData)return;let[p,m]=ClipboardEventUtils.getTextData(f.clipboardData);if(this.logService.trace("NativeEditContext#paste with id : ",m==null?void 0:m.id," with text.length: ",p.length),!p)return;m=m||InMemoryClipboardMetadataManager.INSTANCE.get(p);let _=!1,C=null,b=null;m&&(_=this._context.configuration.options.get(45)&&!!m.isFromEmptySelection,C=typeof m.multicursorText<"u"?m.multicursorText:null,b=m.mode),this.logService.trace("NativeEditContext#paste (before viewController.paste)"),this._viewController.paste(p,_,C,b)})),this._register(editContextAddDisposableListener(this._editContext,"textformatupdate",f=>this._handleTextFormatUpdate(f))),this._register(editContextAddDisposableListener(this._editContext,"characterboundsupdate",f=>this._updateCharacterBounds(f)));let u;this._register(editContextAddDisposableListener(this._editContext,"textupdate",f=>{const p=f.text;if(p.length===1){const m=p.charCodeAt(0);if(isHighSurrogate(m)){u=p;return}if(isLowSurrogate(m)&&u){const _={text:u+p,selectionEnd:f.selectionEnd,selectionStart:f.selectionStart,updateRangeStart:f.updateRangeStart-1,updateRangeEnd:f.updateRangeEnd-1};u=void 0,this._emitTypeEvent(this._viewController,_);return}}this._emitTypeEvent(this._viewController,f)})),this._register(editContextAddDisposableListener(this._editContext,"compositionstart",f=>{this._updateEditContext(),this._viewController.compositionStart(),this._context.viewModel.onCompositionStart()})),this._register(editContextAddDisposableListener(this._editContext,"compositionend",f=>{this._updateEditContext(),this._viewController.compositionEnd(),this._context.viewModel.onCompositionEnd()}));let g=!1;this._register(IME.onDidChange(()=>{IME.enabled&&g&&(this._focusTracker.resume(),this.domNode.focus(),g=!1),!IME.enabled&&this.isFocused()&&(this._focusTracker.pause(),this._imeTextArea.focus(),g=!0)})),this._register(NativeEditContextRegistry.register(e,this))}dispose(){this.domNode.domNode.editContext=void 0,this.domNode.domNode.blur(),this.domNode.domNode.remove(),this._imeTextArea.domNode.remove(),super.dispose()}setAriaOptions(e){this._screenReaderSupport.setAriaOptions(e)}getLastRenderData(){return this._primarySelection.getPosition()}prepareRender(e){this._screenReaderSupport.prepareRender(e),this._updateSelectionAndControlBounds(e)}render(e){this._screenReaderSupport.render(e)}onCursorStateChanged(e){return this._primarySelection=e.modelSelections[0]??new Selection$1(1,1,1,1),this._screenReaderSupport.onCursorStateChanged(e),this._updateEditContext(),!0}onConfigurationChanged(e){return this._screenReaderSupport.onConfigurationChanged(e),this._updateDomAttributes(),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return this._updateEditContextOnLineChange(e.fromLineNumber,e.fromLineNumber+e.count-1),!0}onLinesDeleted(e){return this._updateEditContextOnLineChange(e.fromLineNumber,e.toLineNumber),!0}onLinesInserted(e){return this._updateEditContextOnLineChange(e.fromLineNumber,e.toLineNumber),!0}_updateEditContextOnLineChange(e,t){this._editContextPrimarySelection.endLineNumber<e||this._editContextPrimarySelection.startLineNumber>t||this._updateEditContext()}onScrollChanged(e){return this._scrollLeft=e.scrollLeft,this._scrollTop=e.scrollTop,!0}onZonesChanged(e){return!0}onWillPaste(){this.logService.trace("NativeEditContext#onWillPaste"),this._onWillPaste()}_onWillPaste(){this._screenReaderSupport.onWillPaste()}onWillCopy(){this.logService.trace("NativeEditContext#onWillCopy"),this.logService.trace("NativeEditContext#isFocused : ",this.domNode.domNode===getActiveElement())}writeScreenReaderContent(){this._screenReaderSupport.writeScreenReaderContent()}isFocused(){return this._focusTracker.isFocused}focus(){this._focusTracker.focus(),this.refreshFocusState()}refreshFocusState(){this._focusTracker.refreshFocusState()}setEditContextOnDomNode(){const e=getWindow(this.domNode.domNode),t=getWindowId(e);this._targetWindowId!==t&&(this.domNode.domNode.editContext=this._editContext,this._targetWindowId=t)}_onKeyUp(e){this._viewController.emitKeyUp(new StandardKeyboardEvent(e))}_onKeyDown(e){const t=new StandardKeyboardEvent(e);t.keyCode===114&&t.stopPropagation(),this._viewController.emitKeyDown(t)}_updateDomAttributes(){const e=this._context.configuration.options;this.domNode.domNode.setAttribute("tabindex",String(e.get(140)))}_updateEditContext(){const e=this._getNewEditContextState();e&&(this._editContext.updateText(0,Number.MAX_SAFE_INTEGER,e.text??" "),this._editContext.updateSelection(e.selectionStartOffset,e.selectionEndOffset),this._editContextPrimarySelection=e.editContextPrimarySelection,this._previousEditContextSelection=new OffsetRange(e.selectionStartOffset,e.selectionEndOffset))}_emitTypeEvent(e,t){if(!this._editContext)return;const s=this._previousEditContextSelection.endExclusive,o=this._previousEditContextSelection.start;this._previousEditContextSelection=new OffsetRange(t.selectionStart,t.selectionEnd);let r=0,l=0;t.updateRangeEnd>s&&(r=t.updateRangeEnd-s),t.updateRangeStart<o&&(l=o-t.updateRangeStart);let c="";o<t.updateRangeStart&&(c+=this._editContext.text.substring(o,t.updateRangeStart)),c+=t.text,s>t.updateRangeEnd&&(c+=this._editContext.text.substring(t.updateRangeEnd,s));let d=0;t.selectionStart===t.selectionEnd&&o===s&&(d=t.selectionStart-(t.updateRangeStart+t.text.length));const u={text:c,replacePrevCharCnt:l,replaceNextCharCnt:r,positionDelta:d};this._onType(e,u)}_onType(e,t){t.replacePrevCharCnt||t.replaceNextCharCnt||t.positionDelta?e.compositionType(t.text,t.replacePrevCharCnt,t.replaceNextCharCnt,t.positionDelta):e.type(t.text)}_getNewEditContextState(){const e=this._primarySelection,t=this._context.viewModel.model;if(!t.isValidRange(e))return;const s=e.startLineNumber,o=e.endLineNumber,r=t.getLineMaxColumn(o),l=new Range$2(s,1,o,r),c=t.getValueInRange(l,0),d=e.startColumn-1,u=c.length+e.endColumn-r;return{text:c,selectionStartOffset:d,selectionEndOffset:u,editContextPrimarySelection:e}}_editContextStartPosition(){return new Position$1(this._editContextPrimarySelection.startLineNumber,1)}_handleTextFormatUpdate(e){if(!this._editContext)return;const t=e.getTextFormats(),s=this._editContextStartPosition(),o=[];t.forEach(r=>{const l=this._context.viewModel.model,c=l.getOffsetAt(s),d=l.getPositionAt(c+r.rangeStart),u=l.getPositionAt(c+r.rangeEnd),g=Range$2.fromPositions(d,u),f=r.underlineThickness.toLowerCase();let p=CompositionClassName.NONE;switch(f){case"thin":p=CompositionClassName.SECONDARY;break;case"thick":p=CompositionClassName.PRIMARY;break}o.push({range:g,options:{description:"textFormatDecoration",inlineClassName:p}})}),this._decorations=this._context.viewModel.model.deltaDecorations(this._decorations,o)}_updateSelectionAndControlBounds(e){if(!this._parent)return;const s=this._context.configuration.options.get(165).contentLeft,o=this._parent.getBoundingClientRect(),r=this._context.viewModel.coordinatesConverter.convertModelRangeToViewRange(this._primarySelection),l=this._context.viewLayout.getVerticalOffsetForLineNumber(r.startLineNumber),c=o.top+l-this._scrollTop,u=this._context.viewLayout.getVerticalOffsetAfterLineNumber(r.endLineNumber)-l;let g=o.left+s-this._scrollLeft,f;if(this._primarySelection.isEmpty()){const m=e.visibleRangeForPosition(r.getStartPosition());m&&(g+=m.left),f=0}else f=o.width-s;const p=new DOMRect(g,c,f,u);this._editContext.updateSelectionBounds(p),this._editContext.updateControlBounds(p)}_updateCharacterBounds(e){if(!this._parent)return;const t=this._context.configuration.options,s=t.get(59).typicalHalfwidthCharacterWidth,o=t.get(165).contentLeft,r=this._parent.getBoundingClientRect(),l=[],c=new PositionOffsetTransformer(this._editContext.text);for(let d=e.rangeStart;d<e.rangeEnd;d++){const u=c.getPosition(d),g=this._editContextPrimarySelection.startLineNumber-1,f=new Position$1(g+u.lineNumber,u.column),p=f.delta(0,1),m=Range$2.fromPositions(f,p),_=this._context.viewModel.coordinatesConverter.convertModelRangeToViewRange(m),C=this._visibleRangeProvider.linesVisibleRangesForRange(_,!0)??[],b=_.startLineNumber,v=this._context.viewLayout.getVerticalOffsetForLineNumber(b),S=r.top+v-this._scrollTop;let y=0,w=s;if(C.length>0)for(const x of C[0].ranges){y=x.left,w=x.width;break}const L=this._context.viewLayout.getLineHeightForLineNumber(b);l.push(new DOMRect(r.left+o+y-this._scrollLeft,S,w,L))}this._editContext.updateCharacterBounds(e.rangeStart,l)}_ensureClipboardGetsEditorSelection(e){const t=this._context.configuration.options,s=t.get(45),o=t.get(31),r=this._context.viewModel.getCursorStates().map(u=>u.modelState.selection),l=getDataToCopy(this._context.viewModel,r,s,o);let c;this.logService.getLevel()===LogLevel.Trace&&(c=generateUuid());const d={version:1,id:c,isFromEmptySelection:l.isFromEmptySelection,multicursorText:l.multicursorText,mode:l.mode};InMemoryClipboardMetadataManager.INSTANCE.set(isFirefox$1?l.text.replace(/\r\n/g,`
`):l.text,d),e.preventDefault(),e.clipboardData&&ClipboardEventUtils.setTextData(e.clipboardData,l.text,l.html,d),this.logService.trace("NativeEditContext#_ensureClipboardGetsEditorSelectios with id : ",c," with text.length: ",l.text.length)}};NativeEditContext=__decorate$2H([__param$2C(5,IInstantiationService),__param$2C(6,ILogService)],NativeEditContext);class RulersGpu extends ViewPart{constructor(e,t){super(e),this._viewGpuContext=t,this._gpuShapes=[],this._register(autorun(s=>this._updateEntries(s)))}onConfigurationChanged(e){return this._updateEntries(void 0),!0}prepareRender(e){}render(e){}_updateEntries(e){const t=this._context.configuration.options,s=t.get(116),o=t.get(59).typicalHalfwidthCharacterWidth,r=this._viewGpuContext.devicePixelRatio.read(e);for(let l=0,c=s.length;l<c;l++){const d=s[l],u=this._gpuShapes[l],g=d.color?Color.fromHex(d.color):this._context.theme.getColor(editorRuler)??Color.white,f=[d.column*o*r,0,Math.max(1,Math.ceil(r)),Number.MAX_SAFE_INTEGER,g.rgba.r/255,g.rgba.g/255,g.rgba.b/255,g.rgba.a];u?u.setRaw(f):this._gpuShapes[l]=this._viewGpuContext.rectangleRenderer.register(...f)}for(;this._gpuShapes.length>s.length;)this._gpuShapes.splice(-1,1)[0].dispose()}}const gpuMark="",gs=class gs extends DynamicViewOverlay{constructor(e,t){super(),this._viewGpuContext=t,this._context=e,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){return!0}onCursorStateChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}onDecorationsChanged(e){return!0}prepareRender(e){const t=e.visibleRange.startLineNumber,s=e.visibleRange.endLineNumber,o=e.viewportData,r=new ViewLineOptions(this._context.configuration,this._context.theme.type),l=[];for(let c=t;c<=s;c++){const d=c-t,u=this._viewGpuContext.canRenderDetailed(r,o,c);l[d]=u.length?`<div class="${gs.CLASS_NAME}" title="Cannot render on GPU: ${u.join(", ")}"></div>`:""}this._renderResult=l}render(e,t){if(!this._renderResult)return"";const s=t-e;return s<0||s>=this._renderResult.length?"":this._renderResult[s]}};gs.CLASS_NAME="gpu-mark";let GpuMarkOverlay=gs;var __decorate$2G=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2B=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let View$1=class extends ViewEventHandler{constructor(e,t,s,o,r,l,c,d,u){super(),this._instantiationService=u,this._shouldRecomputeGlyphMarginLanes=!1,this._ownerID=t,this._widgetFocusTracker=this._register(new CodeEditorWidgetFocusTracker(e,d)),this._register(this._widgetFocusTracker.onChange(()=>{this._context.viewModel.setHasWidgetFocus(this._widgetFocusTracker.hasFocus())})),this._selections=[new Selection$1(1,1,1,1)],this._renderAnimationFrame=null,this._overflowGuardContainer=createFastDomNode(document.createElement("div")),PartFingerprints.write(this._overflowGuardContainer,3),this._overflowGuardContainer.setClassName("overflow-guard"),this._viewController=new ViewController(o,l,c,s),this._context=new ViewContext(o,r,l),this._context.addEventHandler(this),this._viewParts=[],this._editContextEnabled=this._context.configuration.options.get(170),this._accessibilitySupport=this._context.configuration.options.get(2),this._editContext=this._instantiateEditContext(),this._viewParts.push(this._editContext),this._linesContent=createFastDomNode(document.createElement("div")),this._linesContent.setClassName("lines-content monaco-editor-background"),this._linesContent.setPosition("absolute"),this.domNode=createFastDomNode(document.createElement("div")),this.domNode.setClassName(this._getEditorClassName()),this.domNode.setAttribute("role","code"),this._context.configuration.options.get(46)==="on"&&(this._viewGpuContext=this._instantiationService.createInstance(ViewGpuContext,this._context)),this._scrollbar=new EditorScrollbar(this._context,this._linesContent,this.domNode,this._overflowGuardContainer),this._viewParts.push(this._scrollbar),this._viewLines=new ViewLines(this._context,this._viewGpuContext,this._linesContent),this._viewGpuContext&&(this._viewLinesGpu=this._instantiationService.createInstance(ViewLinesGpu,this._context,this._viewGpuContext)),this._viewZones=new ViewZones(this._context),this._viewParts.push(this._viewZones);const g=new DecorationsOverviewRuler(this._context);this._viewParts.push(g);const f=new ScrollDecorationViewPart(this._context);this._viewParts.push(f);const p=new ContentViewOverlays(this._context);this._viewParts.push(p),p.addDynamicOverlay(new CurrentLineHighlightOverlay(this._context)),p.addDynamicOverlay(new SelectionsOverlay(this._context)),p.addDynamicOverlay(new IndentGuidesOverlay(this._context)),p.addDynamicOverlay(new DecorationsOverlay(this._context)),p.addDynamicOverlay(new WhitespaceOverlay(this._context));const m=new MarginViewOverlays(this._context);this._viewParts.push(m),m.addDynamicOverlay(new CurrentLineMarginHighlightOverlay(this._context)),m.addDynamicOverlay(new MarginViewLineDecorationsOverlay(this._context)),m.addDynamicOverlay(new LinesDecorationsOverlay(this._context)),m.addDynamicOverlay(new LineNumbersOverlay(this._context)),this._viewGpuContext&&m.addDynamicOverlay(new GpuMarkOverlay(this._context,this._viewGpuContext)),this._glyphMarginWidgets=new GlyphMarginWidgets(this._context),this._viewParts.push(this._glyphMarginWidgets);const _=new Margin(this._context);_.getDomNode().appendChild(this._viewZones.marginDomNode),_.getDomNode().appendChild(m.getDomNode()),_.getDomNode().appendChild(this._glyphMarginWidgets.domNode),this._viewParts.push(_),this._contentWidgets=new ViewContentWidgets(this._context,this.domNode),this._viewParts.push(this._contentWidgets),this._viewCursors=new ViewCursors(this._context),this._viewParts.push(this._viewCursors),this._overlayWidgets=new ViewOverlayWidgets(this._context,this.domNode),this._viewParts.push(this._overlayWidgets);const C=this._viewGpuContext?new RulersGpu(this._context,this._viewGpuContext):new Rulers(this._context);this._viewParts.push(C);const b=new BlockDecorations(this._context);this._viewParts.push(b);const v=new Minimap(this._context);if(this._viewParts.push(v),g){const S=this._scrollbar.getOverviewRulerLayoutInfo();S.parent.insertBefore(g.getDomNode(),S.insertBefore)}this._linesContent.appendChild(p.getDomNode()),"domNode"in C&&this._linesContent.appendChild(C.domNode),this._linesContent.appendChild(this._viewZones.domNode),this._linesContent.appendChild(this._viewLines.getDomNode()),this._linesContent.appendChild(this._contentWidgets.domNode),this._linesContent.appendChild(this._viewCursors.getDomNode()),this._overflowGuardContainer.appendChild(_.getDomNode()),this._overflowGuardContainer.appendChild(this._scrollbar.getDomNode()),this._viewGpuContext&&this._overflowGuardContainer.appendChild(this._viewGpuContext.canvas),this._overflowGuardContainer.appendChild(f.getDomNode()),this._overflowGuardContainer.appendChild(this._overlayWidgets.getDomNode()),this._overflowGuardContainer.appendChild(v.getDomNode()),this._overflowGuardContainer.appendChild(b.domNode),this.domNode.appendChild(this._overflowGuardContainer),d?(d.appendChild(this._contentWidgets.overflowingContentWidgetsDomNode.domNode),d.appendChild(this._overlayWidgets.overflowingOverlayWidgetsDomNode.domNode)):(this.domNode.appendChild(this._contentWidgets.overflowingContentWidgetsDomNode),this.domNode.appendChild(this._overlayWidgets.overflowingOverlayWidgetsDomNode)),this._applyLayout(),this._pointerHandler=this._register(new PointerHandler(this._context,this._viewController,this._createPointerHandlerHelper()))}_instantiateEditContext(){return this._context.configuration.options.get(170)?this._instantiationService.createInstance(NativeEditContext,this._ownerID,this._context,this._overflowGuardContainer,this._viewController,this._createTextAreaHandlerHelper()):this._instantiationService.createInstance(TextAreaEditContext,this._context,this._overflowGuardContainer,this._viewController,this._createTextAreaHandlerHelper())}_updateEditContext(){const e=this._context.configuration.options.get(170),t=this._context.configuration.options.get(2);if(this._editContextEnabled===e&&this._accessibilitySupport===t)return;this._editContextEnabled=e,this._accessibilitySupport=t;const s=this._editContext.isFocused(),o=this._viewParts.indexOf(this._editContext);this._editContext.dispose(),this._editContext=this._instantiateEditContext(),s&&this._editContext.focus(),o!==-1&&this._viewParts.splice(o,1,this._editContext)}_computeGlyphMarginLanes(){const e=this._context.viewModel.model,t=this._context.viewModel.glyphLanes;let s=[],o=0;s=s.concat(e.getAllMarginDecorations().map(r=>{var c,d;const l=((c=r.options.glyphMargin)==null?void 0:c.position)??GlyphMarginLane$1.Center;return o=Math.max(o,r.range.endLineNumber),{range:r.range,lane:l,persist:(d=r.options.glyphMargin)==null?void 0:d.persistLane}})),s=s.concat(this._glyphMarginWidgets.getWidgets().map(r=>{const l=e.validateRange(r.preference.range);return o=Math.max(o,l.endLineNumber),{range:l,lane:r.preference.lane}})),s.sort((r,l)=>Range$2.compareRangesUsingStarts(r.range,l.range)),t.reset(o);for(const r of s)t.push(r.lane,r.range,r.persist);return t}_createPointerHandlerHelper(){return{viewDomNode:this.domNode.domNode,linesContentDomNode:this._linesContent.domNode,viewLinesDomNode:this._viewLines.getDomNode().domNode,viewLinesGpu:this._viewLinesGpu,focusTextArea:()=>{this.focus()},dispatchTextAreaEvent:e=>{this._editContext.domNode.domNode.dispatchEvent(e)},getLastRenderData:()=>{const e=this._viewCursors.getLastRenderData()||[],t=this._editContext.getLastRenderData();return new PointerHandlerLastRenderData(e,t)},renderNow:()=>{this.render(!0,!1)},shouldSuppressMouseDownOnViewZone:e=>this._viewZones.shouldSuppressMouseDownOnViewZone(e),shouldSuppressMouseDownOnWidget:e=>this._contentWidgets.shouldSuppressMouseDownOnWidget(e),getPositionFromDOMInfo:(e,t)=>(this._flushAccumulatedAndRenderNow(),this._viewLines.getPositionFromDOMInfo(e,t)),visibleRangeForPosition:(e,t)=>{var o;this._flushAccumulatedAndRenderNow();const s=new Position$1(e,t);return this._viewLines.visibleRangeForPosition(s)??((o=this._viewLinesGpu)==null?void 0:o.visibleRangeForPosition(s))??null},getLineWidth:e=>{if(this._flushAccumulatedAndRenderNow(),this._viewLinesGpu){const t=this._viewLinesGpu.getLineWidth(e);if(t!==void 0)return t}return this._viewLines.getLineWidth(e)}}}_createTextAreaHandlerHelper(){return{visibleRangeForPosition:e=>(this._flushAccumulatedAndRenderNow(),this._viewLines.visibleRangeForPosition(e)),linesVisibleRangesForRange:(e,t)=>(this._flushAccumulatedAndRenderNow(),this._viewLines.linesVisibleRangesForRange(e,t))}}_applyLayout(){const t=this._context.configuration.options.get(165);this.domNode.setWidth(t.width),this.domNode.setHeight(t.height),this._overflowGuardContainer.setWidth(t.width),this._overflowGuardContainer.setHeight(t.height),this._linesContent.setWidth(16777216),this._linesContent.setHeight(16777216)}_getEditorClassName(){const e=this._editContext.isFocused()?" focused":"";return this._context.configuration.options.get(162)+" "+getThemeTypeSelector(this._context.theme.type)+e}handleEvents(e){super.handleEvents(e),this._scheduleRender()}onConfigurationChanged(e){return this.domNode.setClassName(this._getEditorClassName()),this._updateEditContext(),this._applyLayout(),!1}onCursorStateChanged(e){return this._selections=e.selections,!1}onDecorationsChanged(e){return e.affectsGlyphMargin&&(this._shouldRecomputeGlyphMarginLanes=!0),!1}onFocusChanged(e){return this.domNode.setClassName(this._getEditorClassName()),!1}onThemeChanged(e){return this._context.theme.update(e.theme),this.domNode.setClassName(this._getEditorClassName()),!1}dispose(){var e,t;this._renderAnimationFrame!==null&&(this._renderAnimationFrame.dispose(),this._renderAnimationFrame=null),this._contentWidgets.overflowingContentWidgetsDomNode.domNode.remove(),this._overlayWidgets.overflowingOverlayWidgetsDomNode.domNode.remove(),this._context.removeEventHandler(this),(e=this._viewGpuContext)==null||e.dispose(),this._viewLines.dispose(),(t=this._viewLinesGpu)==null||t.dispose();for(const s of this._viewParts)s.dispose();super.dispose()}_scheduleRender(){var e;if(this._store.isDisposed)throw new BugIndicatingError;if(this._renderAnimationFrame===null){this._editContext instanceof NativeEditContext&&this._editContext.setEditContextOnDomNode();const t=this._createCoordinatedRendering();this._renderAnimationFrame=EditorRenderingCoordinator.INSTANCE.scheduleCoordinatedRendering({window:getWindow((e=this.domNode)==null?void 0:e.domNode),prepareRenderText:()=>{if(this._store.isDisposed)throw new BugIndicatingError;try{return t.prepareRenderText()}finally{this._renderAnimationFrame=null}},renderText:()=>{if(this._store.isDisposed)throw new BugIndicatingError;return t.renderText()},prepareRender:(s,o)=>{if(this._store.isDisposed)throw new BugIndicatingError;return t.prepareRender(s,o)},render:(s,o)=>{if(this._store.isDisposed)throw new BugIndicatingError;return t.render(s,o)}})}}_flushAccumulatedAndRenderNow(){const e=this._createCoordinatedRendering();safeInvokeNoArg(()=>e.prepareRenderText());const t=safeInvokeNoArg(()=>e.renderText());if(t){const[s,o]=t;safeInvokeNoArg(()=>e.prepareRender(s,o)),safeInvokeNoArg(()=>e.render(s,o))}}_getViewPartsToRender(){const e=[];let t=0;for(const s of this._viewParts)s.shouldRender()&&(e[t++]=s);return e}_createCoordinatedRendering(){return{prepareRenderText:()=>{if(this._shouldRecomputeGlyphMarginLanes){this._shouldRecomputeGlyphMarginLanes=!1;const e=this._computeGlyphMarginLanes();this._context.configuration.setGlyphMarginDecorationLaneCount(e.requiredLanes)}inputLatency.onRenderStart()},renderText:()=>{var o;if(!this.domNode.domNode.isConnected)return null;let e=this._getViewPartsToRender();if(!this._viewLines.shouldRender()&&e.length===0)return null;const t=this._context.viewLayout.getLinesViewportData();this._context.viewModel.setViewport(t.startLineNumber,t.endLineNumber,t.centeredLineNumber);const s=new ViewportData(this._selections,t,this._context.viewLayout.getWhitespaceViewportData(),this._context.viewModel);return this._contentWidgets.shouldRender()&&this._contentWidgets.onBeforeRender(s),this._viewLines.shouldRender()&&(this._viewLines.renderText(s),this._viewLines.onDidRender(),e=this._getViewPartsToRender()),(o=this._viewLinesGpu)!=null&&o.shouldRender()&&(this._viewLinesGpu.renderText(s),this._viewLinesGpu.onDidRender()),[e,new RenderingContext(this._context.viewLayout,s,this._viewLines,this._viewLinesGpu)]},prepareRender:(e,t)=>{for(const s of e)s.prepareRender(t)},render:(e,t)=>{for(const s of e)s.render(t),s.onDidRender()}}}delegateVerticalScrollbarPointerDown(e){this._scrollbar.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){this._scrollbar.delegateScrollFromMouseWheelEvent(e)}restoreState(e){this._context.viewModel.viewLayout.setScrollPosition({scrollTop:e.scrollTop,scrollLeft:e.scrollLeft},1),this._context.viewModel.visibleLinesStabilized()}getOffsetForColumn(e,t){const s=this._context.viewModel.model.validatePosition({lineNumber:e,column:t}),o=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(s);this._flushAccumulatedAndRenderNow();const r=this._viewLines.visibleRangeForPosition(new Position$1(o.lineNumber,o.column));return r?r.left:-1}getTargetAtClientPoint(e,t){const s=this._pointerHandler.getTargetAtClientPoint(e,t);return s?ViewUserInputEvents.convertViewToModelMouseTarget(s,this._context.viewModel.coordinatesConverter):null}createOverviewRuler(e){return new OverviewRuler(this._context,e)}change(e){this._viewZones.changeViewZones(e),this._scheduleRender()}render(e,t){if(t){this._viewLines.forceShouldRender();for(const s of this._viewParts)s.forceShouldRender()}e?this._flushAccumulatedAndRenderNow():this._scheduleRender()}writeScreenReaderContent(e){this._editContext.writeScreenReaderContent(e)}focus(){this._editContext.focus()}isFocused(){return this._editContext.isFocused()}isWidgetFocused(){return this._widgetFocusTracker.hasFocus()}setAriaOptions(e){this._editContext.setAriaOptions(e)}addContentWidget(e){this._contentWidgets.addWidget(e.widget),this.layoutContentWidget(e),this._scheduleRender()}layoutContentWidget(e){var t,s,o,r;this._contentWidgets.setWidgetPosition(e.widget,((t=e.position)==null?void 0:t.position)??null,((s=e.position)==null?void 0:s.secondaryPosition)??null,((o=e.position)==null?void 0:o.preference)??null,((r=e.position)==null?void 0:r.positionAffinity)??null),this._scheduleRender()}removeContentWidget(e){this._contentWidgets.removeWidget(e.widget),this._scheduleRender()}addOverlayWidget(e){this._overlayWidgets.addWidget(e.widget),this.layoutOverlayWidget(e),this._scheduleRender()}layoutOverlayWidget(e){this._overlayWidgets.setWidgetPosition(e.widget,e.position)&&this._scheduleRender()}removeOverlayWidget(e){this._overlayWidgets.removeWidget(e.widget),this._scheduleRender()}addGlyphMarginWidget(e){this._glyphMarginWidgets.addWidget(e.widget),this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender()}layoutGlyphMarginWidget(e){const t=e.position;this._glyphMarginWidgets.setWidgetPosition(e.widget,t)&&(this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender())}removeGlyphMarginWidget(e){this._glyphMarginWidgets.removeWidget(e.widget),this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender()}};View$1=__decorate$2G([__param$2B(8,IInstantiationService)],View$1);function safeInvokeNoArg(a){try{return a()}catch(e){return onUnexpectedError(e),null}}const fs=class fs{constructor(){this._coordinatedRenderings=[],this._animationFrameRunners=new Map}scheduleCoordinatedRendering(e){return this._coordinatedRenderings.push(e),this._scheduleRender(e.window),{dispose:()=>{const t=this._coordinatedRenderings.indexOf(e);if(t!==-1&&(this._coordinatedRenderings.splice(t,1),this._coordinatedRenderings.length===0)){for(const[s,o]of this._animationFrameRunners)o.dispose();this._animationFrameRunners.clear()}}}}_scheduleRender(e){if(!this._animationFrameRunners.has(e)){const t=()=>{this._animationFrameRunners.delete(e),this._onRenderScheduled()};this._animationFrameRunners.set(e,runAtThisOrScheduleAtNextAnimationFrame(e,t,100))}}_onRenderScheduled(){const e=this._coordinatedRenderings.slice(0);this._coordinatedRenderings=[];for(const s of e)safeInvokeNoArg(()=>s.prepareRenderText());const t=[];for(let s=0,o=e.length;s<o;s++){const r=e[s];t[s]=safeInvokeNoArg(()=>r.renderText())}for(let s=0,o=e.length;s<o;s++){const r=e[s],l=t[s];if(!l)continue;const[c,d]=l;safeInvokeNoArg(()=>r.prepareRender(c,d))}for(let s=0,o=e.length;s<o;s++){const r=e[s],l=t[s];if(!l)continue;const[c,d]=l;safeInvokeNoArg(()=>r.render(c,d))}}};fs.INSTANCE=new fs;let EditorRenderingCoordinator=fs;class CodeEditorWidgetFocusTracker extends Disposable{constructor(e,t){super(),this._onChange=this._register(new Emitter$1),this.onChange=this._onChange.event,this._hadFocus=void 0,this._hasDomElementFocus=!1,this._domFocusTracker=this._register(trackFocus(e)),this._overflowWidgetsDomNodeHasFocus=!1,this._register(this._domFocusTracker.onDidFocus(()=>{this._hasDomElementFocus=!0,this._update()})),this._register(this._domFocusTracker.onDidBlur(()=>{this._hasDomElementFocus=!1,this._update()})),t&&(this._overflowWidgetsDomNode=this._register(trackFocus(t)),this._register(this._overflowWidgetsDomNode.onDidFocus(()=>{this._overflowWidgetsDomNodeHasFocus=!0,this._update()})),this._register(this._overflowWidgetsDomNode.onDidBlur(()=>{this._overflowWidgetsDomNodeHasFocus=!1,this._update()})))}_update(){const e=this._hasDomElementFocus||this._overflowWidgetsDomNodeHasFocus;this._hadFocus!==e&&(this._hadFocus=e,this._onChange.fire(void 0))}hasFocus(){return this._hadFocus??!1}}class ModelLineProjectionData{constructor(e,t,s,o,r){this.injectionOffsets=e,this.injectionOptions=t,this.breakOffsets=s,this.breakOffsetsVisibleColumn=o,this.wrappedTextIndentLength=r}getOutputLineCount(){return this.breakOffsets.length}getMinOutputOffset(e){return e>0?this.wrappedTextIndentLength:0}getLineLength(e){const t=e>0?this.breakOffsets[e-1]:0;let o=this.breakOffsets[e]-t;return e>0&&(o+=this.wrappedTextIndentLength),o}getMaxOutputOffset(e){return this.getLineLength(e)}translateToInputOffset(e,t){e>0&&(t=Math.max(0,t-this.wrappedTextIndentLength));let o=e===0?t:this.breakOffsets[e-1]+t;if(this.injectionOffsets!==null)for(let r=0;r<this.injectionOffsets.length&&o>this.injectionOffsets[r];r++)o<this.injectionOffsets[r]+this.injectionOptions[r].content.length?o=this.injectionOffsets[r]:o-=this.injectionOptions[r].content.length;return o}translateToOutputPosition(e,t=2){let s=e;if(this.injectionOffsets!==null)for(let o=0;o<this.injectionOffsets.length&&!(e<this.injectionOffsets[o]||t!==1&&e===this.injectionOffsets[o]);o++)s+=this.injectionOptions[o].content.length;return this.offsetInInputWithInjectionsToOutputPosition(s,t)}offsetInInputWithInjectionsToOutputPosition(e,t=2){let s=0,o=this.breakOffsets.length-1,r=0,l=0;for(;s<=o;){r=s+(o-s)/2|0;const d=this.breakOffsets[r];if(l=r>0?this.breakOffsets[r-1]:0,t===0)if(e<=l)o=r-1;else if(e>d)s=r+1;else break;else if(e<l)o=r-1;else if(e>=d)s=r+1;else break}let c=e-l;return r>0&&(c+=this.wrappedTextIndentLength),new OutputPosition(r,c)}normalizeOutputPosition(e,t,s){if(this.injectionOffsets!==null){const o=this.outputPositionToOffsetInInputWithInjections(e,t),r=this.normalizeOffsetInInputWithInjectionsAroundInjections(o,s);if(r!==o)return this.offsetInInputWithInjectionsToOutputPosition(r,s)}if(s===0){if(e>0&&t===this.getMinOutputOffset(e))return new OutputPosition(e-1,this.getMaxOutputOffset(e-1))}else if(s===1){const o=this.getOutputLineCount()-1;if(e<o&&t===this.getMaxOutputOffset(e))return new OutputPosition(e+1,this.getMinOutputOffset(e+1))}return new OutputPosition(e,t)}outputPositionToOffsetInInputWithInjections(e,t){return e>0&&(t=Math.max(0,t-this.wrappedTextIndentLength)),(e>0?this.breakOffsets[e-1]:0)+t}normalizeOffsetInInputWithInjectionsAroundInjections(e,t){const s=this.getInjectedTextAtOffset(e);if(!s)return e;if(t===2){if(e===s.offsetInInputWithInjections+s.length&&hasRightCursorStop(this.injectionOptions[s.injectedTextIndex].cursorStops))return s.offsetInInputWithInjections+s.length;{let o=s.offsetInInputWithInjections;if(hasLeftCursorStop(this.injectionOptions[s.injectedTextIndex].cursorStops))return o;let r=s.injectedTextIndex-1;for(;r>=0&&this.injectionOffsets[r]===this.injectionOffsets[s.injectedTextIndex]&&!(hasRightCursorStop(this.injectionOptions[r].cursorStops)||(o-=this.injectionOptions[r].content.length,hasLeftCursorStop(this.injectionOptions[r].cursorStops)));)r--;return o}}else if(t===1||t===4){let o=s.offsetInInputWithInjections+s.length,r=s.injectedTextIndex;for(;r+1<this.injectionOffsets.length&&this.injectionOffsets[r+1]===this.injectionOffsets[r];)o+=this.injectionOptions[r+1].content.length,r++;return o}else if(t===0||t===3){let o=s.offsetInInputWithInjections,r=s.injectedTextIndex;for(;r-1>=0&&this.injectionOffsets[r-1]===this.injectionOffsets[r];)o-=this.injectionOptions[r-1].content.length,r--;return o}assertNever()}getInjectedText(e,t){const s=this.outputPositionToOffsetInInputWithInjections(e,t),o=this.getInjectedTextAtOffset(s);return o?{options:this.injectionOptions[o.injectedTextIndex]}:null}getInjectedTextAtOffset(e){const t=this.injectionOffsets,s=this.injectionOptions;if(t!==null){let o=0;for(let r=0;r<t.length;r++){const l=s[r].content.length,c=t[r]+o,d=t[r]+o+l;if(c>e)break;if(e<=d)return{injectedTextIndex:r,offsetInInputWithInjections:c,length:l};o+=l}}}}function hasRightCursorStop(a){return a==null?!0:a===InjectedTextCursorStops$1.Right||a===InjectedTextCursorStops$1.Both}function hasLeftCursorStop(a){return a==null?!0:a===InjectedTextCursorStops$1.Left||a===InjectedTextCursorStops$1.Both}class OutputPosition{constructor(e,t){this.outputLineIndex=e,this.outputOffset=t}toString(){return`${this.outputLineIndex}:${this.outputOffset}`}toPosition(e){return new Position$1(e+this.outputLineIndex,this.outputOffset+1)}}class ModelRawFlush{constructor(){this.changeType=1}}class LineInjectedText{static applyInjectedText(e,t){if(!t||t.length===0)return e;let s="",o=0;for(const r of t)s+=e.substring(o,r.column-1),o=r.column-1,s+=r.options.content;return s+=e.substring(o),s}static fromDecorations(e){const t=[];for(const s of e)s.options.before&&s.options.before.content.length>0&&t.push(new LineInjectedText(s.ownerId,s.range.startLineNumber,s.range.startColumn,s.options.before,0)),s.options.after&&s.options.after.content.length>0&&t.push(new LineInjectedText(s.ownerId,s.range.endLineNumber,s.range.endColumn,s.options.after,1));return t.sort((s,o)=>s.lineNumber===o.lineNumber?s.column===o.column?s.order-o.order:s.column-o.column:s.lineNumber-o.lineNumber),t}constructor(e,t,s,o,r){this.ownerId=e,this.lineNumber=t,this.column=s,this.options=o,this.order=r}}class ModelRawLineChanged{constructor(e,t,s){this.changeType=2,this.lineNumber=e,this.detail=t,this.injectedText=s}}class ModelLineHeightChanged{constructor(e,t,s,o){this.ownerId=e,this.decorationId=t,this.lineNumber=s,this.lineHeight=o}}class ModelFontChanged{constructor(e,t){this.ownerId=e,this.lineNumber=t}}class ModelRawLinesDeleted{constructor(e,t){this.changeType=3,this.fromLineNumber=e,this.toLineNumber=t}}class ModelRawLinesInserted{constructor(e,t,s,o){this.changeType=4,this.injectedTexts=o,this.fromLineNumber=e,this.toLineNumber=t,this.detail=s}}class ModelRawEOLChanged{constructor(){this.changeType=5}}class ModelRawContentChangedEvent{constructor(e,t,s,o){this.changes=e,this.versionId=t,this.isUndoing=s,this.isRedoing=o,this.resultingSelection=null}containsEvent(e){for(let t=0,s=this.changes.length;t<s;t++)if(this.changes[t].changeType===e)return!0;return!1}static merge(e,t){const s=[].concat(e.changes).concat(t.changes),o=t.versionId,r=e.isUndoing||t.isUndoing,l=e.isRedoing||t.isRedoing;return new ModelRawContentChangedEvent(s,o,r,l)}}class ModelInjectedTextChangedEvent{constructor(e){this.changes=e}}let ModelLineHeightChangedEvent$1=class{constructor(e){this.changes=e}},ModelFontChangedEvent$1=class{constructor(e){this.changes=e}};class InternalModelContentChangeEvent{constructor(e,t){this.rawContentChangedEvent=e,this.contentChangedEvent=t}merge(e){const t=ModelRawContentChangedEvent.merge(this.rawContentChangedEvent,e.rawContentChangedEvent),s=InternalModelContentChangeEvent._mergeChangeEvents(this.contentChangedEvent,e.contentChangedEvent);return new InternalModelContentChangeEvent(t,s)}static _mergeChangeEvents(e,t){const s=[].concat(e.changes).concat(t.changes),o=t.eol,r=t.versionId,l=e.isUndoing||t.isUndoing,c=e.isRedoing||t.isRedoing,d=e.isFlush||t.isFlush,u=e.isEolChange&&t.isEolChange;return{changes:s,eol:o,isEolChange:u,versionId:r,isUndoing:l,isRedoing:c,isFlush:d,detailedReasons:e.detailedReasons.concat(t.detailedReasons),detailedReasonsChangeLengths:e.detailedReasonsChangeLengths.concat(t.detailedReasonsChangeLengths)}}}const ttPolicy$5=createTrustedTypesPolicy$1("domLineBreaksComputer",{createHTML:a=>a});class DOMLineBreaksComputerFactory{static create(e){return new DOMLineBreaksComputerFactory(new WeakRef(e))}constructor(e){this.targetWindow=e}createLineBreaksComputer(e,t,s,o,r,l){const c=[],d=[];return{addRequest:(u,g,f)=>{c.push(u),d.push(g)},finalize:()=>createLineBreaks$1(assertReturnsDefined(this.targetWindow.deref()),c,e,t,s,o,r,d)}}}function createLineBreaks$1(a,e,t,s,o,r,l,c){function d(D){const k=c[D];if(k){const N=LineInjectedText.applyInjectedText(e[D],k),R=k.map(A=>A.options),M=k.map(A=>A.column-1);return new ModelLineProjectionData(M,R,[N.length],[],0)}else return null}if(o===-1){const D=[];for(let k=0,N=e.length;k<N;k++)D[k]=d(k);return D}const u=Math.round(o*t.typicalHalfwidthCharacterWidth),f=Math.round(s*(r===3?2:r===2?1:0)),p=Math.ceil(t.spaceWidth*f),m=document.createElement("div");applyFontInfo(m,t);const _=new StringBuilder(1e4),C=[],b=[],v=[],S=[],y=[];for(let D=0;D<e.length;D++){const k=LineInjectedText.applyInjectedText(e[D],c[D]);let N=0,R=0,M=u;if(r!==0)if(N=firstNonWhitespaceIndex(k),N===-1)N=0;else{for(let W=0;W<N;W++){const B=k.charCodeAt(W)===9?s-R%s:1;R+=B}const P=Math.ceil(t.spaceWidth*R);P+t.typicalFullwidthCharacterWidth>u?(N=0,R=0):M=u-P}const A=k.substr(N),O=renderLine(A,R,s,M,_,p);C[D]=N,b[D]=R,v[D]=A,S[D]=O[0],y[D]=O[1]}const w=_.build(),L=(ttPolicy$5==null?void 0:ttPolicy$5.createHTML(w))??w;m.innerHTML=L,m.style.position="absolute",m.style.top="10000",l==="keepAll"?(m.style.wordBreak="keep-all",m.style.overflowWrap="anywhere"):(m.style.wordBreak="inherit",m.style.overflowWrap="break-word"),a.document.body.appendChild(m);const x=document.createRange(),E=Array.prototype.slice.call(m.children,0),I=[];for(let D=0;D<e.length;D++){const k=E[D],N=readLineBreaks(x,k,v[D],S[D]);if(N===null){I[D]=d(D);continue}const R=C[D],M=b[D]+f,A=y[D],O=[];for(let H=0,V=N.length;H<V;H++)O[H]=A[N[H]];if(R!==0)for(let H=0,V=N.length;H<V;H++)N[H]+=R;let P,W;const B=c[D];B?(P=B.map(H=>H.options),W=B.map(H=>H.column-1)):(P=null,W=null),I[D]=new ModelLineProjectionData(W,P,N,O,M)}return m.remove(),I}function renderLine(a,e,t,s,o,r){if(r!==0){const p=String(r);o.appendString('<div style="text-indent: -'),o.appendString(p),o.appendString("px; padding-left: "),o.appendString(p),o.appendString("px; box-sizing: border-box; width:")}else o.appendString('<div style="width:');o.appendString(String(s)),o.appendString('px;">');const l=a.length;let c=e,d=0;const u=[],g=[];let f=0<l?a.charCodeAt(0):0;o.appendString("<span>");for(let p=0;p<l;p++){p!==0&&p%16384===0&&o.appendString("</span><span>"),u[p]=d,g[p]=c;const m=f;f=p+1<l?a.charCodeAt(p+1):0;let _=1,C=1;switch(m){case 9:_=t-c%t,C=_;for(let b=1;b<=_;b++)b<_?o.appendCharCode(160):o.appendASCIICharCode(32);break;case 32:f===32?o.appendCharCode(160):o.appendASCIICharCode(32);break;case 60:o.appendString("&lt;");break;case 62:o.appendString("&gt;");break;case 38:o.appendString("&amp;");break;case 0:o.appendString("&#00;");break;case 65279:case 8232:case 8233:case 133:o.appendCharCode(65533);break;default:isFullWidthCharacter(m)&&C++,m<32?o.appendCharCode(9216+m):o.appendCharCode(m)}d+=_,c+=C}return o.appendString("</span>"),u[a.length]=d,g[a.length]=c,o.appendString("</div>"),[u,g]}function readLineBreaks(a,e,t,s){if(t.length<=1)return null;const o=Array.prototype.slice.call(e.children,0),r=[];try{discoverBreaks(a,o,s,0,null,t.length-1,null,r)}catch(l){return console.log(l),null}return r.length===0?null:(r.push(t.length),r)}function discoverBreaks(a,e,t,s,o,r,l,c){if(s===r||(o=o||readClientRect(a,e,t[s],t[s+1]),l=l||readClientRect(a,e,t[r],t[r+1]),Math.abs(o[0].top-l[0].top)<=.1))return;if(s+1===r){c.push(r);return}const d=s+(r-s)/2|0,u=readClientRect(a,e,t[d],t[d+1]);discoverBreaks(a,e,t,s,o,d,u,c),discoverBreaks(a,e,t,d,u,r,l,c)}function readClientRect(a,e,t,s){return a.setStart(e[t/16384|0].firstChild,t%16384),a.setEnd(e[s/16384|0].firstChild,s%16384),a.getClientRects()}class CodeEditorContributions extends Disposable{constructor(){super(),this._editor=null,this._instantiationService=null,this._instances=this._register(new DisposableMap),this._pending=new Map,this._finishedInstantiation=[],this._finishedInstantiation[0]=!1,this._finishedInstantiation[1]=!1,this._finishedInstantiation[2]=!1,this._finishedInstantiation[3]=!1}initialize(e,t,s){this._editor=e,this._instantiationService=s;for(const o of t){if(this._pending.has(o.id)){onUnexpectedError(new Error(`Cannot have two contributions with the same id ${o.id}`));continue}this._pending.set(o.id,o)}this._instantiateSome(0),this._register(runWhenWindowIdle(getWindow(this._editor.getDomNode()),()=>{this._instantiateSome(1)})),this._register(runWhenWindowIdle(getWindow(this._editor.getDomNode()),()=>{this._instantiateSome(2)})),this._register(runWhenWindowIdle(getWindow(this._editor.getDomNode()),()=>{this._instantiateSome(3)},5e3))}saveViewState(){const e={};for(const[t,s]of this._instances)typeof s.saveViewState=="function"&&(e[t]=s.saveViewState());return e}restoreViewState(e){for(const[t,s]of this._instances)typeof s.restoreViewState=="function"&&s.restoreViewState(e[t])}get(e){return this._instantiateById(e),this._instances.get(e)||null}onBeforeInteractionEvent(){this._instantiateSome(2)}onAfterModelAttached(){var e;return runWhenWindowIdle(getWindow((e=this._editor)==null?void 0:e.getDomNode()),()=>{this._instantiateSome(1)},50)}_instantiateSome(e){if(this._finishedInstantiation[e])return;this._finishedInstantiation[e]=!0;const t=this._findPendingContributionsByInstantiation(e);for(const s of t)this._instantiateById(s.id)}_findPendingContributionsByInstantiation(e){const t=[];for(const[,s]of this._pending)s.instantiation===e&&t.push(s);return t}_instantiateById(e){const t=this._pending.get(e);if(t){if(this._pending.delete(e),!this._instantiationService||!this._editor)throw new Error("Cannot instantiate contributions before being initialized!");try{const s=this._instantiationService.createInstance(t.ctor,this._editor);this._instances.set(t.id,s),typeof s.restoreViewState=="function"&&t.instantiation!==0&&console.warn(`Editor contribution '${t.id}' should be eager instantiated because it uses saveViewState / restoreViewState.`)}catch(s){onUnexpectedError(s)}}}}class InternalEditorAction{constructor(e,t,s,o,r,l,c){this.id=e,this.label=t,this.alias=s,this.metadata=o,this._precondition=r,this._run=l,this._contextKeyService=c}isSupported(){return this._contextKeyService.contextMatchesRules(this._precondition)}run(e){return this.isSupported()?this._run(e):Promise.resolve(void 0)}}const EditorType={ICodeEditor:"vs.editor.ICodeEditor",IDiffEditor:"vs.editor.IDiffEditor"};function countEOL(a){let e=0,t=0,s=0,o=0;for(let r=0,l=a.length;r<l;r++){const c=a.charCodeAt(r);c===13?(e===0&&(t=r),e++,r+1<l&&a.charCodeAt(r+1)===10?(o|=2,r++):o|=3,s=r+1):c===10&&(o|=1,e===0&&(t=r),e++,s=r+1)}return e===0&&(t=a.length),[e,t,a.length-s,o]}class BracketInfo{constructor(e,t,s,o){this.range=e,this.nestingLevel=t,this.nestingLevelOfEqualBracketType=s,this.isInvalid=o}}class BracketPairInfo{constructor(e,t,s,o,r,l){this.range=e,this.openingBracketRange=t,this.closingBracketRange=s,this.nestingLevel=o,this.nestingLevelOfEqualBracketType=r,this.bracketPairNode=l}get openingBracketInfo(){return this.bracketPairNode.openingBracket.bracketInfo}}class BracketPairWithMinIndentationInfo extends BracketPairInfo{constructor(e,t,s,o,r,l,c){super(e,t,s,o,r,l),this.minVisibleColumnIndentation=c}}function lengthDiff(a,e,t,s){return a!==t?toLength(t-a,s):toLength(0,s-e)}const lengthZero=0;function lengthIsZero(a){return a===0}const factor=2**26;function toLength(a,e){return a*factor+e}function lengthToObj(a){const e=a,t=Math.floor(e/factor),s=e-t*factor;return new TextLength(t,s)}function lengthGetLineCount(a){return Math.floor(a/factor)}function lengthGetColumnCountIfZeroLineCount(a){return a}function lengthAdd(a,e){let t=a+e;return e>=factor&&(t=t-a%factor),t}function sumLengths(a,e){return a.reduce((t,s)=>lengthAdd(t,e(s)),lengthZero)}function lengthEquals(a,e){return a===e}function lengthDiffNonNegative(a,e){const t=a,s=e;if(s-t<=0)return lengthZero;const r=Math.floor(t/factor),l=Math.floor(s/factor),c=s-l*factor;if(r===l){const d=t-r*factor;return toLength(0,c-d)}else return toLength(l-r,c)}function lengthLessThan(a,e){return a<e}function lengthLessThanEqual(a,e){return a<=e}function lengthGreaterThanEqual(a,e){return a>=e}function positionToLength(a){return toLength(a.lineNumber-1,a.column-1)}function lengthsToRange(a,e){const t=a,s=Math.floor(t/factor),o=t-s*factor,r=e,l=Math.floor(r/factor),c=r-l*factor;return new Range$2(s+1,o+1,l+1,c+1)}function lengthOfString(a){const e=splitLines(a);return toLength(e.length-1,e[e.length-1].length)}class TextEditInfo{static fromModelContentChanges(e){return e.map(s=>{const o=Range$2.lift(s.range);return new TextEditInfo(positionToLength(o.getStartPosition()),positionToLength(o.getEndPosition()),lengthOfString(s.text))}).reverse()}constructor(e,t,s){this.startOffset=e,this.endOffset=t,this.newLength=s}toString(){return`[${lengthToObj(this.startOffset)}...${lengthToObj(this.endOffset)}) -> ${lengthToObj(this.newLength)}`}}class BeforeEditPositionMapper{constructor(e){this.nextEditIdx=0,this.deltaOldToNewLineCount=0,this.deltaOldToNewColumnCount=0,this.deltaLineIdxInOld=-1,this.edits=e.map(t=>TextEditInfoCache.from(t))}getOffsetBeforeChange(e){return this.adjustNextEdit(e),this.translateCurToOld(e)}getDistanceToNextChange(e){this.adjustNextEdit(e);const t=this.edits[this.nextEditIdx],s=t?this.translateOldToCur(t.offsetObj):null;return s===null?null:lengthDiffNonNegative(e,s)}translateOldToCur(e){return e.lineCount===this.deltaLineIdxInOld?toLength(e.lineCount+this.deltaOldToNewLineCount,e.columnCount+this.deltaOldToNewColumnCount):toLength(e.lineCount+this.deltaOldToNewLineCount,e.columnCount)}translateCurToOld(e){const t=lengthToObj(e);return t.lineCount-this.deltaOldToNewLineCount===this.deltaLineIdxInOld?toLength(t.lineCount-this.deltaOldToNewLineCount,t.columnCount-this.deltaOldToNewColumnCount):toLength(t.lineCount-this.deltaOldToNewLineCount,t.columnCount)}adjustNextEdit(e){for(;this.nextEditIdx<this.edits.length;){const t=this.edits[this.nextEditIdx],s=this.translateOldToCur(t.endOffsetAfterObj);if(lengthLessThanEqual(s,e)){this.nextEditIdx++;const o=lengthToObj(s),r=lengthToObj(this.translateOldToCur(t.endOffsetBeforeObj)),l=o.lineCount-r.lineCount;this.deltaOldToNewLineCount+=l;const c=this.deltaLineIdxInOld===t.endOffsetBeforeObj.lineCount?this.deltaOldToNewColumnCount:0,d=o.columnCount-r.columnCount;this.deltaOldToNewColumnCount=c+d,this.deltaLineIdxInOld=t.endOffsetBeforeObj.lineCount}else break}}}class TextEditInfoCache{static from(e){return new TextEditInfoCache(e.startOffset,e.endOffset,e.newLength)}constructor(e,t,s){this.endOffsetBeforeObj=lengthToObj(t),this.endOffsetAfterObj=lengthToObj(lengthAdd(e,s)),this.offsetObj=lengthToObj(e)}}const emptyArr$2=[],Le=class Le{static create(e,t){if(e<=128&&t.length===0){let s=Le.cache[e];return s||(s=new Le(e,t),Le.cache[e]=s),s}return new Le(e,t)}static getEmpty(){return this.empty}constructor(e,t){this.items=e,this.additionalItems=t}add(e,t){const s=t.getKey(e);let o=s>>5;if(o===0){const l=1<<s|this.items;return l===this.items?this:Le.create(l,this.additionalItems)}o--;const r=this.additionalItems.slice(0);for(;r.length<o;)r.push(0);return r[o]|=1<<(s&31),Le.create(this.items,r)}merge(e){const t=this.items|e.items;if(this.additionalItems===emptyArr$2&&e.additionalItems===emptyArr$2)return t===this.items?this:t===e.items?e:Le.create(t,emptyArr$2);const s=[];for(let o=0;o<Math.max(this.additionalItems.length,e.additionalItems.length);o++){const r=this.additionalItems[o]||0,l=e.additionalItems[o]||0;s.push(r|l)}return Le.create(t,s)}intersects(e){if(this.items&e.items)return!0;for(let t=0;t<Math.min(this.additionalItems.length,e.additionalItems.length);t++)if(this.additionalItems[t]&e.additionalItems[t])return!0;return!1}};Le.cache=new Array(129),Le.empty=Le.create(0,emptyArr$2);let SmallImmutableSet=Le;const identityKeyProvider={getKey(a){return a}};class DenseKeyProvider{constructor(){this.items=new Map}getKey(e){let t=this.items.get(e);return t===void 0&&(t=this.items.size,this.items.set(e,t)),t}}class BaseAstNode{get length(){return this._length}constructor(e){this._length=e}}class PairAstNode extends BaseAstNode{static create(e,t,s){let o=e.length;return t&&(o=lengthAdd(o,t.length)),s&&(o=lengthAdd(o,s.length)),new PairAstNode(o,e,t,s,t?t.missingOpeningBracketIds:SmallImmutableSet.getEmpty())}get kind(){return 2}get listHeight(){return 0}get childrenLength(){return 3}getChild(e){switch(e){case 0:return this.openingBracket;case 1:return this.child;case 2:return this.closingBracket}throw new Error("Invalid child index")}get children(){const e=[];return e.push(this.openingBracket),this.child&&e.push(this.child),this.closingBracket&&e.push(this.closingBracket),e}constructor(e,t,s,o,r){super(e),this.openingBracket=t,this.child=s,this.closingBracket=o,this.missingOpeningBracketIds=r}canBeReused(e){return!(this.closingBracket===null||e.intersects(this.missingOpeningBracketIds))}deepClone(){return new PairAstNode(this.length,this.openingBracket.deepClone(),this.child&&this.child.deepClone(),this.closingBracket&&this.closingBracket.deepClone(),this.missingOpeningBracketIds)}computeMinIndentation(e,t){return this.child?this.child.computeMinIndentation(lengthAdd(e,this.openingBracket.length),t):Number.MAX_SAFE_INTEGER}}class ListAstNode extends BaseAstNode{static create23(e,t,s,o=!1){let r=e.length,l=e.missingOpeningBracketIds;if(e.listHeight!==t.listHeight)throw new Error("Invalid list heights");if(r=lengthAdd(r,t.length),l=l.merge(t.missingOpeningBracketIds),s){if(e.listHeight!==s.listHeight)throw new Error("Invalid list heights");r=lengthAdd(r,s.length),l=l.merge(s.missingOpeningBracketIds)}return o?new Immutable23ListAstNode(r,e.listHeight+1,e,t,s,l):new TwoThreeListAstNode(r,e.listHeight+1,e,t,s,l)}static getEmpty(){return new ImmutableArrayListAstNode(lengthZero,0,[],SmallImmutableSet.getEmpty())}get kind(){return 4}get missingOpeningBracketIds(){return this._missingOpeningBracketIds}constructor(e,t,s){super(e),this.listHeight=t,this._missingOpeningBracketIds=s,this.cachedMinIndentation=-1}throwIfImmutable(){}makeLastElementMutable(){this.throwIfImmutable();const e=this.childrenLength;if(e===0)return;const t=this.getChild(e-1),s=t.kind===4?t.toMutable():t;return t!==s&&this.setChild(e-1,s),s}makeFirstElementMutable(){if(this.throwIfImmutable(),this.childrenLength===0)return;const t=this.getChild(0),s=t.kind===4?t.toMutable():t;return t!==s&&this.setChild(0,s),s}canBeReused(e){if(e.intersects(this.missingOpeningBracketIds)||this.childrenLength===0)return!1;let t=this;for(;t.kind===4;){const s=t.childrenLength;if(s===0)throw new BugIndicatingError;t=t.getChild(s-1)}return t.canBeReused(e)}handleChildrenChanged(){this.throwIfImmutable();const e=this.childrenLength;let t=this.getChild(0).length,s=this.getChild(0).missingOpeningBracketIds;for(let o=1;o<e;o++){const r=this.getChild(o);t=lengthAdd(t,r.length),s=s.merge(r.missingOpeningBracketIds)}this._length=t,this._missingOpeningBracketIds=s,this.cachedMinIndentation=-1}computeMinIndentation(e,t){if(this.cachedMinIndentation!==-1)return this.cachedMinIndentation;let s=Number.MAX_SAFE_INTEGER,o=e;for(let r=0;r<this.childrenLength;r++){const l=this.getChild(r);l&&(s=Math.min(s,l.computeMinIndentation(o,t)),o=lengthAdd(o,l.length))}return this.cachedMinIndentation=s,s}}class TwoThreeListAstNode extends ListAstNode{get childrenLength(){return this._item3!==null?3:2}getChild(e){switch(e){case 0:return this._item1;case 1:return this._item2;case 2:return this._item3}throw new Error("Invalid child index")}setChild(e,t){switch(e){case 0:this._item1=t;return;case 1:this._item2=t;return;case 2:this._item3=t;return}throw new Error("Invalid child index")}get children(){return this._item3?[this._item1,this._item2,this._item3]:[this._item1,this._item2]}get item1(){return this._item1}get item2(){return this._item2}get item3(){return this._item3}constructor(e,t,s,o,r,l){super(e,t,l),this._item1=s,this._item2=o,this._item3=r}deepClone(){return new TwoThreeListAstNode(this.length,this.listHeight,this._item1.deepClone(),this._item2.deepClone(),this._item3?this._item3.deepClone():null,this.missingOpeningBracketIds)}appendChildOfSameHeight(e){if(this._item3)throw new Error("Cannot append to a full (2,3) tree node");this.throwIfImmutable(),this._item3=e,this.handleChildrenChanged()}unappendChild(){if(!this._item3)throw new Error("Cannot remove from a non-full (2,3) tree node");this.throwIfImmutable();const e=this._item3;return this._item3=null,this.handleChildrenChanged(),e}prependChildOfSameHeight(e){if(this._item3)throw new Error("Cannot prepend to a full (2,3) tree node");this.throwIfImmutable(),this._item3=this._item2,this._item2=this._item1,this._item1=e,this.handleChildrenChanged()}unprependChild(){if(!this._item3)throw new Error("Cannot remove from a non-full (2,3) tree node");this.throwIfImmutable();const e=this._item1;return this._item1=this._item2,this._item2=this._item3,this._item3=null,this.handleChildrenChanged(),e}toMutable(){return this}}class Immutable23ListAstNode extends TwoThreeListAstNode{toMutable(){return new TwoThreeListAstNode(this.length,this.listHeight,this.item1,this.item2,this.item3,this.missingOpeningBracketIds)}throwIfImmutable(){throw new Error("this instance is immutable")}}class ArrayListAstNode extends ListAstNode{get childrenLength(){return this._children.length}getChild(e){return this._children[e]}setChild(e,t){this._children[e]=t}get children(){return this._children}constructor(e,t,s,o){super(e,t,o),this._children=s}deepClone(){const e=new Array(this._children.length);for(let t=0;t<this._children.length;t++)e[t]=this._children[t].deepClone();return new ArrayListAstNode(this.length,this.listHeight,e,this.missingOpeningBracketIds)}appendChildOfSameHeight(e){this.throwIfImmutable(),this._children.push(e),this.handleChildrenChanged()}unappendChild(){this.throwIfImmutable();const e=this._children.pop();return this.handleChildrenChanged(),e}prependChildOfSameHeight(e){this.throwIfImmutable(),this._children.unshift(e),this.handleChildrenChanged()}unprependChild(){this.throwIfImmutable();const e=this._children.shift();return this.handleChildrenChanged(),e}toMutable(){return this}}class ImmutableArrayListAstNode extends ArrayListAstNode{toMutable(){return new ArrayListAstNode(this.length,this.listHeight,[...this.children],this.missingOpeningBracketIds)}throwIfImmutable(){throw new Error("this instance is immutable")}}const emptyArray=[];class ImmutableLeafAstNode extends BaseAstNode{get listHeight(){return 0}get childrenLength(){return 0}getChild(e){return null}get children(){return emptyArray}deepClone(){return this}}class TextAstNode extends ImmutableLeafAstNode{get kind(){return 0}get missingOpeningBracketIds(){return SmallImmutableSet.getEmpty()}canBeReused(e){return!0}computeMinIndentation(e,t){const s=lengthToObj(e),o=(s.columnCount===0?s.lineCount:s.lineCount+1)+1,r=lengthGetLineCount(lengthAdd(e,this.length))+1;let l=Number.MAX_SAFE_INTEGER;for(let c=o;c<=r;c++){const d=t.getLineFirstNonWhitespaceColumn(c),u=t.getLineContent(c);if(d===0)continue;const g=CursorColumns.visibleColumnFromColumn(u,d,t.getOptions().tabSize);l=Math.min(l,g)}return l}}class BracketAstNode extends ImmutableLeafAstNode{static create(e,t,s){return new BracketAstNode(e,t,s)}get kind(){return 1}get missingOpeningBracketIds(){return SmallImmutableSet.getEmpty()}constructor(e,t,s){super(e),this.bracketInfo=t,this.bracketIds=s}get text(){return this.bracketInfo.bracketText}get languageId(){return this.bracketInfo.languageId}canBeReused(e){return!1}computeMinIndentation(e,t){return Number.MAX_SAFE_INTEGER}}class InvalidBracketAstNode extends ImmutableLeafAstNode{get kind(){return 3}constructor(e,t){super(t),this.missingOpeningBracketIds=e}canBeReused(e){return!e.intersects(this.missingOpeningBracketIds)}computeMinIndentation(e,t){return Number.MAX_SAFE_INTEGER}}let Token$1=class{constructor(e,t,s,o,r){this.length=e,this.kind=t,this.bracketId=s,this.bracketIds=o,this.astNode=r}};class TextBufferTokenizer{constructor(e,t){this.textModel=e,this.bracketTokens=t,this.reader=new NonPeekableTextBufferTokenizer(this.textModel,this.bracketTokens),this._offset=lengthZero,this.didPeek=!1,this.peeked=null,this.textBufferLineCount=e.getLineCount(),this.textBufferLastLineLength=e.getLineLength(this.textBufferLineCount)}get offset(){return this._offset}get length(){return toLength(this.textBufferLineCount-1,this.textBufferLastLineLength)}skip(e){this.didPeek=!1,this._offset=lengthAdd(this._offset,e);const t=lengthToObj(this._offset);this.reader.setPosition(t.lineCount,t.columnCount)}read(){let e;return this.peeked?(this.didPeek=!1,e=this.peeked):e=this.reader.read(),e&&(this._offset=lengthAdd(this._offset,e.length)),e}peek(){return this.didPeek||(this.peeked=this.reader.read(),this.didPeek=!0),this.peeked}}class NonPeekableTextBufferTokenizer{constructor(e,t){this.textModel=e,this.bracketTokens=t,this.lineIdx=0,this.line=null,this.lineCharOffset=0,this.lineTokens=null,this.lineTokenOffset=0,this.peekedToken=null,this.textBufferLineCount=e.getLineCount(),this.textBufferLastLineLength=e.getLineLength(this.textBufferLineCount)}setPosition(e,t){e===this.lineIdx?(this.lineCharOffset=t,this.line!==null&&(this.lineTokenOffset=this.lineCharOffset===0?0:this.lineTokens.findTokenIndexAtOffset(this.lineCharOffset))):(this.lineIdx=e,this.lineCharOffset=t,this.line=null),this.peekedToken=null}read(){if(this.peekedToken){const r=this.peekedToken;return this.peekedToken=null,this.lineCharOffset+=r.length,r}if(this.lineIdx>this.textBufferLineCount-1||this.lineIdx===this.textBufferLineCount-1&&this.lineCharOffset>=this.textBufferLastLineLength)return null;this.line===null&&(this.lineTokens=this.textModel.tokenization.getLineTokens(this.lineIdx+1),this.line=this.lineTokens.getLineContent(),this.lineTokenOffset=this.lineCharOffset===0?0:this.lineTokens.findTokenIndexAtOffset(this.lineCharOffset));const e=this.lineIdx,t=this.lineCharOffset;let s=0;for(;;){const r=this.lineTokens,l=r.getCount();let c=null;if(this.lineTokenOffset<l){const d=r.getMetadata(this.lineTokenOffset);for(;this.lineTokenOffset+1<l&&d===r.getMetadata(this.lineTokenOffset+1);)this.lineTokenOffset++;const u=TokenMetadata.getTokenType(d)===0,g=TokenMetadata.containsBalancedBrackets(d),f=r.getEndOffset(this.lineTokenOffset);if(g&&u&&this.lineCharOffset<f){const p=r.getLanguageId(this.lineTokenOffset),m=this.line.substring(this.lineCharOffset,f),_=this.bracketTokens.getSingleLanguageBracketTokens(p),C=_.regExpGlobal;if(C){C.lastIndex=0;const b=C.exec(m);b&&(c=_.getToken(b[0]),c&&(this.lineCharOffset+=b.index))}}if(s+=f-this.lineCharOffset,c)if(e!==this.lineIdx||t!==this.lineCharOffset){this.peekedToken=c;break}else return this.lineCharOffset+=c.length,c;else this.lineTokenOffset++,this.lineCharOffset=f}else if(this.lineIdx===this.textBufferLineCount-1||(this.lineIdx++,this.lineTokens=this.textModel.tokenization.getLineTokens(this.lineIdx+1),this.lineTokenOffset=0,this.line=this.lineTokens.getLineContent(),this.lineCharOffset=0,s+=33,s>1e3))break;if(s>1500)break}const o=lengthDiff(e,t,this.lineIdx,this.lineCharOffset);return new Token$1(o,0,-1,SmallImmutableSet.getEmpty(),new TextAstNode(o))}}class FastTokenizer{constructor(e,t){this.text=e,this._offset=lengthZero,this.idx=0;const s=t.getRegExpStr(),o=s?new RegExp(s+`|
`,"gi"):null,r=[];let l,c=0,d=0,u=0,g=0;const f=[];for(let _=0;_<60;_++)f.push(new Token$1(toLength(0,_),0,-1,SmallImmutableSet.getEmpty(),new TextAstNode(toLength(0,_))));const p=[];for(let _=0;_<60;_++)p.push(new Token$1(toLength(1,_),0,-1,SmallImmutableSet.getEmpty(),new TextAstNode(toLength(1,_))));if(o)for(o.lastIndex=0;(l=o.exec(e))!==null;){const _=l.index,C=l[0];if(C===`
`)c++,d=_+1;else{if(u!==_){let b;if(g===c){const v=_-u;if(v<f.length)b=f[v];else{const S=toLength(0,v);b=new Token$1(S,0,-1,SmallImmutableSet.getEmpty(),new TextAstNode(S))}}else{const v=c-g,S=_-d;if(v===1&&S<p.length)b=p[S];else{const y=toLength(v,S);b=new Token$1(y,0,-1,SmallImmutableSet.getEmpty(),new TextAstNode(y))}}r.push(b)}r.push(t.getToken(C)),u=_+C.length,g=c}}const m=e.length;if(u!==m){const _=g===c?toLength(0,m-u):toLength(c-g,m-d);r.push(new Token$1(_,0,-1,SmallImmutableSet.getEmpty(),new TextAstNode(_)))}this.length=toLength(c,m-d),this.tokens=r}get offset(){return this._offset}read(){return this.tokens[this.idx++]||null}peek(){return this.tokens[this.idx]||null}skip(e){throw new NotSupportedError}}class BracketTokens{static createFromLanguage(e,t){function s(r){return t.getKey(`${r.languageId}:::${r.bracketText}`)}const o=new Map;for(const r of e.bracketsNew.openingBrackets){const l=toLength(0,r.bracketText.length),c=s(r),d=SmallImmutableSet.getEmpty().add(c,identityKeyProvider);o.set(r.bracketText,new Token$1(l,1,c,d,BracketAstNode.create(l,r,d)))}for(const r of e.bracketsNew.closingBrackets){const l=toLength(0,r.bracketText.length);let c=SmallImmutableSet.getEmpty();const d=r.getOpeningBrackets();for(const u of d)c=c.add(s(u),identityKeyProvider);o.set(r.bracketText,new Token$1(l,2,s(d[0]),c,BracketAstNode.create(l,r,c)))}return new BracketTokens(o)}constructor(e){this.map=e,this.hasRegExp=!1,this._regExpGlobal=null}getRegExpStr(){if(this.isEmpty)return null;{const e=[...this.map.keys()];return e.sort(),e.reverse(),e.map(t=>prepareBracketForRegExp(t)).join("|")}}get regExpGlobal(){if(!this.hasRegExp){const e=this.getRegExpStr();this._regExpGlobal=e?new RegExp(e,"gi"):null,this.hasRegExp=!0}return this._regExpGlobal}getToken(e){return this.map.get(e.toLowerCase())}findClosingTokenText(e){for(const[t,s]of this.map)if(s.kind===2&&s.bracketIds.intersects(e))return t}get isEmpty(){return this.map.size===0}}function prepareBracketForRegExp(a){let e=escapeRegExpCharacters(a);return/^[\w ]+/.test(a)&&(e=`\\b${e}`),/[\w ]+$/.test(a)&&(e=`${e}\\b`),e}class LanguageAgnosticBracketTokens{constructor(e,t){this.denseKeyProvider=e,this.getLanguageConfiguration=t,this.languageIdToBracketTokens=new Map}didLanguageChange(e){return this.languageIdToBracketTokens.has(e)}getSingleLanguageBracketTokens(e){let t=this.languageIdToBracketTokens.get(e);return t||(t=BracketTokens.createFromLanguage(this.getLanguageConfiguration(e),this.denseKeyProvider),this.languageIdToBracketTokens.set(e,t)),t}}function concat23Trees(a){if(a.length===0)return null;if(a.length===1)return a[0];let e=0;function t(){if(e>=a.length)return null;const l=e,c=a[l].listHeight;for(e++;e<a.length&&a[e].listHeight===c;)e++;return e-l>=2?concat23TreesOfSameHeight(l===0&&e===a.length?a:a.slice(l,e),!1):a[l]}let s=t(),o=t();if(!o)return s;for(let l=t();l;l=t())heightDiff(s,o)<=heightDiff(o,l)?(s=concat$2(s,o),o=l):o=concat$2(o,l);return concat$2(s,o)}function concat23TreesOfSameHeight(a,e=!1){if(a.length===0)return null;if(a.length===1)return a[0];let t=a.length;for(;t>3;){const s=t>>1;for(let o=0;o<s;o++){const r=o<<1;a[o]=ListAstNode.create23(a[r],a[r+1],r+3===t?a[r+2]:null,e)}t=s}return ListAstNode.create23(a[0],a[1],t>=3?a[2]:null,e)}function heightDiff(a,e){return Math.abs(a.listHeight-e.listHeight)}function concat$2(a,e){return a.listHeight===e.listHeight?ListAstNode.create23(a,e,null,!1):a.listHeight>e.listHeight?append$1(a,e):prepend$1(e,a)}function append$1(a,e){a=a.toMutable();let t=a;const s=[];let o;for(;;){if(e.listHeight===t.listHeight){o=e;break}if(t.kind!==4)throw new Error("unexpected");s.push(t),t=t.makeLastElementMutable()}for(let r=s.length-1;r>=0;r--){const l=s[r];o?l.childrenLength>=3?o=ListAstNode.create23(l.unappendChild(),o,null,!1):(l.appendChildOfSameHeight(o),o=void 0):l.handleChildrenChanged()}return o?ListAstNode.create23(a,o,null,!1):a}function prepend$1(a,e){a=a.toMutable();let t=a;const s=[];for(;e.listHeight!==t.listHeight;){if(t.kind!==4)throw new Error("unexpected");s.push(t),t=t.makeFirstElementMutable()}let o=e;for(let r=s.length-1;r>=0;r--){const l=s[r];o?l.childrenLength>=3?o=ListAstNode.create23(o,l.unprependChild(),null,!1):(l.prependChildOfSameHeight(o),o=void 0):l.handleChildrenChanged()}return o?ListAstNode.create23(o,a,null,!1):a}class NodeReader{constructor(e){this.lastOffset=lengthZero,this.nextNodes=[e],this.offsets=[lengthZero],this.idxs=[]}readLongestNodeAt(e,t){if(lengthLessThan(e,this.lastOffset))throw new Error("Invalid offset");for(this.lastOffset=e;;){const s=lastOrUndefined(this.nextNodes);if(!s)return;const o=lastOrUndefined(this.offsets);if(lengthLessThan(e,o))return;if(lengthLessThan(o,e))if(lengthAdd(o,s.length)<=e)this.nextNodeAfterCurrent();else{const r=getNextChildIdx(s);r!==-1?(this.nextNodes.push(s.getChild(r)),this.offsets.push(o),this.idxs.push(r)):this.nextNodeAfterCurrent()}else{if(t(s))return this.nextNodeAfterCurrent(),s;{const r=getNextChildIdx(s);if(r===-1){this.nextNodeAfterCurrent();return}else this.nextNodes.push(s.getChild(r)),this.offsets.push(o),this.idxs.push(r)}}}}nextNodeAfterCurrent(){for(;;){const e=lastOrUndefined(this.offsets),t=lastOrUndefined(this.nextNodes);if(this.nextNodes.pop(),this.offsets.pop(),this.idxs.length===0)break;const s=lastOrUndefined(this.nextNodes),o=getNextChildIdx(s,this.idxs[this.idxs.length-1]);if(o!==-1){this.nextNodes.push(s.getChild(o)),this.offsets.push(lengthAdd(e,t.length)),this.idxs[this.idxs.length-1]=o;break}else this.idxs.pop()}}}function getNextChildIdx(a,e=-1){for(;;){if(e++,e>=a.childrenLength)return-1;if(a.getChild(e))return e}}function lastOrUndefined(a){return a.length>0?a[a.length-1]:void 0}function parseDocument(a,e,t,s){return new Parser(a,e,t,s).parseDocument()}class Parser{constructor(e,t,s,o){if(this.tokenizer=e,this.createImmutableLists=o,this._itemsConstructed=0,this._itemsFromCache=0,s&&o)throw new Error("Not supported");this.oldNodeReader=s?new NodeReader(s):void 0,this.positionMapper=new BeforeEditPositionMapper(t)}parseDocument(){this._itemsConstructed=0,this._itemsFromCache=0;let e=this.parseList(SmallImmutableSet.getEmpty(),0);return e||(e=ListAstNode.getEmpty()),e}parseList(e,t){const s=[];for(;;){let r=this.tryReadChildFromCache(e);if(!r){const l=this.tokenizer.peek();if(!l||l.kind===2&&l.bracketIds.intersects(e))break;r=this.parseChild(e,t+1)}r.kind===4&&r.childrenLength===0||s.push(r)}return this.oldNodeReader?concat23Trees(s):concat23TreesOfSameHeight(s,this.createImmutableLists)}tryReadChildFromCache(e){if(this.oldNodeReader){const t=this.positionMapper.getDistanceToNextChange(this.tokenizer.offset);if(t===null||!lengthIsZero(t)){const s=this.oldNodeReader.readLongestNodeAt(this.positionMapper.getOffsetBeforeChange(this.tokenizer.offset),o=>t!==null&&!lengthLessThan(o.length,t)?!1:o.canBeReused(e));if(s)return this._itemsFromCache++,this.tokenizer.skip(s.length),s}}}parseChild(e,t){this._itemsConstructed++;const s=this.tokenizer.read();switch(s.kind){case 2:return new InvalidBracketAstNode(s.bracketIds,s.length);case 0:return s.astNode;case 1:{if(t>300)return new TextAstNode(s.length);const o=e.merge(s.bracketIds),r=this.parseList(o,t+1),l=this.tokenizer.peek();return l&&l.kind===2&&(l.bracketId===s.bracketId||l.bracketIds.intersects(s.bracketIds))?(this.tokenizer.read(),PairAstNode.create(s.astNode,r,l.astNode)):PairAstNode.create(s.astNode,r,null)}default:throw new Error("unexpected")}}}function combineTextEditInfos(a,e){if(a.length===0)return e;if(e.length===0)return a;const t=new ArrayQueue(toLengthMapping(a)),s=toLengthMapping(e);s.push({modified:!1,lengthBefore:void 0,lengthAfter:void 0});let o=t.dequeue();function r(u){if(u===void 0){const f=t.takeWhile(p=>!0)||[];return o&&f.unshift(o),f}const g=[];for(;o&&!lengthIsZero(u);){const[f,p]=o.splitAt(u);g.push(f),u=lengthDiffNonNegative(f.lengthAfter,u),o=p??t.dequeue()}return lengthIsZero(u)||g.push(new LengthMapping(!1,u,u)),g}const l=[];function c(u,g,f){if(l.length>0&&lengthEquals(l[l.length-1].endOffset,u)){const p=l[l.length-1];l[l.length-1]=new TextEditInfo(p.startOffset,g,lengthAdd(p.newLength,f))}else l.push({startOffset:u,endOffset:g,newLength:f})}let d=lengthZero;for(const u of s){const g=r(u.lengthBefore);if(u.modified){const f=sumLengths(g,m=>m.lengthBefore),p=lengthAdd(d,f);c(d,p,u.lengthAfter),d=p}else for(const f of g){const p=d;d=lengthAdd(d,f.lengthBefore),f.modified&&c(p,d,f.lengthAfter)}}return l}class LengthMapping{constructor(e,t,s){this.modified=e,this.lengthBefore=t,this.lengthAfter=s}splitAt(e){const t=lengthDiffNonNegative(e,this.lengthAfter);return lengthEquals(t,lengthZero)?[this,void 0]:this.modified?[new LengthMapping(this.modified,this.lengthBefore,e),new LengthMapping(this.modified,lengthZero,t)]:[new LengthMapping(this.modified,e,e),new LengthMapping(this.modified,t,t)]}toString(){return`${this.modified?"M":"U"}:${lengthToObj(this.lengthBefore)} -> ${lengthToObj(this.lengthAfter)}`}}function toLengthMapping(a){const e=[];let t=lengthZero;for(const s of a){const o=lengthDiffNonNegative(t,s.startOffset);lengthIsZero(o)||e.push(new LengthMapping(!1,o,o));const r=lengthDiffNonNegative(s.startOffset,s.endOffset);e.push(new LengthMapping(!0,r,s.newLength)),t=s.endOffset}return e}class BracketPairsTree extends Disposable{didLanguageChange(e){return this.brackets.didLanguageChange(e)}constructor(e,t){if(super(),this.textModel=e,this.getLanguageConfiguration=t,this.didChangeEmitter=new Emitter$1,this.denseKeyProvider=new DenseKeyProvider,this.brackets=new LanguageAgnosticBracketTokens(this.denseKeyProvider,this.getLanguageConfiguration),this.onDidChange=this.didChangeEmitter.event,this.queuedTextEditsForInitialAstWithoutTokens=[],this.queuedTextEdits=[],e.tokenization.hasTokens)e.tokenization.backgroundTokenizationState===2?(this.initialAstWithoutTokens=void 0,this.astWithTokens=this.parseDocumentFromTextBuffer([],void 0,!1)):(this.initialAstWithoutTokens=this.parseDocumentFromTextBuffer([],void 0,!0),this.astWithTokens=this.initialAstWithoutTokens);else{const s=this.brackets.getSingleLanguageBracketTokens(this.textModel.getLanguageId()),o=new FastTokenizer(this.textModel.getValue(),s);this.initialAstWithoutTokens=parseDocument(o,[],void 0,!0),this.astWithTokens=this.initialAstWithoutTokens}}handleDidChangeBackgroundTokenizationState(){if(this.textModel.tokenization.backgroundTokenizationState===2){const e=this.initialAstWithoutTokens===void 0;this.initialAstWithoutTokens=void 0,e||this.didChangeEmitter.fire()}}handleDidChangeTokens({ranges:e}){const t=e.map(s=>new TextEditInfo(toLength(s.fromLineNumber-1,0),toLength(s.toLineNumber,0),toLength(s.toLineNumber-s.fromLineNumber+1,0)));this.handleEdits(t,!0),this.initialAstWithoutTokens||this.didChangeEmitter.fire()}handleContentChanged(e){const t=TextEditInfo.fromModelContentChanges(e.changes);this.handleEdits(t,!1)}handleEdits(e,t){const s=combineTextEditInfos(this.queuedTextEdits,e);this.queuedTextEdits=s,this.initialAstWithoutTokens&&!t&&(this.queuedTextEditsForInitialAstWithoutTokens=combineTextEditInfos(this.queuedTextEditsForInitialAstWithoutTokens,e))}flushQueue(){this.queuedTextEdits.length>0&&(this.astWithTokens=this.parseDocumentFromTextBuffer(this.queuedTextEdits,this.astWithTokens,!1),this.queuedTextEdits=[]),this.queuedTextEditsForInitialAstWithoutTokens.length>0&&(this.initialAstWithoutTokens&&(this.initialAstWithoutTokens=this.parseDocumentFromTextBuffer(this.queuedTextEditsForInitialAstWithoutTokens,this.initialAstWithoutTokens,!1)),this.queuedTextEditsForInitialAstWithoutTokens=[])}parseDocumentFromTextBuffer(e,t,s){const o=t,r=new TextBufferTokenizer(this.textModel,this.brackets);return parseDocument(r,e,o,s)}getBracketsInRange(e,t){this.flushQueue();const s=toLength(e.startLineNumber-1,e.startColumn-1),o=toLength(e.endLineNumber-1,e.endColumn-1);return new CallbackIterable(r=>{const l=this.initialAstWithoutTokens||this.astWithTokens;collectBrackets(l,lengthZero,l.length,s,o,r,0,0,new Map,t)})}getBracketPairsInRange(e,t){this.flushQueue();const s=positionToLength(e.getStartPosition()),o=positionToLength(e.getEndPosition());return new CallbackIterable(r=>{const l=this.initialAstWithoutTokens||this.astWithTokens,c=new CollectBracketPairsContext(r,t,this.textModel);collectBracketPairs(l,lengthZero,l.length,s,o,c,0,new Map)})}getFirstBracketAfter(e){this.flushQueue();const t=this.initialAstWithoutTokens||this.astWithTokens;return getFirstBracketAfter(t,lengthZero,t.length,positionToLength(e))}getFirstBracketBefore(e){this.flushQueue();const t=this.initialAstWithoutTokens||this.astWithTokens;return getFirstBracketBefore(t,lengthZero,t.length,positionToLength(e))}}function getFirstBracketBefore(a,e,t,s){if(a.kind===4||a.kind===2){const o=[];for(const r of a.children)t=lengthAdd(e,r.length),o.push({nodeOffsetStart:e,nodeOffsetEnd:t}),e=t;for(let r=o.length-1;r>=0;r--){const{nodeOffsetStart:l,nodeOffsetEnd:c}=o[r];if(lengthLessThan(l,s)){const d=getFirstBracketBefore(a.children[r],l,c,s);if(d)return d}}return null}else{if(a.kind===3)return null;if(a.kind===1){const o=lengthsToRange(e,t);return{bracketInfo:a.bracketInfo,range:o}}}return null}function getFirstBracketAfter(a,e,t,s){if(a.kind===4||a.kind===2){for(const o of a.children){if(t=lengthAdd(e,o.length),lengthLessThan(s,t)){const r=getFirstBracketAfter(o,e,t,s);if(r)return r}e=t}return null}else{if(a.kind===3)return null;if(a.kind===1){const o=lengthsToRange(e,t);return{bracketInfo:a.bracketInfo,range:o}}}return null}function collectBrackets(a,e,t,s,o,r,l,c,d,u,g=!1){if(l>200)return!0;e:for(;;)switch(a.kind){case 4:{const f=a.childrenLength;for(let p=0;p<f;p++){const m=a.getChild(p);if(m){if(t=lengthAdd(e,m.length),lengthLessThanEqual(e,o)&&lengthGreaterThanEqual(t,s)){if(lengthGreaterThanEqual(t,o)){a=m;continue e}if(!collectBrackets(m,e,t,s,o,r,l,0,d,u))return!1}e=t}}return!0}case 2:{const f=!u||!a.closingBracket||a.closingBracket.bracketInfo.closesColorized(a.openingBracket.bracketInfo);let p=0;if(d){let _=d.get(a.openingBracket.text);_===void 0&&(_=0),p=_,f&&(_++,d.set(a.openingBracket.text,_))}const m=a.childrenLength;for(let _=0;_<m;_++){const C=a.getChild(_);if(C){if(t=lengthAdd(e,C.length),lengthLessThanEqual(e,o)&&lengthGreaterThanEqual(t,s)){if(lengthGreaterThanEqual(t,o)&&C.kind!==1){a=C,f?(l++,c=p+1):c=p;continue e}if((f||C.kind!==1||!a.closingBracket)&&!collectBrackets(C,e,t,s,o,r,f?l+1:l,f?p+1:p,d,u,!a.closingBracket))return!1}e=t}}return d==null||d.set(a.openingBracket.text,p),!0}case 3:{const f=lengthsToRange(e,t);return r(new BracketInfo(f,l-1,0,!0))}case 1:{const f=lengthsToRange(e,t);return r(new BracketInfo(f,l-1,c-1,g))}case 0:return!0}}class CollectBracketPairsContext{constructor(e,t,s){this.push=e,this.includeMinIndentation=t,this.textModel=s}}function collectBracketPairs(a,e,t,s,o,r,l,c){var u;if(l>200)return!0;let d=!0;if(a.kind===2){let g=0;if(c){let m=c.get(a.openingBracket.text);m===void 0&&(m=0),g=m,m++,c.set(a.openingBracket.text,m)}const f=lengthAdd(e,a.openingBracket.length);let p=-1;if(r.includeMinIndentation&&(p=a.computeMinIndentation(e,r.textModel)),d=r.push(new BracketPairWithMinIndentationInfo(lengthsToRange(e,t),lengthsToRange(e,f),a.closingBracket?lengthsToRange(lengthAdd(f,((u=a.child)==null?void 0:u.length)||lengthZero),t):void 0,l,g,a,p)),e=f,d&&a.child){const m=a.child;if(t=lengthAdd(e,m.length),lengthLessThanEqual(e,o)&&lengthGreaterThanEqual(t,s)&&(d=collectBracketPairs(m,e,t,s,o,r,l+1,c),!d))return!1}c==null||c.set(a.openingBracket.text,g)}else{let g=e;for(const f of a.children){const p=g;if(g=lengthAdd(g,f.length),lengthLessThanEqual(p,o)&&lengthLessThanEqual(s,g)&&(d=collectBracketPairs(f,p,g,s,o,r,l,c),!d))return!1}}return d}class BracketPairsTextModelPart extends Disposable{get canBuildAST(){return this.textModel.getValueLength()<=5e6}constructor(e,t){super(),this.textModel=e,this.languageConfigurationService=t,this.bracketPairsTree=this._register(new MutableDisposable),this.onDidChangeEmitter=new Emitter$1,this.onDidChange=this.onDidChangeEmitter.event,this.bracketsRequested=!1}handleLanguageConfigurationServiceChange(e){var t;(!e.languageId||(t=this.bracketPairsTree.value)!=null&&t.object.didLanguageChange(e.languageId))&&(this.bracketPairsTree.clear(),this.updateBracketPairsTree())}handleDidChangeOptions(e){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeLanguage(e){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeContent(e){var t;(t=this.bracketPairsTree.value)==null||t.object.handleContentChanged(e)}handleDidChangeBackgroundTokenizationState(){var e;(e=this.bracketPairsTree.value)==null||e.object.handleDidChangeBackgroundTokenizationState()}handleDidChangeTokens(e){var t;(t=this.bracketPairsTree.value)==null||t.object.handleDidChangeTokens(e)}updateBracketPairsTree(){if(this.bracketsRequested&&this.canBuildAST){if(!this.bracketPairsTree.value){const e=new DisposableStore;this.bracketPairsTree.value=createDisposableRef(e.add(new BracketPairsTree(this.textModel,t=>this.languageConfigurationService.getLanguageConfiguration(t))),e),e.add(this.bracketPairsTree.value.object.onDidChange(t=>this.onDidChangeEmitter.fire(t))),this.onDidChangeEmitter.fire()}}else this.bracketPairsTree.value&&(this.bracketPairsTree.clear(),this.onDidChangeEmitter.fire())}getBracketPairsInRange(e){var t;return this.bracketsRequested=!0,this.updateBracketPairsTree(),((t=this.bracketPairsTree.value)==null?void 0:t.object.getBracketPairsInRange(e,!1))||CallbackIterable.empty}getBracketPairsInRangeWithMinIndentation(e){var t;return this.bracketsRequested=!0,this.updateBracketPairsTree(),((t=this.bracketPairsTree.value)==null?void 0:t.object.getBracketPairsInRange(e,!0))||CallbackIterable.empty}getBracketsInRange(e,t=!1){var s;return this.bracketsRequested=!0,this.updateBracketPairsTree(),((s=this.bracketPairsTree.value)==null?void 0:s.object.getBracketsInRange(e,t))||CallbackIterable.empty}findMatchingBracketUp(e,t,s){const o=this.textModel.validatePosition(t),r=this.textModel.getLanguageIdAtPosition(o.lineNumber,o.column);if(this.canBuildAST){const l=this.languageConfigurationService.getLanguageConfiguration(r).bracketsNew.getClosingBracketInfo(e);if(!l)return null;const c=this.getBracketPairsInRange(Range$2.fromPositions(t,t)).findLast(d=>l.closes(d.openingBracketInfo));return c?c.openingBracketRange:null}else{const l=e.toLowerCase(),c=this.languageConfigurationService.getLanguageConfiguration(r).brackets;if(!c)return null;const d=c.textIsBracket[l];return d?stripBracketSearchCanceled(this._findMatchingBracketUp(d,o,createTimeBasedContinueBracketSearchPredicate(s))):null}}matchBracket(e,t){if(this.canBuildAST){const s=this.getBracketPairsInRange(Range$2.fromPositions(e,e)).filter(o=>o.closingBracketRange!==void 0&&(o.openingBracketRange.containsPosition(e)||o.closingBracketRange.containsPosition(e))).findLastMaxBy(compareBy(o=>o.openingBracketRange.containsPosition(e)?o.openingBracketRange:o.closingBracketRange,Range$2.compareRangesUsingStarts));return s?[s.openingBracketRange,s.closingBracketRange]:null}else{const s=createTimeBasedContinueBracketSearchPredicate(t);return this._matchBracket(this.textModel.validatePosition(e),s)}}_establishBracketSearchOffsets(e,t,s,o){const r=t.getCount(),l=t.getLanguageId(o);let c=Math.max(0,e.column-1-s.maxBracketLength);for(let u=o-1;u>=0;u--){const g=t.getEndOffset(u);if(g<=c)break;if(ignoreBracketsInToken(t.getStandardTokenType(u))||t.getLanguageId(u)!==l){c=g;break}}let d=Math.min(t.getLineContent().length,e.column-1+s.maxBracketLength);for(let u=o+1;u<r;u++){const g=t.getStartOffset(u);if(g>=d)break;if(ignoreBracketsInToken(t.getStandardTokenType(u))||t.getLanguageId(u)!==l){d=g;break}}return{searchStartOffset:c,searchEndOffset:d}}_matchBracket(e,t){const s=e.lineNumber,o=this.textModel.tokenization.getLineTokens(s),r=this.textModel.getLineContent(s),l=o.findTokenIndexAtOffset(e.column-1);if(l<0)return null;const c=this.languageConfigurationService.getLanguageConfiguration(o.getLanguageId(l)).brackets;if(c&&!ignoreBracketsInToken(o.getStandardTokenType(l))){let{searchStartOffset:d,searchEndOffset:u}=this._establishBracketSearchOffsets(e,o,c,l),g=null;for(;;){const f=BracketsUtils.findNextBracketInRange(c.forwardRegex,s,r,d,u);if(!f)break;if(f.startColumn<=e.column&&e.column<=f.endColumn){const p=r.substring(f.startColumn-1,f.endColumn-1).toLowerCase(),m=this._matchFoundBracket(f,c.textIsBracket[p],c.textIsOpenBracket[p],t);if(m){if(m instanceof BracketSearchCanceled)return null;g=m}}d=f.endColumn-1}if(g)return g}if(l>0&&o.getStartOffset(l)===e.column-1){const d=l-1,u=this.languageConfigurationService.getLanguageConfiguration(o.getLanguageId(d)).brackets;if(u&&!ignoreBracketsInToken(o.getStandardTokenType(d))){const{searchStartOffset:g,searchEndOffset:f}=this._establishBracketSearchOffsets(e,o,u,d),p=BracketsUtils.findPrevBracketInRange(u.reversedRegex,s,r,g,f);if(p&&p.startColumn<=e.column&&e.column<=p.endColumn){const m=r.substring(p.startColumn-1,p.endColumn-1).toLowerCase(),_=this._matchFoundBracket(p,u.textIsBracket[m],u.textIsOpenBracket[m],t);if(_)return _ instanceof BracketSearchCanceled?null:_}}}return null}_matchFoundBracket(e,t,s,o){if(!t)return null;const r=s?this._findMatchingBracketDown(t,e.getEndPosition(),o):this._findMatchingBracketUp(t,e.getStartPosition(),o);return r?r instanceof BracketSearchCanceled?r:[e,r]:null}_findMatchingBracketUp(e,t,s){const o=e.languageId,r=e.reversedRegex;let l=-1,c=0;const d=(u,g,f,p)=>{for(;;){if(s&&++c%100===0&&!s())return BracketSearchCanceled.INSTANCE;const m=BracketsUtils.findPrevBracketInRange(r,u,g,f,p);if(!m)break;const _=g.substring(m.startColumn-1,m.endColumn-1).toLowerCase();if(e.isOpen(_)?l++:e.isClose(_)&&l--,l===0)return m;p=m.startColumn-1}return null};for(let u=t.lineNumber;u>=1;u--){const g=this.textModel.tokenization.getLineTokens(u),f=g.getCount(),p=this.textModel.getLineContent(u);let m=f-1,_=p.length,C=p.length;u===t.lineNumber&&(m=g.findTokenIndexAtOffset(t.column-1),_=t.column-1,C=t.column-1);let b=!0;for(;m>=0;m--){const v=g.getLanguageId(m)===o&&!ignoreBracketsInToken(g.getStandardTokenType(m));if(v)b?_=g.getStartOffset(m):(_=g.getStartOffset(m),C=g.getEndOffset(m));else if(b&&_!==C){const S=d(u,p,_,C);if(S)return S}b=v}if(b&&_!==C){const v=d(u,p,_,C);if(v)return v}}return null}_findMatchingBracketDown(e,t,s){const o=e.languageId,r=e.forwardRegex;let l=1,c=0;const d=(g,f,p,m)=>{for(;;){if(s&&++c%100===0&&!s())return BracketSearchCanceled.INSTANCE;const _=BracketsUtils.findNextBracketInRange(r,g,f,p,m);if(!_)break;const C=f.substring(_.startColumn-1,_.endColumn-1).toLowerCase();if(e.isOpen(C)?l++:e.isClose(C)&&l--,l===0)return _;p=_.endColumn-1}return null},u=this.textModel.getLineCount();for(let g=t.lineNumber;g<=u;g++){const f=this.textModel.tokenization.getLineTokens(g),p=f.getCount(),m=this.textModel.getLineContent(g);let _=0,C=0,b=0;g===t.lineNumber&&(_=f.findTokenIndexAtOffset(t.column-1),C=t.column-1,b=t.column-1);let v=!0;for(;_<p;_++){const S=f.getLanguageId(_)===o&&!ignoreBracketsInToken(f.getStandardTokenType(_));if(S)v||(C=f.getStartOffset(_)),b=f.getEndOffset(_);else if(v&&C!==b){const y=d(g,m,C,b);if(y)return y}v=S}if(v&&C!==b){const S=d(g,m,C,b);if(S)return S}}return null}findPrevBracket(e){var l;const t=this.textModel.validatePosition(e);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),((l=this.bracketPairsTree.value)==null?void 0:l.object.getFirstBracketBefore(t))||null;let s=null,o=null,r=null;for(let c=t.lineNumber;c>=1;c--){const d=this.textModel.tokenization.getLineTokens(c),u=d.getCount(),g=this.textModel.getLineContent(c);let f=u-1,p=g.length,m=g.length;if(c===t.lineNumber){f=d.findTokenIndexAtOffset(t.column-1),p=t.column-1,m=t.column-1;const C=d.getLanguageId(f);s!==C&&(s=C,o=this.languageConfigurationService.getLanguageConfiguration(s).brackets,r=this.languageConfigurationService.getLanguageConfiguration(s).bracketsNew)}let _=!0;for(;f>=0;f--){const C=d.getLanguageId(f);if(s!==C){if(o&&r&&_&&p!==m){const v=BracketsUtils.findPrevBracketInRange(o.reversedRegex,c,g,p,m);if(v)return this._toFoundBracket(r,v);_=!1}s=C,o=this.languageConfigurationService.getLanguageConfiguration(s).brackets,r=this.languageConfigurationService.getLanguageConfiguration(s).bracketsNew}const b=!!o&&!ignoreBracketsInToken(d.getStandardTokenType(f));if(b)_?p=d.getStartOffset(f):(p=d.getStartOffset(f),m=d.getEndOffset(f));else if(r&&o&&_&&p!==m){const v=BracketsUtils.findPrevBracketInRange(o.reversedRegex,c,g,p,m);if(v)return this._toFoundBracket(r,v)}_=b}if(r&&o&&_&&p!==m){const C=BracketsUtils.findPrevBracketInRange(o.reversedRegex,c,g,p,m);if(C)return this._toFoundBracket(r,C)}}return null}findNextBracket(e){var c;const t=this.textModel.validatePosition(e);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),((c=this.bracketPairsTree.value)==null?void 0:c.object.getFirstBracketAfter(t))||null;const s=this.textModel.getLineCount();let o=null,r=null,l=null;for(let d=t.lineNumber;d<=s;d++){const u=this.textModel.tokenization.getLineTokens(d),g=u.getCount(),f=this.textModel.getLineContent(d);let p=0,m=0,_=0;if(d===t.lineNumber){p=u.findTokenIndexAtOffset(t.column-1),m=t.column-1,_=t.column-1;const b=u.getLanguageId(p);o!==b&&(o=b,r=this.languageConfigurationService.getLanguageConfiguration(o).brackets,l=this.languageConfigurationService.getLanguageConfiguration(o).bracketsNew)}let C=!0;for(;p<g;p++){const b=u.getLanguageId(p);if(o!==b){if(l&&r&&C&&m!==_){const S=BracketsUtils.findNextBracketInRange(r.forwardRegex,d,f,m,_);if(S)return this._toFoundBracket(l,S);C=!1}o=b,r=this.languageConfigurationService.getLanguageConfiguration(o).brackets,l=this.languageConfigurationService.getLanguageConfiguration(o).bracketsNew}const v=!!r&&!ignoreBracketsInToken(u.getStandardTokenType(p));if(v)C||(m=u.getStartOffset(p)),_=u.getEndOffset(p);else if(l&&r&&C&&m!==_){const S=BracketsUtils.findNextBracketInRange(r.forwardRegex,d,f,m,_);if(S)return this._toFoundBracket(l,S)}C=v}if(l&&r&&C&&m!==_){const b=BracketsUtils.findNextBracketInRange(r.forwardRegex,d,f,m,_);if(b)return this._toFoundBracket(l,b)}}return null}findEnclosingBrackets(e,t){const s=this.textModel.validatePosition(e);if(this.canBuildAST){const m=Range$2.fromPositions(s),_=this.getBracketPairsInRange(Range$2.fromPositions(s,s)).findLast(C=>C.closingBracketRange!==void 0&&C.range.strictContainsRange(m));return _?[_.openingBracketRange,_.closingBracketRange]:null}const o=createTimeBasedContinueBracketSearchPredicate(t),r=this.textModel.getLineCount(),l=new Map;let c=[];const d=(m,_)=>{if(!l.has(m)){const C=[];for(let b=0,v=_?_.brackets.length:0;b<v;b++)C[b]=0;l.set(m,C)}c=l.get(m)};let u=0;const g=(m,_,C,b,v)=>{for(;;){if(o&&++u%100===0&&!o())return BracketSearchCanceled.INSTANCE;const S=BracketsUtils.findNextBracketInRange(m.forwardRegex,_,C,b,v);if(!S)break;const y=C.substring(S.startColumn-1,S.endColumn-1).toLowerCase(),w=m.textIsBracket[y];if(w&&(w.isOpen(y)?c[w.index]++:w.isClose(y)&&c[w.index]--,c[w.index]===-1))return this._matchFoundBracket(S,w,!1,o);b=S.endColumn-1}return null};let f=null,p=null;for(let m=s.lineNumber;m<=r;m++){const _=this.textModel.tokenization.getLineTokens(m),C=_.getCount(),b=this.textModel.getLineContent(m);let v=0,S=0,y=0;if(m===s.lineNumber){v=_.findTokenIndexAtOffset(s.column-1),S=s.column-1,y=s.column-1;const L=_.getLanguageId(v);f!==L&&(f=L,p=this.languageConfigurationService.getLanguageConfiguration(f).brackets,d(f,p))}let w=!0;for(;v<C;v++){const L=_.getLanguageId(v);if(f!==L){if(p&&w&&S!==y){const E=g(p,m,b,S,y);if(E)return stripBracketSearchCanceled(E);w=!1}f=L,p=this.languageConfigurationService.getLanguageConfiguration(f).brackets,d(f,p)}const x=!!p&&!ignoreBracketsInToken(_.getStandardTokenType(v));if(x)w||(S=_.getStartOffset(v)),y=_.getEndOffset(v);else if(p&&w&&S!==y){const E=g(p,m,b,S,y);if(E)return stripBracketSearchCanceled(E)}w=x}if(p&&w&&S!==y){const L=g(p,m,b,S,y);if(L)return stripBracketSearchCanceled(L)}}return null}_toFoundBracket(e,t){if(!t)return null;let s=this.textModel.getValueInRange(t);s=s.toLowerCase();const o=e.getBracketInfo(s);return o?{range:t,bracketInfo:o}:null}}function createDisposableRef(a,e){return{object:a,dispose:()=>e==null?void 0:e.dispose()}}function createTimeBasedContinueBracketSearchPredicate(a){if(typeof a>"u")return()=>!0;{const e=Date.now();return()=>Date.now()-e<=a}}const ps=class ps{constructor(){this._searchCanceledBrand=void 0}};ps.INSTANCE=new ps;let BracketSearchCanceled=ps;function stripBracketSearchCanceled(a){return a instanceof BracketSearchCanceled?null:a}class ColorizedBracketPairsDecorationProvider extends Disposable{constructor(e){super(),this.textModel=e,this.colorProvider=new ColorProvider,this.onDidChangeEmitter=new Emitter$1,this.onDidChange=this.onDidChangeEmitter.event,this.colorizationOptions=e.getOptions().bracketPairColorizationOptions,this._register(e.bracketPairs.onDidChange(t=>{this.onDidChangeEmitter.fire()}))}handleDidChangeOptions(e){this.colorizationOptions=this.textModel.getOptions().bracketPairColorizationOptions}getDecorationsInRange(e,t,s,o){return o?[]:t===void 0?[]:this.colorizationOptions.enabled?this.textModel.bracketPairs.getBracketsInRange(e,!0).map(l=>({id:`bracket${l.range.toString()}-${l.nestingLevel}`,options:{description:"BracketPairColorization",inlineClassName:this.colorProvider.getInlineClassName(l,this.colorizationOptions.independentColorPoolPerBracketType)},ownerId:0,range:l.range})).toArray():[]}getAllDecorations(e,t){return e===void 0?[]:this.colorizationOptions.enabled?this.getDecorationsInRange(new Range$2(1,1,this.textModel.getLineCount(),1),e,t):[]}}class ColorProvider{constructor(){this.unexpectedClosingBracketClassName="unexpected-closing-bracket"}getInlineClassName(e,t){return e.isInvalid?this.unexpectedClosingBracketClassName:this.getInlineClassNameOfLevel(t?e.nestingLevelOfEqualBracketType:e.nestingLevel)}getInlineClassNameOfLevel(e){return`bracket-highlighting-${e%30}`}}registerThemingParticipant((a,e)=>{const t=[editorBracketHighlightingForeground1,editorBracketHighlightingForeground2,editorBracketHighlightingForeground3,editorBracketHighlightingForeground4,editorBracketHighlightingForeground5,editorBracketHighlightingForeground6],s=new ColorProvider;e.addRule(`.monaco-editor .${s.unexpectedClosingBracketClassName} { color: ${a.getColor(editorBracketHighlightingUnexpectedBracketForeground)}; }`);const o=t.map(r=>a.getColor(r)).filter(r=>!!r).filter(r=>!r.isTransparent());for(let r=0;r<30;r++){const l=o[r%o.length];e.addRule(`.monaco-editor .${s.getInlineClassNameOfLevel(r)} { color: ${l}; }`)}});function escapeNewLine(a){return a.replace(/\n/g,"\\n").replace(/\r/g,"\\r")}class TextChange{get oldLength(){return this.oldText.length}get oldEnd(){return this.oldPosition+this.oldText.length}get newLength(){return this.newText.length}get newEnd(){return this.newPosition+this.newText.length}constructor(e,t,s,o){this.oldPosition=e,this.oldText=t,this.newPosition=s,this.newText=o}toString(){return this.oldText.length===0?`(insert@${this.oldPosition} "${escapeNewLine(this.newText)}")`:this.newText.length===0?`(delete@${this.oldPosition} "${escapeNewLine(this.oldText)}")`:`(replace@${this.oldPosition} "${escapeNewLine(this.oldText)}" with "${escapeNewLine(this.newText)}")`}static _writeStringSize(e){return 4+2*e.length}static _writeString(e,t,s){const o=t.length;writeUInt32BE(e,o,s),s+=4;for(let r=0;r<o;r++)writeUInt16LE(e,t.charCodeAt(r),s),s+=2;return s}static _readString(e,t){const s=readUInt32BE(e,t);return t+=4,decodeUTF16LE(e,t,s)}writeSize(){return 4+4+TextChange._writeStringSize(this.oldText)+TextChange._writeStringSize(this.newText)}write(e,t){return writeUInt32BE(e,this.oldPosition,t),t+=4,writeUInt32BE(e,this.newPosition,t),t+=4,t=TextChange._writeString(e,this.oldText,t),t=TextChange._writeString(e,this.newText,t),t}static read(e,t,s){const o=readUInt32BE(e,t);t+=4;const r=readUInt32BE(e,t);t+=4;const l=TextChange._readString(e,t);t+=TextChange._writeStringSize(l);const c=TextChange._readString(e,t);return t+=TextChange._writeStringSize(c),s.push(new TextChange(o,l,r,c)),t}}function compressConsecutiveTextChanges(a,e){return a===null||a.length===0?e:new TextChangeCompressor(a,e).compress()}class TextChangeCompressor{constructor(e,t){this._prevEdits=e,this._currEdits=t,this._result=[],this._resultLen=0,this._prevLen=this._prevEdits.length,this._prevDeltaOffset=0,this._currLen=this._currEdits.length,this._currDeltaOffset=0}compress(){let e=0,t=0,s=this._getPrev(e),o=this._getCurr(t);for(;e<this._prevLen||t<this._currLen;){if(s===null){this._acceptCurr(o),o=this._getCurr(++t);continue}if(o===null){this._acceptPrev(s),s=this._getPrev(++e);continue}if(o.oldEnd<=s.newPosition){this._acceptCurr(o),o=this._getCurr(++t);continue}if(s.newEnd<=o.oldPosition){this._acceptPrev(s),s=this._getPrev(++e);continue}if(o.oldPosition<s.newPosition){const[u,g]=TextChangeCompressor._splitCurr(o,s.newPosition-o.oldPosition);this._acceptCurr(u),o=g;continue}if(s.newPosition<o.oldPosition){const[u,g]=TextChangeCompressor._splitPrev(s,o.oldPosition-s.newPosition);this._acceptPrev(u),s=g;continue}let c,d;if(o.oldEnd===s.newEnd)c=s,d=o,s=this._getPrev(++e),o=this._getCurr(++t);else if(o.oldEnd<s.newEnd){const[u,g]=TextChangeCompressor._splitPrev(s,o.oldLength);c=u,d=o,s=g,o=this._getCurr(++t)}else{const[u,g]=TextChangeCompressor._splitCurr(o,s.newLength);c=s,d=u,s=this._getPrev(++e),o=g}this._result[this._resultLen++]=new TextChange(c.oldPosition,c.oldText,d.newPosition,d.newText),this._prevDeltaOffset+=c.newLength-c.oldLength,this._currDeltaOffset+=d.newLength-d.oldLength}const r=TextChangeCompressor._merge(this._result);return TextChangeCompressor._removeNoOps(r)}_acceptCurr(e){this._result[this._resultLen++]=TextChangeCompressor._rebaseCurr(this._prevDeltaOffset,e),this._currDeltaOffset+=e.newLength-e.oldLength}_getCurr(e){return e<this._currLen?this._currEdits[e]:null}_acceptPrev(e){this._result[this._resultLen++]=TextChangeCompressor._rebasePrev(this._currDeltaOffset,e),this._prevDeltaOffset+=e.newLength-e.oldLength}_getPrev(e){return e<this._prevLen?this._prevEdits[e]:null}static _rebaseCurr(e,t){return new TextChange(t.oldPosition-e,t.oldText,t.newPosition,t.newText)}static _rebasePrev(e,t){return new TextChange(t.oldPosition,t.oldText,t.newPosition+e,t.newText)}static _splitPrev(e,t){const s=e.newText.substr(0,t),o=e.newText.substr(t);return[new TextChange(e.oldPosition,e.oldText,e.newPosition,s),new TextChange(e.oldEnd,"",e.newPosition+t,o)]}static _splitCurr(e,t){const s=e.oldText.substr(0,t),o=e.oldText.substr(t);return[new TextChange(e.oldPosition,s,e.newPosition,e.newText),new TextChange(e.oldPosition+t,o,e.newEnd,"")]}static _merge(e){if(e.length===0)return e;const t=[];let s=0,o=e[0];for(let r=1;r<e.length;r++){const l=e[r];o.oldEnd===l.oldPosition?o=new TextChange(o.oldPosition,o.oldText+l.oldText,o.newPosition,o.newText+l.newText):(t[s++]=o,o=l)}return t[s++]=o,t}static _removeNoOps(e){if(e.length===0)return e;const t=[];let s=0;for(let o=0;o<e.length;o++){const r=e[o];r.oldText!==r.newText&&(t[s++]=r)}return t}}const privateSymbol=Symbol("TextModelEditSource");class TextModelEditSource{constructor(e,t){this.metadata=e}toString(){return`${this.metadata.source}`}getType(){const e=this.metadata;switch(e.source){case"cursor":return e.kind;case"inlineCompletionAccept":return e.source+(e.$nes?":nes":"");case"unknown":return e.name||"unknown";default:return e.source}}toKey(e,t={}){const s=this.metadata;return Object.entries(s).filter(([r,l])=>{const c=t[r];return c!==void 0?c:(r.match(/\$/g)||[]).length<=e&&l!==void 0&&l!==null&&l!==""}).map(([r,l])=>`${r}:${l}`).join("-")}}function createEditSource(a){return new TextModelEditSource(a,privateSymbol)}const EditSources={unknown(a){return createEditSource({source:"unknown",name:a.name})},rename:()=>createEditSource({source:"rename"}),chatApplyEdits(a){var e,t;return createEditSource({source:"Chat.applyEdits",$modelId:avoidPathRedaction(a.modelId),$extensionId:(e=a.extensionId)==null?void 0:e.extensionId,$extensionVersion:(t=a.extensionId)==null?void 0:t.version,$$languageId:a.languageId,$$sessionId:a.sessionId,$$requestId:a.requestId,$$mode:a.mode,$$codeBlockSuggestionId:a.codeBlockSuggestionId})},chatUndoEdits:()=>createEditSource({source:"Chat.undoEdits"}),chatReset:()=>createEditSource({source:"Chat.reset"}),inlineCompletionAccept(a){return createEditSource({source:"inlineCompletionAccept",$nes:a.nes,...toProperties(a.providerId),$$requestUuid:a.requestUuid,$$languageId:a.languageId})},inlineCompletionPartialAccept(a){return createEditSource({source:"inlineCompletionPartialAccept",type:a.type,$nes:a.nes,...toProperties(a.providerId),$$requestUuid:a.requestUuid,$$languageId:a.languageId})},inlineChatApplyEdit(a){var e,t;return createEditSource({source:"inlineChat.applyEdits",$modelId:avoidPathRedaction(a.modelId),$extensionId:(e=a.extensionId)==null?void 0:e.extensionId,$extensionVersion:(t=a.extensionId)==null?void 0:t.version,$$requestId:a.requestId,$$languageId:a.languageId})},reloadFromDisk:()=>createEditSource({source:"reloadFromDisk"}),cursor(a){return createEditSource({source:"cursor",kind:a.kind,detailedSource:a.detailedSource})},setValue:()=>createEditSource({source:"setValue"}),eolChange:()=>createEditSource({source:"eolChange"}),applyEdits:()=>createEditSource({source:"applyEdits"}),snippet:()=>createEditSource({source:"snippet"}),suggest:a=>createEditSource({source:"suggest",...toProperties(a.providerId)}),codeAction:a=>createEditSource({source:"codeAction",$kind:a.kind,...toProperties(a.providerId)})};function toProperties(a){return a?{$extensionId:a.extensionId,$extensionVersion:a.extensionVersion,$providerId:a.providerId}:{}}function avoidPathRedaction(a){if(a!==void 0)return a.replaceAll("/","|")}class EditDeltaInfo{static fromText(e){const t=TextLength.ofText(e).lineCount,s=e.length;return new EditDeltaInfo(t,0,s,0)}static tryCreate(e,t,s,o){if(!(e===void 0||t===void 0||s===void 0||o===void 0))return new EditDeltaInfo(e,t,s,o)}constructor(e,t,s,o){this.linesAdded=e,this.linesRemoved=t,this.charsAdded=s,this.charsRemoved=o}}var EditSuggestionId;(function(a){function e(){const t=prefixedUuid("sgt");return t}a.newId=e})(EditSuggestionId||(EditSuggestionId={}));function toEditIdentity(a){return a}function uriGetComparisonKey(a){return a.toString()}class SingleModelEditStackData{static create(e,t){const s=e.getAlternativeVersionId(),o=getModelEOL(e);return new SingleModelEditStackData(s,s,o,o,t,t,[])}constructor(e,t,s,o,r,l,c){this.beforeVersionId=e,this.afterVersionId=t,this.beforeEOL=s,this.afterEOL=o,this.beforeCursorState=r,this.afterCursorState=l,this.changes=c}append(e,t,s,o,r){t.length>0&&(this.changes=compressConsecutiveTextChanges(this.changes,t)),this.afterEOL=s,this.afterVersionId=o,this.afterCursorState=r}static _writeSelectionsSize(e){return 4+4*4*(e?e.length:0)}static _writeSelections(e,t,s){if(writeUInt32BE(e,t?t.length:0,s),s+=4,t)for(const o of t)writeUInt32BE(e,o.selectionStartLineNumber,s),s+=4,writeUInt32BE(e,o.selectionStartColumn,s),s+=4,writeUInt32BE(e,o.positionLineNumber,s),s+=4,writeUInt32BE(e,o.positionColumn,s),s+=4;return s}static _readSelections(e,t,s){const o=readUInt32BE(e,t);t+=4;for(let r=0;r<o;r++){const l=readUInt32BE(e,t);t+=4;const c=readUInt32BE(e,t);t+=4;const d=readUInt32BE(e,t);t+=4;const u=readUInt32BE(e,t);t+=4,s.push(new Selection$1(l,c,d,u))}return t}serialize(){let e=10+SingleModelEditStackData._writeSelectionsSize(this.beforeCursorState)+SingleModelEditStackData._writeSelectionsSize(this.afterCursorState)+4;for(const o of this.changes)e+=o.writeSize();const t=new Uint8Array(e);let s=0;writeUInt32BE(t,this.beforeVersionId,s),s+=4,writeUInt32BE(t,this.afterVersionId,s),s+=4,writeUInt8(t,this.beforeEOL,s),s+=1,writeUInt8(t,this.afterEOL,s),s+=1,s=SingleModelEditStackData._writeSelections(t,this.beforeCursorState,s),s=SingleModelEditStackData._writeSelections(t,this.afterCursorState,s),writeUInt32BE(t,this.changes.length,s),s+=4;for(const o of this.changes)s=o.write(t,s);return t.buffer}static deserialize(e){const t=new Uint8Array(e);let s=0;const o=readUInt32BE(t,s);s+=4;const r=readUInt32BE(t,s);s+=4;const l=readUInt8(t,s);s+=1;const c=readUInt8(t,s);s+=1;const d=[];s=SingleModelEditStackData._readSelections(t,s,d);const u=[];s=SingleModelEditStackData._readSelections(t,s,u);const g=readUInt32BE(t,s);s+=4;const f=[];for(let p=0;p<g;p++)s=TextChange.read(t,s,f);return new SingleModelEditStackData(o,r,l,c,d,u,f)}}class SingleModelEditStackElement{get type(){return 0}get resource(){return URI.isUri(this.model)?this.model:this.model.uri}constructor(e,t,s,o){this.label=e,this.code=t,this.model=s,this._data=SingleModelEditStackData.create(s,o)}toString(){return(this._data instanceof SingleModelEditStackData?this._data:SingleModelEditStackData.deserialize(this._data)).changes.map(t=>t.toString()).join(", ")}matchesResource(e){return(URI.isUri(this.model)?this.model:this.model.uri).toString()===e.toString()}setModel(e){this.model=e}canAppend(e){return this.model===e&&this._data instanceof SingleModelEditStackData}append(e,t,s,o,r){this._data instanceof SingleModelEditStackData&&this._data.append(e,t,s,o,r)}close(){this._data instanceof SingleModelEditStackData&&(this._data=this._data.serialize())}open(){this._data instanceof SingleModelEditStackData||(this._data=SingleModelEditStackData.deserialize(this._data))}undo(){if(URI.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof SingleModelEditStackData&&(this._data=this._data.serialize());const e=SingleModelEditStackData.deserialize(this._data);this.model._applyUndo(e.changes,e.beforeEOL,e.beforeVersionId,e.beforeCursorState)}redo(){if(URI.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof SingleModelEditStackData&&(this._data=this._data.serialize());const e=SingleModelEditStackData.deserialize(this._data);this.model._applyRedo(e.changes,e.afterEOL,e.afterVersionId,e.afterCursorState)}heapSize(){return this._data instanceof SingleModelEditStackData&&(this._data=this._data.serialize()),this._data.byteLength+168}}class MultiModelEditStackElement{get resources(){return this._editStackElementsArr.map(e=>e.resource)}constructor(e,t,s){this.label=e,this.code=t,this.type=1,this._isOpen=!0,this._editStackElementsArr=s.slice(0),this._editStackElementsMap=new Map;for(const o of this._editStackElementsArr){const r=uriGetComparisonKey(o.resource);this._editStackElementsMap.set(r,o)}this._delegate=null}prepareUndoRedo(){if(this._delegate)return this._delegate.prepareUndoRedo(this)}matchesResource(e){const t=uriGetComparisonKey(e);return this._editStackElementsMap.has(t)}setModel(e){const t=uriGetComparisonKey(URI.isUri(e)?e:e.uri);this._editStackElementsMap.has(t)&&this._editStackElementsMap.get(t).setModel(e)}canAppend(e){if(!this._isOpen)return!1;const t=uriGetComparisonKey(e.uri);return this._editStackElementsMap.has(t)?this._editStackElementsMap.get(t).canAppend(e):!1}append(e,t,s,o,r){const l=uriGetComparisonKey(e.uri);this._editStackElementsMap.get(l).append(e,t,s,o,r)}close(){this._isOpen=!1}open(){}undo(){this._isOpen=!1;for(const e of this._editStackElementsArr)e.undo()}redo(){for(const e of this._editStackElementsArr)e.redo()}heapSize(e){const t=uriGetComparisonKey(e);return this._editStackElementsMap.has(t)?this._editStackElementsMap.get(t).heapSize():0}split(){return this._editStackElementsArr}toString(){const e=[];for(const t of this._editStackElementsArr)e.push(`${basename(t.resource)}: ${t}`);return`{${e.join(", ")}}`}}function getModelEOL(a){return a.getEOL()===`
`?0:1}function isEditStackElement(a){return a?a instanceof SingleModelEditStackElement||a instanceof MultiModelEditStackElement:!1}class EditStack{constructor(e,t){this._model=e,this._undoRedoService=t}pushStackElement(){const e=this._undoRedoService.getLastElement(this._model.uri);isEditStackElement(e)&&e.close()}popStackElement(){const e=this._undoRedoService.getLastElement(this._model.uri);isEditStackElement(e)&&e.open()}clear(){this._undoRedoService.removeElements(this._model.uri)}_getOrCreateEditStackElement(e,t){const s=this._undoRedoService.getLastElement(this._model.uri);if(isEditStackElement(s)&&s.canAppend(this._model))return s;const o=new SingleModelEditStackElement(localize(781,"Typing"),"undoredo.textBufferEdit",this._model,e);return this._undoRedoService.pushElement(o,t),o}pushEOL(e){const t=this._getOrCreateEditStackElement(null,void 0);this._model.setEOL(e),t.append(this._model,[],getModelEOL(this._model),this._model.getAlternativeVersionId(),null)}pushEditOperation(e,t,s,o,r=EditSources.unknown({name:"pushEditOperation"})){const l=this._getOrCreateEditStackElement(e,o),c=this._model.applyEdits(t,!0,r),d=EditStack._computeCursorState(s,c),u=c.map((g,f)=>({index:f,textChange:g.textChange}));return u.sort((g,f)=>g.textChange.oldPosition===f.textChange.oldPosition?g.index-f.index:g.textChange.oldPosition-f.textChange.oldPosition),l.append(this._model,u.map(g=>g.textChange),getModelEOL(this._model),this._model.getAlternativeVersionId(),d),d}static _computeCursorState(e,t){try{return e?e(t):null}catch(s){return onUnexpectedError(s),null}}}class SpacesDiffResult{constructor(){this.spacesDiff=0,this.looksLikeAlignment=!1}}function spacesDiff(a,e,t,s,o){o.spacesDiff=0,o.looksLikeAlignment=!1;let r;for(r=0;r<e&&r<s;r++){const p=a.charCodeAt(r),m=t.charCodeAt(r);if(p!==m)break}let l=0,c=0;for(let p=r;p<e;p++)a.charCodeAt(p)===32?l++:c++;let d=0,u=0;for(let p=r;p<s;p++)t.charCodeAt(p)===32?d++:u++;if(l>0&&c>0||d>0&&u>0)return;const g=Math.abs(c-u),f=Math.abs(l-d);if(g===0){o.spacesDiff=f,f>0&&0<=d-1&&d-1<a.length&&d<t.length&&t.charCodeAt(d)!==32&&a.charCodeAt(d-1)===32&&a.charCodeAt(a.length-1)===44&&(o.looksLikeAlignment=!0);return}if(f%g===0){o.spacesDiff=f/g;return}}function guessIndentation(a,e,t){const s=Math.min(a.getLineCount(),1e4);let o=0,r=0,l="",c=0;const d=[2,4,6,8,3,5,7],u=8,g=[0,0,0,0,0,0,0,0,0],f=new SpacesDiffResult;for(let _=1;_<=s;_++){const C=a.getLineLength(_),b=a.getLineContent(_),v=C<=65536;let S=!1,y=0,w=0,L=0;for(let E=0,I=C;E<I;E++){const D=v?b.charCodeAt(E):a.getLineCharCode(_,E);if(D===9)L++;else if(D===32)w++;else{S=!0,y=E;break}}if(!S||(L>0?o++:w>1&&r++,spacesDiff(l,c,b,y,f),f.looksLikeAlignment&&!(t&&e===f.spacesDiff)))continue;const x=f.spacesDiff;x<=u&&g[x]++,l=b,c=y}let p=t;o!==r&&(p=o<r);let m=e;if(p){let _=p?0:.1*s;d.forEach(C=>{const b=g[C];b>_&&(_=b,m=C)}),m===4&&g[4]>0&&g[2]>0&&g[2]>=g[4]/2&&(m=2)}return{insertSpaces:p,tabSize:m}}function getNodeColor(a){return(a.metadata&1)>>>0}function setNodeColor(a,e){a.metadata=a.metadata&254|e<<0}function getNodeIsVisited(a){return(a.metadata&2)>>>1===1}function setNodeIsVisited(a,e){a.metadata=a.metadata&253|(e?1:0)<<1}function getNodeIsForValidation(a){return(a.metadata&4)>>>2===1}function setNodeIsForValidation(a,e){a.metadata=a.metadata&251|(e?1:0)<<2}function getNodeIsInGlyphMargin(a){return(a.metadata&64)>>>6===1}function setNodeIsInGlyphMargin(a,e){a.metadata=a.metadata&191|(e?1:0)<<6}function getNodeAffectsFont(a){return(a.metadata&128)>>>7===1}function setNodeAffectsFont(a,e){a.metadata=a.metadata&127|(e?1:0)<<7}function getNodeStickiness(a){return(a.metadata&24)>>>3}function _setNodeStickiness(a,e){a.metadata=a.metadata&231|e<<3}function getCollapseOnReplaceEdit(a){return(a.metadata&32)>>>5===1}function setCollapseOnReplaceEdit(a,e){a.metadata=a.metadata&223|(e?1:0)<<5}class IntervalNode{constructor(e,t,s){this.metadata=0,this.parent=this,this.left=this,this.right=this,setNodeColor(this,1),this.start=t,this.end=s,this.delta=0,this.maxEnd=s,this.id=e,this.ownerId=0,this.options=null,setNodeIsForValidation(this,!1),setNodeIsInGlyphMargin(this,!1),_setNodeStickiness(this,1),setCollapseOnReplaceEdit(this,!1),setNodeAffectsFont(this,!1),this.cachedVersionId=0,this.cachedAbsoluteStart=t,this.cachedAbsoluteEnd=s,this.range=null,setNodeIsVisited(this,!1)}reset(e,t,s,o){this.start=t,this.end=s,this.maxEnd=s,this.cachedVersionId=e,this.cachedAbsoluteStart=t,this.cachedAbsoluteEnd=s,this.range=o}setOptions(e){this.options=e;const t=this.options.className;setNodeIsForValidation(this,t==="squiggly-error"||t==="squiggly-warning"||t==="squiggly-info"),setNodeIsInGlyphMargin(this,this.options.glyphMarginClassName!==null),_setNodeStickiness(this,this.options.stickiness),setCollapseOnReplaceEdit(this,this.options.collapseOnReplaceEdit),setNodeAffectsFont(this,this.options.affectsFont??!1)}setCachedOffsets(e,t,s){this.cachedVersionId!==s&&(this.range=null),this.cachedVersionId=s,this.cachedAbsoluteStart=e,this.cachedAbsoluteEnd=t}detach(){this.parent=null,this.left=null,this.right=null}}const SENTINEL$1=new IntervalNode(null,0,0);SENTINEL$1.parent=SENTINEL$1;SENTINEL$1.left=SENTINEL$1;SENTINEL$1.right=SENTINEL$1;setNodeColor(SENTINEL$1,0);class IntervalTree{constructor(){this.root=SENTINEL$1,this.requestNormalizeDelta=!1}intervalSearch(e,t,s,o,r,l,c){return this.root===SENTINEL$1?[]:intervalSearch(this,e,t,s,o,r,l,c)}search(e,t,s,o,r){return this.root===SENTINEL$1?[]:search(this,e,t,s,o,r)}collectNodesFromOwner(e){return collectNodesFromOwner(this,e)}collectNodesPostOrder(){return collectNodesPostOrder(this)}insert(e){rbTreeInsert(this,e),this._normalizeDeltaIfNecessary()}delete(e){rbTreeDelete(this,e),this._normalizeDeltaIfNecessary()}resolveNode(e,t){const s=e;let o=0;for(;e!==this.root;)e===e.parent.right&&(o+=e.parent.delta),e=e.parent;const r=s.start+o,l=s.end+o;s.setCachedOffsets(r,l,t)}acceptReplace(e,t,s,o){const r=searchForEditing(this,e,e+t);for(let l=0,c=r.length;l<c;l++){const d=r[l];rbTreeDelete(this,d)}this._normalizeDeltaIfNecessary(),noOverlapReplace(this,e,e+t,s),this._normalizeDeltaIfNecessary();for(let l=0,c=r.length;l<c;l++){const d=r[l];d.start=d.cachedAbsoluteStart,d.end=d.cachedAbsoluteEnd,nodeAcceptEdit(d,e,e+t,s,o),d.maxEnd=d.end,rbTreeInsert(this,d)}this._normalizeDeltaIfNecessary()}_normalizeDeltaIfNecessary(){this.requestNormalizeDelta&&(this.requestNormalizeDelta=!1,normalizeDelta(this))}}function normalizeDelta(a){let e=a.root,t=0;for(;e!==SENTINEL$1;){if(e.left!==SENTINEL$1&&!getNodeIsVisited(e.left)){e=e.left;continue}if(e.right!==SENTINEL$1&&!getNodeIsVisited(e.right)){t+=e.delta,e=e.right;continue}e.start=t+e.start,e.end=t+e.end,e.delta=0,recomputeMaxEnd(e),setNodeIsVisited(e,!0),setNodeIsVisited(e.left,!1),setNodeIsVisited(e.right,!1),e===e.parent.right&&(t-=e.parent.delta),e=e.parent}setNodeIsVisited(a.root,!1)}function adjustMarkerBeforeColumn(a,e,t,s){return a<t?!0:a>t||s===1?!1:s===2?!0:e}function nodeAcceptEdit(a,e,t,s,o){const r=getNodeStickiness(a),l=r===0||r===2,c=r===1||r===2,d=t-e,u=s,g=Math.min(d,u),f=a.start;let p=!1;const m=a.end;let _=!1;e<=f&&m<=t&&getCollapseOnReplaceEdit(a)&&(a.start=e,p=!0,a.end=e,_=!0);{const b=o?1:d>0?2:0;!p&&adjustMarkerBeforeColumn(f,l,e,b)&&(p=!0),!_&&adjustMarkerBeforeColumn(m,c,e,b)&&(_=!0)}if(g>0&&!o){const b=d>u?2:0;!p&&adjustMarkerBeforeColumn(f,l,e+g,b)&&(p=!0),!_&&adjustMarkerBeforeColumn(m,c,e+g,b)&&(_=!0)}{const b=o?1:0;!p&&adjustMarkerBeforeColumn(f,l,t,b)&&(a.start=e+u,p=!0),!_&&adjustMarkerBeforeColumn(m,c,t,b)&&(a.end=e+u,_=!0)}const C=u-d;p||(a.start=Math.max(0,f+C)),_||(a.end=Math.max(0,m+C)),a.start>a.end&&(a.end=a.start)}function searchForEditing(a,e,t){let s=a.root,o=0,r=0,l=0,c=0;const d=[];let u=0;for(;s!==SENTINEL$1;){if(getNodeIsVisited(s)){setNodeIsVisited(s.left,!1),setNodeIsVisited(s.right,!1),s===s.parent.right&&(o-=s.parent.delta),s=s.parent;continue}if(!getNodeIsVisited(s.left)){if(r=o+s.maxEnd,r<e){setNodeIsVisited(s,!0);continue}if(s.left!==SENTINEL$1){s=s.left;continue}}if(l=o+s.start,l>t){setNodeIsVisited(s,!0);continue}if(c=o+s.end,c>=e&&(s.setCachedOffsets(l,c,0),d[u++]=s),setNodeIsVisited(s,!0),s.right!==SENTINEL$1&&!getNodeIsVisited(s.right)){o+=s.delta,s=s.right;continue}}return setNodeIsVisited(a.root,!1),d}function noOverlapReplace(a,e,t,s){let o=a.root,r=0,l=0,c=0;const d=s-(t-e);for(;o!==SENTINEL$1;){if(getNodeIsVisited(o)){setNodeIsVisited(o.left,!1),setNodeIsVisited(o.right,!1),o===o.parent.right&&(r-=o.parent.delta),recomputeMaxEnd(o),o=o.parent;continue}if(!getNodeIsVisited(o.left)){if(l=r+o.maxEnd,l<e){setNodeIsVisited(o,!0);continue}if(o.left!==SENTINEL$1){o=o.left;continue}}if(c=r+o.start,c>t){o.start+=d,o.end+=d,o.delta+=d,(o.delta<-1073741824||o.delta>1073741824)&&(a.requestNormalizeDelta=!0),setNodeIsVisited(o,!0);continue}if(setNodeIsVisited(o,!0),o.right!==SENTINEL$1&&!getNodeIsVisited(o.right)){r+=o.delta,o=o.right;continue}}setNodeIsVisited(a.root,!1)}function collectNodesFromOwner(a,e){let t=a.root;const s=[];let o=0;for(;t!==SENTINEL$1;){if(getNodeIsVisited(t)){setNodeIsVisited(t.left,!1),setNodeIsVisited(t.right,!1),t=t.parent;continue}if(t.left!==SENTINEL$1&&!getNodeIsVisited(t.left)){t=t.left;continue}if(t.ownerId===e&&(s[o++]=t),setNodeIsVisited(t,!0),t.right!==SENTINEL$1&&!getNodeIsVisited(t.right)){t=t.right;continue}}return setNodeIsVisited(a.root,!1),s}function collectNodesPostOrder(a){let e=a.root;const t=[];let s=0;for(;e!==SENTINEL$1;){if(getNodeIsVisited(e)){setNodeIsVisited(e.left,!1),setNodeIsVisited(e.right,!1),e=e.parent;continue}if(e.left!==SENTINEL$1&&!getNodeIsVisited(e.left)){e=e.left;continue}if(e.right!==SENTINEL$1&&!getNodeIsVisited(e.right)){e=e.right;continue}t[s++]=e,setNodeIsVisited(e,!0)}return setNodeIsVisited(a.root,!1),t}function search(a,e,t,s,o,r){let l=a.root,c=0,d=0,u=0;const g=[];let f=0;for(;l!==SENTINEL$1;){if(getNodeIsVisited(l)){setNodeIsVisited(l.left,!1),setNodeIsVisited(l.right,!1),l===l.parent.right&&(c-=l.parent.delta),l=l.parent;continue}if(l.left!==SENTINEL$1&&!getNodeIsVisited(l.left)){l=l.left;continue}d=c+l.start,u=c+l.end,l.setCachedOffsets(d,u,o);let p=!0;if(e&&l.ownerId&&l.ownerId!==e&&(p=!1),t&&getNodeIsForValidation(l)&&(p=!1),s&&getNodeAffectsFont(l)&&(p=!1),r&&!getNodeIsInGlyphMargin(l)&&(p=!1),p&&(g[f++]=l),setNodeIsVisited(l,!0),l.right!==SENTINEL$1&&!getNodeIsVisited(l.right)){c+=l.delta,l=l.right;continue}}return setNodeIsVisited(a.root,!1),g}function intervalSearch(a,e,t,s,o,r,l,c){let d=a.root,u=0,g=0,f=0,p=0;const m=[];let _=0;for(;d!==SENTINEL$1;){if(getNodeIsVisited(d)){setNodeIsVisited(d.left,!1),setNodeIsVisited(d.right,!1),d===d.parent.right&&(u-=d.parent.delta),d=d.parent;continue}if(!getNodeIsVisited(d.left)){if(g=u+d.maxEnd,g<e){setNodeIsVisited(d,!0);continue}if(d.left!==SENTINEL$1){d=d.left;continue}}if(f=u+d.start,f>t){setNodeIsVisited(d,!0);continue}if(p=u+d.end,p>=e){d.setCachedOffsets(f,p,l);let C=!0;s&&d.ownerId&&d.ownerId!==s&&(C=!1),o&&getNodeIsForValidation(d)&&(C=!1),r&&getNodeAffectsFont(d)&&(C=!1),c&&!getNodeIsInGlyphMargin(d)&&(C=!1),C&&(m[_++]=d)}if(setNodeIsVisited(d,!0),d.right!==SENTINEL$1&&!getNodeIsVisited(d.right)){u+=d.delta,d=d.right;continue}}return setNodeIsVisited(a.root,!1),m}function rbTreeInsert(a,e){if(a.root===SENTINEL$1)return e.parent=SENTINEL$1,e.left=SENTINEL$1,e.right=SENTINEL$1,setNodeColor(e,0),a.root=e,a.root;treeInsert(a,e),recomputeMaxEndWalkToRoot(e.parent);let t=e;for(;t!==a.root&&getNodeColor(t.parent)===1;)if(t.parent===t.parent.parent.left){const s=t.parent.parent.right;getNodeColor(s)===1?(setNodeColor(t.parent,0),setNodeColor(s,0),setNodeColor(t.parent.parent,1),t=t.parent.parent):(t===t.parent.right&&(t=t.parent,leftRotate$1(a,t)),setNodeColor(t.parent,0),setNodeColor(t.parent.parent,1),rightRotate$1(a,t.parent.parent))}else{const s=t.parent.parent.left;getNodeColor(s)===1?(setNodeColor(t.parent,0),setNodeColor(s,0),setNodeColor(t.parent.parent,1),t=t.parent.parent):(t===t.parent.left&&(t=t.parent,rightRotate$1(a,t)),setNodeColor(t.parent,0),setNodeColor(t.parent.parent,1),leftRotate$1(a,t.parent.parent))}return setNodeColor(a.root,0),e}function treeInsert(a,e){let t=0,s=a.root;const o=e.start,r=e.end;for(;;)if(intervalCompare(o,r,s.start+t,s.end+t)<0)if(s.left===SENTINEL$1){e.start-=t,e.end-=t,e.maxEnd-=t,s.left=e;break}else s=s.left;else if(s.right===SENTINEL$1){e.start-=t+s.delta,e.end-=t+s.delta,e.maxEnd-=t+s.delta,s.right=e;break}else t+=s.delta,s=s.right;e.parent=s,e.left=SENTINEL$1,e.right=SENTINEL$1,setNodeColor(e,1)}function rbTreeDelete(a,e){let t,s;if(e.left===SENTINEL$1?(t=e.right,s=e,t.delta+=e.delta,(t.delta<-1073741824||t.delta>1073741824)&&(a.requestNormalizeDelta=!0),t.start+=e.delta,t.end+=e.delta):e.right===SENTINEL$1?(t=e.left,s=e):(s=leftest$1(e.right),t=s.right,t.start+=s.delta,t.end+=s.delta,t.delta+=s.delta,(t.delta<-1073741824||t.delta>1073741824)&&(a.requestNormalizeDelta=!0),s.start+=e.delta,s.end+=e.delta,s.delta=e.delta,(s.delta<-1073741824||s.delta>1073741824)&&(a.requestNormalizeDelta=!0)),s===a.root){a.root=t,setNodeColor(t,0),e.detach(),resetSentinel$1(),recomputeMaxEnd(t),a.root.parent=SENTINEL$1;return}const o=getNodeColor(s)===1;if(s===s.parent.left?s.parent.left=t:s.parent.right=t,s===e?t.parent=s.parent:(s.parent===e?t.parent=s:t.parent=s.parent,s.left=e.left,s.right=e.right,s.parent=e.parent,setNodeColor(s,getNodeColor(e)),e===a.root?a.root=s:e===e.parent.left?e.parent.left=s:e.parent.right=s,s.left!==SENTINEL$1&&(s.left.parent=s),s.right!==SENTINEL$1&&(s.right.parent=s)),e.detach(),o){recomputeMaxEndWalkToRoot(t.parent),s!==e&&(recomputeMaxEndWalkToRoot(s),recomputeMaxEndWalkToRoot(s.parent)),resetSentinel$1();return}recomputeMaxEndWalkToRoot(t),recomputeMaxEndWalkToRoot(t.parent),s!==e&&(recomputeMaxEndWalkToRoot(s),recomputeMaxEndWalkToRoot(s.parent));let r;for(;t!==a.root&&getNodeColor(t)===0;)t===t.parent.left?(r=t.parent.right,getNodeColor(r)===1&&(setNodeColor(r,0),setNodeColor(t.parent,1),leftRotate$1(a,t.parent),r=t.parent.right),getNodeColor(r.left)===0&&getNodeColor(r.right)===0?(setNodeColor(r,1),t=t.parent):(getNodeColor(r.right)===0&&(setNodeColor(r.left,0),setNodeColor(r,1),rightRotate$1(a,r),r=t.parent.right),setNodeColor(r,getNodeColor(t.parent)),setNodeColor(t.parent,0),setNodeColor(r.right,0),leftRotate$1(a,t.parent),t=a.root)):(r=t.parent.left,getNodeColor(r)===1&&(setNodeColor(r,0),setNodeColor(t.parent,1),rightRotate$1(a,t.parent),r=t.parent.left),getNodeColor(r.left)===0&&getNodeColor(r.right)===0?(setNodeColor(r,1),t=t.parent):(getNodeColor(r.left)===0&&(setNodeColor(r.right,0),setNodeColor(r,1),leftRotate$1(a,r),r=t.parent.left),setNodeColor(r,getNodeColor(t.parent)),setNodeColor(t.parent,0),setNodeColor(r.left,0),rightRotate$1(a,t.parent),t=a.root));setNodeColor(t,0),resetSentinel$1()}function leftest$1(a){for(;a.left!==SENTINEL$1;)a=a.left;return a}function resetSentinel$1(){SENTINEL$1.parent=SENTINEL$1,SENTINEL$1.delta=0,SENTINEL$1.start=0,SENTINEL$1.end=0}function leftRotate$1(a,e){const t=e.right;t.delta+=e.delta,(t.delta<-1073741824||t.delta>1073741824)&&(a.requestNormalizeDelta=!0),t.start+=e.delta,t.end+=e.delta,e.right=t.left,t.left!==SENTINEL$1&&(t.left.parent=e),t.parent=e.parent,e.parent===SENTINEL$1?a.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,recomputeMaxEnd(e),recomputeMaxEnd(t)}function rightRotate$1(a,e){const t=e.left;e.delta-=t.delta,(e.delta<-1073741824||e.delta>1073741824)&&(a.requestNormalizeDelta=!0),e.start-=t.delta,e.end-=t.delta,e.left=t.right,t.right!==SENTINEL$1&&(t.right.parent=e),t.parent=e.parent,e.parent===SENTINEL$1?a.root=t:e===e.parent.right?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t,recomputeMaxEnd(e),recomputeMaxEnd(t)}function computeMaxEnd(a){let e=a.end;if(a.left!==SENTINEL$1){const t=a.left.maxEnd;t>e&&(e=t)}if(a.right!==SENTINEL$1){const t=a.right.maxEnd+a.delta;t>e&&(e=t)}return e}function recomputeMaxEnd(a){a.maxEnd=computeMaxEnd(a)}function recomputeMaxEndWalkToRoot(a){for(;a!==SENTINEL$1;){const e=computeMaxEnd(a);if(a.maxEnd===e)return;a.maxEnd=e,a=a.parent}}function intervalCompare(a,e,t,s){return a===t?e-s:a-t}class TreeNode{constructor(e,t){this.piece=e,this.color=t,this.size_left=0,this.lf_left=0,this.parent=this,this.left=this,this.right=this}next(){if(this.right!==SENTINEL)return leftest(this.right);let e=this;for(;e.parent!==SENTINEL&&e.parent.left!==e;)e=e.parent;return e.parent===SENTINEL?SENTINEL:e.parent}prev(){if(this.left!==SENTINEL)return righttest(this.left);let e=this;for(;e.parent!==SENTINEL&&e.parent.right!==e;)e=e.parent;return e.parent===SENTINEL?SENTINEL:e.parent}detach(){this.parent=null,this.left=null,this.right=null}}const SENTINEL=new TreeNode(null,0);SENTINEL.parent=SENTINEL;SENTINEL.left=SENTINEL;SENTINEL.right=SENTINEL;SENTINEL.color=0;function leftest(a){for(;a.left!==SENTINEL;)a=a.left;return a}function righttest(a){for(;a.right!==SENTINEL;)a=a.right;return a}function calculateSize(a){return a===SENTINEL?0:a.size_left+a.piece.length+calculateSize(a.right)}function calculateLF(a){return a===SENTINEL?0:a.lf_left+a.piece.lineFeedCnt+calculateLF(a.right)}function resetSentinel(){SENTINEL.parent=SENTINEL}function leftRotate(a,e){const t=e.right;t.size_left+=e.size_left+(e.piece?e.piece.length:0),t.lf_left+=e.lf_left+(e.piece?e.piece.lineFeedCnt:0),e.right=t.left,t.left!==SENTINEL&&(t.left.parent=e),t.parent=e.parent,e.parent===SENTINEL?a.root=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}function rightRotate(a,e){const t=e.left;e.left=t.right,t.right!==SENTINEL&&(t.right.parent=e),t.parent=e.parent,e.size_left-=t.size_left+(t.piece?t.piece.length:0),e.lf_left-=t.lf_left+(t.piece?t.piece.lineFeedCnt:0),e.parent===SENTINEL?a.root=t:e===e.parent.right?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}function rbDelete(a,e){let t,s;if(e.left===SENTINEL?(s=e,t=s.right):e.right===SENTINEL?(s=e,t=s.left):(s=leftest(e.right),t=s.right),s===a.root){a.root=t,t.color=0,e.detach(),resetSentinel(),a.root.parent=SENTINEL;return}const o=s.color===1;if(s===s.parent.left?s.parent.left=t:s.parent.right=t,s===e?(t.parent=s.parent,recomputeTreeMetadata(a,t)):(s.parent===e?t.parent=s:t.parent=s.parent,recomputeTreeMetadata(a,t),s.left=e.left,s.right=e.right,s.parent=e.parent,s.color=e.color,e===a.root?a.root=s:e===e.parent.left?e.parent.left=s:e.parent.right=s,s.left!==SENTINEL&&(s.left.parent=s),s.right!==SENTINEL&&(s.right.parent=s),s.size_left=e.size_left,s.lf_left=e.lf_left,recomputeTreeMetadata(a,s)),e.detach(),t.parent.left===t){const l=calculateSize(t),c=calculateLF(t);if(l!==t.parent.size_left||c!==t.parent.lf_left){const d=l-t.parent.size_left,u=c-t.parent.lf_left;t.parent.size_left=l,t.parent.lf_left=c,updateTreeMetadata(a,t.parent,d,u)}}if(recomputeTreeMetadata(a,t.parent),o){resetSentinel();return}let r;for(;t!==a.root&&t.color===0;)t===t.parent.left?(r=t.parent.right,r.color===1&&(r.color=0,t.parent.color=1,leftRotate(a,t.parent),r=t.parent.right),r.left.color===0&&r.right.color===0?(r.color=1,t=t.parent):(r.right.color===0&&(r.left.color=0,r.color=1,rightRotate(a,r),r=t.parent.right),r.color=t.parent.color,t.parent.color=0,r.right.color=0,leftRotate(a,t.parent),t=a.root)):(r=t.parent.left,r.color===1&&(r.color=0,t.parent.color=1,rightRotate(a,t.parent),r=t.parent.left),r.left.color===0&&r.right.color===0?(r.color=1,t=t.parent):(r.left.color===0&&(r.right.color=0,r.color=1,leftRotate(a,r),r=t.parent.left),r.color=t.parent.color,t.parent.color=0,r.left.color=0,rightRotate(a,t.parent),t=a.root));t.color=0,resetSentinel()}function fixInsert(a,e){for(recomputeTreeMetadata(a,e);e!==a.root&&e.parent.color===1;)if(e.parent===e.parent.parent.left){const t=e.parent.parent.right;t.color===1?(e.parent.color=0,t.color=0,e.parent.parent.color=1,e=e.parent.parent):(e===e.parent.right&&(e=e.parent,leftRotate(a,e)),e.parent.color=0,e.parent.parent.color=1,rightRotate(a,e.parent.parent))}else{const t=e.parent.parent.left;t.color===1?(e.parent.color=0,t.color=0,e.parent.parent.color=1,e=e.parent.parent):(e===e.parent.left&&(e=e.parent,rightRotate(a,e)),e.parent.color=0,e.parent.parent.color=1,leftRotate(a,e.parent.parent))}a.root.color=0}function updateTreeMetadata(a,e,t,s){for(;e!==a.root&&e!==SENTINEL;)e.parent.left===e&&(e.parent.size_left+=t,e.parent.lf_left+=s),e=e.parent}function recomputeTreeMetadata(a,e){let t=0,s=0;if(e!==a.root){for(;e!==a.root&&e===e.parent.right;)e=e.parent;if(e!==a.root)for(e=e.parent,t=calculateSize(e.left)-e.size_left,s=calculateLF(e.left)-e.lf_left,e.size_left+=t,e.lf_left+=s;e!==a.root&&(t!==0||s!==0);)e.parent.left===e&&(e.parent.size_left+=t,e.parent.lf_left+=s),e=e.parent}}const LIMIT_FIND_COUNT$1=999;class SearchParams{constructor(e,t,s,o){this.searchString=e,this.isRegex=t,this.matchCase=s,this.wordSeparators=o}parseSearchRequest(){if(this.searchString==="")return null;let e;this.isRegex?e=isMultilineRegexSource(this.searchString):e=this.searchString.indexOf(`
`)>=0;let t=null;try{t=createRegExp(this.searchString,this.isRegex,{matchCase:this.matchCase,wholeWord:!1,multiline:e,global:!0,unicode:!0})}catch{return null}if(!t)return null;let s=!this.isRegex&&!e;return s&&this.searchString.toLowerCase()!==this.searchString.toUpperCase()&&(s=this.matchCase),new SearchData(t,this.wordSeparators?getMapForWordSeparators(this.wordSeparators,[]):null,s?this.searchString:null)}}function isMultilineRegexSource(a){if(!a||a.length===0)return!1;for(let e=0,t=a.length;e<t;e++){const s=a.charCodeAt(e);if(s===10)return!0;if(s===92){if(e++,e>=t)break;const o=a.charCodeAt(e);if(o===110||o===114||o===87)return!0}}return!1}function createFindMatch(a,e,t){if(!t)return new FindMatch(a,null);const s=[];for(let o=0,r=e.length;o<r;o++)s[o]=e[o];return new FindMatch(a,s)}class LineFeedCounter{constructor(e){const t=[];let s=0;for(let o=0,r=e.length;o<r;o++)e.charCodeAt(o)===10&&(t[s++]=o);this._lineFeedsOffsets=t}findLineFeedCountBeforeOffset(e){const t=this._lineFeedsOffsets;let s=0,o=t.length-1;if(o===-1||e<=t[0])return 0;for(;s<o;){const r=s+((o-s)/2>>0);t[r]>=e?o=r-1:t[r+1]>=e?(s=r,o=r):s=r+1}return s+1}}class TextModelSearch{static findMatches(e,t,s,o,r){const l=t.parseSearchRequest();return l?l.regex.multiline?this._doFindMatchesMultiline(e,s,new Searcher(l.wordSeparators,l.regex),o,r):this._doFindMatchesLineByLine(e,s,l,o,r):[]}static _getMultilineMatchRange(e,t,s,o,r,l){let c,d=0;o?(d=o.findLineFeedCountBeforeOffset(r),c=t+r+d):c=t+r;let u;if(o){const m=o.findLineFeedCountBeforeOffset(r+l.length)-d;u=c+l.length+m}else u=c+l.length;const g=e.getPositionAt(c),f=e.getPositionAt(u);return new Range$2(g.lineNumber,g.column,f.lineNumber,f.column)}static _doFindMatchesMultiline(e,t,s,o,r){const l=e.getOffsetAt(t.getStartPosition()),c=e.getValueInRange(t,1),d=e.getEOL()===`\r
`?new LineFeedCounter(c):null,u=[];let g=0,f;for(s.reset(0);f=s.next(c);)if(u[g++]=createFindMatch(this._getMultilineMatchRange(e,l,c,d,f.index,f[0]),f,o),g>=r)return u;return u}static _doFindMatchesLineByLine(e,t,s,o,r){const l=[];let c=0;if(t.startLineNumber===t.endLineNumber){const u=e.getLineContent(t.startLineNumber).substring(t.startColumn-1,t.endColumn-1);return c=this._findMatchesInLine(s,u,t.startLineNumber,t.startColumn-1,c,l,o,r),l}const d=e.getLineContent(t.startLineNumber).substring(t.startColumn-1);c=this._findMatchesInLine(s,d,t.startLineNumber,t.startColumn-1,c,l,o,r);for(let u=t.startLineNumber+1;u<t.endLineNumber&&c<r;u++)c=this._findMatchesInLine(s,e.getLineContent(u),u,0,c,l,o,r);if(c<r){const u=e.getLineContent(t.endLineNumber).substring(0,t.endColumn-1);c=this._findMatchesInLine(s,u,t.endLineNumber,0,c,l,o,r)}return l}static _findMatchesInLine(e,t,s,o,r,l,c,d){const u=e.wordSeparators;if(!c&&e.simpleSearch){const p=e.simpleSearch,m=p.length,_=t.length;let C=-m;for(;(C=t.indexOf(p,C+m))!==-1;)if((!u||isValidMatch(u,t,_,C,m))&&(l[r++]=new FindMatch(new Range$2(s,C+1+o,s,C+1+m+o),null),r>=d))return r;return r}const g=new Searcher(e.wordSeparators,e.regex);let f;g.reset(0);do if(f=g.next(t),f&&(l[r++]=createFindMatch(new Range$2(s,f.index+1+o,s,f.index+1+f[0].length+o),f,c),r>=d))return r;while(f);return r}static findNextMatch(e,t,s,o){const r=t.parseSearchRequest();if(!r)return null;const l=new Searcher(r.wordSeparators,r.regex);return r.regex.multiline?this._doFindNextMatchMultiline(e,s,l,o):this._doFindNextMatchLineByLine(e,s,l,o)}static _doFindNextMatchMultiline(e,t,s,o){const r=new Position$1(t.lineNumber,1),l=e.getOffsetAt(r),c=e.getLineCount(),d=e.getValueInRange(new Range$2(r.lineNumber,r.column,c,e.getLineMaxColumn(c)),1),u=e.getEOL()===`\r
`?new LineFeedCounter(d):null;s.reset(t.column-1);const g=s.next(d);return g?createFindMatch(this._getMultilineMatchRange(e,l,d,u,g.index,g[0]),g,o):t.lineNumber!==1||t.column!==1?this._doFindNextMatchMultiline(e,new Position$1(1,1),s,o):null}static _doFindNextMatchLineByLine(e,t,s,o){const r=e.getLineCount(),l=t.lineNumber,c=e.getLineContent(l),d=this._findFirstMatchInLine(s,c,l,t.column,o);if(d)return d;for(let u=1;u<=r;u++){const g=(l+u-1)%r,f=e.getLineContent(g+1),p=this._findFirstMatchInLine(s,f,g+1,1,o);if(p)return p}return null}static _findFirstMatchInLine(e,t,s,o,r){e.reset(o-1);const l=e.next(t);return l?createFindMatch(new Range$2(s,l.index+1,s,l.index+1+l[0].length),l,r):null}static findPreviousMatch(e,t,s,o){const r=t.parseSearchRequest();if(!r)return null;const l=new Searcher(r.wordSeparators,r.regex);return r.regex.multiline?this._doFindPreviousMatchMultiline(e,s,l,o):this._doFindPreviousMatchLineByLine(e,s,l,o)}static _doFindPreviousMatchMultiline(e,t,s,o){const r=this._doFindMatchesMultiline(e,new Range$2(1,1,t.lineNumber,t.column),s,o,10*LIMIT_FIND_COUNT$1);if(r.length>0)return r[r.length-1];const l=e.getLineCount();return t.lineNumber!==l||t.column!==e.getLineMaxColumn(l)?this._doFindPreviousMatchMultiline(e,new Position$1(l,e.getLineMaxColumn(l)),s,o):null}static _doFindPreviousMatchLineByLine(e,t,s,o){const r=e.getLineCount(),l=t.lineNumber,c=e.getLineContent(l).substring(0,t.column-1),d=this._findLastMatchInLine(s,c,l,o);if(d)return d;for(let u=1;u<=r;u++){const g=(r+l-u-1)%r,f=e.getLineContent(g+1),p=this._findLastMatchInLine(s,f,g+1,o);if(p)return p}return null}static _findLastMatchInLine(e,t,s,o){let r=null,l;for(e.reset(0);l=e.next(t);)r=createFindMatch(new Range$2(s,l.index+1,s,l.index+1+l[0].length),l,o);return r}}function leftIsWordBounday(a,e,t,s,o){if(s===0)return!0;const r=e.charCodeAt(s-1);if(a.get(r)!==0||r===13||r===10)return!0;if(o>0){const l=e.charCodeAt(s);if(a.get(l)!==0)return!0}return!1}function rightIsWordBounday(a,e,t,s,o){if(s+o===t)return!0;const r=e.charCodeAt(s+o);if(a.get(r)!==0||r===13||r===10)return!0;if(o>0){const l=e.charCodeAt(s+o-1);if(a.get(l)!==0)return!0}return!1}function isValidMatch(a,e,t,s,o){return leftIsWordBounday(a,e,t,s,o)&&rightIsWordBounday(a,e,t,s,o)}class Searcher{constructor(e,t){this._wordSeparators=e,this._searchRegex=t,this._prevMatchStartIndex=-1,this._prevMatchLength=0}reset(e){this._searchRegex.lastIndex=e,this._prevMatchStartIndex=-1,this._prevMatchLength=0}next(e){const t=e.length;let s;do{if(this._prevMatchStartIndex+this._prevMatchLength===t||(s=this._searchRegex.exec(e),!s))return null;const o=s.index,r=s[0].length;if(o===this._prevMatchStartIndex&&r===this._prevMatchLength){if(r===0){getNextCodePoint(e,t,this._searchRegex.lastIndex)>65535?this._searchRegex.lastIndex+=2:this._searchRegex.lastIndex+=1;continue}return null}if(this._prevMatchStartIndex=o,this._prevMatchLength=r,!this._wordSeparators||isValidMatch(this._wordSeparators,e,t,o,r))return s}while(s);return null}}const AverageBufferSize=65535;function createUintArray(a){let e;return a[a.length-1]<65536?e=new Uint16Array(a.length):e=new Uint32Array(a.length),e.set(a,0),e}class LineStarts{constructor(e,t,s,o,r){this.lineStarts=e,this.cr=t,this.lf=s,this.crlf=o,this.isBasicASCII=r}}function createLineStartsFast(a,e=!0){const t=[0];let s=1;for(let o=0,r=a.length;o<r;o++){const l=a.charCodeAt(o);l===13?o+1<r&&a.charCodeAt(o+1)===10?(t[s++]=o+2,o++):t[s++]=o+1:l===10&&(t[s++]=o+1)}return e?createUintArray(t):t}function createLineStarts(a,e){a.length=0,a[0]=0;let t=1,s=0,o=0,r=0,l=!0;for(let d=0,u=e.length;d<u;d++){const g=e.charCodeAt(d);g===13?d+1<u&&e.charCodeAt(d+1)===10?(r++,a[t++]=d+2,d++):(s++,a[t++]=d+1):g===10?(o++,a[t++]=d+1):l&&g!==9&&(g<32||g>126)&&(l=!1)}const c=new LineStarts(createUintArray(a),s,o,r,l);return a.length=0,c}class Piece{constructor(e,t,s,o,r){this.bufferIndex=e,this.start=t,this.end=s,this.lineFeedCnt=o,this.length=r}}class StringBuffer{constructor(e,t){this.buffer=e,this.lineStarts=t}}class PieceTreeSnapshot{constructor(e,t){this._pieces=[],this._tree=e,this._BOM=t,this._index=0,e.root!==SENTINEL&&e.iterate(e.root,s=>(s!==SENTINEL&&this._pieces.push(s.piece),!0))}read(){return this._pieces.length===0?this._index===0?(this._index++,this._BOM):null:this._index>this._pieces.length-1?null:this._index===0?this._BOM+this._tree.getPieceContent(this._pieces[this._index++]):this._tree.getPieceContent(this._pieces[this._index++])}}class PieceTreeSearchCache{constructor(e){this._limit=e,this._cache=[]}get(e){for(let t=this._cache.length-1;t>=0;t--){const s=this._cache[t];if(s.nodeStartOffset<=e&&s.nodeStartOffset+s.node.piece.length>=e)return s}return null}get2(e){for(let t=this._cache.length-1;t>=0;t--){const s=this._cache[t];if(s.nodeStartLineNumber&&s.nodeStartLineNumber<e&&s.nodeStartLineNumber+s.node.piece.lineFeedCnt>=e)return s}return null}set(e){this._cache.length>=this._limit&&this._cache.shift(),this._cache.push(e)}validate(e){let t=!1;const s=this._cache;for(let o=0;o<s.length;o++){const r=s[o];if(r.node.parent===null||r.nodeStartOffset>=e){s[o]=null,t=!0;continue}}if(t){const o=[];for(const r of s)r!==null&&o.push(r);this._cache=o}}}class PieceTreeBase{constructor(e,t,s){this.create(e,t,s)}create(e,t,s){this._buffers=[new StringBuffer("",[0])],this._lastChangeBufferPos={line:0,column:0},this.root=SENTINEL,this._lineCnt=1,this._length=0,this._EOL=t,this._EOLLength=t.length,this._EOLNormalized=s;let o=null;for(let r=0,l=e.length;r<l;r++)if(e[r].buffer.length>0){e[r].lineStarts||(e[r].lineStarts=createLineStartsFast(e[r].buffer));const c=new Piece(r+1,{line:0,column:0},{line:e[r].lineStarts.length-1,column:e[r].buffer.length-e[r].lineStarts[e[r].lineStarts.length-1]},e[r].lineStarts.length-1,e[r].buffer.length);this._buffers.push(e[r]),o=this.rbInsertRight(o,c)}this._searchCache=new PieceTreeSearchCache(1),this._lastVisitedLine={lineNumber:0,value:""},this.computeBufferMetadata()}normalizeEOL(e){const t=AverageBufferSize,s=t-Math.floor(t/3),o=s*2;let r="",l=0;const c=[];if(this.iterate(this.root,d=>{const u=this.getNodeContent(d),g=u.length;if(l<=s||l+g<o)return r+=u,l+=g,!0;const f=r.replace(/\r\n|\r|\n/g,e);return c.push(new StringBuffer(f,createLineStartsFast(f))),r=u,l=g,!0}),l>0){const d=r.replace(/\r\n|\r|\n/g,e);c.push(new StringBuffer(d,createLineStartsFast(d)))}this.create(c,e,!0)}getEOL(){return this._EOL}setEOL(e){this._EOL=e,this._EOLLength=this._EOL.length,this.normalizeEOL(e)}createSnapshot(e){return new PieceTreeSnapshot(this,e)}getOffsetAt(e,t){let s=0,o=this.root;for(;o!==SENTINEL;)if(o.left!==SENTINEL&&o.lf_left+1>=e)o=o.left;else if(o.lf_left+o.piece.lineFeedCnt+1>=e){s+=o.size_left;const r=this.getAccumulatedValue(o,e-o.lf_left-2);return s+=r+t-1}else e-=o.lf_left+o.piece.lineFeedCnt,s+=o.size_left+o.piece.length,o=o.right;return s}getPositionAt(e){e=Math.floor(e),e=Math.max(0,e);let t=this.root,s=0;const o=e;for(;t!==SENTINEL;)if(t.size_left!==0&&t.size_left>=e)t=t.left;else if(t.size_left+t.piece.length>=e){const r=this.getIndexOf(t,e-t.size_left);if(s+=t.lf_left+r.index,r.index===0){const l=this.getOffsetAt(s+1,1),c=o-l;return new Position$1(s+1,c+1)}return new Position$1(s+1,r.remainder+1)}else if(e-=t.size_left+t.piece.length,s+=t.lf_left+t.piece.lineFeedCnt,t.right===SENTINEL){const r=this.getOffsetAt(s+1,1),l=o-e-r;return new Position$1(s+1,l+1)}else t=t.right;return new Position$1(1,1)}getValueInRange(e,t){if(e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn)return"";const s=this.nodeAt2(e.startLineNumber,e.startColumn),o=this.nodeAt2(e.endLineNumber,e.endColumn),r=this.getValueInRange2(s,o);return t?t!==this._EOL||!this._EOLNormalized?r.replace(/\r\n|\r|\n/g,t):t===this.getEOL()&&this._EOLNormalized?r:r.replace(/\r\n|\r|\n/g,t):r}getValueInRange2(e,t){if(e.node===t.node){const c=e.node,d=this._buffers[c.piece.bufferIndex].buffer,u=this.offsetInBuffer(c.piece.bufferIndex,c.piece.start);return d.substring(u+e.remainder,u+t.remainder)}let s=e.node;const o=this._buffers[s.piece.bufferIndex].buffer,r=this.offsetInBuffer(s.piece.bufferIndex,s.piece.start);let l=o.substring(r+e.remainder,r+s.piece.length);for(s=s.next();s!==SENTINEL;){const c=this._buffers[s.piece.bufferIndex].buffer,d=this.offsetInBuffer(s.piece.bufferIndex,s.piece.start);if(s===t.node){l+=c.substring(d,d+t.remainder);break}else l+=c.substr(d,s.piece.length);s=s.next()}return l}getLinesContent(){const e=[];let t=0,s="",o=!1;return this.iterate(this.root,r=>{if(r===SENTINEL)return!0;const l=r.piece;let c=l.length;if(c===0)return!0;const d=this._buffers[l.bufferIndex].buffer,u=this._buffers[l.bufferIndex].lineStarts,g=l.start.line,f=l.end.line;let p=u[g]+l.start.column;if(o&&(d.charCodeAt(p)===10&&(p++,c--),e[t++]=s,s="",o=!1,c===0))return!0;if(g===f)return!this._EOLNormalized&&d.charCodeAt(p+c-1)===13?(o=!0,s+=d.substr(p,c-1)):s+=d.substr(p,c),!0;s+=this._EOLNormalized?d.substring(p,Math.max(p,u[g+1]-this._EOLLength)):d.substring(p,u[g+1]).replace(/(\r\n|\r|\n)$/,""),e[t++]=s;for(let m=g+1;m<f;m++)s=this._EOLNormalized?d.substring(u[m],u[m+1]-this._EOLLength):d.substring(u[m],u[m+1]).replace(/(\r\n|\r|\n)$/,""),e[t++]=s;return!this._EOLNormalized&&d.charCodeAt(u[f]+l.end.column-1)===13?(o=!0,l.end.column===0?t--:s=d.substr(u[f],l.end.column-1)):s=d.substr(u[f],l.end.column),!0}),o&&(e[t++]=s,s=""),e[t++]=s,e}getLength(){return this._length}getLineCount(){return this._lineCnt}getLineContent(e){return this._lastVisitedLine.lineNumber===e?this._lastVisitedLine.value:(this._lastVisitedLine.lineNumber=e,e===this._lineCnt?this._lastVisitedLine.value=this.getLineRawContent(e):this._EOLNormalized?this._lastVisitedLine.value=this.getLineRawContent(e,this._EOLLength):this._lastVisitedLine.value=this.getLineRawContent(e).replace(/(\r\n|\r|\n)$/,""),this._lastVisitedLine.value)}_getCharCode(e){if(e.remainder===e.node.piece.length){const t=e.node.next();if(!t)return 0;const s=this._buffers[t.piece.bufferIndex],o=this.offsetInBuffer(t.piece.bufferIndex,t.piece.start);return s.buffer.charCodeAt(o)}else{const t=this._buffers[e.node.piece.bufferIndex],o=this.offsetInBuffer(e.node.piece.bufferIndex,e.node.piece.start)+e.remainder;return t.buffer.charCodeAt(o)}}getLineCharCode(e,t){const s=this.nodeAt2(e,t+1);return this._getCharCode(s)}getLineLength(e){if(e===this.getLineCount()){const t=this.getOffsetAt(e,1);return this.getLength()-t}return this.getOffsetAt(e+1,1)-this.getOffsetAt(e,1)-this._EOLLength}getNearestChunk(e){const t=this.nodeAt(e);if(t.remainder===t.node.piece.length){const s=t.node.next();if(!s||s===SENTINEL)return"";const o=this._buffers[s.piece.bufferIndex],r=this.offsetInBuffer(s.piece.bufferIndex,s.piece.start);return o.buffer.substring(r,r+s.piece.length)}else{const s=this._buffers[t.node.piece.bufferIndex],o=this.offsetInBuffer(t.node.piece.bufferIndex,t.node.piece.start),r=o+t.remainder,l=o+t.node.piece.length;return s.buffer.substring(r,l)}}findMatchesInNode(e,t,s,o,r,l,c,d,u,g,f){const p=this._buffers[e.piece.bufferIndex],m=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start),_=this.offsetInBuffer(e.piece.bufferIndex,r),C=this.offsetInBuffer(e.piece.bufferIndex,l);let b;const v={line:0,column:0};let S,y;t._wordSeparators?(S=p.buffer.substring(_,C),y=w=>w+_,t.reset(0)):(S=p.buffer,y=w=>w,t.reset(_));do if(b=t.next(S),b){if(y(b.index)>=C)return g;this.positionInBuffer(e,y(b.index)-m,v);const w=this.getLineFeedCnt(e.piece.bufferIndex,r,v),L=v.line===r.line?v.column-r.column+o:v.column+1,x=L+b[0].length;if(f[g++]=createFindMatch(new Range$2(s+w,L,s+w,x),b,d),y(b.index)+b[0].length>=C||g>=u)return g}while(b);return g}findMatchesLineByLine(e,t,s,o){const r=[];let l=0;const c=new Searcher(t.wordSeparators,t.regex);let d=this.nodeAt2(e.startLineNumber,e.startColumn);if(d===null)return[];const u=this.nodeAt2(e.endLineNumber,e.endColumn);if(u===null)return[];let g=this.positionInBuffer(d.node,d.remainder);const f=this.positionInBuffer(u.node,u.remainder);if(d.node===u.node)return this.findMatchesInNode(d.node,c,e.startLineNumber,e.startColumn,g,f,t,s,o,l,r),r;let p=e.startLineNumber,m=d.node;for(;m!==u.node;){const C=this.getLineFeedCnt(m.piece.bufferIndex,g,m.piece.end);if(C>=1){const v=this._buffers[m.piece.bufferIndex].lineStarts,S=this.offsetInBuffer(m.piece.bufferIndex,m.piece.start),y=v[g.line+C],w=p===e.startLineNumber?e.startColumn:1;if(l=this.findMatchesInNode(m,c,p,w,g,this.positionInBuffer(m,y-S),t,s,o,l,r),l>=o)return r;p+=C}const b=p===e.startLineNumber?e.startColumn-1:0;if(p===e.endLineNumber){const v=this.getLineContent(p).substring(b,e.endColumn-1);return l=this._findMatchesInLine(t,c,v,e.endLineNumber,b,l,r,s,o),r}if(l=this._findMatchesInLine(t,c,this.getLineContent(p).substr(b),p,b,l,r,s,o),l>=o)return r;p++,d=this.nodeAt2(p,1),m=d.node,g=this.positionInBuffer(d.node,d.remainder)}if(p===e.endLineNumber){const C=p===e.startLineNumber?e.startColumn-1:0,b=this.getLineContent(p).substring(C,e.endColumn-1);return l=this._findMatchesInLine(t,c,b,e.endLineNumber,C,l,r,s,o),r}const _=p===e.startLineNumber?e.startColumn:1;return l=this.findMatchesInNode(u.node,c,p,_,g,f,t,s,o,l,r),r}_findMatchesInLine(e,t,s,o,r,l,c,d,u){const g=e.wordSeparators;if(!d&&e.simpleSearch){const p=e.simpleSearch,m=p.length,_=s.length;let C=-m;for(;(C=s.indexOf(p,C+m))!==-1;)if((!g||isValidMatch(g,s,_,C,m))&&(c[l++]=new FindMatch(new Range$2(o,C+1+r,o,C+1+m+r),null),l>=u))return l;return l}let f;t.reset(0);do if(f=t.next(s),f&&(c[l++]=createFindMatch(new Range$2(o,f.index+1+r,o,f.index+1+f[0].length+r),f,d),l>=u))return l;while(f);return l}insert(e,t,s=!1){if(this._EOLNormalized=this._EOLNormalized&&s,this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",this.root!==SENTINEL){const{node:o,remainder:r,nodeStartOffset:l}=this.nodeAt(e),c=o.piece,d=c.bufferIndex,u=this.positionInBuffer(o,r);if(o.piece.bufferIndex===0&&c.end.line===this._lastChangeBufferPos.line&&c.end.column===this._lastChangeBufferPos.column&&l+c.length===e&&t.length<AverageBufferSize){this.appendToNode(o,t),this.computeBufferMetadata();return}if(l===e)this.insertContentToNodeLeft(t,o),this._searchCache.validate(e);else if(l+o.piece.length>e){const g=[];let f=new Piece(c.bufferIndex,u,c.end,this.getLineFeedCnt(c.bufferIndex,u,c.end),this.offsetInBuffer(d,c.end)-this.offsetInBuffer(d,u));if(this.shouldCheckCRLF()&&this.endWithCR(t)&&this.nodeCharCodeAt(o,r)===10){const C={line:f.start.line+1,column:0};f=new Piece(f.bufferIndex,C,f.end,this.getLineFeedCnt(f.bufferIndex,C,f.end),f.length-1),t+=`
`}if(this.shouldCheckCRLF()&&this.startWithLF(t))if(this.nodeCharCodeAt(o,r-1)===13){const C=this.positionInBuffer(o,r-1);this.deleteNodeTail(o,C),t="\r"+t,o.piece.length===0&&g.push(o)}else this.deleteNodeTail(o,u);else this.deleteNodeTail(o,u);const p=this.createNewPieces(t);f.length>0&&this.rbInsertRight(o,f);let m=o;for(let _=0;_<p.length;_++)m=this.rbInsertRight(m,p[_]);this.deleteNodes(g)}else this.insertContentToNodeRight(t,o)}else{const o=this.createNewPieces(t);let r=this.rbInsertLeft(null,o[0]);for(let l=1;l<o.length;l++)r=this.rbInsertRight(r,o[l])}this.computeBufferMetadata()}delete(e,t){if(this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",t<=0||this.root===SENTINEL)return;const s=this.nodeAt(e),o=this.nodeAt(e+t),r=s.node,l=o.node;if(r===l){const p=this.positionInBuffer(r,s.remainder),m=this.positionInBuffer(r,o.remainder);if(s.nodeStartOffset===e){if(t===r.piece.length){const _=r.next();rbDelete(this,r),this.validateCRLFWithPrevNode(_),this.computeBufferMetadata();return}this.deleteNodeHead(r,m),this._searchCache.validate(e),this.validateCRLFWithPrevNode(r),this.computeBufferMetadata();return}if(s.nodeStartOffset+r.piece.length===e+t){this.deleteNodeTail(r,p),this.validateCRLFWithNextNode(r),this.computeBufferMetadata();return}this.shrinkNode(r,p,m),this.computeBufferMetadata();return}const c=[],d=this.positionInBuffer(r,s.remainder);this.deleteNodeTail(r,d),this._searchCache.validate(e),r.piece.length===0&&c.push(r);const u=this.positionInBuffer(l,o.remainder);this.deleteNodeHead(l,u),l.piece.length===0&&c.push(l);const g=r.next();for(let p=g;p!==SENTINEL&&p!==l;p=p.next())c.push(p);const f=r.piece.length===0?r.prev():r;this.deleteNodes(c),this.validateCRLFWithNextNode(f),this.computeBufferMetadata()}insertContentToNodeLeft(e,t){const s=[];if(this.shouldCheckCRLF()&&this.endWithCR(e)&&this.startWithLF(t)){const l=t.piece,c={line:l.start.line+1,column:0},d=new Piece(l.bufferIndex,c,l.end,this.getLineFeedCnt(l.bufferIndex,c,l.end),l.length-1);t.piece=d,e+=`
`,updateTreeMetadata(this,t,-1,-1),t.piece.length===0&&s.push(t)}const o=this.createNewPieces(e);let r=this.rbInsertLeft(t,o[o.length-1]);for(let l=o.length-2;l>=0;l--)r=this.rbInsertLeft(r,o[l]);this.validateCRLFWithPrevNode(r),this.deleteNodes(s)}insertContentToNodeRight(e,t){this.adjustCarriageReturnFromNext(e,t)&&(e+=`
`);const s=this.createNewPieces(e),o=this.rbInsertRight(t,s[0]);let r=o;for(let l=1;l<s.length;l++)r=this.rbInsertRight(r,s[l]);this.validateCRLFWithPrevNode(o)}positionInBuffer(e,t,s){const o=e.piece,r=e.piece.bufferIndex,l=this._buffers[r].lineStarts,d=l[o.start.line]+o.start.column+t;let u=o.start.line,g=o.end.line,f=0,p=0,m=0;for(;u<=g&&(f=u+(g-u)/2|0,m=l[f],f!==g);)if(p=l[f+1],d<m)g=f-1;else if(d>=p)u=f+1;else break;return s?(s.line=f,s.column=d-m,null):{line:f,column:d-m}}getLineFeedCnt(e,t,s){if(s.column===0)return s.line-t.line;const o=this._buffers[e].lineStarts;if(s.line===o.length-1)return s.line-t.line;const r=o[s.line+1],l=o[s.line]+s.column;if(r>l+1)return s.line-t.line;const c=l-1;return this._buffers[e].buffer.charCodeAt(c)===13?s.line-t.line+1:s.line-t.line}offsetInBuffer(e,t){return this._buffers[e].lineStarts[t.line]+t.column}deleteNodes(e){for(let t=0;t<e.length;t++)rbDelete(this,e[t])}createNewPieces(e){if(e.length>AverageBufferSize){const g=[];for(;e.length>AverageBufferSize;){const p=e.charCodeAt(AverageBufferSize-1);let m;p===13||p>=55296&&p<=56319?(m=e.substring(0,AverageBufferSize-1),e=e.substring(AverageBufferSize-1)):(m=e.substring(0,AverageBufferSize),e=e.substring(AverageBufferSize));const _=createLineStartsFast(m);g.push(new Piece(this._buffers.length,{line:0,column:0},{line:_.length-1,column:m.length-_[_.length-1]},_.length-1,m.length)),this._buffers.push(new StringBuffer(m,_))}const f=createLineStartsFast(e);return g.push(new Piece(this._buffers.length,{line:0,column:0},{line:f.length-1,column:e.length-f[f.length-1]},f.length-1,e.length)),this._buffers.push(new StringBuffer(e,f)),g}let t=this._buffers[0].buffer.length;const s=createLineStartsFast(e,!1);let o=this._lastChangeBufferPos;if(this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-1]===t&&t!==0&&this.startWithLF(e)&&this.endWithCR(this._buffers[0].buffer)){this._lastChangeBufferPos={line:this._lastChangeBufferPos.line,column:this._lastChangeBufferPos.column+1},o=this._lastChangeBufferPos;for(let g=0;g<s.length;g++)s[g]+=t+1;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(s.slice(1)),this._buffers[0].buffer+="_"+e,t+=1}else{if(t!==0)for(let g=0;g<s.length;g++)s[g]+=t;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(s.slice(1)),this._buffers[0].buffer+=e}const r=this._buffers[0].buffer.length,l=this._buffers[0].lineStarts.length-1,c=r-this._buffers[0].lineStarts[l],d={line:l,column:c},u=new Piece(0,o,d,this.getLineFeedCnt(0,o,d),r-t);return this._lastChangeBufferPos=d,[u]}getLineRawContent(e,t=0){let s=this.root,o="";const r=this._searchCache.get2(e);if(r){s=r.node;const l=this.getAccumulatedValue(s,e-r.nodeStartLineNumber-1),c=this._buffers[s.piece.bufferIndex].buffer,d=this.offsetInBuffer(s.piece.bufferIndex,s.piece.start);if(r.nodeStartLineNumber+s.piece.lineFeedCnt===e)o=c.substring(d+l,d+s.piece.length);else{const u=this.getAccumulatedValue(s,e-r.nodeStartLineNumber);return c.substring(d+l,d+u-t)}}else{let l=0;const c=e;for(;s!==SENTINEL;)if(s.left!==SENTINEL&&s.lf_left>=e-1)s=s.left;else if(s.lf_left+s.piece.lineFeedCnt>e-1){const d=this.getAccumulatedValue(s,e-s.lf_left-2),u=this.getAccumulatedValue(s,e-s.lf_left-1),g=this._buffers[s.piece.bufferIndex].buffer,f=this.offsetInBuffer(s.piece.bufferIndex,s.piece.start);return l+=s.size_left,this._searchCache.set({node:s,nodeStartOffset:l,nodeStartLineNumber:c-(e-1-s.lf_left)}),g.substring(f+d,f+u-t)}else if(s.lf_left+s.piece.lineFeedCnt===e-1){const d=this.getAccumulatedValue(s,e-s.lf_left-2),u=this._buffers[s.piece.bufferIndex].buffer,g=this.offsetInBuffer(s.piece.bufferIndex,s.piece.start);o=u.substring(g+d,g+s.piece.length);break}else e-=s.lf_left+s.piece.lineFeedCnt,l+=s.size_left+s.piece.length,s=s.right}for(s=s.next();s!==SENTINEL;){const l=this._buffers[s.piece.bufferIndex].buffer;if(s.piece.lineFeedCnt>0){const c=this.getAccumulatedValue(s,0),d=this.offsetInBuffer(s.piece.bufferIndex,s.piece.start);return o+=l.substring(d,d+c-t),o}else{const c=this.offsetInBuffer(s.piece.bufferIndex,s.piece.start);o+=l.substr(c,s.piece.length)}s=s.next()}return o}computeBufferMetadata(){let e=this.root,t=1,s=0;for(;e!==SENTINEL;)t+=e.lf_left+e.piece.lineFeedCnt,s+=e.size_left+e.piece.length,e=e.right;this._lineCnt=t,this._length=s,this._searchCache.validate(this._length)}getIndexOf(e,t){const s=e.piece,o=this.positionInBuffer(e,t),r=o.line-s.start.line;if(this.offsetInBuffer(s.bufferIndex,s.end)-this.offsetInBuffer(s.bufferIndex,s.start)===t){const l=this.getLineFeedCnt(e.piece.bufferIndex,s.start,o);if(l!==r)return{index:l,remainder:0}}return{index:r,remainder:o.column}}getAccumulatedValue(e,t){if(t<0)return 0;const s=e.piece,o=this._buffers[s.bufferIndex].lineStarts,r=s.start.line+t+1;return r>s.end.line?o[s.end.line]+s.end.column-o[s.start.line]-s.start.column:o[r]-o[s.start.line]-s.start.column}deleteNodeTail(e,t){const s=e.piece,o=s.lineFeedCnt,r=this.offsetInBuffer(s.bufferIndex,s.end),l=t,c=this.offsetInBuffer(s.bufferIndex,l),d=this.getLineFeedCnt(s.bufferIndex,s.start,l),u=d-o,g=c-r,f=s.length+g;e.piece=new Piece(s.bufferIndex,s.start,l,d,f),updateTreeMetadata(this,e,g,u)}deleteNodeHead(e,t){const s=e.piece,o=s.lineFeedCnt,r=this.offsetInBuffer(s.bufferIndex,s.start),l=t,c=this.getLineFeedCnt(s.bufferIndex,l,s.end),d=this.offsetInBuffer(s.bufferIndex,l),u=c-o,g=r-d,f=s.length+g;e.piece=new Piece(s.bufferIndex,l,s.end,c,f),updateTreeMetadata(this,e,g,u)}shrinkNode(e,t,s){const o=e.piece,r=o.start,l=o.end,c=o.length,d=o.lineFeedCnt,u=t,g=this.getLineFeedCnt(o.bufferIndex,o.start,u),f=this.offsetInBuffer(o.bufferIndex,t)-this.offsetInBuffer(o.bufferIndex,r);e.piece=new Piece(o.bufferIndex,o.start,u,g,f),updateTreeMetadata(this,e,f-c,g-d);const p=new Piece(o.bufferIndex,s,l,this.getLineFeedCnt(o.bufferIndex,s,l),this.offsetInBuffer(o.bufferIndex,l)-this.offsetInBuffer(o.bufferIndex,s)),m=this.rbInsertRight(e,p);this.validateCRLFWithPrevNode(m)}appendToNode(e,t){this.adjustCarriageReturnFromNext(t,e)&&(t+=`
`);const s=this.shouldCheckCRLF()&&this.startWithLF(t)&&this.endWithCR(e),o=this._buffers[0].buffer.length;this._buffers[0].buffer+=t;const r=createLineStartsFast(t,!1);for(let m=0;m<r.length;m++)r[m]+=o;if(s){const m=this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-2];this._buffers[0].lineStarts.pop(),this._lastChangeBufferPos={line:this._lastChangeBufferPos.line-1,column:o-m}}this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(r.slice(1));const l=this._buffers[0].lineStarts.length-1,c=this._buffers[0].buffer.length-this._buffers[0].lineStarts[l],d={line:l,column:c},u=e.piece.length+t.length,g=e.piece.lineFeedCnt,f=this.getLineFeedCnt(0,e.piece.start,d),p=f-g;e.piece=new Piece(e.piece.bufferIndex,e.piece.start,d,f,u),this._lastChangeBufferPos=d,updateTreeMetadata(this,e,t.length,p)}nodeAt(e){let t=this.root;const s=this._searchCache.get(e);if(s)return{node:s.node,nodeStartOffset:s.nodeStartOffset,remainder:e-s.nodeStartOffset};let o=0;for(;t!==SENTINEL;)if(t.size_left>e)t=t.left;else if(t.size_left+t.piece.length>=e){o+=t.size_left;const r={node:t,remainder:e-t.size_left,nodeStartOffset:o};return this._searchCache.set(r),r}else e-=t.size_left+t.piece.length,o+=t.size_left+t.piece.length,t=t.right;return null}nodeAt2(e,t){let s=this.root,o=0;for(;s!==SENTINEL;)if(s.left!==SENTINEL&&s.lf_left>=e-1)s=s.left;else if(s.lf_left+s.piece.lineFeedCnt>e-1){const r=this.getAccumulatedValue(s,e-s.lf_left-2),l=this.getAccumulatedValue(s,e-s.lf_left-1);return o+=s.size_left,{node:s,remainder:Math.min(r+t-1,l),nodeStartOffset:o}}else if(s.lf_left+s.piece.lineFeedCnt===e-1){const r=this.getAccumulatedValue(s,e-s.lf_left-2);if(r+t-1<=s.piece.length)return{node:s,remainder:r+t-1,nodeStartOffset:o};t-=s.piece.length-r;break}else e-=s.lf_left+s.piece.lineFeedCnt,o+=s.size_left+s.piece.length,s=s.right;for(s=s.next();s!==SENTINEL;){if(s.piece.lineFeedCnt>0){const r=this.getAccumulatedValue(s,0),l=this.offsetOfNode(s);return{node:s,remainder:Math.min(t-1,r),nodeStartOffset:l}}else if(s.piece.length>=t-1){const r=this.offsetOfNode(s);return{node:s,remainder:t-1,nodeStartOffset:r}}else t-=s.piece.length;s=s.next()}return null}nodeCharCodeAt(e,t){if(e.piece.lineFeedCnt<1)return-1;const s=this._buffers[e.piece.bufferIndex],o=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start)+t;return s.buffer.charCodeAt(o)}offsetOfNode(e){if(!e)return 0;let t=e.size_left;for(;e!==this.root;)e.parent.right===e&&(t+=e.parent.size_left+e.parent.piece.length),e=e.parent;return t}shouldCheckCRLF(){return!(this._EOLNormalized&&this._EOL===`
`)}startWithLF(e){if(typeof e=="string")return e.charCodeAt(0)===10;if(e===SENTINEL||e.piece.lineFeedCnt===0)return!1;const t=e.piece,s=this._buffers[t.bufferIndex].lineStarts,o=t.start.line,r=s[o]+t.start.column;return o===s.length-1||s[o+1]>r+1?!1:this._buffers[t.bufferIndex].buffer.charCodeAt(r)===10}endWithCR(e){return typeof e=="string"?e.charCodeAt(e.length-1)===13:e===SENTINEL||e.piece.lineFeedCnt===0?!1:this.nodeCharCodeAt(e,e.piece.length-1)===13}validateCRLFWithPrevNode(e){if(this.shouldCheckCRLF()&&this.startWithLF(e)){const t=e.prev();this.endWithCR(t)&&this.fixCRLF(t,e)}}validateCRLFWithNextNode(e){if(this.shouldCheckCRLF()&&this.endWithCR(e)){const t=e.next();this.startWithLF(t)&&this.fixCRLF(e,t)}}fixCRLF(e,t){const s=[],o=this._buffers[e.piece.bufferIndex].lineStarts;let r;e.piece.end.column===0?r={line:e.piece.end.line-1,column:o[e.piece.end.line]-o[e.piece.end.line-1]-1}:r={line:e.piece.end.line,column:e.piece.end.column-1};const l=e.piece.length-1,c=e.piece.lineFeedCnt-1;e.piece=new Piece(e.piece.bufferIndex,e.piece.start,r,c,l),updateTreeMetadata(this,e,-1,-1),e.piece.length===0&&s.push(e);const d={line:t.piece.start.line+1,column:0},u=t.piece.length-1,g=this.getLineFeedCnt(t.piece.bufferIndex,d,t.piece.end);t.piece=new Piece(t.piece.bufferIndex,d,t.piece.end,g,u),updateTreeMetadata(this,t,-1,-1),t.piece.length===0&&s.push(t);const f=this.createNewPieces(`\r
`);this.rbInsertRight(e,f[0]);for(let p=0;p<s.length;p++)rbDelete(this,s[p])}adjustCarriageReturnFromNext(e,t){if(this.shouldCheckCRLF()&&this.endWithCR(e)){const s=t.next();if(this.startWithLF(s)){if(e+=`
`,s.piece.length===1)rbDelete(this,s);else{const o=s.piece,r={line:o.start.line+1,column:0},l=o.length-1,c=this.getLineFeedCnt(o.bufferIndex,r,o.end);s.piece=new Piece(o.bufferIndex,r,o.end,c,l),updateTreeMetadata(this,s,-1,-1)}return!0}}return!1}iterate(e,t){if(e===SENTINEL)return t(SENTINEL);const s=this.iterate(e.left,t);return s&&t(e)&&this.iterate(e.right,t)}getNodeContent(e){if(e===SENTINEL)return"";const t=this._buffers[e.piece.bufferIndex],s=e.piece,o=this.offsetInBuffer(s.bufferIndex,s.start),r=this.offsetInBuffer(s.bufferIndex,s.end);return t.buffer.substring(o,r)}getPieceContent(e){const t=this._buffers[e.bufferIndex],s=this.offsetInBuffer(e.bufferIndex,e.start),o=this.offsetInBuffer(e.bufferIndex,e.end);return t.buffer.substring(s,o)}rbInsertRight(e,t){const s=new TreeNode(t,1);if(s.left=SENTINEL,s.right=SENTINEL,s.parent=SENTINEL,s.size_left=0,s.lf_left=0,this.root===SENTINEL)this.root=s,s.color=0;else if(e.right===SENTINEL)e.right=s,s.parent=e;else{const r=leftest(e.right);r.left=s,s.parent=r}return fixInsert(this,s),s}rbInsertLeft(e,t){const s=new TreeNode(t,1);if(s.left=SENTINEL,s.right=SENTINEL,s.parent=SENTINEL,s.size_left=0,s.lf_left=0,this.root===SENTINEL)this.root=s,s.color=0;else if(e.left===SENTINEL)e.left=s,s.parent=e;else{const o=righttest(e.left);o.right=s,s.parent=o}return fixInsert(this,s),s}}class PieceTreeTextBuffer extends Disposable{constructor(e,t,s,o,r,l,c){super(),this._onDidChangeContent=this._register(new Emitter$1),this._BOM=t,this._mightContainNonBasicASCII=!l,this._mightContainRTL=o,this._mightContainUnusualLineTerminators=r,this._pieceTree=new PieceTreeBase(e,s,c)}mightContainRTL(){return this._mightContainRTL}mightContainUnusualLineTerminators(){return this._mightContainUnusualLineTerminators}resetMightContainUnusualLineTerminators(){this._mightContainUnusualLineTerminators=!1}mightContainNonBasicASCII(){return this._mightContainNonBasicASCII}getBOM(){return this._BOM}getEOL(){return this._pieceTree.getEOL()}createSnapshot(e){return this._pieceTree.createSnapshot(e?this._BOM:"")}getOffsetAt(e,t){return this._pieceTree.getOffsetAt(e,t)}getPositionAt(e){return this._pieceTree.getPositionAt(e)}getRangeAt(e,t){const s=e+t,o=this.getPositionAt(e),r=this.getPositionAt(s);return new Range$2(o.lineNumber,o.column,r.lineNumber,r.column)}getValueInRange(e,t=0){if(e.isEmpty())return"";const s=this._getEndOfLine(t);return this._pieceTree.getValueInRange(e,s)}getValueLengthInRange(e,t=0){if(e.isEmpty())return 0;if(e.startLineNumber===e.endLineNumber)return e.endColumn-e.startColumn;const s=this.getOffsetAt(e.startLineNumber,e.startColumn),o=this.getOffsetAt(e.endLineNumber,e.endColumn);let r=0;const l=this._getEndOfLine(t),c=this.getEOL();if(l.length!==c.length){const d=l.length-c.length,u=e.endLineNumber-e.startLineNumber;r=d*u}return o-s+r}getCharacterCountInRange(e,t=0){if(this._mightContainNonBasicASCII){let s=0;const o=e.startLineNumber,r=e.endLineNumber;for(let l=o;l<=r;l++){const c=this.getLineContent(l),d=l===o?e.startColumn-1:0,u=l===r?e.endColumn-1:c.length;for(let g=d;g<u;g++)isHighSurrogate(c.charCodeAt(g))?(s=s+1,g=g+1):s=s+1}return s+=this._getEndOfLine(t).length*(r-o),s}return this.getValueLengthInRange(e,t)}getNearestChunk(e){return this._pieceTree.getNearestChunk(e)}getLength(){return this._pieceTree.getLength()}getLineCount(){return this._pieceTree.getLineCount()}getLinesContent(){return this._pieceTree.getLinesContent()}getLineContent(e){return this._pieceTree.getLineContent(e)}getLineCharCode(e,t){return this._pieceTree.getLineCharCode(e,t)}getLineLength(e){return this._pieceTree.getLineLength(e)}getLineFirstNonWhitespaceColumn(e){const t=firstNonWhitespaceIndex(this.getLineContent(e));return t===-1?0:t+1}getLineLastNonWhitespaceColumn(e){const t=lastNonWhitespaceIndex(this.getLineContent(e));return t===-1?0:t+2}_getEndOfLine(e){switch(e){case 1:return`
`;case 2:return`\r
`;case 0:return this.getEOL();default:throw new Error("Unknown EOL preference")}}setEOL(e){this._pieceTree.setEOL(e)}applyEdits(e,t,s){let o=this._mightContainRTL,r=this._mightContainUnusualLineTerminators,l=this._mightContainNonBasicASCII,c=!0,d=[];for(let C=0;C<e.length;C++){const b=e[C];c&&b._isTracked&&(c=!1);const v=b.range;if(b.text){let x=!0;l||(x=!isBasicASCII(b.text),l=x),!o&&x&&(o=containsRTL(b.text)),!r&&x&&(r=containsUnusualLineTerminators(b.text))}let S="",y=0,w=0,L=0;if(b.text){let x;[y,w,L,x]=countEOL(b.text);const E=this.getEOL();x===0||x===(E===`\r
`?2:1)?S=b.text:S=b.text.replace(/\r\n|\r|\n/g,E)}d[C]={sortIndex:C,identifier:b.identifier||null,range:v,rangeOffset:this.getOffsetAt(v.startLineNumber,v.startColumn),rangeLength:this.getValueLengthInRange(v),text:S,eolCount:y,firstLineLength:w,lastLineLength:L,forceMoveMarkers:!!b.forceMoveMarkers,isAutoWhitespaceEdit:b.isAutoWhitespaceEdit||!1}}d.sort(PieceTreeTextBuffer._sortOpsAscending);let u=!1;for(let C=0,b=d.length-1;C<b;C++){const v=d[C].range.getEndPosition(),S=d[C+1].range.getStartPosition();if(S.isBeforeOrEqual(v)){if(S.isBefore(v))throw new Error("Overlapping ranges are not allowed!");u=!0}}c&&(d=this._reduceOperations(d));const g=s||t?PieceTreeTextBuffer._getInverseEditRanges(d):[],f=[];if(t)for(let C=0;C<d.length;C++){const b=d[C],v=g[C];if(b.isAutoWhitespaceEdit&&b.range.isEmpty())for(let S=v.startLineNumber;S<=v.endLineNumber;S++){let y="";S===v.startLineNumber&&(y=this.getLineContent(b.range.startLineNumber),firstNonWhitespaceIndex(y)!==-1)||f.push({lineNumber:S,oldContent:y})}}let p=null;if(s){let C=0;p=[];for(let b=0;b<d.length;b++){const v=d[b],S=g[b],y=this.getValueInRange(v.range),w=v.rangeOffset+C;C+=v.text.length-y.length,p[b]={sortIndex:v.sortIndex,identifier:v.identifier,range:S,text:y,textChange:new TextChange(v.rangeOffset,y,w,v.text)}}u||p.sort((b,v)=>b.sortIndex-v.sortIndex)}this._mightContainRTL=o,this._mightContainUnusualLineTerminators=r,this._mightContainNonBasicASCII=l;const m=this._doApplyEdits(d);let _=null;if(t&&f.length>0){f.sort((C,b)=>b.lineNumber-C.lineNumber),_=[];for(let C=0,b=f.length;C<b;C++){const v=f[C].lineNumber;if(C>0&&f[C-1].lineNumber===v)continue;const S=f[C].oldContent,y=this.getLineContent(v);y.length===0||y===S||firstNonWhitespaceIndex(y)!==-1||_.push(v)}}return this._onDidChangeContent.fire(),new ApplyEditsResult(p,m,_)}_reduceOperations(e){return e.length<1e3?e:[this._toSingleEditOperation(e)]}_toSingleEditOperation(e){let t=!1;const s=e[0].range,o=e[e.length-1].range,r=new Range$2(s.startLineNumber,s.startColumn,o.endLineNumber,o.endColumn);let l=s.startLineNumber,c=s.startColumn;const d=[];for(let m=0,_=e.length;m<_;m++){const C=e[m],b=C.range;t=t||C.forceMoveMarkers,d.push(this.getValueInRange(new Range$2(l,c,b.startLineNumber,b.startColumn))),C.text.length>0&&d.push(C.text),l=b.endLineNumber,c=b.endColumn}const u=d.join(""),[g,f,p]=countEOL(u);return{sortIndex:0,identifier:e[0].identifier,range:r,rangeOffset:this.getOffsetAt(r.startLineNumber,r.startColumn),rangeLength:this.getValueLengthInRange(r,0),text:u,eolCount:g,firstLineLength:f,lastLineLength:p,forceMoveMarkers:t,isAutoWhitespaceEdit:!1}}_doApplyEdits(e){e.sort(PieceTreeTextBuffer._sortOpsDescending);const t=[];for(let s=0;s<e.length;s++){const o=e[s],r=o.range.startLineNumber,l=o.range.startColumn,c=o.range.endLineNumber,d=o.range.endColumn;if(r===c&&l===d&&o.text.length===0)continue;o.text?(this._pieceTree.delete(o.rangeOffset,o.rangeLength),this._pieceTree.insert(o.rangeOffset,o.text,!0)):this._pieceTree.delete(o.rangeOffset,o.rangeLength);const u=new Range$2(r,l,c,d);t.push({range:u,rangeLength:o.rangeLength,text:o.text,rangeOffset:o.rangeOffset,forceMoveMarkers:o.forceMoveMarkers})}return t}findMatchesLineByLine(e,t,s,o){return this._pieceTree.findMatchesLineByLine(e,t,s,o)}static _getInverseEditRanges(e){const t=[];let s=0,o=0,r=null;for(let l=0,c=e.length;l<c;l++){const d=e[l];let u,g;r?r.range.endLineNumber===d.range.startLineNumber?(u=s,g=o+(d.range.startColumn-r.range.endColumn)):(u=s+(d.range.startLineNumber-r.range.endLineNumber),g=d.range.startColumn):(u=d.range.startLineNumber,g=d.range.startColumn);let f;if(d.text.length>0){const p=d.eolCount+1;p===1?f=new Range$2(u,g,u,g+d.firstLineLength):f=new Range$2(u,g,u+p-1,d.lastLineLength+1)}else f=new Range$2(u,g,u,g);s=f.endLineNumber,o=f.endColumn,t.push(f),r=d}return t}static _sortOpsAscending(e,t){const s=Range$2.compareRangesUsingEnds(e.range,t.range);return s===0?e.sortIndex-t.sortIndex:s}static _sortOpsDescending(e,t){const s=Range$2.compareRangesUsingEnds(e.range,t.range);return s===0?t.sortIndex-e.sortIndex:-s}}class PieceTreeTextBufferFactory{constructor(e,t,s,o,r,l,c,d,u){this._chunks=e,this._bom=t,this._cr=s,this._lf=o,this._crlf=r,this._containsRTL=l,this._containsUnusualLineTerminators=c,this._isBasicASCII=d,this._normalizeEOL=u}_getEOL(e){const t=this._cr+this._lf+this._crlf,s=this._cr+this._crlf;return t===0?e===1?`
`:`\r
`:s>t/2?`\r
`:`
`}create(e){const t=this._getEOL(e),s=this._chunks;if(this._normalizeEOL&&(t===`\r
`&&(this._cr>0||this._lf>0)||t===`
`&&(this._cr>0||this._crlf>0)))for(let r=0,l=s.length;r<l;r++){const c=s[r].buffer.replace(/\r\n|\r|\n/g,t),d=createLineStartsFast(c);s[r]=new StringBuffer(c,d)}const o=new PieceTreeTextBuffer(s,this._bom,t,this._containsRTL,this._containsUnusualLineTerminators,this._isBasicASCII,this._normalizeEOL);return{textBuffer:o,disposable:o}}}class PieceTreeTextBufferBuilder{constructor(){this.chunks=[],this.BOM="",this._hasPreviousChar=!1,this._previousChar=0,this._tmpLineStarts=[],this.cr=0,this.lf=0,this.crlf=0,this.containsRTL=!1,this.containsUnusualLineTerminators=!1,this.isBasicASCII=!0}acceptChunk(e){if(e.length===0)return;this.chunks.length===0&&startsWithUTF8BOM(e)&&(this.BOM=UTF8_BOM_CHARACTER,e=e.substr(1));const t=e.charCodeAt(e.length-1);t===13||t>=55296&&t<=56319?(this._acceptChunk1(e.substr(0,e.length-1),!1),this._hasPreviousChar=!0,this._previousChar=t):(this._acceptChunk1(e,!1),this._hasPreviousChar=!1,this._previousChar=t)}_acceptChunk1(e,t){!t&&e.length===0||(this._hasPreviousChar?this._acceptChunk2(String.fromCharCode(this._previousChar)+e):this._acceptChunk2(e))}_acceptChunk2(e){const t=createLineStarts(this._tmpLineStarts,e);this.chunks.push(new StringBuffer(e,t.lineStarts)),this.cr+=t.cr,this.lf+=t.lf,this.crlf+=t.crlf,t.isBasicASCII||(this.isBasicASCII=!1,this.containsRTL||(this.containsRTL=containsRTL(e)),this.containsUnusualLineTerminators||(this.containsUnusualLineTerminators=containsUnusualLineTerminators(e)))}finish(e=!0){return this._finish(),new PieceTreeTextBufferFactory(this.chunks,this.BOM,this.cr,this.lf,this.crlf,this.containsRTL,this.containsUnusualLineTerminators,this.isBasicASCII,e)}_finish(){if(this.chunks.length===0&&this._acceptChunk1("",!0),this._hasPreviousChar){this._hasPreviousChar=!1;const e=this.chunks[this.chunks.length-1];e.buffer+=String.fromCharCode(this._previousChar);const t=createLineStartsFast(e.buffer);e.lineStarts=t,this._previousChar===13&&this.cr++}}}class AttachedViews{constructor(){this._onDidChangeVisibleRanges=new Emitter$1,this.onDidChangeVisibleRanges=this._onDidChangeVisibleRanges.event,this._views=new Set,this._viewsChanged=observableSignal(this),this.visibleLineRanges=derivedOpts({owner:this,equalsFn:itemsEquals(itemEquals())},e=>(this._viewsChanged.read(e),LineRange.joinMany([...this._views].map(s=>{var o;return((o=s.state.read(e))==null?void 0:o.visibleLineRanges)??[]}))))}attachView(){const e=new AttachedViewImpl(t=>{this._onDidChangeVisibleRanges.fire({view:e,state:t})});return this._views.add(e),this._viewsChanged.trigger(void 0),e}detachView(e){this._views.delete(e),this._onDidChangeVisibleRanges.fire({view:e,state:void 0}),this._viewsChanged.trigger(void 0)}}class AttachedViewState{constructor(e,t){this.visibleLineRanges=e,this.stabilized=t}equals(e){return this===e?!0:!(!equals$1(this.visibleLineRanges,e.visibleLineRanges,(t,s)=>t.equals(s))||this.stabilized!==e.stabilized)}}class AttachedViewImpl{get state(){return this._state}constructor(e){this.handleStateChange=e,this._state=observableValueOpts({owner:this,equalsFn:equalsIfDefined((t,s)=>t.equals(s))},void 0)}setVisibleLines(e,t){const s=e.map(r=>new LineRange(r.startLineNumber,r.endLineNumber+1)),o=new AttachedViewState(s,t);this._state.set(o,void 0,void 0),this.handleStateChange(o)}}class AttachedViewHandler extends Disposable{get lineRanges(){return this._lineRanges}constructor(e){super(),this._refreshTokens=e,this.runner=this._register(new RunOnceScheduler(()=>this.update(),50)),this._computedLineRanges=[],this._lineRanges=[]}update(){equals$1(this._computedLineRanges,this._lineRanges,(e,t)=>e.equals(t))||(this._computedLineRanges=this._lineRanges,this._refreshTokens())}handleStateChange(e){this._lineRanges=e.visibleLineRanges,e.stabilized?(this.runner.cancel(),this.update()):this.runner.schedule()}}class AbstractSyntaxTokenBackend extends Disposable{get backgroundTokenizationState(){return this._backgroundTokenizationState}constructor(e,t){super(),this._languageIdCodec=e,this._textModel=t,this._onDidChangeTokens=this._register(new Emitter$1),this.onDidChangeTokens=this._onDidChangeTokens.event}tokenizeIfCheap(e){this.isCheapToTokenize(e)&&this.forceTokenization(e)}}function gotoNextSibling(a,e){const t=a.gotoNextSibling(),s=e.gotoNextSibling();if(t!==s)throw new Error("Trees are out of sync");return t&&s}function gotoParent(a,e){const t=a.gotoParent(),s=e.gotoParent();if(t!==s)throw new Error("Trees are out of sync");return t&&s}function gotoNthChild(a,e,t){const s=a.gotoFirstChild(),o=e.gotoFirstChild();if(s!==o)throw new Error("Trees are out of sync");if(t===0)return s&&o;for(let r=1;r<=t;r++){const l=a.gotoNextSibling(),c=e.gotoNextSibling();if(l!==c)throw new Error("Trees are out of sync");if(!l||!c)return!1}return s&&o}function nextSiblingOrParentSibling(a,e){do{if(a.currentNode.nextSibling)return gotoNextSibling(a,e);a.currentNode.parent&&gotoParent(a,e)}while(a.currentNode.nextSibling||a.currentNode.parent);return!1}function getClosestPreviousNodes(a,e){const t=e.walk();t.resetTo(a);const s=a.currentNode;do if(t.currentNode.previousSibling&&t.currentNode.endIndex-t.currentNode.startIndex!==0)t.gotoPreviousSibling();else{for(;!t.currentNode.previousSibling&&t.currentNode.parent;)t.gotoParent();t.gotoPreviousSibling()}while(t.currentNode.endIndex>s.startIndex&&(t.currentNode.parent||t.currentNode.previousSibling)&&t.currentNode.id!==s.id);if(t.currentNode.id!==s.id&&t.currentNode.endIndex<=s.startIndex)return t.currentNode}var __decorate$2F=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2A=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let TreeSitterTree=class extends Disposable{constructor(e,t,s,o,r,l,c){super(),this.languageId=e,this._ranges=t,this._parser=s,this._parserClass=o,this.textModel=r,this._logService=l,this._telemetryService=c,this._tree=observableValue(this,void 0),this.tree=this._tree,this._treeLastParsedVersion=observableValue(this,-1),this.treeLastParsedVersion=this._treeLastParsedVersion,this._onDidChangeContentQueue=new TaskQueue$1,this._tree=observableValue(this,void 0),this.tree=this._tree,this._register(toDisposable(()=>{var d,u,g;(d=this._tree.get())==null||d.delete(),(u=this._lastFullyParsed)==null||u.delete(),(g=this._lastFullyParsedWithEdits)==null||g.delete(),this._parser.delete()})),this.handleContentChange(void 0,this._ranges)}handleContentChange(e,t){const s=this.textModel.getVersionId();let o=[];t&&(o=this._setRanges(t)),e&&this._applyEdits(e.changes),this._onDidChangeContentQueue.clearPending(),this._onDidChangeContentQueue.schedule(async()=>{if(this._store.isDisposed)return;const r=this._lastFullyParsed;let l;this._lastFullyParsedWithEdits&&this._lastFullyParsed&&(l=this._findChangedNodes(this._lastFullyParsedWithEdits,this._lastFullyParsed));const c=await this._parseAndUpdateTree(s);if(c){let d;l?r&&l&&(d=this._findTreeChanges(c,l,o)):this._ranges&&(d=this._ranges.map(g=>({newRange:new Range$2(g.startPosition.row+1,g.startPosition.column+1,g.endPosition.row+1,g.endPosition.column+1),oldRangeLength:g.endIndex-g.startIndex,newRangeStartOffset:g.startIndex,newRangeEndOffset:g.endIndex}))),d||(d=[{newRange:this.textModel.getFullModelRange(),newRangeStartOffset:0,newRangeEndOffset:this.textModel.getValueLength()}]);const u=this._tree.get();transaction(g=>{this._tree.set(c,g,{ranges:d,versionId:s}),this._treeLastParsedVersion.set(s,g)}),u==null||u.delete()}})}_applyEdits(e){var t,s;for(const o of e){const r=TextLength.ofRange(Range$2.lift(o.range)),l=TextLength.ofText(o.text),c=o.text.length===0?l:r.add(l),d={startIndex:o.rangeOffset,oldEndIndex:o.rangeOffset+o.rangeLength,newEndIndex:o.rangeOffset+o.text.length,startPosition:{row:o.range.startLineNumber-1,column:o.range.startColumn-1},oldEndPosition:{row:o.range.endLineNumber-1,column:o.range.endColumn-1},newEndPosition:{row:o.range.startLineNumber+c.lineCount-1,column:c.lineCount?c.columnCount:o.range.endColumn+c.columnCount}};(t=this._tree.get())==null||t.edit(d),(s=this._lastFullyParsedWithEdits)==null||s.edit(d)}}_findChangedNodes(e,t){if(this._ranges&&this._ranges.every(c=>c.startPosition.row!==e.rootNode.startPosition.row)||e.rootNode.startPosition.row!==0)return[];const s=e.walk(),o=t.walk(),r=[];let l=!0;do if(s.currentNode.hasChanges){const c=s.currentNode.children,d=[],u=c.filter((g,f)=>g!=null&&g.hasChanges||o.currentNode.children.length<=f?(d.push(f),!0):!1);if(u.length===0||s.currentNode.hasError!==o.currentNode.hasError){for(;s.currentNode.parent&&l&&!s.currentNode.isNamed;)l=gotoParent(s,o);const g=s.currentNode,f=getClosestPreviousNodes(s,e)??g;r.push({startIndex:f.startIndex,endIndex:g.endIndex,startPosition:f.startPosition,endPosition:g.endPosition}),l=nextSiblingOrParentSibling(s,o)}else u.length>=1&&(l=gotoNthChild(s,o,d[0]))}else l=nextSiblingOrParentSibling(s,o);while(l);return s.delete(),o.delete(),r}_findTreeChanges(e,t,s){let o=0;const r=[];for(let l=0;l<t.length;l++){const c=t[l];if(r.length>0&&c.startIndex>=r[r.length-1].newRangeStartOffset&&c.endIndex<=r[r.length-1].newRangeEndOffset)continue;const d=e.walk(),u=()=>d.startIndex<c.startIndex&&d.endIndex>c.endIndex;for(;u();){let C=d.gotoFirstChild(),b=!1;for(;C;)if(u()&&d.currentNode.isNamed){b=!0;break}else C=d.gotoNextSibling();if(!b){d.gotoParent();break}if(d.currentNode.childCount===0)break}const g=d.currentNode.startPosition,f=d.currentNode.endPosition,p=d.currentNode.startIndex,m=d.currentNode.endIndex,_={newRange:new Range$2(g.row+1,g.column+1,f.row+1,f.column+1),newRangeStartOffset:p,newRangeEndOffset:m};o<s.length&&rangesIntersect(s[o],{startIndex:p,endIndex:m,startPosition:g,endPosition:f})?(s[o].startIndex<_.newRangeStartOffset&&(_.newRange=_.newRange.setStartPosition(s[o].startPosition.row+1,s[o].startPosition.column+1),_.newRangeStartOffset=s[o].startIndex),s[o].endIndex>_.newRangeEndOffset&&(_.newRange=_.newRange.setEndPosition(s[o].endPosition.row+1,s[o].endPosition.column+1),_.newRangeEndOffset=s[o].endIndex),o++):o<s.length&&s[o].endIndex<_.newRangeStartOffset&&r.push({newRange:new Range$2(s[o].startPosition.row+1,s[o].startPosition.column+1,s[o].endPosition.row+1,s[o].endPosition.column+1),newRangeStartOffset:s[o].startIndex,newRangeEndOffset:s[o].endIndex}),r.length>0&&r[r.length-1].newRangeEndOffset>=_.newRangeStartOffset?(r[r.length-1].newRange=Range$2.fromPositions(r[r.length-1].newRange.getStartPosition(),_.newRange.getEndPosition()),r[r.length-1].newRangeEndOffset=_.newRangeEndOffset):r.push(_)}return this._constrainRanges(r)}_constrainRanges(e){if(!this._ranges)return e;const t=[];let s=0,o=0;for(;s<e.length&&o<this._ranges.length;){const r=e[s],l=this._ranges[o];if(r.newRangeEndOffset<l.startIndex)s++;else if(r.newRangeStartOffset>l.endIndex)o++;else{const c=Math.max(r.newRangeStartOffset,l.startIndex),d=Math.min(r.newRangeEndOffset,l.endIndex),u=r.newRange.intersectRanges(new Range$2(l.startPosition.row+1,l.startPosition.column+1,l.endPosition.row+1,l.endPosition.column+1));t.push({newRange:u,newRangeEndOffset:d,newRangeStartOffset:c}),d<r.newRangeEndOffset?(r.newRange=Range$2.fromPositions(u.getEndPosition(),r.newRange.getEndPosition()),r.newRangeStartOffset=d+1):s++}}return t}async _parseAndUpdateTree(e){var s,o;const t=await this._parse();if(t)return(s=this._lastFullyParsed)==null||s.delete(),this._lastFullyParsed=t.copy(),(o=this._lastFullyParsedWithEdits)==null||o.delete(),this._lastFullyParsedWithEdits=t.copy(),t;this._tree.get()||this._parser.reset()}_parse(){let e="fullParse";return this._tree.get()&&(e="incrementalParse"),this._parseAndYield(e)}async _parseAndYield(e){let t=0,s=0;const o=this.textModel.getVersionId();let r;const l=newTimeOutProgressCallback();do{const c=performance.now();r=this._parser.parse((d,u)=>this._parseCallback(d),this._tree.get(),{progressCallback:l,includedRanges:this._ranges}),t+=performance.now()-c,s++,await new Promise(d=>setTimeout0(d))}while(!this._store.isDisposed&&!r&&o===this.textModel.getVersionId());return this._sendParseTimeTelemetry(e,t,s),r&&o===this.textModel.getVersionId()?r:void 0}_parseCallback(e){try{return this.textModel.getTextBuffer().getNearestChunk(e)}catch(t){this._logService.debug("Error getting chunk for tree-sitter parsing",t)}}_setRanges(e){const t=[];if(this._ranges)for(const s of e){let o=!1;for(let r=0;r<this._ranges.length;r++){const l=this._ranges[r];if(rangesEqual(l,s)||rangesIntersect(l,s)){o=!0;break}}o||t.push(s)}else t.push(...e);return this._ranges=e,t}_sendParseTimeTelemetry(e,t,s){this._logService.debug(`Tree parsing (${e}) took ${t} ms and ${s} passes.`),e==="fullParse"?this._telemetryService.publicLog2("treeSitter.fullParse",{languageId:this.languageId,time:t,passes:s}):this._telemetryService.publicLog2("treeSitter.incrementalParse",{languageId:this.languageId,time:t,passes:s})}createParsedTreeSync(e){const t=new this._parserClass;t.setLanguage(this._parser.language);const s=t.parse(e);return t.delete(),s??void 0}};TreeSitterTree=__decorate$2F([__param$2A(5,ILogService),__param$2A(6,ITelemetryService)],TreeSitterTree);function newTimeOutProgressCallback(){let a=performance.now();return function(t){const s=performance.now();return s-a>50?(a=s,!0):!1}}function rangesEqual(a,e){return a.startPosition.row===e.startPosition.row&&a.startPosition.column===e.startPosition.column&&a.endPosition.row===e.endPosition.row&&a.endPosition.column===e.endPosition.column&&a.startIndex===e.startIndex&&a.endIndex===e.endIndex}function rangesIntersect(a,e){return a.startIndex<=e.startIndex&&a.endIndex>=e.startIndex||e.startIndex<=a.startIndex&&e.endIndex>=a.startIndex}const NullState=new class{clone(){return this}equals(a){return this===a}};function nullTokenize(a,e){return new TokenizationResult([new Token$2(0,"",a)],e)}function nullTokenizeEncoded(a,e){const t=new Uint32Array(2);return t[0]=0,t[1]=(a<<0|0|0|32768|2<<24)>>>0,new EncodedTokenizationResult(t,e===null?NullState:e)}class FixedArray{constructor(e){this._default=e,this._store=[]}get(e){return e<this._store.length?this._store[e]:this._default}set(e,t){for(;e>=this._store.length;)this._store[this._store.length]=this._default;this._store[e]=t}replace(e,t,s){if(e>=this._store.length)return;if(t===0){this.insert(e,s);return}else if(s===0){this.delete(e,t);return}const o=this._store.slice(0,e),r=this._store.slice(e+t),l=arrayFill(s,this._default);this._store=o.concat(l,r)}delete(e,t){t===0||e>=this._store.length||this._store.splice(e,t)}insert(e,t){if(t===0||e>=this._store.length)return;const s=[];for(let o=0;o<t;o++)s[o]=this._default;this._store=arrayInsert(this._store,e,s)}}function arrayFill(a,e){const t=[];for(let s=0;s<a;s++)t[s]=e;return t}class ContiguousMultilineTokens{get startLineNumber(){return this._startLineNumber}get endLineNumber(){return this._startLineNumber+this._tokens.length-1}constructor(e,t){this._startLineNumber=e,this._tokens=t}getLineTokens(e){return this._tokens[e-this._startLineNumber]}appendLineTokens(e){this._tokens.push(e)}}class ContiguousMultilineTokensBuilder{constructor(){this._tokens=[]}add(e,t){if(this._tokens.length>0){const s=this._tokens[this._tokens.length-1];if(s.endLineNumber+1===e){s.appendLineTokens(t);return}}this._tokens.push(new ContiguousMultilineTokens(e,[t]))}finalize(){return this._tokens}}class TokenizerWithStateStore{constructor(e,t){this.tokenizationSupport=t,this.initialState=this.tokenizationSupport.getInitialState(),this.store=new TrackingTokenizationStateStore(e)}getStartState(e){return this.store.getStartState(e,this.initialState)}getFirstInvalidLine(){return this.store.getFirstInvalidLine(this.initialState)}}class TokenizerWithStateStoreAndTextModel extends TokenizerWithStateStore{constructor(e,t,s,o){super(e,t),this._textModel=s,this._languageIdCodec=o}updateTokensUntilLine(e,t){const s=this._textModel.getLanguageId();for(;;){const o=this.getFirstInvalidLine();if(!o||o.lineNumber>t)break;const r=this._textModel.getLineContent(o.lineNumber),l=safeTokenize(this._languageIdCodec,s,this.tokenizationSupport,r,!0,o.startState);e.add(o.lineNumber,l.tokens),this.store.setEndState(o.lineNumber,l.endState)}}getTokenTypeIfInsertingCharacter(e,t){const s=this.getStartState(e.lineNumber);if(!s)return 0;const o=this._textModel.getLanguageId(),r=this._textModel.getLineContent(e.lineNumber),l=r.substring(0,e.column-1)+t+r.substring(e.column-1),c=safeTokenize(this._languageIdCodec,o,this.tokenizationSupport,l,!0,s),d=new LineTokens(c.tokens,l,this._languageIdCodec);if(d.getCount()===0)return 0;const u=d.findTokenIndexAtOffset(e.column-1);return d.getStandardTokenType(u)}tokenizeLinesAt(e,t){const s=this.getStartState(e);if(!s)return null;const o=this._textModel.getLanguageId(),r=[];let l=s;for(const c of t){const d=safeTokenize(this._languageIdCodec,o,this.tokenizationSupport,c,!0,l);r.push(new LineTokens(d.tokens,c,this._languageIdCodec)),l=d.endState}return r}hasAccurateTokensForLine(e){const t=this.store.getFirstInvalidEndStateLineNumberOrMax();return e<t}isCheapToTokenize(e){const t=this.store.getFirstInvalidEndStateLineNumberOrMax();return e<t||e===t&&this._textModel.getLineLength(e)<2048}tokenizeHeuristically(e,t,s){if(s<=this.store.getFirstInvalidEndStateLineNumberOrMax())return{heuristicTokens:!1};if(t<=this.store.getFirstInvalidEndStateLineNumberOrMax())return this.updateTokensUntilLine(e,s),{heuristicTokens:!1};let o=this.guessStartState(t);const r=this._textModel.getLanguageId();for(let l=t;l<=s;l++){const c=this._textModel.getLineContent(l),d=safeTokenize(this._languageIdCodec,r,this.tokenizationSupport,c,!0,o);e.add(l,d.tokens),o=d.endState}return{heuristicTokens:!0}}guessStartState(e){let{likelyRelevantLines:t,initialState:s}=findLikelyRelevantLines(this._textModel,e,this);s||(s=this.tokenizationSupport.getInitialState());const o=this._textModel.getLanguageId();let r=s;for(const l of t)r=safeTokenize(this._languageIdCodec,o,this.tokenizationSupport,l,!1,r).endState;return r}}function findLikelyRelevantLines(a,e,t){let s=a.getLineFirstNonWhitespaceColumn(e);const o=[];let r=null;for(let l=e-1;s>1&&l>=1;l--){const c=a.getLineFirstNonWhitespaceColumn(l);if(c!==0&&c<s&&(o.push(a.getLineContent(l)),s=c,r=t==null?void 0:t.getStartState(l),r))break}return o.reverse(),{likelyRelevantLines:o,initialState:r??void 0}}class TrackingTokenizationStateStore{constructor(e){this.lineCount=e,this._tokenizationStateStore=new TokenizationStateStore,this._invalidEndStatesLineNumbers=new RangePriorityQueueImpl,this._invalidEndStatesLineNumbers.addRange(new OffsetRange(1,e+1))}getEndState(e){return this._tokenizationStateStore.getEndState(e)}setEndState(e,t){if(!t)throw new BugIndicatingError("Cannot set null/undefined state");this._invalidEndStatesLineNumbers.delete(e);const s=this._tokenizationStateStore.setEndState(e,t);return s&&e<this.lineCount&&this._invalidEndStatesLineNumbers.addRange(new OffsetRange(e+1,e+2)),s}acceptChange(e,t){this.lineCount+=t-e.length,this._tokenizationStateStore.acceptChange(e,t),this._invalidEndStatesLineNumbers.addRangeAndResize(new OffsetRange(e.startLineNumber,e.endLineNumberExclusive),t)}acceptChanges(e){for(const t of e){const[s]=countEOL(t.text);this.acceptChange(new LineRange(t.range.startLineNumber,t.range.endLineNumber+1),s+1)}}invalidateEndStateRange(e){this._invalidEndStatesLineNumbers.addRange(new OffsetRange(e.startLineNumber,e.endLineNumberExclusive))}getFirstInvalidEndStateLineNumber(){return this._invalidEndStatesLineNumbers.min}getFirstInvalidEndStateLineNumberOrMax(){return this.getFirstInvalidEndStateLineNumber()||Number.MAX_SAFE_INTEGER}allStatesValid(){return this._invalidEndStatesLineNumbers.min===null}getStartState(e,t){return e===1?t:this.getEndState(e-1)}getFirstInvalidLine(e){const t=this.getFirstInvalidEndStateLineNumber();if(t===null)return null;const s=this.getStartState(t,e);if(!s)throw new BugIndicatingError("Start state must be defined");return{lineNumber:t,startState:s}}}class TokenizationStateStore{constructor(){this._lineEndStates=new FixedArray(null)}getEndState(e){return this._lineEndStates.get(e)}setEndState(e,t){const s=this._lineEndStates.get(e);return s&&s.equals(t)?!1:(this._lineEndStates.set(e,t),!0)}acceptChange(e,t){let s=e.length;t>0&&s>0&&(s--,t--),this._lineEndStates.replace(e.startLineNumber,s,t)}}class RangePriorityQueueImpl{constructor(){this._ranges=[]}get min(){return this._ranges.length===0?null:this._ranges[0].start}delete(e){const t=this._ranges.findIndex(s=>s.contains(e));if(t!==-1){const s=this._ranges[t];s.start===e?s.endExclusive===e+1?this._ranges.splice(t,1):this._ranges[t]=new OffsetRange(e+1,s.endExclusive):s.endExclusive===e+1?this._ranges[t]=new OffsetRange(s.start,e):this._ranges.splice(t,1,new OffsetRange(s.start,e),new OffsetRange(e+1,s.endExclusive))}}addRange(e){OffsetRange.addRange(e,this._ranges)}addRangeAndResize(e,t){let s=0;for(;!(s>=this._ranges.length||e.start<=this._ranges[s].endExclusive);)s++;let o=s;for(;!(o>=this._ranges.length||e.endExclusive<this._ranges[o].start);)o++;const r=t-e.length;for(let l=o;l<this._ranges.length;l++)this._ranges[l]=this._ranges[l].delta(r);if(s===o){const l=new OffsetRange(e.start,e.start+t);l.isEmpty||this._ranges.splice(s,0,l)}else{const l=Math.min(e.start,this._ranges[s].start),c=Math.max(e.endExclusive,this._ranges[o-1].endExclusive),d=new OffsetRange(l,c+r);d.isEmpty?this._ranges.splice(s,o-s):this._ranges.splice(s,o-s,d)}}toString(){return this._ranges.map(e=>e.toString()).join(" + ")}}function safeTokenize(a,e,t,s,o,r){let l=null;if(t)try{l=t.tokenizeEncoded(s,o,r.clone())}catch(c){onUnexpectedError(c)}return l||(l=nullTokenizeEncoded(a.encodeLanguageId(e),r)),LineTokens.convertToEndOffset(l.tokens,s.length),l}class DefaultBackgroundTokenizer{constructor(e,t){this._tokenizerWithStateStore=e,this._backgroundTokenStore=t,this._isDisposed=!1,this._isScheduled=!1}dispose(){this._isDisposed=!0}handleChanges(){this._beginBackgroundTokenization()}_beginBackgroundTokenization(){this._isScheduled||!this._tokenizerWithStateStore._textModel.isAttachedToEditor()||!this._hasLinesToTokenize()||(this._isScheduled=!0,runWhenGlobalIdle(e=>{this._isScheduled=!1,this._backgroundTokenizeWithDeadline(e)}))}_backgroundTokenizeWithDeadline(e){const t=Date.now()+e.timeRemaining(),s=()=>{this._isDisposed||!this._tokenizerWithStateStore._textModel.isAttachedToEditor()||!this._hasLinesToTokenize()||(this._backgroundTokenizeForAtLeast1ms(),Date.now()<t?setTimeout0(s):this._beginBackgroundTokenization())};s()}_backgroundTokenizeForAtLeast1ms(){const e=this._tokenizerWithStateStore._textModel.getLineCount(),t=new ContiguousMultilineTokensBuilder,s=StopWatch.create(!1);do if(s.elapsed()>1||this._tokenizeOneInvalidLine(t)>=e)break;while(this._hasLinesToTokenize());this._backgroundTokenStore.setTokens(t.finalize()),this.checkFinished()}_hasLinesToTokenize(){return this._tokenizerWithStateStore?!this._tokenizerWithStateStore.store.allStatesValid():!1}_tokenizeOneInvalidLine(e){var s;const t=(s=this._tokenizerWithStateStore)==null?void 0:s.getFirstInvalidLine();return t?(this._tokenizerWithStateStore.updateTokensUntilLine(e,t.lineNumber),t.lineNumber):this._tokenizerWithStateStore._textModel.getLineCount()+1}checkFinished(){this._isDisposed||this._tokenizerWithStateStore.store.allStatesValid()&&this._backgroundTokenStore.backgroundTokenizationFinished()}requestTokens(e,t){this._tokenizerWithStateStore.store.invalidateEndStateRange(new LineRange(e,t))}}class ListNode{get children(){return this._children}get length(){return this._length}constructor(e){this.height=e,this._children=[],this._length=0}static create(e,t){const s=new ListNode(e.height+1);return s.appendChild(e),s.appendChild(t),s}canAppendChild(){return this._children.length<3}appendChild(e){if(!this.canAppendChild())throw new Error("Cannot insert more than 3 children in a ListNode");this._children.push(e),this._length+=e.length,this._updateParentLength(e.length),isLeaf(e)||(e.parent=this)}_updateParentLength(e){let t=this.parent;for(;t;)t._length+=e,t=t.parent}unappendChild(){const e=this._children.pop();return this._length-=e.length,this._updateParentLength(-e.length),e}prependChild(e){if(this._children.length>=3)throw new Error("Cannot prepend more than 3 children in a ListNode");this._children.unshift(e),this._length+=e.length,this._updateParentLength(e.length),isLeaf(e)||(e.parent=this)}unprependChild(){const e=this._children.shift();return this._length-=e.length,this._updateParentLength(-e.length),e}lastChild(){return this._children[this._children.length-1]}dispose(){this._children.splice(0,this._children.length)}}var TokenQuality;(function(a){a[a.None=0]="None",a[a.ViewportGuess=1]="ViewportGuess",a[a.EditGuess=2]="EditGuess",a[a.Accurate=3]="Accurate"})(TokenQuality||(TokenQuality={}));function isLeaf(a){return a.token!==void 0}function append(a,e){let t=a;const s=[];let o;for(;;){if(e.height===t.height){o=e;break}if(isLeaf(t))throw new Error("unexpected");s.push(t),t=t.lastChild()}for(let r=s.length-1;r>=0;r--){const l=s[r];o&&(l.children.length>=3?o=ListNode.create(l.unappendChild(),o):(l.appendChild(o),o=void 0))}if(o){const r=new ListNode(o.height+1);return r.appendChild(a),r.appendChild(o),r}else return a}function prepend(a,e){let t=a;const s=[];for(;e.height!==t.height;){if(isLeaf(t))throw new Error("unexpected");s.push(t),t=t.children[0]}let o=e;for(let r=s.length-1;r>=0;r--){const l=s[r];o&&(l.children.length>=3?o=ListNode.create(o,l.unprependChild()):(l.prependChild(o),o=void 0))}return o?ListNode.create(o,a):a}function concat$1(a,e){return a.height===e.height?ListNode.create(a,e):a.height>e.height?append(a,e):prepend(e,a)}class TokenStore{constructor(e){this._textModel=e,this._root=this.createEmptyRoot()}createEmptyRoot(){return{length:this._textModel.getValueLength(),token:0,height:0,tokenQuality:TokenQuality.None}}buildStore(e,t){this._root=this.createFromUpdates(e,t)}createFromUpdates(e,t){if(e.length===0)return this.createEmptyRoot();let s={length:e[0].length,token:e[0].token,height:0,tokenQuality:t};for(let o=1;o<e.length;o++)s=append(s,{length:e[o].length,token:e[o].token,height:0,tokenQuality:t});return s}update(e,t,s){t.length!==0&&this.replace(e,t[0].startOffsetInclusive,t,s)}delete(e,t){this.replace(e,t,[],TokenQuality.EditGuess)}replace(e,t,s,o){const r=t+e,l=[],c=[],d=[{node:this._root,offset:0}];for(;d.length>0;){const f=d.pop(),p=f.offset;if(p<t&&p+f.node.length<=t){isLeaf(f.node)||(f.node.parent=void 0),l.push(f.node);continue}else isLeaf(f.node)&&p<t&&l.push({length:t-p,token:f.node.token,height:0,tokenQuality:f.node.tokenQuality});if(!(t<=p&&p+f.node.length<=r)){if(p>=r){isLeaf(f.node)||(f.node.parent=void 0),c.push(f.node);continue}else if(isLeaf(f.node)&&p+f.node.length>r){c.push({length:p+f.node.length-r,token:f.node.token,height:0,tokenQuality:f.node.tokenQuality});continue}if(!isLeaf(f.node)){let m=p+f.node.length;for(let _=f.node.children.length-1;_>=0;_--)m-=f.node.children[_].length,d.push({node:f.node.children[_],offset:m})}}}let u;s.length>0?u=l.concat(this.createFromUpdates(s,o),c):u=l.concat(c);let g=u[0];for(let f=1;f<u.length;f++)g=concat$1(g,u[f]);this._root=g??this.createEmptyRoot()}traverseInOrderInRange(e,t,s){const o=[{node:this._root,offset:0}];for(;o.length>0;){const{node:r,offset:l}=o.pop();if(!(l+r.length<=e||l>=t)){if(s(r,l))return;if(!isLeaf(r)){let d=l+r.length;for(let u=r.children.length-1;u>=0;u--)d-=r.children[u].length,o.push({node:r.children[u],offset:d})}}}}getTokenAt(e){let t;return this.traverseInOrderInRange(e,this._root.length,(s,o)=>isLeaf(s)?(t={token:s.token,startOffsetInclusive:o,length:s.length},!0):!1),t}getTokensInRange(e,t){const s=[];return this.traverseInOrderInRange(e,t,(o,r)=>{if(isLeaf(o)){let l=o.length,c=r;r<e&&r+o.length>t?(c=e,l=t-e):r<e?(l-=e-r,c=e):r+o.length>t&&(l-=r+o.length-t),s.push({token:o.token,startOffsetInclusive:c,length:l})}return!1}),s}markForRefresh(e,t){this.traverseInOrderInRange(e,t,s=>(isLeaf(s)&&(s.tokenQuality=TokenQuality.None),!1))}rangeHasTokens(e,t,s){let o=!0;return this.traverseInOrderInRange(e,t,r=>(isLeaf(r)&&r.tokenQuality<s&&(o=!1),!1)),o}rangeNeedsRefresh(e,t){let s=!1;return this.traverseInOrderInRange(e,t,o=>(isLeaf(o)&&o.tokenQuality!==TokenQuality.Accurate&&(s=!0),!1)),s}getNeedsRefresh(){const e=[];return this.traverseInOrderInRange(0,this._textModel.getValueLength(),(t,s)=>(isLeaf(t)&&t.tokenQuality!==TokenQuality.Accurate&&(e.length>0&&e[e.length-1].endOffset===s?e[e.length-1].endOffset+=t.length:e.push({startOffset:s,endOffset:s+t.length})),!1)),e}dispose(){const e=[[this._root,!1]];for(;e.length>0;){const[t,s]=e.pop();if(!isLeaf(t))if(s)t.dispose(),t.parent=void 0;else{e.push([t,!0]);for(let o=t.children.length-1;o>=0;o--)e.push([t.children[o],!1])}}this._root=void 0}}const ITreeSitterThemeService=createDecorator("treeSitterThemeService");var __decorate$2E=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2z=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let TreeSitterTokenizationImpl=class extends Disposable{get _textModel(){return this._tree.textModel}constructor(e,t,s,o,r){super(),this._tree=e,this._highlightingQueries=t,this._languageIdCodec=s,this._visibleLineRanges=o,this._treeSitterThemeService=r,this._onDidChangeTokens=this._register(new Emitter$1),this.onDidChangeTokens=this._onDidChangeTokens.event,this._onDidCompleteBackgroundTokenization=this._register(new Emitter$1),this.onDidChangeBackgroundTokenization=this._onDidCompleteBackgroundTokenization.event,this._encodedLanguageId=this._languageIdCodec.encodeLanguageId(this._tree.languageId),this._register(runOnChange(this._treeSitterThemeService.onChange,()=>{this._updateTheme()})),this._tokenStore=this._register(new TokenStore(this._textModel)),this._accurateVersion=this._textModel.getVersionId(),this._guessVersion=this._textModel.getVersionId(),this._tokenStore.buildStore(this._createEmptyTokens(),TokenQuality.None),this._register(autorun(l=>{const c=this._visibleLineRanges.read(l);this._parseAndTokenizeViewPort(c)})),this._register(autorunHandleChanges({owner:this,changeTracker:recordChanges({tree:this._tree.tree})},(l,c)=>{var u;const d=(u=c.changes.at(0))==null?void 0:u.change;if(c.changes.length>1)throw new BugIndicatingError("The tree changed twice in one transaction. This is currently not supported and should not happen.");if(!d)c.tree&&this._firstTreeUpdate(this._tree.treeLastParsedVersion.read(l));else{if(this.hasTokens())for(const g of d.ranges)this._markForRefresh(g.newRange);this.hasTokens()?this._handleTreeUpdate(d.ranges,d.versionId):this._firstTreeUpdate(d.versionId)}}))}handleContentChanged(e){this._guessVersion=e.versionId;for(const t of e.changes)if(t.text.length>t.rangeLength){const s=t.rangeOffset>0?t.rangeOffset-1:t.rangeOffset,o=this._tokenStore.getTokenAt(s);let r;o?(r={startOffsetInclusive:o.startOffsetInclusive,length:o.length+t.text.length-t.rangeLength,token:o.token},this._tokenStore.markForRefresh(s,t.rangeOffset+(t.text.length>t.rangeLength?t.text.length:t.rangeLength))):r={startOffsetInclusive:s,length:t.text.length,token:0},this._tokenStore.update((o==null?void 0:o.length)??0,[r],TokenQuality.EditGuess)}else if(t.text.length<t.rangeLength){const s=t.rangeLength-t.text.length;this._tokenStore.delete(s,t.rangeOffset)}}getLineTokens(e){const t=this._textModel.getLineContent(e),s=this.getTokens(e);return new LineTokens(s,t,this._languageIdCodec)}_createEmptyTokens(){const e=this._emptyToken(),t=this._textModel.getValueLength();return[this._emptyTokensForOffsetAndLength(0,t,e)]}_emptyToken(){return this._treeSitterThemeService.findMetadata([],this._encodedLanguageId,!1,void 0)}_emptyTokensForOffsetAndLength(e,t,s){return{token:s,length:e+t,startOffsetInclusive:0}}hasAccurateTokensForLine(e){return this.hasTokens(new Range$2(e,1,e,this._textModel.getLineMaxColumn(e)))}tokenizeLinesAt(e,t){const s=this._guessTokensForLinesContent(e,t),o=[];if(!s)return null;for(let r=0;r<s.length;r++)o.push(new LineTokens(s[r],t[r],this._languageIdCodec));return o}_rangeHasTokens(e,t){return this._tokenStore.rangeHasTokens(this._textModel.getOffsetAt(e.getStartPosition()),this._textModel.getOffsetAt(e.getEndPosition()),t)}hasTokens(e){return!e||this._guessVersion===this._accurateVersion?!0:!this._tokenStore.rangeNeedsRefresh(this._textModel.getOffsetAt(e.getStartPosition()),this._textModel.getOffsetAt(e.getEndPosition()))}getTokens(e){const t=this._textModel.getOffsetAt({lineNumber:e,column:1}),s=this._textModel.getOffsetAt({lineNumber:e,column:this._textModel.getLineLength(e)+1}),o=this._tokenStore.getTokensInRange(t,s),r=new Uint32Array(o.length*2);for(let l=0;l<o.length;l++)r[l*2]=o[l].startOffsetInclusive-t+o[l].length,r[l*2+1]=o[l].token;return r}getTokensInRange(e,t,s,o){const r=o?this._tokenizeCapturesWithMetadata(o,t,s):this._tokenize(e,t,s);if(r!=null&&r.endOffsetsAndMetadata)return this._rangeTokensAsUpdates(t,r.endOffsetsAndMetadata)}_updateTokensInStore(e,t,s){this._accurateVersion=e;for(const o of t){const r=o.newTokens.length>0?o.newTokens[o.newTokens.length-1]:void 0;let l;r&&this._guessVersion>=e?l=r.startOffsetInclusive+r.length-o.newTokens[0].startOffsetInclusive:o.oldRangeLength?l=o.oldRangeLength:l=0,this._tokenStore.update(l,o.newTokens,s)}}_markForRefresh(e){this._tokenStore.markForRefresh(this._textModel.getOffsetAt(e.getStartPosition()),this._textModel.getOffsetAt(e.getEndPosition()))}_getNeedsRefresh(){const e=this._tokenStore.getNeedsRefresh();return e?e.map(t=>({range:Range$2.fromPositions(this._textModel.getPositionAt(t.startOffset),this._textModel.getPositionAt(t.endOffset)),startOffset:t.startOffset,endOffset:t.endOffset})):[]}_parseAndTokenizeViewPort(e){const t=e.map(s=>s.toInclusiveRange()).filter(isDefined);for(const s of t){const o=this._textModel.getOffsetAt(s.getStartPosition()),r=this._textModel.getOffsetAt(s.getEndPosition()),l=this._textModel.getVersionId();if(this._rangeHasTokens(s,TokenQuality.ViewportGuess))continue;const c=this._textModel.getValueInRange(s),d=this._forceParseAndTokenizeContent(s,o,r,c,!0);if(!d||this._rangeHasTokens(s,TokenQuality.ViewportGuess)||d.length===0)continue;const u=d[d.length-1],g=u.startOffsetInclusive+u.length-d[0].startOffsetInclusive;this._updateTokensInStore(l,[{newTokens:d,oldRangeLength:g}],TokenQuality.ViewportGuess),this._onDidChangeTokens.fire({changes:{semanticTokensApplied:!1,ranges:[{fromLineNumber:s.startLineNumber,toLineNumber:s.endLineNumber}]}})}}_guessTokensForLinesContent(e,t){if(t.length===0)return;const s=t.join(this._textModel.getEOL()),o=new Range$2(1,1,e+t.length,t[t.length-1].length+1),r=this._textModel.getOffsetAt({lineNumber:e,column:1}),l=this._forceParseAndTokenizeContent(o,r,r+s.length,s,!1);if(!l)return;const c=new Array(t.length);let d=0,u=0,g=0;for(let f=0;f<t.length;f++){const p=[];let m=!1;for(let _=d;!m&&_<l.length;_++){const C=l[_],b=C.endOffset-g,v=u-g;if(b<=t[f].length)p.push({endOffset:b,metadata:C.metadata}),d++;else if(v<t[f].length){const S={endOffset:t[f].length,metadata:C.metadata};p.push(S),m=!0}else m=!0;u=C.endOffset}c[f]=this._endOffsetTokensToUint32Array(p),g+=t[f].length+this._textModel.getEOL().length}return c}_forceParseAndTokenizeContent(e,t,s,o,r){const l=findLikelyRelevantLines(this._textModel,e.startLineNumber).likelyRelevantLines,c=l.join(this._textModel.getEOL()),d=this._tree.createParsedTreeSync(`${c}${o}`);if(!d)return;const u=new Range$2(1,1,e.endLineNumber-e.startLineNumber+1+l.length,e.endColumn),g=this.captureAtRange(u),f=this._tokenizeCapturesWithMetadata(g,c.length,s-t+c.length);if(d.delete(),!!f)return r?this._rangeTokensAsUpdates(t,f.endOffsetsAndMetadata,c.length):f.endOffsetsAndMetadata}_firstTreeUpdate(e){return this._setViewPortTokens(e)}_setViewPortTokens(e){const t=this._visibleLineRanges.get().map(s=>{const o=s.toInclusiveRange();if(!o)return;const r=this._textModel.getOffsetAt(o.getStartPosition()),l=this._textModel.getOffsetAt(o.getEndPosition());return{newRange:o,newRangeEndOffset:l,newRangeStartOffset:r}}).filter(isDefined);return this._handleTreeUpdate(t,e)}_handleTreeUpdate(e,t){const s=[];for(let l=0;l<e.length;l++)if(e[l].newRange.endLineNumber-e[l].newRange.startLineNumber>1e3){const d=e[l].newRange.endLineNumber;let u=e[l].newRange.startLineNumber,g=e[l].newRange.startColumn,f=u+1e3;do{const p=new Position$1(u,g),m=f===e[l].newRange.endLineNumber?e[l].newRange.endColumn:this._textModel.getLineMaxColumn(f),_=new Position$1(f,m),C=Range$2.fromPositions(p,_);s.push({range:C,startOffset:this._textModel.getOffsetAt(C.getStartPosition()),endOffset:this._textModel.getOffsetAt(C.getEndPosition())}),u=f+1,g=1,f<d&&f+1e3>d?f=d:f=f+1e3}while(f<=d)}else if(l===0||s[l-1].endOffset<e[l].newRangeStartOffset)s.push({range:e[l].newRange,startOffset:e[l].newRangeStartOffset,endOffset:e[l].newRangeEndOffset});else if(s[l-1].endOffset<e[l].newRangeEndOffset){const d=this._textModel.getPositionAt(s[l-1].endOffset+1),u=new Range$2(d.lineNumber,d.column,e[l].newRange.endLineNumber,e[l].newRange.endColumn);s.push({range:u,startOffset:s[l-1].endOffset+1,endOffset:e[l].newRangeEndOffset})}const r=s.map(l=>this._getCaptures(l.range));return this._updateTreeForRanges(s,t,r).then(()=>{!this._textModel.isDisposed()&&this._tree.treeLastParsedVersion.get()===this._textModel.getVersionId()&&this._refreshNeedsRefresh(t)})}async _updateTreeForRanges(e,t,s){let o;for(let r=0;r<e.length&&!(!this._textModel.isDisposed()&&t!==this._textModel.getVersionId());r++){const l=s[r],c=e[r],d=this.getTokensInRange(c.range,c.startOffset,c.endOffset,l);d?o={newTokens:d}:o={newTokens:[]},this._updateTokensInStore(t,[o],TokenQuality.Accurate),this._onDidChangeTokens.fire({changes:{semanticTokensApplied:!1,ranges:[{fromLineNumber:c.range.getStartPosition().lineNumber,toLineNumber:c.range.getEndPosition().lineNumber}]}}),await new Promise(u=>setTimeout0(u))}this._onDidCompleteBackgroundTokenization.fire()}_refreshNeedsRefresh(e){const t=this._getNeedsRefresh();if(t.length===0)return;const s=new Array(t.length);for(let o=0;o<t.length;o++){const r=t[o];s[o]={newRange:r.range,newRangeStartOffset:r.startOffset,newRangeEndOffset:r.endOffset}}this._handleTreeUpdate(s,e)}_rangeTokensAsUpdates(e,t,s){const o=[];let r=0;for(const l of t){if(l.endOffset<=r||s&&l.endOffset<s)continue;let c;s&&r<s?c={startOffsetInclusive:e+s,length:l.endOffset-s,token:l.metadata}:c={startOffsetInclusive:e+r,length:l.endOffset-r,token:l.metadata},o.push(c),r=l.endOffset}return o}_updateTheme(){const e=this._textModel.getFullModelRange();this._markForRefresh(e),this._parseAndTokenizeViewPort(this._visibleLineRanges.get())}captureAtRange(e){const t=this._tree.tree.get();return t?this._highlightingQueries.captures(t.rootNode,{startPosition:{row:e.startLineNumber-1,column:e.startColumn-1},endPosition:{row:e.endLineNumber-1,column:e.endColumn-1}}).map(s=>({name:s.name,text:s.node.text,node:{startIndex:s.node.startIndex,endIndex:s.node.endIndex,startPosition:{lineNumber:s.node.startPosition.row+1,column:s.node.startPosition.column+1},endPosition:{lineNumber:s.node.endPosition.row+1,column:s.node.endPosition.column+1}},encodedLanguageId:this._encodedLanguageId})):[]}captureAtRangeWithInjections(e){const t=this.captureAtRange(e);for(let s=0;s<t.length;s++){const o=t[s],r=o.node.startPosition.lineNumber,l=o.node.endPosition.lineNumber,c=o.node.startPosition.column,d=o.node.endPosition.column,u=r>e.startLineNumber&&r<e.endLineNumber?r:e.startLineNumber,g=l>e.startLineNumber&&l<e.endLineNumber?l:e.endLineNumber,f=r===e.startLineNumber?c<e.startColumn?e.startColumn:c:r<e.startLineNumber?e.startColumn:c,p=l===e.endLineNumber?d>e.endColumn?e.endColumn:d:l>e.endLineNumber?e.endColumn:d,m=new Range$2(u,f,g,p),_=this._getInjectionCaptures(o,m);_&&_.length>0&&(t.splice(s+1,0,..._),s+=_.length)}return t}tokenizeEncoded(e){const t=this._tokenizeEncoded(e);if(!t)return;const s=this._rangeTokensAsUpdates(this._textModel.getOffsetAt({lineNumber:e,column:1}),t.result);t.versionId===this._textModel.getVersionId()&&this._updateTokensInStore(t.versionId,[{newTokens:s,oldRangeLength:this._textModel.getLineLength(e)}],TokenQuality.Accurate)}_getCaptures(e){return this.captureAtRangeWithInjections(e)}_tokenize(e,t,s){const o=this._getCaptures(e),r=this._tokenizeCapturesWithMetadata(o,t,s);if(r)return{...r,versionId:this._tree.treeLastParsedVersion.get()}}_createTokensFromCaptures(e,t,s){const o=this._tree.tree.get(),r=StopWatch.create(),l=s-t,c=this._languageIdCodec.encodeLanguageId(this._tree.languageId),d=TREESITTER_BASE_SCOPES[this._tree.languageId]||"source";if(e.length===0)return o?(r.stop(),{endOffsets:[{endOffset:l,scopes:[],encodedLanguageId:c}],captureTime:r.elapsed()}):void 0;const u=Array(e.length);u.fill({endOffset:0,scopes:[d],encodedLanguageId:c});let g=0;const f=()=>{u.push({endOffset:0,scopes:[d],encodedLanguageId:c})},p=(C,b)=>C.name.includes("punctuation")&&C.text?Array.from(C.text.matchAll(BRACKETS)).map(v=>b+v.index):void 0,m=(C,b,v,S)=>{if(S!==void 0){const y=u[S].scopes;let w=u[S].bracket;if((S>0?u[S-1].endOffset:0)!==b){let x;if(w&&w.length>0){x=[];const E=[];for(let I=0;I<w.length;I++){const D=w[I];D<b?x.push(D):D>v&&E.push(D)}x.length===0&&(x=void 0),E.length===0?w=void 0:w=E}u.splice(S,0,{endOffset:b,scopes:[...y],bracket:x,encodedLanguageId:C.encodedLanguageId}),S++,f(),g++}u.splice(S,0,{endOffset:v,scopes:[...y,C.name],bracket:p(C,b),encodedLanguageId:C.encodedLanguageId}),u[g].bracket=w}else u[g]={endOffset:v,scopes:[d,C.name],bracket:p(C,b),encodedLanguageId:C.encodedLanguageId};g++};for(let C=0;C<e.length;C++){const b=e[C],v=b.node.endIndex<s?b.node.endIndex<t?t:b.node.endIndex:s,S=b.node.startIndex<t?t:b.node.startIndex,y=v-t;let w;const L=v-S;C>0?w=u[g-1].endOffset:w=S-t-1;const x=y-L;if(w>=0&&w<x&&(u[g]={endOffset:x,scopes:[d],encodedLanguageId:this._encodedLanguageId},g++,f()),!(L<0))if(w>=y){let E=g-1,I=u[E].endOffset,D=E>=2?u[E-1].endOffset:0;do{if(D+L===I){if(D===x){u[E].scopes.push(b.name);const k=u[E].bracket;u[E].bracket=k&&k.length>0?k:p(b,x)}}else if(D<=x){m(b,x,y,E);break}E--,D=E>=1?u[E-1].endOffset:0,I=E>=0?u[E].endOffset:0}while(I>x)}else m(b,x,y)}u[g-1].endOffset<l&&l-u[g-1].endOffset>0&&(f(),u[g]={endOffset:l,scopes:u[g].scopes,encodedLanguageId:this._encodedLanguageId},g++);for(let C=0;C<u.length;C++)if(u[C].endOffset===0&&C!==0){u.splice(C,u.length-C);break}const _=r.elapsed();return{endOffsets:u,captureTime:_}}_getInjectionCaptures(e,t){return[]}_tokenizeCapturesWithMetadata(e,t,s){const o=StopWatch.create(),r=this._createTokensFromCaptures(e,t,s);if(!r)return;const l=r.endOffsets;for(let d=0;d<l.length;d++){const u=l[d];u.metadata=this._treeSitterThemeService.findMetadata(u.scopes,u.encodedLanguageId,!!u.bracket&&u.bracket.length>0,void 0)}const c=o.elapsed();return{endOffsetsAndMetadata:l,captureTime:r.captureTime,metadataTime:c}}_tokenizeEncoded(e){const t=this._textModel.getOffsetAt({lineNumber:e,column:1}),s=this._textModel.getLineCount(),o=e+1<=s?this._textModel.getOffsetAt({lineNumber:e+1,column:1}):this._textModel.getValueLength(),r=o-t,l=this._tokenize(new Range$2(e,1,e,r+1),t,o);if(l)return{result:l.endOffsetsAndMetadata,captureTime:l.captureTime,metadataTime:l.metadataTime,versionId:l.versionId}}_endOffsetTokensToUint32Array(e){const t=new Uint32Array(e.length*2);for(let s=0;s<e.length;s++)t[s*2]=e[s].endOffset,t[s*2+1]=e[s].metadata;return t}};TreeSitterTokenizationImpl=__decorate$2E([__param$2z(4,ITreeSitterThemeService)],TreeSitterTokenizationImpl);const TREESITTER_BASE_SCOPES={css:"source.css",typescript:"source.ts",ini:"source.ini",regex:"source.regex"},BRACKETS=/[\{\}\[\]\<\>\(\)]/g,ITreeSitterLibraryService=createDecorator("treeSitterLibraryService");var __decorate$2D=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2y=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let TreeSitterSyntaxTokenBackend=class extends AbstractSyntaxTokenBackend{constructor(e,t,s,o,r,l){super(t,s),this._languageIdObs=e,this._treeSitterLibraryService=r,this._instantiationService=l,this._backgroundTokenizationState=1,this._onDidChangeBackgroundTokenizationState=this._register(new Emitter$1),this.onDidChangeBackgroundTokenizationState=this._onDidChangeBackgroundTokenizationState.event;const c=new ObservablePromise(this._treeSitterLibraryService.getParserClass()),d=derived(this,u=>{var f,p;return(p=(f=c.promiseResult)==null?void 0:f.read(u))==null?void 0:p.getDataOrThrow()});this._tree=derived(this,u=>{const g=d.read(u);if(!g)return;const f=this._languageIdObs.read(u),p=this._treeSitterLibraryService.getLanguage(f,u);if(!p)return;const m=new g;if(u.store.add(toDisposable(()=>{m.delete()})),m.setLanguage(p),this._treeSitterLibraryService.getInjectionQueries(f,u)!==void 0)return u.store.add(this._instantiationService.createInstance(TreeSitterTree,f,void 0,m,g,this._textModel))}),this._tokenizationImpl=derived(this,u=>{const g=this._tree.read(u);if(!g)return;const f=this._treeSitterLibraryService.getHighlightingQueries(g.languageId,u);if(f)return u.store.add(this._instantiationService.createInstance(TreeSitterTokenizationImpl,g,f,this._languageIdCodec,o))}),this._register(autorun(u=>{const g=this._tokenizationImpl.read(u);g&&(u.store.add(g.onDidChangeTokens(f=>{this._onDidChangeTokens.fire(f.changes)})),u.store.add(g.onDidChangeBackgroundTokenization(f=>{this._backgroundTokenizationState=2,this._onDidChangeBackgroundTokenizationState.fire()})))}))}getLineTokens(e){const t=this._tokenizationImpl.get();if(!t){const s=this._textModel.getLineContent(e);return LineTokens.createEmpty(s,this._languageIdCodec)}return t.getLineTokens(e)}todo_resetTokenization(e=!0){e&&this._onDidChangeTokens.fire({semanticTokensApplied:!1,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]})}handleDidChangeAttached(){}handleDidChangeContent(e){if(e.isFlush)this.todo_resetTokenization(!1);else{const s=this._tokenizationImpl.get();s==null||s.handleContentChanged(e)}const t=this._tree.get();t==null||t.handleContentChange(e)}forceTokenization(e){const t=this._tokenizationImpl.get();t&&(t.hasAccurateTokensForLine(e)||t.tokenizeEncoded(e))}hasAccurateTokensForLine(e){const t=this._tokenizationImpl.get();return t?t.hasAccurateTokensForLine(e):!1}isCheapToTokenize(e){return!0}getTokenTypeIfInsertingCharacter(e,t,s){return 0}tokenizeLinesAt(e,t){const s=this._tokenizationImpl.get();return s?s.tokenizeLinesAt(e,t):null}get hasTokens(){const e=this._tokenizationImpl.get();return e?e.hasTokens():!1}};TreeSitterSyntaxTokenBackend=__decorate$2D([__param$2y(4,ITreeSitterLibraryService),__param$2y(5,IInstantiationService)],TreeSitterSyntaxTokenBackend);class SparseTokensStore{constructor(e){this._pieces=[],this._isComplete=!1,this._languageIdCodec=e}flush(){this._pieces=[],this._isComplete=!1}isEmpty(){return this._pieces.length===0}set(e,t,s=void 0){if(this._pieces=e||[],this._isComplete=t,s)for(const o of this._pieces)o.reportIfInvalid(s)}setPartial(e,t){let s=e;if(t.length>0){const r=t[0].getRange(),l=t[t.length-1].getRange();if(!r||!l)return e;s=e.plusRange(r).plusRange(l)}let o=null;for(let r=0,l=this._pieces.length;r<l;r++){const c=this._pieces[r];if(c.endLineNumber<s.startLineNumber)continue;if(c.startLineNumber>s.endLineNumber){o=o||{index:r};break}if(c.removeTokens(s),c.isEmpty()){this._pieces.splice(r,1),r--,l--;continue}if(c.endLineNumber<s.startLineNumber)continue;if(c.startLineNumber>s.endLineNumber){o=o||{index:r};continue}const[d,u]=c.split(s);if(d.isEmpty()){o=o||{index:r};continue}u.isEmpty()||(this._pieces.splice(r,1,d,u),r++,l++,o=o||{index:r})}return o=o||{index:this._pieces.length},t.length>0&&(this._pieces=arrayInsert(this._pieces,o.index,t)),s}isComplete(){return this._isComplete}addSparseTokens(e,t){if(t.getTextLength()===0)return t;const s=this._pieces;if(s.length===0)return t;const o=SparseTokensStore._findFirstPieceWithLine(s,e),r=s[o].getLineTokens(e);if(!r)return t;const l=t.getCount(),c=r.getCount();let d=0;const u=[];let g=0,f=0;const p=(m,_)=>{m!==f&&(f=m,u[g++]=m,u[g++]=_)};for(let m=0;m<c;m++){const _=Math.min(r.getStartCharacter(m),t.getTextLength()),C=Math.min(r.getEndCharacter(m),t.getTextLength()),b=r.getMetadata(m),v=((b&1?2048:0)|(b&2?4096:0)|(b&4?8192:0)|(b&8?16384:0)|(b&16?16744448:0)|(b&32?4278190080:0))>>>0,S=~v>>>0;for(;d<l&&t.getEndOffset(d)<=_;)p(t.getEndOffset(d),t.getMetadata(d)),d++;for(d<l&&t.getStartOffset(d)<_&&p(_,t.getMetadata(d));d<l&&t.getEndOffset(d)<C;)p(t.getEndOffset(d),t.getMetadata(d)&S|b&v),d++;if(d<l)p(C,t.getMetadata(d)&S|b&v),t.getEndOffset(d)===C&&d++;else{const y=Math.min(Math.max(0,d-1),l-1);p(C,t.getMetadata(y)&S|b&v)}}for(;d<l;)p(t.getEndOffset(d),t.getMetadata(d)),d++;return new LineTokens(new Uint32Array(u),t.getLineContent(),this._languageIdCodec)}static _findFirstPieceWithLine(e,t){let s=0,o=e.length-1;for(;s<o;){let r=s+Math.floor((o-s)/2);if(e[r].endLineNumber<t)s=r+1;else if(e[r].startLineNumber>t)o=r-1;else{for(;r>s&&e[r-1].startLineNumber<=t&&t<=e[r-1].endLineNumber;)r--;return r}}return s}acceptEdit(e,t,s,o,r){for(const l of this._pieces)l.acceptEdit(e,t,s,o,r)}}const EMPTY_LINE_TOKENS=new Uint32Array(0).buffer;class ContiguousTokensEditing{static deleteBeginning(e,t){return e===null||e===EMPTY_LINE_TOKENS?e:ContiguousTokensEditing.delete(e,0,t)}static deleteEnding(e,t){if(e===null||e===EMPTY_LINE_TOKENS)return e;const s=toUint32Array(e),o=s[s.length-2];return ContiguousTokensEditing.delete(e,t,o)}static delete(e,t,s){if(e===null||e===EMPTY_LINE_TOKENS||t===s)return e;const o=toUint32Array(e),r=o.length>>>1;if(t===0&&o[o.length-2]===s)return EMPTY_LINE_TOKENS;const l=LineTokens.findIndexInTokensArray(o,t),c=l>0?o[l-1<<1]:0,d=o[l<<1];if(s<d){const m=s-t;for(let _=l;_<r;_++)o[_<<1]-=m;return e}let u,g;c!==t?(o[l<<1]=t,u=l+1<<1,g=t):(u=l<<1,g=c);const f=s-t;for(let m=l+1;m<r;m++){const _=o[m<<1]-f;_>g&&(o[u++]=_,o[u++]=o[(m<<1)+1],g=_)}if(u===o.length)return e;const p=new Uint32Array(u);return p.set(o.subarray(0,u),0),p.buffer}static append(e,t){if(t===EMPTY_LINE_TOKENS)return e;if(e===EMPTY_LINE_TOKENS)return t;if(e===null)return e;if(t===null)return null;const s=toUint32Array(e),o=toUint32Array(t),r=o.length>>>1,l=new Uint32Array(s.length+o.length);l.set(s,0);let c=s.length;const d=s[s.length-2];for(let u=0;u<r;u++)l[c++]=o[u<<1]+d,l[c++]=o[(u<<1)+1];return l.buffer}static insert(e,t,s){if(e===null||e===EMPTY_LINE_TOKENS)return e;const o=toUint32Array(e),r=o.length>>>1;let l=LineTokens.findIndexInTokensArray(o,t);l>0&&o[l-1<<1]===t&&l--;for(let c=l;c<r;c++)o[c<<1]+=s;return e}}function toUint32Array(a){return a instanceof Uint32Array?a:new Uint32Array(a)}class ContiguousTokensStore{constructor(e){this._lineTokens=[],this._len=0,this._languageIdCodec=e}flush(){this._lineTokens=[],this._len=0}get hasTokens(){return this._lineTokens.length>0}getTokens(e,t,s){let o=null;if(t<this._len&&(o=this._lineTokens[t]),o!==null&&o!==EMPTY_LINE_TOKENS)return new LineTokens(toUint32Array(o),s,this._languageIdCodec);const r=new Uint32Array(2);return r[0]=s.length,r[1]=getDefaultMetadata(this._languageIdCodec.encodeLanguageId(e)),new LineTokens(r,s,this._languageIdCodec)}static _massageTokens(e,t,s){const o=s?toUint32Array(s):null;if(t===0){let r=!1;if(o&&o.length>1&&(r=TokenMetadata.getLanguageId(o[1])!==e),!r)return EMPTY_LINE_TOKENS}if(!o||o.length===0){const r=new Uint32Array(2);return r[0]=t,r[1]=getDefaultMetadata(e),r.buffer}return o[o.length-2]=t,o.byteOffset===0&&o.byteLength===o.buffer.byteLength?o.buffer:o}_ensureLine(e){for(;e>=this._len;)this._lineTokens[this._len]=null,this._len++}_deleteLines(e,t){t!==0&&(e+t>this._len&&(t=this._len-e),this._lineTokens.splice(e,t),this._len-=t)}_insertLines(e,t){if(t===0)return;const s=[];for(let o=0;o<t;o++)s[o]=null;this._lineTokens=arrayInsert(this._lineTokens,e,s),this._len+=t}setTokens(e,t,s,o,r){const l=ContiguousTokensStore._massageTokens(this._languageIdCodec.encodeLanguageId(e),s,o);this._ensureLine(t);const c=this._lineTokens[t];return this._lineTokens[t]=l,r?!ContiguousTokensStore._equals(c,l):!1}static _equals(e,t){if(!e||!t)return!e&&!t;const s=toUint32Array(e),o=toUint32Array(t);if(s.length!==o.length)return!1;for(let r=0,l=s.length;r<l;r++)if(s[r]!==o[r])return!1;return!0}acceptEdit(e,t,s){this._acceptDeleteRange(e),this._acceptInsertText(new Position$1(e.startLineNumber,e.startColumn),t,s)}_acceptDeleteRange(e){const t=e.startLineNumber-1;if(t>=this._len)return;if(e.startLineNumber===e.endLineNumber){if(e.startColumn===e.endColumn)return;this._lineTokens[t]=ContiguousTokensEditing.delete(this._lineTokens[t],e.startColumn-1,e.endColumn-1);return}this._lineTokens[t]=ContiguousTokensEditing.deleteEnding(this._lineTokens[t],e.startColumn-1);const s=e.endLineNumber-1;let o=null;s<this._len&&(o=ContiguousTokensEditing.deleteBeginning(this._lineTokens[s],e.endColumn-1)),this._lineTokens[t]=ContiguousTokensEditing.append(this._lineTokens[t],o),this._deleteLines(e.startLineNumber,e.endLineNumber-e.startLineNumber)}_acceptInsertText(e,t,s){if(t===0&&s===0)return;const o=e.lineNumber-1;if(!(o>=this._len)){if(t===0){this._lineTokens[o]=ContiguousTokensEditing.insert(this._lineTokens[o],e.column-1,s);return}this._lineTokens[o]=ContiguousTokensEditing.deleteEnding(this._lineTokens[o],e.column-1),this._lineTokens[o]=ContiguousTokensEditing.insert(this._lineTokens[o],e.column-1,s),this._insertLines(e.lineNumber,t)}}setMultilineTokens(e,t){if(e.length===0)return{changes:[]};const s=[];for(let o=0,r=e.length;o<r;o++){const l=e[o];let c=0,d=0,u=!1;for(let g=l.startLineNumber;g<=l.endLineNumber;g++)u?(this.setTokens(t.getLanguageId(),g-1,t.getLineLength(g),l.getLineTokens(g),!1),d=g):this.setTokens(t.getLanguageId(),g-1,t.getLineLength(g),l.getLineTokens(g),!0)&&(u=!0,c=g,d=g);u&&s.push({fromLineNumber:c,toLineNumber:d})}return{changes:s}}}function getDefaultMetadata(a){return(a<<0|0|0|32768|2<<24|1024)>>>0}class TokenizerSyntaxTokenBackend extends AbstractSyntaxTokenBackend{constructor(e,t,s,o){super(e,t),this.getLanguageId=s,this._tokenizer=null,this._backgroundTokenizationState=1,this._onDidChangeBackgroundTokenizationState=this._register(new Emitter$1),this.onDidChangeBackgroundTokenizationState=this._onDidChangeBackgroundTokenizationState.event,this._defaultBackgroundTokenizer=null,this._backgroundTokenizer=this._register(new MutableDisposable),this._tokens=new ContiguousTokensStore(this._languageIdCodec),this._debugBackgroundTokenizer=this._register(new MutableDisposable),this._attachedViewStates=this._register(new DisposableMap),this._register(TokenizationRegistry.onDidChange(r=>{const l=this.getLanguageId();r.changedLanguages.indexOf(l)!==-1&&this.todo_resetTokenization()})),this.todo_resetTokenization(),this._register(o.onDidChangeVisibleRanges(({view:r,state:l})=>{if(l){let c=this._attachedViewStates.get(r);c||(c=new AttachedViewHandler(()=>this.refreshRanges(c.lineRanges)),this._attachedViewStates.set(r,c)),c.handleStateChange(l)}else this._attachedViewStates.deleteAndDispose(r)}))}todo_resetTokenization(e=!0){var r;this._tokens.flush(),(r=this._debugBackgroundTokens)==null||r.flush(),this._debugBackgroundStates&&(this._debugBackgroundStates=new TrackingTokenizationStateStore(this._textModel.getLineCount())),e&&this._onDidChangeTokens.fire({semanticTokensApplied:!1,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]});const t=()=>{if(this._textModel.isTooLargeForTokenization())return[null,null];const l=TokenizationRegistry.get(this.getLanguageId());if(!l)return[null,null];let c;try{c=l.getInitialState()}catch(d){return onUnexpectedError(d),[null,null]}return[l,c]},[s,o]=t();if(s&&o?this._tokenizer=new TokenizerWithStateStoreAndTextModel(this._textModel.getLineCount(),s,this._textModel,this._languageIdCodec):this._tokenizer=null,this._backgroundTokenizer.clear(),this._defaultBackgroundTokenizer=null,this._tokenizer){const l={setTokens:c=>{this.setTokens(c)},backgroundTokenizationFinished:()=>{if(this._backgroundTokenizationState===2)return;const c=2;this._backgroundTokenizationState=c,this._onDidChangeBackgroundTokenizationState.fire()},setEndState:(c,d)=>{var g;if(!this._tokenizer)return;const u=this._tokenizer.store.getFirstInvalidEndStateLineNumber();u!==null&&c>=u&&((g=this._tokenizer)==null||g.store.setEndState(c,d))}};s&&s.createBackgroundTokenizer&&!s.backgroundTokenizerShouldOnlyVerifyTokens&&(this._backgroundTokenizer.value=s.createBackgroundTokenizer(this._textModel,l)),!this._backgroundTokenizer.value&&!this._textModel.isTooLargeForTokenization()&&(this._backgroundTokenizer.value=this._defaultBackgroundTokenizer=new DefaultBackgroundTokenizer(this._tokenizer,l),this._defaultBackgroundTokenizer.handleChanges()),s!=null&&s.backgroundTokenizerShouldOnlyVerifyTokens&&s.createBackgroundTokenizer?(this._debugBackgroundTokens=new ContiguousTokensStore(this._languageIdCodec),this._debugBackgroundStates=new TrackingTokenizationStateStore(this._textModel.getLineCount()),this._debugBackgroundTokenizer.clear(),this._debugBackgroundTokenizer.value=s.createBackgroundTokenizer(this._textModel,{setTokens:c=>{var d;(d=this._debugBackgroundTokens)==null||d.setMultilineTokens(c,this._textModel)},backgroundTokenizationFinished(){},setEndState:(c,d)=>{var u;(u=this._debugBackgroundStates)==null||u.setEndState(c,d)}})):(this._debugBackgroundTokens=void 0,this._debugBackgroundStates=void 0,this._debugBackgroundTokenizer.value=void 0)}this.refreshAllVisibleLineTokens()}handleDidChangeAttached(){var e;(e=this._defaultBackgroundTokenizer)==null||e.handleChanges()}handleDidChangeContent(e){var t,s,o;if(e.isFlush)this.todo_resetTokenization(!1);else if(!e.isEolChange){for(const r of e.changes){const[l,c]=countEOL(r.text);this._tokens.acceptEdit(r.range,l,c),(t=this._debugBackgroundTokens)==null||t.acceptEdit(r.range,l,c)}(s=this._debugBackgroundStates)==null||s.acceptChanges(e.changes),this._tokenizer&&this._tokenizer.store.acceptChanges(e.changes),(o=this._defaultBackgroundTokenizer)==null||o.handleChanges()}}setTokens(e){const{changes:t}=this._tokens.setMultilineTokens(e,this._textModel);return t.length>0&&this._onDidChangeTokens.fire({semanticTokensApplied:!1,ranges:t}),{changes:t}}refreshAllVisibleLineTokens(){const e=LineRange.joinMany([...this._attachedViewStates].map(([t,s])=>s.lineRanges));this.refreshRanges(e)}refreshRanges(e){for(const t of e)this.refreshRange(t.startLineNumber,t.endLineNumberExclusive-1)}refreshRange(e,t){var l,c;if(!this._tokenizer)return;e=Math.max(1,Math.min(this._textModel.getLineCount(),e)),t=Math.min(this._textModel.getLineCount(),t);const s=new ContiguousMultilineTokensBuilder,{heuristicTokens:o}=this._tokenizer.tokenizeHeuristically(s,e,t),r=this.setTokens(s.finalize());if(o)for(const d of r.changes)(l=this._backgroundTokenizer.value)==null||l.requestTokens(d.fromLineNumber,d.toLineNumber+1);(c=this._defaultBackgroundTokenizer)==null||c.checkFinished()}forceTokenization(e){var s,o;const t=new ContiguousMultilineTokensBuilder;(s=this._tokenizer)==null||s.updateTokensUntilLine(t,e),this.setTokens(t.finalize()),(o=this._defaultBackgroundTokenizer)==null||o.checkFinished()}hasAccurateTokensForLine(e){return this._tokenizer?this._tokenizer.hasAccurateTokensForLine(e):!0}isCheapToTokenize(e){return this._tokenizer?this._tokenizer.isCheapToTokenize(e):!0}getLineTokens(e){var o;const t=this._textModel.getLineContent(e),s=this._tokens.getTokens(this._textModel.getLanguageId(),e-1,t);if(this._debugBackgroundTokens&&this._debugBackgroundStates&&this._tokenizer&&this._debugBackgroundStates.getFirstInvalidEndStateLineNumberOrMax()>e&&this._tokenizer.store.getFirstInvalidEndStateLineNumberOrMax()>e){const r=this._debugBackgroundTokens.getTokens(this._textModel.getLanguageId(),e-1,t);!s.equals(r)&&((o=this._debugBackgroundTokenizer.value)!=null&&o.reportMismatchingTokens)&&this._debugBackgroundTokenizer.value.reportMismatchingTokens(e)}return s}getTokenTypeIfInsertingCharacter(e,t,s){if(!this._tokenizer)return 0;const o=this._textModel.validatePosition(new Position$1(e,t));return this.forceTokenization(o.lineNumber),this._tokenizer.getTokenTypeIfInsertingCharacter(o,s)}tokenizeLinesAt(e,t){return this._tokenizer?(this.forceTokenization(e),this._tokenizer.tokenizeLinesAt(e,t)):null}get hasTokens(){return this._tokens.hasTokens}}var __decorate$2C=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2x=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},TokenizationTextModelPart_1;let TokenizationTextModelPart=TokenizationTextModelPart_1=class extends TextModelPart{constructor(e,t,s,o,r,l,c,d){super(),this._textModel=e,this._bracketPairsTextModelPart=t,this._languageId=s,this._attachedViews=o,this._languageService=r,this._languageConfigurationService=l,this._instantiationService=c,this._treeSitterLibraryService=d,this._languageIdObs=observableValue(this,this._languageId),this._useTreeSitter=derived(this,g=>{const f=this._languageIdObs.read(g);return this._treeSitterLibraryService.supportsLanguage(f,g)}),this.tokens=derived(this,g=>{let f;return this._useTreeSitter.read(g)?f=g.store.add(this._instantiationService.createInstance(TreeSitterSyntaxTokenBackend,this._languageIdObs,this._languageService.languageIdCodec,this._textModel,this._attachedViews.visibleLineRanges)):f=g.store.add(new TokenizerSyntaxTokenBackend(this._languageService.languageIdCodec,this._textModel,()=>this._languageId,this._attachedViews)),g.store.add(f.onDidChangeTokens(p=>{this._emitModelTokensChangedEvent(p)})),g.store.add(f.onDidChangeBackgroundTokenizationState(p=>{this._bracketPairsTextModelPart.handleDidChangeBackgroundTokenizationState()})),f});let u=!1;this.tokens.recomputeInitiallyAndOnChange(this._store,g=>{u&&g.todo_resetTokenization(),u=!0}),this._semanticTokens=new SparseTokensStore(this._languageService.languageIdCodec),this._onDidChangeLanguage=this._register(new Emitter$1),this.onDidChangeLanguage=this._onDidChangeLanguage.event,this._onDidChangeLanguageConfiguration=this._register(new Emitter$1),this.onDidChangeLanguageConfiguration=this._onDidChangeLanguageConfiguration.event,this._onDidChangeTokens=this._register(new Emitter$1),this.onDidChangeTokens=this._onDidChangeTokens.event}handleLanguageConfigurationServiceChange(e){e.affects(this._languageId)&&this._onDidChangeLanguageConfiguration.fire({})}handleDidChangeContent(e){if(e.isFlush)this._semanticTokens.flush();else if(!e.isEolChange)for(const t of e.changes){const[s,o,r]=countEOL(t.text);this._semanticTokens.acceptEdit(t.range,s,o,r,t.text.length>0?t.text.charCodeAt(0):0)}this.tokens.get().handleDidChangeContent(e)}handleDidChangeAttached(){this.tokens.get().handleDidChangeAttached()}getLineTokens(e){this.validateLineNumber(e);const t=this.tokens.get().getLineTokens(e);return this._semanticTokens.addSparseTokens(e,t)}_emitModelTokensChangedEvent(e){this._textModel._isDisposing()||(this._bracketPairsTextModelPart.handleDidChangeTokens(e),this._onDidChangeTokens.fire(e))}validateLineNumber(e){if(e<1||e>this._textModel.getLineCount())throw new BugIndicatingError("Illegal value for lineNumber")}get hasTokens(){return this.tokens.get().hasTokens}resetTokenization(){this.tokens.get().todo_resetTokenization()}get backgroundTokenizationState(){return this.tokens.get().backgroundTokenizationState}forceTokenization(e){this.validateLineNumber(e),this.tokens.get().forceTokenization(e)}hasAccurateTokensForLine(e){return this.validateLineNumber(e),this.tokens.get().hasAccurateTokensForLine(e)}isCheapToTokenize(e){return this.validateLineNumber(e),this.tokens.get().isCheapToTokenize(e)}tokenizeIfCheap(e){this.validateLineNumber(e),this.tokens.get().tokenizeIfCheap(e)}getTokenTypeIfInsertingCharacter(e,t,s){return this.tokens.get().getTokenTypeIfInsertingCharacter(e,t,s)}tokenizeLinesAt(e,t){return this.tokens.get().tokenizeLinesAt(e,t)}setSemanticTokens(e,t){this._semanticTokens.set(e,t,this._textModel),this._emitModelTokensChangedEvent({semanticTokensApplied:e!==null,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]})}hasCompleteSemanticTokens(){return this._semanticTokens.isComplete()}hasSomeSemanticTokens(){return!this._semanticTokens.isEmpty()}setPartialSemanticTokens(e,t){if(this.hasCompleteSemanticTokens())return;const s=this._textModel.validateRange(this._semanticTokens.setPartial(e,t));this._emitModelTokensChangedEvent({semanticTokensApplied:!0,ranges:[{fromLineNumber:s.startLineNumber,toLineNumber:s.endLineNumber}]})}getWordAtPosition(e){this.assertNotDisposed();const t=this._textModel.validatePosition(e),s=this._textModel.getLineContent(t.lineNumber),o=this.getLineTokens(t.lineNumber),r=o.findTokenIndexAtOffset(t.column-1),[l,c]=TokenizationTextModelPart_1._findLanguageBoundaries(o,r),d=getWordAtText(t.column,this.getLanguageConfiguration(o.getLanguageId(r)).getWordDefinition(),s.substring(l,c),l);if(d&&d.startColumn<=e.column&&e.column<=d.endColumn)return d;if(r>0&&l===t.column-1){const[u,g]=TokenizationTextModelPart_1._findLanguageBoundaries(o,r-1),f=getWordAtText(t.column,this.getLanguageConfiguration(o.getLanguageId(r-1)).getWordDefinition(),s.substring(u,g),u);if(f&&f.startColumn<=e.column&&e.column<=f.endColumn)return f}return null}getLanguageConfiguration(e){return this._languageConfigurationService.getLanguageConfiguration(e)}static _findLanguageBoundaries(e,t){const s=e.getLanguageId(t);let o=0;for(let l=t;l>=0&&e.getLanguageId(l)===s;l--)o=e.getStartOffset(l);let r=e.getLineContent().length;for(let l=t,c=e.getCount();l<c&&e.getLanguageId(l)===s;l++)r=e.getEndOffset(l);return[o,r]}getWordUntilPosition(e){const t=this.getWordAtPosition(e);return t?{word:t.word.substr(0,e.column-t.startColumn),startColumn:t.startColumn,endColumn:e.column}:{word:"",startColumn:e.column,endColumn:e.column}}getLanguageId(){return this._languageId}getLanguageIdAtPosition(e,t){const s=this._textModel.validatePosition(new Position$1(e,t)),o=this.getLineTokens(s.lineNumber);return o.getLanguageId(o.findTokenIndexAtOffset(s.column-1))}setLanguageId(e,t="api"){if(this._languageId===e)return;const s={oldLanguage:this._languageId,newLanguage:e,source:t};this._languageId=e,this._languageIdObs.set(e,void 0),this._bracketPairsTextModelPart.handleDidChangeLanguage(s),this._onDidChangeLanguage.fire(s),this._onDidChangeLanguageConfiguration.fire({})}};TokenizationTextModelPart=TokenizationTextModelPart_1=__decorate$2C([__param$2x(4,ILanguageService),__param$2x(5,ILanguageConfigurationService),__param$2x(6,IInstantiationService),__param$2x(7,ITreeSitterLibraryService)],TokenizationTextModelPart);const IUndoRedoService=createDecorator("undoRedoService");class ResourceEditStackSnapshot{constructor(e,t){this.resource=e,this.elements=t}}const si=class si{constructor(){this.id=si._ID++,this.order=1}nextOrder(){return this.id===0?0:this.order++}};si._ID=0,si.None=new si;let UndoRedoGroup=si;const oi=class oi{constructor(){this.id=oi._ID++,this.order=1}nextOrder(){return this.id===0?0:this.order++}};oi._ID=0,oi.None=new oi;let UndoRedoSource=oi;var _a;function groupByMap(a,e){const t=new Map;for(const s of a){const o=e(s);let r=t.get(o);r||(r=[],t.set(o,r)),r.push(s)}return t}function diffSets(a,e){const t=[],s=[];for(const o of a)e.has(o)||t.push(o);for(const o of e)a.has(o)||s.push(o);return{removed:t,added:s}}function intersection(a,e){const t=new Set;for(const s of e)a.has(s)&&t.add(s);return t}class SetWithKey{constructor(e,t){this.toKey=t,this._map=new Map,this[_a]="SetWithKey";for(const s of e)this.add(s)}get size(){return this._map.size}add(e){const t=this.toKey(e);return this._map.set(t,e),this}delete(e){return this._map.delete(this.toKey(e))}has(e){return this._map.has(this.toKey(e))}*entries(){for(const e of this._map.values())yield[e,e]}keys(){return this.values()}*values(){for(const e of this._map.values())yield e}clear(){this._map.clear()}forEach(e,t){this._map.forEach(s=>e.call(t,s,s,this))}[Symbol.iterator](){return this.values()}}_a=Symbol.toStringTag;var __decorate$2B=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2w=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},TextModel_1;function createTextBufferFactory(a){const e=new PieceTreeTextBufferBuilder;return e.acceptChunk(a),e.finish()}function createTextBufferFactoryFromSnapshot(a){const e=new PieceTreeTextBufferBuilder;let t;for(;typeof(t=a.read())=="string";)e.acceptChunk(t);return e.finish()}function createTextBuffer(a,e){let t;return typeof a=="string"?t=createTextBufferFactory(a):isITextSnapshot(a)?t=createTextBufferFactoryFromSnapshot(a):t=a,t.create(e)}let MODEL_ID$1=0;const LIMIT_FIND_COUNT=999,LONG_LINE_BOUNDARY=1e4,LINE_HEIGHT_CEILING=300;class TextModelSnapshot{constructor(e){this._source=e,this._eos=!1}read(){if(this._eos)return null;const e=[];let t=0,s=0;do{const o=this._source.read();if(o===null)return this._eos=!0,t===0?null:e.join("");if(o.length>0&&(e[t++]=o,s+=o.length),s>=64*1024)return e.join("")}while(!0)}}const invalidFunc=()=>{throw new Error("Invalid change accessor")};var Ve;let TextModel=(Ve=class extends Disposable{static resolveOptions(e,t){if(t.detectIndentation){const s=guessIndentation(e,t.tabSize,t.insertSpaces);return new TextModelResolvedOptions({tabSize:s.tabSize,indentSize:"tabSize",insertSpaces:s.insertSpaces,trimAutoWhitespace:t.trimAutoWhitespace,defaultEOL:t.defaultEOL,bracketPairColorizationOptions:t.bracketPairColorizationOptions})}return new TextModelResolvedOptions(t)}get onDidChangeLanguage(){return this._tokenizationTextModelPart.onDidChangeLanguage}get onDidChangeLanguageConfiguration(){return this._tokenizationTextModelPart.onDidChangeLanguageConfiguration}get onDidChangeTokens(){return this._tokenizationTextModelPart.onDidChangeTokens}get onDidChangeOptions(){return this._onDidChangeOptions.event}get onDidChangeAttached(){return this._onDidChangeAttached.event}get onDidChangeLineHeight(){return this._onDidChangeLineHeight.event}get onDidChangeFont(){return this._onDidChangeFont.event}onDidChangeContent(e){return this._eventEmitter.slowEvent(t=>e(t.contentChangedEvent))}onDidChangeContentOrInjectedText(e){return combinedDisposable(this._eventEmitter.fastEvent(t=>e(t)),this._onDidChangeInjectedText.event(t=>e(t)))}_isDisposing(){return this.__isDisposing}get tokenization(){return this._tokenizationTextModelPart}get bracketPairs(){return this._bracketPairs}get guides(){return this._guidesTextModelPart}constructor(e,t,s,o=null,r,l,c,d){super(),this._undoRedoService=r,this._languageService=l,this._languageConfigurationService=c,this.instantiationService=d,this._onWillDispose=this._register(new Emitter$1),this.onWillDispose=this._onWillDispose.event,this._onDidChangeDecorations=this._register(new DidChangeDecorationsEmitter((_,C,b)=>this.handleBeforeFireDecorationsChangedEvent(_,C,b))),this.onDidChangeDecorations=this._onDidChangeDecorations.event,this._onDidChangeOptions=this._register(new Emitter$1),this._onDidChangeAttached=this._register(new Emitter$1),this._onDidChangeInjectedText=this._register(new Emitter$1),this._onDidChangeLineHeight=this._register(new Emitter$1),this._onDidChangeFont=this._register(new Emitter$1),this._eventEmitter=this._register(new DidChangeContentEmitter),this._languageSelectionListener=this._register(new MutableDisposable),this._deltaDecorationCallCnt=0,this._attachedViews=new AttachedViews,MODEL_ID$1++,this.id="$model"+MODEL_ID$1,this.isForSimpleWidget=s.isForSimpleWidget,typeof o>"u"||o===null?this._associatedResource=URI.parse("inmemory://model/"+MODEL_ID$1):this._associatedResource=o,this._attachedEditorCount=0;const{textBuffer:u,disposable:g}=createTextBuffer(e,s.defaultEOL);this._buffer=u,this._bufferDisposable=g;const f=this._buffer.getLineCount(),p=this._buffer.getValueLengthInRange(new Range$2(1,1,f,this._buffer.getLineLength(f)+1),0);s.largeFileOptimizations?(this._isTooLargeForTokenization=p>TextModel_1.LARGE_FILE_SIZE_THRESHOLD||f>TextModel_1.LARGE_FILE_LINE_COUNT_THRESHOLD,this._isTooLargeForHeapOperation=p>TextModel_1.LARGE_FILE_HEAP_OPERATION_THRESHOLD):(this._isTooLargeForTokenization=!1,this._isTooLargeForHeapOperation=!1),this._options=TextModel_1.resolveOptions(this._buffer,s);const m=typeof t=="string"?t:t.languageId;typeof t!="string"&&(this._languageSelectionListener.value=t.onDidChange(()=>this._setLanguage(t.languageId))),this._bracketPairs=this._register(new BracketPairsTextModelPart(this,this._languageConfigurationService)),this._guidesTextModelPart=this._register(new GuidesTextModelPart(this,this._languageConfigurationService)),this._decorationProvider=this._register(new ColorizedBracketPairsDecorationProvider(this)),this._tokenizationTextModelPart=this.instantiationService.createInstance(TokenizationTextModelPart,this,this._bracketPairs,m,this._attachedViews),this._isTooLargeForSyncing=p>TextModel_1._MODEL_SYNC_LIMIT,this._versionId=1,this._alternativeVersionId=1,this._initialUndoRedoSnapshot=null,this._isDisposed=!1,this.__isDisposing=!1,this._instanceId=singleLetterHash(MODEL_ID$1),this._lastDecorationId=0,this._decorations=Object.create(null),this._decorationsTree=new DecorationsTrees,this._commandManager=new EditStack(this,this._undoRedoService),this._isUndoing=!1,this._isRedoing=!1,this._trimAutoWhitespaceLines=null,this._register(this._decorationProvider.onDidChange(()=>{this._onDidChangeDecorations.beginDeferredEmit(),this._onDidChangeDecorations.fire(),this._onDidChangeDecorations.endDeferredEmit()})),this._languageService.requestRichLanguageFeatures(m),this._register(this._languageConfigurationService.onDidChange(_=>{this._bracketPairs.handleLanguageConfigurationServiceChange(_),this._tokenizationTextModelPart.handleLanguageConfigurationServiceChange(_)}))}dispose(){this.__isDisposing=!0,this._onWillDispose.fire(),this._tokenizationTextModelPart.dispose(),this._isDisposed=!0,super.dispose(),this._bufferDisposable.dispose(),this.__isDisposing=!1;const e=new PieceTreeTextBuffer([],"",`
`,!1,!1,!0,!0);e.dispose(),this._buffer=e,this._bufferDisposable=Disposable.None}_assertNotDisposed(){if(this._isDisposed)throw new BugIndicatingError("Model is disposed!")}getTextBuffer(){return this._assertNotDisposed(),this._buffer}_emitContentChangedEvent(e,t){this.__isDisposing||(this._tokenizationTextModelPart.handleDidChangeContent(t),this._bracketPairs.handleDidChangeContent(t),this._eventEmitter.fire(new InternalModelContentChangeEvent(e,t)))}setValue(e,t=EditSources.setValue()){if(this._assertNotDisposed(),e==null)throw illegalArgument();const{textBuffer:s,disposable:o}=createTextBuffer(e,this._options.defaultEOL);this._setValueFromTextBuffer(s,o,t)}_createContentChanged2(e,t,s,o,r,l,c,d,u,g){return{changes:[{range:e,rangeOffset:t,rangeLength:s,text:r}],eol:this._buffer.getEOL(),isEolChange:u,versionId:this.getVersionId(),isUndoing:l,isRedoing:c,isFlush:d,detailedReasons:[g],detailedReasonsChangeLengths:[1]}}_setValueFromTextBuffer(e,t,s){this._assertNotDisposed();const o=this.getFullModelRange(),r=this.getValueLengthInRange(o),l=this.getLineCount(),c=this.getLineMaxColumn(l);this._buffer=e,this._bufferDisposable.dispose(),this._bufferDisposable=t,this._increaseVersionId(),this._decorations=Object.create(null),this._decorationsTree=new DecorationsTrees,this._commandManager.clear(),this._trimAutoWhitespaceLines=null,this._emitContentChangedEvent(new ModelRawContentChangedEvent([new ModelRawFlush],this._versionId,!1,!1),this._createContentChanged2(new Range$2(1,1,l,c),0,r,new Position$1(l,c),this.getValue(),!1,!1,!0,!1,s))}setEOL(e){this._assertNotDisposed();const t=e===1?`\r
`:`
`;if(this._buffer.getEOL()===t)return;const s=this.getFullModelRange(),o=this.getValueLengthInRange(s),r=this.getLineCount(),l=this.getLineMaxColumn(r);this._onBeforeEOLChange(),this._buffer.setEOL(t),this._increaseVersionId(),this._onAfterEOLChange(),this._emitContentChangedEvent(new ModelRawContentChangedEvent([new ModelRawEOLChanged],this._versionId,!1,!1),this._createContentChanged2(new Range$2(1,1,r,l),0,o,new Position$1(r,l),this.getValue(),!1,!1,!1,!0,EditSources.eolChange()))}_onBeforeEOLChange(){this._decorationsTree.ensureAllNodesHaveRanges(this)}_onAfterEOLChange(){const e=this.getVersionId(),t=this._decorationsTree.collectNodesPostOrder();for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.range,c=r.cachedAbsoluteStart-r.start,d=this._buffer.getOffsetAt(l.startLineNumber,l.startColumn),u=this._buffer.getOffsetAt(l.endLineNumber,l.endColumn);r.cachedAbsoluteStart=d,r.cachedAbsoluteEnd=u,r.cachedVersionId=e,r.start=d-c,r.end=u-c,recomputeMaxEnd(r)}}onBeforeAttached(){return this._attachedEditorCount++,this._attachedEditorCount===1&&(this._tokenizationTextModelPart.handleDidChangeAttached(),this._onDidChangeAttached.fire(void 0)),this._attachedViews.attachView()}onBeforeDetached(e){this._attachedEditorCount--,this._attachedEditorCount===0&&(this._tokenizationTextModelPart.handleDidChangeAttached(),this._onDidChangeAttached.fire(void 0)),this._attachedViews.detachView(e)}isAttachedToEditor(){return this._attachedEditorCount>0}getAttachedEditorCount(){return this._attachedEditorCount}isTooLargeForSyncing(){return this._isTooLargeForSyncing}isTooLargeForTokenization(){return this._isTooLargeForTokenization}isTooLargeForHeapOperation(){return this._isTooLargeForHeapOperation}isDisposed(){return this._isDisposed}isDominatedByLongLines(){if(this._assertNotDisposed(),this.isTooLargeForTokenization())return!1;let e=0,t=0;const s=this._buffer.getLineCount();for(let o=1;o<=s;o++){const r=this._buffer.getLineLength(o);r>=LONG_LINE_BOUNDARY?t+=r:e+=r}return t>e}get uri(){return this._associatedResource}getOptions(){return this._assertNotDisposed(),this._options}getFormattingOptions(){return{tabSize:this._options.indentSize,insertSpaces:this._options.insertSpaces}}updateOptions(e){this._assertNotDisposed();const t=typeof e.tabSize<"u"?e.tabSize:this._options.tabSize,s=typeof e.indentSize<"u"?e.indentSize:this._options.originalIndentSize,o=typeof e.insertSpaces<"u"?e.insertSpaces:this._options.insertSpaces,r=typeof e.trimAutoWhitespace<"u"?e.trimAutoWhitespace:this._options.trimAutoWhitespace,l=typeof e.bracketColorizationOptions<"u"?e.bracketColorizationOptions:this._options.bracketPairColorizationOptions,c=new TextModelResolvedOptions({tabSize:t,indentSize:s,insertSpaces:o,defaultEOL:this._options.defaultEOL,trimAutoWhitespace:r,bracketPairColorizationOptions:l});if(this._options.equals(c))return;const d=this._options.createChangeEvent(c);this._options=c,this._bracketPairs.handleDidChangeOptions(d),this._decorationProvider.handleDidChangeOptions(d),this._onDidChangeOptions.fire(d)}detectIndentation(e,t){this._assertNotDisposed();const s=guessIndentation(this._buffer,t,e);this.updateOptions({insertSpaces:s.insertSpaces,tabSize:s.tabSize,indentSize:s.tabSize})}normalizeIndentation(e){return this._assertNotDisposed(),normalizeIndentation(e,this._options.indentSize,this._options.insertSpaces)}getVersionId(){return this._assertNotDisposed(),this._versionId}mightContainRTL(){return this._buffer.mightContainRTL()}mightContainUnusualLineTerminators(){return this._buffer.mightContainUnusualLineTerminators()}removeUnusualLineTerminators(e=null){const t=this.findMatches(UNUSUAL_LINE_TERMINATORS.source,!1,!0,!1,null,!1,1073741824);this._buffer.resetMightContainUnusualLineTerminators(),this.pushEditOperations(e,t.map(s=>({range:s.range,text:null})),()=>null)}mightContainNonBasicASCII(){return this._buffer.mightContainNonBasicASCII()}getAlternativeVersionId(){return this._assertNotDisposed(),this._alternativeVersionId}getInitialUndoRedoSnapshot(){return this._assertNotDisposed(),this._initialUndoRedoSnapshot}getOffsetAt(e){this._assertNotDisposed();const t=this._validatePosition(e.lineNumber,e.column,0);return this._buffer.getOffsetAt(t.lineNumber,t.column)}getPositionAt(e){this._assertNotDisposed();const t=Math.min(this._buffer.getLength(),Math.max(0,e));return this._buffer.getPositionAt(t)}_increaseVersionId(){this._versionId=this._versionId+1,this._alternativeVersionId=this._versionId}_overwriteVersionId(e){this._versionId=e}_overwriteAlternativeVersionId(e){this._alternativeVersionId=e}_overwriteInitialUndoRedoSnapshot(e){this._initialUndoRedoSnapshot=e}getValue(e,t=!1){if(this._assertNotDisposed(),this.isTooLargeForHeapOperation())throw new BugIndicatingError("Operation would exceed heap memory limits");const s=this.getFullModelRange(),o=this.getValueInRange(s,e);return t?this._buffer.getBOM()+o:o}createSnapshot(e=!1){return new TextModelSnapshot(this._buffer.createSnapshot(e))}getValueLength(e,t=!1){this._assertNotDisposed();const s=this.getFullModelRange(),o=this.getValueLengthInRange(s,e);return t?this._buffer.getBOM().length+o:o}getValueInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getValueInRange(this.validateRange(e),t)}getValueLengthInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getValueLengthInRange(this.validateRange(e),t)}getCharacterCountInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getCharacterCountInRange(this.validateRange(e),t)}getLineCount(){return this._assertNotDisposed(),this._buffer.getLineCount()}getLineContent(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new BugIndicatingError("Illegal value for lineNumber");return this._buffer.getLineContent(e)}getLineLength(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new BugIndicatingError("Illegal value for lineNumber");return this._buffer.getLineLength(e)}getLinesContent(){if(this._assertNotDisposed(),this.isTooLargeForHeapOperation())throw new BugIndicatingError("Operation would exceed heap memory limits");return this._buffer.getLinesContent()}getEOL(){return this._assertNotDisposed(),this._buffer.getEOL()}getEndOfLineSequence(){return this._assertNotDisposed(),this._buffer.getEOL()===`
`?0:1}getLineMinColumn(e){return this._assertNotDisposed(),1}getLineMaxColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new BugIndicatingError("Illegal value for lineNumber");return this._buffer.getLineLength(e)+1}getLineFirstNonWhitespaceColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new BugIndicatingError("Illegal value for lineNumber");return this._buffer.getLineFirstNonWhitespaceColumn(e)}getLineLastNonWhitespaceColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new BugIndicatingError("Illegal value for lineNumber");return this._buffer.getLineLastNonWhitespaceColumn(e)}_validateRangeRelaxedNoAllocations(e){const t=this._buffer.getLineCount(),s=e.startLineNumber,o=e.startColumn;let r=Math.floor(typeof s=="number"&&!isNaN(s)?s:1),l=Math.floor(typeof o=="number"&&!isNaN(o)?o:1);if(r<1)r=1,l=1;else if(r>t)r=t,l=this.getLineMaxColumn(r);else if(l<=1)l=1;else{const f=this.getLineMaxColumn(r);l>=f&&(l=f)}const c=e.endLineNumber,d=e.endColumn;let u=Math.floor(typeof c=="number"&&!isNaN(c)?c:1),g=Math.floor(typeof d=="number"&&!isNaN(d)?d:1);if(u<1)u=1,g=1;else if(u>t)u=t,g=this.getLineMaxColumn(u);else if(g<=1)g=1;else{const f=this.getLineMaxColumn(u);g>=f&&(g=f)}return s===r&&o===l&&c===u&&d===g&&e instanceof Range$2&&!(e instanceof Selection$1)?e:new Range$2(r,l,u,g)}_isValidPosition(e,t,s){if(typeof e!="number"||typeof t!="number"||isNaN(e)||isNaN(t)||e<1||t<1||(e|0)!==e||(t|0)!==t)return!1;const o=this._buffer.getLineCount();if(e>o)return!1;if(t===1)return!0;const r=this.getLineMaxColumn(e);if(t>r)return!1;if(s===1){const l=this._buffer.getLineCharCode(e,t-2);if(isHighSurrogate(l))return!1}return!0}_validatePosition(e,t,s){const o=Math.floor(typeof e=="number"&&!isNaN(e)?e:1),r=Math.floor(typeof t=="number"&&!isNaN(t)?t:1),l=this._buffer.getLineCount();if(o<1)return new Position$1(1,1);if(o>l)return new Position$1(l,this.getLineMaxColumn(l));if(r<=1)return new Position$1(o,1);const c=this.getLineMaxColumn(o);if(r>=c)return new Position$1(o,c);if(s===1){const d=this._buffer.getLineCharCode(o,r-2);if(isHighSurrogate(d))return new Position$1(o,r-1)}return new Position$1(o,r)}validatePosition(e){return this._assertNotDisposed(),e instanceof Position$1&&this._isValidPosition(e.lineNumber,e.column,1)?e:this._validatePosition(e.lineNumber,e.column,1)}isValidRange(e){return this._isValidRange(e,1)}_isValidRange(e,t){const s=e.startLineNumber,o=e.startColumn,r=e.endLineNumber,l=e.endColumn;if(!this._isValidPosition(s,o,0)||!this._isValidPosition(r,l,0))return!1;if(t===1){const c=o>1?this._buffer.getLineCharCode(s,o-2):0,d=l>1&&l<=this._buffer.getLineLength(r)?this._buffer.getLineCharCode(r,l-2):0,u=isHighSurrogate(c),g=isHighSurrogate(d);return!u&&!g}return!0}validateRange(e){if(this._assertNotDisposed(),e instanceof Range$2&&!(e instanceof Selection$1)&&this._isValidRange(e,1))return e;const s=this._validatePosition(e.startLineNumber,e.startColumn,0),o=this._validatePosition(e.endLineNumber,e.endColumn,0),r=s.lineNumber,l=s.column,c=o.lineNumber,d=o.column;{const u=l>1?this._buffer.getLineCharCode(r,l-2):0,g=d>1&&d<=this._buffer.getLineLength(c)?this._buffer.getLineCharCode(c,d-2):0,f=isHighSurrogate(u),p=isHighSurrogate(g);return!f&&!p?new Range$2(r,l,c,d):r===c&&l===d?new Range$2(r,l-1,c,d-1):f&&p?new Range$2(r,l-1,c,d+1):f?new Range$2(r,l-1,c,d):new Range$2(r,l,c,d+1)}}modifyPosition(e,t){this._assertNotDisposed();const s=this.getOffsetAt(e)+t;return this.getPositionAt(Math.min(this._buffer.getLength(),Math.max(0,s)))}getFullModelRange(){this._assertNotDisposed();const e=this.getLineCount();return new Range$2(1,1,e,this.getLineMaxColumn(e))}findMatchesLineByLine(e,t,s,o){return this._buffer.findMatchesLineByLine(e,t,s,o)}findMatches(e,t,s,o,r,l,c=LIMIT_FIND_COUNT){this._assertNotDisposed();let d=null;t!==null&&(Array.isArray(t)||(t=[t]),t.every(f=>Range$2.isIRange(f))&&(d=t.map(f=>this.validateRange(f)))),d===null&&(d=[this.getFullModelRange()]),d=d.sort((f,p)=>f.startLineNumber-p.startLineNumber||f.startColumn-p.startColumn);const u=[];u.push(d.reduce((f,p)=>Range$2.areIntersecting(f,p)?f.plusRange(p):(u.push(f),p)));let g;if(!s&&e.indexOf(`
`)<0){const p=new SearchParams(e,s,o,r).parseSearchRequest();if(!p)return[];g=m=>this.findMatchesLineByLine(m,p,l,c)}else g=f=>TextModelSearch.findMatches(this,new SearchParams(e,s,o,r),f,l,c);return u.map(g).reduce((f,p)=>f.concat(p),[])}findNextMatch(e,t,s,o,r,l){this._assertNotDisposed();const c=this.validatePosition(t);if(!s&&e.indexOf(`
`)<0){const u=new SearchParams(e,s,o,r).parseSearchRequest();if(!u)return null;const g=this.getLineCount();let f=new Range$2(c.lineNumber,c.column,g,this.getLineMaxColumn(g)),p=this.findMatchesLineByLine(f,u,l,1);return TextModelSearch.findNextMatch(this,new SearchParams(e,s,o,r),c,l),p.length>0||(f=new Range$2(1,1,c.lineNumber,this.getLineMaxColumn(c.lineNumber)),p=this.findMatchesLineByLine(f,u,l,1),p.length>0)?p[0]:null}return TextModelSearch.findNextMatch(this,new SearchParams(e,s,o,r),c,l)}findPreviousMatch(e,t,s,o,r,l){this._assertNotDisposed();const c=this.validatePosition(t);return TextModelSearch.findPreviousMatch(this,new SearchParams(e,s,o,r),c,l)}pushStackElement(){this._commandManager.pushStackElement()}popStackElement(){this._commandManager.popStackElement()}pushEOL(e){if((this.getEOL()===`
`?0:1)!==e)try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._initialUndoRedoSnapshot===null&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEOL(e)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_validateEditOperation(e){return e instanceof ValidAnnotatedEditOperation?e:new ValidAnnotatedEditOperation(e.identifier||null,this.validateRange(e.range),e.text,e.forceMoveMarkers||!1,e.isAutoWhitespaceEdit||!1,e._isTracked||!1)}_validateEditOperations(e){const t=[];for(let s=0,o=e.length;s<o;s++)t[s]=this._validateEditOperation(e[s]);return t}pushEditOperations(e,t,s,o,r){try{return this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._pushEditOperations(e,this._validateEditOperations(t),s,o,r)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_pushEditOperations(e,t,s,o,r){if(this._options.trimAutoWhitespace&&this._trimAutoWhitespaceLines){const l=t.map(d=>({range:this.validateRange(d.range),text:d.text}));let c=!0;if(e)for(let d=0,u=e.length;d<u;d++){const g=e[d];let f=!1;for(let p=0,m=l.length;p<m;p++){const _=l[p].range,C=_.startLineNumber>g.endLineNumber,b=g.startLineNumber>_.endLineNumber;if(!C&&!b){f=!0;break}}if(!f){c=!1;break}}if(c)for(let d=0,u=this._trimAutoWhitespaceLines.length;d<u;d++){const g=this._trimAutoWhitespaceLines[d],f=this.getLineMaxColumn(g);let p=!0;for(let m=0,_=l.length;m<_;m++){const C=l[m].range,b=l[m].text;if(!(g<C.startLineNumber||g>C.endLineNumber)&&!(g===C.startLineNumber&&C.startColumn===f&&C.isEmpty()&&b&&b.length>0&&b.charAt(0)===`
`)&&!(g===C.startLineNumber&&C.startColumn===1&&C.isEmpty()&&b&&b.length>0&&b.charAt(b.length-1)===`
`)){p=!1;break}}if(p){const m=new Range$2(g,1,g,f);t.push(new ValidAnnotatedEditOperation(null,m,null,!1,!1,!1))}}this._trimAutoWhitespaceLines=null}return this._initialUndoRedoSnapshot===null&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEditOperation(e,t,s,o,r)}_applyUndo(e,t,s,o){const r=e.map(l=>{const c=this.getPositionAt(l.newPosition),d=this.getPositionAt(l.newEnd);return{range:new Range$2(c.lineNumber,c.column,d.lineNumber,d.column),text:l.oldText}});this._applyUndoRedoEdits(r,t,!0,!1,s,o)}_applyRedo(e,t,s,o){const r=e.map(l=>{const c=this.getPositionAt(l.oldPosition),d=this.getPositionAt(l.oldEnd);return{range:new Range$2(c.lineNumber,c.column,d.lineNumber,d.column),text:l.newText}});this._applyUndoRedoEdits(r,t,!1,!0,s,o)}_applyUndoRedoEdits(e,t,s,o,r,l){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._isUndoing=s,this._isRedoing=o,this.applyEdits(e,!1),this.setEOL(t),this._overwriteAlternativeVersionId(r)}finally{this._isUndoing=!1,this._isRedoing=!1,this._eventEmitter.endDeferredEmit(l),this._onDidChangeDecorations.endDeferredEmit()}}applyEdits(e,t,s){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit();const o=this._validateEditOperations(e);return this._doApplyEdits(o,t??!1,s??EditSources.applyEdits())}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_doApplyEdits(e,t,s){const o=this._buffer.getLineCount(),r=this._buffer.applyEdits(e,this._options.trimAutoWhitespace,t),l=this._buffer.getLineCount(),c=r.changes;if(this._trimAutoWhitespaceLines=r.trimAutoWhitespaceLineNumbers,c.length!==0){for(let g=0,f=c.length;g<f;g++){const p=c[g];this._decorationsTree.acceptReplace(p.rangeOffset,p.rangeLength,p.text.length,p.forceMoveMarkers)}const d=[];this._increaseVersionId();let u=o;for(let g=0,f=c.length;g<f;g++){const p=c[g],[m]=countEOL(p.text);this._onDidChangeDecorations.fire();const _=p.range.startLineNumber,C=p.range.endLineNumber,b=C-_,v=m,S=Math.min(b,v),y=v-b,w=l-u-y+_,L=w,x=w+v,E=this._decorationsTree.getInjectedTextInInterval(this,this.getOffsetAt(new Position$1(L,1)),this.getOffsetAt(new Position$1(x,this.getLineMaxColumn(x))),0),I=LineInjectedText.fromDecorations(E),D=new ArrayQueue(I);for(let k=S;k>=0;k--){const N=_+k,R=w+k;D.takeFromEndWhile(A=>A.lineNumber>R);const M=D.takeFromEndWhile(A=>A.lineNumber===R);d.push(new ModelRawLineChanged(N,this.getLineContent(R),M))}if(S<b){const k=_+S;d.push(new ModelRawLinesDeleted(k+1,C))}if(S<v){const k=new ArrayQueue(I),N=_+S,R=v-S,M=l-u-R+N+1,A=[],O=[];for(let P=0;P<R;P++){const W=M+P;O[P]=this.getLineContent(W),k.takeWhile(B=>B.lineNumber<W),A[P]=k.takeWhile(B=>B.lineNumber===W)}d.push(new ModelRawLinesInserted(N+1,_+v,O,A))}u+=y}this._emitContentChangedEvent(new ModelRawContentChangedEvent(d,this.getVersionId(),this._isUndoing,this._isRedoing),{changes:c,eol:this._buffer.getEOL(),isEolChange:!1,versionId:this.getVersionId(),isUndoing:this._isUndoing,isRedoing:this._isRedoing,isFlush:!1,detailedReasons:[s],detailedReasonsChangeLengths:[c.length]})}return r.reverseEdits===null?void 0:r.reverseEdits}undo(){return this._undoRedoService.undo(this.uri)}canUndo(){return this._undoRedoService.canUndo(this.uri)}redo(){return this._undoRedoService.redo(this.uri)}canRedo(){return this._undoRedoService.canRedo(this.uri)}handleBeforeFireDecorationsChangedEvent(e,t,s){if(e&&e.size>0){const r=Array.from(e).map(l=>new ModelRawLineChanged(l,this.getLineContent(l),this._getInjectedTextInLine(l)));this._onDidChangeInjectedText.fire(new ModelInjectedTextChangedEvent(r))}if(t&&t.size>0){const r=Array.from(t).map(l=>new ModelLineHeightChanged(l.ownerId,l.decorationId,l.lineNumber,l.lineHeight));this._onDidChangeLineHeight.fire(new ModelLineHeightChangedEvent$1(r))}if(s&&s.size>0){const r=Array.from(s).map(l=>new ModelFontChanged(l.ownerId,l.lineNumber));this._onDidChangeFont.fire(new ModelFontChangedEvent$1(r))}}changeDecorations(e,t=0){this._assertNotDisposed();try{return this._onDidChangeDecorations.beginDeferredEmit(),this._changeDecorations(t,e)}finally{this._onDidChangeDecorations.endDeferredEmit()}}_changeDecorations(e,t){const s={addDecoration:(r,l)=>this._deltaDecorationsImpl(e,[],[{range:r,options:l}])[0],changeDecoration:(r,l)=>{this._changeDecorationImpl(e,r,l)},changeDecorationOptions:(r,l)=>{this._changeDecorationOptionsImpl(e,r,_normalizeOptions(l))},removeDecoration:r=>{this._deltaDecorationsImpl(e,[r],[])},deltaDecorations:(r,l)=>r.length===0&&l.length===0?[]:this._deltaDecorationsImpl(e,r,l)};let o=null;try{o=t(s)}catch(r){onUnexpectedError(r)}return s.addDecoration=invalidFunc,s.changeDecoration=invalidFunc,s.changeDecorationOptions=invalidFunc,s.removeDecoration=invalidFunc,s.deltaDecorations=invalidFunc,o}deltaDecorations(e,t,s=0){if(this._assertNotDisposed(),e||(e=[]),e.length===0&&t.length===0)return[];try{return this._deltaDecorationCallCnt++,this._deltaDecorationCallCnt>1&&(console.warn("Invoking deltaDecorations recursively could lead to leaking decorations."),onUnexpectedError(new Error("Invoking deltaDecorations recursively could lead to leaking decorations."))),this._onDidChangeDecorations.beginDeferredEmit(),this._deltaDecorationsImpl(s,e,t)}finally{this._onDidChangeDecorations.endDeferredEmit(),this._deltaDecorationCallCnt--}}_getTrackedRange(e){return this.getDecorationRange(e)}_setTrackedRange(e,t,s){const o=e?this._decorations[e]:null;if(!o)return t?this._deltaDecorationsImpl(0,[],[{range:t,options:TRACKED_RANGE_OPTIONS[s]}],!0)[0]:null;if(!t)return this._decorationsTree.delete(o),delete this._decorations[o.id],null;const r=this._validateRangeRelaxedNoAllocations(t),l=this._buffer.getOffsetAt(r.startLineNumber,r.startColumn),c=this._buffer.getOffsetAt(r.endLineNumber,r.endColumn);return this._decorationsTree.delete(o),o.reset(this.getVersionId(),l,c,r),o.setOptions(TRACKED_RANGE_OPTIONS[s]),this._decorationsTree.insert(o),o.id}removeAllDecorationsWithOwnerId(e){if(this._isDisposed)return;const t=this._decorationsTree.collectNodesFromOwner(e);for(let s=0,o=t.length;s<o;s++){const r=t[s];this._decorationsTree.delete(r),delete this._decorations[r.id]}}getDecorationOptions(e){const t=this._decorations[e];return t?t.options:null}getDecorationRange(e){const t=this._decorations[e];return t?this._decorationsTree.getNodeRange(this,t):null}getLineDecorations(e,t=0,s=!1,o=!1){return e<1||e>this.getLineCount()?[]:this.getLinesDecorations(e,e,t,s,o)}getLinesDecorations(e,t,s=0,o=!1,r=!1,l=!1){const c=this.getLineCount(),d=Math.min(c,Math.max(1,e)),u=Math.min(c,Math.max(1,t)),g=this.getLineMaxColumn(u),f=new Range$2(d,1,u,g),p=this._getDecorationsInRange(f,s,o,r,l);return pushMany(p,this._decorationProvider.getDecorationsInRange(f,s,o)),p}getDecorationsInRange(e,t=0,s=!1,o=!1,r=!1,l=!1){const c=this.validateRange(e),d=this._getDecorationsInRange(c,t,s,o,l);return pushMany(d,this._decorationProvider.getDecorationsInRange(c,t,s,r)),d}getOverviewRulerDecorations(e=0,t=!1,s=!1){return this._decorationsTree.getAll(this,e,t,s,!0,!1)}getInjectedTextDecorations(e=0){return this._decorationsTree.getAllInjectedText(this,e)}getCustomLineHeightsDecorations(e=0){return this._decorationsTree.getAllCustomLineHeights(this,e)}_getInjectedTextInLine(e){const t=this._buffer.getOffsetAt(e,1),s=t+this._buffer.getLineLength(e),o=this._decorationsTree.getInjectedTextInInterval(this,t,s,0);return LineInjectedText.fromDecorations(o).filter(r=>r.lineNumber===e)}getFontDecorationsInRange(e,t=0){const s=this._buffer.getOffsetAt(e.startLineNumber,e.startColumn),o=this._buffer.getOffsetAt(e.endLineNumber,e.endColumn);return this._decorationsTree.getFontDecorationsInInterval(this,s,o,t)}getAllDecorations(e=0,t=!1,s=!1){let o=this._decorationsTree.getAll(this,e,t,s,!1,!1);return o=o.concat(this._decorationProvider.getAllDecorations(e,t)),o}getAllMarginDecorations(e=0){return this._decorationsTree.getAll(this,e,!1,!1,!1,!0)}_getDecorationsInRange(e,t,s,o,r){const l=this._buffer.getOffsetAt(e.startLineNumber,e.startColumn),c=this._buffer.getOffsetAt(e.endLineNumber,e.endColumn);return this._decorationsTree.getAllInInterval(this,l,c,t,s,o,r)}getRangeAt(e,t){return this._buffer.getRangeAt(e,t-e)}_changeDecorationImpl(e,t,s){const o=this._decorations[t];if(!o)return;if(o.options.after){const d=this.getDecorationRange(t);this._onDidChangeDecorations.recordLineAffectedByInjectedText(d.endLineNumber)}if(o.options.before){const d=this.getDecorationRange(t);this._onDidChangeDecorations.recordLineAffectedByInjectedText(d.startLineNumber)}if(o.options.lineHeight!==null){const d=this.getDecorationRange(t);this._onDidChangeDecorations.recordLineAffectedByLineHeightChange(e,t,d.startLineNumber,null)}if(o.options.affectsFont){const d=this.getDecorationRange(t);this._onDidChangeDecorations.recordLineAffectedByFontChange(e,o.id,d.startLineNumber)}const r=this._validateRangeRelaxedNoAllocations(s),l=this._buffer.getOffsetAt(r.startLineNumber,r.startColumn),c=this._buffer.getOffsetAt(r.endLineNumber,r.endColumn);this._decorationsTree.delete(o),o.reset(this.getVersionId(),l,c,r),this._decorationsTree.insert(o),this._onDidChangeDecorations.checkAffectedAndFire(o.options),o.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(r.endLineNumber),o.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(r.startLineNumber),o.options.lineHeight!==null&&this._onDidChangeDecorations.recordLineAffectedByLineHeightChange(e,t,r.startLineNumber,o.options.lineHeight),o.options.affectsFont&&this._onDidChangeDecorations.recordLineAffectedByFontChange(e,o.id,r.startLineNumber)}_changeDecorationOptionsImpl(e,t,s){const o=this._decorations[t];if(!o)return;const r=!!(o.options.overviewRuler&&o.options.overviewRuler.color),l=!!(s.overviewRuler&&s.overviewRuler.color);if(this._onDidChangeDecorations.checkAffectedAndFire(o.options),this._onDidChangeDecorations.checkAffectedAndFire(s),o.options.after||s.after){const u=this._decorationsTree.getNodeRange(this,o);this._onDidChangeDecorations.recordLineAffectedByInjectedText(u.endLineNumber)}if(o.options.before||s.before){const u=this._decorationsTree.getNodeRange(this,o);this._onDidChangeDecorations.recordLineAffectedByInjectedText(u.startLineNumber)}if(o.options.lineHeight!==null||s.lineHeight!==null){const u=this._decorationsTree.getNodeRange(this,o);this._onDidChangeDecorations.recordLineAffectedByLineHeightChange(e,t,u.startLineNumber,s.lineHeight)}if(o.options.affectsFont||s.affectsFont){const u=this._decorationsTree.getNodeRange(this,o);this._onDidChangeDecorations.recordLineAffectedByFontChange(e,t,u.startLineNumber)}const c=r!==l,d=isOptionsInjectedText(s)!==isNodeInjectedText(o);c||d?(this._decorationsTree.delete(o),o.setOptions(s),this._decorationsTree.insert(o)):o.setOptions(s)}_deltaDecorationsImpl(e,t,s,o=!1){const r=this.getVersionId(),l=t.length;let c=0;const d=s.length;let u=0;this._onDidChangeDecorations.beginDeferredEmit();try{const g=new Array(d);for(;c<l||u<d;){let f=null;if(c<l){let p;do p=t[c++],f=this._decorations[p];while(!f&&c<l);if(f){if(f.options.after){const m=this._decorationsTree.getNodeRange(this,f);this._onDidChangeDecorations.recordLineAffectedByInjectedText(m.endLineNumber)}if(f.options.before){const m=this._decorationsTree.getNodeRange(this,f);this._onDidChangeDecorations.recordLineAffectedByInjectedText(m.startLineNumber)}if(f.options.lineHeight!==null){const m=this._decorationsTree.getNodeRange(this,f);this._onDidChangeDecorations.recordLineAffectedByLineHeightChange(e,p,m.startLineNumber,null)}if(f.options.affectsFont){const m=this._decorationsTree.getNodeRange(this,f);this._onDidChangeDecorations.recordLineAffectedByFontChange(e,p,m.startLineNumber)}this._decorationsTree.delete(f),o||this._onDidChangeDecorations.checkAffectedAndFire(f.options)}}if(u<d){if(!f){const v=++this._lastDecorationId,S=`${this._instanceId};${v}`;f=new IntervalNode(S,0,0),this._decorations[S]=f}const p=s[u],m=this._validateRangeRelaxedNoAllocations(p.range),_=_normalizeOptions(p.options),C=this._buffer.getOffsetAt(m.startLineNumber,m.startColumn),b=this._buffer.getOffsetAt(m.endLineNumber,m.endColumn);f.ownerId=e,f.reset(r,C,b,m),f.setOptions(_),f.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(m.endLineNumber),f.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(m.startLineNumber),f.options.lineHeight!==null&&this._onDidChangeDecorations.recordLineAffectedByLineHeightChange(e,f.id,m.startLineNumber,f.options.lineHeight),f.options.affectsFont&&this._onDidChangeDecorations.recordLineAffectedByFontChange(e,f.id,m.startLineNumber),o||this._onDidChangeDecorations.checkAffectedAndFire(_),this._decorationsTree.insert(f),g[u]=f.id,u++}else f&&delete this._decorations[f.id]}return g}finally{this._onDidChangeDecorations.endDeferredEmit()}}getLanguageId(){return this.tokenization.getLanguageId()}setLanguage(e,t){typeof e=="string"?(this._languageSelectionListener.clear(),this._setLanguage(e,t)):(this._languageSelectionListener.value=e.onDidChange(()=>this._setLanguage(e.languageId,t)),this._setLanguage(e.languageId,t))}_setLanguage(e,t){this.tokenization.setLanguageId(e,t),this._languageService.requestRichLanguageFeatures(e)}getLanguageIdAtPosition(e,t){return this.tokenization.getLanguageIdAtPosition(e,t)}getWordAtPosition(e){return this._tokenizationTextModelPart.getWordAtPosition(e)}getWordUntilPosition(e){return this._tokenizationTextModelPart.getWordUntilPosition(e)}normalizePosition(e,t){return e}getLineIndentColumn(e){return indentOfLine(this.getLineContent(e))+1}toString(){return`TextModel(${this.uri.toString()})`}},TextModel_1=Ve,Ve._MODEL_SYNC_LIMIT=50*1024*1024,Ve.LARGE_FILE_SIZE_THRESHOLD=20*1024*1024,Ve.LARGE_FILE_LINE_COUNT_THRESHOLD=300*1e3,Ve.LARGE_FILE_HEAP_OPERATION_THRESHOLD=256*1024*1024,Ve.DEFAULT_CREATION_OPTIONS={isForSimpleWidget:!1,tabSize:EDITOR_MODEL_DEFAULTS.tabSize,indentSize:EDITOR_MODEL_DEFAULTS.indentSize,insertSpaces:EDITOR_MODEL_DEFAULTS.insertSpaces,detectIndentation:!1,defaultEOL:1,trimAutoWhitespace:EDITOR_MODEL_DEFAULTS.trimAutoWhitespace,largeFileOptimizations:EDITOR_MODEL_DEFAULTS.largeFileOptimizations,bracketPairColorizationOptions:EDITOR_MODEL_DEFAULTS.bracketPairColorizationOptions},Ve);TextModel=TextModel_1=__decorate$2B([__param$2w(4,IUndoRedoService),__param$2w(5,ILanguageService),__param$2w(6,ILanguageConfigurationService),__param$2w(7,IInstantiationService)],TextModel);function indentOfLine(a){let e=0;for(const t of a)if(t===" "||t==="	")e++;else break;return e}function isNodeInOverviewRuler(a){return!!(a.options.overviewRuler&&a.options.overviewRuler.color)}function isOptionsInjectedText(a){return!!a.after||!!a.before}function isNodeInjectedText(a){return!!a.options.after||!!a.options.before}class DecorationsTrees{constructor(){this._decorationsTree0=new IntervalTree,this._decorationsTree1=new IntervalTree,this._injectedTextDecorationsTree=new IntervalTree}ensureAllNodesHaveRanges(e){this.getAll(e,0,!1,!1,!1,!1)}_ensureNodesHaveRanges(e,t){for(const s of t)s.range===null&&(s.range=e.getRangeAt(s.cachedAbsoluteStart,s.cachedAbsoluteEnd));return t}getAllInInterval(e,t,s,o,r,l,c){const d=e.getVersionId(),u=this._intervalSearch(t,s,o,r,l,d,c);return this._ensureNodesHaveRanges(e,u)}_intervalSearch(e,t,s,o,r,l,c){const d=this._decorationsTree0.intervalSearch(e,t,s,o,r,l,c),u=this._decorationsTree1.intervalSearch(e,t,s,o,r,l,c),g=this._injectedTextDecorationsTree.intervalSearch(e,t,s,o,r,l,c);return d.concat(u).concat(g)}getInjectedTextInInterval(e,t,s,o){const r=e.getVersionId(),l=this._injectedTextDecorationsTree.intervalSearch(t,s,o,!1,!1,r,!1);return this._ensureNodesHaveRanges(e,l).filter(c=>c.options.showIfCollapsed||!c.range.isEmpty())}getFontDecorationsInInterval(e,t,s,o){const r=e.getVersionId(),l=this._decorationsTree0.intervalSearch(t,s,o,!1,!1,r,!1);return this._ensureNodesHaveRanges(e,l).filter(c=>c.options.affectsFont)}getAllInjectedText(e,t){const s=e.getVersionId(),o=this._injectedTextDecorationsTree.search(t,!1,!1,s,!1);return this._ensureNodesHaveRanges(e,o).filter(r=>r.options.showIfCollapsed||!r.range.isEmpty())}getAllCustomLineHeights(e,t){const s=e.getVersionId(),o=this._search(t,!1,!1,!1,s,!1);return this._ensureNodesHaveRanges(e,o).filter(r=>typeof r.options.lineHeight=="number")}getAll(e,t,s,o,r,l){const c=e.getVersionId(),d=this._search(t,s,o,r,c,l);return this._ensureNodesHaveRanges(e,d)}_search(e,t,s,o,r,l){if(o)return this._decorationsTree1.search(e,t,s,r,l);{const c=this._decorationsTree0.search(e,t,s,r,l),d=this._decorationsTree1.search(e,t,s,r,l),u=this._injectedTextDecorationsTree.search(e,t,s,r,l);return c.concat(d).concat(u)}}collectNodesFromOwner(e){const t=this._decorationsTree0.collectNodesFromOwner(e),s=this._decorationsTree1.collectNodesFromOwner(e),o=this._injectedTextDecorationsTree.collectNodesFromOwner(e);return t.concat(s).concat(o)}collectNodesPostOrder(){const e=this._decorationsTree0.collectNodesPostOrder(),t=this._decorationsTree1.collectNodesPostOrder(),s=this._injectedTextDecorationsTree.collectNodesPostOrder();return e.concat(t).concat(s)}insert(e){isNodeInjectedText(e)?this._injectedTextDecorationsTree.insert(e):isNodeInOverviewRuler(e)?this._decorationsTree1.insert(e):this._decorationsTree0.insert(e)}delete(e){isNodeInjectedText(e)?this._injectedTextDecorationsTree.delete(e):isNodeInOverviewRuler(e)?this._decorationsTree1.delete(e):this._decorationsTree0.delete(e)}getNodeRange(e,t){const s=e.getVersionId();return t.cachedVersionId!==s&&this._resolveNode(t,s),t.range===null&&(t.range=e.getRangeAt(t.cachedAbsoluteStart,t.cachedAbsoluteEnd)),t.range}_resolveNode(e,t){isNodeInjectedText(e)?this._injectedTextDecorationsTree.resolveNode(e,t):isNodeInOverviewRuler(e)?this._decorationsTree1.resolveNode(e,t):this._decorationsTree0.resolveNode(e,t)}acceptReplace(e,t,s,o){this._decorationsTree0.acceptReplace(e,t,s,o),this._decorationsTree1.acceptReplace(e,t,s,o),this._injectedTextDecorationsTree.acceptReplace(e,t,s,o)}}function cleanClassName(a){return a.replace(/[^a-z0-9\-_]/gi," ")}class DecorationOptions{constructor(e){this.color=e.color||"",this.darkColor=e.darkColor||""}}class ModelDecorationOverviewRulerOptions extends DecorationOptions{constructor(e){super(e),this._resolvedColor=null,this.position=typeof e.position=="number"?e.position:OverviewRulerLane$1.Center}getColor(e){return this._resolvedColor||(e.type!=="light"&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=null}_resolveColor(e,t){if(typeof e=="string")return e;const s=e?t.getColor(e.id):null;return s?s.toString():""}}class ModelDecorationGlyphMarginOptions{constructor(e){this.position=(e==null?void 0:e.position)??GlyphMarginLane$1.Center,this.persistLane=e==null?void 0:e.persistLane}}class ModelDecorationMinimapOptions extends DecorationOptions{constructor(e){super(e),this.position=e.position,this.sectionHeaderStyle=e.sectionHeaderStyle??null,this.sectionHeaderText=e.sectionHeaderText??null}getColor(e){return this._resolvedColor||(e.type!=="light"&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=void 0}_resolveColor(e,t){return typeof e=="string"?Color.fromHex(e):t.getColor(e.id)}}class ModelDecorationInjectedTextOptions{static from(e){return e instanceof ModelDecorationInjectedTextOptions?e:new ModelDecorationInjectedTextOptions(e)}constructor(e){this.content=e.content||"",this.tokens=e.tokens??null,this.inlineClassName=e.inlineClassName||null,this.inlineClassNameAffectsLetterSpacing=e.inlineClassNameAffectsLetterSpacing||!1,this.attachedData=e.attachedData||null,this.cursorStops=e.cursorStops||null}}class ModelDecorationOptions{static register(e){return new ModelDecorationOptions(e)}static createDynamic(e){return new ModelDecorationOptions(e)}constructor(e){this.description=e.description,this.blockClassName=e.blockClassName?cleanClassName(e.blockClassName):null,this.blockDoesNotCollapse=e.blockDoesNotCollapse??null,this.blockIsAfterEnd=e.blockIsAfterEnd??null,this.blockPadding=e.blockPadding??null,this.stickiness=e.stickiness||0,this.zIndex=e.zIndex||0,this.className=e.className?cleanClassName(e.className):null,this.shouldFillLineOnLineBreak=e.shouldFillLineOnLineBreak??null,this.hoverMessage=e.hoverMessage||null,this.glyphMarginHoverMessage=e.glyphMarginHoverMessage||null,this.lineNumberHoverMessage=e.lineNumberHoverMessage||null,this.isWholeLine=e.isWholeLine||!1,this.lineHeight=e.lineHeight?Math.min(e.lineHeight,LINE_HEIGHT_CEILING):null,this.fontSize=e.fontSize||null,this.affectsFont=!!e.fontSize||!!e.fontFamily||!!e.fontWeight||!!e.fontStyle,this.showIfCollapsed=e.showIfCollapsed||!1,this.collapseOnReplaceEdit=e.collapseOnReplaceEdit||!1,this.overviewRuler=e.overviewRuler?new ModelDecorationOverviewRulerOptions(e.overviewRuler):null,this.minimap=e.minimap?new ModelDecorationMinimapOptions(e.minimap):null,this.glyphMargin=e.glyphMarginClassName?new ModelDecorationGlyphMarginOptions(e.glyphMargin):null,this.glyphMarginClassName=e.glyphMarginClassName?cleanClassName(e.glyphMarginClassName):null,this.linesDecorationsClassName=e.linesDecorationsClassName?cleanClassName(e.linesDecorationsClassName):null,this.lineNumberClassName=e.lineNumberClassName?cleanClassName(e.lineNumberClassName):null,this.linesDecorationsTooltip=e.linesDecorationsTooltip?htmlAttributeEncodeValue(e.linesDecorationsTooltip):null,this.firstLineDecorationClassName=e.firstLineDecorationClassName?cleanClassName(e.firstLineDecorationClassName):null,this.marginClassName=e.marginClassName?cleanClassName(e.marginClassName):null,this.inlineClassName=e.inlineClassName?cleanClassName(e.inlineClassName):null,this.inlineClassNameAffectsLetterSpacing=e.inlineClassNameAffectsLetterSpacing||!1,this.beforeContentClassName=e.beforeContentClassName?cleanClassName(e.beforeContentClassName):null,this.afterContentClassName=e.afterContentClassName?cleanClassName(e.afterContentClassName):null,this.after=e.after?ModelDecorationInjectedTextOptions.from(e.after):null,this.before=e.before?ModelDecorationInjectedTextOptions.from(e.before):null,this.hideInCommentTokens=e.hideInCommentTokens??!1,this.hideInStringTokens=e.hideInStringTokens??!1,this.textDirection=e.textDirection??null}}ModelDecorationOptions.EMPTY=ModelDecorationOptions.register({description:"empty"});const TRACKED_RANGE_OPTIONS=[ModelDecorationOptions.register({description:"tracked-range-always-grows-when-typing-at-edges",stickiness:0}),ModelDecorationOptions.register({description:"tracked-range-never-grows-when-typing-at-edges",stickiness:1}),ModelDecorationOptions.register({description:"tracked-range-grows-only-when-typing-before",stickiness:2}),ModelDecorationOptions.register({description:"tracked-range-grows-only-when-typing-after",stickiness:3})];function _normalizeOptions(a){return a instanceof ModelDecorationOptions?a:ModelDecorationOptions.createDynamic(a)}class LineHeightChangingDecoration{static toKey(e){return`${e.ownerId};${e.decorationId};${e.lineNumber}`}constructor(e,t,s,o){this.ownerId=e,this.decorationId=t,this.lineNumber=s,this.lineHeight=o}}class LineFontChangingDecoration{static toKey(e){return`${e.ownerId};${e.decorationId};${e.lineNumber}`}constructor(e,t,s){this.ownerId=e,this.decorationId=t,this.lineNumber=s}}class DidChangeDecorationsEmitter extends Disposable{constructor(e){super(),this.handleBeforeFire=e,this._actual=this._register(new Emitter$1),this.event=this._actual.event,this._affectedInjectedTextLines=null,this._affectedLineHeights=null,this._affectedFontLines=null,this._deferredCnt=0,this._shouldFireDeferred=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._affectsGlyphMargin=!1,this._affectsLineNumber=!1}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(){var e,t,s;this._deferredCnt--,this._deferredCnt===0&&(this._shouldFireDeferred&&this.doFire(),(e=this._affectedInjectedTextLines)==null||e.clear(),this._affectedInjectedTextLines=null,(t=this._affectedLineHeights)==null||t.clear(),this._affectedLineHeights=null,(s=this._affectedFontLines)==null||s.clear(),this._affectedFontLines=null)}recordLineAffectedByInjectedText(e){this._affectedInjectedTextLines||(this._affectedInjectedTextLines=new Set),this._affectedInjectedTextLines.add(e)}recordLineAffectedByLineHeightChange(e,t,s,o){this._affectedLineHeights||(this._affectedLineHeights=new SetWithKey([],LineHeightChangingDecoration.toKey)),this._affectedLineHeights.add(new LineHeightChangingDecoration(e,t,s,o))}recordLineAffectedByFontChange(e,t,s){this._affectedFontLines||(this._affectedFontLines=new SetWithKey([],LineFontChangingDecoration.toKey)),this._affectedFontLines.add(new LineFontChangingDecoration(e,t,s))}checkAffectedAndFire(e){var t,s;this._affectsMinimap||(this._affectsMinimap=!!((t=e.minimap)!=null&&t.position)),this._affectsOverviewRuler||(this._affectsOverviewRuler=!!((s=e.overviewRuler)!=null&&s.color)),this._affectsGlyphMargin||(this._affectsGlyphMargin=!!e.glyphMarginClassName),this._affectsLineNumber||(this._affectsLineNumber=!!e.lineNumberClassName),this.tryFire()}fire(){this._affectsMinimap=!0,this._affectsOverviewRuler=!0,this._affectsGlyphMargin=!0,this.tryFire()}tryFire(){this._deferredCnt===0?this.doFire():this._shouldFireDeferred=!0}doFire(){this.handleBeforeFire(this._affectedInjectedTextLines,this._affectedLineHeights,this._affectedFontLines);const e={affectsMinimap:this._affectsMinimap,affectsOverviewRuler:this._affectsOverviewRuler,affectsGlyphMargin:this._affectsGlyphMargin,affectsLineNumber:this._affectsLineNumber};this._shouldFireDeferred=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._affectsGlyphMargin=!1,this._actual.fire(e)}}class DidChangeContentEmitter extends Disposable{constructor(){super(),this._fastEmitter=this._register(new Emitter$1),this.fastEvent=this._fastEmitter.event,this._slowEmitter=this._register(new Emitter$1),this.slowEvent=this._slowEmitter.event,this._deferredCnt=0,this._deferredEvent=null}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(e=null){if(this._deferredCnt--,this._deferredCnt===0&&this._deferredEvent!==null){this._deferredEvent.rawContentChangedEvent.resultingSelection=e;const t=this._deferredEvent;this._deferredEvent=null,this._fastEmitter.fire(t),this._slowEmitter.fire(t)}}fire(e){if(this._deferredCnt>0){this._deferredEvent?this._deferredEvent=this._deferredEvent.merge(e):this._deferredEvent=e;return}this._fastEmitter.fire(e),this._slowEmitter.fire(e)}}const ILanguageFeaturesService=createDecorator("ILanguageFeaturesService");class MonospaceLineBreaksComputerFactory{static create(e){return new MonospaceLineBreaksComputerFactory(e.get(151),e.get(150))}constructor(e,t){this.classifier=new WrappingCharacterClassifier(e,t)}createLineBreaksComputer(e,t,s,o,r,l){const c=[],d=[],u=[];return{addRequest:(g,f,p)=>{c.push(g),d.push(f),u.push(p)},finalize:()=>{const g=e.typicalFullwidthCharacterWidth/e.typicalHalfwidthCharacterWidth,f=[];for(let p=0,m=c.length;p<m;p++){const _=d[p],C=u[p];C&&!C.injectionOptions&&!_&&!l?f[p]=createLineBreaksFromPreviousLineBreaks(this.classifier,C,c[p],t,s,g,o,r):f[p]=createLineBreaks(this.classifier,c[p],_,t,s,g,o,r,l)}return arrPool1.length=0,arrPool2.length=0,f}}}}class WrappingCharacterClassifier extends CharacterClassifier{constructor(e,t){super(0);for(let s=0;s<e.length;s++)this.set(e.charCodeAt(s),1);for(let s=0;s<t.length;s++)this.set(t.charCodeAt(s),2)}get(e){return e>=0&&e<256?this._asciiMap[e]:e>=12352&&e<=12543||e>=13312&&e<=19903||e>=19968&&e<=40959?3:this._map.get(e)||this._defaultValue}}let arrPool1=[],arrPool2=[];function createLineBreaksFromPreviousLineBreaks(a,e,t,s,o,r,l,c){if(o===-1)return null;const d=t.length;if(d<=1)return null;const u=c==="keepAll",g=e.breakOffsets,f=e.breakOffsetsVisibleColumn,p=computeWrappedTextIndentLength(t,s,o,r,l),m=o-p,_=arrPool1,C=arrPool2;let b=0,v=0,S=0,y=o;const w=g.length;let L=0;if(L>=0){let x=Math.abs(f[L]-y);for(;L+1<w;){const E=Math.abs(f[L+1]-y);if(E>=x)break;x=E,L++}}for(;L<w;){let x=L<0?0:g[L],E=L<0?0:f[L];v>x&&(x=v,E=S);let I=0,D=0,k=0,N=0;if(E<=y){let M=E,A=x===0?0:t.charCodeAt(x-1),O=x===0?0:a.get(A),P=!0;for(let W=x;W<d;W++){const B=W,H=t.charCodeAt(W);let V,K;if(isHighSurrogate(H)?(W++,V=0,K=2):(V=a.get(H),K=computeCharWidth(H,M,s,r)),B>v&&canBreak(A,O,H,V,u)&&(I=B,D=M),M+=K,M>y){B>v?(k=B,N=M-K):(k=W+1,N=M),M-D>m&&(I=0),P=!1;break}A=H,O=V}if(P){b>0&&(_[b]=g[g.length-1],C[b]=f[g.length-1],b++);break}}if(I===0){let M=E,A=t.charCodeAt(x),O=a.get(A),P=!1;for(let W=x-1;W>=v;W--){const B=W+1,H=t.charCodeAt(W);if(H===9){P=!0;break}let V,K;if(isLowSurrogate(H)?(W--,V=0,K=2):(V=a.get(H),K=isFullWidthCharacter(H)?r:1),M<=y){if(k===0&&(k=B,N=M),M<=y-m)break;if(canBreak(H,V,A,O,u)){I=B,D=M;break}}M-=K,A=H,O=V}if(I!==0){const W=m-(N-D);if(W<=s){const B=t.charCodeAt(k);let H;isHighSurrogate(B)?H=2:H=computeCharWidth(B,N,s,r),W-H<0&&(I=0)}}if(P){L--;continue}}if(I===0&&(I=k,D=N),I<=v){const M=t.charCodeAt(v);isHighSurrogate(M)?(I=v+2,D=S+2):(I=v+1,D=S+computeCharWidth(M,S,s,r))}for(v=I,_[b]=I,S=D,C[b]=D,b++,y=D+m;L<0||L<w&&f[L]<D;)L++;let R=Math.abs(f[L]-y);for(;L+1<w;){const M=Math.abs(f[L+1]-y);if(M>=R)break;R=M,L++}}return b===0?null:(_.length=b,C.length=b,arrPool1=e.breakOffsets,arrPool2=e.breakOffsetsVisibleColumn,e.breakOffsets=_,e.breakOffsetsVisibleColumn=C,e.wrappedTextIndentLength=p,e)}function createLineBreaks(a,e,t,s,o,r,l,c,d){const u=LineInjectedText.applyInjectedText(e,t);let g,f;if(t&&t.length>0?(g=t.map(k=>k.options),f=t.map(k=>k.column-1)):(g=null,f=null),o===-1)return g?new ModelLineProjectionData(f,g,[u.length],[],0):null;const p=u.length;if(p<=1)return g?new ModelLineProjectionData(f,g,[u.length],[],0):null;const m=c==="keepAll",_=computeWrappedTextIndentLength(u,s,o,r,l),C=o-_,b=[],v=[];let S=0,y=0,w=0,L=o,x=u.charCodeAt(0),E=a.get(x),I=computeCharWidth(x,0,s,r),D=1;isHighSurrogate(x)&&(I+=1,x=u.charCodeAt(1),E=a.get(x),D++);for(let k=D;k<p;k++){const N=k,R=u.charCodeAt(k);let M,A;isHighSurrogate(R)?(k++,M=0,A=2):(M=a.get(R),A=computeCharWidth(R,I,s,r)),canBreak(x,E,R,M,m)&&(y=N,w=I),I+=A,d&&isEscapedLineBreakAtPosition(u,k)&&(I+=L),I>L&&((y===0||I-w>C)&&(y=N,w=I-A),b[S]=y,v[S]=w,S++,L=w+C,y=0),x=R,E=M}return S===0&&(!t||t.length===0)?null:(b[S]=p,v[S]=I,new ModelLineProjectionData(f,g,b,v,_))}function computeCharWidth(a,e,t,s){return a===9?t-e%t:isFullWidthCharacter(a)||a<32?s:1}function tabCharacterWidth(a,e){return e-a%e}function isEscapedLineBreakAtPosition(a,e){return e>=2&&(e<3||a.charAt(e-3)!=="\\")&&a.charAt(e-2)==="\\"&&a.charAt(e-1)==="n"&&a.includes('"')}function canBreak(a,e,t,s,o){return t!==32&&(e===2&&s!==2||e!==1&&s===1||!o&&e===3&&s!==2||!o&&s===3&&e!==1)}function computeWrappedTextIndentLength(a,e,t,s,o){let r=0;if(o!==0){const l=firstNonWhitespaceIndex(a);if(l!==-1){for(let d=0;d<l;d++){const u=a.charCodeAt(d)===9?tabCharacterWidth(r,e):1;r+=u}const c=o===3?2:o===2?1:0;for(let d=0;d<c;d++){const u=tabCharacterWidth(r,e);r+=u}r+s>t&&(r=0)}}return r}class Cursor{constructor(e){this._selTrackedRange=null,this._trackSelection=!0,this._setState(e,new SingleCursorState(new Range$2(1,1,1,1),0,0,new Position$1(1,1),0),new SingleCursorState(new Range$2(1,1,1,1),0,0,new Position$1(1,1),0))}dispose(e){this._removeTrackedRange(e)}startTrackingSelection(e){this._trackSelection=!0,this._updateTrackedRange(e)}stopTrackingSelection(e){this._trackSelection=!1,this._removeTrackedRange(e)}_updateTrackedRange(e){this._trackSelection&&(this._selTrackedRange=e.model._setTrackedRange(this._selTrackedRange,this.modelState.selection,0))}_removeTrackedRange(e){this._selTrackedRange=e.model._setTrackedRange(this._selTrackedRange,null,0)}asCursorState(){return new CursorState$1(this.modelState,this.viewState)}readSelectionFromMarkers(e){const t=e.model._getTrackedRange(this._selTrackedRange);return this.modelState.selection.isEmpty()&&!t.isEmpty()?Selection$1.fromRange(t.collapseToEnd(),this.modelState.selection.getDirection()):Selection$1.fromRange(t,this.modelState.selection.getDirection())}ensureValidState(e){this._setState(e,this.modelState,this.viewState)}setState(e,t,s){this._setState(e,t,s)}static _validatePositionWithCache(e,t,s,o){return t.equals(s)?o:e.normalizePosition(t,2)}static _validateViewState(e,t){const s=t.position,o=t.selectionStart.getStartPosition(),r=t.selectionStart.getEndPosition(),l=e.normalizePosition(s,2),c=this._validatePositionWithCache(e,o,s,l),d=this._validatePositionWithCache(e,r,o,c);return s.equals(l)&&o.equals(c)&&r.equals(d)?t:new SingleCursorState(Range$2.fromPositions(c,d),t.selectionStartKind,t.selectionStartLeftoverVisibleColumns+o.column-c.column,l,t.leftoverVisibleColumns+s.column-l.column)}_setState(e,t,s){if(s&&(s=Cursor._validateViewState(e.viewModel,s)),t){const o=e.model.validateRange(t.selectionStart),r=t.selectionStart.equalsRange(o)?t.selectionStartLeftoverVisibleColumns:0,l=e.model.validatePosition(t.position),c=t.position.equals(l)?t.leftoverVisibleColumns:0;t=new SingleCursorState(o,t.selectionStartKind,r,l,c)}else{if(!s)return;const o=e.model.validateRange(e.coordinatesConverter.convertViewRangeToModelRange(s.selectionStart)),r=e.model.validatePosition(e.coordinatesConverter.convertViewPositionToModelPosition(s.position));t=new SingleCursorState(o,s.selectionStartKind,s.selectionStartLeftoverVisibleColumns,r,s.leftoverVisibleColumns)}if(s){const o=e.coordinatesConverter.validateViewRange(s.selectionStart,t.selectionStart),r=e.coordinatesConverter.validateViewPosition(s.position,t.position);s=new SingleCursorState(o,t.selectionStartKind,t.selectionStartLeftoverVisibleColumns,r,t.leftoverVisibleColumns)}else{const o=e.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(t.selectionStart.startLineNumber,t.selectionStart.startColumn)),r=e.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(t.selectionStart.endLineNumber,t.selectionStart.endColumn)),l=new Range$2(o.lineNumber,o.column,r.lineNumber,r.column),c=e.coordinatesConverter.convertModelPositionToViewPosition(t.position);s=new SingleCursorState(l,t.selectionStartKind,t.selectionStartLeftoverVisibleColumns,c,t.leftoverVisibleColumns)}this.modelState=t,this.viewState=s,this._updateTrackedRange(e)}}class CursorCollection{constructor(e){this.context=e,this.cursors=[new Cursor(e)],this.lastAddedCursorIndex=0}dispose(){for(const e of this.cursors)e.dispose(this.context)}startTrackingSelections(){for(const e of this.cursors)e.startTrackingSelection(this.context)}stopTrackingSelections(){for(const e of this.cursors)e.stopTrackingSelection(this.context)}updateContext(e){this.context=e}ensureValidState(){for(const e of this.cursors)e.ensureValidState(this.context)}readSelectionFromMarkers(){return this.cursors.map(e=>e.readSelectionFromMarkers(this.context))}getAll(){return this.cursors.map(e=>e.asCursorState())}getViewPositions(){return this.cursors.map(e=>e.viewState.position)}getTopMostViewPosition(){return findFirstMin(this.cursors,compareBy(e=>e.viewState.position,Position$1.compare)).viewState.position}getBottomMostViewPosition(){return findLastMax(this.cursors,compareBy(e=>e.viewState.position,Position$1.compare)).viewState.position}getSelections(){return this.cursors.map(e=>e.modelState.selection)}getViewSelections(){return this.cursors.map(e=>e.viewState.selection)}setSelections(e){this.setStates(CursorState$1.fromModelSelections(e))}getPrimaryCursor(){return this.cursors[0].asCursorState()}setStates(e){e!==null&&(this.cursors[0].setState(this.context,e[0].modelState,e[0].viewState),this._setSecondaryStates(e.slice(1)))}_setSecondaryStates(e){const t=this.cursors.length-1,s=e.length;if(t<s){const o=s-t;for(let r=0;r<o;r++)this._addSecondaryCursor()}else if(t>s){const o=t-s;for(let r=0;r<o;r++)this._removeSecondaryCursor(this.cursors.length-2)}for(let o=0;o<s;o++)this.cursors[o+1].setState(this.context,e[o].modelState,e[o].viewState)}killSecondaryCursors(){this._setSecondaryStates([])}_addSecondaryCursor(){this.cursors.push(new Cursor(this.context)),this.lastAddedCursorIndex=this.cursors.length-1}getLastAddedCursorIndex(){return this.cursors.length===1||this.lastAddedCursorIndex===0?0:this.lastAddedCursorIndex}_removeSecondaryCursor(e){this.lastAddedCursorIndex>=e+1&&this.lastAddedCursorIndex--,this.cursors[e+1].dispose(this.context),this.cursors.splice(e+1,1)}normalize(){if(this.cursors.length===1)return;const e=this.cursors.slice(0),t=[];for(let s=0,o=e.length;s<o;s++)t.push({index:s,selection:e[s].modelState.selection});t.sort(compareBy(s=>s.selection,Range$2.compareRangesUsingStarts));for(let s=0;s<t.length-1;s++){const o=t[s],r=t[s+1],l=o.selection,c=r.selection;if(!this.context.cursorConfig.multiCursorMergeOverlapping)continue;let d;if(c.isEmpty()||l.isEmpty()?d=c.getStartPosition().isBeforeOrEqual(l.getEndPosition()):d=c.getStartPosition().isBefore(l.getEndPosition()),d){const u=o.index<r.index?s:s+1,g=o.index<r.index?s+1:s,f=t[g].index,p=t[u].index,m=t[g].selection,_=t[u].selection;if(!m.equalsSelection(_)){const C=m.plusRange(_),b=m.selectionStartLineNumber===m.startLineNumber&&m.selectionStartColumn===m.startColumn,v=_.selectionStartLineNumber===_.startLineNumber&&_.selectionStartColumn===_.startColumn;let S;f===this.lastAddedCursorIndex?(S=b,this.lastAddedCursorIndex=p):S=v;let y;S?y=new Selection$1(C.startLineNumber,C.startColumn,C.endLineNumber,C.endColumn):y=new Selection$1(C.endLineNumber,C.endColumn,C.startLineNumber,C.startColumn),t[u].selection=y;const w=CursorState$1.fromModelSelection(y);e[p].setState(this.context,w.modelState,w.viewState)}for(const C of t)C.index>f&&C.index--;e.splice(f,1),t.splice(g,1),this._removeSecondaryCursor(f-1),s--}}}}class CursorContext{constructor(e,t,s,o){this._cursorContextBrand=void 0,this.model=e,this.viewModel=t,this.coordinatesConverter=s,this.cursorConfig=o}}class ViewCompositionStartEvent{constructor(){this.type=0}}class ViewCompositionEndEvent{constructor(){this.type=1}}class ViewConfigurationChangedEvent{constructor(e){this.type=2,this._source=e}hasChanged(e){return this._source.hasChanged(e)}}class ViewCursorStateChangedEvent{constructor(e,t,s){this.selections=e,this.modelSelections=t,this.reason=s,this.type=3}}class ViewDecorationsChangedEvent{constructor(e){this.type=4,e?(this.affectsMinimap=e.affectsMinimap,this.affectsOverviewRuler=e.affectsOverviewRuler,this.affectsGlyphMargin=e.affectsGlyphMargin,this.affectsLineNumber=e.affectsLineNumber):(this.affectsMinimap=!0,this.affectsOverviewRuler=!0,this.affectsGlyphMargin=!0,this.affectsLineNumber=!0)}}class ViewFlushedEvent{constructor(){this.type=5}}class ViewFocusChangedEvent{constructor(e){this.type=6,this.isFocused=e}}class ViewLanguageConfigurationEvent{constructor(){this.type=7}}class ViewLineMappingChangedEvent{constructor(){this.type=8}}class ViewLinesChangedEvent{constructor(e,t){this.fromLineNumber=e,this.count=t,this.type=9}}class ViewLinesDeletedEvent{constructor(e,t){this.type=10,this.fromLineNumber=e,this.toLineNumber=t}}class ViewLinesInsertedEvent{constructor(e,t){this.type=11,this.fromLineNumber=e,this.toLineNumber=t}}class ViewRevealRangeRequestEvent{constructor(e,t,s,o,r,l,c){this.source=e,this.minimalReveal=t,this.range=s,this.selections=o,this.verticalType=r,this.revealHorizontal=l,this.scrollType=c,this.type=12}}class ViewScrollChangedEvent{constructor(e){this.type=13,this.scrollWidth=e.scrollWidth,this.scrollLeft=e.scrollLeft,this.scrollHeight=e.scrollHeight,this.scrollTop=e.scrollTop,this.scrollWidthChanged=e.scrollWidthChanged,this.scrollLeftChanged=e.scrollLeftChanged,this.scrollHeightChanged=e.scrollHeightChanged,this.scrollTopChanged=e.scrollTopChanged}}class ViewThemeChangedEvent{constructor(e){this.theme=e,this.type=14}}class ViewTokensChangedEvent{constructor(e){this.type=15,this.ranges=e}}class ViewTokensColorsChangedEvent{constructor(){this.type=16}}let ViewZonesChangedEvent$1=class{constructor(){this.type=17}};class ViewModelEventDispatcher extends Disposable{constructor(){super(),this._onEvent=this._register(new Emitter$1),this.onEvent=this._onEvent.event,this._eventHandlers=[],this._viewEventQueue=null,this._isConsumingViewEventQueue=!1,this._collector=null,this._collectorCnt=0,this._outgoingEvents=[]}emitOutgoingEvent(e){this._addOutgoingEvent(e),this._emitOutgoingEvents()}_addOutgoingEvent(e){for(let t=0,s=this._outgoingEvents.length;t<s;t++){const o=this._outgoingEvents[t].kind===e.kind?this._outgoingEvents[t].attemptToMerge(e):null;if(o){this._outgoingEvents[t]=o;return}}this._outgoingEvents.push(e)}_emitOutgoingEvents(){for(;this._outgoingEvents.length>0;){if(this._collector||this._isConsumingViewEventQueue)return;const e=this._outgoingEvents.shift();e.isNoOp()||this._onEvent.fire(e)}}addViewEventHandler(e){for(let t=0,s=this._eventHandlers.length;t<s;t++)this._eventHandlers[t]===e&&console.warn("Detected duplicate listener in ViewEventDispatcher",e);this._eventHandlers.push(e)}removeViewEventHandler(e){for(let t=0;t<this._eventHandlers.length;t++)if(this._eventHandlers[t]===e){this._eventHandlers.splice(t,1);break}}beginEmitViewEvents(){return this._collectorCnt++,this._collectorCnt===1&&(this._collector=new ViewModelEventsCollector),this._collector}endEmitViewEvents(){if(this._collectorCnt--,this._collectorCnt===0){const e=this._collector.outgoingEvents,t=this._collector.viewEvents;this._collector=null;for(const s of e)this._addOutgoingEvent(s);t.length>0&&this._emitMany(t)}this._emitOutgoingEvents()}emitSingleViewEvent(e){try{this.beginEmitViewEvents().emitViewEvent(e)}finally{this.endEmitViewEvents()}}_emitMany(e){this._viewEventQueue?this._viewEventQueue=this._viewEventQueue.concat(e):this._viewEventQueue=e,this._isConsumingViewEventQueue||this._consumeViewEventQueue()}_consumeViewEventQueue(){try{this._isConsumingViewEventQueue=!0,this._doConsumeQueue()}finally{this._isConsumingViewEventQueue=!1}}_doConsumeQueue(){for(;this._viewEventQueue;){const e=this._viewEventQueue;this._viewEventQueue=null;const t=this._eventHandlers.slice(0);for(const s of t)s.handleEvents(e)}}}class ViewModelEventsCollector{constructor(){this.viewEvents=[],this.outgoingEvents=[]}emitViewEvent(e){this.viewEvents.push(e)}emitOutgoingEvent(e){this.outgoingEvents.push(e)}}class ContentSizeChangedEvent{constructor(e,t,s,o){this.kind=0,this._oldContentWidth=e,this._oldContentHeight=t,this.contentWidth=s,this.contentHeight=o,this.contentWidthChanged=this._oldContentWidth!==this.contentWidth,this.contentHeightChanged=this._oldContentHeight!==this.contentHeight}isNoOp(){return!this.contentWidthChanged&&!this.contentHeightChanged}attemptToMerge(e){return e.kind!==this.kind?null:new ContentSizeChangedEvent(this._oldContentWidth,this._oldContentHeight,e.contentWidth,e.contentHeight)}}class FocusChangedEvent{constructor(e,t){this.kind=1,this.oldHasFocus=e,this.hasFocus=t}isNoOp(){return this.oldHasFocus===this.hasFocus}attemptToMerge(e){return e.kind!==this.kind?null:new FocusChangedEvent(this.oldHasFocus,e.hasFocus)}}class WidgetFocusChangedEvent{constructor(e,t){this.kind=2,this.oldHasFocus=e,this.hasFocus=t}isNoOp(){return this.oldHasFocus===this.hasFocus}attemptToMerge(e){return e.kind!==this.kind?null:new FocusChangedEvent(this.oldHasFocus,e.hasFocus)}}class ScrollChangedEvent{constructor(e,t,s,o,r,l,c,d){this.kind=3,this._oldScrollWidth=e,this._oldScrollLeft=t,this._oldScrollHeight=s,this._oldScrollTop=o,this.scrollWidth=r,this.scrollLeft=l,this.scrollHeight=c,this.scrollTop=d,this.scrollWidthChanged=this._oldScrollWidth!==this.scrollWidth,this.scrollLeftChanged=this._oldScrollLeft!==this.scrollLeft,this.scrollHeightChanged=this._oldScrollHeight!==this.scrollHeight,this.scrollTopChanged=this._oldScrollTop!==this.scrollTop}isNoOp(){return!this.scrollWidthChanged&&!this.scrollLeftChanged&&!this.scrollHeightChanged&&!this.scrollTopChanged}attemptToMerge(e){return e.kind!==this.kind?null:new ScrollChangedEvent(this._oldScrollWidth,this._oldScrollLeft,this._oldScrollHeight,this._oldScrollTop,e.scrollWidth,e.scrollLeft,e.scrollHeight,e.scrollTop)}}class ViewZonesChangedEvent{constructor(){this.kind=4}isNoOp(){return!1}attemptToMerge(e){return e.kind!==this.kind?null:this}}class HiddenAreasChangedEvent{constructor(){this.kind=5}isNoOp(){return!1}attemptToMerge(e){return e.kind!==this.kind?null:this}}class CursorStateChangedEvent{constructor(e,t,s,o,r,l,c){this.kind=7,this.oldSelections=e,this.selections=t,this.oldModelVersionId=s,this.modelVersionId=o,this.source=r,this.reason=l,this.reachedMaxCursorCount=c}static _selectionsAreEqual(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;const s=e.length,o=t.length;if(s!==o)return!1;for(let r=0;r<s;r++)if(!e[r].equalsSelection(t[r]))return!1;return!0}isNoOp(){return CursorStateChangedEvent._selectionsAreEqual(this.oldSelections,this.selections)&&this.oldModelVersionId===this.modelVersionId}attemptToMerge(e){return e.kind!==this.kind?null:new CursorStateChangedEvent(this.oldSelections,e.selections,this.oldModelVersionId,e.modelVersionId,e.source,e.reason,this.reachedMaxCursorCount||e.reachedMaxCursorCount)}}class ReadOnlyEditAttemptEvent{constructor(){this.kind=6}isNoOp(){return!1}attemptToMerge(e){return e.kind!==this.kind?null:this}}class ModelDecorationsChangedEvent{constructor(e){this.event=e,this.kind=8}isNoOp(){return!1}attemptToMerge(e){return null}}class ModelLanguageChangedEvent{constructor(e){this.event=e,this.kind=9}isNoOp(){return!1}attemptToMerge(e){return null}}class ModelLanguageConfigurationChangedEvent{constructor(e){this.event=e,this.kind=10}isNoOp(){return!1}attemptToMerge(e){return null}}class ModelContentChangedEvent{constructor(e){this.event=e,this.kind=11}isNoOp(){return!1}attemptToMerge(e){return null}}class ModelOptionsChangedEvent{constructor(e){this.event=e,this.kind=12}isNoOp(){return!1}attemptToMerge(e){return null}}class ModelTokensChangedEvent{constructor(e){this.event=e,this.kind=13}isNoOp(){return!1}attemptToMerge(e){return null}}class ModelLineHeightChangedEvent{constructor(e){this.event=e,this.kind=14}isNoOp(){return!1}attemptToMerge(e){return null}}class ModelFontChangedEvent{constructor(e){this.event=e,this.kind=15}isNoOp(){return!1}attemptToMerge(e){return null}}class CursorsController extends Disposable{constructor(e,t,s,o){super(),this._model=e,this._knownModelVersionId=this._model.getVersionId(),this._viewModel=t,this._coordinatesConverter=s,this.context=new CursorContext(this._model,this._viewModel,this._coordinatesConverter,o),this._cursors=new CursorCollection(this.context),this._hasFocus=!1,this._isHandling=!1,this._compositionState=null,this._columnSelectData=null,this._autoClosedActions=[],this._prevEditOperationType=0}dispose(){this._cursors.dispose(),this._autoClosedActions=dispose(this._autoClosedActions),super.dispose()}updateConfiguration(e){this.context=new CursorContext(this._model,this._viewModel,this._coordinatesConverter,e),this._cursors.updateContext(this.context)}onLineMappingChanged(e){this._knownModelVersionId===this._model.getVersionId()&&this.setStates(e,"viewModel",0,this.getCursorStates())}setHasFocus(e){this._hasFocus=e}_validateAutoClosedActions(){if(this._autoClosedActions.length>0){const e=this._cursors.getSelections();for(let t=0;t<this._autoClosedActions.length;t++){const s=this._autoClosedActions[t];s.isValid(e)||(s.dispose(),this._autoClosedActions.splice(t,1),t--)}}}getPrimaryCursorState(){return this._cursors.getPrimaryCursor()}getLastAddedCursorIndex(){return this._cursors.getLastAddedCursorIndex()}getCursorStates(){return this._cursors.getAll()}setStates(e,t,s,o){let r=!1;const l=this.context.cursorConfig.multiCursorLimit;o!==null&&o.length>l&&(o=o.slice(0,l),r=!0);const c=CursorModelState.from(this._model,this);return this._cursors.setStates(o),this._cursors.normalize(),this._columnSelectData=null,this._validateAutoClosedActions(),this._emitStateChangedIfNecessary(e,t,s,c,r)}setCursorColumnSelectData(e){this._columnSelectData=e}revealAll(e,t,s,o,r,l){const c=this._cursors.getViewPositions();let d=null,u=null;c.length>1?u=this._cursors.getViewSelections():d=Range$2.fromPositions(c[0],c[0]),e.emitViewEvent(new ViewRevealRangeRequestEvent(t,s,d,u,o,r,l))}revealPrimary(e,t,s,o,r,l){const d=[this._cursors.getPrimaryCursor().viewState.selection];e.emitViewEvent(new ViewRevealRangeRequestEvent(t,s,null,d,o,r,l))}saveState(){const e=[],t=this._cursors.getSelections();for(let s=0,o=t.length;s<o;s++){const r=t[s];e.push({inSelectionMode:!r.isEmpty(),selectionStart:{lineNumber:r.selectionStartLineNumber,column:r.selectionStartColumn},position:{lineNumber:r.positionLineNumber,column:r.positionColumn}})}return e}restoreState(e,t){const s=[];for(let o=0,r=t.length;o<r;o++){const l=t[o];let c=1,d=1;l.position&&l.position.lineNumber&&(c=l.position.lineNumber),l.position&&l.position.column&&(d=l.position.column);let u=c,g=d;l.selectionStart&&l.selectionStart.lineNumber&&(u=l.selectionStart.lineNumber),l.selectionStart&&l.selectionStart.column&&(g=l.selectionStart.column),s.push({selectionStartLineNumber:u,selectionStartColumn:g,positionLineNumber:c,positionColumn:d})}this.setStates(e,"restoreState",0,CursorState$1.fromModelSelections(s)),this.revealAll(e,"restoreState",!1,0,!0,1)}onModelContentChanged(e,t){if(t instanceof ModelInjectedTextChangedEvent){if(this._isHandling)return;this._isHandling=!0;try{this.setStates(e,"modelChange",0,this.getCursorStates())}finally{this._isHandling=!1}}else{const s=t.rawContentChangedEvent;if(this._knownModelVersionId=s.versionId,this._isHandling)return;const o=s.containsEvent(1);if(this._prevEditOperationType=0,o)this._cursors.dispose(),this._cursors=new CursorCollection(this.context),this._validateAutoClosedActions(),this._emitStateChangedIfNecessary(e,"model",1,null,!1);else if(this._hasFocus&&s.resultingSelection&&s.resultingSelection.length>0){const r=CursorState$1.fromModelSelections(s.resultingSelection);this.setStates(e,"modelChange",s.isUndoing?5:s.isRedoing?6:2,r)&&this.revealAll(e,"modelChange",!1,0,!0,0)}else{const r=this._cursors.readSelectionFromMarkers();this.setStates(e,"modelChange",2,CursorState$1.fromModelSelections(r))}}}getSelection(){return this._cursors.getPrimaryCursor().modelState.selection}getTopMostViewPosition(){return this._cursors.getTopMostViewPosition()}getBottomMostViewPosition(){return this._cursors.getBottomMostViewPosition()}getCursorColumnSelectData(){if(this._columnSelectData)return this._columnSelectData;const e=this._cursors.getPrimaryCursor(),t=e.viewState.selectionStart.getStartPosition(),s=e.viewState.position;return{isReal:!1,fromViewLineNumber:t.lineNumber,fromViewVisualColumn:this.context.cursorConfig.visibleColumnFromColumn(this._viewModel,t),toViewLineNumber:s.lineNumber,toViewVisualColumn:this.context.cursorConfig.visibleColumnFromColumn(this._viewModel,s)}}getSelections(){return this._cursors.getSelections()}setSelections(e,t,s,o){this.setStates(e,t,o,CursorState$1.fromModelSelections(s))}getPrevEditOperationType(){return this._prevEditOperationType}setPrevEditOperationType(e){this._prevEditOperationType=e}_pushAutoClosedAction(e,t){const s=[],o=[];for(let c=0,d=e.length;c<d;c++)s.push({range:e[c],options:{description:"auto-closed-character",inlineClassName:"auto-closed-character",stickiness:1}}),o.push({range:t[c],options:{description:"auto-closed-enclosing",stickiness:1}});const r=this._model.deltaDecorations([],s),l=this._model.deltaDecorations([],o);this._autoClosedActions.push(new AutoClosedAction(this._model,r,l))}_executeEditOperation(e,t){if(!e)return;e.shouldPushStackElementBefore&&this._model.pushStackElement();const s=CommandExecutor.executeCommands(this._model,this._cursors.getSelections(),e.commands,t);if(s){this._interpretCommandResult(s);const o=[],r=[];for(let l=0;l<e.commands.length;l++){const c=e.commands[l];c instanceof BaseTypeWithAutoClosingCommand&&c.enclosingRange&&c.closeCharacterRange&&(o.push(c.closeCharacterRange),r.push(c.enclosingRange))}o.length>0&&this._pushAutoClosedAction(o,r),this._prevEditOperationType=e.type}e.shouldPushStackElementAfter&&this._model.pushStackElement()}_interpretCommandResult(e){(!e||e.length===0)&&(e=this._cursors.readSelectionFromMarkers()),this._columnSelectData=null,this._cursors.setSelections(e),this._cursors.normalize()}_emitStateChangedIfNecessary(e,t,s,o,r){const l=CursorModelState.from(this._model,this);if(l.equals(o))return!1;const c=this._cursors.getSelections(),d=this._cursors.getViewSelections();if(e.emitViewEvent(new ViewCursorStateChangedEvent(d,c,s)),!o||o.cursorState.length!==l.cursorState.length||l.cursorState.some((u,g)=>!u.modelState.equals(o.cursorState[g].modelState))){const u=o?o.cursorState.map(f=>f.modelState.selection):null,g=o?o.modelVersionId:0;e.emitOutgoingEvent(new CursorStateChangedEvent(u,c,g,l.modelVersionId,t||"keyboard",s,r))}return!0}_findAutoClosingPairs(e){if(!e.length)return null;const t=[];for(let s=0,o=e.length;s<o;s++){const r=e[s];if(!r.text||r.text.indexOf(`
`)>=0)return null;const l=r.text.match(/([)\]}>'"`])([^)\]}>'"`]*)$/);if(!l)return null;const c=l[1],d=this.context.cursorConfig.autoClosingPairs.autoClosingPairsCloseSingleChar.get(c);if(!d||d.length!==1)return null;const u=d[0].open,g=r.text.length-l[2].length-1,f=r.text.lastIndexOf(u,g-1);if(f===-1)return null;t.push([f,g])}return t}executeEdits(e,t,s,o,r){let l=null;t==="snippet"&&(l=this._findAutoClosingPairs(s)),l&&(s[0]._isTracked=!0);const c=[],d=[],u=this._model.pushEditOperations(this.getSelections(),s,g=>{if(l)for(let p=0,m=l.length;p<m;p++){const[_,C]=l[p],b=g[p],v=b.range.startLineNumber,S=b.range.startColumn-1+_,y=b.range.startColumn-1+C;c.push(new Range$2(v,y+1,v,y+2)),d.push(new Range$2(v,S+1,v,y+2))}const f=o(g);return f&&(this._isHandling=!0),f},void 0,r);u&&(this._isHandling=!1,this.setSelections(e,t,u,0)),c.length>0&&this._pushAutoClosedAction(c,d)}_executeEdit(e,t,s,o=0){if(this.context.cursorConfig.readOnly)return;const r=CursorModelState.from(this._model,this);this._cursors.stopTrackingSelections(),this._isHandling=!0;try{this._cursors.ensureValidState(),e()}catch(l){onUnexpectedError(l)}this._isHandling=!1,this._cursors.startTrackingSelections(),this._validateAutoClosedActions(),this._emitStateChangedIfNecessary(t,s,o,r,!1)&&this.revealAll(t,s,!1,0,!0,0)}getAutoClosedCharacters(){return AutoClosedAction.getAllAutoClosedCharacters(this._autoClosedActions)}startComposition(e){this._compositionState=new CompositionState(this._model,this.getSelections())}endComposition(e,t){const s=EditSources.cursor({kind:"compositionEnd",detailedSource:t}),o=this._compositionState?this._compositionState.deduceOutcome(this._model,this.getSelections()):null;this._compositionState=null,this._executeEdit(()=>{t==="keyboard"&&this._executeEditOperation(TypeOperations.compositionEndWithInterceptors(this._prevEditOperationType,this.context.cursorConfig,this._model,o,this.getSelections(),this.getAutoClosedCharacters()),s)},e,t)}type(e,t,s){const o=EditSources.cursor({kind:"type",detailedSource:s});this._executeEdit(()=>{if(s==="keyboard"){const r=t.length;let l=0;for(;l<r;){const c=nextCharLength(t,l),d=t.substr(l,c);this._executeEditOperation(TypeOperations.typeWithInterceptors(!!this._compositionState,this._prevEditOperationType,this.context.cursorConfig,this._model,this.getSelections(),this.getAutoClosedCharacters(),d),o),l+=c}}else this._executeEditOperation(TypeOperations.typeWithoutInterceptors(this._prevEditOperationType,this.context.cursorConfig,this._model,this.getSelections(),t),o)},e,s)}compositionType(e,t,s,o,r,l){const c=EditSources.cursor({kind:"compositionType",detailedSource:l});if(t.length===0&&s===0&&o===0){if(r!==0){const d=this.getSelections().map(u=>{const g=u.getPosition();return new Selection$1(g.lineNumber,g.column+r,g.lineNumber,g.column+r)});this.setSelections(e,l,d,0)}return}this._executeEdit(()=>{this._executeEditOperation(TypeOperations.compositionType(this._prevEditOperationType,this.context.cursorConfig,this._model,this.getSelections(),t,s,o,r),c)},e,l)}paste(e,t,s,o,r){const l=EditSources.cursor({kind:"paste",detailedSource:r});this._executeEdit(()=>{this._executeEditOperation(TypeOperations.paste(this.context.cursorConfig,this._model,this.getSelections(),t,s,o||[]),l)},e,r,4)}cut(e,t){const s=EditSources.cursor({kind:"cut",detailedSource:t});this._executeEdit(()=>{this._executeEditOperation(DeleteOperations.cut(this.context.cursorConfig,this._model,this.getSelections()),s)},e,t)}executeCommand(e,t,s){const o=EditSources.cursor({kind:"executeCommand",detailedSource:s});this._executeEdit(()=>{this._cursors.killSecondaryCursors(),this._executeEditOperation(new EditOperationResult(0,[t],{shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!1}),o)},e,s)}executeCommands(e,t,s){const o=EditSources.cursor({kind:"executeCommands",detailedSource:s});this._executeEdit(()=>{this._executeEditOperation(new EditOperationResult(0,t,{shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!1}),o)},e,s)}}class CursorModelState{static from(e,t){return new CursorModelState(e.getVersionId(),t.getCursorStates())}constructor(e,t){this.modelVersionId=e,this.cursorState=t}equals(e){if(!e||this.modelVersionId!==e.modelVersionId||this.cursorState.length!==e.cursorState.length)return!1;for(let t=0,s=this.cursorState.length;t<s;t++)if(!this.cursorState[t].equals(e.cursorState[t]))return!1;return!0}}class AutoClosedAction{static getAllAutoClosedCharacters(e){let t=[];for(const s of e)t=t.concat(s.getAutoClosedCharactersRanges());return t}constructor(e,t,s){this._model=e,this._autoClosedCharactersDecorations=t,this._autoClosedEnclosingDecorations=s}dispose(){this._autoClosedCharactersDecorations=this._model.deltaDecorations(this._autoClosedCharactersDecorations,[]),this._autoClosedEnclosingDecorations=this._model.deltaDecorations(this._autoClosedEnclosingDecorations,[])}getAutoClosedCharactersRanges(){const e=[];for(let t=0;t<this._autoClosedCharactersDecorations.length;t++){const s=this._model.getDecorationRange(this._autoClosedCharactersDecorations[t]);s&&e.push(s)}return e}isValid(e){const t=[];for(let s=0;s<this._autoClosedEnclosingDecorations.length;s++){const o=this._model.getDecorationRange(this._autoClosedEnclosingDecorations[s]);if(o&&(t.push(o),o.startLineNumber!==o.endLineNumber))return!1}t.sort(Range$2.compareRangesUsingStarts),e.sort(Range$2.compareRangesUsingStarts);for(let s=0;s<e.length;s++)if(s>=t.length||!t[s].strictContainsRange(e[s]))return!1;return!0}}class CommandExecutor{static executeCommands(e,t,s,o=EditSources.unknown({name:"executeCommands"})){const r={model:e,selectionsBefore:t,trackedRanges:[],trackedRangesDirection:[]},l=this._innerExecuteCommands(r,s,o);for(let c=0,d=r.trackedRanges.length;c<d;c++)r.model._setTrackedRange(r.trackedRanges[c],null,0);return l}static _innerExecuteCommands(e,t,s){if(this._arrayIsEmpty(t))return null;const o=this._getEditOperations(e,t);if(o.operations.length===0)return null;const r=o.operations,l=this._getLoserCursorMap(r);if(l.hasOwnProperty("0"))return console.warn("Ignoring commands"),null;const c=[];for(let g=0,f=r.length;g<f;g++)l.hasOwnProperty(r[g].identifier.major.toString())||c.push(r[g]);o.hadTrackedEditOperation&&c.length>0&&(c[0]._isTracked=!0);let d=e.model.pushEditOperations(e.selectionsBefore,c,g=>{const f=[];for(let _=0;_<e.selectionsBefore.length;_++)f[_]=[];for(const _ of g)_.identifier&&f[_.identifier.major].push(_);const p=(_,C)=>_.identifier.minor-C.identifier.minor,m=[];for(let _=0;_<e.selectionsBefore.length;_++)f[_].length>0?(f[_].sort(p),m[_]=t[_].computeCursorState(e.model,{getInverseEditOperations:()=>f[_],getTrackedSelection:C=>{const b=parseInt(C,10),v=e.model._getTrackedRange(e.trackedRanges[b]);return e.trackedRangesDirection[b]===0?new Selection$1(v.startLineNumber,v.startColumn,v.endLineNumber,v.endColumn):new Selection$1(v.endLineNumber,v.endColumn,v.startLineNumber,v.startColumn)}})):m[_]=e.selectionsBefore[_];return m},void 0,s);d||(d=e.selectionsBefore);const u=[];for(const g in l)l.hasOwnProperty(g)&&u.push(parseInt(g,10));u.sort((g,f)=>f-g);for(const g of u)d.splice(g,1);return d}static _arrayIsEmpty(e){for(let t=0,s=e.length;t<s;t++)if(e[t])return!1;return!0}static _getEditOperations(e,t){let s=[],o=!1;for(let r=0,l=t.length;r<l;r++){const c=t[r];if(c){const d=this._getEditOperationsFromCommand(e,r,c);s=s.concat(d.operations),o=o||d.hadTrackedEditOperation}}return{operations:s,hadTrackedEditOperation:o}}static _getEditOperationsFromCommand(e,t,s){const o=[];let r=0;const l=(f,p,m=!1)=>{Range$2.isEmpty(f)&&p===""||o.push({identifier:{major:t,minor:r++},range:f,text:p,forceMoveMarkers:m,isAutoWhitespaceEdit:s.insertsAutoWhitespace})};let c=!1;const g={addEditOperation:l,addTrackedEditOperation:(f,p,m)=>{c=!0,l(f,p,m)},trackSelection:(f,p)=>{const m=Selection$1.liftSelection(f);let _;if(m.isEmpty())if(typeof p=="boolean")p?_=2:_=3;else{const v=e.model.getLineMaxColumn(m.startLineNumber);m.startColumn===v?_=2:_=3}else _=1;const C=e.trackedRanges.length,b=e.model._setTrackedRange(null,m,_);return e.trackedRanges[C]=b,e.trackedRangesDirection[C]=m.getDirection(),C.toString()}};try{s.getEditOperations(e.model,g)}catch(f){return onUnexpectedError(f),{operations:[],hadTrackedEditOperation:!1}}return{operations:o,hadTrackedEditOperation:c}}static _getLoserCursorMap(e){e=e.slice(0),e.sort((s,o)=>-Range$2.compareRangesUsingEnds(s.range,o.range));const t={};for(let s=1;s<e.length;s++){const o=e[s-1],r=e[s];if(Range$2.getStartPosition(o.range).isBefore(Range$2.getEndPosition(r.range))){let l;o.identifier.major>r.identifier.major?l=o.identifier.major:l=r.identifier.major,t[l.toString()]=!0;for(let c=0;c<e.length;c++)e[c].identifier.major===l&&(e.splice(c,1),c<s&&s--,c--);s>0&&s--}}return t}}class CompositionLineState{constructor(e,t,s,o){this.text=e,this.lineNumber=t,this.startSelectionOffset=s,this.endSelectionOffset=o}}class CompositionState{static _capture(e,t){const s=[];for(const o of t){if(o.startLineNumber!==o.endLineNumber)return null;const r=o.startLineNumber;s.push(new CompositionLineState(e.getLineContent(r),r,o.startColumn-1,o.endColumn-1))}return s}constructor(e,t){this._original=CompositionState._capture(e,t)}deduceOutcome(e,t){if(!this._original)return null;const s=CompositionState._capture(e,t);if(!s||this._original.length!==s.length)return null;const o=[];for(let r=0,l=this._original.length;r<l;r++)o.push(CompositionState._deduceOutcome(this._original[r],s[r]));return o}static _deduceOutcome(e,t){const s=Math.min(e.startSelectionOffset,t.startSelectionOffset,commonPrefixLength(e.text,t.text)),o=Math.min(e.text.length-e.endSelectionOffset,t.text.length-t.endSelectionOffset,commonSuffixLength(e.text,t.text)),r=e.text.substring(s,e.text.length-o),l=s,c=t.text.length-o,d=t.text.substring(l,c),u=new Range$2(t.lineNumber,l+1,t.lineNumber,c+1);return new CompositionOutcome(r,e.startSelectionOffset-s,e.endSelectionOffset-s,d,t.startSelectionOffset-s,t.endSelectionOffset-s,u)}}const fallback={getInitialState:()=>NullState,tokenizeEncoded:(a,e,t)=>nullTokenizeEncoded(0,t)};async function tokenizeToString(a,e,t){if(!t)return _tokenizeToString(e,a.languageIdCodec,fallback);const s=await TokenizationRegistry.getOrCreate(t);return _tokenizeToString(e,a.languageIdCodec,s||fallback)}function tokenizeLineToHTML(a,e,t,s,o,r,l){let c="<div>",d=s,u=0,g=!0;for(let f=0,p=e.getCount();f<p;f++){const m=e.getEndOffset(f);if(m<=s)continue;let _="";for(;d<m&&d<o;d++){const C=a.charCodeAt(d);switch(C){case 9:{let b=r-(d+u)%r;for(u+=b-1;b>0;)l&&g?(_+="&#160;",g=!1):(_+=" ",g=!0),b--;break}case 60:_+="&lt;",g=!1;break;case 62:_+="&gt;",g=!1;break;case 38:_+="&amp;",g=!1;break;case 0:_+="&#00;",g=!1;break;case 65279:case 8232:case 8233:case 133:_+="�",g=!1;break;case 13:_+="&#8203",g=!1;break;case 32:l&&g?(_+="&#160;",g=!1):(_+=" ",g=!0);break;default:_+=String.fromCharCode(C),g=!1}}if(c+=`<span style="${e.getInlineStyle(f,t)}">${_}</span>`,m>o||d>=o)break}return c+="</div>",c}function _tokenizeToString(a,e,t){let s='<div class="monaco-tokenized-source">';const o=splitLines(a);let r=t.getInitialState();for(let l=0,c=o.length;l<c;l++){const d=o[l];l>0&&(s+="<br/>");const u=t.tokenizeEncoded(d,!0,r);LineTokens.convertToEndOffset(u.tokens,d.length);const f=new LineTokens(u.tokens,d,e).inflate();let p=0;for(let m=0,_=f.getCount();m<_;m++){const C=f.getClassName(m),b=f.getEndOffset(m);s+=`<span class="${C}">${escape$2(d.substring(p,b))}</span>`,p=b}r=u.endState}return s+="</div>",s}class CustomLine{constructor(e,t,s,o,r){this.decorationId=e,this.index=t,this.lineNumber=s,this.specialHeight=o,this.prefixSum=r,this.maximumSpecialHeight=o,this.deleted=!1}}class LineHeightsManager{constructor(e,t){if(this._decorationIDToCustomLine=new ArrayMap,this._orderedCustomLines=[],this._pendingSpecialLinesToInsert=[],this._invalidIndex=0,this._hasPending=!1,this._defaultLineHeight=e,t.length>0){for(const s of t)this.insertOrChangeCustomLineHeight(s.decorationId,s.startLineNumber,s.endLineNumber,s.lineHeight);this.commit()}}set defaultLineHeight(e){this._defaultLineHeight=e}get defaultLineHeight(){return this._defaultLineHeight}removeCustomLineHeight(e){const t=this._decorationIDToCustomLine.get(e);if(t){this._decorationIDToCustomLine.delete(e);for(const s of t)s.deleted=!0,this._invalidIndex=Math.min(this._invalidIndex,s.index);this._hasPending=!0}}insertOrChangeCustomLineHeight(e,t,s,o){this.removeCustomLineHeight(e);for(let r=t;r<=s;r++){const l=new CustomLine(e,-1,r,o,0);this._pendingSpecialLinesToInsert.push(l)}this._hasPending=!0}heightForLineNumber(e){const t=this._binarySearchOverOrderedCustomLinesArray(e);return t>=0?this._orderedCustomLines[t].maximumSpecialHeight:this._defaultLineHeight}getAccumulatedLineHeightsIncludingLineNumber(e){const t=this._binarySearchOverOrderedCustomLinesArray(e);if(t>=0)return this._orderedCustomLines[t].prefixSum+this._orderedCustomLines[t].maximumSpecialHeight;if(t===-1)return this._defaultLineHeight*e;const s=-(t+1),o=this._orderedCustomLines[s-1];return o.prefixSum+o.maximumSpecialHeight+this._defaultLineHeight*(e-o.lineNumber)}onLinesDeleted(e,t){const s=t-e+1,o=this._orderedCustomLines.length,r=this._binarySearchOverOrderedCustomLinesArray(e);let l;if(r>=0){l=r;for(let f=r-1;f>=0&&this._orderedCustomLines[f].lineNumber===e;f--)l--}else l=r===-(o+1)&&r!==-1?o-1:-(r+1);const c=this._binarySearchOverOrderedCustomLinesArray(t);let d;if(c>=0){d=c;for(let f=c+1;f<o&&this._orderedCustomLines[f].lineNumber===t;f++)d++}else d=c===-(o+1)&&c!==-1?o-1:-(c+1);const u=d>l,g=d===l&&this._orderedCustomLines[l]&&this._orderedCustomLines[l].lineNumber>=e&&this._orderedCustomLines[l].lineNumber<=t;if(u||g){let f=0;for(let x=l;x<=d;x++)f=Math.max(f,this._orderedCustomLines[x].maximumSpecialHeight);let p=0;if(l>0){const x=this._orderedCustomLines[l-1];p=x.prefixSum+x.maximumSpecialHeight+this._defaultLineHeight*(e-x.lineNumber-1)}else p=e>0?(e-1)*this._defaultLineHeight:0;const m=this._orderedCustomLines[l],_=this._orderedCustomLines[d],C=this._orderedCustomLines[d+1],b=C&&C.lineNumber===t+1?C.maximumSpecialHeight:this._defaultLineHeight,v=_.prefixSum+_.maximumSpecialHeight-m.prefixSum+this._defaultLineHeight*(t-_.lineNumber)+this._defaultLineHeight*(m.lineNumber-e)+b-f,S=new Set,y=[],w=new ArrayMap;let L=0;for(let x=0;x<this._orderedCustomLines.length;x++){const E=this._orderedCustomLines[x];if(x<l)y.push(E),w.add(E.decorationId,E);else if(x>=l&&x<=d){const I=E.decorationId;S.has(I)?L++:(E.index-=L,E.lineNumber=e,E.prefixSum=p,E.maximumSpecialHeight=f,y.push(E),w.add(E.decorationId,E))}else x>d&&(E.index-=L,E.lineNumber-=s,E.prefixSum-=v,y.push(E),w.add(E.decorationId,E));S.add(E.decorationId)}this._orderedCustomLines=y,this._decorationIDToCustomLine=w}else{const f=s*this._defaultLineHeight;for(let p=d;p<this._orderedCustomLines.length;p++){const m=this._orderedCustomLines[p];m.lineNumber>t&&(m.lineNumber-=s,m.prefixSum-=f)}}}onLinesInserted(e,t){const s=t-e+1,o=this._binarySearchOverOrderedCustomLinesArray(e);let r;if(o>=0){r=o;for(let g=o-1;g>=0&&this._orderedCustomLines[g].lineNumber===e;g--)r--}else r=-(o+1);const l=[],c=new Set;for(let g=r;g<this._orderedCustomLines.length;g++)this._orderedCustomLines[g].lineNumber===e&&c.add(this._orderedCustomLines[g].decorationId);const d=new Set;for(let g=r-1;g>=0;g--)this._orderedCustomLines[g].lineNumber===e-1&&d.add(this._orderedCustomLines[g].decorationId);const u=intersection(d,c);for(let g=r;g<this._orderedCustomLines.length;g++)this._orderedCustomLines[g].lineNumber+=s,this._orderedCustomLines[g].prefixSum+=this._defaultLineHeight*s;if(u.size>0){for(const g of u){const f=this._decorationIDToCustomLine.get(g);if(f){const p=f.reduce((C,b)=>Math.min(C,b.lineNumber),e),m=f.reduce((C,b)=>Math.max(C,b.lineNumber),e),_=f.reduce((C,b)=>Math.max(C,b.specialHeight),0);l.push({decorationId:g,startLineNumber:p,endLineNumber:m,lineHeight:_})}}for(const g of l)this.insertOrChangeCustomLineHeight(g.decorationId,g.startLineNumber,g.endLineNumber,g.lineHeight);this.commit()}}commit(){if(!this._hasPending)return;for(const r of this._pendingSpecialLinesToInsert){const l=this._binarySearchOverOrderedCustomLinesArray(r.lineNumber),c=l>=0?l:-(l+1);this._orderedCustomLines.splice(c,0,r),this._invalidIndex=Math.min(this._invalidIndex,c)}this._pendingSpecialLinesToInsert=[];const e=new ArrayMap,t=[];for(let r=0;r<this._invalidIndex;r++){const l=this._orderedCustomLines[r];t.push(l),e.add(l.decorationId,l)}let s=0,o=this._invalidIndex>0?t[this._invalidIndex-1]:void 0;for(let r=this._invalidIndex;r<this._orderedCustomLines.length;r++){const l=this._orderedCustomLines[r];if(l.deleted){s++;continue}if(l.index=r-s,o&&o.lineNumber===l.lineNumber)l.maximumSpecialHeight=o.maximumSpecialHeight,l.prefixSum=o.prefixSum;else{let c=l.specialHeight;for(let u=r;u<this._orderedCustomLines.length;u++){const g=this._orderedCustomLines[u];if(!g.deleted){if(g.lineNumber!==l.lineNumber)break;c=Math.max(c,g.specialHeight)}}l.maximumSpecialHeight=c;let d;o?d=o.prefixSum+o.maximumSpecialHeight+this._defaultLineHeight*(l.lineNumber-o.lineNumber-1):d=this._defaultLineHeight*(l.lineNumber-1),l.prefixSum=d}o=l,t.push(l),e.add(l.decorationId,l)}this._orderedCustomLines=t,this._decorationIDToCustomLine=e,this._invalidIndex=1/0,this._hasPending=!1}_binarySearchOverOrderedCustomLinesArray(e){return binarySearch2(this._orderedCustomLines.length,t=>{const s=this._orderedCustomLines[t];return s.lineNumber===e?0:s.lineNumber<e?-1:1})}}class ArrayMap{constructor(){this._map=new Map}add(e,t){const s=this._map.get(e);s?s.push(t):this._map.set(e,[t])}get(e){return this._map.get(e)}delete(e){this._map.delete(e)}}class PendingChanges{constructor(){this._hasPending=!1,this._inserts=[],this._changes=[],this._removes=[]}insert(e){this._hasPending=!0,this._inserts.push(e)}change(e){this._hasPending=!0,this._changes.push(e)}remove(e){this._hasPending=!0,this._removes.push(e)}commit(e){if(!this._hasPending)return;const t=this._inserts,s=this._changes,o=this._removes;this._hasPending=!1,this._inserts=[],this._changes=[],this._removes=[],e._commitPendingChanges(t,s,o)}}class EditorWhitespace{constructor(e,t,s,o,r){this.id=e,this.afterLineNumber=t,this.ordinal=s,this.height=o,this.minWidth=r,this.prefixSum=0}}var Dt;let LinesLayout$1=(Dt=class{constructor(e,t,s,o,r){this._instanceId=singleLetterHash(++Dt.INSTANCE_COUNT),this._pendingChanges=new PendingChanges,this._lastWhitespaceId=0,this._arr=[],this._prefixSumValidIndex=-1,this._minWidth=-1,this._lineCount=e,this._paddingTop=s,this._paddingBottom=o,this._lineHeightsManager=new LineHeightsManager(t,r)}static findInsertionIndex(e,t,s){let o=0,r=e.length;for(;o<r;){const l=o+r>>>1;t===e[l].afterLineNumber?s<e[l].ordinal?r=l:o=l+1:t<e[l].afterLineNumber?r=l:o=l+1}return o}setDefaultLineHeight(e){this._lineHeightsManager.defaultLineHeight=e}setPadding(e,t){this._paddingTop=e,this._paddingBottom=t}onFlushed(e,t){this._lineCount=e,this._lineHeightsManager=new LineHeightsManager(this._lineHeightsManager.defaultLineHeight,t)}changeLineHeights(e){let t=!1;try{e({insertOrChangeCustomLineHeight:(o,r,l,c)=>{t=!0,this._lineHeightsManager.insertOrChangeCustomLineHeight(o,r,l,c)},removeCustomLineHeight:o=>{t=!0,this._lineHeightsManager.removeCustomLineHeight(o)}})}finally{this._lineHeightsManager.commit()}return t}changeWhitespace(e){let t=!1;try{e({insertWhitespace:(o,r,l,c)=>{t=!0,o=o|0,r=r|0,l=l|0,c=c|0;const d=this._instanceId+ ++this._lastWhitespaceId;return this._pendingChanges.insert(new EditorWhitespace(d,o,r,l,c)),d},changeOneWhitespace:(o,r,l)=>{t=!0,r=r|0,l=l|0,this._pendingChanges.change({id:o,newAfterLineNumber:r,newHeight:l})},removeWhitespace:o=>{t=!0,this._pendingChanges.remove({id:o})}})}finally{this._pendingChanges.commit(this)}return t}_commitPendingChanges(e,t,s){if((e.length>0||s.length>0)&&(this._minWidth=-1),e.length+t.length+s.length<=1){for(const d of e)this._insertWhitespace(d);for(const d of t)this._changeOneWhitespace(d.id,d.newAfterLineNumber,d.newHeight);for(const d of s){const u=this._findWhitespaceIndex(d.id);u!==-1&&this._removeWhitespace(u)}return}const o=new Set;for(const d of s)o.add(d.id);const r=new Map;for(const d of t)r.set(d.id,d);const l=d=>{const u=[];for(const g of d)if(!o.has(g.id)){if(r.has(g.id)){const f=r.get(g.id);g.afterLineNumber=f.newAfterLineNumber,g.height=f.newHeight}u.push(g)}return u},c=l(this._arr).concat(l(e));c.sort((d,u)=>d.afterLineNumber===u.afterLineNumber?d.ordinal-u.ordinal:d.afterLineNumber-u.afterLineNumber),this._arr=c,this._prefixSumValidIndex=-1}_insertWhitespace(e){const t=Dt.findInsertionIndex(this._arr,e.afterLineNumber,e.ordinal);this._arr.splice(t,0,e),this._prefixSumValidIndex=Math.min(this._prefixSumValidIndex,t-1)}_findWhitespaceIndex(e){const t=this._arr;for(let s=0,o=t.length;s<o;s++)if(t[s].id===e)return s;return-1}_changeOneWhitespace(e,t,s){const o=this._findWhitespaceIndex(e);if(o!==-1&&(this._arr[o].height!==s&&(this._arr[o].height=s,this._prefixSumValidIndex=Math.min(this._prefixSumValidIndex,o-1)),this._arr[o].afterLineNumber!==t)){const r=this._arr[o];this._removeWhitespace(o),r.afterLineNumber=t,this._insertWhitespace(r)}}_removeWhitespace(e){this._arr.splice(e,1),this._prefixSumValidIndex=Math.min(this._prefixSumValidIndex,e-1)}onLinesDeleted(e,t){e=e|0,t=t|0,this._lineCount-=t-e+1;for(let s=0,o=this._arr.length;s<o;s++){const r=this._arr[s].afterLineNumber;e<=r&&r<=t?this._arr[s].afterLineNumber=e-1:r>t&&(this._arr[s].afterLineNumber-=t-e+1)}this._lineHeightsManager.onLinesDeleted(e,t)}onLinesInserted(e,t){e=e|0,t=t|0,this._lineCount+=t-e+1;for(let s=0,o=this._arr.length;s<o;s++){const r=this._arr[s].afterLineNumber;e<=r&&(this._arr[s].afterLineNumber+=t-e+1)}this._lineHeightsManager.onLinesInserted(e,t)}getWhitespacesTotalHeight(){return this._arr.length===0?0:this.getWhitespacesAccumulatedHeight(this._arr.length-1)}getWhitespacesAccumulatedHeight(e){e=e|0;let t=Math.max(0,this._prefixSumValidIndex+1);t===0&&(this._arr[0].prefixSum=this._arr[0].height,t++);for(let s=t;s<=e;s++)this._arr[s].prefixSum=this._arr[s-1].prefixSum+this._arr[s].height;return this._prefixSumValidIndex=Math.max(this._prefixSumValidIndex,e),this._arr[e].prefixSum}getLinesTotalHeight(){const e=this._lineHeightsManager.getAccumulatedLineHeightsIncludingLineNumber(this._lineCount),t=this.getWhitespacesTotalHeight();return e+t+this._paddingTop+this._paddingBottom}getWhitespaceAccumulatedHeightBeforeLineNumber(e){e=e|0;const t=this._findLastWhitespaceBeforeLineNumber(e);return t===-1?0:this.getWhitespacesAccumulatedHeight(t)}_findLastWhitespaceBeforeLineNumber(e){e=e|0;const t=this._arr;let s=0,o=t.length-1;for(;s<=o;){const l=(o-s|0)/2|0,c=s+l|0;if(t[c].afterLineNumber<e){if(c+1>=t.length||t[c+1].afterLineNumber>=e)return c;s=c+1|0}else o=c-1|0}return-1}_findFirstWhitespaceAfterLineNumber(e){e=e|0;const s=this._findLastWhitespaceBeforeLineNumber(e)+1;return s<this._arr.length?s:-1}getFirstWhitespaceIndexAfterLineNumber(e){return e=e|0,this._findFirstWhitespaceAfterLineNumber(e)}getVerticalOffsetForLineNumber(e,t=!1){e=e|0;let s;e>1?s=this._lineHeightsManager.getAccumulatedLineHeightsIncludingLineNumber(e-1):s=0;const o=this.getWhitespaceAccumulatedHeightBeforeLineNumber(e-(t?1:0));return s+o+this._paddingTop}getLineHeightForLineNumber(e){return this._lineHeightsManager.heightForLineNumber(e)}getVerticalOffsetAfterLineNumber(e,t=!1){e=e|0;const s=this._lineHeightsManager.getAccumulatedLineHeightsIncludingLineNumber(e),o=this.getWhitespaceAccumulatedHeightBeforeLineNumber(e+(t?1:0));return s+o+this._paddingTop}getWhitespaceMinWidth(){if(this._minWidth===-1){let e=0;for(let t=0,s=this._arr.length;t<s;t++)e=Math.max(e,this._arr[t].minWidth);this._minWidth=e}return this._minWidth}isAfterLines(e){const t=this.getLinesTotalHeight();return e>t}isInTopPadding(e){return this._paddingTop===0?!1:e<this._paddingTop}isInBottomPadding(e){if(this._paddingBottom===0)return!1;const t=this.getLinesTotalHeight();return e>=t-this._paddingBottom}getLineNumberAtOrAfterVerticalOffset(e){if(e=e|0,e<0)return 1;const t=this._lineCount|0;let s=1,o=t;for(;s<o;){const r=(s+o)/2|0,l=this.getLineHeightForLineNumber(r),c=this.getVerticalOffsetForLineNumber(r)|0;if(e>=c+l)s=r+1;else{if(e>=c)return r;o=r}}return s>t?t:s}getLinesViewportData(e,t){e=e|0,t=t|0;const s=this.getLineNumberAtOrAfterVerticalOffset(e)|0,o=this.getVerticalOffsetForLineNumber(s)|0;let r=this._lineCount|0,l=this.getFirstWhitespaceIndexAfterLineNumber(s)|0;const c=this.getWhitespacesCount()|0;let d,u;l===-1?(l=c,u=r+1,d=0):(u=this.getAfterLineNumberForWhitespaceIndex(l)|0,d=this.getHeightForWhitespaceIndex(l)|0);let g=o,f=g;const p=5e5;let m=0;o>=p&&(m=Math.floor(o/p)*p,m=Math.floor(m/this._lineHeightsManager.defaultLineHeight)*this._lineHeightsManager.defaultLineHeight,f-=m);const _=[],C=e+(t-e)/2;let b=-1;for(let w=s;w<=r;w++){const L=this.getLineHeightForLineNumber(w);if(b===-1){const x=g,E=g+L;(x<=C&&C<E||x>C)&&(b=w)}for(g+=L,_[w-s]=f,f+=L;u===w;)f+=d,g+=d,l++,l>=c?u=r+1:(u=this.getAfterLineNumberForWhitespaceIndex(l)|0,d=this.getHeightForWhitespaceIndex(l)|0);if(g>=t){r=w;break}}b===-1&&(b=r);const v=this.getVerticalOffsetForLineNumber(r)|0;let S=s,y=r;if(S<y&&o<e&&S++,S<y){const w=this.getLineHeightForLineNumber(r);v+w>t&&y--}return{bigNumbersDelta:m,startLineNumber:s,endLineNumber:r,relativeVerticalOffset:_,centeredLineNumber:b,completelyVisibleStartLineNumber:S,completelyVisibleEndLineNumber:y,lineHeight:this._lineHeightsManager.defaultLineHeight}}getVerticalOffsetForWhitespaceIndex(e){e=e|0;const t=this.getAfterLineNumberForWhitespaceIndex(e);let s;t>=1?s=this._lineHeightsManager.getAccumulatedLineHeightsIncludingLineNumber(t):s=0;let o;return e>0?o=this.getWhitespacesAccumulatedHeight(e-1):o=0,s+o+this._paddingTop}getWhitespaceIndexAtOrAfterVerticallOffset(e){e=e|0;let t=0,s=this.getWhitespacesCount()-1;if(s<0)return-1;const o=this.getVerticalOffsetForWhitespaceIndex(s),r=this.getHeightForWhitespaceIndex(s);if(e>=o+r)return-1;for(;t<s;){const l=Math.floor((t+s)/2),c=this.getVerticalOffsetForWhitespaceIndex(l),d=this.getHeightForWhitespaceIndex(l);if(e>=c+d)t=l+1;else{if(e>=c)return l;s=l}}return t}getWhitespaceAtVerticalOffset(e){e=e|0;const t=this.getWhitespaceIndexAtOrAfterVerticallOffset(e);if(t<0||t>=this.getWhitespacesCount())return null;const s=this.getVerticalOffsetForWhitespaceIndex(t);if(s>e)return null;const o=this.getHeightForWhitespaceIndex(t),r=this.getIdForWhitespaceIndex(t),l=this.getAfterLineNumberForWhitespaceIndex(t);return{id:r,afterLineNumber:l,verticalOffset:s,height:o}}getWhitespaceViewportData(e,t){e=e|0,t=t|0;const s=this.getWhitespaceIndexAtOrAfterVerticallOffset(e),o=this.getWhitespacesCount()-1;if(s<0)return[];const r=[];for(let l=s;l<=o;l++){const c=this.getVerticalOffsetForWhitespaceIndex(l),d=this.getHeightForWhitespaceIndex(l);if(c>=t)break;r.push({id:this.getIdForWhitespaceIndex(l),afterLineNumber:this.getAfterLineNumberForWhitespaceIndex(l),verticalOffset:c,height:d})}return r}getWhitespaces(){return this._arr.slice(0)}getWhitespacesCount(){return this._arr.length}getIdForWhitespaceIndex(e){return e=e|0,this._arr[e].id}getAfterLineNumberForWhitespaceIndex(e){return e=e|0,this._arr[e].afterLineNumber}getHeightForWhitespaceIndex(e){return e=e|0,this._arr[e].height}},Dt.INSTANCE_COUNT=0,Dt);const SMOOTH_SCROLLING_TIME=125;class EditorScrollDimensions{constructor(e,t,s,o){e=e|0,t=t|0,s=s|0,o=o|0,e<0&&(e=0),t<0&&(t=0),s<0&&(s=0),o<0&&(o=0),this.width=e,this.contentWidth=t,this.scrollWidth=Math.max(e,t),this.height=s,this.contentHeight=o,this.scrollHeight=Math.max(s,o)}equals(e){return this.width===e.width&&this.contentWidth===e.contentWidth&&this.height===e.height&&this.contentHeight===e.contentHeight}}class EditorScrollable extends Disposable{constructor(e,t){super(),this._onDidContentSizeChange=this._register(new Emitter$1),this.onDidContentSizeChange=this._onDidContentSizeChange.event,this._dimensions=new EditorScrollDimensions(0,0,0,0),this._scrollable=this._register(new Scrollable({forceIntegerValues:!0,smoothScrollDuration:e,scheduleAtNextAnimationFrame:t})),this.onDidScroll=this._scrollable.onScroll}getScrollable(){return this._scrollable}setSmoothScrollDuration(e){this._scrollable.setSmoothScrollDuration(e)}validateScrollPosition(e){return this._scrollable.validateScrollPosition(e)}getScrollDimensions(){return this._dimensions}setScrollDimensions(e){if(this._dimensions.equals(e))return;const t=this._dimensions;this._dimensions=e,this._scrollable.setScrollDimensions({width:e.width,scrollWidth:e.scrollWidth,height:e.height,scrollHeight:e.scrollHeight},!0);const s=t.contentWidth!==e.contentWidth,o=t.contentHeight!==e.contentHeight;(s||o)&&this._onDidContentSizeChange.fire(new ContentSizeChangedEvent(t.contentWidth,t.contentHeight,e.contentWidth,e.contentHeight))}getFutureScrollPosition(){return this._scrollable.getFutureScrollPosition()}getCurrentScrollPosition(){return this._scrollable.getCurrentScrollPosition()}setScrollPositionNow(e){this._scrollable.setScrollPositionNow(e)}setScrollPositionSmooth(e){this._scrollable.setScrollPositionSmooth(e)}hasPendingScrollAnimation(){return this._scrollable.hasPendingScrollAnimation()}}class ViewLayout extends Disposable{constructor(e,t,s,o){super(),this._configuration=e;const r=this._configuration.options,l=r.get(165),c=r.get(96);this._linesLayout=new LinesLayout$1(t,r.get(75),c.top,c.bottom,s),this._maxLineWidth=0,this._overlayWidgetsMinWidth=0,this._scrollable=this._register(new EditorScrollable(0,o)),this._configureSmoothScrollDuration(),this._scrollable.setScrollDimensions(new EditorScrollDimensions(l.contentWidth,0,l.height,0)),this.onDidScroll=this._scrollable.onDidScroll,this.onDidContentSizeChange=this._scrollable.onDidContentSizeChange,this._updateHeight()}dispose(){super.dispose()}getScrollable(){return this._scrollable.getScrollable()}onHeightMaybeChanged(){this._updateHeight()}_configureSmoothScrollDuration(){this._scrollable.setSmoothScrollDuration(this._configuration.options.get(130)?SMOOTH_SCROLLING_TIME:0)}onConfigurationChanged(e){const t=this._configuration.options;if(e.hasChanged(75)&&this._linesLayout.setDefaultLineHeight(t.get(75)),e.hasChanged(96)){const s=t.get(96);this._linesLayout.setPadding(s.top,s.bottom)}if(e.hasChanged(165)){const s=t.get(165),o=s.contentWidth,r=s.height,l=this._scrollable.getScrollDimensions(),c=l.contentWidth;this._scrollable.setScrollDimensions(new EditorScrollDimensions(o,l.contentWidth,r,this._getContentHeight(o,r,c)))}else this._updateHeight();e.hasChanged(130)&&this._configureSmoothScrollDuration()}onFlushed(e,t){this._linesLayout.onFlushed(e,t)}onLinesDeleted(e,t){this._linesLayout.onLinesDeleted(e,t)}onLinesInserted(e,t){this._linesLayout.onLinesInserted(e,t)}_getHorizontalScrollbarHeight(e,t){const o=this._configuration.options.get(117);return o.horizontal===2||e>=t?0:o.horizontalScrollbarSize}_getContentHeight(e,t,s){const o=this._configuration.options;let r=this._linesLayout.getLinesTotalHeight();return o.get(119)?r+=Math.max(0,t-o.get(75)-o.get(96).bottom):o.get(117).ignoreHorizontalScrollbarInContentHeight||(r+=this._getHorizontalScrollbarHeight(e,s)),r}_updateHeight(){const e=this._scrollable.getScrollDimensions(),t=e.width,s=e.height,o=e.contentWidth;this._scrollable.setScrollDimensions(new EditorScrollDimensions(t,e.contentWidth,s,this._getContentHeight(t,s,o)))}getCurrentViewport(){const e=this._scrollable.getScrollDimensions(),t=this._scrollable.getCurrentScrollPosition();return new Viewport(t.scrollTop,t.scrollLeft,e.width,e.height)}getFutureViewport(){const e=this._scrollable.getScrollDimensions(),t=this._scrollable.getFutureScrollPosition();return new Viewport(t.scrollTop,t.scrollLeft,e.width,e.height)}_computeContentWidth(){const e=this._configuration.options,t=this._maxLineWidth,s=e.get(166),o=e.get(59),r=e.get(165);if(s.isViewportWrapping){const l=e.get(81);return t>r.contentWidth+o.typicalHalfwidthCharacterWidth&&l.enabled&&l.side==="right"?t+r.verticalScrollbarWidth:t}else{const l=e.get(118)*o.typicalHalfwidthCharacterWidth,c=this._linesLayout.getWhitespaceMinWidth();return Math.max(t+l+r.verticalScrollbarWidth,c,this._overlayWidgetsMinWidth)}}setMaxLineWidth(e){this._maxLineWidth=e,this._updateContentWidth()}setOverlayWidgetsMinWidth(e){this._overlayWidgetsMinWidth=e,this._updateContentWidth()}_updateContentWidth(){const e=this._scrollable.getScrollDimensions();this._scrollable.setScrollDimensions(new EditorScrollDimensions(e.width,this._computeContentWidth(),e.height,e.contentHeight)),this._updateHeight()}saveState(){const e=this._scrollable.getFutureScrollPosition(),t=e.scrollTop,s=this._linesLayout.getLineNumberAtOrAfterVerticalOffset(t),o=this._linesLayout.getWhitespaceAccumulatedHeightBeforeLineNumber(s);return{scrollTop:t,scrollTopWithoutViewZones:t-o,scrollLeft:e.scrollLeft}}changeWhitespace(e){const t=this._linesLayout.changeWhitespace(e);return t&&this.onHeightMaybeChanged(),t}changeSpecialLineHeights(e){const t=this._linesLayout.changeLineHeights(e);return t&&this.onHeightMaybeChanged(),t}getVerticalOffsetForLineNumber(e,t=!1){return this._linesLayout.getVerticalOffsetForLineNumber(e,t)}getVerticalOffsetAfterLineNumber(e,t=!1){return this._linesLayout.getVerticalOffsetAfterLineNumber(e,t)}getLineHeightForLineNumber(e){return this._linesLayout.getLineHeightForLineNumber(e)}isAfterLines(e){return this._linesLayout.isAfterLines(e)}isInTopPadding(e){return this._linesLayout.isInTopPadding(e)}isInBottomPadding(e){return this._linesLayout.isInBottomPadding(e)}getLineNumberAtVerticalOffset(e){return this._linesLayout.getLineNumberAtOrAfterVerticalOffset(e)}getWhitespaceAtVerticalOffset(e){return this._linesLayout.getWhitespaceAtVerticalOffset(e)}getLinesViewportData(){const e=this.getCurrentViewport();return this._linesLayout.getLinesViewportData(e.top,e.top+e.height)}getLinesViewportDataAtScrollTop(e){const t=this._scrollable.getScrollDimensions();return e+t.height>t.scrollHeight&&(e=t.scrollHeight-t.height),e<0&&(e=0),this._linesLayout.getLinesViewportData(e,e+t.height)}getWhitespaceViewportData(){const e=this.getCurrentViewport();return this._linesLayout.getWhitespaceViewportData(e.top,e.top+e.height)}getWhitespaces(){return this._linesLayout.getWhitespaces()}getContentWidth(){return this._scrollable.getScrollDimensions().contentWidth}getScrollWidth(){return this._scrollable.getScrollDimensions().scrollWidth}getContentHeight(){return this._scrollable.getScrollDimensions().contentHeight}getScrollHeight(){return this._scrollable.getScrollDimensions().scrollHeight}getCurrentScrollLeft(){return this._scrollable.getCurrentScrollPosition().scrollLeft}getCurrentScrollTop(){return this._scrollable.getCurrentScrollPosition().scrollTop}validateScrollPosition(e){return this._scrollable.validateScrollPosition(e)}setScrollPosition(e,t){t===1?this._scrollable.setScrollPositionNow(e):this._scrollable.setScrollPositionSmooth(e)}hasPendingScrollAnimation(){return this._scrollable.hasPendingScrollAnimation()}deltaScrollNow(e,t){const s=this._scrollable.getCurrentScrollPosition();this._scrollable.setScrollPositionNow({scrollLeft:s.scrollLeft+e,scrollTop:s.scrollTop+t})}}class InlineDecoration{constructor(e,t,s){this.range=e,this.inlineClassName=t,this.type=s}}class SingleLineInlineDecoration{constructor(e,t,s,o){this.startOffset=e,this.endOffset=t,this.inlineClassName=s,this.inlineClassNameAffectsLetterSpacing=o}toInlineDecoration(e){return new InlineDecoration(new Range$2(e,this.startOffset+1,e,this.endOffset+1),this.inlineClassName,this.inlineClassNameAffectsLetterSpacing?3:0)}}class ViewModelDecorations{constructor(e,t,s,o,r){this.editorId=e,this.model=t,this.configuration=s,this._linesCollection=o,this._coordinatesConverter=r,this._decorationsCache=Object.create(null),this._cachedModelDecorationsResolver=null,this._cachedModelDecorationsResolverViewRange=null}_clearCachedModelDecorationsResolver(){this._cachedModelDecorationsResolver=null,this._cachedModelDecorationsResolverViewRange=null}dispose(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}reset(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}onModelDecorationsChanged(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}onLineMappingChanged(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}_getOrCreateViewModelDecoration(e){const t=e.id;let s=this._decorationsCache[t];if(!s){const o=e.range,r=e.options;let l;if(r.isWholeLine){const c=this._coordinatesConverter.convertModelPositionToViewPosition(new Position$1(o.startLineNumber,1),0,!1,!0),d=this._coordinatesConverter.convertModelPositionToViewPosition(new Position$1(o.endLineNumber,this.model.getLineMaxColumn(o.endLineNumber)),1);l=new Range$2(c.lineNumber,c.column,d.lineNumber,d.column)}else l=this._coordinatesConverter.convertModelRangeToViewRange(o,1);s=new ViewModelDecoration(l,r),this._decorationsCache[t]=s}return s}getMinimapDecorationsInRange(e){return this._getDecorationsInRange(e,!0,!1).decorations}getDecorationsViewportData(e){let t=this._cachedModelDecorationsResolver!==null;return t=t&&e.equalsRange(this._cachedModelDecorationsResolverViewRange),t||(this._cachedModelDecorationsResolver=this._getDecorationsInRange(e,!1,!1),this._cachedModelDecorationsResolverViewRange=e),this._cachedModelDecorationsResolver}getDecorationsOnLine(e,t=!1,s=!1){const o=new Range$2(e,this._linesCollection.getViewLineMinColumn(e),e,this._linesCollection.getViewLineMaxColumn(e));return this._getDecorationsInRange(o,t,s)}_getDecorationsInRange(e,t,s){const o=this._linesCollection.getDecorationsInRange(e,this.editorId,filterValidationDecorations(this.configuration.options),filterFontDecorations(this.configuration.options),t,s),r=e.startLineNumber,l=e.endLineNumber,c=[];let d=0;const u=[];for(let f=r;f<=l;f++)u[f-r]=[];let g=!1;for(let f=0,p=o.length;f<p;f++){const m=o[f],_=m.options;if(!isModelDecorationVisible(this.model,m))continue;const C=this._getOrCreateViewModelDecoration(m),b=C.range;if(c[d++]=C,_.inlineClassName){const v=new InlineDecoration(b,_.inlineClassName,_.inlineClassNameAffectsLetterSpacing?3:0),S=Math.max(r,b.startLineNumber),y=Math.min(l,b.endLineNumber);for(let w=S;w<=y;w++)u[w-r].push(v)}if(_.beforeContentClassName&&r<=b.startLineNumber&&b.startLineNumber<=l){const v=new InlineDecoration(new Range$2(b.startLineNumber,b.startColumn,b.startLineNumber,b.startColumn),_.beforeContentClassName,1);u[b.startLineNumber-r].push(v)}if(_.afterContentClassName&&r<=b.endLineNumber&&b.endLineNumber<=l){const v=new InlineDecoration(new Range$2(b.endLineNumber,b.endColumn,b.endLineNumber,b.endColumn),_.afterContentClassName,2);u[b.endLineNumber-r].push(v)}_.affectsFont&&(g=!0)}return{decorations:c,inlineDecorations:u,hasVariableFonts:g}}}function createModelLineProjection(a,e){return a===null?e?IdentityModelLineProjection.INSTANCE:HiddenModelLineProjection.INSTANCE:new ModelLineProjection(a,e)}class ModelLineProjection{constructor(e,t){this._projectionData=e,this._isVisible=t}isVisible(){return this._isVisible}setVisible(e){return this._isVisible=e,this}getProjectionData(){return this._projectionData}getViewLineCount(){return this._isVisible?this._projectionData.getOutputLineCount():0}getViewLineContent(e,t,s){this._assertVisible();const o=s>0?this._projectionData.breakOffsets[s-1]:0,r=this._projectionData.breakOffsets[s];let l;if(this._projectionData.injectionOffsets!==null){const c=this._projectionData.injectionOffsets.map((u,g)=>new LineInjectedText(0,0,u+1,this._projectionData.injectionOptions[g],0));l=LineInjectedText.applyInjectedText(e.getLineContent(t),c).substring(o,r)}else l=e.getValueInRange({startLineNumber:t,startColumn:o+1,endLineNumber:t,endColumn:r+1});return s>0&&(l=spaces(this._projectionData.wrappedTextIndentLength)+l),l}getViewLineLength(e,t,s){return this._assertVisible(),this._projectionData.getLineLength(s)}getViewLineMinColumn(e,t,s){return this._assertVisible(),this._projectionData.getMinOutputOffset(s)+1}getViewLineMaxColumn(e,t,s){return this._assertVisible(),this._projectionData.getMaxOutputOffset(s)+1}getViewLineData(e,t,s){const o=new Array;return this.getViewLinesData(e,t,s,1,0,[!0],o),o[0]}getViewLinesData(e,t,s,o,r,l,c){this._assertVisible();const d=this._projectionData,u=d.injectionOffsets,g=d.injectionOptions;let f=null;if(u){f=[];let m=0,_=0;for(let C=0;C<d.getOutputLineCount();C++){const b=new Array;f[C]=b;const v=C>0?d.breakOffsets[C-1]:0,S=d.breakOffsets[C];for(;_<u.length;){const y=g[_].content.length,w=u[_]+m,L=w+y;if(w>S)break;if(v<L){const x=g[_];if(x.inlineClassName){const E=C>0?d.wrappedTextIndentLength:0,I=E+Math.max(w-v,0),D=E+Math.min(L-v,S-v);I!==D&&b.push(new SingleLineInlineDecoration(I,D,x.inlineClassName,x.inlineClassNameAffectsLetterSpacing))}}if(L<=S)m+=y,_++;else break}}}let p;if(u){const m=[];for(let _=0;_<u.length;_++){const C=u[_],b=g[_].tokens;b?b.forEach((v,S)=>{m.push({offset:C,text:v.substring(g[_].content),tokenMetadata:S.metadata})}):m.push({offset:C,text:g[_].content,tokenMetadata:LineTokens.defaultTokenMetadata})}p=e.tokenization.getLineTokens(t).withInserted(m)}else p=e.tokenization.getLineTokens(t);for(let m=s;m<s+o;m++){const _=r+m-s;if(!l[_]){c[_]=null;continue}c[_]=this._getViewLineData(p,f?f[m]:null,m)}}_getViewLineData(e,t,s){this._assertVisible();const o=this._projectionData,r=s>0?o.wrappedTextIndentLength:0,l=s>0?o.breakOffsets[s-1]:0,c=o.breakOffsets[s],d=e.sliceAndInflate(l,c,r);let u=d.getLineContent();s>0&&(u=spaces(o.wrappedTextIndentLength)+u);const g=this._projectionData.getMinOutputOffset(s)+1,f=u.length+1,p=s+1<this.getViewLineCount(),m=s===0?0:o.breakOffsetsVisibleColumn[s-1];return new ViewLineData(u,p,g,f,m,d,t)}getModelColumnOfViewPosition(e,t){return this._assertVisible(),this._projectionData.translateToInputOffset(e,t-1)+1}getViewPositionOfModelPosition(e,t,s=2){return this._assertVisible(),this._projectionData.translateToOutputPosition(t-1,s).toPosition(e)}getViewLineNumberOfModelPosition(e,t){this._assertVisible();const s=this._projectionData.translateToOutputPosition(t-1);return e+s.outputLineIndex}normalizePosition(e,t,s){const o=t.lineNumber-e;return this._projectionData.normalizeOutputPosition(e,t.column-1,s).toPosition(o)}getInjectedTextAt(e,t){return this._projectionData.getInjectedText(e,t-1)}_assertVisible(){if(!this._isVisible)throw new Error("Not supported")}}const ms=class ms{constructor(){}isVisible(){return!0}setVisible(e){return e?this:HiddenModelLineProjection.INSTANCE}getProjectionData(){return null}getViewLineCount(){return 1}getViewLineContent(e,t,s){return e.getLineContent(t)}getViewLineLength(e,t,s){return e.getLineLength(t)}getViewLineMinColumn(e,t,s){return e.getLineMinColumn(t)}getViewLineMaxColumn(e,t,s){return e.getLineMaxColumn(t)}getViewLineData(e,t,s){const o=e.tokenization.getLineTokens(t),r=o.getLineContent();return new ViewLineData(r,!1,1,r.length+1,0,o.inflate(),null)}getViewLinesData(e,t,s,o,r,l,c){if(!l[r]){c[r]=null;return}c[r]=this.getViewLineData(e,t,0)}getModelColumnOfViewPosition(e,t){return t}getViewPositionOfModelPosition(e,t){return new Position$1(e,t)}getViewLineNumberOfModelPosition(e,t){return e}normalizePosition(e,t,s){return t}getInjectedTextAt(e,t){return null}};ms.INSTANCE=new ms;let IdentityModelLineProjection=ms;const _s=class _s{constructor(){}isVisible(){return!1}setVisible(e){return e?IdentityModelLineProjection.INSTANCE:this}getProjectionData(){return null}getViewLineCount(){return 0}getViewLineContent(e,t,s){throw new Error("Not supported")}getViewLineLength(e,t,s){throw new Error("Not supported")}getViewLineMinColumn(e,t,s){throw new Error("Not supported")}getViewLineMaxColumn(e,t,s){throw new Error("Not supported")}getViewLineData(e,t,s){throw new Error("Not supported")}getViewLinesData(e,t,s,o,r,l,c){throw new Error("Not supported")}getModelColumnOfViewPosition(e,t){throw new Error("Not supported")}getViewPositionOfModelPosition(e,t){throw new Error("Not supported")}getViewLineNumberOfModelPosition(e,t){throw new Error("Not supported")}normalizePosition(e,t,s){throw new Error("Not supported")}getInjectedTextAt(e,t){throw new Error("Not supported")}};_s.INSTANCE=new _s;let HiddenModelLineProjection=_s;const _spaces=[""];function spaces(a){if(a>=_spaces.length)for(let e=1;e<=a;e++)_spaces[e]=_makeSpaces(e);return _spaces[a]}function _makeSpaces(a){return new Array(a+1).join(" ")}class PrefixSumComputer{constructor(e){this.values=e,this.prefixSum=new Uint32Array(e.length),this.prefixSumValidIndex=new Int32Array(1),this.prefixSumValidIndex[0]=-1}insertValues(e,t){e=toUint32(e);const s=this.values,o=this.prefixSum,r=t.length;return r===0?!1:(this.values=new Uint32Array(s.length+r),this.values.set(s.subarray(0,e),0),this.values.set(s.subarray(e),e+r),this.values.set(t,e),e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),this.prefixSum=new Uint32Array(this.values.length),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(o.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}setValue(e,t){return e=toUint32(e),t=toUint32(t),this.values[e]===t?!1:(this.values[e]=t,e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),!0)}removeValues(e,t){e=toUint32(e),t=toUint32(t);const s=this.values,o=this.prefixSum;if(e>=s.length)return!1;const r=s.length-e;return t>=r&&(t=r),t===0?!1:(this.values=new Uint32Array(s.length-t),this.values.set(s.subarray(0,e),0),this.values.set(s.subarray(e+t),e),this.prefixSum=new Uint32Array(this.values.length),e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(o.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}getTotalSum(){return this.values.length===0?0:this._getPrefixSum(this.values.length-1)}getPrefixSum(e){return e<0?0:(e=toUint32(e),this._getPrefixSum(e))}_getPrefixSum(e){if(e<=this.prefixSumValidIndex[0])return this.prefixSum[e];let t=this.prefixSumValidIndex[0]+1;t===0&&(this.prefixSum[0]=this.values[0],t++),e>=this.values.length&&(e=this.values.length-1);for(let s=t;s<=e;s++)this.prefixSum[s]=this.prefixSum[s-1]+this.values[s];return this.prefixSumValidIndex[0]=Math.max(this.prefixSumValidIndex[0],e),this.prefixSum[e]}getIndexOf(e){e=Math.floor(e),this.getTotalSum();let t=0,s=this.values.length-1,o=0,r=0,l=0;for(;t<=s;)if(o=t+(s-t)/2|0,r=this.prefixSum[o],l=r-this.values[o],e<l)s=o-1;else if(e>=r)t=o+1;else break;return new PrefixSumIndexOfResult(o,e-l)}}class ConstantTimePrefixSumComputer{constructor(e){this._values=e,this._isValid=!1,this._validEndIndex=-1,this._prefixSum=[],this._indexBySum=[]}getTotalSum(){return this._ensureValid(),this._indexBySum.length}getPrefixSum(e){return this._ensureValid(),e===0?0:this._prefixSum[e-1]}getIndexOf(e){this._ensureValid();const t=this._indexBySum[e],s=t>0?this._prefixSum[t-1]:0;return new PrefixSumIndexOfResult(t,e-s)}removeValues(e,t){this._values.splice(e,t),this._invalidate(e)}insertValues(e,t){this._values=arrayInsert(this._values,e,t),this._invalidate(e)}_invalidate(e){this._isValid=!1,this._validEndIndex=Math.min(this._validEndIndex,e-1)}_ensureValid(){if(!this._isValid){for(let e=this._validEndIndex+1,t=this._values.length;e<t;e++){const s=this._values[e],o=e>0?this._prefixSum[e-1]:0;this._prefixSum[e]=o+s;for(let r=0;r<s;r++)this._indexBySum[o+r]=e}this._prefixSum.length=this._values.length,this._indexBySum.length=this._prefixSum[this._prefixSum.length-1],this._isValid=!0,this._validEndIndex=this._values.length-1}}setValue(e,t){this._values[e]!==t&&(this._values[e]=t,this._invalidate(e))}}class PrefixSumIndexOfResult{constructor(e,t){this.index=e,this.remainder=t,this._prefixSumIndexOfResultBrand=void 0,this.index=e,this.remainder=t}}class IdentityCoordinatesConverter{constructor(e){this._model=e}_validPosition(e){return this._model.validatePosition(e)}_validRange(e){return this._model.validateRange(e)}convertViewPositionToModelPosition(e){return this._validPosition(e)}convertViewRangeToModelRange(e){return this._validRange(e)}validateViewPosition(e,t){return this._validPosition(t)}validateViewRange(e,t){return this._validRange(t)}convertModelPositionToViewPosition(e){return this._validPosition(e)}convertModelRangeToViewRange(e){return this._validRange(e)}modelPositionIsVisible(e){const t=this._model.getLineCount();return!(e.lineNumber<1||e.lineNumber>t)}getModelLineViewLineCount(e){return 1}getViewLineNumberOfModelPosition(e,t){return e}}class ViewModelLinesFromProjectedModel{constructor(e,t,s,o,r,l,c,d,u,g,f){this._editorId=e,this.model=t,this._validModelVersionId=-1,this._domLineBreaksComputerFactory=s,this._monospaceLineBreaksComputerFactory=o,this.fontInfo=r,this.tabSize=l,this.wrappingStrategy=c,this.wrappingColumn=d,this.wrappingIndent=u,this.wordBreak=g,this.wrapOnEscapedLineFeeds=f,this._constructLines(!0,null)}dispose(){this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,[])}createCoordinatesConverter(){return new CoordinatesConverter(this)}_constructLines(e,t){this.modelLineProjections=[],e&&(this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,[]));const s=this.model.getLinesContent(),o=this.model.getInjectedTextDecorations(this._editorId),r=s.length,l=this.createLineBreaksComputer(),c=new ArrayQueue(LineInjectedText.fromDecorations(o));for(let C=0;C<r;C++){const b=c.takeWhile(v=>v.lineNumber===C+1);l.addRequest(s[C],b,t?t[C]:null)}const d=l.finalize(),u=[],g=this.hiddenAreasDecorationIds.map(C=>this.model.getDecorationRange(C)).sort(Range$2.compareRangesUsingStarts);let f=1,p=0,m=-1,_=m+1<g.length?p+1:r+2;for(let C=0;C<r;C++){const b=C+1;b===_&&(m++,f=g[m].startLineNumber,p=g[m].endLineNumber,_=m+1<g.length?p+1:r+2);const v=b>=f&&b<=p,S=createModelLineProjection(d[C],!v);u[C]=S.getViewLineCount(),this.modelLineProjections[C]=S}this._validModelVersionId=this.model.getVersionId(),this.projectedModelLineLineCounts=new ConstantTimePrefixSumComputer(u)}getHiddenAreas(){return this.hiddenAreasDecorationIds.map(e=>this.model.getDecorationRange(e))}setHiddenAreas(e){const t=e.map(p=>this.model.validateRange(p)),s=normalizeLineRanges(t),o=this.hiddenAreasDecorationIds.map(p=>this.model.getDecorationRange(p)).sort(Range$2.compareRangesUsingStarts);if(s.length===o.length){let p=!1;for(let m=0;m<s.length;m++)if(!s[m].equalsRange(o[m])){p=!0;break}if(!p)return!1}const r=s.map(p=>({range:p,options:ModelDecorationOptions.EMPTY}));this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,r);const l=s;let c=1,d=0,u=-1,g=u+1<l.length?d+1:this.modelLineProjections.length+2,f=!1;for(let p=0;p<this.modelLineProjections.length;p++){const m=p+1;m===g&&(u++,c=l[u].startLineNumber,d=l[u].endLineNumber,g=u+1<l.length?d+1:this.modelLineProjections.length+2);let _=!1;if(m>=c&&m<=d?this.modelLineProjections[p].isVisible()&&(this.modelLineProjections[p]=this.modelLineProjections[p].setVisible(!1),_=!0):(f=!0,this.modelLineProjections[p].isVisible()||(this.modelLineProjections[p]=this.modelLineProjections[p].setVisible(!0),_=!0)),_){const C=this.modelLineProjections[p].getViewLineCount();this.projectedModelLineLineCounts.setValue(p,C)}}return f||this.setHiddenAreas([]),!0}modelPositionIsVisible(e,t){return e<1||e>this.modelLineProjections.length?!1:this.modelLineProjections[e-1].isVisible()}getModelLineViewLineCount(e){return e<1||e>this.modelLineProjections.length?1:this.modelLineProjections[e-1].getViewLineCount()}setTabSize(e){return this.tabSize===e?!1:(this.tabSize=e,this._constructLines(!1,null),!0)}setWrappingSettings(e,t,s,o,r){const l=this.fontInfo.equals(e),c=this.wrappingStrategy===t,d=this.wrappingColumn===s,u=this.wrappingIndent===o,g=this.wordBreak===r;if(l&&c&&d&&u&&g)return!1;const f=l&&c&&!d&&u&&g;this.fontInfo=e,this.wrappingStrategy=t,this.wrappingColumn=s,this.wrappingIndent=o,this.wordBreak=r;let p=null;if(f){p=[];for(let m=0,_=this.modelLineProjections.length;m<_;m++)p[m]=this.modelLineProjections[m].getProjectionData()}return this._constructLines(!1,p),!0}createLineBreaksComputer(){return(this.wrappingStrategy==="advanced"?this._domLineBreaksComputerFactory:this._monospaceLineBreaksComputerFactory).createLineBreaksComputer(this.fontInfo,this.tabSize,this.wrappingColumn,this.wrappingIndent,this.wordBreak,this.wrapOnEscapedLineFeeds)}onModelFlushed(){this._constructLines(!0,null)}onModelLinesDeleted(e,t,s){if(!e||e<=this._validModelVersionId)return null;const o=t===1?1:this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,r=this.projectedModelLineLineCounts.getPrefixSum(s);return this.modelLineProjections.splice(t-1,s-t+1),this.projectedModelLineLineCounts.removeValues(t-1,s-t+1),new ViewLinesDeletedEvent(o,r)}onModelLinesInserted(e,t,s,o){if(!e||e<=this._validModelVersionId)return null;const r=t>2&&!this.modelLineProjections[t-2].isVisible(),l=t===1?1:this.projectedModelLineLineCounts.getPrefixSum(t-1)+1;let c=0;const d=[],u=[];for(let g=0,f=o.length;g<f;g++){const p=createModelLineProjection(o[g],!r);d.push(p);const m=p.getViewLineCount();c+=m,u[g]=m}return this.modelLineProjections=this.modelLineProjections.slice(0,t-1).concat(d).concat(this.modelLineProjections.slice(t-1)),this.projectedModelLineLineCounts.insertValues(t-1,u),new ViewLinesInsertedEvent(l,l+c-1)}onModelLineChanged(e,t,s){if(e!==null&&e<=this._validModelVersionId)return[!1,null,null,null];const o=t-1,r=this.modelLineProjections[o].getViewLineCount(),l=this.modelLineProjections[o].isVisible(),c=createModelLineProjection(s,l);this.modelLineProjections[o]=c;const d=this.modelLineProjections[o].getViewLineCount();let u=!1,g=0,f=-1,p=0,m=-1,_=0,C=-1;r>d?(g=this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,f=g+d-1,_=f+1,C=_+(r-d)-1,u=!0):r<d?(g=this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,f=g+r-1,p=f+1,m=p+(d-r)-1,u=!0):(g=this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,f=g+d-1),this.projectedModelLineLineCounts.setValue(o,d);const b=g<=f?new ViewLinesChangedEvent(g,f-g+1):null,v=p<=m?new ViewLinesInsertedEvent(p,m):null,S=_<=C?new ViewLinesDeletedEvent(_,C):null;return[u,b,v,S]}acceptVersionId(e){this._validModelVersionId=e,this.modelLineProjections.length===1&&!this.modelLineProjections[0].isVisible()&&this.setHiddenAreas([])}getViewLineCount(){return this.projectedModelLineLineCounts.getTotalSum()}_toValidViewLineNumber(e){if(e<1)return 1;const t=this.getViewLineCount();return e>t?t:e|0}getActiveIndentGuide(e,t,s){e=this._toValidViewLineNumber(e),t=this._toValidViewLineNumber(t),s=this._toValidViewLineNumber(s);const o=this.convertViewPositionToModelPosition(e,this.getViewLineMinColumn(e)),r=this.convertViewPositionToModelPosition(t,this.getViewLineMinColumn(t)),l=this.convertViewPositionToModelPosition(s,this.getViewLineMinColumn(s)),c=this.model.guides.getActiveIndentGuide(o.lineNumber,r.lineNumber,l.lineNumber),d=this.convertModelPositionToViewPosition(c.startLineNumber,1),u=this.convertModelPositionToViewPosition(c.endLineNumber,this.model.getLineMaxColumn(c.endLineNumber));return{startLineNumber:d.lineNumber,endLineNumber:u.lineNumber,indent:c.indent}}getViewLineInfo(e){e=this._toValidViewLineNumber(e);const t=this.projectedModelLineLineCounts.getIndexOf(e-1),s=t.index,o=t.remainder;return new ViewLineInfo(s+1,o)}getMinColumnOfViewLine(e){return this.modelLineProjections[e.modelLineNumber-1].getViewLineMinColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx)}getMaxColumnOfViewLine(e){return this.modelLineProjections[e.modelLineNumber-1].getViewLineMaxColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx)}getModelStartPositionOfViewLine(e){const t=this.modelLineProjections[e.modelLineNumber-1],s=t.getViewLineMinColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx),o=t.getModelColumnOfViewPosition(e.modelLineWrappedLineIdx,s);return new Position$1(e.modelLineNumber,o)}getModelEndPositionOfViewLine(e){const t=this.modelLineProjections[e.modelLineNumber-1],s=t.getViewLineMaxColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx),o=t.getModelColumnOfViewPosition(e.modelLineWrappedLineIdx,s);return new Position$1(e.modelLineNumber,o)}getViewLineInfosGroupedByModelRanges(e,t){const s=this.getViewLineInfo(e),o=this.getViewLineInfo(t),r=new Array;let l=this.getModelStartPositionOfViewLine(s),c=new Array;for(let d=s.modelLineNumber;d<=o.modelLineNumber;d++){const u=this.modelLineProjections[d-1];if(u.isVisible()){const g=d===s.modelLineNumber?s.modelLineWrappedLineIdx:0,f=d===o.modelLineNumber?o.modelLineWrappedLineIdx+1:u.getViewLineCount();for(let p=g;p<f;p++)c.push(new ViewLineInfo(d,p))}if(!u.isVisible()&&l){const g=new Position$1(d-1,this.model.getLineMaxColumn(d-1)+1),f=Range$2.fromPositions(l,g);r.push(new ViewLineInfoGroupedByModelRange(f,c)),c=[],l=null}else u.isVisible()&&!l&&(l=new Position$1(d,1))}if(l){const d=Range$2.fromPositions(l,this.getModelEndPositionOfViewLine(o));r.push(new ViewLineInfoGroupedByModelRange(d,c))}return r}getViewLinesBracketGuides(e,t,s,o){const r=s?this.convertViewPositionToModelPosition(s.lineNumber,s.column):null,l=[];for(const c of this.getViewLineInfosGroupedByModelRanges(e,t)){const d=c.modelRange.startLineNumber,u=this.model.guides.getLinesBracketGuides(d,c.modelRange.endLineNumber,r,o);for(const g of c.viewLines){const p=u[g.modelLineNumber-d].map(m=>{if(m.forWrappedLinesAfterColumn!==-1&&this.modelLineProjections[g.modelLineNumber-1].getViewPositionOfModelPosition(0,m.forWrappedLinesAfterColumn).lineNumber>=g.modelLineWrappedLineIdx||m.forWrappedLinesBeforeOrAtColumn!==-1&&this.modelLineProjections[g.modelLineNumber-1].getViewPositionOfModelPosition(0,m.forWrappedLinesBeforeOrAtColumn).lineNumber<g.modelLineWrappedLineIdx)return;if(!m.horizontalLine)return m;let _=-1;if(m.column!==-1){const v=this.modelLineProjections[g.modelLineNumber-1].getViewPositionOfModelPosition(0,m.column);if(v.lineNumber===g.modelLineWrappedLineIdx)_=v.column;else if(v.lineNumber<g.modelLineWrappedLineIdx)_=this.getMinColumnOfViewLine(g);else if(v.lineNumber>g.modelLineWrappedLineIdx)return}const C=this.convertModelPositionToViewPosition(g.modelLineNumber,m.horizontalLine.endColumn),b=this.modelLineProjections[g.modelLineNumber-1].getViewPositionOfModelPosition(0,m.horizontalLine.endColumn);return b.lineNumber===g.modelLineWrappedLineIdx?new IndentGuide(m.visibleColumn,_,m.className,new IndentGuideHorizontalLine(m.horizontalLine.top,C.column),-1,-1):b.lineNumber<g.modelLineWrappedLineIdx||m.visibleColumn!==-1?void 0:new IndentGuide(m.visibleColumn,_,m.className,new IndentGuideHorizontalLine(m.horizontalLine.top,this.getMaxColumnOfViewLine(g)),-1,-1)});l.push(p.filter(m=>!!m))}}return l}getViewLinesIndentGuides(e,t){e=this._toValidViewLineNumber(e),t=this._toValidViewLineNumber(t);const s=this.convertViewPositionToModelPosition(e,this.getViewLineMinColumn(e)),o=this.convertViewPositionToModelPosition(t,this.getViewLineMaxColumn(t));let r=[];const l=[],c=[],d=s.lineNumber-1,u=o.lineNumber-1;let g=null;for(let _=d;_<=u;_++){const C=this.modelLineProjections[_];if(C.isVisible()){const b=C.getViewLineNumberOfModelPosition(0,_===d?s.column:1),v=C.getViewLineNumberOfModelPosition(0,this.model.getLineMaxColumn(_+1)),S=v-b+1;let y=0;S>1&&C.getViewLineMinColumn(this.model,_+1,v)===1&&(y=b===0?1:2),l.push(S),c.push(y),g===null&&(g=new Position$1(_+1,0))}else g!==null&&(r=r.concat(this.model.guides.getLinesIndentGuides(g.lineNumber,_)),g=null)}g!==null&&(r=r.concat(this.model.guides.getLinesIndentGuides(g.lineNumber,o.lineNumber)),g=null);const f=t-e+1,p=new Array(f);let m=0;for(let _=0,C=r.length;_<C;_++){let b=r[_];const v=Math.min(f-m,l[_]),S=c[_];let y;S===2?y=0:S===1?y=1:y=v;for(let w=0;w<v;w++)w===y&&(b=0),p[m++]=b}return p}getViewLineContent(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineContent(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineLength(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineLength(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineMinColumn(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineMinColumn(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineMaxColumn(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineMaxColumn(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineData(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineData(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLinesData(e,t,s){e=this._toValidViewLineNumber(e),t=this._toValidViewLineNumber(t);const o=this.projectedModelLineLineCounts.getIndexOf(e-1);let r=e;const l=o.index,c=o.remainder,d=[];for(let u=l,g=this.model.getLineCount();u<g;u++){const f=this.modelLineProjections[u];if(!f.isVisible())continue;const p=u===l?c:0;let m=f.getViewLineCount()-p,_=!1;if(r+m>t&&(_=!0,m=t-r+1),f.getViewLinesData(this.model,u+1,p,m,r-e,s,d),r+=m,_)break}return d}validateViewPosition(e,t,s){e=this._toValidViewLineNumber(e);const o=this.projectedModelLineLineCounts.getIndexOf(e-1),r=o.index,l=o.remainder,c=this.modelLineProjections[r],d=c.getViewLineMinColumn(this.model,r+1,l),u=c.getViewLineMaxColumn(this.model,r+1,l);t<d&&(t=d),t>u&&(t=u);const g=c.getModelColumnOfViewPosition(l,t);return this.model.validatePosition(new Position$1(r+1,g)).equals(s)?new Position$1(e,t):this.convertModelPositionToViewPosition(s.lineNumber,s.column)}validateViewRange(e,t){const s=this.validateViewPosition(e.startLineNumber,e.startColumn,t.getStartPosition()),o=this.validateViewPosition(e.endLineNumber,e.endColumn,t.getEndPosition());return new Range$2(s.lineNumber,s.column,o.lineNumber,o.column)}convertViewPositionToModelPosition(e,t){const s=this.getViewLineInfo(e),o=this.modelLineProjections[s.modelLineNumber-1].getModelColumnOfViewPosition(s.modelLineWrappedLineIdx,t);return this.model.validatePosition(new Position$1(s.modelLineNumber,o))}convertViewRangeToModelRange(e){const t=this.convertViewPositionToModelPosition(e.startLineNumber,e.startColumn),s=this.convertViewPositionToModelPosition(e.endLineNumber,e.endColumn);return new Range$2(t.lineNumber,t.column,s.lineNumber,s.column)}convertModelPositionToViewPosition(e,t,s=2,o=!1,r=!1){const l=this.model.validatePosition(new Position$1(e,t)),c=l.lineNumber,d=l.column;let u=c-1,g=!1;if(r)for(;u<this.modelLineProjections.length&&!this.modelLineProjections[u].isVisible();)u++,g=!0;else for(;u>0&&!this.modelLineProjections[u].isVisible();)u--,g=!0;if(u===0&&!this.modelLineProjections[u].isVisible())return new Position$1(o?0:1,1);const f=1+this.projectedModelLineLineCounts.getPrefixSum(u);let p;return g?r?p=this.modelLineProjections[u].getViewPositionOfModelPosition(f,1,s):p=this.modelLineProjections[u].getViewPositionOfModelPosition(f,this.model.getLineMaxColumn(u+1),s):p=this.modelLineProjections[c-1].getViewPositionOfModelPosition(f,d,s),p}convertModelRangeToViewRange(e,t=0){if(e.isEmpty()){const s=this.convertModelPositionToViewPosition(e.startLineNumber,e.startColumn,t);return Range$2.fromPositions(s)}else{const s=this.convertModelPositionToViewPosition(e.startLineNumber,e.startColumn,1),o=this.convertModelPositionToViewPosition(e.endLineNumber,e.endColumn,0);return new Range$2(s.lineNumber,s.column,o.lineNumber,o.column)}}getViewLineNumberOfModelPosition(e,t){let s=e-1;if(this.modelLineProjections[s].isVisible()){const r=1+this.projectedModelLineLineCounts.getPrefixSum(s);return this.modelLineProjections[s].getViewLineNumberOfModelPosition(r,t)}for(;s>0&&!this.modelLineProjections[s].isVisible();)s--;if(s===0&&!this.modelLineProjections[s].isVisible())return 1;const o=1+this.projectedModelLineLineCounts.getPrefixSum(s);return this.modelLineProjections[s].getViewLineNumberOfModelPosition(o,this.model.getLineMaxColumn(s+1))}getDecorationsInRange(e,t,s,o,r,l){const c=this.convertViewPositionToModelPosition(e.startLineNumber,e.startColumn),d=this.convertViewPositionToModelPosition(e.endLineNumber,e.endColumn);if(d.lineNumber-c.lineNumber<=e.endLineNumber-e.startLineNumber)return this.model.getDecorationsInRange(new Range$2(c.lineNumber,1,d.lineNumber,d.column),t,s,o,r,l);let u=[];const g=c.lineNumber-1,f=d.lineNumber-1;let p=null;for(let b=g;b<=f;b++)if(this.modelLineProjections[b].isVisible())p===null&&(p=new Position$1(b+1,b===g?c.column:1));else if(p!==null){const S=this.model.getLineMaxColumn(b);u=u.concat(this.model.getDecorationsInRange(new Range$2(p.lineNumber,p.column,b,S),t,s,o,r)),p=null}p!==null&&(u=u.concat(this.model.getDecorationsInRange(new Range$2(p.lineNumber,p.column,d.lineNumber,d.column),t,s,o,r)),p=null),u.sort((b,v)=>{const S=Range$2.compareRangesUsingStarts(b.range,v.range);return S===0?b.id<v.id?-1:b.id>v.id?1:0:S});const m=[];let _=0,C=null;for(const b of u){const v=b.id;C!==v&&(C=v,m[_++]=b)}return m}getInjectedTextAt(e){const t=this.getViewLineInfo(e.lineNumber);return this.modelLineProjections[t.modelLineNumber-1].getInjectedTextAt(t.modelLineWrappedLineIdx,e.column)}normalizePosition(e,t){const s=this.getViewLineInfo(e.lineNumber);return this.modelLineProjections[s.modelLineNumber-1].normalizePosition(s.modelLineWrappedLineIdx,e,t)}getLineIndentColumn(e){const t=this.getViewLineInfo(e);return t.modelLineWrappedLineIdx===0?this.model.getLineIndentColumn(t.modelLineNumber):0}}function normalizeLineRanges(a){if(a.length===0)return[];const e=a.slice();e.sort(Range$2.compareRangesUsingStarts);const t=[];let s=e[0].startLineNumber,o=e[0].endLineNumber;for(let r=1,l=e.length;r<l;r++){const c=e[r];c.startLineNumber>o+1?(t.push(new Range$2(s,1,o,1)),s=c.startLineNumber,o=c.endLineNumber):c.endLineNumber>o&&(o=c.endLineNumber)}return t.push(new Range$2(s,1,o,1)),t}class ViewLineInfo{constructor(e,t){this.modelLineNumber=e,this.modelLineWrappedLineIdx=t}}class ViewLineInfoGroupedByModelRange{constructor(e,t){this.modelRange=e,this.viewLines=t}}class CoordinatesConverter{constructor(e){this._lines=e}convertViewPositionToModelPosition(e){return this._lines.convertViewPositionToModelPosition(e.lineNumber,e.column)}convertViewRangeToModelRange(e){return this._lines.convertViewRangeToModelRange(e)}validateViewPosition(e,t){return this._lines.validateViewPosition(e.lineNumber,e.column,t)}validateViewRange(e,t){return this._lines.validateViewRange(e,t)}convertModelPositionToViewPosition(e,t,s,o){return this._lines.convertModelPositionToViewPosition(e.lineNumber,e.column,t,s,o)}convertModelRangeToViewRange(e,t){return this._lines.convertModelRangeToViewRange(e,t)}modelPositionIsVisible(e){return this._lines.modelPositionIsVisible(e.lineNumber,e.column)}getModelLineViewLineCount(e){return this._lines.getModelLineViewLineCount(e)}getViewLineNumberOfModelPosition(e,t){return this._lines.getViewLineNumberOfModelPosition(e,t)}}class ViewModelLinesFromModelAsIs{constructor(e){this.model=e}dispose(){}createCoordinatesConverter(){return new IdentityCoordinatesConverter(this.model)}getHiddenAreas(){return[]}setHiddenAreas(e){return!1}setTabSize(e){return!1}setWrappingSettings(e,t,s,o){return!1}createLineBreaksComputer(){const e=[];return{addRequest:(t,s,o)=>{e.push(null)},finalize:()=>e}}onModelFlushed(){}onModelLinesDeleted(e,t,s){return new ViewLinesDeletedEvent(t,s)}onModelLinesInserted(e,t,s,o){return new ViewLinesInsertedEvent(t,s)}onModelLineChanged(e,t,s){return[!1,new ViewLinesChangedEvent(t,1),null,null]}acceptVersionId(e){}getViewLineCount(){return this.model.getLineCount()}getActiveIndentGuide(e,t,s){return{startLineNumber:e,endLineNumber:e,indent:0}}getViewLinesBracketGuides(e,t,s){return new Array(t-e+1).fill([])}getViewLinesIndentGuides(e,t){const s=t-e+1,o=new Array(s);for(let r=0;r<s;r++)o[r]=0;return o}getViewLineContent(e){return this.model.getLineContent(e)}getViewLineLength(e){return this.model.getLineLength(e)}getViewLineMinColumn(e){return this.model.getLineMinColumn(e)}getViewLineMaxColumn(e){return this.model.getLineMaxColumn(e)}getViewLineData(e){const t=this.model.tokenization.getLineTokens(e),s=t.getLineContent();return new ViewLineData(s,!1,1,s.length+1,0,t.inflate(),null)}getViewLinesData(e,t,s){const o=this.model.getLineCount();e=Math.min(Math.max(1,e),o),t=Math.min(Math.max(1,t),o);const r=[];for(let l=e;l<=t;l++){const c=l-e;r[c]=s[c]?this.getViewLineData(l):null}return r}getDecorationsInRange(e,t,s,o,r,l){return this.model.getDecorationsInRange(e,t,s,o,r,l)}normalizePosition(e,t){return this.model.normalizePosition(e,t)}getLineIndentColumn(e){return this.model.getLineIndentColumn(e)}getInjectedTextAt(e){return null}}const MAX_LANE=GlyphMarginLane$1.Right;class GlyphMarginLanesModel{constructor(e){this.persist=0,this._requiredLanes=1,this.lanes=new Uint8Array(Math.ceil((e+1)*MAX_LANE/8))}reset(e){const t=Math.ceil((e+1)*MAX_LANE/8);this.lanes.length<t?this.lanes=new Uint8Array(t):this.lanes.fill(0),this._requiredLanes=1}get requiredLanes(){return this._requiredLanes}push(e,t,s){s&&(this.persist|=1<<e-1);for(let o=t.startLineNumber;o<=t.endLineNumber;o++){const r=MAX_LANE*o+(e-1);this.lanes[r>>>3]|=1<<r%8,this._requiredLanes=Math.max(this._requiredLanes,this.countAtLine(o))}}getLanesAtLine(e){const t=[];let s=MAX_LANE*e;for(let o=0;o<MAX_LANE;o++)(this.persist&1<<o||this.lanes[s>>>3]&1<<s%8)&&t.push(o+1),s++;return t.length?t:[GlyphMarginLane$1.Center]}countAtLine(e){let t=MAX_LANE*e,s=0;for(let o=0;o<MAX_LANE;o++)(this.persist&1<<o||this.lanes[t>>>3]&1<<t%8)&&s++,t++;return s}}let ViewModel$1=class extends Disposable{constructor(e,t,s,o,r,l,c,d,u,g){if(super(),this.languageConfigurationService=c,this._themeService=d,this._attachedView=u,this._transactionalTarget=g,this.hiddenAreasModel=new HiddenAreasModel,this.previousHiddenAreas=[],this._editorId=e,this._configuration=t,this.model=s,this._eventDispatcher=new ViewModelEventDispatcher,this.onEvent=this._eventDispatcher.onEvent,this.cursorConfig=new CursorConfiguration(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._updateConfigurationViewLineCount=this._register(new RunOnceScheduler(()=>this._updateConfigurationViewLineCountNow(),0)),this._hasFocus=!1,this._viewportStart=ViewportStart.create(this.model),this.glyphLanes=new GlyphMarginLanesModel(0),this.model.isTooLargeForTokenization())this._lines=new ViewModelLinesFromModelAsIs(this.model);else{const f=this._configuration.options,p=f.get(59),m=f.get(156),_=f.get(166),C=f.get(155),b=f.get(146),v=f.get(160);this._lines=new ViewModelLinesFromProjectedModel(this._editorId,this.model,o,r,p,this.model.getOptions().tabSize,m,_.wrappingColumn,C,b,v)}this.coordinatesConverter=this._lines.createCoordinatesConverter(),this._cursor=this._register(new CursorsController(s,this,this.coordinatesConverter,this.cursorConfig)),this.viewLayout=this._register(new ViewLayout(this._configuration,this.getLineCount(),this._getCustomLineHeights(),l)),this._register(this.viewLayout.onDidScroll(f=>{f.scrollTopChanged&&this._handleVisibleLinesChanged(),f.scrollTopChanged&&this._viewportStart.invalidate(),this._eventDispatcher.emitSingleViewEvent(new ViewScrollChangedEvent(f)),this._eventDispatcher.emitOutgoingEvent(new ScrollChangedEvent(f.oldScrollWidth,f.oldScrollLeft,f.oldScrollHeight,f.oldScrollTop,f.scrollWidth,f.scrollLeft,f.scrollHeight,f.scrollTop))})),this._register(this.viewLayout.onDidContentSizeChange(f=>{this._eventDispatcher.emitOutgoingEvent(f)})),this._decorations=new ViewModelDecorations(this._editorId,this.model,this._configuration,this._lines,this.coordinatesConverter),this._registerModelEvents(),this._register(this._configuration.onDidChangeFast(f=>{try{const p=this._eventDispatcher.beginEmitViewEvents();this._onConfigurationChanged(p,f)}finally{this._eventDispatcher.endEmitViewEvents()}})),this._register(MinimapTokensColorTracker.getInstance().onDidChange(()=>{this._eventDispatcher.emitSingleViewEvent(new ViewTokensColorsChangedEvent)})),this._register(this._themeService.onDidColorThemeChange(f=>{this._invalidateDecorationsColorCache(),this._eventDispatcher.emitSingleViewEvent(new ViewThemeChangedEvent(f))})),this._updateConfigurationViewLineCountNow()}dispose(){super.dispose(),this._decorations.dispose(),this._lines.dispose(),this._viewportStart.dispose(),this._eventDispatcher.dispose()}createLineBreaksComputer(){return this._lines.createLineBreaksComputer()}addViewEventHandler(e){this._eventDispatcher.addViewEventHandler(e)}removeViewEventHandler(e){this._eventDispatcher.removeViewEventHandler(e)}_getCustomLineHeights(){return this._configuration.options.get(5)?this.model.getCustomLineHeightsDecorations(this._editorId).map(s=>{const o=s.range.startLineNumber,r=this.coordinatesConverter.convertModelRangeToViewRange(new Range$2(o,1,o,this.model.getLineMaxColumn(o)));return{decorationId:s.id,startLineNumber:r.startLineNumber,endLineNumber:r.endLineNumber,lineHeight:s.options.lineHeight||0}}):[]}_updateConfigurationViewLineCountNow(){this._configuration.setViewLineCount(this._lines.getViewLineCount())}getModelVisibleRanges(){const e=this.viewLayout.getLinesViewportData(),t=new Range$2(e.startLineNumber,this.getLineMinColumn(e.startLineNumber),e.endLineNumber,this.getLineMaxColumn(e.endLineNumber));return this._toModelVisibleRanges(t)}visibleLinesStabilized(){const e=this.getModelVisibleRanges();this._attachedView.setVisibleLines(e,!0)}_handleVisibleLinesChanged(){const e=this.getModelVisibleRanges();this._attachedView.setVisibleLines(e,!1)}setHasFocus(e){this._hasFocus=e,this._cursor.setHasFocus(e),this._eventDispatcher.emitSingleViewEvent(new ViewFocusChangedEvent(e)),this._eventDispatcher.emitOutgoingEvent(new FocusChangedEvent(!e,e))}setHasWidgetFocus(e){this._eventDispatcher.emitOutgoingEvent(new WidgetFocusChangedEvent(!e,e))}onCompositionStart(){this._eventDispatcher.emitSingleViewEvent(new ViewCompositionStartEvent)}onCompositionEnd(){this._eventDispatcher.emitSingleViewEvent(new ViewCompositionEndEvent)}_captureStableViewport(){if(this._viewportStart.isValid&&this.viewLayout.getCurrentScrollTop()>0){const e=new Position$1(this._viewportStart.viewLineNumber,this.getLineMinColumn(this._viewportStart.viewLineNumber)),t=this.coordinatesConverter.convertViewPositionToModelPosition(e);return new StableViewport(t,this._viewportStart.startLineDelta)}return new StableViewport(null,0)}_onConfigurationChanged(e,t){const s=this._captureStableViewport(),o=this._configuration.options,r=o.get(59),l=o.get(156),c=o.get(166),d=o.get(155),u=o.get(146);this._lines.setWrappingSettings(r,l,c.wrappingColumn,d,u)&&(e.emitViewEvent(new ViewFlushedEvent),e.emitViewEvent(new ViewLineMappingChangedEvent),e.emitViewEvent(new ViewDecorationsChangedEvent(null)),this._cursor.onLineMappingChanged(e),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount(),this._getCustomLineHeights()),this._updateConfigurationViewLineCount.schedule()),t.hasChanged(104)&&(this._decorations.reset(),e.emitViewEvent(new ViewDecorationsChangedEvent(null))),t.hasChanged(112)&&(this._decorations.reset(),e.emitViewEvent(new ViewDecorationsChangedEvent(null))),e.emitViewEvent(new ViewConfigurationChangedEvent(t)),this.viewLayout.onConfigurationChanged(t),s.recoverViewportStart(this.coordinatesConverter,this.viewLayout),CursorConfiguration.shouldRecreate(t)&&(this.cursorConfig=new CursorConfiguration(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig))}_registerModelEvents(){this._register(this.model.onDidChangeContentOrInjectedText(s=>{try{const r=this._eventDispatcher.beginEmitViewEvents();let l=!1,c=!1;const d=s instanceof InternalModelContentChangeEvent?s.rawContentChangedEvent.changes:s.changes,u=s instanceof InternalModelContentChangeEvent?s.rawContentChangedEvent.versionId:null,g=this._lines.createLineBreaksComputer();for(const m of d)switch(m.changeType){case 4:{for(let _=0;_<m.detail.length;_++){const C=m.detail[_];let b=m.injectedTexts[_];b&&(b=b.filter(v=>!v.ownerId||v.ownerId===this._editorId)),g.addRequest(C,b,null)}break}case 2:{let _=null;m.injectedText&&(_=m.injectedText.filter(C=>!C.ownerId||C.ownerId===this._editorId)),g.addRequest(m.detail,_,null);break}}const f=g.finalize(),p=new ArrayQueue(f);for(const m of d)switch(m.changeType){case 1:{this._lines.onModelFlushed(),r.emitViewEvent(new ViewFlushedEvent),this._decorations.reset(),this.viewLayout.onFlushed(this.getLineCount(),this._getCustomLineHeights()),l=!0;break}case 3:{const _=this._lines.onModelLinesDeleted(u,m.fromLineNumber,m.toLineNumber);_!==null&&(r.emitViewEvent(_),this.viewLayout.onLinesDeleted(_.fromLineNumber,_.toLineNumber)),l=!0;break}case 4:{const _=p.takeCount(m.detail.length),C=this._lines.onModelLinesInserted(u,m.fromLineNumber,m.toLineNumber,_);C!==null&&(r.emitViewEvent(C),this.viewLayout.onLinesInserted(C.fromLineNumber,C.toLineNumber)),l=!0;break}case 2:{const _=p.dequeue(),[C,b,v,S]=this._lines.onModelLineChanged(u,m.lineNumber,_);c=C,b&&r.emitViewEvent(b),v&&(r.emitViewEvent(v),this.viewLayout.onLinesInserted(v.fromLineNumber,v.toLineNumber)),S&&(r.emitViewEvent(S),this.viewLayout.onLinesDeleted(S.fromLineNumber,S.toLineNumber));break}case 5:break}u!==null&&this._lines.acceptVersionId(u),this.viewLayout.onHeightMaybeChanged(),!l&&c&&(r.emitViewEvent(new ViewLineMappingChangedEvent),r.emitViewEvent(new ViewDecorationsChangedEvent(null)),this._cursor.onLineMappingChanged(r),this._decorations.onLineMappingChanged())}finally{this._eventDispatcher.endEmitViewEvents()}const o=this._viewportStart.isValid;if(this._viewportStart.invalidate(),this._configuration.setModelLineCount(this.model.getLineCount()),this._updateConfigurationViewLineCountNow(),!this._hasFocus&&this.model.getAttachedEditorCount()>=2&&o){const r=this.model._getTrackedRange(this._viewportStart.modelTrackedRange);if(r){const l=this.coordinatesConverter.convertModelPositionToViewPosition(r.getStartPosition()),c=this.viewLayout.getVerticalOffsetForLineNumber(l.lineNumber);this.viewLayout.setScrollPosition({scrollTop:c+this._viewportStart.startLineDelta},1)}}try{const r=this._eventDispatcher.beginEmitViewEvents();s instanceof InternalModelContentChangeEvent&&r.emitOutgoingEvent(new ModelContentChangedEvent(s.contentChangedEvent)),this._cursor.onModelContentChanged(r,s)}finally{this._eventDispatcher.endEmitViewEvents()}this._handleVisibleLinesChanged()})),this._configuration.options.get(5)&&this._register(this.model.onDidChangeLineHeight(s=>{const o=s.changes.filter(r=>r.ownerId===this._editorId||r.ownerId===0);if(this.viewLayout.changeSpecialLineHeights(r=>{for(const l of o){const{decorationId:c,lineNumber:d,lineHeight:u}=l,g=this.coordinatesConverter.convertModelRangeToViewRange(new Range$2(d,1,d,this.model.getLineMaxColumn(d)));u!==null?r.insertOrChangeCustomLineHeight(c,g.startLineNumber,g.endLineNumber,u):r.removeCustomLineHeight(c)}}),o.length>0){const r=new ModelLineHeightChangedEvent$1(o);this._eventDispatcher.emitOutgoingEvent(new ModelLineHeightChangedEvent(r))}})),this._configuration.options.get(172)&&this._register(this.model.onDidChangeFont(s=>{const o=s.changes.filter(r=>r.ownerId===this._editorId||r.ownerId===0);if(o.length>0){const r=new ModelFontChangedEvent$1(o);this._eventDispatcher.emitOutgoingEvent(new ModelFontChangedEvent(r))}})),this._register(this.model.onDidChangeTokens(s=>{const o=[];for(let r=0,l=s.ranges.length;r<l;r++){const c=s.ranges[r],d=this.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(c.fromLineNumber,1)).lineNumber,u=this.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(c.toLineNumber,this.model.getLineMaxColumn(c.toLineNumber))).lineNumber;o[r]={fromLineNumber:d,toLineNumber:u}}this._eventDispatcher.emitSingleViewEvent(new ViewTokensChangedEvent(o)),this._eventDispatcher.emitOutgoingEvent(new ModelTokensChangedEvent(s))})),this._register(this.model.onDidChangeLanguageConfiguration(s=>{this._eventDispatcher.emitSingleViewEvent(new ViewLanguageConfigurationEvent),this.cursorConfig=new CursorConfiguration(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new ModelLanguageConfigurationChangedEvent(s))})),this._register(this.model.onDidChangeLanguage(s=>{this.cursorConfig=new CursorConfiguration(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new ModelLanguageChangedEvent(s))})),this._register(this.model.onDidChangeOptions(s=>{if(this._lines.setTabSize(this.model.getOptions().tabSize)){try{const o=this._eventDispatcher.beginEmitViewEvents();o.emitViewEvent(new ViewFlushedEvent),o.emitViewEvent(new ViewLineMappingChangedEvent),o.emitViewEvent(new ViewDecorationsChangedEvent(null)),this._cursor.onLineMappingChanged(o),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount(),this._getCustomLineHeights())}finally{this._eventDispatcher.endEmitViewEvents()}this._updateConfigurationViewLineCount.schedule()}this.cursorConfig=new CursorConfiguration(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new ModelOptionsChangedEvent(s))})),this._register(this.model.onDidChangeDecorations(s=>{this._decorations.onModelDecorationsChanged(),this._eventDispatcher.emitSingleViewEvent(new ViewDecorationsChangedEvent(s)),this._eventDispatcher.emitOutgoingEvent(new ModelDecorationsChangedEvent(s))}))}getFontSizeAtPosition(e){if(!this._configuration.options.get(172))return null;const s=this.model.getFontDecorationsInRange(Range$2.fromPositions(e),this._editorId);let o=this._configuration.options.get(59).fontSize+"px";for(const r of s)if(r.options.fontSize){o=r.options.fontSize;break}return o}setHiddenAreas(e,t,s){var c;this.hiddenAreasModel.setHiddenAreas(t,e);const o=this.hiddenAreasModel.getMergedRanges();if(o===this.previousHiddenAreas&&!s)return;this.previousHiddenAreas=o;const r=this._captureStableViewport();let l=!1;try{const d=this._eventDispatcher.beginEmitViewEvents();l=this._lines.setHiddenAreas(o),l&&(d.emitViewEvent(new ViewFlushedEvent),d.emitViewEvent(new ViewLineMappingChangedEvent),d.emitViewEvent(new ViewDecorationsChangedEvent(null)),this._cursor.onLineMappingChanged(d),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount(),this._getCustomLineHeights()),this.viewLayout.onHeightMaybeChanged());const u=(c=r.viewportStartModelPosition)==null?void 0:c.lineNumber;u&&o.some(f=>f.startLineNumber<=u&&u<=f.endLineNumber)||r.recoverViewportStart(this.coordinatesConverter,this.viewLayout)}finally{this._eventDispatcher.endEmitViewEvents()}this._updateConfigurationViewLineCount.schedule(),l&&this._eventDispatcher.emitOutgoingEvent(new HiddenAreasChangedEvent)}getVisibleRangesPlusViewportAboveBelow(){const e=this._configuration.options.get(165),t=this._configuration.options.get(75),s=Math.max(20,Math.round(e.height/t)),o=this.viewLayout.getLinesViewportData(),r=Math.max(1,o.completelyVisibleStartLineNumber-s),l=Math.min(this.getLineCount(),o.completelyVisibleEndLineNumber+s);return this._toModelVisibleRanges(new Range$2(r,this.getLineMinColumn(r),l,this.getLineMaxColumn(l)))}getVisibleRanges(){const e=this.getCompletelyVisibleViewRange();return this._toModelVisibleRanges(e)}getHiddenAreas(){return this._lines.getHiddenAreas()}_toModelVisibleRanges(e){const t=this.coordinatesConverter.convertViewRangeToModelRange(e),s=this._lines.getHiddenAreas();if(s.length===0)return[t];const o=[];let r=0,l=t.startLineNumber,c=t.startColumn;const d=t.endLineNumber,u=t.endColumn;for(let g=0,f=s.length;g<f;g++){const p=s[g].startLineNumber,m=s[g].endLineNumber;m<l||p>d||(l<p&&(o[r++]=new Range$2(l,c,p-1,this.model.getLineMaxColumn(p-1))),l=m+1,c=1)}return(l<d||l===d&&c<u)&&(o[r++]=new Range$2(l,c,d,u)),o}getCompletelyVisibleViewRange(){const e=this.viewLayout.getLinesViewportData(),t=e.completelyVisibleStartLineNumber,s=e.completelyVisibleEndLineNumber;return new Range$2(t,this.getLineMinColumn(t),s,this.getLineMaxColumn(s))}getCompletelyVisibleViewRangeAtScrollTop(e){const t=this.viewLayout.getLinesViewportDataAtScrollTop(e),s=t.completelyVisibleStartLineNumber,o=t.completelyVisibleEndLineNumber;return new Range$2(s,this.getLineMinColumn(s),o,this.getLineMaxColumn(o))}saveState(){const e=this.viewLayout.saveState(),t=e.scrollTop,s=this.viewLayout.getLineNumberAtVerticalOffset(t),o=this.coordinatesConverter.convertViewPositionToModelPosition(new Position$1(s,this.getLineMinColumn(s))),r=this.viewLayout.getVerticalOffsetForLineNumber(s)-t;return{scrollLeft:e.scrollLeft,firstPosition:o,firstPositionDeltaTop:r}}reduceRestoreState(e){if(typeof e.firstPosition>"u")return this._reduceRestoreStateCompatibility(e);const t=this.model.validatePosition(e.firstPosition),s=this.coordinatesConverter.convertModelPositionToViewPosition(t),o=this.viewLayout.getVerticalOffsetForLineNumber(s.lineNumber)-e.firstPositionDeltaTop;return{scrollLeft:e.scrollLeft,scrollTop:o}}_reduceRestoreStateCompatibility(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTopWithoutViewZones}}getTabSize(){return this.model.getOptions().tabSize}getLineCount(){return this._lines.getViewLineCount()}setViewport(e,t,s){this._viewportStart.update(this,e)}getActiveIndentGuide(e,t,s){return this._lines.getActiveIndentGuide(e,t,s)}getLinesIndentGuides(e,t){return this._lines.getViewLinesIndentGuides(e,t)}getBracketGuidesInRangeByLine(e,t,s,o){return this._lines.getViewLinesBracketGuides(e,t,s,o)}getLineContent(e){return this._lines.getViewLineContent(e)}getLineLength(e){return this._lines.getViewLineLength(e)}getLineMinColumn(e){return this._lines.getViewLineMinColumn(e)}getLineMaxColumn(e){return this._lines.getViewLineMaxColumn(e)}getLineFirstNonWhitespaceColumn(e){const t=firstNonWhitespaceIndex(this.getLineContent(e));return t===-1?0:t+1}getLineLastNonWhitespaceColumn(e){const t=lastNonWhitespaceIndex(this.getLineContent(e));return t===-1?0:t+2}getMinimapDecorationsInRange(e){return this._decorations.getMinimapDecorationsInRange(e)}getDecorationsInViewport(e){return this._decorations.getDecorationsViewportData(e).decorations}getInjectedTextAt(e){return this._lines.getInjectedTextAt(e)}_getTextDirection(e,t){let s=0;for(const o of t){const r=o.range;if(r.startLineNumber>e||r.endLineNumber<e)continue;const l=o.options.textDirection;l===TextDirection$1.RTL?s++:l===TextDirection$1.LTR&&s--}return s>0?TextDirection$1.RTL:TextDirection$1.LTR}getTextDirection(e){const t=this._decorations.getDecorationsOnLine(e);return this._getTextDirection(e,t.decorations)}getViewportViewLineRenderingData(e,t){const s=this._decorations.getDecorationsViewportData(e),o=s.inlineDecorations[t-e.startLineNumber];return this._getViewLineRenderingData(t,o,s.hasVariableFonts,s.decorations)}getViewLineRenderingData(e){const t=this._decorations.getDecorationsOnLine(e);return this._getViewLineRenderingData(e,t.inlineDecorations[0],t.hasVariableFonts,t.decorations)}_getViewLineRenderingData(e,t,s,o){const r=this.model.mightContainRTL(),l=this.model.mightContainNonBasicASCII(),c=this.getTabSize(),d=this._lines.getViewLineData(e);return d.inlineDecorations&&(t=[...t,...d.inlineDecorations.map(u=>u.toInlineDecoration(e))]),new ViewLineRenderingData(d.minColumn,d.maxColumn,d.content,d.continuesWithWrappedLine,r,l,d.tokens,t,c,d.startVisibleColumn,this._getTextDirection(e,o),s)}getViewLineData(e){return this._lines.getViewLineData(e)}getMinimapLinesRenderingData(e,t,s){const o=this._lines.getViewLinesData(e,t,s);return new MinimapLinesRenderingData(this.getTabSize(),o)}getAllOverviewRulerDecorations(e){const t=this.model.getOverviewRulerDecorations(this._editorId,filterValidationDecorations(this._configuration.options),filterFontDecorations(this._configuration.options)),s=new OverviewRulerDecorations;for(const o of t){const r=o.options,l=r.overviewRuler;if(!l)continue;const c=l.position;if(c===0)continue;const d=l.getColor(e.value),u=this.coordinatesConverter.getViewLineNumberOfModelPosition(o.range.startLineNumber,o.range.startColumn),g=this.coordinatesConverter.getViewLineNumberOfModelPosition(o.range.endLineNumber,o.range.endColumn);s.accept(d,r.zIndex,u,g,c)}return s.asArray}_invalidateDecorationsColorCache(){const e=this.model.getOverviewRulerDecorations();for(const t of e){const s=t.options.overviewRuler;s==null||s.invalidateCachedColor();const o=t.options.minimap;o==null||o.invalidateCachedColor()}}getValueInRange(e,t){const s=this.coordinatesConverter.convertViewRangeToModelRange(e);return this.model.getValueInRange(s,t)}getValueLengthInRange(e,t){const s=this.coordinatesConverter.convertViewRangeToModelRange(e);return this.model.getValueLengthInRange(s,t)}modifyPosition(e,t){const s=this.coordinatesConverter.convertViewPositionToModelPosition(e),o=this.model.modifyPosition(s,t);return this.coordinatesConverter.convertModelPositionToViewPosition(o)}deduceModelPositionRelativeToViewPosition(e,t,s){const o=this.coordinatesConverter.convertViewPositionToModelPosition(e);this.model.getEOL().length===2&&(t<0?t-=s:t+=s);const l=this.model.getOffsetAt(o)+t;return this.model.getPositionAt(l)}getPlainTextToCopy(e,t,s){const o=s?`\r
`:this.model.getEOL();e=e.slice(0),e.sort(Range$2.compareRangesUsingStarts);let r=!1,l=!1;for(const d of e)d.isEmpty()?r=!0:l=!0;if(!l){if(!t)return"";const d=e.map(g=>g.startLineNumber);let u="";for(let g=0;g<d.length;g++)g>0&&d[g-1]===d[g]||(u+=this.model.getLineContent(d[g])+o);return u}if(r&&t){const d=[];let u=0;for(const g of e){const f=g.startLineNumber;g.isEmpty()?f!==u&&d.push(this.model.getLineContent(f)):d.push(this.model.getValueInRange(g,s?2:0)),u=f}return d.length===1?d[0]:d}const c=[];for(const d of e)d.isEmpty()||c.push(this.model.getValueInRange(d,s?2:0));return c.length===1?c[0]:c}getRichTextToCopy(e,t){const s=this.model.getLanguageId();if(s===PLAINTEXT_LANGUAGE_ID||e.length!==1)return null;let o=e[0];if(o.isEmpty()){if(!t)return null;const g=o.startLineNumber;o=new Range$2(g,this.model.getLineMinColumn(g),g,this.model.getLineMaxColumn(g))}const r=this._configuration.options.get(59),l=this._getColorMap(),d=/[:;\\\/<>]/.test(r.fontFamily)||r.fontFamily===EDITOR_FONT_DEFAULTS.fontFamily;let u;return d?u=EDITOR_FONT_DEFAULTS.fontFamily:(u=r.fontFamily,u=u.replace(/"/g,"'"),/[,']/.test(u)||/[+ ]/.test(u)&&(u=`'${u}'`),u=`${u}, ${EDITOR_FONT_DEFAULTS.fontFamily}`),{mode:s,html:`<div style="color: ${l[1]};background-color: ${l[2]};font-family: ${u};font-weight: ${r.fontWeight};font-size: ${r.fontSize}px;line-height: ${r.lineHeight}px;white-space: pre;">`+this._getHTMLToCopy(o,l)+"</div>"}}_getHTMLToCopy(e,t){const s=e.startLineNumber,o=e.startColumn,r=e.endLineNumber,l=e.endColumn,c=this.getTabSize();let d="";for(let u=s;u<=r;u++){const g=this.model.tokenization.getLineTokens(u),f=g.getLineContent(),p=u===s?o-1:0,m=u===r?l-1:f.length;f===""?d+="<br>":d+=tokenizeLineToHTML(f,g.inflate(),t,p,m,c,isWindows)}return d}_getColorMap(){const e=TokenizationRegistry.getColorMap(),t=["#000000"];if(e)for(let s=1,o=e.length;s<o;s++)t[s]=Color.Format.CSS.formatHex(e[s]);return t}getPrimaryCursorState(){return this._cursor.getPrimaryCursorState()}getLastAddedCursorIndex(){return this._cursor.getLastAddedCursorIndex()}getCursorStates(){return this._cursor.getCursorStates()}setCursorStates(e,t,s){return this._withViewEventsCollector(o=>this._cursor.setStates(o,e,t,s))}getCursorColumnSelectData(){return this._cursor.getCursorColumnSelectData()}getCursorAutoClosedCharacters(){return this._cursor.getAutoClosedCharacters()}setCursorColumnSelectData(e){this._cursor.setCursorColumnSelectData(e)}getPrevEditOperationType(){return this._cursor.getPrevEditOperationType()}setPrevEditOperationType(e){this._cursor.setPrevEditOperationType(e)}getSelection(){return this._cursor.getSelection()}getSelections(){return this._cursor.getSelections()}getPosition(){return this._cursor.getPrimaryCursorState().modelState.position}setSelections(e,t,s=0){this._withViewEventsCollector(o=>this._cursor.setSelections(o,e,t,s))}saveCursorState(){return this._cursor.saveState()}restoreCursorState(e){this._withViewEventsCollector(t=>this._cursor.restoreState(t,e))}_executeCursorEdit(e){if(this._cursor.context.cursorConfig.readOnly){this._eventDispatcher.emitOutgoingEvent(new ReadOnlyEditAttemptEvent);return}this._withViewEventsCollector(e)}executeEdits(e,t,s,o){this._executeCursorEdit(r=>this._cursor.executeEdits(r,e,t,s,o))}startComposition(){this._executeCursorEdit(e=>this._cursor.startComposition(e))}endComposition(e){this._executeCursorEdit(t=>this._cursor.endComposition(t,e))}type(e,t){this._executeCursorEdit(s=>this._cursor.type(s,e,t))}compositionType(e,t,s,o,r){this._executeCursorEdit(l=>this._cursor.compositionType(l,e,t,s,o,r))}paste(e,t,s,o){this._executeCursorEdit(r=>this._cursor.paste(r,e,t,s,o))}cut(e){this._executeCursorEdit(t=>this._cursor.cut(t,e))}executeCommand(e,t){this._executeCursorEdit(s=>this._cursor.executeCommand(s,e,t))}executeCommands(e,t){this._executeCursorEdit(s=>this._cursor.executeCommands(s,e,t))}revealAllCursors(e,t,s=!1){this._withViewEventsCollector(o=>this._cursor.revealAll(o,e,s,0,t,0))}revealPrimaryCursor(e,t,s=!1){this._withViewEventsCollector(o=>this._cursor.revealPrimary(o,e,s,0,t,0))}revealTopMostCursor(e){const t=this._cursor.getTopMostViewPosition(),s=new Range$2(t.lineNumber,t.column,t.lineNumber,t.column);this._withViewEventsCollector(o=>o.emitViewEvent(new ViewRevealRangeRequestEvent(e,!1,s,null,0,!0,0)))}revealBottomMostCursor(e){const t=this._cursor.getBottomMostViewPosition(),s=new Range$2(t.lineNumber,t.column,t.lineNumber,t.column);this._withViewEventsCollector(o=>o.emitViewEvent(new ViewRevealRangeRequestEvent(e,!1,s,null,0,!0,0)))}revealRange(e,t,s,o,r){this._withViewEventsCollector(l=>l.emitViewEvent(new ViewRevealRangeRequestEvent(e,!1,s,null,o,t,r)))}changeWhitespace(e){this.viewLayout.changeWhitespace(e)&&(this._eventDispatcher.emitSingleViewEvent(new ViewZonesChangedEvent$1),this._eventDispatcher.emitOutgoingEvent(new ViewZonesChangedEvent))}_withViewEventsCollector(e){return this._transactionalTarget.batchChanges(()=>{try{const t=this._eventDispatcher.beginEmitViewEvents();return e(t)}finally{this._eventDispatcher.endEmitViewEvents()}})}batchEvents(e){this._withViewEventsCollector(()=>{e()})}normalizePosition(e,t){return this._lines.normalizePosition(e,t)}getLineIndentColumn(e){return this._lines.getLineIndentColumn(e)}};class ViewportStart{static create(e){const t=e._setTrackedRange(null,new Range$2(1,1,1,1),1);return new ViewportStart(e,1,!1,t,0)}get viewLineNumber(){return this._viewLineNumber}get isValid(){return this._isValid}get modelTrackedRange(){return this._modelTrackedRange}get startLineDelta(){return this._startLineDelta}constructor(e,t,s,o,r){this._model=e,this._viewLineNumber=t,this._isValid=s,this._modelTrackedRange=o,this._startLineDelta=r}dispose(){this._model._setTrackedRange(this._modelTrackedRange,null,1)}update(e,t){const s=e.coordinatesConverter.convertViewPositionToModelPosition(new Position$1(t,e.getLineMinColumn(t))),o=e.model._setTrackedRange(this._modelTrackedRange,new Range$2(s.lineNumber,s.column,s.lineNumber,s.column),1),r=e.viewLayout.getVerticalOffsetForLineNumber(t),l=e.viewLayout.getCurrentScrollTop();this._viewLineNumber=t,this._isValid=!0,this._modelTrackedRange=o,this._startLineDelta=l-r}invalidate(){this._isValid=!1}}class OverviewRulerDecorations{constructor(){this._asMap=Object.create(null),this.asArray=[]}accept(e,t,s,o,r){const l=this._asMap[e];if(l){const c=l.data,d=c[c.length-3],u=c[c.length-1];if(d===r&&u+1>=s){o>u&&(c[c.length-1]=o);return}c.push(r,s,o)}else{const c=new OverviewRulerDecorationsGroup(e,t,[r,s,o]);this._asMap[e]=c,this.asArray.push(c)}}}class HiddenAreasModel{constructor(){this.hiddenAreas=new Map,this.shouldRecompute=!1,this.ranges=[]}setHiddenAreas(e,t){const s=this.hiddenAreas.get(e);s&&rangeArraysEqual(s,t)||(this.hiddenAreas.set(e,t),this.shouldRecompute=!0)}getMergedRanges(){if(!this.shouldRecompute)return this.ranges;this.shouldRecompute=!1;const e=Array.from(this.hiddenAreas.values()).reduce((t,s)=>mergeLineRangeArray(t,s),[]);return rangeArraysEqual(this.ranges,e)?this.ranges:(this.ranges=e,this.ranges)}}function mergeLineRangeArray(a,e){const t=[];let s=0,o=0;for(;s<a.length&&o<e.length;){const r=a[s],l=e[o];if(r.endLineNumber<l.startLineNumber-1)t.push(a[s++]);else if(l.endLineNumber<r.startLineNumber-1)t.push(e[o++]);else{const c=Math.min(r.startLineNumber,l.startLineNumber),d=Math.max(r.endLineNumber,l.endLineNumber);t.push(new Range$2(c,1,d,1)),s++,o++}}for(;s<a.length;)t.push(a[s++]);for(;o<e.length;)t.push(e[o++]);return t}function rangeArraysEqual(a,e){if(a.length!==e.length)return!1;for(let t=0;t<a.length;t++)if(!a[t].equalsRange(e[t]))return!1;return!0}class StableViewport{constructor(e,t){this.viewportStartModelPosition=e,this.startLineDelta=t}recoverViewportStart(e,t){if(!this.viewportStartModelPosition)return;const s=e.convertModelPositionToViewPosition(this.viewportStartModelPosition),o=t.getVerticalOffsetForLineNumber(s.lineNumber);t.setScrollPosition({scrollTop:o+this.startLineDelta},1)}}class ServiceCollection{constructor(...e){this._entries=new Map;for(const[t,s]of e)this.set(t,s)}set(e,t){const s=this._entries.get(e);return this._entries.set(e,t),s}get(e){return this._entries.get(e)}}var __decorate$2A=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2v=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},CodeEditorWidget_1,fi;let CodeEditorWidget=(fi=class extends Disposable{get isSimpleWidget(){return this._configuration.isSimpleWidget}get contextMenuId(){return this._configuration.contextMenuId}get contextKeyService(){return this._contextKeyService}constructor(e,t,s,o,r,l,c,d,u,g,f,p){super(),this.languageConfigurationService=f,this._deliveryQueue=createEventDeliveryQueue(),this._contributions=this._register(new CodeEditorContributions),this._onDidDispose=this._register(new Emitter$1),this.onDidDispose=this._onDidDispose.event,this._onDidChangeModelContent=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelContent=this._onDidChangeModelContent.event,this._onDidChangeModelLanguage=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelLanguage=this._onDidChangeModelLanguage.event,this._onDidChangeModelLanguageConfiguration=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelLanguageConfiguration=this._onDidChangeModelLanguageConfiguration.event,this._onDidChangeModelOptions=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelOptions=this._onDidChangeModelOptions.event,this._onDidChangeModelDecorations=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelDecorations=this._onDidChangeModelDecorations.event,this._onDidChangeLineHeight=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeLineHeight=this._onDidChangeLineHeight.event,this._onDidChangeFont=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeFont=this._onDidChangeFont.event,this._onDidChangeModelTokens=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelTokens=this._onDidChangeModelTokens.event,this._onDidChangeConfiguration=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._onWillChangeModel=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onWillChangeModel=this._onWillChangeModel.event,this._onDidChangeModel=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeModel=this._onDidChangeModel.event,this._onDidChangeCursorPosition=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeCursorPosition=this._onDidChangeCursorPosition.event,this._onDidChangeCursorSelection=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeCursorSelection=this._onDidChangeCursorSelection.event,this._onDidAttemptReadOnlyEdit=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onDidAttemptReadOnlyEdit=this._onDidAttemptReadOnlyEdit.event,this._onDidLayoutChange=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidLayoutChange=this._onDidLayoutChange.event,this._editorTextFocus=this._register(new BooleanEventEmitter({deliveryQueue:this._deliveryQueue})),this.onDidFocusEditorText=this._editorTextFocus.onDidChangeToTrue,this.onDidBlurEditorText=this._editorTextFocus.onDidChangeToFalse,this._editorWidgetFocus=this._register(new BooleanEventEmitter({deliveryQueue:this._deliveryQueue})),this.onDidFocusEditorWidget=this._editorWidgetFocus.onDidChangeToTrue,this.onDidBlurEditorWidget=this._editorWidgetFocus.onDidChangeToFalse,this._onWillType=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onWillType=this._onWillType.event,this._onDidType=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onDidType=this._onDidType.event,this._onDidCompositionStart=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onDidCompositionStart=this._onDidCompositionStart.event,this._onDidCompositionEnd=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onDidCompositionEnd=this._onDidCompositionEnd.event,this._onDidPaste=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onDidPaste=this._onDidPaste.event,this._onMouseUp=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseUp=this._onMouseUp.event,this._onMouseDown=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseDown=this._onMouseDown.event,this._onMouseDrag=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseDrag=this._onMouseDrag.event,this._onMouseDrop=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseDrop=this._onMouseDrop.event,this._onMouseDropCanceled=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseDropCanceled=this._onMouseDropCanceled.event,this._onDropIntoEditor=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onDropIntoEditor=this._onDropIntoEditor.event,this._onContextMenu=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onContextMenu=this._onContextMenu.event,this._onMouseMove=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseMove=this._onMouseMove.event,this._onMouseLeave=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseLeave=this._onMouseLeave.event,this._onMouseWheel=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseWheel=this._onMouseWheel.event,this._onKeyUp=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onKeyUp=this._onKeyUp.event,this._onKeyDown=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onKeyDown=this._onKeyDown.event,this._onDidContentSizeChange=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidContentSizeChange=this._onDidContentSizeChange.event,this._onDidScrollChange=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidScrollChange=this._onDidScrollChange.event,this._onDidChangeViewZones=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeViewZones=this._onDidChangeViewZones.event,this._onDidChangeHiddenAreas=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeHiddenAreas=this._onDidChangeHiddenAreas.event,this._updateCounter=0,this._onWillTriggerEditorOperationEvent=this._register(new Emitter$1),this._onBeginUpdate=this._register(new Emitter$1),this.onBeginUpdate=this._onBeginUpdate.event,this._onEndUpdate=this._register(new Emitter$1),this.onEndUpdate=this._onEndUpdate.event,this._onBeforeExecuteEdit=this._register(new Emitter$1),this.onBeforeExecuteEdit=this._onBeforeExecuteEdit.event,this._actions=new Map,this._bannerDomNode=null,this._dropIntoEditorDecorations=this.createDecorationsCollection(),this.inComposition=!1,r.willCreateCodeEditor();const m={...t};if(this._domElement=e,this._overflowWidgetsDomNode=m.overflowWidgetsDomNode,delete m.overflowWidgetsDomNode,this._id=++EDITOR_ID,this._decorationTypeKeysToIds={},this._decorationTypeSubtypes={},this._telemetryData=s.telemetryData,this._configuration=this._register(this._createConfiguration(s.isSimpleWidget||!1,s.contextMenuId??(s.isSimpleWidget?MenuId.SimpleEditorContext:MenuId.EditorContext),m,g)),this._register(this._configuration.onDidChange(b=>{this._onDidChangeConfiguration.fire(b);const v=this._configuration.options;if(b.hasChanged(165)){const S=v.get(165);this._onDidLayoutChange.fire(S)}})),this._contextKeyService=this._register(c.createScoped(this._domElement)),s.contextKeyValues)for(const[b,v]of Object.entries(s.contextKeyValues))this._contextKeyService.createKey(b,v);this._notificationService=u,this._codeEditorService=r,this._commandService=l,this._themeService=d,this._register(new EditorContextKeysManager(this,this._contextKeyService)),this._register(new EditorModeContext(this,this._contextKeyService,p)),this._instantiationService=this._register(o.createChild(new ServiceCollection([IContextKeyService,this._contextKeyService]))),this._modelData=null,this._contentWidgets={},this._overlayWidgets={},this._glyphMarginWidgets={};let _;Array.isArray(s.contributions)?_=s.contributions:_=EditorExtensionsRegistry.getEditorContributions(),this._contributions.initialize(this,_,this._instantiationService);for(const b of EditorExtensionsRegistry.getEditorActions()){if(this._actions.has(b.id)){onUnexpectedError(new Error(`Cannot have two actions with the same id ${b.id}`));continue}const v=new InternalEditorAction(b.id,b.label,b.alias,b.metadata,b.precondition??void 0,S=>this._instantiationService.invokeFunction(y=>Promise.resolve(b.runEditorCommand(y,this,S))),this._contextKeyService);this._actions.set(v.id,v)}const C=()=>!this._configuration.options.get(104)&&this._configuration.options.get(43).enabled;this._register(new DragAndDropObserver(this._domElement,{onDragOver:b=>{if(!C())return;const v=this.getTargetAtClientPoint(b.clientX,b.clientY);v!=null&&v.position&&this.showDropIndicatorAt(v.position)},onDrop:async b=>{if(!C()||(this.removeDropIndicator(),!b.dataTransfer))return;const v=this.getTargetAtClientPoint(b.clientX,b.clientY);v!=null&&v.position&&this._onDropIntoEditor.fire({position:v.position,event:b})},onDragLeave:()=>{this.removeDropIndicator()},onDragEnd:()=>{this.removeDropIndicator()}})),this._codeEditorService.addCodeEditor(this)}writeScreenReaderContent(e){var t;(t=this._modelData)==null||t.view.writeScreenReaderContent(e)}_createConfiguration(e,t,s,o){return new EditorConfiguration(e,t,s,this._domElement,o)}getId(){return this.getEditorType()+":"+this._id}getEditorType(){return EditorType.ICodeEditor}dispose(){this._codeEditorService.removeCodeEditor(this),this._actions.clear(),this._contentWidgets={},this._overlayWidgets={},this._removeDecorationTypes(),this._postDetachModelCleanup(this._detachModel()),this._onDidDispose.fire(),super.dispose()}invokeWithinContext(e){return this._instantiationService.invokeFunction(e)}updateOptions(e){this._configuration.updateOptions(e||{})}getOptions(){return this._configuration.options}getOption(e){return this._configuration.options.get(e)}getRawOptions(){return this._configuration.getRawOptions()}getOverflowWidgetsDomNode(){return this._overflowWidgetsDomNode}getConfiguredWordAtPosition(e){return this._modelData?WordOperations.getWordAtPosition(this._modelData.model,this._configuration.options.get(148),this._configuration.options.get(147),e):null}getValue(e=null){if(!this._modelData)return"";const t=!!(e&&e.preserveBOM);let s=0;return e&&e.lineEnding&&e.lineEnding===`
`?s=1:e&&e.lineEnding&&e.lineEnding===`\r
`&&(s=2),this._modelData.model.getValue(s,t)}setValue(e){try{if(this._beginUpdate(),!this._modelData)return;this._modelData.model.setValue(e)}finally{this._endUpdate()}}getModel(){return this._modelData?this._modelData.model:null}setModel(e=null){var t;try{this._beginUpdate();const s=e;if(this._modelData===null&&s===null||this._modelData&&this._modelData.model===s)return;const o={oldModelUrl:((t=this._modelData)==null?void 0:t.model.uri)||null,newModelUrl:(s==null?void 0:s.uri)||null};this._onWillChangeModel.fire(o);const r=this.hasTextFocus(),l=this._detachModel();this._attachModel(s),this.hasModel()?r&&this.focus():(this._editorTextFocus.setValue(!1),this._editorWidgetFocus.setValue(!1)),this._removeDecorationTypes(),this._onDidChangeModel.fire(o),this._postDetachModelCleanup(l),this._contributionsDisposable=this._contributions.onAfterModelAttached()}finally{this._endUpdate()}}_removeDecorationTypes(){if(this._decorationTypeKeysToIds={},this._decorationTypeSubtypes){for(const e in this._decorationTypeSubtypes){const t=this._decorationTypeSubtypes[e];for(const s in t)this._removeDecorationType(e+"-"+s)}this._decorationTypeSubtypes={}}}getVisibleRanges(){return this._modelData?this._modelData.viewModel.getVisibleRanges():[]}getVisibleRangesPlusViewportAboveBelow(){return this._modelData?this._modelData.viewModel.getVisibleRangesPlusViewportAboveBelow():[]}getWhitespaces(){return this._modelData?this._modelData.viewModel.viewLayout.getWhitespaces():[]}static _getVerticalOffsetAfterPosition(e,t,s,o){const r=e.model.validatePosition({lineNumber:t,column:s}),l=e.viewModel.coordinatesConverter.convertModelPositionToViewPosition(r);return e.viewModel.viewLayout.getVerticalOffsetAfterLineNumber(l.lineNumber,o)}getTopForLineNumber(e,t=!1){return this._modelData?CodeEditorWidget_1._getVerticalOffsetForPosition(this._modelData,e,1,t):-1}getTopForPosition(e,t){return this._modelData?CodeEditorWidget_1._getVerticalOffsetForPosition(this._modelData,e,t,!1):-1}static _getVerticalOffsetForPosition(e,t,s,o=!1){const r=e.model.validatePosition({lineNumber:t,column:s}),l=e.viewModel.coordinatesConverter.convertModelPositionToViewPosition(r);return e.viewModel.viewLayout.getVerticalOffsetForLineNumber(l.lineNumber,o)}getBottomForLineNumber(e,t=!1){if(!this._modelData)return-1;const s=this._modelData.model.getLineMaxColumn(e);return CodeEditorWidget_1._getVerticalOffsetAfterPosition(this._modelData,e,s,t)}getLineHeightForPosition(e){if(!this._modelData)return-1;const t=this._modelData.viewModel,s=t.coordinatesConverter,o=Position$1.lift(e);if(s.modelPositionIsVisible(o)){const r=s.convertModelPositionToViewPosition(o);return t.viewLayout.getLineHeightForLineNumber(r.lineNumber)}return 0}setHiddenAreas(e,t,s){var o;(o=this._modelData)==null||o.viewModel.setHiddenAreas(e.map(r=>Range$2.lift(r)),t,s)}getVisibleColumnFromPosition(e){if(!this._modelData)return e.column;const t=this._modelData.model.validatePosition(e),s=this._modelData.model.getOptions().tabSize;return CursorColumns.visibleColumnFromColumn(this._modelData.model.getLineContent(t.lineNumber),t.column,s)+1}getPosition(){return this._modelData?this._modelData.viewModel.getPosition():null}setPosition(e,t="api"){if(this._modelData){if(!Position$1.isIPosition(e))throw new Error("Invalid arguments");this._modelData.viewModel.setSelections(t,[{selectionStartLineNumber:e.lineNumber,selectionStartColumn:e.column,positionLineNumber:e.lineNumber,positionColumn:e.column}])}}_sendRevealRange(e,t,s,o){if(!this._modelData)return;if(!Range$2.isIRange(e))throw new Error("Invalid arguments");const r=this._modelData.model.validateRange(e),l=this._modelData.viewModel.coordinatesConverter.convertModelRangeToViewRange(r);this._modelData.viewModel.revealRange("api",s,l,t,o)}revealLine(e,t=0){this._revealLine(e,0,t)}revealLineInCenter(e,t=0){this._revealLine(e,1,t)}revealLineInCenterIfOutsideViewport(e,t=0){this._revealLine(e,2,t)}revealLineNearTop(e,t=0){this._revealLine(e,5,t)}_revealLine(e,t,s){if(typeof e!="number")throw new Error("Invalid arguments");this._sendRevealRange(new Range$2(e,1,e,1),t,!1,s)}revealPosition(e,t=0){this._revealPosition(e,0,!0,t)}revealPositionInCenter(e,t=0){this._revealPosition(e,1,!0,t)}revealPositionInCenterIfOutsideViewport(e,t=0){this._revealPosition(e,2,!0,t)}revealPositionNearTop(e,t=0){this._revealPosition(e,5,!0,t)}_revealPosition(e,t,s,o){if(!Position$1.isIPosition(e))throw new Error("Invalid arguments");this._sendRevealRange(new Range$2(e.lineNumber,e.column,e.lineNumber,e.column),t,s,o)}getSelection(){return this._modelData?this._modelData.viewModel.getSelection():null}getSelections(){return this._modelData?this._modelData.viewModel.getSelections():null}setSelection(e,t="api"){const s=Selection$1.isISelection(e),o=Range$2.isIRange(e);if(!s&&!o)throw new Error("Invalid arguments");if(s)this._setSelectionImpl(e,t);else if(o){const r={selectionStartLineNumber:e.startLineNumber,selectionStartColumn:e.startColumn,positionLineNumber:e.endLineNumber,positionColumn:e.endColumn};this._setSelectionImpl(r,t)}}_setSelectionImpl(e,t){if(!this._modelData)return;const s=new Selection$1(e.selectionStartLineNumber,e.selectionStartColumn,e.positionLineNumber,e.positionColumn);this._modelData.viewModel.setSelections(t,[s])}revealLines(e,t,s=0){this._revealLines(e,t,0,s)}revealLinesInCenter(e,t,s=0){this._revealLines(e,t,1,s)}revealLinesInCenterIfOutsideViewport(e,t,s=0){this._revealLines(e,t,2,s)}revealLinesNearTop(e,t,s=0){this._revealLines(e,t,5,s)}_revealLines(e,t,s,o){if(typeof e!="number"||typeof t!="number")throw new Error("Invalid arguments");this._sendRevealRange(new Range$2(e,1,t,1),s,!1,o)}revealRange(e,t=0,s=!1,o=!0){this._revealRange(e,s?1:0,o,t)}revealRangeInCenter(e,t=0){this._revealRange(e,1,!0,t)}revealRangeInCenterIfOutsideViewport(e,t=0){this._revealRange(e,2,!0,t)}revealRangeNearTop(e,t=0){this._revealRange(e,5,!0,t)}revealRangeNearTopIfOutsideViewport(e,t=0){this._revealRange(e,6,!0,t)}revealRangeAtTop(e,t=0){this._revealRange(e,3,!0,t)}_revealRange(e,t,s,o){if(!Range$2.isIRange(e))throw new Error("Invalid arguments");this._sendRevealRange(Range$2.lift(e),t,s,o)}setSelections(e,t="api",s=0){if(this._modelData){if(!e||e.length===0)throw new Error("Invalid arguments");for(let o=0,r=e.length;o<r;o++)if(!Selection$1.isISelection(e[o]))throw new Error("Invalid arguments");this._modelData.viewModel.setSelections(t,e,s)}}getContentWidth(){return this._modelData?this._modelData.viewModel.viewLayout.getContentWidth():-1}getScrollWidth(){return this._modelData?this._modelData.viewModel.viewLayout.getScrollWidth():-1}getScrollLeft(){return this._modelData?this._modelData.viewModel.viewLayout.getCurrentScrollLeft():-1}getContentHeight(){return this._modelData?this._modelData.viewModel.viewLayout.getContentHeight():-1}getScrollHeight(){return this._modelData?this._modelData.viewModel.viewLayout.getScrollHeight():-1}getScrollTop(){return this._modelData?this._modelData.viewModel.viewLayout.getCurrentScrollTop():-1}setScrollLeft(e,t=1){if(this._modelData){if(typeof e!="number")throw new Error("Invalid arguments");this._modelData.viewModel.viewLayout.setScrollPosition({scrollLeft:e},t)}}setScrollTop(e,t=1){if(this._modelData){if(typeof e!="number")throw new Error("Invalid arguments");this._modelData.viewModel.viewLayout.setScrollPosition({scrollTop:e},t)}}setScrollPosition(e,t=1){this._modelData&&this._modelData.viewModel.viewLayout.setScrollPosition(e,t)}hasPendingScrollAnimation(){return this._modelData?this._modelData.viewModel.viewLayout.hasPendingScrollAnimation():!1}saveViewState(){if(!this._modelData)return null;const e=this._contributions.saveViewState(),t=this._modelData.viewModel.saveCursorState(),s=this._modelData.viewModel.saveState();return{cursorState:t,viewState:s,contributionsState:e}}restoreViewState(e){if(!this._modelData||!this._modelData.hasRealView)return;const t=e;if(t&&t.cursorState&&t.viewState){const s=t.cursorState;Array.isArray(s)?s.length>0&&this._modelData.viewModel.restoreCursorState(s):this._modelData.viewModel.restoreCursorState([s]),this._contributions.restoreViewState(t.contributionsState||{});const o=this._modelData.viewModel.reduceRestoreState(t.viewState);this._modelData.view.restoreState(o)}}handleInitialized(){var e;(e=this._getViewModel())==null||e.visibleLinesStabilized()}getContribution(e){return this._contributions.get(e)}getActions(){return Array.from(this._actions.values())}getSupportedActions(){let e=this.getActions();return e=e.filter(t=>t.isSupported()),e}getAction(e){return this._actions.get(e)||null}trigger(e,t,s){s=s||{};try{switch(this._onWillTriggerEditorOperationEvent.fire({source:e,handlerId:t,payload:s}),this._beginUpdate(),t){case"compositionStart":this._startComposition();return;case"compositionEnd":this._endComposition(e);return;case"type":{const r=s;this._type(e,r.text||"");return}case"replacePreviousChar":{const r=s;this._compositionType(e,r.text||"",r.replaceCharCnt||0,0,0);return}case"compositionType":{const r=s;this._compositionType(e,r.text||"",r.replacePrevCharCnt||0,r.replaceNextCharCnt||0,r.positionDelta||0);return}case"paste":{const r=s;this._paste(e,r.text||"",r.pasteOnNewLine||!1,r.multicursorText||null,r.mode||null,r.clipboardEvent);return}case"cut":this._cut(e);return}const o=this.getAction(t);if(o){Promise.resolve(o.run(s)).then(void 0,onUnexpectedError);return}if(!this._modelData||this._triggerEditorCommand(e,t,s))return;this._triggerCommand(t,s)}finally{this._endUpdate()}}_triggerCommand(e,t){this._commandService.executeCommand(e,t)}_startComposition(){this._modelData&&(this.inComposition=!0,this._modelData.viewModel.startComposition(),this._onDidCompositionStart.fire())}_endComposition(e){this._modelData&&(this.inComposition=!1,this._modelData.viewModel.endComposition(e),this._onDidCompositionEnd.fire())}_type(e,t){!this._modelData||t.length===0||(e==="keyboard"&&this._onWillType.fire(t),this._modelData.viewModel.type(t,e),e==="keyboard"&&this._onDidType.fire(t))}_compositionType(e,t,s,o,r){this._modelData&&this._modelData.viewModel.compositionType(t,s,o,r,e)}_paste(e,t,s,o,r,l){if(!this._modelData)return;const c=this._modelData.viewModel,d=c.getSelection().getStartPosition();c.paste(t,s,o,e);const u=c.getSelection().getStartPosition();e==="keyboard"&&this._onDidPaste.fire({clipboardEvent:l,range:new Range$2(d.lineNumber,d.column,u.lineNumber,u.column),languageId:r})}_cut(e){this._modelData&&this._modelData.viewModel.cut(e)}_triggerEditorCommand(e,t,s){const o=EditorExtensionsRegistry.getEditorCommand(t);return o?(s=s||{},s.source=e,this._instantiationService.invokeFunction(r=>{Promise.resolve(o.runEditorCommand(r,this,s)).then(void 0,onUnexpectedError)}),!0):!1}_getViewModel(){return this._modelData?this._modelData.viewModel:null}pushUndoStop(){return!this._modelData||this._configuration.options.get(104)?!1:(this._modelData.model.pushStackElement(),!0)}popUndoStop(){return!this._modelData||this._configuration.options.get(104)?!1:(this._modelData.model.popStackElement(),!0)}edit(e,t){return this.executeEdits(t,e.replacements.map(s=>({range:s.range,text:s.text})),void 0)}executeEdits(e,t,s){if(!this._modelData||this._configuration.options.get(104))return!1;let o;s?Array.isArray(s)?o=()=>s:o=s:o=()=>null;let r,l;return e instanceof TextModelEditSource?(l=e,r=e.metadata.source):(l=EditSources.unknown({name:r}),r=e),this._onBeforeExecuteEdit.fire({source:r??void 0}),this._modelData.viewModel.executeEdits(r,t,o,l),!0}executeCommand(e,t){this._modelData&&this._modelData.viewModel.executeCommand(t,e)}executeCommands(e,t){this._modelData&&this._modelData.viewModel.executeCommands(t,e)}createDecorationsCollection(e){return new EditorDecorationsCollection(this,e)}changeDecorations(e){return this._modelData?this._modelData.model.changeDecorations(e,this._id):null}getLineDecorations(e){if(!this._modelData)return null;const t=this._configuration.options;return this._modelData.model.getLineDecorations(e,this._id,filterValidationDecorations(t),filterFontDecorations(t))}getDecorationsInRange(e){if(!this._modelData)return null;const t=this._configuration.options;return this._modelData.model.getDecorationsInRange(e,this._id,filterValidationDecorations(t),filterFontDecorations(t))}getFontSizeAtPosition(e){return this._modelData?this._modelData.viewModel.getFontSizeAtPosition(e):null}deltaDecorations(e,t){return this._modelData?e.length===0&&t.length===0?e:this._modelData.model.deltaDecorations(e,t,this._id):[]}removeDecorations(e){!this._modelData||e.length===0||this._modelData.model.changeDecorations(t=>{t.deltaDecorations(e,[])})}removeDecorationsByType(e){const t=this._decorationTypeKeysToIds[e];t&&this.changeDecorations(s=>s.deltaDecorations(t,[])),this._decorationTypeKeysToIds.hasOwnProperty(e)&&delete this._decorationTypeKeysToIds[e],this._decorationTypeSubtypes.hasOwnProperty(e)&&delete this._decorationTypeSubtypes[e]}getLayoutInfo(){return this._configuration.options.get(165)}createOverviewRuler(e){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.createOverviewRuler(e)}getContainerDomNode(){return this._domElement}getDomNode(){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.domNode.domNode}delegateVerticalScrollbarPointerDown(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.delegateScrollFromMouseWheelEvent(e)}layout(e,t=!1){this._configuration.observeContainer(e),t||this.render()}focus(){!this._modelData||!this._modelData.hasRealView||this._modelData.view.focus()}hasTextFocus(){return!this._modelData||!this._modelData.hasRealView?!1:this._modelData.view.isFocused()}hasWidgetFocus(){return!this._modelData||!this._modelData.hasRealView?!1:this._modelData.view.isWidgetFocused()}addContentWidget(e){const t={widget:e,position:e.getPosition()};this._contentWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting a content widget with the same id:"+e.getId()),this._contentWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addContentWidget(t)}layoutContentWidget(e){const t=e.getId();if(this._contentWidgets.hasOwnProperty(t)){const s=this._contentWidgets[t];s.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutContentWidget(s)}}removeContentWidget(e){const t=e.getId();if(this._contentWidgets.hasOwnProperty(t)){const s=this._contentWidgets[t];delete this._contentWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeContentWidget(s)}}addOverlayWidget(e){const t={widget:e,position:e.getPosition()};this._overlayWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting an overlay widget with the same id."),this._overlayWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addOverlayWidget(t)}layoutOverlayWidget(e){const t=e.getId();if(this._overlayWidgets.hasOwnProperty(t)){const s=this._overlayWidgets[t];s.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutOverlayWidget(s)}}removeOverlayWidget(e){const t=e.getId();if(this._overlayWidgets.hasOwnProperty(t)){const s=this._overlayWidgets[t];delete this._overlayWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeOverlayWidget(s)}}addGlyphMarginWidget(e){const t={widget:e,position:e.getPosition()};this._glyphMarginWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting a glyph margin widget with the same id."),this._glyphMarginWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addGlyphMarginWidget(t)}layoutGlyphMarginWidget(e){const t=e.getId();if(this._glyphMarginWidgets.hasOwnProperty(t)){const s=this._glyphMarginWidgets[t];s.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutGlyphMarginWidget(s)}}removeGlyphMarginWidget(e){const t=e.getId();if(this._glyphMarginWidgets.hasOwnProperty(t)){const s=this._glyphMarginWidgets[t];delete this._glyphMarginWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeGlyphMarginWidget(s)}}changeViewZones(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.change(e)}getTargetAtClientPoint(e,t){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.getTargetAtClientPoint(e,t)}getScrolledVisiblePosition(e){if(!this._modelData||!this._modelData.hasRealView)return null;const t=this._modelData.model.validatePosition(e),o=this._configuration.options.get(165),r=CodeEditorWidget_1._getVerticalOffsetForPosition(this._modelData,t.lineNumber,t.column)-this.getScrollTop(),l=this._modelData.view.getOffsetForColumn(t.lineNumber,t.column)+o.glyphMarginWidth+o.lineNumbersWidth+o.decorationsWidth-this.getScrollLeft(),c=this.getLineHeightForPosition(t);return{top:r,left:l,height:c}}getOffsetForColumn(e,t){return!this._modelData||!this._modelData.hasRealView?-1:this._modelData.view.getOffsetForColumn(e,t)}render(e=!1){!this._modelData||!this._modelData.hasRealView||this._modelData.viewModel.batchEvents(()=>{this._modelData.view.render(!0,e)})}setAriaOptions(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.setAriaOptions(e)}applyFontInfo(e){applyFontInfo(e,this._configuration.options.get(59))}setBanner(e,t){this._bannerDomNode&&this._domElement.contains(this._bannerDomNode)&&this._bannerDomNode.remove(),this._bannerDomNode=e,this._configuration.setReservedHeight(e?t:0),this._bannerDomNode&&this._domElement.prepend(this._bannerDomNode)}_attachModel(e){if(!e){this._modelData=null;return}const t=[];this._domElement.setAttribute("data-mode-id",e.getLanguageId()),this._configuration.setIsDominatedByLongLines(e.isDominatedByLongLines()),this._configuration.setModelLineCount(e.getLineCount());const s=e.onBeforeAttached(),o=new ViewModel$1(this._id,this._configuration,e,DOMLineBreaksComputerFactory.create(getWindow(this._domElement)),MonospaceLineBreaksComputerFactory.create(this._configuration.options),c=>scheduleAtNextAnimationFrame(getWindow(this._domElement),c),this.languageConfigurationService,this._themeService,s,{batchChanges:c=>{try{return this._beginUpdate(),c()}finally{this._endUpdate()}}});t.push(e.onWillDispose(()=>this.setModel(null))),t.push(o.onEvent(c=>{switch(c.kind){case 0:this._onDidContentSizeChange.fire(c);break;case 1:this._editorTextFocus.setValue(c.hasFocus);break;case 2:this._editorWidgetFocus.setValue(c.hasFocus);break;case 3:this._onDidScrollChange.fire(c);break;case 4:this._onDidChangeViewZones.fire();break;case 5:this._onDidChangeHiddenAreas.fire();break;case 6:this._onDidAttemptReadOnlyEdit.fire();break;case 7:{if(c.reachedMaxCursorCount){const f=this.getOption(89),p=localize(80,"The number of cursors has been limited to {0}. Consider using [find and replace](https://code.visualstudio.com/docs/editor/codebasics#_find-and-replace) for larger changes or increase the editor multi cursor limit setting.",f);this._notificationService.prompt(Severity.Warning,p,[{label:"Find and Replace",run:()=>{this._commandService.executeCommand("editor.action.startFindReplaceAction")}},{label:localize(81,"Increase Multi Cursor Limit"),run:()=>{this._commandService.executeCommand("workbench.action.openSettings2",{query:"editor.multiCursorLimit"})}}])}const d=[];for(let f=0,p=c.selections.length;f<p;f++)d[f]=c.selections[f].getPosition();const u={position:d[0],secondaryPositions:d.slice(1),reason:c.reason,source:c.source};this._onDidChangeCursorPosition.fire(u);const g={selection:c.selections[0],secondarySelections:c.selections.slice(1),modelVersionId:c.modelVersionId,oldSelections:c.oldSelections,oldModelVersionId:c.oldModelVersionId,source:c.source,reason:c.reason};this._onDidChangeCursorSelection.fire(g);break}case 8:this._onDidChangeModelDecorations.fire(c.event);break;case 9:this._domElement.setAttribute("data-mode-id",e.getLanguageId()),this._onDidChangeModelLanguage.fire(c.event);break;case 10:this._onDidChangeModelLanguageConfiguration.fire(c.event);break;case 11:this._onDidChangeModelContent.fire(c.event);break;case 12:this._onDidChangeModelOptions.fire(c.event);break;case 13:this._onDidChangeModelTokens.fire(c.event);break;case 14:this._onDidChangeLineHeight.fire(c.event);break;case 15:this._onDidChangeFont.fire(c.event);break}}));const[r,l]=this._createView(o);if(l){this._domElement.appendChild(r.domNode.domNode);let c=Object.keys(this._contentWidgets);for(let d=0,u=c.length;d<u;d++){const g=c[d];r.addContentWidget(this._contentWidgets[g])}c=Object.keys(this._overlayWidgets);for(let d=0,u=c.length;d<u;d++){const g=c[d];r.addOverlayWidget(this._overlayWidgets[g])}c=Object.keys(this._glyphMarginWidgets);for(let d=0,u=c.length;d<u;d++){const g=c[d];r.addGlyphMarginWidget(this._glyphMarginWidgets[g])}r.render(!1,!0),r.domNode.domNode.setAttribute("data-uri",e.uri.toString())}this._modelData=new ModelData$1(e,o,r,l,t,s)}_createView(e){let t;this.isSimpleWidget?t={paste:(r,l,c,d)=>{this._paste("keyboard",r,l,c,d)},type:r=>{this._type("keyboard",r)},compositionType:(r,l,c,d)=>{this._compositionType("keyboard",r,l,c,d)},startComposition:()=>{this._startComposition()},endComposition:()=>{this._endComposition("keyboard")},cut:()=>{this._cut("keyboard")}}:t={paste:(r,l,c,d)=>{const u={text:r,pasteOnNewLine:l,multicursorText:c,mode:d};this._commandService.executeCommand("paste",u)},type:r=>{const l={text:r};this._commandService.executeCommand("type",l)},compositionType:(r,l,c,d)=>{if(c||d){const u={text:r,replacePrevCharCnt:l,replaceNextCharCnt:c,positionDelta:d};this._commandService.executeCommand("compositionType",u)}else{const u={text:r,replaceCharCnt:l};this._commandService.executeCommand("replacePreviousChar",u)}},startComposition:()=>{this._commandService.executeCommand("compositionStart",{})},endComposition:()=>{this._commandService.executeCommand("compositionEnd",{})},cut:()=>{this._commandService.executeCommand("cut",{})}};const s=new ViewUserInputEvents(e.coordinatesConverter);return s.onKeyDown=r=>this._onKeyDown.fire(r),s.onKeyUp=r=>this._onKeyUp.fire(r),s.onContextMenu=r=>this._onContextMenu.fire(r),s.onMouseMove=r=>this._onMouseMove.fire(r),s.onMouseLeave=r=>this._onMouseLeave.fire(r),s.onMouseDown=r=>this._onMouseDown.fire(r),s.onMouseUp=r=>this._onMouseUp.fire(r),s.onMouseDrag=r=>this._onMouseDrag.fire(r),s.onMouseDrop=r=>this._onMouseDrop.fire(r),s.onMouseDropCanceled=r=>this._onMouseDropCanceled.fire(r),s.onMouseWheel=r=>this._onMouseWheel.fire(r),[new View$1(this._domElement,this.getId(),t,this._configuration,this._themeService.getColorTheme(),e,s,this._overflowWidgetsDomNode,this._instantiationService),!0]}_postDetachModelCleanup(e){e==null||e.removeAllDecorationsWithOwnerId(this._id)}_detachModel(){var s;if((s=this._contributionsDisposable)==null||s.dispose(),this._contributionsDisposable=void 0,!this._modelData)return null;const e=this._modelData.model,t=this._modelData.hasRealView?this._modelData.view.domNode.domNode:null;return this._modelData.dispose(),this._modelData=null,this._domElement.removeAttribute("data-mode-id"),t&&this._domElement.contains(t)&&t.remove(),this._bannerDomNode&&this._domElement.contains(this._bannerDomNode)&&this._bannerDomNode.remove(),e}_removeDecorationType(e){this._codeEditorService.removeDecorationType(e)}hasModel(){return this._modelData!==null}showDropIndicatorAt(e){const t=[{range:new Range$2(e.lineNumber,e.column,e.lineNumber,e.column),options:CodeEditorWidget_1.dropIntoEditorDecorationOptions}];this._dropIntoEditorDecorations.set(t),this.revealPosition(e,1)}removeDropIndicator(){this._dropIntoEditorDecorations.clear()}_beginUpdate(){this._updateCounter++,this._updateCounter===1&&this._onBeginUpdate.fire()}_endUpdate(){this._updateCounter--,this._updateCounter===0&&this._onEndUpdate.fire()}},CodeEditorWidget_1=fi,fi.dropIntoEditorDecorationOptions=ModelDecorationOptions.register({description:"workbench-dnd-target",className:"dnd-target"}),fi);CodeEditorWidget=CodeEditorWidget_1=__decorate$2A([__param$2v(3,IInstantiationService),__param$2v(4,ICodeEditorService),__param$2v(5,ICommandService),__param$2v(6,IContextKeyService),__param$2v(7,IThemeService),__param$2v(8,INotificationService),__param$2v(9,IAccessibilityService),__param$2v(10,ILanguageConfigurationService),__param$2v(11,ILanguageFeaturesService)],CodeEditorWidget);let EDITOR_ID=0,ModelData$1=class{constructor(e,t,s,o,r,l){this.model=e,this.viewModel=t,this.view=s,this.hasRealView=o,this.listenersToRemove=r,this.attachedView=l}dispose(){dispose(this.listenersToRemove),this.model.onBeforeDetached(this.attachedView),this.hasRealView&&this.view.dispose(),this.viewModel.dispose()}};class BooleanEventEmitter extends Disposable{constructor(e){super(),this._emitterOptions=e,this._onDidChangeToTrue=this._register(new Emitter$1(this._emitterOptions)),this.onDidChangeToTrue=this._onDidChangeToTrue.event,this._onDidChangeToFalse=this._register(new Emitter$1(this._emitterOptions)),this.onDidChangeToFalse=this._onDidChangeToFalse.event,this._value=0}setValue(e){const t=e?2:1;this._value!==t&&(this._value=t,this._value===2?this._onDidChangeToTrue.fire():this._value===1&&this._onDidChangeToFalse.fire())}}class InteractionEmitter extends Emitter$1{constructor(e,t){super({deliveryQueue:t}),this._contributions=e}fire(e){this._contributions.onBeforeInteractionEvent(),super.fire(e)}}class EditorContextKeysManager extends Disposable{constructor(e,t){super(),this._editor=e,t.createKey("editorId",e.getId()),this._editorSimpleInput=EditorContextKeys.editorSimpleInput.bindTo(t),this._editorFocus=EditorContextKeys.focus.bindTo(t),this._textInputFocus=EditorContextKeys.textInputFocus.bindTo(t),this._editorTextFocus=EditorContextKeys.editorTextFocus.bindTo(t),this._tabMovesFocus=EditorContextKeys.tabMovesFocus.bindTo(t),this._editorReadonly=EditorContextKeys.readOnly.bindTo(t),this._inDiffEditor=EditorContextKeys.inDiffEditor.bindTo(t),this._editorColumnSelection=EditorContextKeys.columnSelection.bindTo(t),this._hasMultipleSelections=EditorContextKeys.hasMultipleSelections.bindTo(t),this._hasNonEmptySelection=EditorContextKeys.hasNonEmptySelection.bindTo(t),this._canUndo=EditorContextKeys.canUndo.bindTo(t),this._canRedo=EditorContextKeys.canRedo.bindTo(t),this._register(this._editor.onDidChangeConfiguration(()=>this._updateFromConfig())),this._register(this._editor.onDidChangeCursorSelection(()=>this._updateFromSelection())),this._register(this._editor.onDidFocusEditorWidget(()=>this._updateFromFocus())),this._register(this._editor.onDidBlurEditorWidget(()=>this._updateFromFocus())),this._register(this._editor.onDidFocusEditorText(()=>this._updateFromFocus())),this._register(this._editor.onDidBlurEditorText(()=>this._updateFromFocus())),this._register(this._editor.onDidChangeModel(()=>this._updateFromModel())),this._register(this._editor.onDidChangeConfiguration(()=>this._updateFromModel())),this._register(TabFocus.onDidChangeTabFocus(s=>this._tabMovesFocus.set(s))),this._updateFromConfig(),this._updateFromSelection(),this._updateFromFocus(),this._updateFromModel(),this._editorSimpleInput.set(this._editor.isSimpleWidget)}_updateFromConfig(){const e=this._editor.getOptions();this._tabMovesFocus.set(e.get(164)||TabFocus.getTabFocusMode()),this._editorReadonly.set(e.get(104)),this._inDiffEditor.set(e.get(70)),this._editorColumnSelection.set(e.get(28))}_updateFromSelection(){const e=this._editor.getSelections();e?(this._hasMultipleSelections.set(e.length>1),this._hasNonEmptySelection.set(e.some(t=>!t.isEmpty()))):(this._hasMultipleSelections.reset(),this._hasNonEmptySelection.reset())}_updateFromFocus(){this._editorFocus.set(this._editor.hasWidgetFocus()&&!this._editor.isSimpleWidget),this._editorTextFocus.set(this._editor.hasTextFocus()&&!this._editor.isSimpleWidget),this._textInputFocus.set(this._editor.hasTextFocus())}_updateFromModel(){const e=this._editor.getModel();this._canUndo.set(!!(e&&e.canUndo())),this._canRedo.set(!!(e&&e.canRedo()))}}class EditorModeContext extends Disposable{constructor(e,t,s){super(),this._editor=e,this._contextKeyService=t,this._languageFeaturesService=s,this._langId=EditorContextKeys.languageId.bindTo(t),this._hasCompletionItemProvider=EditorContextKeys.hasCompletionItemProvider.bindTo(t),this._hasCodeActionsProvider=EditorContextKeys.hasCodeActionsProvider.bindTo(t),this._hasCodeLensProvider=EditorContextKeys.hasCodeLensProvider.bindTo(t),this._hasDefinitionProvider=EditorContextKeys.hasDefinitionProvider.bindTo(t),this._hasDeclarationProvider=EditorContextKeys.hasDeclarationProvider.bindTo(t),this._hasImplementationProvider=EditorContextKeys.hasImplementationProvider.bindTo(t),this._hasTypeDefinitionProvider=EditorContextKeys.hasTypeDefinitionProvider.bindTo(t),this._hasHoverProvider=EditorContextKeys.hasHoverProvider.bindTo(t),this._hasDocumentHighlightProvider=EditorContextKeys.hasDocumentHighlightProvider.bindTo(t),this._hasDocumentSymbolProvider=EditorContextKeys.hasDocumentSymbolProvider.bindTo(t),this._hasReferenceProvider=EditorContextKeys.hasReferenceProvider.bindTo(t),this._hasRenameProvider=EditorContextKeys.hasRenameProvider.bindTo(t),this._hasSignatureHelpProvider=EditorContextKeys.hasSignatureHelpProvider.bindTo(t),this._hasInlayHintsProvider=EditorContextKeys.hasInlayHintsProvider.bindTo(t),this._hasDocumentFormattingProvider=EditorContextKeys.hasDocumentFormattingProvider.bindTo(t),this._hasDocumentSelectionFormattingProvider=EditorContextKeys.hasDocumentSelectionFormattingProvider.bindTo(t),this._hasMultipleDocumentFormattingProvider=EditorContextKeys.hasMultipleDocumentFormattingProvider.bindTo(t),this._hasMultipleDocumentSelectionFormattingProvider=EditorContextKeys.hasMultipleDocumentSelectionFormattingProvider.bindTo(t),this._isInEmbeddedEditor=EditorContextKeys.isInEmbeddedEditor.bindTo(t);const o=()=>this._update();this._register(e.onDidChangeModel(o)),this._register(e.onDidChangeModelLanguage(o)),this._register(s.completionProvider.onDidChange(o)),this._register(s.codeActionProvider.onDidChange(o)),this._register(s.codeLensProvider.onDidChange(o)),this._register(s.definitionProvider.onDidChange(o)),this._register(s.declarationProvider.onDidChange(o)),this._register(s.implementationProvider.onDidChange(o)),this._register(s.typeDefinitionProvider.onDidChange(o)),this._register(s.hoverProvider.onDidChange(o)),this._register(s.documentHighlightProvider.onDidChange(o)),this._register(s.documentSymbolProvider.onDidChange(o)),this._register(s.referenceProvider.onDidChange(o)),this._register(s.renameProvider.onDidChange(o)),this._register(s.documentFormattingEditProvider.onDidChange(o)),this._register(s.documentRangeFormattingEditProvider.onDidChange(o)),this._register(s.signatureHelpProvider.onDidChange(o)),this._register(s.inlayHintsProvider.onDidChange(o)),o()}dispose(){super.dispose()}reset(){this._contextKeyService.bufferChangeEvents(()=>{this._langId.reset(),this._hasCompletionItemProvider.reset(),this._hasCodeActionsProvider.reset(),this._hasCodeLensProvider.reset(),this._hasDefinitionProvider.reset(),this._hasDeclarationProvider.reset(),this._hasImplementationProvider.reset(),this._hasTypeDefinitionProvider.reset(),this._hasHoverProvider.reset(),this._hasDocumentHighlightProvider.reset(),this._hasDocumentSymbolProvider.reset(),this._hasReferenceProvider.reset(),this._hasRenameProvider.reset(),this._hasDocumentFormattingProvider.reset(),this._hasDocumentSelectionFormattingProvider.reset(),this._hasSignatureHelpProvider.reset(),this._isInEmbeddedEditor.reset()})}_update(){const e=this._editor.getModel();if(!e){this.reset();return}this._contextKeyService.bufferChangeEvents(()=>{this._langId.set(e.getLanguageId()),this._hasCompletionItemProvider.set(this._languageFeaturesService.completionProvider.has(e)),this._hasCodeActionsProvider.set(this._languageFeaturesService.codeActionProvider.has(e)),this._hasCodeLensProvider.set(this._languageFeaturesService.codeLensProvider.has(e)),this._hasDefinitionProvider.set(this._languageFeaturesService.definitionProvider.has(e)),this._hasDeclarationProvider.set(this._languageFeaturesService.declarationProvider.has(e)),this._hasImplementationProvider.set(this._languageFeaturesService.implementationProvider.has(e)),this._hasTypeDefinitionProvider.set(this._languageFeaturesService.typeDefinitionProvider.has(e)),this._hasHoverProvider.set(this._languageFeaturesService.hoverProvider.has(e)),this._hasDocumentHighlightProvider.set(this._languageFeaturesService.documentHighlightProvider.has(e)),this._hasDocumentSymbolProvider.set(this._languageFeaturesService.documentSymbolProvider.has(e)),this._hasReferenceProvider.set(this._languageFeaturesService.referenceProvider.has(e)),this._hasRenameProvider.set(this._languageFeaturesService.renameProvider.has(e)),this._hasSignatureHelpProvider.set(this._languageFeaturesService.signatureHelpProvider.has(e)),this._hasInlayHintsProvider.set(this._languageFeaturesService.inlayHintsProvider.has(e)),this._hasDocumentFormattingProvider.set(this._languageFeaturesService.documentFormattingEditProvider.has(e)||this._languageFeaturesService.documentRangeFormattingEditProvider.has(e)),this._hasDocumentSelectionFormattingProvider.set(this._languageFeaturesService.documentRangeFormattingEditProvider.has(e)),this._hasMultipleDocumentFormattingProvider.set(this._languageFeaturesService.documentFormattingEditProvider.all(e).length+this._languageFeaturesService.documentRangeFormattingEditProvider.all(e).length>1),this._hasMultipleDocumentSelectionFormattingProvider.set(this._languageFeaturesService.documentRangeFormattingEditProvider.all(e).length>1),this._isInEmbeddedEditor.set(e.uri.scheme===Schemas.walkThroughSnippet||e.uri.scheme===Schemas.vscodeChatCodeBlock)})}}class EditorDecorationsCollection{get length(){return this._decorationIds.length}constructor(e,t){this._editor=e,this._decorationIds=[],this._isChangingDecorations=!1,Array.isArray(t)&&t.length>0&&this.set(t)}onDidChange(e,t,s){return this._editor.onDidChangeModelDecorations(o=>{this._isChangingDecorations||e.call(t,o)},s)}getRange(e){return!this._editor.hasModel()||e>=this._decorationIds.length?null:this._editor.getModel().getDecorationRange(this._decorationIds[e])}getRanges(){if(!this._editor.hasModel())return[];const e=this._editor.getModel(),t=[];for(const s of this._decorationIds){const o=e.getDecorationRange(s);o&&t.push(o)}return t}has(e){return this._decorationIds.includes(e.id)}clear(){this._decorationIds.length!==0&&this.set([])}set(e){try{this._isChangingDecorations=!0,this._editor.changeDecorations(t=>{this._decorationIds=t.deltaDecorations(this._decorationIds,e)})}finally{this._isChangingDecorations=!1}return this._decorationIds}append(e){let t=[];try{this._isChangingDecorations=!0,this._editor.changeDecorations(s=>{t=s.deltaDecorations([],e),this._decorationIds=this._decorationIds.concat(t)})}finally{this._isChangingDecorations=!1}return t}}const squigglyStart=encodeURIComponent("<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 6 3' enable-background='new 0 0 6 3' height='3' width='6'><g fill='"),squigglyEnd=encodeURIComponent("'><polygon points='5.5,0 2.5,3 1.1,3 4.1,0'/><polygon points='4,0 6,2 6,0.6 5.4,0'/><polygon points='0,2 1,3 2.4,3 0,0.6'/></g></svg>");function getSquigglySVGData(a){return squigglyStart+encodeURIComponent(a.toString())+squigglyEnd}const dotdotdotStart=encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" height="3" width="12"><g fill="'),dotdotdotEnd=encodeURIComponent('"><circle cx="1" cy="1" r="1"/><circle cx="5" cy="1" r="1"/><circle cx="9" cy="1" r="1"/></g></svg>');function getDotDotDotSVGData(a){return dotdotdotStart+encodeURIComponent(a.toString())+dotdotdotEnd}registerThemingParticipant((a,e)=>{const t=a.getColor(editorErrorForeground);t&&(e.addRule(`.monaco-editor .squiggly-error { background: url("data:image/svg+xml,${getSquigglySVGData(t)}") repeat-x bottom left; }`),e.addRule(`:root { --monaco-editor-error-decoration: url("data:image/svg+xml,${getSquigglySVGData(t)}"); }`));const s=a.getColor(editorWarningForeground);s&&(e.addRule(`.monaco-editor .squiggly-warning { background: url("data:image/svg+xml,${getSquigglySVGData(s)}") repeat-x bottom left; }`),e.addRule(`:root { --monaco-editor-warning-decoration: url("data:image/svg+xml,${getSquigglySVGData(s)}"); }`));const o=a.getColor(editorInfoForeground);o&&(e.addRule(`.monaco-editor .squiggly-info { background: url("data:image/svg+xml,${getSquigglySVGData(o)}") repeat-x bottom left; }`),e.addRule(`:root { --monaco-editor-info-decoration: url("data:image/svg+xml,${getSquigglySVGData(o)}"); }`));const r=a.getColor(editorHintForeground);r&&(e.addRule(`.monaco-editor .squiggly-hint { background: url("data:image/svg+xml,${getDotDotDotSVGData(r)}") no-repeat bottom left; }`),e.addRule(`:root { --monaco-editor-hint-decoration: url("data:image/svg+xml,${getDotDotDotSVGData(r)}"); }`));const l=a.getColor(editorUnnecessaryCodeOpacity);l&&(e.addRule(`.monaco-editor.showUnused .squiggly-inline-unnecessary { opacity: ${l.rgba.a}; }`),e.addRule(`:root { --monaco-editor-unnecessary-decoration-opacity: ${l.rgba.a}; }`))});function readHotReloadableExport(a,e){return a}function createHotClass(a){return constObservable(a)}const IAccessibilitySignalService=createDecorator("accessibilitySignalService"),q=class q{static register(e){return new q(e.fileName)}constructor(e){this.fileName=e}};q.error=q.register({fileName:"error.mp3"}),q.warning=q.register({fileName:"warning.mp3"}),q.success=q.register({fileName:"success.mp3"}),q.foldedArea=q.register({fileName:"foldedAreas.mp3"}),q.break=q.register({fileName:"break.mp3"}),q.quickFixes=q.register({fileName:"quickFixes.mp3"}),q.taskCompleted=q.register({fileName:"taskCompleted.mp3"}),q.taskFailed=q.register({fileName:"taskFailed.mp3"}),q.terminalBell=q.register({fileName:"terminalBell.mp3"}),q.diffLineInserted=q.register({fileName:"diffLineInserted.mp3"}),q.diffLineDeleted=q.register({fileName:"diffLineDeleted.mp3"}),q.diffLineModified=q.register({fileName:"diffLineModified.mp3"}),q.requestSent=q.register({fileName:"requestSent.mp3"}),q.responseReceived1=q.register({fileName:"responseReceived1.mp3"}),q.responseReceived2=q.register({fileName:"responseReceived2.mp3"}),q.responseReceived3=q.register({fileName:"responseReceived3.mp3"}),q.responseReceived4=q.register({fileName:"responseReceived4.mp3"}),q.clear=q.register({fileName:"clear.mp3"}),q.save=q.register({fileName:"save.mp3"}),q.format=q.register({fileName:"format.mp3"}),q.voiceRecordingStarted=q.register({fileName:"voiceRecordingStarted.mp3"}),q.voiceRecordingStopped=q.register({fileName:"voiceRecordingStopped.mp3"}),q.progress=q.register({fileName:"progress.mp3"}),q.chatEditModifiedFile=q.register({fileName:"chatEditModifiedFile.mp3"}),q.editsKept=q.register({fileName:"editsKept.mp3"}),q.editsUndone=q.register({fileName:"editsUndone.mp3"}),q.nextEditSuggestion=q.register({fileName:"nextEditSuggestion.mp3"}),q.terminalCommandSucceeded=q.register({fileName:"terminalCommandSucceeded.mp3"}),q.chatUserActionRequired=q.register({fileName:"chatUserActionRequired.mp3"}),q.codeActionTriggered=q.register({fileName:"codeActionTriggered.mp3"}),q.codeActionApplied=q.register({fileName:"codeActionApplied.mp3"});let Sound=q;class SoundSource{constructor(e){this.randomOneOf=e}}const j=class j{constructor(e,t,s,o,r,l,c=!1){this.sound=e,this.name=t,this.legacySoundSettingsKey=s,this.settingsKey=o,this.legacyAnnouncementSettingsKey=r,this.announcementMessage=l,this.managesOwnEnablement=c}static register(e){const t=new SoundSource("randomOneOf"in e.sound?e.sound.randomOneOf:[e.sound]),s=new j(t,e.name,e.legacySoundSettingsKey,e.settingsKey,e.legacyAnnouncementSettingsKey,e.announcementMessage,e.managesOwnEnablement);return j._signals.add(s),s}};j._signals=new Set,j.errorAtPosition=j.register({name:localize(1561,"Error at Position"),sound:Sound.error,announcementMessage:localize(1562,"Error"),settingsKey:"accessibility.signals.positionHasError",delaySettingsKey:"accessibility.signalOptions.delays.errorAtPosition"}),j.warningAtPosition=j.register({name:localize(1563,"Warning at Position"),sound:Sound.warning,announcementMessage:localize(1564,"Warning"),settingsKey:"accessibility.signals.positionHasWarning",delaySettingsKey:"accessibility.signalOptions.delays.warningAtPosition"}),j.errorOnLine=j.register({name:localize(1565,"Error on Line"),sound:Sound.error,legacySoundSettingsKey:"audioCues.lineHasError",legacyAnnouncementSettingsKey:"accessibility.alert.error",announcementMessage:localize(1566,"Error on Line"),settingsKey:"accessibility.signals.lineHasError"}),j.warningOnLine=j.register({name:localize(1567,"Warning on Line"),sound:Sound.warning,legacySoundSettingsKey:"audioCues.lineHasWarning",legacyAnnouncementSettingsKey:"accessibility.alert.warning",announcementMessage:localize(1568,"Warning on Line"),settingsKey:"accessibility.signals.lineHasWarning"}),j.foldedArea=j.register({name:localize(1569,"Folded Area on Line"),sound:Sound.foldedArea,legacySoundSettingsKey:"audioCues.lineHasFoldedArea",legacyAnnouncementSettingsKey:"accessibility.alert.foldedArea",announcementMessage:localize(1570,"Folded"),settingsKey:"accessibility.signals.lineHasFoldedArea"}),j.break=j.register({name:localize(1571,"Breakpoint on Line"),sound:Sound.break,legacySoundSettingsKey:"audioCues.lineHasBreakpoint",legacyAnnouncementSettingsKey:"accessibility.alert.breakpoint",announcementMessage:localize(1572,"Breakpoint"),settingsKey:"accessibility.signals.lineHasBreakpoint"}),j.inlineSuggestion=j.register({name:localize(1573,"Inline Suggestion on Line"),sound:Sound.quickFixes,legacySoundSettingsKey:"audioCues.lineHasInlineSuggestion",settingsKey:"accessibility.signals.lineHasInlineSuggestion"}),j.nextEditSuggestion=j.register({name:localize(1574,"Next Edit Suggestion on Line"),sound:Sound.nextEditSuggestion,legacySoundSettingsKey:"audioCues.nextEditSuggestion",settingsKey:"accessibility.signals.nextEditSuggestion",announcementMessage:localize(1575,"Next Edit Suggestion")}),j.terminalQuickFix=j.register({name:localize(1576,"Terminal Quick Fix"),sound:Sound.quickFixes,legacySoundSettingsKey:"audioCues.terminalQuickFix",legacyAnnouncementSettingsKey:"accessibility.alert.terminalQuickFix",announcementMessage:localize(1577,"Quick Fix"),settingsKey:"accessibility.signals.terminalQuickFix"}),j.onDebugBreak=j.register({name:localize(1578,"Debugger Stopped on Breakpoint"),sound:Sound.break,legacySoundSettingsKey:"audioCues.onDebugBreak",legacyAnnouncementSettingsKey:"accessibility.alert.onDebugBreak",announcementMessage:localize(1579,"Breakpoint"),settingsKey:"accessibility.signals.onDebugBreak"}),j.noInlayHints=j.register({name:localize(1580,"No Inlay Hints on Line"),sound:Sound.error,legacySoundSettingsKey:"audioCues.noInlayHints",legacyAnnouncementSettingsKey:"accessibility.alert.noInlayHints",announcementMessage:localize(1581,"No Inlay Hints"),settingsKey:"accessibility.signals.noInlayHints"}),j.taskCompleted=j.register({name:localize(1582,"Task Completed"),sound:Sound.taskCompleted,legacySoundSettingsKey:"audioCues.taskCompleted",legacyAnnouncementSettingsKey:"accessibility.alert.taskCompleted",announcementMessage:localize(1583,"Task Completed"),settingsKey:"accessibility.signals.taskCompleted"}),j.taskFailed=j.register({name:localize(1584,"Task Failed"),sound:Sound.taskFailed,legacySoundSettingsKey:"audioCues.taskFailed",legacyAnnouncementSettingsKey:"accessibility.alert.taskFailed",announcementMessage:localize(1585,"Task Failed"),settingsKey:"accessibility.signals.taskFailed"}),j.terminalCommandFailed=j.register({name:localize(1586,"Terminal Command Failed"),sound:Sound.error,legacySoundSettingsKey:"audioCues.terminalCommandFailed",legacyAnnouncementSettingsKey:"accessibility.alert.terminalCommandFailed",announcementMessage:localize(1587,"Command Failed"),settingsKey:"accessibility.signals.terminalCommandFailed"}),j.terminalCommandSucceeded=j.register({name:localize(1588,"Terminal Command Succeeded"),sound:Sound.terminalCommandSucceeded,announcementMessage:localize(1589,"Command Succeeded"),settingsKey:"accessibility.signals.terminalCommandSucceeded"}),j.terminalBell=j.register({name:localize(1590,"Terminal Bell"),sound:Sound.terminalBell,legacySoundSettingsKey:"audioCues.terminalBell",legacyAnnouncementSettingsKey:"accessibility.alert.terminalBell",announcementMessage:localize(1591,"Terminal Bell"),settingsKey:"accessibility.signals.terminalBell"}),j.notebookCellCompleted=j.register({name:localize(1592,"Notebook Cell Completed"),sound:Sound.taskCompleted,legacySoundSettingsKey:"audioCues.notebookCellCompleted",legacyAnnouncementSettingsKey:"accessibility.alert.notebookCellCompleted",announcementMessage:localize(1593,"Notebook Cell Completed"),settingsKey:"accessibility.signals.notebookCellCompleted"}),j.notebookCellFailed=j.register({name:localize(1594,"Notebook Cell Failed"),sound:Sound.taskFailed,legacySoundSettingsKey:"audioCues.notebookCellFailed",legacyAnnouncementSettingsKey:"accessibility.alert.notebookCellFailed",announcementMessage:localize(1595,"Notebook Cell Failed"),settingsKey:"accessibility.signals.notebookCellFailed"}),j.diffLineInserted=j.register({name:localize(1596,"Diff Line Inserted"),sound:Sound.diffLineInserted,legacySoundSettingsKey:"audioCues.diffLineInserted",settingsKey:"accessibility.signals.diffLineInserted"}),j.diffLineDeleted=j.register({name:localize(1597,"Diff Line Deleted"),sound:Sound.diffLineDeleted,legacySoundSettingsKey:"audioCues.diffLineDeleted",settingsKey:"accessibility.signals.diffLineDeleted"}),j.diffLineModified=j.register({name:localize(1598,"Diff Line Modified"),sound:Sound.diffLineModified,legacySoundSettingsKey:"audioCues.diffLineModified",settingsKey:"accessibility.signals.diffLineModified"}),j.chatEditModifiedFile=j.register({name:localize(1599,"Chat Edit Modified File"),sound:Sound.chatEditModifiedFile,announcementMessage:localize(1600,"File Modified from Chat Edits"),settingsKey:"accessibility.signals.chatEditModifiedFile"}),j.chatRequestSent=j.register({name:localize(1601,"Chat Request Sent"),sound:Sound.requestSent,legacySoundSettingsKey:"audioCues.chatRequestSent",legacyAnnouncementSettingsKey:"accessibility.alert.chatRequestSent",announcementMessage:localize(1602,"Chat Request Sent"),settingsKey:"accessibility.signals.chatRequestSent"}),j.chatResponseReceived=j.register({name:localize(1603,"Chat Response Received"),legacySoundSettingsKey:"audioCues.chatResponseReceived",sound:{randomOneOf:[Sound.responseReceived1,Sound.responseReceived2,Sound.responseReceived3,Sound.responseReceived4]},settingsKey:"accessibility.signals.chatResponseReceived"}),j.codeActionTriggered=j.register({name:localize(1604,"Code Action Request Triggered"),sound:Sound.codeActionTriggered,legacySoundSettingsKey:"audioCues.codeActionRequestTriggered",legacyAnnouncementSettingsKey:"accessibility.alert.codeActionRequestTriggered",announcementMessage:localize(1605,"Code Action Request Triggered"),settingsKey:"accessibility.signals.codeActionTriggered"}),j.codeActionApplied=j.register({name:localize(1606,"Code Action Applied"),legacySoundSettingsKey:"audioCues.codeActionApplied",sound:Sound.codeActionApplied,settingsKey:"accessibility.signals.codeActionApplied"}),j.progress=j.register({name:localize(1607,"Progress"),sound:Sound.progress,legacySoundSettingsKey:"audioCues.chatResponsePending",legacyAnnouncementSettingsKey:"accessibility.alert.progress",announcementMessage:localize(1608,"Progress"),settingsKey:"accessibility.signals.progress"}),j.clear=j.register({name:localize(1609,"Clear"),sound:Sound.clear,legacySoundSettingsKey:"audioCues.clear",legacyAnnouncementSettingsKey:"accessibility.alert.clear",announcementMessage:localize(1610,"Clear"),settingsKey:"accessibility.signals.clear"}),j.save=j.register({name:localize(1611,"Save"),sound:Sound.save,legacySoundSettingsKey:"audioCues.save",legacyAnnouncementSettingsKey:"accessibility.alert.save",announcementMessage:localize(1612,"Save"),settingsKey:"accessibility.signals.save"}),j.format=j.register({name:localize(1613,"Format"),sound:Sound.format,legacySoundSettingsKey:"audioCues.format",legacyAnnouncementSettingsKey:"accessibility.alert.format",announcementMessage:localize(1614,"Format"),settingsKey:"accessibility.signals.format"}),j.voiceRecordingStarted=j.register({name:localize(1615,"Voice Recording Started"),sound:Sound.voiceRecordingStarted,legacySoundSettingsKey:"audioCues.voiceRecordingStarted",settingsKey:"accessibility.signals.voiceRecordingStarted"}),j.voiceRecordingStopped=j.register({name:localize(1616,"Voice Recording Stopped"),sound:Sound.voiceRecordingStopped,legacySoundSettingsKey:"audioCues.voiceRecordingStopped",settingsKey:"accessibility.signals.voiceRecordingStopped"}),j.editsKept=j.register({name:localize(1617,"Edits Kept"),sound:Sound.editsKept,announcementMessage:localize(1618,"Edits Kept"),settingsKey:"accessibility.signals.editsKept"}),j.editsUndone=j.register({name:localize(1619,"Undo Edits"),sound:Sound.editsUndone,announcementMessage:localize(1620,"Edits Undone"),settingsKey:"accessibility.signals.editsUndone"}),j.chatUserActionRequired=j.register({name:localize(1621,"Chat User Action Required"),sound:Sound.chatUserActionRequired,announcementMessage:localize(1622,"Chat User Action Required"),settingsKey:"accessibility.signals.chatUserActionRequired",managesOwnEnablement:!0});let AccessibilitySignal=j;function observableConfigValue(a,e,t,s=DebugLocation.ofCaller()){return observableFromEventOpts({debugName:()=>`Configuration Key "${a}"`},o=>t.onDidChangeConfiguration(r=>{r.affectsConfiguration(a)&&o(r)}),()=>t.getValue(a)??e,s)}function bindContextKey(a,e,t,s=DebugLocation.ofCaller()){const o=a.bindTo(e),r=new DisposableStore;return derivedOpts({debugName:()=>`Set Context Key "${a.key}"`},l=>{const c=t(l);return o.set(c),c},s).recomputeInitiallyAndOnChange(r),r}const IProgressService=createDecorator("progressService"),Uo=class Uo{constructor(e){this.callback=e}report(e){this._value=e,this.callback(this._value)}};Uo.None=Object.freeze({report(){}});let Progress=Uo;const IEditorProgressService=createDecorator("editorProgressService");class StableEditorScrollState{static capture(e){if(e.getScrollTop()===0||e.hasPendingScrollAnimation())return new StableEditorScrollState(e.getScrollTop(),e.getContentHeight(),null,0,null);let t=null,s=0;const o=e.getVisibleRanges();if(o.length>0){t=o[0].getStartPosition();const r=e.getTopForPosition(t.lineNumber,t.column);s=e.getScrollTop()-r}return new StableEditorScrollState(e.getScrollTop(),e.getContentHeight(),t,s,e.getPosition())}constructor(e,t,s,o,r){this._initialScrollTop=e,this._initialContentHeight=t,this._visiblePosition=s,this._visiblePositionScrollDelta=o,this._cursorPosition=r}restore(e){if(!(this._initialContentHeight===e.getContentHeight()&&this._initialScrollTop===e.getScrollTop())&&this._visiblePosition){const t=e.getTopForPosition(this._visiblePosition.lineNumber,this._visiblePosition.column);e.setScrollTop(t+this._visiblePositionScrollDelta)}}restoreRelativeVerticalPositionOfCursor(e){if(this._initialContentHeight===e.getContentHeight()&&this._initialScrollTop===e.getScrollTop())return;const t=e.getPosition();if(!this._cursorPosition||!t)return;const s=e.getTopForLineNumber(t.lineNumber)-e.getTopForLineNumber(this._cursorPosition.lineNumber);e.setScrollTop(e.getScrollTop()+s,1)}}const DataTransfers={RESOURCES:"ResourceURLs",DOWNLOAD_URL:"DownloadURL",FILES:"Files",TEXT:Mimes.text,INTERNAL_URI_LIST:"application/vnd.code.uri-list"},nullHoverDelegateFactory=()=>({get delay(){return-1},dispose:()=>{},showHover:()=>{}});let hoverDelegateFactory=nullHoverDelegateFactory;const defaultHoverDelegateMouse=new Lazy(()=>hoverDelegateFactory("mouse",!1)),defaultHoverDelegateElement=new Lazy(()=>hoverDelegateFactory("element",!1));function setHoverDelegateFactory(a){hoverDelegateFactory=a}function getDefaultHoverDelegate(a){return a==="element"?defaultHoverDelegateElement.value:defaultHoverDelegateMouse.value}function createInstantHoverDelegate(){return hoverDelegateFactory("element",!0)}const selectBox="";function asFragment(a){return a}function asCssValueWithDefault(a,e){if(a!==void 0){const t=a.match(/^\s*var\((.+)\)$/);if(t){const s=t[1].split(",",2);return s.length===2&&(e=asCssValueWithDefault(s[1].trim(),e)),`var(${s[0]}, ${e})`}return a}return e}function identValue(a){const e=a.replaceAll(/[^_\-a-z0-9]/gi,"");return e!==a&&console.warn(`CSS ident value ${a} modified to ${e} to be safe for CSS`),e}function stringValue(a){return`'${a.replaceAll(/'/g,"\\000027")}'`}function asCSSUrl(a){return a?inline$1`url('${CSS.escape(FileAccess.uriToBrowserUri(a).toString(!0))}')`:"url('')"}function className(a,e=!1){const t=CSS.escape(a);return!e&&t!==a&&console.warn(`CSS class name ${a} modified to ${t} to be safe for CSS`),t}function inline$1(a,...e){return a.reduce((t,s,o)=>{const r=e[o]||"";return t+s+r},"")}class Builder{constructor(){this._parts=[]}push(...e){this._parts.push(...e)}join(e=`
`){return this._parts.join(e)}}function or(...a){return function(e,t){for(let s=0,o=a.length;s<o;s++){const r=a[s](e,t);if(r)return r}return null}}_matchesPrefix.bind(void 0,!1);const matchesPrefix=_matchesPrefix.bind(void 0,!0);function _matchesPrefix(a,e,t){if(!t||t.length<e.length)return null;let s;return a?s=startsWithIgnoreCase(t,e):s=t.indexOf(e)===0,s?e.length>0?[{start:0,end:e.length}]:[]:null}function matchesContiguousSubString(a,e){const t=e.toLowerCase().indexOf(a.toLowerCase());return t===-1?null:[{start:t,end:t+a.length}]}function matchesSubString(a,e){return _matchesSubString(a.toLowerCase(),e.toLowerCase(),0,0)}function _matchesSubString(a,e,t,s){if(t===a.length)return[];if(s===e.length)return null;if(a[t]===e[s]){let o=null;return(o=_matchesSubString(a,e,t+1,s+1))?join({start:s,end:s+1},o):null}return _matchesSubString(a,e,t,s+1)}function isLower(a){return 97<=a&&a<=122}function isUpper(a){return 65<=a&&a<=90}function isNumber(a){return 48<=a&&a<=57}function isWhitespace(a){return a===32||a===9||a===10||a===13}const wordSeparators=new Set;"()[]{}<>`'\"-/;:,.?!".split("").forEach(a=>wordSeparators.add(a.charCodeAt(0)));function isAlphanumeric(a){return isLower(a)||isUpper(a)||isNumber(a)}function join(a,e){return e.length===0?e=[a]:a.end===e[0].start?e[0].start=a.start:e.unshift(a),e}function nextAnchor(a,e){for(let t=e;t<a.length;t++){const s=a.charCodeAt(t);if(isUpper(s)||isNumber(s)||t>0&&!isAlphanumeric(a.charCodeAt(t-1)))return t}return a.length}function _matchesCamelCase(a,e,t,s){if(t===a.length)return[];if(s===e.length)return null;if(a[t]!==e[s].toLowerCase())return null;{let o=null,r=s+1;for(o=_matchesCamelCase(a,e,t+1,s+1);!o&&(r=nextAnchor(e,r))<e.length;)o=_matchesCamelCase(a,e,t+1,r),r++;return o===null?null:join({start:s,end:s+1},o)}}function analyzeCamelCaseWord(a){let e=0,t=0,s=0,o=0,r=0;for(let g=0;g<a.length;g++)r=a.charCodeAt(g),isUpper(r)&&e++,isLower(r)&&t++,isAlphanumeric(r)&&s++,isNumber(r)&&o++;const l=e/a.length,c=t/a.length,d=s/a.length,u=o/a.length;return{upperPercent:l,lowerPercent:c,alphaPercent:d,numericPercent:u}}function isUpperCaseWord(a){const{upperPercent:e,lowerPercent:t}=a;return t===0&&e>.6}function isCamelCaseWord(a){const{upperPercent:e,lowerPercent:t,alphaPercent:s,numericPercent:o}=a;return t>.2&&e<.8&&s>.6&&o<.2}function isCamelCasePattern(a){let e=0,t=0,s=0,o=0;for(let r=0;r<a.length;r++)s=a.charCodeAt(r),isUpper(s)&&e++,isLower(s)&&t++,isWhitespace(s)&&o++;return(e===0||t===0)&&o===0?a.length<=30:e<=5}function matchesCamelCase(a,e){if(!e||(e=e.trim(),e.length===0)||!isCamelCasePattern(a))return null;e.length>60&&(e=e.substring(0,60));const t=analyzeCamelCaseWord(e);if(!isCamelCaseWord(t)){if(!isUpperCaseWord(t))return null;e=e.toLowerCase()}let s=null,o=0;for(a=a.toLowerCase();o<e.length&&(s=_matchesCamelCase(a,e,0,o))===null;)o=nextAnchor(e,o+1);return s}const fuzzyContiguousFilter=or(matchesPrefix,matchesCamelCase,matchesContiguousSubString),fuzzySeparateFilter=or(matchesPrefix,matchesCamelCase,matchesSubString),fuzzyRegExpCache=new LRUCache(1e4);function matchesFuzzy(a,e,t=!1){if(typeof a!="string"||typeof e!="string")return null;let s=fuzzyRegExpCache.get(a);s||(s=new RegExp(convertSimple2RegExpPattern(a),"i"),fuzzyRegExpCache.set(a,s));const o=s.exec(e);return o?[{start:o.index,end:o.index+o[0].length}]:t?fuzzySeparateFilter(a,e):fuzzyContiguousFilter(a,e)}function matchesFuzzy2(a,e){const t=fuzzyScore(a,a.toLowerCase(),0,e,e.toLowerCase(),0,{firstMatchCanBeWeak:!0,boostFullMatch:!0});return t?createMatches(t):null}function anyScore(a,e,t,s,o,r){const l=Math.min(13,a.length);for(;t<l;t++){const c=fuzzyScore(a,e,t,s,o,r,{firstMatchCanBeWeak:!0,boostFullMatch:!0});if(c)return c}return[0,r]}function createMatches(a){if(typeof a>"u")return[];const e=[],t=a[1];for(let s=a.length-1;s>1;s--){const o=a[s]+t,r=e[e.length-1];r&&r.end===o?r.end=o+1:e.push({start:o,end:o+1})}return e}const _maxLen=128;function initTable(){const a=[],e=[];for(let t=0;t<=_maxLen;t++)e[t]=0;for(let t=0;t<=_maxLen;t++)a.push(e.slice(0));return a}function initArr(a){const e=[];for(let t=0;t<=a;t++)e[t]=0;return e}const _minWordMatchPos=initArr(2*_maxLen),_maxWordMatchPos=initArr(2*_maxLen),_diag=initTable(),_table=initTable(),_arrows=initTable();function isSeparatorAtPos(a,e){if(e<0||e>=a.length)return!1;const t=a.codePointAt(e);switch(t){case 95:case 45:case 46:case 32:case 47:case 92:case 39:case 34:case 58:case 36:case 60:case 62:case 40:case 41:case 91:case 93:case 123:case 125:return!0;case void 0:return!1;default:return!!isEmojiImprecise(t)}}function isWhitespaceAtPos(a,e){if(e<0||e>=a.length)return!1;switch(a.charCodeAt(e)){case 32:case 9:return!0;default:return!1}}function isUpperCaseAtPos(a,e,t){return e[a]!==t[a]}function isPatternInWord(a,e,t,s,o,r,l=!1){for(;e<t&&o<r;)a[e]===s[o]&&(l&&(_minWordMatchPos[e]=o),e+=1),o+=1;return e===t}var FuzzyScore;(function(a){a.Default=[-100,0];function e(t){return!t||t.length===2&&t[0]===-100&&t[1]===0}a.isDefault=e})(FuzzyScore||(FuzzyScore={}));const Ko=class Ko{constructor(e,t){this.firstMatchCanBeWeak=e,this.boostFullMatch=t}};Ko.default={boostFullMatch:!0,firstMatchCanBeWeak:!1};let FuzzyScoreOptions=Ko;function fuzzyScore(a,e,t,s,o,r,l=FuzzyScoreOptions.default){const c=a.length>_maxLen?_maxLen:a.length,d=s.length>_maxLen?_maxLen:s.length;if(t>=c||r>=d||c-t>d-r||!isPatternInWord(e,t,c,o,r,d,!0))return;_fillInMaxWordMatchPos(c,d,t,r,e,o);let u=1,g=1,f=t,p=r;const m=[!1];for(u=1,f=t;f<c;u++,f++){const S=_minWordMatchPos[f],y=_maxWordMatchPos[f],w=f+1<c?_maxWordMatchPos[f+1]:d;for(g=S-r+1,p=S;p<w;g++,p++){let L=Number.MIN_SAFE_INTEGER,x=!1;p<=y&&(L=_doScore(a,e,f,t,s,o,p,d,r,_diag[u-1][g-1]===0,m));let E=0;L!==Number.MIN_SAFE_INTEGER&&(x=!0,E=L+_table[u-1][g-1]);const I=p>S,D=I?_table[u][g-1]+(_diag[u][g-1]>0?-5:0):0,k=p>S+1&&_diag[u][g-1]>0,N=k?_table[u][g-2]+(_diag[u][g-2]>0?-5:0):0;if(k&&(!I||N>=D)&&(!x||N>=E))_table[u][g]=N,_arrows[u][g]=3,_diag[u][g]=0;else if(I&&(!x||D>=E))_table[u][g]=D,_arrows[u][g]=2,_diag[u][g]=0;else if(x)_table[u][g]=E,_arrows[u][g]=1,_diag[u][g]=_diag[u-1][g-1]+1;else throw new Error("not possible")}}if(!m[0]&&!l.firstMatchCanBeWeak)return;u--,g--;const _=[_table[u][g],r];let C=0,b=0;for(;u>=1;){let S=g;do{const y=_arrows[u][S];if(y===3)S=S-2;else if(y===2)S=S-1;else break}while(S>=1);C>1&&e[t+u-1]===o[r+g-1]&&!isUpperCaseAtPos(S+r-1,s,o)&&C+1>_diag[u][S]&&(S=g),S===g?C++:C=1,b||(b=S),u--,g=S-1,_.push(g)}d-r===c&&l.boostFullMatch&&(_[0]+=2);const v=b-c;return _[0]-=v,_}function _fillInMaxWordMatchPos(a,e,t,s,o,r){let l=a-1,c=e-1;for(;l>=t&&c>=s;)o[l]===r[c]&&(_maxWordMatchPos[l]=c,l--),c--}function _doScore(a,e,t,s,o,r,l,c,d,u,g){if(e[t]!==r[l])return Number.MIN_SAFE_INTEGER;let f=1,p=!1;return l===t-s?f=a[t]===o[l]?7:5:isUpperCaseAtPos(l,o,r)&&(l===0||!isUpperCaseAtPos(l-1,o,r))?(f=a[t]===o[l]?7:5,p=!0):isSeparatorAtPos(r,l)&&(l===0||!isSeparatorAtPos(r,l-1))?f=5:(isSeparatorAtPos(r,l-1)||isWhitespaceAtPos(r,l-1))&&(f=5,p=!0),f>1&&t===s&&(g[0]=!0),p||(p=isUpperCaseAtPos(l,o,r)||isSeparatorAtPos(r,l-1)||isWhitespaceAtPos(r,l-1)),t===s?l>d&&(f-=p?3:5):u?f+=p?2:0:f+=p?0:1,l+1===c&&(f-=p?3:5),f}function fuzzyScoreGracefulAggressive(a,e,t,s,o,r,l){return fuzzyScoreWithPermutations(a,e,t,s,o,r,!0,l)}function fuzzyScoreWithPermutations(a,e,t,s,o,r,l,c){let d=fuzzyScore(a,e,t,s,o,r,c);if(d&&!l)return d;if(a.length>=3){const u=Math.min(7,a.length-1);for(let g=t+1;g<u;g++){const f=nextTypoPermutation(a,g);if(f){const p=fuzzyScore(f,f.toLowerCase(),t,s,o,r,c);p&&(p[0]-=3,(!d||p[0]>d[0])&&(d=p))}}}return d}function nextTypoPermutation(a,e){if(e+1>=a.length)return;const t=a[e],s=a[e+1];if(t!==s)return a.slice(0,e)+s+t+a.slice(e+2)}const iconStartMarker="$(",iconsRegex=new RegExp(`\\$\\(${ThemeIcon.iconNameExpression}(?:${ThemeIcon.iconModifierExpression})?\\)`,"g"),escapeIconsRegex=new RegExp(`(\\\\)?${iconsRegex.source}`,"g");function escapeIcons(a){return a.replace(escapeIconsRegex,(e,t)=>t?e:`\\${e}`)}const markdownEscapedIconsRegex=new RegExp(`\\\\${iconsRegex.source}`,"g");function markdownEscapeEscapedIcons(a){return a.replace(markdownEscapedIconsRegex,e=>`\\${e}`)}const stripIconsRegex=new RegExp(`(\\s)?(\\\\)?${iconsRegex.source}(\\s)?`,"g");function stripIcons(a){return a.indexOf(iconStartMarker)===-1?a:a.replace(stripIconsRegex,(e,t,s,o)=>s?e:t||o||"")}function getCodiconAriaLabel(a){return a?a.replace(/\$\((.*?)\)/g,(e,t)=>` ${t} `).trim():""}const _parseIconsRegex=new RegExp(`\\$\\(${ThemeIcon.iconNameCharacter}+\\)`,"g");function parseLabelWithIcons(a){_parseIconsRegex.lastIndex=0;let e="";const t=[];let s=0;for(;;){const o=_parseIconsRegex.lastIndex,r=_parseIconsRegex.exec(a),l=a.substring(o,r==null?void 0:r.index);if(l.length>0){e+=l;for(let c=0;c<l.length;c++)t.push(s)}if(!r)break;s+=r[0].length}return{text:e,iconOffsets:t}}function matchesFuzzyIconAware(a,e,t=!1){const{text:s,iconOffsets:o}=e;if(!o||o.length===0)return matchesFuzzy(a,s,t);const r=ltrim(s," "),l=s.length-r.length,c=matchesFuzzy(a,r,t);if(c)for(const d of c){const u=o[d.start+l]+l;d.start+=u,d.end+=u}return c}class MarkdownString{constructor(e="",t=!1){if(this.value=e,typeof this.value!="string")throw illegalArgument("value");typeof t=="boolean"?(this.isTrusted=t,this.supportThemeIcons=!1,this.supportHtml=!1):(this.isTrusted=t.isTrusted??void 0,this.supportThemeIcons=t.supportThemeIcons??!1,this.supportHtml=t.supportHtml??!1)}appendText(e,t=0){return this.value+=escapeMarkdownSyntaxTokens(this.supportThemeIcons?escapeIcons(e):e).replace(/([ \t]+)/g,(s,o)=>"&nbsp;".repeat(o.length)).replace(/\>/gm,"\\>").replace(/\n/g,t===1?`\\
`:`

`),this}appendMarkdown(e){return this.value+=e,this}appendCodeblock(e,t){return this.value+=`
${appendEscapedMarkdownCodeBlockFence(t,e)}
`,this}appendLink(e,t,s){return this.value+="[",this.value+=this._escape(t,"]"),this.value+="](",this.value+=this._escape(String(e),")"),s&&(this.value+=` "${this._escape(this._escape(s,'"'),")")}"`),this.value+=")",this}_escape(e,t){const s=new RegExp(escapeRegExpCharacters(t),"g");return e.replace(s,(o,r)=>e.charAt(r-1)!=="\\"?`\\${o}`:o)}}function isEmptyMarkdownString(a){return isMarkdownString(a)?!a.value:Array.isArray(a)?a.every(isEmptyMarkdownString):!0}function isMarkdownString(a){return a instanceof MarkdownString?!0:a&&typeof a=="object"?typeof a.value=="string"&&(typeof a.isTrusted=="boolean"||typeof a.isTrusted=="object"||a.isTrusted===void 0)&&(typeof a.supportThemeIcons=="boolean"||a.supportThemeIcons===void 0):!1}function markdownStringEqual(a,e){return a===e?!0:!a||!e?!1:a.value===e.value&&a.isTrusted===e.isTrusted&&a.supportThemeIcons===e.supportThemeIcons&&a.supportHtml===e.supportHtml&&(a.baseUri===e.baseUri||!!a.baseUri&&!!e.baseUri&&isEqual(URI.from(a.baseUri),URI.from(e.baseUri)))}function escapeMarkdownSyntaxTokens(a){return a.replace(/[\\`*_{}[\]()#+\-!~]/g,"\\$&")}function appendEscapedMarkdownCodeBlockFence(a,e){var o;const t=((o=a.match(/^`+/gm))==null?void 0:o.reduce((r,l)=>r.length>l.length?r:l).length)??0,s=t>=3?t+1:3;return[`${"`".repeat(s)}${e}`,a,`${"`".repeat(s)}`].join(`
`)}function escapeDoubleQuotes(a){return a.replace(/"/g,"&quot;")}function removeMarkdownEscapes(a){return a&&a.replace(/\\([\\`*_{}[\]()#+\-.!~])/g,"$1")}function parseHrefAndDimensions(a){const e=[],t=a.split("|").map(o=>o.trim());a=t[0];const s=t[1];if(s){const o=/height=(\d+)/.exec(s),r=/width=(\d+)/.exec(s),l=o?o[1]:"",c=r?r[1]:"",d=isFinite(parseInt(c)),u=isFinite(parseInt(l));d&&e.push(`width="${c}"`),u&&e.push(`height="${l}"`)}return{href:a,dimensions:e}}function createCommandUri(a,...e){return URI.from({scheme:Schemas.command,path:a,query:e.length?encodeURIComponent(JSON.stringify(e)):void 0})}class IdGenerator{constructor(e){this._prefix=e,this._lastId=0}nextId(){return this._prefix+ ++this._lastId}}const defaultGenerator=new IdGenerator("id#");function _getDefaults(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let _defaults=_getDefaults();function changeDefaults(a){_defaults=a}const escapeTest=/[&<>"']/,escapeReplace=new RegExp(escapeTest.source,"g"),escapeTestNoEncode=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode=new RegExp(escapeTestNoEncode.source,"g"),escapeReplacements={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},getEscapeReplacement=a=>escapeReplacements[a];function escape$1(a,e){if(e){if(escapeTest.test(a))return a.replace(escapeReplace,getEscapeReplacement)}else if(escapeTestNoEncode.test(a))return a.replace(escapeReplaceNoEncode,getEscapeReplacement);return a}const caret=/(^|[^\[])\^/g;function edit(a,e){let t=typeof a=="string"?a:a.source;e=e||"";const s={replace:(o,r)=>{let l=typeof r=="string"?r:r.source;return l=l.replace(caret,"$1"),t=t.replace(o,l),s},getRegex:()=>new RegExp(t,e)};return s}function cleanUrl(a){try{a=encodeURI(a).replace(/%25/g,"%")}catch{return null}return a}const noopTest={exec:()=>null};function splitCells(a,e){const t=a.replace(/\|/g,(r,l,c)=>{let d=!1,u=l;for(;--u>=0&&c[u]==="\\";)d=!d;return d?"|":" |"}),s=t.split(/ \|/);let o=0;if(s[0].trim()||s.shift(),s.length>0&&!s[s.length-1].trim()&&s.pop(),e)if(s.length>e)s.splice(e);else for(;s.length<e;)s.push("");for(;o<s.length;o++)s[o]=s[o].trim().replace(/\\\|/g,"|");return s}function rtrim(a,e,t){const s=a.length;if(s===0)return"";let o=0;for(;o<s;){const r=a.charAt(s-o-1);if(r===e&&!t)o++;else if(r!==e&&t)o++;else break}return a.slice(0,s-o)}function findClosingBracket(a,e){if(a.indexOf(e[1])===-1)return-1;let t=0;for(let s=0;s<a.length;s++)if(a[s]==="\\")s++;else if(a[s]===e[0])t++;else if(a[s]===e[1]&&(t--,t<0))return s;return-1}function outputLink(a,e,t,s){const o=e.href,r=e.title?escape$1(e.title):null,l=a[1].replace(/\\([\[\]])/g,"$1");if(a[0].charAt(0)!=="!"){s.state.inLink=!0;const c={type:"link",raw:t,href:o,title:r,text:l,tokens:s.inlineTokens(l)};return s.state.inLink=!1,c}return{type:"image",raw:t,href:o,title:r,text:escape$1(l)}}function indentCodeCompensation(a,e){const t=a.match(/^(\s+)(?:```)/);if(t===null)return e;const s=t[1];return e.split(`
`).map(o=>{const r=o.match(/^\s+/);if(r===null)return o;const[l]=r;return l.length>=s.length?o.slice(s.length):o}).join(`
`)}class _Tokenizer{constructor(e){oe(this,"options");oe(this,"rules");oe(this,"lexer");this.options=e||_defaults}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const s=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?s:rtrim(s,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const s=t[0],o=indentCodeCompensation(s,t[3]||"");return{type:"code",raw:s,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:o}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let s=t[2].trim();if(/#$/.test(s)){const o=rtrim(s,"#");(this.options.pedantic||!o||/ $/.test(o))&&(s=o.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:s,tokens:this.lexer.inline(s)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:rtrim(t[0],`
`)}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let s=rtrim(t[0],`
`).split(`
`),o="",r="";const l=[];for(;s.length>0;){let c=!1;const d=[];let u;for(u=0;u<s.length;u++)if(/^ {0,3}>/.test(s[u]))d.push(s[u]),c=!0;else if(!c)d.push(s[u]);else break;s=s.slice(u);const g=d.join(`
`),f=g.replace(/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,`
    $1`).replace(/^ {0,3}>[ \t]?/gm,"");o=o?`${o}
${g}`:g,r=r?`${r}
${f}`:f;const p=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(f,l,!0),this.lexer.state.top=p,s.length===0)break;const m=l[l.length-1];if((m==null?void 0:m.type)==="code")break;if((m==null?void 0:m.type)==="blockquote"){const _=m,C=_.raw+`
`+s.join(`
`),b=this.blockquote(C);l[l.length-1]=b,o=o.substring(0,o.length-_.raw.length)+b.raw,r=r.substring(0,r.length-_.text.length)+b.text;break}else if((m==null?void 0:m.type)==="list"){const _=m,C=_.raw+`
`+s.join(`
`),b=this.list(C);l[l.length-1]=b,o=o.substring(0,o.length-m.raw.length)+b.raw,r=r.substring(0,r.length-_.raw.length)+b.raw,s=C.substring(l[l.length-1].raw.length).split(`
`);continue}}return{type:"blockquote",raw:o,tokens:l,text:r}}}list(e){let t=this.rules.block.list.exec(e);if(t){let s=t[1].trim();const o=s.length>1,r={type:"list",raw:"",ordered:o,start:o?+s.slice(0,-1):"",loose:!1,items:[]};s=o?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=o?s:"[*+-]");const l=new RegExp(`^( {0,3}${s})((?:[	 ][^\\n]*)?(?:\\n|$))`);let c=!1;for(;e;){let d=!1,u="",g="";if(!(t=l.exec(e))||this.rules.block.hr.test(e))break;u=t[0],e=e.substring(u.length);let f=t[2].split(`
`,1)[0].replace(/^\t+/,v=>" ".repeat(3*v.length)),p=e.split(`
`,1)[0],m=!f.trim(),_=0;if(this.options.pedantic?(_=2,g=f.trimStart()):m?_=t[1].length+1:(_=t[2].search(/[^ ]/),_=_>4?1:_,g=f.slice(_),_+=t[1].length),m&&/^ *$/.test(p)&&(u+=p+`
`,e=e.substring(p.length+1),d=!0),!d){const v=new RegExp(`^ {0,${Math.min(3,_-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),S=new RegExp(`^ {0,${Math.min(3,_-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),y=new RegExp(`^ {0,${Math.min(3,_-1)}}(?:\`\`\`|~~~)`),w=new RegExp(`^ {0,${Math.min(3,_-1)}}#`);for(;e;){const L=e.split(`
`,1)[0];if(p=L,this.options.pedantic&&(p=p.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),y.test(p)||w.test(p)||v.test(p)||S.test(e))break;if(p.search(/[^ ]/)>=_||!p.trim())g+=`
`+p.slice(_);else{if(m||f.search(/[^ ]/)>=4||y.test(f)||w.test(f)||S.test(f))break;g+=`
`+p}!m&&!p.trim()&&(m=!0),u+=L+`
`,e=e.substring(L.length+1),f=p.slice(_)}}r.loose||(c?r.loose=!0:/\n *\n *$/.test(u)&&(c=!0));let C=null,b;this.options.gfm&&(C=/^\[[ xX]\] /.exec(g),C&&(b=C[0]!=="[ ] ",g=g.replace(/^\[[ xX]\] +/,""))),r.items.push({type:"list_item",raw:u,task:!!C,checked:b,loose:!1,text:g,tokens:[]}),r.raw+=u}r.items[r.items.length-1].raw=r.items[r.items.length-1].raw.trimEnd(),r.items[r.items.length-1].text=r.items[r.items.length-1].text.trimEnd(),r.raw=r.raw.trimEnd();for(let d=0;d<r.items.length;d++)if(this.lexer.state.top=!1,r.items[d].tokens=this.lexer.blockTokens(r.items[d].text,[]),!r.loose){const u=r.items[d].tokens.filter(f=>f.type==="space"),g=u.length>0&&u.some(f=>/\n.*\n/.test(f.raw));r.loose=g}if(r.loose)for(let d=0;d<r.items.length;d++)r.items[d].loose=!0;return r}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const s=t[1].toLowerCase().replace(/\s+/g," "),o=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",r=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:s,raw:t[0],href:o,title:r}}}table(e){const t=this.rules.block.table.exec(e);if(!t||!/[:|]/.test(t[2]))return;const s=splitCells(t[1]),o=t[2].replace(/^\||\| *$/g,"").split("|"),r=t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[],l={type:"table",raw:t[0],header:[],align:[],rows:[]};if(s.length===o.length){for(const c of o)/^ *-+: *$/.test(c)?l.align.push("right"):/^ *:-+: *$/.test(c)?l.align.push("center"):/^ *:-+ *$/.test(c)?l.align.push("left"):l.align.push(null);for(let c=0;c<s.length;c++)l.header.push({text:s[c],tokens:this.lexer.inline(s[c]),header:!0,align:l.align[c]});for(const c of r)l.rows.push(splitCells(c,l.header.length).map((d,u)=>({text:d,tokens:this.lexer.inline(d),header:!1,align:l.align[u]})));return l}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const s=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:s,tokens:this.lexer.inline(s)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:escape$1(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const s=t[2].trim();if(!this.options.pedantic&&/^</.test(s)){if(!/>$/.test(s))return;const l=rtrim(s.slice(0,-1),"\\");if((s.length-l.length)%2===0)return}else{const l=findClosingBracket(t[2],"()");if(l>-1){const d=(t[0].indexOf("!")===0?5:4)+t[1].length+l;t[2]=t[2].substring(0,l),t[0]=t[0].substring(0,d).trim(),t[3]=""}}let o=t[2],r="";if(this.options.pedantic){const l=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(o);l&&(o=l[1],r=l[3])}else r=t[3]?t[3].slice(1,-1):"";return o=o.trim(),/^</.test(o)&&(this.options.pedantic&&!/>$/.test(s)?o=o.slice(1):o=o.slice(1,-1)),outputLink(t,{href:o&&o.replace(this.rules.inline.anyPunctuation,"$1"),title:r&&r.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer)}}reflink(e,t){let s;if((s=this.rules.inline.reflink.exec(e))||(s=this.rules.inline.nolink.exec(e))){const o=(s[2]||s[1]).replace(/\s+/g," "),r=t[o.toLowerCase()];if(!r){const l=s[0].charAt(0);return{type:"text",raw:l,text:l}}return outputLink(s,r,s[0],this.lexer)}}emStrong(e,t,s=""){let o=this.rules.inline.emStrongLDelim.exec(e);if(!o||o[3]&&s.match(/[\p{L}\p{N}]/u))return;if(!(o[1]||o[2]||"")||!s||this.rules.inline.punctuation.exec(s)){const l=[...o[0]].length-1;let c,d,u=l,g=0;const f=o[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(f.lastIndex=0,t=t.slice(-1*e.length+l);(o=f.exec(t))!=null;){if(c=o[1]||o[2]||o[3]||o[4]||o[5]||o[6],!c)continue;if(d=[...c].length,o[3]||o[4]){u+=d;continue}else if((o[5]||o[6])&&l%3&&!((l+d)%3)){g+=d;continue}if(u-=d,u>0)continue;d=Math.min(d,d+u+g);const p=[...o[0]][0].length,m=e.slice(0,l+o.index+p+d);if(Math.min(l,d)%2){const C=m.slice(1,-1);return{type:"em",raw:m,text:C,tokens:this.lexer.inlineTokens(C)}}const _=m.slice(2,-2);return{type:"strong",raw:m,text:_,tokens:this.lexer.inlineTokens(_)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let s=t[2].replace(/\n/g," ");const o=/[^ ]/.test(s),r=/^ /.test(s)&&/ $/.test(s);return o&&r&&(s=s.substring(1,s.length-1)),s=escape$1(s,!0),{type:"codespan",raw:t[0],text:s}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let s,o;return t[2]==="@"?(s=escape$1(t[1]),o="mailto:"+s):(s=escape$1(t[1]),o=s),{type:"link",raw:t[0],text:s,href:o,tokens:[{type:"text",raw:s,text:s}]}}}url(e){var s;let t;if(t=this.rules.inline.url.exec(e)){let o,r;if(t[2]==="@")o=escape$1(t[0]),r="mailto:"+o;else{let l;do l=t[0],t[0]=((s=this.rules.inline._backpedal.exec(t[0]))==null?void 0:s[0])??"";while(l!==t[0]);o=escape$1(t[0]),t[1]==="www."?r="http://"+t[0]:r=t[0]}return{type:"link",raw:t[0],text:o,href:r,tokens:[{type:"text",raw:o,text:o}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){let s;return this.lexer.state.inRawBlock?s=t[0]:s=escape$1(t[0]),{type:"text",raw:t[0],text:s}}}}const newline=/^(?: *(?:\n|$))+/,blockCode=/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,bullet=/(?:[*+-]|\d{1,9}[.)])/,lheading=edit(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,bullet).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),_paragraph=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,blockText=/^[^\n]+/,_blockLabel=/(?!\s*\])(?:\\.|[^\[\]\\])+/,def=edit(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",_blockLabel).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),list$1=edit(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,bullet).getRegex(),_tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",_comment=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,html$2=edit("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",_comment).replace("tag",_tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),paragraph=edit(_paragraph).replace("hr",hr).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",_tag).getRegex(),blockquote=edit(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",paragraph).getRegex(),blockNormal={blockquote,code:blockCode,def,fences,heading,hr,html:html$2,lheading,list:list$1,newline,paragraph,table:noopTest,text:blockText},gfmTable=edit("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",hr).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",_tag).getRegex(),blockGfm={...blockNormal,table:gfmTable,paragraph:edit(_paragraph).replace("hr",hr).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",gfmTable).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",_tag).getRegex()},blockPedantic={...blockNormal,html:edit(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",_comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:noopTest,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:edit(_paragraph).replace("hr",hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",lheading).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},escape=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,inlineCode=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br=/^( {2,}|\\)\n(?!\s*$)/,inlineText=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,_punctuation="\\p{P}\\p{S}",punctuation=edit(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,_punctuation).getRegex(),blockSkip=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,emStrongLDelim=edit(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,_punctuation).getRegex(),emStrongRDelimAst=edit("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,_punctuation).getRegex(),emStrongRDelimUnd=edit("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,_punctuation).getRegex(),anyPunctuation=edit(/\\([punct])/,"gu").replace(/punct/g,_punctuation).getRegex(),autolink=edit(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),_inlineComment=edit(_comment).replace("(?:-->|$)","-->").getRegex(),tag=edit("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",_inlineComment).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),_inlineLabel=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,link$1=edit(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",_inlineLabel).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),reflink=edit(/^!?\[(label)\]\[(ref)\]/).replace("label",_inlineLabel).replace("ref",_blockLabel).getRegex(),nolink=edit(/^!?\[(ref)\](?:\[\])?/).replace("ref",_blockLabel).getRegex(),reflinkSearch=edit("reflink|nolink(?!\\()","g").replace("reflink",reflink).replace("nolink",nolink).getRegex(),inlineNormal={_backpedal:noopTest,anyPunctuation,autolink,blockSkip,br,code:inlineCode,del:noopTest,emStrongLDelim,emStrongRDelimAst,emStrongRDelimUnd,escape,link:link$1,nolink,punctuation,reflink,reflinkSearch,tag,text:inlineText,url:noopTest},inlinePedantic={...inlineNormal,link:edit(/^!?\[(label)\]\((.*?)\)/).replace("label",_inlineLabel).getRegex(),reflink:edit(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",_inlineLabel).getRegex()},inlineGfm={...inlineNormal,escape:edit(escape).replace("])","~|])").getRegex(),url:edit(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},inlineBreaks={...inlineGfm,br:edit(br).replace("{2,}","*").getRegex(),text:edit(inlineGfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},block={normal:blockNormal,gfm:blockGfm,pedantic:blockPedantic},inline={normal:inlineNormal,gfm:inlineGfm,breaks:inlineBreaks,pedantic:inlinePedantic};class _Lexer{constructor(e){oe(this,"tokens");oe(this,"options");oe(this,"state");oe(this,"tokenizer");oe(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||_defaults,this.options.tokenizer=this.options.tokenizer||new _Tokenizer,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:block.normal,inline:inline.normal};this.options.pedantic?(t.block=block.pedantic,t.inline=inline.pedantic):this.options.gfm&&(t.block=block.gfm,this.options.breaks?t.inline=inline.breaks:t.inline=inline.gfm),this.tokenizer.rules=t}static get rules(){return{block,inline}}static lex(e,t){return new _Lexer(t).lex(e)}static lexInline(e,t){return new _Lexer(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const s=this.inlineQueue[t];this.inlineTokens(s.src,s.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],s=!1){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(c,d,u)=>d+"    ".repeat(u.length));let o,r,l;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(c=>(o=c.call({lexer:this},e,t))?(e=e.substring(o.raw.length),t.push(o),!0):!1))){if(o=this.tokenizer.space(e)){e=e.substring(o.raw.length),o.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(o);continue}if(o=this.tokenizer.code(e)){e=e.substring(o.raw.length),r=t[t.length-1],r&&(r.type==="paragraph"||r.type==="text")?(r.raw+=`
`+o.raw,r.text+=`
`+o.text,this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(o);continue}if(o=this.tokenizer.fences(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.heading(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.hr(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.blockquote(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.list(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.html(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.def(e)){e=e.substring(o.raw.length),r=t[t.length-1],r&&(r.type==="paragraph"||r.type==="text")?(r.raw+=`
`+o.raw,r.text+=`
`+o.raw,this.inlineQueue[this.inlineQueue.length-1].src=r.text):this.tokens.links[o.tag]||(this.tokens.links[o.tag]={href:o.href,title:o.title});continue}if(o=this.tokenizer.table(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.lheading(e)){e=e.substring(o.raw.length),t.push(o);continue}if(l=e,this.options.extensions&&this.options.extensions.startBlock){let c=1/0;const d=e.slice(1);let u;this.options.extensions.startBlock.forEach(g=>{u=g.call({lexer:this},d),typeof u=="number"&&u>=0&&(c=Math.min(c,u))}),c<1/0&&c>=0&&(l=e.substring(0,c+1))}if(this.state.top&&(o=this.tokenizer.paragraph(l))){r=t[t.length-1],s&&(r==null?void 0:r.type)==="paragraph"?(r.raw+=`
`+o.raw,r.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(o),s=l.length!==e.length,e=e.substring(o.raw.length);continue}if(o=this.tokenizer.text(e)){e=e.substring(o.raw.length),r=t[t.length-1],r&&r.type==="text"?(r.raw+=`
`+o.raw,r.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(o);continue}if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let s,o,r,l=e,c,d,u;if(this.tokens.links){const g=Object.keys(this.tokens.links);if(g.length>0)for(;(c=this.tokenizer.rules.inline.reflinkSearch.exec(l))!=null;)g.includes(c[0].slice(c[0].lastIndexOf("[")+1,-1))&&(l=l.slice(0,c.index)+"["+"a".repeat(c[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(c=this.tokenizer.rules.inline.blockSkip.exec(l))!=null;)l=l.slice(0,c.index)+"["+"a".repeat(c[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(c=this.tokenizer.rules.inline.anyPunctuation.exec(l))!=null;)l=l.slice(0,c.index)+"++"+l.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(d||(u=""),d=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(g=>(s=g.call({lexer:this},e,t))?(e=e.substring(s.raw.length),t.push(s),!0):!1))){if(s=this.tokenizer.escape(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.tag(e)){e=e.substring(s.raw.length),o=t[t.length-1],o&&s.type==="text"&&o.type==="text"?(o.raw+=s.raw,o.text+=s.text):t.push(s);continue}if(s=this.tokenizer.link(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(s.raw.length),o=t[t.length-1],o&&s.type==="text"&&o.type==="text"?(o.raw+=s.raw,o.text+=s.text):t.push(s);continue}if(s=this.tokenizer.emStrong(e,l,u)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.codespan(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.br(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.del(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.autolink(e)){e=e.substring(s.raw.length),t.push(s);continue}if(!this.state.inLink&&(s=this.tokenizer.url(e))){e=e.substring(s.raw.length),t.push(s);continue}if(r=e,this.options.extensions&&this.options.extensions.startInline){let g=1/0;const f=e.slice(1);let p;this.options.extensions.startInline.forEach(m=>{p=m.call({lexer:this},f),typeof p=="number"&&p>=0&&(g=Math.min(g,p))}),g<1/0&&g>=0&&(r=e.substring(0,g+1))}if(s=this.tokenizer.inlineText(r)){e=e.substring(s.raw.length),s.raw.slice(-1)!=="_"&&(u=s.raw.slice(-1)),d=!0,o=t[t.length-1],o&&o.type==="text"?(o.raw+=s.raw,o.text+=s.text):t.push(s);continue}if(e){const g="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(g);break}else throw new Error(g)}}return t}}class _Renderer{constructor(e){oe(this,"options");oe(this,"parser");this.options=e||_defaults}space(e){return""}code({text:e,lang:t,escaped:s}){var l;const o=(l=(t||"").match(/^\S*/))==null?void 0:l[0],r=e.replace(/\n$/,"")+`
`;return o?'<pre><code class="language-'+escape$1(o)+'">'+(s?r:escape$1(r,!0))+`</code></pre>
`:"<pre><code>"+(s?r:escape$1(r,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){const t=e.ordered,s=e.start;let o="";for(let c=0;c<e.items.length;c++){const d=e.items[c];o+=this.listitem(d)}const r=t?"ol":"ul",l=t&&s!==1?' start="'+s+'"':"";return"<"+r+l+`>
`+o+"</"+r+`>
`}listitem(e){let t="";if(e.task){const s=this.checkbox({checked:!!e.checked});e.loose?e.tokens.length>0&&e.tokens[0].type==="paragraph"?(e.tokens[0].text=s+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=s+" "+e.tokens[0].tokens[0].text)):e.tokens.unshift({type:"text",raw:s+" ",text:s+" "}):t+=s+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",s="";for(let r=0;r<e.header.length;r++)s+=this.tablecell(e.header[r]);t+=this.tablerow({text:s});let o="";for(let r=0;r<e.rows.length;r++){const l=e.rows[r];s="";for(let c=0;c<l.length;c++)s+=this.tablecell(l[c]);o+=this.tablerow({text:s})}return o&&(o=`<tbody>${o}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+o+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const t=this.parser.parseInline(e.tokens),s=e.header?"th":"td";return(e.align?`<${s} align="${e.align}">`:`<${s}>`)+t+`</${s}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${e}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:s}){const o=this.parser.parseInline(s),r=cleanUrl(e);if(r===null)return o;e=r;let l='<a href="'+e+'"';return t&&(l+=' title="'+t+'"'),l+=">"+o+"</a>",l}image({href:e,title:t,text:s}){const o=cleanUrl(e);if(o===null)return s;e=o;let r=`<img src="${e}" alt="${s}"`;return t&&(r+=` title="${t}"`),r+=">",r}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):e.text}}class _TextRenderer{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class _Parser{constructor(e){oe(this,"options");oe(this,"renderer");oe(this,"textRenderer");this.options=e||_defaults,this.options.renderer=this.options.renderer||new _Renderer,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new _TextRenderer}static parse(e,t){return new _Parser(t).parse(e)}static parseInline(e,t){return new _Parser(t).parseInline(e)}parse(e,t=!0){let s="";for(let o=0;o<e.length;o++){const r=e[o];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[r.type]){const c=r,d=this.options.extensions.renderers[c.type].call({parser:this},c);if(d!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(c.type)){s+=d||"";continue}}const l=r;switch(l.type){case"space":{s+=this.renderer.space(l);continue}case"hr":{s+=this.renderer.hr(l);continue}case"heading":{s+=this.renderer.heading(l);continue}case"code":{s+=this.renderer.code(l);continue}case"table":{s+=this.renderer.table(l);continue}case"blockquote":{s+=this.renderer.blockquote(l);continue}case"list":{s+=this.renderer.list(l);continue}case"html":{s+=this.renderer.html(l);continue}case"paragraph":{s+=this.renderer.paragraph(l);continue}case"text":{let c=l,d=this.renderer.text(c);for(;o+1<e.length&&e[o+1].type==="text";)c=e[++o],d+=`
`+this.renderer.text(c);t?s+=this.renderer.paragraph({type:"paragraph",raw:d,text:d,tokens:[{type:"text",raw:d,text:d}]}):s+=d;continue}default:{const c='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return s}parseInline(e,t){t=t||this.renderer;let s="";for(let o=0;o<e.length;o++){const r=e[o];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[r.type]){const c=this.options.extensions.renderers[r.type].call({parser:this},r);if(c!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(r.type)){s+=c||"";continue}}const l=r;switch(l.type){case"escape":{s+=t.text(l);break}case"html":{s+=t.html(l);break}case"link":{s+=t.link(l);break}case"image":{s+=t.image(l);break}case"strong":{s+=t.strong(l);break}case"em":{s+=t.em(l);break}case"codespan":{s+=t.codespan(l);break}case"br":{s+=t.br(l);break}case"del":{s+=t.del(l);break}case"text":{s+=t.text(l);break}default:{const c='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return s}}class _Hooks{constructor(e){oe(this,"options");this.options=e||_defaults}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}}oe(_Hooks,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));class Marked{constructor(...e){oe(this,"defaults",_getDefaults());oe(this,"options",this.setOptions);oe(this,"parse",this.parseMarkdown(_Lexer.lex,_Parser.parse));oe(this,"parseInline",this.parseMarkdown(_Lexer.lexInline,_Parser.parseInline));oe(this,"Parser",_Parser);oe(this,"Renderer",_Renderer);oe(this,"TextRenderer",_TextRenderer);oe(this,"Lexer",_Lexer);oe(this,"Tokenizer",_Tokenizer);oe(this,"Hooks",_Hooks);this.use(...e)}walkTokens(e,t){var o,r;let s=[];for(const l of e)switch(s=s.concat(t.call(this,l)),l.type){case"table":{const c=l;for(const d of c.header)s=s.concat(this.walkTokens(d.tokens,t));for(const d of c.rows)for(const u of d)s=s.concat(this.walkTokens(u.tokens,t));break}case"list":{const c=l;s=s.concat(this.walkTokens(c.items,t));break}default:{const c=l;(r=(o=this.defaults.extensions)==null?void 0:o.childTokens)!=null&&r[c.type]?this.defaults.extensions.childTokens[c.type].forEach(d=>{const u=c[d].flat(1/0);s=s.concat(this.walkTokens(u,t))}):c.tokens&&(s=s.concat(this.walkTokens(c.tokens,t)))}}return s}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(s=>{const o={...s};if(o.async=this.defaults.async||o.async||!1,s.extensions&&(s.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if("renderer"in r){const l=t.renderers[r.name];l?t.renderers[r.name]=function(...c){let d=r.renderer.apply(this,c);return d===!1&&(d=l.apply(this,c)),d}:t.renderers[r.name]=r.renderer}if("tokenizer"in r){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const l=t[r.level];l?l.unshift(r.tokenizer):t[r.level]=[r.tokenizer],r.start&&(r.level==="block"?t.startBlock?t.startBlock.push(r.start):t.startBlock=[r.start]:r.level==="inline"&&(t.startInline?t.startInline.push(r.start):t.startInline=[r.start]))}"childTokens"in r&&r.childTokens&&(t.childTokens[r.name]=r.childTokens)}),o.extensions=t),s.renderer){const r=this.defaults.renderer||new _Renderer(this.defaults);for(const l in s.renderer){if(!(l in r))throw new Error(`renderer '${l}' does not exist`);if(["options","parser"].includes(l))continue;const c=l,d=s.renderer[c],u=r[c];r[c]=(...g)=>{let f=d.apply(r,g);return f===!1&&(f=u.apply(r,g)),f||""}}o.renderer=r}if(s.tokenizer){const r=this.defaults.tokenizer||new _Tokenizer(this.defaults);for(const l in s.tokenizer){if(!(l in r))throw new Error(`tokenizer '${l}' does not exist`);if(["options","rules","lexer"].includes(l))continue;const c=l,d=s.tokenizer[c],u=r[c];r[c]=(...g)=>{let f=d.apply(r,g);return f===!1&&(f=u.apply(r,g)),f}}o.tokenizer=r}if(s.hooks){const r=this.defaults.hooks||new _Hooks;for(const l in s.hooks){if(!(l in r))throw new Error(`hook '${l}' does not exist`);if(l==="options")continue;const c=l,d=s.hooks[c],u=r[c];_Hooks.passThroughHooks.has(l)?r[c]=g=>{if(this.defaults.async)return Promise.resolve(d.call(r,g)).then(p=>u.call(r,p));const f=d.call(r,g);return u.call(r,f)}:r[c]=(...g)=>{let f=d.apply(r,g);return f===!1&&(f=u.apply(r,g)),f}}o.hooks=r}if(s.walkTokens){const r=this.defaults.walkTokens,l=s.walkTokens;o.walkTokens=function(c){let d=[];return d.push(l.call(this,c)),r&&(d=d.concat(r.call(this,c))),d}}this.defaults={...this.defaults,...o}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return _Lexer.lex(e,t??this.defaults)}parser(e,t){return _Parser.parse(e,t??this.defaults)}parseMarkdown(e,t){return(o,r)=>{const l={...r},c={...this.defaults,...l},d=this.onError(!!c.silent,!!c.async);if(this.defaults.async===!0&&l.async===!1)return d(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof o>"u"||o===null)return d(new Error("marked(): input parameter is undefined or null"));if(typeof o!="string")return d(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(o)+", string expected"));if(c.hooks&&(c.hooks.options=c),c.async)return Promise.resolve(c.hooks?c.hooks.preprocess(o):o).then(u=>e(u,c)).then(u=>c.hooks?c.hooks.processAllTokens(u):u).then(u=>c.walkTokens?Promise.all(this.walkTokens(u,c.walkTokens)).then(()=>u):u).then(u=>t(u,c)).then(u=>c.hooks?c.hooks.postprocess(u):u).catch(d);try{c.hooks&&(o=c.hooks.preprocess(o));let u=e(o,c);c.hooks&&(u=c.hooks.processAllTokens(u)),c.walkTokens&&this.walkTokens(u,c.walkTokens);let g=t(u,c);return c.hooks&&(g=c.hooks.postprocess(g)),g}catch(u){return d(u)}}}onError(e,t){return s=>{if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const o="<p>An error occurred:</p><pre>"+escape$1(s.message+"",!0)+"</pre>";return t?Promise.resolve(o):o}if(t)return Promise.reject(s);throw s}}}const markedInstance=new Marked;function marked(a,e){return markedInstance.parse(a,e)}marked.options=marked.setOptions=function(a){return markedInstance.setOptions(a),marked.defaults=markedInstance.defaults,changeDefaults(marked.defaults),marked};marked.getDefaults=_getDefaults;marked.defaults=_defaults;marked.use=function(...a){return markedInstance.use(...a),marked.defaults=markedInstance.defaults,changeDefaults(marked.defaults),marked};marked.walkTokens=function(a,e){return markedInstance.walkTokens(a,e)};marked.parseInline=markedInstance.parseInline;marked.Parser=_Parser;marked.parser=_Parser.parse;marked.Renderer=_Renderer;marked.TextRenderer=_TextRenderer;marked.Lexer=_Lexer;marked.lexer=_Lexer.lex;marked.Tokenizer=_Tokenizer;marked.Hooks=_Hooks;marked.parse=marked;marked.options;marked.setOptions;marked.use;marked.walkTokens;marked.parseInline;const parse$2=marked;_Parser.parse;const lexer=_Lexer.lex;function stringify(a){return JSON.stringify(a,replacer)}function parse$1(a){let e=JSON.parse(a);return e=revive(e),e}function replacer(a,e){return e instanceof RegExp?{$mid:2,source:e.source,flags:e.flags}:e}function revive(a,e=0){if(!a||e>200)return a;if(typeof a=="object"){switch(a.$mid){case 1:return URI.revive(a);case 2:return new RegExp(a.source,a.flags);case 17:return new Date(a.source)}if(a instanceof VSBuffer||a instanceof Uint8Array)return a;if(Array.isArray(a))for(let t=0;t<a.length;++t)a[t]=revive(a[t],e+1);else for(const t in a)Object.hasOwnProperty.call(a,t)&&(a[t]=revive(a[t],e+1))}return a}/*! @license DOMPurify 3.1.7 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.1.7/LICENSE */const{entries,setPrototypeOf,isFrozen,getPrototypeOf,getOwnPropertyDescriptor}=Object;let{freeze:freeze$1,seal,create:create$1}=Object,{apply,construct}=typeof Reflect<"u"&&Reflect;freeze$1||(freeze$1=function(e){return e});seal||(seal=function(e){return e});apply||(apply=function(e,t,s){return e.apply(t,s)});construct||(construct=function(e,t){return new e(...t)});const arrayForEach=unapply(Array.prototype.forEach),arrayPop=unapply(Array.prototype.pop),arrayPush=unapply(Array.prototype.push),stringToLowerCase=unapply(String.prototype.toLowerCase),stringToString=unapply(String.prototype.toString),stringMatch=unapply(String.prototype.match),stringReplace=unapply(String.prototype.replace),stringIndexOf=unapply(String.prototype.indexOf),stringTrim=unapply(String.prototype.trim),objectHasOwnProperty=unapply(Object.prototype.hasOwnProperty),regExpTest=unapply(RegExp.prototype.test),typeErrorCreate=unconstruct(TypeError);function unapply(a){return function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),o=1;o<t;o++)s[o-1]=arguments[o];return apply(a,e,s)}}function unconstruct(a){return function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return construct(a,t)}}function addToSet(a,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:stringToLowerCase;setPrototypeOf&&setPrototypeOf(a,null);let s=e.length;for(;s--;){let o=e[s];if(typeof o=="string"){const r=t(o);r!==o&&(isFrozen(e)||(e[s]=r),o=r)}a[o]=!0}return a}function cleanArray(a){for(let e=0;e<a.length;e++)objectHasOwnProperty(a,e)||(a[e]=null);return a}function clone(a){const e=create$1(null);for(const[t,s]of entries(a))objectHasOwnProperty(a,t)&&(Array.isArray(s)?e[t]=cleanArray(s):s&&typeof s=="object"&&s.constructor===Object?e[t]=clone(s):e[t]=s);return e}function lookupGetter(a,e){for(;a!==null;){const s=getOwnPropertyDescriptor(a,e);if(s){if(s.get)return unapply(s.get);if(typeof s.value=="function")return unapply(s.value)}a=getPrototypeOf(a)}function t(){return null}return t}const html$1=freeze$1(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),svg$1=freeze$1(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),svgFilters=freeze$1(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),svgDisallowed=freeze$1(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),mathMl$1=freeze$1(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),mathMlDisallowed=freeze$1(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),text=freeze$1(["#text"]),html=freeze$1(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),svg=freeze$1(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),mathMl=freeze$1(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),xml=freeze$1(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),MUSTACHE_EXPR=seal(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ERB_EXPR=seal(/<%[\w\W]*|[\w\W]*%>/gm),TMPLIT_EXPR=seal(/\${[\w\W]*}/gm),DATA_ATTR=seal(/^data-[\-\w.\u00B7-\uFFFF]/),ARIA_ATTR=seal(/^aria-[\-\w]+$/),IS_ALLOWED_URI=seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),IS_SCRIPT_OR_DATA=seal(/^(?:\w+script|data):/i),ATTR_WHITESPACE=seal(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),DOCTYPE_NAME=seal(/^html$/i),CUSTOM_ELEMENT=seal(/^[a-z][.\w]*(-[.\w]+)+$/i);var EXPRESSIONS=Object.freeze({__proto__:null,MUSTACHE_EXPR,ERB_EXPR,TMPLIT_EXPR,DATA_ATTR,ARIA_ATTR,IS_ALLOWED_URI,IS_SCRIPT_OR_DATA,ATTR_WHITESPACE,DOCTYPE_NAME,CUSTOM_ELEMENT});const NODE_TYPE={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},getGlobal=function(){return typeof window>"u"?null:window},_createTrustedTypesPolicy=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let s=null;const o="data-tt-policy-suffix";t&&t.hasAttribute(o)&&(s=t.getAttribute(o));const r="dompurify"+(s?"#"+s:"");try{return e.createPolicy(r,{createHTML(l){return l},createScriptURL(l){return l}})}catch{return console.warn("TrustedTypes policy "+r+" could not be created."),null}};function createDOMPurify(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:getGlobal();const e=Q=>createDOMPurify(Q);if(e.version="3.1.7",e.removed=[],!a||!a.document||a.document.nodeType!==NODE_TYPE.document)return e.isSupported=!1,e;let{document:t}=a;const s=t,o=s.currentScript,{DocumentFragment:r,HTMLTemplateElement:l,Node:c,Element:d,NodeFilter:u,NamedNodeMap:g=a.NamedNodeMap||a.MozNamedAttrMap,HTMLFormElement:f,DOMParser:p,trustedTypes:m}=a,_=d.prototype,C=lookupGetter(_,"cloneNode"),b=lookupGetter(_,"remove"),v=lookupGetter(_,"nextSibling"),S=lookupGetter(_,"childNodes"),y=lookupGetter(_,"parentNode");if(typeof l=="function"){const Q=t.createElement("template");Q.content&&Q.content.ownerDocument&&(t=Q.content.ownerDocument)}let w,L="";const{implementation:x,createNodeIterator:E,createDocumentFragment:I,getElementsByTagName:D}=t,{importNode:k}=s;let N={};e.isSupported=typeof entries=="function"&&typeof y=="function"&&x&&x.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:R,ERB_EXPR:M,TMPLIT_EXPR:A,DATA_ATTR:O,ARIA_ATTR:P,IS_SCRIPT_OR_DATA:W,ATTR_WHITESPACE:B,CUSTOM_ELEMENT:H}=EXPRESSIONS;let{IS_ALLOWED_URI:V}=EXPRESSIONS,K=null;const z=addToSet({},[...html$1,...svg$1,...svgFilters,...mathMl$1,...text]);let G=null;const X=addToSet({},[...html,...svg,...mathMl,...xml]);let Y=Object.seal(create$1(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ee=null,le=null,ne=!0,me=!0,ft=!1,he=!0,we=!1,Ro=!0,pt=!1,No=!1,Mo=!1,Kt=!1,zn=!1,Un=!1,Jo=!0,er=!1;const kr="user-content-";let Ao=!0,ln=!1,Gt={},jt=null;const tr=addToSet({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ir=null;const nr=addToSet({},["audio","video","img","source","image","track"]);let Oo=null;const sr=addToSet({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Kn="http://www.w3.org/1998/Math/MathML",Gn="http://www.w3.org/2000/svg",Ue="http://www.w3.org/1999/xhtml";let qt=Ue,Po=!1,Fo=null;const Rr=addToSet({},[Kn,Gn,Ue],stringToString);let cn=null;const Nr=["application/xhtml+xml","text/html"],Mr="text/html";let ue=null,Zt=null;const Ar=t.createElement("form"),rr=function(F){return F instanceof RegExp||F instanceof Function},$o=function(){let F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Zt&&Zt===F)){if((!F||typeof F!="object")&&(F={}),F=clone(F),cn=Nr.indexOf(F.PARSER_MEDIA_TYPE)===-1?Mr:F.PARSER_MEDIA_TYPE,ue=cn==="application/xhtml+xml"?stringToString:stringToLowerCase,K=objectHasOwnProperty(F,"ALLOWED_TAGS")?addToSet({},F.ALLOWED_TAGS,ue):z,G=objectHasOwnProperty(F,"ALLOWED_ATTR")?addToSet({},F.ALLOWED_ATTR,ue):X,Fo=objectHasOwnProperty(F,"ALLOWED_NAMESPACES")?addToSet({},F.ALLOWED_NAMESPACES,stringToString):Rr,Oo=objectHasOwnProperty(F,"ADD_URI_SAFE_ATTR")?addToSet(clone(sr),F.ADD_URI_SAFE_ATTR,ue):sr,ir=objectHasOwnProperty(F,"ADD_DATA_URI_TAGS")?addToSet(clone(nr),F.ADD_DATA_URI_TAGS,ue):nr,jt=objectHasOwnProperty(F,"FORBID_CONTENTS")?addToSet({},F.FORBID_CONTENTS,ue):tr,ee=objectHasOwnProperty(F,"FORBID_TAGS")?addToSet({},F.FORBID_TAGS,ue):{},le=objectHasOwnProperty(F,"FORBID_ATTR")?addToSet({},F.FORBID_ATTR,ue):{},Gt=objectHasOwnProperty(F,"USE_PROFILES")?F.USE_PROFILES:!1,ne=F.ALLOW_ARIA_ATTR!==!1,me=F.ALLOW_DATA_ATTR!==!1,ft=F.ALLOW_UNKNOWN_PROTOCOLS||!1,he=F.ALLOW_SELF_CLOSE_IN_ATTR!==!1,we=F.SAFE_FOR_TEMPLATES||!1,Ro=F.SAFE_FOR_XML!==!1,pt=F.WHOLE_DOCUMENT||!1,Kt=F.RETURN_DOM||!1,zn=F.RETURN_DOM_FRAGMENT||!1,Un=F.RETURN_TRUSTED_TYPE||!1,Mo=F.FORCE_BODY||!1,Jo=F.SANITIZE_DOM!==!1,er=F.SANITIZE_NAMED_PROPS||!1,Ao=F.KEEP_CONTENT!==!1,ln=F.IN_PLACE||!1,V=F.ALLOWED_URI_REGEXP||IS_ALLOWED_URI,qt=F.NAMESPACE||Ue,Y=F.CUSTOM_ELEMENT_HANDLING||{},F.CUSTOM_ELEMENT_HANDLING&&rr(F.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Y.tagNameCheck=F.CUSTOM_ELEMENT_HANDLING.tagNameCheck),F.CUSTOM_ELEMENT_HANDLING&&rr(F.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Y.attributeNameCheck=F.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),F.CUSTOM_ELEMENT_HANDLING&&typeof F.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(Y.allowCustomizedBuiltInElements=F.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),we&&(me=!1),zn&&(Kt=!0),Gt&&(K=addToSet({},text),G=[],Gt.html===!0&&(addToSet(K,html$1),addToSet(G,html)),Gt.svg===!0&&(addToSet(K,svg$1),addToSet(G,svg),addToSet(G,xml)),Gt.svgFilters===!0&&(addToSet(K,svgFilters),addToSet(G,svg),addToSet(G,xml)),Gt.mathMl===!0&&(addToSet(K,mathMl$1),addToSet(G,mathMl),addToSet(G,xml))),F.ADD_TAGS&&(K===z&&(K=clone(K)),addToSet(K,F.ADD_TAGS,ue)),F.ADD_ATTR&&(G===X&&(G=clone(G)),addToSet(G,F.ADD_ATTR,ue)),F.ADD_URI_SAFE_ATTR&&addToSet(Oo,F.ADD_URI_SAFE_ATTR,ue),F.FORBID_CONTENTS&&(jt===tr&&(jt=clone(jt)),addToSet(jt,F.FORBID_CONTENTS,ue)),Ao&&(K["#text"]=!0),pt&&addToSet(K,["html","head","body"]),K.table&&(addToSet(K,["tbody"]),delete ee.tbody),F.TRUSTED_TYPES_POLICY){if(typeof F.TRUSTED_TYPES_POLICY.createHTML!="function")throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof F.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');w=F.TRUSTED_TYPES_POLICY,L=w.createHTML("")}else w===void 0&&(w=_createTrustedTypesPolicy(m,o)),w!==null&&typeof L=="string"&&(L=w.createHTML(""));freeze$1&&freeze$1(F),Zt=F}},ar=addToSet({},["mi","mo","mn","ms","mtext"]),lr=addToSet({},["annotation-xml"]),Or=addToSet({},["title","style","font","a","script"]),cr=addToSet({},[...svg$1,...svgFilters,...svgDisallowed]),dr=addToSet({},[...mathMl$1,...mathMlDisallowed]),Pr=function(F){let U=y(F);(!U||!U.tagName)&&(U={namespaceURI:qt,tagName:"template"});const Z=stringToLowerCase(F.tagName),se=stringToLowerCase(U.tagName);return Fo[F.namespaceURI]?F.namespaceURI===Gn?U.namespaceURI===Ue?Z==="svg":U.namespaceURI===Kn?Z==="svg"&&(se==="annotation-xml"||ar[se]):!!cr[Z]:F.namespaceURI===Kn?U.namespaceURI===Ue?Z==="math":U.namespaceURI===Gn?Z==="math"&&lr[se]:!!dr[Z]:F.namespaceURI===Ue?U.namespaceURI===Gn&&!lr[se]||U.namespaceURI===Kn&&!ar[se]?!1:!dr[Z]&&(Or[Z]||!cr[Z]):!!(cn==="application/xhtml+xml"&&Fo[F.namespaceURI]):!1},Me=function(F){arrayPush(e.removed,{element:F});try{y(F).removeChild(F)}catch{b(F)}},jn=function(F,U){try{arrayPush(e.removed,{attribute:U.getAttributeNode(F),from:U})}catch{arrayPush(e.removed,{attribute:null,from:U})}if(U.removeAttribute(F),F==="is"&&!G[F])if(Kt||zn)try{Me(U)}catch{}else try{U.setAttribute(F,"")}catch{}},ur=function(F){let U=null,Z=null;if(Mo)F="<remove></remove>"+F;else{const fe=stringMatch(F,/^[\r\n\t ]+/);Z=fe&&fe[0]}cn==="application/xhtml+xml"&&qt===Ue&&(F='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+F+"</body></html>");const se=w?w.createHTML(F):F;if(qt===Ue)try{U=new p().parseFromString(se,cn)}catch{}if(!U||!U.documentElement){U=x.createDocument(qt,"template",null);try{U.documentElement.innerHTML=Po?L:se}catch{}}const pe=U.body||U.documentElement;return F&&Z&&pe.insertBefore(t.createTextNode(Z),pe.childNodes[0]||null),qt===Ue?D.call(U,pt?"html":"body")[0]:pt?U.documentElement:pe},gr=function(F){return E.call(F.ownerDocument||F,F,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},fr=function(F){return F instanceof f&&(typeof F.nodeName!="string"||typeof F.textContent!="string"||typeof F.removeChild!="function"||!(F.attributes instanceof g)||typeof F.removeAttribute!="function"||typeof F.setAttribute!="function"||typeof F.namespaceURI!="string"||typeof F.insertBefore!="function"||typeof F.hasChildNodes!="function")},pr=function(F){return typeof c=="function"&&F instanceof c},Ke=function(F,U,Z){N[F]&&arrayForEach(N[F],se=>{se.call(e,U,Z,Zt)})},mr=function(F){let U=null;if(Ke("beforeSanitizeElements",F,null),fr(F))return Me(F),!0;const Z=ue(F.nodeName);if(Ke("uponSanitizeElement",F,{tagName:Z,allowedTags:K}),F.hasChildNodes()&&!pr(F.firstElementChild)&&regExpTest(/<[/\w]/g,F.innerHTML)&&regExpTest(/<[/\w]/g,F.textContent)||F.nodeType===NODE_TYPE.progressingInstruction||Ro&&F.nodeType===NODE_TYPE.comment&&regExpTest(/<[/\w]/g,F.data))return Me(F),!0;if(!K[Z]||ee[Z]){if(!ee[Z]&&Cr(Z)&&(Y.tagNameCheck instanceof RegExp&&regExpTest(Y.tagNameCheck,Z)||Y.tagNameCheck instanceof Function&&Y.tagNameCheck(Z)))return!1;if(Ao&&!jt[Z]){const se=y(F)||F.parentNode,pe=S(F)||F.childNodes;if(pe&&se){const fe=pe.length;for(let Ce=fe-1;Ce>=0;--Ce){const Ae=C(pe[Ce],!0);Ae.__removalCount=(F.__removalCount||0)+1,se.insertBefore(Ae,v(F))}}}return Me(F),!0}return F instanceof d&&!Pr(F)||(Z==="noscript"||Z==="noembed"||Z==="noframes")&&regExpTest(/<\/no(script|embed|frames)/i,F.innerHTML)?(Me(F),!0):(we&&F.nodeType===NODE_TYPE.text&&(U=F.textContent,arrayForEach([R,M,A],se=>{U=stringReplace(U,se," ")}),F.textContent!==U&&(arrayPush(e.removed,{element:F.cloneNode()}),F.textContent=U)),Ke("afterSanitizeElements",F,null),!1)},_r=function(F,U,Z){if(Jo&&(U==="id"||U==="name")&&(Z in t||Z in Ar))return!1;if(!(me&&!le[U]&&regExpTest(O,U))){if(!(ne&&regExpTest(P,U))){if(!G[U]||le[U]){if(!(Cr(F)&&(Y.tagNameCheck instanceof RegExp&&regExpTest(Y.tagNameCheck,F)||Y.tagNameCheck instanceof Function&&Y.tagNameCheck(F))&&(Y.attributeNameCheck instanceof RegExp&&regExpTest(Y.attributeNameCheck,U)||Y.attributeNameCheck instanceof Function&&Y.attributeNameCheck(U))||U==="is"&&Y.allowCustomizedBuiltInElements&&(Y.tagNameCheck instanceof RegExp&&regExpTest(Y.tagNameCheck,Z)||Y.tagNameCheck instanceof Function&&Y.tagNameCheck(Z))))return!1}else if(!Oo[U]){if(!regExpTest(V,stringReplace(Z,B,""))){if(!((U==="src"||U==="xlink:href"||U==="href")&&F!=="script"&&stringIndexOf(Z,"data:")===0&&ir[F])){if(!(ft&&!regExpTest(W,stringReplace(Z,B,"")))){if(Z)return!1}}}}}}return!0},Cr=function(F){return F!=="annotation-xml"&&stringMatch(F,H)},vr=function(F){Ke("beforeSanitizeAttributes",F,null);const{attributes:U}=F;if(!U)return;const Z={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:G};let se=U.length;for(;se--;){const pe=U[se],{name:fe,namespaceURI:Ce,value:Ae}=pe,dn=ue(fe);let _e=fe==="value"?Ae:stringTrim(Ae);if(Z.attrName=dn,Z.attrValue=_e,Z.keepAttr=!0,Z.forceKeepAttr=void 0,Ke("uponSanitizeAttribute",F,Z),_e=Z.attrValue,Z.forceKeepAttr||(jn(fe,F),!Z.keepAttr))continue;if(!he&&regExpTest(/\/>/i,_e)){jn(fe,F);continue}we&&arrayForEach([R,M,A],wr=>{_e=stringReplace(_e,wr," ")});const Sr=ue(F.nodeName);if(_r(Sr,dn,_e)){if(er&&(dn==="id"||dn==="name")&&(jn(fe,F),_e=kr+_e),Ro&&regExpTest(/((--!?|])>)|<\/(style|title)/i,_e)){jn(fe,F);continue}if(w&&typeof m=="object"&&typeof m.getAttributeType=="function"&&!Ce)switch(m.getAttributeType(Sr,dn)){case"TrustedHTML":{_e=w.createHTML(_e);break}case"TrustedScriptURL":{_e=w.createScriptURL(_e);break}}try{Ce?F.setAttributeNS(Ce,fe,_e):F.setAttribute(fe,_e),fr(F)?Me(F):arrayPop(e.removed)}catch{}}}Ke("afterSanitizeAttributes",F,null)},Fr=function Q(F){let U=null;const Z=gr(F);for(Ke("beforeSanitizeShadowDOM",F,null);U=Z.nextNode();)Ke("uponSanitizeShadowNode",U,null),!mr(U)&&(U.content instanceof r&&Q(U.content),vr(U));Ke("afterSanitizeShadowDOM",F,null)};return e.sanitize=function(Q){let F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},U=null,Z=null,se=null,pe=null;if(Po=!Q,Po&&(Q="<!-->"),typeof Q!="string"&&!pr(Q))if(typeof Q.toString=="function"){if(Q=Q.toString(),typeof Q!="string")throw typeErrorCreate("dirty is not a string, aborting")}else throw typeErrorCreate("toString is not a function");if(!e.isSupported)return Q;if(No||$o(F),e.removed=[],typeof Q=="string"&&(ln=!1),ln){if(Q.nodeName){const Ae=ue(Q.nodeName);if(!K[Ae]||ee[Ae])throw typeErrorCreate("root node is forbidden and cannot be sanitized in-place")}}else if(Q instanceof c)U=ur("<!---->"),Z=U.ownerDocument.importNode(Q,!0),Z.nodeType===NODE_TYPE.element&&Z.nodeName==="BODY"||Z.nodeName==="HTML"?U=Z:U.appendChild(Z);else{if(!Kt&&!we&&!pt&&Q.indexOf("<")===-1)return w&&Un?w.createHTML(Q):Q;if(U=ur(Q),!U)return Kt?null:Un?L:""}U&&Mo&&Me(U.firstChild);const fe=gr(ln?Q:U);for(;se=fe.nextNode();)mr(se)||(se.content instanceof r&&Fr(se.content),vr(se));if(ln)return Q;if(Kt){if(zn)for(pe=I.call(U.ownerDocument);U.firstChild;)pe.appendChild(U.firstChild);else pe=U;return(G.shadowroot||G.shadowrootmode)&&(pe=k.call(s,pe,!0)),pe}let Ce=pt?U.outerHTML:U.innerHTML;return pt&&K["!doctype"]&&U.ownerDocument&&U.ownerDocument.doctype&&U.ownerDocument.doctype.name&&regExpTest(DOCTYPE_NAME,U.ownerDocument.doctype.name)&&(Ce="<!DOCTYPE "+U.ownerDocument.doctype.name+`>
`+Ce),we&&arrayForEach([R,M,A],Ae=>{Ce=stringReplace(Ce,Ae," ")}),w&&Un?w.createHTML(Ce):Ce},e.setConfig=function(){let Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$o(Q),No=!0},e.clearConfig=function(){Zt=null,No=!1},e.isValidAttribute=function(Q,F,U){Zt||$o({});const Z=ue(Q),se=ue(F);return _r(Z,se,U)},e.addHook=function(Q,F){typeof F=="function"&&(N[Q]=N[Q]||[],arrayPush(N[Q],F))},e.removeHook=function(Q){if(N[Q])return arrayPop(N[Q])},e.removeHooks=function(Q){N[Q]&&(N[Q]=[])},e.removeAllHooks=function(){N={}},e}var purify=createDOMPurify();const basicMarkupHtmlTags=Object.freeze(["a","abbr","b","bdo","blockquote","br","caption","cite","code","col","colgroup","dd","del","details","dfn","div","dl","dt","em","figcaption","figure","h1","h2","h3","h4","h5","h6","hr","i","img","ins","kbd","label","li","mark","ol","p","pre","q","rp","rt","ruby","s","samp","small","small","source","span","strike","strong","sub","summary","sup","table","tbody","td","tfoot","th","thead","time","tr","tt","u","ul","var","video","wbr"]),defaultAllowedAttrs=Object.freeze(["href","target","src","alt","title","for","name","role","tabindex","x-dispatch","required","checked","placeholder","type","start","width","height","align"]),fakeRelativeUrlProtocol="vscode-relative-path";function validateLink(a,e){if(e.override==="*")return!0;try{const t=new URL(a,fakeRelativeUrlProtocol+"://");return!!(e.override.includes(t.protocol.replace(/:$/,""))||e.allowRelativePaths&&t.protocol===fakeRelativeUrlProtocol+":"&&!a.trim().toLowerCase().startsWith(fakeRelativeUrlProtocol))}catch{return!1}}function hookDomPurifyHrefAndSrcSanitizer(a,e){purify.addHook("afterSanitizeAttributes",t=>{for(const s of["href","src"])if(t.hasAttribute(s)){const o=t.getAttribute(s);s==="href"?!o.startsWith("#")&&!validateLink(o,a)&&t.removeAttribute(s):validateLink(o,e)||t.removeAttribute(s)}})}const defaultDomPurifyConfig=Object.freeze({ALLOWED_TAGS:[...basicMarkupHtmlTags],ALLOWED_ATTR:[...defaultAllowedAttrs],ALLOW_UNKNOWN_PROTOCOLS:!0});function sanitizeHtml(a,e){return doSanitizeHtml(a,e,"trusted")}function doSanitizeHtml(a,e,t){var s,o;try{const r={...defaultDomPurifyConfig};e!=null&&e.allowedTags&&(e.allowedTags.override&&(r.ALLOWED_TAGS=[...e.allowedTags.override]),e.allowedTags.augment&&(r.ALLOWED_TAGS=[...r.ALLOWED_TAGS??[],...e.allowedTags.augment]));let l=[...defaultAllowedAttrs];e!=null&&e.allowedAttributes&&(e.allowedAttributes.override&&(l=[...e.allowedAttributes.override]),e.allowedAttributes.augment&&(l=[...l,...e.allowedAttributes.augment])),l=l.map(u=>typeof u=="string"?u.toLowerCase():{attributeName:u.attributeName.toLowerCase(),shouldKeep:u.shouldKeep});const c=new Set(l.map(u=>typeof u=="string"?u:u.attributeName)),d=new Map;for(const u of l)typeof u=="string"?d.delete(u):d.set(u.attributeName,u);return r.ALLOWED_ATTR=Array.from(c),hookDomPurifyHrefAndSrcSanitizer({override:((s=e==null?void 0:e.allowedLinkProtocols)==null?void 0:s.override)??[Schemas.http,Schemas.https],allowRelativePaths:(e==null?void 0:e.allowRelativeLinkPaths)??!1},{override:((o=e==null?void 0:e.allowedMediaProtocols)==null?void 0:o.override)??[Schemas.http,Schemas.https],allowRelativePaths:(e==null?void 0:e.allowRelativeMediaPaths)??!1}),e!=null&&e.replaceWithPlaintext&&purify.addHook("uponSanitizeElement",replaceWithPlainTextHook),d.size&&purify.addHook("uponSanitizeAttribute",(u,g)=>{const f=d.get(g.attrName);if(f){const p=f.shouldKeep(u,g);typeof p=="string"?(g.keepAttr=!0,g.attrValue=p):g.keepAttr=p}else g.keepAttr=c.has(g.attrName)}),t==="dom"?purify.sanitize(a,{...r,RETURN_DOM_FRAGMENT:!0}):purify.sanitize(a,{...r,RETURN_TRUSTED_TYPE:!0})}finally{purify.removeAllHooks()}}const selfClosingTags=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];function replaceWithPlainTextHook(a,e,t){var s,o;if(!e.allowedTags[e.tagName]&&e.tagName!=="body"){const r=convertTagToPlaintext(a);a.nodeType===Node.COMMENT_NODE?(s=a.parentElement)==null||s.insertBefore(r,a):(o=a.parentElement)==null||o.replaceChild(r,a)}}function convertTagToPlaintext(a){let e,t;if(a.nodeType===Node.COMMENT_NODE)e=`<!--${a.textContent}-->`;else{const l=a.tagName.toLowerCase(),c=selfClosingTags.includes(l),d=a.attributes.length?" "+Array.from(a.attributes).map(u=>`${u.name}="${u.value}"`).join(" "):"";e=`<${l}${d}>`,c||(t=`</${l}>`)}const s=document.createDocumentFragment(),o=a.ownerDocument.createTextNode(e);for(s.appendChild(o);a.firstChild;)s.appendChild(a.firstChild);const r=t?a.ownerDocument.createTextNode(t):void 0;return r&&s.appendChild(r),s}function safeSetInnerHtml(a,e,t){const s=doSanitizeHtml(e,t,"dom");reset(a,s)}const labelWithIconsRegex=new RegExp(`(\\\\)?\\$\\((${ThemeIcon.iconNameExpression}(?:${ThemeIcon.iconModifierExpression})?)\\)`,"g");function renderLabelWithIcons(a){const e=new Array;let t,s=0,o=0;for(;(t=labelWithIconsRegex.exec(a))!==null;){o=t.index||0,s<o&&e.push(a.substring(s,o)),s=(t.index||0)+t[0].length;const[,r,l]=t;e.push(r?`$(${l})`:renderIcon({id:l}))}return s<a.length&&e.push(a.substring(s)),e}function renderIcon(a){const e=$$l("span");return e.classList.add(...ThemeIcon.asClassNameArray(a)),e}const defaultMarkedRenderers=Object.freeze({image:({href:a,title:e,text:t})=>{let s=[],o=[];return a&&({href:a,dimensions:s}=parseHrefAndDimensions(a),o.push(`src="${escapeDoubleQuotes(a)}"`)),t&&o.push(`alt="${escapeDoubleQuotes(t)}"`),e&&o.push(`title="${escapeDoubleQuotes(e)}"`),s.length&&(o=o.concat(s)),"<img "+o.join(" ")+">"},paragraph({tokens:a}){return`<p>${this.parser.parseInline(a)}</p>`},link({href:a,title:e,tokens:t}){let s=this.parser.parseInline(t);return typeof a!="string"?"":(a===s&&(s=removeMarkdownEscapes(s)),e=typeof e=="string"?escapeDoubleQuotes(removeMarkdownEscapes(e)):"",a=removeMarkdownEscapes(a),a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),`<a href="${a}" title="${e||a}" draggable="false">${s}</a>`)}});function renderMarkdown$1(a,e={},t){var _,C,b;const s=new DisposableStore;let o=!1;const r=new Marked(...e.markedExtensions??[]),{renderer:l,codeBlocks:c,syncCodeBlocks:d}=createMarkdownRenderer(r,e,a),u=preprocessMarkdownString(a);let g;if(e.fillInIncompleteTokens){const v={...r.defaults,...e.markedOptions,renderer:l},S=r.lexer(u,v),y=fillInIncompleteTokens(S);g=r.parser(y,v)}else g=r.parse(u,{...e==null?void 0:e.markedOptions,renderer:l,async:!1});a.supportThemeIcons&&(g=renderLabelWithIcons(g).map(S=>typeof S=="string"?S:S.outerHTML).join(""));const f=document.createElement("div"),p=getDomSanitizerConfig(a,e.sanitizerConfig??{});safeSetInnerHtml(f,g,p),rewriteRenderedLinks(a,e,f);let m;if(t?(m=t,reset(t,...f.children)):m=f,c.length>0)Promise.all(c).then(v=>{var w;if(o)return;const S=new Map(v),y=m.querySelectorAll("div[data-code]");for(const L of y){const x=S.get(L.dataset.code??"");x&&reset(L,x)}(w=e.asyncRenderCallback)==null||w.call(e)});else if(d.length>0){const v=new Map(d),S=m.querySelectorAll("div[data-code]");for(const y of S){const w=v.get(y.dataset.code??"");w&&reset(y,w)}}if(e.asyncRenderCallback)for(const v of m.getElementsByTagName("img")){const S=s.add(addDisposableListener(v,"load",()=>{S.dispose(),e.asyncRenderCallback()}))}if(e.actionHandler){const v=S=>{const y=new StandardMouseEvent(getWindow(m),S);!y.leftButton&&!y.middleButton||activateLink(a,e,y)};s.add(addDisposableListener(m,"click",v)),s.add(addDisposableListener(m,"auxclick",v)),s.add(addDisposableListener(m,"keydown",S=>{const y=new StandardKeyboardEvent(S);!y.equals(10)&&!y.equals(3)||activateLink(a,e,y)}))}for(const v of[...m.getElementsByTagName("input")])if(((_=v.attributes.getNamedItem("type"))==null?void 0:_.value)==="checkbox")v.setAttribute("disabled","");else if((C=e.sanitizerConfig)!=null&&C.replaceWithPlaintext){const S=convertTagToPlaintext(v);(b=v.parentElement)==null||b.replaceChild(S,v)}else v.remove();return{element:m,dispose:()=>{o=!0,s.dispose()}}}function rewriteRenderedLinks(a,e,t){var s;for(const o of t.querySelectorAll("img, audio, video, source")){const r=o.getAttribute("src");if(r){let l=r;try{a.baseUri&&(l=resolveWithBaseUri(URI.from(a.baseUri),l))}catch{}if(o.setAttribute("src",massageHref(a,l,!0)),(s=e.sanitizerConfig)!=null&&s.remoteImageIsAllowed){const c=URI.parse(l);c.scheme!==Schemas.file&&c.scheme!==Schemas.data&&!e.sanitizerConfig.remoteImageIsAllowed(c)&&o.replaceWith($$l("",void 0,o.outerHTML))}}}for(const o of t.querySelectorAll("a")){const r=o.getAttribute("href");if(o.setAttribute("href",""),!r||/^data:|javascript:/i.test(r)||/^command:/i.test(r)&&!a.isTrusted||/^command:(\/\/\/)?_workbench\.downloadResource/i.test(r))o.replaceWith(...o.childNodes);else{let l=massageHref(a,r,!1);a.baseUri&&(l=resolveWithBaseUri(URI.from(a.baseUri),r)),o.dataset.href=l}}}function createMarkdownRenderer(a,e,t){const s=new a.Renderer(e.markedOptions);s.image=defaultMarkedRenderers.image,s.link=defaultMarkedRenderers.link,s.paragraph=defaultMarkedRenderers.paragraph;const o=[],r=[];return e.codeBlockRendererSync?s.code=({text:l,lang:c,raw:d})=>{const u=defaultGenerator.nextId(),g=e.codeBlockRendererSync(postProcessCodeBlockLanguageId(c),l,d);return r.push([u,g]),`<div class="code" data-code="${u}">${escape$2(l)}</div>`}:e.codeBlockRenderer&&(s.code=({text:l,lang:c})=>{const d=defaultGenerator.nextId(),u=e.codeBlockRenderer(postProcessCodeBlockLanguageId(c),l);return o.push(u.then(g=>[d,g])),`<div class="code" data-code="${d}">${escape$2(l)}</div>`}),t.supportHtml||(s.html=({text:l})=>{var d;return(d=e.sanitizerConfig)!=null&&d.replaceWithPlaintext?escape$2(l):(t.isTrusted?l.match(/^(<span[^>]+>)|(<\/\s*span>)$/):void 0)?l:""}),{renderer:s,codeBlocks:o,syncCodeBlocks:r}}function preprocessMarkdownString(a){let e=a.value;return e.length>1e5&&(e=`${e.substr(0,1e5)}…`),a.supportThemeIcons&&(e=markdownEscapeEscapedIcons(e)),e}function activateLink(a,e,t){var o;const s=t.target.closest("a[data-href]");if(isHTMLElement(s))try{let r=s.dataset.href;r&&(a.baseUri&&(r=resolveWithBaseUri(URI.from(a.baseUri),r)),(o=e.actionHandler)==null||o.call(e,r,a))}catch(r){onUnexpectedError(r)}finally{t.preventDefault()}}function uriMassage(a,e){let t;try{t=parse$1(decodeURIComponent(e))}catch{}return t?(t=cloneAndChange(t,s=>{if(a.uris&&a.uris[s])return URI.revive(a.uris[s])}),encodeURIComponent(JSON.stringify(t))):e}function massageHref(a,e,t){const s=a.uris&&a.uris[e];let o=URI.revive(s);return t?e.startsWith(Schemas.data+":")?e:(o||(o=URI.parse(e)),FileAccess.uriToBrowserUri(o).toString(!0)):!o||URI.parse(e).toString()===o.toString()?e:(o.query&&(o=o.with({query:uriMassage(a,o.query)})),o.toString())}function postProcessCodeBlockLanguageId(a){if(!a)return"";const e=a.split(/[\s+|:|,|\{|\?]/,1);return e.length?e[0]:a}function resolveWithBaseUri(a,e){return/^\w[\w\d+.-]*:/.test(e)?e:a.path.endsWith("/")?resolvePath(a,e).toString():resolvePath(dirname(a),e).toString()}function sanitizeRenderedMarkdown(a,e,t={}){const s=getDomSanitizerConfig(e,t);return sanitizeHtml(a,s)}const allowedMarkdownHtmlTags=Object.freeze([...basicMarkupHtmlTags,"input"]),allowedMarkdownHtmlAttributes=Object.freeze(["align","autoplay","alt","colspan","controls","draggable","height","href","loop","muted","playsinline","poster","rowspan","src","target","title","type","width","start","checked","disabled","value","data-code","data-href",{attributeName:"style",shouldKeep:(a,e)=>a.tagName==="SPAN"&&e.attrName==="style"?/^(color\:(#[0-9a-fA-F]+|var\(--vscode(-[a-zA-Z0-9]+)+\));)?(background-color\:(#[0-9a-fA-F]+|var\(--vscode(-[a-zA-Z0-9]+)+\));)?(border-radius:[0-9]+px;)?$/.test(e.attrValue):!1},{attributeName:"class",shouldKeep:(a,e)=>a.tagName==="SPAN"&&e.attrName==="class"?/^codicon codicon-[a-z\-]+( codicon-modifier-[a-z\-]+)?$/.test(e.attrValue):!1}]);function getDomSanitizerConfig(a,e){var o,r,l;const t=a.isTrusted??!1,s=[Schemas.http,Schemas.https,Schemas.mailto,Schemas.file,Schemas.vscodeFileResource,Schemas.vscodeRemote,Schemas.vscodeRemoteResource,Schemas.vscodeNotebookCell];return t&&s.push(Schemas.command),(o=e.allowedLinkSchemes)!=null&&o.augment&&s.push(...e.allowedLinkSchemes.augment),{allowedTags:{override:((r=e.allowedTags)==null?void 0:r.override)??allowedMarkdownHtmlTags},allowedAttributes:{override:((l=e.allowedAttributes)==null?void 0:l.override)??allowedMarkdownHtmlAttributes},allowedLinkProtocols:{override:s},allowRelativeLinkPaths:!!a.baseUri,allowedMediaProtocols:{override:[Schemas.http,Schemas.https,Schemas.data,Schemas.file,Schemas.vscodeFileResource,Schemas.vscodeRemote,Schemas.vscodeRemoteResource]},replaceWithPlaintext:e.replaceWithPlaintext}}function renderAsPlaintext(a,e){if(typeof a=="string")return a;let t=a.value??"";t.length>1e5&&(t=`${t.substr(0,1e5)}…`);const s=parse$2(t,{async:!1,renderer:e!=null&&e.includeCodeBlocksFences?plainTextWithCodeBlocksRenderer.value:plainTextRenderer.value});return sanitizeRenderedMarkdown(s,{isTrusted:!1},{}).toString().replace(/&(#\d+|[a-zA-Z]+);/g,o=>unescapeInfo.get(o)??o).trim()}const unescapeInfo=new Map([["&quot;",'"'],["&nbsp;"," "],["&amp;","&"],["&#39;","'"],["&lt;","<"],["&gt;",">"]]);function createPlainTextRenderer(){const a=new _Renderer;return a.code=({text:e})=>escape$2(e),a.blockquote=({text:e})=>e+`
`,a.html=e=>"",a.heading=function({tokens:e}){return this.parser.parseInline(e)+`
`},a.hr=()=>"",a.list=function({items:e}){return e.map(t=>this.listitem(t)).join(`
`)+`
`},a.listitem=({text:e})=>e+`
`,a.paragraph=function({tokens:e}){return this.parser.parseInline(e)+`
`},a.table=function({header:e,rows:t}){return e.map(s=>this.tablecell(s)).join(" ")+`
`+t.map(s=>s.map(o=>this.tablecell(o)).join(" ")).join(`
`)+`
`},a.tablerow=({text:e})=>e,a.tablecell=function({tokens:e}){return this.parser.parseInline(e)},a.strong=({text:e})=>e,a.em=({text:e})=>e,a.codespan=({text:e})=>escape$2(e),a.br=e=>`
`,a.del=({text:e})=>e,a.image=e=>"",a.text=({text:e})=>e,a.link=({text:e})=>e,a}const plainTextRenderer=new Lazy(createPlainTextRenderer),plainTextWithCodeBlocksRenderer=new Lazy(()=>{const a=createPlainTextRenderer();return a.code=({text:e})=>`
\`\`\`
${escape$2(e)}
\`\`\`
`,a});function mergeRawTokenText(a){let e="";return a.forEach(t=>{e+=t.raw}),e}function completeSingleLinePattern(a){var e,t;if(a.tokens)for(let s=a.tokens.length-1;s>=0;s--){const o=a.tokens[s];if(o.type==="text"){const r=o.raw.split(`
`),l=r[r.length-1];if(l.includes("`"))return completeCodespan(a);if(l.includes("**"))return completeDoublestar(a);if(l.match(/\*\w/))return completeStar(a);if(l.match(/(^|\s)__\w/))return completeDoubleUnderscore(a);if(l.match(/(^|\s)_\w/))return completeUnderscore(a);if(hasLinkTextAndStartOfLinkTarget(l)||hasStartOfLinkTargetAndNoLinkText(l)&&a.tokens.slice(0,s).some(c=>c.type==="text"&&c.raw.match(/\[[^\]]*$/))){const c=a.tokens.slice(s+1);return((e=c[0])==null?void 0:e.type)==="link"&&((t=c[1])==null?void 0:t.type)==="text"&&c[1].raw.match(/^ *"[^"]*$/)||l.match(/^[^"]* +"[^"]*$/)?completeLinkTargetArg(a):completeLinkTarget(a)}else if(l.match(/(^|\s)\[\w*[^\]]*$/))return completeLinkText(a)}}}function hasLinkTextAndStartOfLinkTarget(a){return!!a.match(/(^|\s)\[.*\]\(\w*/)}function hasStartOfLinkTargetAndNoLinkText(a){return!!a.match(/^[^\[]*\]\([^\)]*$/)}function completeListItemPattern(a){var u;const e=a.items[a.items.length-1],t=e.tokens?e.tokens[e.tokens.length-1]:void 0,s=g=>{const f=g.items.at(-1),p=f==null?void 0:f.tokens.at(-1);return(p==null?void 0:p.type)==="heading"||(p==null?void 0:p.type)==="list"&&s(p)};let o;if((t==null?void 0:t.type)==="text"&&!("inRawBlock"in e))o=completeSingleLinePattern(t);else if(s(a)){const g=lexer(a.raw.trim()+" &nbsp;")[0];return g.type!=="list"?void 0:g}if(!o||o.type!=="paragraph")return;const r=mergeRawTokenText(a.items.slice(0,-1)),l=(u=e.raw.match(/^(\s*(-|\d+\.|\*) +)/))==null?void 0:u[0];if(!l)return;const c=l+mergeRawTokenText(e.tokens.slice(0,-1))+o.raw,d=lexer(r+c)[0];if(d.type==="list")return d}function completeHeading(a,e){if(a.raw.match(/-\s*$/))return lexer(e+" &nbsp;")}const maxIncompleteTokensFixRounds=3;function fillInIncompleteTokens(a){for(let e=0;e<maxIncompleteTokensFixRounds;e++){const t=fillInIncompleteTokensOnce(a);if(t)a=t;else break}return a}function fillInIncompleteTokensOnce(a){let e,t;for(e=0;e<a.length;e++){const o=a[e];if(o.type==="paragraph"&&o.raw.match(/(\n|^)\|/)){t=completeTable(a.slice(e));break}}const s=a.at(-1);if(!t&&(s==null?void 0:s.type)==="list"){const o=completeListItemPattern(s);o&&(t=[o],e=a.length-1)}if(!t&&(s==null?void 0:s.type)==="paragraph"){const o=completeSingleLinePattern(s);o&&(t=[o],e=a.length-1)}if(t){const o=[...a.slice(0,e),...t];return o.links=a.links,o}if((s==null?void 0:s.type)==="heading"){const o=completeHeading(s,mergeRawTokenText(a));if(o)return o}return null}function completeCodespan(a){return completeWithString(a,"`")}function completeStar(a){return completeWithString(a,"*")}function completeUnderscore(a){return completeWithString(a,"_")}function completeLinkTarget(a){return completeWithString(a,")",!1)}function completeLinkTargetArg(a){return completeWithString(a,'")',!1)}function completeLinkText(a){return completeWithString(a,"](https://microsoft.com)",!1)}function completeDoublestar(a){return completeWithString(a,"**")}function completeDoubleUnderscore(a){return completeWithString(a,"__")}function completeWithString(a,e,t=!0){const s=mergeRawTokenText(Array.isArray(a)?a:[a]),o=t?s.trimEnd():s;return lexer(o+e)[0]}function completeTable(a){const e=mergeRawTokenText(a),t=e.split(`
`);let s,o=!1;for(let r=0;r<t.length;r++){const l=t[r].trim();if(typeof s>"u"&&l.match(/^\s*\|/)){const c=l.match(/(\|[^\|]+)(?=\||$)/g);c&&(s=c.length)}else if(typeof s=="number")if(l.match(/^\s*\|/)){if(r!==t.length-1)return;o=!0}else return}if(typeof s=="number"&&s>0){const r=o?t.slice(0,-1).join(`
`):e,l=!!r.match(/\|\s*$/),c=r+(l?"":"|")+`
|${" --- |".repeat(s)}`;return lexer(c)}}let baseHoverDelegate={showInstantHover:()=>{},showDelayedHover:()=>{},setupDelayedHover:()=>Disposable.None,setupDelayedHoverAtMouse:()=>Disposable.None,hideHover:()=>{},showAndFocusLastHover:()=>{},setupManagedHover:()=>({dispose:()=>{},show:()=>{},hide:()=>{},update:()=>{}}),showManagedHover:()=>{}};function setBaseLayerHoverDelegate(a){baseHoverDelegate=a}function getBaseLayerHoverDelegate(){return baseHoverDelegate}class CombinedSpliceable{constructor(e){this.spliceables=e}splice(e,t,s){this.spliceables.forEach(o=>o.splice(e,t,s))}}function clamp(a,e,t){return Math.min(Math.max(a,e),t)}class MovingAverage{constructor(){this._n=1,this._val=0}update(e){return this._val=this._val+(e-this._val)/this._n,this._n+=1,this._val}get value(){return this._val}}class SlidingWindowAverage{constructor(e){this._n=0,this._val=0,this._values=[],this._index=0,this._sum=0,this._values=new Array(e),this._values.fill(0,0,e)}update(e){const t=this._values[this._index];return this._values[this._index]=e,this._index=(this._index+1)%this._values.length,this._sum-=t,this._sum+=e,this._n<this._values.length&&(this._n+=1),this._val=this._sum/this._n,this._val}get value(){return this._val}}const list="";class ListError extends Error{constructor(e,t){super(`ListError [${e}] ${t}`)}}var Range$1;(function(a){function e(r,l){if(r.start>=l.end||l.start>=r.end)return{start:0,end:0};const c=Math.max(r.start,l.start),d=Math.min(r.end,l.end);return d-c<=0?{start:0,end:0}:{start:c,end:d}}a.intersect=e;function t(r){return r.end-r.start<=0}a.isEmpty=t;function s(r,l){return!t(e(r,l))}a.intersects=s;function o(r,l){const c=[],d={start:r.start,end:Math.min(l.start,r.end)},u={start:Math.max(l.end,r.start),end:r.end};return t(d)||c.push(d),t(u)||c.push(u),c}a.relativeComplement=o})(Range$1||(Range$1={}));function groupIntersect(a,e){const t=[];for(const s of e){if(a.start>=s.range.end)continue;if(a.end<s.range.start)break;const o=Range$1.intersect(a,s.range);Range$1.isEmpty(o)||t.push({range:o,size:s.size})}return t}function shift({start:a,end:e},t){return{start:a+t,end:e+t}}function consolidate(a){const e=[];let t=null;for(const s of a){const o=s.range.start,r=s.range.end,l=s.size;if(t&&l===t.size){t.range.end=r;continue}t={range:{start:o,end:r},size:l},e.push(t)}return e}function concat(...a){return consolidate(a.reduce((e,t)=>e.concat(t),[]))}class RangeMap{get paddingTop(){return this._paddingTop}set paddingTop(e){this._size=this._size+e-this._paddingTop,this._paddingTop=e}constructor(e){this.groups=[],this._size=0,this._paddingTop=0,this._paddingTop=e??0,this._size=this._paddingTop}splice(e,t,s=[]){const o=s.length-t,r=groupIntersect({start:0,end:e},this.groups),l=groupIntersect({start:e+t,end:Number.POSITIVE_INFINITY},this.groups).map(d=>({range:shift(d.range,o),size:d.size})),c=s.map((d,u)=>({range:{start:e+u,end:e+u+1},size:d.size}));this.groups=concat(r,c,l),this._size=this._paddingTop+this.groups.reduce((d,u)=>d+u.size*(u.range.end-u.range.start),0)}get count(){const e=this.groups.length;return e?this.groups[e-1].range.end:0}get size(){return this._size}indexAt(e){if(e<0)return-1;if(e<this._paddingTop)return 0;let t=0,s=this._paddingTop;for(const o of this.groups){const r=o.range.end-o.range.start,l=s+r*o.size;if(e<l)return t+Math.floor((e-s)/o.size);t+=r,s=l}return t}indexAfter(e){return Math.min(this.indexAt(e)+1,this.count)}positionAt(e){if(e<0)return-1;let t=0,s=0;for(const o of this.groups){const r=o.range.end-o.range.start,l=s+r;if(e<l)return this._paddingTop+t+(e-s)*o.size;t+=r*o.size,s=l}return-1}}class RowCache{constructor(e){this.renderers=e,this.cache=new Map,this.transactionNodesPendingRemoval=new Set,this.inTransaction=!1}alloc(e){let t=this.getTemplateCache(e).pop(),s=!1;if(t)s=this.transactionNodesPendingRemoval.has(t.domNode),s&&this.transactionNodesPendingRemoval.delete(t.domNode);else{const o=$$l(".monaco-list-row"),l=this.getRenderer(e).renderTemplate(o);t={domNode:o,templateId:e,templateData:l}}return{row:t,isReusingConnectedDomNode:s}}release(e){e&&this.releaseRow(e)}transact(e){if(this.inTransaction)throw new Error("Already in transaction");this.inTransaction=!0;try{e()}finally{for(const t of this.transactionNodesPendingRemoval)this.doRemoveNode(t);this.transactionNodesPendingRemoval.clear(),this.inTransaction=!1}}releaseRow(e){const{domNode:t,templateId:s}=e;t&&(this.inTransaction?this.transactionNodesPendingRemoval.add(t):this.doRemoveNode(t)),this.getTemplateCache(s).push(e)}doRemoveNode(e){e.classList.remove("scrolling"),e.remove()}getTemplateCache(e){let t=this.cache.get(e);return t||(t=[],this.cache.set(e,t)),t}dispose(){this.cache.forEach((e,t)=>{for(const s of e)this.getRenderer(t).disposeTemplate(s.templateData),s.templateData=null}),this.cache.clear(),this.transactionNodesPendingRemoval.clear()}getRenderer(e){const t=this.renderers.get(e);if(!t)throw new Error(`No renderer found for ${e}`);return t}}const dnd$1="";function applyDragImage(a,e,t,s=[]){if(!a.dataTransfer)return;const o=$$l(".monaco-drag-image");o.textContent=t,o.classList.add(...s),(c=>{for(;c&&!c.classList.contains("monaco-workbench");)c=c.parentElement;return c||e.ownerDocument.body})(e).appendChild(o),a.dataTransfer.setDragImage(o,-10,-10),setTimeout(()=>o.remove(),0)}var __decorate$2z=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};const StaticDND={CurrentDragAndDropData:void 0},DefaultOptions$1={useShadows:!0,verticalScrollMode:1,setRowLineHeight:!0,setRowHeight:!0,supportDynamicHeights:!1,dnd:{getDragElements(a){return[a]},getDragURI(){return null},onDragStart(){},onDragOver(){return!1},drop(){},dispose(){}},horizontalScrolling:!1,transformOptimization:!0,alwaysConsumeMouseWheel:!0};class ElementsDragAndDropData{constructor(e){this.elements=e}update(){}getData(){return this.elements}}class ExternalElementsDragAndDropData{constructor(e){this.elements=e}update(){}getData(){return this.elements}}class NativeDragAndDropData{constructor(){this.types=[],this.files=[]}update(e){if(e.types&&this.types.splice(0,this.types.length,...e.types),e.files){this.files.splice(0,this.files.length);for(let t=0;t<e.files.length;t++){const s=e.files.item(t);s&&(s.size||s.type)&&this.files.push(s)}}}getData(){return{types:this.types,files:this.files}}}function equalsDragFeedback(a,e){return Array.isArray(a)&&Array.isArray(e)?equals$1(a,e):a===e}class ListViewAccessibilityProvider{constructor(e){e!=null&&e.getSetSize?this.getSetSize=e.getSetSize.bind(e):this.getSetSize=(t,s,o)=>o,e!=null&&e.getPosInSet?this.getPosInSet=e.getPosInSet.bind(e):this.getPosInSet=(t,s)=>s+1,e!=null&&e.getRole?this.getRole=e.getRole.bind(e):this.getRole=t=>"listitem",e!=null&&e.isChecked?this.isChecked=e.isChecked.bind(e):this.isChecked=t=>{}}}const Cs=class Cs{get contentHeight(){return this.rangeMap.size}get onDidScroll(){return this.scrollableElement.onScroll}get scrollableElementDomNode(){return this.scrollableElement.getDomNode()}get horizontalScrolling(){return this._horizontalScrolling}set horizontalScrolling(e){if(e!==this._horizontalScrolling){if(e&&this.supportDynamicHeights)throw new Error("Horizontal scrolling and dynamic heights not supported simultaneously");if(this._horizontalScrolling=e,this.domNode.classList.toggle("horizontal-scrolling",this._horizontalScrolling),this._horizontalScrolling){for(const t of this.items)this.measureItemWidth(t);this.updateScrollWidth(),this.scrollableElement.setScrollDimensions({width:getContentWidth(this.domNode)}),this.rowsContainer.style.width=`${Math.max(this.scrollWidth||0,this.renderWidth)}px`}else this.scrollableElementWidthDelayer.cancel(),this.scrollableElement.setScrollDimensions({width:this.renderWidth,scrollWidth:this.renderWidth}),this.rowsContainer.style.width=""}}constructor(e,t,s,o=DefaultOptions$1){var l,c;if(this.virtualDelegate=t,this.domId=`list_id_${++Cs.InstanceCount}`,this.renderers=new Map,this.renderWidth=0,this._scrollHeight=0,this.scrollableElementUpdateDisposable=null,this.scrollableElementWidthDelayer=new Delayer(50),this.splicing=!1,this.dragOverAnimationStopDisposable=Disposable.None,this.dragOverMouseY=0,this.canDrop=!1,this.currentDragFeedbackDisposable=Disposable.None,this.onDragLeaveTimeout=Disposable.None,this.currentSelectionDisposable=Disposable.None,this.disposables=new DisposableStore,this._onDidChangeContentHeight=new Emitter$1,this._onDidChangeContentWidth=new Emitter$1,this.onDidChangeContentHeight=Event$1.latch(this._onDidChangeContentHeight.event,void 0,this.disposables),this._horizontalScrolling=!1,o.horizontalScrolling&&o.supportDynamicHeights)throw new Error("Horizontal scrolling and dynamic heights not supported simultaneously");this.items=[],this.itemId=0,this.rangeMap=this.createRangeMap(o.paddingTop??0);for(const d of s)this.renderers.set(d.templateId,d);if(this.cache=this.disposables.add(new RowCache(this.renderers)),this.lastRenderTop=0,this.lastRenderHeight=0,this.domNode=document.createElement("div"),this.domNode.className="monaco-list",this.domNode.classList.add(this.domId),this.domNode.tabIndex=0,this.domNode.classList.toggle("mouse-support",typeof o.mouseSupport=="boolean"?o.mouseSupport:!0),this._horizontalScrolling=o.horizontalScrolling??DefaultOptions$1.horizontalScrolling,this.domNode.classList.toggle("horizontal-scrolling",this._horizontalScrolling),this.paddingBottom=typeof o.paddingBottom>"u"?0:o.paddingBottom,this.accessibilityProvider=new ListViewAccessibilityProvider(o.accessibilityProvider),this.rowsContainer=document.createElement("div"),this.rowsContainer.className="monaco-list-rows",(o.transformOptimization??DefaultOptions$1.transformOptimization)&&(this.rowsContainer.style.transform="translate3d(0px, 0px, 0px)",this.rowsContainer.style.overflow="hidden",this.rowsContainer.style.contain="strict"),this.disposables.add(Gesture.addTarget(this.rowsContainer)),this.scrollable=this.disposables.add(new Scrollable({forceIntegerValues:!0,smoothScrollDuration:o.smoothScrolling??!1?125:0,scheduleAtNextAnimationFrame:d=>scheduleAtNextAnimationFrame(getWindow(this.domNode),d)})),this.scrollableElement=this.disposables.add(new SmoothScrollableElement(this.rowsContainer,{alwaysConsumeMouseWheel:o.alwaysConsumeMouseWheel??DefaultOptions$1.alwaysConsumeMouseWheel,horizontal:1,vertical:o.verticalScrollMode??DefaultOptions$1.verticalScrollMode,useShadows:o.useShadows??DefaultOptions$1.useShadows,mouseWheelScrollSensitivity:o.mouseWheelScrollSensitivity,fastScrollSensitivity:o.fastScrollSensitivity,scrollByPage:o.scrollByPage},this.scrollable)),this.domNode.appendChild(this.scrollableElement.getDomNode()),e.appendChild(this.domNode),this.scrollableElement.onScroll(this.onScroll,this,this.disposables),this.disposables.add(addDisposableListener(this.rowsContainer,EventType.Change,d=>this.onTouchChange(d))),this.disposables.add(addDisposableListener(this.scrollableElement.getDomNode(),"scroll",d=>{const u=d.target,g=u.scrollTop;u.scrollTop=0,o.scrollToActiveElement&&this.setScrollTop(this.scrollTop+g)})),this.disposables.add(addDisposableListener(this.domNode,"dragover",d=>this.onDragOver(this.toDragEvent(d)))),this.disposables.add(addDisposableListener(this.domNode,"drop",d=>this.onDrop(this.toDragEvent(d)))),this.disposables.add(addDisposableListener(this.domNode,"dragleave",d=>this.onDragLeave(this.toDragEvent(d)))),this.disposables.add(addDisposableListener(this.domNode,"dragend",d=>this.onDragEnd(d))),o.userSelection){if(o.dnd)throw new Error("DND and user selection cannot be used simultaneously");this.disposables.add(addDisposableListener(this.domNode,"mousedown",d=>this.onPotentialSelectionStart(d)))}this.setRowLineHeight=o.setRowLineHeight??DefaultOptions$1.setRowLineHeight,this.setRowHeight=o.setRowHeight??DefaultOptions$1.setRowHeight,this.supportDynamicHeights=o.supportDynamicHeights??DefaultOptions$1.supportDynamicHeights,this.dnd=o.dnd??this.disposables.add(DefaultOptions$1.dnd),this.layout((l=o.initialSize)==null?void 0:l.height,(c=o.initialSize)==null?void 0:c.width),o.scrollToActiveElement&&this._setupFocusObserver(e)}_setupFocusObserver(e){this.disposables.add(addDisposableListener(e,"focus",()=>{const t=getActiveElement();this.activeElement!==t&&t!==null&&(this.activeElement=t,this._scrollToActiveElement(this.activeElement,e))},!0))}_scrollToActiveElement(e,t){const s=t.getBoundingClientRect(),r=e.getBoundingClientRect().top-s.top;r<0&&this.setScrollTop(this.scrollTop+r)}updateOptions(e){e.paddingBottom!==void 0&&(this.paddingBottom=e.paddingBottom,this.scrollableElement.setScrollDimensions({scrollHeight:this.scrollHeight})),e.smoothScrolling!==void 0&&this.scrollable.setSmoothScrollDuration(e.smoothScrolling?125:0),e.horizontalScrolling!==void 0&&(this.horizontalScrolling=e.horizontalScrolling);let t;if(e.scrollByPage!==void 0&&(t={...t??{},scrollByPage:e.scrollByPage}),e.mouseWheelScrollSensitivity!==void 0&&(t={...t??{},mouseWheelScrollSensitivity:e.mouseWheelScrollSensitivity}),e.fastScrollSensitivity!==void 0&&(t={...t??{},fastScrollSensitivity:e.fastScrollSensitivity}),t&&this.scrollableElement.updateOptions(t),e.paddingTop!==void 0&&e.paddingTop!==this.rangeMap.paddingTop){const s=this.getRenderRange(this.lastRenderTop,this.lastRenderHeight),o=e.paddingTop-this.rangeMap.paddingTop;this.rangeMap.paddingTop=e.paddingTop,this.render(s,Math.max(0,this.lastRenderTop+o),this.lastRenderHeight,void 0,void 0,!0),this.setScrollTop(this.lastRenderTop),this.eventuallyUpdateScrollDimensions(),this.supportDynamicHeights&&this._rerender(this.lastRenderTop,this.lastRenderHeight)}}createRangeMap(e){return new RangeMap(e)}splice(e,t,s=[]){if(this.splicing)throw new Error("Can't run recursive splices.");this.splicing=!0;try{return this._splice(e,t,s)}finally{this.splicing=!1,this._onDidChangeContentHeight.fire(this.contentHeight)}}_splice(e,t,s=[]){const o=this.getRenderRange(this.lastRenderTop,this.lastRenderHeight),r={start:e,end:e+t},l=Range$1.intersect(o,r),c=new Map;for(let L=l.end-1;L>=l.start;L--){const x=this.items[L];if(x.dragStartDisposable.dispose(),x.checkedDisposable.dispose(),x.row){let E=c.get(x.templateId);E||(E=[],c.set(x.templateId,E));const I=this.renderers.get(x.templateId);I&&I.disposeElement&&I.disposeElement(x.element,L,x.row.templateData,{height:x.size}),E.unshift(x.row)}x.row=null,x.stale=!0}const d={start:e+t,end:this.items.length},u=Range$1.intersect(d,o),g=Range$1.relativeComplement(d,o),f=s.map(L=>({id:String(this.itemId++),element:L,templateId:this.virtualDelegate.getTemplateId(L),size:this.virtualDelegate.getHeight(L),width:void 0,hasDynamicHeight:!!this.virtualDelegate.hasDynamicHeight&&this.virtualDelegate.hasDynamicHeight(L),lastDynamicHeightWidth:void 0,row:null,uri:void 0,dropTarget:!1,dragStartDisposable:Disposable.None,checkedDisposable:Disposable.None,stale:!1}));let p;e===0&&t>=this.items.length?(this.rangeMap=this.createRangeMap(this.rangeMap.paddingTop),this.rangeMap.splice(0,0,f),p=this.items,this.items=f):(this.rangeMap.splice(e,t,f),p=splice$1(this.items,e,t,f));const m=s.length-t,_=this.getRenderRange(this.lastRenderTop,this.lastRenderHeight),C=shift(u,m),b=Range$1.intersect(_,C);for(let L=b.start;L<b.end;L++)this.updateItemInDOM(this.items[L],L);const v=Range$1.relativeComplement(C,_);for(const L of v)for(let x=L.start;x<L.end;x++)this.removeItemFromDOM(x);const S=g.map(L=>shift(L,m)),w=[{start:e,end:e+s.length},...S].map(L=>Range$1.intersect(_,L)).reverse();for(const L of w)for(let x=L.end-1;x>=L.start;x--){const E=this.items[x],I=c.get(E.templateId),D=I==null?void 0:I.pop();this.insertItemInDOM(x,D)}for(const L of c.values())for(const x of L)this.cache.release(x);return this.eventuallyUpdateScrollDimensions(),this.supportDynamicHeights&&this._rerender(this.scrollTop,this.renderHeight),p.map(L=>L.element)}eventuallyUpdateScrollDimensions(){this._scrollHeight=this.contentHeight,this.rowsContainer.style.height=`${this._scrollHeight}px`,this.scrollableElementUpdateDisposable||(this.scrollableElementUpdateDisposable=scheduleAtNextAnimationFrame(getWindow(this.domNode),()=>{this.scrollableElement.setScrollDimensions({scrollHeight:this.scrollHeight}),this.updateScrollWidth(),this.scrollableElementUpdateDisposable=null}))}eventuallyUpdateScrollWidth(){if(!this.horizontalScrolling){this.scrollableElementWidthDelayer.cancel();return}this.scrollableElementWidthDelayer.trigger(()=>this.updateScrollWidth())}updateScrollWidth(){if(!this.horizontalScrolling)return;let e=0;for(const t of this.items)typeof t.width<"u"&&(e=Math.max(e,t.width));this.scrollWidth=e,this.scrollableElement.setScrollDimensions({scrollWidth:e===0?0:e+10}),this._onDidChangeContentWidth.fire(this.scrollWidth)}rerender(){if(this.supportDynamicHeights){for(const e of this.items)e.lastDynamicHeightWidth=void 0;this._rerender(this.lastRenderTop,this.lastRenderHeight)}}get length(){return this.items.length}get renderHeight(){return this.scrollableElement.getScrollDimensions().height}get firstVisibleIndex(){return this.getVisibleRange(this.lastRenderTop,this.lastRenderHeight).start}element(e){return this.items[e].element}indexOf(e){return this.items.findIndex(t=>t.element===e)}domElement(e){const t=this.items[e].row;return t&&t.domNode}elementHeight(e){return this.items[e].size}elementTop(e){return this.rangeMap.positionAt(e)}indexAt(e){return this.rangeMap.indexAt(e)}indexAfter(e){return this.rangeMap.indexAfter(e)}layout(e,t){const s={height:typeof e=="number"?e:getContentHeight(this.domNode)};this.scrollableElementUpdateDisposable&&(this.scrollableElementUpdateDisposable.dispose(),this.scrollableElementUpdateDisposable=null,s.scrollHeight=this.scrollHeight),this.scrollableElement.setScrollDimensions(s),typeof t<"u"&&(this.renderWidth=t,this.supportDynamicHeights&&this._rerender(this.scrollTop,this.renderHeight)),this.horizontalScrolling&&this.scrollableElement.setScrollDimensions({width:typeof t=="number"?t:getContentWidth(this.domNode)})}render(e,t,s,o,r,l=!1,c=!1){const d=this.getRenderRange(t,s),u=Range$1.relativeComplement(d,e).reverse(),g=Range$1.relativeComplement(e,d);if(l){const f=Range$1.intersect(e,d);for(let p=f.start;p<f.end;p++)this.updateItemInDOM(this.items[p],p)}this.cache.transact(()=>{for(const f of g)for(let p=f.start;p<f.end;p++)this.removeItemFromDOM(p,c);for(const f of u)for(let p=f.end-1;p>=f.start;p--)this.insertItemInDOM(p)}),o!==void 0&&(this.rowsContainer.style.left=`-${o}px`),this.rowsContainer.style.top=`-${t}px`,this.horizontalScrolling&&r!==void 0&&(this.rowsContainer.style.width=`${Math.max(r,this.renderWidth)}px`),this.lastRenderTop=t,this.lastRenderHeight=s}insertItemInDOM(e,t){var d,u;const s=this.items[e];if(!s.row)if(t)s.row=t,s.stale=!0;else{const g=this.cache.alloc(s.templateId);s.row=g.row,s.stale||(s.stale=g.isReusingConnectedDomNode)}const o=this.accessibilityProvider.getRole(s.element)||"listitem";s.row.domNode.setAttribute("role",o);const r=this.accessibilityProvider.isChecked(s.element);if(typeof r=="boolean")s.row.domNode.setAttribute("aria-checked",String(!!r));else if(r){const g=f=>s.row.domNode.setAttribute("aria-checked",String(!!f));g(r.value),s.checkedDisposable=r.onDidChange(()=>g(r.value))}if(s.stale||!s.row.domNode.parentElement){const g=((u=(d=this.items.at(e+1))==null?void 0:d.row)==null?void 0:u.domNode)??null;(s.row.domNode.parentElement!==this.rowsContainer||s.row.domNode.nextElementSibling!==g)&&this.rowsContainer.insertBefore(s.row.domNode,g),s.stale=!1}this.updateItemInDOM(s,e);const l=this.renderers.get(s.templateId);if(!l)throw new Error(`No renderer found for template id ${s.templateId}`);l==null||l.renderElement(s.element,e,s.row.templateData,{height:s.size});const c=this.dnd.getDragURI(s.element);s.dragStartDisposable.dispose(),s.row.domNode.draggable=!!c,c&&(s.dragStartDisposable=addDisposableListener(s.row.domNode,"dragstart",g=>this.onDragStart(s.element,c,g))),this.horizontalScrolling&&(this.measureItemWidth(s),this.eventuallyUpdateScrollWidth())}measureItemWidth(e){if(!e.row||!e.row.domNode)return;e.row.domNode.style.width="fit-content",e.width=getContentWidth(e.row.domNode);const t=getWindow(e.row.domNode).getComputedStyle(e.row.domNode);t.paddingLeft&&(e.width+=parseFloat(t.paddingLeft)),t.paddingRight&&(e.width+=parseFloat(t.paddingRight)),e.row.domNode.style.width=""}updateItemInDOM(e,t){e.row.domNode.style.top=`${this.elementTop(t)}px`,this.setRowHeight&&(e.row.domNode.style.height=`${e.size}px`),this.setRowLineHeight&&(e.row.domNode.style.lineHeight=`${e.size}px`),e.row.domNode.setAttribute("data-index",`${t}`),e.row.domNode.setAttribute("data-last-element",t===this.length-1?"true":"false"),e.row.domNode.setAttribute("data-parity",t%2===0?"even":"odd"),e.row.domNode.setAttribute("aria-setsize",String(this.accessibilityProvider.getSetSize(e.element,t,this.length))),e.row.domNode.setAttribute("aria-posinset",String(this.accessibilityProvider.getPosInSet(e.element,t))),e.row.domNode.setAttribute("id",this.getElementDomId(t)),e.row.domNode.classList.toggle("drop-target",e.dropTarget)}removeItemFromDOM(e,t){const s=this.items[e];if(s.dragStartDisposable.dispose(),s.checkedDisposable.dispose(),s.row){const o=this.renderers.get(s.templateId);o&&o.disposeElement&&o.disposeElement(s.element,e,s.row.templateData,{height:s.size,onScroll:t}),this.cache.release(s.row),s.row=null}this.horizontalScrolling&&this.eventuallyUpdateScrollWidth()}getScrollTop(){return this.scrollableElement.getScrollPosition().scrollTop}setScrollTop(e,t){this.scrollableElementUpdateDisposable&&(this.scrollableElementUpdateDisposable.dispose(),this.scrollableElementUpdateDisposable=null,this.scrollableElement.setScrollDimensions({scrollHeight:this.scrollHeight})),this.scrollableElement.setScrollPosition({scrollTop:e,reuseAnimation:t})}get scrollTop(){return this.getScrollTop()}set scrollTop(e){this.setScrollTop(e)}get scrollHeight(){return this._scrollHeight+(this.horizontalScrolling?10:0)+this.paddingBottom}get onMouseClick(){return Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"click")).event,e=>this.toMouseEvent(e),this.disposables)}get onMouseDblClick(){return Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"dblclick")).event,e=>this.toMouseEvent(e),this.disposables)}get onMouseMiddleClick(){return Event$1.filter(Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"auxclick")).event,e=>this.toMouseEvent(e),this.disposables),e=>e.browserEvent.button===1,this.disposables)}get onMouseDown(){return Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"mousedown")).event,e=>this.toMouseEvent(e),this.disposables)}get onMouseOver(){return Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"mouseover")).event,e=>this.toMouseEvent(e),this.disposables)}get onMouseOut(){return Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"mouseout")).event,e=>this.toMouseEvent(e),this.disposables)}get onContextMenu(){return Event$1.any(Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"contextmenu")).event,e=>this.toMouseEvent(e),this.disposables),Event$1.map(this.disposables.add(new DomEmitter(this.domNode,EventType.Contextmenu)).event,e=>this.toGestureEvent(e),this.disposables))}get onTouchStart(){return Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"touchstart")).event,e=>this.toTouchEvent(e),this.disposables)}get onTap(){return Event$1.map(this.disposables.add(new DomEmitter(this.rowsContainer,EventType.Tap)).event,e=>this.toGestureEvent(e),this.disposables)}toMouseEvent(e){const t=this.getItemIndexFromEventTarget(e.target||null),s=typeof t>"u"?void 0:this.items[t],o=s&&s.element;return{browserEvent:e,index:t,element:o}}toTouchEvent(e){const t=this.getItemIndexFromEventTarget(e.target||null),s=typeof t>"u"?void 0:this.items[t],o=s&&s.element;return{browserEvent:e,index:t,element:o}}toGestureEvent(e){const t=this.getItemIndexFromEventTarget(e.initialTarget||null),s=typeof t>"u"?void 0:this.items[t],o=s&&s.element;return{browserEvent:e,index:t,element:o}}toDragEvent(e){const t=this.getItemIndexFromEventTarget(e.target||null),s=typeof t>"u"?void 0:this.items[t],o=s&&s.element,r=this.getTargetSector(e,t);return{browserEvent:e,index:t,element:o,sector:r}}onScroll(e){try{const t=this.getRenderRange(this.lastRenderTop,this.lastRenderHeight);this.render(t,e.scrollTop,e.height,e.scrollLeft,e.scrollWidth,void 0,!0),this.supportDynamicHeights&&this._rerender(e.scrollTop,e.height,e.inSmoothScrolling)}catch(t){throw console.error("Got bad scroll event:",e),t}}onTouchChange(e){e.preventDefault(),e.stopPropagation(),this.scrollTop-=e.translationY}onDragStart(e,t,s){var l,c;if(!s.dataTransfer)return;const o=this.dnd.getDragElements(e);s.dataTransfer.effectAllowed="copyMove",s.dataTransfer.setData(DataTransfers.TEXT,t);let r;this.dnd.getDragLabel&&(r=this.dnd.getDragLabel(o,s)),typeof r>"u"&&(r=String(o.length)),applyDragImage(s,this.domNode,r,[this.domId]),this.domNode.classList.add("dragging"),this.currentDragData=new ElementsDragAndDropData(o),StaticDND.CurrentDragAndDropData=new ExternalElementsDragAndDropData(o),(c=(l=this.dnd).onDragStart)==null||c.call(l,this.currentDragData,s)}onPotentialSelectionStart(e){this.currentSelectionDisposable.dispose();const t=getDocument(this.domNode),s=this.currentSelectionDisposable=new DisposableStore,o=s.add(new DisposableStore);o.add(addDisposableListener(this.domNode,"selectstart",()=>{o.add(addDisposableListener(t,"mousemove",r=>{var l;((l=t.getSelection())==null?void 0:l.isCollapsed)===!1&&this.setupDragAndDropScrollTopAnimation(r)})),s.add(toDisposable(()=>{const r=this.getRenderRange(this.lastRenderTop,this.lastRenderHeight);this.currentSelectionBounds=void 0,this.render(r,this.lastRenderTop,this.lastRenderHeight,void 0,void 0)})),s.add(addDisposableListener(t,"selectionchange",()=>{const r=t.getSelection();if(!r||r.isCollapsed){o.isDisposed&&s.dispose();return}let l=this.getIndexOfListElement(r.anchorNode),c=this.getIndexOfListElement(r.focusNode);l!==void 0&&c!==void 0&&(c<l&&([l,c]=[c,l]),this.currentSelectionBounds={start:l,end:c})}))})),o.add(addDisposableListener(t,"mouseup",()=>{var r;o.dispose(),this.teardownDragAndDropScrollTopAnimation(),((r=t.getSelection())==null?void 0:r.isCollapsed)!==!1&&s.dispose()}))}getIndexOfListElement(e){var t;if(!(!e||!this.domNode.contains(e)))for(;e&&e!==this.domNode;){if((t=e.dataset)!=null&&t.index)return Number(e.dataset.index);e=e.parentElement}}onDragOver(e){var r,l;if(e.browserEvent.preventDefault(),this.onDragLeaveTimeout.dispose(),StaticDND.CurrentDragAndDropData&&StaticDND.CurrentDragAndDropData.getData()==="vscode-ui"||(this.setupDragAndDropScrollTopAnimation(e.browserEvent),!e.browserEvent.dataTransfer))return!1;if(!this.currentDragData)if(StaticDND.CurrentDragAndDropData)this.currentDragData=StaticDND.CurrentDragAndDropData;else{if(!e.browserEvent.dataTransfer.types)return!1;this.currentDragData=new NativeDragAndDropData}const t=this.dnd.onDragOver(this.currentDragData,e.element,e.index,e.sector,e.browserEvent);if(this.canDrop=typeof t=="boolean"?t:t.accept,!this.canDrop)return this.currentDragFeedback=void 0,this.currentDragFeedbackDisposable.dispose(),!1;e.browserEvent.dataTransfer.dropEffect=typeof t!="boolean"&&((r=t.effect)==null?void 0:r.type)===0?"copy":"move";let s;typeof t!="boolean"&&t.feedback?s=t.feedback:typeof e.index>"u"?s=[-1]:s=[e.index],s=distinct(s).filter(c=>c>=-1&&c<this.length).sort((c,d)=>c-d),s=s[0]===-1?[-1]:s;let o=typeof t!="boolean"&&t.effect&&t.effect.position?t.effect.position:"drop-target";if(equalsDragFeedback(this.currentDragFeedback,s)&&this.currentDragFeedbackPosition===o)return!0;if(this.currentDragFeedback=s,this.currentDragFeedbackPosition=o,this.currentDragFeedbackDisposable.dispose(),s[0]===-1)this.domNode.classList.add(o),this.rowsContainer.classList.add(o),this.currentDragFeedbackDisposable=toDisposable(()=>{this.domNode.classList.remove(o),this.rowsContainer.classList.remove(o)});else{if(s.length>1&&o!=="drop-target")throw new Error("Can't use multiple feedbacks with position different than 'over'");o==="drop-target-after"&&s[0]<this.length-1&&(s[0]+=1,o="drop-target-before");for(const c of s){const d=this.items[c];d.dropTarget=!0,(l=d.row)==null||l.domNode.classList.add(o)}this.currentDragFeedbackDisposable=toDisposable(()=>{var c;for(const d of s){const u=this.items[d];u.dropTarget=!1,(c=u.row)==null||c.domNode.classList.remove(o)}})}return!0}onDragLeave(e){var t,s;this.onDragLeaveTimeout.dispose(),this.onDragLeaveTimeout=disposableTimeout(()=>this.clearDragOverFeedback(),100,this.disposables),this.currentDragData&&((s=(t=this.dnd).onDragLeave)==null||s.call(t,this.currentDragData,e.element,e.index,e.browserEvent))}onDrop(e){if(!this.canDrop)return;const t=this.currentDragData;this.teardownDragAndDropScrollTopAnimation(),this.clearDragOverFeedback(),this.domNode.classList.remove("dragging"),this.currentDragData=void 0,StaticDND.CurrentDragAndDropData=void 0,!(!t||!e.browserEvent.dataTransfer)&&(e.browserEvent.preventDefault(),t.update(e.browserEvent.dataTransfer),this.dnd.drop(t,e.element,e.index,e.sector,e.browserEvent))}onDragEnd(e){var t,s;this.canDrop=!1,this.teardownDragAndDropScrollTopAnimation(),this.clearDragOverFeedback(),this.domNode.classList.remove("dragging"),this.currentDragData=void 0,StaticDND.CurrentDragAndDropData=void 0,(s=(t=this.dnd).onDragEnd)==null||s.call(t,e)}clearDragOverFeedback(){this.currentDragFeedback=void 0,this.currentDragFeedbackPosition=void 0,this.currentDragFeedbackDisposable.dispose(),this.currentDragFeedbackDisposable=Disposable.None}setupDragAndDropScrollTopAnimation(e){if(!this.dragOverAnimationDisposable){const t=getTopLeftOffset(this.domNode).top;this.dragOverAnimationDisposable=animate(getWindow(this.domNode),this.animateDragAndDropScrollTop.bind(this,t))}this.dragOverAnimationStopDisposable.dispose(),this.dragOverAnimationStopDisposable=disposableTimeout(()=>{this.dragOverAnimationDisposable&&(this.dragOverAnimationDisposable.dispose(),this.dragOverAnimationDisposable=void 0)},1e3,this.disposables),this.dragOverMouseY=e.pageY}animateDragAndDropScrollTop(e){if(this.dragOverMouseY===void 0)return;const t=this.dragOverMouseY-e,s=this.renderHeight-35;t<35?this.scrollTop+=Math.max(-14,Math.floor(.3*(t-35))):t>s&&(this.scrollTop+=Math.min(14,Math.floor(.3*(t-s))))}teardownDragAndDropScrollTopAnimation(){this.dragOverAnimationStopDisposable.dispose(),this.dragOverAnimationDisposable&&(this.dragOverAnimationDisposable.dispose(),this.dragOverAnimationDisposable=void 0)}getTargetSector(e,t){if(t===void 0)return;const s=e.offsetY/this.items[t].size,o=Math.floor(s/.25);return clamp(o,0,3)}getItemIndexFromEventTarget(e){const t=this.scrollableElement.getDomNode();let s=e;for(;(isHTMLElement(s)||isSVGElement(s))&&s!==this.rowsContainer&&t.contains(s);){const o=s.getAttribute("data-index");if(o){const r=Number(o);if(!isNaN(r))return r}s=s.parentElement}}getVisibleRange(e,t){return{start:this.rangeMap.indexAt(e),end:this.rangeMap.indexAfter(e+t-1)}}getRenderRange(e,t){const s=this.getVisibleRange(e,t);if(this.currentSelectionBounds){const o=this.rangeMap.count;s.start=Math.min(s.start,this.currentSelectionBounds.start,o),s.end=Math.min(Math.max(s.end,this.currentSelectionBounds.end+1),o)}return s}_rerender(e,t,s){const o=this.getRenderRange(e,t);let r,l;e===this.elementTop(o.start)?(r=o.start,l=0):o.end-o.start>1&&(r=o.start+1,l=this.elementTop(r)-e);let c=0;for(;;){const d=this.getRenderRange(e,t);let u=!1;for(let g=d.start;g<d.end;g++){const f=this.probeDynamicHeight(g);f!==0&&this.rangeMap.splice(g,1,[this.items[g]]),c+=f,u=u||f!==0}if(!u){c!==0&&this.eventuallyUpdateScrollDimensions();const g=Range$1.relativeComplement(o,d);for(const p of g)for(let m=p.start;m<p.end;m++)this.items[m].row&&this.removeItemFromDOM(m);const f=Range$1.relativeComplement(d,o).reverse();for(const p of f)for(let m=p.end-1;m>=p.start;m--)this.insertItemInDOM(m);for(let p=d.start;p<d.end;p++)this.items[p].row&&this.updateItemInDOM(this.items[p],p);if(typeof r=="number"){const p=this.scrollable.getFutureScrollPosition().scrollTop-e,m=this.elementTop(r)-l+p;this.setScrollTop(m,s)}this._onDidChangeContentHeight.fire(this.contentHeight);return}}}probeDynamicHeight(e){var l,c,d;const t=this.items[e];if(this.virtualDelegate.getDynamicHeight){const u=this.virtualDelegate.getDynamicHeight(t.element);if(u!==null){const g=t.size;return t.size=u,t.lastDynamicHeightWidth=this.renderWidth,u-g}}if(!t.hasDynamicHeight||t.lastDynamicHeightWidth===this.renderWidth||this.virtualDelegate.hasDynamicHeight&&!this.virtualDelegate.hasDynamicHeight(t.element))return 0;const s=t.size;if(t.row)return t.row.domNode.style.height="",t.size=t.row.domNode.offsetHeight,t.size===0&&!isAncestor$1(t.row.domNode,getWindow(t.row.domNode).document.body)&&console.warn("Measuring item node that is not in DOM! Add ListView to the DOM before measuring row height!",new Error().stack),t.lastDynamicHeightWidth=this.renderWidth,t.size-s;const{row:o}=this.cache.alloc(t.templateId);o.domNode.style.height="",this.rowsContainer.appendChild(o.domNode);const r=this.renderers.get(t.templateId);if(!r)throw new BugIndicatingError("Missing renderer for templateId: "+t.templateId);return r.renderElement(t.element,e,o.templateData),t.size=o.domNode.offsetHeight,(l=r.disposeElement)==null||l.call(r,t.element,e,o.templateData),(d=(c=this.virtualDelegate).setDynamicHeight)==null||d.call(c,t.element,t.size),t.lastDynamicHeightWidth=this.renderWidth,o.domNode.remove(),this.cache.release(o),t.size-s}getElementDomId(e){return`${this.domId}_${e}`}dispose(){var e,t,s;for(const o of this.items)if(o.dragStartDisposable.dispose(),o.checkedDisposable.dispose(),o.row){const r=this.renderers.get(o.row.templateId);r&&((e=r.disposeElement)==null||e.call(r,o.element,-1,o.row.templateData,void 0),r.disposeTemplate(o.row.templateData))}this.items=[],(t=this.domNode)==null||t.remove(),(s=this.dragOverAnimationDisposable)==null||s.dispose(),this.disposables.dispose()}};Cs.InstanceCount=0;let ListView=Cs;__decorate$2z([memoize],ListView.prototype,"onMouseClick",null);__decorate$2z([memoize],ListView.prototype,"onMouseDblClick",null);__decorate$2z([memoize],ListView.prototype,"onMouseMiddleClick",null);__decorate$2z([memoize],ListView.prototype,"onMouseDown",null);__decorate$2z([memoize],ListView.prototype,"onMouseOver",null);__decorate$2z([memoize],ListView.prototype,"onMouseOut",null);__decorate$2z([memoize],ListView.prototype,"onContextMenu",null);__decorate$2z([memoize],ListView.prototype,"onTouchStart",null);__decorate$2z([memoize],ListView.prototype,"onTap",null);var __decorate$2y=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};class TraitRenderer{constructor(e){this.trait=e,this.renderedElements=[]}get templateId(){return`template:${this.trait.name}`}renderTemplate(e){return e}renderElement(e,t,s){const o=this.renderedElements.findIndex(r=>r.templateData===s);if(o>=0){const r=this.renderedElements[o];this.trait.unrender(s),r.index=t}else{const r={index:t,templateData:s};this.renderedElements.push(r)}this.trait.renderIndex(t,s)}splice(e,t,s){const o=[];for(const r of this.renderedElements)r.index<e?o.push(r):r.index>=e+t&&o.push({index:r.index+s-t,templateData:r.templateData});this.renderedElements=o}renderIndexes(e){for(const{index:t,templateData:s}of this.renderedElements)e.indexOf(t)>-1&&this.trait.renderIndex(t,s)}disposeTemplate(e){const t=this.renderedElements.findIndex(s=>s.templateData===e);t<0||this.renderedElements.splice(t,1)}}let Trait$1=class{get onChange(){return this._onChange.event}get name(){return this._trait}get renderer(){return new TraitRenderer(this)}constructor(e){this._trait=e,this.indexes=[],this.sortedIndexes=[],this._onChange=new Emitter$1}splice(e,t,s){const o=s.length-t,r=e+t,l=[];let c=0;for(;c<this.sortedIndexes.length&&this.sortedIndexes[c]<e;)l.push(this.sortedIndexes[c++]);for(let d=0;d<s.length;d++)s[d]&&l.push(d+e);for(;c<this.sortedIndexes.length&&this.sortedIndexes[c]>=r;)l.push(this.sortedIndexes[c++]+o);this.renderer.splice(e,t,s.length),this._set(l,l)}renderIndex(e,t){t.classList.toggle(this._trait,this.contains(e))}unrender(e){e.classList.remove(this._trait)}set(e,t){return this._set(e,[...e].sort(numericSort),t)}_set(e,t,s){const o=this.indexes,r=this.sortedIndexes;this.indexes=e,this.sortedIndexes=t;const l=disjunction(r,e);return this.renderer.renderIndexes(l),this._onChange.fire({indexes:e,browserEvent:s}),o}get(){return this.indexes}contains(e){return binarySearch(this.sortedIndexes,e,numericSort)>=0}dispose(){dispose(this._onChange)}};__decorate$2y([memoize],Trait$1.prototype,"renderer",null);class SelectionTrait extends Trait$1{constructor(e){super("selected"),this.setAriaSelected=e}renderIndex(e,t){super.renderIndex(e,t),this.setAriaSelected&&(this.contains(e)?t.setAttribute("aria-selected","true"):t.setAttribute("aria-selected","false"))}}class TraitSpliceable{constructor(e,t,s){this.trait=e,this.view=t,this.identityProvider=s}splice(e,t,s){if(!this.identityProvider)return this.trait.splice(e,t,new Array(s.length).fill(!1));const o=this.trait.get().map(c=>this.identityProvider.getId(this.view.element(c)).toString());if(o.length===0)return this.trait.splice(e,t,new Array(s.length).fill(!1));const r=new Set(o),l=s.map(c=>r.has(this.identityProvider.getId(c).toString()));this.trait.splice(e,t,l)}}function isListElementDescendantOfClass(a,e){return a.classList.contains(e)?!0:a.classList.contains("monaco-list")||!a.parentElement?!1:isListElementDescendantOfClass(a.parentElement,e)}function isMonacoEditor(a){return isListElementDescendantOfClass(a,"monaco-editor")}function isMonacoCustomToggle(a){return isListElementDescendantOfClass(a,"monaco-custom-toggle")}function isActionItem(a){return isListElementDescendantOfClass(a,"action-item")}function isStickyScrollElement(a){return isListElementDescendantOfClass(a,"monaco-tree-sticky-row")}function isStickyScrollContainer(a){return a.classList.contains("monaco-tree-sticky-container")}function isButton(a){return a.tagName==="A"&&a.classList.contains("monaco-button")||a.tagName==="DIV"&&a.classList.contains("monaco-button-dropdown")?!0:a.classList.contains("monaco-list")||!a.parentElement?!1:isButton(a.parentElement)}class KeyboardController{get onKeyDown(){return Event$1.chain(this.disposables.add(new DomEmitter(this.view.domNode,"keydown")).event,e=>e.filter(t=>!isEditableElement(t.target)).map(t=>new StandardKeyboardEvent(t)))}constructor(e,t,s){this.list=e,this.view=t,this.disposables=new DisposableStore,this.multipleSelectionDisposables=new DisposableStore,this.multipleSelectionSupport=s.multipleSelectionSupport,this.disposables.add(this.onKeyDown(o=>{switch(o.keyCode){case 3:return this.onEnter(o);case 16:return this.onUpArrow(o);case 18:return this.onDownArrow(o);case 11:return this.onPageUpArrow(o);case 12:return this.onPageDownArrow(o);case 9:return this.onEscape(o);case 31:this.multipleSelectionSupport&&(isMacintosh?o.metaKey:o.ctrlKey)&&this.onCtrlA(o)}}))}updateOptions(e){e.multipleSelectionSupport!==void 0&&(this.multipleSelectionSupport=e.multipleSelectionSupport)}onEnter(e){e.preventDefault(),e.stopPropagation(),this.list.setSelection(this.list.getFocus(),e.browserEvent)}onUpArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusPrevious(1,!1,e.browserEvent);const t=this.list.getFocus()[0];this.list.setAnchor(t),this.list.reveal(t),this.view.domNode.focus()}onDownArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusNext(1,!1,e.browserEvent);const t=this.list.getFocus()[0];this.list.setAnchor(t),this.list.reveal(t),this.view.domNode.focus()}onPageUpArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusPreviousPage(e.browserEvent);const t=this.list.getFocus()[0];this.list.setAnchor(t),this.list.reveal(t),this.view.domNode.focus()}onPageDownArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusNextPage(e.browserEvent);const t=this.list.getFocus()[0];this.list.setAnchor(t),this.list.reveal(t),this.view.domNode.focus()}onCtrlA(e){e.preventDefault(),e.stopPropagation(),this.list.setSelection(range(this.list.length),e.browserEvent),this.list.setAnchor(void 0),this.view.domNode.focus()}onEscape(e){this.list.getSelection().length&&(e.preventDefault(),e.stopPropagation(),this.list.setSelection([],e.browserEvent),this.list.setAnchor(void 0),this.view.domNode.focus())}dispose(){this.disposables.dispose(),this.multipleSelectionDisposables.dispose()}}__decorate$2y([memoize],KeyboardController.prototype,"onKeyDown",null);var TypeNavigationMode;(function(a){a[a.Automatic=0]="Automatic",a[a.Trigger=1]="Trigger"})(TypeNavigationMode||(TypeNavigationMode={}));var TypeNavigationControllerState;(function(a){a[a.Idle=0]="Idle",a[a.Typing=1]="Typing"})(TypeNavigationControllerState||(TypeNavigationControllerState={}));const DefaultKeyboardNavigationDelegate=new class{mightProducePrintableCharacter(a){return a.ctrlKey||a.metaKey||a.altKey?!1:a.keyCode>=31&&a.keyCode<=56||a.keyCode>=21&&a.keyCode<=30||a.keyCode>=98&&a.keyCode<=107||a.keyCode>=85&&a.keyCode<=95}};class TypeNavigationController{constructor(e,t,s,o,r){this.list=e,this.view=t,this.keyboardNavigationLabelProvider=s,this.keyboardNavigationEventFilter=o,this.delegate=r,this.enabled=!1,this.state=TypeNavigationControllerState.Idle,this.mode=TypeNavigationMode.Automatic,this.triggered=!1,this.previouslyFocused=-1,this.enabledDisposables=new DisposableStore,this.disposables=new DisposableStore,this.updateOptions(e.options)}updateOptions(e){e.typeNavigationEnabled??!0?this.enable():this.disable(),this.mode=e.typeNavigationMode??TypeNavigationMode.Automatic}enable(){if(this.enabled)return;let e=!1;const t=Event$1.chain(this.enabledDisposables.add(new DomEmitter(this.view.domNode,"keydown")).event,r=>r.filter(l=>!isEditableElement(l.target)).filter(()=>this.mode===TypeNavigationMode.Automatic||this.triggered).map(l=>new StandardKeyboardEvent(l)).filter(l=>e||this.keyboardNavigationEventFilter(l)).filter(l=>this.delegate.mightProducePrintableCharacter(l)).forEach(l=>EventHelper.stop(l,!0)).map(l=>l.browserEvent.key)),s=Event$1.debounce(t,()=>null,800,void 0,void 0,void 0,this.enabledDisposables);Event$1.reduce(Event$1.any(t,s),(r,l)=>l===null?null:(r||"")+l,void 0,this.enabledDisposables)(this.onInput,this,this.enabledDisposables),s(this.onClear,this,this.enabledDisposables),t(()=>e=!0,void 0,this.enabledDisposables),s(()=>e=!1,void 0,this.enabledDisposables),this.enabled=!0,this.triggered=!1}disable(){this.enabled&&(this.enabledDisposables.clear(),this.enabled=!1,this.triggered=!1)}onClear(){var t;const e=this.list.getFocus();if(e.length>0&&e[0]===this.previouslyFocused){const s=(t=this.list.options.accessibilityProvider)==null?void 0:t.getAriaLabel(this.list.element(e[0]));typeof s=="string"?alert$1(s):s&&alert$1(s.get())}this.previouslyFocused=-1}onInput(e){if(!e){this.state=TypeNavigationControllerState.Idle,this.triggered=!1;return}const t=this.list.getFocus(),s=t.length>0?t[0]:0,o=this.state===TypeNavigationControllerState.Idle?1:0;this.state=TypeNavigationControllerState.Typing;for(let r=0;r<this.list.length;r++){const l=(s+r+o)%this.list.length,c=this.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(this.view.element(l)),d=c&&c.toString();if(this.list.options.typeNavigationEnabled){if(typeof d<"u"){if(matchesPrefix(e,d)){this.previouslyFocused=s,this.list.setFocus([l]),this.list.reveal(l);return}const u=matchesFuzzy2(e,d);if(u&&u[0].end-u[0].start>1&&u.length===1){this.previouslyFocused=s,this.list.setFocus([l]),this.list.reveal(l);return}}}else if(typeof d>"u"||matchesPrefix(e,d)){this.previouslyFocused=s,this.list.setFocus([l]),this.list.reveal(l);return}}}dispose(){this.disable(),this.enabledDisposables.dispose(),this.disposables.dispose()}}class DOMFocusController{constructor(e,t){this.list=e,this.view=t,this.disposables=new DisposableStore;const s=Event$1.chain(this.disposables.add(new DomEmitter(t.domNode,"keydown")).event,r=>r.filter(l=>!isEditableElement(l.target)).map(l=>new StandardKeyboardEvent(l)));Event$1.chain(s,r=>r.filter(l=>l.keyCode===2&&!l.ctrlKey&&!l.metaKey&&!l.shiftKey&&!l.altKey))(this.onTab,this,this.disposables)}onTab(e){if(e.target!==this.view.domNode)return;const t=this.list.getFocus();if(t.length===0)return;const s=this.view.domElement(t[0]);if(!s)return;const o=s.querySelector("[tabIndex]");if(!o||!isHTMLElement(o)||o.tabIndex===-1)return;const r=getWindow(o).getComputedStyle(o);r.visibility==="hidden"||r.display==="none"||(e.preventDefault(),e.stopPropagation(),o.focus())}dispose(){this.disposables.dispose()}}function isSelectionSingleChangeEvent(a){return isMacintosh?a.browserEvent.metaKey:a.browserEvent.ctrlKey}function isSelectionRangeChangeEvent(a){return a.browserEvent.shiftKey}function isMouseRightClick(a){return isMouseEvent(a)&&a.button===2}const DefaultMultipleSelectionController={isSelectionSingleChangeEvent,isSelectionRangeChangeEvent};class MouseController{get onPointer(){return this._onPointer.event}constructor(e){this.list=e,this.disposables=new DisposableStore,this._onPointer=this.disposables.add(new Emitter$1),e.options.multipleSelectionSupport!==!1&&(this.multipleSelectionController=this.list.options.multipleSelectionController||DefaultMultipleSelectionController),this.mouseSupport=typeof e.options.mouseSupport>"u"||!!e.options.mouseSupport,this.mouseSupport&&(e.onMouseDown(this.onMouseDown,this,this.disposables),e.onContextMenu(this.onContextMenu,this,this.disposables),e.onMouseDblClick(this.onDoubleClick,this,this.disposables),e.onTouchStart(this.onMouseDown,this,this.disposables),this.disposables.add(Gesture.addTarget(e.getHTMLElement()))),Event$1.any(e.onMouseClick,e.onMouseMiddleClick,e.onTap)(this.onViewPointer,this,this.disposables)}updateOptions(e){e.multipleSelectionSupport!==void 0&&(this.multipleSelectionController=void 0,e.multipleSelectionSupport&&(this.multipleSelectionController=this.list.options.multipleSelectionController||DefaultMultipleSelectionController))}isSelectionSingleChangeEvent(e){return this.multipleSelectionController?this.multipleSelectionController.isSelectionSingleChangeEvent(e):!1}isSelectionRangeChangeEvent(e){return this.multipleSelectionController?this.multipleSelectionController.isSelectionRangeChangeEvent(e):!1}isSelectionChangeEvent(e){return this.isSelectionSingleChangeEvent(e)||this.isSelectionRangeChangeEvent(e)}onMouseDown(e){isMonacoEditor(e.browserEvent.target)||getActiveElement()!==e.browserEvent.target&&this.list.domFocus()}onContextMenu(e){if(isEditableElement(e.browserEvent.target)||isMonacoEditor(e.browserEvent.target))return;const t=typeof e.index>"u"?[]:[e.index];this.list.setFocus(t,e.browserEvent)}onViewPointer(e){if(!this.mouseSupport||isEditableElement(e.browserEvent.target)||isMonacoEditor(e.browserEvent.target)||e.browserEvent.isHandledByList)return;e.browserEvent.isHandledByList=!0;const t=e.index;if(typeof t>"u"){this.list.setFocus([],e.browserEvent),this.list.setSelection([],e.browserEvent),this.list.setAnchor(void 0);return}if(this.isSelectionChangeEvent(e))return this.changeSelection(e);this.list.setFocus([t],e.browserEvent),this.list.setAnchor(t),isMouseRightClick(e.browserEvent)||this.list.setSelection([t],e.browserEvent),this._onPointer.fire(e)}onDoubleClick(e){if(isEditableElement(e.browserEvent.target)||isMonacoEditor(e.browserEvent.target)||this.isSelectionChangeEvent(e)||e.browserEvent.isHandledByList)return;e.browserEvent.isHandledByList=!0;const t=this.list.getFocus();this.list.setSelection(t,e.browserEvent)}changeSelection(e){const t=e.index;let s=this.list.getAnchor();if(this.isSelectionRangeChangeEvent(e)){typeof s>"u"&&(s=this.list.getFocus()[0]??t,this.list.setAnchor(s));const o=Math.min(s,t),r=Math.max(s,t),l=range(o,r+1),c=this.list.getSelection(),d=getContiguousRangeContaining(disjunction(c,[s]),s);if(d.length===0)return;const u=disjunction(l,relativeComplement(c,d));this.list.setSelection(u,e.browserEvent),this.list.setFocus([t],e.browserEvent)}else if(this.isSelectionSingleChangeEvent(e)){const o=this.list.getSelection(),r=o.filter(l=>l!==t);this.list.setFocus([t]),this.list.setAnchor(t),o.length===r.length?this.list.setSelection([...r,t],e.browserEvent):this.list.setSelection(r,e.browserEvent)}}dispose(){this.disposables.dispose()}}class DefaultStyleController{constructor(e,t){this.styleElement=e,this.selectorSuffix=t}style(e){const t=this.selectorSuffix&&`.${this.selectorSuffix}`,s=[];e.listBackground&&s.push(`.monaco-list${t} .monaco-list-rows { background: ${e.listBackground}; }`),e.listFocusBackground&&(s.push(`.monaco-list${t}:focus .monaco-list-row.focused { background-color: ${e.listFocusBackground}; }`),s.push(`.monaco-list${t}:focus .monaco-list-row.focused:hover { background-color: ${e.listFocusBackground}; }`)),e.listFocusForeground&&s.push(`.monaco-list${t}:focus .monaco-list-row.focused { color: ${e.listFocusForeground}; }`),e.listActiveSelectionBackground&&(s.push(`.monaco-list${t}:focus .monaco-list-row.selected { background-color: ${e.listActiveSelectionBackground}; }`),s.push(`.monaco-list${t}:focus .monaco-list-row.selected:hover { background-color: ${e.listActiveSelectionBackground}; }`)),e.listActiveSelectionForeground&&s.push(`.monaco-list${t}:focus .monaco-list-row.selected { color: ${e.listActiveSelectionForeground}; }`),e.listActiveSelectionIconForeground&&s.push(`.monaco-list${t}:focus .monaco-list-row.selected .codicon { color: ${e.listActiveSelectionIconForeground}; }`),e.listFocusAndSelectionBackground&&s.push(`
				.monaco-drag-image${t},
				.monaco-list${t}:focus .monaco-list-row.selected.focused { background-color: ${e.listFocusAndSelectionBackground}; }
			`),e.listFocusAndSelectionForeground&&s.push(`
				.monaco-drag-image${t},
				.monaco-list${t}:focus .monaco-list-row.selected.focused { color: ${e.listFocusAndSelectionForeground}; }
			`),e.listInactiveFocusForeground&&(s.push(`.monaco-list${t} .monaco-list-row.focused { color:  ${e.listInactiveFocusForeground}; }`),s.push(`.monaco-list${t} .monaco-list-row.focused:hover { color:  ${e.listInactiveFocusForeground}; }`)),e.listInactiveSelectionIconForeground&&s.push(`.monaco-list${t} .monaco-list-row.focused .codicon { color:  ${e.listInactiveSelectionIconForeground}; }`),e.listInactiveFocusBackground&&(s.push(`.monaco-list${t} .monaco-list-row.focused { background-color:  ${e.listInactiveFocusBackground}; }`),s.push(`.monaco-list${t} .monaco-list-row.focused:hover { background-color:  ${e.listInactiveFocusBackground}; }`)),e.listInactiveSelectionBackground&&(s.push(`.monaco-list${t} .monaco-list-row.selected { background-color:  ${e.listInactiveSelectionBackground}; }`),s.push(`.monaco-list${t} .monaco-list-row.selected:hover { background-color:  ${e.listInactiveSelectionBackground}; }`)),e.listInactiveSelectionForeground&&s.push(`.monaco-list${t} .monaco-list-row.selected { color: ${e.listInactiveSelectionForeground}; }`),e.listHoverBackground&&s.push(`.monaco-list${t}:not(.drop-target):not(.dragging) .monaco-list-row:hover:not(.selected):not(.focused) { background-color: ${e.listHoverBackground}; }`),e.listHoverForeground&&s.push(`.monaco-list${t}:not(.drop-target):not(.dragging) .monaco-list-row:hover:not(.selected):not(.focused) { color:  ${e.listHoverForeground}; }`);const o=asCssValueWithDefault(e.listFocusAndSelectionOutline,asCssValueWithDefault(e.listSelectionOutline,e.listFocusOutline??""));o&&s.push(`.monaco-list${t}:focus .monaco-list-row.focused.selected { outline: 1px solid ${o}; outline-offset: -1px;}`),e.listFocusOutline&&s.push(`
				.monaco-drag-image${t},
				.monaco-list${t}:focus .monaco-list-row.focused,
				.monaco-workbench.context-menu-visible .monaco-list${t}.last-focused .monaco-list-row.focused { outline: 1px solid ${e.listFocusOutline}; outline-offset: -1px; }
			`);const r=asCssValueWithDefault(e.listSelectionOutline,e.listInactiveFocusOutline??"");r&&s.push(`.monaco-list${t} .monaco-list-row.focused.selected { outline: 1px dotted ${r}; outline-offset: -1px; }`),e.listSelectionOutline&&s.push(`.monaco-list${t} .monaco-list-row.selected { outline: 1px dotted ${e.listSelectionOutline}; outline-offset: -1px; }`),e.listInactiveFocusOutline&&s.push(`.monaco-list${t} .monaco-list-row.focused { outline: 1px dotted ${e.listInactiveFocusOutline}; outline-offset: -1px; }`),e.listHoverOutline&&s.push(`.monaco-list${t} .monaco-list-row:hover { outline: 1px dashed ${e.listHoverOutline}; outline-offset: -1px; }`),e.listDropOverBackground&&s.push(`
				.monaco-list${t}.drop-target,
				.monaco-list${t} .monaco-list-rows.drop-target,
				.monaco-list${t} .monaco-list-row.drop-target { background-color: ${e.listDropOverBackground} !important; color: inherit !important; }
			`),e.listDropBetweenBackground&&(s.push(`
			.monaco-list${t} .monaco-list-rows.drop-target-before .monaco-list-row:first-child::before,
			.monaco-list${t} .monaco-list-row.drop-target-before::before {
				content: ""; position: absolute; top: 0px; left: 0px; width: 100%; height: 1px;
				background-color: ${e.listDropBetweenBackground};
			}`),s.push(`
			.monaco-list${t} .monaco-list-rows.drop-target-after .monaco-list-row:last-child::after,
			.monaco-list${t} .monaco-list-row.drop-target-after::after {
				content: ""; position: absolute; bottom: 0px; left: 0px; width: 100%; height: 1px;
				background-color: ${e.listDropBetweenBackground};
			}`)),e.tableColumnsBorder&&s.push(`
				.monaco-table > .monaco-split-view2,
				.monaco-table > .monaco-split-view2 .monaco-sash.vertical::before,
				.monaco-workbench:not(.reduce-motion) .monaco-table:hover > .monaco-split-view2,
				.monaco-workbench:not(.reduce-motion) .monaco-table:hover > .monaco-split-view2 .monaco-sash.vertical::before {
					border-color: ${e.tableColumnsBorder};
				}

				.monaco-workbench:not(.reduce-motion) .monaco-table > .monaco-split-view2,
				.monaco-workbench:not(.reduce-motion) .monaco-table > .monaco-split-view2 .monaco-sash.vertical::before {
					border-color: transparent;
				}
			`),e.tableOddRowsBackgroundColor&&s.push(`
				.monaco-table .monaco-list-row[data-parity=odd]:not(.focused):not(.selected):not(:hover) .monaco-table-tr,
				.monaco-table .monaco-list:not(:focus) .monaco-list-row[data-parity=odd].focused:not(.selected):not(:hover) .monaco-table-tr,
				.monaco-table .monaco-list:not(.focused) .monaco-list-row[data-parity=odd].focused:not(.selected):not(:hover) .monaco-table-tr {
					background-color: ${e.tableOddRowsBackgroundColor};
				}
			`),this.styleElement.textContent=s.join(`
`)}}const unthemedListStyles={listFocusBackground:"#7FB0D0",listActiveSelectionBackground:"#0E639C",listActiveSelectionForeground:"#FFFFFF",listActiveSelectionIconForeground:"#FFFFFF",listFocusAndSelectionOutline:"#90C2F9",listFocusAndSelectionBackground:"#094771",listFocusAndSelectionForeground:"#FFFFFF",listInactiveSelectionBackground:"#3F3F46",listInactiveSelectionIconForeground:"#FFFFFF",listHoverBackground:"#2A2D2E",listDropOverBackground:"#383B3D",listDropBetweenBackground:"#EEEEEE",treeIndentGuidesStroke:"#a9a9a9",treeInactiveIndentGuidesStroke:Color.fromHex("#a9a9a9").transparent(.4).toString(),tableColumnsBorder:Color.fromHex("#cccccc").transparent(.2).toString(),tableOddRowsBackgroundColor:Color.fromHex("#cccccc").transparent(.04).toString(),listBackground:void 0,listFocusForeground:void 0,listInactiveSelectionForeground:void 0,listInactiveFocusForeground:void 0,listInactiveFocusBackground:void 0,listHoverForeground:void 0,listFocusOutline:void 0,listInactiveFocusOutline:void 0,listSelectionOutline:void 0,listHoverOutline:void 0,treeStickyScrollBackground:void 0,treeStickyScrollBorder:void 0,treeStickyScrollShadow:void 0},DefaultOptions={keyboardSupport:!0,mouseSupport:!0,multipleSelectionSupport:!0,dnd:{getDragURI(){return null},onDragStart(){},onDragOver(){return!1},drop(){},dispose(){}}};function getContiguousRangeContaining(a,e){const t=a.indexOf(e);if(t===-1)return[];const s=[];let o=t-1;for(;o>=0&&a[o]===e-(t-o);)s.push(a[o--]);for(s.reverse(),o=t;o<a.length&&a[o]===e+(o-t);)s.push(a[o++]);return s}function disjunction(a,e){const t=[];let s=0,o=0;for(;s<a.length||o<e.length;)if(s>=a.length)t.push(e[o++]);else if(o>=e.length)t.push(a[s++]);else if(a[s]===e[o]){t.push(a[s]),s++,o++;continue}else a[s]<e[o]?t.push(a[s++]):t.push(e[o++]);return t}function relativeComplement(a,e){const t=[];let s=0,o=0;for(;s<a.length||o<e.length;)if(s>=a.length)t.push(e[o++]);else if(o>=e.length)t.push(a[s++]);else if(a[s]===e[o]){s++,o++;continue}else a[s]<e[o]?t.push(a[s++]):o++;return t}const numericSort=(a,e)=>a-e;class PipelineRenderer{constructor(e,t){this._templateId=e,this.renderers=t}get templateId(){return this._templateId}renderTemplate(e){return this.renderers.map(t=>t.renderTemplate(e))}renderElement(e,t,s,o){let r=0;for(const l of this.renderers)l.renderElement(e,t,s[r++],o)}disposeElement(e,t,s,o){var l;let r=0;for(const c of this.renderers)(l=c.disposeElement)==null||l.call(c,e,t,s[r],o),r+=1}disposeTemplate(e){let t=0;for(const s of this.renderers)s.disposeTemplate(e[t++])}}class AccessibiltyRenderer{constructor(e){this.accessibilityProvider=e,this.templateId="a18n"}renderTemplate(e){return{container:e,disposables:new DisposableStore}}renderElement(e,t,s){const o=this.accessibilityProvider.getAriaLabel(e),r=o&&typeof o!="string"?o:constObservable(o);s.disposables.add(autorun(c=>{this.setAriaLabel(c.readObservable(r),s.container)}));const l=this.accessibilityProvider.getAriaLevel&&this.accessibilityProvider.getAriaLevel(e);typeof l=="number"?s.container.setAttribute("aria-level",`${l}`):s.container.removeAttribute("aria-level")}setAriaLabel(e,t){e?t.setAttribute("aria-label",e):t.removeAttribute("aria-label")}disposeElement(e,t,s){s.disposables.clear()}disposeTemplate(e){e.disposables.dispose()}}class ListViewDragAndDrop{constructor(e,t){this.list=e,this.dnd=t}getDragElements(e){const t=this.list.getSelectedElements();return t.indexOf(e)>-1?t:[e]}getDragURI(e){return this.dnd.getDragURI(e)}getDragLabel(e,t){if(this.dnd.getDragLabel)return this.dnd.getDragLabel(e,t)}onDragStart(e,t){var s,o;(o=(s=this.dnd).onDragStart)==null||o.call(s,e,t)}onDragOver(e,t,s,o,r){return this.dnd.onDragOver(e,t,s,o,r)}onDragLeave(e,t,s,o){var r,l;(l=(r=this.dnd).onDragLeave)==null||l.call(r,e,t,s,o)}onDragEnd(e){var t,s;(s=(t=this.dnd).onDragEnd)==null||s.call(t,e)}drop(e,t,s,o,r){this.dnd.drop(e,t,s,o,r)}dispose(){this.dnd.dispose()}}class List{get onDidChangeFocus(){return Event$1.map(this.eventBufferer.wrapEvent(this.focus.onChange),e=>this.toListEvent(e),this.disposables)}get onDidChangeSelection(){return Event$1.map(this.eventBufferer.wrapEvent(this.selection.onChange),e=>this.toListEvent(e),this.disposables)}get domId(){return this.view.domId}get onDidScroll(){return this.view.onDidScroll}get onMouseClick(){return this.view.onMouseClick}get onMouseDblClick(){return this.view.onMouseDblClick}get onMouseMiddleClick(){return this.view.onMouseMiddleClick}get onPointer(){return this.mouseController.onPointer}get onMouseDown(){return this.view.onMouseDown}get onMouseOver(){return this.view.onMouseOver}get onMouseOut(){return this.view.onMouseOut}get onTouchStart(){return this.view.onTouchStart}get onTap(){return this.view.onTap}get onContextMenu(){let e=!1;const t=Event$1.chain(this.disposables.add(new DomEmitter(this.view.domNode,"keydown")).event,r=>r.map(l=>new StandardKeyboardEvent(l)).filter(l=>e=l.keyCode===58||l.shiftKey&&l.keyCode===68).map(l=>EventHelper.stop(l,!0)).filter(()=>!1)),s=Event$1.chain(this.disposables.add(new DomEmitter(this.view.domNode,"keyup")).event,r=>r.forEach(()=>e=!1).map(l=>new StandardKeyboardEvent(l)).filter(l=>l.keyCode===58||l.shiftKey&&l.keyCode===68).map(l=>EventHelper.stop(l,!0)).map(({browserEvent:l})=>{const c=this.getFocus(),d=c.length?c[0]:void 0,u=typeof d<"u"?this.view.element(d):void 0,g=typeof d<"u"?this.view.domElement(d):this.view.domNode;return{index:d,element:u,anchor:g,browserEvent:l}})),o=Event$1.chain(this.view.onContextMenu,r=>r.filter(l=>!e).map(({element:l,index:c,browserEvent:d})=>({element:l,index:c,anchor:new StandardMouseEvent(getWindow(this.view.domNode),d),browserEvent:d})));return Event$1.any(t,s,o)}get onKeyDown(){return this.disposables.add(new DomEmitter(this.view.domNode,"keydown")).event}get onDidFocus(){return Event$1.signal(this.disposables.add(new DomEmitter(this.view.domNode,"focus",!0)).event)}get onDidBlur(){return Event$1.signal(this.disposables.add(new DomEmitter(this.view.domNode,"blur",!0)).event)}constructor(e,t,s,o,r=DefaultOptions){var u,g,f;this.user=e,this._options=r,this.focus=new Trait$1("focused"),this.anchor=new Trait$1("anchor"),this.eventBufferer=new EventBufferer,this._ariaLabel="",this.disposables=new DisposableStore,this._onDidDispose=new Emitter$1,this.onDidDispose=this._onDidDispose.event;const l=this._options.accessibilityProvider&&this._options.accessibilityProvider.getWidgetRole?(u=this._options.accessibilityProvider)==null?void 0:u.getWidgetRole():"list";this.selection=new SelectionTrait(l!=="listbox");const c=[this.focus.renderer,this.selection.renderer];this.accessibilityProvider=r.accessibilityProvider,this.accessibilityProvider&&(c.push(new AccessibiltyRenderer(this.accessibilityProvider)),(f=(g=this.accessibilityProvider).onDidChangeActiveDescendant)==null||f.call(g,this.onDidChangeActiveDescendant,this,this.disposables)),o=o.map(p=>new PipelineRenderer(p.templateId,[...c,p]));const d={...r,dnd:r.dnd&&new ListViewDragAndDrop(this,r.dnd)};if(this.view=this.createListView(t,s,o,d),this.view.domNode.setAttribute("role",l),r.styleController)this.styleController=r.styleController(this.view.domId);else{const p=createStyleSheet(this.view.domNode);this.styleController=new DefaultStyleController(p,this.view.domId)}if(this.spliceable=new CombinedSpliceable([new TraitSpliceable(this.focus,this.view,r.identityProvider),new TraitSpliceable(this.selection,this.view,r.identityProvider),new TraitSpliceable(this.anchor,this.view,r.identityProvider),this.view]),this.disposables.add(this.focus),this.disposables.add(this.selection),this.disposables.add(this.anchor),this.disposables.add(this.view),this.disposables.add(this._onDidDispose),this.disposables.add(new DOMFocusController(this,this.view)),(typeof r.keyboardSupport!="boolean"||r.keyboardSupport)&&(this.keyboardController=new KeyboardController(this,this.view,r),this.disposables.add(this.keyboardController)),r.keyboardNavigationLabelProvider){const p=r.keyboardNavigationDelegate||DefaultKeyboardNavigationDelegate;this.typeNavigationController=new TypeNavigationController(this,this.view,r.keyboardNavigationLabelProvider,r.keyboardNavigationEventFilter??(()=>!0),p),this.disposables.add(this.typeNavigationController)}if(this.mouseController=this.createMouseController(r),this.disposables.add(this.mouseController),this.onDidChangeFocus(this._onFocusChange,this,this.disposables),this.onDidChangeSelection(this._onSelectionChange,this,this.disposables),this.accessibilityProvider){const p=this.accessibilityProvider.getWidgetAriaLabel(),m=p&&typeof p!="string"?p:constObservable(p);this.disposables.add(autorun(_=>{this.ariaLabel=_.readObservable(m)}))}this._options.multipleSelectionSupport!==!1&&this.view.domNode.setAttribute("aria-multiselectable","true")}createListView(e,t,s,o){return new ListView(e,t,s,o)}createMouseController(e){return new MouseController(this)}updateOptions(e={}){var t,s;this._options={...this._options,...e},(t=this.typeNavigationController)==null||t.updateOptions(this._options),this._options.multipleSelectionController!==void 0&&(this._options.multipleSelectionSupport?this.view.domNode.setAttribute("aria-multiselectable","true"):this.view.domNode.removeAttribute("aria-multiselectable")),this.mouseController.updateOptions(e),(s=this.keyboardController)==null||s.updateOptions(e),this.view.updateOptions(e)}get options(){return this._options}splice(e,t,s=[]){if(e<0||e>this.view.length)throw new ListError(this.user,`Invalid start index: ${e}`);if(t<0)throw new ListError(this.user,`Invalid delete count: ${t}`);t===0&&s.length===0||this.eventBufferer.bufferEvents(()=>this.spliceable.splice(e,t,s))}rerender(){this.view.rerender()}element(e){return this.view.element(e)}indexOf(e){return this.view.indexOf(e)}indexAt(e){return this.view.indexAt(e)}get length(){return this.view.length}get contentHeight(){return this.view.contentHeight}get onDidChangeContentHeight(){return this.view.onDidChangeContentHeight}get scrollTop(){return this.view.getScrollTop()}set scrollTop(e){this.view.setScrollTop(e)}get scrollHeight(){return this.view.scrollHeight}get renderHeight(){return this.view.renderHeight}get firstVisibleIndex(){return this.view.firstVisibleIndex}get ariaLabel(){return this._ariaLabel}set ariaLabel(e){this._ariaLabel=e,this.view.domNode.setAttribute("aria-label",e)}domFocus(){this.view.domNode.focus({preventScroll:!0})}layout(e,t){this.view.layout(e,t)}setSelection(e,t){for(const s of e)if(s<0||s>=this.length)throw new ListError(this.user,`Invalid index ${s}`);this.selection.set(e,t)}getSelection(){return this.selection.get()}getSelectedElements(){return this.getSelection().map(e=>this.view.element(e))}setAnchor(e){if(typeof e>"u"){this.anchor.set([]);return}if(e<0||e>=this.length)throw new ListError(this.user,`Invalid index ${e}`);this.anchor.set([e])}getAnchor(){return this.anchor.get().at(0)}getAnchorElement(){const e=this.getAnchor();return typeof e>"u"?void 0:this.element(e)}setFocus(e,t){for(const s of e)if(s<0||s>=this.length)throw new ListError(this.user,`Invalid index ${s}`);this.focus.set(e,t)}focusNext(e=1,t=!1,s,o){if(this.length===0)return;const r=this.focus.get(),l=this.findNextIndex(r.length>0?r[0]+e:0,t,o);l>-1&&this.setFocus([l],s)}focusPrevious(e=1,t=!1,s,o){if(this.length===0)return;const r=this.focus.get(),l=this.findPreviousIndex(r.length>0?r[0]-e:0,t,o);l>-1&&this.setFocus([l],s)}async focusNextPage(e,t){let s=this.view.indexAt(this.view.getScrollTop()+this.view.renderHeight);s=s===0?0:s-1;const o=this.getFocus()[0];if(o!==s&&(o===void 0||s>o)){const r=this.findPreviousIndex(s,!1,t);r>-1&&o!==r?this.setFocus([r],e):this.setFocus([s],e)}else{const r=this.view.getScrollTop();let l=r+this.view.renderHeight;s>o&&(l-=this.view.elementHeight(s)),this.view.setScrollTop(l),this.view.getScrollTop()!==r&&(this.setFocus([]),await timeout(0),await this.focusNextPage(e,t))}}async focusPreviousPage(e,t,s=()=>0){let o;const r=s(),l=this.view.getScrollTop()+r;l===0?o=this.view.indexAt(l):o=this.view.indexAfter(l-1);const c=this.getFocus()[0];if(c!==o&&(c===void 0||c>=o)){const d=this.findNextIndex(o,!1,t);d>-1&&c!==d?this.setFocus([d],e):this.setFocus([o],e)}else{const d=l;this.view.setScrollTop(l-this.view.renderHeight-r),this.view.getScrollTop()+s()!==d&&(this.setFocus([]),await timeout(0),await this.focusPreviousPage(e,t,s))}}focusLast(e,t){if(this.length===0)return;const s=this.findPreviousIndex(this.length-1,!1,t);s>-1&&this.setFocus([s],e)}focusFirst(e,t){this.focusNth(0,e,t)}focusNth(e,t,s){if(this.length===0)return;const o=this.findNextIndex(e,!1,s);o>-1&&this.setFocus([o],t)}findNextIndex(e,t=!1,s){for(let o=0;o<this.length;o++){if(e>=this.length&&!t)return-1;if(e=e%this.length,!s||s(this.element(e)))return e;e++}return-1}findPreviousIndex(e,t=!1,s){for(let o=0;o<this.length;o++){if(e<0&&!t)return-1;if(e=(this.length+e%this.length)%this.length,!s||s(this.element(e)))return e;e--}return-1}getFocus(){return this.focus.get()}getFocusedElements(){return this.getFocus().map(e=>this.view.element(e))}reveal(e,t,s=0){if(e<0||e>=this.length)throw new ListError(this.user,`Invalid index ${e}`);const o=this.view.getScrollTop(),r=this.view.elementTop(e),l=this.view.elementHeight(e);if(isNumber$1(t)){const c=l-this.view.renderHeight+s;this.view.setScrollTop(c*clamp(t,0,1)+r-s)}else{const c=r+l,d=o+this.view.renderHeight;r<o+s&&c>=d||(r<o+s||c>=d&&l>=this.view.renderHeight?this.view.setScrollTop(r-s):c>=d&&this.view.setScrollTop(c-this.view.renderHeight))}}getRelativeTop(e,t=0){if(e<0||e>=this.length)throw new ListError(this.user,`Invalid index ${e}`);const s=this.view.getScrollTop(),o=this.view.elementTop(e),r=this.view.elementHeight(e);if(o<s+t||o+r>s+this.view.renderHeight)return null;const l=r-this.view.renderHeight+t;return Math.abs((s+t-o)/l)}getHTMLElement(){return this.view.domNode}getScrollableElement(){return this.view.scrollableElementDomNode}getElementID(e){return this.view.getElementDomId(e)}getElementTop(e){return this.view.elementTop(e)}style(e){this.styleController.style(e)}toListEvent({indexes:e,browserEvent:t}){return{indexes:e,elements:e.map(s=>this.view.element(s)),browserEvent:t}}_onFocusChange(){const e=this.focus.get();this.view.domNode.classList.toggle("element-focused",e.length>0),this.onDidChangeActiveDescendant()}onDidChangeActiveDescendant(){var t;const e=this.focus.get();if(e.length>0){let s;(t=this.accessibilityProvider)!=null&&t.getActiveDescendantId&&(s=this.accessibilityProvider.getActiveDescendantId(this.view.element(e[0]))),this.view.domNode.setAttribute("aria-activedescendant",s||this.view.getElementDomId(e[0]))}else this.view.domNode.removeAttribute("aria-activedescendant")}_onSelectionChange(){const e=this.selection.get();this.view.domNode.classList.toggle("selection-none",e.length===0),this.view.domNode.classList.toggle("selection-single",e.length===1),this.view.domNode.classList.toggle("selection-multiple",e.length>1)}dispose(){this._onDidDispose.fire(),this.disposables.dispose(),this._onDidDispose.dispose()}}__decorate$2y([memoize],List.prototype,"onDidChangeFocus",null);__decorate$2y([memoize],List.prototype,"onDidChangeSelection",null);__decorate$2y([memoize],List.prototype,"onContextMenu",null);__decorate$2y([memoize],List.prototype,"onKeyDown",null);__decorate$2y([memoize],List.prototype,"onDidFocus",null);__decorate$2y([memoize],List.prototype,"onDidBlur",null);const selectBoxCustom="",$$k=$$l,SELECT_OPTION_ENTRY_TEMPLATE_ID="selectOption.entry.template";class SelectListRenderer{get templateId(){return SELECT_OPTION_ENTRY_TEMPLATE_ID}renderTemplate(e){const t=Object.create(null);return t.root=e,t.text=append$2(e,$$k(".option-text")),t.detail=append$2(e,$$k(".option-detail")),t.decoratorRight=append$2(e,$$k(".option-decorator-right")),t}renderElement(e,t,s){const o=s,r=e.text,l=e.detail,c=e.decoratorRight,d=e.isDisabled;o.text.textContent=r,o.detail.textContent=l||"",o.decoratorRight.textContent=c||"",d?o.root.classList.add("option-disabled"):o.root.classList.remove("option-disabled")}disposeTemplate(e){}}const $e=class $e extends Disposable{constructor(e,t,s,o,r){super(),this.options=[],this._currentSelection=0,this._hasDetails=!1,this._skipLayout=!1,this._sticky=!1,this._isVisible=!1,this.styles=o,this.selectBoxOptions=r||Object.create(null),typeof this.selectBoxOptions.minBottomMargin!="number"?this.selectBoxOptions.minBottomMargin=$e.DEFAULT_DROPDOWN_MINIMUM_BOTTOM_MARGIN:this.selectBoxOptions.minBottomMargin<0&&(this.selectBoxOptions.minBottomMargin=0),this.selectElement=document.createElement("select"),this.selectElement.className="monaco-select-box monaco-select-box-dropdown-padding",typeof this.selectBoxOptions.ariaLabel=="string"&&this.selectElement.setAttribute("aria-label",this.selectBoxOptions.ariaLabel),typeof this.selectBoxOptions.ariaDescription=="string"&&this.selectElement.setAttribute("aria-description",this.selectBoxOptions.ariaDescription),this._onDidSelect=new Emitter$1,this._register(this._onDidSelect),this.registerListeners(),this.constructSelectDropDown(s),this.selected=t||0,e&&this.setOptions(e,t),this.initStyleSheet()}setTitle(e){!this._hover&&e?this._hover=this._register(getBaseLayerHoverDelegate().setupManagedHover(getDefaultHoverDelegate("mouse"),this.selectElement,e)):this._hover&&this._hover.update(e)}getHeight(){return 22}getTemplateId(){return SELECT_OPTION_ENTRY_TEMPLATE_ID}constructSelectDropDown(e){this.contextViewProvider=e,this.selectDropDownContainer=$$l(".monaco-select-box-dropdown-container"),this.selectDropDownContainer.classList.add("monaco-select-box-dropdown-padding"),this.selectionDetailsPane=append$2(this.selectDropDownContainer,$$k(".select-box-details-pane"));const t=append$2(this.selectDropDownContainer,$$k(".select-box-dropdown-container-width-control")),s=append$2(t,$$k(".width-control-div"));this.widthControlElement=document.createElement("span"),this.widthControlElement.className="option-text-width-control",append$2(s,this.widthControlElement),this._dropDownPosition=0,this.styleElement=createStyleSheet(this.selectDropDownContainer),this.selectDropDownContainer.setAttribute("draggable","true"),this._register(addDisposableListener(this.selectDropDownContainer,EventType$1.DRAG_START,o=>{EventHelper.stop(o,!0)}))}registerListeners(){this._register(addStandardDisposableListener(this.selectElement,"change",t=>{this.selected=t.target.selectedIndex,this._onDidSelect.fire({index:t.target.selectedIndex,selected:t.target.value}),this.options[this.selected]&&this.options[this.selected].text&&this.setTitle(this.options[this.selected].text)})),this._register(addDisposableListener(this.selectElement,EventType$1.CLICK,t=>{EventHelper.stop(t),this._isVisible?this.hideSelectDropDown(!0):this.showSelectDropDown()})),this._register(addDisposableListener(this.selectElement,EventType$1.MOUSE_DOWN,t=>{EventHelper.stop(t)}));let e;this._register(addDisposableListener(this.selectElement,"touchstart",t=>{e=this._isVisible})),this._register(addDisposableListener(this.selectElement,"touchend",t=>{EventHelper.stop(t),e?this.hideSelectDropDown(!0):this.showSelectDropDown()})),this._register(addDisposableListener(this.selectElement,EventType$1.KEY_DOWN,t=>{const s=new StandardKeyboardEvent(t);let o=!1;isMacintosh?(s.keyCode===18||s.keyCode===16||s.keyCode===10||s.keyCode===3)&&(o=!0):(s.keyCode===18&&s.altKey||s.keyCode===16&&s.altKey||s.keyCode===10||s.keyCode===3)&&(o=!0),o&&(this.showSelectDropDown(),EventHelper.stop(t,!0))}))}get onDidSelect(){return this._onDidSelect.event}setOptions(e,t){equals$1(this.options,e)||(this.options=e,this.selectElement.options.length=0,this._hasDetails=!1,this._cachedMaxDetailsHeight=void 0,this.options.forEach((s,o)=>{this.selectElement.add(this.createOption(s.text,o,s.isDisabled)),typeof s.description=="string"&&(this._hasDetails=!0)})),t!==void 0&&(this.select(t),this._currentSelection=this.selected)}setOptionsList(){var e;(e=this.selectList)==null||e.splice(0,this.selectList.length,this.options)}select(e){e>=0&&e<this.options.length?this.selected=e:e>this.options.length-1?this.select(this.options.length-1):this.selected<0&&(this.selected=0),this.selectElement.selectedIndex=this.selected,this.options[this.selected]&&this.options[this.selected].text&&this.setTitle(this.options[this.selected].text)}focus(){this.selectElement&&(this.selectElement.tabIndex=0,this.selectElement.focus())}blur(){this.selectElement&&(this.selectElement.tabIndex=-1,this.selectElement.blur())}setFocusable(e){this.selectElement.tabIndex=e?0:-1}render(e){this.container=e,e.classList.add("select-container"),e.appendChild(this.selectElement),this.styleSelectElement()}initStyleSheet(){const e=[];this.styles.listFocusBackground&&e.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row.focused { background-color: ${this.styles.listFocusBackground} !important; }`),this.styles.listFocusForeground&&e.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row.focused { color: ${this.styles.listFocusForeground} !important; }`),this.styles.decoratorRightForeground&&e.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row:not(.focused) .option-decorator-right { color: ${this.styles.decoratorRightForeground}; }`),this.styles.selectBackground&&this.styles.selectBorder&&this.styles.selectBorder!==this.styles.selectBackground?(e.push(`.monaco-select-box-dropdown-container { border: 1px solid ${this.styles.selectBorder} } `),e.push(`.monaco-select-box-dropdown-container > .select-box-details-pane.border-top { border-top: 1px solid ${this.styles.selectBorder} } `),e.push(`.monaco-select-box-dropdown-container > .select-box-details-pane.border-bottom { border-bottom: 1px solid ${this.styles.selectBorder} } `)):this.styles.selectListBorder&&(e.push(`.monaco-select-box-dropdown-container > .select-box-details-pane.border-top { border-top: 1px solid ${this.styles.selectListBorder} } `),e.push(`.monaco-select-box-dropdown-container > .select-box-details-pane.border-bottom { border-bottom: 1px solid ${this.styles.selectListBorder} } `)),this.styles.listHoverForeground&&e.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row:not(.option-disabled):not(.focused):hover { color: ${this.styles.listHoverForeground} !important; }`),this.styles.listHoverBackground&&e.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row:not(.option-disabled):not(.focused):hover { background-color: ${this.styles.listHoverBackground} !important; }`),this.styles.listFocusOutline&&e.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row.focused { outline: 1.6px dotted ${this.styles.listFocusOutline} !important; outline-offset: -1.6px !important; }`),this.styles.listHoverOutline&&e.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row:not(.option-disabled):not(.focused):hover { outline: 1.6px dashed ${this.styles.listHoverOutline} !important; outline-offset: -1.6px !important; }`),e.push(".monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row.option-disabled.focused { background-color: transparent !important; color: inherit !important; outline: none !important; }"),e.push(".monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row.option-disabled:hover { background-color: transparent !important; color: inherit !important; outline: none !important; }"),this.styleElement.textContent=e.join(`
`)}styleSelectElement(){const e=this.styles.selectBackground??"",t=this.styles.selectForeground??"",s=this.styles.selectBorder??"";this.selectElement.style.backgroundColor=e,this.selectElement.style.color=t,this.selectElement.style.borderColor=s}styleList(){const e=this.styles.selectBackground??"",t=asCssValueWithDefault(this.styles.selectListBackground,e);this.selectDropDownListContainer.style.backgroundColor=t,this.selectionDetailsPane.style.backgroundColor=t;const s=this.styles.focusBorder??"";this.selectDropDownContainer.style.outlineColor=s,this.selectDropDownContainer.style.outlineOffset="-1px",this.selectList.style(this.styles)}createOption(e,t,s){const o=document.createElement("option");return o.value=e,o.text=e,o.disabled=!!s,o}showSelectDropDown(){this.selectionDetailsPane.textContent="",!(!this.contextViewProvider||this._isVisible)&&(this.createSelectList(this.selectDropDownContainer),this.setOptionsList(),this.contextViewProvider.showContextView({getAnchor:()=>this.selectElement,render:e=>this.renderSelectDropDown(e,!0),layout:()=>{this.layoutSelectDropDown()},onHide:()=>{this.selectDropDownContainer.classList.remove("visible"),this.selectElement.classList.remove("synthetic-focus")},anchorPosition:this._dropDownPosition},this.selectBoxOptions.optionsAsChildren?this.container:void 0),this._isVisible=!0,this.hideSelectDropDown(!1),this.contextViewProvider.showContextView({getAnchor:()=>this.selectElement,render:e=>this.renderSelectDropDown(e),layout:()=>this.layoutSelectDropDown(),onHide:()=>{this.selectDropDownContainer.classList.remove("visible"),this.selectElement.classList.remove("synthetic-focus")},anchorPosition:this._dropDownPosition},this.selectBoxOptions.optionsAsChildren?this.container:void 0),this._currentSelection=this.selected,this._isVisible=!0,this.selectElement.setAttribute("aria-expanded","true"))}hideSelectDropDown(e){!this.contextViewProvider||!this._isVisible||(this._isVisible=!1,this.selectElement.setAttribute("aria-expanded","false"),e&&this.selectElement.focus(),this.contextViewProvider.hideContextView())}renderSelectDropDown(e,t){return e.appendChild(this.selectDropDownContainer),this.layoutSelectDropDown(t),{dispose:()=>{this.selectDropDownContainer.remove()}}}measureMaxDetailsHeight(){let e=0;return this.options.forEach((t,s)=>{this.updateDetail(s),this.selectionDetailsPane.offsetHeight>e&&(e=this.selectionDetailsPane.offsetHeight)}),e}layoutSelectDropDown(e){if(this._skipLayout)return!1;if(this.selectList){this.selectDropDownContainer.classList.add("visible");const t=getWindow(this.selectElement),s=getDomNodePagePosition(this.selectElement),o=getWindow(this.selectElement).getComputedStyle(this.selectElement),r=parseFloat(o.getPropertyValue("--dropdown-padding-top"))+parseFloat(o.getPropertyValue("--dropdown-padding-bottom")),l=t.innerHeight-s.top-s.height-(this.selectBoxOptions.minBottomMargin||0),c=s.top-$e.DEFAULT_DROPDOWN_MINIMUM_TOP_MARGIN,d=this.selectElement.offsetWidth,u=this.setWidthControlElement(this.widthControlElement),g=Math.max(u,Math.round(d)).toString()+"px";this.selectDropDownContainer.style.width=g,this.selectList.getHTMLElement().style.height="",this.selectList.layout();let f=this.selectList.contentHeight;this._hasDetails&&this._cachedMaxDetailsHeight===void 0&&(this._cachedMaxDetailsHeight=this.measureMaxDetailsHeight());const p=this._hasDetails?this._cachedMaxDetailsHeight:0,m=f+r+p,_=Math.floor((l-r-p)/this.getHeight()),C=Math.floor((c-r-p)/this.getHeight());if(e)return s.top+s.height>t.innerHeight-22||s.top<$e.DEFAULT_DROPDOWN_MINIMUM_TOP_MARGIN||_<1&&C<1?!1:(_<$e.DEFAULT_MINIMUM_VISIBLE_OPTIONS&&C>_&&this.options.length>_?(this._dropDownPosition=1,this.selectDropDownListContainer.remove(),this.selectionDetailsPane.remove(),this.selectDropDownContainer.appendChild(this.selectionDetailsPane),this.selectDropDownContainer.appendChild(this.selectDropDownListContainer),this.selectionDetailsPane.classList.remove("border-top"),this.selectionDetailsPane.classList.add("border-bottom")):(this._dropDownPosition=0,this.selectDropDownListContainer.remove(),this.selectionDetailsPane.remove(),this.selectDropDownContainer.appendChild(this.selectDropDownListContainer),this.selectDropDownContainer.appendChild(this.selectionDetailsPane),this.selectionDetailsPane.classList.remove("border-bottom"),this.selectionDetailsPane.classList.add("border-top")),!0);if(s.top+s.height>t.innerHeight-22||s.top<$e.DEFAULT_DROPDOWN_MINIMUM_TOP_MARGIN||this._dropDownPosition===0&&_<1||this._dropDownPosition===1&&C<1)return this.hideSelectDropDown(!0),!1;if(this._dropDownPosition===0){if(this._isVisible&&_+C<1)return this.hideSelectDropDown(!0),!1;m>l&&(f=_*this.getHeight())}else m>c&&(f=C*this.getHeight());return this.selectList.layout(f),this.selectList.domFocus(),this.selectList.length>0&&(this.selectList.setFocus([this.selected||0]),this.selectList.reveal(this.selectList.getFocus()[0]||0)),this._hasDetails?(this.selectList.getHTMLElement().style.height=f+r+"px",this.selectDropDownContainer.style.height=""):this.selectDropDownContainer.style.height=f+r+"px",this.updateDetail(this.selected),this.selectDropDownContainer.style.width=g,this.selectDropDownListContainer.setAttribute("tabindex","0"),this.selectElement.classList.add("synthetic-focus"),this.selectDropDownContainer.classList.add("synthetic-focus"),!0}else return!1}setWidthControlElement(e){let t=0;if(e){let s=0,o=0;this.options.forEach((r,l)=>{const c=r.detail?r.detail.length:0,d=r.decoratorRight?r.decoratorRight.length:0,u=r.text.length+c+d;u>o&&(s=l,o=u)}),e.textContent=this.options[s].text+(this.options[s].decoratorRight?this.options[s].decoratorRight+" ":""),t=getTotalWidth(e)}return t}createSelectList(e){if(this.selectList)return;this.selectDropDownListContainer=append$2(e,$$k(".select-box-dropdown-list-container")),this.listRenderer=new SelectListRenderer,this.selectList=this._register(new List("SelectBoxCustom",this.selectDropDownListContainer,this,[this.listRenderer],{useShadows:!1,verticalScrollMode:3,keyboardSupport:!1,mouseSupport:!1,accessibilityProvider:{getAriaLabel:o=>{let r=o.text;return o.detail&&(r+=`. ${o.detail}`),o.decoratorRight&&(r+=`. ${o.decoratorRight}`),o.description&&(r+=`. ${o.description}`),r},getWidgetAriaLabel:()=>localize(16,"Select Box"),getRole:()=>isMacintosh?"":"option",getWidgetRole:()=>"listbox"}})),this.selectBoxOptions.ariaLabel&&(this.selectList.ariaLabel=this.selectBoxOptions.ariaLabel);const t=this._register(new DomEmitter(this.selectDropDownListContainer,"keydown")),s=Event$1.chain(t.event,o=>o.filter(()=>this.selectList.length>0).map(r=>new StandardKeyboardEvent(r)));this._register(Event$1.chain(s,o=>o.filter(r=>r.keyCode===3))(this.onEnter,this)),this._register(Event$1.chain(s,o=>o.filter(r=>r.keyCode===2))(this.onEnter,this)),this._register(Event$1.chain(s,o=>o.filter(r=>r.keyCode===9))(this.onEscape,this)),this._register(Event$1.chain(s,o=>o.filter(r=>r.keyCode===16))(this.onUpArrow,this)),this._register(Event$1.chain(s,o=>o.filter(r=>r.keyCode===18))(this.onDownArrow,this)),this._register(Event$1.chain(s,o=>o.filter(r=>r.keyCode===12))(this.onPageDown,this)),this._register(Event$1.chain(s,o=>o.filter(r=>r.keyCode===11))(this.onPageUp,this)),this._register(Event$1.chain(s,o=>o.filter(r=>r.keyCode===14))(this.onHome,this)),this._register(Event$1.chain(s,o=>o.filter(r=>r.keyCode===13))(this.onEnd,this)),this._register(Event$1.chain(s,o=>o.filter(r=>r.keyCode>=21&&r.keyCode<=56||r.keyCode>=85&&r.keyCode<=113))(this.onCharacter,this)),this._register(addDisposableListener(this.selectList.getHTMLElement(),EventType$1.POINTER_UP,o=>this.onPointerUp(o))),this._register(this.selectList.onMouseOver(o=>typeof o.index<"u"&&this.selectList.setFocus([o.index]))),this._register(this.selectList.onDidChangeFocus(o=>this.onListFocus(o))),this._register(addDisposableListener(this.selectDropDownContainer,EventType$1.FOCUS_OUT,o=>{!this._isVisible||isAncestor$1(o.relatedTarget,this.selectDropDownContainer)||this.onListBlur()})),this.selectList.getHTMLElement().setAttribute("aria-label",this.selectBoxOptions.ariaLabel||""),this.selectList.getHTMLElement().setAttribute("aria-expanded","true"),this.styleList()}onPointerUp(e){if(!this.selectList.length)return;EventHelper.stop(e);const t=e.target;if(!t||t.classList.contains("slider"))return;const s=t.closest(".monaco-list-row");if(!s)return;const o=Number(s.getAttribute("data-index")),r=s.classList.contains("option-disabled");o>=0&&o<this.options.length&&!r&&(this.selected=o,this.select(this.selected),this.selectList.setFocus([this.selected]),this.selectList.reveal(this.selectList.getFocus()[0]),this.selected!==this._currentSelection&&(this._currentSelection=this.selected,this._onDidSelect.fire({index:this.selectElement.selectedIndex,selected:this.options[this.selected].text}),this.options[this.selected]&&this.options[this.selected].text&&this.setTitle(this.options[this.selected].text)),this.hideSelectDropDown(!0))}onListBlur(){this._sticky||(this.selected!==this._currentSelection&&this.select(this._currentSelection),this.hideSelectDropDown(!1))}renderDescriptionMarkdown(e,t){const s=r=>{for(let l=0;l<r.childNodes.length;l++){const c=r.childNodes.item(l);(c.tagName&&c.tagName.toLowerCase())==="img"?c.remove():s(c)}},o=renderMarkdown$1({value:e,supportThemeIcons:!0},{actionHandler:t});return o.element.classList.add("select-box-description-markdown"),s(o.element),o.element}onListFocus(e){!this._isVisible||!this._hasDetails||this.updateDetail(e.indexes[0])}updateDetail(e){this.selectionDetailsPane.textContent="";const t=this.options[e],s=(t==null?void 0:t.description)??"",o=(t==null?void 0:t.descriptionIsMarkdown)??!1;if(s){if(o){const r=t.descriptionMarkdownActionHandler;this.selectionDetailsPane.appendChild(this.renderDescriptionMarkdown(s,r))}else this.selectionDetailsPane.textContent=s;this.selectionDetailsPane.style.display="block"}else this.selectionDetailsPane.style.display="none";this._skipLayout=!0,this.contextViewProvider.layout(),this._skipLayout=!1}onEscape(e){EventHelper.stop(e),this.select(this._currentSelection),this.hideSelectDropDown(!0)}onEnter(e){EventHelper.stop(e),this.selected!==this._currentSelection&&(this._currentSelection=this.selected,this._onDidSelect.fire({index:this.selectElement.selectedIndex,selected:this.options[this.selected].text}),this.options[this.selected]&&this.options[this.selected].text&&this.setTitle(this.options[this.selected].text)),this.hideSelectDropDown(!0)}onDownArrow(e){if(this.selected<this.options.length-1){EventHelper.stop(e,!0);const t=this.options[this.selected+1].isDisabled;if(t&&this.options.length>this.selected+2)this.selected+=2;else{if(t)return;this.selected++}this.select(this.selected),this.selectList.setFocus([this.selected]),this.selectList.reveal(this.selectList.getFocus()[0])}}onUpArrow(e){this.selected>0&&(EventHelper.stop(e,!0),this.options[this.selected-1].isDisabled&&this.selected>1?this.selected-=2:this.selected--,this.select(this.selected),this.selectList.setFocus([this.selected]),this.selectList.reveal(this.selectList.getFocus()[0]))}onPageUp(e){EventHelper.stop(e),this.selectList.focusPreviousPage(),setTimeout(()=>{this.selected=this.selectList.getFocus()[0],this.options[this.selected].isDisabled&&this.selected<this.options.length-1&&(this.selected++,this.selectList.setFocus([this.selected])),this.selectList.reveal(this.selected),this.select(this.selected)},1)}onPageDown(e){EventHelper.stop(e),this.selectList.focusNextPage(),setTimeout(()=>{this.selected=this.selectList.getFocus()[0],this.options[this.selected].isDisabled&&this.selected>0&&(this.selected--,this.selectList.setFocus([this.selected])),this.selectList.reveal(this.selected),this.select(this.selected)},1)}onHome(e){EventHelper.stop(e),!(this.options.length<2)&&(this.selected=0,this.options[this.selected].isDisabled&&this.selected>1&&this.selected++,this.selectList.setFocus([this.selected]),this.selectList.reveal(this.selected),this.select(this.selected))}onEnd(e){EventHelper.stop(e),!(this.options.length<2)&&(this.selected=this.options.length-1,this.options[this.selected].isDisabled&&this.selected>1&&this.selected--,this.selectList.setFocus([this.selected]),this.selectList.reveal(this.selected),this.select(this.selected))}onCharacter(e){const t=KeyCodeUtils.toString(e.keyCode);let s=-1;for(let o=0;o<this.options.length-1;o++)if(s=(o+this.selected+1)%this.options.length,this.options[s].text.charAt(0).toUpperCase()===t&&!this.options[s].isDisabled){this.select(s),this.selectList.setFocus([s]),this.selectList.reveal(this.selectList.getFocus()[0]),EventHelper.stop(e);break}}dispose(){this.hideSelectDropDown(!1),super.dispose()}};$e.DEFAULT_DROPDOWN_MINIMUM_BOTTOM_MARGIN=32,$e.DEFAULT_DROPDOWN_MINIMUM_TOP_MARGIN=2,$e.DEFAULT_MINIMUM_VISIBLE_OPTIONS=3;let SelectBoxList=$e;class SelectBoxNative extends Disposable{constructor(e,t,s,o){super(),this.selected=0,this.selectBoxOptions=o||Object.create(null),this.options=[],this.selectElement=document.createElement("select"),this.selectElement.className="monaco-select-box",typeof this.selectBoxOptions.ariaLabel=="string"&&this.selectElement.setAttribute("aria-label",this.selectBoxOptions.ariaLabel),typeof this.selectBoxOptions.ariaDescription=="string"&&this.selectElement.setAttribute("aria-description",this.selectBoxOptions.ariaDescription),this._onDidSelect=this._register(new Emitter$1),this.styles=s,this.registerListeners(),this.setOptions(e,t)}registerListeners(){this._register(Gesture.addTarget(this.selectElement)),[EventType.Tap].forEach(e=>{this._register(addDisposableListener(this.selectElement,e,t=>{this.selectElement.focus()}))}),this._register(addStandardDisposableListener(this.selectElement,"click",e=>{EventHelper.stop(e,!0)})),this._register(addStandardDisposableListener(this.selectElement,"change",e=>{this.selectElement.title=e.target.value,this._onDidSelect.fire({index:e.target.selectedIndex,selected:e.target.value})})),this._register(addStandardDisposableListener(this.selectElement,"keydown",e=>{let t=!1;isMacintosh?(e.keyCode===18||e.keyCode===16||e.keyCode===10)&&(t=!0):(e.keyCode===18&&e.altKey||e.keyCode===10||e.keyCode===3)&&(t=!0),t&&e.stopPropagation()}))}get onDidSelect(){return this._onDidSelect.event}setOptions(e,t){(!this.options||!equals$1(this.options,e))&&(this.options=e,this.selectElement.options.length=0,this.options.forEach((s,o)=>{this.selectElement.add(this.createOption(s.text,o,s.isDisabled))})),t!==void 0&&this.select(t)}select(e){this.options.length===0?this.selected=0:e>=0&&e<this.options.length?this.selected=e:e>this.options.length-1?this.select(this.options.length-1):this.selected<0&&(this.selected=0),this.selectElement.selectedIndex=this.selected,this.selected<this.options.length&&typeof this.options[this.selected].text=="string"?this.selectElement.title=this.options[this.selected].text:this.selectElement.title=""}focus(){this.selectElement&&(this.selectElement.tabIndex=0,this.selectElement.focus())}blur(){this.selectElement&&(this.selectElement.tabIndex=-1,this.selectElement.blur())}setFocusable(e){this.selectElement.tabIndex=e?0:-1}render(e){e.classList.add("select-container"),e.appendChild(this.selectElement),this.setOptions(this.options,this.selected),this.applyStyles()}applyStyles(){this.selectElement&&(this.selectElement.style.backgroundColor=this.styles.selectBackground??"",this.selectElement.style.color=this.styles.selectForeground??"",this.selectElement.style.borderColor=this.styles.selectBorder??"")}createOption(e,t,s){const o=document.createElement("option");return o.value=e,o.text=e,o.disabled=!!s,o}}class SelectBox extends Widget$1{constructor(e,t,s,o,r){super(),isMacintosh&&!(r!=null&&r.useCustomDrawn)?this.selectBoxDelegate=new SelectBoxNative(e,t,o,r):this.selectBoxDelegate=new SelectBoxList(e,t,s,o,r),this._register(this.selectBoxDelegate)}get onDidSelect(){return this.selectBoxDelegate.onDidSelect}setOptions(e,t){this.selectBoxDelegate.setOptions(e,t)}select(e){this.selectBoxDelegate.select(e)}focus(){this.selectBoxDelegate.focus()}blur(){this.selectBoxDelegate.blur()}setFocusable(e){this.selectBoxDelegate.setFocusable(e)}render(e){this.selectBoxDelegate.render(e)}}const actionbar="";class BaseActionViewItem extends Disposable{get action(){return this._action}constructor(e,t,s={}){super(),this.options=s,this._context=e||this,this._action=t,t instanceof Action&&this._register(t.onDidChange(o=>{this.element&&this.handleActionChangeEvent(o)}))}handleActionChangeEvent(e){e.enabled!==void 0&&this.updateEnabled(),e.checked!==void 0&&this.updateChecked(),e.class!==void 0&&this.updateClass(),e.label!==void 0&&(this.updateLabel(),this.updateTooltip()),e.tooltip!==void 0&&this.updateTooltip()}get actionRunner(){return this._actionRunner||(this._actionRunner=this._register(new ActionRunner)),this._actionRunner}set actionRunner(e){this._actionRunner=e}isEnabled(){return this._action.enabled}setActionContext(e){this._context=e}render(e){const t=this.element=e;this._register(Gesture.addTarget(e));const s=this.options&&this.options.draggable;s&&(e.draggable=!0,isFirefox$1&&this._register(addDisposableListener(e,EventType$1.DRAG_START,o=>{var r;return(r=o.dataTransfer)==null?void 0:r.setData(DataTransfers.TEXT,this._action.label)}))),this._register(addDisposableListener(t,EventType.Tap,o=>this.onClick(o,!0))),this._register(addDisposableListener(t,EventType$1.MOUSE_DOWN,o=>{s||EventHelper.stop(o,!0),this._action.enabled&&o.button===0&&t.classList.add("active")})),isMacintosh&&this._register(addDisposableListener(t,EventType$1.CONTEXT_MENU,o=>{o.button===0&&o.ctrlKey===!0&&this.onClick(o)})),this._register(addDisposableListener(t,EventType$1.CLICK,o=>{EventHelper.stop(o,!0),this.options&&this.options.isMenu||this.onClick(o)})),this._register(addDisposableListener(t,EventType$1.DBLCLICK,o=>{EventHelper.stop(o,!0)})),[EventType$1.MOUSE_UP,EventType$1.MOUSE_OUT].forEach(o=>{this._register(addDisposableListener(t,o,r=>{EventHelper.stop(r),t.classList.remove("active")}))})}onClick(e,t=!1){var o;EventHelper.stop(e,!0);const s=isUndefinedOrNull(this._context)?(o=this.options)!=null&&o.useEventAsContext?e:{preserveFocus:t}:this._context;this.actionRunner.run(this._action,s)}focus(){this.element&&(this.element.tabIndex=0,this.element.focus(),this.element.classList.add("focused"))}blur(){this.element&&(this.element.blur(),this.element.tabIndex=-1,this.element.classList.remove("focused"))}setFocusable(e){this.element&&(this.element.tabIndex=e?0:-1)}get trapsArrowNavigation(){return!1}updateEnabled(){}updateLabel(){}getClass(){return this.action.class}getTooltip(){return this.action.tooltip}getHoverContents(){return this.getTooltip()}updateTooltip(){if(!this.element)return;const e=this.getHoverContents()??"";if(this.updateAriaLabel(),!this.customHover&&e!==""){const t=this.options.hoverDelegate??getDefaultHoverDelegate("element");this.customHover=this._store.add(getBaseLayerHoverDelegate().setupManagedHover(t,this.element,e))}else this.customHover&&this.customHover.update(e)}updateAriaLabel(){if(this.element){const e=this.getTooltip()??"";this.element.setAttribute("aria-label",e)}}updateClass(){}updateChecked(){}dispose(){this.element&&(this.element.remove(),this.element=void 0),this._context=void 0,super.dispose()}}class ActionViewItem extends BaseActionViewItem{constructor(e,t,s){s={...s,icon:s.icon!==void 0?s.icon:!1,label:s.label!==void 0?s.label:!0},super(e,t,s),this.options=s,this.cssClass=""}render(e){super.render(e),assertType(this.element);const t=document.createElement("a");if(t.classList.add("action-label"),t.setAttribute("role",this.getDefaultAriaRole()),this.label=t,this.element.appendChild(t),this.options.label&&this.options.keybinding&&!this.options.keybindingNotRenderedWithLabel){const s=document.createElement("span");s.classList.add("keybinding"),s.textContent=this.options.keybinding,this.element.appendChild(s)}this.updateClass(),this.updateLabel(),this.updateTooltip(),this.updateEnabled(),this.updateChecked()}getDefaultAriaRole(){return this._action.id===Separator.ID?"presentation":this.options.isMenu?"menuitem":this.options.isTabList?"tab":"button"}focus(){this.label&&(this.label.tabIndex=0,this.label.focus())}blur(){this.label&&(this.label.tabIndex=-1)}setFocusable(e){this.label&&(this.label.tabIndex=e?0:-1)}updateLabel(){this.options.label&&this.label&&(this.label.textContent=this.action.label)}getTooltip(){let e=null;return this.action.tooltip?e=this.action.tooltip:this.action.label&&(e=this.action.label,this.options.keybinding&&(e=localize(0,"{0} ({1})",e,this.options.keybinding))),e??void 0}updateClass(){var e;this.cssClass&&this.label&&this.label.classList.remove(...this.cssClass.split(" ")),this.options.icon?(this.cssClass=this.getClass(),this.label&&(this.label.classList.add("codicon"),this.cssClass&&this.label.classList.add(...this.cssClass.split(" "))),this.updateEnabled()):(e=this.label)==null||e.classList.remove("codicon")}updateEnabled(){var e,t;this.action.enabled?(this.label&&(this.label.removeAttribute("aria-disabled"),this.label.classList.remove("disabled")),(e=this.element)==null||e.classList.remove("disabled")):(this.label&&(this.label.setAttribute("aria-disabled","true"),this.label.classList.add("disabled")),(t=this.element)==null||t.classList.add("disabled"))}updateAriaLabel(){if(this.label){const e=this.getTooltip()??"";this.label.setAttribute("aria-label",e)}}updateChecked(){this.label&&(this.action.checked!==void 0?(this.label.classList.toggle("checked",this.action.checked),this.options.isTabList?this.label.setAttribute("aria-selected",this.action.checked?"true":"false"):(this.label.setAttribute("aria-checked",this.action.checked?"true":"false"),this.label.setAttribute("role","checkbox"))):(this.label.classList.remove("checked"),this.label.removeAttribute(this.options.isTabList?"aria-selected":"aria-checked"),this.label.setAttribute("role",this.getDefaultAriaRole())))}}class SelectActionViewItem extends BaseActionViewItem{constructor(e,t,s,o,r,l,c){super(e,t),this.selectBox=new SelectBox(s,o,r,l,c),this.selectBox.setFocusable(!1),this._register(this.selectBox),this.registerListeners()}select(e){this.selectBox.select(e)}registerListeners(){this._register(this.selectBox.onDidSelect(e=>this.runAction(e.selected,e.index)))}runAction(e,t){this.actionRunner.run(this._action,this.getActionContext(e,t))}getActionContext(e,t){return e}setFocusable(e){this.selectBox.setFocusable(e)}focus(){var e;(e=this.selectBox)==null||e.focus()}blur(){var e;(e=this.selectBox)==null||e.blur()}render(e){this.selectBox.render(e)}}class ActionBar extends Disposable{get onDidBlur(){return this._onDidBlur.event}get onDidCancel(){return this._onDidCancel.event}get onDidRun(){return this._onDidRun.event}get onWillRun(){return this._onWillRun.event}constructor(e,t={}){var r,l;super(),this._actionRunnerDisposables=this._register(new DisposableStore),this.viewItemDisposables=this._register(new DisposableMap),this.triggerKeyDown=!1,this.focusable=!0,this._onDidBlur=this._register(new Emitter$1),this._onDidCancel=this._register(new Emitter$1({onWillAddFirstListener:()=>this.cancelHasListener=!0})),this.cancelHasListener=!1,this._onDidRun=this._register(new Emitter$1),this._onWillRun=this._register(new Emitter$1),this.options=t,this._context=t.context??null,this._orientation=this.options.orientation??0,this._triggerKeys={keyDown:((r=this.options.triggerKeys)==null?void 0:r.keyDown)??!1,keys:((l=this.options.triggerKeys)==null?void 0:l.keys)??[3,10]},this._hoverDelegate=t.hoverDelegate??this._register(createInstantHoverDelegate()),this.options.actionRunner?this._actionRunner=this.options.actionRunner:(this._actionRunner=new ActionRunner,this._actionRunnerDisposables.add(this._actionRunner)),this._actionRunnerDisposables.add(this._actionRunner.onDidRun(c=>this._onDidRun.fire(c))),this._actionRunnerDisposables.add(this._actionRunner.onWillRun(c=>this._onWillRun.fire(c))),this.viewItems=[],this.focusedItem=void 0,this.domNode=document.createElement("div"),this.domNode.className="monaco-action-bar";let s,o;switch(this._orientation){case 0:s=[15],o=[17];break;case 1:s=[16],o=[18],this.domNode.className+=" vertical";break}this._register(addDisposableListener(this.domNode,EventType$1.KEY_DOWN,c=>{const d=new StandardKeyboardEvent(c);let u=!0;const g=typeof this.focusedItem=="number"?this.viewItems[this.focusedItem]:void 0;s&&(d.equals(s[0])||d.equals(s[1]))?u=this.focusPrevious():o&&(d.equals(o[0])||d.equals(o[1]))?u=this.focusNext():d.equals(9)&&this.cancelHasListener?this._onDidCancel.fire():d.equals(14)?u=this.focusFirst():d.equals(13)?u=this.focusLast():d.equals(2)&&g instanceof BaseActionViewItem&&g.trapsArrowNavigation?u=this.focusNext(void 0,!0):this.isTriggerKeyEvent(d)?this._triggerKeys.keyDown?this.doTrigger(d):this.triggerKeyDown=!0:u=!1,u&&(d.preventDefault(),d.stopPropagation())})),this._register(addDisposableListener(this.domNode,EventType$1.KEY_UP,c=>{const d=new StandardKeyboardEvent(c);this.isTriggerKeyEvent(d)?(!this._triggerKeys.keyDown&&this.triggerKeyDown&&(this.triggerKeyDown=!1,this.doTrigger(d)),d.preventDefault(),d.stopPropagation()):(d.equals(2)||d.equals(1026)||d.equals(16)||d.equals(18)||d.equals(15)||d.equals(17))&&this.updateFocusedItem()})),this.focusTracker=this._register(trackFocus(this.domNode)),this._register(this.focusTracker.onDidBlur(()=>{(getActiveElement()===this.domNode||!isAncestor$1(getActiveElement(),this.domNode))&&(this._onDidBlur.fire(),this.previouslyFocusedItem=this.focusedItem,this.focusedItem=void 0,this.triggerKeyDown=!1)})),this._register(this.focusTracker.onDidFocus(()=>this.updateFocusedItem())),this.actionsList=document.createElement("ul"),this.actionsList.className="actions-container",this.options.highlightToggledItems&&this.actionsList.classList.add("highlight-toggled"),this.actionsList.setAttribute("role",this.options.ariaRole||"toolbar"),this.options.ariaLabel&&this.actionsList.setAttribute("aria-label",this.options.ariaLabel),this.domNode.appendChild(this.actionsList),e.appendChild(this.domNode)}refreshRole(){this.length()>=1?this.actionsList.setAttribute("role",this.options.ariaRole||"toolbar"):this.actionsList.setAttribute("role","presentation")}setFocusable(e){if(this.focusable=e,this.focusable){const t=this.viewItems.find(s=>s instanceof BaseActionViewItem&&s.isEnabled());t instanceof BaseActionViewItem&&t.setFocusable(!0)}else this.viewItems.forEach(t=>{t instanceof BaseActionViewItem&&t.setFocusable(!1)})}isTriggerKeyEvent(e){let t=!1;return this._triggerKeys.keys.forEach(s=>{t=t||e.equals(s)}),t}updateFocusedItem(){var e,t;for(let s=0;s<this.actionsList.children.length;s++){const o=this.actionsList.children[s];if(isAncestor$1(getActiveElement(),o)){this.focusedItem=s,(t=(e=this.viewItems[this.focusedItem])==null?void 0:e.showHover)==null||t.call(e);break}}}get context(){return this._context}set context(e){this._context=e,this.viewItems.forEach(t=>t.setActionContext(e))}get actionRunner(){return this._actionRunner}set actionRunner(e){this._actionRunner=e,this._actionRunnerDisposables.clear(),this._actionRunnerDisposables.add(this._actionRunner.onDidRun(t=>this._onDidRun.fire(t))),this._actionRunnerDisposables.add(this._actionRunner.onWillRun(t=>this._onWillRun.fire(t))),this.viewItems.forEach(t=>t.actionRunner=e)}getContainer(){return this.domNode}getAction(e){var t;if(typeof e=="number")return(t=this.viewItems[e])==null?void 0:t.action;if(isHTMLElement(e)){for(;e.parentElement!==this.actionsList;){if(!e.parentElement)return;e=e.parentElement}for(let s=0;s<this.actionsList.childNodes.length;s++)if(this.actionsList.childNodes[s]===e)return this.viewItems[s].action}}push(e,t={}){const s=Array.isArray(e)?e:[e];let o=isNumber$1(t.index)?t.index:null;if(s.forEach(r=>{const l=document.createElement("li");l.className="action-item",l.setAttribute("role","presentation");let c;const d={hoverDelegate:this._hoverDelegate,...t,isTabList:this.options.ariaRole==="tablist"};this.options.actionViewItemProvider&&(c=this.options.actionViewItemProvider(r,d)),c||(c=new ActionViewItem(this.context,r,d)),this.options.allowContextMenu||this.viewItemDisposables.set(c,addDisposableListener(l,EventType$1.CONTEXT_MENU,u=>{EventHelper.stop(u,!0)})),c.actionRunner=this._actionRunner,c.setActionContext(this.context),c.render(l),o===null||o<0||o>=this.actionsList.children.length?(this.actionsList.appendChild(l),this.viewItems.push(c)):(this.actionsList.insertBefore(l,this.actionsList.children[o]),this.viewItems.splice(o,0,c),o++)}),this.focusable){let r=!1;for(const l of this.viewItems){if(!(l instanceof BaseActionViewItem))continue;let c;r||l.action.id===Separator.ID||!l.isEnabled()&&this.options.focusOnlyEnabledItems?c=!1:c=!0,c?(l.setFocusable(!0),r=!0):l.setFocusable(!1)}}typeof this.focusedItem=="number"&&this.focus(this.focusedItem),this.refreshRole()}clear(){this.isEmpty()||(this.viewItems=dispose(this.viewItems),this.viewItemDisposables.clearAndDisposeAll(),clearNode(this.actionsList),this.refreshRole())}length(){return this.viewItems.length}isEmpty(){return this.viewItems.length===0}focus(e){let t=!1,s;if(e===void 0?t=!0:typeof e=="number"?s=e:typeof e=="boolean"&&(t=e),t&&typeof this.focusedItem>"u"){const o=this.viewItems.findIndex(r=>r.isEnabled());this.focusedItem=o===-1?void 0:o,this.updateFocus(void 0,void 0,!0)}else s!==void 0&&(this.focusedItem=s),this.updateFocus(void 0,void 0,!0)}focusFirst(){return this.focusedItem=this.length()-1,this.focusNext(!0)}focusLast(){return this.focusedItem=0,this.focusPrevious(!0)}focusNext(e,t){if(typeof this.focusedItem>"u")this.focusedItem=this.viewItems.length-1;else if(this.viewItems.length<=1)return!1;const s=this.focusedItem;let o;do{if(!e&&this.options.preventLoopNavigation&&this.focusedItem+1>=this.viewItems.length)return this.focusedItem=s,!1;this.focusedItem=(this.focusedItem+1)%this.viewItems.length,o=this.viewItems[this.focusedItem]}while(this.focusedItem!==s&&(this.options.focusOnlyEnabledItems&&!o.isEnabled()||o.action.id===Separator.ID));return this.updateFocus(void 0,void 0,t),!0}focusPrevious(e){if(typeof this.focusedItem>"u")this.focusedItem=0;else if(this.viewItems.length<=1)return!1;const t=this.focusedItem;let s;do{if(this.focusedItem=this.focusedItem-1,this.focusedItem<0){if(!e&&this.options.preventLoopNavigation)return this.focusedItem=t,!1;this.focusedItem=this.viewItems.length-1}s=this.viewItems[this.focusedItem]}while(this.focusedItem!==t&&(this.options.focusOnlyEnabledItems&&!s.isEnabled()||s.action.id===Separator.ID));return this.updateFocus(!0),!0}updateFocus(e,t,s=!1){var r,l;typeof this.focusedItem>"u"&&this.actionsList.focus({preventScroll:t}),this.previouslyFocusedItem!==void 0&&this.previouslyFocusedItem!==this.focusedItem&&((r=this.viewItems[this.previouslyFocusedItem])==null||r.blur());const o=this.focusedItem!==void 0?this.viewItems[this.focusedItem]:void 0;if(o){let c=!0;isFunction(o.focus)||(c=!1),this.options.focusOnlyEnabledItems&&isFunction(o.isEnabled)&&!o.isEnabled()&&(c=!1),o.action.id===Separator.ID&&(c=!1),c?(s||this.previouslyFocusedItem!==this.focusedItem)&&(o.focus(e),this.previouslyFocusedItem=this.focusedItem):(this.actionsList.focus({preventScroll:t}),this.previouslyFocusedItem=void 0),c&&((l=o.showHover)==null||l.call(o))}}doTrigger(e){if(typeof this.focusedItem>"u")return;const t=this.viewItems[this.focusedItem];if(t instanceof BaseActionViewItem){const s=t._context===null||t._context===void 0?e:t._context;this.run(t._action,s)}}async run(e,t){await this._actionRunner.run(e,t)}dispose(){this._context=void 0,this.viewItems=dispose(this.viewItems),this.getContainer().remove(),super.dispose()}}function joinCombine(a,e,t,s){if(a.length===0)return e;if(e.length===0)return a;const o=[];let r=0,l=0;for(;r<a.length&&l<e.length;){const c=a[r],d=e[l],u=t(c),g=t(d);u<g?(o.push(c),r++):u>g?(o.push(d),l++):(o.push(s(c,d)),r++,l++)}for(;r<a.length;)o.push(a[r]),r++;for(;l<e.length;)o.push(e[l]),l++;return o}function applyObservableDecorations(a,e){const t=new DisposableStore,s=a.createDecorationsCollection();return t.add(autorunOpts({debugName:()=>`Apply decorations from ${e.debugName}`},o=>{const r=e.read(o);s.set(r)})),t.add({dispose:()=>{s.clear()}}),t}function appendRemoveOnDispose(a,e){return a.appendChild(e),toDisposable(()=>{e.remove()})}function prependRemoveOnDispose(a,e){return a.prepend(e),toDisposable(()=>{e.remove()})}class ObservableElementSizeObserver extends Disposable{get width(){return this._width}get height(){return this._height}get automaticLayout(){return this._automaticLayout}constructor(e,t){super(),this._automaticLayout=!1,this.elementSizeObserver=this._register(new ElementSizeObserver(e,t)),this._width=observableValue(this,this.elementSizeObserver.getWidth()),this._height=observableValue(this,this.elementSizeObserver.getHeight()),this._register(this.elementSizeObserver.onDidChange(s=>transaction(o=>{this._width.set(this.elementSizeObserver.getWidth(),o),this._height.set(this.elementSizeObserver.getHeight(),o)})))}observe(e){this.elementSizeObserver.observe(e)}setAutomaticLayout(e){this._automaticLayout=e,e?this.elementSizeObserver.startObserving():this.elementSizeObserver.stopObserving()}}function animatedObservable(a,e,t){let s=e.get(),o=s,r=s;const l=observableValue("animatedValue",s);let c=-1;const d=300;let u;t.add(autorunHandleChanges({changeTracker:{createChangeSummary:()=>({animate:!1}),handleChange:(f,p)=>(f.didChange(e)&&(p.animate=p.animate||f.change),!0)}},(f,p)=>{u!==void 0&&(a.cancelAnimationFrame(u),u=void 0),o=r,s=e.read(f),c=Date.now()-(p.animate?0:d),g()}));function g(){const f=Date.now()-c;r=Math.floor(easeOutExpo$1(f,o,s-o,d)),f<d?u=a.requestAnimationFrame(g):r=s,l.set(r,void 0)}return l}function easeOutExpo$1(a,e,t,s){return a===s?e+t:t*(-Math.pow(2,-10*a/s)+1)+e}class ViewZoneOverlayWidget extends Disposable{constructor(e,t,s){super(),this._register(new ManagedOverlayWidget(e,s)),this._register(applyStyle(s,{height:t.actualHeight,top:t.actualTop}))}}class PlaceholderViewZone{get afterLineNumber(){return this._afterLineNumber.get()}constructor(e,t){this._afterLineNumber=e,this.heightInPx=t,this.domNode=document.createElement("div"),this._actualTop=observableValue(this,void 0),this._actualHeight=observableValue(this,void 0),this.actualTop=this._actualTop,this.actualHeight=this._actualHeight,this.showInHiddenAreas=!0,this.onChange=this._afterLineNumber,this.onDomNodeTop=s=>{this._actualTop.set(s,void 0)},this.onComputedHeight=s=>{this._actualHeight.set(s,void 0)}}}const bs=class bs{constructor(e,t){this._editor=e,this._domElement=t,this._overlayWidgetId=`managedOverlayWidget-${bs._counter++}`,this._overlayWidget={getId:()=>this._overlayWidgetId,getDomNode:()=>this._domElement,getPosition:()=>null},this._editor.addOverlayWidget(this._overlayWidget)}dispose(){this._editor.removeOverlayWidget(this._overlayWidget)}};bs._counter=0;let ManagedOverlayWidget=bs;function applyStyle(a,e){return autorun(t=>{for(let[s,o]of Object.entries(e))o&&typeof o=="object"&&"read"in o&&(o=o.read(t)),typeof o=="number"&&(o=`${o}px`),s=s.replace(/[A-Z]/g,r=>"-"+r.toLowerCase()),a.style[s]=o})}function applyViewZones(a,e,t,s){const o=new DisposableStore,r=[];return o.add(autorunWithStore((l,c)=>{const d=e.read(l),u=new Map,g=new Map;t&&t(!0),a.changeViewZones(f=>{for(const p of r)f.removeZone(p),s==null||s.delete(p);r.length=0;for(const p of d){const m=f.addZone(p);p.setZoneId&&p.setZoneId(m),r.push(m),s==null||s.add(m),u.set(p,m)}}),t&&t(!1),c.add(autorunHandleChanges({changeTracker:{createChangeSummary(){return{zoneIds:[]}},handleChange(f,p){const m=g.get(f.changedObservable);return m!==void 0&&p.zoneIds.push(m),!0}}},(f,p)=>{for(const m of d)m.onChange&&(g.set(m.onChange,u.get(m)),m.onChange.read(f));t&&t(!0),a.changeViewZones(m=>{for(const _ of p.zoneIds)m.layoutZone(_)}),t&&t(!1)}))})),o.add({dispose(){t&&t(!0),a.changeViewZones(l=>{for(const c of r)l.removeZone(c)}),s==null||s.clear(),t&&t(!1)}}),o}class DisposableCancellationTokenSource extends CancellationTokenSource$1{dispose(){super.dispose(!0)}}function translatePosition(a,e){const t=findLast(e,o=>o.original.startLineNumber<=a.lineNumber);if(!t)return Range$2.fromPositions(a);if(t.original.endLineNumberExclusive<=a.lineNumber){const o=a.lineNumber-t.original.endLineNumberExclusive+t.modified.endLineNumberExclusive;return Range$2.fromPositions(new Position$1(o,a.column))}if(!t.innerChanges)return Range$2.fromPositions(new Position$1(t.modified.startLineNumber,1));const s=findLast(t.innerChanges,o=>o.originalRange.getStartPosition().isBeforeOrEqual(a));if(!s){const o=a.lineNumber-t.original.startLineNumber+t.modified.startLineNumber;return Range$2.fromPositions(new Position$1(o,a.column))}if(s.originalRange.containsPosition(a))return s.modifiedRange;{const o=lengthBetweenPositions(s.originalRange.getEndPosition(),a);return Range$2.fromPositions(o.addToPosition(s.modifiedRange.getEndPosition()))}}function lengthBetweenPositions(a,e){return a.lineNumber===e.lineNumber?new TextLength(0,e.column-a.column):new TextLength(e.lineNumber-a.lineNumber,e.column-1)}function filterWithPrevious(a,e){let t;return a.filter(s=>{const o=e(s,t);return t=s,o})}class RefCounted{static create(e,t=void 0){return new BaseRefCounted(e,e,t)}static createWithDisposable(e,t,s=void 0){const o=new DisposableStore;return o.add(t),o.add(e),new BaseRefCounted(e,o,s)}}class BaseRefCounted extends RefCounted{constructor(e,t,s){super(),this.object=e,this._disposable=t,this._debugOwner=s,this._refCount=1,this._isDisposed=!1,this._owners=[],s&&this._addOwner(s)}_addOwner(e){e&&this._owners.push(e)}createNewRef(e){return this._refCount++,e&&this._addOwner(e),new ClonedRefCounted(this,e)}dispose(){this._isDisposed||(this._isDisposed=!0,this._decreaseRefCount(this._debugOwner))}_decreaseRefCount(e){if(this._refCount--,this._refCount===0&&this._disposable.dispose(),e){const t=this._owners.indexOf(e);t!==-1&&this._owners.splice(t,1)}}}class ClonedRefCounted extends RefCounted{constructor(e,t){super(),this._base=e,this._debugOwner=t,this._isDisposed=!1}get object(){return this._base.object}createNewRef(e){return this._base.createNewRef(e)}dispose(){this._isDisposed||(this._isDisposed=!0,this._base._decreaseRefCount(this._debugOwner))}}class LineRangeMapping{static inverse(e,t,s){const o=[];let r=1,l=1;for(const d of e){const u=new LineRangeMapping(new LineRange(r,d.original.startLineNumber),new LineRange(l,d.modified.startLineNumber));u.modified.isEmpty||o.push(u),r=d.original.endLineNumberExclusive,l=d.modified.endLineNumberExclusive}const c=new LineRangeMapping(new LineRange(r,t+1),new LineRange(l,s+1));return c.modified.isEmpty||o.push(c),o}static clip(e,t,s){const o=[];for(const r of e){const l=r.original.intersect(t),c=r.modified.intersect(s);l&&!l.isEmpty&&c&&!c.isEmpty&&o.push(new LineRangeMapping(l,c))}return o}constructor(e,t){this.original=e,this.modified=t}toString(){return`{${this.original.toString()}->${this.modified.toString()}}`}flip(){return new LineRangeMapping(this.modified,this.original)}join(e){return new LineRangeMapping(this.original.join(e.original),this.modified.join(e.modified))}toRangeMapping(){const e=this.original.toInclusiveRange(),t=this.modified.toInclusiveRange();if(e&&t)return new RangeMapping(e,t);if(this.original.startLineNumber===1||this.modified.startLineNumber===1){if(!(this.modified.startLineNumber===1&&this.original.startLineNumber===1))throw new BugIndicatingError("not a valid diff");return new RangeMapping(new Range$2(this.original.startLineNumber,1,this.original.endLineNumberExclusive,1),new Range$2(this.modified.startLineNumber,1,this.modified.endLineNumberExclusive,1))}else return new RangeMapping(new Range$2(this.original.startLineNumber-1,Number.MAX_SAFE_INTEGER,this.original.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),new Range$2(this.modified.startLineNumber-1,Number.MAX_SAFE_INTEGER,this.modified.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER))}toRangeMapping2(e,t){if(isValidLineNumber(this.original.endLineNumberExclusive,e)&&isValidLineNumber(this.modified.endLineNumberExclusive,t))return new RangeMapping(new Range$2(this.original.startLineNumber,1,this.original.endLineNumberExclusive,1),new Range$2(this.modified.startLineNumber,1,this.modified.endLineNumberExclusive,1));if(!this.original.isEmpty&&!this.modified.isEmpty)return new RangeMapping(Range$2.fromPositions(new Position$1(this.original.startLineNumber,1),normalizePosition(new Position$1(this.original.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),e)),Range$2.fromPositions(new Position$1(this.modified.startLineNumber,1),normalizePosition(new Position$1(this.modified.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),t)));if(this.original.startLineNumber>1&&this.modified.startLineNumber>1)return new RangeMapping(Range$2.fromPositions(normalizePosition(new Position$1(this.original.startLineNumber-1,Number.MAX_SAFE_INTEGER),e),normalizePosition(new Position$1(this.original.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),e)),Range$2.fromPositions(normalizePosition(new Position$1(this.modified.startLineNumber-1,Number.MAX_SAFE_INTEGER),t),normalizePosition(new Position$1(this.modified.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),t)));throw new BugIndicatingError}}function normalizePosition(a,e){if(a.lineNumber<1)return new Position$1(1,1);if(a.lineNumber>e.length)return new Position$1(e.length,e[e.length-1].length+1);const t=e[a.lineNumber-1];return a.column>t.length+1?new Position$1(a.lineNumber,t.length+1):a}function isValidLineNumber(a,e){return a>=1&&a<=e.length}class DetailedLineRangeMapping extends LineRangeMapping{static fromRangeMappings(e){const t=LineRange.join(e.map(o=>LineRange.fromRangeInclusive(o.originalRange))),s=LineRange.join(e.map(o=>LineRange.fromRangeInclusive(o.modifiedRange)));return new DetailedLineRangeMapping(t,s,e)}constructor(e,t,s){super(e,t),this.innerChanges=s}flip(){var e;return new DetailedLineRangeMapping(this.modified,this.original,(e=this.innerChanges)==null?void 0:e.map(t=>t.flip()))}withInnerChangesFromLineRanges(){return new DetailedLineRangeMapping(this.original,this.modified,[this.toRangeMapping()])}}class RangeMapping{static fromEdit(e){const t=e.getNewRanges();return e.replacements.map((o,r)=>new RangeMapping(o.range,t[r]))}static assertSorted(e){for(let t=1;t<e.length;t++){const s=e[t-1],o=e[t];if(!(s.originalRange.getEndPosition().isBeforeOrEqual(o.originalRange.getStartPosition())&&s.modifiedRange.getEndPosition().isBeforeOrEqual(o.modifiedRange.getStartPosition())))throw new BugIndicatingError("Range mappings must be sorted")}}constructor(e,t){this.originalRange=e,this.modifiedRange=t}toString(){return`{${this.originalRange.toString()}->${this.modifiedRange.toString()}}`}flip(){return new RangeMapping(this.modifiedRange,this.originalRange)}toTextEdit(e){const t=e.getValueOfRange(this.modifiedRange);return new TextReplacement(this.originalRange,t)}}function lineRangeMappingFromRangeMappings(a,e,t,s=!1){const o=[];for(const r of groupAdjacentBy(a.map(l=>getLineRangeMapping(l,e,t)),(l,c)=>l.original.intersectsOrTouches(c.original)||l.modified.intersectsOrTouches(c.modified))){const l=r[0],c=r[r.length-1];o.push(new DetailedLineRangeMapping(l.original.join(c.original),l.modified.join(c.modified),r.map(d=>d.innerChanges[0])))}return assertFn(()=>!s&&o.length>0&&(o[0].modified.startLineNumber!==o[0].original.startLineNumber||t.length.lineCount-o[o.length-1].modified.endLineNumberExclusive!==e.length.lineCount-o[o.length-1].original.endLineNumberExclusive)?!1:checkAdjacentItems(o,(r,l)=>l.original.startLineNumber-r.original.endLineNumberExclusive===l.modified.startLineNumber-r.modified.endLineNumberExclusive&&r.original.endLineNumberExclusive<l.original.startLineNumber&&r.modified.endLineNumberExclusive<l.modified.startLineNumber)),o}function getLineRangeMapping(a,e,t){let s=0,o=0;a.modifiedRange.endColumn===1&&a.originalRange.endColumn===1&&a.originalRange.startLineNumber+s<=a.originalRange.endLineNumber&&a.modifiedRange.startLineNumber+s<=a.modifiedRange.endLineNumber&&(o=-1),a.modifiedRange.startColumn-1>=t.getLineLength(a.modifiedRange.startLineNumber)&&a.originalRange.startColumn-1>=e.getLineLength(a.originalRange.startLineNumber)&&a.originalRange.startLineNumber<=a.originalRange.endLineNumber+o&&a.modifiedRange.startLineNumber<=a.modifiedRange.endLineNumber+o&&(s=1);const r=new LineRange(a.originalRange.startLineNumber+s,a.originalRange.endLineNumber+1+o),l=new LineRange(a.modifiedRange.startLineNumber+s,a.modifiedRange.endLineNumber+1+o);return new DetailedLineRangeMapping(r,l,[a])}const Extensions$2={IconContribution:"base.contributions.icons"};var IconContribution;(function(a){function e(t,s){let o=t.defaults;for(;ThemeIcon.isThemeIcon(o);){const r=iconRegistry.getIcon(o.id);if(!r)return;o=r.defaults}return o}a.getDefinition=e})(IconContribution||(IconContribution={}));var IconFontDefinition;(function(a){function e(s){return{weight:s.weight,style:s.style,src:s.src.map(o=>({format:o.format,location:o.location.toString()}))}}a.toJSONObject=e;function t(s){const o=r=>isString$1(r)?r:void 0;if(s&&Array.isArray(s.src)&&s.src.every(r=>isString$1(r.format)&&isString$1(r.location)))return{weight:o(s.weight),style:o(s.style),src:s.src.map(r=>({format:r.format,location:URI.parse(r.location)}))}}a.fromJSONObject=t})(IconFontDefinition||(IconFontDefinition={}));const fontIdRegex=/^([\w_-]+)$/,fontIdErrorMessage=localize(2006,"The font ID must only contain letters, numbers, underscores and dashes.");class IconRegistry extends Disposable{constructor(){super(),this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,this.iconSchema={definitions:{icons:{type:"object",properties:{fontId:{type:"string",description:localize(2007,"The id of the font to use. If not set, the font that is defined first is used."),pattern:fontIdRegex.source,patternErrorMessage:fontIdErrorMessage},fontCharacter:{type:"string",description:localize(2008,"The font character associated with the icon definition.")}},additionalProperties:!1,defaultSnippets:[{body:{fontCharacter:"\\\\e030"}}]}},type:"object",properties:{}},this.iconReferenceSchema={type:"string",pattern:`^${ThemeIcon.iconNameExpression}$`,enum:[],enumDescriptions:[]},this.iconsById={},this.iconFontsById={}}registerIcon(e,t,s,o){const r=this.iconsById[e];if(r){if(s&&!r.description){r.description=s,this.iconSchema.properties[e].markdownDescription=`${s} $(${e})`;const d=this.iconReferenceSchema.enum.indexOf(e);d!==-1&&(this.iconReferenceSchema.enumDescriptions[d]=s),this._onDidChange.fire()}return r}const l={id:e,description:s,defaults:t,deprecationMessage:o};this.iconsById[e]=l;const c={$ref:"#/definitions/icons"};return o&&(c.deprecationMessage=o),s&&(c.markdownDescription=`${s}: $(${e})`),this.iconSchema.properties[e]=c,this.iconReferenceSchema.enum.push(e),this.iconReferenceSchema.enumDescriptions.push(s||""),this._onDidChange.fire(),{id:e}}getIcons(){return Object.keys(this.iconsById).map(e=>this.iconsById[e])}getIcon(e){return this.iconsById[e]}getIconSchema(){return this.iconSchema}toString(){const e=(r,l)=>r.id.localeCompare(l.id),t=r=>{for(;ThemeIcon.isThemeIcon(r.defaults);)r=this.iconsById[r.defaults.id];return`codicon codicon-${r?r.id:""}`},s=[];s.push("| preview     | identifier                        | default codicon ID                | description"),s.push("| ----------- | --------------------------------- | --------------------------------- | --------------------------------- |");const o=Object.keys(this.iconsById).map(r=>this.iconsById[r]);for(const r of o.filter(l=>!!l.description).sort(e))s.push(`|<i class="${t(r)}"></i>|${r.id}|${ThemeIcon.isThemeIcon(r.defaults)?r.defaults.id:r.id}|${r.description||""}|`);s.push("| preview     | identifier                        "),s.push("| ----------- | --------------------------------- |");for(const r of o.filter(l=>!ThemeIcon.isThemeIcon(l.defaults)).sort(e))s.push(`|<i class="${t(r)}"></i>|${r.id}|`);return s.join(`
`)}}const iconRegistry=new IconRegistry;Registry.add(Extensions$2.IconContribution,iconRegistry);function registerIcon(a,e,t,s){return iconRegistry.registerIcon(a,e,t,s)}function getIconRegistry(){return iconRegistry}function initialize(){const a=getCodiconFontCharacters();for(const e in a){const t="\\"+a[e].toString(16);iconRegistry.registerIcon(e,{fontCharacter:t})}}initialize();const iconsSchemaId="vscode://schemas/icons",schemaRegistry=Registry.as(Extensions$7.JSONContribution);schemaRegistry.registerSchema(iconsSchemaId,iconRegistry.getIconSchema());const delayer=new RunOnceScheduler(()=>schemaRegistry.notifySchemaChanged(iconsSchemaId),200);iconRegistry.onDidChange(()=>{delayer.isScheduled()||delayer.schedule()});const widgetClose=registerIcon("widget-close",Codicon.close,localize(2009,"Icon for the close action in widgets."));registerIcon("goto-previous-location",Codicon.arrowUp,localize(2010,"Icon for goto previous editor location."));registerIcon("goto-next-location",Codicon.arrowDown,localize(2011,"Icon for goto next editor location."));ThemeIcon.modify(Codicon.sync,"spin");ThemeIcon.modify(Codicon.loading,"spin");const accessibleDiffViewer="";var __decorate$2x=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2u=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const accessibleDiffViewerInsertIcon=registerIcon("diff-review-insert",Codicon.add,localize(94,"Icon for 'Insert' in accessible diff viewer.")),accessibleDiffViewerRemoveIcon=registerIcon("diff-review-remove",Codicon.remove,localize(95,"Icon for 'Remove' in accessible diff viewer.")),accessibleDiffViewerCloseIcon=registerIcon("diff-review-close",Codicon.close,localize(96,"Icon for 'Close' in accessible diff viewer."));var kn;let AccessibleDiffViewer=(kn=class extends Disposable{constructor(e,t,s,o,r,l,c,d,u){super(),this._parentNode=e,this._visible=t,this._setVisible=s,this._canClose=o,this._width=r,this._height=l,this._diffs=c,this._models=d,this._instantiationService=u,this._state=derived(this,g=>{const f=this._visible.read(g);if(this._parentNode.style.visibility=f?"visible":"hidden",!f)return null;const p=g.store.add(this._instantiationService.createInstance(ViewModel,this._diffs,this._models,this._setVisible,this._canClose)),m=g.store.add(this._instantiationService.createInstance(View,this._parentNode,p,this._width,this._height,this._models));return{model:p,view:m}}).recomputeInitiallyAndOnChange(this._store)}next(){transaction(e=>{const t=this._visible.get();this._setVisible(!0,e),t&&this._state.get().model.nextGroup(e)})}prev(){transaction(e=>{this._setVisible(!0,e),this._state.get().model.previousGroup(e)})}close(){transaction(e=>{this._setVisible(!1,e)})}},kn._ttPolicy=createTrustedTypesPolicy$1("diffReview",{createHTML:e=>e}),kn);AccessibleDiffViewer=__decorate$2x([__param$2u(8,IInstantiationService)],AccessibleDiffViewer);let ViewModel=class extends Disposable{constructor(e,t,s,o,r){super(),this._diffs=e,this._models=t,this._setVisible=s,this.canClose=o,this._accessibilitySignalService=r,this._groups=observableValue(this,[]),this._currentGroupIdx=observableValue(this,0),this._currentElementIdx=observableValue(this,0),this.groups=this._groups,this.currentGroup=this._currentGroupIdx.map((l,c)=>this._groups.read(c)[l]),this.currentGroupIndex=this._currentGroupIdx,this.currentElement=this._currentElementIdx.map((l,c)=>{var d;return(d=this.currentGroup.read(c))==null?void 0:d.lines[l]}),this._register(autorun(l=>{const c=this._diffs.read(l);if(!c){this._groups.set([],void 0);return}const d=computeViewElementGroups(c,this._models.getOriginalModel().getLineCount(),this._models.getModifiedModel().getLineCount());transaction(u=>{const g=this._models.getModifiedPosition();if(g){const f=d.findIndex(p=>(g==null?void 0:g.lineNumber)<p.range.modified.endLineNumberExclusive);f!==-1&&this._currentGroupIdx.set(f,u)}this._groups.set(d,u)})})),this._register(autorun(l=>{const c=this.currentElement.read(l);(c==null?void 0:c.type)===LineType.Deleted?this._accessibilitySignalService.playSignal(AccessibilitySignal.diffLineDeleted,{source:"accessibleDiffViewer.currentElementChanged"}):(c==null?void 0:c.type)===LineType.Added&&this._accessibilitySignalService.playSignal(AccessibilitySignal.diffLineInserted,{source:"accessibleDiffViewer.currentElementChanged"})})),this._register(autorun(l=>{const c=this.currentElement.read(l);if(c&&c.type!==LineType.Header){const d=c.modifiedLineNumber??c.diff.modified.startLineNumber;this._models.modifiedSetSelection(Range$2.fromPositions(new Position$1(d,1)))}}))}_goToGroupDelta(e,t){const s=this.groups.get();!s||s.length<=1||subtransaction(t,o=>{this._currentGroupIdx.set(OffsetRange.ofLength(s.length).clipCyclic(this._currentGroupIdx.get()+e),o),this._currentElementIdx.set(0,o)})}nextGroup(e){this._goToGroupDelta(1,e)}previousGroup(e){this._goToGroupDelta(-1,e)}_goToLineDelta(e){const t=this.currentGroup.get();!t||t.lines.length<=1||transaction(s=>{this._currentElementIdx.set(OffsetRange.ofLength(t.lines.length).clip(this._currentElementIdx.get()+e),s)})}goToNextLine(){this._goToLineDelta(1)}goToPreviousLine(){this._goToLineDelta(-1)}goToLine(e){const t=this.currentGroup.get();if(!t)return;const s=t.lines.indexOf(e);s!==-1&&transaction(o=>{this._currentElementIdx.set(s,o)})}revealCurrentElementInEditor(){if(!this.canClose.get())return;this._setVisible(!1,void 0);const e=this.currentElement.get();e&&(e.type===LineType.Deleted?this._models.originalReveal(Range$2.fromPositions(new Position$1(e.originalLineNumber,1))):this._models.modifiedReveal(e.type!==LineType.Header?Range$2.fromPositions(new Position$1(e.modifiedLineNumber,1)):void 0))}close(){this.canClose.get()&&(this._setVisible(!1,void 0),this._models.modifiedFocus())}};ViewModel=__decorate$2x([__param$2u(4,IAccessibilitySignalService)],ViewModel);const viewElementGroupLineMargin=3;function computeViewElementGroups(a,e,t){const s=[];for(const o of groupAdjacentBy(a,(r,l)=>l.modified.startLineNumber-r.modified.endLineNumberExclusive<2*viewElementGroupLineMargin)){const r=[];r.push(new HeaderViewElement);const l=new LineRange(Math.max(1,o[0].original.startLineNumber-viewElementGroupLineMargin),Math.min(o[o.length-1].original.endLineNumberExclusive+viewElementGroupLineMargin,e+1)),c=new LineRange(Math.max(1,o[0].modified.startLineNumber-viewElementGroupLineMargin),Math.min(o[o.length-1].modified.endLineNumberExclusive+viewElementGroupLineMargin,t+1));forEachAdjacent(o,(g,f)=>{const p=new LineRange(g?g.original.endLineNumberExclusive:l.startLineNumber,f?f.original.startLineNumber:l.endLineNumberExclusive),m=new LineRange(g?g.modified.endLineNumberExclusive:c.startLineNumber,f?f.modified.startLineNumber:c.endLineNumberExclusive);p.forEach(_=>{r.push(new UnchangedLineViewElement(_,m.startLineNumber+(_-p.startLineNumber)))}),f&&(f.original.forEach(_=>{r.push(new DeletedLineViewElement(f,_))}),f.modified.forEach(_=>{r.push(new AddedLineViewElement(f,_))}))});const d=o[0].modified.join(o[o.length-1].modified),u=o[0].original.join(o[o.length-1].original);s.push(new ViewElementGroup(new LineRangeMapping(d,u),r))}return s}var LineType;(function(a){a[a.Header=0]="Header",a[a.Unchanged=1]="Unchanged",a[a.Deleted=2]="Deleted",a[a.Added=3]="Added"})(LineType||(LineType={}));class ViewElementGroup{constructor(e,t){this.range=e,this.lines=t}}class HeaderViewElement{constructor(){this.type=LineType.Header}}class DeletedLineViewElement{constructor(e,t){this.diff=e,this.originalLineNumber=t,this.type=LineType.Deleted,this.modifiedLineNumber=void 0}}class AddedLineViewElement{constructor(e,t){this.diff=e,this.modifiedLineNumber=t,this.type=LineType.Added,this.originalLineNumber=void 0}}class UnchangedLineViewElement{constructor(e,t){this.originalLineNumber=e,this.modifiedLineNumber=t,this.type=LineType.Unchanged}}let View=class extends Disposable{constructor(e,t,s,o,r,l){super(),this._element=e,this._model=t,this._width=s,this._height=o,this._models=r,this._languageService=l,this.domNode=this._element,this.domNode.className="monaco-component diff-review monaco-editor-background";const c=document.createElement("div");c.className="diff-review-actions",this._actionBar=this._register(new ActionBar(c)),this._register(autorun(d=>{this._actionBar.clear(),this._model.canClose.read(d)&&this._actionBar.push(toAction({id:"diffreview.close",label:localize(97,"Close"),class:"close-diff-review "+ThemeIcon.asClassName(accessibleDiffViewerCloseIcon),enabled:!0,run:async()=>t.close()}),{label:!1,icon:!0})})),this._content=document.createElement("div"),this._content.className="diff-review-content",this._content.setAttribute("role","code"),this._scrollbar=this._register(new DomScrollableElement(this._content,{})),reset(this.domNode,this._scrollbar.getDomNode(),c),this._register(autorun(d=>{this._height.read(d),this._width.read(d),this._scrollbar.scanDomNode()})),this._register(toDisposable(()=>{reset(this.domNode)})),this._register(applyStyle(this.domNode,{width:this._width,height:this._height})),this._register(applyStyle(this._content,{width:this._width,height:this._height})),this._register(autorunWithStore((d,u)=>{this._model.currentGroup.read(d),this._render(u)})),this._register(addStandardDisposableListener(this.domNode,"keydown",d=>{(d.equals(18)||d.equals(2066)||d.equals(530))&&(d.preventDefault(),this._model.goToNextLine()),(d.equals(16)||d.equals(2064)||d.equals(528))&&(d.preventDefault(),this._model.goToPreviousLine()),(d.equals(9)||d.equals(2057)||d.equals(521)||d.equals(1033))&&(d.preventDefault(),this._model.close()),(d.equals(10)||d.equals(3))&&(d.preventDefault(),this._model.revealCurrentElementInEditor())}))}_render(e){const t=this._models.getOriginalOptions(),s=this._models.getModifiedOptions(),o=document.createElement("div");o.className="diff-review-table",o.setAttribute("role","list"),o.setAttribute("aria-label",localize(98,"Accessible Diff Viewer. Use arrow up and down to navigate.")),applyFontInfo(o,s.get(59)),reset(this._content,o);const r=this._models.getOriginalModel(),l=this._models.getModifiedModel();if(!r||!l)return;const c=r.getOptions(),d=l.getOptions(),u=s.get(75),g=this._model.currentGroup.get();for(const f of(g==null?void 0:g.lines)||[]){if(!g)break;let p;if(f.type===LineType.Header){const _=document.createElement("div");_.className="diff-review-row",_.setAttribute("role","listitem");const C=g.range,b=this._model.currentGroupIndex.get(),v=this._model.groups.get().length,S=x=>x===0?localize(99,"no lines changed"):x===1?localize(100,"1 line changed"):localize(101,"{0} lines changed",x),y=S(C.original.length),w=S(C.modified.length);_.setAttribute("aria-label",localize(102,"Difference {0} of {1}: original line {2}, {3}, modified line {4}, {5}",b+1,v,C.original.startLineNumber,y,C.modified.startLineNumber,w));const L=document.createElement("div");L.className="diff-review-cell diff-review-summary",L.appendChild(document.createTextNode(`${b+1}/${v}: @@ -${C.original.startLineNumber},${C.original.length} +${C.modified.startLineNumber},${C.modified.length} @@`)),_.appendChild(L),p=_}else p=this._createRow(f,u,this._width.get(),t,r,c,s,l,d);o.appendChild(p);const m=derived(_=>this._model.currentElement.read(_)===f);e.add(autorun(_=>{const C=m.read(_);p.tabIndex=C?0:-1,C&&p.focus()})),e.add(addDisposableListener(p,"focus",()=>{this._model.goToLine(f)}))}this._scrollbar.scanDomNode()}_createRow(e,t,s,o,r,l,c,d,u){const g=o.get(165),f=g.glyphMarginWidth+g.lineNumbersWidth,p=c.get(165),m=10+p.glyphMarginWidth+p.lineNumbersWidth;let _="diff-review-row",C="";const b="diff-review-spacer";let v=null;switch(e.type){case LineType.Added:_="diff-review-row line-insert",C=" char-insert",v=accessibleDiffViewerInsertIcon;break;case LineType.Deleted:_="diff-review-row line-delete",C=" char-delete",v=accessibleDiffViewerRemoveIcon;break}const S=document.createElement("div");S.style.minWidth=s+"px",S.className=_,S.setAttribute("role","listitem"),S.ariaLevel="";const y=document.createElement("div");y.className="diff-review-cell",y.style.height=`${t}px`,S.appendChild(y);const w=document.createElement("span");w.style.width=f+"px",w.style.minWidth=f+"px",w.className="diff-review-line-number"+C,e.originalLineNumber!==void 0?w.appendChild(document.createTextNode(String(e.originalLineNumber))):w.innerText=" ",y.appendChild(w);const L=document.createElement("span");L.style.width=m+"px",L.style.minWidth=m+"px",L.style.paddingRight="10px",L.className="diff-review-line-number"+C,e.modifiedLineNumber!==void 0?L.appendChild(document.createTextNode(String(e.modifiedLineNumber))):L.innerText=" ",y.appendChild(L);const x=document.createElement("span");if(x.className=b,v){const D=document.createElement("span");D.className=ThemeIcon.asClassName(v),D.innerText="  ",x.appendChild(D)}else x.innerText="  ";y.appendChild(x);let E;if(e.modifiedLineNumber!==void 0){let D=this._getLineHtml(d,c,u.tabSize,e.modifiedLineNumber,this._languageService.languageIdCodec);AccessibleDiffViewer._ttPolicy&&(D=AccessibleDiffViewer._ttPolicy.createHTML(D)),y.insertAdjacentHTML("beforeend",D),E=d.getLineContent(e.modifiedLineNumber)}else{let D=this._getLineHtml(r,o,l.tabSize,e.originalLineNumber,this._languageService.languageIdCodec);AccessibleDiffViewer._ttPolicy&&(D=AccessibleDiffViewer._ttPolicy.createHTML(D)),y.insertAdjacentHTML("beforeend",D),E=r.getLineContent(e.originalLineNumber)}E.length===0&&(E=localize(103,"blank"));let I="";switch(e.type){case LineType.Unchanged:e.originalLineNumber===e.modifiedLineNumber?I=localize(104,"{0} unchanged line {1}",E,e.originalLineNumber):I=localize(105,"{0} original line {1} modified line {2}",E,e.originalLineNumber,e.modifiedLineNumber);break;case LineType.Added:I=localize(106,"+ {0} modified line {1}",E,e.modifiedLineNumber);break;case LineType.Deleted:I=localize(107,"- {0} original line {1}",E,e.originalLineNumber);break}return S.setAttribute("aria-label",I),S}_getLineHtml(e,t,s,o,r){const l=e.getLineContent(o),c=t.get(59),d=t.get(117).verticalScrollbarSize,u=LineTokens.createEmpty(l,r),g=ViewLineRenderingData.isBasicASCII(l,e.mightContainNonBasicASCII()),f=ViewLineRenderingData.containsRTL(l,g,e.mightContainRTL());return renderViewLine2(new RenderLineInput(c.isMonospace&&!t.get(40),c.canUseHalfwidthRightwardsArrow,l,!1,g,f,0,u,[],s,0,c.spaceWidth,c.middotWidth,c.wsmiddotWidth,t.get(133),t.get(113),t.get(108),t.get(60)!==EditorFontLigatures.OFF,null,null,d)).html}};View=__decorate$2x([__param$2u(5,ILanguageService)],View);class AccessibleDiffViewerModelFromEditors{constructor(e){this.editors=e}getOriginalModel(){return this.editors.original.getModel()}getOriginalOptions(){return this.editors.original.getOptions()}originalReveal(e){this.editors.original.revealRange(e),this.editors.original.setSelection(e),this.editors.original.focus()}getModifiedModel(){return this.editors.modified.getModel()}getModifiedOptions(){return this.editors.modified.getOptions()}modifiedReveal(e){e&&(this.editors.modified.revealRange(e),this.editors.modified.setSelection(e)),this.editors.modified.focus()}modifiedSetSelection(e){this.editors.modified.setSelection(e)}modifiedFocus(){this.editors.modified.focus()}getModifiedPosition(){return this.editors.modified.getPosition()??void 0}}registerColor("diffEditor.move.border","#8b8b8b9c",localize(134,"The border color for text that got moved in the diff editor."));registerColor("diffEditor.moveActive.border","#FFA500",localize(135,"The active border color for text that got moved in the diff editor."));registerColor("diffEditor.unchangedRegionShadow",{dark:"#000000",light:"#737373BF",hcDark:"#000000",hcLight:"#737373BF"},localize(136,"The color of the shadow around unchanged region widgets."));const diffInsertIcon=registerIcon("diff-insert",Codicon.add,localize(137,"Line decoration for inserts in the diff editor.")),diffRemoveIcon=registerIcon("diff-remove",Codicon.remove,localize(138,"Line decoration for removals in the diff editor.")),diffLineAddDecorationBackgroundWithIndicator=ModelDecorationOptions.register({className:"line-insert",description:"line-insert",isWholeLine:!0,linesDecorationsClassName:"insert-sign "+ThemeIcon.asClassName(diffInsertIcon),marginClassName:"gutter-insert"}),diffLineDeleteDecorationBackgroundWithIndicator=ModelDecorationOptions.register({className:"line-delete",description:"line-delete",isWholeLine:!0,linesDecorationsClassName:"delete-sign "+ThemeIcon.asClassName(diffRemoveIcon),marginClassName:"gutter-delete"}),diffLineAddDecorationBackground=ModelDecorationOptions.register({className:"line-insert",description:"line-insert",isWholeLine:!0,marginClassName:"gutter-insert"}),diffLineDeleteDecorationBackground=ModelDecorationOptions.register({className:"line-delete",description:"line-delete",isWholeLine:!0,marginClassName:"gutter-delete"}),diffAddDecoration=ModelDecorationOptions.register({className:"char-insert",description:"char-insert",shouldFillLineOnLineBreak:!0}),diffWholeLineAddDecoration=ModelDecorationOptions.register({className:"char-insert",description:"char-insert",isWholeLine:!0}),diffAddDecorationEmpty=ModelDecorationOptions.register({className:"char-insert diff-range-empty",description:"char-insert diff-range-empty"}),diffDeleteDecoration=ModelDecorationOptions.register({className:"char-delete",description:"char-delete",shouldFillLineOnLineBreak:!0}),diffWholeLineDeleteDecoration=ModelDecorationOptions.register({className:"char-delete",description:"char-delete",isWholeLine:!0}),diffDeleteDecorationEmpty=ModelDecorationOptions.register({className:"char-delete diff-range-empty",description:"char-delete diff-range-empty"}),IEditorWorkerService=createDecorator("editorWorkerService");var __decorate$2w=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2t=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},WorkerBasedDocumentDiffProvider_1;const IDiffProviderFactoryService=createDecorator("diffProviderFactoryService");let WorkerBasedDiffProviderFactoryService=class{constructor(e){this.instantiationService=e}createDiffProvider(e){return this.instantiationService.createInstance(WorkerBasedDocumentDiffProvider,e)}};WorkerBasedDiffProviderFactoryService=__decorate$2w([__param$2t(0,IInstantiationService)],WorkerBasedDiffProviderFactoryService);registerSingleton(IDiffProviderFactoryService,WorkerBasedDiffProviderFactoryService,1);var pi;let WorkerBasedDocumentDiffProvider=(pi=class{constructor(e,t,s){this.editorWorkerService=t,this.telemetryService=s,this.onDidChangeEventEmitter=new Emitter$1,this.onDidChange=this.onDidChangeEventEmitter.event,this.diffAlgorithm="advanced",this.diffAlgorithmOnDidChangeSubscription=void 0,this.setOptions(e)}dispose(){var e;(e=this.diffAlgorithmOnDidChangeSubscription)==null||e.dispose()}async computeDiff(e,t,s,o){if(typeof this.diffAlgorithm!="string")return this.diffAlgorithm.computeDiff(e,t,s,o);if(e.isDisposed()||t.isDisposed())return{changes:[],identical:!0,quitEarly:!1,moves:[]};if(e.getLineCount()===1&&e.getLineMaxColumn(1)===1)return t.getLineCount()===1&&t.getLineMaxColumn(1)===1?{changes:[],identical:!0,quitEarly:!1,moves:[]}:{changes:[new DetailedLineRangeMapping(new LineRange(1,2),new LineRange(1,t.getLineCount()+1),[new RangeMapping(e.getFullModelRange(),t.getFullModelRange())])],identical:!1,quitEarly:!1,moves:[]};const r=JSON.stringify([e.uri.toString(),t.uri.toString()]),l=JSON.stringify([e.id,t.id,e.getAlternativeVersionId(),t.getAlternativeVersionId(),JSON.stringify(s)]),c=WorkerBasedDocumentDiffProvider_1.diffCache.get(r);if(c&&c.context===l)return c.result;const d=StopWatch.create(),u=await this.editorWorkerService.computeDiff(e.uri,t.uri,s,this.diffAlgorithm),g=d.elapsed();if(this.telemetryService.publicLog2("diffEditor.computeDiff",{timeMs:g,timedOut:(u==null?void 0:u.quitEarly)??!0,detectedMoves:s.computeMoves?(u==null?void 0:u.moves.length)??0:-1}),o.isCancellationRequested)return{changes:[],identical:!1,quitEarly:!0,moves:[]};if(!u)throw new Error("no diff result available");return WorkerBasedDocumentDiffProvider_1.diffCache.size>10&&WorkerBasedDocumentDiffProvider_1.diffCache.delete(WorkerBasedDocumentDiffProvider_1.diffCache.keys().next().value),WorkerBasedDocumentDiffProvider_1.diffCache.set(r,{result:u,context:l}),u}setOptions(e){var s;let t=!1;e.diffAlgorithm&&this.diffAlgorithm!==e.diffAlgorithm&&((s=this.diffAlgorithmOnDidChangeSubscription)==null||s.dispose(),this.diffAlgorithmOnDidChangeSubscription=void 0,this.diffAlgorithm=e.diffAlgorithm,typeof e.diffAlgorithm!="string"&&(this.diffAlgorithmOnDidChangeSubscription=e.diffAlgorithm.onDidChange(()=>this.onDidChangeEventEmitter.fire())),t=!0),t&&this.onDidChangeEventEmitter.fire()}},WorkerBasedDocumentDiffProvider_1=pi,pi.diffCache=new Map,pi);WorkerBasedDocumentDiffProvider=WorkerBasedDocumentDiffProvider_1=__decorate$2w([__param$2t(1,IEditorWorkerService),__param$2t(2,ITelemetryService)],WorkerBasedDocumentDiffProvider);class LinesDiff{constructor(e,t,s){this.changes=e,this.moves=t,this.hitTimeout=s}}class MovedText{constructor(e,t){this.lineRangeMapping=e,this.changes=t}}class DiffAlgorithmResult{static trivial(e,t){return new DiffAlgorithmResult([new SequenceDiff(OffsetRange.ofLength(e.length),OffsetRange.ofLength(t.length))],!1)}static trivialTimedOut(e,t){return new DiffAlgorithmResult([new SequenceDiff(OffsetRange.ofLength(e.length),OffsetRange.ofLength(t.length))],!0)}constructor(e,t){this.diffs=e,this.hitTimeout=t}}class SequenceDiff{static invert(e,t){const s=[];return forEachAdjacent(e,(o,r)=>{s.push(SequenceDiff.fromOffsetPairs(o?o.getEndExclusives():OffsetPair.zero,r?r.getStarts():new OffsetPair(t,(o?o.seq2Range.endExclusive-o.seq1Range.endExclusive:0)+t)))}),s}static fromOffsetPairs(e,t){return new SequenceDiff(new OffsetRange(e.offset1,t.offset1),new OffsetRange(e.offset2,t.offset2))}static assertSorted(e){let t;for(const s of e){if(t&&!(t.seq1Range.endExclusive<=s.seq1Range.start&&t.seq2Range.endExclusive<=s.seq2Range.start))throw new BugIndicatingError("Sequence diffs must be sorted");t=s}}constructor(e,t){this.seq1Range=e,this.seq2Range=t}swap(){return new SequenceDiff(this.seq2Range,this.seq1Range)}toString(){return`${this.seq1Range} <-> ${this.seq2Range}`}join(e){return new SequenceDiff(this.seq1Range.join(e.seq1Range),this.seq2Range.join(e.seq2Range))}delta(e){return e===0?this:new SequenceDiff(this.seq1Range.delta(e),this.seq2Range.delta(e))}deltaStart(e){return e===0?this:new SequenceDiff(this.seq1Range.deltaStart(e),this.seq2Range.deltaStart(e))}deltaEnd(e){return e===0?this:new SequenceDiff(this.seq1Range.deltaEnd(e),this.seq2Range.deltaEnd(e))}intersect(e){const t=this.seq1Range.intersect(e.seq1Range),s=this.seq2Range.intersect(e.seq2Range);if(!(!t||!s))return new SequenceDiff(t,s)}getStarts(){return new OffsetPair(this.seq1Range.start,this.seq2Range.start)}getEndExclusives(){return new OffsetPair(this.seq1Range.endExclusive,this.seq2Range.endExclusive)}}const yt=class yt{constructor(e,t){this.offset1=e,this.offset2=t}toString(){return`${this.offset1} <-> ${this.offset2}`}delta(e){return e===0?this:new yt(this.offset1+e,this.offset2+e)}equals(e){return this.offset1===e.offset1&&this.offset2===e.offset2}};yt.zero=new yt(0,0),yt.max=new yt(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER);let OffsetPair=yt;const Ss=class Ss{isValid(){return!0}};Ss.instance=new Ss;let InfiniteTimeout=Ss;class DateTimeout{constructor(e){if(this.timeout=e,this.startTime=Date.now(),this.valid=!0,e<=0)throw new BugIndicatingError("timeout must be positive")}isValid(){return!(Date.now()-this.startTime<this.timeout)&&this.valid&&(this.valid=!1),this.valid}}class Array2D{constructor(e,t){this.width=e,this.height=t,this.array=[],this.array=new Array(e*t)}get(e,t){return this.array[e+t*this.width]}set(e,t,s){this.array[e+t*this.width]=s}}function isSpace(a){return a===32||a===9}const pn=class pn{static getKey(e){let t=this.chrKeys.get(e);return t===void 0&&(t=this.chrKeys.size,this.chrKeys.set(e,t)),t}constructor(e,t,s){this.range=e,this.lines=t,this.source=s,this.histogram=[];let o=0;for(let r=e.startLineNumber-1;r<e.endLineNumberExclusive-1;r++){const l=t[r];for(let d=0;d<l.length;d++){o++;const u=l[d],g=pn.getKey(u);this.histogram[g]=(this.histogram[g]||0)+1}o++;const c=pn.getKey(`
`);this.histogram[c]=(this.histogram[c]||0)+1}this.totalCount=o}computeSimilarity(e){let t=0;const s=Math.max(this.histogram.length,e.histogram.length);for(let o=0;o<s;o++)t+=Math.abs((this.histogram[o]??0)-(e.histogram[o]??0));return 1-t/(this.totalCount+e.totalCount)}};pn.chrKeys=new Map;let LineRangeFragment=pn;class DynamicProgrammingDiffing{compute(e,t,s=InfiniteTimeout.instance,o){if(e.length===0||t.length===0)return DiffAlgorithmResult.trivial(e,t);const r=new Array2D(e.length,t.length),l=new Array2D(e.length,t.length),c=new Array2D(e.length,t.length);for(let _=0;_<e.length;_++)for(let C=0;C<t.length;C++){if(!s.isValid())return DiffAlgorithmResult.trivialTimedOut(e,t);const b=_===0?0:r.get(_-1,C),v=C===0?0:r.get(_,C-1);let S;e.getElement(_)===t.getElement(C)?(_===0||C===0?S=0:S=r.get(_-1,C-1),_>0&&C>0&&l.get(_-1,C-1)===3&&(S+=c.get(_-1,C-1)),S+=o?o(_,C):1):S=-1;const y=Math.max(b,v,S);if(y===S){const w=_>0&&C>0?c.get(_-1,C-1):0;c.set(_,C,w+1),l.set(_,C,3)}else y===b?(c.set(_,C,0),l.set(_,C,1)):y===v&&(c.set(_,C,0),l.set(_,C,2));r.set(_,C,y)}const d=[];let u=e.length,g=t.length;function f(_,C){(_+1!==u||C+1!==g)&&d.push(new SequenceDiff(new OffsetRange(_+1,u),new OffsetRange(C+1,g))),u=_,g=C}let p=e.length-1,m=t.length-1;for(;p>=0&&m>=0;)l.get(p,m)===3?(f(p,m),p--,m--):l.get(p,m)===1?p--:m--;return f(-1,-1),d.reverse(),new DiffAlgorithmResult(d,!1)}}class MyersDiffAlgorithm{compute(e,t,s=InfiniteTimeout.instance){if(e.length===0||t.length===0)return DiffAlgorithmResult.trivial(e,t);const o=e,r=t;function l(C,b){for(;C<o.length&&b<r.length&&o.getElement(C)===r.getElement(b);)C++,b++;return C}let c=0;const d=new FastInt32Array;d.set(0,l(0,0));const u=new FastArrayNegativeIndices;u.set(0,d.get(0)===0?null:new SnakePath(null,0,0,d.get(0)));let g=0;e:for(;;){if(c++,!s.isValid())return DiffAlgorithmResult.trivialTimedOut(o,r);const C=-Math.min(c,r.length+c%2),b=Math.min(c,o.length+c%2);for(g=C;g<=b;g+=2){const v=g===b?-1:d.get(g+1),S=g===C?-1:d.get(g-1)+1,y=Math.min(Math.max(v,S),o.length),w=y-g;if(y>o.length||w>r.length)continue;const L=l(y,w);d.set(g,L);const x=y===v?u.get(g+1):u.get(g-1);if(u.set(g,L!==y?new SnakePath(x,y,w,L-y):x),d.get(g)===o.length&&d.get(g)-g===r.length)break e}}let f=u.get(g);const p=[];let m=o.length,_=r.length;for(;;){const C=f?f.x+f.length:0,b=f?f.y+f.length:0;if((C!==m||b!==_)&&p.push(new SequenceDiff(new OffsetRange(C,m),new OffsetRange(b,_))),!f)break;m=f.x,_=f.y,f=f.prev}return p.reverse(),new DiffAlgorithmResult(p,!1)}}class SnakePath{constructor(e,t,s,o){this.prev=e,this.x=t,this.y=s,this.length=o}}class FastInt32Array{constructor(){this.positiveArr=new Int32Array(10),this.negativeArr=new Int32Array(10)}get(e){return e<0?(e=-e-1,this.negativeArr[e]):this.positiveArr[e]}set(e,t){if(e<0){if(e=-e-1,e>=this.negativeArr.length){const s=this.negativeArr;this.negativeArr=new Int32Array(s.length*2),this.negativeArr.set(s)}this.negativeArr[e]=t}else{if(e>=this.positiveArr.length){const s=this.positiveArr;this.positiveArr=new Int32Array(s.length*2),this.positiveArr.set(s)}this.positiveArr[e]=t}}}class FastArrayNegativeIndices{constructor(){this.positiveArr=[],this.negativeArr=[]}get(e){return e<0?(e=-e-1,this.negativeArr[e]):this.positiveArr[e]}set(e,t){e<0?(e=-e-1,this.negativeArr[e]=t):this.positiveArr[e]=t}}class LinesSliceCharSequence{constructor(e,t,s){this.lines=e,this.range=t,this.considerWhitespaceChanges=s,this.elements=[],this.firstElementOffsetByLineIdx=[],this.lineStartOffsets=[],this.trimmedWsLengthsByLineIdx=[],this.firstElementOffsetByLineIdx.push(0);for(let o=this.range.startLineNumber;o<=this.range.endLineNumber;o++){let r=e[o-1],l=0;o===this.range.startLineNumber&&this.range.startColumn>1&&(l=this.range.startColumn-1,r=r.substring(l)),this.lineStartOffsets.push(l);let c=0;if(!s){const u=r.trimStart();c=r.length-u.length,r=u.trimEnd()}this.trimmedWsLengthsByLineIdx.push(c);const d=o===this.range.endLineNumber?Math.min(this.range.endColumn-1-l-c,r.length):r.length;for(let u=0;u<d;u++)this.elements.push(r.charCodeAt(u));o<this.range.endLineNumber&&(this.elements.push(`
`.charCodeAt(0)),this.firstElementOffsetByLineIdx.push(this.elements.length))}}toString(){return`Slice: "${this.text}"`}get text(){return this.getText(new OffsetRange(0,this.length))}getText(e){return this.elements.slice(e.start,e.endExclusive).map(t=>String.fromCharCode(t)).join("")}getElement(e){return this.elements[e]}get length(){return this.elements.length}getBoundaryScore(e){const t=getCategory(e>0?this.elements[e-1]:-1),s=getCategory(e<this.elements.length?this.elements[e]:-1);if(t===7&&s===8)return 0;if(t===8)return 150;let o=0;return t!==s&&(o+=10,t===0&&s===1&&(o+=1)),o+=getCategoryBoundaryScore(t),o+=getCategoryBoundaryScore(s),o}translateOffset(e,t="right"){const s=findLastIdxMonotonous(this.firstElementOffsetByLineIdx,r=>r<=e),o=e-this.firstElementOffsetByLineIdx[s];return new Position$1(this.range.startLineNumber+s,1+this.lineStartOffsets[s]+o+(o===0&&t==="left"?0:this.trimmedWsLengthsByLineIdx[s]))}translateRange(e){const t=this.translateOffset(e.start,"right"),s=this.translateOffset(e.endExclusive,"left");return s.isBefore(t)?Range$2.fromPositions(s,s):Range$2.fromPositions(t,s)}findWordContaining(e){if(e<0||e>=this.elements.length||!isWordChar(this.elements[e]))return;let t=e;for(;t>0&&isWordChar(this.elements[t-1]);)t--;let s=e;for(;s<this.elements.length&&isWordChar(this.elements[s]);)s++;return new OffsetRange(t,s)}findSubWordContaining(e){if(e<0||e>=this.elements.length||!isWordChar(this.elements[e]))return;let t=e;for(;t>0&&isWordChar(this.elements[t-1])&&!isUpperCase(this.elements[t]);)t--;let s=e;for(;s<this.elements.length&&isWordChar(this.elements[s])&&!isUpperCase(this.elements[s]);)s++;return new OffsetRange(t,s)}countLinesIn(e){return this.translateOffset(e.endExclusive).lineNumber-this.translateOffset(e.start).lineNumber}isStronglyEqual(e,t){return this.elements[e]===this.elements[t]}extendToFullLines(e){const t=findLastMonotonous(this.firstElementOffsetByLineIdx,o=>o<=e.start)??0,s=findFirstMonotonous(this.firstElementOffsetByLineIdx,o=>e.endExclusive<=o)??this.elements.length;return new OffsetRange(t,s)}}function isWordChar(a){return a>=97&&a<=122||a>=65&&a<=90||a>=48&&a<=57}function isUpperCase(a){return a>=65&&a<=90}const score$1={0:0,1:0,2:0,3:10,4:2,5:30,6:3,7:10,8:10};function getCategoryBoundaryScore(a){return score$1[a]}function getCategory(a){return a===10?8:a===13?7:isSpace(a)?6:a>=97&&a<=122?0:a>=65&&a<=90?1:a>=48&&a<=57?2:a===-1?3:a===44||a===59?5:4}function computeMovedLines(a,e,t,s,o,r){let{moves:l,excludedChanges:c}=computeMovesFromSimpleDeletionsToSimpleInsertions(a,e,t,r);if(!r.isValid())return[];const d=a.filter(g=>!c.has(g)),u=computeUnchangedMoves(d,s,o,e,t,r);return pushMany(l,u),l=joinCloseConsecutiveMoves(l),l=l.filter(g=>{const f=g.original.toOffsetRange().slice(e).map(m=>m.trim());return f.join(`
`).length>=15&&countWhere(f,m=>m.length>=2)>=2}),l=removeMovesInSameDiff(a,l),l}function countWhere(a,e){let t=0;for(const s of a)e(s)&&t++;return t}function computeMovesFromSimpleDeletionsToSimpleInsertions(a,e,t,s){const o=[],r=a.filter(d=>d.modified.isEmpty&&d.original.length>=3).map(d=>new LineRangeFragment(d.original,e,d)),l=new Set(a.filter(d=>d.original.isEmpty&&d.modified.length>=3).map(d=>new LineRangeFragment(d.modified,t,d))),c=new Set;for(const d of r){let u=-1,g;for(const f of l){const p=d.computeSimilarity(f);p>u&&(u=p,g=f)}if(u>.9&&g&&(l.delete(g),o.push(new LineRangeMapping(d.range,g.range)),c.add(d.source),c.add(g.source)),!s.isValid())return{moves:o,excludedChanges:c}}return{moves:o,excludedChanges:c}}function computeUnchangedMoves(a,e,t,s,o,r){const l=[],c=new SetMap;for(const p of a)for(let m=p.original.startLineNumber;m<p.original.endLineNumberExclusive-2;m++){const _=`${e[m-1]}:${e[m+1-1]}:${e[m+2-1]}`;c.add(_,{range:new LineRange(m,m+3)})}const d=[];a.sort(compareBy(p=>p.modified.startLineNumber,numberComparator));for(const p of a){let m=[];for(let _=p.modified.startLineNumber;_<p.modified.endLineNumberExclusive-2;_++){const C=`${t[_-1]}:${t[_+1-1]}:${t[_+2-1]}`,b=new LineRange(_,_+3),v=[];c.forEach(C,({range:S})=>{for(const w of m)if(w.originalLineRange.endLineNumberExclusive+1===S.endLineNumberExclusive&&w.modifiedLineRange.endLineNumberExclusive+1===b.endLineNumberExclusive){w.originalLineRange=new LineRange(w.originalLineRange.startLineNumber,S.endLineNumberExclusive),w.modifiedLineRange=new LineRange(w.modifiedLineRange.startLineNumber,b.endLineNumberExclusive),v.push(w);return}const y={modifiedLineRange:b,originalLineRange:S};d.push(y),v.push(y)}),m=v}if(!r.isValid())return[]}d.sort(reverseOrder(compareBy(p=>p.modifiedLineRange.length,numberComparator)));const u=new LineRangeSet,g=new LineRangeSet;for(const p of d){const m=p.modifiedLineRange.startLineNumber-p.originalLineRange.startLineNumber,_=u.subtractFrom(p.modifiedLineRange),C=g.subtractFrom(p.originalLineRange).getWithDelta(m),b=_.getIntersection(C);for(const v of b.ranges){if(v.length<3)continue;const S=v,y=v.delta(-m);l.push(new LineRangeMapping(y,S)),u.addRange(S),g.addRange(y)}}l.sort(compareBy(p=>p.original.startLineNumber,numberComparator));const f=new MonotonousArray(a);for(let p=0;p<l.length;p++){const m=l[p],_=f.findLastMonotonous(x=>x.original.startLineNumber<=m.original.startLineNumber),C=findLastMonotonous(a,x=>x.modified.startLineNumber<=m.modified.startLineNumber),b=Math.max(m.original.startLineNumber-_.original.startLineNumber,m.modified.startLineNumber-C.modified.startLineNumber),v=f.findLastMonotonous(x=>x.original.startLineNumber<m.original.endLineNumberExclusive),S=findLastMonotonous(a,x=>x.modified.startLineNumber<m.modified.endLineNumberExclusive),y=Math.max(v.original.endLineNumberExclusive-m.original.endLineNumberExclusive,S.modified.endLineNumberExclusive-m.modified.endLineNumberExclusive);let w;for(w=0;w<b;w++){const x=m.original.startLineNumber-w-1,E=m.modified.startLineNumber-w-1;if(x>s.length||E>o.length||u.contains(E)||g.contains(x)||!areLinesSimilar(s[x-1],o[E-1],r))break}w>0&&(g.addRange(new LineRange(m.original.startLineNumber-w,m.original.startLineNumber)),u.addRange(new LineRange(m.modified.startLineNumber-w,m.modified.startLineNumber)));let L;for(L=0;L<y;L++){const x=m.original.endLineNumberExclusive+L,E=m.modified.endLineNumberExclusive+L;if(x>s.length||E>o.length||u.contains(E)||g.contains(x)||!areLinesSimilar(s[x-1],o[E-1],r))break}L>0&&(g.addRange(new LineRange(m.original.endLineNumberExclusive,m.original.endLineNumberExclusive+L)),u.addRange(new LineRange(m.modified.endLineNumberExclusive,m.modified.endLineNumberExclusive+L))),(w>0||L>0)&&(l[p]=new LineRangeMapping(new LineRange(m.original.startLineNumber-w,m.original.endLineNumberExclusive+L),new LineRange(m.modified.startLineNumber-w,m.modified.endLineNumberExclusive+L)))}return l}function areLinesSimilar(a,e,t){if(a.trim()===e.trim())return!0;if(a.length>300&&e.length>300)return!1;const o=new MyersDiffAlgorithm().compute(new LinesSliceCharSequence([a],new Range$2(1,1,1,a.length),!1),new LinesSliceCharSequence([e],new Range$2(1,1,1,e.length),!1),t);let r=0;const l=SequenceDiff.invert(o.diffs,a.length);for(const g of l)g.seq1Range.forEach(f=>{isSpace(a.charCodeAt(f))||r++});function c(g){let f=0;for(let p=0;p<a.length;p++)isSpace(g.charCodeAt(p))||f++;return f}const d=c(a.length>e.length?a:e);return r/d>.6&&d>10}function joinCloseConsecutiveMoves(a){if(a.length===0)return a;a.sort(compareBy(t=>t.original.startLineNumber,numberComparator));const e=[a[0]];for(let t=1;t<a.length;t++){const s=e[e.length-1],o=a[t],r=o.original.startLineNumber-s.original.endLineNumberExclusive,l=o.modified.startLineNumber-s.modified.endLineNumberExclusive;if(r>=0&&l>=0&&r+l<=2){e[e.length-1]=s.join(o);continue}e.push(o)}return e}function removeMovesInSameDiff(a,e){const t=new MonotonousArray(a);return e=e.filter(s=>{const o=t.findLastMonotonous(c=>c.original.startLineNumber<s.original.endLineNumberExclusive)||new LineRangeMapping(new LineRange(1,1),new LineRange(1,1)),r=findLastMonotonous(a,c=>c.modified.startLineNumber<s.modified.endLineNumberExclusive);return o!==r}),e}function optimizeSequenceDiffs(a,e,t){let s=t;return s=joinSequenceDiffsByShifting(a,e,s),s=joinSequenceDiffsByShifting(a,e,s),s=shiftSequenceDiffs(a,e,s),s}function joinSequenceDiffsByShifting(a,e,t){if(t.length===0)return t;const s=[];s.push(t[0]);for(let r=1;r<t.length;r++){const l=s[s.length-1];let c=t[r];if(c.seq1Range.isEmpty||c.seq2Range.isEmpty){const d=c.seq1Range.start-l.seq1Range.endExclusive;let u;for(u=1;u<=d&&!(a.getElement(c.seq1Range.start-u)!==a.getElement(c.seq1Range.endExclusive-u)||e.getElement(c.seq2Range.start-u)!==e.getElement(c.seq2Range.endExclusive-u));u++);if(u--,u===d){s[s.length-1]=new SequenceDiff(new OffsetRange(l.seq1Range.start,c.seq1Range.endExclusive-d),new OffsetRange(l.seq2Range.start,c.seq2Range.endExclusive-d));continue}c=c.delta(-u)}s.push(c)}const o=[];for(let r=0;r<s.length-1;r++){const l=s[r+1];let c=s[r];if(c.seq1Range.isEmpty||c.seq2Range.isEmpty){const d=l.seq1Range.start-c.seq1Range.endExclusive;let u;for(u=0;u<d&&!(!a.isStronglyEqual(c.seq1Range.start+u,c.seq1Range.endExclusive+u)||!e.isStronglyEqual(c.seq2Range.start+u,c.seq2Range.endExclusive+u));u++);if(u===d){s[r+1]=new SequenceDiff(new OffsetRange(c.seq1Range.start+d,l.seq1Range.endExclusive),new OffsetRange(c.seq2Range.start+d,l.seq2Range.endExclusive));continue}u>0&&(c=c.delta(u))}o.push(c)}return s.length>0&&o.push(s[s.length-1]),o}function shiftSequenceDiffs(a,e,t){if(!a.getBoundaryScore||!e.getBoundaryScore)return t;for(let s=0;s<t.length;s++){const o=s>0?t[s-1]:void 0,r=t[s],l=s+1<t.length?t[s+1]:void 0,c=new OffsetRange(o?o.seq1Range.endExclusive+1:0,l?l.seq1Range.start-1:a.length),d=new OffsetRange(o?o.seq2Range.endExclusive+1:0,l?l.seq2Range.start-1:e.length);r.seq1Range.isEmpty?t[s]=shiftDiffToBetterPosition(r,a,e,c,d):r.seq2Range.isEmpty&&(t[s]=shiftDiffToBetterPosition(r.swap(),e,a,d,c).swap())}return t}function shiftDiffToBetterPosition(a,e,t,s,o){let l=1;for(;a.seq1Range.start-l>=s.start&&a.seq2Range.start-l>=o.start&&t.isStronglyEqual(a.seq2Range.start-l,a.seq2Range.endExclusive-l)&&l<100;)l++;l--;let c=0;for(;a.seq1Range.start+c<s.endExclusive&&a.seq2Range.endExclusive+c<o.endExclusive&&t.isStronglyEqual(a.seq2Range.start+c,a.seq2Range.endExclusive+c)&&c<100;)c++;if(l===0&&c===0)return a;let d=0,u=-1;for(let g=-l;g<=c;g++){const f=a.seq2Range.start+g,p=a.seq2Range.endExclusive+g,m=a.seq1Range.start+g,_=e.getBoundaryScore(m)+t.getBoundaryScore(f)+t.getBoundaryScore(p);_>u&&(u=_,d=g)}return a.delta(d)}function removeShortMatches(a,e,t){const s=[];for(const o of t){const r=s[s.length-1];if(!r){s.push(o);continue}o.seq1Range.start-r.seq1Range.endExclusive<=2||o.seq2Range.start-r.seq2Range.endExclusive<=2?s[s.length-1]=new SequenceDiff(r.seq1Range.join(o.seq1Range),r.seq2Range.join(o.seq2Range)):s.push(o)}return s}function extendDiffsToEntireWordIfAppropriate(a,e,t,s,o=!1){const r=SequenceDiff.invert(t,a.length),l=[];let c=new OffsetPair(0,0);function d(g,f){if(g.offset1<c.offset1||g.offset2<c.offset2)return;const p=s(a,g.offset1),m=s(e,g.offset2);if(!p||!m)return;let _=new SequenceDiff(p,m);const C=_.intersect(f);let b=C.seq1Range.length,v=C.seq2Range.length;for(;r.length>0;){const S=r[0];if(!(S.seq1Range.intersects(_.seq1Range)||S.seq2Range.intersects(_.seq2Range)))break;const w=s(a,S.seq1Range.start),L=s(e,S.seq2Range.start),x=new SequenceDiff(w,L),E=x.intersect(S);if(b+=E.seq1Range.length,v+=E.seq2Range.length,_=_.join(x),_.seq1Range.endExclusive>=S.seq1Range.endExclusive)r.shift();else break}(o&&b+v<_.seq1Range.length+_.seq2Range.length||b+v<(_.seq1Range.length+_.seq2Range.length)*2/3)&&l.push(_),c=_.getEndExclusives()}for(;r.length>0;){const g=r.shift();g.seq1Range.isEmpty||(d(g.getStarts(),g),d(g.getEndExclusives().delta(-1),g))}return mergeSequenceDiffs(t,l)}function mergeSequenceDiffs(a,e){const t=[];for(;a.length>0||e.length>0;){const s=a[0],o=e[0];let r;s&&(!o||s.seq1Range.start<o.seq1Range.start)?r=a.shift():r=e.shift(),t.length>0&&t[t.length-1].seq1Range.endExclusive>=r.seq1Range.start?t[t.length-1]=t[t.length-1].join(r):t.push(r)}return t}function removeVeryShortMatchingLinesBetweenDiffs(a,e,t){let s=t;if(s.length===0)return s;let o=0,r;do{r=!1;const l=[s[0]];for(let c=1;c<s.length;c++){let g=function(p,m){const _=new OffsetRange(u.seq1Range.endExclusive,d.seq1Range.start);return a.getText(_).replace(/\s/g,"").length<=4&&(p.seq1Range.length+p.seq2Range.length>5||m.seq1Range.length+m.seq2Range.length>5)};const d=s[c],u=l[l.length-1];g(u,d)?(r=!0,l[l.length-1]=l[l.length-1].join(d)):l.push(d)}s=l}while(o++<10&&r);return s}function removeVeryShortMatchingTextBetweenLongDiffs(a,e,t){let s=t;if(s.length===0)return s;let o=0,r;do{r=!1;const c=[s[0]];for(let d=1;d<s.length;d++){let f=function(m,_){const C=new OffsetRange(g.seq1Range.endExclusive,u.seq1Range.start);if(a.countLinesIn(C)>5||C.length>500)return!1;const v=a.getText(C).trim();if(v.length>20||v.split(/\r\n|\r|\n/).length>1)return!1;const S=a.countLinesIn(m.seq1Range),y=m.seq1Range.length,w=e.countLinesIn(m.seq2Range),L=m.seq2Range.length,x=a.countLinesIn(_.seq1Range),E=_.seq1Range.length,I=e.countLinesIn(_.seq2Range),D=_.seq2Range.length,k=2*40+50;function N(R){return Math.min(R,k)}return Math.pow(Math.pow(N(S*40+y),1.5)+Math.pow(N(w*40+L),1.5),1.5)+Math.pow(Math.pow(N(x*40+E),1.5)+Math.pow(N(I*40+D),1.5),1.5)>(k**1.5)**1.5*1.3};const u=s[d],g=c[c.length-1];f(g,u)?(r=!0,c[c.length-1]=c[c.length-1].join(u)):c.push(u)}s=c}while(o++<10&&r);const l=[];return forEachWithNeighbors(s,(c,d,u)=>{let g=d;function f(v){return v.length>0&&v.trim().length<=3&&d.seq1Range.length+d.seq2Range.length>100}const p=a.extendToFullLines(d.seq1Range),m=a.getText(new OffsetRange(p.start,d.seq1Range.start));f(m)&&(g=g.deltaStart(-m.length));const _=a.getText(new OffsetRange(d.seq1Range.endExclusive,p.endExclusive));f(_)&&(g=g.deltaEnd(_.length));const C=SequenceDiff.fromOffsetPairs(c?c.getEndExclusives():OffsetPair.zero,u?u.getStarts():OffsetPair.max),b=g.intersect(C);l.length>0&&b.getStarts().equals(l[l.length-1].getEndExclusives())?l[l.length-1]=l[l.length-1].join(b):l.push(b)}),l}let LineSequence$1=class{constructor(e,t){this.trimmedHash=e,this.lines=t}getElement(e){return this.trimmedHash[e]}get length(){return this.trimmedHash.length}getBoundaryScore(e){const t=e===0?0:getIndentation(this.lines[e-1]),s=e===this.lines.length?0:getIndentation(this.lines[e]);return 1e3-(t+s)}getText(e){return this.lines.slice(e.start,e.endExclusive).join(`
`)}isStronglyEqual(e,t){return this.lines[e]===this.lines[t]}};function getIndentation(a){let e=0;for(;e<a.length&&(a.charCodeAt(e)===32||a.charCodeAt(e)===9);)e++;return e}class DefaultLinesDiffComputer{constructor(){this.dynamicProgrammingDiffing=new DynamicProgrammingDiffing,this.myersDiffingAlgorithm=new MyersDiffAlgorithm}computeDiff(e,t,s){if(e.length<=1&&equals$1(e,t,(E,I)=>E===I))return new LinesDiff([],[],!1);if(e.length===1&&e[0].length===0||t.length===1&&t[0].length===0)return new LinesDiff([new DetailedLineRangeMapping(new LineRange(1,e.length+1),new LineRange(1,t.length+1),[new RangeMapping(new Range$2(1,1,e.length,e[e.length-1].length+1),new Range$2(1,1,t.length,t[t.length-1].length+1))])],[],!1);const o=s.maxComputationTimeMs===0?InfiniteTimeout.instance:new DateTimeout(s.maxComputationTimeMs),r=!s.ignoreTrimWhitespace,l=new Map;function c(E){let I=l.get(E);return I===void 0&&(I=l.size,l.set(E,I)),I}const d=e.map(E=>c(E.trim())),u=t.map(E=>c(E.trim())),g=new LineSequence$1(d,e),f=new LineSequence$1(u,t),p=(()=>g.length+f.length<1700?this.dynamicProgrammingDiffing.compute(g,f,o,(E,I)=>e[E]===t[I]?t[I].length===0?.1:1+Math.log(1+t[I].length):.99):this.myersDiffingAlgorithm.compute(g,f,o))();let m=p.diffs,_=p.hitTimeout;m=optimizeSequenceDiffs(g,f,m),m=removeVeryShortMatchingLinesBetweenDiffs(g,f,m);const C=[],b=E=>{if(r)for(let I=0;I<E;I++){const D=v+I,k=S+I;if(e[D]!==t[k]){const N=this.refineDiff(e,t,new SequenceDiff(new OffsetRange(D,D+1),new OffsetRange(k,k+1)),o,r,s);for(const R of N.mappings)C.push(R);N.hitTimeout&&(_=!0)}}};let v=0,S=0;for(const E of m){assertFn(()=>E.seq1Range.start-v===E.seq2Range.start-S);const I=E.seq1Range.start-v;b(I),v=E.seq1Range.endExclusive,S=E.seq2Range.endExclusive;const D=this.refineDiff(e,t,E,o,r,s);D.hitTimeout&&(_=!0);for(const k of D.mappings)C.push(k)}b(e.length-v);const y=new ArrayText(e),w=new ArrayText(t),L=lineRangeMappingFromRangeMappings(C,y,w);let x=[];return s.computeMoves&&(x=this.computeMoves(L,e,t,d,u,o,r,s)),assertFn(()=>{function E(D,k){if(D.lineNumber<1||D.lineNumber>k.length)return!1;const N=k[D.lineNumber-1];return!(D.column<1||D.column>N.length+1)}function I(D,k){return!(D.startLineNumber<1||D.startLineNumber>k.length+1||D.endLineNumberExclusive<1||D.endLineNumberExclusive>k.length+1)}for(const D of L){if(!D.innerChanges)return!1;for(const k of D.innerChanges)if(!(E(k.modifiedRange.getStartPosition(),t)&&E(k.modifiedRange.getEndPosition(),t)&&E(k.originalRange.getStartPosition(),e)&&E(k.originalRange.getEndPosition(),e)))return!1;if(!I(D.modified,t)||!I(D.original,e))return!1}return!0}),new LinesDiff(L,x,_)}computeMoves(e,t,s,o,r,l,c,d){return computeMovedLines(e,t,s,o,r,l).map(f=>{const p=this.refineDiff(t,s,new SequenceDiff(f.original.toOffsetRange(),f.modified.toOffsetRange()),l,c,d),m=lineRangeMappingFromRangeMappings(p.mappings,new ArrayText(t),new ArrayText(s),!0);return new MovedText(f,m)})}refineDiff(e,t,s,o,r,l){const d=toLineRangeMapping(s).toRangeMapping2(e,t),u=new LinesSliceCharSequence(e,d.originalRange,r),g=new LinesSliceCharSequence(t,d.modifiedRange,r),f=u.length+g.length<500?this.dynamicProgrammingDiffing.compute(u,g,o):this.myersDiffingAlgorithm.compute(u,g,o);let p=f.diffs;return p=optimizeSequenceDiffs(u,g,p),p=extendDiffsToEntireWordIfAppropriate(u,g,p,(_,C)=>_.findWordContaining(C)),l.extendToSubwords&&(p=extendDiffsToEntireWordIfAppropriate(u,g,p,(_,C)=>_.findSubWordContaining(C),!0)),p=removeShortMatches(u,g,p),p=removeVeryShortMatchingTextBetweenLongDiffs(u,g,p),{mappings:p.map(_=>new RangeMapping(u.translateRange(_.seq1Range),g.translateRange(_.seq2Range))),hitTimeout:f.hitTimeout}}}function toLineRangeMapping(a){return new LineRangeMapping(new LineRange(a.seq1Range.start+1,a.seq1Range.endExclusive+1),new LineRange(a.seq2Range.start+1,a.seq2Range.endExclusive+1))}var __decorate$2v=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2s=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let DiffEditorViewModel=class extends Disposable{setActiveMovedText(e){this._activeMovedText.set(e,void 0)}constructor(e,t,s){super(),this.model=e,this._options=t,this._diffProviderFactoryService=s,this._isDiffUpToDate=observableValue(this,!1),this.isDiffUpToDate=this._isDiffUpToDate,this._diff=observableValue(this,void 0),this.diff=this._diff,this._unchangedRegions=observableValue(this,void 0),this.unchangedRegions=derived(this,c=>{var d;return this._options.hideUnchangedRegions.read(c)?((d=this._unchangedRegions.read(c))==null?void 0:d.regions)??[]:(transaction(u=>{var g;for(const f of((g=this._unchangedRegions.read(void 0))==null?void 0:g.regions)||[])f.collapseAll(u)}),[])}),this.movedTextToCompare=observableValue(this,void 0),this._activeMovedText=observableValue(this,void 0),this._hoveredMovedText=observableValue(this,void 0),this.activeMovedText=derived(this,c=>this.movedTextToCompare.read(c)??this._hoveredMovedText.read(c)??this._activeMovedText.read(c)),this._cancellationTokenSource=new CancellationTokenSource$1,this._diffProvider=derived(this,c=>{const d=this._diffProviderFactoryService.createDiffProvider({diffAlgorithm:this._options.diffAlgorithm.read(c)}),u=observableSignalFromEvent("onDidChange",d.onDidChange);return{diffProvider:d,onChangeSignal:u}}),this._register(toDisposable(()=>this._cancellationTokenSource.cancel()));const o=observableSignal("contentChangedSignal"),r=this._register(new RunOnceScheduler(()=>o.trigger(void 0),200));this._register(autorun(c=>{const d=this._unchangedRegions.read(c);if(!d||d.regions.some(_=>_.isDragged.read(c)))return;const u=d.originalDecorationIds.map(_=>e.original.getDecorationRange(_)).map(_=>_?LineRange.fromRangeInclusive(_):void 0),g=d.modifiedDecorationIds.map(_=>e.modified.getDecorationRange(_)).map(_=>_?LineRange.fromRangeInclusive(_):void 0),f=d.regions.map((_,C)=>!u[C]||!g[C]?void 0:new UnchangedRegion(u[C].startLineNumber,g[C].startLineNumber,u[C].length,_.visibleLineCountTop.read(c),_.visibleLineCountBottom.read(c))).filter(isDefined),p=[];let m=!1;for(const _ of groupAdjacentBy(f,(C,b)=>C.getHiddenModifiedRange(c).endLineNumberExclusive===b.getHiddenModifiedRange(c).startLineNumber))if(_.length>1){m=!0;const C=_.reduce((v,S)=>v+S.lineCount,0),b=new UnchangedRegion(_[0].originalLineNumber,_[0].modifiedLineNumber,C,_[0].visibleLineCountTop.read(void 0),_[_.length-1].visibleLineCountBottom.read(void 0));p.push(b)}else p.push(_[0]);if(m){const _=e.original.deltaDecorations(d.originalDecorationIds,p.map(b=>({range:b.originalUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}}))),C=e.modified.deltaDecorations(d.modifiedDecorationIds,p.map(b=>({range:b.modifiedUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}})));transaction(b=>{this._unchangedRegions.set({regions:p,originalDecorationIds:_,modifiedDecorationIds:C},b)})}}));const l=(c,d,u)=>{const g=UnchangedRegion.fromDiffs(c.changes,e.original.getLineCount(),e.modified.getLineCount(),this._options.hideUnchangedRegionsMinimumLineCount.read(u),this._options.hideUnchangedRegionsContextLineCount.read(u));let f;const p=this._unchangedRegions.get();if(p){const b=p.originalDecorationIds.map(w=>e.original.getDecorationRange(w)).map(w=>w?LineRange.fromRangeInclusive(w):void 0),v=p.modifiedDecorationIds.map(w=>e.modified.getDecorationRange(w)).map(w=>w?LineRange.fromRangeInclusive(w):void 0);let y=filterWithPrevious(p.regions.map((w,L)=>{if(!b[L]||!v[L])return;const x=b[L].length;return new UnchangedRegion(b[L].startLineNumber,v[L].startLineNumber,x,Math.min(w.visibleLineCountTop.get(),x),Math.min(w.visibleLineCountBottom.get(),x-w.visibleLineCountTop.get()))}).filter(isDefined),(w,L)=>!L||w.modifiedLineNumber>=L.modifiedLineNumber+L.lineCount&&w.originalLineNumber>=L.originalLineNumber+L.lineCount).map(w=>new LineRangeMapping(w.getHiddenOriginalRange(u),w.getHiddenModifiedRange(u)));y=LineRangeMapping.clip(y,LineRange.ofLength(1,e.original.getLineCount()),LineRange.ofLength(1,e.modified.getLineCount())),f=LineRangeMapping.inverse(y,e.original.getLineCount(),e.modified.getLineCount())}const m=[];if(f)for(const b of g){const v=f.filter(S=>S.original.intersectsStrict(b.originalUnchangedRange)&&S.modified.intersectsStrict(b.modifiedUnchangedRange));m.push(...b.setVisibleRanges(v,d))}else m.push(...g);const _=e.original.deltaDecorations((p==null?void 0:p.originalDecorationIds)||[],m.map(b=>({range:b.originalUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}}))),C=e.modified.deltaDecorations((p==null?void 0:p.modifiedDecorationIds)||[],m.map(b=>({range:b.modifiedUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}})));this._unchangedRegions.set({regions:m,originalDecorationIds:_,modifiedDecorationIds:C},d)};this._register(e.modified.onDidChangeContent(c=>{if(this._diff.get()){const u=TextEditInfo.fromModelContentChanges(c.changes);this._lastDiff,e.original,e.modified}this._isDiffUpToDate.set(!1,void 0),r.schedule()})),this._register(e.original.onDidChangeContent(c=>{if(this._diff.get()){const u=TextEditInfo.fromModelContentChanges(c.changes);this._lastDiff,e.original,e.modified}this._isDiffUpToDate.set(!1,void 0),r.schedule()})),this._register(autorunWithStore(async(c,d)=>{this._options.hideUnchangedRegionsMinimumLineCount.read(c),this._options.hideUnchangedRegionsContextLineCount.read(c),r.cancel(),o.read(c);const u=this._diffProvider.read(c);u.onChangeSignal.read(c),this._isDiffUpToDate.set(!1,void 0);let g=[];d.add(e.original.onDidChangeContent(m=>{const _=TextEditInfo.fromModelContentChanges(m.changes);g=combineTextEditInfos(g,_)}));let f=[];d.add(e.modified.onDidChangeContent(m=>{const _=TextEditInfo.fromModelContentChanges(m.changes);f=combineTextEditInfos(f,_)}));let p=await u.diffProvider.computeDiff(e.original,e.modified,{ignoreTrimWhitespace:this._options.ignoreTrimWhitespace.read(c),maxComputationTimeMs:this._options.maxComputationTimeMs.read(c),computeMoves:this._options.showMoves.read(c)},this._cancellationTokenSource.token);this._cancellationTokenSource.token.isCancellationRequested||e.original.isDisposed()||e.modified.isDisposed()||(p=normalizeDocumentDiff(p,e.original,e.modified),p=(e.original,e.modified,void 0)??p,p=(e.original,e.modified,void 0)??p,transaction(m=>{l(p,m),this._lastDiff=p;const _=DiffState.fromDiffResult(p);this._diff.set(_,m),this._isDiffUpToDate.set(!0,m);const C=this.movedTextToCompare.read(void 0);this.movedTextToCompare.set(C?this._lastDiff.moves.find(b=>b.lineRangeMapping.modified.intersect(C.lineRangeMapping.modified)):void 0,m)}))}))}ensureModifiedLineIsVisible(e,t,s){var r,l;if(((r=this.diff.get())==null?void 0:r.mappings.length)===0)return;const o=((l=this._unchangedRegions.get())==null?void 0:l.regions)||[];for(const c of o)if(c.getHiddenModifiedRange(void 0).contains(e)){c.showModifiedLine(e,t,s);return}}ensureOriginalLineIsVisible(e,t,s){var r,l;if(((r=this.diff.get())==null?void 0:r.mappings.length)===0)return;const o=((l=this._unchangedRegions.get())==null?void 0:l.regions)||[];for(const c of o)if(c.getHiddenOriginalRange(void 0).contains(e)){c.showOriginalLine(e,t,s);return}}async waitForDiff(){await waitForState(this.isDiffUpToDate,e=>e)}serializeState(){const e=this._unchangedRegions.get();return{collapsedRegions:e==null?void 0:e.regions.map(t=>({range:t.getHiddenModifiedRange(void 0).serialize()}))}}restoreSerializedState(e){var o;const t=(o=e.collapsedRegions)==null?void 0:o.map(r=>LineRange.deserialize(r.range)),s=this._unchangedRegions.get();!s||!t||transaction(r=>{for(const l of s.regions)for(const c of t)if(l.modifiedUnchangedRange.intersect(c)){l.setHiddenModifiedRange(c,r);break}})}};DiffEditorViewModel=__decorate$2v([__param$2s(2,IDiffProviderFactoryService)],DiffEditorViewModel);function normalizeDocumentDiff(a,e,t){return{changes:a.changes.map(s=>new DetailedLineRangeMapping(s.original,s.modified,s.innerChanges?s.innerChanges.map(o=>normalizeRangeMapping(o,e,t)):void 0)),moves:a.moves,identical:a.identical,quitEarly:a.quitEarly}}function normalizeRangeMapping(a,e,t){let s=a.originalRange,o=a.modifiedRange;return s.startColumn===1&&o.startColumn===1&&(s.endColumn!==1||o.endColumn!==1)&&s.endColumn===e.getLineMaxColumn(s.endLineNumber)&&o.endColumn===t.getLineMaxColumn(o.endLineNumber)&&s.endLineNumber<e.getLineCount()&&o.endLineNumber<t.getLineCount()&&(s=s.setEndPosition(s.endLineNumber+1,1),o=o.setEndPosition(o.endLineNumber+1,1)),new RangeMapping(s,o)}class DiffState{static fromDiffResult(e){return new DiffState(e.changes.map(t=>new DiffMapping(t)),e.moves||[],e.identical,e.quitEarly)}constructor(e,t,s,o){this.mappings=e,this.movedTexts=t,this.identical=s,this.quitEarly=o}}class DiffMapping{constructor(e){this.lineRangeMapping=e}}class UnchangedRegion{static fromDiffs(e,t,s,o,r){const l=DetailedLineRangeMapping.inverse(e,t,s),c=[];for(const d of l){let u=d.original.startLineNumber,g=d.modified.startLineNumber,f=d.original.length;const p=u===1&&g===1,m=u+f===t+1&&g+f===s+1;(p||m)&&f>=r+o?(p&&!m&&(f-=r),m&&!p&&(u+=r,g+=r,f-=r),c.push(new UnchangedRegion(u,g,f,0,0))):f>=r*2+o&&(u+=r,g+=r,f-=r*2,c.push(new UnchangedRegion(u,g,f,0,0)))}return c}get originalUnchangedRange(){return LineRange.ofLength(this.originalLineNumber,this.lineCount)}get modifiedUnchangedRange(){return LineRange.ofLength(this.modifiedLineNumber,this.lineCount)}constructor(e,t,s,o,r){this.originalLineNumber=e,this.modifiedLineNumber=t,this.lineCount=s,this._visibleLineCountTop=observableValue(this,0),this.visibleLineCountTop=this._visibleLineCountTop,this._visibleLineCountBottom=observableValue(this,0),this.visibleLineCountBottom=this._visibleLineCountBottom,this._shouldHideControls=derived(this,d=>this.visibleLineCountTop.read(d)+this.visibleLineCountBottom.read(d)===this.lineCount&&!this.isDragged.read(d)),this.isDragged=observableValue(this,void 0);const l=Math.max(Math.min(o,this.lineCount),0),c=Math.max(Math.min(r,this.lineCount-o),0);softAssert(o===l),softAssert(r===c),this._visibleLineCountTop.set(l,void 0),this._visibleLineCountBottom.set(c,void 0)}setVisibleRanges(e,t){const s=[],o=new LineRangeSet(e.map(d=>d.modified)).subtractFrom(this.modifiedUnchangedRange);let r=this.originalLineNumber,l=this.modifiedLineNumber;const c=this.modifiedLineNumber+this.lineCount;if(o.ranges.length===0)this.showAll(t),s.push(this);else{let d=0;for(const u of o.ranges){const g=d===o.ranges.length-1;d++;const f=(g?c:u.endLineNumberExclusive)-l,p=new UnchangedRegion(r,l,f,0,0);p.setHiddenModifiedRange(u,t),s.push(p),r=p.originalUnchangedRange.endLineNumberExclusive,l=p.modifiedUnchangedRange.endLineNumberExclusive}}return s}shouldHideControls(e){return this._shouldHideControls.read(e)}getHiddenOriginalRange(e){return LineRange.ofLength(this.originalLineNumber+this._visibleLineCountTop.read(e),this.lineCount-this._visibleLineCountTop.read(e)-this._visibleLineCountBottom.read(e))}getHiddenModifiedRange(e){return LineRange.ofLength(this.modifiedLineNumber+this._visibleLineCountTop.read(e),this.lineCount-this._visibleLineCountTop.read(e)-this._visibleLineCountBottom.read(e))}setHiddenModifiedRange(e,t){const s=e.startLineNumber-this.modifiedLineNumber,o=this.modifiedLineNumber+this.lineCount-e.endLineNumberExclusive;this.setState(s,o,t)}getMaxVisibleLineCountTop(){return this.lineCount-this._visibleLineCountBottom.get()}getMaxVisibleLineCountBottom(){return this.lineCount-this._visibleLineCountTop.get()}showMoreAbove(e=10,t){const s=this.getMaxVisibleLineCountTop();this._visibleLineCountTop.set(Math.min(this._visibleLineCountTop.get()+e,s),t)}showMoreBelow(e=10,t){const s=this.lineCount-this._visibleLineCountTop.get();this._visibleLineCountBottom.set(Math.min(this._visibleLineCountBottom.get()+e,s),t)}showAll(e){this._visibleLineCountBottom.set(this.lineCount-this._visibleLineCountTop.get(),e)}showModifiedLine(e,t,s){const o=e+1-(this.modifiedLineNumber+this._visibleLineCountTop.get()),r=this.modifiedLineNumber-this._visibleLineCountBottom.get()+this.lineCount-e;t===0&&o<r||t===1?this._visibleLineCountTop.set(this._visibleLineCountTop.get()+o,s):this._visibleLineCountBottom.set(this._visibleLineCountBottom.get()+r,s)}showOriginalLine(e,t,s){const o=e-this.originalLineNumber,r=this.originalLineNumber+this.lineCount-e;t===0&&o<r||t===1?this._visibleLineCountTop.set(Math.min(this._visibleLineCountTop.get()+r-o,this.getMaxVisibleLineCountTop()),s):this._visibleLineCountBottom.set(Math.min(this._visibleLineCountBottom.get()+o-r,this.getMaxVisibleLineCountBottom()),s)}collapseAll(e){this._visibleLineCountTop.set(0,e),this._visibleLineCountBottom.set(0,e)}setState(e,t,s){e=Math.max(Math.min(e,this.lineCount),0),t=Math.max(Math.min(t,this.lineCount-e),0),this._visibleLineCountTop.set(e,s),this._visibleLineCountBottom.set(t,s)}}function applyOriginalEdits(a,e,t,s){}function applyModifiedEdits(a,e,t,s){}class InlineDiffDeletedCodeMargin extends Disposable{get visibility(){return this._visibility}set visibility(e){this._visibility!==e&&(this._visibility=e,this._diffActions.style.visibility=e?"visible":"hidden")}constructor(e,t,s,o,r,l,c,d,u){super(),this._getViewZoneId=e,this._marginDomNode=t,this._modifiedEditor=s,this._diff=o,this._editor=r,this._viewLineCounts=l,this._originalTextModel=c,this._contextMenuService=d,this._clipboardService=u,this._visibility=!1,this._marginDomNode.style.zIndex="10",this._diffActions=document.createElement("div"),this._diffActions.className=ThemeIcon.asClassName(Codicon.lightBulb)+" lightbulb-glyph",this._diffActions.style.position="absolute";const g=this._modifiedEditor.getOption(75);this._diffActions.style.right="0px",this._diffActions.style.visibility="hidden",this._diffActions.style.height=`${g}px`,this._diffActions.style.lineHeight=`${g}px`,this._marginDomNode.appendChild(this._diffActions);let f=0;const p=s.getOption(144)&&!isIOS,m=(_,C)=>{this._contextMenuService.showContextMenu({domForShadowRoot:p?s.getDomNode()??void 0:void 0,getAnchor:()=>({x:_,y:C}),getActions:()=>{const b=[],v=o.modified.isEmpty;return b.push(new Action("diff.clipboard.copyDeletedContent",v?o.original.length>1?localize(109,"Copy deleted lines"):localize(110,"Copy deleted line"):o.original.length>1?localize(111,"Copy changed lines"):localize(112,"Copy changed line"),void 0,!0,async()=>{const y=this._originalTextModel.getValueInRange(o.original.toExclusiveRange());await this._clipboardService.writeText(y)})),o.original.length>1&&b.push(new Action("diff.clipboard.copyDeletedLineContent",v?localize(113,"Copy deleted line ({0})",o.original.startLineNumber+f):localize(114,"Copy changed line ({0})",o.original.startLineNumber+f),void 0,!0,async()=>{let y=this._originalTextModel.getLineContent(o.original.startLineNumber+f);y===""&&(y=this._originalTextModel.getEndOfLineSequence()===0?`
`:`\r
`),await this._clipboardService.writeText(y)})),s.getOption(104)||b.push(new Action("diff.inline.revertChange",localize(115,"Revert this change"),void 0,!0,async()=>{this._editor.revert(this._diff)})),b},autoSelectFirstItem:!0})};this._register(addStandardDisposableListener(this._diffActions,"mousedown",_=>{if(!_.leftButton)return;const{top:C,height:b}=getDomNodePagePosition(this._diffActions),v=Math.floor(g/3);_.preventDefault(),m(_.posx,C+b+v)})),this._register(s.onMouseMove(_=>{(_.target.type===8||_.target.type===5)&&_.target.detail.viewZoneId===this._getViewZoneId()?(f=this._updateLightBulbPosition(this._marginDomNode,_.event.browserEvent.y,g),this.visibility=!0):this.visibility=!1})),this._register(s.onMouseDown(_=>{_.event.leftButton&&(_.target.type===8||_.target.type===5)&&_.target.detail.viewZoneId===this._getViewZoneId()&&(_.event.preventDefault(),f=this._updateLightBulbPosition(this._marginDomNode,_.event.browserEvent.y,g),m(_.event.posx,_.event.posy+g))}))}_updateLightBulbPosition(e,t,s){const{top:o}=getDomNodePagePosition(e),r=t-o,l=Math.floor(r/s),c=l*s;if(this._diffActions.style.top=`${c}px`,this._viewLineCounts){let d=0;for(let u=0;u<this._viewLineCounts.length;u++)if(d+=this._viewLineCounts[u],l<d)return u}return l}}const ttPolicy$4=createTrustedTypesPolicy$1("diffEditorWidget",{createHTML:a=>a});function renderLines$1(a,e,t,s,o=!1){applyFontInfo(s,e.fontInfo);const r=t.length>0,l=new StringBuilder(1e4);let c=0,d=0;const u=[];for(let m=0;m<a.lineTokens.length;m++){const _=m+1,C=a.lineTokens[m],b=a.lineBreakData[m],v=LineDecoration.filter(t,_,1,Number.MAX_SAFE_INTEGER);if(b){let S=0;for(const y of b.breakOffsets){const w=C.sliceAndInflate(S,y,0);c=Math.max(c,renderOriginalLine(d,w,LineDecoration.extractWrapped(v,S,y),r,a.mightContainNonBasicASCII,a.mightContainRTL,e,l,o)),d++,S=y}u.push(b.breakOffsets.length)}else u.push(1),c=Math.max(c,renderOriginalLine(d,C,v,r,a.mightContainNonBasicASCII,a.mightContainRTL,e,l,o)),d++}c+=e.scrollBeyondLastColumn;const g=l.build(),f=ttPolicy$4?ttPolicy$4.createHTML(g):g;s.innerHTML=f;const p=c*e.typicalHalfwidthCharacterWidth;return{heightInLines:d,minWidthInPx:p,viewLineCounts:u}}class LineSource{constructor(e,t=e.map(r=>null),s=!0,o=!0){this.lineTokens=e,this.lineBreakData=t,this.mightContainNonBasicASCII=s,this.mightContainRTL=o}}class RenderOptions{static fromEditor(e){var r;const t=e.getOptions(),s=t.get(59),o=t.get(165);return new RenderOptions(((r=e.getModel())==null?void 0:r.getOptions().tabSize)||0,s,t.get(40),s.typicalHalfwidthCharacterWidth,t.get(118),t.get(75),o.decorationsWidth,t.get(133),t.get(113),t.get(108),t.get(60),t.get(117).verticalScrollbarSize)}constructor(e,t,s,o,r,l,c,d,u,g,f,p,m=!0){this.tabSize=e,this.fontInfo=t,this.disableMonospaceOptimizations=s,this.typicalHalfwidthCharacterWidth=o,this.scrollBeyondLastColumn=r,this.lineHeight=l,this.lineDecorationsWidth=c,this.stopRenderingLineAfter=d,this.renderWhitespace=u,this.renderControlCharacters=g,this.fontLigatures=f,this.verticalScrollbarSize=p,this.setWidth=m}withSetWidth(e){return new RenderOptions(this.tabSize,this.fontInfo,this.disableMonospaceOptimizations,this.typicalHalfwidthCharacterWidth,this.scrollBeyondLastColumn,this.lineHeight,this.lineDecorationsWidth,this.stopRenderingLineAfter,this.renderWhitespace,this.renderControlCharacters,this.fontLigatures,this.verticalScrollbarSize,e)}withScrollBeyondLastColumn(e){return new RenderOptions(this.tabSize,this.fontInfo,this.disableMonospaceOptimizations,this.typicalHalfwidthCharacterWidth,e,this.lineHeight,this.lineDecorationsWidth,this.stopRenderingLineAfter,this.renderWhitespace,this.renderControlCharacters,this.fontLigatures,this.verticalScrollbarSize,this.setWidth)}}function renderOriginalLine(a,e,t,s,o,r,l,c,d){c.appendString('<div class="view-line'),!d&&!s&&c.appendString(" char-delete"),c.appendString('" style="top:'),c.appendString(String(a*l.lineHeight)),l.setWidth?c.appendString('px;width:1000000px;">'):c.appendString('px;">');const u=e.getLineContent(),g=ViewLineRenderingData.isBasicASCII(u,o),f=ViewLineRenderingData.containsRTL(u,g,r),p=renderViewLine(new RenderLineInput(l.fontInfo.isMonospace&&!l.disableMonospaceOptimizations,l.fontInfo.canUseHalfwidthRightwardsArrow,u,!1,g,f,0,e,t,l.tabSize,0,l.fontInfo.spaceWidth,l.fontInfo.middotWidth,l.fontInfo.wsmiddotWidth,l.stopRenderingLineAfter,l.renderWhitespace,l.renderControlCharacters,l.fontLigatures!==EditorFontLigatures.OFF,null,null,l.verticalScrollbarSize),c);return c.appendString("</div>"),p.characterMapping.getHorizontalOffset(p.characterMapping.length)}const IClipboardService=createDecorator("clipboardService"),IContextViewService=createDecorator("contextViewService"),IContextMenuService=createDecorator("contextMenuService");var __decorate$2u=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2r=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let DiffEditorViewZones=class extends Disposable{constructor(e,t,s,o,r,l,c,d,u,g){super(),this._targetWindow=e,this._editors=t,this._diffModel=s,this._options=o,this._diffEditorWidget=r,this._canIgnoreViewZoneUpdateEvent=l,this._origViewZonesToIgnore=c,this._modViewZonesToIgnore=d,this._clipboardService=u,this._contextMenuService=g,this._originalTopPadding=observableValue(this,0),this._originalScrollOffset=observableValue(this,0),this._originalScrollOffsetAnimated=animatedObservable(this._targetWindow,this._originalScrollOffset,this._store),this._modifiedTopPadding=observableValue(this,0),this._modifiedScrollOffset=observableValue(this,0),this._modifiedScrollOffsetAnimated=animatedObservable(this._targetWindow,this._modifiedScrollOffset,this._store);const f=observableValue("invalidateAlignmentsState",0),p=this._register(new RunOnceScheduler(()=>{f.set(f.get()+1,void 0)},0));this._register(this._editors.original.onDidChangeViewZones(y=>{this._canIgnoreViewZoneUpdateEvent()||p.schedule()})),this._register(this._editors.modified.onDidChangeViewZones(y=>{this._canIgnoreViewZoneUpdateEvent()||p.schedule()})),this._register(this._editors.original.onDidChangeConfiguration(y=>{(y.hasChanged(166)||y.hasChanged(75))&&p.schedule()})),this._register(this._editors.modified.onDidChangeConfiguration(y=>{(y.hasChanged(166)||y.hasChanged(75))&&p.schedule()}));const m=this._diffModel.map(y=>y?observableFromEvent(this,y.model.original.onDidChangeTokens,()=>y.model.original.tokenization.backgroundTokenizationState===2):void 0).map((y,w)=>y==null?void 0:y.read(w)),_=derived(y=>{const w=this._diffModel.read(y),L=w==null?void 0:w.diff.read(y);if(!w||!L)return null;f.read(y);const E=this._options.renderSideBySide.read(y);return computeRangeAlignment(this._editors.original,this._editors.modified,L.mappings,this._origViewZonesToIgnore,this._modViewZonesToIgnore,E)}),C=derived(y=>{var x;const w=(x=this._diffModel.read(y))==null?void 0:x.movedTextToCompare.read(y);if(!w)return null;f.read(y);const L=w.changes.map(E=>new DiffMapping(E));return computeRangeAlignment(this._editors.original,this._editors.modified,L,this._origViewZonesToIgnore,this._modViewZonesToIgnore,!0)});function b(){const y=document.createElement("div");return y.className="diagonal-fill",y}const v=this._register(new DisposableStore);this.viewZones=derived(this,y=>{var B,H,V,K;v.clear();const w=_.read(y)||[],L=[],x=[],E=this._modifiedTopPadding.read(y);E>0&&x.push({afterLineNumber:0,domNode:document.createElement("div"),heightInPx:E,showInHiddenAreas:!0,suppressMouseDown:!0});const I=this._originalTopPadding.read(y);I>0&&L.push({afterLineNumber:0,domNode:document.createElement("div"),heightInPx:I,showInHiddenAreas:!0,suppressMouseDown:!0});const D=this._options.renderSideBySide.read(y),k=D||(B=this._editors.modified._getViewModel())==null?void 0:B.createLineBreaksComputer();if(k){const z=this._editors.original.getModel();for(const G of w)if(G.diff)for(let X=G.originalRange.startLineNumber;X<G.originalRange.endLineNumberExclusive;X++){if(X>z.getLineCount())return{orig:L,mod:x};k==null||k.addRequest(z.getLineContent(X),null,null)}}const N=(k==null?void 0:k.finalize())??[];let R=0;const M=this._editors.modified.getOption(75),A=(H=this._diffModel.read(y))==null?void 0:H.movedTextToCompare.read(y),O=((V=this._editors.original.getModel())==null?void 0:V.mightContainNonBasicASCII())??!1,P=((K=this._editors.original.getModel())==null?void 0:K.mightContainRTL())??!1,W=RenderOptions.fromEditor(this._editors.modified);for(const z of w)if(z.diff&&!D&&(!this._options.useTrueInlineDiffRendering.read(y)||!allowsTrueInlineDiffRendering$1(z.diff))){if(!z.originalRange.isEmpty){m.read(y);const X=document.createElement("div");X.classList.add("view-lines","line-delete","monaco-mouse-cursor-text");const Y=this._editors.original.getModel();if(z.originalRange.endLineNumberExclusive-1>Y.getLineCount())return{orig:L,mod:x};const ee=new LineSource(z.originalRange.mapToLineArray(he=>Y.tokenization.getLineTokens(he)),z.originalRange.mapToLineArray(he=>N[R++]),O,P),le=[];for(const he of z.diff.innerChanges||[])le.push(new InlineDecoration(he.originalRange.delta(-(z.diff.original.startLineNumber-1)),diffDeleteDecoration.className,0));const ne=renderLines$1(ee,W,le,X),me=document.createElement("div");if(me.className="inline-deleted-margin-view-zone",applyFontInfo(me,W.fontInfo),this._options.renderIndicators.read(y))for(let he=0;he<ne.heightInLines;he++){const we=document.createElement("div");we.className=`delete-sign ${ThemeIcon.asClassName(diffRemoveIcon)}`,we.setAttribute("style",`position:absolute;top:${he*M}px;width:${W.lineDecorationsWidth}px;height:${M}px;right:0;`),me.appendChild(we)}let ft;v.add(new InlineDiffDeletedCodeMargin(()=>assertReturnsDefined(ft),me,this._editors.modified,z.diff,this._diffEditorWidget,ne.viewLineCounts,this._editors.original.getModel(),this._contextMenuService,this._clipboardService));for(let he=0;he<ne.viewLineCounts.length;he++){const we=ne.viewLineCounts[he];we>1&&L.push({afterLineNumber:z.originalRange.startLineNumber+he,domNode:b(),heightInPx:(we-1)*M,showInHiddenAreas:!0,suppressMouseDown:!0})}x.push({afterLineNumber:z.modifiedRange.startLineNumber-1,domNode:X,heightInPx:ne.heightInLines*M,minWidthInPx:ne.minWidthInPx,marginDomNode:me,setZoneId(he){ft=he},showInHiddenAreas:!0,suppressMouseDown:!0})}const G=document.createElement("div");G.className="gutter-delete",L.push({afterLineNumber:z.originalRange.endLineNumberExclusive-1,domNode:b(),heightInPx:z.modifiedHeightInPx,marginDomNode:G,showInHiddenAreas:!0,suppressMouseDown:!0})}else{const G=z.modifiedHeightInPx-z.originalHeightInPx;if(G>0){if(A!=null&&A.lineRangeMapping.original.delta(-1).deltaLength(2).contains(z.originalRange.endLineNumberExclusive-1))continue;L.push({afterLineNumber:z.originalRange.endLineNumberExclusive-1,domNode:b(),heightInPx:G,showInHiddenAreas:!0,suppressMouseDown:!0})}else{let X=function(){const ee=document.createElement("div");return ee.className="arrow-revert-change "+ThemeIcon.asClassName(Codicon.arrowRight),y.store.add(addDisposableListener(ee,"mousedown",le=>le.stopPropagation())),y.store.add(addDisposableListener(ee,"click",le=>{le.stopPropagation(),r.revert(z.diff)})),$$l("div",{},ee)};if(A!=null&&A.lineRangeMapping.modified.delta(-1).deltaLength(2).contains(z.modifiedRange.endLineNumberExclusive-1))continue;let Y;z.diff&&z.diff.modified.isEmpty&&this._options.shouldRenderOldRevertArrows.read(y)&&(Y=X()),x.push({afterLineNumber:z.modifiedRange.endLineNumberExclusive-1,domNode:b(),heightInPx:-G,marginDomNode:Y,showInHiddenAreas:!0,suppressMouseDown:!0})}}for(const z of C.read(y)??[]){if(!(A!=null&&A.lineRangeMapping.original.intersect(z.originalRange))||!(A!=null&&A.lineRangeMapping.modified.intersect(z.modifiedRange)))continue;const G=z.modifiedHeightInPx-z.originalHeightInPx;G>0?L.push({afterLineNumber:z.originalRange.endLineNumberExclusive-1,domNode:b(),heightInPx:G,showInHiddenAreas:!0,suppressMouseDown:!0}):x.push({afterLineNumber:z.modifiedRange.endLineNumberExclusive-1,domNode:b(),heightInPx:-G,showInHiddenAreas:!0,suppressMouseDown:!0})}return{orig:L,mod:x}});let S=!1;this._register(this._editors.original.onDidScrollChange(y=>{y.scrollLeftChanged&&!S&&(S=!0,this._editors.modified.setScrollLeft(y.scrollLeft),S=!1)})),this._register(this._editors.modified.onDidScrollChange(y=>{y.scrollLeftChanged&&!S&&(S=!0,this._editors.original.setScrollLeft(y.scrollLeft),S=!1)})),this._originalScrollTop=observableFromEvent(this._editors.original.onDidScrollChange,()=>this._editors.original.getScrollTop()),this._modifiedScrollTop=observableFromEvent(this._editors.modified.onDidScrollChange,()=>this._editors.modified.getScrollTop()),this._register(autorun(y=>{const w=this._originalScrollTop.read(y)-(this._originalScrollOffsetAnimated.read(void 0)-this._modifiedScrollOffsetAnimated.read(y))-(this._originalTopPadding.read(void 0)-this._modifiedTopPadding.read(y));w!==this._editors.modified.getScrollTop()&&this._editors.modified.setScrollTop(w,1)})),this._register(autorun(y=>{const w=this._modifiedScrollTop.read(y)-(this._modifiedScrollOffsetAnimated.read(void 0)-this._originalScrollOffsetAnimated.read(y))-(this._modifiedTopPadding.read(void 0)-this._originalTopPadding.read(y));w!==this._editors.original.getScrollTop()&&this._editors.original.setScrollTop(w,1)})),this._register(autorun(y=>{var x;const w=(x=this._diffModel.read(y))==null?void 0:x.movedTextToCompare.read(y);let L=0;if(w){const E=this._editors.original.getTopForLineNumber(w.lineRangeMapping.original.startLineNumber,!0)-this._originalTopPadding.read(void 0);L=this._editors.modified.getTopForLineNumber(w.lineRangeMapping.modified.startLineNumber,!0)-this._modifiedTopPadding.read(void 0)-E}L>0?(this._modifiedTopPadding.set(0,void 0),this._originalTopPadding.set(L,void 0)):L<0?(this._modifiedTopPadding.set(-L,void 0),this._originalTopPadding.set(0,void 0)):setTimeout(()=>{this._modifiedTopPadding.set(0,void 0),this._originalTopPadding.set(0,void 0)},400),this._editors.modified.hasTextFocus()?this._originalScrollOffset.set(this._modifiedScrollOffset.read(void 0)-L,void 0,!0):this._modifiedScrollOffset.set(this._originalScrollOffset.read(void 0)+L,void 0,!0)}))}};DiffEditorViewZones=__decorate$2u([__param$2r(8,IClipboardService),__param$2r(9,IContextMenuService)],DiffEditorViewZones);function computeRangeAlignment(a,e,t,s,o,r){const l=new ArrayQueue(getAdditionalLineHeights(a,s)),c=new ArrayQueue(getAdditionalLineHeights(e,o)),d=a.getOption(75),u=e.getOption(75),g=[];let f=0,p=0;function m(_,C){for(;;){let b=l.peek(),v=c.peek();if(b&&b.lineNumber>=_&&(b=void 0),v&&v.lineNumber>=C&&(v=void 0),!b&&!v)break;const S=b?b.lineNumber-f:Number.MAX_VALUE,y=v?v.lineNumber-p:Number.MAX_VALUE;S<y?(l.dequeue(),v={lineNumber:b.lineNumber-f+p,heightInPx:0}):S>y?(c.dequeue(),b={lineNumber:v.lineNumber-p+f,heightInPx:0}):(l.dequeue(),c.dequeue()),g.push({originalRange:LineRange.ofLength(b.lineNumber,1),modifiedRange:LineRange.ofLength(v.lineNumber,1),originalHeightInPx:d+b.heightInPx,modifiedHeightInPx:u+v.heightInPx,diff:void 0})}}for(const _ of t){let y=function(w,L,x=!1){var N,R;if(w<S||L<v)return;if(b)b=!1;else if(!x&&(w===S||L===v))return;const E=new LineRange(S,w),I=new LineRange(v,L);if(E.isEmpty&&I.isEmpty)return;const D=((N=l.takeWhile(M=>M.lineNumber<w))==null?void 0:N.reduce((M,A)=>M+A.heightInPx,0))??0,k=((R=c.takeWhile(M=>M.lineNumber<L))==null?void 0:R.reduce((M,A)=>M+A.heightInPx,0))??0;g.push({originalRange:E,modifiedRange:I,originalHeightInPx:E.length*d+D,modifiedHeightInPx:I.length*u+k,diff:_.lineRangeMapping}),S=w,v=L};const C=_.lineRangeMapping;m(C.original.startLineNumber,C.modified.startLineNumber);let b=!0,v=C.modified.startLineNumber,S=C.original.startLineNumber;if(r)for(const w of C.innerChanges||[]){w.originalRange.startColumn>1&&w.modifiedRange.startColumn>1&&y(w.originalRange.startLineNumber,w.modifiedRange.startLineNumber);const L=a.getModel(),x=w.originalRange.endLineNumber<=L.getLineCount()?L.getLineMaxColumn(w.originalRange.endLineNumber):Number.MAX_SAFE_INTEGER;w.originalRange.endColumn<x&&y(w.originalRange.endLineNumber,w.modifiedRange.endLineNumber)}y(C.original.endLineNumberExclusive,C.modified.endLineNumberExclusive,!0),f=C.original.endLineNumberExclusive,p=C.modified.endLineNumberExclusive}return m(Number.MAX_VALUE,Number.MAX_VALUE),g}function getAdditionalLineHeights(a,e){const t=[],s=[],o=a.getOption(166).wrappingColumn!==-1,r=a._getViewModel().coordinatesConverter,l=a.getOption(75);if(o)for(let d=1;d<=a.getModel().getLineCount();d++){const u=r.getModelLineViewLineCount(d);u>1&&s.push({lineNumber:d,heightInPx:l*(u-1)})}for(const d of a.getWhitespaces()){if(e.has(d.id))continue;const u=d.afterLineNumber===0?0:r.convertViewPositionToModelPosition(new Position$1(d.afterLineNumber,1)).lineNumber;t.push({lineNumber:u,heightInPx:d.height})}return joinCombine(t,s,d=>d.lineNumber,(d,u)=>({lineNumber:d.lineNumber,heightInPx:d.heightInPx+u.heightInPx}))}function allowsTrueInlineDiffRendering$1(a){return a.innerChanges?a.innerChanges.every(e=>rangeIsSingleLine(e.modifiedRange)&&rangeIsSingleLine(e.originalRange)||e.originalRange.equalsRange(new Range$2(1,1,1,1))):!1}function rangeIsSingleLine(a){return a.startLineNumber===a.endLineNumber}const mn=class mn extends Disposable{constructor(e,t,s,o,r){super(),this._rootElement=e,this._diffModel=t,this._originalEditorLayoutInfo=s,this._modifiedEditorLayoutInfo=o,this._editors=r,this._originalScrollTop=observableFromEvent(this,this._editors.original.onDidScrollChange,()=>this._editors.original.getScrollTop()),this._modifiedScrollTop=observableFromEvent(this,this._editors.modified.onDidScrollChange,()=>this._editors.modified.getScrollTop()),this._viewZonesChanged=observableSignalFromEvent("onDidChangeViewZones",this._editors.modified.onDidChangeViewZones),this.width=observableValue(this,0),this._modifiedViewZonesChangedSignal=observableSignalFromEvent("modified.onDidChangeViewZones",this._editors.modified.onDidChangeViewZones),this._originalViewZonesChangedSignal=observableSignalFromEvent("original.onDidChangeViewZones",this._editors.original.onDidChangeViewZones),this._state=derived(this,g=>{var x;this._element.replaceChildren();const f=this._diffModel.read(g),p=(x=f==null?void 0:f.diff.read(g))==null?void 0:x.movedTexts;if(!p||p.length===0){this.width.set(0,void 0);return}this._viewZonesChanged.read(g);const m=this._originalEditorLayoutInfo.read(g),_=this._modifiedEditorLayoutInfo.read(g);if(!m||!_){this.width.set(0,void 0);return}this._modifiedViewZonesChangedSignal.read(g),this._originalViewZonesChangedSignal.read(g);const C=p.map(E=>{function I(W,B){const H=B.getTopForLineNumber(W.startLineNumber,!0),V=B.getTopForLineNumber(W.endLineNumberExclusive,!0);return(H+V)/2}const D=I(E.lineRangeMapping.original,this._editors.original),k=this._originalScrollTop.read(g),N=I(E.lineRangeMapping.modified,this._editors.modified),R=this._modifiedScrollTop.read(g),M=D-k,A=N-R,O=Math.min(D,N),P=Math.max(D,N);return{range:new OffsetRange(O,P),from:M,to:A,fromWithoutScroll:D,toWithoutScroll:N,move:E}});C.sort(tieBreakComparators(compareBy(E=>E.fromWithoutScroll>E.toWithoutScroll,booleanComparator),compareBy(E=>E.fromWithoutScroll>E.toWithoutScroll?E.fromWithoutScroll:-E.toWithoutScroll,numberComparator)));const b=LinesLayout.compute(C.map(E=>E.range)),v=10,S=m.verticalScrollbarWidth,y=(b.getTrackCount()-1)*10+v*2,w=S+y+(_.contentLeft-mn.movedCodeBlockPadding);let L=0;for(const E of C){const I=b.getTrack(L),D=S+v+I*10,k=15,N=15,R=w,M=_.glyphMarginWidth+_.lineNumbersWidth,A=18,O=document.createElementNS("http://www.w3.org/2000/svg","rect");O.classList.add("arrow-rectangle"),O.setAttribute("x",`${R-M}`),O.setAttribute("y",`${E.to-A/2}`),O.setAttribute("width",`${M}`),O.setAttribute("height",`${A}`),this._element.appendChild(O);const P=document.createElementNS("http://www.w3.org/2000/svg","g"),W=document.createElementNS("http://www.w3.org/2000/svg","path");W.setAttribute("d",`M 0 ${E.from} L ${D} ${E.from} L ${D} ${E.to} L ${R-N} ${E.to}`),W.setAttribute("fill","none"),P.appendChild(W);const B=document.createElementNS("http://www.w3.org/2000/svg","polygon");B.classList.add("arrow"),g.store.add(autorun(H=>{W.classList.toggle("currentMove",E.move===f.activeMovedText.read(H)),B.classList.toggle("currentMove",E.move===f.activeMovedText.read(H))})),B.setAttribute("points",`${R-N},${E.to-k/2} ${R},${E.to} ${R-N},${E.to+k/2}`),P.appendChild(B),this._element.appendChild(P),L++}this.width.set(y,void 0)}),this._element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._element.setAttribute("class","moved-blocks-lines"),this._rootElement.appendChild(this._element),this._register(toDisposable(()=>this._element.remove())),this._register(autorun(g=>{const f=this._originalEditorLayoutInfo.read(g),p=this._modifiedEditorLayoutInfo.read(g);!f||!p||(this._element.style.left=`${f.width-f.verticalScrollbarWidth}px`,this._element.style.height=`${f.height}px`,this._element.style.width=`${f.verticalScrollbarWidth+f.contentLeft-mn.movedCodeBlockPadding+this.width.read(g)}px`)})),this._register(recomputeInitiallyAndOnChange(this._state));const l=derived(g=>{const f=this._diffModel.read(g),p=f==null?void 0:f.diff.read(g);return p?p.movedTexts.map(m=>({move:m,original:new PlaceholderViewZone(constObservable(m.lineRangeMapping.original.startLineNumber-1),18),modified:new PlaceholderViewZone(constObservable(m.lineRangeMapping.modified.startLineNumber-1),18)})):[]});this._register(applyViewZones(this._editors.original,l.map(g=>g.map(f=>f.original)))),this._register(applyViewZones(this._editors.modified,l.map(g=>g.map(f=>f.modified)))),this._register(autorunWithStore((g,f)=>{const p=l.read(g);for(const m of p)f.add(new MovedBlockOverlayWidget(this._editors.original,m.original,m.move,"original",this._diffModel.get())),f.add(new MovedBlockOverlayWidget(this._editors.modified,m.modified,m.move,"modified",this._diffModel.get()))}));const c=observableSignalFromEvent("original.onDidFocusEditorWidget",g=>this._editors.original.onDidFocusEditorWidget(()=>setTimeout(()=>g(void 0),0))),d=observableSignalFromEvent("modified.onDidFocusEditorWidget",g=>this._editors.modified.onDidFocusEditorWidget(()=>setTimeout(()=>g(void 0),0)));let u="modified";this._register(autorunHandleChanges({changeTracker:{createChangeSummary:()=>{},handleChange:(g,f)=>(g.didChange(c)&&(u="original"),g.didChange(d)&&(u="modified"),!0)}},g=>{c.read(g),d.read(g);const f=this._diffModel.read(g);if(!f)return;const p=f.diff.read(g);let m;if(p&&u==="original"){const _=this._editors.originalCursor.read(g);_&&(m=p.movedTexts.find(C=>C.lineRangeMapping.original.contains(_.lineNumber)))}if(p&&u==="modified"){const _=this._editors.modifiedCursor.read(g);_&&(m=p.movedTexts.find(C=>C.lineRangeMapping.modified.contains(_.lineNumber)))}m!==f.movedTextToCompare.read(void 0)&&f.movedTextToCompare.set(void 0,void 0),f.setActiveMovedText(m)}))}};mn.movedCodeBlockPadding=4;let MovedBlocksLinesFeature=mn;class LinesLayout{static compute(e){const t=[],s=[];for(const o of e){let r=t.findIndex(l=>!l.intersectsStrict(o));r===-1&&(t.length>=6?r=findMaxIdx(t,compareBy(c=>c.intersectWithRangeLength(o),numberComparator)):(r=t.length,t.push(new OffsetRangeSet))),t[r].addRange(o),s.push(r)}return new LinesLayout(t.length,s)}constructor(e,t){this._trackCount=e,this.trackPerLineIdx=t}getTrack(e){return this.trackPerLineIdx[e]}getTrackCount(){return this._trackCount}}class MovedBlockOverlayWidget extends ViewZoneOverlayWidget{constructor(e,t,s,o,r){const l=h("div.diff-hidden-lines-widget");super(e,t,l.root),this._editor=e,this._move=s,this._kind=o,this._diffModel=r,this._nodes=h("div.diff-moved-code-block",{style:{marginRight:"4px"}},[h("div.text-content@textContent"),h("div.action-bar@actionBar")]),l.root.appendChild(this._nodes.root);const c=observableFromEvent(this._editor.onDidLayoutChange,()=>this._editor.getLayoutInfo());this._register(applyStyle(this._nodes.root,{paddingRight:c.map(p=>p.verticalScrollbarWidth)}));let d;s.changes.length>0?d=this._kind==="original"?localize(128,"Code moved with changes to line {0}-{1}",this._move.lineRangeMapping.modified.startLineNumber,this._move.lineRangeMapping.modified.endLineNumberExclusive-1):localize(129,"Code moved with changes from line {0}-{1}",this._move.lineRangeMapping.original.startLineNumber,this._move.lineRangeMapping.original.endLineNumberExclusive-1):d=this._kind==="original"?localize(130,"Code moved to line {0}-{1}",this._move.lineRangeMapping.modified.startLineNumber,this._move.lineRangeMapping.modified.endLineNumberExclusive-1):localize(131,"Code moved from line {0}-{1}",this._move.lineRangeMapping.original.startLineNumber,this._move.lineRangeMapping.original.endLineNumberExclusive-1);const u=this._register(new ActionBar(this._nodes.actionBar,{highlightToggledItems:!0})),g=new Action("",d,"",!1);u.push(g,{icon:!1,label:!0});const f=new Action("","Compare",ThemeIcon.asClassName(Codicon.compareChanges),!0,()=>{this._editor.focus(),this._diffModel.movedTextToCompare.set(this._diffModel.movedTextToCompare.get()===s?void 0:this._move,void 0)});this._register(autorun(p=>{const m=this._diffModel.movedTextToCompare.read(p)===s;f.checked=m})),u.push(f,{icon:!1,label:!0})}}class DiffEditorDecorations extends Disposable{constructor(e,t,s,o){super(),this._editors=e,this._diffModel=t,this._options=s,this._decorations=derived(this,r=>{const l=this._diffModel.read(r),c=l==null?void 0:l.diff.read(r);if(!c)return null;const d=this._diffModel.read(r).movedTextToCompare.read(r),u=this._options.renderIndicators.read(r),g=this._options.showEmptyDecorations.read(r),f=[],p=[];if(!d)for(const _ of c.mappings)if(_.lineRangeMapping.original.isEmpty||f.push({range:_.lineRangeMapping.original.toInclusiveRange(),options:u?diffLineDeleteDecorationBackgroundWithIndicator:diffLineDeleteDecorationBackground}),_.lineRangeMapping.modified.isEmpty||p.push({range:_.lineRangeMapping.modified.toInclusiveRange(),options:u?diffLineAddDecorationBackgroundWithIndicator:diffLineAddDecorationBackground}),_.lineRangeMapping.modified.isEmpty||_.lineRangeMapping.original.isEmpty)_.lineRangeMapping.original.isEmpty||f.push({range:_.lineRangeMapping.original.toInclusiveRange(),options:diffWholeLineDeleteDecoration}),_.lineRangeMapping.modified.isEmpty||p.push({range:_.lineRangeMapping.modified.toInclusiveRange(),options:diffWholeLineAddDecoration});else{const C=this._options.useTrueInlineDiffRendering.read(r)&&allowsTrueInlineDiffRendering$1(_.lineRangeMapping);for(const b of _.lineRangeMapping.innerChanges||[])if(_.lineRangeMapping.original.contains(b.originalRange.startLineNumber)&&f.push({range:b.originalRange,options:b.originalRange.isEmpty()&&g?diffDeleteDecorationEmpty:diffDeleteDecoration}),_.lineRangeMapping.modified.contains(b.modifiedRange.startLineNumber)&&p.push({range:b.modifiedRange,options:b.modifiedRange.isEmpty()&&g&&!C?diffAddDecorationEmpty:diffAddDecoration}),C){const v=l.model.original.getValueInRange(b.originalRange);p.push({range:b.modifiedRange,options:{description:"deleted-text",before:{content:v,inlineClassName:"inline-deleted-text"},zIndex:1e5,showIfCollapsed:!0}})}}if(d)for(const _ of d.changes){const C=_.original.toInclusiveRange();C&&f.push({range:C,options:u?diffLineDeleteDecorationBackgroundWithIndicator:diffLineDeleteDecorationBackground});const b=_.modified.toInclusiveRange();b&&p.push({range:b,options:u?diffLineAddDecorationBackgroundWithIndicator:diffLineAddDecorationBackground});for(const v of _.innerChanges||[])f.push({range:v.originalRange,options:diffDeleteDecoration}),p.push({range:v.modifiedRange,options:diffAddDecoration})}const m=this._diffModel.read(r).activeMovedText.read(r);for(const _ of c.movedTexts)f.push({range:_.lineRangeMapping.original.toInclusiveRange(),options:{description:"moved",blockClassName:"movedOriginal"+(_===m?" currentMove":""),blockPadding:[MovedBlocksLinesFeature.movedCodeBlockPadding,0,MovedBlocksLinesFeature.movedCodeBlockPadding,MovedBlocksLinesFeature.movedCodeBlockPadding]}}),p.push({range:_.lineRangeMapping.modified.toInclusiveRange(),options:{description:"moved",blockClassName:"movedModified"+(_===m?" currentMove":""),blockPadding:[4,0,4,4]}});return{originalDecorations:f,modifiedDecorations:p}}),this._register(applyObservableDecorations(this._editors.original,this._decorations.map(r=>(r==null?void 0:r.originalDecorations)||[]))),this._register(applyObservableDecorations(this._editors.modified,this._decorations.map(r=>(r==null?void 0:r.modifiedDecorations)||[])))}}class Point{static equals(e,t){return e.x===t.x&&e.y===t.y}constructor(e,t){this.x=e,this.y=t}add(e){return new Point(this.x+e.x,this.y+e.y)}deltaX(e){return new Point(this.x+e,this.y)}deltaY(e){return new Point(this.x,this.y+e)}toString(){return`(${this.x},${this.y})`}subtract(e){return new Point(this.x-e.x,this.y-e.y)}scale(e){return new Point(this.x*e,this.y*e)}mapComponents(e){return new Point(e(this.x),e(this.y))}isZero(){return this.x===0&&this.y===0}withThreshold(e){return this.mapComponents(t=>t>e?t-e:t<-e?t+e:0)}}function observableCodeEditor(a){return ObservableCodeEditor.get(a)}const et=class et extends Disposable{static get(e){let t=et._map.get(e);if(!t){t=new et(e),et._map.set(e,t);const s=e.onDidDispose(()=>{const o=et._map.get(e);o&&(et._map.delete(e),o.dispose(),s.dispose())})}return t}_beginUpdate(){this._updateCounter++,this._updateCounter===1&&(this._currentTransaction=new TransactionImpl(()=>{}))}_endUpdate(){if(this._updateCounter--,this._updateCounter===0){const e=this._currentTransaction;this._currentTransaction=void 0,e.finish()}}constructor(e){var t;super(),this.editor=e,this._updateCounter=0,this._currentTransaction=void 0,this._model=observableValue(this,this.editor.getModel()),this.model=this._model,this.isReadonly=observableFromEvent(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(104)),this._versionId=observableValueOpts({owner:this,lazy:!0},((t=this.editor.getModel())==null?void 0:t.getVersionId())??null),this.versionId=this._versionId,this._selections=observableValueOpts({owner:this,equalsFn:equalsIfDefined(itemsEquals(Selection$1.selectionsEqual)),lazy:!0},this.editor.getSelections()??null),this.selections=this._selections,this.positions=derivedOpts({owner:this,equalsFn:equalsIfDefined(itemsEquals(Position$1.equals))},s=>{var o;return((o=this.selections.read(s))==null?void 0:o.map(r=>r.getStartPosition()))??null}),this.isFocused=observableFromEvent(this,s=>{const o=this.editor.onDidFocusEditorWidget(s),r=this.editor.onDidBlurEditorWidget(s);return{dispose(){o.dispose(),r.dispose()}}},()=>this.editor.hasWidgetFocus()),this.isTextFocused=observableFromEvent(this,s=>{const o=this.editor.onDidFocusEditorText(s),r=this.editor.onDidBlurEditorText(s);return{dispose(){o.dispose(),r.dispose()}}},()=>this.editor.hasTextFocus()),this.inComposition=observableFromEvent(this,s=>{const o=this.editor.onDidCompositionStart(()=>{s(void 0)}),r=this.editor.onDidCompositionEnd(()=>{s(void 0)});return{dispose(){o.dispose(),r.dispose()}}},()=>this.editor.inComposition),this.value=derivedWithSetter(this,s=>{var o;return this.versionId.read(s),((o=this.model.read(s))==null?void 0:o.getValue())??""},(s,o)=>{const r=this.model.get();r!==null&&s!==r.getValue()&&r.setValue(s)}),this.valueIsEmpty=derived(this,s=>{var o;return this.versionId.read(s),((o=this.editor.getModel())==null?void 0:o.getValueLength())===0}),this.cursorSelection=derivedOpts({owner:this,equalsFn:equalsIfDefined(Selection$1.selectionsEqual)},s=>{var o;return((o=this.selections.read(s))==null?void 0:o[0])??null}),this.cursorPosition=derivedOpts({owner:this,equalsFn:Position$1.equals},s=>{var o,r;return((r=(o=this.selections.read(s))==null?void 0:o[0])==null?void 0:r.getPosition())??null}),this.cursorLineNumber=derived(this,s=>{var o;return((o=this.cursorPosition.read(s))==null?void 0:o.lineNumber)??null}),this.onDidType=observableSignal(this),this.onDidPaste=observableSignal(this),this.scrollTop=observableFromEvent(this.editor.onDidScrollChange,()=>this.editor.getScrollTop()),this.scrollLeft=observableFromEvent(this.editor.onDidScrollChange,()=>this.editor.getScrollLeft()),this.layoutInfo=observableFromEvent(this.editor.onDidLayoutChange,()=>this.editor.getLayoutInfo()),this.layoutInfoContentLeft=this.layoutInfo.map(s=>s.contentLeft),this.layoutInfoDecorationsLeft=this.layoutInfo.map(s=>s.decorationsLeft),this.layoutInfoWidth=this.layoutInfo.map(s=>s.width),this.layoutInfoHeight=this.layoutInfo.map(s=>s.height),this.layoutInfoMinimap=this.layoutInfo.map(s=>s.minimap),this.layoutInfoVerticalScrollbarWidth=this.layoutInfo.map(s=>s.verticalScrollbarWidth),this.contentWidth=observableFromEvent(this.editor.onDidContentSizeChange,()=>this.editor.getContentWidth()),this.contentHeight=observableFromEvent(this.editor.onDidContentSizeChange,()=>this.editor.getContentHeight()),this._widgetCounter=0,this.openedPeekWidgets=observableValue(this,0),this._register(this.editor.onBeginUpdate(()=>this._beginUpdate())),this._register(this.editor.onEndUpdate(()=>this._endUpdate())),this._register(this.editor.onDidChangeModel(()=>{this._beginUpdate();try{this._model.set(this.editor.getModel(),this._currentTransaction),this._forceUpdate()}finally{this._endUpdate()}})),this._register(this.editor.onDidType(s=>{this._beginUpdate();try{this._forceUpdate(),this.onDidType.trigger(this._currentTransaction,s)}finally{this._endUpdate()}})),this._register(this.editor.onDidPaste(s=>{this._beginUpdate();try{this._forceUpdate(),this.onDidPaste.trigger(this._currentTransaction,s)}finally{this._endUpdate()}})),this._register(this.editor.onDidChangeModelContent(s=>{var o;this._beginUpdate();try{this._versionId.set(((o=this.editor.getModel())==null?void 0:o.getVersionId())??null,this._currentTransaction,s),this._forceUpdate()}finally{this._endUpdate()}})),this._register(this.editor.onDidChangeCursorSelection(s=>{this._beginUpdate();try{this._selections.set(this.editor.getSelections(),this._currentTransaction,s),this._forceUpdate()}finally{this._endUpdate()}})),this.domNode=derived(s=>(this.model.read(s),this.editor.getDomNode()))}forceUpdate(e){this._beginUpdate();try{return this._forceUpdate(),e?e(this._currentTransaction):void 0}finally{this._endUpdate()}}_forceUpdate(){var e;this._beginUpdate();try{this._model.set(this.editor.getModel(),this._currentTransaction),this._versionId.set(((e=this.editor.getModel())==null?void 0:e.getVersionId())??null,this._currentTransaction,void 0),this._selections.set(this.editor.getSelections(),this._currentTransaction,void 0)}finally{this._endUpdate()}}getOption(e,t=DebugLocation.ofCaller()){return observableFromEvent(this,s=>this.editor.onDidChangeConfiguration(o=>{o.hasChanged(e)&&s(void 0)}),()=>this.editor.getOption(e),t)}setDecorations(e){const t=new DisposableStore,s=this.editor.createDecorationsCollection();return t.add(autorunOpts({owner:this,debugName:()=>`Apply decorations from ${e.debugName}`},o=>{const r=e.read(o);s.set(r)})),t.add({dispose:()=>{s.clear()}}),t}createOverlayWidget(e){const t="observableOverlayWidget"+this._widgetCounter++,s={getDomNode:()=>e.domNode,getPosition:()=>e.position.get(),getId:()=>t,allowEditorOverflow:e.allowEditorOverflow,getMinContentWidthInPx:()=>e.minContentWidthInPx.get()};this.editor.addOverlayWidget(s);const o=autorun(r=>{e.position.read(r),e.minContentWidthInPx.read(r),this.editor.layoutOverlayWidget(s)});return toDisposable(()=>{o.dispose(),this.editor.removeOverlayWidget(s)})}createContentWidget(e){const t="observableContentWidget"+this._widgetCounter++,s={getDomNode:()=>e.domNode,getPosition:()=>e.position.get(),getId:()=>t,allowEditorOverflow:e.allowEditorOverflow};this.editor.addContentWidget(s);const o=autorun(r=>{e.position.read(r),this.editor.layoutContentWidget(s)});return toDisposable(()=>{o.dispose(),this.editor.removeContentWidget(s)})}observeLineOffsetRange(e,t){const s=this.observePosition(e.map(r=>new Position$1(r.startLineNumber,1)),t),o=this.observePosition(e.map(r=>new Position$1(r.endLineNumberExclusive+1,1)),t);return derived(r=>{var g;s.read(r),o.read(r);const l=e.read(r),c=(g=this.model.read(r))==null?void 0:g.getLineCount(),d=(typeof c<"u"&&l.startLineNumber>c?this.editor.getBottomForLineNumber(c):this.editor.getTopForLineNumber(l.startLineNumber))-this.scrollTop.read(r),u=l.isEmpty?d:this.editor.getBottomForLineNumber(l.endLineNumberExclusive-1)-this.scrollTop.read(r);return new OffsetRange(d,u)})}observePosition(e,t){let s=e.get();const o=observableValueOpts({owner:this,debugName:()=>`topLeftOfPosition${s==null?void 0:s.toString()}`,equalsFn:equalsIfDefined(Point.equals)},new Point(0,0)),r="observablePositionWidget"+this._widgetCounter++,l=document.createElement("div"),c={getDomNode:()=>l,getPosition:()=>s?{preference:[0],position:e.get()}:null,getId:()=>r,allowEditorOverflow:!1,afterRender:(d,u)=>{const g=this._model.get();g&&s&&s.lineNumber>g.getLineCount()?o.set(new Point(0,this.editor.getBottomForLineNumber(g.getLineCount())-this.scrollTop.get()),void 0):o.set(u?new Point(u.left,u.top):null,void 0)}};return this.editor.addContentWidget(c),t.add(autorun(d=>{s=e.read(d),this.editor.layoutContentWidget(c)})),t.add(toDisposable(()=>{this.editor.removeContentWidget(c)})),o}isTargetHovered(e,t){const s=observableValue("isInjectedTextHovered",!1);return t.add(this.editor.onMouseMove(o=>{const r=e(o);s.set(r,void 0)})),t.add(this.editor.onMouseLeave(o=>{s.set(!1,void 0)})),s}observeLineHeightForPosition(e){return derived(t=>{const s=e instanceof Position$1?e:e.read(t);return s===null?null:(this.getOption(75).read(t),this.editor.getLineHeightForPosition(s))})}observeLineHeightForLine(e){return typeof e=="number"?this.observeLineHeightForPosition(new Position$1(e,1)):derived(t=>{const s=e.read(t);return s===null?null:this.observeLineHeightForPosition(new Position$1(s,1)).read(t)})}observeLineHeightsForLineRange(e){return derived(t=>{const s=e instanceof LineRange?e:e.read(t),o=[];for(let r=s.startLineNumber;r<s.endLineNumberExclusive;r++)o.push(this.observeLineHeightForLine(r).read(t));return o})}};et._map=new Map;let ObservableCodeEditor=et;var __decorate$2t=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2q=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},OverviewRulerFeature_1,lt;let OverviewRulerFeature=(lt=class extends Disposable{constructor(e,t,s,o,r,l,c){super(),this._editors=e,this._rootElement=t,this._diffModel=s,this._rootWidth=o,this._rootHeight=r,this._modifiedEditorLayoutInfo=l,this._themeService=c,this.width=OverviewRulerFeature_1.ENTIRE_DIFF_OVERVIEW_WIDTH;const d=observableFromEvent(this._themeService.onDidColorThemeChange,()=>this._themeService.getColorTheme()),u=derived(p=>{const m=d.read(p),_=m.getColor(diffOverviewRulerInserted)||(m.getColor(diffInserted)||defaultInsertColor).transparent(2),C=m.getColor(diffOverviewRulerRemoved)||(m.getColor(diffRemoved)||defaultRemoveColor).transparent(2);return{insertColor:_,removeColor:C}}),g=createFastDomNode(document.createElement("div"));g.setClassName("diffViewport"),g.setPosition("absolute");const f=h("div.diffOverview",{style:{position:"absolute",top:"0px",width:OverviewRulerFeature_1.ENTIRE_DIFF_OVERVIEW_WIDTH+"px"}}).root;this._register(appendRemoveOnDispose(f,g.domNode)),this._register(addStandardDisposableListener(f,EventType$1.POINTER_DOWN,p=>{this._editors.modified.delegateVerticalScrollbarPointerDown(p)})),this._register(addDisposableListener(f,EventType$1.MOUSE_WHEEL,p=>{this._editors.modified.delegateScrollFromMouseWheelEvent(p)},{passive:!1})),this._register(appendRemoveOnDispose(this._rootElement,f)),this._register(autorunWithStore((p,m)=>{const _=this._diffModel.read(p),C=this._editors.original.createOverviewRuler("original diffOverviewRuler");C&&(m.add(C),m.add(appendRemoveOnDispose(f,C.getDomNode())));const b=this._editors.modified.createOverviewRuler("modified diffOverviewRuler");if(b&&(m.add(b),m.add(appendRemoveOnDispose(f,b.getDomNode()))),!C||!b)return;const v=observableSignalFromEvent("viewZoneChanged",this._editors.original.onDidChangeViewZones),S=observableSignalFromEvent("viewZoneChanged",this._editors.modified.onDidChangeViewZones),y=observableSignalFromEvent("hiddenRangesChanged",this._editors.original.onDidChangeHiddenAreas),w=observableSignalFromEvent("hiddenRangesChanged",this._editors.modified.onDidChangeHiddenAreas);m.add(autorun(L=>{var N;v.read(L),S.read(L),y.read(L),w.read(L);const x=u.read(L),E=(N=_==null?void 0:_.diff.read(L))==null?void 0:N.mappings;function I(R,M,A){const O=A._getViewModel();return O?R.filter(P=>P.length>0).map(P=>{const W=O.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(P.startLineNumber,1)),B=O.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(P.endLineNumberExclusive,1)),H=B.lineNumber-W.lineNumber;return new OverviewRulerZone(W.lineNumber,B.lineNumber,H,M.toString())}):[]}const D=I((E||[]).map(R=>R.lineRangeMapping.original),x.removeColor,this._editors.original),k=I((E||[]).map(R=>R.lineRangeMapping.modified),x.insertColor,this._editors.modified);C==null||C.setZones(D),b==null||b.setZones(k)})),m.add(autorun(L=>{const x=this._rootHeight.read(L),E=this._rootWidth.read(L),I=this._modifiedEditorLayoutInfo.read(L);if(I){const D=OverviewRulerFeature_1.ENTIRE_DIFF_OVERVIEW_WIDTH-2*OverviewRulerFeature_1.ONE_OVERVIEW_WIDTH;C.setLayout({top:0,height:x,right:D+OverviewRulerFeature_1.ONE_OVERVIEW_WIDTH,width:OverviewRulerFeature_1.ONE_OVERVIEW_WIDTH}),b.setLayout({top:0,height:x,right:0,width:OverviewRulerFeature_1.ONE_OVERVIEW_WIDTH});const k=this._editors.modifiedScrollTop.read(L),N=this._editors.modifiedScrollHeight.read(L),R=this._editors.modified.getOption(117),M=new ScrollbarState(R.verticalHasArrows?R.arrowSize:0,R.verticalScrollbarSize,0,I.height,N,k);g.setTop(M.getSliderPosition()),g.setHeight(M.getSliderSize())}else g.setTop(0),g.setHeight(0);f.style.height=x+"px",f.style.left=E-OverviewRulerFeature_1.ENTIRE_DIFF_OVERVIEW_WIDTH+"px",g.setWidth(OverviewRulerFeature_1.ENTIRE_DIFF_OVERVIEW_WIDTH)}))}))}},OverviewRulerFeature_1=lt,lt.ONE_OVERVIEW_WIDTH=15,lt.ENTIRE_DIFF_OVERVIEW_WIDTH=lt.ONE_OVERVIEW_WIDTH*2,lt);OverviewRulerFeature=OverviewRulerFeature_1=__decorate$2t([__param$2q(6,IThemeService)],OverviewRulerFeature);var __decorate$2s=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2p=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let DiffEditorEditors=class extends Disposable{get onDidContentSizeChange(){return this._onDidContentSizeChange.event}constructor(e,t,s,o,r,l,c,d){super(),this.originalEditorElement=e,this.modifiedEditorElement=t,this._options=s,this._argCodeEditorWidgetOptions=o,this._createInnerEditor=r,this._contextKeyService=l,this._instantiationService=c,this._keybindingService=d,this.original=this._register(this._createLeftHandSideEditor(this._options.editorOptions.get(),this._argCodeEditorWidgetOptions.originalEditor||{})),this.modified=this._register(this._createRightHandSideEditor(this._options.editorOptions.get(),this._argCodeEditorWidgetOptions.modifiedEditor||{})),this._onDidContentSizeChange=this._register(new Emitter$1),this.modifiedScrollTop=observableFromEvent(this,this.modified.onDidScrollChange,()=>this.modified.getScrollTop()),this.modifiedScrollHeight=observableFromEvent(this,this.modified.onDidScrollChange,()=>this.modified.getScrollHeight()),this.modifiedObs=observableCodeEditor(this.modified),this.originalObs=observableCodeEditor(this.original),this.modifiedModel=this.modifiedObs.model,this.modifiedSelections=observableFromEvent(this,this.modified.onDidChangeCursorSelection,()=>this.modified.getSelections()??[]),this.modifiedCursor=derivedOpts({owner:this,equalsFn:Position$1.equals},u=>{var g;return((g=this.modifiedSelections.read(u)[0])==null?void 0:g.getPosition())??new Position$1(1,1)}),this.originalCursor=observableFromEvent(this,this.original.onDidChangeCursorPosition,()=>this.original.getPosition()??new Position$1(1,1)),this.isOriginalFocused=observableCodeEditor(this.original).isFocused,this.isModifiedFocused=observableCodeEditor(this.modified).isFocused,this.isFocused=derived(this,u=>this.isOriginalFocused.read(u)||this.isModifiedFocused.read(u)),this._argCodeEditorWidgetOptions=null,this._register(autorunHandleChanges({changeTracker:{createChangeSummary:()=>({}),handleChange:(u,g)=>(u.didChange(s.editorOptions)&&Object.assign(g,u.change.changedOptions),!0)}},(u,g)=>{s.editorOptions.read(u),this._options.renderSideBySide.read(u),this.modified.updateOptions(this._adjustOptionsForRightHandSide(u,g)),this.original.updateOptions(this._adjustOptionsForLeftHandSide(u,g))}))}_createLeftHandSideEditor(e,t){const s=this._adjustOptionsForLeftHandSide(void 0,e),o=this._constructInnerEditor(this._instantiationService,this.originalEditorElement,s,t),r=this._contextKeyService.createKey("isInDiffLeftEditor",o.hasWidgetFocus());return this._register(o.onDidFocusEditorWidget(()=>r.set(!0))),this._register(o.onDidBlurEditorWidget(()=>r.set(!1))),o}_createRightHandSideEditor(e,t){const s=this._adjustOptionsForRightHandSide(void 0,e),o=this._constructInnerEditor(this._instantiationService,this.modifiedEditorElement,s,t),r=this._contextKeyService.createKey("isInDiffRightEditor",o.hasWidgetFocus());return this._register(o.onDidFocusEditorWidget(()=>r.set(!0))),this._register(o.onDidBlurEditorWidget(()=>r.set(!1))),o}_constructInnerEditor(e,t,s,o){const r=this._createInnerEditor(e,t,s,o);return this._register(r.onDidContentSizeChange(l=>{const c=this.original.getContentWidth()+this.modified.getContentWidth()+OverviewRulerFeature.ENTIRE_DIFF_OVERVIEW_WIDTH,d=Math.max(this.modified.getContentHeight(),this.original.getContentHeight());this._onDidContentSizeChange.fire({contentHeight:d,contentWidth:c,contentHeightChanged:l.contentHeightChanged,contentWidthChanged:l.contentWidthChanged})})),r}_adjustOptionsForLeftHandSide(e,t){const s=this._adjustOptionsForSubEditor(t);return this._options.renderSideBySide.get()?(s.unicodeHighlight=this._options.editorOptions.get().unicodeHighlight||{},s.wordWrapOverride1=this._options.diffWordWrap.get()):(s.wordWrapOverride1="off",s.wordWrapOverride2="off",s.stickyScroll={enabled:!1},s.unicodeHighlight={nonBasicASCII:!1,ambiguousCharacters:!1,invisibleCharacters:!1}),s.glyphMargin=this._options.renderSideBySide.get(),t.originalAriaLabel&&(s.ariaLabel=t.originalAriaLabel),s.ariaLabel=this._updateAriaLabel(s.ariaLabel),s.readOnly=!this._options.originalEditable.get(),s.dropIntoEditor={enabled:!s.readOnly},s.extraEditorClassName="original-in-monaco-diff-editor",s}_adjustOptionsForRightHandSide(e,t){const s=this._adjustOptionsForSubEditor(t);return t.modifiedAriaLabel&&(s.ariaLabel=t.modifiedAriaLabel),s.ariaLabel=this._updateAriaLabel(s.ariaLabel),s.wordWrapOverride1=this._options.diffWordWrap.get(),s.revealHorizontalRightPadding=EditorOptions.revealHorizontalRightPadding.defaultValue+OverviewRulerFeature.ENTIRE_DIFF_OVERVIEW_WIDTH,s.scrollbar.verticalHasArrows=!1,s.extraEditorClassName="modified-in-monaco-diff-editor",s}_adjustOptionsForSubEditor(e){const t={...e,dimension:{height:0,width:0}};return t.inDiffEditor=!0,t.automaticLayout=!1,t.allowVariableLineHeights=!1,t.allowVariableFonts=!1,t.allowVariableFontsInAccessibilityMode=!1,t.scrollbar={...t.scrollbar||{}},t.folding=!1,t.codeLens=this._options.diffCodeLens.get(),t.fixedOverflowWidgets=!0,t.minimap={...t.minimap||{}},t.minimap.enabled=!1,this._options.hideUnchangedRegions.get()?t.stickyScroll={enabled:!1}:t.stickyScroll=this._options.editorOptions.get().stickyScroll,t}_updateAriaLabel(e){var s;e||(e="");const t=localize(108," use {0} to open the accessibility help.",(s=this._keybindingService.lookupKeybinding("editor.action.accessibilityHelp"))==null?void 0:s.getAriaLabel());return this._options.accessibilityVerbose.get()?e+t:e?e.replaceAll(t,""):""}};DiffEditorEditors=__decorate$2s([__param$2p(5,IContextKeyService),__param$2p(6,IInstantiationService),__param$2p(7,IKeybindingService)],DiffEditorEditors);const sash="";var __decorate$2r=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};const DEBUG=!1;var OrthogonalEdge;(function(a){a.North="north",a.South="south",a.East="east",a.West="west"})(OrthogonalEdge||(OrthogonalEdge={}));let globalSize=4;const onDidChangeGlobalSize=new Emitter$1;let globalHoverDelay=300;const onDidChangeHoverDelay=new Emitter$1;class MouseEventFactory{constructor(e){this.el=e,this.disposables=new DisposableStore}get onPointerMove(){return this.disposables.add(new DomEmitter(getWindow(this.el),"mousemove")).event}get onPointerUp(){return this.disposables.add(new DomEmitter(getWindow(this.el),"mouseup")).event}dispose(){this.disposables.dispose()}}__decorate$2r([memoize],MouseEventFactory.prototype,"onPointerMove",null);__decorate$2r([memoize],MouseEventFactory.prototype,"onPointerUp",null);class GestureEventFactory{get onPointerMove(){return this.disposables.add(new DomEmitter(this.el,EventType.Change)).event}get onPointerUp(){return this.disposables.add(new DomEmitter(this.el,EventType.End)).event}constructor(e){this.el=e,this.disposables=new DisposableStore}dispose(){this.disposables.dispose()}}__decorate$2r([memoize],GestureEventFactory.prototype,"onPointerMove",null);__decorate$2r([memoize],GestureEventFactory.prototype,"onPointerUp",null);class OrthogonalPointerEventFactory{get onPointerMove(){return this.factory.onPointerMove}get onPointerUp(){return this.factory.onPointerUp}constructor(e){this.factory=e}dispose(){}}__decorate$2r([memoize],OrthogonalPointerEventFactory.prototype,"onPointerMove",null);__decorate$2r([memoize],OrthogonalPointerEventFactory.prototype,"onPointerUp",null);const PointerEventsDisabledCssClass="pointer-events-disabled";class Sash extends Disposable{get state(){return this._state}get orthogonalStartSash(){return this._orthogonalStartSash}get orthogonalEndSash(){return this._orthogonalEndSash}set state(e){this._state!==e&&(this.el.classList.toggle("disabled",e===0),this.el.classList.toggle("minimum",e===1),this.el.classList.toggle("maximum",e===2),this._state=e,this.onDidEnablementChange.fire(e))}get onDidStart(){return this._onDidStart.event}get onDidChange(){return this._onDidChange.event}get onDidReset(){return this._onDidReset.event}get onDidEnd(){return this._onDidEnd.event}set orthogonalStartSash(e){if(this._orthogonalStartSash!==e){if(this.orthogonalStartDragHandleDisposables.clear(),this.orthogonalStartSashDisposables.clear(),e){const t=s=>{this.orthogonalStartDragHandleDisposables.clear(),s!==0&&(this._orthogonalStartDragHandle=append$2(this.el,$$l(".orthogonal-drag-handle.start")),this.orthogonalStartDragHandleDisposables.add(toDisposable(()=>this._orthogonalStartDragHandle.remove())),this.orthogonalStartDragHandleDisposables.add(addDisposableListener(this._orthogonalStartDragHandle,"mouseenter",()=>Sash.onMouseEnter(e))),this.orthogonalStartDragHandleDisposables.add(addDisposableListener(this._orthogonalStartDragHandle,"mouseleave",()=>Sash.onMouseLeave(e))))};this.orthogonalStartSashDisposables.add(e.onDidEnablementChange.event(t,this)),t(e.state)}this._orthogonalStartSash=e}}set orthogonalEndSash(e){if(this._orthogonalEndSash!==e){if(this.orthogonalEndDragHandleDisposables.clear(),this.orthogonalEndSashDisposables.clear(),e){const t=s=>{this.orthogonalEndDragHandleDisposables.clear(),s!==0&&(this._orthogonalEndDragHandle=append$2(this.el,$$l(".orthogonal-drag-handle.end")),this.orthogonalEndDragHandleDisposables.add(toDisposable(()=>this._orthogonalEndDragHandle.remove())),this.orthogonalEndDragHandleDisposables.add(addDisposableListener(this._orthogonalEndDragHandle,"mouseenter",()=>Sash.onMouseEnter(e))),this.orthogonalEndDragHandleDisposables.add(addDisposableListener(this._orthogonalEndDragHandle,"mouseleave",()=>Sash.onMouseLeave(e))))};this.orthogonalEndSashDisposables.add(e.onDidEnablementChange.event(t,this)),t(e.state)}this._orthogonalEndSash=e}}constructor(e,t,s){super(),this.hoverDelay=globalHoverDelay,this.hoverDelayer=this._register(new Delayer(this.hoverDelay)),this._state=3,this.onDidEnablementChange=this._register(new Emitter$1),this._onDidStart=this._register(new Emitter$1),this._onDidChange=this._register(new Emitter$1),this._onDidReset=this._register(new Emitter$1),this._onDidEnd=this._register(new Emitter$1),this.orthogonalStartSashDisposables=this._register(new DisposableStore),this.orthogonalStartDragHandleDisposables=this._register(new DisposableStore),this.orthogonalEndSashDisposables=this._register(new DisposableStore),this.orthogonalEndDragHandleDisposables=this._register(new DisposableStore),this.linkedSash=void 0,this.el=append$2(e,$$l(".monaco-sash")),s.orthogonalEdge&&this.el.classList.add(`orthogonal-edge-${s.orthogonalEdge}`),isMacintosh&&this.el.classList.add("mac"),this._register(addDisposableListener(this.el,"mousedown",r=>this.onPointerStart(r,new MouseEventFactory(e)))),this._register(addDisposableListener(this.el,"dblclick",r=>this.onPointerDoublePress(r))),this._register(addDisposableListener(this.el,"mouseenter",()=>Sash.onMouseEnter(this))),this._register(addDisposableListener(this.el,"mouseleave",()=>Sash.onMouseLeave(this))),this._register(Gesture.addTarget(this.el)),this._register(addDisposableListener(this.el,EventType.Start,r=>this.onPointerStart(r,new GestureEventFactory(this.el))));let o;this._register(addDisposableListener(this.el,EventType.Tap,r=>{if(o){clearTimeout(o),o=void 0,this.onPointerDoublePress(r);return}clearTimeout(o),o=setTimeout(()=>o=void 0,250)})),typeof s.size=="number"?(this.size=s.size,s.orientation===0?this.el.style.width=`${this.size}px`:this.el.style.height=`${this.size}px`):(this.size=globalSize,this._register(onDidChangeGlobalSize.event(r=>{this.size=r,this.layout()}))),this._register(onDidChangeHoverDelay.event(r=>this.hoverDelay=r)),this.layoutProvider=t,this.orthogonalStartSash=s.orthogonalStartSash,this.orthogonalEndSash=s.orthogonalEndSash,this.orientation=s.orientation||0,this.orientation===1?(this.el.classList.add("horizontal"),this.el.classList.remove("vertical")):(this.el.classList.remove("horizontal"),this.el.classList.add("vertical")),this.el.classList.toggle("debug",DEBUG),this.layout()}onPointerStart(e,t){EventHelper.stop(e);let s=!1;if(!e.__orthogonalSashEvent){const _=this.getOrthogonalSash(e);_&&(s=!0,e.__orthogonalSashEvent=!0,_.onPointerStart(e,new OrthogonalPointerEventFactory(t)))}if(this.linkedSash&&!e.__linkedSashEvent&&(e.__linkedSashEvent=!0,this.linkedSash.onPointerStart(e,new OrthogonalPointerEventFactory(t))),!this.state)return;const o=this.el.ownerDocument.getElementsByTagName("iframe");for(const _ of o)_.classList.add(PointerEventsDisabledCssClass);const r=e.pageX,l=e.pageY,c=e.altKey,d={startX:r,currentX:r,startY:l,currentY:l,altKey:c};this.el.classList.add("active"),this._onDidStart.fire(d);const u=createStyleSheet(this.el),g=()=>{let _="";s?_="all-scroll":this.orientation===1?this.state===1?_="s-resize":this.state===2?_="n-resize":_=isMacintosh?"row-resize":"ns-resize":this.state===1?_="e-resize":this.state===2?_="w-resize":_=isMacintosh?"col-resize":"ew-resize",u.textContent=`* { cursor: ${_} !important; }`},f=new DisposableStore;g(),s||this.onDidEnablementChange.event(g,null,f);const p=_=>{EventHelper.stop(_,!1);const C={startX:r,currentX:_.pageX,startY:l,currentY:_.pageY,altKey:c};this._onDidChange.fire(C)},m=_=>{EventHelper.stop(_,!1),u.remove(),this.el.classList.remove("active"),this._onDidEnd.fire(),f.dispose();for(const C of o)C.classList.remove(PointerEventsDisabledCssClass)};t.onPointerMove(p,null,f),t.onPointerUp(m,null,f),f.add(t)}onPointerDoublePress(e){const t=this.getOrthogonalSash(e);t&&t._onDidReset.fire(),this.linkedSash&&this.linkedSash._onDidReset.fire(),this._onDidReset.fire()}static onMouseEnter(e,t=!1){e.el.classList.contains("active")?(e.hoverDelayer.cancel(),e.el.classList.add("hover")):e.hoverDelayer.trigger(()=>e.el.classList.add("hover"),e.hoverDelay).then(void 0,()=>{}),!t&&e.linkedSash&&Sash.onMouseEnter(e.linkedSash,!0)}static onMouseLeave(e,t=!1){e.hoverDelayer.cancel(),e.el.classList.remove("hover"),!t&&e.linkedSash&&Sash.onMouseLeave(e.linkedSash,!0)}clearSashHoverState(){Sash.onMouseLeave(this)}layout(){if(this.orientation===0){const e=this.layoutProvider;this.el.style.left=e.getVerticalSashLeft(this)-this.size/2+"px",e.getVerticalSashTop&&(this.el.style.top=e.getVerticalSashTop(this)+"px"),e.getVerticalSashHeight&&(this.el.style.height=e.getVerticalSashHeight(this)+"px")}else{const e=this.layoutProvider;this.el.style.top=e.getHorizontalSashTop(this)-this.size/2+"px",e.getHorizontalSashLeft&&(this.el.style.left=e.getHorizontalSashLeft(this)+"px"),e.getHorizontalSashWidth&&(this.el.style.width=e.getHorizontalSashWidth(this)+"px")}}getOrthogonalSash(e){const t=e.initialTarget??e.target;if(!(!t||!isHTMLElement(t))&&t.classList.contains("orthogonal-drag-handle"))return t.classList.contains("start")?this.orthogonalStartSash:this.orthogonalEndSash}dispose(){super.dispose(),this.el.remove()}}class SashLayout{resetSash(){this._sashRatio.set(void 0,void 0)}constructor(e,t){this._options=e,this.dimensions=t,this.sashLeft=derivedWithSetter(this,s=>{const o=this._sashRatio.read(s)??this._options.splitViewDefaultRatio.read(s);return this._computeSashLeft(o,s)},(s,o)=>{const r=this.dimensions.width.get();this._sashRatio.set(s/r,o)}),this._sashRatio=observableValue(this,void 0)}_computeSashLeft(e,t){const s=this.dimensions.width.read(t),o=Math.floor(this._options.splitViewDefaultRatio.read(t)*s),r=this._options.enableSplitViewResizing.read(t)?Math.floor(e*s):o,l=100;return s<=l*2?o:r<l?l:r>s-l?s-l:r}}class DiffEditorSash extends Disposable{constructor(e,t,s,o,r,l){super(),this._domNode=e,this._dimensions=t,this._enabled=s,this._boundarySashes=o,this.sashLeft=r,this._resetSash=l,this._sash=this._register(new Sash(this._domNode,{getVerticalSashTop:c=>0,getVerticalSashLeft:c=>this.sashLeft.get(),getVerticalSashHeight:c=>this._dimensions.height.get()},{orientation:0})),this._startSashPosition=void 0,this._register(this._sash.onDidStart(()=>{this._startSashPosition=this.sashLeft.get()})),this._register(this._sash.onDidChange(c=>{this.sashLeft.set(this._startSashPosition+(c.currentX-c.startX),void 0)})),this._register(this._sash.onDidEnd(()=>this._sash.layout())),this._register(this._sash.onDidReset(()=>this._resetSash())),this._register(autorun(c=>{const d=this._boundarySashes.read(c);d&&(this._sash.orthogonalEndSash=d.bottom)})),this._register(autorun(c=>{const d=this._enabled.read(c);this._sash.state=d?3:0,this.sashLeft.read(c),this._dimensions.height.read(c),this._sash.layout()}))}}const ws=class ws extends Disposable{constructor(){super(...arguments),this._id=++ws.idCounter,this._onDidDispose=this._register(new Emitter$1),this.onDidDispose=this._onDidDispose.event}getId(){return this.getEditorType()+":v2:"+this._id}getVisibleColumnFromPosition(e){return this._targetEditor.getVisibleColumnFromPosition(e)}getPosition(){return this._targetEditor.getPosition()}setPosition(e,t="api"){this._targetEditor.setPosition(e,t)}revealLine(e,t=0){this._targetEditor.revealLine(e,t)}revealLineInCenter(e,t=0){this._targetEditor.revealLineInCenter(e,t)}revealLineInCenterIfOutsideViewport(e,t=0){this._targetEditor.revealLineInCenterIfOutsideViewport(e,t)}revealLineNearTop(e,t=0){this._targetEditor.revealLineNearTop(e,t)}revealPosition(e,t=0){this._targetEditor.revealPosition(e,t)}revealPositionInCenter(e,t=0){this._targetEditor.revealPositionInCenter(e,t)}revealPositionInCenterIfOutsideViewport(e,t=0){this._targetEditor.revealPositionInCenterIfOutsideViewport(e,t)}revealPositionNearTop(e,t=0){this._targetEditor.revealPositionNearTop(e,t)}getSelection(){return this._targetEditor.getSelection()}getSelections(){return this._targetEditor.getSelections()}setSelection(e,t="api"){this._targetEditor.setSelection(e,t)}setSelections(e,t="api"){this._targetEditor.setSelections(e,t)}revealLines(e,t,s=0){this._targetEditor.revealLines(e,t,s)}revealLinesInCenter(e,t,s=0){this._targetEditor.revealLinesInCenter(e,t,s)}revealLinesInCenterIfOutsideViewport(e,t,s=0){this._targetEditor.revealLinesInCenterIfOutsideViewport(e,t,s)}revealLinesNearTop(e,t,s=0){this._targetEditor.revealLinesNearTop(e,t,s)}revealRange(e,t=0,s=!1,o=!0){this._targetEditor.revealRange(e,t,s,o)}revealRangeInCenter(e,t=0){this._targetEditor.revealRangeInCenter(e,t)}revealRangeInCenterIfOutsideViewport(e,t=0){this._targetEditor.revealRangeInCenterIfOutsideViewport(e,t)}revealRangeNearTop(e,t=0){this._targetEditor.revealRangeNearTop(e,t)}revealRangeNearTopIfOutsideViewport(e,t=0){this._targetEditor.revealRangeNearTopIfOutsideViewport(e,t)}revealRangeAtTop(e,t=0){this._targetEditor.revealRangeAtTop(e,t)}getSupportedActions(){return this._targetEditor.getSupportedActions()}focus(){this._targetEditor.focus()}trigger(e,t,s){this._targetEditor.trigger(e,t,s)}createDecorationsCollection(e){return this._targetEditor.createDecorationsCollection(e)}changeDecorations(e){return this._targetEditor.changeDecorations(e)}};ws.idCounter=0;let DelegatingEditor=ws;const diffEditorDefaultOptions={enableSplitViewResizing:!0,splitViewDefaultRatio:.5,renderSideBySide:!0,renderMarginRevertIcon:!0,renderGutterMenu:!0,maxComputationTime:5e3,maxFileSize:50,ignoreTrimWhitespace:!0,renderIndicators:!0,originalEditable:!1,diffCodeLens:!1,renderOverviewRuler:!0,diffWordWrap:"inherit",diffAlgorithm:"advanced",accessibilityVerbose:!1,experimental:{showMoves:!1,showEmptyDecorations:!0,useTrueInlineView:!1},hideUnchangedRegions:{enabled:!1,contextLineCount:3,minimumLineCount:3,revealLineCount:20},isInEmbeddedEditor:!1,onlyShowAccessibleDiffViewer:!1,renderSideBySideInlineBreakpoint:900,useInlineViewWhenSpaceIsLimited:!0,compactMode:!1};var __decorate$2q=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2o=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let DiffEditorOptions=class{get editorOptions(){return this._options}constructor(e,t){this._accessibilityService=t,this._diffEditorWidth=observableValue(this,0),this._screenReaderMode=observableFromEvent(this,this._accessibilityService.onDidChangeScreenReaderOptimized,()=>this._accessibilityService.isScreenReaderOptimized()),this.couldShowInlineViewBecauseOfSize=derived(this,o=>this._options.read(o).renderSideBySide&&this._diffEditorWidth.read(o)<=this._options.read(o).renderSideBySideInlineBreakpoint),this.renderOverviewRuler=derived(this,o=>this._options.read(o).renderOverviewRuler),this.renderSideBySide=derived(this,o=>this.compactMode.read(o)&&this.shouldRenderInlineViewInSmartMode.read(o)?!1:this._options.read(o).renderSideBySide&&!(this._options.read(o).useInlineViewWhenSpaceIsLimited&&this.couldShowInlineViewBecauseOfSize.read(o)&&!this._screenReaderMode.read(o))),this.readOnly=derived(this,o=>this._options.read(o).readOnly),this.shouldRenderOldRevertArrows=derived(this,o=>!(!this._options.read(o).renderMarginRevertIcon||!this.renderSideBySide.read(o)||this.readOnly.read(o)||this.shouldRenderGutterMenu.read(o))),this.shouldRenderGutterMenu=derived(this,o=>this._options.read(o).renderGutterMenu),this.renderIndicators=derived(this,o=>this._options.read(o).renderIndicators),this.enableSplitViewResizing=derived(this,o=>this._options.read(o).enableSplitViewResizing),this.splitViewDefaultRatio=derived(this,o=>this._options.read(o).splitViewDefaultRatio),this.ignoreTrimWhitespace=derived(this,o=>this._options.read(o).ignoreTrimWhitespace),this.maxComputationTimeMs=derived(this,o=>this._options.read(o).maxComputationTime),this.showMoves=derived(this,o=>this._options.read(o).experimental.showMoves&&this.renderSideBySide.read(o)),this.isInEmbeddedEditor=derived(this,o=>this._options.read(o).isInEmbeddedEditor),this.diffWordWrap=derived(this,o=>this._options.read(o).diffWordWrap),this.originalEditable=derived(this,o=>this._options.read(o).originalEditable),this.diffCodeLens=derived(this,o=>this._options.read(o).diffCodeLens),this.accessibilityVerbose=derived(this,o=>this._options.read(o).accessibilityVerbose),this.diffAlgorithm=derived(this,o=>this._options.read(o).diffAlgorithm),this.showEmptyDecorations=derived(this,o=>this._options.read(o).experimental.showEmptyDecorations),this.onlyShowAccessibleDiffViewer=derived(this,o=>this._options.read(o).onlyShowAccessibleDiffViewer),this.compactMode=derived(this,o=>this._options.read(o).compactMode),this.trueInlineDiffRenderingEnabled=derived(this,o=>this._options.read(o).experimental.useTrueInlineView),this.useTrueInlineDiffRendering=derived(this,o=>!this.renderSideBySide.read(o)&&this.trueInlineDiffRenderingEnabled.read(o)),this.hideUnchangedRegions=derived(this,o=>this._options.read(o).hideUnchangedRegions.enabled),this.hideUnchangedRegionsRevealLineCount=derived(this,o=>this._options.read(o).hideUnchangedRegions.revealLineCount),this.hideUnchangedRegionsContextLineCount=derived(this,o=>this._options.read(o).hideUnchangedRegions.contextLineCount),this.hideUnchangedRegionsMinimumLineCount=derived(this,o=>this._options.read(o).hideUnchangedRegions.minimumLineCount),this._model=observableValue(this,void 0),this.shouldRenderInlineViewInSmartMode=this._model.map(this,o=>derivedConstOnceDefined(this,r=>{const l=o==null?void 0:o.diff.read(r);return l?isSimpleDiff(l,this.trueInlineDiffRenderingEnabled.read(r)):void 0})).flatten().map(this,o=>!!o),this.inlineViewHideOriginalLineNumbers=this.compactMode;const s={...e,...validateDiffEditorOptions(e,diffEditorDefaultOptions)};this._options=observableValue(this,s)}updateOptions(e){const t=validateDiffEditorOptions(e,this._options.get()),s={...this._options.get(),...e,...t};this._options.set(s,void 0,{changedOptions:e})}setWidth(e){this._diffEditorWidth.set(e,void 0)}setModel(e){this._model.set(e,void 0)}};DiffEditorOptions=__decorate$2q([__param$2o(1,IAccessibilityService)],DiffEditorOptions);function isSimpleDiff(a,e){return a.mappings.every(t=>isInsertion(t.lineRangeMapping)||isDeletion$1(t.lineRangeMapping)||e&&allowsTrueInlineDiffRendering$1(t.lineRangeMapping))}function isInsertion(a){return a.original.length===0}function isDeletion$1(a){return a.modified.length===0}function validateDiffEditorOptions(a,e){var t,s,o,r,l,c,d,u;return{enableSplitViewResizing:boolean(a.enableSplitViewResizing,e.enableSplitViewResizing),splitViewDefaultRatio:clampedFloat(a.splitViewDefaultRatio,.5,.1,.9),renderSideBySide:boolean(a.renderSideBySide,e.renderSideBySide),renderMarginRevertIcon:boolean(a.renderMarginRevertIcon,e.renderMarginRevertIcon),maxComputationTime:clampedInt(a.maxComputationTime,e.maxComputationTime,0,1073741824),maxFileSize:clampedInt(a.maxFileSize,e.maxFileSize,0,1073741824),ignoreTrimWhitespace:boolean(a.ignoreTrimWhitespace,e.ignoreTrimWhitespace),renderIndicators:boolean(a.renderIndicators,e.renderIndicators),originalEditable:boolean(a.originalEditable,e.originalEditable),diffCodeLens:boolean(a.diffCodeLens,e.diffCodeLens),renderOverviewRuler:boolean(a.renderOverviewRuler,e.renderOverviewRuler),diffWordWrap:stringSet(a.diffWordWrap,e.diffWordWrap,["off","on","inherit"]),diffAlgorithm:stringSet(a.diffAlgorithm,e.diffAlgorithm,["legacy","advanced"],{smart:"legacy",experimental:"advanced"}),accessibilityVerbose:boolean(a.accessibilityVerbose,e.accessibilityVerbose),experimental:{showMoves:boolean((t=a.experimental)==null?void 0:t.showMoves,e.experimental.showMoves),showEmptyDecorations:boolean((s=a.experimental)==null?void 0:s.showEmptyDecorations,e.experimental.showEmptyDecorations),useTrueInlineView:boolean((o=a.experimental)==null?void 0:o.useTrueInlineView,e.experimental.useTrueInlineView)},hideUnchangedRegions:{enabled:boolean(((r=a.hideUnchangedRegions)==null?void 0:r.enabled)??((l=a.experimental)==null?void 0:l.collapseUnchangedRegions),e.hideUnchangedRegions.enabled),contextLineCount:clampedInt((c=a.hideUnchangedRegions)==null?void 0:c.contextLineCount,e.hideUnchangedRegions.contextLineCount,0,1073741824),minimumLineCount:clampedInt((d=a.hideUnchangedRegions)==null?void 0:d.minimumLineCount,e.hideUnchangedRegions.minimumLineCount,0,1073741824),revealLineCount:clampedInt((u=a.hideUnchangedRegions)==null?void 0:u.revealLineCount,e.hideUnchangedRegions.revealLineCount,0,1073741824)},isInEmbeddedEditor:boolean(a.isInEmbeddedEditor,e.isInEmbeddedEditor),onlyShowAccessibleDiffViewer:boolean(a.onlyShowAccessibleDiffViewer,e.onlyShowAccessibleDiffViewer),renderSideBySideInlineBreakpoint:clampedInt(a.renderSideBySideInlineBreakpoint,e.renderSideBySideInlineBreakpoint,0,1073741824),useInlineViewWhenSpaceIsLimited:boolean(a.useInlineViewWhenSpaceIsLimited,e.useInlineViewWhenSpaceIsLimited),renderGutterMenu:boolean(a.renderGutterMenu,e.renderGutterMenu),compactMode:boolean(a.compactMode,e.compactMode)}}const dropdown="";class BaseDropdown extends ActionRunner{constructor(e,t){super(),this._onDidChangeVisibility=this._register(new Emitter$1),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this._element=append$2(e,$$l(".monaco-dropdown")),this._label=append$2(this._element,$$l(".dropdown-label"));let s=t.labelRenderer;s||(s=r=>(r.textContent=t.label||"",null));for(const r of[EventType$1.CLICK,EventType$1.MOUSE_DOWN,EventType.Tap])this._register(addDisposableListener(this.element,r,l=>EventHelper.stop(l,!0)));for(const r of[EventType$1.MOUSE_DOWN,EventType.Tap])this._register(addDisposableListener(this._label,r,l=>{isMouseEvent(l)&&l.button!==0||(this.visible?this.hide():this.show())}));this._register(addDisposableListener(this._label,EventType$1.KEY_DOWN,r=>{const l=new StandardKeyboardEvent(r);(l.equals(3)||l.equals(10))&&(EventHelper.stop(r,!0),this.visible?this.hide():this.show())}));const o=s(this._label);o&&this._register(o),this._register(Gesture.addTarget(this._label))}get element(){return this._element}show(){this.visible||(this.visible=!0,this._onDidChangeVisibility.fire(!0))}hide(){this.visible&&(this.visible=!1,this._onDidChangeVisibility.fire(!1))}dispose(){super.dispose(),this.hide(),this.boxContainer&&(this.boxContainer.remove(),this.boxContainer=void 0),this.contents&&(this.contents.remove(),this.contents=void 0),this._label&&(this._label.remove(),this._label=void 0)}}class DropdownMenu extends BaseDropdown{constructor(e,t){super(e,t),this._options=t,this._actions=[],this.actions=t.actions||[]}set menuOptions(e){this._menuOptions=e}get menuOptions(){return this._menuOptions}get actions(){return this._options.actionProvider?this._options.actionProvider.getActions():this._actions}set actions(e){this._actions=e}show(){super.show(),this.element.classList.add("active"),this._options.contextMenuProvider.showContextMenu({getAnchor:()=>this.element,getActions:()=>this.actions,getActionsContext:()=>this.menuOptions?this.menuOptions.context:null,getActionViewItem:(e,t)=>this.menuOptions&&this.menuOptions.actionViewItemProvider?this.menuOptions.actionViewItemProvider(e,t):void 0,getKeyBinding:e=>this.menuOptions&&this.menuOptions.getKeyBinding?this.menuOptions.getKeyBinding(e):void 0,getMenuClassName:()=>this._options.menuClassName||"",onHide:()=>this.onHide(),actionRunner:this.menuOptions?this.menuOptions.actionRunner:void 0,anchorAlignment:this.menuOptions?this.menuOptions.anchorAlignment:0,domForShadowRoot:this._options.menuAsChild?this.element:void 0,skipTelemetry:this._options.skipTelemetry})}hide(){super.hide()}onHide(){this.hide(),this.element.classList.remove("active")}}class DropdownMenuActionViewItem extends BaseActionViewItem{get onDidChangeVisibility(){return this._onDidChangeVisibility.event}constructor(e,t,s,o=Object.create(null)){super(null,e,o),this.actionItem=null,this._onDidChangeVisibility=this._register(new Emitter$1),this.menuActionsOrProvider=t,this.contextMenuProvider=s,this.options=o,this.options.actionRunner&&(this.actionRunner=this.options.actionRunner)}render(e){this.actionItem=e;const t=r=>(this.element=append$2(r,$$l("a.action-label")),this.renderLabel(this.element)),s=Array.isArray(this.menuActionsOrProvider),o={contextMenuProvider:this.contextMenuProvider,labelRenderer:t,menuAsChild:this.options.menuAsChild,actions:s?this.menuActionsOrProvider:void 0,actionProvider:s?void 0:this.menuActionsOrProvider,skipTelemetry:this.options.skipTelemetry};if(this.dropdownMenu=this._register(new DropdownMenu(e,o)),this._register(this.dropdownMenu.onDidChangeVisibility(r=>{var l;(l=this.element)==null||l.setAttribute("aria-expanded",`${r}`),this._onDidChangeVisibility.fire(r)})),this.dropdownMenu.menuOptions={actionViewItemProvider:this.options.actionViewItemProvider,actionRunner:this.actionRunner,getKeyBinding:this.options.keybindingProvider,context:this._context},this.options.anchorAlignmentProvider){const r=this;this.dropdownMenu.menuOptions={...this.dropdownMenu.menuOptions,get anchorAlignment(){return r.options.anchorAlignmentProvider()}}}this.updateTooltip(),this.updateEnabled()}renderLabel(e){let t=[];return typeof this.options.classNames=="string"?t=this.options.classNames.split(/\s+/g).filter(s=>!!s):this.options.classNames&&(t=this.options.classNames),t.find(s=>s==="icon")||t.push("codicon"),e.classList.add(...t),this._action.label&&this._register(getBaseLayerHoverDelegate().setupManagedHover(this.options.hoverDelegate??getDefaultHoverDelegate("mouse"),e,this._action.label)),null}getTooltip(){let e=null;return this.action.tooltip?e=this.action.tooltip:this.action.label&&(e=this.action.label),e??void 0}setActionContext(e){super.setActionContext(e),this.dropdownMenu&&(this.dropdownMenu.menuOptions?this.dropdownMenu.menuOptions.context=e:this.dropdownMenu.menuOptions={context:e})}show(){var e;(e=this.dropdownMenu)==null||e.show()}updateEnabled(){var t,s;const e=!this.action.enabled;(t=this.actionItem)==null||t.classList.toggle("disabled",e),(s=this.element)==null||s.classList.toggle("disabled",e)}}const toolbar="";class ToolBar extends Disposable{get onDidChangeDropdownVisibility(){return this._onDidChangeDropdownVisibility.event}constructor(e,t,s={orientation:0}){super(),this.submenuActionViewItems=[],this.hasSecondaryActions=!1,this._onDidChangeDropdownVisibility=this._register(new EventMultiplexer),this.disposables=this._register(new DisposableStore),s.hoverDelegate=s.hoverDelegate??this._register(createInstantHoverDelegate()),this.options=s,this.toggleMenuAction=this._register(new ToggleMenuAction(()=>{var o;return(o=this.toggleMenuActionViewItem)==null?void 0:o.show()},s.toggleMenuTitle)),this.element=document.createElement("div"),this.element.className="monaco-toolbar",e.appendChild(this.element),this.actionBar=this._register(new ActionBar(this.element,{orientation:s.orientation,ariaLabel:s.ariaLabel,actionRunner:s.actionRunner,allowContextMenu:s.allowContextMenu,highlightToggledItems:s.highlightToggledItems,hoverDelegate:s.hoverDelegate,actionViewItemProvider:(o,r)=>{if(o.id===ToggleMenuAction.ID)return this.toggleMenuActionViewItem=new DropdownMenuActionViewItem(o,o.menuActions,t,{actionViewItemProvider:this.options.actionViewItemProvider,actionRunner:this.actionRunner,keybindingProvider:this.options.getKeyBinding,classNames:ThemeIcon.asClassNameArray(s.moreIcon??Codicon.toolBarMore),anchorAlignmentProvider:this.options.anchorAlignmentProvider,menuAsChild:!!this.options.renderDropdownAsChildElement,skipTelemetry:this.options.skipTelemetry,isMenu:!0,hoverDelegate:this.options.hoverDelegate}),this.toggleMenuActionViewItem.setActionContext(this.actionBar.context),this.disposables.add(this._onDidChangeDropdownVisibility.add(this.toggleMenuActionViewItem.onDidChangeVisibility)),this.toggleMenuActionViewItem;if(s.actionViewItemProvider){const l=s.actionViewItemProvider(o,r);if(l)return l}if(o instanceof SubmenuAction){const l=new DropdownMenuActionViewItem(o,o.actions,t,{actionViewItemProvider:this.options.actionViewItemProvider,actionRunner:this.actionRunner,keybindingProvider:this.options.getKeyBinding,classNames:o.class,anchorAlignmentProvider:this.options.anchorAlignmentProvider,menuAsChild:!!this.options.renderDropdownAsChildElement,skipTelemetry:this.options.skipTelemetry,hoverDelegate:this.options.hoverDelegate});return l.setActionContext(this.actionBar.context),this.submenuActionViewItems.push(l),this.disposables.add(this._onDidChangeDropdownVisibility.add(l.onDidChangeVisibility)),l}}}))}set actionRunner(e){this.actionBar.actionRunner=e}get actionRunner(){return this.actionBar.actionRunner}set context(e){var t;this.actionBar.context=e,(t=this.toggleMenuActionViewItem)==null||t.setActionContext(e);for(const s of this.submenuActionViewItems)s.setActionContext(e)}getElement(){return this.element}getItemAction(e){return this.actionBar.getAction(e)}setActions(e,t){this.clear();const s=e?e.slice(0):[];this.hasSecondaryActions=!!(t&&t.length>0),this.hasSecondaryActions&&t&&(this.toggleMenuAction.menuActions=t.slice(0),s.push(this.toggleMenuAction)),s.forEach(o=>{this.actionBar.push(o,{icon:this.options.icon??!0,label:this.options.label??!1,keybinding:this.getKeybindingLabel(o)})})}getKeybindingLabel(e){var s,o;const t=(o=(s=this.options).getKeyBinding)==null?void 0:o.call(s,e);return(t==null?void 0:t.getLabel())??void 0}clear(){this.submenuActionViewItems=[],this.disposables.clear(),this.actionBar.clear()}dispose(){this.clear(),this.disposables.dispose(),super.dispose()}}const ys=class ys extends Action{constructor(e,t){t=t||localize(17,"More Actions..."),super(ys.ID,t,void 0,!0),this._menuActions=[],this.toggleDropdownMenu=e}async run(){this.toggleDropdownMenu()}get menuActions(){return this._menuActions}set menuActions(e){this._menuActions=e}};ys.ID="toolbar.toggle.more";let ToggleMenuAction=ys;class ModifierLabelProvider{constructor(e,t,s=t){this.modifierLabels=[null],this.modifierLabels[2]=e,this.modifierLabels[1]=t,this.modifierLabels[3]=s}toLabel(e,t,s){if(t.length===0)return null;const o=[];for(let r=0,l=t.length;r<l;r++){const c=t[r],d=s(c);if(d===null)return null;o[r]=_simpleAsString(c,d,this.modifierLabels[e])}return o.join(" ")}}const UILabelProvider=new ModifierLabelProvider({ctrlKey:"⌃",shiftKey:"⇧",altKey:"⌥",metaKey:"⌘",separator:""},{ctrlKey:localize(35,"Ctrl"),shiftKey:localize(36,"Shift"),altKey:localize(37,"Alt"),metaKey:localize(38,"Windows"),separator:"+"},{ctrlKey:localize(39,"Ctrl"),shiftKey:localize(40,"Shift"),altKey:localize(41,"Alt"),metaKey:localize(42,"Super"),separator:"+"}),AriaLabelProvider=new ModifierLabelProvider({ctrlKey:localize(43,"Control"),shiftKey:localize(44,"Shift"),altKey:localize(45,"Option"),metaKey:localize(46,"Command"),separator:"+"},{ctrlKey:localize(47,"Control"),shiftKey:localize(48,"Shift"),altKey:localize(49,"Alt"),metaKey:localize(50,"Windows"),separator:"+"},{ctrlKey:localize(51,"Control"),shiftKey:localize(52,"Shift"),altKey:localize(53,"Alt"),metaKey:localize(54,"Super"),separator:"+"}),ElectronAcceleratorLabelProvider=new ModifierLabelProvider({ctrlKey:"Ctrl",shiftKey:"Shift",altKey:"Alt",metaKey:"Cmd",separator:"+"},{ctrlKey:"Ctrl",shiftKey:"Shift",altKey:"Alt",metaKey:"Super",separator:"+"}),UserSettingsLabelProvider=new ModifierLabelProvider({ctrlKey:"ctrl",shiftKey:"shift",altKey:"alt",metaKey:"cmd",separator:"+"},{ctrlKey:"ctrl",shiftKey:"shift",altKey:"alt",metaKey:"win",separator:"+"},{ctrlKey:"ctrl",shiftKey:"shift",altKey:"alt",metaKey:"meta",separator:"+"});function _simpleAsString(a,e,t){if(e===null)return"";const s=[];return a.ctrlKey&&s.push(t.ctrlKey),a.shiftKey&&s.push(t.shiftKey),a.altKey&&s.push(t.altKey),a.metaKey&&s.push(t.metaKey),e!==""&&s.push(e),s.join(t.separator)}function isICommandActionToggleInfo(a){return a?a.condition!==void 0:!1}var StorageHint;(function(a){a[a.STORAGE_DOES_NOT_EXIST=0]="STORAGE_DOES_NOT_EXIST",a[a.STORAGE_IN_MEMORY=1]="STORAGE_IN_MEMORY"})(StorageHint||(StorageHint={}));var StorageState;(function(a){a[a.None=0]="None",a[a.Initialized=1]="Initialized",a[a.Closed=2]="Closed"})(StorageState||(StorageState={}));const Ls=class Ls extends Disposable{constructor(e,t=Object.create(null)){super(),this.database=e,this.options=t,this._onDidChangeStorage=this._register(new PauseableEmitter),this.onDidChangeStorage=this._onDidChangeStorage.event,this.state=StorageState.None,this.cache=new Map,this.flushDelayer=this._register(new ThrottledDelayer(Ls.DEFAULT_FLUSH_DELAY)),this.pendingDeletes=new Set,this.pendingInserts=new Map,this.pendingClose=void 0,this.whenFlushedCallbacks=[],this.registerListeners()}registerListeners(){this._register(this.database.onDidChangeItemsExternal(e=>this.onDidChangeItemsExternal(e)))}onDidChangeItemsExternal(e){var t,s;this._onDidChangeStorage.pause();try{(t=e.changed)==null||t.forEach((o,r)=>this.acceptExternal(r,o)),(s=e.deleted)==null||s.forEach(o=>this.acceptExternal(o,void 0))}finally{this._onDidChangeStorage.resume()}}acceptExternal(e,t){if(this.state===StorageState.Closed)return;let s=!1;isUndefinedOrNull(t)?s=this.cache.delete(e):this.cache.get(e)!==t&&(this.cache.set(e,t),s=!0),s&&this._onDidChangeStorage.fire({key:e,external:!0})}get(e,t){const s=this.cache.get(e);return isUndefinedOrNull(s)?t:s}getBoolean(e,t){const s=this.get(e);return isUndefinedOrNull(s)?t:s==="true"}getNumber(e,t){const s=this.get(e);return isUndefinedOrNull(s)?t:parseInt(s,10)}async set(e,t,s=!1){if(this.state===StorageState.Closed)return;if(isUndefinedOrNull(t))return this.delete(e,s);const o=isObject(t)||Array.isArray(t)?stringify(t):String(t);if(this.cache.get(e)!==o)return this.cache.set(e,o),this.pendingInserts.set(e,o),this.pendingDeletes.delete(e),this._onDidChangeStorage.fire({key:e,external:s}),this.doFlush()}async delete(e,t=!1){if(!(this.state===StorageState.Closed||!this.cache.delete(e)))return this.pendingDeletes.has(e)||this.pendingDeletes.add(e),this.pendingInserts.delete(e),this._onDidChangeStorage.fire({key:e,external:t}),this.doFlush()}get hasPending(){return this.pendingInserts.size>0||this.pendingDeletes.size>0}async flushPending(){if(!this.hasPending)return;const e={insert:this.pendingInserts,delete:this.pendingDeletes};return this.pendingDeletes=new Set,this.pendingInserts=new Map,this.database.updateItems(e).finally(()=>{var t;if(!this.hasPending)for(;this.whenFlushedCallbacks.length;)(t=this.whenFlushedCallbacks.pop())==null||t()})}async flush(e){if(!(this.state===StorageState.Closed||this.pendingClose))return this.doFlush(e)}async doFlush(e){return this.options.hint===StorageHint.STORAGE_IN_MEMORY?this.flushPending():this.flushDelayer.trigger(()=>this.flushPending(),e)}async whenFlushed(){if(this.hasPending)return new Promise(e=>this.whenFlushedCallbacks.push(e))}};Ls.DEFAULT_FLUSH_DELAY=100;let Storage=Ls;class InMemoryStorageDatabase{constructor(){this.onDidChangeItemsExternal=Event$1.None,this.items=new Map}async updateItems(e){var t,s;(t=e.insert)==null||t.forEach((o,r)=>this.items.set(r,o)),(s=e.delete)==null||s.forEach(o=>this.items.delete(o))}}const TARGET_KEY="__$__targetStorageMarker",IStorageService=createDecorator("storageService");var WillSaveStateReason;(function(a){a[a.NONE=0]="NONE",a[a.SHUTDOWN=1]="SHUTDOWN"})(WillSaveStateReason||(WillSaveStateReason={}));function loadKeyTargets(a){const e=a.get(TARGET_KEY);if(e)try{return JSON.parse(e)}catch{}return Object.create(null)}const Es=class Es extends Disposable{constructor(e={flushInterval:Es.DEFAULT_FLUSH_INTERVAL}){super(),this._onDidChangeValue=this._register(new PauseableEmitter),this._onDidChangeTarget=this._register(new PauseableEmitter),this._onWillSaveState=this._register(new Emitter$1),this.onWillSaveState=this._onWillSaveState.event,this.runFlushWhenIdle=this._register(new MutableDisposable),this._workspaceKeyTargets=void 0,this._profileKeyTargets=void 0,this._applicationKeyTargets=void 0,this.flushWhenIdleScheduler=this._register(new RunOnceScheduler(()=>this.doFlushWhenIdle(),e.flushInterval))}onDidChangeValue(e,t,s){return Event$1.filter(this._onDidChangeValue.event,o=>o.scope===e&&(t===void 0||o.key===t),s)}doFlushWhenIdle(){this.runFlushWhenIdle.value=runWhenGlobalIdle(()=>{this.shouldFlushWhenIdle()&&this.flush(),this.flushWhenIdleScheduler.schedule()})}shouldFlushWhenIdle(){return!0}emitDidChangeValue(e,t){const{key:s,external:o}=t;if(s===TARGET_KEY){switch(e){case-1:this._applicationKeyTargets=void 0;break;case 0:this._profileKeyTargets=void 0;break;case 1:this._workspaceKeyTargets=void 0;break}this._onDidChangeTarget.fire({scope:e})}else this._onDidChangeValue.fire({scope:e,key:s,target:this.getKeyTargets(e)[s],external:o})}get(e,t,s){var o;return(o=this.getStorage(t))==null?void 0:o.get(e,s)}getBoolean(e,t,s){var o;return(o=this.getStorage(t))==null?void 0:o.getBoolean(e,s)}getNumber(e,t,s){var o;return(o=this.getStorage(t))==null?void 0:o.getNumber(e,s)}store(e,t,s,o,r=!1){if(isUndefinedOrNull(t)){this.remove(e,s,r);return}this.withPausedEmitters(()=>{var l;this.updateKeyTarget(e,s,o),(l=this.getStorage(s))==null||l.set(e,t,r)})}remove(e,t,s=!1){this.withPausedEmitters(()=>{var o;this.updateKeyTarget(e,t,void 0),(o=this.getStorage(t))==null||o.delete(e,s)})}withPausedEmitters(e){this._onDidChangeValue.pause(),this._onDidChangeTarget.pause();try{e()}finally{this._onDidChangeValue.resume(),this._onDidChangeTarget.resume()}}updateKeyTarget(e,t,s,o=!1){var l,c;const r=this.getKeyTargets(t);typeof s=="number"?r[e]!==s&&(r[e]=s,(l=this.getStorage(t))==null||l.set(TARGET_KEY,JSON.stringify(r),o)):typeof r[e]=="number"&&(delete r[e],(c=this.getStorage(t))==null||c.set(TARGET_KEY,JSON.stringify(r),o))}get workspaceKeyTargets(){return this._workspaceKeyTargets||(this._workspaceKeyTargets=this.loadKeyTargets(1)),this._workspaceKeyTargets}get profileKeyTargets(){return this._profileKeyTargets||(this._profileKeyTargets=this.loadKeyTargets(0)),this._profileKeyTargets}get applicationKeyTargets(){return this._applicationKeyTargets||(this._applicationKeyTargets=this.loadKeyTargets(-1)),this._applicationKeyTargets}getKeyTargets(e){switch(e){case-1:return this.applicationKeyTargets;case 0:return this.profileKeyTargets;default:return this.workspaceKeyTargets}}loadKeyTargets(e){const t=this.getStorage(e);return t?loadKeyTargets(t):Object.create(null)}async flush(e=WillSaveStateReason.NONE){this._onWillSaveState.fire({reason:e});const t=this.getStorage(-1),s=this.getStorage(0),o=this.getStorage(1);switch(e){case WillSaveStateReason.NONE:await Promises.settled([(t==null?void 0:t.whenFlushed())??Promise.resolve(),(s==null?void 0:s.whenFlushed())??Promise.resolve(),(o==null?void 0:o.whenFlushed())??Promise.resolve()]);break;case WillSaveStateReason.SHUTDOWN:await Promises.settled([(t==null?void 0:t.flush(0))??Promise.resolve(),(s==null?void 0:s.flush(0))??Promise.resolve(),(o==null?void 0:o.flush(0))??Promise.resolve()]);break}}};Es.DEFAULT_FLUSH_INTERVAL=60*1e3;let AbstractStorageService=Es;class InMemoryStorageService extends AbstractStorageService{constructor(){super(),this.applicationStorage=this._register(new Storage(new InMemoryStorageDatabase,{hint:StorageHint.STORAGE_IN_MEMORY})),this.profileStorage=this._register(new Storage(new InMemoryStorageDatabase,{hint:StorageHint.STORAGE_IN_MEMORY})),this.workspaceStorage=this._register(new Storage(new InMemoryStorageDatabase,{hint:StorageHint.STORAGE_IN_MEMORY})),this._register(this.workspaceStorage.onDidChangeStorage(e=>this.emitDidChangeValue(1,e))),this._register(this.profileStorage.onDidChangeStorage(e=>this.emitDidChangeValue(0,e))),this._register(this.applicationStorage.onDidChangeStorage(e=>this.emitDidChangeValue(-1,e)))}getStorage(e){switch(e){case-1:return this.applicationStorage;case 0:return this.profileStorage;default:return this.workspaceStorage}}shouldFlushWhenIdle(){return!1}}function overrideStyles(a,e){const t={...e};for(const s in a){const o=a[s];t[s]=o!==void 0?asCssVariable(o):void 0}return t}const defaultKeybindingLabelStyles={keybindingLabelBackground:asCssVariable(keybindingLabelBackground),keybindingLabelForeground:asCssVariable(keybindingLabelForeground),keybindingLabelBorder:asCssVariable(keybindingLabelBorder),keybindingLabelBottomBorder:asCssVariable(keybindingLabelBottomBorder),keybindingLabelShadow:asCssVariable(widgetShadow)},defaultButtonStyles={buttonForeground:asCssVariable(buttonForeground),buttonSeparator:asCssVariable(buttonSeparator),buttonBackground:asCssVariable(buttonBackground),buttonHoverBackground:asCssVariable(buttonHoverBackground),buttonSecondaryForeground:asCssVariable(buttonSecondaryForeground),buttonSecondaryBackground:asCssVariable(buttonSecondaryBackground),buttonSecondaryHoverBackground:asCssVariable(buttonSecondaryHoverBackground),buttonBorder:asCssVariable(buttonBorder)},defaultProgressBarStyles={progressBarBackground:asCssVariable(progressBarBackground)},defaultToggleStyles={inputActiveOptionBorder:asCssVariable(inputActiveOptionBorder),inputActiveOptionForeground:asCssVariable(inputActiveOptionForeground),inputActiveOptionBackground:asCssVariable(inputActiveOptionBackground)};asCssVariable(radioActiveForeground),asCssVariable(radioActiveBackground),asCssVariable(radioActiveBorder),asCssVariable(radioInactiveForeground),asCssVariable(radioInactiveBackground),asCssVariable(radioInactiveBorder),asCssVariable(radioInactiveHoverBackground);const defaultCheckboxStyles={checkboxBackground:asCssVariable(checkboxBackground),checkboxBorder:asCssVariable(checkboxBorder),checkboxForeground:asCssVariable(checkboxForeground),checkboxDisabledBackground:asCssVariable(checkboxDisabledBackground),checkboxDisabledForeground:asCssVariable(checkboxDisabledForeground)};asCssVariable(editorWidgetBackground),asCssVariable(editorWidgetForeground),asCssVariable(widgetShadow),asCssVariable(widgetBorder),asCssVariable(problemsErrorIconForeground),asCssVariable(problemsWarningIconForeground),asCssVariable(problemsInfoIconForeground),asCssVariable(textLinkForeground);const defaultInputBoxStyles={inputBackground:asCssVariable(inputBackground),inputForeground:asCssVariable(inputForeground),inputBorder:asCssVariable(inputBorder),inputValidationInfoBorder:asCssVariable(inputValidationInfoBorder),inputValidationInfoBackground:asCssVariable(inputValidationInfoBackground),inputValidationInfoForeground:asCssVariable(inputValidationInfoForeground),inputValidationWarningBorder:asCssVariable(inputValidationWarningBorder),inputValidationWarningBackground:asCssVariable(inputValidationWarningBackground),inputValidationWarningForeground:asCssVariable(inputValidationWarningForeground),inputValidationErrorBorder:asCssVariable(inputValidationErrorBorder),inputValidationErrorBackground:asCssVariable(inputValidationErrorBackground),inputValidationErrorForeground:asCssVariable(inputValidationErrorForeground)},defaultFindWidgetStyles={listFilterWidgetBackground:asCssVariable(listFilterWidgetBackground),listFilterWidgetOutline:asCssVariable(listFilterWidgetOutline),listFilterWidgetNoMatchesOutline:asCssVariable(listFilterWidgetNoMatchesOutline),listFilterWidgetShadow:asCssVariable(listFilterWidgetShadow),inputBoxStyles:defaultInputBoxStyles,toggleStyles:defaultToggleStyles},defaultCountBadgeStyles={badgeBackground:asCssVariable(badgeBackground),badgeForeground:asCssVariable(badgeForeground),badgeBorder:asCssVariable(contrastBorder)};asCssVariable(breadcrumbsBackground),asCssVariable(breadcrumbsForeground),asCssVariable(breadcrumbsFocusForeground),asCssVariable(breadcrumbsFocusForeground),asCssVariable(breadcrumbsActiveSelectionForeground);const defaultListStyles={listBackground:void 0,listInactiveFocusForeground:void 0,listFocusBackground:asCssVariable(listFocusBackground),listFocusForeground:asCssVariable(listFocusForeground),listFocusOutline:asCssVariable(listFocusOutline),listActiveSelectionBackground:asCssVariable(listActiveSelectionBackground),listActiveSelectionForeground:asCssVariable(listActiveSelectionForeground),listActiveSelectionIconForeground:asCssVariable(listActiveSelectionIconForeground),listFocusAndSelectionOutline:asCssVariable(listFocusAndSelectionOutline),listFocusAndSelectionBackground:asCssVariable(listActiveSelectionBackground),listFocusAndSelectionForeground:asCssVariable(listActiveSelectionForeground),listInactiveSelectionBackground:asCssVariable(listInactiveSelectionBackground),listInactiveSelectionIconForeground:asCssVariable(listInactiveSelectionIconForeground),listInactiveSelectionForeground:asCssVariable(listInactiveSelectionForeground),listInactiveFocusBackground:asCssVariable(listInactiveFocusBackground),listInactiveFocusOutline:asCssVariable(listInactiveFocusOutline),listHoverBackground:asCssVariable(listHoverBackground),listHoverForeground:asCssVariable(listHoverForeground),listDropOverBackground:asCssVariable(listDropOverBackground),listDropBetweenBackground:asCssVariable(listDropBetweenBackground),listSelectionOutline:asCssVariable(activeContrastBorder),listHoverOutline:asCssVariable(activeContrastBorder),treeIndentGuidesStroke:asCssVariable(treeIndentGuidesStroke),treeInactiveIndentGuidesStroke:asCssVariable(treeInactiveIndentGuidesStroke),treeStickyScrollBackground:void 0,treeStickyScrollBorder:void 0,treeStickyScrollShadow:asCssVariable(scrollbarShadow),tableColumnsBorder:asCssVariable(tableColumnsBorder),tableOddRowsBackgroundColor:asCssVariable(tableOddRowsBackgroundColor)};function getListStyles(a){return overrideStyles(a,defaultListStyles)}const defaultSelectBoxStyles={selectBackground:asCssVariable(selectBackground),selectListBackground:asCssVariable(selectListBackground),selectForeground:asCssVariable(selectForeground),decoratorRightForeground:asCssVariable(pickerGroupForeground),selectBorder:asCssVariable(selectBorder),focusBorder:asCssVariable(focusBorder),listFocusBackground:asCssVariable(quickInputListFocusBackground),listInactiveSelectionIconForeground:asCssVariable(quickInputListFocusIconForeground),listFocusForeground:asCssVariable(quickInputListFocusForeground),listFocusOutline:asCssVariableWithDefault(activeContrastBorder,Color.transparent.toString()),listHoverBackground:asCssVariable(listHoverBackground),listHoverForeground:asCssVariable(listHoverForeground),listHoverOutline:asCssVariable(activeContrastBorder),selectListBorder:asCssVariable(editorWidgetBorder),listBackground:void 0,listActiveSelectionBackground:void 0,listActiveSelectionForeground:void 0,listActiveSelectionIconForeground:void 0,listFocusAndSelectionBackground:void 0,listDropOverBackground:void 0,listDropBetweenBackground:void 0,listInactiveSelectionBackground:void 0,listInactiveSelectionForeground:void 0,listInactiveFocusBackground:void 0,listInactiveFocusOutline:void 0,listSelectionOutline:void 0,listFocusAndSelectionForeground:void 0,listFocusAndSelectionOutline:void 0,listInactiveFocusForeground:void 0,tableColumnsBorder:void 0,tableOddRowsBackgroundColor:void 0,treeIndentGuidesStroke:void 0,treeInactiveIndentGuidesStroke:void 0,treeStickyScrollBackground:void 0,treeStickyScrollBorder:void 0,treeStickyScrollShadow:void 0},defaultMenuStyles={shadowColor:asCssVariable(widgetShadow),borderColor:asCssVariable(menuBorder),foregroundColor:asCssVariable(menuForeground),backgroundColor:asCssVariable(menuBackground),selectionForegroundColor:asCssVariable(menuSelectionForeground),selectionBackgroundColor:asCssVariable(menuSelectionBackground),selectionBorderColor:asCssVariable(menuSelectionBorder),separatorColor:asCssVariable(menuSeparatorBackground),scrollbarShadow:asCssVariable(scrollbarShadow),scrollbarSliderBackground:asCssVariable(scrollbarSliderBackground),scrollbarSliderHoverBackground:asCssVariable(scrollbarSliderHoverBackground),scrollbarSliderActiveBackground:asCssVariable(scrollbarSliderActiveBackground)};function hasNativeContextMenu(a,e){if(isWeb)return!1;const t=hasNativeTitlebar(a,e),s=a.getValue("window");return(s==null?void 0:s.menuStyle)==="native"?!(!isMacintosh&&!t):(s==null?void 0:s.menuStyle)==="custom"?!1:t}function hasNativeTitlebar(a,e){return e||(e=getTitleBarStyle(a)),e==="native"}function getTitleBarStyle(a){if(isWeb)return"custom";const e=a.getValue("window");if(e){if(isMacintosh&&e.nativeTabs===!0||isMacintosh&&e.nativeFullScreen===!1)return"native";const o=e.titleBarStyle;if(o==="native"||o==="custom")return o}return"custom"}function getWindowControlsStyle(a){if(isWeb||isMacintosh||getTitleBarStyle(a)==="native")return"native";const e=a.getValue("window"),t=e==null?void 0:e.controlsStyle;return t==="custom"||t==="hidden"?t:"native"}const menuEntryActionViewItem="";var __decorate$2p=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2n=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};function getFlatContextMenuActions(a,e){const t=[];return getContextMenuActionsImpl(a,t,e),t}function getContextMenuActionsImpl(a,e,t){const s=ModifierKeyEmitter.getInstance(),o=s.keyStatus.altKey||(isWindows||isLinux)&&s.keyStatus.shiftKey;fillInActions(a,e,o,t?r=>r===t:r=>r==="navigation")}function getActionBarActions(a,e,t,s){const o={primary:[],secondary:[]};return fillInActionBarActions(a,o,e,t,s),o}function getFlatActionBarActions(a,e,t,s){const o=[];return fillInActionBarActions(a,o,e,t,s),o}function fillInActionBarActions(a,e,t,s,o){fillInActions(a,e,!1,typeof t=="string"?l=>l===t:t,s,o)}function fillInActions(a,e,t,s=l=>l==="navigation",o=()=>!1,r=!1){let l,c;Array.isArray(e)?(l=e,c=e):(l=e.primary,c=e.secondary);const d=new Set;for(const[u,g]of a){let f;s(u)?(f=l,f.length>0&&r&&f.push(new Separator)):(f=c,f.length>0&&f.push(new Separator));for(let p of g){t&&(p=p instanceof MenuItemAction&&p.alt?p.alt:p);const m=f.push(p);p instanceof SubmenuAction&&d.add({group:u,action:p,index:m-1})}}for(const{group:u,action:g,index:f}of d){const p=s(u)?l:c,m=g.actions;o(g,u,p.length)&&p.splice(f,1,...m)}}let MenuEntryActionViewItem=class extends ActionViewItem{constructor(e,t,s,o,r,l,c,d){super(void 0,e,{icon:!!(e.class||e.item.icon),label:!e.class&&!e.item.icon,draggable:t==null?void 0:t.draggable,keybinding:t==null?void 0:t.keybinding,hoverDelegate:t==null?void 0:t.hoverDelegate,keybindingNotRenderedWithLabel:t==null?void 0:t.keybindingNotRenderedWithLabel}),this._options=t,this._keybindingService=s,this._notificationService=o,this._contextKeyService=r,this._themeService=l,this._contextMenuService=c,this._accessibilityService=d,this._wantsAltCommand=!1,this._itemClassDispose=this._register(new MutableDisposable),this._altKey=ModifierKeyEmitter.getInstance()}get _menuItemAction(){return this._action}get _commandAction(){return this._wantsAltCommand&&this._menuItemAction.alt||this._menuItemAction}async onClick(e){e.preventDefault(),e.stopPropagation();try{await this.actionRunner.run(this._commandAction,this._context)}catch(t){this._notificationService.error(t)}}render(e){if(super.render(e),e.classList.add("menu-entry"),this.options.icon&&this._updateItemClass(this._menuItemAction.item),this._menuItemAction.alt){let t=!1;const s=()=>{var r;const o=!!((r=this._menuItemAction.alt)!=null&&r.enabled)&&(!this._accessibilityService.isMotionReduced()||t)&&(this._altKey.keyStatus.altKey||this._altKey.keyStatus.shiftKey&&t);o!==this._wantsAltCommand&&(this._wantsAltCommand=o,this.updateLabel(),this.updateTooltip(),this.updateClass())};this._register(this._altKey.event(s)),this._register(addDisposableListener(e,"mouseleave",o=>{t=!1,s()})),this._register(addDisposableListener(e,"mouseenter",o=>{t=!0,s()})),s()}}updateLabel(){this.options.label&&this.label&&(this.label.textContent=this._commandAction.label)}getTooltip(){var r;const e=this._keybindingService.lookupKeybinding(this._commandAction.id,this._contextKeyService),t=e&&e.getLabel(),s=this._commandAction.tooltip||this._commandAction.label;let o=t?localize(1629,"{0} ({1})",s,t):s;if(!this._wantsAltCommand&&((r=this._menuItemAction.alt)!=null&&r.enabled)){const l=this._menuItemAction.alt.tooltip||this._menuItemAction.alt.label,c=this._keybindingService.lookupKeybinding(this._menuItemAction.alt.id,this._contextKeyService),d=c&&c.getLabel(),u=d?localize(1630,"{0} ({1})",l,d):l;o=localize(1631,`{0}
[{1}] {2}`,o,UILabelProvider.modifierLabels[OS].altKey,u)}return o}updateClass(){this.options.icon&&(this._commandAction!==this._menuItemAction?this._menuItemAction.alt&&this._updateItemClass(this._menuItemAction.alt.item):this._updateItemClass(this._menuItemAction.item))}_updateItemClass(e){this._itemClassDispose.value=void 0;const{element:t,label:s}=this;if(!t||!s)return;const o=this._commandAction.checked&&isICommandActionToggleInfo(e.toggled)&&e.toggled.icon?e.toggled.icon:e.icon;if(o)if(ThemeIcon.isThemeIcon(o)){const r=ThemeIcon.asClassNameArray(o);s.classList.add(...r),this._itemClassDispose.value=toDisposable(()=>{s.classList.remove(...r)})}else s.style.backgroundImage=isDark(this._themeService.getColorTheme().type)?asCSSUrl(o.dark):asCSSUrl(o.light),s.classList.add("icon"),this._itemClassDispose.value=combinedDisposable(toDisposable(()=>{s.style.backgroundImage="",s.classList.remove("icon")}),this._themeService.onDidColorThemeChange(()=>{this.updateClass()}))}};MenuEntryActionViewItem=__decorate$2p([__param$2n(2,IKeybindingService),__param$2n(3,INotificationService),__param$2n(4,IContextKeyService),__param$2n(5,IThemeService),__param$2n(6,IContextMenuService),__param$2n(7,IAccessibilityService)],MenuEntryActionViewItem);class TextOnlyMenuEntryActionViewItem extends MenuEntryActionViewItem{render(e){var t;this.options.label=!0,this.options.icon=!1,super.render(e),e.classList.add("text-only"),e.classList.toggle("use-comma",((t=this._options)==null?void 0:t.useComma)??!1)}updateLabel(){var t;const e=this._keybindingService.lookupKeybinding(this._action.id,this._contextKeyService);if(!e)return super.updateLabel();if(this.label){const s=TextOnlyMenuEntryActionViewItem._symbolPrintEnter(e);(t=this._options)!=null&&t.conversational?this.label.textContent=localize(1632,"{1} to {0}",this._action.label,s):this.label.textContent=localize(1633,"{0} ({1})",this._action.label,s)}}static _symbolPrintEnter(e){var t;return(t=e.getLabel())==null?void 0:t.replace(/\benter\b/gi,"⏎").replace(/\bEscape\b/gi,"Esc")}}let SubmenuEntryActionViewItem=class extends DropdownMenuActionViewItem{constructor(e,t,s,o,r){const l={...t,menuAsChild:(t==null?void 0:t.menuAsChild)??!1,classNames:(t==null?void 0:t.classNames)??(ThemeIcon.isThemeIcon(e.item.icon)?ThemeIcon.asClassName(e.item.icon):void 0),keybindingProvider:(t==null?void 0:t.keybindingProvider)??(c=>s.lookupKeybinding(c.id))};super(e,{getActions:()=>e.actions},o,l),this._keybindingService=s,this._contextMenuService=o,this._themeService=r}render(e){super.render(e),assertType(this.element),e.classList.add("menu-entry");const t=this._action,{icon:s}=t.item;if(s&&!ThemeIcon.isThemeIcon(s)){this.element.classList.add("icon");const o=()=>{this.element&&(this.element.style.backgroundImage=isDark(this._themeService.getColorTheme().type)?asCSSUrl(s.dark):asCSSUrl(s.light))};o(),this._register(this._themeService.onDidColorThemeChange(()=>{o()}))}}};SubmenuEntryActionViewItem=__decorate$2p([__param$2n(2,IKeybindingService),__param$2n(3,IContextMenuService),__param$2n(4,IThemeService)],SubmenuEntryActionViewItem);let DropdownWithDefaultActionViewItem=class extends BaseActionViewItem{constructor(e,t,s,o,r,l,c,d){super(null,e),this._keybindingService=s,this._notificationService=o,this._contextMenuService=r,this._menuService=l,this._instaService=c,this._storageService=d,this._defaultActionDisposables=this._register(new DisposableStore),this._container=null,this._options=t,this._storageKey=`${e.item.submenu.id}_lastActionId`;let u;const g=t!=null&&t.persistLastActionId?d.get(this._storageKey,1):void 0;g&&(u=e.actions.find(p=>g===p.id)),u||(u=e.actions[0]),this._defaultAction=this._defaultActionDisposables.add(this._instaService.createInstance(MenuEntryActionViewItem,u,{keybinding:this._getDefaultActionKeybindingLabel(u)}));const f={keybindingProvider:p=>this._keybindingService.lookupKeybinding(p.id),...t,menuAsChild:(t==null?void 0:t.menuAsChild)??!0,classNames:(t==null?void 0:t.classNames)??["codicon","codicon-chevron-down"],actionRunner:(t==null?void 0:t.actionRunner)??this._register(new ActionRunner)};this._dropdown=this._register(new DropdownMenuActionViewItem(e,e.actions,this._contextMenuService,f)),this._register(this._dropdown.actionRunner.onDidRun(p=>{p.action instanceof MenuItemAction&&this.update(p.action)}))}update(e){var t;(t=this._options)!=null&&t.persistLastActionId&&this._storageService.store(this._storageKey,e.id,1,1),this._defaultActionDisposables.clear(),this._defaultAction=this._defaultActionDisposables.add(this._instaService.createInstance(MenuEntryActionViewItem,e,{keybinding:this._getDefaultActionKeybindingLabel(e)})),this._defaultAction.actionRunner=this._defaultActionDisposables.add(new class extends ActionRunner{async runAction(s,o){await s.run(void 0)}}),this._container&&this._defaultAction.render(prepend$2(this._container,$$l(".action-container")))}_getDefaultActionKeybindingLabel(e){var s;let t;if((s=this._options)!=null&&s.renderKeybindingWithDefaultActionLabel){const o=this._keybindingService.lookupKeybinding(e.id);o&&(t=`(${o.getLabel()})`)}return t}setActionContext(e){super.setActionContext(e),this._defaultAction.setActionContext(e),this._dropdown.setActionContext(e)}render(e){this._container=e,super.render(this._container),this._container.classList.add("monaco-dropdown-with-default");const t=$$l(".action-container");this._defaultAction.render(append$2(this._container,t)),this._register(addDisposableListener(t,EventType$1.KEY_DOWN,o=>{const r=new StandardKeyboardEvent(o);r.equals(17)&&(this._defaultAction.element.tabIndex=-1,this._dropdown.focus(),r.stopPropagation())}));const s=$$l(".dropdown-action-container");this._dropdown.render(append$2(this._container,s)),this._register(addDisposableListener(s,EventType$1.KEY_DOWN,o=>{var l;const r=new StandardKeyboardEvent(o);r.equals(15)&&(this._defaultAction.element.tabIndex=0,this._dropdown.setFocusable(!1),(l=this._defaultAction.element)==null||l.focus(),r.stopPropagation())}))}focus(e){e?this._dropdown.focus():(this._defaultAction.element.tabIndex=0,this._defaultAction.element.focus())}blur(){this._defaultAction.element.tabIndex=-1,this._dropdown.blur(),this._container.blur()}setFocusable(e){e?this._defaultAction.element.tabIndex=0:(this._defaultAction.element.tabIndex=-1,this._dropdown.setFocusable(!1))}};DropdownWithDefaultActionViewItem=__decorate$2p([__param$2n(2,IKeybindingService),__param$2n(3,INotificationService),__param$2n(4,IContextMenuService),__param$2n(5,IMenuService),__param$2n(6,IInstantiationService),__param$2n(7,IStorageService)],DropdownWithDefaultActionViewItem);let SubmenuEntrySelectActionViewItem=class extends SelectActionViewItem{constructor(e,t,s){super(null,e,e.actions.map(o=>({text:o.id===Separator.ID?"─────────":o.label,isDisabled:!o.enabled})),0,t,defaultSelectBoxStyles,{ariaLabel:e.tooltip,optionsAsChildren:!0,useCustomDrawn:!hasNativeContextMenu(s)}),this.select(Math.max(0,e.actions.findIndex(o=>o.checked)))}render(e){super.render(e),e.style.borderColor=asCssVariable(selectBorder)}runAction(e,t){const s=this.action.actions[t];s&&this.actionRunner.run(s)}};SubmenuEntrySelectActionViewItem=__decorate$2p([__param$2n(1,IContextViewService),__param$2n(2,IConfigurationService)],SubmenuEntrySelectActionViewItem);function createActionViewItem(a,e,t){return e instanceof MenuItemAction?a.createInstance(MenuEntryActionViewItem,e,t):e instanceof SubmenuItemAction?e.item.isSelection?a.createInstance(SubmenuEntrySelectActionViewItem,e):e.item.rememberDefaultAction?a.createInstance(DropdownWithDefaultActionViewItem,e,{...t,persistLastActionId:!0}):a.createInstance(SubmenuEntryActionViewItem,e,t):void 0}var __decorate$2o=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2m=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},PersistedMenuHideState_1,MenuInfo_1;let MenuService=class{constructor(e,t,s){this._commandService=e,this._keybindingService=t,this._hiddenStates=new PersistedMenuHideState(s)}createMenu(e,t,s){return new MenuImpl(e,this._hiddenStates,{emitEventsForSubmenuChanges:!1,eventDebounceDelay:50,...s},this._commandService,this._keybindingService,t)}getMenuActions(e,t,s){const o=new MenuImpl(e,this._hiddenStates,{emitEventsForSubmenuChanges:!1,eventDebounceDelay:50,...s},this._commandService,this._keybindingService,t),r=o.getActions(s);return o.dispose(),r}resetHiddenStates(e){this._hiddenStates.reset(e)}};MenuService=__decorate$2o([__param$2m(0,ICommandService),__param$2m(1,IKeybindingService),__param$2m(2,IStorageService)],MenuService);var mi;let PersistedMenuHideState=(mi=class{constructor(e){this._storageService=e,this._disposables=new DisposableStore,this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._ignoreChangeEvent=!1,this._hiddenByDefaultCache=new Map;try{const t=e.get(PersistedMenuHideState_1._key,0,"{}");this._data=JSON.parse(t)}catch{this._data=Object.create(null)}this._disposables.add(e.onDidChangeValue(0,PersistedMenuHideState_1._key,this._disposables)(()=>{if(!this._ignoreChangeEvent)try{const t=e.get(PersistedMenuHideState_1._key,0,"{}");this._data=JSON.parse(t)}catch(t){console.log("FAILED to read storage after UPDATE",t)}this._onDidChange.fire()}))}dispose(){this._onDidChange.dispose(),this._disposables.dispose()}_isHiddenByDefault(e,t){return this._hiddenByDefaultCache.get(`${e.id}/${t}`)??!1}setDefaultState(e,t,s){this._hiddenByDefaultCache.set(`${e.id}/${t}`,s)}isHidden(e,t){var r;const s=this._isHiddenByDefault(e,t),o=((r=this._data[e.id])==null?void 0:r.includes(t))??!1;return s?!o:o}updateHidden(e,t,s){this._isHiddenByDefault(e,t)&&(s=!s);const r=this._data[e.id];if(s)r?r.indexOf(t)<0&&r.push(t):this._data[e.id]=[t];else if(r){const l=r.indexOf(t);l>=0&&removeFastWithoutKeepingOrder(r,l),r.length===0&&delete this._data[e.id]}this._persist()}reset(e){if(e===void 0)this._data=Object.create(null),this._persist();else{for(const{id:t}of e)this._data[t]&&delete this._data[t];this._persist()}}_persist(){try{this._ignoreChangeEvent=!0;const e=JSON.stringify(this._data);this._storageService.store(PersistedMenuHideState_1._key,e,0,0)}finally{this._ignoreChangeEvent=!1}}},PersistedMenuHideState_1=mi,mi._key="menu.hiddenCommands",mi);PersistedMenuHideState=PersistedMenuHideState_1=__decorate$2o([__param$2m(0,IStorageService)],PersistedMenuHideState);class MenuInfoSnapshot{constructor(e,t){this._id=e,this._collectContextKeysForSubmenus=t,this._menuGroups=[],this._allMenuIds=new Set,this._structureContextKeys=new Set,this._preconditionContextKeys=new Set,this._toggledContextKeys=new Set,this.refresh()}get allMenuIds(){return this._allMenuIds}get structureContextKeys(){return this._structureContextKeys}get preconditionContextKeys(){return this._preconditionContextKeys}get toggledContextKeys(){return this._toggledContextKeys}refresh(){this._menuGroups.length=0,this._allMenuIds.clear(),this._structureContextKeys.clear(),this._preconditionContextKeys.clear(),this._toggledContextKeys.clear();const e=this._sort(MenuRegistry.getMenuItems(this._id));let t;for(const s of e){const o=s.group||"";(!t||t[0]!==o)&&(t=[o,[]],this._menuGroups.push(t)),t[1].push(s),this._collectContextKeysAndSubmenuIds(s)}this._allMenuIds.add(this._id)}_sort(e){return e}_collectContextKeysAndSubmenuIds(e){if(MenuInfoSnapshot._fillInKbExprKeys(e.when,this._structureContextKeys),isIMenuItem(e)){if(e.command.precondition&&MenuInfoSnapshot._fillInKbExprKeys(e.command.precondition,this._preconditionContextKeys),e.command.toggled){const t=e.command.toggled.condition||e.command.toggled;MenuInfoSnapshot._fillInKbExprKeys(t,this._toggledContextKeys)}}else this._collectContextKeysForSubmenus&&(MenuRegistry.getMenuItems(e.submenu).forEach(this._collectContextKeysAndSubmenuIds,this),this._allMenuIds.add(e.submenu))}static _fillInKbExprKeys(e,t){if(e)for(const s of e.keys())t.add(s)}}let MenuInfo=MenuInfo_1=class extends MenuInfoSnapshot{constructor(e,t,s,o,r,l){super(e,s),this._hiddenStates=t,this._commandService=o,this._keybindingService=r,this._contextKeyService=l,this.refresh()}createActionGroups(e){const t=[];for(const s of this._menuGroups){const[o,r]=s;let l;for(const c of r)if(this._contextKeyService.contextMatchesRules(c.when)){const d=isIMenuItem(c);d&&this._hiddenStates.setDefaultState(this._id,c.command.id,!!c.isHiddenByDefault);const u=createMenuHide(this._id,d?c.command:c,this._hiddenStates);if(d){const g=createConfigureKeybindingAction(this._commandService,this._keybindingService,c.command.id,c.when);(l??(l=[])).push(new MenuItemAction(c.command,c.alt,e,u,g,this._contextKeyService,this._commandService))}else{const g=new MenuInfo_1(c.submenu,this._hiddenStates,this._collectContextKeysForSubmenus,this._commandService,this._keybindingService,this._contextKeyService).createActionGroups(e),f=Separator.join(...g.map(p=>p[1]));f.length>0&&(l??(l=[])).push(new SubmenuItemAction(c,u,f))}}l&&l.length>0&&t.push([o,l])}return t}_sort(e){return e.sort(MenuInfo_1._compareMenuItems)}static _compareMenuItems(e,t){const s=e.group,o=t.group;if(s!==o){if(s){if(!o)return-1}else return 1;if(s==="navigation")return-1;if(o==="navigation")return 1;const c=s.localeCompare(o);if(c!==0)return c}const r=e.order||0,l=t.order||0;return r<l?-1:r>l?1:MenuInfo_1._compareTitles(isIMenuItem(e)?e.command.title:e.title,isIMenuItem(t)?t.command.title:t.title)}static _compareTitles(e,t){const s=typeof e=="string"?e:e.original,o=typeof t=="string"?t:t.original;return s.localeCompare(o)}};MenuInfo=MenuInfo_1=__decorate$2o([__param$2m(3,ICommandService),__param$2m(4,IKeybindingService),__param$2m(5,IContextKeyService)],MenuInfo);let MenuImpl=class{constructor(e,t,s,o,r,l){this._disposables=new DisposableStore,this._menuInfo=new MenuInfo(e,t,s.emitEventsForSubmenuChanges,o,r,l);const c=new RunOnceScheduler(()=>{this._menuInfo.refresh(),this._onDidChange.fire({menu:this,isStructuralChange:!0,isEnablementChange:!0,isToggleChange:!0})},s.eventDebounceDelay);this._disposables.add(c),this._disposables.add(MenuRegistry.onDidChangeMenu(f=>{for(const p of this._menuInfo.allMenuIds)if(f.has(p)){c.schedule();break}}));const d=this._disposables.add(new DisposableStore),u=f=>{let p=!1,m=!1,_=!1;for(const C of f)if(p=p||C.isStructuralChange,m=m||C.isEnablementChange,_=_||C.isToggleChange,p&&m&&_)break;return{menu:this,isStructuralChange:p,isEnablementChange:m,isToggleChange:_}},g=()=>{d.add(l.onDidChangeContext(f=>{const p=f.affectsSome(this._menuInfo.structureContextKeys),m=f.affectsSome(this._menuInfo.preconditionContextKeys),_=f.affectsSome(this._menuInfo.toggledContextKeys);(p||m||_)&&this._onDidChange.fire({menu:this,isStructuralChange:p,isEnablementChange:m,isToggleChange:_})})),d.add(t.onDidChange(f=>{this._onDidChange.fire({menu:this,isStructuralChange:!0,isEnablementChange:!1,isToggleChange:!1})}))};this._onDidChange=new DebounceEmitter({onWillAddFirstListener:g,onDidRemoveLastListener:d.clear.bind(d),delay:s.eventDebounceDelay,merge:u}),this.onDidChange=this._onDidChange.event}getActions(e){return this._menuInfo.createActionGroups(e)}dispose(){this._disposables.dispose(),this._onDidChange.dispose()}};MenuImpl=__decorate$2o([__param$2m(3,ICommandService),__param$2m(4,IKeybindingService),__param$2m(5,IContextKeyService)],MenuImpl);function createMenuHide(a,e,t){const s=isISubmenuItem(e)?e.submenu.id:e.id,o=typeof e.title=="string"?e.title:e.title.value,r=toAction({id:`hide/${a.id}/${s}`,label:localize(1636,"Hide '{0}'",o),run(){t.updateHidden(a,s,!0)}}),l=toAction({id:`toggle/${a.id}/${s}`,label:o,get checked(){return!t.isHidden(a,s)},run(){t.updateHidden(a,s,!!this.checked)}});return{hide:r,toggle:l,get isHidden(){return!l.checked}}}function createConfigureKeybindingAction(a,e,t,s=void 0,o=!0){return toAction({id:`configureKeybinding/${t}`,label:localize(1637,"Configure Keybinding"),enabled:o,run(){const l=!!!e.lookupKeybinding(t)&&s?s.serialize():void 0;a.executeCommand("workbench.action.openGlobalKeybindings",`@command:${t}`+(l?` +when:${l}`:""))}})}const IActionViewItemService=createDecorator("IActionViewItemService");class ActionViewItemService{constructor(){this._providers=new Map,this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event}dispose(){this._onDidChange.dispose()}lookUp(e,t){return this._providers.get(this._makeKey(e,t))}_makeKey(e,t){return`${e.id}/${t instanceof MenuId?t.id:t}`}}registerSingleton(IActionViewItemService,ActionViewItemService,1);var __decorate$2n=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2l=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let WorkbenchToolBar=class extends ToolBar{constructor(e,t,s,o,r,l,c,d){super(e,r,{getKeyBinding:g=>l.lookupKeybinding(g.id)??void 0,...t,allowContextMenu:!0,skipTelemetry:typeof(t==null?void 0:t.telemetrySource)=="string"}),this._options=t,this._menuService=s,this._contextKeyService=o,this._contextMenuService=r,this._keybindingService=l,this._commandService=c,this._sessionDisposables=this._store.add(new DisposableStore);const u=t==null?void 0:t.telemetrySource;u&&this._store.add(this.actionBar.onDidRun(g=>d.publicLog2("workbenchActionExecuted",{id:g.action.id,from:u})))}setActions(e,t=[],s){var g,f,p;this._sessionDisposables.clear();const o=e.slice(),r=t.slice(),l=[];let c=0;const d=[];let u=!1;if(((g=this._options)==null?void 0:g.hiddenItemStrategy)!==-1)for(let m=0;m<o.length;m++){const _=o[m];!(_ instanceof MenuItemAction)&&!(_ instanceof SubmenuItemAction)||_.hideActions&&(l.push(_.hideActions.toggle),_.hideActions.toggle.checked&&c++,_.hideActions.isHidden&&(u=!0,o[m]=void 0,((f=this._options)==null?void 0:f.hiddenItemStrategy)!==0&&(d[m]=_)))}if(((p=this._options)==null?void 0:p.overflowBehavior)!==void 0){const m=intersection(new Set(this._options.overflowBehavior.exempted),Iterable.map(o,b=>b==null?void 0:b.id)),_=this._options.overflowBehavior.maxItems-m.size;let C=0;for(let b=0;b<o.length;b++){const v=o[b];v&&(C++,!m.has(v.id)&&C>=_&&(o[b]=void 0,d[b]=v))}}coalesceInPlace(o),coalesceInPlace(d),super.setActions(o,Separator.join(d,r)),(l.length>0||o.length>0)&&this._sessionDisposables.add(addDisposableListener(this.getElement(),"contextmenu",m=>{var S,y,w,L,x;const _=new StandardMouseEvent(getWindow(this.getElement()),m),C=this.getItemAction(_.target);if(!C)return;_.preventDefault(),_.stopPropagation();const b=[];if(C instanceof MenuItemAction&&C.menuKeybinding)b.push(C.menuKeybinding);else if(!(C instanceof SubmenuItemAction||C instanceof ToggleMenuAction)){const E=!!this._keybindingService.lookupKeybinding(C.id);b.push(createConfigureKeybindingAction(this._commandService,this._keybindingService,C.id,void 0,E))}if(l.length>0){let E=!1;if(c===1&&((S=this._options)==null?void 0:S.hiddenItemStrategy)===0){E=!0;for(let I=0;I<l.length;I++)if(l[I].checked){l[I]=toAction({id:C.id,label:C.label,checked:!0,enabled:!1,run(){}});break}}if(!E&&(C instanceof MenuItemAction||C instanceof SubmenuItemAction)){if(!C.hideActions)return;b.push(C.hideActions.hide)}else b.push(toAction({id:"label",label:localize(1634,"Hide"),enabled:!1,run(){}}))}const v=Separator.join(b,l);(y=this._options)!=null&&y.resetMenu&&!s&&(s=[this._options.resetMenu]),u&&s&&(v.push(new Separator),v.push(toAction({id:"resetThisMenu",label:localize(1635,"Reset Menu"),run:()=>this._menuService.resetHiddenStates(s)}))),v.length!==0&&this._contextMenuService.showContextMenu({getAnchor:()=>_,getActions:()=>v,menuId:(w=this._options)==null?void 0:w.contextMenu,menuActionOptions:{renderShortTitle:!0,...(L=this._options)==null?void 0:L.menuOptions},skipTelemetry:typeof((x=this._options)==null?void 0:x.telemetrySource)=="string",contextKeyService:this._contextKeyService})}))}};WorkbenchToolBar=__decorate$2n([__param$2l(2,IMenuService),__param$2l(3,IContextKeyService),__param$2l(4,IContextMenuService),__param$2l(5,IKeybindingService),__param$2l(6,ICommandService),__param$2l(7,ITelemetryService)],WorkbenchToolBar);let MenuWorkbenchToolBar=class extends WorkbenchToolBar{get onDidChangeMenuItems(){return this._onDidChangeMenuItems.event}constructor(e,t,s,o,r,l,c,d,u,g,f){super(e,{resetMenu:t,...s,actionViewItemProvider:(_,C)=>{let b=g.lookUp(t,_ instanceof SubmenuItemAction?_.item.submenu.id:_.id);b||(b=s==null?void 0:s.actionViewItemProvider);const v=b==null?void 0:b(_,C,f,getWindow(e).vscodeWindowId);return v||createActionViewItem(f,_,C)}},o,r,l,c,d,u),this._onDidChangeMenuItems=this._store.add(new Emitter$1);const p=this._store.add(o.createMenu(t,r,{emitEventsForSubmenuChanges:!0,eventDebounceDelay:s==null?void 0:s.eventDebounceDelay})),m=()=>{var b,v,S;const{primary:_,secondary:C}=getActionBarActions(p.getActions(s==null?void 0:s.menuOptions),(b=s==null?void 0:s.toolbarOptions)==null?void 0:b.primaryGroup,(v=s==null?void 0:s.toolbarOptions)==null?void 0:v.shouldInlineSubmenu,(S=s==null?void 0:s.toolbarOptions)==null?void 0:S.useSeparatorsInPrimaryActions);e.classList.toggle("has-no-actions",_.length===0&&C.length===0),super.setActions(_,C)};this._store.add(p.onDidChange(()=>{m(),this._onDidChangeMenuItems.fire(this)})),this._store.add(g.onDidChange(_=>{_===t&&m()})),m()}setActions(){throw new BugIndicatingError("This toolbar is populated from a menu.")}};MenuWorkbenchToolBar=__decorate$2n([__param$2l(3,IMenuService),__param$2l(4,IContextKeyService),__param$2l(5,IContextMenuService),__param$2l(6,IKeybindingService),__param$2l(7,ICommandService),__param$2l(8,ITelemetryService),__param$2l(9,IActionViewItemService),__param$2l(10,IInstantiationService)],MenuWorkbenchToolBar);var __decorate$2m=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2k=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const IHoverService=createDecorator("hoverService");let WorkbenchHoverDelegate=class extends Disposable{get delay(){var e;return this.isInstantlyHovering()?0:(e=this.hoverOptions)!=null&&e.dynamicDelay?t=>{var s,o;return((o=(s=this.hoverOptions)==null?void 0:s.dynamicDelay)==null?void 0:o.call(s,t))??this._delay}:this._delay}constructor(e,t,s={},o,r){super(),this.placement=e,this.hoverOptions=t,this.overrideOptions=s,this.configurationService=o,this.hoverService=r,this.lastHoverHideTime=0,this.timeLimit=200,this.hoverDisposables=this._register(new DisposableStore),this._delay=this.configurationService.getValue("workbench.hover.delay"),this._register(this.configurationService.onDidChangeConfiguration(l=>{l.affectsConfiguration("workbench.hover.delay")&&(this._delay=this.configurationService.getValue("workbench.hover.delay"))}))}showHover(e,t){const s=typeof this.overrideOptions=="function"?this.overrideOptions(e,t):this.overrideOptions;this.hoverDisposables.clear();const o=isHTMLElement(e.target)?[e.target]:e.target.targetElements;for(const l of o)this.hoverDisposables.add(addStandardDisposableListener(l,"keydown",c=>{c.equals(9)&&this.hoverService.hideHover()}));const r=isHTMLElement(e.content)?void 0:typeof e.content=="string"?e.content.toString():e.content.value;return this.hoverService.showInstantHover({...e,...s,persistence:{hideOnKeyDown:!0,...s.persistence},id:r,appearance:{...e.appearance,compact:!0,skipFadeInAnimation:this.isInstantlyHovering(),...s.appearance}},t)}isInstantlyHovering(){var e;return!!((e=this.hoverOptions)!=null&&e.instantHover)&&Date.now()-this.lastHoverHideTime<this.timeLimit}onDidHideHover(){var e;this.hoverDisposables.clear(),(e=this.hoverOptions)!=null&&e.instantHover&&(this.lastHoverHideTime=Date.now())}};WorkbenchHoverDelegate=__decorate$2m([__param$2k(3,IConfigurationService),__param$2k(4,IHoverService)],WorkbenchHoverDelegate);const nativeHoverDelegate={showHover:function(){throw new Error("Native hover function not implemented.")},delay:0,showNativeHover:!0};class TextModelText extends AbstractText{constructor(e){super(),this._textModel=e}getValueOfRange(e){return this._textModel.getValueInRange(e)}getLineLength(e){return this._textModel.getLineLength(e)}get length(){const e=this._textModel.getLineCount(),t=this._textModel.getLineLength(e);return new TextLength(e-1,t)}}class ActionRunnerWithContext extends ActionRunner{constructor(e){super(),this._getContext=e}runAction(e,t){const s=this._getContext();return super.runAction(e,s)}}class EditorGutter extends Disposable{constructor(e,t,s){super(),this._editor=e,this._domNode=t,this.itemProvider=s,this.scrollTop=observableFromEvent(this,this._editor.onDidScrollChange,l=>this._editor.getScrollTop()),this.isScrollTopZero=this.scrollTop.map(l=>l===0),this.modelAttached=observableFromEvent(this,this._editor.onDidChangeModel,l=>this._editor.hasModel()),this.editorOnDidChangeViewZones=observableSignalFromEvent("onDidChangeViewZones",this._editor.onDidChangeViewZones),this.editorOnDidContentSizeChange=observableSignalFromEvent("onDidContentSizeChange",this._editor.onDidContentSizeChange),this.domNodeSizeChanged=observableSignal("domNodeSizeChanged"),this.views=new Map,this._domNode.className="gutter monaco-editor";const o=this._domNode.appendChild(h("div.scroll-decoration",{role:"presentation",ariaHidden:"true",style:{width:"100%"}}).root),r=new ResizeObserver(()=>{transaction(l=>{this.domNodeSizeChanged.trigger(l)})});r.observe(this._domNode),this._register(toDisposable(()=>r.disconnect())),this._register(autorun(l=>{o.className=this.isScrollTopZero.read(l)?"":"scroll-decoration"})),this._register(autorun(l=>this.render(l)))}dispose(){super.dispose(),reset(this._domNode)}render(e){if(!this.modelAttached.read(e))return;this.domNodeSizeChanged.read(e),this.editorOnDidChangeViewZones.read(e),this.editorOnDidContentSizeChange.read(e);const t=this.scrollTop.read(e),s=this._editor.getVisibleRanges(),o=new Set(this.views.keys()),r=OffsetRange.ofStartAndLength(0,this._domNode.clientHeight);if(!r.isEmpty)for(const l of s){const c=new LineRange(l.startLineNumber,l.endLineNumber+1),d=this.itemProvider.getIntersectingGutterItems(c,e);transaction(u=>{for(const g of d){if(!g.range.intersect(c))continue;o.delete(g.id);let f=this.views.get(g.id);if(f)f.item.set(g,u);else{const C=document.createElement("div");this._domNode.appendChild(C);const b=observableValue("item",g),v=this.itemProvider.createView(b,C);f=new ManagedGutterItemView(b,v,C),this.views.set(g.id,f)}const p=g.range.startLineNumber<=this._editor.getModel().getLineCount()?this._editor.getTopForLineNumber(g.range.startLineNumber,!0)-t:g.range.startLineNumber>1?this._editor.getBottomForLineNumber(g.range.startLineNumber-1,!1)-t:0,_=(g.range.endLineNumberExclusive===1?Math.max(p,this._editor.getTopForLineNumber(g.range.startLineNumber,!1)-t):Math.max(p,this._editor.getBottomForLineNumber(g.range.endLineNumberExclusive-1,!0)-t))-p;f.domNode.style.top=`${p}px`,f.domNode.style.height=`${_}px`,f.gutterItemView.layout(OffsetRange.ofStartAndLength(p,_),r)}})}for(const l of o){const c=this.views.get(l);c.gutterItemView.dispose(),c.domNode.remove(),this.views.delete(l)}}}class ManagedGutterItemView{constructor(e,t,s){this.item=e,this.gutterItemView=t,this.domNode=s}}var __decorate$2l=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2j=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const emptyArr$1=[],width=35;let DiffEditorGutter=class extends Disposable{constructor(e,t,s,o,r,l,c,d,u){super(),this._diffModel=t,this._editors=s,this._options=o,this._sashLayout=r,this._boundarySashes=l,this._instantiationService=c,this._contextKeyService=d,this._menuService=u,this._menu=this._register(this._menuService.createMenu(MenuId.DiffEditorHunkToolbar,this._contextKeyService)),this._actions=observableFromEvent(this,this._menu.onDidChange,()=>this._menu.getActions()),this._hasActions=this._actions.map(f=>f.length>0),this._showSash=derived(this,f=>this._options.renderSideBySide.read(f)&&this._hasActions.read(f)),this.width=derived(this,f=>this._hasActions.read(f)?width:0),this.elements=h("div.gutter@gutter",{style:{position:"absolute",height:"100%",width:width+"px"}},[]),this._currentDiff=derived(this,f=>{var C;const p=this._diffModel.read(f);if(!p)return;const m=(C=p.diff.read(f))==null?void 0:C.mappings,_=this._editors.modifiedCursor.read(f);if(_)return m==null?void 0:m.find(b=>b.lineRangeMapping.modified.contains(_.lineNumber))}),this._selectedDiffs=derived(this,f=>{const p=this._diffModel.read(f),m=p==null?void 0:p.diff.read(f);if(!m)return emptyArr$1;const _=this._editors.modifiedSelections.read(f);if(_.every(S=>S.isEmpty()))return emptyArr$1;const C=new LineRangeSet(_.map(S=>LineRange.fromRangeInclusive(S))),v=m.mappings.filter(S=>S.lineRangeMapping.innerChanges&&C.intersects(S.lineRangeMapping.modified)).map(S=>({mapping:S,rangeMappings:S.lineRangeMapping.innerChanges.filter(y=>_.some(w=>Range$2.areIntersecting(y.modifiedRange,w)))}));return v.length===0||v.every(S=>S.rangeMappings.length===0)?emptyArr$1:v}),this._register(prependRemoveOnDispose(e,this.elements.root)),this._register(addDisposableListener(this.elements.root,"click",()=>{this._editors.modified.focus()})),this._register(applyStyle(this.elements.root,{display:this._hasActions.map(f=>f?"block":"none")})),derivedDisposable(this,f=>this._showSash.read(f)?new DiffEditorSash(e,this._sashLayout.dimensions,this._options.enableSplitViewResizing,this._boundarySashes,derivedWithSetter(this,m=>this._sashLayout.sashLeft.read(m)-width,(m,_)=>this._sashLayout.sashLeft.set(m+width,_)),()=>this._sashLayout.resetSash()):void 0).recomputeInitiallyAndOnChange(this._store);const g=derived(this,f=>{const p=this._diffModel.read(f);if(!p)return[];const m=p.diff.read(f);if(!m)return[];const _=this._selectedDiffs.read(f);if(_.length>0){const b=DetailedLineRangeMapping.fromRangeMappings(_.flatMap(v=>v.rangeMappings));return[new DiffGutterItem(b,!0,MenuId.DiffEditorSelectionToolbar,void 0,p.model.original.uri,p.model.modified.uri)]}const C=this._currentDiff.read(f);return m.mappings.map(b=>new DiffGutterItem(b.lineRangeMapping.withInnerChangesFromLineRanges(),b.lineRangeMapping===(C==null?void 0:C.lineRangeMapping),MenuId.DiffEditorHunkToolbar,void 0,p.model.original.uri,p.model.modified.uri))});this._register(new EditorGutter(this._editors.modified,this.elements.root,{getIntersectingGutterItems:(f,p)=>g.read(p),createView:(f,p)=>this._instantiationService.createInstance(DiffToolBar,f,p,this)})),this._register(addDisposableListener(this.elements.gutter,EventType$1.MOUSE_WHEEL,f=>{this._editors.modified.getOption(117).handleMouseWheel&&this._editors.modified.delegateScrollFromMouseWheelEvent(f)},{passive:!1}))}computeStagedValue(e){const t=e.innerChanges??[],s=new TextModelText(this._editors.modifiedModel.get()),o=new TextModelText(this._editors.original.getModel());return new TextEdit(t.map(c=>c.toTextEdit(s))).apply(o)}layout(e){this.elements.gutter.style.left=e+"px"}};DiffEditorGutter=__decorate$2l([__param$2j(6,IInstantiationService),__param$2j(7,IContextKeyService),__param$2j(8,IMenuService)],DiffEditorGutter);class DiffGutterItem{constructor(e,t,s,o,r,l){this.mapping=e,this.showAlways=t,this.menuId=s,this.rangeOverride=o,this.originalUri=r,this.modifiedUri=l}get id(){return this.mapping.modified.toString()}get range(){return this.rangeOverride??this.mapping.modified}}let DiffToolBar=class extends Disposable{constructor(e,t,s,o){super(),this._item=e,this._elements=h("div.gutterItem",{style:{height:"20px",width:"34px"}},[h("div.background@background",{},[]),h("div.buttons@buttons",{},[])]),this._showAlways=this._item.map(this,l=>l.showAlways),this._menuId=this._item.map(this,l=>l.menuId),this._isSmall=observableValue(this,!1),this._lastItemRange=void 0,this._lastViewRange=void 0;const r=this._register(o.createInstance(WorkbenchHoverDelegate,"element",{instantHover:!0},{position:{hoverPosition:1}}));this._register(appendRemoveOnDispose(t,this._elements.root)),this._register(autorun(l=>{const c=this._showAlways.read(l);this._elements.root.classList.toggle("noTransition",!0),this._elements.root.classList.toggle("showAlways",c),setTimeout(()=>{this._elements.root.classList.toggle("noTransition",!1)},0)})),this._register(autorunWithStore((l,c)=>{this._elements.buttons.replaceChildren();const d=c.add(o.createInstance(MenuWorkbenchToolBar,this._elements.buttons,this._menuId.read(l),{orientation:1,hoverDelegate:r,toolbarOptions:{primaryGroup:u=>u.startsWith("primary")},overflowBehavior:{maxItems:this._isSmall.read(l)?1:3},hiddenItemStrategy:0,actionRunner:c.add(new ActionRunnerWithContext(()=>{const u=this._item.read(void 0),g=u.mapping;return{mapping:g,originalWithModifiedChanges:s.computeStagedValue(g),originalUri:u.originalUri,modifiedUri:u.modifiedUri}})),menuOptions:{shouldForwardArgs:!0}}));c.add(d.onDidChangeMenuItems(()=>{this._lastItemRange&&this.layout(this._lastItemRange,this._lastViewRange)}))}))}layout(e,t){this._lastItemRange=e,this._lastViewRange=t;let s=this._elements.buttons.clientHeight;this._isSmall.set(this._item.get().mapping.original.startLineNumber===1&&e.length<30,void 0),s=this._elements.buttons.clientHeight;const o=e.length/2-s/2,r=s;let l=e.start+o;const c=OffsetRange.tryCreate(r,t.endExclusive-r-s),d=OffsetRange.tryCreate(e.start+r,e.endExclusive-s-r);d&&c&&d.start<d.endExclusive&&(l=c.clip(l),l=d.clip(l)),this._elements.buttons.style.top=`${l-e.start}px`}};DiffToolBar=__decorate$2l([__param$2j(3,IInstantiationService)],DiffToolBar);var __decorate$2k=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2i=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},HideUnchangedRegionsFeature_1,_i;let HideUnchangedRegionsFeature=(_i=class extends Disposable{static setBreadcrumbsSourceFactory(e){this._breadcrumbsSourceFactory.set(e,void 0)}get isUpdatingHiddenAreas(){return this._isUpdatingHiddenAreas}constructor(e,t,s,o){super(),this._editors=e,this._diffModel=t,this._options=s,this._instantiationService=o,this._modifiedOutlineSource=derivedDisposable(this,d=>{const u=this._editors.modifiedModel.read(d),g=HideUnchangedRegionsFeature_1._breadcrumbsSourceFactory.read(d);return!u||!g?void 0:g(u,this._instantiationService)}),this._isUpdatingHiddenAreas=!1,this._register(this._editors.original.onDidChangeCursorPosition(d=>{if(d.reason===1)return;const u=this._diffModel.get();transaction(g=>{for(const f of this._editors.original.getSelections()||[])u==null||u.ensureOriginalLineIsVisible(f.getStartPosition().lineNumber,0,g),u==null||u.ensureOriginalLineIsVisible(f.getEndPosition().lineNumber,0,g)})})),this._register(this._editors.modified.onDidChangeCursorPosition(d=>{if(d.reason===1)return;const u=this._diffModel.get();transaction(g=>{for(const f of this._editors.modified.getSelections()||[])u==null||u.ensureModifiedLineIsVisible(f.getStartPosition().lineNumber,0,g),u==null||u.ensureModifiedLineIsVisible(f.getEndPosition().lineNumber,0,g)})}));const r=this._diffModel.map((d,u)=>{var f;const g=(d==null?void 0:d.unchangedRegions.read(u))??[];return g.length===1&&g[0].modifiedLineNumber===1&&g[0].lineCount===((f=this._editors.modifiedModel.read(u))==null?void 0:f.getLineCount())?[]:g});this.viewZones=derived(this,d=>{const u=this._modifiedOutlineSource.read(d);if(!u)return{origViewZones:[],modViewZones:[]};const g=[],f=[],p=this._options.renderSideBySide.read(d),m=this._options.compactMode.read(d),_=r.read(d);for(let C=0;C<_.length;C++){const b=_[C];if(!b.shouldHideControls(d)&&!(m&&(C===0||C===_.length-1)))if(m){{const v=derived(this,y=>b.getHiddenOriginalRange(y).startLineNumber-1),S=new PlaceholderViewZone(v,12);g.push(S),d.store.add(new CompactCollapsedCodeOverlayWidget(this._editors.original,S,b,!p))}{const v=derived(this,y=>b.getHiddenModifiedRange(y).startLineNumber-1),S=new PlaceholderViewZone(v,12);f.push(S),d.store.add(new CompactCollapsedCodeOverlayWidget(this._editors.modified,S,b))}}else{{const v=derived(this,y=>b.getHiddenOriginalRange(y).startLineNumber-1),S=new PlaceholderViewZone(v,24);g.push(S),d.store.add(new CollapsedCodeOverlayWidget(this._editors.original,S,b,b.originalUnchangedRange,!p,u,y=>this._diffModel.get().ensureModifiedLineIsVisible(y,2,void 0),this._options))}{const v=derived(this,y=>b.getHiddenModifiedRange(y).startLineNumber-1),S=new PlaceholderViewZone(v,24);f.push(S),d.store.add(new CollapsedCodeOverlayWidget(this._editors.modified,S,b,b.modifiedUnchangedRange,!1,u,y=>this._diffModel.get().ensureModifiedLineIsVisible(y,2,void 0),this._options))}}}return{origViewZones:g,modViewZones:f}});const l={description:"unchanged lines",className:"diff-unchanged-lines",isWholeLine:!0},c={description:"Fold Unchanged",glyphMarginHoverMessage:new MarkdownString(void 0,{isTrusted:!0,supportThemeIcons:!0}).appendMarkdown(localize(121,"Fold Unchanged Region")),glyphMarginClassName:"fold-unchanged "+ThemeIcon.asClassName(Codicon.fold),zIndex:10001};this._register(applyObservableDecorations(this._editors.original,derived(this,d=>{const u=r.read(d),g=u.map(f=>({range:f.originalUnchangedRange.toInclusiveRange(),options:l}));for(const f of u)f.shouldHideControls(d)&&g.push({range:Range$2.fromPositions(new Position$1(f.originalLineNumber,1)),options:c});return g}))),this._register(applyObservableDecorations(this._editors.modified,derived(this,d=>{const u=r.read(d),g=u.map(f=>({range:f.modifiedUnchangedRange.toInclusiveRange(),options:l}));for(const f of u)f.shouldHideControls(d)&&g.push({range:LineRange.ofLength(f.modifiedLineNumber,1).toInclusiveRange(),options:c});return g}))),this._register(autorun(d=>{const u=r.read(d);this._isUpdatingHiddenAreas=!0;try{this._editors.original.setHiddenAreas(u.map(g=>g.getHiddenOriginalRange(d).toInclusiveRange()).filter(isDefined)),this._editors.modified.setHiddenAreas(u.map(g=>g.getHiddenModifiedRange(d).toInclusiveRange()).filter(isDefined))}finally{this._isUpdatingHiddenAreas=!1}})),this._register(this._editors.modified.onMouseUp(d=>{var u;if(!d.event.rightButton&&d.target.position&&((u=d.target.element)!=null&&u.className.includes("fold-unchanged"))){const g=d.target.position.lineNumber,f=this._diffModel.get();if(!f)return;const p=f.unchangedRegions.get().find(m=>m.modifiedUnchangedRange.contains(g));if(!p)return;p.collapseAll(void 0),d.event.stopPropagation(),d.event.preventDefault()}})),this._register(this._editors.original.onMouseUp(d=>{var u;if(!d.event.rightButton&&d.target.position&&((u=d.target.element)!=null&&u.className.includes("fold-unchanged"))){const g=d.target.position.lineNumber,f=this._diffModel.get();if(!f)return;const p=f.unchangedRegions.get().find(m=>m.originalUnchangedRange.contains(g));if(!p)return;p.collapseAll(void 0),d.event.stopPropagation(),d.event.preventDefault()}}))}},HideUnchangedRegionsFeature_1=_i,_i._breadcrumbsSourceFactory=observableValue(HideUnchangedRegionsFeature_1,()=>({dispose(){},getBreadcrumbItems(e,t){return[]}})),_i);HideUnchangedRegionsFeature=HideUnchangedRegionsFeature_1=__decorate$2k([__param$2i(3,IInstantiationService)],HideUnchangedRegionsFeature);class CompactCollapsedCodeOverlayWidget extends ViewZoneOverlayWidget{constructor(e,t,s,o=!1){const r=h("div.diff-hidden-lines-widget");super(e,t,r.root),this._unchangedRegion=s,this._hide=o,this._nodes=h("div.diff-hidden-lines-compact",[h("div.line-left",[]),h("div.text@text",[]),h("div.line-right",[])]),r.root.appendChild(this._nodes.root),this._hide&&this._nodes.root.replaceChildren(),this._register(autorun(l=>{if(!this._hide){const c=this._unchangedRegion.getHiddenModifiedRange(l).length,d=localize(122,"{0} hidden lines",c);this._nodes.text.innerText=d}}))}}class CollapsedCodeOverlayWidget extends ViewZoneOverlayWidget{constructor(e,t,s,o,r,l,c,d){const u=h("div.diff-hidden-lines-widget");super(e,t,u.root),this._editor=e,this._unchangedRegion=s,this._unchangedRegionRange=o,this._hide=r,this._modifiedOutlineSource=l,this._revealModifiedHiddenLine=c,this._options=d,this._nodes=h("div.diff-hidden-lines",[h("div.top@top",{title:localize(123,"Click or drag to show more above")}),h("div.center@content",{style:{display:"flex"}},[h("div@first",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexShrink:"0"}},[$$l("a",{title:localize(124,"Show Unchanged Region"),role:"button",onclick:()=>{this._unchangedRegion.showAll(void 0)}},...renderLabelWithIcons("$(unfold)"))]),h("div@others",{style:{display:"flex",justifyContent:"center",alignItems:"center"}})]),h("div.bottom@bottom",{title:localize(125,"Click or drag to show more below"),role:"button"})]),u.root.appendChild(this._nodes.root),this._hide?reset(this._nodes.first):this._register(applyStyle(this._nodes.first,{width:observableCodeEditor(this._editor).layoutInfoContentLeft})),this._register(autorun(f=>{const p=this._unchangedRegion.visibleLineCountTop.read(f)+this._unchangedRegion.visibleLineCountBottom.read(f)===this._unchangedRegion.lineCount;this._nodes.bottom.classList.toggle("canMoveTop",!p),this._nodes.bottom.classList.toggle("canMoveBottom",this._unchangedRegion.visibleLineCountBottom.read(f)>0),this._nodes.top.classList.toggle("canMoveTop",this._unchangedRegion.visibleLineCountTop.read(f)>0),this._nodes.top.classList.toggle("canMoveBottom",!p);const m=this._unchangedRegion.isDragged.read(f),_=this._editor.getDomNode();_&&(_.classList.toggle("draggingUnchangedRegion",!!m),m==="top"?(_.classList.toggle("canMoveTop",this._unchangedRegion.visibleLineCountTop.read(f)>0),_.classList.toggle("canMoveBottom",!p)):m==="bottom"?(_.classList.toggle("canMoveTop",!p),_.classList.toggle("canMoveBottom",this._unchangedRegion.visibleLineCountBottom.read(f)>0)):(_.classList.toggle("canMoveTop",!1),_.classList.toggle("canMoveBottom",!1)))}));const g=this._editor;this._register(addDisposableListener(this._nodes.top,"mousedown",f=>{if(f.button!==0)return;this._nodes.top.classList.toggle("dragging",!0),this._nodes.root.classList.toggle("dragging",!0),f.preventDefault();const p=f.clientY;let m=!1;const _=this._unchangedRegion.visibleLineCountTop.get();this._unchangedRegion.isDragged.set("top",void 0);const C=getWindow(this._nodes.top),b=addDisposableListener(C,"mousemove",S=>{const w=S.clientY-p;m=m||Math.abs(w)>2;const L=Math.round(w/g.getOption(75)),x=Math.max(0,Math.min(_+L,this._unchangedRegion.getMaxVisibleLineCountTop()));this._unchangedRegion.visibleLineCountTop.set(x,void 0)}),v=addDisposableListener(C,"mouseup",S=>{m||this._unchangedRegion.showMoreAbove(this._options.hideUnchangedRegionsRevealLineCount.get(),void 0),this._nodes.top.classList.toggle("dragging",!1),this._nodes.root.classList.toggle("dragging",!1),this._unchangedRegion.isDragged.set(void 0,void 0),b.dispose(),v.dispose()})})),this._register(addDisposableListener(this._nodes.bottom,"mousedown",f=>{if(f.button!==0)return;this._nodes.bottom.classList.toggle("dragging",!0),this._nodes.root.classList.toggle("dragging",!0),f.preventDefault();const p=f.clientY;let m=!1;const _=this._unchangedRegion.visibleLineCountBottom.get();this._unchangedRegion.isDragged.set("bottom",void 0);const C=getWindow(this._nodes.bottom),b=addDisposableListener(C,"mousemove",S=>{const w=S.clientY-p;m=m||Math.abs(w)>2;const L=Math.round(w/g.getOption(75)),x=Math.max(0,Math.min(_-L,this._unchangedRegion.getMaxVisibleLineCountBottom())),E=this._unchangedRegionRange.endLineNumberExclusive>g.getModel().getLineCount()?g.getContentHeight():g.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);this._unchangedRegion.visibleLineCountBottom.set(x,void 0);const I=this._unchangedRegionRange.endLineNumberExclusive>g.getModel().getLineCount()?g.getContentHeight():g.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);g.setScrollTop(g.getScrollTop()+(I-E))}),v=addDisposableListener(C,"mouseup",S=>{if(this._unchangedRegion.isDragged.set(void 0,void 0),!m){const y=g.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);this._unchangedRegion.showMoreBelow(this._options.hideUnchangedRegionsRevealLineCount.get(),void 0);const w=g.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);g.setScrollTop(g.getScrollTop()+(w-y))}this._nodes.bottom.classList.toggle("dragging",!1),this._nodes.root.classList.toggle("dragging",!1),b.dispose(),v.dispose()})})),this._register(autorun(f=>{const p=[];if(!this._hide){const m=s.getHiddenModifiedRange(f).length,_=localize(126,"{0} hidden lines",m),C=$$l("span",{title:localize(127,"Double click to unfold")},_);C.addEventListener("dblclick",S=>{S.button===0&&(S.preventDefault(),this._unchangedRegion.showAll(void 0))}),p.push(C);const b=this._unchangedRegion.getHiddenModifiedRange(f),v=this._modifiedOutlineSource.getBreadcrumbItems(b,f);if(v.length>0){p.push($$l("span",void 0,"  |  "));for(let S=0;S<v.length;S++){const y=v[S],w=SymbolKinds.toIcon(y.kind),L=h("div.breadcrumb-item",{style:{display:"flex",alignItems:"center"}},[renderIcon(w)," ",y.name,...S===v.length-1?[]:[renderIcon(Codicon.chevronRight)]]).root;p.push(L),L.onclick=()=>{this._revealModifiedHiddenLine(y.startLineNumber)}}}}reset(this._nodes.others,...p)}))}}const emptyArr=[];class RevertButtonsFeature extends Disposable{constructor(e,t,s,o){super(),this._editors=e,this._diffModel=t,this._options=s,this._widget=o,this._selectedDiffs=derived(this,r=>{const l=this._diffModel.read(r),c=l==null?void 0:l.diff.read(r);if(!c)return emptyArr;const d=this._editors.modifiedSelections.read(r);if(d.every(p=>p.isEmpty()))return emptyArr;const u=new LineRangeSet(d.map(p=>LineRange.fromRangeInclusive(p))),f=c.mappings.filter(p=>p.lineRangeMapping.innerChanges&&u.intersects(p.lineRangeMapping.modified)).map(p=>({mapping:p,rangeMappings:p.lineRangeMapping.innerChanges.filter(m=>d.some(_=>Range$2.areIntersecting(m.modifiedRange,_)))}));return f.length===0||f.every(p=>p.rangeMappings.length===0)?emptyArr:f}),this._register(autorunWithStore((r,l)=>{if(!this._options.shouldRenderOldRevertArrows.read(r))return;const c=this._diffModel.read(r),d=c==null?void 0:c.diff.read(r);if(!c||!d||c.movedTextToCompare.read(r))return;const u=[],g=this._selectedDiffs.read(r),f=new Set(g.map(p=>p.mapping));if(g.length>0){const p=this._editors.modifiedSelections.read(r),m=l.add(new RevertButton(p[p.length-1].positionLineNumber,this._widget,g.flatMap(_=>_.rangeMappings),!0));this._editors.modified.addGlyphMarginWidget(m),u.push(m)}for(const p of d.mappings)if(!f.has(p)&&!p.lineRangeMapping.modified.isEmpty&&p.lineRangeMapping.innerChanges){const m=l.add(new RevertButton(p.lineRangeMapping.modified.startLineNumber,this._widget,p.lineRangeMapping,!1));this._editors.modified.addGlyphMarginWidget(m),u.push(m)}l.add(toDisposable(()=>{for(const p of u)this._editors.modified.removeGlyphMarginWidget(p)}))}))}}const xs=class xs extends Disposable{getId(){return this._id}constructor(e,t,s,o){super(),this._lineNumber=e,this._widget=t,this._diffs=s,this._revertSelection=o,this._id=`revertButton${xs.counter++}`,this._domNode=h("div.revertButton",{title:this._revertSelection?localize(132,"Revert Selected Changes"):localize(133,"Revert Change")},[renderIcon(Codicon.arrowRight)]).root,this._register(addDisposableListener(this._domNode,EventType$1.MOUSE_DOWN,r=>{r.button!==2&&(r.stopPropagation(),r.preventDefault())})),this._register(addDisposableListener(this._domNode,EventType$1.MOUSE_UP,r=>{r.stopPropagation(),r.preventDefault()})),this._register(addDisposableListener(this._domNode,EventType$1.CLICK,r=>{this._diffs instanceof LineRangeMapping?this._widget.revert(this._diffs):this._widget.revertRangeMappings(this._diffs),r.stopPropagation(),r.preventDefault()}))}getDomNode(){return this._domNode}getPosition(){return{lane:GlyphMarginLane$1.Right,range:{startColumn:1,startLineNumber:this._lineNumber,endColumn:1,endLineNumber:this._lineNumber},zIndex:10001}}};xs.counter=0;let RevertButton=xs;const style$1="";var __decorate$2j=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2h=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let DiffEditorWidget=class extends DelegatingEditor{get onDidContentSizeChange(){return this._editors.onDidContentSizeChange}constructor(e,t,s,o,r,l,c,d){super(),this._domElement=e,this._parentContextKeyService=o,this._parentInstantiationService=r,this._accessibilitySignalService=c,this._editorProgressService=d,this.elements=h("div.monaco-diff-editor.side-by-side",{style:{position:"relative",height:"100%"}},[h("div.editor.original@original",{style:{position:"absolute",height:"100%"}}),h("div.editor.modified@modified",{style:{position:"absolute",height:"100%"}}),h("div.accessibleDiffViewer@accessibleDiffViewer",{style:{position:"absolute",height:"100%"}})]),this._diffModelSrc=this._register(disposableObservableValue(this,void 0)),this._diffModel=derived(this,w=>{var L;return(L=this._diffModelSrc.read(w))==null?void 0:L.object}),this.onDidChangeModel=Event$1.fromObservableLight(this._diffModel),this._contextKeyService=this._register(this._parentContextKeyService.createScoped(this._domElement)),this._instantiationService=this._register(this._parentInstantiationService.createChild(new ServiceCollection([IContextKeyService,this._contextKeyService]))),this._boundarySashes=observableValue(this,void 0),this._accessibleDiffViewerShouldBeVisible=observableValue(this,!1),this._accessibleDiffViewerVisible=derived(this,w=>this._options.onlyShowAccessibleDiffViewer.read(w)?!0:this._accessibleDiffViewerShouldBeVisible.read(w)),this._movedBlocksLinesPart=observableValue(this,void 0),this._layoutInfo=derived(this,w=>{var W,B;const L=this._rootSizeObserver.width.read(w),x=this._rootSizeObserver.height.read(w);this._rootSizeObserver.automaticLayout?this.elements.root.style.height="100%":this.elements.root.style.height=x+"px";const E=this._sash.read(w),I=this._gutter.read(w),D=(I==null?void 0:I.width.read(w))??0,k=((W=this._overviewRulerPart.read(w))==null?void 0:W.width)??0;let N,R,M,A,O;if(!!E){const H=E.sashLeft.read(w),V=((B=this._movedBlocksLinesPart.read(w))==null?void 0:B.width.read(w))??0;N=0,R=H-D-V,O=H-D,M=H,A=L-M-k}else{O=0;const H=this._options.inlineViewHideOriginalLineNumbers.read(w);N=D,H?R=0:R=Math.max(5,this._editors.originalObs.layoutInfoDecorationsLeft.read(w)),M=D+R,A=L-M-k}return this.elements.original.style.left=N+"px",this.elements.original.style.width=R+"px",this._editors.original.layout({width:R,height:x},!0),I==null||I.layout(O),this.elements.modified.style.left=M+"px",this.elements.modified.style.width=A+"px",this._editors.modified.layout({width:A,height:x},!0),{modifiedEditor:this._editors.modified.getLayoutInfo(),originalEditor:this._editors.original.getLayoutInfo()}}),this._diffValue=this._diffModel.map((w,L)=>w==null?void 0:w.diff.read(L)),this.onDidUpdateDiff=Event$1.fromObservableLight(this._diffValue),l.willCreateDiffEditor(),this._contextKeyService.createKey("isInDiffEditor",!0),this._domElement.appendChild(this.elements.root),this._register(toDisposable(()=>this.elements.root.remove())),this._rootSizeObserver=this._register(new ObservableElementSizeObserver(this.elements.root,t.dimension)),this._rootSizeObserver.setAutomaticLayout(t.automaticLayout??!1),this._options=this._instantiationService.createInstance(DiffEditorOptions,t),this._register(autorun(w=>{this._options.setWidth(this._rootSizeObserver.width.read(w))})),this._contextKeyService.createKey(EditorContextKeys.isEmbeddedDiffEditor.key,!1),this._register(bindContextKey(EditorContextKeys.isEmbeddedDiffEditor,this._contextKeyService,w=>this._options.isInEmbeddedEditor.read(w))),this._register(bindContextKey(EditorContextKeys.comparingMovedCode,this._contextKeyService,w=>{var L;return!!((L=this._diffModel.read(w))!=null&&L.movedTextToCompare.read(w))})),this._register(bindContextKey(EditorContextKeys.diffEditorRenderSideBySideInlineBreakpointReached,this._contextKeyService,w=>this._options.couldShowInlineViewBecauseOfSize.read(w))),this._register(bindContextKey(EditorContextKeys.diffEditorInlineMode,this._contextKeyService,w=>!this._options.renderSideBySide.read(w))),this._register(bindContextKey(EditorContextKeys.hasChanges,this._contextKeyService,w=>{var L,x;return(((x=(L=this._diffModel.read(w))==null?void 0:L.diff.read(w))==null?void 0:x.mappings.length)??0)>0})),this._editors=this._register(this._instantiationService.createInstance(DiffEditorEditors,this.elements.original,this.elements.modified,this._options,s,(w,L,x,E)=>this._createInnerEditor(w,L,x,E))),this._register(bindContextKey(EditorContextKeys.diffEditorOriginalWritable,this._contextKeyService,w=>this._options.originalEditable.read(w))),this._register(bindContextKey(EditorContextKeys.diffEditorModifiedWritable,this._contextKeyService,w=>!this._options.readOnly.read(w))),this._register(bindContextKey(EditorContextKeys.diffEditorOriginalUri,this._contextKeyService,w=>{var L;return((L=this._diffModel.read(w))==null?void 0:L.model.original.uri.toString())??""})),this._register(bindContextKey(EditorContextKeys.diffEditorModifiedUri,this._contextKeyService,w=>{var L;return((L=this._diffModel.read(w))==null?void 0:L.model.modified.uri.toString())??""})),this._overviewRulerPart=derivedDisposable(this,w=>this._options.renderOverviewRuler.read(w)?this._instantiationService.createInstance(readHotReloadableExport(OverviewRulerFeature),this._editors,this.elements.root,this._diffModel,this._rootSizeObserver.width,this._rootSizeObserver.height,this._layoutInfo.map(L=>L.modifiedEditor)):void 0).recomputeInitiallyAndOnChange(this._store);const u={height:this._rootSizeObserver.height,width:this._rootSizeObserver.width.map((w,L)=>{var x;return w-(((x=this._overviewRulerPart.read(L))==null?void 0:x.width)??0)})};this._sashLayout=new SashLayout(this._options,u),this._sash=derivedDisposable(this,w=>{const L=this._options.renderSideBySide.read(w);return this.elements.root.classList.toggle("side-by-side",L),L?new DiffEditorSash(this.elements.root,u,this._options.enableSplitViewResizing,this._boundarySashes,this._sashLayout.sashLeft,()=>this._sashLayout.resetSash()):void 0}).recomputeInitiallyAndOnChange(this._store);const g=derivedDisposable(this,w=>this._instantiationService.createInstance(readHotReloadableExport(HideUnchangedRegionsFeature),this._editors,this._diffModel,this._options)).recomputeInitiallyAndOnChange(this._store);derivedDisposable(this,w=>this._instantiationService.createInstance(readHotReloadableExport(DiffEditorDecorations),this._editors,this._diffModel,this._options,this)).recomputeInitiallyAndOnChange(this._store);const f=new Set,p=new Set;let m=!1;const _=derivedDisposable(this,w=>this._instantiationService.createInstance(readHotReloadableExport(DiffEditorViewZones),getWindow(this._domElement),this._editors,this._diffModel,this._options,this,()=>m||g.read(void 0).isUpdatingHiddenAreas,f,p)).recomputeInitiallyAndOnChange(this._store),C=derived(this,w=>{const L=_.read(w).viewZones.read(w).orig,x=g.read(w).viewZones.read(w).origViewZones;return L.concat(x)}),b=derived(this,w=>{const L=_.read(w).viewZones.read(w).mod,x=g.read(w).viewZones.read(w).modViewZones;return L.concat(x)});this._register(applyViewZones(this._editors.original,C,w=>{m=w},f));let v;this._register(applyViewZones(this._editors.modified,b,w=>{m=w,m?v=StableEditorScrollState.capture(this._editors.modified):(v==null||v.restore(this._editors.modified),v=void 0)},p)),this._accessibleDiffViewer=derivedDisposable(this,w=>this._instantiationService.createInstance(readHotReloadableExport(AccessibleDiffViewer),this.elements.accessibleDiffViewer,this._accessibleDiffViewerVisible,(L,x)=>this._accessibleDiffViewerShouldBeVisible.set(L,x),this._options.onlyShowAccessibleDiffViewer.map(L=>!L),this._rootSizeObserver.width,this._rootSizeObserver.height,this._diffModel.map((L,x)=>{var E;return(E=L==null?void 0:L.diff.read(x))==null?void 0:E.mappings.map(I=>I.lineRangeMapping)}),new AccessibleDiffViewerModelFromEditors(this._editors))).recomputeInitiallyAndOnChange(this._store);const S=this._accessibleDiffViewerVisible.map(w=>w?"hidden":"visible");this._register(applyStyle(this.elements.modified,{visibility:S})),this._register(applyStyle(this.elements.original,{visibility:S})),this._createDiffEditorContributions(),l.addDiffEditor(this),this._gutter=derivedDisposable(this,w=>this._options.shouldRenderGutterMenu.read(w)?this._instantiationService.createInstance(readHotReloadableExport(DiffEditorGutter),this.elements.root,this._diffModel,this._editors,this._options,this._sashLayout,this._boundarySashes):void 0),this._register(recomputeInitiallyAndOnChange(this._layoutInfo)),derivedDisposable(this,w=>new(readHotReloadableExport(MovedBlocksLinesFeature))(this.elements.root,this._diffModel,this._layoutInfo.map(L=>L.originalEditor),this._layoutInfo.map(L=>L.modifiedEditor),this._editors)).recomputeInitiallyAndOnChange(this._store,w=>{this._movedBlocksLinesPart.set(w,void 0)}),this._register(Event$1.runAndSubscribe(this._editors.modified.onDidChangeCursorPosition,w=>this._handleCursorPositionChange(w,!0))),this._register(Event$1.runAndSubscribe(this._editors.original.onDidChangeCursorPosition,w=>this._handleCursorPositionChange(w,!1)));const y=this._diffModel.map(this,(w,L)=>{if(w)return w.diff.read(L)===void 0&&!w.isDiffUpToDate.read(L)});this._register(autorunWithStore((w,L)=>{if(y.read(w)===!0){const x=this._editorProgressService.show(!0,1e3);L.add(toDisposable(()=>x.done()))}})),this._register(autorunWithStore((w,L)=>{L.add(new(readHotReloadableExport(RevertButtonsFeature))(this._editors,this._diffModel,this._options,this))})),this._register(autorunWithStore((w,L)=>{const x=this._diffModel.read(w);if(x)for(const E of[x.model.original,x.model.modified])L.add(E.onWillDispose(I=>{onUnexpectedError(new BugIndicatingError("TextModel got disposed before DiffEditorWidget model got reset")),this.setModel(null)}))})),this._register(autorun(w=>{this._options.setModel(this._diffModel.read(w))}))}_createInnerEditor(e,t,s,o){return e.createInstance(CodeEditorWidget,t,s,o)}_createDiffEditorContributions(){const e=EditorExtensionsRegistry.getDiffEditorContributions();for(const t of e)try{this._register(this._instantiationService.createInstance(t.ctor,this))}catch(s){onUnexpectedError(s)}}get _targetEditor(){return this._editors.modified}getEditorType(){return EditorType.IDiffEditor}layout(e){this._rootSizeObserver.observe(e)}hasTextFocus(){return this._editors.original.hasTextFocus()||this._editors.modified.hasTextFocus()}saveViewState(){var s;const e=this._editors.original.saveViewState(),t=this._editors.modified.saveViewState();return{original:e,modified:t,modelState:(s=this._diffModel.get())==null?void 0:s.serializeState()}}restoreViewState(e){var t;if(e&&e.original&&e.modified){const s=e;this._editors.original.restoreViewState(s.original),this._editors.modified.restoreViewState(s.modified),s.modelState&&((t=this._diffModel.get())==null||t.restoreSerializedState(s.modelState))}}handleInitialized(){this._editors.original.handleInitialized(),this._editors.modified.handleInitialized()}createViewModel(e){return this._instantiationService.createInstance(DiffEditorViewModel,e,this._options)}getModel(){var e;return((e=this._diffModel.get())==null?void 0:e.model)??null}setModel(e){const t=e?"model"in e?RefCounted.create(e).createNewRef(this):RefCounted.create(this.createViewModel(e),this):null;this.setDiffModel(t)}setDiffModel(e,t){const s=this._diffModel.get();!e&&s&&this._accessibleDiffViewer.get().close(),this._diffModel.get()!==(e==null?void 0:e.object)&&subtransaction(t,o=>{var c;const r=e==null?void 0:e.object;observableFromEvent.batchEventsGlobally(o,()=>{this._editors.original.setModel(r?r.model.original:null),this._editors.modified.setModel(r?r.model.modified:null)});const l=(c=this._diffModelSrc.get())==null?void 0:c.createNewRef(this);this._diffModelSrc.set(e==null?void 0:e.createNewRef(this),o),setTimeout(()=>{l==null||l.dispose()},0)})}updateOptions(e){this._options.updateOptions(e)}getContainerDomNode(){return this._domElement}getOriginalEditor(){return this._editors.original}getModifiedEditor(){return this._editors.modified}getLineChanges(){var t;const e=(t=this._diffModel.get())==null?void 0:t.diff.get();return e?toLineChanges(e):null}revert(e){const t=this._diffModel.get();!t||!t.isDiffUpToDate.get()||this._editors.modified.executeEdits("diffEditor",[{range:e.modified.toExclusiveRange(),text:t.model.original.getValueInRange(e.original.toExclusiveRange())}])}revertRangeMappings(e){const t=this._diffModel.get();if(!t||!t.isDiffUpToDate.get())return;const s=e.map(o=>({range:o.modifiedRange,text:t.model.original.getValueInRange(o.originalRange)}));this._editors.modified.executeEdits("diffEditor",s)}revertFocusedRangeMappings(){var d,u;const e=this._diffModel.get();if(!e||!e.isDiffUpToDate.get())return;const t=(u=(d=this._diffModel.get())==null?void 0:d.diff.get())==null?void 0:u.mappings;if(!t||t.length===0)return;const s=this._editors.modified;if(!s.hasTextFocus())return;const o=s.getPosition().lineNumber,r=s.getSelection(),l=LineRange.fromRange(r||new Range$2(o,0,o,0)),c=t.filter(g=>g.lineRangeMapping.modified.intersect(l));s.executeEdits("diffEditor",c.map(g=>({range:g.lineRangeMapping.modified.toExclusiveRange(),text:e.model.original.getValueInRange(g.lineRangeMapping.original.toExclusiveRange())})))}_goTo(e){this._editors.modified.setPosition(new Position$1(e.lineRangeMapping.modified.startLineNumber,1)),this._editors.modified.revealRangeInCenter(e.lineRangeMapping.modified.toExclusiveRange())}goToDiff(e){var r,l;const t=(l=(r=this._diffModel.get())==null?void 0:r.diff.get())==null?void 0:l.mappings;if(!t||t.length===0)return;const s=this._editors.modified.getPosition().lineNumber;let o;e==="next"?this._editors.modified.getModel().getLineCount()===s?o=t[0]:o=t.find(d=>d.lineRangeMapping.modified.startLineNumber>s)??t[0]:o=findLast(t,c=>c.lineRangeMapping.modified.startLineNumber<s)??t[t.length-1],this._goTo(o),o.lineRangeMapping.modified.isEmpty?this._accessibilitySignalService.playSignal(AccessibilitySignal.diffLineDeleted,{source:"diffEditor.goToDiff"}):o.lineRangeMapping.original.isEmpty?this._accessibilitySignalService.playSignal(AccessibilitySignal.diffLineInserted,{source:"diffEditor.goToDiff"}):o&&this._accessibilitySignalService.playSignal(AccessibilitySignal.diffLineModified,{source:"diffEditor.goToDiff"})}revealFirstDiff(){const e=this._diffModel.get();e&&this.waitForDiff().then(()=>{var s;const t=(s=e.diff.get())==null?void 0:s.mappings;!t||t.length===0||this._goTo(t[0])})}accessibleDiffViewerNext(){this._accessibleDiffViewer.get().next()}accessibleDiffViewerPrev(){this._accessibleDiffViewer.get().prev()}async waitForDiff(){const e=this._diffModel.get();e&&await e.waitForDiff()}mapToOtherSide(){var l,c;const e=this._editors.modified.hasWidgetFocus(),t=e?this._editors.modified:this._editors.original,s=e?this._editors.original:this._editors.modified;let o;const r=t.getSelection();if(r){const d=(c=(l=this._diffModel.get())==null?void 0:l.diff.get())==null?void 0:c.mappings.map(u=>e?u.lineRangeMapping.flip():u.lineRangeMapping);if(d){const u=translatePosition(r.getStartPosition(),d),g=translatePosition(r.getEndPosition(),d);o=Range$2.plusRange(u,g)}}return{destination:s,destinationSelection:o}}switchSide(){const{destination:e,destinationSelection:t}=this.mapToOtherSide();e.focus(),t&&e.setSelection(t)}exitCompareMove(){const e=this._diffModel.get();e&&e.movedTextToCompare.set(void 0,void 0)}collapseAllUnchangedRegions(){var t;const e=(t=this._diffModel.get())==null?void 0:t.unchangedRegions.get();e&&transaction(s=>{for(const o of e)o.collapseAll(s)})}showAllUnchangedRegions(){var t;const e=(t=this._diffModel.get())==null?void 0:t.unchangedRegions.get();e&&transaction(s=>{for(const o of e)o.showAll(s)})}_handleCursorPositionChange(e,t){var s,o;if((e==null?void 0:e.reason)===3){const r=(o=(s=this._diffModel.get())==null?void 0:s.diff.get())==null?void 0:o.mappings.find(l=>t?l.lineRangeMapping.modified.contains(e.position.lineNumber):l.lineRangeMapping.original.contains(e.position.lineNumber));r!=null&&r.lineRangeMapping.modified.isEmpty?this._accessibilitySignalService.playSignal(AccessibilitySignal.diffLineDeleted,{source:"diffEditor.cursorPositionChanged"}):r!=null&&r.lineRangeMapping.original.isEmpty?this._accessibilitySignalService.playSignal(AccessibilitySignal.diffLineInserted,{source:"diffEditor.cursorPositionChanged"}):r&&this._accessibilitySignalService.playSignal(AccessibilitySignal.diffLineModified,{source:"diffEditor.cursorPositionChanged"})}}};DiffEditorWidget=__decorate$2j([__param$2h(3,IContextKeyService),__param$2h(4,IInstantiationService),__param$2h(5,ICodeEditorService),__param$2h(6,IAccessibilitySignalService),__param$2h(7,IEditorProgressService)],DiffEditorWidget);function toLineChanges(a){return a.mappings.map(e=>{const t=e.lineRangeMapping;let s,o,r,l,c=t.innerChanges;return t.original.isEmpty?(s=t.original.startLineNumber-1,o=0,c=void 0):(s=t.original.startLineNumber,o=t.original.endLineNumberExclusive-1),t.modified.isEmpty?(r=t.modified.startLineNumber-1,l=0,c=void 0):(r=t.modified.startLineNumber,l=t.modified.endLineNumberExclusive-1),{originalStartLineNumber:s,originalEndLineNumber:o,modifiedStartLineNumber:r,modifiedEndLineNumber:l,charChanges:c==null?void 0:c.map(d=>({originalStartLineNumber:d.originalRange.startLineNumber,originalStartColumn:d.originalRange.startColumn,originalEndLineNumber:d.originalRange.endLineNumber,originalEndColumn:d.originalRange.endColumn,modifiedStartLineNumber:d.modifiedRange.startLineNumber,modifiedStartColumn:d.modifiedRange.startColumn,modifiedEndLineNumber:d.modifiedRange.endLineNumber,modifiedEndColumn:d.modifiedRange.endColumn}))}})}class ToggleCollapseUnchangedRegions extends Action2{constructor(){super({id:"diffEditor.toggleCollapseUnchangedRegions",title:localize2(82,"Toggle Collapse Unchanged Regions"),icon:Codicon.map,toggled:ContextKeyExpr.has("config.diffEditor.hideUnchangedRegions.enabled"),precondition:ContextKeyExpr.has("isInDiffEditor"),menu:{when:ContextKeyExpr.has("isInDiffEditor"),id:MenuId.EditorTitle,order:22,group:"navigation"}})}run(e,...t){const s=e.get(IConfigurationService),o=!s.getValue("diffEditor.hideUnchangedRegions.enabled");s.updateValue("diffEditor.hideUnchangedRegions.enabled",o)}}class ToggleShowMovedCodeBlocks extends Action2{constructor(){super({id:"diffEditor.toggleShowMovedCodeBlocks",title:localize2(83,"Toggle Show Moved Code Blocks"),precondition:ContextKeyExpr.has("isInDiffEditor")})}run(e,...t){const s=e.get(IConfigurationService),o=!s.getValue("diffEditor.experimental.showMoves");s.updateValue("diffEditor.experimental.showMoves",o)}}class ToggleUseInlineViewWhenSpaceIsLimited extends Action2{constructor(){super({id:"diffEditor.toggleUseInlineViewWhenSpaceIsLimited",title:localize2(84,"Toggle Use Inline View When Space Is Limited"),precondition:ContextKeyExpr.has("isInDiffEditor")})}run(e,...t){const s=e.get(IConfigurationService),o=!s.getValue("diffEditor.useInlineViewWhenSpaceIsLimited");s.updateValue("diffEditor.useInlineViewWhenSpaceIsLimited",o)}}const diffEditorCategory=localize2(85,"Diff Editor");class SwitchSide extends EditorAction2{constructor(){super({id:"diffEditor.switchSide",title:localize2(86,"Switch Side"),icon:Codicon.arrowSwap,precondition:ContextKeyExpr.has("isInDiffEditor"),f1:!0,category:diffEditorCategory})}runEditorCommand(e,t,s){const o=findFocusedDiffEditor(e);if(o instanceof DiffEditorWidget){if(s&&s.dryRun)return{destinationSelection:o.mapToOtherSide().destinationSelection};o.switchSide()}}}class ExitCompareMove extends EditorAction2{constructor(){super({id:"diffEditor.exitCompareMove",title:localize2(87,"Exit Compare Move"),icon:Codicon.close,precondition:EditorContextKeys.comparingMovedCode,f1:!1,category:diffEditorCategory,keybinding:{weight:1e4,primary:9}})}runEditorCommand(e,t,...s){const o=findFocusedDiffEditor(e);o instanceof DiffEditorWidget&&o.exitCompareMove()}}class CollapseAllUnchangedRegions extends EditorAction2{constructor(){super({id:"diffEditor.collapseAllUnchangedRegions",title:localize2(88,"Collapse All Unchanged Regions"),icon:Codicon.fold,precondition:ContextKeyExpr.has("isInDiffEditor"),f1:!0,category:diffEditorCategory})}runEditorCommand(e,t,...s){const o=findFocusedDiffEditor(e);o instanceof DiffEditorWidget&&o.collapseAllUnchangedRegions()}}class ShowAllUnchangedRegions extends EditorAction2{constructor(){super({id:"diffEditor.showAllUnchangedRegions",title:localize2(89,"Show All Unchanged Regions"),icon:Codicon.unfold,precondition:ContextKeyExpr.has("isInDiffEditor"),f1:!0,category:diffEditorCategory})}runEditorCommand(e,t,...s){const o=findFocusedDiffEditor(e);o instanceof DiffEditorWidget&&o.showAllUnchangedRegions()}}class RevertHunkOrSelection extends Action2{constructor(){super({id:"diffEditor.revert",title:localize2(90,"Revert"),f1:!0,category:diffEditorCategory,precondition:ContextKeyExpr.has("isInDiffEditor")})}run(e,t){return t?this.runViaToolbarContext(e,t):this.runViaCursorOrSelection(e)}runViaCursorOrSelection(e){const t=findFocusedDiffEditor(e);t instanceof DiffEditorWidget&&t.revertFocusedRangeMappings()}runViaToolbarContext(e,t){const s=findDiffEditor(e,t.originalUri,t.modifiedUri);s instanceof DiffEditorWidget&&s.revertRangeMappings(t.mapping.innerChanges??[])}}const accessibleDiffViewerCategory=localize2(91,"Accessible Diff Viewer"),Is=class Is extends Action2{constructor(){super({id:Is.id,title:localize2(92,"Go to Next Difference"),category:accessibleDiffViewerCategory,precondition:ContextKeyExpr.has("isInDiffEditor"),keybinding:{primary:65,weight:100},f1:!0})}run(e){const t=findFocusedDiffEditor(e);t==null||t.accessibleDiffViewerNext()}};Is.id="editor.action.accessibleDiffViewer.next";let AccessibleDiffViewerNext=Is;const Ds=class Ds extends Action2{constructor(){super({id:Ds.id,title:localize2(93,"Go to Previous Difference"),category:accessibleDiffViewerCategory,precondition:ContextKeyExpr.has("isInDiffEditor"),keybinding:{primary:1089,weight:100},f1:!0})}run(e){const t=findFocusedDiffEditor(e);t==null||t.accessibleDiffViewerPrev()}};Ds.id="editor.action.accessibleDiffViewer.prev";let AccessibleDiffViewerPrev=Ds;function findDiffEditor(a,e,t){return a.get(ICodeEditorService).listDiffEditors().find(r=>{var d,u;const l=r.getModifiedEditor(),c=r.getOriginalEditor();return l&&((d=l.getModel())==null?void 0:d.uri.toString())===t.toString()&&c&&((u=c.getModel())==null?void 0:u.uri.toString())===e.toString()})||null}function findFocusedDiffEditor(a){const t=a.get(ICodeEditorService).listDiffEditors(),s=getActiveElement();if(s){for(const o of t)if(o.getContainerDomNode().contains(s))return o}return null}registerAction2(ToggleCollapseUnchangedRegions);registerAction2(ToggleShowMovedCodeBlocks);registerAction2(ToggleUseInlineViewWhenSpaceIsLimited);MenuRegistry.appendMenuItem(MenuId.EditorTitle,{command:{id:new ToggleUseInlineViewWhenSpaceIsLimited().desc.id,title:localize(116,"Use Inline View When Space Is Limited"),toggled:ContextKeyExpr.has("config.diffEditor.useInlineViewWhenSpaceIsLimited"),precondition:ContextKeyExpr.has("isInDiffEditor")},order:11,group:"1_diff",when:ContextKeyExpr.and(EditorContextKeys.diffEditorRenderSideBySideInlineBreakpointReached,ContextKeyExpr.has("isInDiffEditor"))});MenuRegistry.appendMenuItem(MenuId.EditorTitle,{command:{id:new ToggleShowMovedCodeBlocks().desc.id,title:localize(117,"Show Moved Code Blocks"),icon:Codicon.move,toggled:ContextKeyEqualsExpr.create("config.diffEditor.experimental.showMoves",!0),precondition:ContextKeyExpr.has("isInDiffEditor")},order:10,group:"1_diff",when:ContextKeyExpr.has("isInDiffEditor")});registerAction2(RevertHunkOrSelection);for(const a of[{icon:Codicon.arrowRight,key:EditorContextKeys.diffEditorInlineMode.toNegated()},{icon:Codicon.discard,key:EditorContextKeys.diffEditorInlineMode}])MenuRegistry.appendMenuItem(MenuId.DiffEditorHunkToolbar,{command:{id:new RevertHunkOrSelection().desc.id,title:localize(118,"Revert Block"),icon:a.icon},when:ContextKeyExpr.and(EditorContextKeys.diffEditorModifiedWritable,a.key),order:5,group:"primary"}),MenuRegistry.appendMenuItem(MenuId.DiffEditorSelectionToolbar,{command:{id:new RevertHunkOrSelection().desc.id,title:localize(119,"Revert Selection"),icon:a.icon},when:ContextKeyExpr.and(EditorContextKeys.diffEditorModifiedWritable,a.key),order:5,group:"primary"});registerAction2(SwitchSide);registerAction2(ExitCompareMove);registerAction2(CollapseAllUnchangedRegions);registerAction2(ShowAllUnchangedRegions);MenuRegistry.appendMenuItem(MenuId.EditorTitle,{command:{id:AccessibleDiffViewerNext.id,title:localize(120,"Open Accessible Diff Viewer"),precondition:ContextKeyExpr.has("isInDiffEditor")},order:10,group:"2_diff",when:ContextKeyExpr.and(EditorContextKeys.accessibleDiffViewerVisible.negate(),ContextKeyExpr.has("isInDiffEditor"))});CommandsRegistry.registerCommandAlias("editor.action.diffReview.next",AccessibleDiffViewerNext.id);registerAction2(AccessibleDiffViewerNext);CommandsRegistry.registerCommandAlias("editor.action.diffReview.prev",AccessibleDiffViewerPrev.id);registerAction2(AccessibleDiffViewerPrev);const anchorSelect="";var __decorate$2i=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2g=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},SelectionAnchorController_1;const SelectionAnchorSet=new RawContextKey("selectionAnchorSet",!1);var Ci;let SelectionAnchorController=(Ci=class{static get(e){return e.getContribution(SelectionAnchorController_1.ID)}constructor(e,t){this.editor=e,this.selectionAnchorSetContextKey=SelectionAnchorSet.bindTo(t),this.modelChangeListener=e.onDidChangeModel(()=>this.selectionAnchorSetContextKey.reset())}setSelectionAnchor(){if(this.editor.hasModel()){const e=this.editor.getPosition();this.editor.changeDecorations(t=>{this.decorationId&&t.removeDecoration(this.decorationId),this.decorationId=t.addDecoration(Selection$1.fromPositions(e,e),{description:"selection-anchor",stickiness:1,hoverMessage:new MarkdownString().appendText(localize(794,"Selection Anchor")),className:"selection-anchor"})}),this.selectionAnchorSetContextKey.set(!!this.decorationId),alert$1(localize(795,"Anchor set at {0}:{1}",e.lineNumber,e.column))}}goToSelectionAnchor(){if(this.editor.hasModel()&&this.decorationId){const e=this.editor.getModel().getDecorationRange(this.decorationId);e&&this.editor.setPosition(e.getStartPosition())}}selectFromAnchorToCursor(){if(this.editor.hasModel()&&this.decorationId){const e=this.editor.getModel().getDecorationRange(this.decorationId);if(e){const t=this.editor.getPosition();this.editor.setSelection(Selection$1.fromPositions(e.getStartPosition(),t)),this.cancelSelectionAnchor()}}}cancelSelectionAnchor(){if(this.decorationId){const e=this.decorationId;this.editor.changeDecorations(t=>{t.removeDecoration(e),this.decorationId=void 0}),this.selectionAnchorSetContextKey.set(!1)}}dispose(){this.cancelSelectionAnchor(),this.modelChangeListener.dispose()}},SelectionAnchorController_1=Ci,Ci.ID="editor.contrib.selectionAnchorController",Ci);SelectionAnchorController=SelectionAnchorController_1=__decorate$2i([__param$2g(1,IContextKeyService)],SelectionAnchorController);class SetSelectionAnchor extends EditorAction{constructor(){super({id:"editor.action.setSelectionAnchor",label:localize2(796,"Set Selection Anchor"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2080),weight:100}})}async run(e,t){var s;(s=SelectionAnchorController.get(t))==null||s.setSelectionAnchor()}}class GoToSelectionAnchor extends EditorAction{constructor(){super({id:"editor.action.goToSelectionAnchor",label:localize2(797,"Go to Selection Anchor"),precondition:SelectionAnchorSet})}async run(e,t){var s;(s=SelectionAnchorController.get(t))==null||s.goToSelectionAnchor()}}class SelectFromAnchorToCursor extends EditorAction{constructor(){super({id:"editor.action.selectFromAnchorToCursor",label:localize2(798,"Select from Anchor to Cursor"),precondition:SelectionAnchorSet,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2089),weight:100}})}async run(e,t){var s;(s=SelectionAnchorController.get(t))==null||s.selectFromAnchorToCursor()}}class CancelSelectionAnchor extends EditorAction{constructor(){super({id:"editor.action.cancelSelectionAnchor",label:localize2(799,"Cancel Selection Anchor"),precondition:SelectionAnchorSet,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:9,weight:100}})}async run(e,t){var s;(s=SelectionAnchorController.get(t))==null||s.cancelSelectionAnchor()}}registerEditorContribution(SelectionAnchorController.ID,SelectionAnchorController,4);registerEditorAction(SetSelectionAnchor);registerEditorAction(GoToSelectionAnchor);registerEditorAction(SelectFromAnchorToCursor);registerEditorAction(CancelSelectionAnchor);const bracketMatching="",overviewRulerBracketMatchForeground=registerColor("editorOverviewRuler.bracketMatchForeground","#A0A0A0",localize(800,"Overview ruler marker color for matching brackets."));class JumpToBracketAction extends EditorAction{constructor(){super({id:"editor.action.jumpToBracket",label:localize2(802,"Go to Bracket"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3165,weight:100}})}run(e,t){var s;(s=BracketMatchingController.get(t))==null||s.jumpToBracket()}}class SelectToBracketAction extends EditorAction{constructor(){super({id:"editor.action.selectToBracket",label:localize2(803,"Select to Bracket"),precondition:void 0,metadata:{description:localize2(804,"Select the text inside and including the brackets or curly braces"),args:[{name:"args",schema:{type:"object",properties:{selectBrackets:{type:"boolean",default:!0}}}}]}})}run(e,t,s){var r;let o=!0;s&&s.selectBrackets===!1&&(o=!1),(r=BracketMatchingController.get(t))==null||r.selectToBracket(o)}}class RemoveBracketsAction extends EditorAction{constructor(){super({id:"editor.action.removeBrackets",label:localize2(805,"Remove Brackets"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2561,weight:100}})}run(e,t){var s;(s=BracketMatchingController.get(t))==null||s.removeBrackets(this.id)}}class BracketsData{constructor(e,t,s){this.position=e,this.brackets=t,this.options=s}}const tt=class tt extends Disposable{static get(e){return e.getContribution(tt.ID)}constructor(e){super(),this._editor=e,this._lastBracketsData=[],this._lastVersionId=0,this._decorations=this._editor.createDecorationsCollection(),this._updateBracketsSoon=this._register(new RunOnceScheduler(()=>this._updateBrackets(),50)),this._matchBrackets=this._editor.getOption(80),this._updateBracketsSoon.schedule(),this._register(e.onDidChangeCursorPosition(t=>{this._matchBrackets!=="never"&&this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModelContent(t=>{this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModel(t=>{this._lastBracketsData=[],this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModelLanguageConfiguration(t=>{this._lastBracketsData=[],this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeConfiguration(t=>{t.hasChanged(80)&&(this._matchBrackets=this._editor.getOption(80),this._decorations.clear(),this._lastBracketsData=[],this._lastVersionId=0,this._updateBracketsSoon.schedule())})),this._register(e.onDidBlurEditorWidget(()=>{this._updateBracketsSoon.schedule()})),this._register(e.onDidFocusEditorWidget(()=>{this._updateBracketsSoon.schedule()}))}jumpToBracket(){if(!this._editor.hasModel())return;const e=this._editor.getModel(),t=this._editor.getSelections().map(s=>{const o=s.getStartPosition(),r=e.bracketPairs.matchBracket(o);let l=null;if(r)r[0].containsPosition(o)&&!r[1].containsPosition(o)?l=r[1].getStartPosition():r[1].containsPosition(o)&&(l=r[0].getStartPosition());else{const c=e.bracketPairs.findEnclosingBrackets(o);if(c)l=c[1].getStartPosition();else{const d=e.bracketPairs.findNextBracket(o);d&&d.range&&(l=d.range.getStartPosition())}}return l?new Selection$1(l.lineNumber,l.column,l.lineNumber,l.column):new Selection$1(o.lineNumber,o.column,o.lineNumber,o.column)});this._editor.setSelections(t),this._editor.revealRange(t[0])}selectToBracket(e){if(!this._editor.hasModel())return;const t=this._editor.getModel(),s=[];this._editor.getSelections().forEach(o=>{const r=o.getStartPosition();let l=t.bracketPairs.matchBracket(r);if(!l&&(l=t.bracketPairs.findEnclosingBrackets(r),!l)){const u=t.bracketPairs.findNextBracket(r);u&&u.range&&(l=t.bracketPairs.matchBracket(u.range.getStartPosition()))}let c=null,d=null;if(l){l.sort(Range$2.compareRangesUsingStarts);const[u,g]=l;if(c=e?u.getStartPosition():u.getEndPosition(),d=e?g.getEndPosition():g.getStartPosition(),g.containsPosition(r)){const f=c;c=d,d=f}}c&&d&&s.push(new Selection$1(c.lineNumber,c.column,d.lineNumber,d.column))}),s.length>0&&(this._editor.setSelections(s),this._editor.revealRange(s[0]))}removeBrackets(e){if(!this._editor.hasModel())return;const t=this._editor.getModel();this._editor.getSelections().forEach(s=>{const o=s.getPosition();let r=t.bracketPairs.matchBracket(o);r||(r=t.bracketPairs.findEnclosingBrackets(o)),r&&(this._editor.pushUndoStop(),this._editor.executeEdits(e,[{range:r[0],text:""},{range:r[1],text:""}]),this._editor.pushUndoStop())})}_updateBrackets(){if(this._matchBrackets==="never")return;this._recomputeBrackets();const e=[];let t=0;for(const s of this._lastBracketsData){const o=s.brackets;o&&(e[t++]={range:o[0],options:s.options},e[t++]={range:o[1],options:s.options})}this._decorations.set(e)}_recomputeBrackets(){if(!this._editor.hasModel()||!this._editor.hasWidgetFocus()){this._lastBracketsData=[],this._lastVersionId=0;return}const e=this._editor.getSelections();if(e.length>100){this._lastBracketsData=[],this._lastVersionId=0;return}const t=this._editor.getModel(),s=t.getVersionId();let o=[];this._lastVersionId===s&&(o=this._lastBracketsData);const r=[];let l=0;for(let f=0,p=e.length;f<p;f++){const m=e[f];m.isEmpty()&&(r[l++]=m.getStartPosition())}r.length>1&&r.sort(Position$1.compare);const c=[];let d=0,u=0;const g=o.length;for(let f=0,p=r.length;f<p;f++){const m=r[f];for(;u<g&&o[u].position.isBefore(m);)u++;if(u<g&&o[u].position.equals(m))c[d++]=o[u];else{let _=t.bracketPairs.matchBracket(m,20),C=tt._DECORATION_OPTIONS_WITH_OVERVIEW_RULER;!_&&this._matchBrackets==="always"&&(_=t.bracketPairs.findEnclosingBrackets(m,20),C=tt._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER),c[d++]=new BracketsData(m,_,C)}}this._lastBracketsData=c,this._lastVersionId=s}};tt.ID="editor.contrib.bracketMatchingController",tt._DECORATION_OPTIONS_WITH_OVERVIEW_RULER=ModelDecorationOptions.register({description:"bracket-match-overview",stickiness:1,className:"bracket-match",overviewRuler:{color:themeColorFromId(overviewRulerBracketMatchForeground),position:OverviewRulerLane$1.Center}}),tt._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER=ModelDecorationOptions.register({description:"bracket-match-no-overview",stickiness:1,className:"bracket-match"});let BracketMatchingController=tt;registerEditorContribution(BracketMatchingController.ID,BracketMatchingController,1);registerEditorAction(SelectToBracketAction);registerEditorAction(JumpToBracketAction);registerEditorAction(RemoveBracketsAction);MenuRegistry.appendMenuItem(MenuId.MenubarGoMenu,{group:"5_infile_nav",command:{id:"editor.action.jumpToBracket",title:localize(801,"Go to &&Bracket")},order:2});class MoveCaretCommand{constructor(e,t){this._selection=e,this._isMovingLeft=t}getEditOperations(e,t){if(this._selection.startLineNumber!==this._selection.endLineNumber||this._selection.isEmpty())return;const s=this._selection.startLineNumber,o=this._selection.startColumn,r=this._selection.endColumn;if(!(this._isMovingLeft&&o===1)&&!(!this._isMovingLeft&&r===e.getLineMaxColumn(s)))if(this._isMovingLeft){const l=new Range$2(s,o-1,s,o),c=e.getValueInRange(l);t.addEditOperation(l,null),t.addEditOperation(new Range$2(s,r,s,r),c)}else{const l=new Range$2(s,r,s,r+1),c=e.getValueInRange(l);t.addEditOperation(l,null),t.addEditOperation(new Range$2(s,o,s,o),c)}}computeCursorState(e,t){return this._isMovingLeft?new Selection$1(this._selection.startLineNumber,this._selection.startColumn-1,this._selection.endLineNumber,this._selection.endColumn-1):new Selection$1(this._selection.startLineNumber,this._selection.startColumn+1,this._selection.endLineNumber,this._selection.endColumn+1)}}class MoveCaretAction extends EditorAction{constructor(e,t){super(t),this.left=e}run(e,t){if(!t.hasModel())return;const s=[],o=t.getSelections();for(const r of o)s.push(new MoveCaretCommand(r,this.left));t.pushUndoStop(),t.executeCommands(this.id,s),t.pushUndoStop()}}class MoveCaretLeftAction extends MoveCaretAction{constructor(){super(!0,{id:"editor.action.moveCarretLeftAction",label:localize2(806,"Move Selected Text Left"),precondition:EditorContextKeys.writable})}}class MoveCaretRightAction extends MoveCaretAction{constructor(){super(!1,{id:"editor.action.moveCarretRightAction",label:localize2(807,"Move Selected Text Right"),precondition:EditorContextKeys.writable})}}registerEditorAction(MoveCaretLeftAction);registerEditorAction(MoveCaretRightAction);class TransposeLettersAction extends EditorAction{constructor(){super({id:"editor.action.transposeLetters",label:localize2(808,"Transpose Letters"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:306},weight:100}})}run(e,t){if(!t.hasModel())return;const s=t.getModel(),o=[],r=t.getSelections();for(const l of r){if(!l.isEmpty())continue;const c=l.startLineNumber,d=l.startColumn,u=s.getLineMaxColumn(c);if(c===1&&(d===1||d===2&&u===2))continue;const g=d===u?l.getPosition():MoveOperations.rightPosition(s,l.getPosition().lineNumber,l.getPosition().column),f=MoveOperations.leftPosition(s,g),p=MoveOperations.leftPosition(s,f),m=s.getValueInRange(Range$2.fromPositions(p,f)),_=s.getValueInRange(Range$2.fromPositions(f,g)),C=Range$2.fromPositions(p,g);o.push(new ReplaceCommand(C,_+m))}o.length>0&&(t.pushUndoStop(),t.executeCommands(this.id,o),t.pushUndoStop())}}registerEditorAction(TransposeLettersAction);const IProductService=createDecorator("productService");function createStringDataTransferItem(a,e){return{id:e,asString:async()=>a,asFile:()=>{},value:typeof a=="string"?a:void 0}}function createFileDataTransferItem(a,e,t,s){const o={id:generateUuid(),name:a,uri:e,data:t};return{id:s,asString:async()=>"",asFile:()=>o,value:void 0}}class VSDataTransfer{constructor(){this._entries=new Map}get size(){let e=0;for(const t of this._entries)e++;return e}has(e){return this._entries.has(this.toKey(e))}matches(e){const t=[...this._entries.keys()];return Iterable.some(this,([s,o])=>o.asFile())&&t.push("files"),matchesMimeType_normalized(normalizeMimeType(e),t)}get(e){var t;return(t=this._entries.get(this.toKey(e)))==null?void 0:t[0]}append(e,t){const s=this._entries.get(e);s?s.push(t):this._entries.set(this.toKey(e),[t])}replace(e,t){this._entries.set(this.toKey(e),[t])}delete(e){this._entries.delete(this.toKey(e))}*[Symbol.iterator](){for(const[e,t]of this._entries)for(const s of t)yield[e,s]}toKey(e){return normalizeMimeType(e)}}function normalizeMimeType(a){return a.toLowerCase()}function matchesMimeType(a,e){return matchesMimeType_normalized(normalizeMimeType(a),e.map(normalizeMimeType))}function matchesMimeType_normalized(a,e){if(a==="*/*")return e.length>0;if(e.includes(a))return!0;const t=a.match(/^([a-z]+)\/([a-z]+|\*)$/i);if(!t)return!1;const[s,o,r]=t;return r==="*"?e.some(l=>l.startsWith(o+"/")):!1}const UriList=Object.freeze({create:a=>distinct(a.map(e=>e.toString())).join(`\r
`),split:a=>a.split(`\r
`),parse:a=>UriList.split(a).filter(e=>!e.startsWith("#"))}),We=class We{constructor(e){this.value=e}equals(e){return this.value===e.value}contains(e){return this.equals(e)||this.value===""||e.value.startsWith(this.value+We.sep)}intersects(e){return this.contains(e)||e.contains(this)}append(...e){return new We((this.value?[this.value,...e]:e).join(We.sep))}};We.sep=".",We.None=new We("@@none@@"),We.Empty=new We("");let HierarchicalKind=We;const NO_KEY_MODS={ctrlCmd:!1,alt:!1};var QuickInputHideReason;(function(a){a[a.Blur=1]="Blur",a[a.Gesture=2]="Gesture",a[a.Other=3]="Other"})(QuickInputHideReason||(QuickInputHideReason={}));var ItemActivation;(function(a){a[a.NONE=0]="NONE",a[a.FIRST=1]="FIRST",a[a.SECOND=2]="SECOND",a[a.LAST=3]="LAST"})(ItemActivation||(ItemActivation={}));var QuickPickFocus;(function(a){a[a.First=1]="First",a[a.Second=2]="Second",a[a.Last=3]="Last",a[a.Next=4]="Next",a[a.Previous=5]="Previous",a[a.NextPage=6]="NextPage",a[a.PreviousPage=7]="PreviousPage",a[a.NextSeparator=8]="NextSeparator",a[a.PreviousSeparator=9]="PreviousSeparator"})(QuickPickFocus||(QuickPickFocus={}));var QuickInputButtonLocation;(function(a){a[a.Title=1]="Title",a[a.Inline=2]="Inline"})(QuickInputButtonLocation||(QuickInputButtonLocation={}));const IQuickInputService=createDecorator("quickInputService"),CodeDataTransfers={EDITORS:"CodeEditors",FILES:"CodeFiles",SYMBOLS:"application/vnd.code.symbols",MARKERS:"application/vnd.code.diagnostics",NOTEBOOK_CELL_OUTPUT:"notebook-cell-output",SCM_HISTORY_ITEM:"scm-history-item"};class DragAndDropContributionRegistry{}const Extensions$1={DragAndDropContribution:"workbench.contributions.dragAndDrop"};Registry.add(Extensions$1.DragAndDropContribution,new DragAndDropContributionRegistry);const _n=class _n{constructor(){}static getInstance(){return _n.INSTANCE}hasData(e){return e&&e===this.proto}getData(e){if(this.hasData(e))return this.data}};_n.INSTANCE=new _n;let LocalSelectionTransfer=_n;function getPathForFile(a){var e,t;if(isNative&&typeof((t=(e=globalThis.vscode)==null?void 0:e.webUtils)==null?void 0:t.getPathForFile)=="function")return globalThis.vscode.webUtils.getPathForFile(a)}function toVSDataTransfer(a){const e=new VSDataTransfer;for(const t of a.items){const s=t.type;if(t.kind==="string"){const o=new Promise(r=>t.getAsString(r));e.append(s,createStringDataTransferItem(o))}else if(t.kind==="file"){const o=t.getAsFile();o&&e.append(s,createFileDataTransferItemFromFile(o))}}return e}function createFileDataTransferItemFromFile(a){const e=getPathForFile(a),t=e?URI.parse(e):void 0;return createFileDataTransferItem(a.name,t,async()=>new Uint8Array(await a.arrayBuffer()))}const INTERNAL_DND_MIME_TYPES=Object.freeze([CodeDataTransfers.EDITORS,CodeDataTransfers.FILES,DataTransfers.RESOURCES,DataTransfers.INTERNAL_URI_LIST]);function toExternalVSDataTransfer(a,e=!1){const t=toVSDataTransfer(a),s=t.get(DataTransfers.INTERNAL_URI_LIST);if(s)t.replace(Mimes.uriList,s);else if(e||!t.has(Mimes.uriList)){const o=[];for(const r of a.items){const l=r.getAsFile();if(l){const c=getPathForFile(l);try{c?o.push(URI.file(c).toString()):o.push(URI.parse(l.name,!0).toString())}catch{}}}o.length&&t.replace(Mimes.uriList,createStringDataTransferItem(UriList.create(o)))}for(const o of INTERNAL_DND_MIME_TYPES)t.delete(o);return t}const IBulkEditService=createDecorator("IWorkspaceEditService");class ResourceEdit{constructor(e){this.metadata=e}static convert(e){return e.edits.map(t=>{if(ResourceTextEdit.is(t))return ResourceTextEdit.lift(t);if(ResourceFileEdit.is(t))return ResourceFileEdit.lift(t);throw new Error("Unsupported edit")})}}class ResourceTextEdit extends ResourceEdit{static is(e){return e instanceof ResourceTextEdit?!0:isObject(e)&&URI.isUri(e.resource)&&isObject(e.textEdit)}static lift(e){return e instanceof ResourceTextEdit?e:new ResourceTextEdit(e.resource,e.textEdit,e.versionId,e.metadata)}constructor(e,t,s=void 0,o){super(o),this.resource=e,this.textEdit=t,this.versionId=s}}class ResourceFileEdit extends ResourceEdit{static is(e){return e instanceof ResourceFileEdit?!0:isObject(e)&&(!!e.newResource||!!e.oldResource)}static lift(e){return e instanceof ResourceFileEdit?e:new ResourceFileEdit(e.oldResource,e.newResource,e.options,e.metadata)}constructor(e,t,s={},o){super(o),this.oldResource=e,this.newResource=t,this.options=s}}const IEditorCancellationTokens=createDecorator("IEditorCancelService"),ctxCancellableOperation=new RawContextKey("cancellableOperation",!1,localize(934,"Whether the editor runs a cancellable operation, e.g. like 'Peek References'"));registerSingleton(IEditorCancellationTokens,class{constructor(){this._tokens=new WeakMap}add(a,e){let t=this._tokens.get(a);t||(t=a.invokeWithinContext(o=>{const r=ctxCancellableOperation.bindTo(o.get(IContextKeyService)),l=new LinkedList;return{key:r,tokens:l}}),this._tokens.set(a,t));let s;return t.key.set(!0),s=t.tokens.push(e),()=>{s&&(s(),t.key.set(!t.tokens.isEmpty()),s=void 0)}}cancel(a){const e=this._tokens.get(a);if(!e)return;const t=e.tokens.pop();t&&(t.cancel(),e.key.set(!e.tokens.isEmpty()))}},1);class EditorKeybindingCancellationTokenSource extends CancellationTokenSource$1{constructor(e,t){super(t),this.editor=e,this._unregister=e.invokeWithinContext(s=>s.get(IEditorCancellationTokens).add(e,this))}dispose(){this._unregister(),super.dispose()}}registerEditorCommand(new class extends EditorCommand{constructor(){super({id:"editor.cancelOperation",kbOpts:{weight:100,primary:9},precondition:ctxCancellableOperation})}runEditorCommand(a,e){a.get(IEditorCancellationTokens).cancel(e)}});let EditorState$1=class Bo{constructor(e,t){if(this.flags=t,this.flags&1){const s=e.getModel();this.modelVersionId=s?format("{0}#{1}",s.uri.toString(),s.getVersionId()):null}else this.modelVersionId=null;this.flags&4?this.position=e.getPosition():this.position=null,this.flags&2?this.selection=e.getSelection():this.selection=null,this.flags&8?(this.scrollLeft=e.getScrollLeft(),this.scrollTop=e.getScrollTop()):(this.scrollLeft=-1,this.scrollTop=-1)}_equals(e){if(!(e instanceof Bo))return!1;const t=e;return!(this.modelVersionId!==t.modelVersionId||this.scrollLeft!==t.scrollLeft||this.scrollTop!==t.scrollTop||!this.position&&t.position||this.position&&!t.position||this.position&&t.position&&!this.position.equals(t.position)||!this.selection&&t.selection||this.selection&&!t.selection||this.selection&&t.selection&&!this.selection.equalsRange(t.selection))}validate(e){return this._equals(new Bo(e,this.flags))}};class EditorStateCancellationTokenSource extends EditorKeybindingCancellationTokenSource{constructor(e,t,s,o){super(e,o),this._listener=new DisposableStore,t&4&&this._listener.add(e.onDidChangeCursorPosition(r=>{(!s||!Range$2.containsPosition(s,r.position))&&this.cancel()})),t&2&&this._listener.add(e.onDidChangeCursorSelection(r=>{(!s||!Range$2.containsRange(s,r.selection))&&this.cancel()})),t&8&&this._listener.add(e.onDidScrollChange(r=>this.cancel())),t&1&&(this._listener.add(e.onDidChangeModel(r=>this.cancel())),this._listener.add(e.onDidChangeModelContent(r=>this.cancel())))}dispose(){this._listener.dispose(),super.dispose()}}class TextModelCancellationTokenSource extends CancellationTokenSource$1{constructor(e,t){super(t),this._listener=e.onDidChangeContent(()=>this.cancel())}dispose(){this._listener.dispose(),super.dispose()}}const inlineProgressWidget="";var __decorate$2h=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2f=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const inlineProgressDecoration=ModelDecorationOptions.register({description:"inline-progress-widget",stickiness:1,showIfCollapsed:!0,after:{content:noBreakWhitespace,inlineClassName:"inline-editor-progress-decoration",inlineClassNameAffectsLetterSpacing:!0}}),Ts=class Ts extends Disposable{constructor(e,t,s,o,r){super(),this.typeId=e,this.editor=t,this.range=s,this.delegate=r,this.allowEditorOverflow=!1,this.suppressMouseDown=!0,this.create(o),this.editor.addContentWidget(this),this.editor.layoutContentWidget(this)}create(e){this.domNode=$$l(".inline-progress-widget"),this.domNode.role="button",this.domNode.title=e;const t=$$l("span.icon");this.domNode.append(t),t.classList.add(...ThemeIcon.asClassNameArray(Codicon.loading),"codicon-modifier-spin");const s=()=>{const o=this.editor.getOption(75);this.domNode.style.height=`${o}px`,this.domNode.style.width=`${Math.ceil(.8*o)}px`};s(),this._register(this.editor.onDidChangeConfiguration(o=>{(o.hasChanged(61)||o.hasChanged(75))&&s()})),this._register(addDisposableListener(this.domNode,EventType$1.CLICK,o=>{this.delegate.cancel()}))}getId(){return Ts.baseId+"."+this.typeId}getDomNode(){return this.domNode}getPosition(){return{position:{lineNumber:this.range.startLineNumber,column:this.range.startColumn},preference:[0]}}dispose(){super.dispose(),this.editor.removeContentWidget(this)}};Ts.baseId="editor.widget.inlineProgressWidget";let InlineProgressWidget=Ts,InlineProgressManager=class extends Disposable{constructor(e,t,s){super(),this.id=e,this._editor=t,this._instantiationService=s,this._showDelay=500,this._showPromise=this._register(new MutableDisposable),this._currentWidget=this._register(new MutableDisposable),this._operationIdPool=0,this._currentDecorations=t.createDecorationsCollection()}dispose(){super.dispose(),this._currentDecorations.clear()}async showWhile(e,t,s,o,r){const l=this._operationIdPool++;this._currentOperation=l,this.clear(),this._showPromise.value=disposableTimeout(()=>{const c=Range$2.fromPositions(e);this._currentDecorations.set([{range:c,options:inlineProgressDecoration}]).length>0&&(this._currentWidget.value=this._instantiationService.createInstance(InlineProgressWidget,this.id,this._editor,c,t,o))},r??this._showDelay);try{return await s}finally{this._currentOperation===l&&(this.clear(),this._currentOperation=void 0)}}clear(){this._showPromise.clear(),this._currentDecorations.clear(),this._currentWidget.clear()}};InlineProgressManager=__decorate$2h([__param$2f(2,IInstantiationService)],InlineProgressManager);const messageController="",IOpenerService=createDecorator("openerService");function withSelection(a,e){return a.with({fragment:`${e.startLineNumber},${e.startColumn}${e.endLineNumber?`-${e.endLineNumber}${e.endColumn?`,${e.endColumn}`:""}`:""}`})}function extractSelection(a){let e;const t=/^L?(\d+)(?:,(\d+))?(-L?(\d+)(?:,(\d+))?)?/.exec(a.fragment);return t&&(e={startLineNumber:parseInt(t[1]),startColumn:t[2]?parseInt(t[2]):1,endLineNumber:t[4]?parseInt(t[4]):void 0,endColumn:t[4]?t[5]?parseInt(t[5]):1:void 0},a=a.with({fragment:""})),{selection:e,uri:a}}const renderedMarkdown="";var __decorate$2g=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2e=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},MarkdownRenderer_1,bi;let MarkdownRenderer=(bi=class{constructor(e,t,s){this._options=e,this._languageService=t,this._openerService=s}render(e,t,s){const o=renderMarkdown$1(e,{codeBlockRenderer:(r,l)=>this.renderCodeBlock(r,l),actionHandler:(r,l)=>this.openMarkdownLink(r,l),...t},s);return o.element.classList.add("rendered-markdown"),o}async renderCodeBlock(e,t){var l,c;let s;e?s=this._languageService.getLanguageIdByLanguageName(e):this._options.editor&&(s=(l=this._options.editor.getModel())==null?void 0:l.getLanguageId()),s||(s=PLAINTEXT_LANGUAGE_ID);const o=await tokenizeToString(this._languageService,t,s),r=document.createElement("span");if(r.innerHTML=((c=MarkdownRenderer_1._ttpTokenizer)==null?void 0:c.createHTML(o))??o,this._options.editor){const d=this._options.editor.getOption(59);applyFontInfo(r,d)}else this._options.codeBlockFontFamily&&(r.style.fontFamily=this._options.codeBlockFontFamily);return this._options.codeBlockFontSize!==void 0&&(r.style.fontSize=this._options.codeBlockFontSize),r}async openMarkdownLink(e,t){await openLinkFromMarkdown(this._openerService,e,t.isTrusted)}},MarkdownRenderer_1=bi,bi._ttpTokenizer=createTrustedTypesPolicy$1("tokenizeToString",{createHTML(e){return e}}),bi);MarkdownRenderer=MarkdownRenderer_1=__decorate$2g([__param$2e(1,ILanguageService),__param$2e(2,IOpenerService)],MarkdownRenderer);async function openLinkFromMarkdown(a,e,t,s){try{return await a.open(e,{fromUserGesture:!0,allowContributedOpeners:!0,allowCommands:toAllowCommandsOption(t),skipValidation:s})}catch(o){return onUnexpectedError(o),!1}}function toAllowCommandsOption(a){return a===!0?!0:a&&Array.isArray(a.enabledCommands)?a.enabledCommands:!1}var __decorate$2f=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2d=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},MessageController_1,Tt;let MessageController=(Tt=class{static get(e){return e.getContribution(MessageController_1.ID)}constructor(e,t,s){this._openerService=s,this._messageWidget=new MutableDisposable,this._messageListeners=new DisposableStore,this._mouseOverMessage=!1,this._editor=e,this._visible=MessageController_1.MESSAGE_VISIBLE.bindTo(t)}dispose(){this._messageListeners.dispose(),this._messageWidget.dispose(),this._visible.reset()}showMessage(e,t){if(alert$1(isMarkdownString(e)?e.value:e),this._visible.set(!0),this._messageWidget.clear(),this._messageListeners.clear(),isMarkdownString(e)){const o=this._messageListeners.add(renderMarkdown$1(e,{actionHandler:(r,l)=>{this.closeMessage(),openLinkFromMarkdown(this._openerService,r,l.isTrusted)}}));this._messageWidget.value=new MessageWidget$1(this._editor,t,o.element)}else this._messageWidget.value=new MessageWidget$1(this._editor,t,e);this._messageListeners.add(Event$1.debounce(this._editor.onDidBlurEditorText,(o,r)=>r,0)(()=>{this._mouseOverMessage||this._messageWidget.value&&isAncestor$1(getActiveElement(),this._messageWidget.value.getDomNode())||this.closeMessage()})),this._messageListeners.add(this._editor.onDidChangeCursorPosition(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidDispose(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidChangeModel(()=>this.closeMessage())),this._messageListeners.add(addDisposableListener(this._messageWidget.value.getDomNode(),EventType$1.MOUSE_ENTER,()=>this._mouseOverMessage=!0,!0)),this._messageListeners.add(addDisposableListener(this._messageWidget.value.getDomNode(),EventType$1.MOUSE_LEAVE,()=>this._mouseOverMessage=!1,!0));let s;this._messageListeners.add(this._editor.onMouseMove(o=>{o.target.position&&(s?s.containsPosition(o.target.position)||this.closeMessage():s=new Range$2(t.lineNumber-3,1,o.target.position.lineNumber+3,1))}))}closeMessage(){this._visible.reset(),this._messageListeners.clear(),this._messageWidget.value&&this._messageListeners.add(MessageWidget$1.fadeOut(this._messageWidget.value))}},MessageController_1=Tt,Tt.ID="editor.contrib.messageController",Tt.MESSAGE_VISIBLE=new RawContextKey("messageVisible",!1,localize(1277,"Whether the editor is currently showing an inline message")),Tt);MessageController=MessageController_1=__decorate$2f([__param$2d(1,IContextKeyService),__param$2d(2,IOpenerService)],MessageController);const MessageCommand=EditorCommand.bindToContribution(MessageController.get);registerEditorCommand(new MessageCommand({id:"leaveEditorMessage",precondition:MessageController.MESSAGE_VISIBLE,handler:a=>a.closeMessage(),kbOpts:{weight:100+30,primary:9}}));let MessageWidget$1=class{static fadeOut(e){const t=()=>{e.dispose(),clearTimeout(s),e.getDomNode().removeEventListener("animationend",t)},s=setTimeout(t,110);return e.getDomNode().addEventListener("animationend",t),e.getDomNode().classList.add("fadeOut"),{dispose:t}}constructor(e,{lineNumber:t,column:s},o){this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._editor=e,this._editor.revealLinesInCenterIfOutsideViewport(t,t,0),this._position={lineNumber:t,column:s},this._domNode=document.createElement("div"),this._domNode.classList.add("monaco-editor-overlaymessage"),this._domNode.style.marginLeft="-6px";const r=document.createElement("div");r.classList.add("anchor","top"),this._domNode.appendChild(r);const l=document.createElement("div");typeof o=="string"?(l.classList.add("message"),l.textContent=o):(o.classList.add("message"),l.appendChild(o)),this._domNode.appendChild(l);const c=document.createElement("div");c.classList.add("anchor","below"),this._domNode.appendChild(c),this._editor.addContentWidget(this),this._domNode.classList.add("fadeIn")}dispose(){this._editor.removeContentWidget(this)}getId(){return"messageoverlay"}getDomNode(){return this._domNode}getPosition(){return{position:this._position,preference:[1,2],positionAffinity:1}}afterRender(e){this._domNode.classList.toggle("below",e===2)}};registerEditorContribution(MessageController.ID,MessageController,4);class StringIterator{constructor(){this._value="",this._pos=0}reset(e){return this._value=e,this._pos=0,this}next(){return this._pos+=1,this}hasNext(){return this._pos<this._value.length-1}cmp(e){const t=e.charCodeAt(0),s=this._value.charCodeAt(this._pos);return t-s}value(){return this._value[this._pos]}}class ConfigKeysIterator{constructor(e=!0){this._caseSensitive=e}reset(e){return this._value=e,this._from=0,this._to=0,this.next()}hasNext(){return this._to<this._value.length}next(){this._from=this._to;let e=!0;for(;this._to<this._value.length;this._to++)if(this._value.charCodeAt(this._to)===46)if(e)this._from++;else break;else e=!1;return this}cmp(e){return this._caseSensitive?compareSubstring(e,this._value,0,e.length,this._from,this._to):compareSubstringIgnoreCase(e,this._value,0,e.length,this._from,this._to)}value(){return this._value.substring(this._from,this._to)}}class PathIterator{constructor(e=!0,t=!0){this._splitOnBackslash=e,this._caseSensitive=t}reset(e){this._from=0,this._to=0,this._value=e,this._valueLen=e.length;for(let t=e.length-1;t>=0;t--,this._valueLen--){const s=this._value.charCodeAt(t);if(!(s===47||this._splitOnBackslash&&s===92))break}return this.next()}hasNext(){return this._to<this._valueLen}next(){this._from=this._to;let e=!0;for(;this._to<this._valueLen;this._to++){const t=this._value.charCodeAt(this._to);if(t===47||this._splitOnBackslash&&t===92)if(e)this._from++;else break;else e=!1}return this}cmp(e){return this._caseSensitive?compareSubstring(e,this._value,0,e.length,this._from,this._to):compareSubstringIgnoreCase(e,this._value,0,e.length,this._from,this._to)}value(){return this._value.substring(this._from,this._to)}}class UriIterator{constructor(e,t){this._ignorePathCasing=e,this._ignoreQueryAndFragment=t,this._states=[],this._stateIdx=0}reset(e){return this._value=e,this._states=[],this._value.scheme&&this._states.push(1),this._value.authority&&this._states.push(2),this._value.path&&(this._pathIterator=new PathIterator(!1,!this._ignorePathCasing(e)),this._pathIterator.reset(e.path),this._pathIterator.value()&&this._states.push(3)),this._ignoreQueryAndFragment(e)||(this._value.query&&this._states.push(4),this._value.fragment&&this._states.push(5)),this._stateIdx=0,this}next(){return this._states[this._stateIdx]===3&&this._pathIterator.hasNext()?this._pathIterator.next():this._stateIdx+=1,this}hasNext(){return this._states[this._stateIdx]===3&&this._pathIterator.hasNext()||this._stateIdx<this._states.length-1}cmp(e){if(this._states[this._stateIdx]===1)return compareIgnoreCase(e,this._value.scheme);if(this._states[this._stateIdx]===2)return compareIgnoreCase(e,this._value.authority);if(this._states[this._stateIdx]===3)return this._pathIterator.cmp(e);if(this._states[this._stateIdx]===4)return compare(e,this._value.query);if(this._states[this._stateIdx]===5)return compare(e,this._value.fragment);throw new Error}value(){if(this._states[this._stateIdx]===1)return this._value.scheme;if(this._states[this._stateIdx]===2)return this._value.authority;if(this._states[this._stateIdx]===3)return this._pathIterator.value();if(this._states[this._stateIdx]===4)return this._value.query;if(this._states[this._stateIdx]===5)return this._value.fragment;throw new Error}}const Cn=class Cn{static wrap(e){return e===void 0?Cn.Val:e}static unwrap(e){return e===Cn.Val?void 0:e}};Cn.Val=Symbol("undefined_placeholder");let Undef=Cn;class TernarySearchTreeNode{constructor(){this.height=1,this.value=void 0,this.key=void 0,this.left=void 0,this.mid=void 0,this.right=void 0}rotateLeft(){const e=this.right;return this.right=e.left,e.left=this,this.updateHeight(),e.updateHeight(),e}rotateRight(){const e=this.left;return this.left=e.right,e.right=this,this.updateHeight(),e.updateHeight(),e}updateHeight(){this.height=1+Math.max(this.heightLeft,this.heightRight)}balanceFactor(){return this.heightRight-this.heightLeft}get heightLeft(){var e;return((e=this.left)==null?void 0:e.height)??0}get heightRight(){var e;return((e=this.right)==null?void 0:e.height)??0}}class TernarySearchTree{static forUris(e=()=>!1,t=()=>!1){return new TernarySearchTree(new UriIterator(e,t))}static forStrings(){return new TernarySearchTree(new StringIterator)}static forConfigKeys(){return new TernarySearchTree(new ConfigKeysIterator)}constructor(e){this._iter=e}clear(){this._root=void 0}set(e,t){const s=this._iter.reset(e);let o;this._root||(this._root=new TernarySearchTreeNode,this._root.segment=s.value());const r=[];for(o=this._root;;){const c=s.cmp(o.segment);if(c>0)o.left||(o.left=new TernarySearchTreeNode,o.left.segment=s.value()),r.push([-1,o]),o=o.left;else if(c<0)o.right||(o.right=new TernarySearchTreeNode,o.right.segment=s.value()),r.push([1,o]),o=o.right;else if(s.hasNext())s.next(),o.mid||(o.mid=new TernarySearchTreeNode,o.mid.segment=s.value()),r.push([0,o]),o=o.mid;else break}const l=Undef.unwrap(o.value);o.value=Undef.wrap(t),o.key=e;for(let c=r.length-1;c>=0;c--){const d=r[c][1];d.updateHeight();const u=d.balanceFactor();if(u<-1||u>1){const g=r[c][0],f=r[c+1][0];if(g===1&&f===1)r[c][1]=d.rotateLeft();else if(g===-1&&f===-1)r[c][1]=d.rotateRight();else if(g===1&&f===-1)d.right=r[c+1][1]=r[c+1][1].rotateRight(),r[c][1]=d.rotateLeft();else if(g===-1&&f===1)d.left=r[c+1][1]=r[c+1][1].rotateLeft(),r[c][1]=d.rotateRight();else throw new Error;if(c>0)switch(r[c-1][0]){case-1:r[c-1][1].left=r[c][1];break;case 1:r[c-1][1].right=r[c][1];break;case 0:r[c-1][1].mid=r[c][1];break}else this._root=r[0][1]}}return l}get(e){var t;return Undef.unwrap((t=this._getNode(e))==null?void 0:t.value)}_getNode(e){const t=this._iter.reset(e);let s=this._root;for(;s;){const o=t.cmp(s.segment);if(o>0)s=s.left;else if(o<0)s=s.right;else if(t.hasNext())t.next(),s=s.mid;else break}return s}has(e){const t=this._getNode(e);return!((t==null?void 0:t.value)===void 0&&(t==null?void 0:t.mid)===void 0)}delete(e){return this._delete(e,!1)}deleteSuperstr(e){return this._delete(e,!0)}_delete(e,t){const s=this._iter.reset(e),o=[];let r=this._root;for(;r;){const l=s.cmp(r.segment);if(l>0)o.push([-1,r]),r=r.left;else if(l<0)o.push([1,r]),r=r.right;else if(s.hasNext())s.next(),o.push([0,r]),r=r.mid;else break}if(r){if(t?(r.left=void 0,r.mid=void 0,r.right=void 0,r.height=1):(r.key=void 0,r.value=void 0),!r.mid&&!r.value)if(r.left&&r.right){const l=[[1,r]],c=this._min(r.right,l);if(c.key){r.key=c.key,r.value=c.value,r.segment=c.segment;const d=c.right;if(l.length>1){const[g,f]=l[l.length-1];switch(g){case-1:f.left=d;break;case 0:assert(!1);case 1:assert(!1)}}else r.right=d;const u=this._balanceByStack(l);if(o.length>0){const[g,f]=o[o.length-1];switch(g){case-1:f.left=u;break;case 0:f.mid=u;break;case 1:f.right=u;break}}else this._root=u}}else{const l=r.left??r.right;if(o.length>0){const[c,d]=o[o.length-1];switch(c){case-1:d.left=l;break;case 0:d.mid=l;break;case 1:d.right=l;break}}else this._root=l}this._root=this._balanceByStack(o)??this._root}}_min(e,t){for(;e.left;)t.push([-1,e]),e=e.left;return e}_balanceByStack(e){for(let t=e.length-1;t>=0;t--){const s=e[t][1];s.updateHeight();const o=s.balanceFactor();if(o>1?(s.right.balanceFactor()>=0||(s.right=s.right.rotateRight()),e[t][1]=s.rotateLeft()):o<-1&&(s.left.balanceFactor()<=0||(s.left=s.left.rotateLeft()),e[t][1]=s.rotateRight()),t>0)switch(e[t-1][0]){case-1:e[t-1][1].left=e[t][1];break;case 1:e[t-1][1].right=e[t][1];break;case 0:e[t-1][1].mid=e[t][1];break}else return e[0][1]}}findSubstr(e){const t=this._iter.reset(e);let s=this._root,o;for(;s;){const r=t.cmp(s.segment);if(r>0)s=s.left;else if(r<0)s=s.right;else if(t.hasNext())t.next(),o=Undef.unwrap(s.value)||o,s=s.mid;else break}return s&&Undef.unwrap(s.value)||o}findSuperstr(e){return this._findSuperstrOrElement(e,!1)}_findSuperstrOrElement(e,t){const s=this._iter.reset(e);let o=this._root;for(;o;){const r=s.cmp(o.segment);if(r>0)o=o.left;else if(r<0)o=o.right;else if(s.hasNext())s.next(),o=o.mid;else return o.mid?this._entries(o.mid):t?Undef.unwrap(o.value):void 0}}forEach(e){for(const[t,s]of this)e(s,t)}*[Symbol.iterator](){yield*this._entries(this._root)}_entries(e){const t=[];return this._dfsEntries(e,t),t[Symbol.iterator]()}_dfsEntries(e,t){e&&(e.left&&this._dfsEntries(e.left,t),e.value!==void 0&&t.push([e.key,Undef.unwrap(e.value)]),e.mid&&this._dfsEntries(e.mid,t),e.right&&this._dfsEntries(e.right,t))}}const IWorkspaceContextService=createDecorator("contextService");function isSingleFolderWorkspaceIdentifier(a){const e=a;return typeof(e==null?void 0:e.id)=="string"&&URI.isUri(e.uri)}function isEmptyWorkspaceIdentifier(a){const e=a;return typeof(e==null?void 0:e.id)=="string"&&!isSingleFolderWorkspaceIdentifier(a)&&!isWorkspaceIdentifier(a)}const EXTENSION_DEVELOPMENT_EMPTY_WINDOW_WORKSPACE={id:"ext-dev"},UNKNOWN_EMPTY_WINDOW_WORKSPACE={id:"empty-window"};function toWorkspaceIdentifier(a,e){if(typeof a=="string"||typeof a>"u")return typeof a=="string"?{id:basename$1(a)}:e?EXTENSION_DEVELOPMENT_EMPTY_WINDOW_WORKSPACE:UNKNOWN_EMPTY_WINDOW_WORKSPACE;const t=a;return t.configuration?{id:t.id,configPath:t.configuration}:t.folders.length===1?{id:t.id,uri:t.folders[0].uri}:{id:t.id}}function isWorkspaceIdentifier(a){const e=a;return typeof(e==null?void 0:e.id)=="string"&&URI.isUri(e.configPath)}class WorkspaceFolder{constructor(e,t){this.raw=t,this.uri=e.uri,this.index=e.index,this.name=e.name}toJSON(){return{uri:this.uri,name:this.name,index:this.index}}}const WORKSPACE_EXTENSION="code-workspace";localize(2032,"Code Workspace");const STANDALONE_EDITOR_WORKSPACE_ID="4064f6ec-cb38-4ad0-af64-ee6467e63c82";function isStandaloneEditorWorkspace(a){return a.id===STANDALONE_EDITOR_WORKSPACE_ID}var __decorate$2e=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2c=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class SimplePasteAndDropProvider{constructor(e){this.copyMimeTypes=[],this.kind=e,this.providedDropEditKinds=[this.kind],this.providedPasteEditKinds=[this.kind]}async provideDocumentPasteEdits(e,t,s,o,r){const l=await this.getEdit(s,r);if(l)return{edits:[{insertText:l.insertText,title:l.title,kind:l.kind,handledMimeType:l.handledMimeType,yieldTo:l.yieldTo}],dispose(){}}}async provideDocumentDropEdits(e,t,s,o){const r=await this.getEdit(s,o);if(r)return{edits:[{insertText:r.insertText,title:r.title,kind:r.kind,handledMimeType:r.handledMimeType,yieldTo:r.yieldTo}],dispose(){}}}}const ks=class ks extends SimplePasteAndDropProvider{constructor(){super(HierarchicalKind.Empty.append("text","plain")),this.id=ks.id,this.dropMimeTypes=[Mimes.text],this.pasteMimeTypes=[Mimes.text]}async getEdit(e,t){const s=e.get(Mimes.text);if(!s||e.has(Mimes.uriList))return;const o=await s.asString();return{handledMimeType:Mimes.text,title:localize(921,"Insert Plain Text"),insertText:o,kind:this.kind}}};ks.id="text";let DefaultTextPasteOrDropEditProvider=ks;class PathProvider extends SimplePasteAndDropProvider{constructor(){super(HierarchicalKind.Empty.append("uri","path","absolute")),this.dropMimeTypes=[Mimes.uriList],this.pasteMimeTypes=[Mimes.uriList]}async getEdit(e,t){const s=await extractUriList(e);if(!s.length||t.isCancellationRequested)return;let o=0;const r=s.map(({uri:c,originalText:d})=>c.scheme===Schemas.file?c.fsPath:(o++,d)).join(" ");let l;return o>0?l=s.length>1?localize(922,"Insert Uris"):localize(923,"Insert Uri"):l=s.length>1?localize(924,"Insert Paths"):localize(925,"Insert Path"),{handledMimeType:Mimes.uriList,insertText:r,title:l,kind:this.kind}}}let RelativePathProvider=class extends SimplePasteAndDropProvider{constructor(e){super(HierarchicalKind.Empty.append("uri","path","relative")),this._workspaceContextService=e,this.dropMimeTypes=[Mimes.uriList],this.pasteMimeTypes=[Mimes.uriList]}async getEdit(e,t){const s=await extractUriList(e);if(!s.length||t.isCancellationRequested)return;const o=coalesce(s.map(({uri:r})=>{const l=this._workspaceContextService.getWorkspaceFolder(r);return l?relativePath(l.uri,r):void 0}));if(o.length)return{handledMimeType:Mimes.uriList,insertText:o.join(" "),title:s.length>1?localize(926,"Insert Relative Paths"):localize(927,"Insert Relative Path"),kind:this.kind}}};RelativePathProvider=__decorate$2e([__param$2c(0,IWorkspaceContextService)],RelativePathProvider);class PasteHtmlProvider{constructor(){this.kind=new HierarchicalKind("html"),this.providedPasteEditKinds=[this.kind],this.copyMimeTypes=[],this.pasteMimeTypes=["text/html"],this._yieldTo=[{mimeType:Mimes.text}]}async provideDocumentPasteEdits(e,t,s,o,r){var d;if(o.triggerKind!==DocumentPasteTriggerKind.PasteAs&&!((d=o.only)!=null&&d.contains(this.kind)))return;const l=s.get("text/html"),c=await(l==null?void 0:l.asString());if(!(!c||r.isCancellationRequested))return{dispose(){},edits:[{insertText:c,yieldTo:this._yieldTo,title:localize(928,"Insert HTML"),kind:this.kind}]}}}async function extractUriList(a){const e=a.get(Mimes.uriList);if(!e)return[];const t=await e.asString(),s=[];for(const o of UriList.parse(t))try{s.push({uri:URI.parse(o),originalText:o})}catch{}return s}const genericLanguageSelector={scheme:"*",hasAccessToAllModels:!0};let DefaultDropProvidersFeature=class extends Disposable{constructor(e,t){super(),this._register(e.documentDropEditProvider.register(genericLanguageSelector,new DefaultTextPasteOrDropEditProvider)),this._register(e.documentDropEditProvider.register(genericLanguageSelector,new PathProvider)),this._register(e.documentDropEditProvider.register(genericLanguageSelector,new RelativePathProvider(t)))}};DefaultDropProvidersFeature=__decorate$2e([__param$2c(0,ILanguageFeaturesService),__param$2c(1,IWorkspaceContextService)],DefaultDropProvidersFeature);let DefaultPasteProvidersFeature=class extends Disposable{constructor(e,t){super(),this._register(e.documentPasteEditProvider.register(genericLanguageSelector,new DefaultTextPasteOrDropEditProvider)),this._register(e.documentPasteEditProvider.register(genericLanguageSelector,new PathProvider)),this._register(e.documentPasteEditProvider.register(genericLanguageSelector,new RelativePathProvider(t))),this._register(e.documentPasteEditProvider.register(genericLanguageSelector,new PasteHtmlProvider))}};DefaultPasteProvidersFeature=__decorate$2e([__param$2c(0,ILanguageFeaturesService),__param$2c(1,IWorkspaceContextService)],DefaultPasteProvidersFeature);const Te=class Te{constructor(){this.value="",this.pos=0}static isDigitCharacter(e){return e>=48&&e<=57}static isVariableCharacter(e){return e===95||e>=97&&e<=122||e>=65&&e<=90}text(e){this.value=e,this.pos=0}tokenText(e){return this.value.substr(e.pos,e.len)}next(){if(this.pos>=this.value.length)return{type:14,pos:this.pos,len:0};const e=this.pos;let t=0,s=this.value.charCodeAt(e),o;if(o=Te._table[s],typeof o=="number")return this.pos+=1,{type:o,pos:e,len:1};if(Te.isDigitCharacter(s)){o=8;do t+=1,s=this.value.charCodeAt(e+t);while(Te.isDigitCharacter(s));return this.pos+=t,{type:o,pos:e,len:t}}if(Te.isVariableCharacter(s)){o=9;do s=this.value.charCodeAt(e+ ++t);while(Te.isVariableCharacter(s)||Te.isDigitCharacter(s));return this.pos+=t,{type:o,pos:e,len:t}}o=10;do t+=1,s=this.value.charCodeAt(e+t);while(!isNaN(s)&&typeof Te._table[s]>"u"&&!Te.isDigitCharacter(s)&&!Te.isVariableCharacter(s));return this.pos+=t,{type:o,pos:e,len:t}}};Te._table={36:0,58:1,44:2,123:3,125:4,92:5,47:6,124:7,43:11,45:12,63:13};let Scanner=Te;class Marker{constructor(){this._children=[]}appendChild(e){return e instanceof Text&&this._children[this._children.length-1]instanceof Text?this._children[this._children.length-1].value+=e.value:(e.parent=this,this._children.push(e)),this}replace(e,t){const{parent:s}=e,o=s.children.indexOf(e),r=s.children.slice(0);r.splice(o,1,...t),s._children=r,function l(c,d){for(const u of c)u.parent=d,l(u.children,u)}(t,s)}get children(){return this._children}get rightMostDescendant(){return this._children.length>0?this._children[this._children.length-1].rightMostDescendant:this}get snippet(){let e=this;for(;;){if(!e)return;if(e instanceof TextmateSnippet)return e;e=e.parent}}toString(){return this.children.reduce((e,t)=>e+t.toString(),"")}len(){return 0}}class Text extends Marker{constructor(e){super(),this.value=e}toString(){return this.value}len(){return this.value.length}clone(){return new Text(this.value)}}class TransformableMarker extends Marker{}class Placeholder extends TransformableMarker{static compareByIndex(e,t){return e.index===t.index?0:e.isFinalTabstop?1:t.isFinalTabstop||e.index<t.index?-1:e.index>t.index?1:0}constructor(e){super(),this.index=e}get isFinalTabstop(){return this.index===0}get choice(){return this._children.length===1&&this._children[0]instanceof Choice?this._children[0]:void 0}clone(){const e=new Placeholder(this.index);return this.transform&&(e.transform=this.transform.clone()),e._children=this.children.map(t=>t.clone()),e}}class Choice extends Marker{constructor(){super(...arguments),this.options=[]}appendChild(e){return e instanceof Text&&(e.parent=this,this.options.push(e)),this}toString(){return this.options[0].value}len(){return this.options[0].len()}clone(){const e=new Choice;return this.options.forEach(e.appendChild,e),e}}class Transform extends Marker{constructor(){super(...arguments),this.regexp=new RegExp("")}resolve(e){const t=this;let s=!1,o=e.replace(this.regexp,function(){return s=!0,t._replace(Array.prototype.slice.call(arguments,0,-2))});return!s&&this._children.some(r=>r instanceof FormatString&&!!r.elseValue)&&(o=this._replace([])),o}_replace(e){let t="";for(const s of this._children)if(s instanceof FormatString){let o=e[s.index]||"";o=s.resolve(o),t+=o}else t+=s.toString();return t}toString(){return""}clone(){const e=new Transform;return e.regexp=new RegExp(this.regexp.source,(this.regexp.ignoreCase?"i":"")+(this.regexp.global?"g":"")),e._children=this.children.map(t=>t.clone()),e}}class FormatString extends Marker{constructor(e,t,s,o){super(),this.index=e,this.shorthandName=t,this.ifValue=s,this.elseValue=o}resolve(e){return this.shorthandName==="upcase"?e?e.toLocaleUpperCase():"":this.shorthandName==="downcase"?e?e.toLocaleLowerCase():"":this.shorthandName==="capitalize"?e?e[0].toLocaleUpperCase()+e.substr(1):"":this.shorthandName==="pascalcase"?e?this._toPascalCase(e):"":this.shorthandName==="camelcase"?e?this._toCamelCase(e):"":e&&typeof this.ifValue=="string"?this.ifValue:!e&&typeof this.elseValue=="string"?this.elseValue:e||""}_toPascalCase(e){const t=e.match(/[a-z0-9]+/gi);return t?t.map(s=>s.charAt(0).toUpperCase()+s.substr(1)).join(""):e}_toCamelCase(e){const t=e.match(/[a-z0-9]+/gi);return t?t.map((s,o)=>o===0?s.charAt(0).toLowerCase()+s.substr(1):s.charAt(0).toUpperCase()+s.substr(1)).join(""):e}clone(){return new FormatString(this.index,this.shorthandName,this.ifValue,this.elseValue)}}class Variable extends TransformableMarker{constructor(e){super(),this.name=e}resolve(e){let t=e.resolve(this);return this.transform&&(t=this.transform.resolve(t||"")),t!==void 0?(this._children=[new Text(t)],!0):!1}clone(){const e=new Variable(this.name);return this.transform&&(e.transform=this.transform.clone()),e._children=this.children.map(t=>t.clone()),e}}function walk(a,e){const t=[...a];for(;t.length>0;){const s=t.shift();if(!e(s))break;t.unshift(...s.children)}}class TextmateSnippet extends Marker{get placeholderInfo(){if(!this._placeholders){const e=[];let t;this.walk(function(s){return s instanceof Placeholder&&(e.push(s),t=!t||t.index<s.index?s:t),!0}),this._placeholders={all:e,last:t}}return this._placeholders}get placeholders(){const{all:e}=this.placeholderInfo;return e}offset(e){let t=0,s=!1;return this.walk(o=>o===e?(s=!0,!1):(t+=o.len(),!0)),s?t:-1}fullLen(e){let t=0;return walk([e],s=>(t+=s.len(),!0)),t}enclosingPlaceholders(e){const t=[];let{parent:s}=e;for(;s;)s instanceof Placeholder&&t.push(s),s=s.parent;return t}resolveVariables(e){return this.walk(t=>(t instanceof Variable&&t.resolve(e)&&(this._placeholders=void 0),!0)),this}appendChild(e){return this._placeholders=void 0,super.appendChild(e)}replace(e,t){return this._placeholders=void 0,super.replace(e,t)}clone(){const e=new TextmateSnippet;return this._children=this.children.map(t=>t.clone()),e}walk(e){walk(this.children,e)}}class SnippetParser{constructor(){this._scanner=new Scanner,this._token={type:14,pos:0,len:0}}static escape(e){return e.replace(/\$|}|\\/g,"\\$&")}static guessNeedsClipboard(e){return/\${?CLIPBOARD/.test(e)}parse(e,t,s){const o=new TextmateSnippet;return this.parseFragment(e,o),this.ensureFinalTabstop(o,s??!1,t??!1),o}parseFragment(e,t){const s=t.children.length;for(this._scanner.text(e),this._token=this._scanner.next();this._parse(t););const o=new Map,r=[];t.walk(d=>(d instanceof Placeholder&&(d.isFinalTabstop?o.set(0,void 0):!o.has(d.index)&&d.children.length>0?o.set(d.index,d.children):r.push(d)),!0));const l=(d,u)=>{const g=o.get(d.index);if(!g)return;const f=new Placeholder(d.index);f.transform=d.transform;for(const p of g){const m=p.clone();f.appendChild(m),m instanceof Placeholder&&o.has(m.index)&&!u.has(m.index)&&(u.add(m.index),l(m,u),u.delete(m.index))}t.replace(d,[f])},c=new Set;for(const d of r)l(d,c);return t.children.slice(s)}ensureFinalTabstop(e,t,s){(t||s&&e.placeholders.length>0)&&(e.placeholders.find(r=>r.index===0)||e.appendChild(new Placeholder(0)))}_accept(e,t){if(e===void 0||this._token.type===e){const s=t?this._scanner.tokenText(this._token):!0;return this._token=this._scanner.next(),s}return!1}_backTo(e){return this._scanner.pos=e.pos+e.len,this._token=e,!1}_until(e){const t=this._token;for(;this._token.type!==e;){if(this._token.type===14)return!1;if(this._token.type===5){const o=this._scanner.next();if(o.type!==0&&o.type!==4&&o.type!==5)return!1}this._token=this._scanner.next()}const s=this._scanner.value.substring(t.pos,this._token.pos).replace(/\\(\$|}|\\)/g,"$1");return this._token=this._scanner.next(),s}_parse(e){return this._parseEscaped(e)||this._parseTabstopOrVariableName(e)||this._parseComplexPlaceholder(e)||this._parseComplexVariable(e)||this._parseAnything(e)}_parseEscaped(e){let t;return(t=this._accept(5,!0))?(t=this._accept(0,!0)||this._accept(4,!0)||this._accept(5,!0)||t,e.appendChild(new Text(t)),!0):!1}_parseTabstopOrVariableName(e){let t;const s=this._token;return this._accept(0)&&(t=this._accept(9,!0)||this._accept(8,!0))?(e.appendChild(/^\d+$/.test(t)?new Placeholder(Number(t)):new Variable(t)),!0):this._backTo(s)}_parseComplexPlaceholder(e){let t;const s=this._token;if(!(this._accept(0)&&this._accept(3)&&(t=this._accept(8,!0))))return this._backTo(s);const r=new Placeholder(Number(t));if(this._accept(1))for(;;){if(this._accept(4))return e.appendChild(r),!0;if(!this._parse(r))return e.appendChild(new Text("${"+t+":")),r.children.forEach(e.appendChild,e),!0}else if(r.index>0&&this._accept(7)){const l=new Choice;for(;;){if(this._parseChoiceElement(l)){if(this._accept(2))continue;if(this._accept(7)&&(r.appendChild(l),this._accept(4)))return e.appendChild(r),!0}return this._backTo(s),!1}}else return this._accept(6)?this._parseTransform(r)?(e.appendChild(r),!0):(this._backTo(s),!1):this._accept(4)?(e.appendChild(r),!0):this._backTo(s)}_parseChoiceElement(e){const t=this._token,s=[];for(;!(this._token.type===2||this._token.type===7);){let o;if((o=this._accept(5,!0))?o=this._accept(2,!0)||this._accept(7,!0)||this._accept(5,!0)||o:o=this._accept(void 0,!0),!o)return this._backTo(t),!1;s.push(o)}return s.length===0?(this._backTo(t),!1):(e.appendChild(new Text(s.join(""))),!0)}_parseComplexVariable(e){let t;const s=this._token;if(!(this._accept(0)&&this._accept(3)&&(t=this._accept(9,!0))))return this._backTo(s);const r=new Variable(t);if(this._accept(1))for(;;){if(this._accept(4))return e.appendChild(r),!0;if(!this._parse(r))return e.appendChild(new Text("${"+t+":")),r.children.forEach(e.appendChild,e),!0}else return this._accept(6)?this._parseTransform(r)?(e.appendChild(r),!0):(this._backTo(s),!1):this._accept(4)?(e.appendChild(r),!0):this._backTo(s)}_parseTransform(e){const t=new Transform;let s="",o="";for(;!this._accept(6);){let r;if(r=this._accept(5,!0)){r=this._accept(6,!0)||r,s+=r;continue}if(this._token.type!==14){s+=this._accept(void 0,!0);continue}return!1}for(;!this._accept(6);){let r;if(r=this._accept(5,!0)){r=this._accept(5,!0)||this._accept(6,!0)||r,t.appendChild(new Text(r));continue}if(!(this._parseFormatString(t)||this._parseAnything(t)))return!1}for(;!this._accept(4);){if(this._token.type!==14){o+=this._accept(void 0,!0);continue}return!1}try{t.regexp=new RegExp(s,o)}catch{return!1}return e.transform=t,!0}_parseFormatString(e){const t=this._token;if(!this._accept(0))return!1;let s=!1;this._accept(3)&&(s=!0);const o=this._accept(8,!0);if(o)if(s){if(this._accept(4))return e.appendChild(new FormatString(Number(o))),!0;if(!this._accept(1))return this._backTo(t),!1}else return e.appendChild(new FormatString(Number(o))),!0;else return this._backTo(t),!1;if(this._accept(6)){const r=this._accept(9,!0);return!r||!this._accept(4)?(this._backTo(t),!1):(e.appendChild(new FormatString(Number(o),r)),!0)}else if(this._accept(11)){const r=this._until(4);if(r)return e.appendChild(new FormatString(Number(o),void 0,r,void 0)),!0}else if(this._accept(12)){const r=this._until(4);if(r)return e.appendChild(new FormatString(Number(o),void 0,void 0,r)),!0}else if(this._accept(13)){const r=this._until(1);if(r){const l=this._until(4);if(l)return e.appendChild(new FormatString(Number(o),void 0,r,l)),!0}}else{const r=this._until(4);if(r)return e.appendChild(new FormatString(Number(o),void 0,void 0,r)),!0}return this._backTo(t),!1}_parseAnything(e){return this._token.type!==14?(e.appendChild(new Text(this._scanner.tokenText(this._token))),this._accept(void 0),!0):!1}}function createCombinedWorkspaceEdit(a,e,t){var s,o;return(typeof t.insertText=="string"?t.insertText==="":t.insertText.snippet==="")?{edits:((s=t.additionalEdit)==null?void 0:s.edits)??[]}:{edits:[...e.map(r=>new ResourceTextEdit(a,{range:r,text:typeof t.insertText=="string"?SnippetParser.escape(t.insertText)+"$0":t.insertText.snippet,insertAsSnippet:!0})),...((o=t.additionalEdit)==null?void 0:o.edits)??[]]}}function sortEditsByYieldTo(a){function e(l,c){return"mimeType"in l?l.mimeType===c.handledMimeType:!!c.kind&&l.kind.contains(c.kind)}const t=new Map;for(const l of a)for(const c of l.yieldTo??[])for(const d of a)if(d!==l&&e(c,d)){let u=t.get(l);u||(u=[],t.set(l,u)),u.push(d)}if(!t.size)return Array.from(a);const s=new Set,o=[];function r(l){if(!l.length)return[];const c=l[0];if(o.includes(c))return console.warn("Yield to cycle detected",c),l;if(s.has(c))return r(l.slice(1));let d=[];const u=t.get(c);return u&&(o.push(c),d=r(u),o.pop()),s.add(c),[...d,c,...r(l.slice(1))]}return r(Array.from(a))}const button="";Color.white.toString(),Color.white.toString();const buttonSanitizerConfig=Object.freeze({allowedTags:{override:["b","i","u","code","span"]},allowedAttributes:{override:["class"]}});class Button extends Disposable{get onDidClick(){return this._onDidClick.event}constructor(e,t){super(),this._label="",this._onDidClick=this._register(new Emitter$1),this._onDidEscape=this._register(new Emitter$1),this.options=t,this._element=document.createElement("a"),this._element.classList.add("monaco-button"),this._element.tabIndex=0,this._element.setAttribute("role","button"),this._element.classList.toggle("secondary",!!t.secondary);const s=t.secondary?t.buttonSecondaryBackground:t.buttonBackground,o=t.secondary?t.buttonSecondaryForeground:t.buttonForeground;this._element.style.color=o||"",this._element.style.backgroundColor=s||"",t.supportShortLabel&&(this._labelShortElement=document.createElement("div"),this._labelShortElement.classList.add("monaco-button-label-short"),this._element.appendChild(this._labelShortElement),this._labelElement=document.createElement("div"),this._labelElement.classList.add("monaco-button-label"),this._element.appendChild(this._labelElement),this._element.classList.add("monaco-text-button-with-short-label")),typeof t.title=="string"&&this.setTitle(t.title),typeof t.ariaLabel=="string"&&this._element.setAttribute("aria-label",t.ariaLabel),e.appendChild(this._element),this.enabled=!t.disabled,this._register(Gesture.addTarget(this._element)),[EventType$1.CLICK,EventType.Tap].forEach(r=>{this._register(addDisposableListener(this._element,r,l=>{if(!this.enabled){EventHelper.stop(l);return}this._onDidClick.fire(l)}))}),this._register(addDisposableListener(this._element,EventType$1.KEY_DOWN,r=>{const l=new StandardKeyboardEvent(r);let c=!1;this.enabled&&(l.equals(3)||l.equals(10))?(this._onDidClick.fire(r),c=!0):l.equals(9)&&(this._onDidEscape.fire(r),this._element.blur(),c=!0),c&&EventHelper.stop(l,!0)})),this._register(addDisposableListener(this._element,EventType$1.MOUSE_OVER,r=>{this._element.classList.contains("disabled")||this.updateBackground(!0)})),this._register(addDisposableListener(this._element,EventType$1.MOUSE_OUT,r=>{this.updateBackground(!1)})),this.focusTracker=this._register(trackFocus(this._element)),this._register(this.focusTracker.onDidFocus(()=>{this.enabled&&this.updateBackground(!0)})),this._register(this.focusTracker.onDidBlur(()=>{this.enabled&&this.updateBackground(!1)}))}dispose(){super.dispose(),this._element.remove()}getContentElements(e){const t=[];for(let s of renderLabelWithIcons(e))if(typeof s=="string"){if(s=s.trim(),s==="")continue;const o=document.createElement("span");o.textContent=s,t.push(o)}else t.push(s);return t}updateBackground(e){let t;this.options.secondary?t=e?this.options.buttonSecondaryHoverBackground:this.options.buttonSecondaryBackground:t=e?this.options.buttonHoverBackground:this.options.buttonBackground,t&&(this._element.style.backgroundColor=t)}get element(){return this._element}set label(e){var o;if(this._label===e||isMarkdownString(this._label)&&isMarkdownString(e)&&markdownStringEqual(this._label,e))return;this._element.classList.add("monaco-text-button");const t=this.options.supportShortLabel?this._labelElement:this._element;if(isMarkdownString(e)){const r=renderMarkdown$1(e,void 0,document.createElement("span"));r.dispose();const l=(o=r.element.querySelector("p"))==null?void 0:o.innerHTML;l?safeSetInnerHtml(t,l,buttonSanitizerConfig):reset(t)}else this.options.supportIcons?reset(t,...this.getContentElements(e)):t.textContent=e;let s="";typeof this.options.title=="string"?s=this.options.title:this.options.title&&(s=renderAsPlaintext(e)),this.setTitle(s),this._setAriaLabel(),this._label=e}get label(){return this._label}_setAriaLabel(){typeof this.options.ariaLabel=="string"?this._element.setAttribute("aria-label",this.options.ariaLabel):typeof this.options.title=="string"&&this._element.setAttribute("aria-label",this.options.title)}set icon(e){this._setAriaLabel();const t=Array.from(this._element.classList).filter(s=>s.startsWith("codicon-"));this._element.classList.remove(...t),this._element.classList.add(...ThemeIcon.asClassNameArray(e))}set enabled(e){e?(this._element.classList.remove("disabled"),this._element.setAttribute("aria-disabled",String(!1)),this._element.tabIndex=0):(this._element.classList.add("disabled"),this._element.setAttribute("aria-disabled",String(!0)))}get enabled(){return!this._element.classList.contains("disabled")}setTitle(e){!this._hover&&e!==""?this._hover=this._register(getBaseLayerHoverDelegate().setupManagedHover(this.options.hoverDelegate??getDefaultHoverDelegate("element"),this._element,e)):this._hover&&this._hover.update(e)}}function exceptionToErrorMessage(a,e){return e&&(a.stack||a.stacktrace)?localize(29,"{0}: {1}",detectSystemErrorMessage(a),stackToString(a.stack)||stackToString(a.stacktrace)):detectSystemErrorMessage(a)}function stackToString(a){return Array.isArray(a)?a.join(`
`):a}function detectSystemErrorMessage(a){return a.code==="ERR_UNC_HOST_NOT_ALLOWED"?`${a.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`:typeof a.code=="string"&&typeof a.errno=="number"&&typeof a.syscall=="string"?localize(30,"A system error occurred ({0})",a.message):a.message||localize(31,"An unknown error occurred. Please consult the log for more details.")}function toErrorMessage(a=null,e=!1){if(!a)return localize(32,"An unknown error occurred. Please consult the log for more details.");if(Array.isArray(a)){const t=coalesce(a),s=toErrorMessage(t[0],e);return t.length>1?localize(33,"{0} ({1} errors in total)",s,t.length):s}if(isString$1(a))return a;if(a.detail){const t=a.detail;if(t.error)return exceptionToErrorMessage(t.error,e);if(t.exception)return exceptionToErrorMessage(t.exception,e)}return a.stack?exceptionToErrorMessage(a,e):a.message?a.message:localize(34,"An unknown error occurred. Please consult the log for more details.")}const actionWidget="",keybindingLabel="",$$j=$$l,unthemedKeybindingLabelOptions={keybindingLabelBackground:void 0,keybindingLabelForeground:void 0,keybindingLabelBorder:void 0,keybindingLabelBottomBorder:void 0,keybindingLabelShadow:void 0};class KeybindingLabel extends Disposable{constructor(e,t,s){super(),this.os=t,this.keyElements=new Set,this.options=s||Object.create(null);const o=this.options.keybindingLabelForeground;this.domNode=append$2(e,$$j(".monaco-keybinding")),o&&(this.domNode.style.color=o),this.hover=this._register(getBaseLayerHoverDelegate().setupManagedHover(getDefaultHoverDelegate("mouse"),this.domNode,"")),this.didEverRender=!1,e.appendChild(this.domNode)}set(e,t){this.didEverRender&&this.keybinding===e&&KeybindingLabel.areSame(this.matches,t)||(this.keybinding=e,this.matches=t,this.render())}render(){if(this.clear(),this.keybinding){const e=this.keybinding.getChords();e[0]&&this.renderChord(this.domNode,e[0],this.matches?this.matches.firstPart:null);for(let s=1;s<e.length;s++)append$2(this.domNode,$$j("span.monaco-keybinding-key-chord-separator",void 0," ")),this.renderChord(this.domNode,e[s],this.matches?this.matches.chordPart:null);const t=this.options.disableTitle??!1?void 0:this.keybinding.getAriaLabel()||void 0;this.hover.update(t),this.domNode.setAttribute("aria-label",t||"")}else this.options&&this.options.renderUnboundKeybindings&&this.renderUnbound(this.domNode);this.didEverRender=!0}clear(){clearNode(this.domNode),this.keyElements.clear()}renderChord(e,t,s){const o=UILabelProvider.modifierLabels[this.os];t.ctrlKey&&this.renderKey(e,o.ctrlKey,!!(s!=null&&s.ctrlKey),o.separator),t.shiftKey&&this.renderKey(e,o.shiftKey,!!(s!=null&&s.shiftKey),o.separator),t.altKey&&this.renderKey(e,o.altKey,!!(s!=null&&s.altKey),o.separator),t.metaKey&&this.renderKey(e,o.metaKey,!!(s!=null&&s.metaKey),o.separator);const r=t.keyLabel;r&&this.renderKey(e,r,!!(s!=null&&s.keyCode),"")}renderKey(e,t,s,o){append$2(e,this.createKeyElement(t,s?".highlight":"")),o&&append$2(e,$$j("span.monaco-keybinding-key-separator",void 0,o))}renderUnbound(e){append$2(e,this.createKeyElement(localize(15,"Unbound")))}createKeyElement(e,t=""){const s=$$j("span.monaco-keybinding-key"+t,void 0,e);return this.keyElements.add(s),this.options.keybindingLabelBackground&&(s.style.backgroundColor=this.options.keybindingLabelBackground),this.options.keybindingLabelBorder&&(s.style.borderColor=this.options.keybindingLabelBorder),this.options.keybindingLabelBottomBorder&&(s.style.borderBottomColor=this.options.keybindingLabelBottomBorder),this.options.keybindingLabelShadow&&(s.style.boxShadow=`inset 0 -1px 0 ${this.options.keybindingLabelShadow}`),s}static areSame(e,t){return e===t||!e&&!t?!0:!!e&&!!t&&equals(e.firstPart,t.firstPart)&&equals(e.chordPart,t.chordPart)}}const ILayoutService=createDecorator("layoutService");var __decorate$2d=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2b=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const acceptSelectedActionCommand="acceptSelectedCodeAction",previewSelectedActionCommand="previewSelectedCodeAction";class HeaderRenderer{get templateId(){return"header"}renderTemplate(e){e.classList.add("group-header");const t=document.createElement("span");return e.append(t),{container:e,text:t}}renderElement(e,t,s){var o;s.text.textContent=((o=e.group)==null?void 0:o.title)??e.label??""}disposeTemplate(e){}}class SeparatorRenderer{get templateId(){return"separator"}renderTemplate(e){e.classList.add("separator");const t=document.createElement("span");return e.append(t),{container:e,text:t}}renderElement(e,t,s){s.text.textContent=e.label??""}disposeTemplate(e){}}let ActionItemRenderer=class{get templateId(){return"action"}constructor(e,t){this._supportsPreview=e,this._keybindingService=t}renderTemplate(e){e.classList.add(this.templateId);const t=document.createElement("div");t.className="icon",e.append(t);const s=document.createElement("span");s.className="title",e.append(s);const o=document.createElement("span");o.className="description",e.append(o);const r=new KeybindingLabel(e,OS);return{container:e,icon:t,text:s,description:o,keybinding:r}}renderElement(e,t,s){var l,c,d;if((l=e.group)!=null&&l.icon?(s.icon.className=ThemeIcon.asClassName(e.group.icon),e.group.icon.color&&(s.icon.style.color=asCssVariable(e.group.icon.color.id))):(s.icon.className=ThemeIcon.asClassName(Codicon.lightBulb),s.icon.style.color="var(--vscode-editorLightBulb-foreground)"),!e.item||!e.label)return;setVisibility(!e.hideIcon,s.icon),s.text.textContent=stripNewlines(e.label),e.keybinding?(s.description.textContent=e.keybinding.getLabel(),s.description.style.display="inline",s.description.style.letterSpacing="0.5px"):e.description?(s.description.textContent=stripNewlines(e.description),s.description.style.display="inline"):(s.description.textContent="",s.description.style.display="none");const o=(c=this._keybindingService.lookupKeybinding(acceptSelectedActionCommand))==null?void 0:c.getLabel(),r=(d=this._keybindingService.lookupKeybinding(previewSelectedActionCommand))==null?void 0:d.getLabel();s.container.classList.toggle("option-disabled",e.disabled),e.tooltip?s.container.title=e.tooltip:e.disabled?s.container.title=e.label:o&&r?this._supportsPreview&&e.canPreview?s.container.title=localize(1638,"{0} to Apply, {1} to Preview",o,r):s.container.title=localize(1639,"{0} to Apply",o):s.container.title=""}disposeTemplate(e){e.keybinding.dispose()}};ActionItemRenderer=__decorate$2d([__param$2b(1,IKeybindingService)],ActionItemRenderer);class AcceptSelectedEvent extends UIEvent{constructor(){super("acceptSelectedAction")}}class PreviewSelectedEvent extends UIEvent{constructor(){super("previewSelectedAction")}}function getKeyboardNavigationLabel(a){if(a.kind==="action")return a.label}let ActionList=class extends Disposable{constructor(e,t,s,o,r,l,c,d){super(),this._delegate=o,this._contextViewService=l,this._keybindingService=c,this._layoutService=d,this._actionLineHeight=28,this._headerLineHeight=28,this._separatorLineHeight=8,this.cts=this._register(new CancellationTokenSource$1),this.domNode=document.createElement("div"),this.domNode.classList.add("actionList");const u={getHeight:g=>{switch(g.kind){case"header":return this._headerLineHeight;case"separator":return this._separatorLineHeight;default:return this._actionLineHeight}},getTemplateId:g=>g.kind};this._list=this._register(new List(e,this.domNode,u,[new ActionItemRenderer(t,this._keybindingService),new HeaderRenderer,new SeparatorRenderer],{keyboardSupport:!1,typeNavigationEnabled:!0,keyboardNavigationLabelProvider:{getKeyboardNavigationLabel},accessibilityProvider:{getAriaLabel:g=>{if(g.kind==="action"){let f=g.label?stripNewlines(g==null?void 0:g.label):"";return g.description&&(f=f+", "+stripNewlines(g.description)),g.disabled&&(f=localize(1640,"{0}, Disabled Reason: {1}",f,g.disabled)),f}return null},getWidgetAriaLabel:()=>localize(1641,"Action Widget"),getRole:g=>{switch(g.kind){case"action":return"option";case"separator":return"separator";default:return"separator"}},getWidgetRole:()=>"listbox",...r}})),this._list.style(defaultListStyles),this._register(this._list.onMouseClick(g=>this.onListClick(g))),this._register(this._list.onMouseOver(g=>this.onListHover(g))),this._register(this._list.onDidChangeFocus(()=>this.onFocus())),this._register(this._list.onDidChangeSelection(g=>this.onListSelection(g))),this._allMenuItems=s,this._list.splice(0,this._list.length,this._allMenuItems),this._list.length&&this.focusNext()}focusCondition(e){return!e.disabled&&e.kind==="action"}hide(e){this._delegate.onHide(e),this.cts.cancel(),this._contextViewService.hideContextView()}layout(e){const t=this._allMenuItems.filter(g=>g.kind==="header").length,s=this._allMenuItems.filter(g=>g.kind==="separator").length,l=this._allMenuItems.length*this._actionLineHeight+t*this._headerLineHeight-t*this._actionLineHeight+s*this._separatorLineHeight-s*this._actionLineHeight;this._list.layout(l);let c=e;if(this._allMenuItems.length>=50)c=380;else{const g=this._allMenuItems.map((f,p)=>{const m=this.domNode.ownerDocument.getElementById(this._list.getElementID(p));if(m){m.style.width="auto";const _=m.getBoundingClientRect().width;return m.style.width="",_}return 0});c=Math.max(...g,e)}const d=.7,u=Math.min(l,this._layoutService.getContainer(getWindow(this.domNode)).clientHeight*d);return this._list.layout(u,c),this.domNode.style.height=`${u}px`,this._list.domFocus(),c}focusPrevious(){this._list.focusPrevious(1,!0,void 0,this.focusCondition)}focusNext(){this._list.focusNext(1,!0,void 0,this.focusCondition)}acceptSelected(e){const t=this._list.getFocus();if(t.length===0)return;const s=t[0],o=this._list.element(s);if(!this.focusCondition(o))return;const r=e?new PreviewSelectedEvent:new AcceptSelectedEvent;this._list.setSelection([s],r)}onListSelection(e){if(!e.elements.length)return;const t=e.elements[0];t.item&&this.focusCondition(t)?this._delegate.onSelect(t.item,e.browserEvent instanceof PreviewSelectedEvent):this._list.setSelection([])}onFocus(){var o,r;const e=this._list.getFocus();if(e.length===0)return;const t=e[0],s=this._list.element(t);(r=(o=this._delegate).onFocus)==null||r.call(o,s.item)}async onListHover(e){const t=e.element;if(t&&t.item&&this.focusCondition(t)){if(this._delegate.onHover&&!t.disabled&&t.kind==="action"){const s=await this._delegate.onHover(t.item,this.cts.token);t.canPreview=s?s.canPreview:void 0}e.index&&this._list.splice(e.index,1,[t])}this._list.setFocus(typeof e.index=="number"?[e.index]:[])}onListClick(e){e.element&&this.focusCondition(e.element)&&this._list.setFocus([])}};ActionList=__decorate$2d([__param$2b(5,IContextViewService),__param$2b(6,IKeybindingService),__param$2b(7,ILayoutService)],ActionList);function stripNewlines(a){return a.replace(/\r\n|\r|\n/g," ")}var __decorate$2c=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2a=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};registerColor("actionBar.toggledBackground",inputActiveOptionBackground,localize(1642,"Background color for toggled action items in action bar."));const ActionWidgetContextKeys={Visible:new RawContextKey("codeActionMenuVisible",!1,localize(1643,"Whether the action widget list is visible"))},IActionWidgetService=createDecorator("actionWidgetService");let ActionWidgetService=class extends Disposable{get isVisible(){return ActionWidgetContextKeys.Visible.getValue(this._contextKeyService)||!1}constructor(e,t,s){super(),this._contextViewService=e,this._contextKeyService=t,this._instantiationService=s,this._list=this._register(new MutableDisposable)}show(e,t,s,o,r,l,c,d){const u=ActionWidgetContextKeys.Visible.bindTo(this._contextKeyService),g=this._instantiationService.createInstance(ActionList,e,t,s,o,d);this._contextViewService.showContextView({getAnchor:()=>r,render:f=>(u.set(!0),this._renderWidget(f,g,c??[])),onHide:f=>{u.reset(),this._onWidgetClosed(f)}},l,!1)}acceptSelected(e){var t;(t=this._list.value)==null||t.acceptSelected(e)}focusPrevious(){var e,t;(t=(e=this._list)==null?void 0:e.value)==null||t.focusPrevious()}focusNext(){var e,t;(t=(e=this._list)==null?void 0:e.value)==null||t.focusNext()}hide(e){var t;(t=this._list.value)==null||t.hide(e),this._list.clear()}_renderWidget(e,t,s){var m;const o=document.createElement("div");if(o.classList.add("action-widget"),e.appendChild(o),this._list.value=t,this._list.value)o.appendChild(this._list.value.domNode);else throw new Error("List has no value");const r=new DisposableStore,l=document.createElement("div"),c=e.appendChild(l);c.classList.add("context-view-block"),r.add(addDisposableListener(c,EventType$1.MOUSE_DOWN,_=>_.stopPropagation()));const d=document.createElement("div"),u=e.appendChild(d);u.classList.add("context-view-pointerBlock"),r.add(addDisposableListener(u,EventType$1.POINTER_MOVE,()=>u.remove())),r.add(addDisposableListener(u,EventType$1.MOUSE_DOWN,()=>u.remove()));let g=0;if(s.length){const _=this._createActionBar(".action-widget-action-bar",s);_&&(o.appendChild(_.getContainer().parentElement),r.add(_),g=_.getContainer().offsetWidth)}const f=(m=this._list.value)==null?void 0:m.layout(g);o.style.width=`${f}px`;const p=r.add(trackFocus(e));return r.add(p.onDidBlur(()=>this.hide(!0))),r}_createActionBar(e,t){if(!t.length)return;const s=$$l(e),o=new ActionBar(s);return o.push(t,{icon:!1,label:!0}),o}_onWidgetClosed(e){var t;(t=this._list.value)==null||t.hide(e)}};ActionWidgetService=__decorate$2c([__param$2a(0,IContextViewService),__param$2a(1,IContextKeyService),__param$2a(2,IInstantiationService)],ActionWidgetService);registerSingleton(IActionWidgetService,ActionWidgetService,1);const weight$3=100+1e3;registerAction2(class extends Action2{constructor(){super({id:"hideCodeActionWidget",title:localize2(1644,"Hide action widget"),precondition:ActionWidgetContextKeys.Visible,keybinding:{weight:weight$3,primary:9,secondary:[1033]}})}run(a){a.get(IActionWidgetService).hide(!0)}});registerAction2(class extends Action2{constructor(){super({id:"selectPrevCodeAction",title:localize2(1645,"Select previous action"),precondition:ActionWidgetContextKeys.Visible,keybinding:{weight:weight$3,primary:16,secondary:[2064],mac:{primary:16,secondary:[2064,302]}}})}run(a){const e=a.get(IActionWidgetService);e instanceof ActionWidgetService&&e.focusPrevious()}});registerAction2(class extends Action2{constructor(){super({id:"selectNextCodeAction",title:localize2(1646,"Select next action"),precondition:ActionWidgetContextKeys.Visible,keybinding:{weight:weight$3,primary:18,secondary:[2066],mac:{primary:18,secondary:[2066,300]}}})}run(a){const e=a.get(IActionWidgetService);e instanceof ActionWidgetService&&e.focusNext()}});registerAction2(class extends Action2{constructor(){super({id:acceptSelectedActionCommand,title:localize2(1647,"Accept selected action"),precondition:ActionWidgetContextKeys.Visible,keybinding:{weight:weight$3,primary:3,secondary:[2137]}})}run(a){const e=a.get(IActionWidgetService);e instanceof ActionWidgetService&&e.acceptSelected()}});registerAction2(class extends Action2{constructor(){super({id:previewSelectedActionCommand,title:localize2(1648,"Preview selected action"),precondition:ActionWidgetContextKeys.Visible,keybinding:{weight:weight$3,primary:2051}})}run(a){const e=a.get(IActionWidgetService);e instanceof ActionWidgetService&&e.acceptSelected(!0)}});const postEditWidget="";var __decorate$2b=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$29=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},PostEditWidget_1,vi;let PostEditWidget=(vi=class extends Disposable{constructor(e,t,s,o,r,l,c,d,u,g,f){super(),this.typeId=e,this.editor=t,this.showCommand=o,this.range=r,this.edits=l,this.onSelectNewEdit=c,this.additionalActions=d,this._keybindingService=g,this._actionWidgetService=f,this.allowEditorOverflow=!0,this.suppressMouseDown=!0,this.create(),this.visibleContext=s.bindTo(u),this.visibleContext.set(!0),this._register(toDisposable(()=>this.visibleContext.reset())),this.editor.addContentWidget(this),this.editor.layoutContentWidget(this),this._register(toDisposable(()=>this.editor.removeContentWidget(this))),this._register(this.editor.onDidChangeCursorPosition(p=>{this.dispose()})),this._register(Event$1.runAndSubscribe(g.onDidUpdateKeybindings,()=>{this._updateButtonTitle()}))}_updateButtonTitle(){var t;const e=(t=this._keybindingService.lookupKeybinding(this.showCommand.id))==null?void 0:t.getLabel();this.button.element.title=this.showCommand.label+(e?` (${e})`:"")}create(){this.domNode=$$l(".post-edit-widget"),this.button=this._register(new Button(this.domNode,{supportIcons:!0})),this.button.label="$(insert)",this._register(addDisposableListener(this.domNode,EventType$1.CLICK,()=>this.showSelector()))}getId(){return PostEditWidget_1.baseId+"."+this.typeId}getDomNode(){return this.domNode}getPosition(){return{position:this.range.getEndPosition(),preference:[2]}}showSelector(){const e=getDomNodePagePosition(this.button.element),t={x:e.left+e.width,y:e.top+e.height};this._actionWidgetService.show("postEditWidget",!1,this.edits.allEdits.map((s,o)=>({kind:"action",item:s,label:s.title,disabled:!1,canPreview:!1,group:{title:"",icon:ThemeIcon.fromId(o===this.edits.activeEditIndex?Codicon.check.id:Codicon.blank.id)}})),{onHide:()=>{this.editor.focus()},onSelect:s=>{this._actionWidgetService.hide(!1);const o=this.edits.allEdits.findIndex(r=>r===s);if(o!==this.edits.activeEditIndex)return this.onSelectNewEdit(o)}},t,this.editor.getDomNode()??void 0,this.additionalActions)}},PostEditWidget_1=vi,vi.baseId="editor.widget.postEditWidget",vi);PostEditWidget=PostEditWidget_1=__decorate$2b([__param$29(8,IContextKeyService),__param$29(9,IKeybindingService),__param$29(10,IActionWidgetService)],PostEditWidget);let PostEditWidgetManager=class extends Disposable{constructor(e,t,s,o,r,l,c,d){super(),this._id=e,this._editor=t,this._visibleContext=s,this._showCommand=o,this._getAdditionalActions=r,this._instantiationService=l,this._bulkEditService=c,this._notificationService=d,this._currentWidget=this._register(new MutableDisposable),this._register(Event$1.any(t.onDidChangeModel,t.onDidChangeModelContent)(()=>this.clear()))}async applyEditAndShowIfNeeded(e,t,s,o,r){if(!e.length||!this._editor.hasModel())return;const l=this._editor.getModel(),c=t.allEdits.at(t.activeEditIndex);if(!c)return;const d=async v=>{const S=this._editor.getModel();S&&(await S.undo(),this.applyEditAndShowIfNeeded(e,{activeEditIndex:v,allEdits:t.allEdits},s,o,r))},u=(v,S)=>{isCancellationError(v)||(this._notificationService.error(S),s&&this.show(e[0],t,d))},g=new EditorStateCancellationTokenSource(this._editor,3,void 0,r);let f;try{f=await raceCancellationError(o(c,g.token),g.token)}catch(v){return u(v,localize(932,`Error resolving edit '{0}':
{1}`,c.title,toErrorMessage(v)))}finally{g.dispose()}if(r.isCancellationRequested)return;const p=createCombinedWorkspaceEdit(l.uri,e,f),m=e[0],_=l.deltaDecorations([],[{range:m,options:{description:"paste-line-suffix",stickiness:0}}]);this._editor.focus();let C,b;try{C=await this._bulkEditService.apply(p,{editor:this._editor,token:r}),b=l.getDecorationRange(_[0])}catch(v){return u(v,localize(933,`Error applying edit '{0}':
{1}`,c.title,toErrorMessage(v)))}finally{l.deltaDecorations(_,[])}r.isCancellationRequested||s&&C.isApplied&&t.allEdits.length>1&&this.show(b??m,t,d)}show(e,t,s){this.clear(),this._editor.hasModel()&&(this._currentWidget.value=this._instantiationService.createInstance(PostEditWidget,this._id,this._editor,this._visibleContext,this._showCommand,e,t,s,this._getAdditionalActions()))}clear(){this._currentWidget.clear()}tryShowSelector(){var e;(e=this._currentWidget.value)==null||e.showSelector()}};PostEditWidgetManager=__decorate$2b([__param$29(5,IInstantiationService),__param$29(6,IBulkEditService),__param$29(7,INotificationService)],PostEditWidgetManager);var __decorate$2a=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$28=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},CopyPasteController_1;const changePasteTypeCommandId="editor.changePasteType",pasteAsPreferenceConfig="editor.pasteAs.preferences",pasteWidgetVisibleCtx=new RawContextKey("pasteWidgetVisible",!1,localize(912,"Whether the paste widget is showing")),vscodeClipboardMime="application/vnd.code.copymetadata";var Si;let CopyPasteController=(Si=class extends Disposable{static get(e){return e.getContribution(CopyPasteController_1.ID)}constructor(e,t,s,o,r,l,c,d,u,g){super(),this._logService=s,this._bulkEditService=o,this._clipboardService=r,this._commandService=l,this._configService=c,this._languageFeaturesService=d,this._quickInputService=u,this._progressService=g,this._editor=e;const f=e.getContainerDomNode();this._register(addDisposableListener(f,"copy",p=>this.handleCopy(p))),this._register(addDisposableListener(f,"cut",p=>this.handleCopy(p))),this._register(addDisposableListener(f,"paste",p=>this.handlePaste(p),!0)),this._pasteProgressManager=this._register(new InlineProgressManager("pasteIntoEditor",e,t)),this._postPasteWidgetManager=this._register(t.createInstance(PostEditWidgetManager,"pasteIntoEditor",e,pasteWidgetVisibleCtx,{id:changePasteTypeCommandId,label:localize(913,"Show paste options...")},()=>CopyPasteController_1._configureDefaultAction?[CopyPasteController_1._configureDefaultAction]:[]))}changePasteType(){this._postPasteWidgetManager.tryShowSelector()}async pasteAs(e){this._logService.trace("CopyPasteController.pasteAs"),this._editor.focus();try{this._logService.trace("Before calling editor.action.clipboardPasteAction"),this._pasteAsActionContext={preferred:e},await this._commandService.executeCommand("editor.action.clipboardPasteAction")}finally{this._pasteAsActionContext=void 0}}clearWidgets(){this._postPasteWidgetManager.clear()}isPasteAsEnabled(){return this._editor.getOption(97).enabled}async finishedPaste(){await this._currentPasteOperation}handleCopy(e){var b,v,S,y;let t=null;if(e.clipboardData){const[w,L]=ClipboardEventUtils.getTextData(e.clipboardData),x=L||InMemoryClipboardMetadataManager.INSTANCE.get(w);t=(x==null?void 0:x.id)||null,this._logService.trace("CopyPasteController#handleCopy for id : ",t," with text.length : ",w.length)}else this._logService.trace("CopyPasteController#handleCopy");if(!this._editor.hasTextFocus()||((v=(b=this._clipboardService).clearInternalState)==null||v.call(b),!e.clipboardData||!this.isPasteAsEnabled()))return;const s=this._editor.getModel(),o=this._editor.getSelections();if(!s||!(o!=null&&o.length))return;const r=this._editor.getOption(45);let l=o;const c=o.length===1&&o[0].isEmpty();if(c){if(!r)return;l=[new Range$2(l[0].startLineNumber,1,l[0].startLineNumber,1+s.getLineLength(l[0].startLineNumber))]}const d=(S=this._editor._getViewModel())==null?void 0:S.getPlainTextToCopy(o,r,isWindows),g={multicursorText:Array.isArray(d)?d:null,pasteOnNewLine:c,mode:null},f=this._languageFeaturesService.documentPasteEditProvider.ordered(s).filter(w=>!!w.prepareDocumentPaste);if(!f.length){this.setCopyMetadata(e.clipboardData,{defaultPastePayload:g});return}const p=toVSDataTransfer(e.clipboardData),m=f.flatMap(w=>w.copyMimeTypes??[]),_=t??generateUuid();this.setCopyMetadata(e.clipboardData,{id:_,providerCopyMimeTypes:m,defaultPastePayload:g});const C=f.map(w=>({providerMimeTypes:w.copyMimeTypes,operation:createCancelablePromise(L=>w.prepareDocumentPaste(s,l,p,L).catch(x=>{console.error(x)}))}));(y=CopyPasteController_1._currentCopyOperation)==null||y.operations.forEach(w=>w.operation.cancel()),CopyPasteController_1._currentCopyOperation={handle:_,operations:C}}async handlePaste(e){var u,g,f;if(e.clipboardData){const[p,m]=ClipboardEventUtils.getTextData(e.clipboardData),_=m||InMemoryClipboardMetadataManager.INSTANCE.get(p);this._logService.trace("CopyPasteController#handlePaste for id : ",_==null?void 0:_.id)}else this._logService.trace("CopyPasteController#handlePaste");if(!e.clipboardData||!this._editor.hasTextFocus())return;(u=MessageController.get(this._editor))==null||u.closeMessage(),(g=this._currentPasteOperation)==null||g.cancel(),this._currentPasteOperation=void 0;const t=this._editor.getModel(),s=this._editor.getSelections();if(!(s!=null&&s.length)||!t||this._editor.getOption(104)||!this.isPasteAsEnabled()&&!this._pasteAsActionContext)return;const o=this.fetchCopyMetadata(e);this._logService.trace("CopyPasteController#handlePaste with metadata : ",o==null?void 0:o.id," and text.length : ",e.clipboardData.getData("text/plain").length);const r=toExternalVSDataTransfer(e.clipboardData);r.delete(vscodeClipboardMime);const l=Array.from(e.clipboardData.files).map(p=>p.type),c=[...e.clipboardData.types,...l,...(o==null?void 0:o.providerCopyMimeTypes)??[],Mimes.uriList],d=this._languageFeaturesService.documentPasteEditProvider.ordered(t).filter(p=>{var _,C;const m=(_=this._pasteAsActionContext)==null?void 0:_.preferred;return m&&!this.providerMatchesPreference(p,m)?!1:(C=p.pasteMimeTypes)==null?void 0:C.some(b=>matchesMimeType(b,c))});if(!d.length){(f=this._pasteAsActionContext)!=null&&f.preferred&&(this.showPasteAsNoEditMessage(s,this._pasteAsActionContext.preferred),e.preventDefault(),e.stopImmediatePropagation());return}e.preventDefault(),e.stopImmediatePropagation(),this._pasteAsActionContext?this.showPasteAsPick(this._pasteAsActionContext.preferred,d,s,r,o):this.doPasteInline(d,s,r,o,e)}showPasteAsNoEditMessage(e,t){var o;const s="only"in t?t.only.value:"preferences"in t?t.preferences.length?t.preferences.map(r=>r.value).join(", "):localize(914,"empty"):t.providerId;(o=MessageController.get(this._editor))==null||o.showMessage(localize(915,"No paste edits for '{0}' found",s),e[0].getStartPosition())}doPasteInline(e,t,s,o,r){this._logService.trace("CopyPasteController#doPasteInline");const l=this._editor;if(!l.hasModel())return;const c=new EditorStateCancellationTokenSource(l,3,void 0),d=createCancelablePromise(async u=>{const g=this._editor;if(!g.hasModel())return;const f=g.getModel(),p=new DisposableStore,m=p.add(new CancellationTokenSource$1(u));p.add(c.token.onCancellationRequested(()=>m.cancel()));const _=m.token;try{if(await this.mergeInDataFromCopy(e,s,o,_),_.isCancellationRequested)return;const C=e.filter(S=>this.isSupportedPasteProvider(S,s));if(!C.length||C.length===1&&C[0]instanceof DefaultTextPasteOrDropEditProvider)return this.applyDefaultPasteHandler(s,o,_,r);const b={triggerKind:DocumentPasteTriggerKind.Automatic},v=await this.getPasteEdits(C,s,f,t,b,_);if(p.add(v),_.isCancellationRequested)return;if(v.edits.length===1&&v.edits[0].provider instanceof DefaultTextPasteOrDropEditProvider)return this.applyDefaultPasteHandler(s,o,_,r);if(v.edits.length){const S=g.getOption(97).showPasteSelector==="afterPaste";return this._postPasteWidgetManager.applyEditAndShowIfNeeded(t,{activeEditIndex:this.getInitialActiveEditIndex(f,v.edits),allEdits:v.edits},S,async(y,w)=>{if(!y.provider.resolveDocumentPasteEdit)return y;const L=y.provider.resolveDocumentPasteEdit(y,w),x=new DeferredPromise,E=await this._pasteProgressManager.showWhile(t[0].getEndPosition(),localize(916,"Resolving paste edit for '{0}'. Click to cancel",y.title),raceCancellation(Promise.race([x.p,L]),w),{cancel:()=>x.cancel()},0);return E&&(y.insertText=E.insertText,y.additionalEdit=E.additionalEdit),y},_)}await this.applyDefaultPasteHandler(s,o,_,r)}finally{p.dispose(),this._currentPasteOperation===d&&(this._currentPasteOperation=void 0)}});this._pasteProgressManager.showWhile(t[0].getEndPosition(),localize(917,"Running paste handlers. Click to cancel and do basic paste"),d,{cancel:async()=>{d.cancel(),!c.token.isCancellationRequested&&await this.applyDefaultPasteHandler(s,o,c.token,r)}}).finally(()=>{c.dispose()}),this._currentPasteOperation=d}showPasteAsPick(e,t,s,o,r){this._logService.trace("CopyPasteController#showPasteAsPick");const l=createCancelablePromise(async c=>{var p;const d=this._editor;if(!d.hasModel())return;const u=d.getModel(),g=new DisposableStore,f=g.add(new EditorStateCancellationTokenSource(d,3,void 0,c));try{if(await this.mergeInDataFromCopy(t,o,r,f.token),f.token.isCancellationRequested)return;let m=t.filter(S=>this.isSupportedPasteProvider(S,o,e));e&&(m=m.filter(S=>this.providerMatchesPreference(S,e)));const _={triggerKind:DocumentPasteTriggerKind.PasteAs,only:e&&"only"in e?e.only:void 0};let C=g.add(await this.getPasteEdits(m,o,u,s,_,f.token));if(f.token.isCancellationRequested)return;if(e&&(C={edits:C.edits.filter(S=>"only"in e?e.only.contains(S.kind):"preferences"in e?e.preferences.some(y=>y.contains(S.kind)):e.providerId===S.provider.id),dispose:C.dispose}),!C.edits.length){e&&this.showPasteAsNoEditMessage(s,e);return}let b;if(e)b=C.edits.at(0);else{const S={id:"editor.pasteAs.default",label:localize(918,"Configure default paste action"),edit:void 0},y=await this._quickInputService.pick([...C.edits.map(w=>{var L;return{label:w.title,description:(L=w.kind)==null?void 0:L.value,edit:w}}),...CopyPasteController_1._configureDefaultAction?[{type:"separator"},{label:CopyPasteController_1._configureDefaultAction.label,edit:void 0}]:[]],{placeHolder:localize(919,"Select Paste Action")});if(y===S){(p=CopyPasteController_1._configureDefaultAction)==null||p.run();return}b=y==null?void 0:y.edit}if(!b)return;const v=createCombinedWorkspaceEdit(u.uri,s,b);await this._bulkEditService.apply(v,{editor:this._editor})}finally{g.dispose(),this._currentPasteOperation===l&&(this._currentPasteOperation=void 0)}});this._progressService.withProgress({location:10,title:localize(920,"Running paste handlers")},()=>l)}setCopyMetadata(e,t){this._logService.trace("CopyPasteController#setCopyMetadata new id : ",t.id),e.setData(vscodeClipboardMime,JSON.stringify(t))}fetchCopyMetadata(e){if(this._logService.trace("CopyPasteController#fetchCopyMetadata"),!e.clipboardData)return;const t=e.clipboardData.getData(vscodeClipboardMime);if(t)try{return JSON.parse(t)}catch{return}const[s,o]=ClipboardEventUtils.getTextData(e.clipboardData);if(o)return{defaultPastePayload:{mode:o.mode,multicursorText:o.multicursorText??null,pasteOnNewLine:!!o.isFromEmptySelection}}}async mergeInDataFromCopy(e,t,s,o){var r;if(this._logService.trace("CopyPasteController#mergeInDataFromCopy with metadata : ",s==null?void 0:s.id),s!=null&&s.id&&((r=CopyPasteController_1._currentCopyOperation)==null?void 0:r.handle)===s.id){const l=CopyPasteController_1._currentCopyOperation.operations.filter(d=>e.some(u=>u.pasteMimeTypes.some(g=>matchesMimeType(g,d.providerMimeTypes)))).map(d=>d.operation),c=await Promise.all(l);if(o.isCancellationRequested)return;for(const d of c.reverse())if(d)for(const[u,g]of d)t.replace(u,g)}if(!t.has(Mimes.uriList)){const l=await this._clipboardService.readResources();if(o.isCancellationRequested)return;l.length&&t.append(Mimes.uriList,createStringDataTransferItem(UriList.create(l)))}}async getPasteEdits(e,t,s,o,r,l){const c=new DisposableStore,d=await raceCancellation(Promise.all(e.map(async g=>{var f,p;try{const m=await((f=g.provideDocumentPasteEdits)==null?void 0:f.call(g,s,o,t,r,l));return m&&c.add(m),(p=m==null?void 0:m.edits)==null?void 0:p.map(_=>({..._,provider:g}))}catch(m){isCancellationError(m)||console.error(m);return}})),l),u=coalesce(d??[]).flat().filter(g=>!r.only||r.only.contains(g.kind));return{edits:sortEditsByYieldTo(u),dispose:()=>c.dispose()}}async applyDefaultPasteHandler(e,t,s,o){const r=e.get(Mimes.text)??e.get("text"),l=await(r==null?void 0:r.asString())??"";if(s.isCancellationRequested)return;const c={clipboardEvent:o,text:l,pasteOnNewLine:(t==null?void 0:t.defaultPastePayload.pasteOnNewLine)??!1,multicursorText:(t==null?void 0:t.defaultPastePayload.multicursorText)??null,mode:null};this._logService.trace("CopyPasteController#applyDefaultPasteHandler for id : ",t==null?void 0:t.id),this._editor.trigger("keyboard","paste",c)}isSupportedPasteProvider(e,t,s){var o;return(o=e.pasteMimeTypes)!=null&&o.some(r=>t.matches(r))?!s||this.providerMatchesPreference(e,s):!1}providerMatchesPreference(e,t){return"only"in t?e.providedPasteEditKinds.some(s=>t.only.contains(s)):"preferences"in t?t.preferences.some(s=>t.preferences.some(o=>o.contains(s))):e.id===t.providerId}getInitialActiveEditIndex(e,t){const s=this._configService.getValue(pasteAsPreferenceConfig,{resource:e.uri});for(const o of Array.isArray(s)?s:[]){const r=new HierarchicalKind(o),l=t.findIndex(c=>r.contains(c.kind));if(l>=0)return l}return 0}},CopyPasteController_1=Si,Si.ID="editor.contrib.copyPasteActionController",Si);CopyPasteController=CopyPasteController_1=__decorate$2a([__param$28(1,IInstantiationService),__param$28(2,ILogService),__param$28(3,IBulkEditService),__param$28(4,IClipboardService),__param$28(5,ICommandService),__param$28(6,IConfigurationService),__param$28(7,ILanguageFeaturesService),__param$28(8,IQuickInputService),__param$28(9,IProgressService)],CopyPasteController);const CLIPBOARD_CONTEXT_MENU_GROUP="9_cutcopypaste",supportsCut=isNative||document.queryCommandSupported("cut"),supportsCopy=isNative||document.queryCommandSupported("copy"),supportsPaste=typeof navigator.clipboard>"u"||isFirefox$1?document.queryCommandSupported("paste"):!0;function registerCommand$1(a){return a.register(),a}const CutAction=supportsCut?registerCommand$1(new MultiCommand({id:"editor.action.clipboardCutAction",precondition:void 0,kbOpts:isNative?{primary:2102,win:{primary:2102,secondary:[1044]},weight:100}:void 0,menuOpts:[{menuId:MenuId.MenubarEditMenu,group:"2_ccp",title:localize(809,"Cu&&t"),order:1},{menuId:MenuId.EditorContext,group:CLIPBOARD_CONTEXT_MENU_GROUP,title:localize(810,"Cut"),when:EditorContextKeys.writable,order:1},{menuId:MenuId.CommandPalette,group:"",title:localize(811,"Cut"),order:1},{menuId:MenuId.SimpleEditorContext,group:CLIPBOARD_CONTEXT_MENU_GROUP,title:localize(812,"Cut"),when:EditorContextKeys.writable,order:1}]})):void 0,CopyAction=supportsCopy?registerCommand$1(new MultiCommand({id:"editor.action.clipboardCopyAction",precondition:void 0,kbOpts:isNative?{primary:2081,win:{primary:2081,secondary:[2067]},weight:100}:void 0,menuOpts:[{menuId:MenuId.MenubarEditMenu,group:"2_ccp",title:localize(813,"&&Copy"),order:2},{menuId:MenuId.EditorContext,group:CLIPBOARD_CONTEXT_MENU_GROUP,title:localize(814,"Copy"),order:2},{menuId:MenuId.CommandPalette,group:"",title:localize(815,"Copy"),order:1},{menuId:MenuId.SimpleEditorContext,group:CLIPBOARD_CONTEXT_MENU_GROUP,title:localize(816,"Copy"),order:2}]})):void 0;MenuRegistry.appendMenuItem(MenuId.MenubarEditMenu,{submenu:MenuId.MenubarCopy,title:localize2(821,"Copy As"),group:"2_ccp",order:3});MenuRegistry.appendMenuItem(MenuId.EditorContext,{submenu:MenuId.EditorContextCopy,title:localize2(822,"Copy As"),group:CLIPBOARD_CONTEXT_MENU_GROUP,order:3});MenuRegistry.appendMenuItem(MenuId.EditorContext,{submenu:MenuId.EditorContextShare,title:localize2(823,"Share"),group:"11_share",order:-1,when:ContextKeyExpr.and(ContextKeyExpr.notEquals("resourceScheme","output"),EditorContextKeys.editorTextFocus)});MenuRegistry.appendMenuItem(MenuId.ExplorerContext,{submenu:MenuId.ExplorerContextShare,title:localize2(824,"Share"),group:"11_share",order:-1});const PasteAction=supportsPaste?registerCommand$1(new MultiCommand({id:"editor.action.clipboardPasteAction",precondition:void 0,kbOpts:isNative?{primary:2100,win:{primary:2100,secondary:[1043]},linux:{primary:2100,secondary:[1043]},weight:100}:void 0,menuOpts:[{menuId:MenuId.MenubarEditMenu,group:"2_ccp",title:localize(817,"&&Paste"),order:4},{menuId:MenuId.EditorContext,group:CLIPBOARD_CONTEXT_MENU_GROUP,title:localize(818,"Paste"),when:EditorContextKeys.writable,order:4},{menuId:MenuId.CommandPalette,group:"",title:localize(819,"Paste"),order:1},{menuId:MenuId.SimpleEditorContext,group:CLIPBOARD_CONTEXT_MENU_GROUP,title:localize(820,"Paste"),when:EditorContextKeys.writable,order:4}]})):void 0;class ExecCommandCopyWithSyntaxHighlightingAction extends EditorAction{constructor(){super({id:"editor.action.clipboardCopyWithSyntaxHighlightingAction",label:localize2(825,"Copy with Syntax Highlighting"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,weight:100}})}run(e,t){const s=e.get(ILogService);s.trace("ExecCommandCopyWithSyntaxHighlightingAction#run"),!(!t.hasModel()||!t.getOption(45)&&t.getSelection().isEmpty())&&(CopyOptions.forceCopyWithSyntaxHighlighting=!0,t.focus(),s.trace("ExecCommandCopyWithSyntaxHighlightingAction (before execCommand copy)"),t.getContainerDomNode().ownerDocument.execCommand("copy"),s.trace("ExecCommandCopyWithSyntaxHighlightingAction (after execCommand copy)"),CopyOptions.forceCopyWithSyntaxHighlighting=!1)}}function registerExecCommandImpl(a,e){a&&(a.addImplementation(1e4,"code-editor",(t,s)=>{const o=t.get(ILogService);o.trace("registerExecCommandImpl (addImplementation code-editor for : ",e,")");const r=t.get(ICodeEditorService).getFocusedCodeEditor();if(r&&r.hasTextFocus()){const l=r.getOption(45),c=r.getSelection();return c&&c.isEmpty()&&!l||(r.getOption(170)&&e==="cut"?(logCopyCommand(r),o.trace("registerExecCommandImpl (before execCommand copy)"),r.getContainerDomNode().ownerDocument.execCommand("copy"),r.trigger(void 0,"cut",void 0),o.trace("registerExecCommandImpl (after execCommand copy)")):(logCopyCommand(r),o.trace("registerExecCommandImpl (before execCommand "+e+")"),r.getContainerDomNode().ownerDocument.execCommand(e),o.trace("registerExecCommandImpl (after execCommand "+e+")"))),!0}return!1}),a.addImplementation(0,"generic-dom",(t,s)=>{const o=t.get(ILogService);return o.trace("registerExecCommandImpl (addImplementation generic-dom for : ",e,")"),o.trace("registerExecCommandImpl (before execCommand "+e+")"),getActiveDocument().execCommand(e),o.trace("registerExecCommandImpl (after execCommand "+e+")"),!0}))}function logCopyCommand(a){if(a.getOption(170)){const t=NativeEditContextRegistry.get(a.getId());t&&t.onWillCopy()}}registerExecCommandImpl(CutAction,"cut");registerExecCommandImpl(CopyAction,"copy");PasteAction&&(PasteAction.addImplementation(1e4,"code-editor",(a,e)=>{const t=a.get(ILogService);t.trace("registerExecCommandImpl (addImplementation code-editor for : paste)");const s=a.get(ICodeEditorService),o=a.get(IClipboardService),r=a.get(ITelemetryService),l=a.get(IProductService),c=s.getFocusedCodeEditor();if(c&&c.hasModel()&&c.hasTextFocus()){if(c.getOption(170)){const f=NativeEditContextRegistry.get(c.getId());f&&f.onWillPaste()}const u=StopWatch.create(!0);t.trace("registerExecCommandImpl (before triggerPaste)");const g=o.triggerPaste(getActiveWindow().vscodeWindowId);return g?(t.trace("registerExecCommandImpl (triggerPaste defined)"),g.then(async()=>{var f;if(t.trace("registerExecCommandImpl (after triggerPaste)"),l.quality!=="stable"){const p=u.elapsed();r.publicLog2("editorAsyncPaste",{duration:p})}return((f=CopyPasteController.get(c))==null?void 0:f.finishedPaste())??Promise.resolve()})):(t.trace("registerExecCommandImpl (triggerPaste undefined)"),isWeb?(t.trace("registerExecCommandImpl (Paste handling on web)"),(async()=>{const f=await o.readText();if(f!==""){const p=InMemoryClipboardMetadataManager.INSTANCE.get(f);let m=!1,_=null,C=null;p&&(m=c.getOption(45)&&!!p.isFromEmptySelection,_=typeof p.multicursorText<"u"?p.multicursorText:null,C=p.mode),t.trace("registerExecCommandImpl (clipboardText.length : ",f.length," id : ",p==null?void 0:p.id,")"),c.trigger("keyboard","paste",{text:f,pasteOnNewLine:m,multicursorText:_,mode:C})}})()):!0)}return!1}),PasteAction.addImplementation(0,"generic-dom",(a,e)=>(a.get(ILogService).trace("registerExecCommandImpl (addImplementation generic-dom for : paste)"),a.get(IClipboardService).triggerPaste(getActiveWindow().vscodeWindowId)??!1)));supportsCopy&&registerEditorAction(ExecCommandCopyWithSyntaxHighlightingAction);const editorConfigurationBaseNode=Object.freeze({id:"editor",order:5,type:"object",title:localize(144,"Editor"),scope:6}),editorConfiguration={...editorConfigurationBaseNode,properties:{"editor.tabSize":{type:"number",default:EDITOR_MODEL_DEFAULTS.tabSize,minimum:1,maximum:100,markdownDescription:localize(145,"The number of spaces a tab is equal to. This setting is overridden based on the file contents when {0} is on.","`#editor.detectIndentation#`")},"editor.indentSize":{anyOf:[{type:"string",enum:["tabSize"]},{type:"number",minimum:1}],default:"tabSize",markdownDescription:localize(146,'The number of spaces used for indentation or `"tabSize"` to use the value from `#editor.tabSize#`. This setting is overridden based on the file contents when `#editor.detectIndentation#` is on.')},"editor.insertSpaces":{type:"boolean",default:EDITOR_MODEL_DEFAULTS.insertSpaces,markdownDescription:localize(147,"Insert spaces when pressing `Tab`. This setting is overridden based on the file contents when {0} is on.","`#editor.detectIndentation#`")},"editor.detectIndentation":{type:"boolean",default:EDITOR_MODEL_DEFAULTS.detectIndentation,markdownDescription:localize(148,"Controls whether {0} and {1} will be automatically detected when a file is opened based on the file contents.","`#editor.tabSize#`","`#editor.insertSpaces#`")},"editor.trimAutoWhitespace":{type:"boolean",default:EDITOR_MODEL_DEFAULTS.trimAutoWhitespace,description:localize(149,"Remove trailing auto inserted whitespace.")},"editor.largeFileOptimizations":{type:"boolean",default:EDITOR_MODEL_DEFAULTS.largeFileOptimizations,description:localize(150,"Special handling for large files to disable certain memory intensive features.")},"editor.wordBasedSuggestions":{enum:["off","currentDocument","matchingDocuments","allDocuments"],default:"matchingDocuments",enumDescriptions:[localize(151,"Turn off Word Based Suggestions."),localize(152,"Only suggest words from the active document."),localize(153,"Suggest words from all open documents of the same language."),localize(154,"Suggest words from all open documents.")],description:localize(155,"Controls whether completions should be computed based on words in the document and from which documents they are computed.")},"editor.semanticHighlighting.enabled":{enum:[!0,!1,"configuredByTheme"],enumDescriptions:[localize(156,"Semantic highlighting enabled for all color themes."),localize(157,"Semantic highlighting disabled for all color themes."),localize(158,"Semantic highlighting is configured by the current color theme's `semanticHighlighting` setting.")],default:"configuredByTheme",description:localize(159,"Controls whether the semanticHighlighting is shown for the languages that support it.")},"editor.stablePeek":{type:"boolean",default:!1,markdownDescription:localize(160,"Keep peek editors open even when double-clicking their content or when hitting `Escape`.")},"editor.maxTokenizationLineLength":{type:"integer",default:2e4,description:localize(161,"Lines above this length will not be tokenized for performance reasons")},"editor.experimental.asyncTokenization":{type:"boolean",default:!0,description:localize(162,"Controls whether the tokenization should happen asynchronously on a web worker."),tags:["experimental"]},"editor.experimental.asyncTokenizationLogging":{type:"boolean",default:!1,description:localize(163,"Controls whether async tokenization should be logged. For debugging only.")},"editor.experimental.asyncTokenizationVerification":{type:"boolean",default:!1,description:localize(164,"Controls whether async tokenization should be verified against legacy background tokenization. Might slow down tokenization. For debugging only."),tags:["experimental"]},"editor.experimental.treeSitterTelemetry":{type:"boolean",default:!1,markdownDescription:localize(165,"Controls whether tree sitter parsing should be turned on and telemetry collected. Setting `#editor.experimental.preferTreeSitter#` for specific languages will take precedence."),tags:["experimental"],experiment:{mode:"auto"}},"editor.experimental.preferTreeSitter.css":{type:"boolean",default:!1,markdownDescription:localize(166,"Controls whether tree sitter parsing should be turned on for css. This will take precedence over `#editor.experimental.treeSitterTelemetry#` for css."),tags:["experimental"],experiment:{mode:"auto"}},"editor.experimental.preferTreeSitter.typescript":{type:"boolean",default:!1,markdownDescription:localize(167,"Controls whether tree sitter parsing should be turned on for typescript. This will take precedence over `#editor.experimental.treeSitterTelemetry#` for typescript."),tags:["experimental"],experiment:{mode:"auto"}},"editor.experimental.preferTreeSitter.ini":{type:"boolean",default:!1,markdownDescription:localize(168,"Controls whether tree sitter parsing should be turned on for ini. This will take precedence over `#editor.experimental.treeSitterTelemetry#` for ini."),tags:["experimental"],experiment:{mode:"auto"}},"editor.experimental.preferTreeSitter.regex":{type:"boolean",default:!1,markdownDescription:localize(169,"Controls whether tree sitter parsing should be turned on for regex. This will take precedence over `#editor.experimental.treeSitterTelemetry#` for regex."),tags:["experimental"],experiment:{mode:"auto"}},"editor.language.brackets":{type:["array","null"],default:null,description:localize(170,"Defines the bracket symbols that increase or decrease the indentation."),items:{type:"array",items:[{type:"string",description:localize(171,"The opening bracket character or string sequence.")},{type:"string",description:localize(172,"The closing bracket character or string sequence.")}]}},"editor.language.colorizedBracketPairs":{type:["array","null"],default:null,description:localize(173,"Defines the bracket pairs that are colorized by their nesting level if bracket pair colorization is enabled."),items:{type:"array",items:[{type:"string",description:localize(174,"The opening bracket character or string sequence.")},{type:"string",description:localize(175,"The closing bracket character or string sequence.")}]}},"diffEditor.maxComputationTime":{type:"number",default:diffEditorDefaultOptions.maxComputationTime,description:localize(176,"Timeout in milliseconds after which diff computation is cancelled. Use 0 for no timeout.")},"diffEditor.maxFileSize":{type:"number",default:diffEditorDefaultOptions.maxFileSize,description:localize(177,"Maximum file size in MB for which to compute diffs. Use 0 for no limit.")},"diffEditor.renderSideBySide":{type:"boolean",default:diffEditorDefaultOptions.renderSideBySide,description:localize(178,"Controls whether the diff editor shows the diff side by side or inline.")},"diffEditor.renderSideBySideInlineBreakpoint":{type:"number",default:diffEditorDefaultOptions.renderSideBySideInlineBreakpoint,description:localize(179,"If the diff editor width is smaller than this value, the inline view is used.")},"diffEditor.useInlineViewWhenSpaceIsLimited":{type:"boolean",default:diffEditorDefaultOptions.useInlineViewWhenSpaceIsLimited,description:localize(180,"If enabled and the editor width is too small, the inline view is used.")},"diffEditor.renderMarginRevertIcon":{type:"boolean",default:diffEditorDefaultOptions.renderMarginRevertIcon,description:localize(181,"When enabled, the diff editor shows arrows in its glyph margin to revert changes.")},"diffEditor.renderGutterMenu":{type:"boolean",default:diffEditorDefaultOptions.renderGutterMenu,description:localize(182,"When enabled, the diff editor shows a special gutter for revert and stage actions.")},"diffEditor.ignoreTrimWhitespace":{type:"boolean",default:diffEditorDefaultOptions.ignoreTrimWhitespace,description:localize(183,"When enabled, the diff editor ignores changes in leading or trailing whitespace.")},"diffEditor.renderIndicators":{type:"boolean",default:diffEditorDefaultOptions.renderIndicators,description:localize(184,"Controls whether the diff editor shows +/- indicators for added/removed changes.")},"diffEditor.codeLens":{type:"boolean",default:diffEditorDefaultOptions.diffCodeLens,description:localize(185,"Controls whether the editor shows CodeLens.")},"diffEditor.wordWrap":{type:"string",enum:["off","on","inherit"],default:diffEditorDefaultOptions.diffWordWrap,markdownEnumDescriptions:[localize(186,"Lines will never wrap."),localize(187,"Lines will wrap at the viewport width."),localize(188,"Lines will wrap according to the {0} setting.","`#editor.wordWrap#`")]},"diffEditor.diffAlgorithm":{type:"string",enum:["legacy","advanced"],default:diffEditorDefaultOptions.diffAlgorithm,markdownEnumDescriptions:[localize(189,"Uses the legacy diffing algorithm."),localize(190,"Uses the advanced diffing algorithm.")]},"diffEditor.hideUnchangedRegions.enabled":{type:"boolean",default:diffEditorDefaultOptions.hideUnchangedRegions.enabled,markdownDescription:localize(191,"Controls whether the diff editor shows unchanged regions.")},"diffEditor.hideUnchangedRegions.revealLineCount":{type:"integer",default:diffEditorDefaultOptions.hideUnchangedRegions.revealLineCount,markdownDescription:localize(192,"Controls how many lines are used for unchanged regions."),minimum:1},"diffEditor.hideUnchangedRegions.minimumLineCount":{type:"integer",default:diffEditorDefaultOptions.hideUnchangedRegions.minimumLineCount,markdownDescription:localize(193,"Controls how many lines are used as a minimum for unchanged regions."),minimum:1},"diffEditor.hideUnchangedRegions.contextLineCount":{type:"integer",default:diffEditorDefaultOptions.hideUnchangedRegions.contextLineCount,markdownDescription:localize(194,"Controls how many lines are used as context when comparing unchanged regions."),minimum:1},"diffEditor.experimental.showMoves":{type:"boolean",default:diffEditorDefaultOptions.experimental.showMoves,markdownDescription:localize(195,"Controls whether the diff editor should show detected code moves.")},"diffEditor.experimental.showEmptyDecorations":{type:"boolean",default:diffEditorDefaultOptions.experimental.showEmptyDecorations,description:localize(196,"Controls whether the diff editor shows empty decorations to see where characters got inserted or deleted.")},"diffEditor.experimental.useTrueInlineView":{type:"boolean",default:diffEditorDefaultOptions.experimental.useTrueInlineView,description:localize(197,"If enabled and the editor uses the inline view, word changes are rendered inline.")}}};function isConfigurationPropertySchema(a){return typeof a.type<"u"||typeof a.anyOf<"u"}for(const a of editorOptionsRegistry){const e=a.schema;if(typeof e<"u")if(isConfigurationPropertySchema(e))editorConfiguration.properties[`editor.${a.name}`]=e;else for(const t in e)Object.hasOwnProperty.call(e,t)&&(editorConfiguration.properties[t]=e[t])}let cachedEditorConfigurationKeys=null;function getEditorConfigurationKeys(){return cachedEditorConfigurationKeys===null&&(cachedEditorConfigurationKeys=Object.create(null),Object.keys(editorConfiguration.properties).forEach(a=>{cachedEditorConfigurationKeys[a]=!0})),cachedEditorConfigurationKeys}function isEditorConfigurationKey(a){return getEditorConfigurationKeys()[`editor.${a}`]||!1}function isDiffEditorConfigurationKey(a){return getEditorConfigurationKeys()[`diffEditor.${a}`]||!1}const configurationRegistry$1=Registry.as(Extensions$6.Configuration);configurationRegistry$1.registerConfiguration(editorConfiguration);const CodeActionKind=new class{constructor(){this.QuickFix=new HierarchicalKind("quickfix"),this.Refactor=new HierarchicalKind("refactor"),this.RefactorExtract=this.Refactor.append("extract"),this.RefactorInline=this.Refactor.append("inline"),this.RefactorMove=this.Refactor.append("move"),this.RefactorRewrite=this.Refactor.append("rewrite"),this.Notebook=new HierarchicalKind("notebook"),this.Source=new HierarchicalKind("source"),this.SourceOrganizeImports=this.Source.append("organizeImports"),this.SourceFixAll=this.Source.append("fixAll"),this.SurroundWith=this.Refactor.append("surround")}};var CodeActionTriggerSource;(function(a){a.Refactor="refactor",a.RefactorPreview="refactor preview",a.Lightbulb="lightbulb",a.Default="other (default)",a.SourceAction="source action",a.QuickFix="quick fix action",a.FixAll="fix all",a.OrganizeImports="organize imports",a.AutoFix="auto fix",a.QuickFixHover="quick fix hover window",a.OnSave="save participants",a.ProblemsView="problems view"})(CodeActionTriggerSource||(CodeActionTriggerSource={}));function mayIncludeActionsOfKind(a,e){return!(a.include&&!a.include.intersects(e)||a.excludes&&a.excludes.some(t=>excludesAction(e,t,a.include))||!a.includeSourceActions&&CodeActionKind.Source.contains(e))}function filtersAction(a,e){const t=e.kind?new HierarchicalKind(e.kind):void 0;return!(a.include&&(!t||!a.include.contains(t))||a.excludes&&t&&a.excludes.some(s=>excludesAction(t,s,a.include))||!a.includeSourceActions&&t&&CodeActionKind.Source.contains(t)||a.onlyIncludePreferredActions&&!e.isPreferred)}function excludesAction(a,e,t){return!(!e.contains(a)||t&&e.contains(t))}class CodeActionCommandArgs{static fromUser(e,t){return!e||typeof e!="object"?new CodeActionCommandArgs(t.kind,t.apply,!1):new CodeActionCommandArgs(CodeActionCommandArgs.getKindFromUser(e,t.kind),CodeActionCommandArgs.getApplyFromUser(e,t.apply),CodeActionCommandArgs.getPreferredUser(e))}static getApplyFromUser(e,t){switch(typeof e.apply=="string"?e.apply.toLowerCase():""){case"first":return"first";case"never":return"never";case"ifsingle":return"ifSingle";default:return t}}static getKindFromUser(e,t){return typeof e.kind=="string"?new HierarchicalKind(e.kind):t}static getPreferredUser(e){return typeof e.preferred=="boolean"?e.preferred:!1}constructor(e,t,s){this.kind=e,this.apply=t,this.preferred=s}}class CodeActionItem{constructor(e,t,s){this.action=e,this.provider=t,this.highlightRange=s}async resolve(e){var t;if((t=this.provider)!=null&&t.resolveCodeAction&&!this.action.edit){let s;try{s=await this.provider.resolveCodeAction(this.action,e)}catch(o){onUnexpectedExternalError(o)}s&&(this.action.edit=s.edit)}return this}}const codeActionCommandId="editor.action.codeAction",quickFixCommandId="editor.action.quickFix",autoFixCommandId="editor.action.autoFix",refactorCommandId="editor.action.refactor",sourceActionCommandId="editor.action.sourceAction",organizeImportsCommandId="editor.action.organizeImports",fixAllCommandId="editor.action.fixAll",CODE_ACTION_SOUND_APPLIED_DURATION=1e3;class ManagedCodeActionSet extends Disposable{static codeActionsPreferredComparator(e,t){return e.isPreferred&&!t.isPreferred?-1:!e.isPreferred&&t.isPreferred?1:0}static codeActionsComparator({action:e},{action:t}){return e.isAI&&!t.isAI?1:!e.isAI&&t.isAI?-1:isNonEmptyArray(e.diagnostics)?isNonEmptyArray(t.diagnostics)?ManagedCodeActionSet.codeActionsPreferredComparator(e,t):-1:isNonEmptyArray(t.diagnostics)?1:ManagedCodeActionSet.codeActionsPreferredComparator(e,t)}constructor(e,t,s){super(),this.documentation=t,this._register(s),this.allActions=[...e].sort(ManagedCodeActionSet.codeActionsComparator),this.validActions=this.allActions.filter(({action:o})=>!o.disabled)}get hasAutoFix(){return this.validActions.some(({action:e})=>!!e.kind&&CodeActionKind.QuickFix.contains(new HierarchicalKind(e.kind))&&!!e.isPreferred)}get hasAIFix(){return this.validActions.some(({action:e})=>!!e.isAI)}get allAIFixes(){return this.validActions.every(({action:e})=>!!e.isAI)}}const emptyCodeActionsResponse={actions:[],documentation:void 0};async function getCodeActions(a,e,t,s,o,r){var C;const l=s.filter||{},c={...l,excludes:[...l.excludes||[],CodeActionKind.Notebook]},d={only:(C=l.include)==null?void 0:C.value,trigger:s.type},u=new TextModelCancellationTokenSource(e,r),g=s.type===2,f=getCodeActionProviders(a,e,g?c:l),p=new DisposableStore,m=f.map(async b=>{const v=setTimeout(()=>o.report(b),1250);try{const S=await b.provideCodeActions(e,t,d,u.token);if(u.token.isCancellationRequested)return S==null||S.dispose(),emptyCodeActionsResponse;S&&p.add(S);const y=((S==null?void 0:S.actions)||[]).filter(L=>L&&filtersAction(l,L)),w=getDocumentationFromProvider(b,y,l.include);return{actions:y.map(L=>new CodeActionItem(L,b)),documentation:w}}catch(S){if(isCancellationError(S))throw S;return onUnexpectedExternalError(S),emptyCodeActionsResponse}finally{clearTimeout(v)}}),_=a.onDidChange(()=>{const b=a.all(e);equals$1(b,f)||u.cancel()});try{const b=await Promise.all(m),v=b.map(w=>w.actions).flat(),S=[...coalesce(b.map(w=>w.documentation)),...getAdditionalDocumentationForShowingActions(a,e,s,v)],y=new ManagedCodeActionSet(v,S,p);return p.add(y),y}catch(b){throw p.dispose(),b}finally{_.dispose(),u.dispose()}}function getCodeActionProviders(a,e,t){return a.all(e).filter(s=>s.providedCodeActionKinds?s.providedCodeActionKinds.some(o=>mayIncludeActionsOfKind(t,new HierarchicalKind(o))):!0)}function*getAdditionalDocumentationForShowingActions(a,e,t,s){var o,r,l;if(e&&s.length)for(const c of a.all(e))c._getAdditionalMenuItems&&(yield*(l=c._getAdditionalMenuItems)==null?void 0:l.call(c,{trigger:t.type,only:(r=(o=t.filter)==null?void 0:o.include)==null?void 0:r.value},s.map(d=>d.action)))}function getDocumentationFromProvider(a,e,t){if(!a.documentation)return;const s=a.documentation.map(o=>({kind:new HierarchicalKind(o.kind),command:o.command}));if(t){let o;for(const r of s)r.kind.contains(t)&&(o?o.kind.contains(r.kind)&&(o=r):o=r);if(o)return o==null?void 0:o.command}for(const o of e)if(o.kind){for(const r of s)if(r.kind.contains(new HierarchicalKind(o.kind)))return r.command}}var ApplyCodeActionReason;(function(a){a.OnSave="onSave",a.FromProblemsView="fromProblemsView",a.FromCodeActions="fromCodeActions",a.FromAILightbulb="fromAILightbulb",a.FromProblemsHover="fromProblemsHover"})(ApplyCodeActionReason||(ApplyCodeActionReason={}));async function applyCodeAction(a,e,t,s,o=CancellationToken.None){var g,f;const r=a.get(IBulkEditService),l=a.get(ICommandService),c=a.get(ITelemetryService),d=a.get(INotificationService),u=a.get(IAccessibilitySignalService);if(c.publicLog2("codeAction.applyCodeAction",{codeActionTitle:e.action.title,codeActionKind:e.action.kind,codeActionIsPreferred:!!e.action.isPreferred,reason:t}),u.playSignal(AccessibilitySignal.codeActionTriggered),await e.resolve(o),!o.isCancellationRequested&&!((g=e.action.edit)!=null&&g.edits.length&&!(await r.apply(e.action.edit,{editor:s==null?void 0:s.editor,label:e.action.title,quotableLabel:e.action.title,code:"undoredo.codeAction",respectAutoSaveConfig:t!==ApplyCodeActionReason.OnSave,showPreview:s==null?void 0:s.preview,reason:EditSources.codeAction({kind:e.action.kind,providerId:ProviderId.fromExtensionId((f=e.provider)==null?void 0:f.extensionId)})})).isApplied)){if(e.action.command)try{await l.executeCommand(e.action.command.id,...e.action.command.arguments||[])}catch(p){const m=asMessage(p);d.error(typeof m=="string"?m:localize(826,"An unknown error occurred while applying the code action"))}setTimeout(()=>u.playSignal(AccessibilitySignal.codeActionApplied),CODE_ACTION_SOUND_APPLIED_DURATION)}}function asMessage(a){return typeof a=="string"?a:a instanceof Error&&typeof a.message=="string"?a.message:void 0}CommandsRegistry.registerCommand("_executeCodeActionProvider",async function(a,e,t,s,o){if(!(e instanceof URI))throw illegalArgument();const{codeActionProvider:r}=a.get(ILanguageFeaturesService),l=a.get(IModelService).getModel(e);if(!l)throw illegalArgument();const c=Selection$1.isISelection(t)?Selection$1.liftSelection(t):Range$2.isIRange(t)?l.validateRange(t):void 0;if(!c)throw illegalArgument();const d=typeof s=="string"?new HierarchicalKind(s):void 0,u=await getCodeActions(r,l,c,{type:1,triggerAction:CodeActionTriggerSource.Default,filter:{includeSourceActions:!0,include:d}},Progress.None,CancellationToken.None),g=[],f=Math.min(u.validActions.length,typeof o=="number"?o:0);for(let p=0;p<f;p++)g.push(u.validActions[p].resolve(CancellationToken.None));try{return await Promise.all(g),u.validActions.map(p=>p.action)}finally{setTimeout(()=>u.dispose(),100)}});var MarkerSeverity$2;(function(a){a[a.Hint=1]="Hint",a[a.Info=2]="Info",a[a.Warning=4]="Warning",a[a.Error=8]="Error"})(MarkerSeverity$2||(MarkerSeverity$2={}));(function(a){function e(d,u){return u-d}a.compare=e;const t=Object.create(null);t[a.Error]=localize(1715,"Error"),t[a.Warning]=localize(1716,"Warning"),t[a.Info]=localize(1717,"Info");function s(d){return t[d]||""}a.toString=s;const o=Object.create(null);o[a.Error]=localize(1718,"Errors"),o[a.Warning]=localize(1719,"Warnings"),o[a.Info]=localize(1720,"Infos");function r(d){return o[d]||""}a.toStringPlural=r;function l(d){switch(d){case Severity$2.Error:return a.Error;case Severity$2.Warning:return a.Warning;case Severity$2.Info:return a.Info;case Severity$2.Ignore:return a.Hint}}a.fromSeverity=l;function c(d){switch(d){case a.Error:return Severity$2.Error;case a.Warning:return Severity$2.Warning;case a.Info:return Severity$2.Info;case a.Hint:return Severity$2.Ignore}}a.toSeverity=c})(MarkerSeverity$2||(MarkerSeverity$2={}));var IMarkerData;(function(a){const e="";function t(o){return s(o,!0)}a.makeKey=t;function s(o,r){const l=[e];return o.source?l.push(o.source.replace("¦","\\¦")):l.push(e),o.code?typeof o.code=="string"?l.push(o.code.replace("¦","\\¦")):l.push(o.code.value.replace("¦","\\¦")):l.push(e),o.severity!==void 0&&o.severity!==null?l.push(MarkerSeverity$2.toString(o.severity)):l.push(e),o.message&&r?l.push(o.message.replace("¦","\\¦")):l.push(e),o.startLineNumber!==void 0&&o.startLineNumber!==null?l.push(o.startLineNumber.toString()):l.push(e),o.startColumn!==void 0&&o.startColumn!==null?l.push(o.startColumn.toString()):l.push(e),o.endLineNumber!==void 0&&o.endLineNumber!==null?l.push(o.endLineNumber.toString()):l.push(e),o.endColumn!==void 0&&o.endColumn!==null?l.push(o.endColumn.toString()):l.push(e),l.push(e),l.join("¦")}a.makeKeyOptionalMessage=s})(IMarkerData||(IMarkerData={}));const IMarkerService=createDecorator("markerService");var __decorate$29=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$27=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},CodeActionKeybindingResolver_1,wi;let CodeActionKeybindingResolver=(wi=class{constructor(e){this.keybindingService=e}getResolver(){const e=new Lazy(()=>this.keybindingService.getKeybindings().filter(t=>CodeActionKeybindingResolver_1.codeActionCommands.indexOf(t.command)>=0).filter(t=>t.resolvedKeybinding).map(t=>{let s=t.commandArgs;return t.command===organizeImportsCommandId?s={kind:CodeActionKind.SourceOrganizeImports.value}:t.command===fixAllCommandId&&(s={kind:CodeActionKind.SourceFixAll.value}),{resolvedKeybinding:t.resolvedKeybinding,...CodeActionCommandArgs.fromUser(s,{kind:HierarchicalKind.None,apply:"never"})}}));return t=>{if(t.kind){const s=this.bestKeybindingForCodeAction(t,e.value);return s==null?void 0:s.resolvedKeybinding}}}bestKeybindingForCodeAction(e,t){if(!e.kind)return;const s=new HierarchicalKind(e.kind);return t.filter(o=>o.kind.contains(s)).filter(o=>o.preferred?e.isPreferred:!0).reduceRight((o,r)=>o?o.kind.contains(r.kind)?r:o:r,void 0)}},CodeActionKeybindingResolver_1=wi,wi.codeActionCommands=[refactorCommandId,codeActionCommandId,sourceActionCommandId,organizeImportsCommandId,fixAllCommandId],wi);CodeActionKeybindingResolver=CodeActionKeybindingResolver_1=__decorate$29([__param$27(0,IKeybindingService)],CodeActionKeybindingResolver);const codicon="",codiconModifiers="",symbolIcons="";registerColor("symbolIcon.arrayForeground",foreground,localize(1480,"The foreground color for array symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.booleanForeground",foreground,localize(1481,"The foreground color for boolean symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.classForeground",{dark:"#EE9D28",light:"#D67E00",hcDark:"#EE9D28",hcLight:"#D67E00"},localize(1482,"The foreground color for class symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.colorForeground",foreground,localize(1483,"The foreground color for color symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.constantForeground",foreground,localize(1484,"The foreground color for constant symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.constructorForeground",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},localize(1485,"The foreground color for constructor symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.enumeratorForeground",{dark:"#EE9D28",light:"#D67E00",hcDark:"#EE9D28",hcLight:"#D67E00"},localize(1486,"The foreground color for enumerator symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.enumeratorMemberForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},localize(1487,"The foreground color for enumerator member symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.eventForeground",{dark:"#EE9D28",light:"#D67E00",hcDark:"#EE9D28",hcLight:"#D67E00"},localize(1488,"The foreground color for event symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.fieldForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},localize(1489,"The foreground color for field symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.fileForeground",foreground,localize(1490,"The foreground color for file symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.folderForeground",foreground,localize(1491,"The foreground color for folder symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.functionForeground",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},localize(1492,"The foreground color for function symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.interfaceForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},localize(1493,"The foreground color for interface symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.keyForeground",foreground,localize(1494,"The foreground color for key symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.keywordForeground",foreground,localize(1495,"The foreground color for keyword symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.methodForeground",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},localize(1496,"The foreground color for method symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.moduleForeground",foreground,localize(1497,"The foreground color for module symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.namespaceForeground",foreground,localize(1498,"The foreground color for namespace symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.nullForeground",foreground,localize(1499,"The foreground color for null symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.numberForeground",foreground,localize(1500,"The foreground color for number symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.objectForeground",foreground,localize(1501,"The foreground color for object symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.operatorForeground",foreground,localize(1502,"The foreground color for operator symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.packageForeground",foreground,localize(1503,"The foreground color for package symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.propertyForeground",foreground,localize(1504,"The foreground color for property symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.referenceForeground",foreground,localize(1505,"The foreground color for reference symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.snippetForeground",foreground,localize(1506,"The foreground color for snippet symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.stringForeground",foreground,localize(1507,"The foreground color for string symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.structForeground",foreground,localize(1508,"The foreground color for struct symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.textForeground",foreground,localize(1509,"The foreground color for text symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.typeParameterForeground",foreground,localize(1510,"The foreground color for type parameter symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.unitForeground",foreground,localize(1511,"The foreground color for unit symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.variableForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},localize(1512,"The foreground color for variable symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));const uncategorizedCodeActionGroup=Object.freeze({kind:HierarchicalKind.Empty,title:localize(862,"More Actions...")}),codeActionGroups=Object.freeze([{kind:CodeActionKind.QuickFix,title:localize(863,"Quick Fix")},{kind:CodeActionKind.RefactorExtract,title:localize(864,"Extract"),icon:Codicon.wrench},{kind:CodeActionKind.RefactorInline,title:localize(865,"Inline"),icon:Codicon.wrench},{kind:CodeActionKind.RefactorRewrite,title:localize(866,"Rewrite"),icon:Codicon.wrench},{kind:CodeActionKind.RefactorMove,title:localize(867,"Move"),icon:Codicon.wrench},{kind:CodeActionKind.SurroundWith,title:localize(868,"Surround With"),icon:Codicon.surroundWith},{kind:CodeActionKind.Source,title:localize(869,"Source Action"),icon:Codicon.symbolFile},uncategorizedCodeActionGroup]);function toMenuItems(a,e,t){if(!e)return a.map(r=>{var l;return{kind:"action",item:r,group:uncategorizedCodeActionGroup,disabled:!!r.action.disabled,label:r.action.disabled||r.action.title,canPreview:!!((l=r.action.edit)!=null&&l.edits.length)}});const s=codeActionGroups.map(r=>({group:r,actions:[]}));for(const r of a){const l=r.action.kind?new HierarchicalKind(r.action.kind):HierarchicalKind.None;for(const c of s)if(c.group.kind.contains(l)){c.actions.push(r);break}}const o=[];for(const r of s)if(r.actions.length){o.push({kind:"header",group:r.group});for(const l of r.actions){const c=r.group;o.push({kind:"action",item:l,group:l.action.isAI?{title:c.title,kind:c.kind,icon:Codicon.sparkle}:c,label:l.action.title,disabled:!!l.action.disabled,keybinding:t(l.action)})}}return o}const SUPPORTED_CODE_ACTIONS=new RawContextKey("supportedCodeAction",""),APPLY_FIX_ALL_COMMAND_ID="_typescript.applyFixAllCodeAction";class CodeActionOracle extends Disposable{constructor(e,t,s,o=250){super(),this._editor=e,this._markerService=t,this._signalChange=s,this._delay=o,this._autoTriggerTimer=this._register(new TimeoutTimer),this._register(this._markerService.onMarkerChanged(r=>this._onMarkerChanges(r))),this._register(this._editor.onDidChangeCursorPosition(()=>this._tryAutoTrigger()))}trigger(e){const t=this._getRangeOfSelectionUnlessWhitespaceEnclosed(e);this._signalChange(t?{trigger:e,selection:t}:void 0)}_onMarkerChanges(e){const t=this._editor.getModel();t&&e.some(s=>isEqual(s,t.uri))&&this._tryAutoTrigger()}_tryAutoTrigger(){this._autoTriggerTimer.cancelAndSet(()=>{this.trigger({type:2,triggerAction:CodeActionTriggerSource.Default})},this._delay)}_getRangeOfSelectionUnlessWhitespaceEnclosed(e){if(!this._editor.hasModel())return;const t=this._editor.getSelection();if(e.type===1)return t;const s=this._editor.getOption(73).enabled;if(s!==ShowLightbulbIconMode$1.Off){{if(s===ShowLightbulbIconMode$1.On)return t;if(s===ShowLightbulbIconMode$1.OnCode){if(!t.isEmpty())return t;const r=this._editor.getModel(),{lineNumber:l,column:c}=t.getPosition(),d=r.getLineContent(l);if(d.length===0)return;if(c===1){if(/\s/.test(d[0]))return}else if(c===r.getLineMaxColumn(l)){if(/\s/.test(d[d.length-1]))return}else if(/\s/.test(d[c-2])&&/\s/.test(d[c-1]))return}}return t}}}var CodeActionsState;(function(a){a.Empty={type:0};class e{constructor(s,o,r){this.trigger=s,this.position=o,this._cancellablePromise=r,this.type=1,this.actions=r.catch(l=>{if(isCancellationError(l))return emptyCodeActionSet;throw l})}cancel(){this._cancellablePromise.cancel()}}a.Triggered=e})(CodeActionsState||(CodeActionsState={}));const emptyCodeActionSet=Object.freeze({allActions:[],validActions:[],dispose:()=>{},documentation:[],hasAutoFix:!1,hasAIFix:!1,allAIFixes:!1});class CodeActionModel extends Disposable{constructor(e,t,s,o,r,l){super(),this._editor=e,this._registry=t,this._markerService=s,this._progressService=r,this._configurationService=l,this._codeActionOracle=this._register(new MutableDisposable),this._state=CodeActionsState.Empty,this._onDidChangeState=this._register(new Emitter$1),this.onDidChangeState=this._onDidChangeState.event,this.codeActionsDisposable=this._register(new MutableDisposable),this._disposed=!1,this._supportedCodeActions=SUPPORTED_CODE_ACTIONS.bindTo(o),this._register(this._editor.onDidChangeModel(()=>this._update())),this._register(this._editor.onDidChangeModelLanguage(()=>this._update())),this._register(this._registry.onDidChange(()=>this._update())),this._register(this._editor.onDidChangeConfiguration(c=>{c.hasChanged(73)&&this._update()})),this._update()}dispose(){this._disposed||(this._disposed=!0,super.dispose(),this.setState(CodeActionsState.Empty,!0))}_settingEnabledNearbyQuickfixes(){var t;const e=(t=this._editor)==null?void 0:t.getModel();return this._configurationService?this._configurationService.getValue("editor.codeActionWidget.includeNearbyQuickFixes",{resource:e==null?void 0:e.uri}):!1}_update(){if(this._disposed)return;this._codeActionOracle.value=void 0,this.setState(CodeActionsState.Empty);const e=this._editor.getModel();if(e&&this._registry.has(e)&&!this._editor.getOption(104)){const t=this._registry.all(e).flatMap(s=>s.providedCodeActionKinds??[]);this._supportedCodeActions.set(t.join(" ")),this._codeActionOracle.value=new CodeActionOracle(this._editor,this._markerService,s=>{var d;if(!s){this.setState(CodeActionsState.Empty);return}const o=s.selection.getStartPosition(),r=createCancelablePromise(async u=>{var f,p,m,_,C,b,v,S,y,w;if(this._settingEnabledNearbyQuickfixes()&&s.trigger.type===1&&(s.trigger.triggerAction===CodeActionTriggerSource.QuickFix||(p=(f=s.trigger.filter)==null?void 0:f.include)!=null&&p.contains(CodeActionKind.QuickFix))){const L=await getCodeActions(this._registry,e,s.selection,s.trigger,Progress.None,u);this.codeActionsDisposable.value=L;const x=[...L.allActions];if(u.isCancellationRequested)return L.dispose(),emptyCodeActionSet;const E=(m=L.validActions)==null?void 0:m.some(D=>D.action.kind&&CodeActionKind.QuickFix.contains(new HierarchicalKind(D.action.kind))&&!D.action.isAI),I=this._markerService.read({resource:e.uri});if(E){for(const D of L.validActions)(C=(_=D.action.command)==null?void 0:_.arguments)!=null&&C.some(k=>typeof k=="string"&&k.includes(APPLY_FIX_ALL_COMMAND_ID))&&(D.action.diagnostics=[...I.filter(k=>k.relatedInformation)]);return{validActions:L.validActions,allActions:x,documentation:L.documentation,hasAutoFix:L.hasAutoFix,hasAIFix:L.hasAIFix,allAIFixes:L.allAIFixes,dispose:()=>{this.codeActionsDisposable.value=L}}}else if(!E&&I.length>0){const D=s.selection.getPosition();let k=D,N=Number.MAX_VALUE;const R=[...L.validActions];for(const A of I){const O=A.endColumn,P=A.endLineNumber,W=A.startLineNumber;if(P===D.lineNumber||W===D.lineNumber){k=new Position$1(P,O);const B={type:s.trigger.type,triggerAction:s.trigger.triggerAction,filter:{include:(b=s.trigger.filter)!=null&&b.include?(v=s.trigger.filter)==null?void 0:v.include:CodeActionKind.QuickFix},autoApply:s.trigger.autoApply,context:{notAvailableMessage:((S=s.trigger.context)==null?void 0:S.notAvailableMessage)||"",position:k}},H=new Selection$1(k.lineNumber,k.column,k.lineNumber,k.column),V=await getCodeActions(this._registry,e,H,B,Progress.None,u);if(u.isCancellationRequested)return V.dispose(),emptyCodeActionSet;if(V.validActions.length!==0){for(const K of V.validActions)(w=(y=K.action.command)==null?void 0:y.arguments)!=null&&w.some(z=>typeof z=="string"&&z.includes(APPLY_FIX_ALL_COMMAND_ID))&&(K.action.diagnostics=[...I.filter(z=>z.relatedInformation)]);L.allActions.length===0&&x.push(...V.allActions),Math.abs(D.column-O)<N?R.unshift(...V.validActions):R.push(...V.validActions)}N=Math.abs(D.column-O)}}const M=R.filter((A,O,P)=>P.findIndex(W=>W.action.title===A.action.title)===O);return M.sort((A,O)=>A.action.isPreferred&&!O.action.isPreferred?-1:!A.action.isPreferred&&O.action.isPreferred||A.action.isAI&&!O.action.isAI?1:!A.action.isAI&&O.action.isAI?-1:0),{validActions:M,allActions:x,documentation:L.documentation,hasAutoFix:L.hasAutoFix,hasAIFix:L.hasAIFix,allAIFixes:L.allAIFixes,dispose:()=>{this.codeActionsDisposable.value=L}}}}if(s.trigger.type===1){const L=await getCodeActions(this._registry,e,s.selection,s.trigger,Progress.None,u);return this.codeActionsDisposable.value=L,L}const g=await getCodeActions(this._registry,e,s.selection,s.trigger,Progress.None,u);return this.codeActionsDisposable.value=g,g});s.trigger.type===1&&((d=this._progressService)==null||d.showWhile(r,250));const l=new CodeActionsState.Triggered(s.trigger,o,r);let c=!1;this._state.type===1&&(c=this._state.trigger.type===1&&l.type===1&&l.trigger.type===2&&this._state.position!==l.position),c?setTimeout(()=>{this.setState(l)},500):this.setState(l)},void 0),this._codeActionOracle.value.trigger({type:2,triggerAction:CodeActionTriggerSource.Default})}else this._supportedCodeActions.reset()}trigger(e){var t;(t=this._codeActionOracle.value)==null||t.trigger(e),this.codeActionsDisposable.dispose()}setState(e,t){e!==this._state&&(this._state.type===1&&this._state.cancel(),this._state=e,!t&&!this._disposed&&this._onDidChangeState.fire(e))}}const lightBulbWidget="";var __decorate$28=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$26=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},LightBulbWidget_1;const GUTTER_LIGHTBULB_ICON=registerIcon("gutter-lightbulb",Codicon.lightBulb,localize(870,"Icon which spawns code actions menu from the gutter when there is no space in the editor.")),GUTTER_LIGHTBULB_AUTO_FIX_ICON=registerIcon("gutter-lightbulb-auto-fix",Codicon.lightbulbAutofix,localize(871,"Icon which spawns code actions menu from the gutter when there is no space in the editor and a quick fix is available.")),GUTTER_LIGHTBULB_AIFIX_ICON=registerIcon("gutter-lightbulb-sparkle",Codicon.lightbulbSparkle,localize(872,"Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix is available.")),GUTTER_LIGHTBULB_AIFIX_AUTO_FIX_ICON=registerIcon("gutter-lightbulb-aifix-auto-fix",Codicon.lightbulbSparkleAutofix,localize(873,"Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available.")),GUTTER_SPARKLE_FILLED_ICON=registerIcon("gutter-lightbulb-sparkle-filled",Codicon.sparkleFilled,localize(874,"Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available."));var LightBulbState;(function(a){a.Hidden={type:0};class e{constructor(s,o,r,l){this.actions=s,this.trigger=o,this.editorPosition=r,this.widgetPosition=l,this.type=1}}a.Showing=e})(LightBulbState||(LightBulbState={}));var ct;let LightBulbWidget=(ct=class extends Disposable{constructor(e,t){super(),this._editor=e,this._keybindingService=t,this._onClick=this._register(new Emitter$1),this.onClick=this._onClick.event,this._state=LightBulbState.Hidden,this._gutterState=LightBulbState.Hidden,this._iconClasses=[],this.lightbulbClasses=["codicon-"+GUTTER_LIGHTBULB_ICON.id,"codicon-"+GUTTER_LIGHTBULB_AIFIX_AUTO_FIX_ICON.id,"codicon-"+GUTTER_LIGHTBULB_AUTO_FIX_ICON.id,"codicon-"+GUTTER_LIGHTBULB_AIFIX_ICON.id,"codicon-"+GUTTER_SPARKLE_FILLED_ICON.id],this.gutterDecoration=LightBulbWidget_1.GUTTER_DECORATION,this._domNode=$$l("div.lightBulbWidget"),this._domNode.role="listbox",this._register(Gesture.ignoreTarget(this._domNode)),this._editor.addContentWidget(this),this._register(this._editor.onDidChangeModelContent(s=>{const o=this._editor.getModel();(this.state.type!==1||!o||this.state.editorPosition.lineNumber>=o.getLineCount())&&this.hide(),(this.gutterState.type!==1||!o||this.gutterState.editorPosition.lineNumber>=o.getLineCount())&&this.gutterHide()})),this._register(addStandardDisposableGenericMouseDownListener(this._domNode,s=>{if(this.state.type!==1)return;this._editor.focus(),s.preventDefault();const{top:o,height:r}=getDomNodePagePosition(this._domNode),l=this._editor.getOption(75);let c=Math.floor(l/3);this.state.widgetPosition.position!==null&&this.state.widgetPosition.position.lineNumber<this.state.editorPosition.lineNumber&&(c+=l),this._onClick.fire({x:s.posx,y:o+r+c,actions:this.state.actions,trigger:this.state.trigger})})),this._register(addDisposableListener(this._domNode,"mouseenter",s=>{(s.buttons&1)===1&&this.hide()})),this._register(Event$1.runAndSubscribe(this._keybindingService.onDidUpdateKeybindings,()=>{var s,o;this._preferredKbLabel=((s=this._keybindingService.lookupKeybinding(autoFixCommandId))==null?void 0:s.getLabel())??void 0,this._quickFixKbLabel=((o=this._keybindingService.lookupKeybinding(quickFixCommandId))==null?void 0:o.getLabel())??void 0,this._updateLightBulbTitleAndIcon()})),this._register(this._editor.onMouseDown(async s=>{if(!s.target.element||!this.lightbulbClasses.some(d=>s.target.element&&s.target.element.classList.contains(d))||this.gutterState.type!==1)return;this._editor.focus();const{top:o,height:r}=getDomNodePagePosition(s.target.element),l=this._editor.getOption(75);let c=Math.floor(l/3);this.gutterState.widgetPosition.position!==null&&this.gutterState.widgetPosition.position.lineNumber<this.gutterState.editorPosition.lineNumber&&(c+=l),this._onClick.fire({x:s.event.posx,y:o+r+c,actions:this.gutterState.actions,trigger:this.gutterState.trigger})}))}dispose(){super.dispose(),this._editor.removeContentWidget(this),this._gutterDecorationID&&this._removeGutterDecoration(this._gutterDecorationID)}getId(){return"LightBulbWidget"}getDomNode(){return this._domNode}getPosition(){return this._state.type===1?this._state.widgetPosition:null}update(e,t,s){if(e.validActions.length<=0)return this.gutterHide(),this.hide();if(!this._editor.hasTextFocus())return this.gutterHide(),this.hide();if(!this._editor.getOptions().get(73).enabled)return this.gutterHide(),this.hide();const l=this._editor.getModel();if(!l)return this.gutterHide(),this.hide();const{lineNumber:c,column:d}=l.validatePosition(s),u=l.getOptions().tabSize,g=this._editor.getOptions().get(59),f=l.getLineContent(c),p=computeIndentLevel(f,u),m=g.spaceWidth*p>22,_=L=>L>2&&this._editor.getTopForLineNumber(L)===this._editor.getTopForLineNumber(L-1),C=this._editor.getLineDecorations(c);let b=!1;if(C)for(const L of C){const x=L.options.glyphMarginClassName;if(x&&!this.lightbulbClasses.some(E=>x.includes(E))){b=!0;break}}let v=c,S=1;if(!m){const L=x=>{const E=l.getLineContent(x);return/^\s*$|^\s+/.test(E)||E.length<=S};if(c>1&&!_(c-1)){const x=l.getLineCount(),E=c===x,I=c>1&&L(c-1),D=!E&&L(c+1),k=L(c),N=!D&&!I;if(!D&&!I&&!b)return this.gutterState=new LightBulbState.Showing(e,t,s,{position:{lineNumber:v,column:S},preference:LightBulbWidget_1._posPref}),this.renderGutterLightbub(),this.hide();I||E||I&&!k?v-=1:(D||N&&k)&&(v+=1)}else if(c===1&&(c===l.getLineCount()||!L(c+1)&&!L(c)))if(this.gutterState=new LightBulbState.Showing(e,t,s,{position:{lineNumber:v,column:S},preference:LightBulbWidget_1._posPref}),b)this.gutterHide();else return this.renderGutterLightbub(),this.hide();else if(c<l.getLineCount()&&!_(c+1))v+=1;else if(d*g.spaceWidth<22)return this.hide();S=/^\S\s*$/.test(l.getLineContent(v))?2:1}this.state=new LightBulbState.Showing(e,t,s,{position:{lineNumber:v,column:S},preference:LightBulbWidget_1._posPref}),this._gutterDecorationID&&(this._removeGutterDecoration(this._gutterDecorationID),this.gutterHide());const y=e.validActions,w=e.validActions[0].action.kind;if(y.length!==1||!w){this._editor.layoutContentWidget(this);return}this._editor.layoutContentWidget(this)}hide(){this.state!==LightBulbState.Hidden&&(this.state=LightBulbState.Hidden,this._editor.layoutContentWidget(this))}gutterHide(){this.gutterState!==LightBulbState.Hidden&&(this._gutterDecorationID&&this._removeGutterDecoration(this._gutterDecorationID),this.gutterState=LightBulbState.Hidden)}get state(){return this._state}set state(e){this._state=e,this._updateLightBulbTitleAndIcon()}get gutterState(){return this._gutterState}set gutterState(e){this._gutterState=e,this._updateGutterLightBulbTitleAndIcon()}_updateLightBulbTitleAndIcon(){if(this._domNode.classList.remove(...this._iconClasses),this._iconClasses=[],this.state.type!==1)return;let e,t=!1;this.state.actions.allAIFixes?(e=Codicon.sparkleFilled,this.state.actions.validActions.length===1&&(t=!0)):this.state.actions.hasAutoFix?this.state.actions.hasAIFix?e=Codicon.lightbulbSparkleAutofix:e=Codicon.lightbulbAutofix:this.state.actions.hasAIFix?e=Codicon.lightbulbSparkle:e=Codicon.lightBulb,this._updateLightbulbTitle(this.state.actions.hasAutoFix,t),this._iconClasses=ThemeIcon.asClassNameArray(e),this._domNode.classList.add(...this._iconClasses)}_updateGutterLightBulbTitleAndIcon(){if(this.gutterState.type!==1)return;let e,t=!1;this.gutterState.actions.allAIFixes?(e=GUTTER_SPARKLE_FILLED_ICON,this.gutterState.actions.validActions.length===1&&(t=!0)):this.gutterState.actions.hasAutoFix?this.gutterState.actions.hasAIFix?e=GUTTER_LIGHTBULB_AIFIX_AUTO_FIX_ICON:e=GUTTER_LIGHTBULB_AUTO_FIX_ICON:this.gutterState.actions.hasAIFix?e=GUTTER_LIGHTBULB_AIFIX_ICON:e=GUTTER_LIGHTBULB_ICON,this._updateLightbulbTitle(this.gutterState.actions.hasAutoFix,t);const s=ModelDecorationOptions.register({description:"codicon-gutter-lightbulb-decoration",glyphMarginClassName:ThemeIcon.asClassName(e),glyphMargin:{position:GlyphMarginLane$1.Left},stickiness:1});this.gutterDecoration=s}renderGutterLightbub(){const e=this._editor.getSelection();e&&(this._gutterDecorationID===void 0?this._addGutterDecoration(e.startLineNumber):this._updateGutterDecoration(this._gutterDecorationID,e.startLineNumber))}_addGutterDecoration(e){this._editor.changeDecorations(t=>{this._gutterDecorationID=t.addDecoration(new Range$2(e,0,e,0),this.gutterDecoration)})}_removeGutterDecoration(e){this._editor.changeDecorations(t=>{t.removeDecoration(e),this._gutterDecorationID=void 0})}_updateGutterDecoration(e,t){this._editor.changeDecorations(s=>{s.changeDecoration(e,new Range$2(t,0,t,0)),s.changeDecorationOptions(e,this.gutterDecoration)})}_updateLightbulbTitle(e,t){this.state.type===1&&(t?this.title=localize(875,"Run: {0}",this.state.actions.validActions[0].action.title):e&&this._preferredKbLabel?this.title=localize(876,"Show Code Actions. Preferred Quick Fix Available ({0})",this._preferredKbLabel):!e&&this._quickFixKbLabel?this.title=localize(877,"Show Code Actions ({0})",this._quickFixKbLabel):e||(this.title=localize(878,"Show Code Actions")))}set title(e){this._domNode.title=e}},LightBulbWidget_1=ct,ct.GUTTER_DECORATION=ModelDecorationOptions.register({description:"codicon-gutter-lightbulb-decoration",glyphMarginClassName:ThemeIcon.asClassName(Codicon.lightBulb),glyphMargin:{position:GlyphMarginLane$1.Left},stickiness:1}),ct.ID="editor.contrib.lightbulbWidget",ct._posPref=[0],ct);LightBulbWidget=LightBulbWidget_1=__decorate$28([__param$26(1,IKeybindingService)],LightBulbWidget);var __decorate$27=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$25=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},CodeActionController_1;const DECORATION_CLASS_NAME$1="quickfix-edit-highlight";var kt;let CodeActionController=(kt=class extends Disposable{static get(e){return e.getContribution(CodeActionController_1.ID)}constructor(e,t,s,o,r,l,c,d,u,g,f){super(),this._commandService=c,this._configurationService=d,this._actionWidgetService=u,this._instantiationService=g,this._progressService=f,this._activeCodeActions=this._register(new MutableDisposable),this._showDisabled=!1,this._disposed=!1,this._editor=e,this._model=this._register(new CodeActionModel(this._editor,r.codeActionProvider,t,s,l,d)),this._register(this._model.onDidChangeState(p=>this.update(p))),this._lightBulbWidget=new Lazy(()=>{const p=this._editor.getContribution(LightBulbWidget.ID);return p&&this._register(p.onClick(m=>this.showCodeActionsFromLightbulb(m.actions,m))),p}),this._resolver=o.createInstance(CodeActionKeybindingResolver),this._register(this._editor.onDidLayoutChange(()=>this._actionWidgetService.hide()))}dispose(){this._disposed=!0,super.dispose()}async showCodeActionsFromLightbulb(e,t){if(e.allAIFixes&&e.validActions.length===1){const s=e.validActions[0],o=s.action.command;o&&o.id==="inlineChat.start"&&o.arguments&&o.arguments.length>=1&&(o.arguments[0]={...o.arguments[0],autoSend:!1}),await this.applyCodeAction(s,!1,!1,ApplyCodeActionReason.FromAILightbulb);return}await this.showCodeActionList(e,t,{includeDisabledActions:!1,fromLightbulb:!0})}showCodeActions(e,t,s){return this.showCodeActionList(t,s,{includeDisabledActions:!1,fromLightbulb:!1})}manualTriggerAtCurrentPosition(e,t,s,o){var l;if(!this._editor.hasModel())return;(l=MessageController.get(this._editor))==null||l.closeMessage();const r=this._editor.getPosition();this._trigger({type:1,triggerAction:t,filter:s,autoApply:o,context:{notAvailableMessage:e,position:r}})}_trigger(e){return this._model.trigger(e)}async applyCodeAction(e,t,s,o){const r=this._progressService.show(!0,500);try{await this._instantiationService.invokeFunction(applyCodeAction,e,o,{preview:s,editor:this._editor})}finally{t&&this._trigger({type:2,triggerAction:CodeActionTriggerSource.QuickFix,filter:{}}),r.done()}}hideLightBulbWidget(){var e,t;(e=this._lightBulbWidget.rawValue)==null||e.hide(),(t=this._lightBulbWidget.rawValue)==null||t.gutterHide()}async update(e){var o,r,l,c,d;if(e.type!==1){this.hideLightBulbWidget();return}let t;try{t=await e.actions}catch(u){onUnexpectedError(u);return}if(this._disposed)return;const s=this._editor.getSelection();if((s==null?void 0:s.startLineNumber)===e.position.lineNumber)if((o=this._lightBulbWidget.value)==null||o.update(t,e.trigger,e.position),e.trigger.type===1){if((r=e.trigger.filter)!=null&&r.include){const g=this.tryGetValidActionToApply(e.trigger,t);if(g){try{this.hideLightBulbWidget(),await this.applyCodeAction(g,!1,!1,ApplyCodeActionReason.FromCodeActions)}finally{t.dispose()}return}if(e.trigger.context){const f=this.getInvalidActionThatWouldHaveBeenApplied(e.trigger,t);if(f&&f.action.disabled){(l=MessageController.get(this._editor))==null||l.showMessage(f.action.disabled,e.trigger.context.position),t.dispose();return}}}const u=!!((c=e.trigger.filter)!=null&&c.include);if(e.trigger.context&&(!t.allActions.length||!u&&!t.validActions.length)){(d=MessageController.get(this._editor))==null||d.showMessage(e.trigger.context.notAvailableMessage,e.trigger.context.position),this._activeCodeActions.value=t,t.dispose();return}this._activeCodeActions.value=t,this.showCodeActionList(t,this.toCoords(e.position),{includeDisabledActions:u,fromLightbulb:!1})}else this._actionWidgetService.isVisible?t.dispose():this._activeCodeActions.value=t}getInvalidActionThatWouldHaveBeenApplied(e,t){if(t.allActions.length&&(e.autoApply==="first"&&t.validActions.length===0||e.autoApply==="ifSingle"&&t.allActions.length===1))return t.allActions.find(({action:s})=>s.disabled)}tryGetValidActionToApply(e,t){if(t.validActions.length&&(e.autoApply==="first"&&t.validActions.length>0||e.autoApply==="ifSingle"&&t.validActions.length===1))return t.validActions[0]}async showCodeActionList(e,t,s){const o=this._editor.createDecorationsCollection(),r=this._editor.getDomNode();if(!r)return;const l=s.includeDisabledActions&&(this._showDisabled||e.validActions.length===0)?e.allActions:e.validActions;if(!l.length)return;const c=Position$1.isIPosition(t)?this.toCoords(t):t,d={onSelect:async(u,g)=>{this.applyCodeAction(u,!0,!!g,s.fromLightbulb?ApplyCodeActionReason.FromAILightbulb:ApplyCodeActionReason.FromCodeActions),this._actionWidgetService.hide(!1),o.clear()},onHide:u=>{var g;(g=this._editor)==null||g.focus(),o.clear()},onHover:async(u,g)=>{var m;if(g.isCancellationRequested)return;let f=!1;const p=u.action.kind;if(p){const _=new HierarchicalKind(p);f=[CodeActionKind.RefactorExtract,CodeActionKind.RefactorInline,CodeActionKind.RefactorRewrite,CodeActionKind.RefactorMove,CodeActionKind.Source].some(b=>b.contains(_))}return{canPreview:f||!!((m=u.action.edit)!=null&&m.edits.length)}},onFocus:u=>{var g,f;if(u&&u.action){const p=u.action.ranges,m=u.action.diagnostics;if(o.clear(),p&&p.length>0){const _=m&&(m==null?void 0:m.length)>1?m.map(C=>({range:C,options:CodeActionController_1.DECORATION})):p.map(C=>({range:C,options:CodeActionController_1.DECORATION}));o.set(_)}else if(m&&m.length>0){const _=m.map(b=>({range:b,options:CodeActionController_1.DECORATION}));o.set(_);const C=m[0];if(C.startLineNumber&&C.startColumn){const b=(f=(g=this._editor.getModel())==null?void 0:g.getWordAtPosition({lineNumber:C.startLineNumber,column:C.startColumn}))==null?void 0:f.word;status(localize(859,"Context: {0} at line {1} and column {2}.",b,C.startLineNumber,C.startColumn))}}}else o.clear()}};this._actionWidgetService.show("codeActionWidget",!0,toMenuItems(l,this._shouldShowHeaders(),this._resolver.getResolver()),d,c,r,this._getActionBarActions(e,t,s))}toCoords(e){if(!this._editor.hasModel())return{x:0,y:0};this._editor.revealPosition(e,1),this._editor.render();const t=this._editor.getScrolledVisiblePosition(e),s=getDomNodePagePosition(this._editor.getDomNode()),o=s.left+t.left,r=s.top+t.top+t.height;return{x:o,y:r}}_shouldShowHeaders(){var t;const e=(t=this._editor)==null?void 0:t.getModel();return this._configurationService.getValue("editor.codeActionWidget.showHeaders",{resource:e==null?void 0:e.uri})}_getActionBarActions(e,t,s){if(s.fromLightbulb)return[];const o=e.documentation.map(r=>({id:r.id,label:r.title,tooltip:r.tooltip??"",class:void 0,enabled:!0,run:()=>this._commandService.executeCommand(r.id,...r.arguments??[])}));return s.includeDisabledActions&&e.validActions.length>0&&e.allActions.length!==e.validActions.length&&o.push(this._showDisabled?{id:"hideMoreActions",label:localize(860,"Hide Disabled"),enabled:!0,tooltip:"",class:void 0,run:()=>(this._showDisabled=!1,this.showCodeActionList(e,t,s))}:{id:"showMoreActions",label:localize(861,"Show Disabled"),enabled:!0,tooltip:"",class:void 0,run:()=>(this._showDisabled=!0,this.showCodeActionList(e,t,s))}),o}},CodeActionController_1=kt,kt.ID="editor.contrib.codeActionController",kt.DECORATION=ModelDecorationOptions.register({description:"quickfix-highlight",className:DECORATION_CLASS_NAME$1}),kt);CodeActionController=CodeActionController_1=__decorate$27([__param$25(1,IMarkerService),__param$25(2,IContextKeyService),__param$25(3,IInstantiationService),__param$25(4,ILanguageFeaturesService),__param$25(5,IEditorProgressService),__param$25(6,ICommandService),__param$25(7,IConfigurationService),__param$25(8,IActionWidgetService),__param$25(9,IInstantiationService),__param$25(10,IEditorProgressService)],CodeActionController);registerThemingParticipant((a,e)=>{((o,r)=>{r&&e.addRule(`.monaco-editor ${o} { background-color: ${r}; }`)})(".quickfix-edit-highlight",a.getColor(editorFindMatchHighlight));const s=a.getColor(editorFindMatchHighlightBorder);s&&e.addRule(`.monaco-editor .quickfix-edit-highlight { border: 1px ${isHighContrast(a.type)?"dotted":"solid"} ${s}; box-sizing: border-box; }`)});function contextKeyForSupportedActions(a){return ContextKeyExpr.regex(SUPPORTED_CODE_ACTIONS.keys()[0],new RegExp("(\\s|^)"+escapeRegExpCharacters(a.value)+"\\b"))}const argsSchema={type:"object",defaultSnippets:[{body:{kind:""}}],properties:{kind:{type:"string",description:localize(827,"Kind of the code action to run.")},apply:{type:"string",description:localize(828,"Controls when the returned actions are applied."),default:"ifSingle",enum:["first","ifSingle","never"],enumDescriptions:[localize(829,"Always apply the first returned code action."),localize(830,"Apply the first returned code action if it is the only one."),localize(831,"Do not apply the returned code actions.")]},preferred:{type:"boolean",default:!1,description:localize(832,"Controls if only preferred code actions should be returned.")}}};function triggerCodeActionsForEditorSelection(a,e,t,s,o=CodeActionTriggerSource.Default){if(a.hasModel()){const r=CodeActionController.get(a);r==null||r.manualTriggerAtCurrentPosition(e,o,t,s)}}class QuickFixAction extends EditorAction{constructor(){super({id:quickFixCommandId,label:localize2(849,"Quick Fix..."),precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasCodeActionsProvider),kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:2137,weight:100}})}run(e,t){return triggerCodeActionsForEditorSelection(t,localize(833,"No code actions available"),void 0,void 0,CodeActionTriggerSource.QuickFix)}}class CodeActionCommand extends EditorCommand{constructor(){super({id:codeActionCommandId,precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasCodeActionsProvider),metadata:{description:"Trigger a code action",args:[{name:"args",schema:argsSchema}]}})}runEditorCommand(e,t,s){const o=CodeActionCommandArgs.fromUser(s,{kind:HierarchicalKind.Empty,apply:"ifSingle"});return triggerCodeActionsForEditorSelection(t,typeof(s==null?void 0:s.kind)=="string"?o.preferred?localize(834,"No preferred code actions for '{0}' available",s.kind):localize(835,"No code actions for '{0}' available",s.kind):o.preferred?localize(836,"No preferred code actions available"):localize(837,"No code actions available"),{include:o.kind,includeSourceActions:!0,onlyIncludePreferredActions:o.preferred},o.apply)}}class RefactorAction extends EditorAction{constructor(){super({id:refactorCommandId,label:localize2(850,"Refactor..."),precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasCodeActionsProvider),kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:3120,mac:{primary:1328},weight:100},contextMenuOpts:{group:"1_modification",order:2,when:ContextKeyExpr.and(EditorContextKeys.writable,contextKeyForSupportedActions(CodeActionKind.Refactor))},metadata:{description:"Refactor...",args:[{name:"args",schema:argsSchema}]}})}run(e,t,s){const o=CodeActionCommandArgs.fromUser(s,{kind:CodeActionKind.Refactor,apply:"never"});return triggerCodeActionsForEditorSelection(t,typeof(s==null?void 0:s.kind)=="string"?o.preferred?localize(838,"No preferred refactorings for '{0}' available",s.kind):localize(839,"No refactorings for '{0}' available",s.kind):o.preferred?localize(840,"No preferred refactorings available"):localize(841,"No refactorings available"),{include:CodeActionKind.Refactor.contains(o.kind)?o.kind:HierarchicalKind.None,onlyIncludePreferredActions:o.preferred},o.apply,CodeActionTriggerSource.Refactor)}}class SourceAction extends EditorAction{constructor(){super({id:sourceActionCommandId,label:localize2(851,"Source Action..."),precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasCodeActionsProvider),contextMenuOpts:{group:"1_modification",order:2.1,when:ContextKeyExpr.and(EditorContextKeys.writable,contextKeyForSupportedActions(CodeActionKind.Source))},metadata:{description:"Source Action...",args:[{name:"args",schema:argsSchema}]}})}run(e,t,s){const o=CodeActionCommandArgs.fromUser(s,{kind:CodeActionKind.Source,apply:"never"});return triggerCodeActionsForEditorSelection(t,typeof(s==null?void 0:s.kind)=="string"?o.preferred?localize(842,"No preferred source actions for '{0}' available",s.kind):localize(843,"No source actions for '{0}' available",s.kind):o.preferred?localize(844,"No preferred source actions available"):localize(845,"No source actions available"),{include:CodeActionKind.Source.contains(o.kind)?o.kind:HierarchicalKind.None,includeSourceActions:!0,onlyIncludePreferredActions:o.preferred},o.apply,CodeActionTriggerSource.SourceAction)}}class OrganizeImportsAction extends EditorAction{constructor(){super({id:organizeImportsCommandId,label:localize2(852,"Organize Imports"),precondition:ContextKeyExpr.and(EditorContextKeys.writable,contextKeyForSupportedActions(CodeActionKind.SourceOrganizeImports)),kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:1581,weight:100},metadata:{description:localize2(853,"Organize imports in the current file. Also called 'Optimize Imports' by some tools")}})}run(e,t){return triggerCodeActionsForEditorSelection(t,localize(846,"No organize imports action available"),{include:CodeActionKind.SourceOrganizeImports,includeSourceActions:!0},"ifSingle",CodeActionTriggerSource.OrganizeImports)}}class FixAllAction extends EditorAction{constructor(){super({id:fixAllCommandId,label:localize2(854,"Fix All"),precondition:ContextKeyExpr.and(EditorContextKeys.writable,contextKeyForSupportedActions(CodeActionKind.SourceFixAll))})}run(e,t){return triggerCodeActionsForEditorSelection(t,localize(847,"No fix all action available"),{include:CodeActionKind.SourceFixAll,includeSourceActions:!0},"ifSingle",CodeActionTriggerSource.FixAll)}}class AutoFixAction extends EditorAction{constructor(){super({id:autoFixCommandId,label:localize2(855,"Auto Fix..."),precondition:ContextKeyExpr.and(EditorContextKeys.writable,contextKeyForSupportedActions(CodeActionKind.QuickFix)),kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:1625,mac:{primary:2649},weight:100}})}run(e,t){return triggerCodeActionsForEditorSelection(t,localize(848,"No auto fixes available"),{include:CodeActionKind.QuickFix,onlyIncludePreferredActions:!0},"ifSingle",CodeActionTriggerSource.AutoFix)}}registerEditorContribution(CodeActionController.ID,CodeActionController,3);registerEditorContribution(LightBulbWidget.ID,LightBulbWidget,4);registerEditorAction(QuickFixAction);registerEditorAction(RefactorAction);registerEditorAction(SourceAction);registerEditorAction(OrganizeImportsAction);registerEditorAction(AutoFixAction);registerEditorAction(FixAllAction);registerEditorCommand(new CodeActionCommand);Registry.as(Extensions$6.Configuration).registerConfiguration({...editorConfigurationBaseNode,properties:{"editor.codeActionWidget.showHeaders":{type:"boolean",scope:6,description:localize(856,"Enable/disable showing group headers in the Code Action menu."),default:!0}}});Registry.as(Extensions$6.Configuration).registerConfiguration({...editorConfigurationBaseNode,properties:{"editor.codeActionWidget.includeNearbyQuickFixes":{type:"boolean",scope:6,description:localize(857,"Enable/disable showing nearest Quick Fix within a line when not currently on a diagnostic."),default:!0}}});Registry.as(Extensions$6.Configuration).registerConfiguration({...editorConfigurationBaseNode,properties:{"editor.codeActions.triggerOnFocusChange":{type:"boolean",scope:6,markdownDescription:localize(858,"Enable triggering {0} when {1} is set to {2}. Code Actions must be set to {3} to be triggered for window and focus changes.","`#editor.codeActionsOnSave#`","`#files.autoSave#`","`afterDelay`","`always`"),default:!1}}});const Rs=class Rs{constructor(){this.lenses=[]}dispose(){var e;(e=this._store)==null||e.dispose()}get isDisposed(){var e;return((e=this._store)==null?void 0:e.isDisposed)??!1}add(e,t){isDisposable(e)&&(this._store??(this._store=new DisposableStore),this._store.add(e));for(const s of e.lenses)this.lenses.push({symbol:s,provider:t})}};Rs.Empty=new Rs;let CodeLensModel=Rs;async function getCodeLensModel(a,e,t){const s=a.ordered(e),o=new Map,r=new CodeLensModel,l=s.map(async(c,d)=>{o.set(c,d);try{const u=await Promise.resolve(c.provideCodeLenses(e,t));u&&r.add(u,c)}catch(u){onUnexpectedExternalError(u)}});return await Promise.all(l),t.isCancellationRequested?(r.dispose(),CodeLensModel.Empty):(r.lenses=r.lenses.sort((c,d)=>c.symbol.range.startLineNumber<d.symbol.range.startLineNumber?-1:c.symbol.range.startLineNumber>d.symbol.range.startLineNumber?1:o.get(c.provider)<o.get(d.provider)?-1:o.get(c.provider)>o.get(d.provider)?1:c.symbol.range.startColumn<d.symbol.range.startColumn?-1:c.symbol.range.startColumn>d.symbol.range.startColumn?1:0),r)}CommandsRegistry.registerCommand("_executeCodeLensProvider",function(a,...e){let[t,s]=e;assertType(URI.isUri(t)),assertType(typeof s=="number"||!s);const{codeLensProvider:o}=a.get(ILanguageFeaturesService),r=a.get(IModelService).getModel(t);if(!r)throw illegalArgument();const l=[],c=new DisposableStore;return getCodeLensModel(o,r,CancellationToken.None).then(d=>{c.add(d);const u=[];for(const g of d.lenses)s==null||g.symbol.command?l.push(g.symbol):s-- >0&&g.provider.resolveCodeLens&&u.push(Promise.resolve(g.provider.resolveCodeLens(r,g.symbol,CancellationToken.None)).then(f=>l.push(f||g.symbol)));return Promise.all(u)}).then(()=>l).finally(()=>{setTimeout(()=>c.dispose(),100)})});var __decorate$26=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$24=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const ICodeLensCache=createDecorator("ICodeLensCache");class CacheItem{constructor(e,t){this.lineCount=e,this.data=t}}let CodeLensCache=class{constructor(e){this._fakeProvider=new class{provideCodeLenses(){throw new Error("not supported")}},this._cache=new LRUCache(20,.75);const t="codelens/cache";runWhenWindowIdle(mainWindow,()=>e.remove(t,1));const s="codelens/cache2",o=e.get(s,1,"{}");this._deserialize(o);const r=Event$1.filter(e.onWillSaveState,l=>l.reason===WillSaveStateReason.SHUTDOWN);Event$1.once(r)(l=>{e.store(s,this._serialize(),1,1)})}put(e,t){const s=t.lenses.map(l=>{var c;return{range:l.symbol.range,command:l.symbol.command&&{id:"",title:(c=l.symbol.command)==null?void 0:c.title}}}),o=new CodeLensModel;o.add({lenses:s},this._fakeProvider);const r=new CacheItem(e.getLineCount(),o);this._cache.set(e.uri.toString(),r)}get(e){const t=this._cache.get(e.uri.toString());return t&&t.lineCount===e.getLineCount()?t.data:void 0}delete(e){this._cache.delete(e.uri.toString())}_serialize(){const e=Object.create(null);for(const[t,s]of this._cache){const o=new Set;for(const r of s.data.lenses)o.add(r.symbol.range.startLineNumber);e[t]={lineCount:s.lineCount,lines:[...o.values()]}}return JSON.stringify(e)}_deserialize(e){try{const t=JSON.parse(e);for(const s in t){const o=t[s],r=[];for(const c of o.lines)r.push({range:new Range$2(c,1,c,11)});const l=new CodeLensModel;l.add({lenses:r},this._fakeProvider),this._cache.set(s,new CacheItem(o.lineCount,l))}}catch{}}};CodeLensCache=__decorate$26([__param$24(0,IStorageService)],CodeLensCache);registerSingleton(ICodeLensCache,CodeLensCache,1);const codelensWidget="";class CodeLensViewZone{constructor(e,t,s){this.afterColumn=1073741824,this.afterLineNumber=e,this.heightInPx=t,this._onHeight=s,this.suppressMouseDown=!0,this.domNode=document.createElement("div")}onComputedHeight(e){this._lastHeight===void 0?this._lastHeight=e:this._lastHeight!==e&&(this._lastHeight=e,this._onHeight())}isVisible(){return this._lastHeight!==0&&this.domNode.hasAttribute("monaco-visible-view-zone")}}const bn=class bn{constructor(e,t){this.allowEditorOverflow=!1,this.suppressMouseDown=!0,this._commands=new Map,this._isEmpty=!0,this._editor=e,this._id=`codelens.widget-${bn._idPool++}`,this.updatePosition(t),this._domNode=document.createElement("span"),this._domNode.className="codelens-decoration"}withCommands(e,t){this._commands.clear();const s=[];let o=!1;for(let r=0;r<e.length;r++){const l=e[r];if(l&&(o=!0,l.command)){const c=renderLabelWithIcons(l.command.title.trim());if(l.command.id){const d=`c${bn._idPool++}`;s.push($$l("a",{id:d,title:l.command.tooltip,role:"button"},...c)),this._commands.set(d,l.command)}else s.push($$l("span",{title:l.command.tooltip},...c));r+1<e.length&&s.push($$l("span",void 0," | "))}}o?(reset(this._domNode,...s),this._isEmpty&&t&&this._domNode.classList.add("fadein"),this._isEmpty=!1):reset(this._domNode,$$l("span",void 0,"no commands"))}getCommand(e){return e.parentElement===this._domNode?this._commands.get(e.id):void 0}getId(){return this._id}getDomNode(){return this._domNode}updatePosition(e){const t=this._editor.getModel().getLineFirstNonWhitespaceColumn(e);this._widgetPosition={position:{lineNumber:e,column:t},preference:[1]}}getPosition(){return this._widgetPosition||null}};bn._idPool=0;let CodeLensContentWidget=bn;class CodeLensHelper{constructor(){this._removeDecorations=[],this._addDecorations=[],this._addDecorationsCallbacks=[]}addDecoration(e,t){this._addDecorations.push(e),this._addDecorationsCallbacks.push(t)}removeDecoration(e){this._removeDecorations.push(e)}commit(e){const t=e.deltaDecorations(this._removeDecorations,this._addDecorations);for(let s=0,o=t.length;s<o;s++)this._addDecorationsCallbacks[s](t[s])}}const codeLensDecorationOptions=ModelDecorationOptions.register({collapseOnReplaceEdit:!0,description:"codelens"});class CodeLensWidget{constructor(e,t,s,o,r,l){this._isDisposed=!1,this._editor=t,this._data=e,this._decorationIds=[];let c;const d=[];this._data.forEach((u,g)=>{u.symbol.command&&d.push(u.symbol),s.addDecoration({range:u.symbol.range,options:codeLensDecorationOptions},f=>this._decorationIds[g]=f),c?c=Range$2.plusRange(c,u.symbol.range):c=Range$2.lift(u.symbol.range)}),this._viewZone=new CodeLensViewZone(c.startLineNumber-1,r,l),this._viewZoneId=o.addZone(this._viewZone),d.length>0&&(this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(d,!1))}_createContentWidgetIfNecessary(){this._contentWidget?this._editor.layoutContentWidget(this._contentWidget):(this._contentWidget=new CodeLensContentWidget(this._editor,this._viewZone.afterLineNumber+1),this._editor.addContentWidget(this._contentWidget))}dispose(e,t){this._decorationIds.forEach(e.removeDecoration,e),this._decorationIds=[],t==null||t.removeZone(this._viewZoneId),this._contentWidget&&(this._editor.removeContentWidget(this._contentWidget),this._contentWidget=void 0),this._isDisposed=!0}isDisposed(){return this._isDisposed}isValid(){return this._decorationIds.some((e,t)=>{const s=this._editor.getModel().getDecorationRange(e),o=this._data[t].symbol;return!!(s&&Range$2.isEmpty(o.range)===s.isEmpty())})}updateCodeLensSymbols(e,t){this._decorationIds.forEach(t.removeDecoration,t),this._decorationIds=[],this._data=e,this._data.forEach((s,o)=>{t.addDecoration({range:s.symbol.range,options:codeLensDecorationOptions},r=>this._decorationIds[o]=r)})}updateHeight(e,t){this._viewZone.heightInPx=e,t.layoutZone(this._viewZoneId),this._contentWidget&&this._editor.layoutContentWidget(this._contentWidget)}computeIfNecessary(e){if(!this._viewZone.isVisible())return null;for(let t=0;t<this._decorationIds.length;t++){const s=e.getDecorationRange(this._decorationIds[t]);s&&(this._data[t].symbol.range=s)}return this._data}updateCommands(e){this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(e,!0);for(let t=0;t<this._data.length;t++){const s=e[t];if(s){const{symbol:o}=this._data[t];o.command=s.command||o.command}}}getCommand(e){var t;return(t=this._contentWidget)==null?void 0:t.getCommand(e)}getLineNumber(){const e=this._editor.getModel().getDecorationRange(this._decorationIds[0]);return e?e.startLineNumber:-1}update(e){if(this.isValid()){const t=this._editor.getModel().getDecorationRange(this._decorationIds[0]);t&&(this._viewZone.afterLineNumber=t.startLineNumber-1,e.layoutZone(this._viewZoneId),this._contentWidget&&(this._contentWidget.updatePosition(t.startLineNumber),this._editor.layoutContentWidget(this._contentWidget)))}}}const IEnvironmentService=createDecorator("environmentService");var __decorate$25=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$23=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const ILanguageFeatureDebounceService=createDecorator("ILanguageFeatureDebounceService");var IdentityHash;(function(a){const e=new WeakMap;let t=0;function s(o){let r=e.get(o);return r===void 0&&(r=++t,e.set(o,r)),r}a.of=s})(IdentityHash||(IdentityHash={}));class NullDebounceInformation{constructor(e){this._default=e}get(e){return this._default}update(e,t){return this._default}default(){return this._default}}class FeatureDebounceInformation{constructor(e,t,s,o,r,l){this._logService=e,this._name=t,this._registry=s,this._default=o,this._min=r,this._max=l,this._cache=new LRUCache(50,.7)}_key(e){return e.id+this._registry.all(e).reduce((t,s)=>doHash(IdentityHash.of(s),t),0)}get(e){const t=this._key(e),s=this._cache.get(t);return s?clamp(s.value,this._min,this._max):this.default()}update(e,t){const s=this._key(e);let o=this._cache.get(s);o||(o=new SlidingWindowAverage(6),this._cache.set(s,o));const r=clamp(o.update(t),this._min,this._max);return matchesScheme(e.uri,"output")||this._logService.trace(`[DEBOUNCE: ${this._name}] for ${e.uri.toString()} is ${r}ms`),r}_overall(){const e=new MovingAverage;for(const[,t]of this._cache)e.update(t.value);return e.value}default(){const e=this._overall()|0||this._default;return clamp(e,this._min,this._max)}}let LanguageFeatureDebounceService=class{constructor(e,t){this._logService=e,this._data=new Map,this._isDev=t.isExtensionDevelopment||!t.isBuilt}for(e,t,s){const o=(s==null?void 0:s.min)??50,r=(s==null?void 0:s.max)??o**2,l=(s==null?void 0:s.key)??void 0,c=`${IdentityHash.of(e)},${o}${l?","+l:""}`;let d=this._data.get(c);return d||(this._isDev?(this._logService.debug(`[DEBOUNCE: ${t}] is disabled in developed mode`),d=new NullDebounceInformation(o*1.5)):d=new FeatureDebounceInformation(this._logService,t,e,this._overallAverage()|0||o*1.5,o,r),this._data.set(c,d)),d}_overallAverage(){const e=new MovingAverage;for(const t of this._data.values())e.update(t.default());return e.value}};LanguageFeatureDebounceService=__decorate$25([__param$23(0,ILogService),__param$23(1,IEnvironmentService)],LanguageFeatureDebounceService);registerSingleton(ILanguageFeatureDebounceService,LanguageFeatureDebounceService,1);var __decorate$24=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$22=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},Rn;let CodeLensContribution=(Rn=class{constructor(e,t,s,o,r,l){this._editor=e,this._languageFeaturesService=t,this._commandService=o,this._notificationService=r,this._codeLensCache=l,this._disposables=new DisposableStore,this._localToDispose=new DisposableStore,this._lenses=[],this._oldCodeLensModels=new DisposableStore,this._provideCodeLensDebounce=s.for(t.codeLensProvider,"CodeLensProvide",{min:250}),this._resolveCodeLensesDebounce=s.for(t.codeLensProvider,"CodeLensResolve",{min:250,salt:"resolve"}),this._resolveCodeLensesScheduler=new RunOnceScheduler(()=>this._resolveCodeLensesInViewport(),this._resolveCodeLensesDebounce.default()),this._disposables.add(this._editor.onDidChangeModel(()=>this._onModelChange())),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>this._onModelChange())),this._disposables.add(this._editor.onDidChangeConfiguration(c=>{(c.hasChanged(59)||c.hasChanged(25)||c.hasChanged(24))&&this._updateLensStyle(),c.hasChanged(23)&&this._onModelChange()})),this._disposables.add(t.codeLensProvider.onDidChange(this._onModelChange,this)),this._onModelChange(),this._updateLensStyle()}dispose(){var e;this._localDispose(),this._localToDispose.dispose(),this._disposables.dispose(),this._oldCodeLensModels.dispose(),(e=this._currentCodeLensModel)==null||e.dispose()}_getLayoutInfo(){const e=Math.max(1.3,this._editor.getOption(75)/this._editor.getOption(61));let t=this._editor.getOption(25);return(!t||t<5)&&(t=this._editor.getOption(61)*.9|0),{fontSize:t,codeLensHeight:t*e|0}}_updateLensStyle(){const{codeLensHeight:e,fontSize:t}=this._getLayoutInfo(),s=this._editor.getOption(24),o=this._editor.getOption(59),{style:r}=this._editor.getContainerDomNode();r.setProperty("--vscode-editorCodeLens-lineHeight",`${e}px`),r.setProperty("--vscode-editorCodeLens-fontSize",`${t}px`),r.setProperty("--vscode-editorCodeLens-fontFeatureSettings",o.fontFeatureSettings),s&&(r.setProperty("--vscode-editorCodeLens-fontFamily",s),r.setProperty("--vscode-editorCodeLens-fontFamilyDefault",EDITOR_FONT_DEFAULTS.fontFamily)),this._editor.changeViewZones(l=>{for(const c of this._lenses)c.updateHeight(e,l)})}_localDispose(){var e,t,s;(e=this._getCodeLensModelPromise)==null||e.cancel(),this._getCodeLensModelPromise=void 0,(t=this._resolveCodeLensesPromise)==null||t.cancel(),this._resolveCodeLensesPromise=void 0,this._localToDispose.clear(),this._oldCodeLensModels.clear(),(s=this._currentCodeLensModel)==null||s.dispose()}_onModelChange(){this._localDispose();const e=this._editor.getModel();if(!e||!this._editor.getOption(23)||e.isTooLargeForTokenization())return;const t=this._codeLensCache.get(e);if(t&&this._renderCodeLensSymbols(t),!this._languageFeaturesService.codeLensProvider.has(e)){t&&disposableTimeout(()=>{const o=this._codeLensCache.get(e);t===o&&(this._codeLensCache.delete(e),this._onModelChange())},30*1e3,this._localToDispose);return}for(const o of this._languageFeaturesService.codeLensProvider.all(e))if(typeof o.onDidChange=="function"){const r=o.onDidChange(()=>s.schedule());this._localToDispose.add(r)}const s=new RunOnceScheduler(()=>{var r;const o=Date.now();(r=this._getCodeLensModelPromise)==null||r.cancel(),this._getCodeLensModelPromise=createCancelablePromise(l=>getCodeLensModel(this._languageFeaturesService.codeLensProvider,e,l)),this._getCodeLensModelPromise.then(l=>{this._currentCodeLensModel&&this._oldCodeLensModels.add(this._currentCodeLensModel),this._currentCodeLensModel=l,this._codeLensCache.put(e,l);const c=this._provideCodeLensDebounce.update(e,Date.now()-o);s.delay=c,this._renderCodeLensSymbols(l),this._resolveCodeLensesInViewportSoon()},onUnexpectedError)},this._provideCodeLensDebounce.get(e));this._localToDispose.add(s),this._localToDispose.add(toDisposable(()=>this._resolveCodeLensesScheduler.cancel())),this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{var o;this._editor.changeDecorations(r=>{this._editor.changeViewZones(l=>{const c=[];let d=-1;this._lenses.forEach(g=>{!g.isValid()||d===g.getLineNumber()?c.push(g):(g.update(l),d=g.getLineNumber())});const u=new CodeLensHelper;c.forEach(g=>{g.dispose(u,l),this._lenses.splice(this._lenses.indexOf(g),1)}),u.commit(r)})}),s.schedule(),this._resolveCodeLensesScheduler.cancel(),(o=this._resolveCodeLensesPromise)==null||o.cancel(),this._resolveCodeLensesPromise=void 0})),this._localToDispose.add(this._editor.onDidFocusEditorText(()=>{s.schedule()})),this._localToDispose.add(this._editor.onDidBlurEditorText(()=>{s.cancel()})),this._localToDispose.add(this._editor.onDidScrollChange(o=>{o.scrollTopChanged&&this._lenses.length>0&&this._resolveCodeLensesInViewportSoon()})),this._localToDispose.add(this._editor.onDidLayoutChange(()=>{this._resolveCodeLensesInViewportSoon()})),this._localToDispose.add(toDisposable(()=>{if(this._editor.getModel()){const o=StableEditorScrollState.capture(this._editor);this._editor.changeDecorations(r=>{this._editor.changeViewZones(l=>{this._disposeAllLenses(r,l)})}),o.restore(this._editor)}else this._disposeAllLenses(void 0,void 0)})),this._localToDispose.add(this._editor.onMouseDown(o=>{if(o.target.type!==9)return;let r=o.target.element;if((r==null?void 0:r.tagName)==="SPAN"&&(r=r.parentElement),(r==null?void 0:r.tagName)==="A")for(const l of this._lenses){const c=l.getCommand(r);if(c){this._commandService.executeCommand(c.id,...c.arguments||[]).catch(d=>this._notificationService.error(d));break}}})),s.schedule()}_disposeAllLenses(e,t){const s=new CodeLensHelper;for(const o of this._lenses)o.dispose(s,t);e&&s.commit(e),this._lenses.length=0}_renderCodeLensSymbols(e){if(!this._editor.hasModel())return;const t=this._editor.getModel().getLineCount(),s=[];let o;for(const c of e.lenses){const d=c.symbol.range.startLineNumber;d<1||d>t||(o&&o[o.length-1].symbol.range.startLineNumber===d?o.push(c):(o=[c],s.push(o)))}if(!s.length&&!this._lenses.length)return;const r=StableEditorScrollState.capture(this._editor),l=this._getLayoutInfo();this._editor.changeDecorations(c=>{this._editor.changeViewZones(d=>{const u=new CodeLensHelper;let g=0,f=0;for(;f<s.length&&g<this._lenses.length;){const p=s[f][0].symbol.range.startLineNumber,m=this._lenses[g].getLineNumber();m<p?(this._lenses[g].dispose(u,d),this._lenses.splice(g,1)):m===p?(this._lenses[g].updateCodeLensSymbols(s[f],u),f++,g++):(this._lenses.splice(g,0,new CodeLensWidget(s[f],this._editor,u,d,l.codeLensHeight,()=>this._resolveCodeLensesInViewportSoon())),g++,f++)}for(;g<this._lenses.length;)this._lenses[g].dispose(u,d),this._lenses.splice(g,1);for(;f<s.length;)this._lenses.push(new CodeLensWidget(s[f],this._editor,u,d,l.codeLensHeight,()=>this._resolveCodeLensesInViewportSoon())),f++;u.commit(c)})}),r.restore(this._editor)}_resolveCodeLensesInViewportSoon(){this._editor.getModel()&&this._resolveCodeLensesScheduler.schedule()}_resolveCodeLensesInViewport(){var l;(l=this._resolveCodeLensesPromise)==null||l.cancel(),this._resolveCodeLensesPromise=void 0;const e=this._editor.getModel();if(!e)return;const t=[],s=[];if(this._lenses.forEach(c=>{const d=c.computeIfNecessary(e);d&&(t.push(d),s.push(c))}),t.length===0){this._oldCodeLensModels.clear();return}const o=Date.now(),r=createCancelablePromise(c=>{const d=t.map((u,g)=>{const f=new Array(u.length),p=u.map((m,_)=>!m.symbol.command&&typeof m.provider.resolveCodeLens=="function"?Promise.resolve(m.provider.resolveCodeLens(e,m.symbol,c)).then(C=>{f[_]=C},onUnexpectedExternalError):(f[_]=m.symbol,Promise.resolve(void 0)));return Promise.all(p).then(()=>{!c.isCancellationRequested&&!s[g].isDisposed()&&s[g].updateCommands(f)})});return Promise.all(d)});this._resolveCodeLensesPromise=r,this._resolveCodeLensesPromise.then(()=>{const c=this._resolveCodeLensesDebounce.update(e,Date.now()-o);this._resolveCodeLensesScheduler.delay=c,this._currentCodeLensModel&&this._codeLensCache.put(e,this._currentCodeLensModel),this._oldCodeLensModels.clear(),r===this._resolveCodeLensesPromise&&(this._resolveCodeLensesPromise=void 0)},c=>{onUnexpectedError(c),r===this._resolveCodeLensesPromise&&(this._resolveCodeLensesPromise=void 0)})}async getModel(){var e;return await this._getCodeLensModelPromise,await this._resolveCodeLensesPromise,(e=this._currentCodeLensModel)!=null&&e.isDisposed?void 0:this._currentCodeLensModel}},Rn.ID="css.editor.codeLens",Rn);CodeLensContribution=__decorate$24([__param$22(1,ILanguageFeaturesService),__param$22(2,ILanguageFeatureDebounceService),__param$22(3,ICommandService),__param$22(4,INotificationService),__param$22(5,ICodeLensCache)],CodeLensContribution);registerEditorContribution(CodeLensContribution.ID,CodeLensContribution,1);registerEditorAction(class extends EditorAction{constructor(){super({id:"codelens.showLensesInCurrentLine",precondition:EditorContextKeys.hasCodeLensProvider,label:localize2(880,"Show CodeLens Commands for Current Line")})}async run(e,t){if(!t.hasModel())return;const s=e.get(IQuickInputService),o=e.get(ICommandService),r=e.get(INotificationService),l=t.getSelection().positionLineNumber,c=t.getContribution(CodeLensContribution.ID);if(!c)return;const d=await c.getModel();if(!d)return;const u=[];for(const p of d.lenses)p.symbol.command&&p.symbol.range.startLineNumber===l&&u.push({label:p.symbol.command.title,command:p.symbol.command});if(u.length===0)return;const g=await s.pick(u,{canPickMany:!1,placeHolder:localize(879,"Select a command")});if(!g)return;let f=g.command;if(d.isDisposed){const p=await c.getModel(),m=p==null?void 0:p.lenses.find(_=>{var C;return _.symbol.range.startLineNumber===l&&((C=_.symbol.command)==null?void 0:C.title)===f.title});if(!m||!m.symbol.command)return;f=m.symbol.command}try{await o.executeCommand(f.id,...f.arguments||[])}catch(p){r.error(p)}}});const editorFeatures=[];function registerEditorFeature(a){editorFeatures.push(a)}function getEditorFeatures(){return editorFeatures.slice(0)}class HoverRangeAnchor{constructor(e,t,s,o){this.priority=e,this.range=t,this.initialMousePosX=s,this.initialMousePosY=o,this.type=1}equals(e){return e.type===1&&this.range.equalsRange(e.range)}canAdoptVisibleHover(e,t){return e.type===1&&t.lineNumber===this.range.startLineNumber}}class HoverForeignElementAnchor{constructor(e,t,s,o,r,l){this.priority=e,this.owner=t,this.range=s,this.initialMousePosX=o,this.initialMousePosY=r,this.supportsMarkerHover=l,this.type=2}equals(e){return e.type===2&&this.owner===e.owner}canAdoptVisibleHover(e,t){return e.type===2&&this.owner===e.owner}}class RenderedHoverParts{constructor(e,t){this.renderedHoverParts=e,this.disposables=t}dispose(){var e;for(const t of this.renderedHoverParts)t.dispose();(e=this.disposables)==null||e.dispose()}}const HoverParticipantRegistry=new class{constructor(){this._participants=[]}register(e){this._participants.push(e)}getAll(){return this._participants}};var __decorate$23=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$21=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let DefaultDocumentColorProvider=class{constructor(e){this._editorWorkerService=e}async provideDocumentColors(e,t){return this._editorWorkerService.computeDefaultDocumentColors(e.uri)}provideColorPresentations(e,t,s){const o=t.range,r=t.color,l=r.alpha,c=new Color(new RGBA(Math.round(255*r.red),Math.round(255*r.green),Math.round(255*r.blue),l)),d=l?Color.Format.CSS.formatRGBA(c):Color.Format.CSS.formatRGB(c),u=l?Color.Format.CSS.formatHSLA(c):Color.Format.CSS.formatHSL(c),g=l?Color.Format.CSS.formatHexA(c):Color.Format.CSS.formatHex(c),f=[];return f.push({label:d,textEdit:{range:o,text:d}}),f.push({label:u,textEdit:{range:o,text:u}}),f.push({label:g,textEdit:{range:o,text:g}}),f}};DefaultDocumentColorProvider=__decorate$23([__param$21(0,IEditorWorkerService)],DefaultDocumentColorProvider);let DefaultDocumentColorProviderFeature=class extends Disposable{constructor(e,t){super(),this._register(e.colorProvider.register("*",new DefaultDocumentColorProvider(t)))}};DefaultDocumentColorProviderFeature=__decorate$23([__param$21(0,ILanguageFeaturesService),__param$21(1,IEditorWorkerService)],DefaultDocumentColorProviderFeature);async function getColors(a,e,t,s="auto"){return _findColorData(new ColorDataCollector,a,e,t,s)}function getColorPresentations(a,e,t,s){return Promise.resolve(t.provideColorPresentations(a,e,s))}class ColorDataCollector{constructor(){}async compute(e,t,s,o){const r=await e.provideDocumentColors(t,s);if(Array.isArray(r))for(const l of r)o.push({colorInfo:l,provider:e});return Array.isArray(r)}}class ExtColorDataCollector{constructor(){}async compute(e,t,s,o){const r=await e.provideDocumentColors(t,s);if(Array.isArray(r))for(const l of r)o.push({range:l.range,color:[l.color.red,l.color.green,l.color.blue,l.color.alpha]});return Array.isArray(r)}}class ColorPresentationsCollector{constructor(e){this.colorInfo=e}async compute(e,t,s,o){const r=await e.provideColorPresentations(t,this.colorInfo,CancellationToken.None);return Array.isArray(r)&&o.push(...r),Array.isArray(r)}}async function _findColorData(a,e,t,s,o){let r=!1,l;const c=[],d=e.ordered(t);for(let u=d.length-1;u>=0;u--){const g=d[u];if(o!=="always"&&g instanceof DefaultDocumentColorProvider)l=g;else try{await a.compute(g,t,s,c)&&(r=!0)}catch(f){onUnexpectedExternalError(f)}}return r?c:l&&o!=="never"?(await a.compute(l,t,s,c),c):[]}function _setupColorCommand(a,e){const{colorProvider:t}=a.get(ILanguageFeaturesService),s=a.get(IModelService).getModel(e);if(!s)throw illegalArgument();const o=a.get(IConfigurationService).getValue("editor.defaultColorDecorators",{resource:e});return{model:s,colorProviderRegistry:t,defaultColorDecoratorsEnablement:o}}var __decorate$22=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$20=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},ColorDetector_1;const ColorDecorationInjectedTextMarker=Object.create({});var Rt;let ColorDetector=(Rt=class extends Disposable{constructor(e,t,s,o){super(),this._editor=e,this._configurationService=t,this._languageFeaturesService=s,this._localToDispose=this._register(new DisposableStore),this._decorationsIds=[],this._colorDatas=new Map,this._decoratorLimitReporter=this._register(new DecoratorLimitReporter),this._colorDecorationClassRefs=this._register(new DisposableStore),this._colorDecoratorIds=this._editor.createDecorationsCollection(),this._ruleFactory=this._register(new DynamicCssRules(this._editor)),this._debounceInformation=o.for(s.colorProvider,"Document Colors",{min:ColorDetector_1.RECOMPUTE_TIME}),this._register(e.onDidChangeModel(()=>{this._isColorDecoratorsEnabled=this.isEnabled(),this.updateColors()})),this._register(e.onDidChangeModelLanguage(()=>this.updateColors())),this._register(s.colorProvider.onDidChange(()=>this.updateColors())),this._register(e.onDidChangeConfiguration(r=>{const l=this._isColorDecoratorsEnabled;this._isColorDecoratorsEnabled=this.isEnabled(),this._defaultColorDecoratorsEnablement=this._editor.getOption(167);const c=l!==this._isColorDecoratorsEnabled||r.hasChanged(27),d=r.hasChanged(167);(c||d)&&(this._isColorDecoratorsEnabled?this.updateColors():this.removeAllDecorations())})),this._timeoutTimer=null,this._computePromise=null,this._isColorDecoratorsEnabled=this.isEnabled(),this._defaultColorDecoratorsEnablement=this._editor.getOption(167),this.updateColors()}isEnabled(){const e=this._editor.getModel();if(!e)return!1;const t=e.getLanguageId(),s=this._configurationService.getValue(t);if(s&&typeof s=="object"){const o=s.colorDecorators;if(o&&o.enable!==void 0&&!o.enable)return o.enable}return this._editor.getOption(26)}static get(e){return e.getContribution(this.ID)}dispose(){this.stop(),this.removeAllDecorations(),super.dispose()}updateColors(){if(this.stop(),!this._isColorDecoratorsEnabled)return;const e=this._editor.getModel();!e||!this._languageFeaturesService.colorProvider.has(e)||(this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{this._timeoutTimer||(this._timeoutTimer=new TimeoutTimer,this._timeoutTimer.cancelAndSet(()=>{this._timeoutTimer=null,this.beginCompute()},this._debounceInformation.get(e)))})),this.beginCompute())}async beginCompute(){this._computePromise=createCancelablePromise(async e=>{const t=this._editor.getModel();if(!t)return[];const s=new StopWatch(!1),o=await getColors(this._languageFeaturesService.colorProvider,t,e,this._defaultColorDecoratorsEnablement);return this._debounceInformation.update(t,s.elapsed()),o});try{const e=await this._computePromise;this.updateDecorations(e),this.updateColorDecorators(e),this._computePromise=null}catch(e){onUnexpectedError(e)}}stop(){this._timeoutTimer&&(this._timeoutTimer.cancel(),this._timeoutTimer=null),this._computePromise&&(this._computePromise.cancel(),this._computePromise=null),this._localToDispose.clear()}updateDecorations(e){const t=e.map(s=>({range:{startLineNumber:s.colorInfo.range.startLineNumber,startColumn:s.colorInfo.range.startColumn,endLineNumber:s.colorInfo.range.endLineNumber,endColumn:s.colorInfo.range.endColumn},options:ModelDecorationOptions.EMPTY}));this._editor.changeDecorations(s=>{this._decorationsIds=s.deltaDecorations(this._decorationsIds,t),this._colorDatas=new Map,this._decorationsIds.forEach((o,r)=>this._colorDatas.set(o,e[r]))})}updateColorDecorators(e){this._colorDecorationClassRefs.clear();const t=[],s=this._editor.getOption(27);for(let r=0;r<e.length&&t.length<s;r++){const{red:l,green:c,blue:d,alpha:u}=e[r].colorInfo.color,g=new RGBA(Math.round(l*255),Math.round(c*255),Math.round(d*255),u),f=`rgba(${g.r}, ${g.g}, ${g.b}, ${g.a})`,p=this._colorDecorationClassRefs.add(this._ruleFactory.createClassNameRef({backgroundColor:f}));t.push({range:{startLineNumber:e[r].colorInfo.range.startLineNumber,startColumn:e[r].colorInfo.range.startColumn,endLineNumber:e[r].colorInfo.range.endLineNumber,endColumn:e[r].colorInfo.range.endColumn},options:{description:"colorDetector",before:{content:noBreakWhitespace,inlineClassName:`${p.className} colorpicker-color-decoration`,inlineClassNameAffectsLetterSpacing:!0,attachedData:ColorDecorationInjectedTextMarker}}})}const o=s<e.length?s:!1;this._decoratorLimitReporter.update(e.length,o),this._colorDecoratorIds.set(t)}removeAllDecorations(){this._editor.removeDecorations(this._decorationsIds),this._decorationsIds=[],this._colorDecoratorIds.clear(),this._colorDecorationClassRefs.clear()}getColorData(e){const t=this._editor.getModel();if(!t)return null;const s=t.getDecorationsInRange(Range$2.fromPositions(e,e)).filter(o=>this._colorDatas.has(o.id));return s.length===0?null:this._colorDatas.get(s[0].id)}isColorDecoration(e){return this._colorDecoratorIds.has(e)}},ColorDetector_1=Rt,Rt.ID="editor.contrib.colorDetector",Rt.RECOMPUTE_TIME=1e3,Rt);ColorDetector=ColorDetector_1=__decorate$22([__param$20(1,IConfigurationService),__param$20(2,ILanguageFeaturesService),__param$20(3,ILanguageFeatureDebounceService)],ColorDetector);class DecoratorLimitReporter extends Disposable{constructor(){super(...arguments),this._onDidChange=this._register(new Emitter$1),this._computed=0,this._limited=!1}update(e,t){(e!==this._computed||t!==this._limited)&&(this._computed=e,this._limited=t,this._onDidChange.fire())}}const SHOW_OR_FOCUS_HOVER_ACTION_ID="editor.action.showHover",SHOW_DEFINITION_PREVIEW_HOVER_ACTION_ID="editor.action.showDefinitionPreviewHover",HIDE_HOVER_ACTION_ID="editor.action.hideHover",SCROLL_UP_HOVER_ACTION_ID="editor.action.scrollUpHover",SCROLL_DOWN_HOVER_ACTION_ID="editor.action.scrollDownHover",SCROLL_LEFT_HOVER_ACTION_ID="editor.action.scrollLeftHover",SCROLL_RIGHT_HOVER_ACTION_ID="editor.action.scrollRightHover",PAGE_UP_HOVER_ACTION_ID="editor.action.pageUpHover",PAGE_DOWN_HOVER_ACTION_ID="editor.action.pageDownHover",GO_TO_TOP_HOVER_ACTION_ID="editor.action.goToTopHover",GO_TO_BOTTOM_HOVER_ACTION_ID="editor.action.goToBottomHover",INCREASE_HOVER_VERBOSITY_ACTION_ID="editor.action.increaseHoverVerbosityLevel",INCREASE_HOVER_VERBOSITY_ACTION_LABEL=localize(1097,"Increase Hover Verbosity Level"),DECREASE_HOVER_VERBOSITY_ACTION_ID="editor.action.decreaseHoverVerbosityLevel",DECREASE_HOVER_VERBOSITY_ACTION_LABEL=localize(1098,"Decrease Hover Verbosity Level"),inlineSuggestCommitId="editor.action.inlineSuggest.commit",showPreviousInlineSuggestionActionId="editor.action.inlineSuggest.showPrevious",showNextInlineSuggestionActionId="editor.action.inlineSuggest.showNext",jumpToNextInlineEditId="editor.action.inlineSuggest.jump",hideInlineCompletionId="editor.action.inlineSuggest.hide",toggleShowCollapsedId="editor.action.inlineSuggest.toggleShowCollapsed",inlineCompletionsHintsWidget="";var __decorate$21=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1$=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},InlineSuggestionHintsContentWidget_1;let InlineCompletionsHintsWidget=class extends Disposable{constructor(e,t,s){super(),this.editor=e,this.model=t,this.instantiationService=s,this.alwaysShowToolbar=observableFromEvent(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(71).showToolbar==="always"),this.sessionPosition=void 0,this.position=derived(this,o=>{var d,u;const r=(d=this.model.read(o))==null?void 0:d.primaryGhostText.read(o);if(!this.alwaysShowToolbar.read(o)||!r||r.parts.length===0)return this.sessionPosition=void 0,null;const l=r.parts[0].column;this.sessionPosition&&this.sessionPosition.lineNumber!==r.lineNumber&&(this.sessionPosition=void 0);const c=new Position$1(r.lineNumber,Math.min(l,((u=this.sessionPosition)==null?void 0:u.column)??Number.MAX_SAFE_INTEGER));return this.sessionPosition=c,c}),this._register(autorunWithStore((o,r)=>{const l=this.model.read(o);if(!l||!this.alwaysShowToolbar.read(o))return;const c=derived(u=>{const g=u.store.add(this.instantiationService.createInstance(InlineSuggestionHintsContentWidget.hot.read(u),this.editor,!0,this.position,l.selectedInlineCompletionIndex,l.inlineCompletionsCount,l.activeCommands,l.warning,()=>{}));return e.addContentWidget(g),u.store.add(toDisposable(()=>e.removeContentWidget(g))),u.store.add(autorun(f=>{this.position.read(f)&&l.lastTriggerKind.read(f)!==InlineCompletionTriggerKind$1.Explicit&&l.triggerExplicitly()})),g}),d=derivedObservableWithCache(this,(u,g)=>!!this.position.read(u)||!!g);r.add(autorun(u=>{d.read(u)&&c.read(u)}))}))}};InlineCompletionsHintsWidget=__decorate$21([__param$1$(2,IInstantiationService)],InlineCompletionsHintsWidget);const inlineSuggestionHintsNextIcon=registerIcon("inline-suggestion-hints-next",Codicon.chevronRight,localize(1198,"Icon for show next parameter hint.")),inlineSuggestionHintsPreviousIcon=registerIcon("inline-suggestion-hints-previous",Codicon.chevronLeft,localize(1199,"Icon for show previous parameter hint."));var dt;let InlineSuggestionHintsContentWidget=(dt=class extends Disposable{static get dropDownVisible(){return this._dropDownVisible}createCommandAction(e,t,s){const o=new Action(e,t,s,!0,()=>this._commandService.executeCommand(e)),r=this.keybindingService.lookupKeybinding(e,this._contextKeyService);let l=t;return r&&(l=localize(1200,"{0} ({1})",t,r.getLabel())),o.tooltip=l,o}constructor(e,t,s,o,r,l,c,d,u,g,f,p,m){super(),this.editor=e,this.withBorder=t,this._position=s,this._currentSuggestionIdx=o,this._suggestionCount=r,this._extraCommands=l,this._warning=c,this._relayout=d,this._commandService=u,this.keybindingService=f,this._contextKeyService=p,this._menuService=m,this.id=`InlineSuggestionHintsContentWidget${InlineSuggestionHintsContentWidget_1.id++}`,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._warningMessageContentNode=derived(_=>{const C=this._warning.read(_);return C?typeof C.message=="string"?C.message:_.store.add(renderMarkdown$1(C.message)).element:void 0}),this._warningMessageNode=n.div({class:"warningMessage",style:{maxWidth:400,margin:4,marginBottom:4,display:derived(_=>this._warning.read(_)?"block":"none")}},[this._warningMessageContentNode]).keepUpdated(this._store),this.nodes=h("div.inlineSuggestionsHints",{className:this.withBorder?"monaco-hover monaco-hover-content":""},[this._warningMessageNode.element,h("div@toolBar")]),this.previousAction=this._register(this.createCommandAction(showPreviousInlineSuggestionActionId,localize(1201,"Previous"),ThemeIcon.asClassName(inlineSuggestionHintsPreviousIcon))),this.availableSuggestionCountAction=this._register(new Action("inlineSuggestionHints.availableSuggestionCount","",void 0,!1)),this.nextAction=this._register(this.createCommandAction(showNextInlineSuggestionActionId,localize(1202,"Next"),ThemeIcon.asClassName(inlineSuggestionHintsNextIcon))),this.inlineCompletionsActionsMenus=this._register(this._menuService.createMenu(MenuId.InlineCompletionsActions,this._contextKeyService)),this.clearAvailableSuggestionCountLabelDebounced=this._register(new RunOnceScheduler(()=>{this.availableSuggestionCountAction.label=""},100)),this.disableButtonsDebounced=this._register(new RunOnceScheduler(()=>{this.previousAction.enabled=this.nextAction.enabled=!1},100)),this._register(autorun(_=>{this._warningMessageContentNode.read(_),this._warningMessageNode.readEffect(_),this._relayout()})),this.toolBar=this._register(g.createInstance(CustomizedMenuWorkbenchToolBar,this.nodes.toolBar,MenuId.InlineSuggestionToolbar,{menuOptions:{renderShortTitle:!0},toolbarOptions:{primaryGroup:_=>_.startsWith("primary")},actionViewItemProvider:(_,C)=>{if(_ instanceof MenuItemAction)return g.createInstance(StatusBarViewItem,_,void 0);if(_===this.availableSuggestionCountAction){const b=new ActionViewItemWithClassName(void 0,_,{label:!0,icon:!1});return b.setClass("availableSuggestionCount"),b}},telemetrySource:"InlineSuggestionToolbar"})),this.toolBar.setPrependedPrimaryActions([this.previousAction,this.availableSuggestionCountAction,this.nextAction]),this._register(this.toolBar.onDidChangeDropdownVisibility(_=>{InlineSuggestionHintsContentWidget_1._dropDownVisible=_})),this._register(autorun(_=>{this._position.read(_),this.editor.layoutContentWidget(this)})),this._register(autorun(_=>{const C=this._suggestionCount.read(_),b=this._currentSuggestionIdx.read(_);C!==void 0?(this.clearAvailableSuggestionCountLabelDebounced.cancel(),this.availableSuggestionCountAction.label=`${b+1}/${C}`):this.clearAvailableSuggestionCountLabelDebounced.schedule(),C!==void 0&&C>1?(this.disableButtonsDebounced.cancel(),this.previousAction.enabled=this.nextAction.enabled=!0):this.disableButtonsDebounced.schedule()})),this._register(autorun(_=>{const b=this._extraCommands.read(_).map(v=>({class:void 0,id:v.command.id,enabled:!0,tooltip:v.command.tooltip||"",label:v.command.title,run:S=>this._commandService.executeCommand(v.command.id)}));for(const[v,S]of this.inlineCompletionsActionsMenus.getActions())for(const y of S)y instanceof MenuItemAction&&b.push(y);b.length>0&&b.unshift(new Separator),this.toolBar.setAdditionalSecondaryActions(b)}))}getId(){return this.id}getDomNode(){return this.nodes.root}getPosition(){return{position:this._position.get(),preference:[1,2],positionAffinity:3}}},InlineSuggestionHintsContentWidget_1=dt,dt.hot=createHotClass(InlineSuggestionHintsContentWidget_1),dt._dropDownVisible=!1,dt.id=0,dt);InlineSuggestionHintsContentWidget=InlineSuggestionHintsContentWidget_1=__decorate$21([__param$1$(8,ICommandService),__param$1$(9,IInstantiationService),__param$1$(10,IKeybindingService),__param$1$(11,IContextKeyService),__param$1$(12,IMenuService)],InlineSuggestionHintsContentWidget);class ActionViewItemWithClassName extends ActionViewItem{constructor(){super(...arguments),this._className=void 0}setClass(e){this._className=e}render(e){super.render(e),this._className&&e.classList.add(this._className)}updateTooltip(){}}class StatusBarViewItem extends MenuEntryActionViewItem{updateLabel(){const e=this._keybindingService.lookupKeybinding(this._action.id,this._contextKeyService,!0);if(!e)return super.updateLabel();if(this.label){const t=h("div.keybinding").root;this._register(new KeybindingLabel(t,OS,{disableTitle:!0,...unthemedKeybindingLabelOptions})).set(e),this.label.textContent=this._action.label,this.label.appendChild(t),this.label.classList.add("inlineSuggestionStatusBarItemLabel")}}updateTooltip(){}}let CustomizedMenuWorkbenchToolBar=class extends WorkbenchToolBar{constructor(e,t,s,o,r,l,c,d,u){super(e,{resetMenu:t,...s},o,r,l,c,d,u),this.menuId=t,this.options2=s,this.menuService=o,this.contextKeyService=r,this.menu=this._store.add(this.menuService.createMenu(this.menuId,this.contextKeyService,{emitEventsForSubmenuChanges:!0})),this.additionalActions=[],this.prependedPrimaryActions=[],this.additionalPrimaryActions=[],this._store.add(this.menu.onDidChange(()=>this.updateToolbar())),this.updateToolbar()}updateToolbar(){var s,o,r,l,c,d,u;const{primary:e,secondary:t}=getActionBarActions(this.menu.getActions((s=this.options2)==null?void 0:s.menuOptions),(r=(o=this.options2)==null?void 0:o.toolbarOptions)==null?void 0:r.primaryGroup,(c=(l=this.options2)==null?void 0:l.toolbarOptions)==null?void 0:c.shouldInlineSubmenu,(u=(d=this.options2)==null?void 0:d.toolbarOptions)==null?void 0:u.useSeparatorsInPrimaryActions);t.push(...this.additionalActions),e.unshift(...this.prependedPrimaryActions),e.push(...this.additionalPrimaryActions),this.setActions(e,t)}setPrependedPrimaryActions(e){equals$1(this.prependedPrimaryActions,e,(t,s)=>t===s)||(this.prependedPrimaryActions=e,this.updateToolbar())}setAdditionalSecondaryActions(e){equals$1(this.additionalActions,e,(t,s)=>t===s)||(this.additionalActions=e,this.updateToolbar())}};CustomizedMenuWorkbenchToolBar=__decorate$21([__param$1$(3,IMenuService),__param$1$(4,IContextKeyService),__param$1$(5,IContextMenuService),__param$1$(6,IKeybindingService),__param$1$(7,ICommandService),__param$1$(8,ITelemetryService)],CustomizedMenuWorkbenchToolBar);function isMousePositionWithinElement(a,e,t){const s=getDomNodePagePosition(a);return!(e<s.left||e>s.left+s.width||t<s.top||t>s.top+s.height)}class HoverResult{constructor(e,t,s,o){this.value=e,this.isComplete=t,this.hasLoadingMessage=s,this.options=o}}class HoverOperation extends Disposable{constructor(e,t){super(),this._editor=e,this._computer=t,this._onResult=this._register(new Emitter$1),this.onResult=this._onResult.event,this._asyncComputationScheduler=this._register(new Debouncer(s=>this._triggerAsyncComputation(s),0)),this._syncComputationScheduler=this._register(new Debouncer(s=>this._triggerSyncComputation(s),0)),this._loadingMessageScheduler=this._register(new Debouncer(s=>this._triggerLoadingMessage(s),0)),this._state=0,this._asyncIterable=null,this._asyncIterableDone=!1,this._result=[]}dispose(){this._asyncIterable&&(this._asyncIterable.cancel(),this._asyncIterable=null),this._options=void 0,super.dispose()}get _hoverTime(){return this._editor.getOption(69).delay}get _firstWaitTime(){return this._hoverTime/2}get _secondWaitTime(){return this._hoverTime-this._firstWaitTime}get _loadingMessageTime(){return 3*this._hoverTime}_setState(e,t){this._options=t,this._state=e,this._fireResult(t)}_triggerAsyncComputation(e){this._setState(2,e),this._syncComputationScheduler.schedule(e,this._secondWaitTime),this._computer.computeAsync?(this._asyncIterableDone=!1,this._asyncIterable=createCancelableAsyncIterableProducer(t=>this._computer.computeAsync(e,t)),(async()=>{try{for await(const t of this._asyncIterable)t&&(this._result.push(t),this._fireResult(e));this._asyncIterableDone=!0,(this._state===3||this._state===4)&&this._setState(0,e)}catch(t){onUnexpectedError(t)}})()):this._asyncIterableDone=!0}_triggerSyncComputation(e){this._computer.computeSync&&(this._result=this._result.concat(this._computer.computeSync(e))),this._setState(this._asyncIterableDone?0:3,e)}_triggerLoadingMessage(e){this._state===3&&this._setState(4,e)}_fireResult(e){if(this._state===1||this._state===2)return;const t=this._state===0,s=this._state===4;this._onResult.fire(new HoverResult(this._result.slice(0),t,s,e))}start(e,t){if(e===0)this._state===0&&(this._setState(1,t),this._asyncComputationScheduler.schedule(t,this._firstWaitTime),this._loadingMessageScheduler.schedule(t,this._loadingMessageTime));else switch(this._state){case 0:this._triggerAsyncComputation(t),this._syncComputationScheduler.cancel(),this._triggerSyncComputation(t);break;case 2:this._syncComputationScheduler.cancel(),this._triggerSyncComputation(t);break}}cancel(){this._asyncComputationScheduler.cancel(),this._syncComputationScheduler.cancel(),this._loadingMessageScheduler.cancel(),this._asyncIterable&&(this._asyncIterable.cancel(),this._asyncIterable=null),this._result=[],this._options=void 0,this._state=0}get options(){return this._options}}class Debouncer extends Disposable{constructor(e,t){super(),this._scheduler=this._register(new RunOnceScheduler(()=>e(this._options),t))}schedule(e,t){this._options=e,this._scheduler.schedule(t)}cancel(){this._scheduler.cancel()}}class ResizableHTMLElement{get onDidWillResize(){return this._onDidWillResize.event}get onDidResize(){return this._onDidResize.event}constructor(){this._onDidWillResize=new Emitter$1,this._onDidResize=new Emitter$1,this._sashListener=new DisposableStore,this._size=new Dimension(0,0),this._minSize=new Dimension(0,0),this._maxSize=new Dimension(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.domNode=document.createElement("div"),this._eastSash=new Sash(this.domNode,{getVerticalSashLeft:()=>this._size.width},{orientation:0}),this._westSash=new Sash(this.domNode,{getVerticalSashLeft:()=>0},{orientation:0}),this._northSash=new Sash(this.domNode,{getHorizontalSashTop:()=>0},{orientation:1,orthogonalEdge:OrthogonalEdge.North}),this._southSash=new Sash(this.domNode,{getHorizontalSashTop:()=>this._size.height},{orientation:1,orthogonalEdge:OrthogonalEdge.South}),this._northSash.orthogonalStartSash=this._westSash,this._northSash.orthogonalEndSash=this._eastSash,this._southSash.orthogonalStartSash=this._westSash,this._southSash.orthogonalEndSash=this._eastSash;let e,t=0,s=0;this._sashListener.add(Event$1.any(this._northSash.onDidStart,this._eastSash.onDidStart,this._southSash.onDidStart,this._westSash.onDidStart)(()=>{e===void 0&&(this._onDidWillResize.fire(),e=this._size,t=0,s=0)})),this._sashListener.add(Event$1.any(this._northSash.onDidEnd,this._eastSash.onDidEnd,this._southSash.onDidEnd,this._westSash.onDidEnd)(()=>{e!==void 0&&(e=void 0,t=0,s=0,this._onDidResize.fire({dimension:this._size,done:!0}))})),this._sashListener.add(this._eastSash.onDidChange(o=>{e&&(s=o.currentX-o.startX,this.layout(e.height+t,e.width+s),this._onDidResize.fire({dimension:this._size,done:!1,east:!0}))})),this._sashListener.add(this._westSash.onDidChange(o=>{e&&(s=-(o.currentX-o.startX),this.layout(e.height+t,e.width+s),this._onDidResize.fire({dimension:this._size,done:!1,west:!0}))})),this._sashListener.add(this._northSash.onDidChange(o=>{e&&(t=-(o.currentY-o.startY),this.layout(e.height+t,e.width+s),this._onDidResize.fire({dimension:this._size,done:!1,north:!0}))})),this._sashListener.add(this._southSash.onDidChange(o=>{e&&(t=o.currentY-o.startY,this.layout(e.height+t,e.width+s),this._onDidResize.fire({dimension:this._size,done:!1,south:!0}))})),this._sashListener.add(Event$1.any(this._eastSash.onDidReset,this._westSash.onDidReset)(o=>{this._preferredSize&&(this.layout(this._size.height,this._preferredSize.width),this._onDidResize.fire({dimension:this._size,done:!0}))})),this._sashListener.add(Event$1.any(this._northSash.onDidReset,this._southSash.onDidReset)(o=>{this._preferredSize&&(this.layout(this._preferredSize.height,this._size.width),this._onDidResize.fire({dimension:this._size,done:!0}))}))}dispose(){this._northSash.dispose(),this._southSash.dispose(),this._eastSash.dispose(),this._westSash.dispose(),this._sashListener.dispose(),this._onDidResize.dispose(),this._onDidWillResize.dispose(),this.domNode.remove()}enableSashes(e,t,s,o){this._northSash.state=e?3:0,this._eastSash.state=t?3:0,this._southSash.state=s?3:0,this._westSash.state=o?3:0}layout(e=this.size.height,t=this.size.width){const{height:s,width:o}=this._minSize,{height:r,width:l}=this._maxSize;e=Math.max(s,Math.min(r,e)),t=Math.max(o,Math.min(l,t));const c=new Dimension(t,e);Dimension.equals(c,this._size)||(this.domNode.style.height=e+"px",this.domNode.style.width=t+"px",this._size=c,this._northSash.layout(),this._eastSash.layout(),this._southSash.layout(),this._westSash.layout())}clearSashHoverState(){this._eastSash.clearSashHoverState(),this._westSash.clearSashHoverState(),this._northSash.clearSashHoverState(),this._southSash.clearSashHoverState()}get size(){return this._size}set maxSize(e){this._maxSize=e}get maxSize(){return this._maxSize}set minSize(e){this._minSize=e}get minSize(){return this._minSize}set preferredSize(e){this._preferredSize=e}get preferredSize(){return this._preferredSize}}const TOP_HEIGHT=30,BOTTOM_HEIGHT=24;class ResizableContentWidget extends Disposable{constructor(e,t=new Dimension(10,10)){super(),this._editor=e,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._resizableNode=this._register(new ResizableHTMLElement),this._contentPosition=null,this._isResizing=!1,this._resizableNode.domNode.style.position="absolute",this._resizableNode.minSize=Dimension.lift(t),this._resizableNode.layout(t.height,t.width),this._resizableNode.enableSashes(!0,!0,!0,!0),this._register(this._resizableNode.onDidResize(s=>{this._resize(new Dimension(s.dimension.width,s.dimension.height)),s.done&&(this._isResizing=!1)})),this._register(this._resizableNode.onDidWillResize(()=>{this._isResizing=!0}))}get isResizing(){return this._isResizing}getDomNode(){return this._resizableNode.domNode}getPosition(){return this._contentPosition}get position(){var e;return(e=this._contentPosition)!=null&&e.position?Position$1.lift(this._contentPosition.position):void 0}_availableVerticalSpaceAbove(e){const t=this._editor.getDomNode(),s=this._editor.getScrolledVisiblePosition(e);return!t||!s?void 0:getDomNodePagePosition(t).top+s.top-TOP_HEIGHT}_availableVerticalSpaceBelow(e){const t=this._editor.getDomNode(),s=this._editor.getScrolledVisiblePosition(e);if(!t||!s)return;const o=getDomNodePagePosition(t),r=getClientArea(t.ownerDocument.body),l=o.top+s.top+s.height;return r.height-l-BOTTOM_HEIGHT}_findPositionPreference(e,t){const s=Math.min(this._availableVerticalSpaceBelow(t)??1/0,e),o=Math.min(this._availableVerticalSpaceAbove(t)??1/0,e),r=Math.min(Math.max(o,s),e),l=Math.min(e,r);let c;return this._editor.getOption(69).above?c=l<=o?1:2:c=l<=s?2:1,c===1?this._resizableNode.enableSashes(!0,!0,!1,!1):this._resizableNode.enableSashes(!1,!0,!0,!1),c}_resize(e){this._resizableNode.layout(e.height,e.width)}}const hoverWidget="",$$i=$$l;let HoverWidget$1=class extends Disposable{constructor(e){super(),this.containerDomNode=document.createElement("div"),this.containerDomNode.className="monaco-hover",this.containerDomNode.classList.toggle("fade-in",!!e),this.containerDomNode.tabIndex=0,this.containerDomNode.setAttribute("role","tooltip"),this.contentsDomNode=document.createElement("div"),this.contentsDomNode.className="monaco-hover-content",this.scrollbar=this._register(new DomScrollableElement(this.contentsDomNode,{consumeMouseWheelIfScrollbarIsNeeded:!0})),this.containerDomNode.appendChild(this.scrollbar.getDomNode())}onContentsChanged(){this.scrollbar.scanDomNode()}};class HoverAction extends Disposable{static render(e,t,s){return new HoverAction(e,t,s)}constructor(e,t,s){super(),this.actionLabel=t.label,this.actionKeybindingLabel=s,this.actionContainer=append$2(e,$$i("div.action-container")),this.actionContainer.setAttribute("tabindex","0"),this.action=append$2(this.actionContainer,$$i("a.action")),this.action.setAttribute("role","button"),t.iconClass&&append$2(this.action,$$i("span.icon")).classList.add(...t.iconClass.split(" ")),this.actionRenderedLabel=s?`${t.label} (${s})`:t.label;const o=append$2(this.action,$$i("span"));o.textContent=this.actionRenderedLabel,this._store.add(new ClickAction(this.actionContainer,t.run)),this._store.add(new KeyDownAction(this.actionContainer,t.run,[3,10])),this.setEnabled(!0)}setEnabled(e){e?(this.actionContainer.classList.remove("disabled"),this.actionContainer.removeAttribute("aria-disabled")):(this.actionContainer.classList.add("disabled"),this.actionContainer.setAttribute("aria-disabled","true"))}}function getHoverAccessibleViewHint(a,e){return a&&e?localize(7,"Inspect this in the accessible view with {0}.",e):a?localize(8,"Inspect this in the accessible view via the command Open Accessible View which is currently not triggerable via keybinding."):""}class ClickAction extends Disposable{constructor(e,t){super(),this._register(addDisposableListener(e,EventType$1.CLICK,s=>{s.stopPropagation(),s.preventDefault(),t(e)}))}}class KeyDownAction extends Disposable{constructor(e,t,s){super(),this._register(addDisposableListener(e,EventType$1.KEY_DOWN,o=>{const r=new StandardKeyboardEvent(o);s.some(l=>r.equals(l))&&(o.stopPropagation(),o.preventDefault(),t(e))}))}}var __decorate$20=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1_=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},ContentHoverWidget_1;const HORIZONTAL_SCROLLING_BY=30;var Nt;let ContentHoverWidget=(Nt=class extends ResizableContentWidget{get isVisibleFromKeyboard(){var e;return((e=this._renderedHover)==null?void 0:e.source)===2}get isVisible(){return this._hoverVisibleKey.get()??!1}get isFocused(){return this._hoverFocusedKey.get()??!1}constructor(e,t,s,o,r){const l=e.getOption(75)+8,c=150,d=new Dimension(c,l);super(e,d),this._configurationService=s,this._accessibilityService=o,this._keybindingService=r,this._hover=this._register(new HoverWidget$1(!0)),this._onDidResize=this._register(new Emitter$1),this.onDidResize=this._onDidResize.event,this._onDidScroll=this._register(new Emitter$1),this.onDidScroll=this._onDidScroll.event,this._onContentsChanged=this._register(new Emitter$1),this.onContentsChanged=this._onContentsChanged.event,this._minimumSize=d,this._hoverVisibleKey=EditorContextKeys.hoverVisible.bindTo(t),this._hoverFocusedKey=EditorContextKeys.hoverFocused.bindTo(t),append$2(this._resizableNode.domNode,this._hover.containerDomNode),this._resizableNode.domNode.style.zIndex="50",this._resizableNode.domNode.className="monaco-resizable-hover",this._register(this._editor.onDidLayoutChange(()=>{this.isVisible&&this._updateMaxDimensions()})),this._register(this._editor.onDidChangeConfiguration(g=>{g.hasChanged(59)&&this._updateFont()}));const u=this._register(trackFocus(this._resizableNode.domNode));this._register(u.onDidFocus(()=>{this._hoverFocusedKey.set(!0)})),this._register(u.onDidBlur(()=>{this._hoverFocusedKey.set(!1)})),this._register(this._hover.scrollbar.onScroll(g=>{this._onDidScroll.fire(g)})),this._setRenderedHover(void 0),this._editor.addContentWidget(this)}dispose(){var e;super.dispose(),(e=this._renderedHover)==null||e.dispose(),this._editor.removeContentWidget(this)}getId(){return ContentHoverWidget_1.ID}static _applyDimensions(e,t,s){const o=typeof t=="number"?`${t}px`:t,r=typeof s=="number"?`${s}px`:s;e.style.width=o,e.style.height=r}_setContentsDomNodeDimensions(e,t){const s=this._hover.contentsDomNode;return ContentHoverWidget_1._applyDimensions(s,e,t)}_setContainerDomNodeDimensions(e,t){const s=this._hover.containerDomNode;return ContentHoverWidget_1._applyDimensions(s,e,t)}_setScrollableElementDimensions(e,t){const s=this._hover.scrollbar.getDomNode();return ContentHoverWidget_1._applyDimensions(s,e,t)}_setHoverWidgetDimensions(e,t){this._setContainerDomNodeDimensions(e,t),this._setScrollableElementDimensions(e,t),this._setContentsDomNodeDimensions(e,t),this._layoutContentWidget()}static _applyMaxDimensions(e,t,s){const o=typeof t=="number"?`${t}px`:t,r=typeof s=="number"?`${s}px`:s;e.style.maxWidth=o,e.style.maxHeight=r}_setHoverWidgetMaxDimensions(e,t){ContentHoverWidget_1._applyMaxDimensions(this._hover.contentsDomNode,e,t),ContentHoverWidget_1._applyMaxDimensions(this._hover.scrollbar.getDomNode(),e,t),ContentHoverWidget_1._applyMaxDimensions(this._hover.containerDomNode,e,t),this._hover.containerDomNode.style.setProperty("--vscode-hover-maxWidth",typeof e=="number"?`${e}px`:e),this._layoutContentWidget()}_setAdjustedHoverWidgetDimensions(e){this._setHoverWidgetMaxDimensions("none","none"),this._setHoverWidgetDimensions(e.width,e.height)}_updateResizableNodeMaxDimensions(){const e=this._findMaximumRenderingWidth()??1/0,t=this._findMaximumRenderingHeight()??1/0;this._resizableNode.maxSize=new Dimension(e,t),this._setHoverWidgetMaxDimensions(e,t)}_resize(e){ContentHoverWidget_1._lastDimensions=new Dimension(e.width,e.height),this._setAdjustedHoverWidgetDimensions(e),this._resizableNode.layout(e.height,e.width),this._updateResizableNodeMaxDimensions(),this._hover.scrollbar.scanDomNode(),this._editor.layoutContentWidget(this),this._onDidResize.fire()}_findAvailableSpaceVertically(){var t;const e=(t=this._renderedHover)==null?void 0:t.showAtPosition;if(e)return this._positionPreference===1?this._availableVerticalSpaceAbove(e):this._availableVerticalSpaceBelow(e)}_findMaximumRenderingHeight(){const e=this._findAvailableSpaceVertically();if(!e)return;let s=this._hover.contentsDomNode.children.length-1;return Array.from(this._hover.contentsDomNode.children).forEach(o=>{s+=o.clientHeight}),Math.min(e,s)}_isHoverTextOverflowing(){this._hover.containerDomNode.style.setProperty("--vscode-hover-whiteSpace","nowrap"),this._hover.containerDomNode.style.setProperty("--vscode-hover-sourceWhiteSpace","nowrap");const e=Array.from(this._hover.contentsDomNode.children).some(t=>t.scrollWidth>t.clientWidth);return this._hover.containerDomNode.style.removeProperty("--vscode-hover-whiteSpace"),this._hover.containerDomNode.style.removeProperty("--vscode-hover-sourceWhiteSpace"),e}_findMaximumRenderingWidth(){if(!this._editor||!this._editor.hasModel())return;const e=this._isHoverTextOverflowing(),t=typeof this._contentWidth>"u"?0:this._contentWidth;return e||this._hover.containerDomNode.clientWidth<t?getClientArea(this._hover.containerDomNode.ownerDocument.body).width-14:this._hover.containerDomNode.clientWidth}isMouseGettingCloser(e,t){if(!this._renderedHover)return!1;if(this._renderedHover.initialMousePosX===void 0||this._renderedHover.initialMousePosY===void 0)return this._renderedHover.initialMousePosX=e,this._renderedHover.initialMousePosY=t,!1;const s=getDomNodePagePosition(this.getDomNode());this._renderedHover.closestMouseDistance===void 0&&(this._renderedHover.closestMouseDistance=computeDistanceFromPointToRectangle(this._renderedHover.initialMousePosX,this._renderedHover.initialMousePosY,s.left,s.top,s.width,s.height));const o=computeDistanceFromPointToRectangle(e,t,s.left,s.top,s.width,s.height);return o>this._renderedHover.closestMouseDistance+4?!1:(this._renderedHover.closestMouseDistance=Math.min(this._renderedHover.closestMouseDistance,o),!0)}_setRenderedHover(e){var t;(t=this._renderedHover)==null||t.dispose(),this._renderedHover=e,this._hoverVisibleKey.set(!!e),this._hover.containerDomNode.classList.toggle("hidden",!e)}_updateFont(){const{fontSize:e,lineHeight:t}=this._editor.getOption(59),s=this._hover.contentsDomNode;s.style.fontSize=`${e}px`,s.style.lineHeight=`${t/e}`,Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName("code")).forEach(r=>this._editor.applyFontInfo(r))}_updateContent(e){const t=this._hover.contentsDomNode;t.style.paddingBottom="",t.textContent="",t.appendChild(e)}_layoutContentWidget(){this._editor.layoutContentWidget(this),this._hover.onContentsChanged()}_updateMaxDimensions(){const e=Math.max(this._editor.getLayoutInfo().height/4,250,ContentHoverWidget_1._lastDimensions.height),t=Math.max(this._editor.getLayoutInfo().width*.66,750,ContentHoverWidget_1._lastDimensions.width);this._resizableNode.maxSize=new Dimension(t,e),this._setHoverWidgetMaxDimensions(t,e)}_render(e){this._setRenderedHover(e),this._updateFont(),this._updateContent(e.domNode),this.handleContentsChanged(),this._editor.render()}getPosition(){return this._renderedHover?{position:this._renderedHover.showAtPosition,secondaryPosition:this._renderedHover.showAtSecondaryPosition,positionAffinity:this._renderedHover.shouldAppearBeforeContent?3:void 0,preference:[this._positionPreference??1]}:null}show(e){var l;if(!this._editor||!this._editor.hasModel())return;this._render(e);const t=getTotalHeight(this._hover.containerDomNode),s=e.showAtPosition;this._positionPreference=this._findPositionPreference(t,s)??1,this.handleContentsChanged(),e.shouldFocus&&this._hover.containerDomNode.focus(),this._onDidResize.fire();const r=this._hover.containerDomNode.ownerDocument.activeElement===this._hover.containerDomNode&&getHoverAccessibleViewHint(this._configurationService.getValue("accessibility.verbosity.hover")===!0&&this._accessibilityService.isScreenReaderOptimized(),((l=this._keybindingService.lookupKeybinding("editor.action.accessibleView"))==null?void 0:l.getAriaLabel())??"");r&&(this._hover.contentsDomNode.ariaLabel=this._hover.contentsDomNode.textContent+", "+r)}hide(){if(!this._renderedHover)return;const e=this._renderedHover.shouldFocus||this._hoverFocusedKey.get();this._setRenderedHover(void 0),this._resizableNode.maxSize=new Dimension(1/0,1/0),this._resizableNode.clearSashHoverState(),this._hoverFocusedKey.set(!1),this._editor.layoutContentWidget(this),e&&this._editor.focus()}_removeConstraintsRenderNormally(){const e=this._editor.getLayoutInfo();this._resizableNode.layout(e.height,e.width),this._setHoverWidgetDimensions("auto","auto"),this._updateMaxDimensions()}setMinimumDimensions(e){this._minimumSize=new Dimension(Math.max(this._minimumSize.width,e.width),Math.max(this._minimumSize.height,e.height)),this._updateMinimumWidth()}_updateMinimumWidth(){const e=typeof this._contentWidth>"u"?this._minimumSize.width:Math.min(this._contentWidth,this._minimumSize.width);this._resizableNode.minSize=new Dimension(e,this._minimumSize.height)}handleContentsChanged(){var o;this._removeConstraintsRenderNormally();const e=this._hover.contentsDomNode;let t=getTotalHeight(e),s=getTotalWidth(e)+2;if(this._resizableNode.layout(t,s),this._setHoverWidgetDimensions(s,t),t=getTotalHeight(e),s=getTotalWidth(e),this._contentWidth=s,this._updateMinimumWidth(),this._resizableNode.layout(t,s),(o=this._renderedHover)!=null&&o.showAtPosition){const r=getTotalHeight(this._hover.containerDomNode);this._positionPreference=this._findPositionPreference(r,this._renderedHover.showAtPosition)}this._layoutContentWidget(),this._onContentsChanged.fire()}focus(){this._hover.containerDomNode.focus()}scrollUp(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._editor.getOption(59);this._hover.scrollbar.setScrollPosition({scrollTop:e-t.lineHeight})}scrollDown(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._editor.getOption(59);this._hover.scrollbar.setScrollPosition({scrollTop:e+t.lineHeight})}scrollLeft(){const e=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:e-HORIZONTAL_SCROLLING_BY})}scrollRight(){const e=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:e+HORIZONTAL_SCROLLING_BY})}pageUp(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:e-t})}pageDown(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:e+t})}goToTop(){this._hover.scrollbar.setScrollPosition({scrollTop:0})}goToBottom(){this._hover.scrollbar.setScrollPosition({scrollTop:this._hover.scrollbar.getScrollDimensions().scrollHeight})}},ContentHoverWidget_1=Nt,Nt.ID="editor.contrib.resizableContentHoverWidget",Nt._lastDimensions=new Dimension(0,0),Nt);ContentHoverWidget=ContentHoverWidget_1=__decorate$20([__param$1_(1,IContextKeyService),__param$1_(2,IConfigurationService),__param$1_(3,IAccessibilityService),__param$1_(4,IKeybindingService)],ContentHoverWidget);function computeDistanceFromPointToRectangle(a,e,t,s,o,r){const l=t+o/2,c=s+r/2,d=Math.max(Math.abs(a-l)-o/2,0),u=Math.max(Math.abs(e-c)-r/2,0);return Math.sqrt(d*d+u*u)}class ContentHoverComputer{constructor(e,t){this._editor=e,this._participants=t}static _getLineDecorations(e,t){if(t.type!==1&&!t.supportsMarkerHover)return[];const s=e.getModel(),o=t.range.startLineNumber;if(o>s.getLineCount())return[];const r=s.getLineMaxColumn(o);return e.getLineDecorations(o).filter(l=>{if(l.options.isWholeLine)return!0;const c=l.range.startLineNumber===o?l.range.startColumn:1,d=l.range.endLineNumber===o?l.range.endColumn:r;if(l.options.showIfCollapsed){if(c>t.range.startColumn+1||t.range.endColumn-1>d)return!1}else if(c>t.range.startColumn||t.range.endColumn>d)return!1;return!0})}computeAsync(e,t){const s=e.anchor;if(!this._editor.hasModel()||!s)return AsyncIterableProducer.EMPTY;const o=ContentHoverComputer._getLineDecorations(this._editor,s);return AsyncIterableProducer.merge(this._participants.map(r=>r.computeAsync?r.computeAsync(s,o,e.source,t):AsyncIterableProducer.EMPTY))}computeSync(e){if(!this._editor.hasModel())return[];const t=e.anchor,s=ContentHoverComputer._getLineDecorations(this._editor,t);let o=[];for(const r of this._participants)o=o.concat(r.computeSync(t,s,e.source));return coalesce(o)}}class ContentHoverResult{constructor(e,t,s){this.hoverParts=e,this.isComplete=t,this.options=s}filter(e){const t=this.hoverParts.filter(s=>s.isValidForHoverAnchor(e));return t.length===this.hoverParts.length?this:new FilteredContentHoverResult(this,t,this.isComplete,this.options)}}class FilteredContentHoverResult extends ContentHoverResult{constructor(e,t,s,o){super(t,s,o),this.original=e}filter(e){return this.original.filter(e)}}var __decorate$1$=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1Z=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const $$h=$$l;let EditorHoverStatusBar=class extends Disposable{get hasContent(){return this._hasContent}constructor(e,t){super(),this._keybindingService=e,this._hoverService=t,this.actions=[],this._hasContent=!1,this.hoverElement=$$h("div.hover-row.status-bar"),this.hoverElement.tabIndex=0,this.actionsElement=append$2(this.hoverElement,$$h("div.actions"))}addAction(e){const t=this._keybindingService.lookupKeybinding(e.commandId),s=t?t.getLabel():null;this._hasContent=!0;const o=this._register(HoverAction.render(this.actionsElement,e,s));return this._register(this._hoverService.setupManagedHover(getDefaultHoverDelegate("element"),o.actionContainer,o.actionRenderedLabel)),this.actions.push(o),o}append(e){const t=append$2(this.actionsElement,e);return this._hasContent=!0,t}};EditorHoverStatusBar=__decorate$1$([__param$1Z(0,IKeybindingService),__param$1Z(1,IHoverService)],EditorHoverStatusBar);class HoverProviderResult{constructor(e,t,s){this.provider=e,this.hover=t,this.ordinal=s}}async function executeProvider(a,e,t,s,o){const r=await Promise.resolve(a.provideHover(t,s,o)).catch(onUnexpectedExternalError);if(!(!r||!isValid(r)))return new HoverProviderResult(a,r,e)}function getHoverProviderResultsAsAsyncIterable(a,e,t,s,o=!1){const l=a.ordered(e,o).map((c,d)=>executeProvider(c,d,e,t,s));return AsyncIterableProducer.fromPromisesResolveOrder(l).coalesce()}async function getHoversPromise(a,e,t,s,o=!1){const r=[];for await(const l of getHoverProviderResultsAsAsyncIterable(a,e,t,s,o))r.push(l.hover);return r}registerModelAndPositionCommand("_executeHoverProvider",(a,e,t)=>{const s=a.get(ILanguageFeaturesService);return getHoversPromise(s.hoverProvider,e,t,CancellationToken.None)});registerModelAndPositionCommand("_executeHoverProvider_recursive",(a,e,t)=>{const s=a.get(ILanguageFeaturesService);return getHoversPromise(s.hoverProvider,e,t,CancellationToken.None,!0)});function isValid(a){const e=typeof a.range<"u",t=typeof a.contents<"u"&&a.contents&&a.contents.length>0;return e&&t}var __decorate$1_=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1Y=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const $$g=$$l,increaseHoverVerbosityIcon=registerIcon("hover-increase-verbosity",Codicon.add,localize(1123,"Icon for increaseing hover verbosity.")),decreaseHoverVerbosityIcon=registerIcon("hover-decrease-verbosity",Codicon.remove,localize(1124,"Icon for decreasing hover verbosity."));class MarkdownHover{constructor(e,t,s,o,r,l=void 0){this.owner=e,this.range=t,this.contents=s,this.isBeforeContent=o,this.ordinal=r,this.source=l}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}class HoverSource{constructor(e,t,s){this.hover=e,this.hoverProvider=t,this.hoverPosition=s}supportsVerbosityAction(e){switch(e){case HoverVerbosityAction$1.Increase:return this.hover.canIncreaseVerbosity??!1;case HoverVerbosityAction$1.Decrease:return this.hover.canDecreaseVerbosity??!1}}}let MarkdownHoverParticipant=class{constructor(e,t,s,o,r,l,c,d){this._editor=e,this._languageService=t,this._openerService=s,this._configurationService=o,this._languageFeaturesService=r,this._keybindingService=l,this._hoverService=c,this._commandService=d,this.hoverOrdinal=3}createLoadingMessage(e){return new MarkdownHover(this,e.range,[new MarkdownString().appendText(localize(1125,"Loading..."))],!1,2e3)}computeSync(e,t){if(!this._editor.hasModel()||e.type!==1)return[];const s=this._editor.getModel(),o=e.range.startLineNumber,r=s.getLineMaxColumn(o),l=[];let c=1e3;const d=s.getLineLength(o),u=s.getLanguageIdAtPosition(e.range.startLineNumber,e.range.startColumn),g=this._editor.getOption(133),f=this._configurationService.getValue("editor.maxTokenizationLineLength",{overrideIdentifier:u});let p=!1;g>=0&&d>g&&e.range.startColumn>=g&&(p=!0,l.push(new MarkdownHover(this,e.range,[{value:localize(1126,"Rendering paused for long line for performance reasons. This can be configured via `editor.stopRenderingLineAfter`.")}],!1,c++))),!p&&typeof f=="number"&&d>=f&&l.push(new MarkdownHover(this,e.range,[{value:localize(1127,"Tokenization is skipped for long lines for performance reasons. This can be configured via `editor.maxTokenizationLineLength`.")}],!1,c++));let m=!1;for(const _ of t){const C=_.range.startLineNumber===o?_.range.startColumn:1,b=_.range.endLineNumber===o?_.range.endColumn:r,v=_.options.hoverMessage;if(!v||isEmptyMarkdownString(v))continue;_.options.beforeContentClassName&&(m=!0);const S=new Range$2(e.range.startLineNumber,C,e.range.startLineNumber,b);l.push(new MarkdownHover(this,S,asArray(v),m,c++))}return l}computeAsync(e,t,s,o){if(!this._editor.hasModel()||e.type!==1)return AsyncIterableProducer.EMPTY;const r=this._editor.getModel(),l=this._languageFeaturesService.hoverProvider;return l.has(r)?this._getMarkdownHovers(l,r,e,o):AsyncIterableProducer.EMPTY}async*_getMarkdownHovers(e,t,s,o){const r=s.range.getStartPosition(),l=getHoverProviderResultsAsAsyncIterable(e,t,r,o);for await(const c of l)if(!isEmptyMarkdownString(c.hover.contents)){const d=c.hover.range?Range$2.lift(c.hover.range):s.range,u=new HoverSource(c.hover,c.provider,r);yield new MarkdownHover(this,d,c.hover.contents,!1,c.ordinal,u)}}renderHoverParts(e,t){return this._renderedHoverParts=new MarkdownRenderedHoverParts(t,e.fragment,this,this._editor,this._languageService,this._openerService,this._commandService,this._keybindingService,this._hoverService,this._configurationService,e.onContentsChanged),this._renderedHoverParts}handleScroll(e){var t;(t=this._renderedHoverParts)==null||t.handleScroll(e)}updateMarkdownHoverVerbosityLevel(e,t){var s;return Promise.resolve((s=this._renderedHoverParts)==null?void 0:s.updateMarkdownHoverPartVerbosityLevel(e,t))}};MarkdownHoverParticipant=__decorate$1_([__param$1Y(1,ILanguageService),__param$1Y(2,IOpenerService),__param$1Y(3,IConfigurationService),__param$1Y(4,ILanguageFeaturesService),__param$1Y(5,IKeybindingService),__param$1Y(6,IHoverService),__param$1Y(7,ICommandService)],MarkdownHoverParticipant);class RenderedMarkdownHoverPart{constructor(e,t,s,o){this.hoverPart=e,this.hoverElement=t,this.disposables=s,this.actionsContainer=o}dispose(){this.disposables.dispose()}}class MarkdownRenderedHoverParts{constructor(e,t,s,o,r,l,c,d,u,g,f){this._hoverParticipant=s,this._editor=o,this._languageService=r,this._openerService=l,this._commandService=c,this._keybindingService=d,this._hoverService=u,this._configurationService=g,this._onFinishedRendering=f,this._ongoingHoverOperations=new Map,this._disposables=new DisposableStore,this.renderedHoverParts=this._renderHoverParts(e,t,this._onFinishedRendering),this._disposables.add(toDisposable(()=>{this.renderedHoverParts.forEach(p=>{p.dispose()}),this._ongoingHoverOperations.forEach(p=>{p.tokenSource.dispose(!0)})}))}_renderHoverParts(e,t,s){return e.sort(compareBy(o=>o.ordinal,numberComparator)),e.map(o=>{const r=this._renderHoverPart(o,s);return t.appendChild(r.hoverElement),r})}_renderHoverPart(e,t){const s=this._renderMarkdownHover(e,t),o=s.hoverElement,r=e.source,l=new DisposableStore;if(l.add(s),!r)return new RenderedMarkdownHoverPart(e,o,l);const c=r.supportsVerbosityAction(HoverVerbosityAction$1.Increase),d=r.supportsVerbosityAction(HoverVerbosityAction$1.Decrease);if(!c&&!d)return new RenderedMarkdownHoverPart(e,o,l);const u=$$g("div.verbosity-actions");o.prepend(u);const g=$$g("div.verbosity-actions-inner");return u.append(g),l.add(this._renderHoverExpansionAction(g,HoverVerbosityAction$1.Increase,c)),l.add(this._renderHoverExpansionAction(g,HoverVerbosityAction$1.Decrease,d)),new RenderedMarkdownHoverPart(e,o,l,g)}_renderMarkdownHover(e,t){return renderMarkdown(this._editor,e,this._languageService,this._openerService,t)}_renderHoverExpansionAction(e,t,s){const o=new DisposableStore,r=t===HoverVerbosityAction$1.Increase,l=append$2(e,$$g(ThemeIcon.asCSSSelector(r?increaseHoverVerbosityIcon:decreaseHoverVerbosityIcon)));l.tabIndex=0;const c=new WorkbenchHoverDelegate("mouse",void 0,{target:e,position:{hoverPosition:0}},this._configurationService,this._hoverService);if(o.add(this._hoverService.setupManagedHover(c,l,labelForHoverVerbosityAction(this._keybindingService,t))),!s)return l.classList.add("disabled"),o;l.classList.add("enabled");const d=()=>this._commandService.executeCommand(t===HoverVerbosityAction$1.Increase?INCREASE_HOVER_VERBOSITY_ACTION_ID:DECREASE_HOVER_VERBOSITY_ACTION_ID,{focus:!0});return o.add(new ClickAction(l,d)),o.add(new KeyDownAction(l,d,[3,10])),o}handleScroll(e){this.renderedHoverParts.forEach(t=>{const s=t.actionsContainer;if(!s)return;const o=t.hoverElement,l=e.scrollTop+e.height,c=o.offsetTop,d=o.clientHeight,u=c+d,g=22;let f;u<=l||c>=l?f=d-g:f=l-c-g,s.style.top=`${f}px`})}async updateMarkdownHoverPartVerbosityLevel(e,t){const s=this._editor.getModel();if(!s)return;const o=this._getRenderedHoverPartAtIndex(t),r=o==null?void 0:o.hoverPart.source;if(!o||!(r!=null&&r.supportsVerbosityAction(e)))return;const l=await this._fetchHover(r,s,e);if(!l)return;const c=new HoverSource(l,r.hoverProvider,r.hoverPosition),d=o.hoverPart,u=new MarkdownHover(this._hoverParticipant,d.range,l.contents,d.isBeforeContent,d.ordinal,c),g=this._updateRenderedHoverPart(t,u);if(g)return{hoverPart:u,hoverElement:g.hoverElement}}async _fetchHover(e,t,s){let o=s===HoverVerbosityAction$1.Increase?1:-1;const r=e.hoverProvider,l=this._ongoingHoverOperations.get(r);l&&(l.tokenSource.cancel(),o+=l.verbosityDelta);const c=new CancellationTokenSource$1;this._ongoingHoverOperations.set(r,{verbosityDelta:o,tokenSource:c});const d={verbosityRequest:{verbosityDelta:o,previousHover:e.hover}};let u;try{u=await Promise.resolve(r.provideHover(t,e.hoverPosition,c.token,d))}catch(g){onUnexpectedExternalError(g)}return c.dispose(),this._ongoingHoverOperations.delete(r),u}_updateRenderedHoverPart(e,t){if(e>=this.renderedHoverParts.length||e<0)return;const s=this._renderHoverPart(t,this._onFinishedRendering),o=this.renderedHoverParts[e],r=o.hoverElement,l=s.hoverElement,c=Array.from(l.children);r.replaceChildren(...c);const d=new RenderedMarkdownHoverPart(t,r,s.disposables,s.actionsContainer);return o.dispose(),this.renderedHoverParts[e]=d,d}_getRenderedHoverPartAtIndex(e){return this.renderedHoverParts[e]}dispose(){this._disposables.dispose()}}function renderMarkdownHovers(a,e,t,s,o){e.sort(compareBy(l=>l.ordinal,numberComparator));const r=[];for(const l of e){const c=renderMarkdown(t,l,s,o,a.onContentsChanged);a.fragment.appendChild(c.hoverElement),r.push(c)}return new RenderedHoverParts(r)}function renderMarkdown(a,e,t,s,o){const r=new DisposableStore,l=$$g("div.hover-row"),c=$$g("div.hover-row-contents");l.appendChild(c);const d=e.contents;for(const g of d){if(isEmptyMarkdownString(g))continue;const f=$$g("div.markdown-hover"),p=append$2(f,$$g("div.hover-contents")),m=new MarkdownRenderer({editor:a},t,s),_=r.add(m.render(g,{asyncRenderCallback:()=>{p.className="hover-contents code-hover-contents",o()}}));p.appendChild(_.element),c.appendChild(f)}return{hoverPart:e,hoverElement:l,dispose(){r.dispose()}}}function labelForHoverVerbosityAction(a,e){switch(e){case HoverVerbosityAction$1.Increase:{const t=a.lookupKeybinding(INCREASE_HOVER_VERBOSITY_ACTION_ID);return t?localize(1128,"Increase Hover Verbosity ({0})",t.getLabel()):localize(1129,"Increase Hover Verbosity")}case HoverVerbosityAction$1.Decrease:{const t=a.lookupKeybinding(DECREASE_HOVER_VERBOSITY_ACTION_ID);return t?localize(1130,"Decrease Hover Verbosity ({0})",t.getLabel()):localize(1131,"Decrease Hover Verbosity")}}}const colorPicker="",$$f=$$l;class SaturationBox extends Disposable{constructor(e,t,s){super(),this.model=t,this.pixelRatio=s,this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new Emitter$1,this.onColorFlushed=this._onColorFlushed.event,this._domNode=$$f(".saturation-wrap"),append$2(e,this._domNode),this._canvas=document.createElement("canvas"),this._canvas.className="saturation-box",append$2(this._domNode,this._canvas),this.selection=$$f(".saturation-selection"),append$2(this._domNode,this.selection),this.layout(),this._register(addDisposableListener(this._domNode,EventType$1.POINTER_DOWN,o=>this.onPointerDown(o))),this._register(this.model.onDidChangeColor(this.onDidChangeColor,this)),this.monitor=null}get domNode(){return this._domNode}onPointerDown(e){if(!e.target||!(e.target instanceof Element))return;this.monitor=this._register(new GlobalPointerMoveMonitor);const t=getDomNodePagePosition(this._domNode);e.target!==this.selection&&this.onDidChangePosition(e.offsetX,e.offsetY),this.monitor.startMonitoring(e.target,e.pointerId,e.buttons,o=>this.onDidChangePosition(o.pageX-t.left,o.pageY-t.top),()=>null);const s=addDisposableListener(e.target.ownerDocument,EventType$1.POINTER_UP,()=>{this._onColorFlushed.fire(),s.dispose(),this.monitor&&(this.monitor.stopMonitoring(!0),this.monitor=null)},!0)}onDidChangePosition(e,t){const s=Math.max(0,Math.min(1,e/this.width)),o=Math.max(0,Math.min(1,1-t/this.height));this.paintSelection(s,o),this._onDidChange.fire({s,v:o})}layout(){this.width=this._domNode.offsetWidth,this.height=this._domNode.offsetHeight,this._canvas.width=this.width*this.pixelRatio,this._canvas.height=this.height*this.pixelRatio,this.paint();const e=this.model.color.hsva;this.paintSelection(e.s,e.v)}paint(){const e=this.model.color.hsva,t=new Color(new HSVA(e.h,1,1,1)),s=this._canvas.getContext("2d"),o=s.createLinearGradient(0,0,this._canvas.width,0);o.addColorStop(0,"rgba(255, 255, 255, 1)"),o.addColorStop(.5,"rgba(255, 255, 255, 0.5)"),o.addColorStop(1,"rgba(255, 255, 255, 0)");const r=s.createLinearGradient(0,0,0,this._canvas.height);r.addColorStop(0,"rgba(0, 0, 0, 0)"),r.addColorStop(1,"rgba(0, 0, 0, 1)"),s.rect(0,0,this._canvas.width,this._canvas.height),s.fillStyle=Color.Format.CSS.format(t),s.fill(),s.fillStyle=o,s.fill(),s.fillStyle=r,s.fill()}paintSelection(e,t){this.selection.style.left=`${e*this.width}px`,this.selection.style.top=`${this.height-t*this.height}px`}onDidChangeColor(e){if(this.monitor&&this.monitor.isMonitoring())return;this.paint();const t=e.hsva;this.paintSelection(t.s,t.v)}}class InsertButton extends Disposable{constructor(e){super(),this._onClicked=this._register(new Emitter$1),this.onClicked=this._onClicked.event,this._button=append$2(e,document.createElement("button")),this._button.classList.add("insert-button"),this._button.textContent="Insert",this._register(addDisposableListener(this._button,EventType$1.CLICK,()=>{this._onClicked.fire()}))}get button(){return this._button}}const $$e=$$l;class Strip extends Disposable{constructor(e,t,s){super(),this.model=t,this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new Emitter$1,this.onColorFlushed=this._onColorFlushed.event,s==="standalone"?(this.domNode=append$2(e,$$e(".standalone-strip")),this.overlay=append$2(this.domNode,$$e(".standalone-overlay"))):(this.domNode=append$2(e,$$e(".strip")),this.overlay=append$2(this.domNode,$$e(".overlay"))),this.slider=append$2(this.domNode,$$e(".slider")),this.slider.style.top="0px",this._register(addDisposableListener(this.domNode,EventType$1.POINTER_DOWN,o=>this.onPointerDown(o))),this._register(t.onDidChangeColor(this.onDidChangeColor,this)),this.layout()}layout(){this.height=this.domNode.offsetHeight-this.slider.offsetHeight;const e=this.getValue(this.model.color);this.updateSliderPosition(e)}onDidChangeColor(e){const t=this.getValue(e);this.updateSliderPosition(t)}onPointerDown(e){if(!e.target||!(e.target instanceof Element))return;const t=this._register(new GlobalPointerMoveMonitor),s=getDomNodePagePosition(this.domNode);this.domNode.classList.add("grabbing"),e.target!==this.slider&&this.onDidChangeTop(e.offsetY),t.startMonitoring(e.target,e.pointerId,e.buttons,r=>this.onDidChangeTop(r.pageY-s.top),()=>null);const o=addDisposableListener(e.target.ownerDocument,EventType$1.POINTER_UP,()=>{this._onColorFlushed.fire(),o.dispose(),t.stopMonitoring(!0),this.domNode.classList.remove("grabbing")},!0)}onDidChangeTop(e){const t=Math.max(0,Math.min(1,1-e/this.height));this.updateSliderPosition(t),this._onDidChange.fire(t)}updateSliderPosition(e){this.slider.style.top=`${(1-e)*this.height}px`}}class OpacityStrip extends Strip{constructor(e,t,s){super(e,t,s),this.domNode.classList.add("opacity-strip"),this.onDidChangeColor(this.model.color)}onDidChangeColor(e){super.onDidChangeColor(e);const{r:t,g:s,b:o}=e.rgba,r=new Color(new RGBA(t,s,o,1)),l=new Color(new RGBA(t,s,o,0));this.overlay.style.background=`linear-gradient(to bottom, ${r} 0%, ${l} 100%)`}getValue(e){return e.hsva.a}}class HueStrip extends Strip{constructor(e,t,s){super(e,t,s),this.domNode.classList.add("hue-strip")}getValue(e){return 1-e.hsva.h/360}}const $$d=$$l;class ColorPickerBody extends Disposable{constructor(e,t,s,o){super(),this.model=t,this.pixelRatio=s,this._insertButton=null,this._domNode=$$d(".colorpicker-body"),append$2(e,this._domNode),this._saturationBox=new SaturationBox(this._domNode,this.model,this.pixelRatio),this._register(this._saturationBox),this._register(this._saturationBox.onDidChange(this.onDidSaturationValueChange,this)),this._register(this._saturationBox.onColorFlushed(this.flushColor,this)),this._opacityStrip=new OpacityStrip(this._domNode,this.model,o),this._register(this._opacityStrip),this._register(this._opacityStrip.onDidChange(this.onDidOpacityChange,this)),this._register(this._opacityStrip.onColorFlushed(this.flushColor,this)),this._hueStrip=new HueStrip(this._domNode,this.model,o),this._register(this._hueStrip),this._register(this._hueStrip.onDidChange(this.onDidHueChange,this)),this._register(this._hueStrip.onColorFlushed(this.flushColor,this)),o==="standalone"&&(this._insertButton=this._register(new InsertButton(this._domNode)),this._domNode.classList.add("standalone-colorpicker"))}flushColor(){this.model.flushColor()}onDidSaturationValueChange({s:e,v:t}){const s=this.model.color.hsva;this.model.color=new Color(new HSVA(s.h,e,t,s.a))}onDidOpacityChange(e){const t=this.model.color.hsva;this.model.color=new Color(new HSVA(t.h,t.s,t.v,e))}onDidHueChange(e){const t=this.model.color.hsva,s=(1-e)*360;this.model.color=new Color(new HSVA(s===360?0:s,t.s,t.v,t.a))}get domNode(){return this._domNode}get saturationBox(){return this._saturationBox}get enterButton(){return this._insertButton}layout(){this._saturationBox.layout(),this._opacityStrip.layout(),this._hueStrip.layout()}}const $$c=$$l;class CloseButton extends Disposable{constructor(e){super(),this._onClicked=this._register(new Emitter$1),this.onClicked=this._onClicked.event,this._button=document.createElement("div"),this._button.classList.add("close-button"),append$2(e,this._button);const t=document.createElement("div");t.classList.add("close-button-inner-div"),append$2(this._button,t),append$2(t,$$c(".button"+ThemeIcon.asCSSSelector(registerIcon("color-picker-close",Codicon.close,localize(881,"Icon to close the color picker"))))).classList.add("close-icon"),this._register(addDisposableListener(this._button,EventType$1.CLICK,()=>{this._onClicked.fire()}))}}const $$b=$$l;class ColorPickerHeader extends Disposable{constructor(e,t,s,o){super(),this.model=t,this.type=o,this._closeButton=null,this._domNode=$$b(".colorpicker-header"),append$2(e,this._domNode),this._pickedColorNode=append$2(this._domNode,$$b(".picked-color")),append$2(this._pickedColorNode,$$b("span.codicon.codicon-color-mode")),this._pickedColorPresentation=append$2(this._pickedColorNode,document.createElement("span")),this._pickedColorPresentation.classList.add("picked-color-presentation");const r=localize(882,"Click to toggle color options (rgb/hsl/hex)");this._pickedColorNode.setAttribute("title",r),this._originalColorNode=append$2(this._domNode,$$b(".original-color")),this._originalColorNode.style.backgroundColor=Color.Format.CSS.format(this.model.originalColor)||"",this.backgroundColor=s.getColorTheme().getColor(editorHoverBackground)||Color.white,this._register(s.onDidColorThemeChange(l=>{this.backgroundColor=l.getColor(editorHoverBackground)||Color.white})),this._register(addDisposableListener(this._pickedColorNode,EventType$1.CLICK,()=>this.model.selectNextColorPresentation())),this._register(addDisposableListener(this._originalColorNode,EventType$1.CLICK,()=>{this.model.color=this.model.originalColor,this.model.flushColor()})),this._register(t.onDidChangeColor(this.onDidChangeColor,this)),this._register(t.onDidChangePresentation(this.onDidChangePresentation,this)),this._pickedColorNode.style.backgroundColor=Color.Format.CSS.format(t.color)||"",this._pickedColorNode.classList.toggle("light",t.color.rgba.a<.5?this.backgroundColor.isLighter():t.color.isLighter()),this.onDidChangeColor(this.model.color),this.type==="standalone"&&(this._domNode.classList.add("standalone-colorpicker"),this._closeButton=this._register(new CloseButton(this._domNode)))}get closeButton(){return this._closeButton}get pickedColorNode(){return this._pickedColorNode}get originalColorNode(){return this._originalColorNode}onDidChangeColor(e){this._pickedColorNode.style.backgroundColor=Color.Format.CSS.format(e)||"",this._pickedColorNode.classList.toggle("light",e.rgba.a<.5?this.backgroundColor.isLighter():e.isLighter()),this.onDidChangePresentation()}onDidChangePresentation(){this._pickedColorPresentation.textContent=this.model.presentation?this.model.presentation.label:""}}const $$a=$$l;class ColorPickerWidget extends Widget$1{constructor(e,t,s,o,r){super(),this.model=t,this.pixelRatio=s,this._register(PixelRatio.getInstance(getWindow(e)).onDidChange(()=>this.layout())),this._domNode=$$a(".colorpicker-widget"),e.appendChild(this._domNode),this.header=this._register(new ColorPickerHeader(this._domNode,this.model,o,r)),this.body=this._register(new ColorPickerBody(this._domNode,this.model,this.pixelRatio,r))}layout(){this.body.layout()}get domNode(){return this._domNode}}class ColorPickerModel{get color(){return this._color}set color(e){this._color.equals(e)||(this._color=e,this._onDidChangeColor.fire(e))}get presentation(){return this.colorPresentations[this.presentationIndex]}get colorPresentations(){return this._colorPresentations}set colorPresentations(e){this._colorPresentations=e,this.presentationIndex>e.length-1&&(this.presentationIndex=0),this._onDidChangePresentation.fire(this.presentation)}constructor(e,t,s){this.presentationIndex=s,this._onColorFlushed=new Emitter$1,this.onColorFlushed=this._onColorFlushed.event,this._onDidChangeColor=new Emitter$1,this.onDidChangeColor=this._onDidChangeColor.event,this._onDidChangePresentation=new Emitter$1,this.onDidChangePresentation=this._onDidChangePresentation.event,this.originalColor=e,this._color=e,this._colorPresentations=t}selectNextColorPresentation(){this.presentationIndex=(this.presentationIndex+1)%this.colorPresentations.length,this.flushColor(),this._onDidChangePresentation.fire(this.presentation)}guessColorPresentation(e,t){let s=-1;for(let o=0;o<this.colorPresentations.length;o++)if(t.toLowerCase()===this.colorPresentations[o].label){s=o;break}if(s===-1){const o=t.split("(")[0].toLowerCase();for(let r=0;r<this.colorPresentations.length;r++)if(this.colorPresentations[r].label.toLowerCase().startsWith(o)){s=r;break}}s!==-1&&s!==this.presentationIndex&&(this.presentationIndex=s,this._onDidChangePresentation.fire(this.presentation))}flushColor(){this._onColorFlushed.fire(this._color)}}async function createColorHover(a,e,t){const s=a.getValueInRange(e.range),{red:o,green:r,blue:l,alpha:c}=e.color,d=new RGBA(Math.round(o*255),Math.round(r*255),Math.round(l*255),c),u=new Color(d),g=await getColorPresentations(a,e,t,CancellationToken.None),f=new ColorPickerModel(u,[],0);return f.colorPresentations=g||[],f.guessColorPresentation(u,s),{range:Range$2.lift(e.range),model:f,provider:t}}function updateEditorModel(a,e,t){const s=[],o=t.presentation.textEdit??{range:e,text:t.presentation.label,forceMoveMarkers:!1};s.push(o),t.presentation.additionalTextEdits&&s.push(...t.presentation.additionalTextEdits);const r=Range$2.lift(o.range),l=a.getModel()._setTrackedRange(null,r,3);return a.executeEdits("colorpicker",s),a.pushUndoStop(),a.getModel()._getTrackedRange(l)??r}async function updateColorPresentations(a,e,t,s,o){const r=await getColorPresentations(a,{range:s,color:{red:t.rgba.r/255,green:t.rgba.g/255,blue:t.rgba.b/255,alpha:t.rgba.a}},o.provider,CancellationToken.None);e.colorPresentations=r||[]}var __decorate$1Z=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1X=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class ColorHover{constructor(e,t,s,o){this.owner=e,this.range=t,this.model=s,this.provider=o,this.forceShowAtRange=!0}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}static fromBaseColor(e,t){return new ColorHover(e,t.range,t.model,t.provider)}}let HoverColorPickerParticipant=class{constructor(e,t){this._editor=e,this._themeService=t,this.hoverOrdinal=2}computeSync(e,t,s){return[]}computeAsync(e,t,s,o){return AsyncIterableProducer.fromPromise(this._computeAsync(e,t,s))}async _computeAsync(e,t,s){if(!this._editor.hasModel())return[];if(!this._isValidRequest(s))return[];const o=ColorDetector.get(this._editor);if(!o)return[];for(const r of t){if(!o.isColorDecoration(r))continue;const l=o.getColorData(r.range.getStartPosition());if(l)return[ColorHover.fromBaseColor(this,await createColorHover(this._editor.getModel(),l.colorInfo,l.provider))]}return[]}_isValidRequest(e){const t=this._editor.getOption(168);switch(e){case 0:return t==="hover"||t==="clickAndHover";case 1:return t==="click"||t==="clickAndHover";case 2:return!0}}renderHoverParts(e,t){const s=this._editor;if(t.length===0||!s.hasModel())return new RenderedHoverParts([]);const o=s.getOption(75)+8;e.setMinimumDimensions(new Dimension(302,o));const r=new DisposableStore,l=t[0],c=s.getModel(),d=l.model;this._colorPicker=r.add(new ColorPickerWidget(e.fragment,d,s.getOption(163),this._themeService,"hover"));let u=!1,g=new Range$2(l.range.startLineNumber,l.range.startColumn,l.range.endLineNumber,l.range.endColumn);r.add(d.onColorFlushed(async p=>{await updateColorPresentations(c,d,p,g,l),u=!0,g=updateEditorModel(s,g,d)})),r.add(d.onDidChangeColor(p=>{updateColorPresentations(c,d,p,g,l)})),r.add(s.onDidChangeModelContent(p=>{u?u=!1:(e.hide(),s.focus())}));const f={hoverPart:ColorHover.fromBaseColor(this,l),hoverElement:this._colorPicker.domNode,dispose(){r.dispose()}};return new RenderedHoverParts([f])}handleResize(){var e;(e=this._colorPicker)==null||e.layout()}handleContentsChanged(){var e;(e=this._colorPicker)==null||e.layout()}handleHide(){var e;(e=this._colorPicker)==null||e.dispose(),this._colorPicker=void 0}isColorPickerVisible(){return!!this._colorPicker}};HoverColorPickerParticipant=__decorate$1Z([__param$1X(1,IThemeService)],HoverColorPickerParticipant);class EditOperation{static insert(e,t){return{range:new Range$2(e.lineNumber,e.column,e.lineNumber,e.column),text:t,forceMoveMarkers:!0}}static delete(e){return{range:e,text:null}}static replace(e,t){return{range:e,text:t}}static replaceMove(e,t){return{range:e,text:t,forceMoveMarkers:!0}}}function hasModifier(a,e){return!!a[e]}class ClickLinkMouseEvent{constructor(e,t){this.target=e.target,this.isLeftClick=e.event.leftButton,this.isMiddleClick=e.event.middleButton,this.isRightClick=e.event.rightButton,this.mouseMiddleClickAction=t.mouseMiddleClickAction,this.hasTriggerModifier=hasModifier(e.event,t.triggerModifier),this.isMiddleClick&&t.mouseMiddleClickAction==="ctrlLeftClick"&&(this.isMiddleClick=!1,this.isLeftClick=!0,this.hasTriggerModifier=!0),this.hasSideBySideModifier=hasModifier(e.event,t.triggerSideBySideModifier),this.isNoneOrSingleMouseDown=e.event.detail<=1}}class ClickLinkKeyboardEvent{constructor(e,t){this.keyCodeIsTriggerKey=e.keyCode===t.triggerKey,this.keyCodeIsSideBySideKey=e.keyCode===t.triggerSideBySideKey,this.hasTriggerModifier=hasModifier(e,t.triggerModifier)}}class ClickLinkOptions{constructor(e,t,s,o,r){this.mouseMiddleClickAction=r,this.triggerKey=e,this.triggerModifier=t,this.triggerSideBySideKey=s,this.triggerSideBySideModifier=o}equals(e){return this.triggerKey===e.triggerKey&&this.triggerModifier===e.triggerModifier&&this.triggerSideBySideKey===e.triggerSideBySideKey&&this.triggerSideBySideModifier===e.triggerSideBySideModifier&&this.mouseMiddleClickAction===e.mouseMiddleClickAction}}function createOptions(a,e){return a==="altKey"?isMacintosh?new ClickLinkOptions(57,"metaKey",6,"altKey",e):new ClickLinkOptions(5,"ctrlKey",6,"altKey",e):isMacintosh?new ClickLinkOptions(6,"altKey",57,"metaKey",e):new ClickLinkOptions(6,"altKey",5,"ctrlKey",e)}class ClickLinkGesture extends Disposable{constructor(e,t){super(),this._onMouseMoveOrRelevantKeyDown=this._register(new Emitter$1),this.onMouseMoveOrRelevantKeyDown=this._onMouseMoveOrRelevantKeyDown.event,this._onExecute=this._register(new Emitter$1),this.onExecute=this._onExecute.event,this._onCancel=this._register(new Emitter$1),this.onCancel=this._onCancel.event,this._editor=e,this._extractLineNumberFromMouseEvent=(t==null?void 0:t.extractLineNumberFromMouseEvent)??(s=>s.target.position?s.target.position.lineNumber:0),this._opts=createOptions(this._editor.getOption(86),this._editor.getOption(87)),this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._register(this._editor.onDidChangeConfiguration(s=>{if(s.hasChanged(86)||s.hasChanged(87)){const o=createOptions(this._editor.getOption(86),this._editor.getOption(87));if(this._opts.equals(o))return;this._opts=o,this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._onCancel.fire()}})),this._register(this._editor.onMouseMove(s=>this._onEditorMouseMove(new ClickLinkMouseEvent(s,this._opts)))),this._register(this._editor.onMouseDown(s=>this._onEditorMouseDown(new ClickLinkMouseEvent(s,this._opts)))),this._register(this._editor.onMouseUp(s=>this._onEditorMouseUp(new ClickLinkMouseEvent(s,this._opts)))),this._register(this._editor.onKeyDown(s=>this._onEditorKeyDown(new ClickLinkKeyboardEvent(s,this._opts)))),this._register(this._editor.onKeyUp(s=>this._onEditorKeyUp(new ClickLinkKeyboardEvent(s,this._opts)))),this._register(this._editor.onMouseDrag(()=>this._resetHandler())),this._register(this._editor.onDidChangeCursorSelection(s=>this._onDidChangeCursorSelection(s))),this._register(this._editor.onDidChangeModel(s=>this._resetHandler())),this._register(this._editor.onDidChangeModelContent(()=>this._resetHandler())),this._register(this._editor.onDidScrollChange(s=>{(s.scrollTopChanged||s.scrollLeftChanged)&&this._resetHandler()}))}_onDidChangeCursorSelection(e){e.selection&&e.selection.startColumn!==e.selection.endColumn&&this._resetHandler()}_onEditorMouseMove(e){this._lastMouseMoveEvent=e,this._onMouseMoveOrRelevantKeyDown.fire([e,null])}_onEditorMouseDown(e){this._hasTriggerKeyOnMouseDown=e.hasTriggerModifier,this._lineNumberOnMouseDown=this._extractLineNumberFromMouseEvent(e)}_onEditorMouseUp(e){const t=this._extractLineNumberFromMouseEvent(e);!!this._lineNumberOnMouseDown&&this._lineNumberOnMouseDown===t&&(this._hasTriggerKeyOnMouseDown||e.isMiddleClick&&e.mouseMiddleClickAction==="openLink")&&this._onExecute.fire(e)}_onEditorKeyDown(e){this._lastMouseMoveEvent&&(e.keyCodeIsTriggerKey||e.keyCodeIsSideBySideKey&&e.hasTriggerModifier)?this._onMouseMoveOrRelevantKeyDown.fire([this._lastMouseMoveEvent,e]):e.hasTriggerModifier&&this._onCancel.fire()}_onEditorKeyUp(e){e.keyCodeIsTriggerKey&&this._onCancel.fire()}_resetHandler(){this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._onCancel.fire()}}class InlayHintAnchor{constructor(e,t){this.range=e,this.direction=t}}class InlayHintItem{constructor(e,t,s){this.hint=e,this.anchor=t,this.provider=s,this._isResolved=!1}with(e){const t=new InlayHintItem(this.hint,e.anchor,this.provider);return t._isResolved=this._isResolved,t._currentResolve=this._currentResolve,t}async resolve(e){if(typeof this.provider.resolveInlayHint=="function"){if(this._currentResolve)return await this._currentResolve,e.isCancellationRequested?void 0:this.resolve(e);this._isResolved||(this._currentResolve=this._doResolve(e).finally(()=>this._currentResolve=void 0)),await this._currentResolve}}async _doResolve(e){try{const t=await Promise.resolve(this.provider.resolveInlayHint(this.hint,e));this.hint.tooltip=(t==null?void 0:t.tooltip)??this.hint.tooltip,this.hint.label=(t==null?void 0:t.label)??this.hint.label,this.hint.textEdits=(t==null?void 0:t.textEdits)??this.hint.textEdits,this._isResolved=!0}catch(t){onUnexpectedExternalError(t),this._isResolved=!1}}}const ri=class ri{static async create(e,t,s,o){const r=[],l=e.ordered(t).reverse().map(c=>s.map(async d=>{try{const u=await c.provideInlayHints(t,d,o);(u!=null&&u.hints.length||c.onDidChangeInlayHints)&&r.push([u??ri._emptyInlayHintList,c])}catch(u){onUnexpectedExternalError(u)}}));if(await Promise.all(l.flat()),o.isCancellationRequested||t.isDisposed())throw new CancellationError;return new ri(s,r,t)}constructor(e,t,s){this._disposables=new DisposableStore,this.ranges=e,this.provider=new Set;const o=[];for(const[r,l]of t){this._disposables.add(r),this.provider.add(l);for(const c of r.hints){const d=s.validatePosition(c.position);let u="before";const g=ri._getRangeAtPosition(s,d);let f;g.getStartPosition().isBefore(d)?(f=Range$2.fromPositions(g.getStartPosition(),d),u="after"):(f=Range$2.fromPositions(d,g.getEndPosition()),u="before"),o.push(new InlayHintItem(c,new InlayHintAnchor(f,u),l))}}this.items=o.sort((r,l)=>Position$1.compare(r.hint.position,l.hint.position))}dispose(){this._disposables.dispose()}static _getRangeAtPosition(e,t){const s=t.lineNumber,o=e.getWordAtPosition(t);if(o)return new Range$2(s,o.startColumn,s,o.endColumn);e.tokenization.tokenizeIfCheap(s);const r=e.tokenization.getLineTokens(s),l=t.column-1,c=r.findTokenIndexAtOffset(l);let d=r.getStartOffset(c),u=r.getEndOffset(c);return u-d===1&&(d===l&&c>1?(d=r.getStartOffset(c-1),u=r.getEndOffset(c-1)):u===l&&c<r.getCount()-1&&(d=r.getStartOffset(c+1),u=r.getEndOffset(c+1))),new Range$2(s,d+1,s,u+1)}};ri._emptyInlayHintList=Object.freeze({dispose(){},hints:[]});let InlayHintsFragments=ri;function asCommandLink(a){return createCommandUri(a.id,...a.arguments??[]).toString()}function isCodeEditor(a){return a&&typeof a.getEditorType=="function"?a.getEditorType()===EditorType.ICodeEditor:!1}function isDiffEditor(a){return a&&typeof a.getEditorType=="function"?a.getEditorType()===EditorType.IDiffEditor:!1}var __decorate$1Y=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1W=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let EmbeddedCodeEditorWidget=class extends CodeEditorWidget{constructor(e,t,s,o,r,l,c,d,u,g,f,p,m){super(e,{...o.getRawOptions(),overflowWidgetsDomNode:o.getOverflowWidgetsDomNode()},s,r,l,c,d,u,g,f,p,m),this._parentEditor=o,this._overwriteOptions=t,super.updateOptions(this._overwriteOptions),this._register(o.onDidChangeConfiguration(_=>this._onParentConfigurationChanged(_)))}getParentEditor(){return this._parentEditor}_onParentConfigurationChanged(e){super.updateOptions(this._parentEditor.getRawOptions()),super.updateOptions(this._overwriteOptions)}updateOptions(e){mixin(this._overwriteOptions,e,!0),super.updateOptions(this._overwriteOptions)}};EmbeddedCodeEditorWidget=__decorate$1Y([__param$1W(4,IInstantiationService),__param$1W(5,ICodeEditorService),__param$1W(6,ICommandService),__param$1W(7,IContextKeyService),__param$1W(8,IThemeService),__param$1W(9,INotificationService),__param$1W(10,IAccessibilityService),__param$1W(11,ILanguageConfigurationService),__param$1W(12,ILanguageFeaturesService)],EmbeddedCodeEditorWidget);function getOuterEditor(a){const e=a.get(ICodeEditorService).getFocusedCodeEditor();return e instanceof EmbeddedCodeEditorWidget?e.getParentEditor():e}const peekViewWidget="",zoneWidget="",defaultColor=new Color(new RGBA(0,122,204)),defaultOptions$1={showArrow:!0,showFrame:!0,className:"",frameColor:defaultColor,arrowColor:defaultColor,keepEditorSelection:!1},WIDGET_ID="vs.editor.contrib.zoneWidget";class ViewZoneDelegate{constructor(e,t,s,o,r,l,c,d){this.id="",this.domNode=e,this.afterLineNumber=t,this.afterColumn=s,this.heightInLines=o,this.showInHiddenAreas=c,this.ordinal=d,this._onDomNodeTop=r,this._onComputedHeight=l}onDomNodeTop(e){this._onDomNodeTop(e)}onComputedHeight(e){this._onComputedHeight(e)}}class OverlayWidgetDelegate{constructor(e,t){this._id=e,this._domNode=t}getId(){return this._id}getDomNode(){return this._domNode}getPosition(){return null}}const Ns=class Ns{constructor(e){this._editor=e,this._ruleName=Ns._IdGenerator.nextId(),this._color=null,this._height=-1,this._decorations=this._editor.createDecorationsCollection()}dispose(){this.hide(),removeCSSRulesContainingSelector(this._ruleName)}set color(e){this._color!==e&&(this._color=e,this._updateStyle())}set height(e){this._height!==e&&(this._height=e,this._updateStyle())}_updateStyle(){removeCSSRulesContainingSelector(this._ruleName),createCSSRule(`.monaco-editor ${this._ruleName}`,`border-style: solid; border-color: transparent; border-bottom-color: ${this._color}; border-width: ${this._height}px; bottom: -${this._height}px !important; margin-left: -${this._height}px; `)}show(e){e.column===1&&(e={lineNumber:e.lineNumber,column:2}),this._decorations.set([{range:Range$2.fromPositions(e),options:{description:"zone-widget-arrow",className:this._ruleName,stickiness:1}}])}hide(){this._decorations.clear()}};Ns._IdGenerator=new IdGenerator(".arrow-decoration-");let Arrow=Ns;class ZoneWidget{constructor(e,t={}){this._arrow=null,this._overlayWidget=null,this._resizeSash=null,this._isSashResizeHeight=!1,this._viewZone=null,this._disposables=new DisposableStore,this.container=null,this._isShowing=!1,this.editor=e,this._positionMarkerId=this.editor.createDecorationsCollection(),this.options=deepClone(t),mixin(this.options,defaultOptions$1,!1),this.domNode=document.createElement("div"),this.options.isAccessible||(this.domNode.setAttribute("aria-hidden","true"),this.domNode.setAttribute("role","presentation")),this._disposables.add(this.editor.onDidLayoutChange(s=>{const o=this._getWidth(s);this.domNode.style.width=o+"px",this.domNode.style.left=this._getLeft(s)+"px",this._onWidth(o)}))}dispose(){this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),this._viewZone&&this.editor.changeViewZones(e=>{this._viewZone&&e.removeZone(this._viewZone.id),this._viewZone=null}),this._positionMarkerId.clear(),this._disposables.dispose()}create(){this.domNode.classList.add("zone-widget"),this.options.className&&this.domNode.classList.add(this.options.className),this.container=document.createElement("div"),this.container.classList.add("zone-widget-container"),this.domNode.appendChild(this.container),this.options.showArrow&&(this._arrow=new Arrow(this.editor),this._disposables.add(this._arrow)),this._fillContainer(this.container),this._initSash(),this._applyStyles()}style(e){e.frameColor&&(this.options.frameColor=e.frameColor),e.arrowColor&&(this.options.arrowColor=e.arrowColor),this._applyStyles()}_applyStyles(){if(this.container&&this.options.frameColor){const e=this.options.frameColor.toString();this.container.style.borderTopColor=e,this.container.style.borderBottomColor=e}if(this._arrow&&this.options.arrowColor){const e=this.options.arrowColor.toString();this._arrow.color=e}}_getWidth(e){return e.width-e.minimap.minimapWidth-e.verticalScrollbarWidth}_getLeft(e){return e.minimap.minimapWidth>0&&e.minimap.minimapLeft===0?e.minimap.minimapWidth:0}_onViewZoneTop(e){this.domNode.style.top=e+"px"}_onViewZoneHeight(e){var t;if(this.domNode.style.height=`${e}px`,this.container){const s=e-this._decoratingElementsHeight();this.container.style.height=`${s}px`;const o=this.editor.getLayoutInfo();this._doLayout(s,this._getWidth(o))}(t=this._resizeSash)==null||t.layout()}get position(){const e=this._positionMarkerId.getRange(0);if(e)return e.getStartPosition()}show(e,t){const s=Range$2.isIRange(e)?Range$2.lift(e):Range$2.fromPositions(e);this._isShowing=!0,this._showImpl(s,t),this._isShowing=!1,this._positionMarkerId.set([{range:s,options:ModelDecorationOptions.EMPTY}])}hide(){var e;this._viewZone&&(this.editor.changeViewZones(t=>{this._viewZone&&t.removeZone(this._viewZone.id)}),this._viewZone=null),this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),(e=this._arrow)==null||e.hide(),this._positionMarkerId.clear(),this._isSashResizeHeight=!1}_decoratingElementsHeight(){const e=this.editor.getOption(75);let t=0;if(this.options.showArrow){const s=Math.round(e/3);t+=2*s}if(this.options.showFrame){const s=this.options.frameWidth??Math.round(e/9);t+=2*s}return t}_getMaximumHeightInLines(){return Math.max(12,this.editor.getLayoutInfo().height/this.editor.getOption(75)*.8)}_showImpl(e,t){const s=e.getStartPosition(),o=this.editor.getLayoutInfo(),r=this._getWidth(o);this.domNode.style.width=`${r}px`,this.domNode.style.left=this._getLeft(o)+"px";const l=document.createElement("div");l.style.overflow="hidden";const c=this.editor.getOption(75),d=this._getMaximumHeightInLines();d!==void 0&&(t=Math.min(t,d));let u=0,g=0;if(this._arrow&&this.options.showArrow&&(u=Math.round(c/3),this._arrow.height=u,this._arrow.show(s)),this.options.showFrame&&(g=Math.round(c/9)),this.editor.changeViewZones(m=>{this._viewZone&&m.removeZone(this._viewZone.id),this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),this.domNode.style.top="-1000px",this._viewZone=new ViewZoneDelegate(l,s.lineNumber,s.column,t,_=>this._onViewZoneTop(_),_=>this._onViewZoneHeight(_),this.options.showInHiddenAreas,this.options.ordinal),this._viewZone.id=m.addZone(this._viewZone),this._overlayWidget=new OverlayWidgetDelegate(WIDGET_ID+this._viewZone.id,this.domNode),this.editor.addOverlayWidget(this._overlayWidget)}),this._updateSashEnablement(),this.container&&this.options.showFrame){const m=this.options.frameWidth?this.options.frameWidth:g;this.container.style.borderTopWidth=m+"px",this.container.style.borderBottomWidth=m+"px"}const f=t*c-this._decoratingElementsHeight();this.container&&(this.container.style.top=u+"px",this.container.style.height=f+"px",this.container.style.overflow="hidden"),this._doLayout(f,r),this.options.keepEditorSelection||this.editor.setSelection(e);const p=this.editor.getModel();if(p){const m=p.validateRange(new Range$2(e.startLineNumber,1,e.endLineNumber+1,1));this.revealRange(m,m.startLineNumber===p.getLineCount())}}revealRange(e,t){t?this.editor.revealLineNearTop(e.endLineNumber,0):this.editor.revealRange(e,0)}setCssClass(e,t){this.container&&(t&&this.container.classList.remove(t),this.container.classList.add(e))}_onWidth(e){}_doLayout(e,t){}_relayout(e,t){const s=this._getMaximumHeightInLines(),o=t&&s!==void 0?Math.min(s,e):e;this._viewZone&&this._viewZone.heightInLines!==o&&(this.editor.changeViewZones(r=>{this._viewZone&&(this._viewZone.heightInLines=o,r.layoutZone(this._viewZone.id))}),this._updateSashEnablement())}_initSash(){if(this._resizeSash)return;this._resizeSash=this._disposables.add(new Sash(this.domNode,this,{orientation:1})),this.options.isResizeable||(this._resizeSash.state=0);let e;this._disposables.add(this._resizeSash.onDidStart(t=>{this._viewZone&&(e={startY:t.startY,heightInLines:this._viewZone.heightInLines,...this._getResizeBounds()})})),this._disposables.add(this._resizeSash.onDidEnd(()=>{e=void 0})),this._disposables.add(this._resizeSash.onDidChange(t=>{if(e){const s=(t.currentY-e.startY)/this.editor.getOption(75),o=s<0?Math.ceil(s):Math.floor(s),r=e.heightInLines+o;r>e.minLines&&r<e.maxLines&&(this._isSashResizeHeight=!0,this._relayout(r))}}))}_updateSashEnablement(){if(this._resizeSash){const{minLines:e,maxLines:t}=this._getResizeBounds();this._resizeSash.state=e===t?0:3}}_getResizeBounds(){return{minLines:5,maxLines:35}}getHorizontalSashLeft(){return 0}getHorizontalSashTop(){return(this.domNode.style.height===null?0:parseInt(this.domNode.style.height))-this._decoratingElementsHeight()/2}getHorizontalSashWidth(){const e=this.editor.getLayoutInfo();return e.width-e.minimap.minimapWidth}}var __decorate$1X=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1V=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const IPeekViewService=createDecorator("IPeekViewService");registerSingleton(IPeekViewService,class{constructor(){this._widgets=new Map}addExclusiveWidget(a,e){const t=this._widgets.get(a);t&&(t.listener.dispose(),t.widget.dispose());const s=()=>{const o=this._widgets.get(a);o&&o.widget===e&&(o.listener.dispose(),this._widgets.delete(a))};this._widgets.set(a,{widget:e,listener:e.onDidClose(s)})}},1);var PeekContext;(function(a){a.inPeekEditor=new RawContextKey("inReferenceSearchEditor",!0,localize(1306,"Whether the current code editor is embedded inside peek")),a.notInPeekEditor=a.inPeekEditor.toNegated()})(PeekContext||(PeekContext={}));var Nn;let PeekContextController=(Nn=class{constructor(e,t){e instanceof EmbeddedCodeEditorWidget&&PeekContext.inPeekEditor.bindTo(t)}dispose(){}},Nn.ID="editor.contrib.referenceController",Nn);PeekContextController=__decorate$1X([__param$1V(1,IContextKeyService)],PeekContextController);registerEditorContribution(PeekContextController.ID,PeekContextController,0);const defaultOptions={headerBackgroundColor:Color.white,primaryHeadingColor:Color.fromHex("#333333"),secondaryHeadingColor:Color.fromHex("#6c6c6cb3")};let PeekViewWidget=class extends ZoneWidget{constructor(e,t,s){super(e,t),this.instantiationService=s,this._onDidClose=new Emitter$1,this.onDidClose=this._onDidClose.event,mixin(this.options,defaultOptions,!1);const o=observableCodeEditor(this.editor);o.openedPeekWidgets.set(o.openedPeekWidgets.get()+1,void 0)}dispose(){if(!this.disposed){this.disposed=!0,super.dispose(),this._onDidClose.fire(this);const e=observableCodeEditor(this.editor);e.openedPeekWidgets.set(e.openedPeekWidgets.get()-1,void 0)}}style(e){const t=this.options;e.headerBackgroundColor&&(t.headerBackgroundColor=e.headerBackgroundColor),e.primaryHeadingColor&&(t.primaryHeadingColor=e.primaryHeadingColor),e.secondaryHeadingColor&&(t.secondaryHeadingColor=e.secondaryHeadingColor),super.style(e)}_applyStyles(){super._applyStyles();const e=this.options;this._headElement&&e.headerBackgroundColor&&(this._headElement.style.backgroundColor=e.headerBackgroundColor.toString()),this._primaryHeading&&e.primaryHeadingColor&&(this._primaryHeading.style.color=e.primaryHeadingColor.toString()),this._secondaryHeading&&e.secondaryHeadingColor&&(this._secondaryHeading.style.color=e.secondaryHeadingColor.toString()),this._bodyElement&&e.frameColor&&(this._bodyElement.style.borderColor=e.frameColor.toString())}_fillContainer(e){this.setCssClass("peekview-widget"),this._headElement=$$l(".head"),this._bodyElement=$$l(".body"),this._fillHead(this._headElement),this._fillBody(this._bodyElement),e.appendChild(this._headElement),e.appendChild(this._bodyElement)}_fillHead(e,t){this._titleElement=$$l(".peekview-title"),this.options.supportOnTitleClick&&(this._titleElement.classList.add("clickable"),addStandardDisposableListener(this._titleElement,"click",r=>this._onTitleClick(r))),append$2(this._headElement,this._titleElement),this._fillTitleIcon(this._titleElement),this._primaryHeading=$$l("span.filename"),this._secondaryHeading=$$l("span.dirname"),this._metaHeading=$$l("span.meta"),append$2(this._titleElement,this._primaryHeading,this._secondaryHeading,this._metaHeading);const s=$$l(".peekview-actions");append$2(this._headElement,s);const o=this._getActionBarOptions();this._actionbarWidget=new ActionBar(s,o),this._disposables.add(this._actionbarWidget),t||this._actionbarWidget.push(this._disposables.add(new Action("peekview.close",localize(1307,"Close"),ThemeIcon.asClassName(Codicon.close),!0,()=>(this.dispose(),Promise.resolve()))),{label:!1,icon:!0})}_fillTitleIcon(e){}_getActionBarOptions(){return{actionViewItemProvider:createActionViewItem.bind(void 0,this.instantiationService),orientation:0}}_onTitleClick(e){}setTitle(e,t){this._primaryHeading&&this._secondaryHeading&&(this._primaryHeading.innerText=e,this._primaryHeading.setAttribute("title",e),t?this._secondaryHeading.innerText=t:clearNode(this._secondaryHeading))}setMetaTitle(e){this._metaHeading&&(e?(this._metaHeading.innerText=e,show(this._metaHeading)):hide(this._metaHeading))}_doLayout(e,t){if(!this._isShowing&&e<0){this.dispose();return}const s=Math.ceil(this.editor.getOption(75)*1.2),o=Math.round(e-(s+1));this._doLayoutHead(s,t),this._doLayoutBody(o,t)}_doLayoutHead(e,t){this._headElement&&(this._headElement.style.height=`${e}px`,this._headElement.style.lineHeight=this._headElement.style.height)}_doLayoutBody(e,t){this._bodyElement&&(this._bodyElement.style.height=`${e}px`)}};PeekViewWidget=__decorate$1X([__param$1V(2,IInstantiationService)],PeekViewWidget);const peekViewTitleBackground=registerColor("peekViewTitle.background",{dark:"#252526",light:"#F3F3F3",hcDark:Color.black,hcLight:Color.white},localize(1308,"Background color of the peek view title area.")),peekViewTitleForeground=registerColor("peekViewTitleLabel.foreground",{dark:Color.white,light:Color.black,hcDark:Color.white,hcLight:editorForeground},localize(1309,"Color of the peek view title.")),peekViewTitleInfoForeground=registerColor("peekViewTitleDescription.foreground",{dark:"#ccccccb3",light:"#616161",hcDark:"#FFFFFF99",hcLight:"#292929"},localize(1310,"Color of the peek view title info.")),peekViewBorder=registerColor("peekView.border",{dark:editorInfoForeground,light:editorInfoForeground,hcDark:contrastBorder,hcLight:contrastBorder},localize(1311,"Color of the peek view borders and arrow.")),peekViewResultsBackground=registerColor("peekViewResult.background",{dark:"#252526",light:"#F3F3F3",hcDark:Color.black,hcLight:Color.white},localize(1312,"Background color of the peek view result list."));registerColor("peekViewResult.lineForeground",{dark:"#bbbbbb",light:"#646465",hcDark:Color.white,hcLight:editorForeground},localize(1313,"Foreground color for line nodes in the peek view result list."));registerColor("peekViewResult.fileForeground",{dark:Color.white,light:"#1E1E1E",hcDark:Color.white,hcLight:editorForeground},localize(1314,"Foreground color for file nodes in the peek view result list."));registerColor("peekViewResult.selectionBackground",{dark:"#3399ff33",light:"#3399ff33",hcDark:null,hcLight:null},localize(1315,"Background color of the selected entry in the peek view result list."));registerColor("peekViewResult.selectionForeground",{dark:Color.white,light:"#6C6C6C",hcDark:Color.white,hcLight:editorForeground},localize(1316,"Foreground color of the selected entry in the peek view result list."));const peekViewEditorBackground=registerColor("peekViewEditor.background",{dark:"#001F33",light:"#F2F8FC",hcDark:Color.black,hcLight:Color.white},localize(1317,"Background color of the peek view editor."));registerColor("peekViewEditorGutter.background",peekViewEditorBackground,localize(1318,"Background color of the gutter in the peek view editor."));registerColor("peekViewEditorStickyScroll.background",peekViewEditorBackground,localize(1319,"Background color of sticky scroll in the peek view editor."));registerColor("peekViewEditorStickyScrollGutter.background",peekViewEditorBackground,localize(1320,"Background color of the gutter part of sticky scroll in the peek view editor."));registerColor("peekViewResult.matchHighlightBackground",{dark:"#ea5c004d",light:"#ea5c004d",hcDark:null,hcLight:null},localize(1321,"Match highlight color in the peek view result list."));registerColor("peekViewEditor.matchHighlightBackground",{dark:"#ff8f0099",light:"#f5d802de",hcDark:null,hcLight:null},localize(1322,"Match highlight color in the peek view editor."));registerColor("peekViewEditor.matchHighlightBorder",{dark:null,light:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize(1323,"Match highlight border in the peek view editor."));class PagedRenderer{get templateId(){return this.renderer.templateId}constructor(e,t){this.renderer=e,this.modelProvider=t}renderTemplate(e){return{data:this.renderer.renderTemplate(e),disposable:Disposable.None}}renderElement(e,t,s,o){var d;if((d=s.disposable)==null||d.dispose(),!s.data)return;const r=this.modelProvider();if(r.isResolved(e))return this.renderer.renderElement(r.get(e),e,s.data,o);const l=new CancellationTokenSource$1,c=r.resolve(e,l.token);s.disposable={dispose:()=>l.cancel()},this.renderer.renderPlaceholder(e,s.data),c.then(u=>this.renderer.renderElement(u,e,s.data,o))}disposeTemplate(e){e.disposable&&(e.disposable.dispose(),e.disposable=void 0),e.data&&(this.renderer.disposeTemplate(e.data),e.data=void 0)}}class PagedAccessibilityProvider{constructor(e,t){this.modelProvider=e,this.accessibilityProvider=t}getWidgetAriaLabel(){return this.accessibilityProvider.getWidgetAriaLabel()}getAriaLabel(e){const t=this.modelProvider();return t.isResolved(e)?this.accessibilityProvider.getAriaLabel(t.get(e)):null}}function fromPagedListOptions(a,e){return{...e,accessibilityProvider:e.accessibilityProvider&&new PagedAccessibilityProvider(a,e.accessibilityProvider)}}class PagedList{constructor(e,t,s,o,r={}){const l=()=>this.model,c=o.map(d=>new PagedRenderer(d,l));this.list=new List(e,t,s,c,fromPagedListOptions(l,r))}updateOptions(e){this.list.updateOptions(e)}getHTMLElement(){return this.list.getHTMLElement()}get onDidFocus(){return this.list.onDidFocus}get widget(){return this.list}get onDidDispose(){return this.list.onDidDispose}get onMouseDblClick(){return Event$1.map(this.list.onMouseDblClick,({element:e,index:t,browserEvent:s})=>({element:e===void 0?void 0:this._model.get(e),index:t,browserEvent:s}))}get onPointer(){return Event$1.map(this.list.onPointer,({element:e,index:t,browserEvent:s})=>({element:e===void 0?void 0:this._model.get(e),index:t,browserEvent:s}))}get onDidChangeSelection(){return Event$1.map(this.list.onDidChangeSelection,({elements:e,indexes:t,browserEvent:s})=>({elements:e.map(o=>this._model.get(o)),indexes:t,browserEvent:s}))}get model(){return this._model}set model(e){this._model=e,this.list.splice(0,this.list.length,range(e.length))}getFocus(){return this.list.getFocus()}getSelection(){return this.list.getSelection()}getSelectedElements(){return this.getSelection().map(e=>this.model.get(e))}style(e){this.list.style(e)}dispose(){this.list.dispose()}}const splitview="",defaultStyles={separatorBorder:Color.transparent};class ViewItem{set size(e){this._size=e}get size(){return this._size}get visible(){return typeof this._cachedVisibleSize>"u"}setVisible(e,t){var s,o;if(e!==this.visible){e?(this.size=clamp(this._cachedVisibleSize,this.viewMinimumSize,this.viewMaximumSize),this._cachedVisibleSize=void 0):(this._cachedVisibleSize=typeof t=="number"?t:this.size,this.size=0),this.container.classList.toggle("visible",e);try{(o=(s=this.view).setVisible)==null||o.call(s,e)}catch(r){console.error("Splitview: Failed to set visible view"),console.error(r)}}}get minimumSize(){return this.visible?this.view.minimumSize:0}get viewMinimumSize(){return this.view.minimumSize}get maximumSize(){return this.visible?this.view.maximumSize:0}get viewMaximumSize(){return this.view.maximumSize}get priority(){return this.view.priority}get proportionalLayout(){return this.view.proportionalLayout??!0}get snap(){return!!this.view.snap}set enabled(e){this.container.style.pointerEvents=e?"":"none"}constructor(e,t,s,o){this.container=e,this.view=t,this.disposable=o,this._cachedVisibleSize=void 0,typeof s=="number"?(this._size=s,this._cachedVisibleSize=void 0,e.classList.add("visible")):(this._size=0,this._cachedVisibleSize=s.cachedVisibleSize)}layout(e,t){this.layoutContainer(e);try{this.view.layout(this.size,e,t)}catch(s){console.error("Splitview: Failed to layout view"),console.error(s)}}dispose(){this.disposable.dispose()}}class VerticalViewItem extends ViewItem{layoutContainer(e){this.container.style.top=`${e}px`,this.container.style.height=`${this.size}px`}}class HorizontalViewItem extends ViewItem{layoutContainer(e){this.container.style.left=`${e}px`,this.container.style.width=`${this.size}px`}}var State;(function(a){a[a.Idle=0]="Idle",a[a.Busy=1]="Busy"})(State||(State={}));var Sizing;(function(a){a.Distribute={type:"distribute"};function e(o){return{type:"split",index:o}}a.Split=e;function t(o){return{type:"auto",index:o}}a.Auto=t;function s(o){return{type:"invisible",cachedVisibleSize:o}}a.Invisible=s})(Sizing||(Sizing={}));class SplitView extends Disposable{get orthogonalStartSash(){return this._orthogonalStartSash}get orthogonalEndSash(){return this._orthogonalEndSash}get startSnappingEnabled(){return this._startSnappingEnabled}get endSnappingEnabled(){return this._endSnappingEnabled}set orthogonalStartSash(e){for(const t of this.sashItems)t.sash.orthogonalStartSash=e;this._orthogonalStartSash=e}set orthogonalEndSash(e){for(const t of this.sashItems)t.sash.orthogonalEndSash=e;this._orthogonalEndSash=e}set startSnappingEnabled(e){this._startSnappingEnabled!==e&&(this._startSnappingEnabled=e,this.updateSashEnablement())}set endSnappingEnabled(e){this._endSnappingEnabled!==e&&(this._endSnappingEnabled=e,this.updateSashEnablement())}constructor(e,t={}){super(),this.size=0,this._contentSize=0,this.proportions=void 0,this.viewItems=[],this.sashItems=[],this.state=State.Idle,this._onDidSashChange=this._register(new Emitter$1),this._onDidSashReset=this._register(new Emitter$1),this._startSnappingEnabled=!0,this._endSnappingEnabled=!0,this.onDidSashChange=this._onDidSashChange.event,this.onDidSashReset=this._onDidSashReset.event,this.orientation=t.orientation??0,this.inverseAltBehavior=t.inverseAltBehavior??!1,this.proportionalLayout=t.proportionalLayout??!0,this.getSashOrthogonalSize=t.getSashOrthogonalSize,this.el=document.createElement("div"),this.el.classList.add("monaco-split-view2"),this.el.classList.add(this.orientation===0?"vertical":"horizontal"),e.appendChild(this.el),this.sashContainer=append$2(this.el,$$l(".sash-container")),this.viewContainer=$$l(".split-view-container"),this.scrollable=this._register(new Scrollable({forceIntegerValues:!0,smoothScrollDuration:125,scheduleAtNextAnimationFrame:o=>scheduleAtNextAnimationFrame(getWindow(this.el),o)})),this.scrollableElement=this._register(new SmoothScrollableElement(this.viewContainer,{vertical:this.orientation===0?t.scrollbarVisibility??1:2,horizontal:this.orientation===1?t.scrollbarVisibility??1:2},this.scrollable));const s=this._register(new DomEmitter(this.viewContainer,"scroll")).event;this._register(s(o=>{const r=this.scrollableElement.getScrollPosition(),l=Math.abs(this.viewContainer.scrollLeft-r.scrollLeft)<=1?void 0:this.viewContainer.scrollLeft,c=Math.abs(this.viewContainer.scrollTop-r.scrollTop)<=1?void 0:this.viewContainer.scrollTop;(l!==void 0||c!==void 0)&&this.scrollableElement.setScrollPosition({scrollLeft:l,scrollTop:c})})),this.onDidScroll=this.scrollableElement.onScroll,this._register(this.onDidScroll(o=>{o.scrollTopChanged&&(this.viewContainer.scrollTop=o.scrollTop),o.scrollLeftChanged&&(this.viewContainer.scrollLeft=o.scrollLeft)})),append$2(this.el,this.scrollableElement.getDomNode()),this.style(t.styles||defaultStyles),t.descriptor&&(this.size=t.descriptor.size,t.descriptor.views.forEach((o,r)=>{const l=isUndefined(o.visible)||o.visible?o.size:{type:"invisible",cachedVisibleSize:o.size},c=o.view;this.doAddView(c,l,r,!0)}),this._contentSize=this.viewItems.reduce((o,r)=>o+r.size,0),this.saveProportions())}style(e){e.separatorBorder.isTransparent()?(this.el.classList.remove("separator-border"),this.el.style.removeProperty("--separator-border")):(this.el.classList.add("separator-border"),this.el.style.setProperty("--separator-border",e.separatorBorder.toString()))}addView(e,t,s=this.viewItems.length,o){this.doAddView(e,t,s,o)}layout(e,t){const s=Math.max(this.size,this._contentSize);if(this.size=e,this.layoutContext=t,this.proportions){let o=0;for(let r=0;r<this.viewItems.length;r++){const l=this.viewItems[r],c=this.proportions[r];typeof c=="number"?o+=c:e-=l.size}for(let r=0;r<this.viewItems.length;r++){const l=this.viewItems[r],c=this.proportions[r];typeof c=="number"&&o>0&&(l.size=clamp(Math.round(c*e/o),l.minimumSize,l.maximumSize))}}else{const o=range(this.viewItems.length),r=o.filter(c=>this.viewItems[c].priority===1),l=o.filter(c=>this.viewItems[c].priority===2);this.resize(this.viewItems.length-1,e-s,void 0,r,l)}this.distributeEmptySpace(),this.layoutViews()}saveProportions(){this.proportionalLayout&&this._contentSize>0&&(this.proportions=this.viewItems.map(e=>e.proportionalLayout&&e.visible?e.size/this._contentSize:void 0))}onSashStart({sash:e,start:t,alt:s}){for(const c of this.viewItems)c.enabled=!1;const o=this.sashItems.findIndex(c=>c.sash===e),r=combinedDisposable(addDisposableListener(this.el.ownerDocument.body,"keydown",c=>l(this.sashDragState.current,c.altKey)),addDisposableListener(this.el.ownerDocument.body,"keyup",()=>l(this.sashDragState.current,!1))),l=(c,d)=>{const u=this.viewItems.map(_=>_.size);let g=Number.NEGATIVE_INFINITY,f=Number.POSITIVE_INFINITY;if(this.inverseAltBehavior&&(d=!d),d)if(o===this.sashItems.length-1){const C=this.viewItems[o];g=(C.minimumSize-C.size)/2,f=(C.maximumSize-C.size)/2}else{const C=this.viewItems[o+1];g=(C.size-C.maximumSize)/2,f=(C.size-C.minimumSize)/2}let p,m;if(!d){const _=range(o,-1),C=range(o+1,this.viewItems.length),b=_.reduce((I,D)=>I+(this.viewItems[D].minimumSize-u[D]),0),v=_.reduce((I,D)=>I+(this.viewItems[D].viewMaximumSize-u[D]),0),S=C.length===0?Number.POSITIVE_INFINITY:C.reduce((I,D)=>I+(u[D]-this.viewItems[D].minimumSize),0),y=C.length===0?Number.NEGATIVE_INFINITY:C.reduce((I,D)=>I+(u[D]-this.viewItems[D].viewMaximumSize),0),w=Math.max(b,y),L=Math.min(S,v),x=this.findFirstSnapIndex(_),E=this.findFirstSnapIndex(C);if(typeof x=="number"){const I=this.viewItems[x],D=Math.floor(I.viewMinimumSize/2);p={index:x,limitDelta:I.visible?w-D:w+D,size:I.size}}if(typeof E=="number"){const I=this.viewItems[E],D=Math.floor(I.viewMinimumSize/2);m={index:E,limitDelta:I.visible?L+D:L-D,size:I.size}}}this.sashDragState={start:c,current:c,index:o,sizes:u,minDelta:g,maxDelta:f,alt:d,snapBefore:p,snapAfter:m,disposable:r}};l(t,s)}onSashChange({current:e}){const{index:t,start:s,sizes:o,alt:r,minDelta:l,maxDelta:c,snapBefore:d,snapAfter:u}=this.sashDragState;this.sashDragState.current=e;const g=e-s,f=this.resize(t,g,o,void 0,void 0,l,c,d,u);if(r){const p=t===this.sashItems.length-1,m=this.viewItems.map(y=>y.size),_=p?t:t+1,C=this.viewItems[_],b=C.size-C.maximumSize,v=C.size-C.minimumSize,S=p?t-1:t+1;this.resize(S,-f,m,void 0,void 0,b,v)}this.distributeEmptySpace(),this.layoutViews()}onSashEnd(e){this._onDidSashChange.fire(e),this.sashDragState.disposable.dispose(),this.saveProportions();for(const t of this.viewItems)t.enabled=!0}onViewChange(e,t){const s=this.viewItems.indexOf(e);s<0||s>=this.viewItems.length||(t=typeof t=="number"?t:e.size,t=clamp(t,e.minimumSize,e.maximumSize),this.inverseAltBehavior&&s>0?(this.resize(s-1,Math.floor((e.size-t)/2)),this.distributeEmptySpace(),this.layoutViews()):(e.size=t,this.relayout([s],void 0)))}resizeView(e,t){if(!(e<0||e>=this.viewItems.length)){if(this.state!==State.Idle)throw new Error("Cant modify splitview");this.state=State.Busy;try{const s=range(this.viewItems.length).filter(c=>c!==e),o=[...s.filter(c=>this.viewItems[c].priority===1),e],r=s.filter(c=>this.viewItems[c].priority===2),l=this.viewItems[e];t=Math.round(t),t=clamp(t,l.minimumSize,Math.min(l.maximumSize,this.size)),l.size=t,this.relayout(o,r)}finally{this.state=State.Idle}}}distributeViewSizes(){const e=[];let t=0;for(const c of this.viewItems)c.maximumSize-c.minimumSize>0&&(e.push(c),t+=c.size);const s=Math.floor(t/e.length);for(const c of e)c.size=clamp(s,c.minimumSize,c.maximumSize);const o=range(this.viewItems.length),r=o.filter(c=>this.viewItems[c].priority===1),l=o.filter(c=>this.viewItems[c].priority===2);this.relayout(r,l)}getViewSize(e){return e<0||e>=this.viewItems.length?-1:this.viewItems[e].size}doAddView(e,t,s=this.viewItems.length,o){if(this.state!==State.Idle)throw new Error("Cant modify splitview");this.state=State.Busy;try{const r=$$l(".split-view-view");s===this.viewItems.length?this.viewContainer.appendChild(r):this.viewContainer.insertBefore(r,this.viewContainer.children.item(s));const l=e.onDidChange(p=>this.onViewChange(g,p)),c=toDisposable(()=>r.remove()),d=combinedDisposable(l,c);let u;typeof t=="number"?u=t:(t.type==="auto"&&(this.areViewsDistributed()?t={type:"distribute"}:t={type:"split",index:t.index}),t.type==="split"?u=this.getViewSize(t.index)/2:t.type==="invisible"?u={cachedVisibleSize:t.cachedVisibleSize}:u=e.minimumSize);const g=this.orientation===0?new VerticalViewItem(r,e,u,d):new HorizontalViewItem(r,e,u,d);if(this.viewItems.splice(s,0,g),this.viewItems.length>1){const p={orthogonalStartSash:this.orthogonalStartSash,orthogonalEndSash:this.orthogonalEndSash},m=this.orientation===0?new Sash(this.sashContainer,{getHorizontalSashTop:I=>this.getSashPosition(I),getHorizontalSashWidth:this.getSashOrthogonalSize},{...p,orientation:1}):new Sash(this.sashContainer,{getVerticalSashLeft:I=>this.getSashPosition(I),getVerticalSashHeight:this.getSashOrthogonalSize},{...p,orientation:0}),_=this.orientation===0?I=>({sash:m,start:I.startY,current:I.currentY,alt:I.altKey}):I=>({sash:m,start:I.startX,current:I.currentX,alt:I.altKey}),b=Event$1.map(m.onDidStart,_)(this.onSashStart,this),S=Event$1.map(m.onDidChange,_)(this.onSashChange,this),w=Event$1.map(m.onDidEnd,()=>this.sashItems.findIndex(I=>I.sash===m))(this.onSashEnd,this),L=m.onDidReset(()=>{const I=this.sashItems.findIndex(M=>M.sash===m),D=range(I,-1),k=range(I+1,this.viewItems.length),N=this.findFirstSnapIndex(D),R=this.findFirstSnapIndex(k);typeof N=="number"&&!this.viewItems[N].visible||typeof R=="number"&&!this.viewItems[R].visible||this._onDidSashReset.fire(I)}),x=combinedDisposable(b,S,w,L,m),E={sash:m,disposable:x};this.sashItems.splice(s-1,0,E)}r.appendChild(e.element);let f;typeof t!="number"&&t.type==="split"&&(f=[t.index]),o||this.relayout([s],f),!o&&typeof t!="number"&&t.type==="distribute"&&this.distributeViewSizes()}finally{this.state=State.Idle}}relayout(e,t){const s=this.viewItems.reduce((o,r)=>o+r.size,0);this.resize(this.viewItems.length-1,this.size-s,void 0,e,t),this.distributeEmptySpace(),this.layoutViews(),this.saveProportions()}resize(e,t,s=this.viewItems.map(g=>g.size),o,r,l=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY,d,u){if(e<0||e>=this.viewItems.length)return 0;const g=range(e,-1),f=range(e+1,this.viewItems.length);if(r)for(const E of r)pushToStart(g,E),pushToStart(f,E);if(o)for(const E of o)pushToEnd(g,E),pushToEnd(f,E);const p=g.map(E=>this.viewItems[E]),m=g.map(E=>s[E]),_=f.map(E=>this.viewItems[E]),C=f.map(E=>s[E]),b=g.reduce((E,I)=>E+(this.viewItems[I].minimumSize-s[I]),0),v=g.reduce((E,I)=>E+(this.viewItems[I].maximumSize-s[I]),0),S=f.length===0?Number.POSITIVE_INFINITY:f.reduce((E,I)=>E+(s[I]-this.viewItems[I].minimumSize),0),y=f.length===0?Number.NEGATIVE_INFINITY:f.reduce((E,I)=>E+(s[I]-this.viewItems[I].maximumSize),0),w=Math.max(b,y,l),L=Math.min(S,v,c);let x=!1;if(d){const E=this.viewItems[d.index],I=t>=d.limitDelta;x=I!==E.visible,E.setVisible(I,d.size)}if(!x&&u){const E=this.viewItems[u.index],I=t<u.limitDelta;x=I!==E.visible,E.setVisible(I,u.size)}if(x)return this.resize(e,t,s,o,r,l,c);t=clamp(t,w,L);for(let E=0,I=t;E<p.length;E++){const D=p[E],k=clamp(m[E]+I,D.minimumSize,D.maximumSize),N=k-m[E];I-=N,D.size=k}for(let E=0,I=t;E<_.length;E++){const D=_[E],k=clamp(C[E]-I,D.minimumSize,D.maximumSize),N=k-C[E];I+=N,D.size=k}return t}distributeEmptySpace(e){const t=this.viewItems.reduce((c,d)=>c+d.size,0);let s=this.size-t;const o=range(this.viewItems.length-1,-1),r=o.filter(c=>this.viewItems[c].priority===1),l=o.filter(c=>this.viewItems[c].priority===2);for(const c of l)pushToStart(o,c);for(const c of r)pushToEnd(o,c);typeof e=="number"&&pushToEnd(o,e);for(let c=0;s!==0&&c<o.length;c++){const d=this.viewItems[o[c]],u=clamp(d.size+s,d.minimumSize,d.maximumSize),g=u-d.size;s-=g,d.size=u}}layoutViews(){this._contentSize=this.viewItems.reduce((t,s)=>t+s.size,0);let e=0;for(const t of this.viewItems)t.layout(e,this.layoutContext),e+=t.size;this.sashItems.forEach(t=>t.sash.layout()),this.updateSashEnablement(),this.updateScrollableElement()}updateScrollableElement(){this.orientation===0?this.scrollableElement.setScrollDimensions({height:this.size,scrollHeight:this._contentSize}):this.scrollableElement.setScrollDimensions({width:this.size,scrollWidth:this._contentSize})}updateSashEnablement(){let e=!1;const t=this.viewItems.map(d=>e=d.size-d.minimumSize>0||e);e=!1;const s=this.viewItems.map(d=>e=d.maximumSize-d.size>0||e),o=[...this.viewItems].reverse();e=!1;const r=o.map(d=>e=d.size-d.minimumSize>0||e).reverse();e=!1;const l=o.map(d=>e=d.maximumSize-d.size>0||e).reverse();let c=0;for(let d=0;d<this.sashItems.length;d++){const{sash:u}=this.sashItems[d],g=this.viewItems[d];c+=g.size;const f=!(t[d]&&l[d+1]),p=!(s[d]&&r[d+1]);if(f&&p){const m=range(d,-1),_=range(d+1,this.viewItems.length),C=this.findFirstSnapIndex(m),b=this.findFirstSnapIndex(_),v=typeof C=="number"&&!this.viewItems[C].visible,S=typeof b=="number"&&!this.viewItems[b].visible;v&&r[d]&&(c>0||this.startSnappingEnabled)?u.state=1:S&&t[d]&&(c<this._contentSize||this.endSnappingEnabled)?u.state=2:u.state=0}else f&&!p?u.state=1:!f&&p?u.state=2:u.state=3}}getSashPosition(e){let t=0;for(let s=0;s<this.sashItems.length;s++)if(t+=this.viewItems[s].size,this.sashItems[s].sash===e)return t;return 0}findFirstSnapIndex(e){for(const t of e){const s=this.viewItems[t];if(s.visible&&s.snap)return t}for(const t of e){const s=this.viewItems[t];if(s.visible&&s.maximumSize-s.minimumSize>0)return;if(!s.visible&&s.snap)return t}}areViewsDistributed(){let e,t;for(const s of this.viewItems)if(e=e===void 0?s.size:Math.min(e,s.size),t=t===void 0?s.size:Math.max(t,s.size),t-e>2)return!1;return!0}dispose(){var e;(e=this.sashDragState)==null||e.disposable.dispose(),dispose(this.viewItems),this.viewItems=[],this.sashItems.forEach(t=>t.disposable.dispose()),this.sashItems=[],super.dispose()}}const table="",Ms=class Ms{constructor(e,t,s){this.columns=e,this.getColumnSize=s,this.templateId=Ms.TemplateId,this.renderedTemplates=new Set;const o=new Map(t.map(r=>[r.templateId,r]));this.renderers=[];for(const r of e){const l=o.get(r.templateId);if(!l)throw new Error(`Table cell renderer for template id ${r.templateId} not found.`);this.renderers.push(l)}}renderTemplate(e){const t=append$2(e,$$l(".monaco-table-tr")),s=[],o=[];for(let l=0;l<this.columns.length;l++){const c=this.renderers[l],d=append$2(t,$$l(".monaco-table-td",{"data-col-index":l}));d.style.width=`${this.getColumnSize(l)}px`,s.push(d),o.push(c.renderTemplate(d))}const r={container:e,cellContainers:s,cellTemplateData:o};return this.renderedTemplates.add(r),r}renderElement(e,t,s,o){for(let r=0;r<this.columns.length;r++){const c=this.columns[r].project(e);this.renderers[r].renderElement(c,t,s.cellTemplateData[r],o)}}disposeElement(e,t,s,o){for(let r=0;r<this.columns.length;r++){const l=this.renderers[r];if(l.disposeElement){const d=this.columns[r].project(e);l.disposeElement(d,t,s.cellTemplateData[r],o)}}}disposeTemplate(e){for(let t=0;t<this.columns.length;t++)this.renderers[t].disposeTemplate(e.cellTemplateData[t]);clearNode(e.container),this.renderedTemplates.delete(e)}layoutColumn(e,t){for(const{cellContainers:s}of this.renderedTemplates)s[e].style.width=`${t}px`}};Ms.TemplateId="row";let TableListRenderer=Ms;function asListVirtualDelegate(a){return{getHeight(e){return a.getHeight(e)},getTemplateId(){return TableListRenderer.TemplateId}}}class ColumnHeader extends Disposable{get minimumSize(){return this.column.minimumWidth??120}get maximumSize(){return this.column.maximumWidth??Number.POSITIVE_INFINITY}get onDidChange(){return this.column.onDidChangeWidthConstraints??Event$1.None}constructor(e,t){super(),this.column=e,this.index=t,this._onDidLayout=new Emitter$1,this.onDidLayout=this._onDidLayout.event,this.element=$$l(".monaco-table-th",{"data-col-index":t},e.label),e.tooltip&&this._register(getBaseLayerHoverDelegate().setupManagedHover(getDefaultHoverDelegate("mouse"),this.element,e.tooltip))}layout(e){this._onDidLayout.fire([this.index,e])}}const As=class As{get onDidChangeFocus(){return this.list.onDidChangeFocus}get onDidChangeSelection(){return this.list.onDidChangeSelection}get onDidScroll(){return this.list.onDidScroll}get onMouseDblClick(){return this.list.onMouseDblClick}get onPointer(){return this.list.onPointer}get onDidFocus(){return this.list.onDidFocus}get scrollTop(){return this.list.scrollTop}set scrollTop(e){this.list.scrollTop=e}get scrollHeight(){return this.list.scrollHeight}get renderHeight(){return this.list.renderHeight}get onDidDispose(){return this.list.onDidDispose}constructor(e,t,s,o,r,l){this.virtualDelegate=s,this.columns=o,this.domId=`table_id_${++As.InstanceCount}`,this.disposables=new DisposableStore,this.cachedWidth=0,this.cachedHeight=0,this.domNode=append$2(t,$$l(`.monaco-table.${this.domId}`));const c=o.map((g,f)=>this.disposables.add(new ColumnHeader(g,f))),d={size:c.reduce((g,f)=>g+f.column.weight,0),views:c.map(g=>({size:g.column.weight,view:g}))};this.splitview=this.disposables.add(new SplitView(this.domNode,{orientation:1,scrollbarVisibility:2,getSashOrthogonalSize:()=>this.cachedHeight,descriptor:d})),this.splitview.el.style.height=`${s.headerRowHeight}px`,this.splitview.el.style.lineHeight=`${s.headerRowHeight}px`;const u=new TableListRenderer(o,r,g=>this.splitview.getViewSize(g));this.list=this.disposables.add(new List(e,this.domNode,asListVirtualDelegate(s),[u],l)),Event$1.any(...c.map(g=>g.onDidLayout))(([g,f])=>u.layoutColumn(g,f),null,this.disposables),this.splitview.onDidSashReset(g=>{const f=o.reduce((m,_)=>m+_.weight,0),p=o[g].weight/f*this.cachedWidth;this.splitview.resizeView(g,p)},null,this.disposables),this.styleElement=createStyleSheet(this.domNode),this.style(unthemedListStyles)}updateOptions(e){this.list.updateOptions(e)}splice(e,t,s=[]){this.list.splice(e,t,s)}getHTMLElement(){return this.domNode}style(e){const t=[];t.push(`.monaco-table.${this.domId} > .monaco-split-view2 .monaco-sash.vertical::before {
			top: ${this.virtualDelegate.headerRowHeight+1}px;
			height: calc(100% - ${this.virtualDelegate.headerRowHeight}px);
		}`),this.styleElement.textContent=t.join(`
`),this.list.style(e)}getSelectedElements(){return this.list.getSelectedElements()}getSelection(){return this.list.getSelection()}getFocus(){return this.list.getFocus()}dispose(){this.disposables.dispose()}};As.InstanceCount=0;let Table=As;const toggle="",unthemedToggleStyles={inputActiveOptionBorder:"#007ACC00",inputActiveOptionForeground:"#FFFFFF",inputActiveOptionBackground:"#0E639C50"};class Toggle extends Widget$1{get onChange(){return this._onChange.event}get onKeyDown(){return this._onKeyDown.event}constructor(e){super(),this._onChange=this._register(new Emitter$1),this._onKeyDown=this._register(new Emitter$1),this._opts=e,this._checked=this._opts.isChecked;const t=["monaco-custom-toggle"];this._opts.icon&&(this._icon=this._opts.icon,t.push(...ThemeIcon.asClassNameArray(this._icon))),this._opts.actionClassName&&t.push(...this._opts.actionClassName.split(" ")),this._checked&&t.push("checked"),this.domNode=document.createElement("div"),this._hover=this._register(getBaseLayerHoverDelegate().setupManagedHover(e.hoverDelegate??getDefaultHoverDelegate("mouse"),this.domNode,this._opts.title)),this.domNode.classList.add(...t),this._opts.notFocusable||(this.domNode.tabIndex=0),this.domNode.setAttribute("role","checkbox"),this.domNode.setAttribute("aria-checked",String(this._checked)),this.domNode.setAttribute("aria-label",this._opts.title),this.applyStyles(),this.onclick(this.domNode,s=>{this.enabled&&(this.checked=!this._checked,this._onChange.fire(!1),s.preventDefault())}),this._register(this.ignoreGesture(this.domNode)),this.onkeydown(this.domNode,s=>{if(this.enabled){if(s.keyCode===10||s.keyCode===3){this.checked=!this._checked,this._onChange.fire(!0),s.preventDefault(),s.stopPropagation();return}this._onKeyDown.fire(s)}})}get enabled(){return this.domNode.getAttribute("aria-disabled")!=="true"}focus(){this.domNode.focus()}get checked(){return this._checked}set checked(e){this._checked=e,this.domNode.setAttribute("aria-checked",String(this._checked)),this.domNode.classList.toggle("checked",this._checked),this.applyStyles()}setIcon(e){this._icon&&this.domNode.classList.remove(...ThemeIcon.asClassNameArray(this._icon)),this._icon=e,this._icon&&this.domNode.classList.add(...ThemeIcon.asClassNameArray(this._icon))}width(){return 2+2+2+16}applyStyles(){this.domNode&&(this.domNode.style.borderColor=this._checked&&this._opts.inputActiveOptionBorder||"",this.domNode.style.color=this._checked&&this._opts.inputActiveOptionForeground||"inherit",this.domNode.style.backgroundColor=this._checked&&this._opts.inputActiveOptionBackground||"")}enable(){this.domNode.setAttribute("aria-disabled",String(!1)),this.domNode.classList.remove("disabled")}disable(){this.domNode.setAttribute("aria-disabled",String(!0)),this.domNode.classList.add("disabled")}setTitle(e){this._hover.update(e),this.domNode.setAttribute("aria-label",e)}}const Go=class Go extends Widget$1{constructor(e,t,s){super(),this.checkbox=e,this.domNode=t,this.styles=s,this._onChange=this._register(new Emitter$1),this.onChange=this._onChange.event,this.applyStyles()}get enabled(){return this.checkbox.enabled}enable(){this.checkbox.enable(),this.applyStyles(!0)}disable(){this.checkbox.disable(),this.applyStyles(!1)}setTitle(e){this.checkbox.setTitle(e)}applyStyles(e=this.enabled){this.domNode.style.color=(e?this.styles.checkboxForeground:this.styles.checkboxDisabledForeground)||"",this.domNode.style.backgroundColor=(e?this.styles.checkboxBackground:this.styles.checkboxDisabledBackground)||"",this.domNode.style.borderColor=(e?this.styles.checkboxBorder:this.styles.checkboxDisabledBackground)||"";const t=this.styles.size||18;this.domNode.style.width=this.domNode.style.height=this.domNode.style.fontSize=`${t}px`,this.domNode.style.fontSize=`${t-2}px`}};Go.CLASS_NAME="monaco-checkbox";let BaseCheckbox=Go;class Checkbox extends BaseCheckbox{constructor(e,t,s){const o=new Toggle({title:e,isChecked:t,icon:Codicon.check,actionClassName:BaseCheckbox.CLASS_NAME,hoverDelegate:s.hoverDelegate,...unthemedToggleStyles});super(o,o.domNode,s),this._register(o),this._register(this.checkbox.onChange(r=>{this.applyStyles(),this._onChange.fire(r)}))}get checked(){return this.checkbox.checked}set checked(e){this.checkbox.checked=e,this.applyStyles()}applyStyles(e){this.checkbox.checked?this.checkbox.setIcon(Codicon.check):this.checkbox.setIcon(void 0),super.applyStyles(e)}}class TriStateCheckbox extends BaseCheckbox{constructor(e,t,s){let o;switch(t){case!0:o=Codicon.check;break;case"partial":o=Codicon.dash;break;case!1:o=void 0;break}const r=new Toggle({title:e,isChecked:t===!0,icon:o,actionClassName:Checkbox.CLASS_NAME,hoverDelegate:s.hoverDelegate,...unthemedToggleStyles});super(r,r.domNode,s),this._state=t,this._register(r),this._register(this.checkbox.onChange(l=>{this._state=this.checkbox.checked,this.applyStyles(),this._onChange.fire(l)}))}get checked(){return this._state}set checked(e){this._state!==e&&(this._state=e,this.checkbox.checked=e===!0,this.applyStyles())}applyStyles(e){switch(this._state){case!0:this.checkbox.setIcon(Codicon.check);break;case"partial":this.checkbox.setIcon(Codicon.dash);break;case!1:this.checkbox.setIcon(void 0);break}super.applyStyles(e)}}const NLS_CASE_SENSITIVE_TOGGLE_LABEL=localize(2,"Match Case"),NLS_WHOLE_WORD_TOGGLE_LABEL=localize(3,"Match Whole Word"),NLS_REGEX_TOGGLE_LABEL=localize(4,"Use Regular Expression");class CaseSensitiveToggle extends Toggle{constructor(e){super({icon:Codicon.caseSensitive,title:NLS_CASE_SENSITIVE_TOGGLE_LABEL+e.appendTitle,isChecked:e.isChecked,hoverDelegate:e.hoverDelegate??getDefaultHoverDelegate("element"),inputActiveOptionBorder:e.inputActiveOptionBorder,inputActiveOptionForeground:e.inputActiveOptionForeground,inputActiveOptionBackground:e.inputActiveOptionBackground})}}class WholeWordsToggle extends Toggle{constructor(e){super({icon:Codicon.wholeWord,title:NLS_WHOLE_WORD_TOGGLE_LABEL+e.appendTitle,isChecked:e.isChecked,hoverDelegate:e.hoverDelegate??getDefaultHoverDelegate("element"),inputActiveOptionBorder:e.inputActiveOptionBorder,inputActiveOptionForeground:e.inputActiveOptionForeground,inputActiveOptionBackground:e.inputActiveOptionBackground})}}class RegexToggle extends Toggle{constructor(e){super({icon:Codicon.regex,title:NLS_REGEX_TOGGLE_LABEL+e.appendTitle,isChecked:e.isChecked,hoverDelegate:e.hoverDelegate??getDefaultHoverDelegate("element"),inputActiveOptionBorder:e.inputActiveOptionBorder,inputActiveOptionForeground:e.inputActiveOptionForeground,inputActiveOptionBackground:e.inputActiveOptionBackground})}}function renderText(a,e,t){const s=t??document.createElement("div");return s.textContent=a,s}function renderFormattedText(a,e,t){const s=t??document.createElement("div");return s.textContent="",_renderFormattedText(s,parseFormattedText(a,!!(e!=null&&e.renderCodeSegments)),e==null?void 0:e.actionHandler,e==null?void 0:e.renderCodeSegments),s}class StringStream{constructor(e){this.source=e,this.index=0}eos(){return this.index>=this.source.length}next(){const e=this.peek();return this.advance(),e}peek(){return this.source[this.index]}advance(){this.index++}}function _renderFormattedText(a,e,t,s){let o;if(e.type===2)o=document.createTextNode(e.content||"");else if(e.type===3)o=document.createElement("b");else if(e.type===4)o=document.createElement("i");else if(e.type===7&&s)o=document.createElement("code");else if(e.type===5&&t){const r=document.createElement("a");t.disposables.add(addStandardDisposableListener(r,"click",l=>{t.callback(String(e.index),l)})),o=r}else e.type===8?o=document.createElement("br"):e.type===1&&(o=a);o&&a!==o&&a.appendChild(o),o&&Array.isArray(e.children)&&e.children.forEach(r=>{_renderFormattedText(o,r,t,s)})}function parseFormattedText(a,e){const t={type:1,children:[]};let s=0,o=t;const r=[],l=new StringStream(a);for(;!l.eos();){let c=l.next();const d=c==="\\"&&formatTagType(l.peek(),e)!==0;if(d&&(c=l.next()),!d&&isFormatTag(c,e)&&c===l.peek()){l.advance(),o.type===2&&(o=r.pop());const u=formatTagType(c,e);if(o.type===u||o.type===5&&u===6)o=r.pop();else{const g={type:u,children:[]};u===5&&(g.index=s,s++),o.children.push(g),r.push(o),o=g}}else if(c===`
`)o.type===2&&(o=r.pop()),o.children.push({type:8});else if(o.type!==2){const u={type:2,content:c};o.children.push(u),r.push(o),o=u}else o.content+=c}return o.type===2&&(o=r.pop()),t}function isFormatTag(a,e){return formatTagType(a,e)!==0}function formatTagType(a,e){switch(a){case"*":return 3;case"_":return 4;case"[":return 5;case"]":return 6;case"`":return e?7:0;default:return 0}}class ArrayNavigator{constructor(e,t=0,s=e.length,o=t-1){this.items=e,this.start=t,this.end=s,this.index=o}current(){return this.index===this.start-1||this.index===this.end?null:this.items[this.index]}next(){return this.index=Math.min(this.index+1,this.end),this.current()}previous(){return this.index=Math.max(this.index-1,this.start-1),this.current()}first(){return this.index=this.start,this.current()}last(){return this.index=this.end-1,this.current()}}class HistoryNavigator{constructor(e=new Set,t=10){this._history=e,this._limit=t,this._onChange(),this._history.onDidChange&&(this._disposable=this._history.onDidChange(()=>this._onChange()))}getHistory(){return this._elements}add(e){this._history.delete(e),this._history.add(e),this._onChange()}next(){return this._navigator.next()}previous(){return this._currentPosition()!==0?this._navigator.previous():null}current(){return this._navigator.current()}first(){return this._navigator.first()}last(){return this._navigator.last()}isLast(){return this._currentPosition()>=this._elements.length-1}isNowhere(){return this._navigator.current()===null}has(e){return this._history.has(e)}_onChange(){this._reduceToLimit();const e=this._elements;this._navigator=new ArrayNavigator(e,0,e.length,e.length)}_reduceToLimit(){const e=this._elements;if(e.length>this._limit){const t=e.slice(e.length-this._limit);this._history.replace?this._history.replace(t):this._history=new Set(t)}}_currentPosition(){const e=this._navigator.current();return e?this._elements.indexOf(e):-1}get _elements(){const e=[];return this._history.forEach(t=>e.push(t)),e}dispose(){this._disposable&&(this._disposable.dispose(),this._disposable=void 0)}}const inputBox="",$$9=$$l;let InputBox$1=class extends Widget$1{get onDidChange(){return this._onDidChange.event}get onDidHeightChange(){return this._onDidHeightChange.event}constructor(e,t,s){super(),this.state="idle",this.maxHeight=Number.POSITIVE_INFINITY,this.hover=this._register(new MutableDisposable),this._onDidChange=this._register(new Emitter$1),this._onDidHeightChange=this._register(new Emitter$1),this.contextViewProvider=t,this.options=s,this.message=null,this.placeholder=this.options.placeholder||"",this.tooltip=this.options.tooltip??(this.placeholder||""),this.ariaLabel=this.options.ariaLabel||"",this.options.validationOptions&&(this.validation=this.options.validationOptions.validation),this.element=append$2(e,$$9(".monaco-inputbox.idle"));const o=this.options.flexibleHeight?"textarea":"input",r=append$2(this.element,$$9(".ibwrapper"));if(this.input=append$2(r,$$9(o+".input.empty")),this.input.setAttribute("autocorrect","off"),this.input.setAttribute("autocapitalize","off"),this.input.setAttribute("spellcheck","false"),this.onfocus(this.input,()=>this.element.classList.add("synthetic-focus")),this.onblur(this.input,()=>this.element.classList.remove("synthetic-focus")),this.options.flexibleHeight){this.maxHeight=typeof this.options.flexibleMaxHeight=="number"?this.options.flexibleMaxHeight:Number.POSITIVE_INFINITY,this.mirror=append$2(r,$$9("div.mirror")),this.mirror.innerText=" ",this.scrollableElement=new ScrollableElement(this.element,{vertical:1}),this.options.flexibleWidth&&(this.input.setAttribute("wrap","off"),this.mirror.style.whiteSpace="pre",this.mirror.style.wordWrap="initial"),append$2(e,this.scrollableElement.getDomNode()),this._register(this.scrollableElement),this._register(this.scrollableElement.onScroll(d=>this.input.scrollTop=d.scrollTop));const l=this._register(new DomEmitter(e.ownerDocument,"selectionchange")),c=Event$1.filter(l.event,()=>{const d=e.ownerDocument.getSelection();return(d==null?void 0:d.anchorNode)===r});this._register(c(this.updateScrollDimensions,this)),this._register(this.onDidHeightChange(this.updateScrollDimensions,this))}else this.input.type=this.options.type||"text",this.input.setAttribute("wrap","off");this.ariaLabel&&this.input.setAttribute("aria-label",this.ariaLabel),this.placeholder&&!this.options.showPlaceholderOnFocus&&this.setPlaceHolder(this.placeholder),this.tooltip&&this.setTooltip(this.tooltip),this.oninput(this.input,()=>this.onValueChange()),this.onblur(this.input,()=>this.onBlur()),this.onfocus(this.input,()=>this.onFocus()),this._register(this.ignoreGesture(this.input)),setTimeout(()=>this.updateMirror(),0),this.options.actions&&(this.actionbar=this._register(new ActionBar(this.element)),this.actionbar.push(this.options.actions,{icon:!0,label:!1})),this.applyStyles()}onBlur(){this._hideMessage(),this.options.showPlaceholderOnFocus&&this.input.setAttribute("placeholder","")}onFocus(){this._showMessage(),this.options.showPlaceholderOnFocus&&this.input.setAttribute("placeholder",this.placeholder||"")}setPlaceHolder(e){this.placeholder=e,this.input.setAttribute("placeholder",e)}setTooltip(e){this.tooltip=e,this.hover.value||(this.hover.value=this._register(getBaseLayerHoverDelegate().setupDelayedHoverAtMouse(this.input,()=>({content:this.tooltip,appearance:{compact:!0}}))))}get inputElement(){return this.input}get value(){return this.input.value}set value(e){this.input.value!==e&&(this.input.value=e,this.onValueChange())}get height(){return typeof this.cachedHeight=="number"?this.cachedHeight:getTotalHeight(this.element)}focus(){this.input.focus()}blur(){this.input.blur()}hasFocus(){return isActiveElement(this.input)}select(e=null){this.input.select(),e&&(this.input.setSelectionRange(e.start,e.end),e.end===this.input.value.length&&(this.input.scrollLeft=this.input.scrollWidth))}isSelectionAtEnd(){return this.input.selectionEnd===this.input.value.length&&this.input.selectionStart===this.input.selectionEnd}getSelection(){const e=this.input.selectionStart;if(e===null)return null;const t=this.input.selectionEnd??e;return{start:e,end:t}}enable(){this.input.removeAttribute("disabled")}disable(){this.blur(),this.input.disabled=!0,this._hideMessage()}set paddingRight(e){this.input.style.width=`calc(100% - ${e}px)`,this.mirror&&(this.mirror.style.paddingRight=e+"px")}updateScrollDimensions(){if(typeof this.cachedContentHeight!="number"||typeof this.cachedHeight!="number"||!this.scrollableElement)return;const e=this.cachedContentHeight,t=this.cachedHeight,s=this.input.scrollTop;this.scrollableElement.setScrollDimensions({scrollHeight:e,height:t}),this.scrollableElement.setScrollPosition({scrollTop:s})}showMessage(e,t){if(this.state==="open"&&equals(this.message,e))return;this.message=e,this.element.classList.remove("idle"),this.element.classList.remove("info"),this.element.classList.remove("warning"),this.element.classList.remove("error"),this.element.classList.add(this.classForType(e.type));const s=this.stylesForType(this.message.type);this.element.style.border=`1px solid ${asCssValueWithDefault(s.border,"transparent")}`,this.message.content&&(this.hasFocus()||t)&&this._showMessage()}hideMessage(){this.message=null,this.element.classList.remove("info"),this.element.classList.remove("warning"),this.element.classList.remove("error"),this.element.classList.add("idle"),this._hideMessage(),this.applyStyles()}validate(){let e=null;return this.validation&&(e=this.validation(this.value),e?(this.inputElement.setAttribute("aria-invalid","true"),this.showMessage(e)):this.inputElement.hasAttribute("aria-invalid")&&(this.inputElement.removeAttribute("aria-invalid"),this.hideMessage())),e==null?void 0:e.type}stylesForType(e){const t=this.options.inputBoxStyles;switch(e){case 1:return{border:t.inputValidationInfoBorder,background:t.inputValidationInfoBackground,foreground:t.inputValidationInfoForeground};case 2:return{border:t.inputValidationWarningBorder,background:t.inputValidationWarningBackground,foreground:t.inputValidationWarningForeground};default:return{border:t.inputValidationErrorBorder,background:t.inputValidationErrorBackground,foreground:t.inputValidationErrorForeground}}}classForType(e){switch(e){case 1:return"info";case 2:return"warning";default:return"error"}}_showMessage(){if(!this.contextViewProvider||!this.message)return;let e;const t=()=>e.style.width=getTotalWidth(this.element)+"px";this.contextViewProvider.showContextView({getAnchor:()=>this.element,anchorAlignment:1,render:o=>{if(!this.message)return null;e=append$2(o,$$9(".monaco-inputbox-container")),t();const r=$$9("span.monaco-inputbox-message");this.message.formatContent?renderFormattedText(this.message.content,void 0,r):renderText(this.message.content,void 0,r),r.classList.add(this.classForType(this.message.type));const l=this.stylesForType(this.message.type);return r.style.backgroundColor=l.background??"",r.style.color=l.foreground??"",r.style.border=l.border?`1px solid ${l.border}`:"",append$2(e,r),null},onHide:()=>{this.state="closed"},layout:t});let s;this.message.type===3?s=localize(9,"Error: {0}",this.message.content):this.message.type===2?s=localize(10,"Warning: {0}",this.message.content):s=localize(11,"Info: {0}",this.message.content),alert$1(s),this.state="open"}_hideMessage(){this.contextViewProvider&&(this.state==="open"&&this.contextViewProvider.hideContextView(),this.state="idle")}onValueChange(){this._onDidChange.fire(this.value),this.validate(),this.updateMirror(),this.input.classList.toggle("empty",!this.value),this.state==="open"&&this.contextViewProvider&&this.contextViewProvider.layout()}updateMirror(){if(!this.mirror)return;const e=this.value,s=e.charCodeAt(e.length-1)===10?" ":"";(e+s).replace(/\u000c/g,"")?this.mirror.textContent=e+s:this.mirror.innerText=" ",this.layout()}applyStyles(){const e=this.options.inputBoxStyles,t=e.inputBackground??"",s=e.inputForeground??"",o=e.inputBorder??"";this.element.style.backgroundColor=t,this.element.style.color=s,this.input.style.backgroundColor="inherit",this.input.style.color=s,this.element.style.border=`1px solid ${asCssValueWithDefault(o,"transparent")}`}layout(){if(!this.mirror)return;const e=this.cachedContentHeight;this.cachedContentHeight=getTotalHeight(this.mirror),e!==this.cachedContentHeight&&(this.cachedHeight=Math.min(this.cachedContentHeight,this.maxHeight),this.input.style.height=this.cachedHeight+"px",this._onDidHeightChange.fire(this.cachedContentHeight))}insertAtCursor(e){const t=this.inputElement,s=t.selectionStart,o=t.selectionEnd,r=t.value;s!==null&&o!==null&&(this.value=r.substr(0,s)+e+r.substr(o),t.setSelectionRange(s+1,s+1),this.layout())}dispose(){var e;this._hideMessage(),this.message=null,(e=this.actionbar)==null||e.dispose(),super.dispose()}};class HistoryInputBox extends InputBox$1{constructor(e,t,s){const o=localize(12," or {0} for history","⇅"),r=localize(13," ({0} for history)","⇅");super(e,t,s),this._onDidFocus=this._register(new Emitter$1),this.onDidFocus=this._onDidFocus.event,this._onDidBlur=this._register(new Emitter$1),this.onDidBlur=this._onDidBlur.event,this.history=this._register(new HistoryNavigator(s.history,100));const l=()=>{if(s.showHistoryHint&&s.showHistoryHint()&&!this.placeholder.endsWith(o)&&!this.placeholder.endsWith(r)&&this.history.getHistory().length){const c=this.placeholder.endsWith(")")?o:r,d=this.placeholder+c;s.showPlaceholderOnFocus&&!isActiveElement(this.input)?this.placeholder=d:this.setPlaceHolder(d)}};this.observer=new MutationObserver((c,d)=>{c.forEach(u=>{u.target.textContent||l()})}),this.observer.observe(this.input,{attributeFilter:["class"]}),this.onfocus(this.input,()=>l()),this.onblur(this.input,()=>{const c=d=>{if(this.placeholder.endsWith(d)){const u=this.placeholder.slice(0,this.placeholder.length-d.length);return s.showPlaceholderOnFocus?this.placeholder=u:this.setPlaceHolder(u),!0}else return!1};c(r)||c(o)})}dispose(){super.dispose(),this.observer&&(this.observer.disconnect(),this.observer=void 0)}addToHistory(e){this.value&&(e||this.value!==this.getCurrentValue())&&this.history.add(this.value)}isAtLastInHistory(){return this.history.isLast()}isNowhereInHistory(){return this.history.isNowhere()}showNextValue(){this.history.has(this.value)||this.addToHistory();let e=this.getNextValue();e&&(e=e===this.value?this.getNextValue():e),this.value=e??"",status(this.value?this.value:localize(14,"Cleared Input"))}showPreviousValue(){this.history.has(this.value)||this.addToHistory();let e=this.getPreviousValue();e&&(e=e===this.value?this.getPreviousValue():e),e&&(this.value=e,status(this.value))}setPlaceHolder(e){super.setPlaceHolder(e),this.setTooltip(e)}onBlur(){super.onBlur(),this._onDidBlur.fire()}onFocus(){super.onFocus(),this._onDidFocus.fire()}getCurrentValue(){let e=this.history.current();return e||(e=this.history.last(),this.history.next()),e}getPreviousValue(){return this.history.previous()||this.history.first()}getNextValue(){return this.history.next()}}const findInput="",NLS_DEFAULT_LABEL$1=localize(1,"input");class FindInput extends Widget$1{get onDidOptionChange(){return this._onDidOptionChange.event}get onKeyDown(){return this._onKeyDown.event}get onMouseDown(){return this._onMouseDown.event}get onCaseSensitiveKeyDown(){return this._onCaseSensitiveKeyDown.event}get onRegexKeyDown(){return this._onRegexKeyDown.event}constructor(e,t,s){super(),this.fixFocusOnOptionClickEnabled=!0,this.imeSessionInProgress=!1,this.additionalTogglesDisposables=this._register(new MutableDisposable),this.additionalToggles=[],this._onDidOptionChange=this._register(new Emitter$1),this._onKeyDown=this._register(new Emitter$1),this._onMouseDown=this._register(new Emitter$1),this._onInput=this._register(new Emitter$1),this._onKeyUp=this._register(new Emitter$1),this._onCaseSensitiveKeyDown=this._register(new Emitter$1),this._onRegexKeyDown=this._register(new Emitter$1),this._lastHighlightFindOptions=0,this.placeholder=s.placeholder||"",this.validation=s.validation,this.label=s.label||NLS_DEFAULT_LABEL$1,this.showCommonFindToggles=!!s.showCommonFindToggles;const o=s.appendCaseSensitiveLabel||"",r=s.appendWholeWordsLabel||"",l=s.appendRegexLabel||"",c=!!s.flexibleHeight,d=!!s.flexibleWidth,u=s.flexibleMaxHeight;this.domNode=document.createElement("div"),this.domNode.classList.add("monaco-findInput"),this.inputBox=this._register(new HistoryInputBox(this.domNode,t,{placeholder:this.placeholder||"",ariaLabel:this.label||"",validationOptions:{validation:this.validation},showHistoryHint:s.showHistoryHint,flexibleHeight:c,flexibleWidth:d,flexibleMaxHeight:u,inputBoxStyles:s.inputBoxStyles,history:s.history}));const g=this._register(createInstantHoverDelegate());if(this.showCommonFindToggles){this.regex=this._register(new RegexToggle({appendTitle:l,isChecked:!1,hoverDelegate:g,...s.toggleStyles})),this._register(this.regex.onChange(p=>{this._onDidOptionChange.fire(p),!p&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this._register(this.regex.onKeyDown(p=>{this._onRegexKeyDown.fire(p)})),this.wholeWords=this._register(new WholeWordsToggle({appendTitle:r,isChecked:!1,hoverDelegate:g,...s.toggleStyles})),this._register(this.wholeWords.onChange(p=>{this._onDidOptionChange.fire(p),!p&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this.caseSensitive=this._register(new CaseSensitiveToggle({appendTitle:o,isChecked:!1,hoverDelegate:g,...s.toggleStyles})),this._register(this.caseSensitive.onChange(p=>{this._onDidOptionChange.fire(p),!p&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this._register(this.caseSensitive.onKeyDown(p=>{this._onCaseSensitiveKeyDown.fire(p)}));const f=[this.caseSensitive.domNode,this.wholeWords.domNode,this.regex.domNode];this.onkeydown(this.domNode,p=>{if(p.equals(15)||p.equals(17)||p.equals(9)){const m=f.indexOf(this.domNode.ownerDocument.activeElement);if(m>=0){let _=-1;p.equals(17)?_=(m+1)%f.length:p.equals(15)&&(m===0?_=f.length-1:_=m-1),p.equals(9)?(f[m].blur(),this.inputBox.focus()):_>=0&&f[_].focus(),EventHelper.stop(p,!0)}}})}this.controls=document.createElement("div"),this.controls.className="controls",this.controls.style.display=this.showCommonFindToggles?"":"none",this.caseSensitive&&this.controls.append(this.caseSensitive.domNode),this.wholeWords&&this.controls.appendChild(this.wholeWords.domNode),this.regex&&this.controls.appendChild(this.regex.domNode),this.setAdditionalToggles(s==null?void 0:s.additionalToggles),this.controls&&this.domNode.appendChild(this.controls),e==null||e.appendChild(this.domNode),this._register(addDisposableListener(this.inputBox.inputElement,"compositionstart",f=>{this.imeSessionInProgress=!0})),this._register(addDisposableListener(this.inputBox.inputElement,"compositionend",f=>{this.imeSessionInProgress=!1,this._onInput.fire()})),this.onkeydown(this.inputBox.inputElement,f=>this._onKeyDown.fire(f)),this.onkeyup(this.inputBox.inputElement,f=>this._onKeyUp.fire(f)),this.oninput(this.inputBox.inputElement,f=>this._onInput.fire()),this.onmousedown(this.inputBox.inputElement,f=>this._onMouseDown.fire(f))}get onDidChange(){return this.inputBox.onDidChange}layout(e){this.inputBox.layout(),this.updateInputBoxPadding(e.collapsedFindWidget)}enable(){var e,t,s;this.domNode.classList.remove("disabled"),this.inputBox.enable(),(e=this.regex)==null||e.enable(),(t=this.wholeWords)==null||t.enable(),(s=this.caseSensitive)==null||s.enable();for(const o of this.additionalToggles)o.enable()}disable(){var e,t,s;this.domNode.classList.add("disabled"),this.inputBox.disable(),(e=this.regex)==null||e.disable(),(t=this.wholeWords)==null||t.disable(),(s=this.caseSensitive)==null||s.disable();for(const o of this.additionalToggles)o.disable()}setFocusInputOnOptionClick(e){this.fixFocusOnOptionClickEnabled=e}setEnabled(e){e?this.enable():this.disable()}setAdditionalToggles(e){for(const t of this.additionalToggles)t.domNode.remove();this.additionalToggles=[],this.additionalTogglesDisposables.value=new DisposableStore;for(const t of e??[])this.additionalTogglesDisposables.value.add(t),this.controls.appendChild(t.domNode),this.additionalTogglesDisposables.value.add(t.onChange(s=>{this._onDidOptionChange.fire(s),!s&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus()})),this.additionalToggles.push(t);this.additionalToggles.length>0&&(this.controls.style.display=""),this.updateInputBoxPadding()}updateInputBoxPadding(e=!1){var t,s,o;e?this.inputBox.paddingRight=0:this.inputBox.paddingRight=(((t=this.caseSensitive)==null?void 0:t.width())??0)+(((s=this.wholeWords)==null?void 0:s.width())??0)+(((o=this.regex)==null?void 0:o.width())??0)+this.additionalToggles.reduce((r,l)=>r+l.width(),0)}getValue(){return this.inputBox.value}setValue(e){this.inputBox.value!==e&&(this.inputBox.value=e)}select(){this.inputBox.select()}focus(){this.inputBox.focus()}getCaseSensitive(){var e;return((e=this.caseSensitive)==null?void 0:e.checked)??!1}setCaseSensitive(e){this.caseSensitive&&(this.caseSensitive.checked=e)}getWholeWords(){var e;return((e=this.wholeWords)==null?void 0:e.checked)??!1}setWholeWords(e){this.wholeWords&&(this.wholeWords.checked=e)}getRegex(){var e;return((e=this.regex)==null?void 0:e.checked)??!1}setRegex(e){this.regex&&(this.regex.checked=e,this.validate())}focusOnCaseSensitive(){var e;(e=this.caseSensitive)==null||e.focus()}highlightFindOptions(){this.domNode.classList.remove("highlight-"+this._lastHighlightFindOptions),this._lastHighlightFindOptions=1-this._lastHighlightFindOptions,this.domNode.classList.add("highlight-"+this._lastHighlightFindOptions)}validate(){this.inputBox.validate()}showMessage(e){this.inputBox.showMessage(e)}clearMessage(){this.inputBox.hideMessage()}}var ObjectTreeElementCollapseState;(function(a){a[a.Expanded=0]="Expanded",a[a.Collapsed=1]="Collapsed",a[a.PreserveOrExpanded=2]="PreserveOrExpanded",a[a.PreserveOrCollapsed=3]="PreserveOrCollapsed"})(ObjectTreeElementCollapseState||(ObjectTreeElementCollapseState={}));var TreeMouseEventTarget;(function(a){a[a.Unknown=0]="Unknown",a[a.Twistie=1]="Twistie",a[a.Element=2]="Element",a[a.Filter=3]="Filter"})(TreeMouseEventTarget||(TreeMouseEventTarget={}));class TreeError extends Error{constructor(e,t){super(`TreeError [${e}] ${t}`)}}class WeakMapper{constructor(e){this.fn=e,this._map=new WeakMap}map(e){let t=this._map.get(e);return t||(t=this.fn(e),this._map.set(e,t)),t}}class DiffChange{constructor(e,t,s,o){this.originalStart=e,this.originalLength=t,this.modifiedStart=s,this.modifiedLength=o}getOriginalEnd(){return this.originalStart+this.originalLength}getModifiedEnd(){return this.modifiedStart+this.modifiedLength}}class StringDiffSequence{constructor(e){this.source=e}getElements(){const e=this.source,t=new Int32Array(e.length);for(let s=0,o=e.length;s<o;s++)t[s]=e.charCodeAt(s);return t}}function stringDiff(a,e,t){return new LcsDiff(new StringDiffSequence(a),new StringDiffSequence(e)).ComputeDiff(t).changes}class Debug{static Assert(e,t){if(!e)throw new Error(t)}}class MyArray{static Copy(e,t,s,o,r){for(let l=0;l<r;l++)s[o+l]=e[t+l]}static Copy2(e,t,s,o,r){for(let l=0;l<r;l++)s[o+l]=e[t+l]}}class DiffChangeHelper{constructor(){this.m_changes=[],this.m_originalStart=1073741824,this.m_modifiedStart=1073741824,this.m_originalCount=0,this.m_modifiedCount=0}MarkNextChange(){(this.m_originalCount>0||this.m_modifiedCount>0)&&this.m_changes.push(new DiffChange(this.m_originalStart,this.m_originalCount,this.m_modifiedStart,this.m_modifiedCount)),this.m_originalCount=0,this.m_modifiedCount=0,this.m_originalStart=1073741824,this.m_modifiedStart=1073741824}AddOriginalElement(e,t){this.m_originalStart=Math.min(this.m_originalStart,e),this.m_modifiedStart=Math.min(this.m_modifiedStart,t),this.m_originalCount++}AddModifiedElement(e,t){this.m_originalStart=Math.min(this.m_originalStart,e),this.m_modifiedStart=Math.min(this.m_modifiedStart,t),this.m_modifiedCount++}getChanges(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes}getReverseChanges(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes.reverse(),this.m_changes}}class LcsDiff{constructor(e,t,s=null){this.ContinueProcessingPredicate=s,this._originalSequence=e,this._modifiedSequence=t;const[o,r,l]=LcsDiff._getElements(e),[c,d,u]=LcsDiff._getElements(t);this._hasStrings=l&&u,this._originalStringElements=o,this._originalElementsOrHash=r,this._modifiedStringElements=c,this._modifiedElementsOrHash=d,this.m_forwardHistory=[],this.m_reverseHistory=[]}static _isStringArray(e){return e.length>0&&typeof e[0]=="string"}static _getElements(e){const t=e.getElements();if(LcsDiff._isStringArray(t)){const s=new Int32Array(t.length);for(let o=0,r=t.length;o<r;o++)s[o]=stringHash(t[o],0);return[t,s,!0]}return t instanceof Int32Array?[[],t,!1]:[[],new Int32Array(t),!1]}ElementsAreEqual(e,t){return this._originalElementsOrHash[e]!==this._modifiedElementsOrHash[t]?!1:this._hasStrings?this._originalStringElements[e]===this._modifiedStringElements[t]:!0}ElementsAreStrictEqual(e,t){if(!this.ElementsAreEqual(e,t))return!1;const s=LcsDiff._getStrictElement(this._originalSequence,e),o=LcsDiff._getStrictElement(this._modifiedSequence,t);return s===o}static _getStrictElement(e,t){return typeof e.getStrictElement=="function"?e.getStrictElement(t):null}OriginalElementsAreEqual(e,t){return this._originalElementsOrHash[e]!==this._originalElementsOrHash[t]?!1:this._hasStrings?this._originalStringElements[e]===this._originalStringElements[t]:!0}ModifiedElementsAreEqual(e,t){return this._modifiedElementsOrHash[e]!==this._modifiedElementsOrHash[t]?!1:this._hasStrings?this._modifiedStringElements[e]===this._modifiedStringElements[t]:!0}ComputeDiff(e){return this._ComputeDiff(0,this._originalElementsOrHash.length-1,0,this._modifiedElementsOrHash.length-1,e)}_ComputeDiff(e,t,s,o,r){const l=[!1];let c=this.ComputeDiffRecursive(e,t,s,o,l);return r&&(c=this.PrettifyChanges(c)),{quitEarly:l[0],changes:c}}ComputeDiffRecursive(e,t,s,o,r){for(r[0]=!1;e<=t&&s<=o&&this.ElementsAreEqual(e,s);)e++,s++;for(;t>=e&&o>=s&&this.ElementsAreEqual(t,o);)t--,o--;if(e>t||s>o){let f;return s<=o?(Debug.Assert(e===t+1,"originalStart should only be one more than originalEnd"),f=[new DiffChange(e,0,s,o-s+1)]):e<=t?(Debug.Assert(s===o+1,"modifiedStart should only be one more than modifiedEnd"),f=[new DiffChange(e,t-e+1,s,0)]):(Debug.Assert(e===t+1,"originalStart should only be one more than originalEnd"),Debug.Assert(s===o+1,"modifiedStart should only be one more than modifiedEnd"),f=[]),f}const l=[0],c=[0],d=this.ComputeRecursionPoint(e,t,s,o,l,c,r),u=l[0],g=c[0];if(d!==null)return d;if(!r[0]){const f=this.ComputeDiffRecursive(e,u,s,g,r);let p=[];return r[0]?p=[new DiffChange(u+1,t-(u+1)+1,g+1,o-(g+1)+1)]:p=this.ComputeDiffRecursive(u+1,t,g+1,o,r),this.ConcatenateChanges(f,p)}return[new DiffChange(e,t-e+1,s,o-s+1)]}WALKTRACE(e,t,s,o,r,l,c,d,u,g,f,p,m,_,C,b,v,S){let y=null,w=null,L=new DiffChangeHelper,x=t,E=s,I=m[0]-b[0]-o,D=-1073741824,k=this.m_forwardHistory.length-1;do{const N=I+e;N===x||N<E&&u[N-1]<u[N+1]?(f=u[N+1],_=f-I-o,f<D&&L.MarkNextChange(),D=f,L.AddModifiedElement(f+1,_),I=N+1-e):(f=u[N-1]+1,_=f-I-o,f<D&&L.MarkNextChange(),D=f-1,L.AddOriginalElement(f,_+1),I=N-1-e),k>=0&&(u=this.m_forwardHistory[k],e=u[0],x=1,E=u.length-1)}while(--k>=-1);if(y=L.getReverseChanges(),S[0]){let N=m[0]+1,R=b[0]+1;if(y!==null&&y.length>0){const M=y[y.length-1];N=Math.max(N,M.getOriginalEnd()),R=Math.max(R,M.getModifiedEnd())}w=[new DiffChange(N,p-N+1,R,C-R+1)]}else{L=new DiffChangeHelper,x=l,E=c,I=m[0]-b[0]-d,D=1073741824,k=v?this.m_reverseHistory.length-1:this.m_reverseHistory.length-2;do{const N=I+r;N===x||N<E&&g[N-1]>=g[N+1]?(f=g[N+1]-1,_=f-I-d,f>D&&L.MarkNextChange(),D=f+1,L.AddOriginalElement(f+1,_+1),I=N+1-r):(f=g[N-1],_=f-I-d,f>D&&L.MarkNextChange(),D=f,L.AddModifiedElement(f+1,_+1),I=N-1-r),k>=0&&(g=this.m_reverseHistory[k],r=g[0],x=1,E=g.length-1)}while(--k>=-1);w=L.getChanges()}return this.ConcatenateChanges(y,w)}ComputeRecursionPoint(e,t,s,o,r,l,c){let d=0,u=0,g=0,f=0,p=0,m=0;e--,s--,r[0]=0,l[0]=0,this.m_forwardHistory=[],this.m_reverseHistory=[];const _=t-e+(o-s),C=_+1,b=new Int32Array(C),v=new Int32Array(C),S=o-s,y=t-e,w=e-s,L=t-o,E=(y-S)%2===0;b[S]=e,v[y]=t,c[0]=!1;for(let I=1;I<=_/2+1;I++){let D=0,k=0;g=this.ClipDiagonalBound(S-I,I,S,C),f=this.ClipDiagonalBound(S+I,I,S,C);for(let R=g;R<=f;R+=2){R===g||R<f&&b[R-1]<b[R+1]?d=b[R+1]:d=b[R-1]+1,u=d-(R-S)-w;const M=d;for(;d<t&&u<o&&this.ElementsAreEqual(d+1,u+1);)d++,u++;if(b[R]=d,d+u>D+k&&(D=d,k=u),!E&&Math.abs(R-y)<=I-1&&d>=v[R])return r[0]=d,l[0]=u,M<=v[R]&&1447>0&&I<=1447+1?this.WALKTRACE(S,g,f,w,y,p,m,L,b,v,d,t,r,u,o,l,E,c):null}const N=(D-e+(k-s)-I)/2;if(this.ContinueProcessingPredicate!==null&&!this.ContinueProcessingPredicate(D,N))return c[0]=!0,r[0]=D,l[0]=k,N>0&&1447>0&&I<=1447+1?this.WALKTRACE(S,g,f,w,y,p,m,L,b,v,d,t,r,u,o,l,E,c):(e++,s++,[new DiffChange(e,t-e+1,s,o-s+1)]);p=this.ClipDiagonalBound(y-I,I,y,C),m=this.ClipDiagonalBound(y+I,I,y,C);for(let R=p;R<=m;R+=2){R===p||R<m&&v[R-1]>=v[R+1]?d=v[R+1]-1:d=v[R-1],u=d-(R-y)-L;const M=d;for(;d>e&&u>s&&this.ElementsAreEqual(d,u);)d--,u--;if(v[R]=d,E&&Math.abs(R-S)<=I&&d<=b[R])return r[0]=d,l[0]=u,M>=b[R]&&1447>0&&I<=1447+1?this.WALKTRACE(S,g,f,w,y,p,m,L,b,v,d,t,r,u,o,l,E,c):null}if(I<=1447){let R=new Int32Array(f-g+2);R[0]=S-g+1,MyArray.Copy2(b,g,R,1,f-g+1),this.m_forwardHistory.push(R),R=new Int32Array(m-p+2),R[0]=y-p+1,MyArray.Copy2(v,p,R,1,m-p+1),this.m_reverseHistory.push(R)}}return this.WALKTRACE(S,g,f,w,y,p,m,L,b,v,d,t,r,u,o,l,E,c)}PrettifyChanges(e){for(let t=0;t<e.length;t++){const s=e[t],o=t<e.length-1?e[t+1].originalStart:this._originalElementsOrHash.length,r=t<e.length-1?e[t+1].modifiedStart:this._modifiedElementsOrHash.length,l=s.originalLength>0,c=s.modifiedLength>0;for(;s.originalStart+s.originalLength<o&&s.modifiedStart+s.modifiedLength<r&&(!l||this.OriginalElementsAreEqual(s.originalStart,s.originalStart+s.originalLength))&&(!c||this.ModifiedElementsAreEqual(s.modifiedStart,s.modifiedStart+s.modifiedLength));){const u=this.ElementsAreStrictEqual(s.originalStart,s.modifiedStart);if(this.ElementsAreStrictEqual(s.originalStart+s.originalLength,s.modifiedStart+s.modifiedLength)&&!u)break;s.originalStart++,s.modifiedStart++}const d=[null];if(t<e.length-1&&this.ChangesOverlap(e[t],e[t+1],d)){e[t]=d[0],e.splice(t+1,1),t--;continue}}for(let t=e.length-1;t>=0;t--){const s=e[t];let o=0,r=0;if(t>0){const f=e[t-1];o=f.originalStart+f.originalLength,r=f.modifiedStart+f.modifiedLength}const l=s.originalLength>0,c=s.modifiedLength>0;let d=0,u=this._boundaryScore(s.originalStart,s.originalLength,s.modifiedStart,s.modifiedLength);for(let f=1;;f++){const p=s.originalStart-f,m=s.modifiedStart-f;if(p<o||m<r||l&&!this.OriginalElementsAreEqual(p,p+s.originalLength)||c&&!this.ModifiedElementsAreEqual(m,m+s.modifiedLength))break;const C=(p===o&&m===r?5:0)+this._boundaryScore(p,s.originalLength,m,s.modifiedLength);C>u&&(u=C,d=f)}s.originalStart-=d,s.modifiedStart-=d;const g=[null];if(t>0&&this.ChangesOverlap(e[t-1],e[t],g)){e[t-1]=g[0],e.splice(t,1),t++;continue}}if(this._hasStrings)for(let t=1,s=e.length;t<s;t++){const o=e[t-1],r=e[t],l=r.originalStart-o.originalStart-o.originalLength,c=o.originalStart,d=r.originalStart+r.originalLength,u=d-c,g=o.modifiedStart,f=r.modifiedStart+r.modifiedLength,p=f-g;if(l<5&&u<20&&p<20){const m=this._findBetterContiguousSequence(c,u,g,p,l);if(m){const[_,C]=m;(_!==o.originalStart+o.originalLength||C!==o.modifiedStart+o.modifiedLength)&&(o.originalLength=_-o.originalStart,o.modifiedLength=C-o.modifiedStart,r.originalStart=_+l,r.modifiedStart=C+l,r.originalLength=d-r.originalStart,r.modifiedLength=f-r.modifiedStart)}}}return e}_findBetterContiguousSequence(e,t,s,o,r){if(t<r||o<r)return null;const l=e+t-r+1,c=s+o-r+1;let d=0,u=0,g=0;for(let f=e;f<l;f++)for(let p=s;p<c;p++){const m=this._contiguousSequenceScore(f,p,r);m>0&&m>d&&(d=m,u=f,g=p)}return d>0?[u,g]:null}_contiguousSequenceScore(e,t,s){let o=0;for(let r=0;r<s;r++){if(!this.ElementsAreEqual(e+r,t+r))return 0;o+=this._originalStringElements[e+r].length}return o}_OriginalIsBoundary(e){return e<=0||e>=this._originalElementsOrHash.length-1?!0:this._hasStrings&&/^\s*$/.test(this._originalStringElements[e])}_OriginalRegionIsBoundary(e,t){if(this._OriginalIsBoundary(e)||this._OriginalIsBoundary(e-1))return!0;if(t>0){const s=e+t;if(this._OriginalIsBoundary(s-1)||this._OriginalIsBoundary(s))return!0}return!1}_ModifiedIsBoundary(e){return e<=0||e>=this._modifiedElementsOrHash.length-1?!0:this._hasStrings&&/^\s*$/.test(this._modifiedStringElements[e])}_ModifiedRegionIsBoundary(e,t){if(this._ModifiedIsBoundary(e)||this._ModifiedIsBoundary(e-1))return!0;if(t>0){const s=e+t;if(this._ModifiedIsBoundary(s-1)||this._ModifiedIsBoundary(s))return!0}return!1}_boundaryScore(e,t,s,o){const r=this._OriginalRegionIsBoundary(e,t)?1:0,l=this._ModifiedRegionIsBoundary(s,o)?1:0;return r+l}ConcatenateChanges(e,t){const s=[];if(e.length===0||t.length===0)return t.length>0?t:e;if(this.ChangesOverlap(e[e.length-1],t[0],s)){const o=new Array(e.length+t.length-1);return MyArray.Copy(e,0,o,0,e.length-1),o[e.length-1]=s[0],MyArray.Copy(t,1,o,e.length,t.length-1),o}else{const o=new Array(e.length+t.length);return MyArray.Copy(e,0,o,0,e.length),MyArray.Copy(t,0,o,e.length,t.length),o}}ChangesOverlap(e,t,s){if(Debug.Assert(e.originalStart<=t.originalStart,"Left change is not less than or equal to right change"),Debug.Assert(e.modifiedStart<=t.modifiedStart,"Left change is not less than or equal to right change"),e.originalStart+e.originalLength>=t.originalStart||e.modifiedStart+e.modifiedLength>=t.modifiedStart){const o=e.originalStart;let r=e.originalLength;const l=e.modifiedStart;let c=e.modifiedLength;return e.originalStart+e.originalLength>=t.originalStart&&(r=t.originalStart+t.originalLength-e.originalStart),e.modifiedStart+e.modifiedLength>=t.modifiedStart&&(c=t.modifiedStart+t.modifiedLength-e.modifiedStart),s[0]=new DiffChange(o,r,l,c),!0}else return s[0]=null,!1}ClipDiagonalBound(e,t,s,o){if(e>=0&&e<o)return e;const r=s,l=o-s-1,c=t%2===0;if(e<0){const d=r%2===0;return c===d?0:1}else{const d=l%2===0;return c===d?o-1:o-2}}}function isFilterResult(a){return!!a&&a.visibility!==void 0}function getVisibleState(a){switch(a){case!0:return 1;case!1:return 0;default:return a}}function isCollapsibleStateUpdate(a){return typeof a.collapsible=="boolean"}class IndexTreeModel{constructor(e,t,s={}){this.user=e,this.rootRef=[],this.eventBufferer=new EventBufferer,this._onDidSpliceModel=new Emitter$1,this.onDidSpliceModel=this._onDidSpliceModel.event,this._onDidSpliceRenderedNodes=new Emitter$1,this.onDidSpliceRenderedNodes=this._onDidSpliceRenderedNodes.event,this._onDidChangeCollapseState=new Emitter$1,this.onDidChangeCollapseState=this.eventBufferer.wrapEvent(this._onDidChangeCollapseState.event),this._onDidChangeRenderNodeCount=new Emitter$1,this.onDidChangeRenderNodeCount=this.eventBufferer.wrapEvent(this._onDidChangeRenderNodeCount.event),this.refilterDelayer=new Delayer(MicrotaskDelay),this.collapseByDefault=typeof s.collapseByDefault>"u"?!1:s.collapseByDefault,this.allowNonCollapsibleParents=s.allowNonCollapsibleParents??!1,this.filter=s.filter,this.autoExpandSingleChildren=typeof s.autoExpandSingleChildren>"u"?!1:s.autoExpandSingleChildren,this.root={parent:void 0,element:t,children:[],depth:0,visibleChildrenCount:0,visibleChildIndex:-1,collapsible:!1,collapsed:!1,renderNodeCount:0,visibility:1,visible:!0,filterData:void 0}}splice(e,t,s=Iterable.empty(),o={}){if(e.length===0)throw new TreeError(this.user,"Invalid tree location");o.diffIdentityProvider?this.spliceSmart(o.diffIdentityProvider,e,t,s,o):this.spliceSimple(e,t,s,o)}spliceSmart(e,t,s,o=Iterable.empty(),r,l=r.diffDepth??0){const{parentNode:c}=this.getParentNodeWithListIndex(t);if(!c.lastDiffIds)return this.spliceSimple(t,s,o,r);const d=[...o],u=t[t.length-1],g=new LcsDiff({getElements:()=>c.lastDiffIds},{getElements:()=>[...c.children.slice(0,u),...d,...c.children.slice(u+s)].map(C=>e.getId(C.element).toString())}).ComputeDiff(!1);if(g.quitEarly)return c.lastDiffIds=void 0,this.spliceSimple(t,s,d,r);const f=t.slice(0,-1),p=(C,b,v)=>{if(l>0)for(let S=0;S<v;S++)C--,b--,this.spliceSmart(e,[...f,C,0],Number.MAX_SAFE_INTEGER,d[b].children,r,l-1)};let m=Math.min(c.children.length,u+s),_=d.length;for(const C of g.changes.sort((b,v)=>v.originalStart-b.originalStart))p(m,_,m-(C.originalStart+C.originalLength)),m=C.originalStart,_=C.modifiedStart-u,this.spliceSimple([...f,m],C.originalLength,Iterable.slice(d,_,_+C.modifiedLength),r);p(m,_,m)}spliceSimple(e,t,s=Iterable.empty(),{onDidCreateNode:o,onDidDeleteNode:r,diffIdentityProvider:l}){const{parentNode:c,listIndex:d,revealed:u,visible:g}=this.getParentNodeWithListIndex(e),f=[],p=Iterable.map(s,L=>this.createTreeNode(L,c,c.visible?1:0,u,f,o)),m=e[e.length-1];let _=0;for(let L=m;L>=0&&L<c.children.length;L--){const x=c.children[L];if(x.visible){_=x.visibleChildIndex;break}}const C=[];let b=0,v=0;for(const L of p)C.push(L),v+=L.renderNodeCount,L.visible&&(L.visibleChildIndex=_+b++);const S=splice$1(c.children,m,t,C);l?c.lastDiffIds?splice$1(c.lastDiffIds,m,t,C.map(L=>l.getId(L.element).toString())):c.lastDiffIds=c.children.map(L=>l.getId(L.element).toString()):c.lastDiffIds=void 0;let y=0;for(const L of S)L.visible&&y++;if(y!==0)for(let L=m+C.length;L<c.children.length;L++){const x=c.children[L];x.visible&&(x.visibleChildIndex-=y)}if(c.visibleChildrenCount+=b-y,S.length>0&&r){const L=x=>{r(x),x.children.forEach(L)};S.forEach(L)}if(u&&g){const L=S.reduce((x,E)=>x+(E.visible?E.renderNodeCount:0),0);this._updateAncestorsRenderNodeCount(c,v-L),this._onDidSpliceRenderedNodes.fire({start:d,deleteCount:L,elements:f})}this._onDidSpliceModel.fire({insertedNodes:C,deletedNodes:S});let w=c;for(;w;){if(w.visibility===2){this.refilterDelayer.trigger(()=>this.refilter());break}w=w.parent}}rerender(e){if(e.length===0)throw new TreeError(this.user,"Invalid tree location");const{node:t,listIndex:s,revealed:o}=this.getTreeNodeWithListIndex(e);t.visible&&o&&this._onDidSpliceRenderedNodes.fire({start:s,deleteCount:1,elements:[t]})}has(e){return this.hasTreeNode(e)}getListIndex(e){const{listIndex:t,visible:s,revealed:o}=this.getTreeNodeWithListIndex(e);return s&&o?t:-1}getListRenderCount(e){return this.getTreeNode(e).renderNodeCount}isCollapsible(e){return this.getTreeNode(e).collapsible}setCollapsible(e,t){const s=this.getTreeNode(e);typeof t>"u"&&(t=!s.collapsible);const o={collapsible:t};return this.eventBufferer.bufferEvents(()=>this._setCollapseState(e,o))}isCollapsed(e){return this.getTreeNode(e).collapsed}setCollapsed(e,t,s){const o=this.getTreeNode(e);typeof t>"u"&&(t=!o.collapsed);const r={collapsed:t,recursive:s||!1};return this.eventBufferer.bufferEvents(()=>this._setCollapseState(e,r))}_setCollapseState(e,t){const{node:s,listIndex:o,revealed:r}=this.getTreeNodeWithListIndex(e),l=this._setListNodeCollapseState(s,o,r,t);if(s!==this.root&&this.autoExpandSingleChildren&&l&&!isCollapsibleStateUpdate(t)&&s.collapsible&&!s.collapsed&&!t.recursive){let c=-1;for(let d=0;d<s.children.length;d++)if(s.children[d].visible)if(c>-1){c=-1;break}else c=d;c>-1&&this._setCollapseState([...e,c],t)}return l}_setListNodeCollapseState(e,t,s,o){const r=this._setNodeCollapseState(e,o,!1);if(!s||!e.visible||!r)return r;const l=e.renderNodeCount,c=this.updateNodeAfterCollapseChange(e),d=l-(t===-1?0:1);return this._onDidSpliceRenderedNodes.fire({start:t+1,deleteCount:d,elements:c.slice(1)}),r}_setNodeCollapseState(e,t,s){let o;if(e===this.root?o=!1:(isCollapsibleStateUpdate(t)?(o=e.collapsible!==t.collapsible,e.collapsible=t.collapsible):e.collapsible?(o=e.collapsed!==t.collapsed,e.collapsed=t.collapsed):o=!1,o&&this._onDidChangeCollapseState.fire({node:e,deep:s})),!isCollapsibleStateUpdate(t)&&t.recursive)for(const r of e.children)o=this._setNodeCollapseState(r,t,!0)||o;return o}expandTo(e){this.eventBufferer.bufferEvents(()=>{let t=this.getTreeNode(e);for(;t.parent;)t=t.parent,e=e.slice(0,e.length-1),t.collapsed&&this._setCollapseState(e,{collapsed:!1,recursive:!1})})}refilter(){const e=this.root.renderNodeCount,t=this.updateNodeAfterFilterChange(this.root);this._onDidSpliceRenderedNodes.fire({start:0,deleteCount:e,elements:t}),this.refilterDelayer.cancel()}createTreeNode(e,t,s,o,r,l){const c={parent:t,element:e.element,children:[],depth:t.depth+1,visibleChildrenCount:0,visibleChildIndex:-1,collapsible:typeof e.collapsible=="boolean"?e.collapsible:typeof e.collapsed<"u",collapsed:typeof e.collapsed>"u"?this.collapseByDefault:e.collapsed,renderNodeCount:1,visibility:1,visible:!0,filterData:void 0},d=this._filterNode(c,s);c.visibility=d,o&&r.push(c);const u=e.children||Iterable.empty(),g=o&&d!==0&&!c.collapsed;let f=0,p=1;for(const m of u){const _=this.createTreeNode(m,c,d,g,r,l);c.children.push(_),p+=_.renderNodeCount,_.visible&&(_.visibleChildIndex=f++)}return this.allowNonCollapsibleParents||(c.collapsible=c.collapsible||c.children.length>0),c.visibleChildrenCount=f,c.visible=d===2?f>0:d===1,c.visible?c.collapsed||(c.renderNodeCount=p):(c.renderNodeCount=0,o&&r.pop()),l==null||l(c),c}updateNodeAfterCollapseChange(e){const t=e.renderNodeCount,s=[];return this._updateNodeAfterCollapseChange(e,s),this._updateAncestorsRenderNodeCount(e.parent,s.length-t),s}_updateNodeAfterCollapseChange(e,t){if(e.visible===!1)return 0;if(t.push(e),e.renderNodeCount=1,!e.collapsed)for(const s of e.children)e.renderNodeCount+=this._updateNodeAfterCollapseChange(s,t);return this._onDidChangeRenderNodeCount.fire(e),e.renderNodeCount}updateNodeAfterFilterChange(e){const t=e.renderNodeCount,s=[];return this._updateNodeAfterFilterChange(e,e.visible?1:0,s),this._updateAncestorsRenderNodeCount(e.parent,s.length-t),s}_updateNodeAfterFilterChange(e,t,s,o=!0){let r;if(e!==this.root){if(r=this._filterNode(e,t),r===0)return e.visible=!1,e.renderNodeCount=0,!1;o&&s.push(e)}const l=s.length;e.renderNodeCount=e===this.root?0:1;let c=!1;if(!e.collapsed||r!==0){let d=0;for(const u of e.children)c=this._updateNodeAfterFilterChange(u,r,s,o&&!e.collapsed)||c,u.visible&&(u.visibleChildIndex=d++);e.visibleChildrenCount=d}else e.visibleChildrenCount=0;return e!==this.root&&(e.visible=r===2?c:r===1,e.visibility=r),e.visible?e.collapsed||(e.renderNodeCount+=s.length-l):(e.renderNodeCount=0,o&&s.pop()),this._onDidChangeRenderNodeCount.fire(e),e.visible}_updateAncestorsRenderNodeCount(e,t){if(t!==0)for(;e;)e.renderNodeCount+=t,this._onDidChangeRenderNodeCount.fire(e),e=e.parent}_filterNode(e,t){const s=this.filter?this.filter.filter(e.element,t):1;return typeof s=="boolean"?(e.filterData=void 0,s?1:0):isFilterResult(s)?(e.filterData=s.data,getVisibleState(s.visibility)):(e.filterData=void 0,getVisibleState(s))}hasTreeNode(e,t=this.root){if(!e||e.length===0)return!0;const[s,...o]=e;return s<0||s>t.children.length?!1:this.hasTreeNode(o,t.children[s])}getTreeNode(e,t=this.root){if(!e||e.length===0)return t;const[s,...o]=e;if(s<0||s>t.children.length)throw new TreeError(this.user,"Invalid tree location");return this.getTreeNode(o,t.children[s])}getTreeNodeWithListIndex(e){if(e.length===0)return{node:this.root,listIndex:-1,revealed:!0,visible:!1};const{parentNode:t,listIndex:s,revealed:o,visible:r}=this.getParentNodeWithListIndex(e),l=e[e.length-1];if(l<0||l>t.children.length)throw new TreeError(this.user,"Invalid tree location");const c=t.children[l];return{node:c,listIndex:s,revealed:o,visible:r&&c.visible}}getParentNodeWithListIndex(e,t=this.root,s=0,o=!0,r=!0){const[l,...c]=e;if(l<0||l>t.children.length)throw new TreeError(this.user,"Invalid tree location");for(let d=0;d<l;d++)s+=t.children[d].renderNodeCount;return o=o&&!t.collapsed,r=r&&t.visible,c.length===0?{parentNode:t,listIndex:s,revealed:o,visible:r}:this.getParentNodeWithListIndex(c,t.children[l],s+1,o,r)}getNode(e=[]){return this.getTreeNode(e)}getNodeLocation(e){const t=[];let s=e;for(;s.parent;)t.push(s.parent.children.indexOf(s)),s=s.parent;return t.reverse()}getParentNodeLocation(e){if(e.length!==0)return e.length===1?[]:tail(e)[0]}getFirstElementChild(e){const t=this.getTreeNode(e);if(t.children.length!==0)return t.children[0].element}}const tree="";class TreeElementsDragAndDropData extends ElementsDragAndDropData{constructor(e){super(e.elements.map(t=>t.element)),this.data=e}}function asTreeDragAndDropData(a){return a instanceof ElementsDragAndDropData?new TreeElementsDragAndDropData(a):a}class TreeNodeListDragAndDrop{constructor(e,t){this.modelProvider=e,this.dnd=t,this.autoExpandDisposable=Disposable.None,this.disposables=new DisposableStore}getDragURI(e){return this.dnd.getDragURI(e.element)}getDragLabel(e,t){if(this.dnd.getDragLabel)return this.dnd.getDragLabel(e.map(s=>s.element),t)}onDragStart(e,t){var s,o;(o=(s=this.dnd).onDragStart)==null||o.call(s,asTreeDragAndDropData(e),t)}onDragOver(e,t,s,o,r,l=!0){const c=this.dnd.onDragOver(asTreeDragAndDropData(e),t&&t.element,s,o,r),d=this.autoExpandNode!==t;if(d&&(this.autoExpandDisposable.dispose(),this.autoExpandNode=t),typeof t>"u")return c;if(d&&typeof c!="boolean"&&c.autoExpand&&(this.autoExpandDisposable=disposableTimeout(()=>{const m=this.modelProvider(),_=m.getNodeLocation(t);m.isCollapsed(_)&&m.setCollapsed(_,!1),this.autoExpandNode=void 0},500,this.disposables)),typeof c=="boolean"||!c.accept||typeof c.bubble>"u"||c.feedback){if(!l){const m=typeof c=="boolean"?c:c.accept,_=typeof c=="boolean"?void 0:c.effect;return{accept:m,effect:_,feedback:[s]}}return c}if(c.bubble===1){const m=this.modelProvider(),_=m.getNodeLocation(t),C=m.getParentNodeLocation(_),b=m.getNode(C),v=C&&m.getListIndex(C);return this.onDragOver(e,b,v,o,r,!1)}const u=this.modelProvider(),g=u.getNodeLocation(t),f=u.getListIndex(g),p=u.getListRenderCount(g);return{...c,feedback:range(f,f+p)}}drop(e,t,s,o,r){this.autoExpandDisposable.dispose(),this.autoExpandNode=void 0,this.dnd.drop(asTreeDragAndDropData(e),t&&t.element,s,o,r)}onDragEnd(e){var t,s;(s=(t=this.dnd).onDragEnd)==null||s.call(t,e)}dispose(){this.disposables.dispose(),this.dnd.dispose()}}function asListOptions(a,e,t){return t&&{...t,identityProvider:t.identityProvider&&{getId(s){return t.identityProvider.getId(s.element)}},dnd:t.dnd&&e.add(new TreeNodeListDragAndDrop(a,t.dnd)),multipleSelectionController:t.multipleSelectionController&&{isSelectionSingleChangeEvent(s){return t.multipleSelectionController.isSelectionSingleChangeEvent({...s,element:s.element})},isSelectionRangeChangeEvent(s){return t.multipleSelectionController.isSelectionRangeChangeEvent({...s,element:s.element})}},accessibilityProvider:t.accessibilityProvider&&{...t.accessibilityProvider,getSetSize(s){const o=a(),r=o.getNodeLocation(s),l=o.getParentNodeLocation(r);return o.getNode(l).visibleChildrenCount},getPosInSet(s){return s.visibleChildIndex+1},isChecked:t.accessibilityProvider&&t.accessibilityProvider.isChecked?s=>t.accessibilityProvider.isChecked(s.element):void 0,getRole:t.accessibilityProvider&&t.accessibilityProvider.getRole?s=>t.accessibilityProvider.getRole(s.element):()=>"treeitem",getAriaLabel(s){return t.accessibilityProvider.getAriaLabel(s.element)},getWidgetAriaLabel(){return t.accessibilityProvider.getWidgetAriaLabel()},getWidgetRole:t.accessibilityProvider&&t.accessibilityProvider.getWidgetRole?()=>t.accessibilityProvider.getWidgetRole():()=>"tree",getAriaLevel:t.accessibilityProvider&&t.accessibilityProvider.getAriaLevel?s=>t.accessibilityProvider.getAriaLevel(s.element):s=>s.depth,getActiveDescendantId:t.accessibilityProvider.getActiveDescendantId&&(s=>t.accessibilityProvider.getActiveDescendantId(s.element))},keyboardNavigationLabelProvider:t.keyboardNavigationLabelProvider&&{...t.keyboardNavigationLabelProvider,getKeyboardNavigationLabel(s){return t.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(s.element)}}}}class ComposedTreeDelegate{constructor(e){this.delegate=e}getHeight(e){return this.delegate.getHeight(e.element)}getTemplateId(e){return this.delegate.getTemplateId(e.element)}hasDynamicHeight(e){return!!this.delegate.hasDynamicHeight&&this.delegate.hasDynamicHeight(e.element)}setDynamicHeight(e,t){var s,o;(o=(s=this.delegate).setDynamicHeight)==null||o.call(s,e.element,t)}}var RenderIndentGuides;(function(a){a.None="none",a.OnHover="onHover",a.Always="always"})(RenderIndentGuides||(RenderIndentGuides={}));class EventCollection{get elements(){return this._elements}constructor(e,t=[]){this._elements=t,this.disposables=new DisposableStore,this.onDidChange=Event$1.forEach(e,s=>this._elements=s,this.disposables)}dispose(){this.disposables.dispose()}}const ai=class ai{constructor(e,t,s,o,r,l={}){var c;this.renderer=e,this.model=t,this.activeNodes=o,this.renderedIndentGuides=r,this.renderedElements=new Map,this.renderedNodes=new Map,this.indent=ai.DefaultIndent,this.hideTwistiesOfChildlessElements=!1,this.shouldRenderIndentGuides=!1,this.activeIndentNodes=new Set,this.indentGuidesDisposable=Disposable.None,this.disposables=new DisposableStore,this.templateId=e.templateId,this.updateOptions(l),Event$1.map(s,d=>d.node)(this.onDidChangeNodeTwistieState,this,this.disposables),(c=e.onDidChangeTwistieState)==null||c.call(e,this.onDidChangeTwistieState,this,this.disposables)}updateOptions(e={}){if(typeof e.indent<"u"){const t=clamp(e.indent,0,40);if(t!==this.indent){this.indent=t;for(const[s,o]of this.renderedNodes)o.indentSize=ai.DefaultIndent+(s.depth-1)*this.indent,this.renderTreeElement(s,o)}}if(typeof e.renderIndentGuides<"u"){const t=e.renderIndentGuides!==RenderIndentGuides.None;if(t!==this.shouldRenderIndentGuides){this.shouldRenderIndentGuides=t;for(const[s,o]of this.renderedNodes)this._renderIndentGuides(s,o);if(this.indentGuidesDisposable.dispose(),t){const s=new DisposableStore;this.activeNodes.onDidChange(this._onDidChangeActiveNodes,this,s),this.indentGuidesDisposable=s,this._onDidChangeActiveNodes(this.activeNodes.elements)}}}typeof e.hideTwistiesOfChildlessElements<"u"&&(this.hideTwistiesOfChildlessElements=e.hideTwistiesOfChildlessElements)}renderTemplate(e){const t=append$2(e,$$l(".monaco-tl-row")),s=append$2(t,$$l(".monaco-tl-indent")),o=append$2(t,$$l(".monaco-tl-twistie")),r=append$2(t,$$l(".monaco-tl-contents")),l=this.renderer.renderTemplate(r);return{container:e,indent:s,twistie:o,indentGuidesDisposable:Disposable.None,indentSize:0,templateData:l}}renderElement(e,t,s,o){s.indentSize=ai.DefaultIndent+(e.depth-1)*this.indent,this.renderedNodes.set(e,s),this.renderedElements.set(e.element,e),this.renderTreeElement(e,s),this.renderer.renderElement(e,t,s.templateData,{...o,indent:s.indentSize})}disposeElement(e,t,s,o){var r,l;s.indentGuidesDisposable.dispose(),(l=(r=this.renderer).disposeElement)==null||l.call(r,e,t,s.templateData,{...o,indent:s.indentSize}),typeof(o==null?void 0:o.height)=="number"&&(this.renderedNodes.delete(e),this.renderedElements.delete(e.element))}disposeTemplate(e){this.renderer.disposeTemplate(e.templateData)}onDidChangeTwistieState(e){const t=this.renderedElements.get(e);t&&this.onDidChangeNodeTwistieState(t)}onDidChangeNodeTwistieState(e){const t=this.renderedNodes.get(e);t&&(this._onDidChangeActiveNodes(this.activeNodes.elements),this.renderTreeElement(e,t))}renderTreeElement(e,t){t.twistie.style.paddingLeft=`${t.indentSize}px`,t.indent.style.width=`${t.indentSize+this.indent-16}px`,e.collapsible?t.container.setAttribute("aria-expanded",String(!e.collapsed)):t.container.removeAttribute("aria-expanded"),t.twistie.classList.remove(...ThemeIcon.asClassNameArray(Codicon.treeItemExpanded));let s=!1;this.renderer.renderTwistie&&(s=this.renderer.renderTwistie(e.element,t.twistie)),e.collapsible&&(!this.hideTwistiesOfChildlessElements||e.visibleChildrenCount>0)?(s||t.twistie.classList.add(...ThemeIcon.asClassNameArray(Codicon.treeItemExpanded)),t.twistie.classList.add("collapsible"),t.twistie.classList.toggle("collapsed",e.collapsed)):t.twistie.classList.remove("collapsible","collapsed"),this._renderIndentGuides(e,t)}_renderIndentGuides(e,t){if(clearNode(t.indent),t.indentGuidesDisposable.dispose(),!this.shouldRenderIndentGuides)return;const s=new DisposableStore;for(;;){const o=this.model.getNodeLocation(e),r=this.model.getParentNodeLocation(o);if(!r)break;const l=this.model.getNode(r),c=$$l(".indent-guide",{style:`width: ${this.indent}px`});this.activeIndentNodes.has(l)&&c.classList.add("active"),t.indent.childElementCount===0?t.indent.appendChild(c):t.indent.insertBefore(c,t.indent.firstElementChild),this.renderedIndentGuides.add(l,c),s.add(toDisposable(()=>this.renderedIndentGuides.delete(l,c))),e=l}t.indentGuidesDisposable=s}_onDidChangeActiveNodes(e){if(!this.shouldRenderIndentGuides)return;const t=new Set;e.forEach(s=>{const o=this.model.getNodeLocation(s);try{const r=this.model.getParentNodeLocation(o);s.collapsible&&s.children.length>0&&!s.collapsed?t.add(s):r&&t.add(this.model.getNode(r))}catch{}}),this.activeIndentNodes.forEach(s=>{t.has(s)||this.renderedIndentGuides.forEach(s,o=>o.classList.remove("active"))}),t.forEach(s=>{this.activeIndentNodes.has(s)||this.renderedIndentGuides.forEach(s,o=>o.classList.add("active"))}),this.activeIndentNodes=t}dispose(){this.renderedNodes.clear(),this.renderedElements.clear(),this.indentGuidesDisposable.dispose(),dispose(this.disposables)}};ai.DefaultIndent=8;let TreeRenderer=ai;function contiguousFuzzyScore(a,e){const t=e.toLowerCase().indexOf(a);let s;if(t>-1){s=[Number.MAX_SAFE_INTEGER,0];for(let o=a.length;o>0;o--)s.push(t+o-1)}return s}class FindFilter{get totalCount(){return this._totalCount}get matchCount(){return this._matchCount}set findMatchType(e){this._findMatchType=e}get findMatchType(){return this._findMatchType}set findMode(e){this._findMode=e}get findMode(){return this._findMode}constructor(e,t,s){this._keyboardNavigationLabelProvider=e,this._filter=t,this._defaultFindVisibility=s,this._totalCount=0,this._matchCount=0,this._findMatchType=TreeFindMatchType.Fuzzy,this._findMode=TreeFindMode.Highlight,this._pattern="",this._lowercasePattern="",this.disposables=new DisposableStore}filter(e,t){let s=1;if(this._filter){const l=this._filter.filter(e,t);if(typeof l=="boolean"?s=l?1:0:isFilterResult(l)?s=getVisibleState(l.visibility):s=l,s===0)return!1}if(this._totalCount++,!this._pattern)return this._matchCount++,{data:FuzzyScore.Default,visibility:s};const o=this._keyboardNavigationLabelProvider.getKeyboardNavigationLabel(e),r=Array.isArray(o)?o:[o];for(const l of r){const c=l&&l.toString();if(typeof c>"u")return{data:FuzzyScore.Default,visibility:s};let d;if(this._findMatchType===TreeFindMatchType.Contiguous?d=contiguousFuzzyScore(this._lowercasePattern,c.toLowerCase()):d=fuzzyScore(this._pattern,this._lowercasePattern,0,c,c.toLowerCase(),0,{firstMatchCanBeWeak:!0,boostFullMatch:!0}),d)return this._matchCount++,r.length===1?{data:d,visibility:s}:{data:{label:c,score:d},visibility:s}}return this._findMode===TreeFindMode.Filter?typeof this._defaultFindVisibility=="number"?this._defaultFindVisibility:this._defaultFindVisibility?this._defaultFindVisibility(e):2:{data:FuzzyScore.Default,visibility:s}}reset(){this._totalCount=0,this._matchCount=0}dispose(){dispose(this.disposables)}}class FindToggles{constructor(e){this.stateMap=new Map(e.map(t=>[t.id,{...t}]))}get(e){const t=this.stateMap.get(e);if(t===void 0)throw new Error(`No state found for toggle id ${e}`);return t.isChecked}set(e,t){const s=this.stateMap.get(e);if(s===void 0)throw new Error(`No state found for toggle id ${e}`);return s.isChecked===t?!1:(s.isChecked=t,!0)}}var TreeFindMode;(function(a){a[a.Highlight=0]="Highlight",a[a.Filter=1]="Filter"})(TreeFindMode||(TreeFindMode={}));var TreeFindMatchType;(function(a){a[a.Fuzzy=0]="Fuzzy",a[a.Contiguous=1]="Contiguous"})(TreeFindMatchType||(TreeFindMatchType={}));var DefaultTreeToggles;(function(a){a.Mode="mode",a.MatchType="matchType"})(DefaultTreeToggles||(DefaultTreeToggles={}));class AbstractFindController{get pattern(){return this._pattern}get placeholder(){return this._placeholder}set placeholder(e){var t;this._placeholder=e,(t=this.widget)==null||t.setPlaceHolder(e)}constructor(e,t,s,o={}){this.tree=e,this.filter=t,this.contextViewProvider=s,this.options=o,this._pattern="",this._onDidChangePattern=new Emitter$1,this._onDidChangeOpenState=new Emitter$1,this.onDidChangeOpenState=this._onDidChangeOpenState.event,this.enabledDisposables=new DisposableStore,this.disposables=new DisposableStore,this.toggles=new FindToggles(o.toggles??[]),this._placeholder=o.placeholder??localize(20,"Type to search")}isOpened(){return!!this.widget}updateToggleState(e,t){var s;this.toggles.set(e,t),(s=this.widget)==null||s.setToggleState(e,t)}renderMessage(e,t){var s,o,r;e?this.tree.options.showNotFoundMessage??!0?(s=this.widget)==null||s.showMessage({type:2,content:t??localize(21,"No results found.")}):(o=this.widget)==null||o.showMessage({type:2}):(r=this.widget)==null||r.clearMessage()}alertResults(e){alert$1(e?localize(23,"{0} results",e):localize(22,"No results"))}dispose(){this._history=void 0,this._onDidChangePattern.dispose(),this.enabledDisposables.dispose(),this.disposables.dispose()}}let FindController$1=class extends AbstractFindController{get mode(){return this.toggles.get(DefaultTreeToggles.Mode)?TreeFindMode.Filter:TreeFindMode.Highlight}set mode(e){if(e===this.mode)return;const t=e===TreeFindMode.Filter;this.updateToggleState(DefaultTreeToggles.Mode,t),this.placeholder=t?localize(24,"Type to filter"):localize(25,"Type to search"),this.filter.findMode=e,this.tree.refilter(),this.render(),this._onDidChangeMode.fire(e)}get matchType(){return this.toggles.get(DefaultTreeToggles.MatchType)?TreeFindMatchType.Fuzzy:TreeFindMatchType.Contiguous}set matchType(e){e!==this.matchType&&(this.updateToggleState(DefaultTreeToggles.MatchType,e===TreeFindMatchType.Fuzzy),this.filter.findMatchType=e,this.tree.refilter(),this.render(),this._onDidChangeMatchType.fire(e))}constructor(e,t,s,o={}){const r=o.defaultFindMode??TreeFindMode.Highlight,l=o.defaultFindMatchType??TreeFindMatchType.Fuzzy,c=[{id:DefaultTreeToggles.Mode,icon:Codicon.listFilter,title:localize(26,"Filter"),isChecked:r===TreeFindMode.Filter},{id:DefaultTreeToggles.MatchType,icon:Codicon.searchFuzzy,title:localize(27,"Fuzzy Match"),isChecked:l===TreeFindMatchType.Fuzzy}];t.findMatchType=l,t.findMode=r,super(e,t,s,{...o,toggles:c}),this.filter=t,this._onDidChangeMode=new Emitter$1,this.onDidChangeMode=this._onDidChangeMode.event,this._onDidChangeMatchType=new Emitter$1,this.onDidChangeMatchType=this._onDidChangeMatchType.event,this.disposables.add(this.tree.onDidChangeModel(()=>{this.isOpened()&&(this.pattern.length!==0&&this.tree.refilter(),this.render())})),this.disposables.add(this.tree.onWillRefilter(()=>this.filter.reset()))}updateOptions(e={}){e.defaultFindMode!==void 0&&(this.mode=e.defaultFindMode),e.defaultFindMatchType!==void 0&&(this.matchType=e.defaultFindMatchType)}shouldAllowFocus(e){return!this.isOpened()||!this.pattern||this.filter.totalCount>0&&this.filter.matchCount<=1?!0:!FuzzyScore.isDefault(e.filterData)}render(){const t=this.filter.matchCount===0&&this.filter.totalCount>0&&this.pattern.length>0;this.renderMessage(t),this.pattern.length&&this.alertResults(this.filter.matchCount)}};function stickyScrollNodeStateEquals(a,e){return a.position===e.position&&stickyScrollNodeEquals(a,e)}function stickyScrollNodeEquals(a,e){return a.node.element===e.node.element&&a.startIndex===e.startIndex&&a.height===e.height&&a.endIndex===e.endIndex}class StickyScrollState{constructor(e=[]){this.stickyNodes=e}get count(){return this.stickyNodes.length}equal(e){return equals$1(this.stickyNodes,e.stickyNodes,stickyScrollNodeStateEquals)}contains(e){return this.stickyNodes.some(t=>t.node.element===e.element)}lastNodePartiallyVisible(){if(this.count===0)return!1;const e=this.stickyNodes[this.count-1];if(this.count===1)return e.position!==0;const t=this.stickyNodes[this.count-2];return t.position+t.height!==e.position}animationStateChanged(e){if(!equals$1(this.stickyNodes,e.stickyNodes,stickyScrollNodeEquals)||this.count===0)return!1;const t=this.stickyNodes[this.count-1],s=e.stickyNodes[e.count-1];return t.position!==s.position}}class DefaultStickyScrollDelegate{constrainStickyScrollNodes(e,t,s){for(let o=0;o<e.length;o++){const r=e[o];if(r.position+r.height>s||o>=t)return e.slice(0,o)}return e}}let StickyScrollController$1=class extends Disposable{constructor(e,t,s,o,r,l={}){super(),this.tree=e,this.model=t,this.view=s,this.treeDelegate=r,this.maxWidgetViewRatio=.4;const c=this.validateStickySettings(l);this.stickyScrollMaxItemCount=c.stickyScrollMaxItemCount,this.stickyScrollDelegate=l.stickyScrollDelegate??new DefaultStickyScrollDelegate,this.paddingTop=l.paddingTop??0,this._widget=this._register(new StickyScrollWidget$1(s.getScrollableElement(),s,e,o,r,l.accessibilityProvider)),this.onDidChangeHasFocus=this._widget.onDidChangeHasFocus,this.onContextMenu=this._widget.onContextMenu,this._register(s.onDidScroll(()=>this.update())),this._register(s.onDidChangeContentHeight(()=>this.update())),this._register(e.onDidChangeCollapseState(()=>this.update())),this._register(t.onDidSpliceRenderedNodes(d=>{const u=this._widget.state;if(!u)return;if(d.deleteCount>0&&u.stickyNodes.some(p=>!this.model.has(this.model.getNodeLocation(p.node)))){this.update();return}u.stickyNodes.some(p=>{const m=this.model.getListIndex(this.model.getNodeLocation(p.node));return m>=d.start&&m<d.start+d.deleteCount&&u.contains(p.node)})&&this._widget.rerender()})),this.update()}get height(){return this._widget.height}getNodeAtHeight(e){let t;if(e===0?t=this.view.firstVisibleIndex:t=this.view.indexAt(e+this.view.scrollTop),!(t<0||t>=this.view.length))return this.view.element(t)}update(){const e=this.getNodeAtHeight(this.paddingTop);if(!e||this.tree.scrollTop<=this.paddingTop){this._widget.setState(void 0);return}const t=this.findStickyState(e);this._widget.setState(t)}findStickyState(e){const t=[];let s=e,o=0,r=this.getNextStickyNode(s,void 0,o);for(;r&&(t.push(r),o+=r.height,!(t.length<=this.stickyScrollMaxItemCount&&(s=this.getNextVisibleNode(r),!s)));)r=this.getNextStickyNode(s,r.node,o);const l=this.constrainStickyNodes(t);return l.length?new StickyScrollState(l):void 0}getNextVisibleNode(e){return this.getNodeAtHeight(e.position+e.height)}getNextStickyNode(e,t,s){const o=this.getAncestorUnderPrevious(e,t);if(o&&!(o===e&&(!this.nodeIsUncollapsedParent(e)||this.nodeTopAlignsWithStickyNodesBottom(e,s))))return this.createStickyScrollNode(o,s)}nodeTopAlignsWithStickyNodesBottom(e,t){const s=this.getNodeIndex(e),o=this.view.getElementTop(s),r=t;return this.view.scrollTop===o-r}createStickyScrollNode(e,t){const s=this.treeDelegate.getHeight(e),{startIndex:o,endIndex:r}=this.getNodeRange(e),l=this.calculateStickyNodePosition(r,t,s);return{node:e,position:l,height:s,startIndex:o,endIndex:r}}getAncestorUnderPrevious(e,t=void 0){let s=e,o=this.getParentNode(s);for(;o;){if(o===t)return s;s=o,o=this.getParentNode(s)}if(t===void 0)return s}calculateStickyNodePosition(e,t,s){let o=this.view.getRelativeTop(e);if(o===null&&this.view.firstVisibleIndex===e&&e+1<this.view.length){const u=this.treeDelegate.getHeight(this.view.element(e)),g=this.view.getRelativeTop(e+1);o=g?g-u/this.view.renderHeight:null}if(o===null)return t;const r=this.view.element(e),l=this.treeDelegate.getHeight(r),d=o*this.view.renderHeight+l;return t+s>d&&t<=d?d-s:t}constrainStickyNodes(e){if(e.length===0)return[];const t=this.view.renderHeight*this.maxWidgetViewRatio,s=e[e.length-1];if(e.length<=this.stickyScrollMaxItemCount&&s.position+s.height<=t)return e;const o=this.stickyScrollDelegate.constrainStickyScrollNodes(e,this.stickyScrollMaxItemCount,t);if(!o.length)return[];const r=o[o.length-1];if(o.length>this.stickyScrollMaxItemCount||r.position+r.height>t)throw new Error("stickyScrollDelegate violates constraints");return o}getParentNode(e){const t=this.model.getNodeLocation(e),s=this.model.getParentNodeLocation(t);return s?this.model.getNode(s):void 0}nodeIsUncollapsedParent(e){const t=this.model.getNodeLocation(e);return this.model.getListRenderCount(t)>1}getNodeIndex(e){const t=this.model.getNodeLocation(e);return this.model.getListIndex(t)}getNodeRange(e){const t=this.model.getNodeLocation(e),s=this.model.getListIndex(t);if(s<0)throw new Error("Node not found in tree");const o=this.model.getListRenderCount(t),r=s+o-1;return{startIndex:s,endIndex:r}}nodePositionTopBelowWidget(e){const t=[];let s=this.getParentNode(e);for(;s;)t.push(s),s=this.getParentNode(s);let o=0;for(let r=0;r<t.length&&r<this.stickyScrollMaxItemCount;r++)o+=this.treeDelegate.getHeight(t[r]);return o}domFocus(){this._widget.domFocus()}focusedLast(){return this._widget.focusedLast()}updateOptions(e={}){if(e.paddingTop!==void 0&&(this.paddingTop=e.paddingTop),e.stickyScrollMaxItemCount!==void 0){const t=this.validateStickySettings(e);this.stickyScrollMaxItemCount!==t.stickyScrollMaxItemCount&&(this.stickyScrollMaxItemCount=t.stickyScrollMaxItemCount,this.update())}}validateStickySettings(e){let t=7;return typeof e.stickyScrollMaxItemCount=="number"&&(t=Math.max(e.stickyScrollMaxItemCount,1)),{stickyScrollMaxItemCount:t}}},StickyScrollWidget$1=class{get state(){return this._previousState}constructor(e,t,s,o,r,l){this.view=t,this.tree=s,this.treeRenderers=o,this.treeDelegate=r,this.accessibilityProvider=l,this._previousElements=[],this._previousStateDisposables=new DisposableStore,this._rootDomNode=$$l(".monaco-tree-sticky-container.empty"),e.appendChild(this._rootDomNode);const c=$$l(".monaco-tree-sticky-container-shadow");this._rootDomNode.appendChild(c),this.stickyScrollFocus=new StickyScrollFocus(this._rootDomNode,t),this.onDidChangeHasFocus=this.stickyScrollFocus.onDidChangeHasFocus,this.onContextMenu=this.stickyScrollFocus.onContextMenu}get height(){if(!this._previousState)return 0;const e=this._previousState.stickyNodes[this._previousState.count-1];return e.position+e.height}setState(e){const t=!!this._previousState&&this._previousState.count>0,s=!!e&&e.count>0;if(!t&&!s||t&&s&&this._previousState.equal(e))return;if(t!==s&&this.setVisible(s),!s){this._previousState=void 0,this._previousElements=[],this._previousStateDisposables.clear();return}const o=e.stickyNodes[e.count-1];this._previousState&&e.animationStateChanged(this._previousState)?this._previousElements[this._previousState.count-1].style.top=`${o.position}px`:this.renderState(e),this._previousState=e,this._rootDomNode.style.height=`${o.position+o.height}px`}renderState(e){this._previousStateDisposables.clear();const t=Array(e.count);for(let s=e.count-1;s>=0;s--){const o=e.stickyNodes[s],{element:r,disposable:l}=this.createElement(o,s,e.count);t[s]=r,this._rootDomNode.appendChild(r),this._previousStateDisposables.add(l)}this.stickyScrollFocus.updateElements(t,e),this._previousElements=t}rerender(){this._previousState&&this.renderState(this._previousState)}createElement(e,t,s){const o=e.startIndex,r=document.createElement("div");r.style.top=`${e.position}px`,this.tree.options.setRowHeight!==!1&&(r.style.height=`${e.height}px`),this.tree.options.setRowLineHeight!==!1&&(r.style.lineHeight=`${e.height}px`),r.classList.add("monaco-tree-sticky-row"),r.classList.add("monaco-list-row"),r.setAttribute("data-index",`${o}`),r.setAttribute("data-parity",o%2===0?"even":"odd"),r.setAttribute("id",this.view.getElementID(o));const l=this.setAccessibilityAttributes(r,e.node.element,t,s),c=this.treeDelegate.getTemplateId(e.node),d=this.treeRenderers.find(p=>p.templateId===c);if(!d)throw new Error(`No renderer found for template id ${c}`);let u=e.node;u===this.tree.getNode(this.tree.getNodeLocation(e.node))&&(u=new Proxy(e.node,{}));const g=d.renderTemplate(r);d.renderElement(u,e.startIndex,g,{height:e.height});const f=toDisposable(()=>{l.dispose(),d.disposeElement(u,e.startIndex,g,{height:e.height}),d.disposeTemplate(g),r.remove()});return{element:r,disposable:f}}setAccessibilityAttributes(e,t,s,o){if(!this.accessibilityProvider)return Disposable.None;this.accessibilityProvider.getSetSize&&e.setAttribute("aria-setsize",String(this.accessibilityProvider.getSetSize(t,s,o))),this.accessibilityProvider.getPosInSet&&e.setAttribute("aria-posinset",String(this.accessibilityProvider.getPosInSet(t,s))),this.accessibilityProvider.getRole&&e.setAttribute("role",this.accessibilityProvider.getRole(t)??"treeitem");const r=this.accessibilityProvider.getAriaLabel(t),l=r&&typeof r!="string"?r:constObservable(r),c=autorun(u=>{const g=u.readObservable(l);g?e.setAttribute("aria-label",g):e.removeAttribute("aria-label")});typeof r=="string"||r&&e.setAttribute("aria-label",r.get());const d=this.accessibilityProvider.getAriaLevel&&this.accessibilityProvider.getAriaLevel(t);return typeof d=="number"&&e.setAttribute("aria-level",`${d}`),e.setAttribute("aria-selected",String(!1)),c}setVisible(e){this._rootDomNode.classList.toggle("empty",!e),e||this.stickyScrollFocus.updateElements([],void 0)}domFocus(){this.stickyScrollFocus.domFocus()}focusedLast(){return this.stickyScrollFocus.focusedLast()}dispose(){this.stickyScrollFocus.dispose(),this._previousStateDisposables.dispose(),this._rootDomNode.remove()}};class StickyScrollFocus extends Disposable{get domHasFocus(){return this._domHasFocus}set domHasFocus(e){e!==this._domHasFocus&&(this._onDidChangeHasFocus.fire(e),this._domHasFocus=e)}constructor(e,t){super(),this.container=e,this.view=t,this.focusedIndex=-1,this.elements=[],this._onDidChangeHasFocus=new Emitter$1,this.onDidChangeHasFocus=this._onDidChangeHasFocus.event,this._onContextMenu=new Emitter$1,this.onContextMenu=this._onContextMenu.event,this._domHasFocus=!1,this._register(addDisposableListener(this.container,"focus",()=>this.onFocus())),this._register(addDisposableListener(this.container,"blur",()=>this.onBlur())),this._register(this.view.onDidFocus(()=>this.toggleStickyScrollFocused(!1))),this._register(this.view.onKeyDown(s=>this.onKeyDown(s))),this._register(this.view.onMouseDown(s=>this.onMouseDown(s))),this._register(this.view.onContextMenu(s=>this.handleContextMenu(s)))}handleContextMenu(e){const t=e.browserEvent.target;if(!isStickyScrollContainer(t)&&!isStickyScrollElement(t)){this.focusedLast()&&this.view.domFocus();return}if(!isKeyboardEvent(e.browserEvent)){if(!this.state)throw new Error("Context menu should not be triggered when state is undefined");const l=this.state.stickyNodes.findIndex(c=>{var d;return c.node.element===((d=e.element)==null?void 0:d.element)});if(l===-1)throw new Error("Context menu should not be triggered when element is not in sticky scroll widget");this.container.focus(),this.setFocus(l);return}if(!this.state||this.focusedIndex<0)throw new Error("Context menu key should not be triggered when focus is not in sticky scroll widget");const o=this.state.stickyNodes[this.focusedIndex].node.element,r=this.elements[this.focusedIndex];this._onContextMenu.fire({element:o,anchor:r,browserEvent:e.browserEvent,isStickyScroll:!0})}onKeyDown(e){if(this.domHasFocus&&this.state){if(e.key==="ArrowUp")this.setFocusedElement(Math.max(0,this.focusedIndex-1)),e.preventDefault(),e.stopPropagation();else if(e.key==="ArrowDown"||e.key==="ArrowRight"){if(this.focusedIndex>=this.state.count-1){const t=this.state.stickyNodes[this.state.count-1].startIndex+1;this.view.domFocus(),this.view.setFocus([t]),this.scrollNodeUnderWidget(t,this.state)}else this.setFocusedElement(this.focusedIndex+1);e.preventDefault(),e.stopPropagation()}}}onMouseDown(e){const t=e.browserEvent.target;!isStickyScrollContainer(t)&&!isStickyScrollElement(t)||(e.browserEvent.preventDefault(),e.browserEvent.stopPropagation())}updateElements(e,t){if(t&&t.count===0)throw new Error("Sticky scroll state must be undefined when there are no sticky nodes");if(t&&t.count!==e.length)throw new Error("Sticky scroll focus received illigel state");const s=this.focusedIndex;if(this.removeFocus(),this.elements=e,this.state=t,t){const o=clamp(s,0,t.count-1);this.setFocus(o)}else this.domHasFocus&&this.view.domFocus();this.container.tabIndex=t?0:-1}setFocusedElement(e){const t=this.state;if(!t)throw new Error("Cannot set focus when state is undefined");if(this.setFocus(e),!(e<t.count-1)&&t.lastNodePartiallyVisible()){const s=t.stickyNodes[e];this.scrollNodeUnderWidget(s.endIndex+1,t)}}scrollNodeUnderWidget(e,t){const s=t.stickyNodes[t.count-1],o=t.count>1?t.stickyNodes[t.count-2]:void 0,r=this.view.getElementTop(e),l=o?o.position+o.height+s.height:s.height;this.view.scrollTop=r-l}domFocus(){if(!this.state)throw new Error("Cannot focus when state is undefined");this.container.focus()}focusedLast(){return this.state?this.view.getHTMLElement().classList.contains("sticky-scroll-focused"):!1}removeFocus(){this.focusedIndex!==-1&&(this.toggleElementFocus(this.elements[this.focusedIndex],!1),this.focusedIndex=-1)}setFocus(e){if(0>e)throw new Error("addFocus() can not remove focus");if(!this.state&&e>=0)throw new Error("Cannot set focus index when state is undefined");if(this.state&&e>=this.state.count)throw new Error("Cannot set focus index to an index that does not exist");const t=this.focusedIndex;t>=0&&this.toggleElementFocus(this.elements[t],!1),e>=0&&this.toggleElementFocus(this.elements[e],!0),this.focusedIndex=e}toggleElementFocus(e,t){this.toggleElementActiveFocus(e,t&&this.domHasFocus),this.toggleElementPassiveFocus(e,t)}toggleCurrentElementActiveFocus(e){this.focusedIndex!==-1&&this.toggleElementActiveFocus(this.elements[this.focusedIndex],e)}toggleElementActiveFocus(e,t){e.classList.toggle("focused",t)}toggleElementPassiveFocus(e,t){e.classList.toggle("passive-focused",t)}toggleStickyScrollFocused(e){this.view.getHTMLElement().classList.toggle("sticky-scroll-focused",e)}onFocus(){if(!this.state||this.elements.length===0)throw new Error("Cannot focus when state is undefined or elements are empty");this.domHasFocus=!0,this.toggleStickyScrollFocused(!0),this.toggleCurrentElementActiveFocus(!0),this.focusedIndex===-1&&this.setFocus(0)}onBlur(){this.domHasFocus=!1,this.toggleCurrentElementActiveFocus(!1)}dispose(){this.toggleStickyScrollFocused(!1),this._onDidChangeHasFocus.fire(!1),super.dispose()}}function asTreeMouseEvent$1(a){let e=TreeMouseEventTarget.Unknown;return hasParentWithClass(a.browserEvent.target,"monaco-tl-twistie","monaco-tl-row")?e=TreeMouseEventTarget.Twistie:hasParentWithClass(a.browserEvent.target,"monaco-tl-contents","monaco-tl-row")?e=TreeMouseEventTarget.Element:hasParentWithClass(a.browserEvent.target,"monaco-tree-type-filter","monaco-list")&&(e=TreeMouseEventTarget.Filter),{browserEvent:a.browserEvent,element:a.element?a.element.element:null,target:e}}function asTreeContextMenuEvent(a){const e=isStickyScrollContainer(a.browserEvent.target);return{element:a.element?a.element.element:null,browserEvent:a.browserEvent,anchor:a.anchor,isStickyScroll:e}}function dfs$1(a,e){e(a),a.children.forEach(t=>dfs$1(t,e))}class Trait{get nodeSet(){return this._nodeSet||(this._nodeSet=this.createNodeSet()),this._nodeSet}constructor(e,t){this.getFirstViewElementWithTrait=e,this.identityProvider=t,this.nodes=[],this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event}set(e,t){!(t!=null&&t.__forceEvent)&&equals$1(this.nodes,e)||this._set(e,!1,t)}_set(e,t,s){if(this.nodes=[...e],this.elements=void 0,this._nodeSet=void 0,!t){const o=this;this._onDidChange.fire({get elements(){return o.get()},browserEvent:s})}}get(){return this.elements||(this.elements=this.nodes.map(e=>e.element)),[...this.elements]}getNodes(){return this.nodes}has(e){return this.nodeSet.has(e)}onDidModelSplice({insertedNodes:e,deletedNodes:t}){if(!this.identityProvider){const d=this.createNodeSet(),u=g=>d.delete(g);t.forEach(g=>dfs$1(g,u)),this.set([...d.values()]);return}const s=new Set,o=d=>s.add(this.identityProvider.getId(d.element).toString());t.forEach(d=>dfs$1(d,o));const r=new Map,l=d=>r.set(this.identityProvider.getId(d.element).toString(),d);e.forEach(d=>dfs$1(d,l));const c=[];for(const d of this.nodes){const u=this.identityProvider.getId(d.element).toString();if(!s.has(u))c.push(d);else{const f=r.get(u);f&&f.visible&&c.push(f)}}if(this.nodes.length>0&&c.length===0){const d=this.getFirstViewElementWithTrait();d&&c.push(d)}this._set(c,!0)}createNodeSet(){const e=new Set;for(const t of this.nodes)e.add(t);return e}}class TreeNodeListMouseController extends MouseController{constructor(e,t,s){super(e),this.tree=t,this.stickyScrollProvider=s}onViewPointer(e){if(isButton(e.browserEvent.target)||isEditableElement(e.browserEvent.target)||isMonacoEditor(e.browserEvent.target)||e.browserEvent.isHandledByList)return;const t=e.element;if(!t)return super.onViewPointer(e);if(this.isSelectionRangeChangeEvent(e)||this.isSelectionSingleChangeEvent(e))return super.onViewPointer(e);const s=e.browserEvent.target,o=s.classList.contains("monaco-tl-twistie")||s.classList.contains("monaco-icon-label")&&s.classList.contains("folder-icon")&&e.browserEvent.offsetX<16,r=isStickyScrollElement(e.browserEvent.target);let l=!1;if(r?l=!0:typeof this.tree.expandOnlyOnTwistieClick=="function"?l=this.tree.expandOnlyOnTwistieClick(t.element):l=!!this.tree.expandOnlyOnTwistieClick,r)this.handleStickyScrollMouseEvent(e,t);else{if(l&&!o&&e.browserEvent.detail!==2)return super.onViewPointer(e);if(!this.tree.expandOnDoubleClick&&e.browserEvent.detail===2)return super.onViewPointer(e)}if(t.collapsible&&(!r||o)){const c=this.tree.getNodeLocation(t),d=e.browserEvent.altKey;if(this.tree.setFocus([c]),this.tree.toggleCollapsed(c,d),o){e.browserEvent.isHandledByList=!0;return}}r||super.onViewPointer(e)}handleStickyScrollMouseEvent(e,t){if(isMonacoCustomToggle(e.browserEvent.target)||isActionItem(e.browserEvent.target))return;const s=this.stickyScrollProvider();if(!s)throw new Error("Sticky scroll controller not found");const o=this.list.indexOf(t),r=this.list.getElementTop(o),l=s.nodePositionTopBelowWidget(t);this.tree.scrollTop=r-l,this.list.domFocus(),this.list.setFocus([o]),this.list.setSelection([o])}onDoubleClick(e){e.browserEvent.target.classList.contains("monaco-tl-twistie")||!this.tree.expandOnDoubleClick||e.browserEvent.isHandledByList||super.onDoubleClick(e)}onMouseDown(e){const t=e.browserEvent.target;if(!isStickyScrollContainer(t)&&!isStickyScrollElement(t)){super.onMouseDown(e);return}}onContextMenu(e){const t=e.browserEvent.target;if(!isStickyScrollContainer(t)&&!isStickyScrollElement(t)){super.onContextMenu(e);return}}}class TreeNodeList extends List{constructor(e,t,s,o,r,l,c,d){super(e,t,s,o,d),this.focusTrait=r,this.selectionTrait=l,this.anchorTrait=c}createMouseController(e){return new TreeNodeListMouseController(this,e.tree,e.stickyScrollProvider)}splice(e,t,s=[]){if(super.splice(e,t,s),s.length===0)return;const o=[],r=[];let l;s.forEach((c,d)=>{this.focusTrait.has(c)&&o.push(e+d),this.selectionTrait.has(c)&&r.push(e+d),this.anchorTrait.has(c)&&(l=e+d)}),o.length>0&&super.setFocus(distinct([...super.getFocus(),...o])),r.length>0&&super.setSelection(distinct([...super.getSelection(),...r])),typeof l=="number"&&super.setAnchor(l)}setFocus(e,t,s=!1){super.setFocus(e,t),s||this.focusTrait.set(e.map(o=>this.element(o)),t)}setSelection(e,t,s=!1){super.setSelection(e,t),s||this.selectionTrait.set(e.map(o=>this.element(o)),t)}setAnchor(e,t=!1){super.setAnchor(e),t||(typeof e>"u"?this.anchorTrait.set([]):this.anchorTrait.set([this.element(e)]))}}class AbstractTree{get onDidScroll(){return this.view.onDidScroll}get onDidChangeFocus(){return this.eventBufferer.wrapEvent(this.focus.onDidChange)}get onDidChangeSelection(){return this.eventBufferer.wrapEvent(this.selection.onDidChange)}get onMouseDblClick(){return Event$1.filter(Event$1.map(this.view.onMouseDblClick,asTreeMouseEvent$1),e=>e.target!==TreeMouseEventTarget.Filter)}get onMouseOver(){return Event$1.map(this.view.onMouseOver,asTreeMouseEvent$1)}get onMouseOut(){return Event$1.map(this.view.onMouseOut,asTreeMouseEvent$1)}get onContextMenu(){var e;return Event$1.any(Event$1.filter(Event$1.map(this.view.onContextMenu,asTreeContextMenuEvent),t=>!t.isStickyScroll),((e=this.stickyScrollController)==null?void 0:e.onContextMenu)??Event$1.None)}get onPointer(){return Event$1.map(this.view.onPointer,asTreeMouseEvent$1)}get onKeyDown(){return this.view.onKeyDown}get onDidFocus(){return this.view.onDidFocus}get onDidChangeModel(){return Event$1.any(this.onDidChangeModelRelay.event,this.onDidSwapModel.event)}get onDidChangeCollapseState(){return this.onDidChangeCollapseStateRelay.event}get expandOnDoubleClick(){return typeof this._options.expandOnDoubleClick>"u"?!0:this._options.expandOnDoubleClick}get expandOnlyOnTwistieClick(){return typeof this._options.expandOnlyOnTwistieClick>"u"?!0:this._options.expandOnlyOnTwistieClick}get onDidDispose(){return this.view.onDidDispose}constructor(e,t,s,o,r={}){this._user=e,this._options=r,this.eventBufferer=new EventBufferer,this.onDidChangeFindOpenState=Event$1.None,this.onDidChangeStickyScrollFocused=Event$1.None,this.disposables=new DisposableStore,this.onDidSwapModel=this.disposables.add(new Emitter$1),this.onDidChangeModelRelay=this.disposables.add(new Relay),this.onDidSpliceModelRelay=this.disposables.add(new Relay),this.onDidChangeCollapseStateRelay=this.disposables.add(new Relay),this.onDidChangeRenderNodeCountRelay=this.disposables.add(new Relay),this.onDidChangeActiveNodesRelay=this.disposables.add(new Relay),this._onWillRefilter=new Emitter$1,this.onWillRefilter=this._onWillRefilter.event,this._onDidUpdateOptions=new Emitter$1,this.modelDisposables=new DisposableStore,r.keyboardNavigationLabelProvider&&(r.findWidgetEnabled??!0)&&(this.findFilter=new FindFilter(r.keyboardNavigationLabelProvider,r.filter,r.defaultFindVisibility),r={...r,filter:this.findFilter},this.disposables.add(this.findFilter)),this.model=this.createModel(e,r),this.treeDelegate=new ComposedTreeDelegate(s);const l=this.disposables.add(new EventCollection(this.onDidChangeActiveNodesRelay.event)),c=new SetMap;this.renderers=o.map(d=>new TreeRenderer(d,this.model,this.onDidChangeCollapseStateRelay.event,l,c,r));for(const d of this.renderers)this.disposables.add(d);if(this.focus=new Trait(()=>this.view.getFocusedElements()[0],r.identityProvider),this.selection=new Trait(()=>this.view.getSelectedElements()[0],r.identityProvider),this.anchor=new Trait(()=>this.view.getAnchorElement(),r.identityProvider),this.view=new TreeNodeList(e,t,this.treeDelegate,this.renderers,this.focus,this.selection,this.anchor,{...asListOptions(()=>this.model,this.disposables,r),tree:this,stickyScrollProvider:()=>this.stickyScrollController}),this.setupModel(this.model),r.keyboardSupport!==!1){const d=Event$1.chain(this.view.onKeyDown,u=>u.filter(g=>!isEditableElement(g.target)).map(g=>new StandardKeyboardEvent(g)));Event$1.chain(d,u=>u.filter(g=>g.keyCode===15))(this.onLeftArrow,this,this.disposables),Event$1.chain(d,u=>u.filter(g=>g.keyCode===17))(this.onRightArrow,this,this.disposables),Event$1.chain(d,u=>u.filter(g=>g.keyCode===10))(this.onSpace,this,this.disposables)}if((r.findWidgetEnabled??!0)&&r.keyboardNavigationLabelProvider&&r.contextViewProvider){const d={styles:r.findWidgetStyles,defaultFindMode:r.defaultFindMode,defaultFindMatchType:r.defaultFindMatchType,showNotFoundMessage:r.showNotFoundMessage};this.findController=this.disposables.add(new FindController$1(this,this.findFilter,r.contextViewProvider,d)),this.focusNavigationFilter=u=>this.findController.shouldAllowFocus(u),this.onDidChangeFindOpenState=this.findController.onDidChangeOpenState,this.onDidChangeFindMode=this.findController.onDidChangeMode,this.onDidChangeFindMatchType=this.findController.onDidChangeMatchType}else this.onDidChangeFindMode=Event$1.None,this.onDidChangeFindMatchType=Event$1.None;r.enableStickyScroll&&(this.stickyScrollController=new StickyScrollController$1(this,this.model,this.view,this.renderers,this.treeDelegate,r),this.onDidChangeStickyScrollFocused=this.stickyScrollController.onDidChangeHasFocus),this.styleElement=createStyleSheet(this.view.getHTMLElement()),this.getHTMLElement().classList.toggle("always",this._options.renderIndentGuides===RenderIndentGuides.Always)}updateOptions(e={}){var t;this._options={...this._options,...e};for(const s of this.renderers)s.updateOptions(e);this.view.updateOptions(this._options),(t=this.findController)==null||t.updateOptions(e),this.updateStickyScroll(e),this._onDidUpdateOptions.fire(this._options),this.getHTMLElement().classList.toggle("always",this._options.renderIndentGuides===RenderIndentGuides.Always)}get options(){return this._options}updateStickyScroll(e){var t;!this.stickyScrollController&&this._options.enableStickyScroll?(this.stickyScrollController=new StickyScrollController$1(this,this.model,this.view,this.renderers,this.treeDelegate,this._options),this.onDidChangeStickyScrollFocused=this.stickyScrollController.onDidChangeHasFocus):this.stickyScrollController&&!this._options.enableStickyScroll&&(this.onDidChangeStickyScrollFocused=Event$1.None,this.stickyScrollController.dispose(),this.stickyScrollController=void 0),(t=this.stickyScrollController)==null||t.updateOptions(e)}getHTMLElement(){return this.view.getHTMLElement()}get onDidChangeContentHeight(){return this.view.onDidChangeContentHeight}get scrollTop(){return this.view.scrollTop}set scrollTop(e){this.view.scrollTop=e}get scrollHeight(){return this.view.scrollHeight}get renderHeight(){return this.view.renderHeight}get ariaLabel(){return this.view.ariaLabel}set ariaLabel(e){this.view.ariaLabel=e}domFocus(){var e;(e=this.stickyScrollController)!=null&&e.focusedLast()?this.stickyScrollController.domFocus():this.view.domFocus()}layout(e,t){this.view.layout(e,t)}style(e){const t=`.${this.view.domId}`,s=[];e.treeIndentGuidesStroke&&(s.push(`.monaco-list${t}:hover .monaco-tl-indent > .indent-guide, .monaco-list${t}.always .monaco-tl-indent > .indent-guide  { opacity: 1; border-color: ${e.treeInactiveIndentGuidesStroke}; }`),s.push(`.monaco-list${t} .monaco-tl-indent > .indent-guide.active { opacity: 1; border-color: ${e.treeIndentGuidesStroke}; }`));const o=e.treeStickyScrollBackground??e.listBackground;o&&(s.push(`.monaco-list${t} .monaco-scrollable-element .monaco-tree-sticky-container { background-color: ${o}; }`),s.push(`.monaco-list${t} .monaco-scrollable-element .monaco-tree-sticky-container .monaco-tree-sticky-row { background-color: ${o}; }`)),e.treeStickyScrollBorder&&s.push(`.monaco-list${t} .monaco-scrollable-element .monaco-tree-sticky-container { border-bottom: 1px solid ${e.treeStickyScrollBorder}; }`),e.treeStickyScrollShadow&&s.push(`.monaco-list${t} .monaco-scrollable-element .monaco-tree-sticky-container .monaco-tree-sticky-container-shadow { box-shadow: ${e.treeStickyScrollShadow} 0 6px 6px -6px inset; height: 3px; }`),e.listFocusForeground&&(s.push(`.monaco-list${t}.sticky-scroll-focused .monaco-scrollable-element .monaco-tree-sticky-container:focus .monaco-list-row.focused { color: ${e.listFocusForeground}; }`),s.push(`.monaco-list${t}:not(.sticky-scroll-focused) .monaco-scrollable-element .monaco-tree-sticky-container .monaco-list-row.focused { color: inherit; }`));const r=asCssValueWithDefault(e.listFocusAndSelectionOutline,asCssValueWithDefault(e.listSelectionOutline,e.listFocusOutline??""));r&&(s.push(`.monaco-list${t}.sticky-scroll-focused .monaco-scrollable-element .monaco-tree-sticky-container:focus .monaco-list-row.focused.selected { outline: 1px solid ${r}; outline-offset: -1px;}`),s.push(`.monaco-list${t}:not(.sticky-scroll-focused) .monaco-scrollable-element .monaco-tree-sticky-container .monaco-list-row.focused.selected { outline: inherit;}`)),e.listFocusOutline&&(s.push(`.monaco-list${t}.sticky-scroll-focused .monaco-scrollable-element .monaco-tree-sticky-container:focus .monaco-list-row.focused { outline: 1px solid ${e.listFocusOutline}; outline-offset: -1px; }`),s.push(`.monaco-list${t}:not(.sticky-scroll-focused) .monaco-scrollable-element .monaco-tree-sticky-container .monaco-list-row.focused { outline: inherit; }`),s.push(`.monaco-workbench.context-menu-visible .monaco-list${t}.last-focused.sticky-scroll-focused .monaco-scrollable-element .monaco-tree-sticky-container .monaco-list-row.passive-focused { outline: 1px solid ${e.listFocusOutline}; outline-offset: -1px; }`),s.push(`.monaco-workbench.context-menu-visible .monaco-list${t}.last-focused.sticky-scroll-focused .monaco-list-rows .monaco-list-row.focused { outline: inherit; }`),s.push(`.monaco-workbench.context-menu-visible .monaco-list${t}.last-focused:not(.sticky-scroll-focused) .monaco-tree-sticky-container .monaco-list-rows .monaco-list-row.focused { outline: inherit; }`)),this.styleElement.textContent=s.join(`
`),this.view.style(e)}getParentElement(e){const t=this.model.getParentNodeLocation(e);return this.model.getNode(t).element}getFirstElementChild(e){return this.model.getFirstElementChild(e)}getNode(e){return this.model.getNode(e)}getNodeLocation(e){return this.model.getNodeLocation(e)}collapse(e,t=!1){return this.model.setCollapsed(e,!0,t)}expand(e,t=!1){return this.model.setCollapsed(e,!1,t)}toggleCollapsed(e,t=!1){return this.model.setCollapsed(e,void 0,t)}isCollapsible(e){return this.model.isCollapsible(e)}setCollapsible(e,t){return this.model.setCollapsible(e,t)}isCollapsed(e){return this.model.isCollapsed(e)}refilter(){this._onWillRefilter.fire(void 0),this.model.refilter()}setSelection(e,t){this.eventBufferer.bufferEvents(()=>{const s=e.map(r=>this.model.getNode(r));this.selection.set(s,t);const o=e.map(r=>this.model.getListIndex(r)).filter(r=>r>-1);this.view.setSelection(o,t,!0)})}getSelection(){return this.selection.get()}setFocus(e,t){this.eventBufferer.bufferEvents(()=>{const s=e.map(r=>this.model.getNode(r));this.focus.set(s,t);const o=e.map(r=>this.model.getListIndex(r)).filter(r=>r>-1);this.view.setFocus(o,t,!0)})}focusNext(e=1,t=!1,s,o=isKeyboardEvent(s)&&s.altKey?void 0:this.focusNavigationFilter){this.view.focusNext(e,t,s,o)}focusPrevious(e=1,t=!1,s,o=isKeyboardEvent(s)&&s.altKey?void 0:this.focusNavigationFilter){this.view.focusPrevious(e,t,s,o)}focusNextPage(e,t=isKeyboardEvent(e)&&e.altKey?void 0:this.focusNavigationFilter){return this.view.focusNextPage(e,t)}focusPreviousPage(e,t=isKeyboardEvent(e)&&e.altKey?void 0:this.focusNavigationFilter){return this.view.focusPreviousPage(e,t,()=>{var s;return((s=this.stickyScrollController)==null?void 0:s.height)??0})}focusLast(e,t=isKeyboardEvent(e)&&e.altKey?void 0:this.focusNavigationFilter){this.view.focusLast(e,t)}focusFirst(e,t=isKeyboardEvent(e)&&e.altKey?void 0:this.focusNavigationFilter){this.view.focusFirst(e,t)}getFocus(){return this.focus.get()}reveal(e,t){this.model.expandTo(e);const s=this.model.getListIndex(e);if(s!==-1)if(!this.stickyScrollController)this.view.reveal(s,t);else{const o=this.stickyScrollController.nodePositionTopBelowWidget(this.getNode(e));this.view.reveal(s,t,o)}}onLeftArrow(e){e.preventDefault(),e.stopPropagation();const t=this.view.getFocusedElements();if(t.length===0)return;const s=t[0],o=this.model.getNodeLocation(s);if(!this.model.setCollapsed(o,!0)){const l=this.model.getParentNodeLocation(o);if(!l)return;const c=this.model.getListIndex(l);this.view.reveal(c),this.view.setFocus([c])}}onRightArrow(e){e.preventDefault(),e.stopPropagation();const t=this.view.getFocusedElements();if(t.length===0)return;const s=t[0],o=this.model.getNodeLocation(s);if(!this.model.setCollapsed(o,!1)){if(!s.children.some(d=>d.visible))return;const[l]=this.view.getFocus(),c=l+1;this.view.reveal(c),this.view.setFocus([c])}}onSpace(e){e.preventDefault(),e.stopPropagation();const t=this.view.getFocusedElements();if(t.length===0)return;const s=t[0],o=this.model.getNodeLocation(s),r=e.browserEvent.altKey;this.model.setCollapsed(o,void 0,r)}setupModel(e){this.modelDisposables.clear(),this.modelDisposables.add(e.onDidSpliceRenderedNodes(({start:r,deleteCount:l,elements:c})=>this.view.splice(r,l,c)));const t=Event$1.forEach(e.onDidSpliceModel,r=>{this.eventBufferer.bufferEvents(()=>{this.focus.onDidModelSplice(r),this.selection.onDidModelSplice(r)})},this.modelDisposables);t(()=>null,null,this.modelDisposables);const s=this.modelDisposables.add(new Emitter$1),o=this.modelDisposables.add(new Delayer(0));this.modelDisposables.add(Event$1.any(t,this.focus.onDidChange,this.selection.onDidChange)(()=>{o.trigger(()=>{const r=new Set;for(const l of this.focus.getNodes())r.add(l);for(const l of this.selection.getNodes())r.add(l);s.fire([...r.values()])})})),this.onDidChangeActiveNodesRelay.input=s.event,this.onDidChangeModelRelay.input=Event$1.signal(e.onDidSpliceModel),this.onDidChangeCollapseStateRelay.input=e.onDidChangeCollapseState,this.onDidChangeRenderNodeCountRelay.input=e.onDidChangeRenderNodeCount,this.onDidSpliceModelRelay.input=e.onDidSpliceModel}dispose(){var e;dispose(this.disposables),(e=this.stickyScrollController)==null||e.dispose(),this.view.dispose(),this.modelDisposables.dispose()}}class ObjectTreeModel{constructor(e,t={}){this.user=e,this.rootRef=null,this.nodes=new Map,this.nodesByIdentity=new Map,this.model=new IndexTreeModel(e,null,t),this.onDidSpliceModel=this.model.onDidSpliceModel,this.onDidSpliceRenderedNodes=this.model.onDidSpliceRenderedNodes,this.onDidChangeCollapseState=this.model.onDidChangeCollapseState,this.onDidChangeRenderNodeCount=this.model.onDidChangeRenderNodeCount,t.sorter&&(this.sorter={compare(s,o){return t.sorter.compare(s.element,o.element)}}),this.identityProvider=t.identityProvider}setChildren(e,t=Iterable.empty(),s={}){const o=this.getElementLocation(e);this._setChildren(o,this.preserveCollapseState(t),s)}_setChildren(e,t=Iterable.empty(),s){const o=new Set,r=new Set,l=d=>{var g;if(d.element===null)return;const u=d;if(o.add(u.element),this.nodes.set(u.element,u),this.identityProvider){const f=this.identityProvider.getId(u.element).toString();r.add(f),this.nodesByIdentity.set(f,u)}(g=s.onDidCreateNode)==null||g.call(s,u)},c=d=>{var g;if(d.element===null)return;const u=d;if(o.has(u.element)||this.nodes.delete(u.element),this.identityProvider){const f=this.identityProvider.getId(u.element).toString();r.has(f)||this.nodesByIdentity.delete(f)}(g=s.onDidDeleteNode)==null||g.call(s,u)};this.model.splice([...e,0],Number.MAX_VALUE,t,{...s,onDidCreateNode:l,onDidDeleteNode:c})}preserveCollapseState(e=Iterable.empty()){return this.sorter&&(e=[...e].sort(this.sorter.compare.bind(this.sorter))),Iterable.map(e,t=>{let s=this.nodes.get(t.element);if(!s&&this.identityProvider){const l=this.identityProvider.getId(t.element).toString();s=this.nodesByIdentity.get(l)}if(!s){let l;return typeof t.collapsed>"u"?l=void 0:t.collapsed===ObjectTreeElementCollapseState.Collapsed||t.collapsed===ObjectTreeElementCollapseState.PreserveOrCollapsed?l=!0:t.collapsed===ObjectTreeElementCollapseState.Expanded||t.collapsed===ObjectTreeElementCollapseState.PreserveOrExpanded?l=!1:l=!!t.collapsed,{...t,children:this.preserveCollapseState(t.children),collapsed:l}}const o=typeof t.collapsible=="boolean"?t.collapsible:s.collapsible;let r;return typeof t.collapsed>"u"||t.collapsed===ObjectTreeElementCollapseState.PreserveOrCollapsed||t.collapsed===ObjectTreeElementCollapseState.PreserveOrExpanded?r=s.collapsed:t.collapsed===ObjectTreeElementCollapseState.Collapsed?r=!0:t.collapsed===ObjectTreeElementCollapseState.Expanded?r=!1:r=!!t.collapsed,{...t,collapsible:o,collapsed:r,children:this.preserveCollapseState(t.children)}})}rerender(e){const t=this.getElementLocation(e);this.model.rerender(t)}getFirstElementChild(e=null){const t=this.getElementLocation(e);return this.model.getFirstElementChild(t)}has(e){return this.nodes.has(e)}getListIndex(e){const t=this.getElementLocation(e);return this.model.getListIndex(t)}getListRenderCount(e){const t=this.getElementLocation(e);return this.model.getListRenderCount(t)}isCollapsible(e){const t=this.getElementLocation(e);return this.model.isCollapsible(t)}setCollapsible(e,t){const s=this.getElementLocation(e);return this.model.setCollapsible(s,t)}isCollapsed(e){const t=this.getElementLocation(e);return this.model.isCollapsed(t)}setCollapsed(e,t,s){const o=this.getElementLocation(e);return this.model.setCollapsed(o,t,s)}expandTo(e){const t=this.getElementLocation(e);this.model.expandTo(t)}refilter(){this.model.refilter()}getNode(e=null){if(e===null)return this.model.getNode(this.model.rootRef);const t=this.nodes.get(e);if(!t)throw new TreeError(this.user,`Tree element not found: ${e}`);return t}getNodeLocation(e){return e.element}getParentNodeLocation(e){if(e===null)throw new TreeError(this.user,"Invalid getParentNodeLocation call");const t=this.nodes.get(e);if(!t)throw new TreeError(this.user,`Tree element not found: ${e}`);const s=this.model.getNodeLocation(t),o=this.model.getParentNodeLocation(s);return this.model.getNode(o).element}getElementLocation(e){if(e===null)return[];const t=this.nodes.get(e);if(!t)throw new TreeError(this.user,`Tree element not found: ${e}`);return this.model.getNodeLocation(t)}}function noCompress(a){const e=[a.element],t=a.incompressible||!1;return{element:{elements:e,incompressible:t},children:Iterable.map(Iterable.from(a.children),noCompress),collapsible:a.collapsible,collapsed:a.collapsed}}function compress(a){const e=[a.element],t=a.incompressible||!1;let s,o;for(;[o,s]=Iterable.consume(Iterable.from(a.children),2),!(o.length!==1||o[0].incompressible);)a=o[0],e.push(a.element);return{element:{elements:e,incompressible:t},children:Iterable.map(Iterable.concat(o,s),compress),collapsible:a.collapsible,collapsed:a.collapsed}}function _decompress(a,e=0){let t;return e<a.element.elements.length-1?t=[_decompress(a,e+1)]:t=Iterable.map(Iterable.from(a.children),s=>_decompress(s,0)),e===0&&a.element.incompressible?{element:a.element.elements[e],children:t,incompressible:!0,collapsible:a.collapsible,collapsed:a.collapsed}:{element:a.element.elements[e],children:t,collapsible:a.collapsible,collapsed:a.collapsed}}function decompress(a){return _decompress(a,0)}function splice(a,e,t){return a.element===e?{...a,children:t}:{...a,children:Iterable.map(Iterable.from(a.children),s=>splice(s,e,t))}}const wrapIdentityProvider=a=>({getId(e){return e.elements.map(t=>a.getId(t).toString()).join("\0")}});class CompressedObjectTreeModel{get onDidSpliceRenderedNodes(){return this.model.onDidSpliceRenderedNodes}get onDidSpliceModel(){return this.model.onDidSpliceModel}get onDidChangeCollapseState(){return this.model.onDidChangeCollapseState}get onDidChangeRenderNodeCount(){return this.model.onDidChangeRenderNodeCount}constructor(e,t={}){this.user=e,this.rootRef=null,this.nodes=new Map,this.model=new ObjectTreeModel(e,t),this.enabled=typeof t.compressionEnabled>"u"?!0:t.compressionEnabled,this.identityProvider=t.identityProvider}setChildren(e,t=Iterable.empty(),s){const o=s.diffIdentityProvider&&wrapIdentityProvider(s.diffIdentityProvider);if(e===null){const _=Iterable.map(t,this.enabled?compress:noCompress);this._setChildren(null,_,{diffIdentityProvider:o,diffDepth:1/0});return}const r=this.nodes.get(e);if(!r)throw new TreeError(this.user,"Unknown compressed tree node");const l=this.model.getNode(r),c=this.model.getParentNodeLocation(r),d=this.model.getNode(c),u=decompress(l),g=splice(u,e,t),f=(this.enabled?compress:noCompress)(g),p=s.diffIdentityProvider?(_,C)=>s.diffIdentityProvider.getId(_)===s.diffIdentityProvider.getId(C):void 0;if(equals$1(f.element.elements,l.element.elements,p)){this._setChildren(r,f.children||Iterable.empty(),{diffIdentityProvider:o,diffDepth:1});return}const m=d.children.map(_=>_===l?f:_);this._setChildren(d.element,m,{diffIdentityProvider:o,diffDepth:l.depth-d.depth})}isCompressionEnabled(){return this.enabled}setCompressionEnabled(e){if(e===this.enabled)return;this.enabled=e;const s=this.model.getNode().children,o=Iterable.map(s,decompress),r=Iterable.map(o,e?compress:noCompress);this._setChildren(null,r,{diffIdentityProvider:this.identityProvider,diffDepth:1/0})}_setChildren(e,t,s){const o=new Set,r=c=>{for(const d of c.element.elements)o.add(d),this.nodes.set(d,c.element)},l=c=>{for(const d of c.element.elements)o.has(d)||this.nodes.delete(d)};this.model.setChildren(e,t,{...s,onDidCreateNode:r,onDidDeleteNode:l})}has(e){return this.nodes.has(e)}getListIndex(e){const t=this.getCompressedNode(e);return this.model.getListIndex(t)}getListRenderCount(e){const t=this.getCompressedNode(e);return this.model.getListRenderCount(t)}getNode(e){if(typeof e>"u")return this.model.getNode();const t=this.getCompressedNode(e);return this.model.getNode(t)}getNodeLocation(e){const t=this.model.getNodeLocation(e);return t===null?null:t.elements[t.elements.length-1]}getParentNodeLocation(e){const t=this.getCompressedNode(e),s=this.model.getParentNodeLocation(t);return s===null?null:s.elements[s.elements.length-1]}getFirstElementChild(e){const t=this.getCompressedNode(e);return this.model.getFirstElementChild(t)}isCollapsible(e){const t=this.getCompressedNode(e);return this.model.isCollapsible(t)}setCollapsible(e,t){const s=this.getCompressedNode(e);return this.model.setCollapsible(s,t)}isCollapsed(e){const t=this.getCompressedNode(e);return this.model.isCollapsed(t)}setCollapsed(e,t,s){const o=this.getCompressedNode(e);return this.model.setCollapsed(o,t,s)}expandTo(e){const t=this.getCompressedNode(e);this.model.expandTo(t)}rerender(e){const t=this.getCompressedNode(e);this.model.rerender(t)}refilter(){this.model.refilter()}getCompressedNode(e){if(e===null)return null;const t=this.nodes.get(e);if(!t)throw new TreeError(this.user,`Tree element not found: ${e}`);return t}}const DefaultElementMapper=a=>a[a.length-1];class CompressedTreeNodeWrapper{get element(){return this.node.element===null?null:this.unwrapper(this.node.element)}get children(){return this.node.children.map(e=>new CompressedTreeNodeWrapper(this.unwrapper,e))}get depth(){return this.node.depth}get visibleChildrenCount(){return this.node.visibleChildrenCount}get visibleChildIndex(){return this.node.visibleChildIndex}get collapsible(){return this.node.collapsible}get collapsed(){return this.node.collapsed}get visible(){return this.node.visible}get filterData(){return this.node.filterData}constructor(e,t){this.unwrapper=e,this.node=t}}function mapOptions(a,e){return{...e,identityProvider:e.identityProvider&&{getId(t){return e.identityProvider.getId(a(t))}},sorter:e.sorter&&{compare(t,s){return e.sorter.compare(t.elements[0],s.elements[0])}},filter:e.filter&&{filter(t,s){const o=t.elements;for(let r=0;r<o.length-1;r++){const l=e.filter.filter(o[r],s);s=getVisibleState(isFilterResult(l)?l.visibility:l)}return e.filter.filter(o[o.length-1],s)}}}}class CompressibleObjectTreeModel{get onDidSpliceModel(){return Event$1.map(this.model.onDidSpliceModel,({insertedNodes:e,deletedNodes:t})=>({insertedNodes:e.map(s=>this.nodeMapper.map(s)),deletedNodes:t.map(s=>this.nodeMapper.map(s))}))}get onDidSpliceRenderedNodes(){return Event$1.map(this.model.onDidSpliceRenderedNodes,({start:e,deleteCount:t,elements:s})=>({start:e,deleteCount:t,elements:s.map(o=>this.nodeMapper.map(o))}))}get onDidChangeCollapseState(){return Event$1.map(this.model.onDidChangeCollapseState,({node:e,deep:t})=>({node:this.nodeMapper.map(e),deep:t}))}get onDidChangeRenderNodeCount(){return Event$1.map(this.model.onDidChangeRenderNodeCount,e=>this.nodeMapper.map(e))}constructor(e,t={}){this.rootRef=null,this.elementMapper=t.elementMapper||DefaultElementMapper;const s=o=>this.elementMapper(o.elements);this.nodeMapper=new WeakMapper(o=>new CompressedTreeNodeWrapper(s,o)),this.model=new CompressedObjectTreeModel(e,mapOptions(s,t))}setChildren(e,t=Iterable.empty(),s={}){this.model.setChildren(e,t,s)}isCompressionEnabled(){return this.model.isCompressionEnabled()}setCompressionEnabled(e){this.model.setCompressionEnabled(e)}has(e){return this.model.has(e)}getListIndex(e){return this.model.getListIndex(e)}getListRenderCount(e){return this.model.getListRenderCount(e)}getNode(e){return this.nodeMapper.map(this.model.getNode(e))}getNodeLocation(e){return e.element}getParentNodeLocation(e){return this.model.getParentNodeLocation(e)}getFirstElementChild(e){const t=this.model.getFirstElementChild(e);return t===null||typeof t>"u"?t:this.elementMapper(t.elements)}isCollapsible(e){return this.model.isCollapsible(e)}setCollapsible(e,t){return this.model.setCollapsible(e,t)}isCollapsed(e){return this.model.isCollapsed(e)}setCollapsed(e,t,s){return this.model.setCollapsed(e,t,s)}expandTo(e){return this.model.expandTo(e)}rerender(e){return this.model.rerender(e)}refilter(){return this.model.refilter()}getCompressedTreeNode(e=null){return this.model.getNode(e)}}var __decorate$1W=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};class ObjectTree extends AbstractTree{get onDidChangeCollapseState(){return this.model.onDidChangeCollapseState}constructor(e,t,s,o,r={}){super(e,t,s,o,r),this.user=e}setChildren(e,t=Iterable.empty(),s){this.model.setChildren(e,t,s)}rerender(e){if(e===void 0){this.view.rerender();return}this.model.rerender(e)}hasElement(e){return this.model.has(e)}createModel(e,t){return new ObjectTreeModel(e,t)}}class CompressibleRenderer{get compressedTreeNodeProvider(){return this._compressedTreeNodeProvider()}constructor(e,t,s){this._compressedTreeNodeProvider=e,this.stickyScrollDelegate=t,this.renderer=s,this.templateId=s.templateId,s.onDidChangeTwistieState&&(this.onDidChangeTwistieState=s.onDidChangeTwistieState)}renderTemplate(e){return{compressedTreeNode:void 0,data:this.renderer.renderTemplate(e)}}renderElement(e,t,s,o){let r=this.stickyScrollDelegate.getCompressedNode(e);r||(r=this.compressedTreeNodeProvider.getCompressedTreeNode(e.element)),r.element.elements.length===1?(s.compressedTreeNode=void 0,this.renderer.renderElement(e,t,s.data,o)):(s.compressedTreeNode=r,this.renderer.renderCompressedElements(r,t,s.data,o))}disposeElement(e,t,s,o){var r,l,c,d;s.compressedTreeNode?(l=(r=this.renderer).disposeCompressedElements)==null||l.call(r,s.compressedTreeNode,t,s.data,o):(d=(c=this.renderer).disposeElement)==null||d.call(c,e,t,s.data,o)}disposeTemplate(e){this.renderer.disposeTemplate(e.data)}renderTwistie(e,t){var s,o;return((o=(s=this.renderer).renderTwistie)==null?void 0:o.call(s,e,t))??!1}}__decorate$1W([memoize],CompressibleRenderer.prototype,"compressedTreeNodeProvider",null);class CompressibleStickyScrollDelegate{constructor(e){this.modelProvider=e,this.compressedStickyNodes=new Map}getCompressedNode(e){return this.compressedStickyNodes.get(e)}constrainStickyScrollNodes(e,t,s){if(this.compressedStickyNodes.clear(),e.length===0)return[];for(let o=0;o<e.length;o++){const r=e[o],l=r.position+r.height;if(o+1<e.length&&l+e[o+1].height>s||o>=t-1&&t<e.length){const d=e.slice(0,o),u=e.slice(o),g=this.compressStickyNodes(u);return[...d,g]}}return e}compressStickyNodes(e){if(e.length===0)throw new Error("Can't compress empty sticky nodes");const t=this.modelProvider();if(!t.isCompressionEnabled())return e[0];const s=[];for(let u=0;u<e.length;u++){const g=e[u],f=t.getCompressedTreeNode(g.node.element);if(f.element){if(u!==0&&f.element.incompressible)break;s.push(...f.element.elements)}}if(s.length<2)return e[0];const o=e[e.length-1],r={elements:s,incompressible:!1},l={...o.node,children:[],element:r},c=new Proxy(e[0].node,{}),d={node:c,startIndex:e[0].startIndex,endIndex:o.endIndex,position:e[0].position,height:e[0].height};return this.compressedStickyNodes.set(c,l),d}}function asObjectTreeOptions$1(a,e){return e&&{...e,keyboardNavigationLabelProvider:e.keyboardNavigationLabelProvider&&{getKeyboardNavigationLabel(t){let s;try{s=a().getCompressedTreeNode(t)}catch{return e.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(t)}return s.element.elements.length===1?e.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(t):e.keyboardNavigationLabelProvider.getCompressedNodeKeyboardNavigationLabel(s.element.elements)}}}}class CompressibleObjectTree extends ObjectTree{constructor(e,t,s,o,r={}){const l=()=>this,c=new CompressibleStickyScrollDelegate(()=>this.model),d=o.map(u=>new CompressibleRenderer(l,c,u));super(e,t,s,d,{...asObjectTreeOptions$1(l,r),stickyScrollDelegate:c})}setChildren(e,t=Iterable.empty(),s){this.model.setChildren(e,t,s)}createModel(e,t){return new CompressibleObjectTreeModel(e,t)}updateOptions(e={}){super.updateOptions(e),typeof e.compressionEnabled<"u"&&this.model.setCompressionEnabled(e.compressionEnabled)}getCompressedTreeNode(e=null){return this.model.getCompressedTreeNode(e)}}function createAsyncDataTreeNode(a){return{...a,children:[],refreshPromise:void 0,stale:!0,slow:!1,forceExpanded:!1}}function isAncestor(a,e){return e.parent?e.parent===a?!0:isAncestor(a,e.parent):!1}function intersects(a,e){return a===e||isAncestor(a,e)||isAncestor(e,a)}class AsyncDataTreeNodeWrapper{get element(){return this.node.element.element}get children(){return this.node.children.map(e=>new AsyncDataTreeNodeWrapper(e))}get depth(){return this.node.depth}get visibleChildrenCount(){return this.node.visibleChildrenCount}get visibleChildIndex(){return this.node.visibleChildIndex}get collapsible(){return this.node.collapsible}get collapsed(){return this.node.collapsed}get visible(){return this.node.visible}get filterData(){return this.node.filterData}constructor(e){this.node=e}}class AsyncDataTreeRenderer{constructor(e,t,s){this.renderer=e,this.nodeMapper=t,this.onDidChangeTwistieState=s,this.renderedNodes=new Map,this.templateId=e.templateId}renderTemplate(e){return{templateData:this.renderer.renderTemplate(e)}}renderElement(e,t,s,o){this.renderer.renderElement(this.nodeMapper.map(e),t,s.templateData,o)}renderTwistie(e,t){return e.slow?(t.classList.add(...ThemeIcon.asClassNameArray(Codicon.treeItemLoading)),!0):(t.classList.remove(...ThemeIcon.asClassNameArray(Codicon.treeItemLoading)),!1)}disposeElement(e,t,s,o){var r,l;(l=(r=this.renderer).disposeElement)==null||l.call(r,this.nodeMapper.map(e),t,s.templateData,o)}disposeTemplate(e){this.renderer.disposeTemplate(e.templateData)}dispose(){this.renderedNodes.clear()}}function asTreeEvent(a){return{browserEvent:a.browserEvent,elements:a.elements.map(e=>e.element)}}function asTreeMouseEvent(a){return{browserEvent:a.browserEvent,element:a.element&&a.element.element,target:a.target}}class AsyncDataTreeElementsDragAndDropData extends ElementsDragAndDropData{constructor(e){super(e.elements.map(t=>t.element)),this.data=e}}function asAsyncDataTreeDragAndDropData(a){return a instanceof ElementsDragAndDropData?new AsyncDataTreeElementsDragAndDropData(a):a}class AsyncDataTreeNodeListDragAndDrop{constructor(e){this.dnd=e}getDragURI(e){return this.dnd.getDragURI(e.element)}getDragLabel(e,t){if(this.dnd.getDragLabel)return this.dnd.getDragLabel(e.map(s=>s.element),t)}onDragStart(e,t){var s,o;(o=(s=this.dnd).onDragStart)==null||o.call(s,asAsyncDataTreeDragAndDropData(e),t)}onDragOver(e,t,s,o,r,l=!0){return this.dnd.onDragOver(asAsyncDataTreeDragAndDropData(e),t&&t.element,s,o,r)}drop(e,t,s,o,r){this.dnd.drop(asAsyncDataTreeDragAndDropData(e),t&&t.element,s,o,r)}onDragEnd(e){var t,s;(s=(t=this.dnd).onDragEnd)==null||s.call(t,e)}dispose(){this.dnd.dispose()}}class AsyncFindFilter extends FindFilter{constructor(e,t,s){super(t,s),this.findProvider=e,this.isFindSessionActive=!1}filter(e,t){const s=super.filter(e,t);if(!this.isFindSessionActive||this.findMode===TreeFindMode.Highlight||!this.findProvider.isVisible)return s;const o=isFilterResult(s)?s.visibility:s;return getVisibleState(o)===0?0:this.findProvider.isVisible(e)?s:0}}class AsyncFindController extends FindController$1{constructor(e,t,s,o,r){super(e,s,o,r),this.findProvider=t,this.filter=s,this.activeSession=!1,this.asyncWorkInProgress=!1,this.disposables.add(toDisposable(async()=>{var l,c;this.activeSession&&await((c=(l=this.findProvider).endSession)==null?void 0:c.call(l))}))}render(){if(this.asyncWorkInProgress||!this.activeFindMetadata)return;const e=this.activeFindMetadata.matchCount===0&&this.pattern.length>0;this.renderMessage(e),this.pattern.length&&this.alertResults(this.activeFindMetadata.matchCount)}shouldAllowFocus(e){return this.shouldFocusWhenNavigating(e)}shouldFocusWhenNavigating(e){var s;if(!this.activeSession||!this.activeFindMetadata)return!0;const t=(s=e.element)==null?void 0:s.element;return t&&this.activeFindMetadata.isMatch(t)?!0:!FuzzyScore.isDefault(e.filterData)}}function asObjectTreeOptions(a){return a&&{...a,collapseByDefault:!0,identityProvider:a.identityProvider&&{getId(e){return a.identityProvider.getId(e.element)}},dnd:a.dnd&&new AsyncDataTreeNodeListDragAndDrop(a.dnd),multipleSelectionController:a.multipleSelectionController&&{isSelectionSingleChangeEvent(e){return a.multipleSelectionController.isSelectionSingleChangeEvent({...e,element:e.element})},isSelectionRangeChangeEvent(e){return a.multipleSelectionController.isSelectionRangeChangeEvent({...e,element:e.element})}},accessibilityProvider:a.accessibilityProvider&&{...a.accessibilityProvider,getPosInSet:void 0,getSetSize:void 0,getRole:a.accessibilityProvider.getRole?e=>a.accessibilityProvider.getRole(e.element):()=>"treeitem",isChecked:a.accessibilityProvider.isChecked?e=>{var t;return!!((t=a.accessibilityProvider)!=null&&t.isChecked(e.element))}:void 0,getAriaLabel(e){return a.accessibilityProvider.getAriaLabel(e.element)},getWidgetAriaLabel(){return a.accessibilityProvider.getWidgetAriaLabel()},getWidgetRole:a.accessibilityProvider.getWidgetRole?()=>a.accessibilityProvider.getWidgetRole():()=>"tree",getAriaLevel:a.accessibilityProvider.getAriaLevel&&(e=>a.accessibilityProvider.getAriaLevel(e.element)),getActiveDescendantId:a.accessibilityProvider.getActiveDescendantId&&(e=>a.accessibilityProvider.getActiveDescendantId(e.element))},filter:a.filter&&{filter(e,t){return a.filter.filter(e.element,t)}},keyboardNavigationLabelProvider:a.keyboardNavigationLabelProvider&&{...a.keyboardNavigationLabelProvider,getKeyboardNavigationLabel(e){return a.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(e.element)}},sorter:void 0,expandOnlyOnTwistieClick:typeof a.expandOnlyOnTwistieClick>"u"?void 0:typeof a.expandOnlyOnTwistieClick!="function"?a.expandOnlyOnTwistieClick:e=>a.expandOnlyOnTwistieClick(e.element),defaultFindVisibility:e=>e.hasChildren&&e.stale?1:typeof a.defaultFindVisibility=="number"?a.defaultFindVisibility:typeof a.defaultFindVisibility>"u"?2:a.defaultFindVisibility(e.element)}}function dfs(a,e){e(a),a.children.forEach(t=>dfs(t,e))}class AsyncDataTree{get onDidScroll(){return this.tree.onDidScroll}get onDidChangeFocus(){return Event$1.map(this.tree.onDidChangeFocus,asTreeEvent)}get onDidChangeSelection(){return Event$1.map(this.tree.onDidChangeSelection,asTreeEvent)}get onMouseDblClick(){return Event$1.map(this.tree.onMouseDblClick,asTreeMouseEvent)}get onPointer(){return Event$1.map(this.tree.onPointer,asTreeMouseEvent)}get onDidFocus(){return this.tree.onDidFocus}get onDidChangeModel(){return this.tree.onDidChangeModel}get onDidChangeCollapseState(){return this.tree.onDidChangeCollapseState}get onDidChangeStickyScrollFocused(){return this.tree.onDidChangeStickyScrollFocused}get onDidDispose(){return this.tree.onDidDispose}constructor(e,t,s,o,r,l={}){this.user=e,this.dataSource=r,this.nodes=new Map,this.subTreeRefreshPromises=new Map,this.refreshPromises=new Map,this._onDidRender=new Emitter$1,this._onDidChangeNodeSlowState=new Emitter$1,this.nodeMapper=new WeakMapper(u=>new AsyncDataTreeNodeWrapper(u)),this.disposables=new DisposableStore,this.identityProvider=l.identityProvider,this.autoExpandSingleChildren=typeof l.autoExpandSingleChildren>"u"?!1:l.autoExpandSingleChildren,this.sorter=l.sorter,this.getDefaultCollapseState=u=>l.collapseByDefault?l.collapseByDefault(u)?ObjectTreeElementCollapseState.PreserveOrCollapsed:ObjectTreeElementCollapseState.PreserveOrExpanded:void 0;let c=!1,d;if(l.findProvider&&(l.findWidgetEnabled??!0)&&l.keyboardNavigationLabelProvider&&l.contextViewProvider&&(c=!0,d=new AsyncFindFilter(l.findProvider,l.keyboardNavigationLabelProvider,l.filter)),this.tree=this.createTree(e,t,s,o,{...l,findWidgetEnabled:!c,filter:d??l.filter}),this.root=createAsyncDataTreeNode({element:void 0,parent:null,hasChildren:!0,defaultCollapseState:void 0}),this.identityProvider&&(this.root={...this.root,id:null}),this.nodes.set(null,this.root),this.tree.onDidChangeCollapseState(this._onDidChangeCollapseState,this,this.disposables),c){const u={styles:l.findWidgetStyles,showNotFoundMessage:l.showNotFoundMessage,defaultFindMatchType:l.defaultFindMatchType,defaultFindMode:l.defaultFindMode};this.findController=this.disposables.add(new AsyncFindController(this.tree,l.findProvider,d,this.tree.options.contextViewProvider,u)),this.focusNavigationFilter=g=>this.findController.shouldFocusWhenNavigating(g),this.onDidChangeFindOpenState=this.findController.onDidChangeOpenState,this.onDidChangeFindMode=this.findController.onDidChangeMode,this.onDidChangeFindMatchType=this.findController.onDidChangeMatchType}else this.onDidChangeFindOpenState=this.tree.onDidChangeFindOpenState,this.onDidChangeFindMode=this.tree.onDidChangeFindMode,this.onDidChangeFindMatchType=this.tree.onDidChangeFindMatchType}createTree(e,t,s,o,r){const l=new ComposedTreeDelegate(s),c=o.map(u=>new AsyncDataTreeRenderer(u,this.nodeMapper,this._onDidChangeNodeSlowState.event)),d=asObjectTreeOptions(r)||{};return new ObjectTree(e,t,l,c,d)}updateOptions(e={}){this.findController&&(e.defaultFindMode!==void 0&&(this.findController.mode=e.defaultFindMode),e.defaultFindMatchType!==void 0&&(this.findController.matchType=e.defaultFindMatchType)),this.tree.updateOptions(e)}getHTMLElement(){return this.tree.getHTMLElement()}get scrollTop(){return this.tree.scrollTop}set scrollTop(e){this.tree.scrollTop=e}get scrollHeight(){return this.tree.scrollHeight}get renderHeight(){return this.tree.renderHeight}domFocus(){this.tree.domFocus()}layout(e,t){this.tree.layout(e,t)}style(e){this.tree.style(e)}getInput(){return this.root.element}async setInput(e,t){this.cancelAllRefreshPromises(),this.root.element=e;const s=t&&{viewState:t,focus:[],selection:[]};await this._updateChildren(e,!0,!1,s),s&&(this.tree.setFocus(s.focus),this.tree.setSelection(s.selection)),t&&typeof t.scrollTop=="number"&&(this.scrollTop=t.scrollTop)}cancelAllRefreshPromises(e=!1){this.refreshPromises.forEach(t=>t.cancel()),this.refreshPromises.clear(),e&&(this.subTreeRefreshPromises.forEach(t=>t.cancel()),this.subTreeRefreshPromises.clear())}async _updateChildren(e=this.root.element,t=!0,s=!1,o,r){if(typeof this.root.element>"u")throw new TreeError(this.user,"Tree input not set");this.root.refreshPromise&&(await this.root.refreshPromise,await Event$1.toPromise(this._onDidRender.event));const l=this.getDataNode(e);if(await this.refreshAndRenderNode(l,t,o,r),s)try{this.tree.rerender(l)}catch{}}rerender(e){if(e===void 0||e===this.root.element){this.tree.rerender();return}const t=this.getDataNode(e);this.tree.rerender(t)}getNode(e=this.root.element){const t=this.getDataNode(e),s=this.tree.getNode(t===this.root?null:t);return this.nodeMapper.map(s)}collapse(e,t=!1){const s=this.getDataNode(e);return this.tree.collapse(s===this.root?null:s,t)}async expand(e,t=!1){if(typeof this.root.element>"u")throw new TreeError(this.user,"Tree input not set");this.root.refreshPromise&&(await this.root.refreshPromise,await Event$1.toPromise(this._onDidRender.event));const s=this.getDataNode(e);if(this.tree.hasElement(s)&&!this.tree.isCollapsible(s)||(s.refreshPromise&&(await s.refreshPromise,await Event$1.toPromise(this._onDidRender.event)),s!==this.root&&!s.refreshPromise&&!this.tree.isCollapsed(s)))return!1;const o=this.tree.expand(s===this.root?null:s,t);return s.refreshPromise&&(await s.refreshPromise,await Event$1.toPromise(this._onDidRender.event)),o}setSelection(e,t){const s=e.map(o=>this.getDataNode(o));this.tree.setSelection(s,t)}getSelection(){return this.tree.getSelection().map(t=>t.element)}setFocus(e,t){const s=e.map(o=>this.getDataNode(o));this.tree.setFocus(s,t)}getFocus(){return this.tree.getFocus().map(t=>t.element)}reveal(e,t){this.tree.reveal(this.getDataNode(e),t)}getParentElement(e){const t=this.tree.getParentElement(this.getDataNode(e));return t&&t.element}getFirstElementChild(e=this.root.element){const t=this.getDataNode(e),s=this.tree.getFirstElementChild(t===this.root?null:t);return s&&s.element}getDataNode(e){var s;const t=this.nodes.get(e===this.root.element?null:e);if(!t){const o=(s=this.identityProvider)==null?void 0:s.getId(e).toString();throw new TreeError(this.user,`Data tree node not found${o?`: ${o}`:""}`)}return t}async refreshAndRenderNode(e,t,s,o){this.disposables.isDisposed||(await this.refreshNode(e,t,s),!this.disposables.isDisposed&&this.render(e,s,o))}async refreshNode(e,t,s){let o;if(this.subTreeRefreshPromises.forEach((r,l)=>{!o&&intersects(l,e)&&(o=r.then(()=>this.refreshNode(e,t,s)))}),o)return o;if(e!==this.root&&this.tree.getNode(e).collapsed){e.hasChildren=!!this.dataSource.hasChildren(e.element),e.stale=!0,this.setChildren(e,[],t,s);return}return this.doRefreshSubTree(e,t,s)}async doRefreshSubTree(e,t,s){const o=createCancelablePromise(async()=>{const r=await this.doRefreshNode(e,t,s);e.stale=!1,await Promises.settled(r.map(l=>this.doRefreshSubTree(l,t,s)))});return e.refreshPromise=o,this.subTreeRefreshPromises.set(e,o),o.finally(()=>{e.refreshPromise=void 0,this.subTreeRefreshPromises.delete(e)}),o}async doRefreshNode(e,t,s){e.hasChildren=!!this.dataSource.hasChildren(e.element);let o;if(!e.hasChildren)o=Promise.resolve(Iterable.empty());else{const r=this.doGetChildren(e);if(isIterable(r))o=Promise.resolve(r);else{const l=timeout(800);l.then(()=>{e.slow=!0,this._onDidChangeNodeSlowState.fire(e)},c=>null),o=r.finally(()=>l.cancel())}}try{const r=await o;return this.setChildren(e,r,t,s)}catch(r){if(e!==this.root&&this.tree.hasElement(e)&&this.tree.collapse(e),isCancellationError(r))return[];throw r}finally{e.slow&&(e.slow=!1,this._onDidChangeNodeSlowState.fire(e))}}doGetChildren(e){let t=this.refreshPromises.get(e);if(t)return t;const s=this.dataSource.getChildren(e.element);return isIterable(s)?this.processChildren(s):(t=createCancelablePromise(async()=>this.processChildren(await s)),this.refreshPromises.set(e,t),t.finally(()=>{this.refreshPromises.delete(e)}))}_onDidChangeCollapseState({node:e,deep:t}){e.element!==null&&!e.collapsed&&e.element.stale&&(t?this.collapse(e.element.element):this.refreshAndRenderNode(e.element,!1).catch(onUnexpectedError))}setChildren(e,t,s,o){const r=[...t];if(e.children.length===0&&r.length===0)return[];const l=new Map,c=new Map;for(const g of e.children)l.set(g.element,g),this.identityProvider&&c.set(g.id,{node:g,collapsed:this.tree.hasElement(g)&&this.tree.isCollapsed(g)});const d=[],u=r.map(g=>{const f=!!this.dataSource.hasChildren(g);if(!this.identityProvider){const C=createAsyncDataTreeNode({element:g,parent:e,hasChildren:f,defaultCollapseState:this.getDefaultCollapseState(g)});return f&&C.defaultCollapseState===ObjectTreeElementCollapseState.PreserveOrExpanded&&d.push(C),C}const p=this.identityProvider.getId(g).toString(),m=c.get(p);if(m){const C=m.node;return l.delete(C.element),this.nodes.delete(C.element),this.nodes.set(g,C),C.element=g,C.hasChildren=f,s?m.collapsed?(C.children.forEach(b=>dfs(b,v=>this.nodes.delete(v.element))),C.children.splice(0,C.children.length),C.stale=!0):d.push(C):f&&!m.collapsed&&d.push(C),C}const _=createAsyncDataTreeNode({element:g,parent:e,id:p,hasChildren:f,defaultCollapseState:this.getDefaultCollapseState(g)});return o&&o.viewState.focus&&o.viewState.focus.indexOf(p)>-1&&o.focus.push(_),o&&o.viewState.selection&&o.viewState.selection.indexOf(p)>-1&&o.selection.push(_),(o&&o.viewState.expanded&&o.viewState.expanded.indexOf(p)>-1||f&&_.defaultCollapseState===ObjectTreeElementCollapseState.PreserveOrExpanded)&&d.push(_),_});for(const g of l.values())dfs(g,f=>this.nodes.delete(f.element));for(const g of u)this.nodes.set(g.element,g);return splice$1(e.children,0,e.children.length,u),e!==this.root&&this.autoExpandSingleChildren&&u.length===1&&d.length===0&&(u[0].forceExpanded=!0,d.push(u[0])),d}render(e,t,s){const o=e.children.map(l=>this.asTreeElement(l,t)),r=s&&{...s,diffIdentityProvider:s.diffIdentityProvider&&{getId(l){return s.diffIdentityProvider.getId(l.element)}}};this.tree.setChildren(e===this.root?null:e,o,r),e!==this.root&&this.tree.setCollapsible(e,e.hasChildren),this._onDidRender.fire()}asTreeElement(e,t){if(e.stale)return{element:e,collapsible:e.hasChildren,collapsed:!0};let s;return t&&t.viewState.expanded&&e.id&&t.viewState.expanded.indexOf(e.id)>-1?s=!1:e.forceExpanded?(s=!1,e.forceExpanded=!1):s=e.defaultCollapseState,{element:e,children:e.hasChildren?Iterable.map(e.children,o=>this.asTreeElement(o,t)):[],collapsible:e.hasChildren,collapsed:s}}processChildren(e){return this.sorter&&(e=[...e].sort(this.sorter.compare.bind(this.sorter))),e}dispose(){this.disposables.dispose(),this.tree.dispose()}}class CompressibleAsyncDataTreeNodeWrapper{get element(){return{elements:this.node.element.elements.map(e=>e.element),incompressible:this.node.element.incompressible}}get children(){return this.node.children.map(e=>new CompressibleAsyncDataTreeNodeWrapper(e))}get depth(){return this.node.depth}get visibleChildrenCount(){return this.node.visibleChildrenCount}get visibleChildIndex(){return this.node.visibleChildIndex}get collapsible(){return this.node.collapsible}get collapsed(){return this.node.collapsed}get visible(){return this.node.visible}get filterData(){return this.node.filterData}constructor(e){this.node=e}}class CompressibleAsyncDataTreeRenderer{constructor(e,t,s,o){this.renderer=e,this.nodeMapper=t,this.compressibleNodeMapperProvider=s,this.onDidChangeTwistieState=o,this.renderedNodes=new Map,this.disposables=[],this.templateId=e.templateId}renderTemplate(e){return{templateData:this.renderer.renderTemplate(e)}}renderElement(e,t,s,o){this.renderer.renderElement(this.nodeMapper.map(e),t,s.templateData,o)}renderCompressedElements(e,t,s,o){this.renderer.renderCompressedElements(this.compressibleNodeMapperProvider().map(e),t,s.templateData,o)}renderTwistie(e,t){return e.slow?(t.classList.add(...ThemeIcon.asClassNameArray(Codicon.treeItemLoading)),!0):(t.classList.remove(...ThemeIcon.asClassNameArray(Codicon.treeItemLoading)),!1)}disposeElement(e,t,s,o){var r,l;(l=(r=this.renderer).disposeElement)==null||l.call(r,this.nodeMapper.map(e),t,s.templateData,o)}disposeCompressedElements(e,t,s,o){var r,l;(l=(r=this.renderer).disposeCompressedElements)==null||l.call(r,this.compressibleNodeMapperProvider().map(e),t,s.templateData,o)}disposeTemplate(e){this.renderer.disposeTemplate(e.templateData)}dispose(){this.renderedNodes.clear(),this.disposables=dispose(this.disposables)}}function asCompressibleObjectTreeOptions(a){const e=a&&asObjectTreeOptions(a);return e&&{...e,keyboardNavigationLabelProvider:e.keyboardNavigationLabelProvider&&{...e.keyboardNavigationLabelProvider,getCompressedNodeKeyboardNavigationLabel(t){return a.keyboardNavigationLabelProvider.getCompressedNodeKeyboardNavigationLabel(t.map(s=>s.element))}}}}class CompressibleAsyncDataTree extends AsyncDataTree{constructor(e,t,s,o,r,l,c={}){super(e,t,s,r,l,c),this.compressionDelegate=o,this.compressibleNodeMapper=new WeakMapper(d=>new CompressibleAsyncDataTreeNodeWrapper(d)),this.filter=c.filter}createTree(e,t,s,o,r){const l=new ComposedTreeDelegate(s),c=o.map(u=>new CompressibleAsyncDataTreeRenderer(u,this.nodeMapper,()=>this.compressibleNodeMapper,this._onDidChangeNodeSlowState.event)),d=asCompressibleObjectTreeOptions(r)||{};return new CompressibleObjectTree(e,t,l,c,d)}asTreeElement(e,t){return{incompressible:this.compressionDelegate.isIncompressible(e.element),...super.asTreeElement(e,t)}}render(e,t,s){if(!this.identityProvider)return super.render(e,t);const o=m=>this.identityProvider.getId(m).toString(),r=m=>{const _=new Set;for(const C of m){const b=this.tree.getCompressedTreeNode(C===this.root?null:C);if(b.element)for(const v of b.element.elements)_.add(o(v.element))}return _},l=r(this.tree.getSelection()),c=r(this.tree.getFocus());super.render(e,t,s);const d=this.getSelection();let u=!1;const g=this.getFocus();let f=!1;const p=m=>{const _=m.element;if(_)for(let C=0;C<_.elements.length;C++){const b=o(_.elements[C].element),v=_.elements[_.elements.length-1].element;l.has(b)&&d.indexOf(v)===-1&&(d.push(v),u=!0),c.has(b)&&g.indexOf(v)===-1&&(g.push(v),f=!0)}m.children.forEach(p)};p(this.tree.getCompressedTreeNode(e===this.root?null:e)),u&&this.setSelection(d),f&&this.setFocus(g)}processChildren(e){return this.filter&&(e=Iterable.filter(e,t=>{const s=this.filter.filter(t,1),o=getVisibility(s);if(o===2)throw new Error("Recursive tree visibility not supported in async data compressed trees");return o===1})),super.processChildren(e)}}function getVisibility(a){return typeof a=="boolean"?a?1:0:isFilterResult(a)?getVisibleState(a.visibility):getVisibleState(a)}class DataTree extends AbstractTree{constructor(e,t,s,o,r,l={}){super(e,t,s,o,l),this.user=e,this.dataSource=r,this.identityProvider=l.identityProvider}createModel(e,t){return new ObjectTreeModel(e,t)}}new RawContextKey("isMac",isMacintosh,localize(1669,"Whether the operating system is macOS"));new RawContextKey("isLinux",isLinux,localize(1670,"Whether the operating system is Linux"));const IsWindowsContext=new RawContextKey("isWindows",isWindows,localize(1671,"Whether the operating system is Windows")),IsWebContext=new RawContextKey("isWeb",isWeb,localize(1672,"Whether the platform is a web browser"));new RawContextKey("isMacNative",isMacintosh&&!isWeb,localize(1673,"Whether the operating system is macOS on a non-browser platform"));new RawContextKey("isIOS",isIOS,localize(1674,"Whether the operating system is iOS"));new RawContextKey("isMobile",isMobile,localize(1675,"Whether the platform is a mobile web browser"));new RawContextKey("isDevelopment",!1,!0);new RawContextKey("productQualityType","",localize(1676,"Quality type of VS Code"));const InputFocusedContextKey="inputFocus",InputFocusedContext=new RawContextKey(InputFocusedContextKey,!1,localize(1677,"Whether keyboard focus is inside an input box"));var __decorate$1V=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1U=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const IListService=createDecorator("listService");class ListService{get lastFocusedList(){return this._lastFocusedWidget}constructor(){this.disposables=new DisposableStore,this.lists=[],this._lastFocusedWidget=void 0}setLastFocusedList(e){var t,s;e!==this._lastFocusedWidget&&((t=this._lastFocusedWidget)==null||t.getHTMLElement().classList.remove("last-focused"),this._lastFocusedWidget=e,(s=this._lastFocusedWidget)==null||s.getHTMLElement().classList.add("last-focused"))}register(e,t){if(this.lists.some(o=>o.widget===e))throw new Error("Cannot register the same widget multiple times");const s={widget:e,extraContextKeys:t};return this.lists.push(s),isActiveElement(e.getHTMLElement())&&this.setLastFocusedList(e),combinedDisposable(e.onDidFocus(()=>this.setLastFocusedList(e)),toDisposable(()=>this.lists.splice(this.lists.indexOf(s),1)),e.onDidDispose(()=>{this.lists=this.lists.filter(o=>o!==s),this._lastFocusedWidget===e&&this.setLastFocusedList(void 0)}))}dispose(){this.disposables.dispose()}}const RawWorkbenchListScrollAtBoundaryContextKey=new RawContextKey("listScrollAtBoundary","none");ContextKeyExpr.or(RawWorkbenchListScrollAtBoundaryContextKey.isEqualTo("top"),RawWorkbenchListScrollAtBoundaryContextKey.isEqualTo("both"));ContextKeyExpr.or(RawWorkbenchListScrollAtBoundaryContextKey.isEqualTo("bottom"),RawWorkbenchListScrollAtBoundaryContextKey.isEqualTo("both"));const RawWorkbenchListFocusContextKey=new RawContextKey("listFocus",!0),WorkbenchTreeStickyScrollFocused=new RawContextKey("treestickyScrollFocused",!1),WorkbenchListSupportsMultiSelectContextKey=new RawContextKey("listSupportsMultiselect",!0),WorkbenchListFocusContextKey=ContextKeyExpr.and(RawWorkbenchListFocusContextKey,ContextKeyExpr.not(InputFocusedContextKey),WorkbenchTreeStickyScrollFocused.negate()),WorkbenchListHasSelectionOrFocus=new RawContextKey("listHasSelectionOrFocus",!1),WorkbenchListDoubleSelection=new RawContextKey("listDoubleSelection",!1),WorkbenchListMultiSelection=new RawContextKey("listMultiSelection",!1),WorkbenchListSelectionNavigation=new RawContextKey("listSelectionNavigation",!1),WorkbenchListSupportsFind=new RawContextKey("listSupportsFind",!0),WorkbenchTreeElementCanCollapse=new RawContextKey("treeElementCanCollapse",!1),WorkbenchTreeElementHasParent=new RawContextKey("treeElementHasParent",!1),WorkbenchTreeElementCanExpand=new RawContextKey("treeElementCanExpand",!1),WorkbenchTreeElementHasChild=new RawContextKey("treeElementHasChild",!1),WorkbenchTreeFindOpen=new RawContextKey("treeFindOpen",!1),WorkbenchListTypeNavigationModeKey="listTypeNavigationMode",WorkbenchListAutomaticKeyboardNavigationLegacyKey="listAutomaticKeyboardNavigation";function createScopedContextKeyService(a,e){const t=a.createScoped(e.getHTMLElement());return RawWorkbenchListFocusContextKey.bindTo(t),t}function createScrollObserver(a,e){const t=RawWorkbenchListScrollAtBoundaryContextKey.bindTo(a),s=()=>{const o=e.scrollTop===0,r=e.scrollHeight-e.renderHeight-e.scrollTop<1;o&&r?t.set("both"):o?t.set("top"):r?t.set("bottom"):t.set("none")};return s(),e.onDidScroll(s)}const multiSelectModifierSettingKey="workbench.list.multiSelectModifier",openModeSettingKey="workbench.list.openMode",horizontalScrollingKey="workbench.list.horizontalScrolling",defaultFindModeSettingKey="workbench.list.defaultFindMode",typeNavigationModeSettingKey="workbench.list.typeNavigationMode",keyboardNavigationSettingKey="workbench.list.keyboardNavigation",scrollByPageKey="workbench.list.scrollByPage",defaultFindMatchTypeSettingKey="workbench.list.defaultFindMatchType",treeIndentKey="workbench.tree.indent",treeRenderIndentGuidesKey="workbench.tree.renderIndentGuides",listSmoothScrolling="workbench.list.smoothScrolling",mouseWheelScrollSensitivityKey="workbench.list.mouseWheelScrollSensitivity",fastScrollSensitivityKey="workbench.list.fastScrollSensitivity",treeExpandMode="workbench.tree.expandMode",treeStickyScroll="workbench.tree.enableStickyScroll",treeStickyScrollMaxElements="workbench.tree.stickyScrollMaxItemCount";function useAltAsMultipleSelectionModifier(a){return a.getValue(multiSelectModifierSettingKey)==="alt"}class MultipleSelectionController extends Disposable{constructor(e){super(),this.configurationService=e,this.useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(e),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration(multiSelectModifierSettingKey)&&(this.useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(this.configurationService))}))}isSelectionSingleChangeEvent(e){return this.useAltAsMultipleSelectionModifier?e.browserEvent.altKey:isSelectionSingleChangeEvent(e)}isSelectionRangeChangeEvent(e){return isSelectionRangeChangeEvent(e)}}function toWorkbenchListOptions(a,e){const t=a.get(IConfigurationService),s=a.get(IKeybindingService),o=new DisposableStore;return[{...e,keyboardNavigationDelegate:{mightProducePrintableCharacter(l){return s.mightProducePrintableCharacter(l)}},smoothScrolling:!!t.getValue(listSmoothScrolling),mouseWheelScrollSensitivity:t.getValue(mouseWheelScrollSensitivityKey),fastScrollSensitivity:t.getValue(fastScrollSensitivityKey),multipleSelectionController:e.multipleSelectionController??o.add(new MultipleSelectionController(t)),keyboardNavigationEventFilter:createKeyboardNavigationEventFilter(s),scrollByPage:!!t.getValue(scrollByPageKey)},o]}let WorkbenchList=class extends List{constructor(e,t,s,o,r,l,c,d,u){const g=typeof r.horizontalScrolling<"u"?r.horizontalScrolling:!!d.getValue(horizontalScrollingKey),[f,p]=u.invokeFunction(toWorkbenchListOptions,r);super(e,t,s,o,{keyboardSupport:!1,...f,horizontalScrolling:g}),this.disposables.add(p),this.contextKeyService=createScopedContextKeyService(l,this),this.disposables.add(createScrollObserver(this.contextKeyService,this)),this.listSupportsMultiSelect=WorkbenchListSupportsMultiSelectContextKey.bindTo(this.contextKeyService),this.listSupportsMultiSelect.set(r.multipleSelectionSupport!==!1),WorkbenchListSelectionNavigation.bindTo(this.contextKeyService).set(!!r.selectionNavigation),this.listHasSelectionOrFocus=WorkbenchListHasSelectionOrFocus.bindTo(this.contextKeyService),this.listDoubleSelection=WorkbenchListDoubleSelection.bindTo(this.contextKeyService),this.listMultiSelection=WorkbenchListMultiSelection.bindTo(this.contextKeyService),this.horizontalScrolling=r.horizontalScrolling,this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(d),this.disposables.add(this.contextKeyService),this.disposables.add(c.register(this)),this.updateStyles(r.overrideStyles),this.disposables.add(this.onDidChangeSelection(()=>{const _=this.getSelection(),C=this.getFocus();this.contextKeyService.bufferChangeEvents(()=>{this.listHasSelectionOrFocus.set(_.length>0||C.length>0),this.listMultiSelection.set(_.length>1),this.listDoubleSelection.set(_.length===2)})})),this.disposables.add(this.onDidChangeFocus(()=>{const _=this.getSelection(),C=this.getFocus();this.listHasSelectionOrFocus.set(_.length>0||C.length>0)})),this.disposables.add(d.onDidChangeConfiguration(_=>{_.affectsConfiguration(multiSelectModifierSettingKey)&&(this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(d));let C={};if(_.affectsConfiguration(horizontalScrollingKey)&&this.horizontalScrolling===void 0){const b=!!d.getValue(horizontalScrollingKey);C={...C,horizontalScrolling:b}}if(_.affectsConfiguration(scrollByPageKey)){const b=!!d.getValue(scrollByPageKey);C={...C,scrollByPage:b}}if(_.affectsConfiguration(listSmoothScrolling)){const b=!!d.getValue(listSmoothScrolling);C={...C,smoothScrolling:b}}if(_.affectsConfiguration(mouseWheelScrollSensitivityKey)){const b=d.getValue(mouseWheelScrollSensitivityKey);C={...C,mouseWheelScrollSensitivity:b}}if(_.affectsConfiguration(fastScrollSensitivityKey)){const b=d.getValue(fastScrollSensitivityKey);C={...C,fastScrollSensitivity:b}}Object.keys(C).length>0&&this.updateOptions(C)})),this.navigator=new ListResourceNavigator(this,{configurationService:d,...r}),this.disposables.add(this.navigator)}updateOptions(e){super.updateOptions(e),e.overrideStyles!==void 0&&this.updateStyles(e.overrideStyles),e.multipleSelectionSupport!==void 0&&this.listSupportsMultiSelect.set(!!e.multipleSelectionSupport)}updateStyles(e){this.style(e?getListStyles(e):defaultListStyles)}};WorkbenchList=__decorate$1V([__param$1U(5,IContextKeyService),__param$1U(6,IListService),__param$1U(7,IConfigurationService),__param$1U(8,IInstantiationService)],WorkbenchList);let WorkbenchPagedList=class extends PagedList{constructor(e,t,s,o,r,l,c,d,u){const g=typeof r.horizontalScrolling<"u"?r.horizontalScrolling:!!d.getValue(horizontalScrollingKey),[f,p]=u.invokeFunction(toWorkbenchListOptions,r);super(e,t,s,o,{keyboardSupport:!1,...f,horizontalScrolling:g}),this.disposables=new DisposableStore,this.disposables.add(p),this.contextKeyService=createScopedContextKeyService(l,this),this.disposables.add(createScrollObserver(this.contextKeyService,this.widget)),this.horizontalScrolling=r.horizontalScrolling,this.listSupportsMultiSelect=WorkbenchListSupportsMultiSelectContextKey.bindTo(this.contextKeyService),this.listSupportsMultiSelect.set(r.multipleSelectionSupport!==!1),WorkbenchListSelectionNavigation.bindTo(this.contextKeyService).set(!!r.selectionNavigation),this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(d),this.disposables.add(this.contextKeyService),this.disposables.add(c.register(this)),this.updateStyles(r.overrideStyles),this.disposables.add(d.onDidChangeConfiguration(_=>{_.affectsConfiguration(multiSelectModifierSettingKey)&&(this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(d));let C={};if(_.affectsConfiguration(horizontalScrollingKey)&&this.horizontalScrolling===void 0){const b=!!d.getValue(horizontalScrollingKey);C={...C,horizontalScrolling:b}}if(_.affectsConfiguration(scrollByPageKey)){const b=!!d.getValue(scrollByPageKey);C={...C,scrollByPage:b}}if(_.affectsConfiguration(listSmoothScrolling)){const b=!!d.getValue(listSmoothScrolling);C={...C,smoothScrolling:b}}if(_.affectsConfiguration(mouseWheelScrollSensitivityKey)){const b=d.getValue(mouseWheelScrollSensitivityKey);C={...C,mouseWheelScrollSensitivity:b}}if(_.affectsConfiguration(fastScrollSensitivityKey)){const b=d.getValue(fastScrollSensitivityKey);C={...C,fastScrollSensitivity:b}}Object.keys(C).length>0&&this.updateOptions(C)})),this.navigator=new ListResourceNavigator(this,{configurationService:d,...r}),this.disposables.add(this.navigator)}updateOptions(e){super.updateOptions(e),e.overrideStyles!==void 0&&this.updateStyles(e.overrideStyles),e.multipleSelectionSupport!==void 0&&this.listSupportsMultiSelect.set(!!e.multipleSelectionSupport)}updateStyles(e){this.style(e?getListStyles(e):defaultListStyles)}dispose(){this.disposables.dispose(),super.dispose()}};WorkbenchPagedList=__decorate$1V([__param$1U(5,IContextKeyService),__param$1U(6,IListService),__param$1U(7,IConfigurationService),__param$1U(8,IInstantiationService)],WorkbenchPagedList);let WorkbenchTable=class extends Table{constructor(e,t,s,o,r,l,c,d,u,g){const f=typeof l.horizontalScrolling<"u"?l.horizontalScrolling:!!u.getValue(horizontalScrollingKey),[p,m]=g.invokeFunction(toWorkbenchListOptions,l);super(e,t,s,o,r,{keyboardSupport:!1,...p,horizontalScrolling:f}),this.disposables.add(m),this.contextKeyService=createScopedContextKeyService(c,this),this.disposables.add(createScrollObserver(this.contextKeyService,this)),this.listSupportsMultiSelect=WorkbenchListSupportsMultiSelectContextKey.bindTo(this.contextKeyService),this.listSupportsMultiSelect.set(l.multipleSelectionSupport!==!1),WorkbenchListSelectionNavigation.bindTo(this.contextKeyService).set(!!l.selectionNavigation),this.listHasSelectionOrFocus=WorkbenchListHasSelectionOrFocus.bindTo(this.contextKeyService),this.listDoubleSelection=WorkbenchListDoubleSelection.bindTo(this.contextKeyService),this.listMultiSelection=WorkbenchListMultiSelection.bindTo(this.contextKeyService),this.horizontalScrolling=l.horizontalScrolling,this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(u),this.disposables.add(this.contextKeyService),this.disposables.add(d.register(this)),this.updateStyles(l.overrideStyles),this.disposables.add(this.onDidChangeSelection(()=>{const C=this.getSelection(),b=this.getFocus();this.contextKeyService.bufferChangeEvents(()=>{this.listHasSelectionOrFocus.set(C.length>0||b.length>0),this.listMultiSelection.set(C.length>1),this.listDoubleSelection.set(C.length===2)})})),this.disposables.add(this.onDidChangeFocus(()=>{const C=this.getSelection(),b=this.getFocus();this.listHasSelectionOrFocus.set(C.length>0||b.length>0)})),this.disposables.add(u.onDidChangeConfiguration(C=>{C.affectsConfiguration(multiSelectModifierSettingKey)&&(this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(u));let b={};if(C.affectsConfiguration(horizontalScrollingKey)&&this.horizontalScrolling===void 0){const v=!!u.getValue(horizontalScrollingKey);b={...b,horizontalScrolling:v}}if(C.affectsConfiguration(scrollByPageKey)){const v=!!u.getValue(scrollByPageKey);b={...b,scrollByPage:v}}if(C.affectsConfiguration(listSmoothScrolling)){const v=!!u.getValue(listSmoothScrolling);b={...b,smoothScrolling:v}}if(C.affectsConfiguration(mouseWheelScrollSensitivityKey)){const v=u.getValue(mouseWheelScrollSensitivityKey);b={...b,mouseWheelScrollSensitivity:v}}if(C.affectsConfiguration(fastScrollSensitivityKey)){const v=u.getValue(fastScrollSensitivityKey);b={...b,fastScrollSensitivity:v}}Object.keys(b).length>0&&this.updateOptions(b)})),this.navigator=new TableResourceNavigator(this,{configurationService:u,...l}),this.disposables.add(this.navigator)}updateOptions(e){super.updateOptions(e),e.overrideStyles!==void 0&&this.updateStyles(e.overrideStyles),e.multipleSelectionSupport!==void 0&&this.listSupportsMultiSelect.set(!!e.multipleSelectionSupport)}updateStyles(e){this.style(e?getListStyles(e):defaultListStyles)}dispose(){this.disposables.dispose(),super.dispose()}};WorkbenchTable=__decorate$1V([__param$1U(6,IContextKeyService),__param$1U(7,IListService),__param$1U(8,IConfigurationService),__param$1U(9,IInstantiationService)],WorkbenchTable);class ResourceNavigator extends Disposable{constructor(e,t){super(),this.widget=e,this._onDidOpen=this._register(new Emitter$1),this.onDidOpen=this._onDidOpen.event,this._register(Event$1.filter(this.widget.onDidChangeSelection,s=>isKeyboardEvent(s.browserEvent))(s=>this.onSelectionFromKeyboard(s))),this._register(this.widget.onPointer(s=>this.onPointer(s.element,s.browserEvent))),this._register(this.widget.onMouseDblClick(s=>this.onMouseDblClick(s.element,s.browserEvent))),typeof(t==null?void 0:t.openOnSingleClick)!="boolean"&&(t!=null&&t.configurationService)?(this.openOnSingleClick=(t==null?void 0:t.configurationService.getValue(openModeSettingKey))!=="doubleClick",this._register(t==null?void 0:t.configurationService.onDidChangeConfiguration(s=>{s.affectsConfiguration(openModeSettingKey)&&(this.openOnSingleClick=(t==null?void 0:t.configurationService.getValue(openModeSettingKey))!=="doubleClick")}))):this.openOnSingleClick=(t==null?void 0:t.openOnSingleClick)??!0}onSelectionFromKeyboard(e){if(e.elements.length!==1)return;const t=e.browserEvent,s=typeof t.preserveFocus=="boolean"?t.preserveFocus:!0,o=typeof t.pinned=="boolean"?t.pinned:!s,r=!1;this._open(this.getSelectedElement(),s,o,r,e.browserEvent)}onPointer(e,t){if(!this.openOnSingleClick||t.detail===2)return;const o=t.button===1,r=!0,l=o,c=t.ctrlKey||t.metaKey||t.altKey;this._open(e,r,l,c,t)}onMouseDblClick(e,t){if(!t)return;const s=t.target;if(s.classList.contains("monaco-tl-twistie")||s.classList.contains("monaco-icon-label")&&s.classList.contains("folder-icon")&&t.offsetX<16)return;const r=!1,l=!0,c=t.ctrlKey||t.metaKey||t.altKey;this._open(e,r,l,c,t)}_open(e,t,s,o,r){e&&this._onDidOpen.fire({editorOptions:{preserveFocus:t,pinned:s,revealIfVisible:!0},sideBySide:o,element:e,browserEvent:r})}}class ListResourceNavigator extends ResourceNavigator{constructor(e,t){super(e,t),this.widget=e}getSelectedElement(){return this.widget.getSelectedElements()[0]}}class TableResourceNavigator extends ResourceNavigator{constructor(e,t){super(e,t)}getSelectedElement(){return this.widget.getSelectedElements()[0]}}class TreeResourceNavigator extends ResourceNavigator{constructor(e,t){super(e,t)}getSelectedElement(){return this.widget.getSelection()[0]??void 0}}function createKeyboardNavigationEventFilter(a){let e=!1;return t=>{if(t.toKeyCodeChord().isModifierKey())return!1;if(e)return e=!1,!1;const s=a.softDispatch(t,t.target);return s.kind===1?(e=!0,!1):(e=!1,s.kind===0)}}let WorkbenchObjectTree=class extends ObjectTree{get onDidOpen(){return this.internals.onDidOpen}constructor(e,t,s,o,r,l,c,d,u){const{options:g,getTypeNavigationMode:f,disposable:p}=l.invokeFunction(workbenchTreeDataPreamble,r);super(e,t,s,o,g),this.disposables.add(p),this.internals=new WorkbenchTreeInternals(this,r,f,r.overrideStyles,c,d,u),this.disposables.add(this.internals)}updateOptions(e){super.updateOptions(e),this.internals.updateOptions(e)}};WorkbenchObjectTree=__decorate$1V([__param$1U(5,IInstantiationService),__param$1U(6,IContextKeyService),__param$1U(7,IListService),__param$1U(8,IConfigurationService)],WorkbenchObjectTree);let WorkbenchCompressibleObjectTree=class extends CompressibleObjectTree{constructor(e,t,s,o,r,l,c,d,u){const{options:g,getTypeNavigationMode:f,disposable:p}=l.invokeFunction(workbenchTreeDataPreamble,r);super(e,t,s,o,g),this.disposables.add(p),this.internals=new WorkbenchTreeInternals(this,r,f,r.overrideStyles,c,d,u),this.disposables.add(this.internals)}updateOptions(e={}){super.updateOptions(e),e.overrideStyles&&this.internals.updateStyleOverrides(e.overrideStyles),this.internals.updateOptions(e)}};WorkbenchCompressibleObjectTree=__decorate$1V([__param$1U(5,IInstantiationService),__param$1U(6,IContextKeyService),__param$1U(7,IListService),__param$1U(8,IConfigurationService)],WorkbenchCompressibleObjectTree);let WorkbenchDataTree=class extends DataTree{constructor(e,t,s,o,r,l,c,d,u,g){const{options:f,getTypeNavigationMode:p,disposable:m}=c.invokeFunction(workbenchTreeDataPreamble,l);super(e,t,s,o,r,f),this.disposables.add(m),this.internals=new WorkbenchTreeInternals(this,l,p,l.overrideStyles,d,u,g),this.disposables.add(this.internals)}updateOptions(e={}){super.updateOptions(e),e.overrideStyles!==void 0&&this.internals.updateStyleOverrides(e.overrideStyles),this.internals.updateOptions(e)}};WorkbenchDataTree=__decorate$1V([__param$1U(6,IInstantiationService),__param$1U(7,IContextKeyService),__param$1U(8,IListService),__param$1U(9,IConfigurationService)],WorkbenchDataTree);let WorkbenchAsyncDataTree=class extends AsyncDataTree{get onDidOpen(){return this.internals.onDidOpen}constructor(e,t,s,o,r,l,c,d,u,g){const{options:f,getTypeNavigationMode:p,disposable:m}=c.invokeFunction(workbenchTreeDataPreamble,l);super(e,t,s,o,r,f),this.disposables.add(m),this.internals=new WorkbenchTreeInternals(this,l,p,l.overrideStyles,d,u,g),this.disposables.add(this.internals)}updateOptions(e={}){super.updateOptions(e),e.overrideStyles&&this.internals.updateStyleOverrides(e.overrideStyles),this.internals.updateOptions(e)}};WorkbenchAsyncDataTree=__decorate$1V([__param$1U(6,IInstantiationService),__param$1U(7,IContextKeyService),__param$1U(8,IListService),__param$1U(9,IConfigurationService)],WorkbenchAsyncDataTree);let WorkbenchCompressibleAsyncDataTree=class extends CompressibleAsyncDataTree{constructor(e,t,s,o,r,l,c,d,u,g,f){const{options:p,getTypeNavigationMode:m,disposable:_}=d.invokeFunction(workbenchTreeDataPreamble,c);super(e,t,s,o,r,l,p),this.disposables.add(_),this.internals=new WorkbenchTreeInternals(this,c,m,c.overrideStyles,u,g,f),this.disposables.add(this.internals)}updateOptions(e){super.updateOptions(e),this.internals.updateOptions(e)}};WorkbenchCompressibleAsyncDataTree=__decorate$1V([__param$1U(7,IInstantiationService),__param$1U(8,IContextKeyService),__param$1U(9,IListService),__param$1U(10,IConfigurationService)],WorkbenchCompressibleAsyncDataTree);function getDefaultTreeFindMode(a){const e=a.getValue(defaultFindModeSettingKey);if(e==="highlight")return TreeFindMode.Highlight;if(e==="filter")return TreeFindMode.Filter;const t=a.getValue(keyboardNavigationSettingKey);if(t==="simple"||t==="highlight")return TreeFindMode.Highlight;if(t==="filter")return TreeFindMode.Filter}function getDefaultTreeFindMatchType(a){const e=a.getValue(defaultFindMatchTypeSettingKey);if(e==="fuzzy")return TreeFindMatchType.Fuzzy;if(e==="contiguous")return TreeFindMatchType.Contiguous}function workbenchTreeDataPreamble(a,e){const t=a.get(IConfigurationService),s=a.get(IContextViewService),o=a.get(IContextKeyService),r=a.get(IInstantiationService),l=()=>{const p=o.getContextKeyValue(WorkbenchListTypeNavigationModeKey);if(p==="automatic")return TypeNavigationMode.Automatic;if(p==="trigger"||o.getContextKeyValue(WorkbenchListAutomaticKeyboardNavigationLegacyKey)===!1)return TypeNavigationMode.Trigger;const _=t.getValue(typeNavigationModeSettingKey);if(_==="automatic")return TypeNavigationMode.Automatic;if(_==="trigger")return TypeNavigationMode.Trigger},c=e.horizontalScrolling!==void 0?e.horizontalScrolling:!!t.getValue(horizontalScrollingKey),[d,u]=r.invokeFunction(toWorkbenchListOptions,e),g=e.paddingBottom,f=e.renderIndentGuides!==void 0?e.renderIndentGuides:t.getValue(treeRenderIndentGuidesKey);return{getTypeNavigationMode:l,disposable:u,options:{keyboardSupport:!1,...d,indent:typeof t.getValue(treeIndentKey)=="number"?t.getValue(treeIndentKey):void 0,renderIndentGuides:f,smoothScrolling:!!t.getValue(listSmoothScrolling),defaultFindMode:getDefaultTreeFindMode(t),defaultFindMatchType:getDefaultTreeFindMatchType(t),horizontalScrolling:c,scrollByPage:!!t.getValue(scrollByPageKey),paddingBottom:g,hideTwistiesOfChildlessElements:e.hideTwistiesOfChildlessElements,expandOnlyOnTwistieClick:e.expandOnlyOnTwistieClick??t.getValue(treeExpandMode)==="doubleClick",contextViewProvider:s,findWidgetStyles:defaultFindWidgetStyles,enableStickyScroll:!!t.getValue(treeStickyScroll),stickyScrollMaxItemCount:Number(t.getValue(treeStickyScrollMaxElements))}}}let WorkbenchTreeInternals=class{get onDidOpen(){return this.navigator.onDidOpen}constructor(e,t,s,o,r,l,c){this.tree=e,this.disposables=[],this.contextKeyService=createScopedContextKeyService(r,e),this.disposables.push(createScrollObserver(this.contextKeyService,e)),this.listSupportsMultiSelect=WorkbenchListSupportsMultiSelectContextKey.bindTo(this.contextKeyService),this.listSupportsMultiSelect.set(t.multipleSelectionSupport!==!1),WorkbenchListSelectionNavigation.bindTo(this.contextKeyService).set(!!t.selectionNavigation),this.listSupportFindWidget=WorkbenchListSupportsFind.bindTo(this.contextKeyService),this.listSupportFindWidget.set(t.findWidgetEnabled??!0),this.hasSelectionOrFocus=WorkbenchListHasSelectionOrFocus.bindTo(this.contextKeyService),this.hasDoubleSelection=WorkbenchListDoubleSelection.bindTo(this.contextKeyService),this.hasMultiSelection=WorkbenchListMultiSelection.bindTo(this.contextKeyService),this.treeElementCanCollapse=WorkbenchTreeElementCanCollapse.bindTo(this.contextKeyService),this.treeElementHasParent=WorkbenchTreeElementHasParent.bindTo(this.contextKeyService),this.treeElementCanExpand=WorkbenchTreeElementCanExpand.bindTo(this.contextKeyService),this.treeElementHasChild=WorkbenchTreeElementHasChild.bindTo(this.contextKeyService),this.treeFindOpen=WorkbenchTreeFindOpen.bindTo(this.contextKeyService),this.treeStickyScrollFocused=WorkbenchTreeStickyScrollFocused.bindTo(this.contextKeyService),this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(c),this.updateStyleOverrides(o);const u=()=>{const f=e.getFocus()[0];if(!f)return;const p=e.getNode(f);this.treeElementCanCollapse.set(p.collapsible&&!p.collapsed),this.treeElementHasParent.set(!!e.getParentElement(f)),this.treeElementCanExpand.set(p.collapsible&&p.collapsed),this.treeElementHasChild.set(!!e.getFirstElementChild(f))},g=new Set;g.add(WorkbenchListTypeNavigationModeKey),g.add(WorkbenchListAutomaticKeyboardNavigationLegacyKey),this.disposables.push(this.contextKeyService,l.register(e),e.onDidChangeSelection(()=>{const f=e.getSelection(),p=e.getFocus();this.contextKeyService.bufferChangeEvents(()=>{this.hasSelectionOrFocus.set(f.length>0||p.length>0),this.hasMultiSelection.set(f.length>1),this.hasDoubleSelection.set(f.length===2)})}),e.onDidChangeFocus(()=>{const f=e.getSelection(),p=e.getFocus();this.hasSelectionOrFocus.set(f.length>0||p.length>0),u()}),e.onDidChangeCollapseState(u),e.onDidChangeModel(u),e.onDidChangeFindOpenState(f=>this.treeFindOpen.set(f)),e.onDidChangeStickyScrollFocused(f=>this.treeStickyScrollFocused.set(f)),c.onDidChangeConfiguration(f=>{let p={};if(f.affectsConfiguration(multiSelectModifierSettingKey)&&(this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(c)),f.affectsConfiguration(treeIndentKey)){const m=c.getValue(treeIndentKey);p={...p,indent:m}}if(f.affectsConfiguration(treeRenderIndentGuidesKey)&&t.renderIndentGuides===void 0){const m=c.getValue(treeRenderIndentGuidesKey);p={...p,renderIndentGuides:m}}if(f.affectsConfiguration(listSmoothScrolling)){const m=!!c.getValue(listSmoothScrolling);p={...p,smoothScrolling:m}}if(f.affectsConfiguration(defaultFindModeSettingKey)||f.affectsConfiguration(keyboardNavigationSettingKey)){const m=getDefaultTreeFindMode(c);p={...p,defaultFindMode:m}}if(f.affectsConfiguration(typeNavigationModeSettingKey)||f.affectsConfiguration(keyboardNavigationSettingKey)){const m=s();p={...p,typeNavigationMode:m}}if(f.affectsConfiguration(defaultFindMatchTypeSettingKey)){const m=getDefaultTreeFindMatchType(c);p={...p,defaultFindMatchType:m}}if(f.affectsConfiguration(horizontalScrollingKey)&&t.horizontalScrolling===void 0){const m=!!c.getValue(horizontalScrollingKey);p={...p,horizontalScrolling:m}}if(f.affectsConfiguration(scrollByPageKey)){const m=!!c.getValue(scrollByPageKey);p={...p,scrollByPage:m}}if(f.affectsConfiguration(treeExpandMode)&&t.expandOnlyOnTwistieClick===void 0&&(p={...p,expandOnlyOnTwistieClick:c.getValue(treeExpandMode)==="doubleClick"}),f.affectsConfiguration(treeStickyScroll)){const m=c.getValue(treeStickyScroll);p={...p,enableStickyScroll:m}}if(f.affectsConfiguration(treeStickyScrollMaxElements)){const m=Math.max(1,c.getValue(treeStickyScrollMaxElements));p={...p,stickyScrollMaxItemCount:m}}if(f.affectsConfiguration(mouseWheelScrollSensitivityKey)){const m=c.getValue(mouseWheelScrollSensitivityKey);p={...p,mouseWheelScrollSensitivity:m}}if(f.affectsConfiguration(fastScrollSensitivityKey)){const m=c.getValue(fastScrollSensitivityKey);p={...p,fastScrollSensitivity:m}}Object.keys(p).length>0&&e.updateOptions(p)}),this.contextKeyService.onDidChangeContext(f=>{f.affectsSome(g)&&e.updateOptions({typeNavigationMode:s()})})),this.navigator=new TreeResourceNavigator(e,{configurationService:c,...t}),this.disposables.push(this.navigator)}updateOptions(e){e.multipleSelectionSupport!==void 0&&this.listSupportsMultiSelect.set(!!e.multipleSelectionSupport)}updateStyleOverrides(e){this.tree.style(e?getListStyles(e):defaultListStyles)}dispose(){this.disposables=dispose(this.disposables)}};WorkbenchTreeInternals=__decorate$1V([__param$1U(4,IContextKeyService),__param$1U(5,IListService),__param$1U(6,IConfigurationService)],WorkbenchTreeInternals);const configurationRegistry=Registry.as(Extensions$6.Configuration);configurationRegistry.registerConfiguration({id:"workbench",order:7,title:localize(1688,"Workbench"),type:"object",properties:{[multiSelectModifierSettingKey]:{type:"string",enum:["ctrlCmd","alt"],markdownEnumDescriptions:[localize(1689,"Maps to `Control` on Windows and Linux and to `Command` on macOS."),localize(1690,"Maps to `Alt` on Windows and Linux and to `Option` on macOS.")],default:"ctrlCmd",description:localize(1691,"The modifier to be used to add an item in trees and lists to a multi-selection with the mouse (for example in the explorer, open editors and scm view). The 'Open to Side' mouse gestures - if supported - will adapt such that they do not conflict with the multiselect modifier.")},[openModeSettingKey]:{type:"string",enum:["singleClick","doubleClick"],default:"singleClick",description:localize(1692,"Controls how to open items in trees and lists using the mouse (if supported). Note that some trees and lists might choose to ignore this setting if it is not applicable.")},[horizontalScrollingKey]:{type:"boolean",default:!1,description:localize(1693,"Controls whether lists and trees support horizontal scrolling in the workbench. Warning: turning on this setting has a performance implication.")},[scrollByPageKey]:{type:"boolean",default:!1,description:localize(1694,"Controls whether clicks in the scrollbar scroll page by page.")},[treeIndentKey]:{type:"number",default:8,minimum:4,maximum:40,description:localize(1695,"Controls tree indentation in pixels.")},[treeRenderIndentGuidesKey]:{type:"string",enum:["none","onHover","always"],default:"onHover",description:localize(1696,"Controls whether the tree should render indent guides.")},[listSmoothScrolling]:{type:"boolean",default:!1,description:localize(1697,"Controls whether lists and trees have smooth scrolling.")},[mouseWheelScrollSensitivityKey]:{type:"number",default:1,markdownDescription:localize(1698,"A multiplier to be used on the `deltaX` and `deltaY` of mouse wheel scroll events.")},[fastScrollSensitivityKey]:{type:"number",default:5,markdownDescription:localize(1699,"Scrolling speed multiplier when pressing `Alt`.")},[defaultFindModeSettingKey]:{type:"string",enum:["highlight","filter"],enumDescriptions:[localize(1700,"Highlight elements when searching. Further up and down navigation will traverse only the highlighted elements."),localize(1701,"Filter elements when searching.")],default:"highlight",description:localize(1702,"Controls the default find mode for lists and trees in the workbench.")},[keyboardNavigationSettingKey]:{type:"string",enum:["simple","highlight","filter"],enumDescriptions:[localize(1703,"Simple keyboard navigation focuses elements which match the keyboard input. Matching is done only on prefixes."),localize(1704,"Highlight keyboard navigation highlights elements which match the keyboard input. Further up and down navigation will traverse only the highlighted elements."),localize(1705,"Filter keyboard navigation will filter out and hide all the elements which do not match the keyboard input.")],default:"highlight",description:localize(1706,"Controls the keyboard navigation style for lists and trees in the workbench. Can be simple, highlight and filter."),deprecated:!0,deprecationMessage:localize(1707,"Please use 'workbench.list.defaultFindMode' and	'workbench.list.typeNavigationMode' instead.")},[defaultFindMatchTypeSettingKey]:{type:"string",enum:["fuzzy","contiguous"],enumDescriptions:[localize(1708,"Use fuzzy matching when searching."),localize(1709,"Use contiguous matching when searching.")],default:"fuzzy",description:localize(1710,"Controls the type of matching used when searching lists and trees in the workbench.")},[treeExpandMode]:{type:"string",enum:["singleClick","doubleClick"],default:"singleClick",description:localize(1711,"Controls how tree folders are expanded when clicking the folder names. Note that some trees and lists might choose to ignore this setting if it is not applicable.")},[treeStickyScroll]:{type:"boolean",default:!0,description:localize(1712,"Controls whether sticky scrolling is enabled in trees.")},[treeStickyScrollMaxElements]:{type:"number",minimum:1,default:7,markdownDescription:localize(1713,"Controls the number of sticky elements displayed in the tree when {0} is enabled.","`#workbench.tree.enableStickyScroll#`")},[typeNavigationModeSettingKey]:{type:"string",enum:["automatic","trigger"],default:"automatic",markdownDescription:localize(1714,"Controls how type navigation works in lists and trees in the workbench. When set to `trigger`, type navigation begins once the `list.triggerTypeNavigation` command is run.")}}});class OneReference{constructor(e,t,s,o){this.isProviderFirst=e,this.parent=t,this.link=s,this._rangeCallback=o,this.id=defaultGenerator.nextId()}get uri(){return this.link.uri}get range(){return this._range??this.link.targetSelectionRange??this.link.range}set range(e){this._range=e,this._rangeCallback(this)}get ariaMessage(){var t;const e=(t=this.parent.getPreview(this))==null?void 0:t.preview(this.range);return e?localize(1083,"{0} in {1} on line {2} at column {3}",e.value,basename(this.uri),this.range.startLineNumber,this.range.startColumn):localize(1082,"in {0} on line {1} at column {2}",basename(this.uri),this.range.startLineNumber,this.range.startColumn)}}class FilePreview{constructor(e){this._modelReference=e}dispose(){this._modelReference.dispose()}preview(e,t=8){const s=this._modelReference.object.textEditorModel;if(!s)return;const{startLineNumber:o,startColumn:r,endLineNumber:l,endColumn:c}=e,d=s.getWordUntilPosition({lineNumber:o,column:r-t}),u=new Range$2(o,d.startColumn,o,r),g=new Range$2(l,c,l,1073741824),f=s.getValueInRange(u).replace(/^\s+/,""),p=s.getValueInRange(e),m=s.getValueInRange(g).replace(/\s+$/,"");return{value:f+p+m,highlight:{start:f.length,end:f.length+p.length}}}}class FileReferences{constructor(e,t){this.parent=e,this.uri=t,this.children=[],this._previews=new ResourceMap}dispose(){dispose(this._previews.values()),this._previews.clear()}getPreview(e){return this._previews.get(e.uri)}get ariaMessage(){const e=this.children.length;return e===1?localize(1084,"1 symbol in {0}, full path {1}",basename(this.uri),this.uri.fsPath):localize(1085,"{0} symbols in {1}, full path {2}",e,basename(this.uri),this.uri.fsPath)}async resolve(e){if(this._previews.size!==0)return this;for(const t of this.children)if(!this._previews.has(t.uri))try{const s=await e.createModelReference(t.uri);this._previews.set(t.uri,new FilePreview(s))}catch(s){onUnexpectedError(s)}return this}}class ReferencesModel{constructor(e,t){this.groups=[],this.references=[],this._onDidChangeReferenceRange=new Emitter$1,this.onDidChangeReferenceRange=this._onDidChangeReferenceRange.event,this._links=e,this._title=t;const[s]=e;e.sort(ReferencesModel._compareReferences);let o;for(const r of e)if((!o||!extUri.isEqual(o.uri,r.uri,!0))&&(o=new FileReferences(this,r.uri),this.groups.push(o)),o.children.length===0||ReferencesModel._compareReferences(r,o.children[o.children.length-1])!==0){const l=new OneReference(s===r,o,r,c=>this._onDidChangeReferenceRange.fire(c));this.references.push(l),o.children.push(l)}}dispose(){dispose(this.groups),this._onDidChangeReferenceRange.dispose(),this.groups.length=0}clone(){return new ReferencesModel(this._links,this._title)}get title(){return this._title}get isEmpty(){return this.groups.length===0}get ariaMessage(){return this.isEmpty?localize(1086,"No results found"):this.references.length===1?localize(1087,"Found 1 symbol in {0}",this.references[0].uri.fsPath):this.groups.length===1?localize(1088,"Found {0} symbols in {1}",this.references.length,this.groups[0].uri.fsPath):localize(1089,"Found {0} symbols in {1} files",this.references.length,this.groups.length)}nextOrPreviousReference(e,t){const{parent:s}=e;let o=s.children.indexOf(e);const r=s.children.length,l=s.parent.groups.length;return l===1||t&&o+1<r||!t&&o>0?(t?o=(o+1)%r:o=(o+r-1)%r,s.children[o]):(o=s.parent.groups.indexOf(s),t?(o=(o+1)%l,s.parent.groups[o].children[0]):(o=(o+l-1)%l,s.parent.groups[o].children[s.parent.groups[o].children.length-1]))}nearestReference(e,t){const s=this.references.map((o,r)=>({idx:r,prefixLen:commonPrefixLength(o.uri.toString(),e.toString()),offsetDist:Math.abs(o.range.startLineNumber-t.lineNumber)*100+Math.abs(o.range.startColumn-t.column)})).sort((o,r)=>o.prefixLen>r.prefixLen?-1:o.prefixLen<r.prefixLen?1:o.offsetDist<r.offsetDist?-1:o.offsetDist>r.offsetDist?1:0)[0];if(s)return this.references[s.idx]}referenceAt(e,t){for(const s of this.references)if(s.uri.toString()===e.toString()&&Range$2.containsPosition(s.range,t))return s}firstReference(){for(const e of this.references)if(e.isProviderFirst)return e;return this.references[0]}static _compareReferences(e,t){return extUri.compare(e.uri,t.uri)||Range$2.compareRangesUsingStarts(e.range,t.range)}}const referencesWidget="",countBadge="";class CountBadge extends Disposable{constructor(e,t,s){super(),this.options=t,this.styles=s,this.count=0,this.hover=this._register(new MutableDisposable),this.element=append$2(e,$$l(".monaco-count-badge")),this._register(toDisposable(()=>e.removeChild(this.element))),this.countFormat=this.options.countFormat||"{0}",this.titleFormat=this.options.titleFormat||"",this.setCount(this.options.count||0),this.updateHover()}setCount(e){this.count=e,this.render()}setTitleFormat(e){this.titleFormat=e,this.updateHover(),this.render()}updateHover(){this.titleFormat!==""&&!this.hover.value?this.hover.value=getBaseLayerHoverDelegate().setupDelayedHoverAtMouse(this.element,()=>({content:format(this.titleFormat,this.count),appearance:{compact:!0}})):this.titleFormat===""&&this.hover.value&&(this.hover.value=void 0)}render(){this.element.textContent=format(this.countFormat,this.count),this.element.style.backgroundColor=this.styles.badgeBackground??"",this.element.style.color=this.styles.badgeForeground??"",this.styles.badgeBorder&&(this.element.style.border=`1px solid ${this.styles.badgeBorder}`)}}class HighlightedLabel extends Disposable{constructor(e,t){super(),this.options=t,this.text="",this.title="",this.highlights=[],this.didEverRender=!1,this.supportIcons=(t==null?void 0:t.supportIcons)??!1,this.domNode=append$2(e,$$l("span.monaco-highlighted-label"))}get element(){return this.domNode}set(e,t=[],s="",o){e||(e=""),o&&(e=HighlightedLabel.escapeNewLines(e,t)),!(this.didEverRender&&this.text===e&&this.title===s&&equals(this.highlights,t))&&(this.text=e,this.title=s,this.highlights=t,this.render())}render(){var s;const e=[];let t=0;for(const o of this.highlights){if(o.end===o.start)continue;if(t<o.start){const c=this.text.substring(t,o.start);this.supportIcons?e.push(...renderLabelWithIcons(c)):e.push(c),t=o.start}const r=this.text.substring(t,o.end),l=$$l("span.highlight",void 0,...this.supportIcons?renderLabelWithIcons(r):[r]);o.extraClasses&&l.classList.add(...o.extraClasses),e.push(l),t=o.end}if(t<this.text.length){const o=this.text.substring(t);this.supportIcons?e.push(...renderLabelWithIcons(o)):e.push(o)}if(reset(this.domNode,...e),!this.customHover&&this.title!==""){const o=((s=this.options)==null?void 0:s.hoverDelegate)??getDefaultHoverDelegate("mouse");this.customHover=this._register(getBaseLayerHoverDelegate().setupManagedHover(o,this.domNode,this.title))}else this.customHover&&this.customHover.update(this.title);this.didEverRender=!0}static escapeNewLines(e,t){let s=0,o=0;return e.replace(/\r\n|\r|\n/g,(r,l)=>{o=r===`\r
`?-1:0,l+=s;for(const c of t)c.end<=l||(c.start>=l&&(c.start+=o),c.end>=l&&(c.end+=o));return s+=o,"⏎"})}}const iconlabel="";class FastLabelNode{constructor(e){this._element=e}get element(){return this._element}set textContent(e){this.disposed||e===this._textContent||(this._textContent=e,this._element.textContent=e)}set classNames(e){this.disposed||equals(e,this._classNames)||(this._classNames=e,this._element.classList.value="",this._element.classList.add(...e))}set empty(e){this.disposed||e===this._empty||(this._empty=e,this._element.style.marginLeft=e?"0":"")}dispose(){this.disposed=!0}}class IconLabel extends Disposable{constructor(e,t){super(),this.customHovers=new Map,this.creationOptions=t,this.domNode=this._register(new FastLabelNode(append$2(e,$$l(".monaco-icon-label")))),this.labelContainer=append$2(this.domNode.element,$$l(".monaco-icon-label-container")),this.nameContainer=append$2(this.labelContainer,$$l("span.monaco-icon-name-container")),t!=null&&t.supportHighlights||t!=null&&t.supportIcons?this.nameNode=this._register(new LabelWithHighlights(this.nameContainer,!!t.supportIcons)):this.nameNode=new Label(this.nameContainer),this.hoverDelegate=(t==null?void 0:t.hoverDelegate)??getDefaultHoverDelegate("mouse")}get element(){return this.domNode.element}setLabel(e,t,s){const o=["monaco-icon-label"],r=["monaco-icon-label-container"];let l="";s&&(s.extraClasses&&o.push(...s.extraClasses),s.italic&&o.push("italic"),s.strikethrough&&o.push("strikethrough"),s.disabledCommand&&r.push("disabled"),s.title&&(typeof s.title=="string"?l+=s.title:l+=e));const c=this.domNode.element.querySelector(".monaco-icon-label-iconpath");if(s!=null&&s.iconPath){let d;!c||!isHTMLElement(c)?(d=$$l(".monaco-icon-label-iconpath"),this.domNode.element.prepend(d)):d=c,d.style.backgroundImage=asCSSUrl(s==null?void 0:s.iconPath),d.style.backgroundRepeat="no-repeat",d.style.backgroundPosition="center",d.style.backgroundSize="contain"}else c&&c.remove();if(this.domNode.classNames=o,this.domNode.element.setAttribute("aria-label",l),this.labelContainer.classList.value="",this.labelContainer.classList.add(...r),this.setupHover(s!=null&&s.descriptionTitle?this.labelContainer:this.element,s==null?void 0:s.title),this.nameNode.setLabel(e,s),t||this.descriptionNode){const d=this.getOrCreateDescriptionNode();d instanceof HighlightedLabel?(d.set(t||"",s?s.descriptionMatches:void 0,void 0,s==null?void 0:s.labelEscapeNewLines),this.setupHover(d.element,s==null?void 0:s.descriptionTitle)):(d.textContent=t&&(s!=null&&s.labelEscapeNewLines)?HighlightedLabel.escapeNewLines(t,[]):t||"",this.setupHover(d.element,(s==null?void 0:s.descriptionTitle)||""),d.empty=!t)}if(s!=null&&s.suffix||this.suffixNode){const d=this.getOrCreateSuffixNode();d.textContent=(s==null?void 0:s.suffix)??""}}setupHover(e,t){var l;const s=this.customHovers.get(e);if(s&&(s.dispose(),this.customHovers.delete(e)),!t){e.removeAttribute("title");return}let o=e;if((l=this.creationOptions)!=null&&l.hoverTargetOverride){if(!isAncestor$1(e,this.creationOptions.hoverTargetOverride))throw new Error("hoverTargetOverrride must be an ancestor of the htmlElement");o=this.creationOptions.hoverTargetOverride}const r=getBaseLayerHoverDelegate().setupManagedHover(this.hoverDelegate,o,t);r&&this.customHovers.set(e,r)}dispose(){super.dispose();for(const e of this.customHovers.values())e.dispose();this.customHovers.clear()}getOrCreateSuffixNode(){if(!this.suffixNode){const e=this._register(new FastLabelNode(after(this.nameContainer,$$l("span.monaco-icon-suffix-container"))));this.suffixNode=this._register(new FastLabelNode(append$2(e.element,$$l("span.label-suffix"))))}return this.suffixNode}getOrCreateDescriptionNode(){var e;if(!this.descriptionNode){const t=this._register(new FastLabelNode(append$2(this.labelContainer,$$l("span.monaco-icon-description-container"))));(e=this.creationOptions)!=null&&e.supportDescriptionHighlights?this.descriptionNode=this._register(new HighlightedLabel(append$2(t.element,$$l("span.label-description")),{supportIcons:!!this.creationOptions.supportIcons})):this.descriptionNode=this._register(new FastLabelNode(append$2(t.element,$$l("span.label-description"))))}return this.descriptionNode}}class Label{constructor(e){this.container=e,this.label=void 0,this.singleLabel=void 0}setLabel(e,t){if(!(this.label===e&&equals(this.options,t)))if(this.label=e,this.options=t,typeof e=="string")this.singleLabel||(this.container.textContent="",this.container.classList.remove("multiple"),this.singleLabel=append$2(this.container,$$l("a.label-name",{id:t==null?void 0:t.domId}))),this.singleLabel.textContent=e;else{this.container.textContent="",this.container.classList.add("multiple"),this.singleLabel=void 0;for(let s=0;s<e.length;s++){const o=e[s],r=(t==null?void 0:t.domId)&&`${t==null?void 0:t.domId}_${s}`;append$2(this.container,$$l("a.label-name",{id:r,"data-icon-label-count":e.length,"data-icon-label-index":s,role:"treeitem"},o)),s<e.length-1&&append$2(this.container,$$l("span.label-separator",void 0,(t==null?void 0:t.separator)||"/"))}}}}function splitMatches(a,e,t){if(!t)return;let s=0;return a.map(o=>{const r={start:s,end:s+o.length},l=t.map(c=>Range$1.intersect(r,c)).filter(c=>!Range$1.isEmpty(c)).map(({start:c,end:d})=>({start:c-s,end:d-s}));return s=r.end+e.length,l})}class LabelWithHighlights extends Disposable{constructor(e,t){super(),this.container=e,this.supportIcons=t,this.label=void 0,this.singleLabel=void 0}setLabel(e,t){if(!(this.label===e&&equals(this.options,t)))if(this.label=e,this.options=t,typeof e=="string")this.singleLabel||(this.container.textContent="",this.container.classList.remove("multiple"),this.singleLabel=this._register(new HighlightedLabel(append$2(this.container,$$l("a.label-name",{id:t==null?void 0:t.domId})),{supportIcons:this.supportIcons}))),this.singleLabel.set(e,t==null?void 0:t.matches,void 0,t==null?void 0:t.labelEscapeNewLines);else{this.container.textContent="",this.container.classList.add("multiple"),this.singleLabel=void 0;const s=(t==null?void 0:t.separator)||"/",o=splitMatches(e,s,t==null?void 0:t.matches);for(let r=0;r<e.length;r++){const l=e[r],c=o?o[r]:void 0,d=(t==null?void 0:t.domId)&&`${t==null?void 0:t.domId}_${r}`,u=$$l("a.label-name",{id:d,"data-icon-label-count":e.length,"data-icon-label-index":r,role:"treeitem"});this._register(new HighlightedLabel(append$2(this.container,u),{supportIcons:this.supportIcons})).set(l,c,void 0,t==null?void 0:t.labelEscapeNewLines),r<e.length-1&&append$2(u,$$l("span.label-separator",void 0,s))}}}}const ILabelService=createDecorator("labelService");var __decorate$1U=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1T=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},FileReferencesRenderer_1;let DataSource=class{constructor(e){this._resolverService=e}hasChildren(e){return e instanceof ReferencesModel||e instanceof FileReferences}getChildren(e){if(e instanceof ReferencesModel)return e.groups;if(e instanceof FileReferences)return e.resolve(this._resolverService).then(t=>t.children);throw new Error("bad tree")}};DataSource=__decorate$1U([__param$1T(0,ITextModelService)],DataSource);class Delegate{getHeight(){return 23}getTemplateId(e){return e instanceof FileReferences?FileReferencesRenderer.id:OneReferenceRenderer.id}}let StringRepresentationProvider=class{constructor(e){this._keybindingService=e}getKeyboardNavigationLabel(e){var t;if(e instanceof OneReference){const s=(t=e.parent.getPreview(e))==null?void 0:t.preview(e.range);if(s)return s.value}return basename(e.uri)}};StringRepresentationProvider=__decorate$1U([__param$1T(0,IKeybindingService)],StringRepresentationProvider);class IdentityProvider{getId(e){return e instanceof OneReference?e.id:e.uri}}let FileReferencesTemplate=class extends Disposable{constructor(e,t){super(),this._labelService=t;const s=document.createElement("div");s.classList.add("reference-file"),this.file=this._register(new IconLabel(s,{supportHighlights:!0})),this.badge=this._register(new CountBadge(append$2(s,$$l(".count")),{},defaultCountBadgeStyles)),e.appendChild(s)}set(e,t){const s=dirname(e.uri);this.file.setLabel(this._labelService.getUriBasenameLabel(e.uri),this._labelService.getUriLabel(s,{relative:!0}),{title:this._labelService.getUriLabel(e.uri),matches:t});const o=e.children.length;this.badge.setCount(o),o>1?this.badge.setTitleFormat(localize(1076,"{0} references",o)):this.badge.setTitleFormat(localize(1077,"{0} reference",o))}};FileReferencesTemplate=__decorate$1U([__param$1T(1,ILabelService)],FileReferencesTemplate);var yi;let FileReferencesRenderer=(yi=class{constructor(e){this._instantiationService=e,this.templateId=FileReferencesRenderer_1.id}renderTemplate(e){return this._instantiationService.createInstance(FileReferencesTemplate,e)}renderElement(e,t,s){s.set(e.element,createMatches(e.filterData))}disposeTemplate(e){e.dispose()}},FileReferencesRenderer_1=yi,yi.id="FileReferencesRenderer",yi);FileReferencesRenderer=FileReferencesRenderer_1=__decorate$1U([__param$1T(0,IInstantiationService)],FileReferencesRenderer);class OneReferenceTemplate extends Disposable{constructor(e){super(),this.label=this._register(new HighlightedLabel(e))}set(e,t){var o;const s=(o=e.parent.getPreview(e))==null?void 0:o.preview(e.range);if(!s||!s.value)this.label.set(`${basename(e.uri)}:${e.range.startLineNumber+1}:${e.range.startColumn+1}`);else{const{value:r,highlight:l}=s;t&&!FuzzyScore.isDefault(t)?(this.label.element.classList.toggle("referenceMatch",!1),this.label.set(r,createMatches(t))):(this.label.element.classList.toggle("referenceMatch",!0),this.label.set(r,[l]))}}}const Os=class Os{constructor(){this.templateId=Os.id}renderTemplate(e){return new OneReferenceTemplate(e)}renderElement(e,t,s){s.set(e.element,e.filterData)}disposeTemplate(e){e.dispose()}};Os.id="OneReferenceRenderer";let OneReferenceRenderer=Os;class AccessibilityProvider{getWidgetAriaLabel(){return localize(1078,"References")}getAriaLabel(e){return e.ariaMessage}}var __decorate$1T=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1S=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const Ps=class Ps{constructor(e,t){this._editor=e,this._model=t,this._decorations=new Map,this._decorationIgnoreSet=new Set,this._callOnDispose=new DisposableStore,this._callOnModelChange=new DisposableStore,this._callOnDispose.add(this._editor.onDidChangeModel(()=>this._onModelChanged())),this._onModelChanged()}dispose(){this._callOnModelChange.dispose(),this._callOnDispose.dispose(),this.removeDecorations()}_onModelChanged(){this._callOnModelChange.clear();const e=this._editor.getModel();if(e){for(const t of this._model.references)if(t.uri.toString()===e.uri.toString()){this._addDecorations(t.parent);return}}}_addDecorations(e){if(!this._editor.hasModel())return;this._callOnModelChange.add(this._editor.getModel().onDidChangeDecorations(()=>this._onDecorationChanged()));const t=[],s=[];for(let o=0,r=e.children.length;o<r;o++){const l=e.children[o];this._decorationIgnoreSet.has(l.id)||l.uri.toString()===this._editor.getModel().uri.toString()&&(t.push({range:l.range,options:Ps.DecorationOptions}),s.push(o))}this._editor.changeDecorations(o=>{const r=o.deltaDecorations([],t);for(let l=0;l<r.length;l++)this._decorations.set(r[l],e.children[s[l]])})}_onDecorationChanged(){const e=[],t=this._editor.getModel();if(t){for(const[s,o]of this._decorations){const r=t.getDecorationRange(s);if(!r)continue;let l=!1;if(!Range$2.equalsRange(r,o.range)){if(Range$2.spansMultipleLines(r))l=!0;else{const c=o.range.endColumn-o.range.startColumn,d=r.endColumn-r.startColumn;c!==d&&(l=!0)}l?(this._decorationIgnoreSet.add(o.id),e.push(s)):o.range=r}}for(let s=0,o=e.length;s<o;s++)this._decorations.delete(e[s]);this._editor.removeDecorations(e)}}removeDecorations(){this._editor.removeDecorations([...this._decorations.keys()]),this._decorations.clear()}};Ps.DecorationOptions=ModelDecorationOptions.register({description:"reference-decoration",stickiness:1,className:"reference-decoration"});let DecorationsManager=Ps;class LayoutData{constructor(){this.ratio=.7,this.heightInLines=18}static fromJSON(e){let t,s;try{const o=JSON.parse(e);t=o.ratio,s=o.heightInLines}catch{}return{ratio:t||.7,heightInLines:s||18}}}class ReferencesTree extends WorkbenchAsyncDataTree{}let ReferencesDragAndDrop=class{constructor(e){this.labelService=e,this.disposables=new DisposableStore}getDragURI(e){return e instanceof FileReferences?e.uri.toString():e instanceof OneReference?withSelection(e.uri,e.range).toString():null}getDragLabel(e){return e.length===0?void 0:e.map(s=>this.labelService.getUriBasenameLabel(s.uri)).join(", ")}onDragStart(e,t){if(!t.dataTransfer)return;const o=e.elements.map(r=>this.getDragURI(r)).filter(Boolean);o.length&&(t.dataTransfer.setData(DataTransfers.RESOURCES,JSON.stringify(o)),t.dataTransfer.setData(DataTransfers.TEXT,o.join(`
`)))}onDragOver(){return!1}drop(){}dispose(){this.disposables.dispose()}};ReferencesDragAndDrop=__decorate$1T([__param$1S(0,ILabelService)],ReferencesDragAndDrop);let ReferenceWidget=class extends PeekViewWidget{constructor(e,t,s,o,r,l,c,d,u){super(e,{showFrame:!1,showArrow:!0,isResizeable:!0,isAccessible:!0,supportOnTitleClick:!0},l),this._defaultTreeKeyboardSupport=t,this.layoutData=s,this._textModelResolverService=r,this._instantiationService=l,this._peekViewService=c,this._uriLabel=d,this._keybindingService=u,this._disposeOnNewModel=new DisposableStore,this._callOnDispose=new DisposableStore,this._onDidSelectReference=new Emitter$1,this.onDidSelectReference=this._onDidSelectReference.event,this._dim=new Dimension(0,0),this._isClosing=!1,this._applyTheme(o.getColorTheme()),this._callOnDispose.add(o.onDidColorThemeChange(this._applyTheme.bind(this))),this._peekViewService.addExclusiveWidget(e,this),this.create()}get isClosing(){return this._isClosing}dispose(){this._isClosing=!0,this.setModel(void 0),this._callOnDispose.dispose(),this._disposeOnNewModel.dispose(),dispose(this._preview),dispose(this._previewNotAvailableMessage),dispose(this._tree),dispose(this._previewModelReference),this._splitView.dispose(),super.dispose()}_applyTheme(e){const t=e.getColor(peekViewBorder)||Color.transparent;this.style({arrowColor:t,frameColor:t,headerBackgroundColor:e.getColor(peekViewTitleBackground)||Color.transparent,primaryHeadingColor:e.getColor(peekViewTitleForeground),secondaryHeadingColor:e.getColor(peekViewTitleInfoForeground)})}show(e){super.show(e,this.layoutData.heightInLines||18)}focusOnReferenceTree(){this._tree.domFocus()}focusOnPreviewEditor(){this._preview.focus()}isPreviewEditorFocused(){return this._preview.hasTextFocus()}_onTitleClick(e){this._preview&&this._preview.getModel()&&this._onDidSelectReference.fire({element:this._getFocusedReference(),kind:e.ctrlKey||e.metaKey||e.altKey?"side":"open",source:"title"})}_fillBody(e){this.setCssClass("reference-zone-widget"),this._messageContainer=append$2(e,$$l("div.messages")),hide(this._messageContainer),this._splitView=new SplitView(e,{orientation:1}),this._previewContainer=append$2(e,$$l("div.preview.inline"));const t={scrollBeyondLastLine:!1,scrollbar:{verticalScrollbarSize:14,horizontal:"auto",useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,alwaysConsumeMouseWheel:!0},overviewRulerLanes:2,fixedOverflowWidgets:!0,minimap:{enabled:!1}};this._preview=this._instantiationService.createInstance(EmbeddedCodeEditorWidget,this._previewContainer,t,{},this.editor),hide(this._previewContainer),this._previewNotAvailableMessage=this._instantiationService.createInstance(TextModel,localize(1079,"no preview available"),PLAINTEXT_LANGUAGE_ID,TextModel.DEFAULT_CREATION_OPTIONS,null),this._treeContainer=append$2(e,$$l("div.ref-tree.inline"));const s={keyboardSupport:this._defaultTreeKeyboardSupport,accessibilityProvider:new AccessibilityProvider,keyboardNavigationLabelProvider:this._instantiationService.createInstance(StringRepresentationProvider),identityProvider:new IdentityProvider,openOnSingleClick:!0,selectionNavigation:!0,overrideStyles:{listBackground:peekViewResultsBackground},dnd:this._instantiationService.createInstance(ReferencesDragAndDrop)};this._defaultTreeKeyboardSupport&&this._callOnDispose.add(addStandardDisposableListener(this._treeContainer,"keydown",r=>{r.equals(9)&&(this._keybindingService.dispatchEvent(r,r.target),r.stopPropagation())},!0)),this._tree=this._instantiationService.createInstance(ReferencesTree,"ReferencesWidget",this._treeContainer,new Delegate,[this._instantiationService.createInstance(FileReferencesRenderer),this._instantiationService.createInstance(OneReferenceRenderer)],this._instantiationService.createInstance(DataSource),s),this._splitView.addView({onDidChange:Event$1.None,element:this._previewContainer,minimumSize:200,maximumSize:Number.MAX_VALUE,layout:r=>{this._preview.layout({height:this._dim.height,width:r})}},Sizing.Distribute),this._splitView.addView({onDidChange:Event$1.None,element:this._treeContainer,minimumSize:100,maximumSize:Number.MAX_VALUE,layout:r=>{this._treeContainer.style.height=`${this._dim.height}px`,this._treeContainer.style.width=`${r}px`,this._tree.layout(this._dim.height,r)}},Sizing.Distribute),this._disposables.add(this._splitView.onDidSashChange(()=>{this._dim.width&&(this.layoutData.ratio=this._splitView.getViewSize(0)/this._dim.width)},void 0));const o=(r,l)=>{r instanceof OneReference&&(l==="show"&&this._revealReference(r,!1),this._onDidSelectReference.fire({element:r,kind:l,source:"tree"}))};this._disposables.add(this._tree.onDidOpen(r=>{r.sideBySide?o(r.element,"side"):r.editorOptions.pinned?o(r.element,"goto"):o(r.element,"show")})),hide(this._treeContainer)}_onWidth(e){this._dim&&this._doLayoutBody(this._dim.height,e)}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._dim=new Dimension(t,e),this.layoutData.heightInLines=this._viewZone?this._viewZone.heightInLines:this.layoutData.heightInLines,this._splitView.layout(t),this._splitView.resizeView(0,t*this.layoutData.ratio)}setSelection(e){return this._revealReference(e,!0).then(()=>{this._model&&(this._tree.setSelection([e]),this._tree.setFocus([e]))})}setModel(e){return this._disposeOnNewModel.clear(),this._model=e,this._model?this._onNewModel():Promise.resolve()}_onNewModel(){return this._model?this._model.isEmpty?(this.setTitle(""),this._messageContainer.innerText=localize(1080,"No results"),show(this._messageContainer),Promise.resolve(void 0)):(hide(this._messageContainer),this._decorationsManager=new DecorationsManager(this._preview,this._model),this._disposeOnNewModel.add(this._decorationsManager),this._disposeOnNewModel.add(this._model.onDidChangeReferenceRange(e=>this._tree.rerender(e))),this._disposeOnNewModel.add(this._preview.onMouseDown(e=>{const{event:t,target:s}=e;if(t.detail!==2)return;const o=this._getFocusedReference();o&&this._onDidSelectReference.fire({element:{uri:o.uri,range:s.range},kind:t.ctrlKey||t.metaKey||t.altKey?"side":"open",source:"editor"})})),this.container.classList.add("results-loaded"),show(this._treeContainer),show(this._previewContainer),this._splitView.layout(this._dim.width),this.focusOnReferenceTree(),this._tree.setInput(this._model.groups.length===1?this._model.groups[0]:this._model)):Promise.resolve(void 0)}_getFocusedReference(){const[e]=this._tree.getFocus();if(e instanceof OneReference)return e;if(e instanceof FileReferences&&e.children.length>0)return e.children[0]}async revealReference(e){await this._revealReference(e,!1),this._onDidSelectReference.fire({element:e,kind:"goto",source:"tree"})}async _revealReference(e,t){if(this._revealedReference===e)return;this._revealedReference=e,e.uri.scheme!==Schemas.inMemory?this.setTitle(basenameOrAuthority(e.uri),this._uriLabel.getUriLabel(dirname(e.uri))):this.setTitle(localize(1081,"References"));const s=this._textModelResolverService.createModelReference(e.uri);this._tree.getInput()===e.parent?this._tree.reveal(e):(t&&this._tree.reveal(e.parent),await this._tree.expand(e.parent),this._tree.reveal(e));const o=await s;if(!this._model){o.dispose();return}dispose(this._previewModelReference);const r=o.object;if(r){const l=this._preview.getModel()===r.textEditorModel?0:1,c=Range$2.lift(e.range).collapseToStart();this._previewModelReference=o,this._preview.setModel(r.textEditorModel),this._preview.setSelection(c),this._preview.revealRangeInCenter(c,l)}else this._preview.setModel(this._previewNotAvailableMessage),o.dispose()}};ReferenceWidget=__decorate$1T([__param$1S(3,IThemeService),__param$1S(4,ITextModelService),__param$1S(5,IInstantiationService),__param$1S(6,IPeekViewService),__param$1S(7,ILabelService),__param$1S(8,IKeybindingService)],ReferenceWidget);var __decorate$1S=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1R=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},ReferencesController_1;const ctxReferenceSearchVisible=new RawContextKey("referenceSearchVisible",!1,localize(1073,"Whether reference peek is visible, like 'Peek References' or 'Peek Definition'"));var Li;let ReferencesController=(Li=class{static get(e){return e.getContribution(ReferencesController_1.ID)}constructor(e,t,s,o,r,l,c,d){this._defaultTreeKeyboardSupport=e,this._editor=t,this._editorService=o,this._notificationService=r,this._instantiationService=l,this._storageService=c,this._configurationService=d,this._disposables=new DisposableStore,this._requestIdPool=0,this._ignoreModelChangeEvent=!1,this._referenceSearchVisible=ctxReferenceSearchVisible.bindTo(s)}dispose(){var e,t;this._referenceSearchVisible.reset(),this._disposables.dispose(),(e=this._widget)==null||e.dispose(),(t=this._model)==null||t.dispose(),this._widget=void 0,this._model=void 0}toggleWidget(e,t,s){let o;if(this._widget&&(o=this._widget.position),this.closeWidget(),o&&e.containsPosition(o))return;this._peekMode=s,this._referenceSearchVisible.set(!0),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>{this.closeWidget()})),this._disposables.add(this._editor.onDidChangeModel(()=>{this._ignoreModelChangeEvent||this.closeWidget()}));const r="peekViewLayout",l=LayoutData.fromJSON(this._storageService.get(r,0,"{}"));this._widget=this._instantiationService.createInstance(ReferenceWidget,this._editor,this._defaultTreeKeyboardSupport,l),this._widget.setTitle(localize(1074,"Loading...")),this._widget.show(e),this._disposables.add(this._widget.onDidClose(()=>{t.cancel(),this._widget?(this._storageService.store(r,JSON.stringify(this._widget.layoutData),0,1),this._widget.isClosing||this.closeWidget(),this._widget=void 0):this.closeWidget()})),this._disposables.add(this._widget.onDidSelectReference(d=>{const{element:u,kind:g}=d;if(u)switch(g){case"open":(d.source!=="editor"||!this._configurationService.getValue("editor.stablePeek"))&&this.openReference(u,!1,!1);break;case"side":this.openReference(u,!0,!1);break;case"goto":s?this._gotoReference(u,!0):this.openReference(u,!1,!0);break}}));const c=++this._requestIdPool;t.then(d=>{var u;if(c!==this._requestIdPool||!this._widget){d.dispose();return}return(u=this._model)==null||u.dispose(),this._model=d,this._widget.setModel(this._model).then(()=>{if(this._widget&&this._model&&this._editor.hasModel()){this._model.isEmpty?this._widget.setMetaTitle(""):this._widget.setMetaTitle(localize(1075,"{0} ({1})",this._model.title,this._model.references.length));const g=this._editor.getModel().uri,f=new Position$1(e.startLineNumber,e.startColumn),p=this._model.nearestReference(g,f);if(p)return this._widget.setSelection(p).then(()=>{this._widget&&this._editor.getOption(99)==="editor"&&this._widget.focusOnPreviewEditor()})}})},d=>{this._notificationService.error(d)})}changeFocusBetweenPreviewAndReferences(){this._widget&&(this._widget.isPreviewEditorFocused()?this._widget.focusOnReferenceTree():this._widget.focusOnPreviewEditor())}async goToNextOrPreviousReference(e){if(!this._editor.hasModel()||!this._model||!this._widget)return;const t=this._widget.position;if(!t)return;const s=this._model.nearestReference(this._editor.getModel().uri,t);if(!s)return;const o=this._model.nextOrPreviousReference(s,e),r=this._editor.hasTextFocus(),l=this._widget.isPreviewEditorFocused();await this._widget.setSelection(o),await this._gotoReference(o,!1),r?this._editor.focus():this._widget&&l&&this._widget.focusOnPreviewEditor()}async revealReference(e){!this._editor.hasModel()||!this._model||!this._widget||await this._widget.revealReference(e)}closeWidget(e=!0){var t,s;(t=this._widget)==null||t.dispose(),(s=this._model)==null||s.dispose(),this._referenceSearchVisible.reset(),this._disposables.clear(),this._widget=void 0,this._model=void 0,e&&this._editor.focus(),this._requestIdPool+=1}_gotoReference(e,t){var o;(o=this._widget)==null||o.hide(),this._ignoreModelChangeEvent=!0;const s=Range$2.lift(e.range).collapseToStart();return this._editorService.openCodeEditor({resource:e.uri,options:{selection:s,selectionSource:"code.jump",pinned:t}},this._editor).then(r=>{if(this._ignoreModelChangeEvent=!1,!r||!this._widget){this.closeWidget();return}if(this._editor===r)this._widget.show(s),this._widget.focusOnReferenceTree();else{const l=ReferencesController_1.get(r),c=this._model.clone();this.closeWidget(),r.focus(),l==null||l.toggleWidget(s,createCancelablePromise(d=>Promise.resolve(c)),this._peekMode??!1)}},r=>{this._ignoreModelChangeEvent=!1,onUnexpectedError(r)})}openReference(e,t,s){t||this.closeWidget();const{uri:o,range:r}=e;this._editorService.openCodeEditor({resource:o,options:{selection:r,selectionSource:"code.jump",pinned:s}},this._editor,t)}},ReferencesController_1=Li,Li.ID="editor.contrib.referencesController",Li);ReferencesController=ReferencesController_1=__decorate$1S([__param$1R(2,IContextKeyService),__param$1R(3,ICodeEditorService),__param$1R(4,INotificationService),__param$1R(5,IInstantiationService),__param$1R(6,IStorageService),__param$1R(7,IConfigurationService)],ReferencesController);function withController(a,e){const t=getOuterEditor(a);if(!t)return;const s=ReferencesController.get(t);s&&e(s)}KeybindingsRegistry.registerCommandAndKeybindingRule({id:"togglePeekWidgetFocus",weight:100,primary:KeyChord(2089,60),when:ContextKeyExpr.or(ctxReferenceSearchVisible,PeekContext.inPeekEditor),handler(a){withController(a,e=>{e.changeFocusBetweenPreviewAndReferences()})}});KeybindingsRegistry.registerCommandAndKeybindingRule({id:"goToNextReference",weight:100-10,primary:62,secondary:[70],when:ContextKeyExpr.or(ctxReferenceSearchVisible,PeekContext.inPeekEditor),handler(a){withController(a,e=>{e.goToNextOrPreviousReference(!0)})}});KeybindingsRegistry.registerCommandAndKeybindingRule({id:"goToPreviousReference",weight:100-10,primary:1086,secondary:[1094],when:ContextKeyExpr.or(ctxReferenceSearchVisible,PeekContext.inPeekEditor),handler(a){withController(a,e=>{e.goToNextOrPreviousReference(!1)})}});CommandsRegistry.registerCommandAlias("goToNextReferenceFromEmbeddedEditor","goToNextReference");CommandsRegistry.registerCommandAlias("goToPreviousReferenceFromEmbeddedEditor","goToPreviousReference");CommandsRegistry.registerCommandAlias("closeReferenceSearchEditor","closeReferenceSearch");CommandsRegistry.registerCommand("closeReferenceSearch",a=>withController(a,e=>e.closeWidget()));KeybindingsRegistry.registerKeybindingRule({id:"closeReferenceSearch",weight:100-101,primary:9,secondary:[1033],when:ContextKeyExpr.and(PeekContext.inPeekEditor,ContextKeyExpr.not("config.editor.stablePeek"))});KeybindingsRegistry.registerKeybindingRule({id:"closeReferenceSearch",weight:200+50,primary:9,secondary:[1033],when:ContextKeyExpr.and(ctxReferenceSearchVisible,ContextKeyExpr.not("config.editor.stablePeek"),ContextKeyExpr.or(EditorContextKeys.editorTextFocus,InputFocusedContext.negate()))});KeybindingsRegistry.registerCommandAndKeybindingRule({id:"revealReference",weight:200,primary:3,mac:{primary:3,secondary:[2066]},when:ContextKeyExpr.and(ctxReferenceSearchVisible,WorkbenchListFocusContextKey,WorkbenchTreeElementCanCollapse.negate(),WorkbenchTreeElementCanExpand.negate()),handler(a){var s;const t=(s=a.get(IListService).lastFocusedList)==null?void 0:s.getFocus();Array.isArray(t)&&t[0]instanceof OneReference&&withController(a,o=>o.revealReference(t[0]))}});KeybindingsRegistry.registerCommandAndKeybindingRule({id:"openReferenceToSide",weight:100,primary:2051,mac:{primary:259},when:ContextKeyExpr.and(ctxReferenceSearchVisible,WorkbenchListFocusContextKey,WorkbenchTreeElementCanCollapse.negate(),WorkbenchTreeElementCanExpand.negate()),handler(a){var s;const t=(s=a.get(IListService).lastFocusedList)==null?void 0:s.getFocus();Array.isArray(t)&&t[0]instanceof OneReference&&withController(a,o=>o.openReference(t[0],!0,!0))}});CommandsRegistry.registerCommand("openReference",a=>{var s;const t=(s=a.get(IListService).lastFocusedList)==null?void 0:s.getFocus();Array.isArray(t)&&t[0]instanceof OneReference&&withController(a,o=>o.openReference(t[0],!1,!0))});var __decorate$1R=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1Q=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const ctxHasSymbols=new RawContextKey("hasSymbols",!1,localize(1090,"Whether there are symbol locations that can be navigated via keyboard-only.")),ISymbolNavigationService=createDecorator("ISymbolNavigationService");let SymbolNavigationService=class{constructor(e,t,s,o){this._editorService=t,this._notificationService=s,this._keybindingService=o,this._currentModel=void 0,this._currentIdx=-1,this._ignoreEditorChange=!1,this._ctxHasSymbols=ctxHasSymbols.bindTo(e)}reset(){var e,t;this._ctxHasSymbols.reset(),(e=this._currentState)==null||e.dispose(),(t=this._currentMessage)==null||t.close(),this._currentModel=void 0,this._currentIdx=-1}put(e){const t=e.parent.parent;if(t.references.length<=1){this.reset();return}this._currentModel=t,this._currentIdx=t.references.indexOf(e),this._ctxHasSymbols.set(!0),this._showMessage();const s=new EditorState(this._editorService),o=s.onDidChange(r=>{if(this._ignoreEditorChange)return;const l=this._editorService.getActiveCodeEditor();if(!l)return;const c=l.getModel(),d=l.getPosition();if(!c||!d)return;let u=!1,g=!1;for(const f of t.references)if(isEqual(f.uri,c.uri))u=!0,g=g||Range$2.containsPosition(f.range,d);else if(u)break;(!u||!g)&&this.reset()});this._currentState=combinedDisposable(s,o)}revealNext(e){if(!this._currentModel)return Promise.resolve();this._currentIdx+=1,this._currentIdx%=this._currentModel.references.length;const t=this._currentModel.references[this._currentIdx];return this._showMessage(),this._ignoreEditorChange=!0,this._editorService.openCodeEditor({resource:t.uri,options:{selection:Range$2.collapseToStart(t.range),selectionRevealType:3}},e).finally(()=>{this._ignoreEditorChange=!1})}_showMessage(){var s;(s=this._currentMessage)==null||s.close();const e=this._keybindingService.lookupKeybinding("editor.gotoNextSymbolFromResult"),t=e?localize(1091,"Symbol {0} of {1}, {2} for next",this._currentIdx+1,this._currentModel.references.length,e.getLabel()):localize(1092,"Symbol {0} of {1}",this._currentIdx+1,this._currentModel.references.length);this._currentMessage=this._notificationService.status(t)}};SymbolNavigationService=__decorate$1R([__param$1Q(0,IContextKeyService),__param$1Q(1,ICodeEditorService),__param$1Q(2,INotificationService),__param$1Q(3,IKeybindingService)],SymbolNavigationService);registerSingleton(ISymbolNavigationService,SymbolNavigationService,1);registerEditorCommand(new class extends EditorCommand{constructor(){super({id:"editor.gotoNextSymbolFromResult",precondition:ctxHasSymbols,kbOpts:{weight:100,primary:70}})}runEditorCommand(a,e){return a.get(ISymbolNavigationService).revealNext(e)}});KeybindingsRegistry.registerCommandAndKeybindingRule({id:"editor.gotoNextSymbolFromResult.cancel",weight:100,when:ctxHasSymbols,primary:9,handler(a){a.get(ISymbolNavigationService).reset()}});let EditorState=class{constructor(e){this._listener=new Map,this._disposables=new DisposableStore,this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._disposables.add(e.onCodeEditorRemove(this._onDidRemoveEditor,this)),this._disposables.add(e.onCodeEditorAdd(this._onDidAddEditor,this)),e.listCodeEditors().forEach(this._onDidAddEditor,this)}dispose(){this._disposables.dispose(),this._onDidChange.dispose(),dispose(this._listener.values())}_onDidAddEditor(e){this._listener.set(e,combinedDisposable(e.onDidChangeCursorPosition(t=>this._onDidChange.fire({editor:e})),e.onDidChangeModelContent(t=>this._onDidChange.fire({editor:e}))))}_onDidRemoveEditor(e){var t;(t=this._listener.get(e))==null||t.dispose(),this._listener.delete(e)}};EditorState=__decorate$1R([__param$1Q(0,ICodeEditorService)],EditorState);function shouldIncludeLocationLink(a,e){return e.uri.scheme===a.uri.scheme?!0:!matchesSomeScheme(e.uri,Schemas.walkThroughSnippet,Schemas.vscodeChatCodeBlock,Schemas.vscodeChatCodeCompareBlock)}async function getLocationLinks(a,e,t,s,o){const l=t.ordered(a,s).map(d=>Promise.resolve(o(d,a,e)).then(void 0,u=>{onUnexpectedExternalError(u)})),c=await Promise.all(l);return coalesce(c.flat()).filter(d=>shouldIncludeLocationLink(a,d))}function getDefinitionsAtPosition(a,e,t,s,o){return getLocationLinks(e,t,a,s,(r,l,c)=>r.provideDefinition(l,c,o))}function getDeclarationsAtPosition(a,e,t,s,o){return getLocationLinks(e,t,a,s,(r,l,c)=>r.provideDeclaration(l,c,o))}function getImplementationsAtPosition(a,e,t,s,o){return getLocationLinks(e,t,a,s,(r,l,c)=>r.provideImplementation(l,c,o))}function getTypeDefinitionsAtPosition(a,e,t,s,o){return getLocationLinks(e,t,a,s,(r,l,c)=>r.provideTypeDefinition(l,c,o))}function getReferencesAtPosition(a,e,t,s,o,r){return getLocationLinks(e,t,a,o,async(l,c,d)=>{var f,p;const u=(f=await l.provideReferences(c,d,{includeDeclaration:!0},r))==null?void 0:f.filter(m=>shouldIncludeLocationLink(c,m));if(!s||!u||u.length!==2)return u;const g=(p=await l.provideReferences(c,d,{includeDeclaration:!1},r))==null?void 0:p.filter(m=>shouldIncludeLocationLink(c,m));return g&&g.length===1?g:u})}async function _sortedAndDeduped(a){const e=await a(),t=new ReferencesModel(e,""),s=t.references.map(o=>o.link);return t.dispose(),s}registerModelAndPositionCommand("_executeDefinitionProvider",(a,e,t)=>{const s=a.get(ILanguageFeaturesService),o=getDefinitionsAtPosition(s.definitionProvider,e,t,!1,CancellationToken.None);return _sortedAndDeduped(()=>o)});registerModelAndPositionCommand("_executeDefinitionProvider_recursive",(a,e,t)=>{const s=a.get(ILanguageFeaturesService),o=getDefinitionsAtPosition(s.definitionProvider,e,t,!0,CancellationToken.None);return _sortedAndDeduped(()=>o)});registerModelAndPositionCommand("_executeTypeDefinitionProvider",(a,e,t)=>{const s=a.get(ILanguageFeaturesService),o=getTypeDefinitionsAtPosition(s.typeDefinitionProvider,e,t,!1,CancellationToken.None);return _sortedAndDeduped(()=>o)});registerModelAndPositionCommand("_executeTypeDefinitionProvider_recursive",(a,e,t)=>{const s=a.get(ILanguageFeaturesService),o=getTypeDefinitionsAtPosition(s.typeDefinitionProvider,e,t,!0,CancellationToken.None);return _sortedAndDeduped(()=>o)});registerModelAndPositionCommand("_executeDeclarationProvider",(a,e,t)=>{const s=a.get(ILanguageFeaturesService),o=getDeclarationsAtPosition(s.declarationProvider,e,t,!1,CancellationToken.None);return _sortedAndDeduped(()=>o)});registerModelAndPositionCommand("_executeDeclarationProvider_recursive",(a,e,t)=>{const s=a.get(ILanguageFeaturesService),o=getDeclarationsAtPosition(s.declarationProvider,e,t,!0,CancellationToken.None);return _sortedAndDeduped(()=>o)});registerModelAndPositionCommand("_executeReferenceProvider",(a,e,t)=>{const s=a.get(ILanguageFeaturesService),o=getReferencesAtPosition(s.referenceProvider,e,t,!1,!1,CancellationToken.None);return _sortedAndDeduped(()=>o)});registerModelAndPositionCommand("_executeReferenceProvider_recursive",(a,e,t)=>{const s=a.get(ILanguageFeaturesService),o=getReferencesAtPosition(s.referenceProvider,e,t,!1,!0,CancellationToken.None);return _sortedAndDeduped(()=>o)});registerModelAndPositionCommand("_executeImplementationProvider",(a,e,t)=>{const s=a.get(ILanguageFeaturesService),o=getImplementationsAtPosition(s.implementationProvider,e,t,!1,CancellationToken.None);return _sortedAndDeduped(()=>o)});registerModelAndPositionCommand("_executeImplementationProvider_recursive",(a,e,t)=>{const s=a.get(ILanguageFeaturesService),o=getImplementationsAtPosition(s.implementationProvider,e,t,!0,CancellationToken.None);return _sortedAndDeduped(()=>o)});MenuRegistry.appendMenuItem(MenuId.EditorContext,{submenu:MenuId.EditorContextPeek,title:localize(1033,"Peek"),group:"navigation",order:100});class SymbolNavigationAnchor{static is(e){return!e||typeof e!="object"?!1:!!(e instanceof SymbolNavigationAnchor||Position$1.isIPosition(e.position)&&e.model)}constructor(e,t){this.model=e,this.position=t}}const ke=class ke extends EditorAction2{static all(){return ke._allSymbolNavigationCommands.values()}static _patchConfig(e){const t={...e,f1:!0};if(t.menu)for(const s of Iterable.wrap(t.menu))(s.id===MenuId.EditorContext||s.id===MenuId.EditorContextPeek)&&(s.when=ContextKeyExpr.and(e.precondition,s.when));return t}constructor(e,t){super(ke._patchConfig(t)),this.configuration=e,ke._allSymbolNavigationCommands.set(t.id,this)}runEditorCommand(e,t,s,o){if(!t.hasModel())return Promise.resolve(void 0);const r=e.get(INotificationService),l=e.get(ICodeEditorService),c=e.get(IEditorProgressService),d=e.get(ISymbolNavigationService),u=e.get(ILanguageFeaturesService),g=e.get(IInstantiationService),f=t.getModel(),p=t.getPosition(),m=SymbolNavigationAnchor.is(s)?s:new SymbolNavigationAnchor(f,p),_=new EditorStateCancellationTokenSource(t,5),C=raceCancellation(this._getLocationModel(u,m.model,m.position,_.token),_.token).then(async b=>{var y;if(!b||_.token.isCancellationRequested)return;alert$1(b.ariaMessage);let v;if(b.referenceAt(f.uri,p)){const w=this._getAlternativeCommand(t);w!==void 0&&!ke._activeAlternativeCommands.has(w)&&ke._allSymbolNavigationCommands.has(w)&&(v=ke._allSymbolNavigationCommands.get(w))}const S=b.references.length;if(S===0){if(!this.configuration.muteMessage){const w=f.getWordAtPosition(p);(y=MessageController.get(t))==null||y.showMessage(this._getNoResultFoundMessage(w),p)}}else if(S===1&&v)ke._activeAlternativeCommands.add(this.desc.id),g.invokeFunction(w=>v.runEditorCommand(w,t,s,o).finally(()=>{ke._activeAlternativeCommands.delete(this.desc.id)}));else return this._onResult(l,d,t,b,o)},b=>{r.error(b)}).finally(()=>{_.dispose()});return c.showWhile(C,250),C}async _onResult(e,t,s,o,r){const l=this._getGoToPreference(s);if(!(s instanceof EmbeddedCodeEditorWidget)&&(this.configuration.openInPeek||l==="peek"&&o.references.length>1))this._openInPeek(s,o,r);else{const c=o.firstReference(),d=o.references.length>1&&l==="gotoAndPeek",u=await this._openReference(s,e,c,this.configuration.openToSide,!d);d&&u?this._openInPeek(u,o,r):o.dispose(),l==="goto"&&t.put(c)}}async _openReference(e,t,s,o,r){let l;if(isLocationLink(s)&&(l=s.targetSelectionRange),l||(l=s.range),!l)return;const c=await t.openCodeEditor({resource:s.uri,options:{selection:Range$2.collapseToStart(l),selectionRevealType:3,selectionSource:"code.jump"}},e,o);if(c){if(r){const d=c.getModel(),u=c.createDecorationsCollection([{range:l,options:{description:"symbol-navigate-action-highlight",className:"symbolHighlight"}}]);setTimeout(()=>{c.getModel()===d&&u.clear()},350)}return c}}_openInPeek(e,t,s){const o=ReferencesController.get(e);o&&e.hasModel()?o.toggleWidget(s??e.getSelection(),createCancelablePromise(r=>Promise.resolve(t)),this.configuration.openInPeek):t.dispose()}};ke._allSymbolNavigationCommands=new Map,ke._activeAlternativeCommands=new Set;let SymbolNavigationAction=ke;class DefinitionAction extends SymbolNavigationAction{async _getLocationModel(e,t,s,o){return new ReferencesModel(await getDefinitionsAtPosition(e.definitionProvider,t,s,!1,o),localize(1034,"Definitions"))}_getNoResultFoundMessage(e){return e&&e.word?localize(1035,"No definition found for '{0}'",e.word):localize(1036,"No definition found")}_getAlternativeCommand(e){return e.getOption(67).alternativeDefinitionCommand}_getGoToPreference(e){return e.getOption(67).multipleDefinitions}}var Mt;registerAction2((Mt=class extends DefinitionAction{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:Mt.id,title:{...localize2(1060,"Go to Definition"),mnemonicTitle:localize(1037,"Go to &&Definition")},precondition:EditorContextKeys.hasDefinitionProvider,keybinding:[{when:EditorContextKeys.editorTextFocus,primary:70,weight:100},{when:ContextKeyExpr.and(EditorContextKeys.editorTextFocus,IsWebContext),primary:2118,weight:100}],menu:[{id:MenuId.EditorContext,group:"navigation",order:1.1},{id:MenuId.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:2}]}),CommandsRegistry.registerCommandAlias("editor.action.goToDeclaration",Mt.id)}},Mt.id="editor.action.revealDefinition",Mt));var At;registerAction2((At=class extends DefinitionAction{constructor(){super({openToSide:!0,openInPeek:!1,muteMessage:!1},{id:At.id,title:localize2(1061,"Open Definition to the Side"),precondition:ContextKeyExpr.and(EditorContextKeys.hasDefinitionProvider,EditorContextKeys.isInEmbeddedEditor.toNegated()),keybinding:[{when:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,70),weight:100},{when:ContextKeyExpr.and(EditorContextKeys.editorTextFocus,IsWebContext),primary:KeyChord(2089,2118),weight:100}]}),CommandsRegistry.registerCommandAlias("editor.action.openDeclarationToTheSide",At.id)}},At.id="editor.action.revealDefinitionAside",At));var Ot;registerAction2((Ot=class extends DefinitionAction{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:Ot.id,title:localize2(1062,"Peek Definition"),precondition:ContextKeyExpr.and(EditorContextKeys.hasDefinitionProvider,PeekContext.notInPeekEditor,EditorContextKeys.isInEmbeddedEditor.toNegated()),keybinding:{when:EditorContextKeys.editorTextFocus,primary:582,linux:{primary:3140},weight:100},menu:{id:MenuId.EditorContextPeek,group:"peek",order:2}}),CommandsRegistry.registerCommandAlias("editor.action.previewDeclaration",Ot.id)}},Ot.id="editor.action.peekDefinition",Ot));class DeclarationAction extends SymbolNavigationAction{async _getLocationModel(e,t,s,o){return new ReferencesModel(await getDeclarationsAtPosition(e.declarationProvider,t,s,!1,o),localize(1038,"Declarations"))}_getNoResultFoundMessage(e){return e&&e.word?localize(1039,"No declaration found for '{0}'",e.word):localize(1040,"No declaration found")}_getAlternativeCommand(e){return e.getOption(67).alternativeDeclarationCommand}_getGoToPreference(e){return e.getOption(67).multipleDeclarations}}var Ei;registerAction2((Ei=class extends DeclarationAction{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:Ei.id,title:{...localize2(1063,"Go to Declaration"),mnemonicTitle:localize(1041,"Go to &&Declaration")},precondition:ContextKeyExpr.and(EditorContextKeys.hasDeclarationProvider,EditorContextKeys.isInEmbeddedEditor.toNegated()),menu:[{id:MenuId.EditorContext,group:"navigation",order:1.3},{id:MenuId.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:3}]})}_getNoResultFoundMessage(e){return e&&e.word?localize(1042,"No declaration found for '{0}'",e.word):localize(1043,"No declaration found")}},Ei.id="editor.action.revealDeclaration",Ei));registerAction2(class extends DeclarationAction{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:"editor.action.peekDeclaration",title:localize2(1064,"Peek Declaration"),precondition:ContextKeyExpr.and(EditorContextKeys.hasDeclarationProvider,PeekContext.notInPeekEditor,EditorContextKeys.isInEmbeddedEditor.toNegated()),menu:{id:MenuId.EditorContextPeek,group:"peek",order:3}})}});class TypeDefinitionAction extends SymbolNavigationAction{async _getLocationModel(e,t,s,o){return new ReferencesModel(await getTypeDefinitionsAtPosition(e.typeDefinitionProvider,t,s,!1,o),localize(1044,"Type Definitions"))}_getNoResultFoundMessage(e){return e&&e.word?localize(1045,"No type definition found for '{0}'",e.word):localize(1046,"No type definition found")}_getAlternativeCommand(e){return e.getOption(67).alternativeTypeDefinitionCommand}_getGoToPreference(e){return e.getOption(67).multipleTypeDefinitions}}var xi;registerAction2((xi=class extends TypeDefinitionAction{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:xi.ID,title:{...localize2(1065,"Go to Type Definition"),mnemonicTitle:localize(1047,"Go to &&Type Definition")},precondition:EditorContextKeys.hasTypeDefinitionProvider,keybinding:{when:EditorContextKeys.editorTextFocus,primary:0,weight:100},menu:[{id:MenuId.EditorContext,group:"navigation",order:1.4},{id:MenuId.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:3}]})}},xi.ID="editor.action.goToTypeDefinition",xi));var Ii;registerAction2((Ii=class extends TypeDefinitionAction{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:Ii.ID,title:localize2(1066,"Peek Type Definition"),precondition:ContextKeyExpr.and(EditorContextKeys.hasTypeDefinitionProvider,PeekContext.notInPeekEditor,EditorContextKeys.isInEmbeddedEditor.toNegated()),menu:{id:MenuId.EditorContextPeek,group:"peek",order:4}})}},Ii.ID="editor.action.peekTypeDefinition",Ii));class ImplementationAction extends SymbolNavigationAction{async _getLocationModel(e,t,s,o){return new ReferencesModel(await getImplementationsAtPosition(e.implementationProvider,t,s,!1,o),localize(1048,"Implementations"))}_getNoResultFoundMessage(e){return e&&e.word?localize(1049,"No implementation found for '{0}'",e.word):localize(1050,"No implementation found")}_getAlternativeCommand(e){return e.getOption(67).alternativeImplementationCommand}_getGoToPreference(e){return e.getOption(67).multipleImplementations}}var Di;registerAction2((Di=class extends ImplementationAction{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:Di.ID,title:{...localize2(1067,"Go to Implementations"),mnemonicTitle:localize(1051,"Go to &&Implementations")},precondition:EditorContextKeys.hasImplementationProvider,keybinding:{when:EditorContextKeys.editorTextFocus,primary:2118,weight:100},menu:[{id:MenuId.EditorContext,group:"navigation",order:1.45},{id:MenuId.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:4}]})}},Di.ID="editor.action.goToImplementation",Di));var Ti;registerAction2((Ti=class extends ImplementationAction{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:Ti.ID,title:localize2(1068,"Peek Implementations"),precondition:ContextKeyExpr.and(EditorContextKeys.hasImplementationProvider,PeekContext.notInPeekEditor,EditorContextKeys.isInEmbeddedEditor.toNegated()),keybinding:{when:EditorContextKeys.editorTextFocus,primary:3142,weight:100},menu:{id:MenuId.EditorContextPeek,group:"peek",order:5}})}},Ti.ID="editor.action.peekImplementation",Ti));class ReferencesAction extends SymbolNavigationAction{_getNoResultFoundMessage(e){return e?localize(1052,"No references found for '{0}'",e.word):localize(1053,"No references found")}_getAlternativeCommand(e){return e.getOption(67).alternativeReferenceCommand}_getGoToPreference(e){return e.getOption(67).multipleReferences}}registerAction2(class extends ReferencesAction{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:"editor.action.goToReferences",title:{...localize2(1069,"Go to References"),mnemonicTitle:localize(1054,"Go to &&References")},precondition:ContextKeyExpr.and(EditorContextKeys.hasReferenceProvider,PeekContext.notInPeekEditor,EditorContextKeys.isInEmbeddedEditor.toNegated()),keybinding:{when:EditorContextKeys.editorTextFocus,primary:1094,weight:100},menu:[{id:MenuId.EditorContext,group:"navigation",order:1.45},{id:MenuId.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:5}]})}async _getLocationModel(e,t,s,o){return new ReferencesModel(await getReferencesAtPosition(e.referenceProvider,t,s,!0,!1,o),localize(1055,"References"))}});registerAction2(class extends ReferencesAction{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:"editor.action.referenceSearch.trigger",title:localize2(1070,"Peek References"),precondition:ContextKeyExpr.and(EditorContextKeys.hasReferenceProvider,PeekContext.notInPeekEditor,EditorContextKeys.isInEmbeddedEditor.toNegated()),menu:{id:MenuId.EditorContextPeek,group:"peek",order:6}})}async _getLocationModel(e,t,s,o){return new ReferencesModel(await getReferencesAtPosition(e.referenceProvider,t,s,!1,!1,o),localize(1056,"References"))}});class GenericGoToLocationAction extends SymbolNavigationAction{constructor(e,t,s){super(e,{id:"editor.action.goToLocation",title:localize2(1071,"Go to Any Symbol"),precondition:ContextKeyExpr.and(PeekContext.notInPeekEditor,EditorContextKeys.isInEmbeddedEditor.toNegated())}),this._references=t,this._gotoMultipleBehaviour=s}async _getLocationModel(e,t,s,o){return new ReferencesModel(this._references,localize(1057,"Locations"))}_getNoResultFoundMessage(e){return e&&localize(1058,"No results for '{0}'",e.word)||""}_getGoToPreference(e){return this._gotoMultipleBehaviour??e.getOption(67).multipleReferences}_getAlternativeCommand(){}}CommandsRegistry.registerCommand({id:"editor.action.goToLocations",metadata:{description:"Go to locations from a position in a file",args:[{name:"uri",description:"The text document in which to start",constraint:URI},{name:"position",description:"The position at which to start",constraint:Position$1.isIPosition},{name:"locations",description:"An array of locations.",constraint:Array},{name:"multiple",description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"},{name:"noResultsMessage",description:"Human readable message that shows when locations is empty."}]},handler:async(a,e,t,s,o,r,l)=>{assertType(URI.isUri(e)),assertType(Position$1.isIPosition(t)),assertType(Array.isArray(s)),assertType(typeof o>"u"||typeof o=="string"),assertType(typeof l>"u"||typeof l=="boolean");const c=a.get(ICodeEditorService),d=await c.openCodeEditor({resource:e},c.getFocusedCodeEditor());if(isCodeEditor(d))return d.setPosition(t),d.revealPositionInCenterIfOutsideViewport(t,0),d.invokeWithinContext(u=>{const g=new class extends GenericGoToLocationAction{_getNoResultFoundMessage(f){return r||super._getNoResultFoundMessage(f)}}({muteMessage:!r,openInPeek:!!l,openToSide:!1},s,o);u.get(IInstantiationService).invokeFunction(g.run.bind(g),d)})}});CommandsRegistry.registerCommand({id:"editor.action.peekLocations",metadata:{description:"Peek locations from a position in a file",args:[{name:"uri",description:"The text document in which to start",constraint:URI},{name:"position",description:"The position at which to start",constraint:Position$1.isIPosition},{name:"locations",description:"An array of locations.",constraint:Array},{name:"multiple",description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"}]},handler:async(a,e,t,s,o)=>{a.get(ICommandService).executeCommand("editor.action.goToLocations",e,t,s,o,void 0,!0)}});CommandsRegistry.registerCommand({id:"editor.action.findReferences",handler:(a,e,t)=>{assertType(URI.isUri(e)),assertType(Position$1.isIPosition(t));const s=a.get(ILanguageFeaturesService),o=a.get(ICodeEditorService);return o.openCodeEditor({resource:e},o.getFocusedCodeEditor()).then(r=>{if(!isCodeEditor(r)||!r.hasModel())return;const l=ReferencesController.get(r);if(!l)return;const c=createCancelablePromise(u=>getReferencesAtPosition(s.referenceProvider,r.getModel(),Position$1.lift(t),!1,!1,u).then(g=>new ReferencesModel(g,localize(1059,"References")))),d=new Range$2(t.lineNumber,t.column,t.lineNumber,t.column);return Promise.resolve(l.toggleWidget(d,c,!1))})}});CommandsRegistry.registerCommandAlias("editor.action.showReferences","editor.action.peekLocations");async function showGoToContextMenu(a,e,t,s){const o=a.get(ITextModelService),r=a.get(IContextMenuService),l=a.get(ICommandService),c=a.get(IInstantiationService),d=a.get(INotificationService);if(await s.item.resolve(CancellationToken.None),!s.part.location)return;const u=s.part.location,g=[],f=new Set(MenuRegistry.getMenuItems(MenuId.EditorContext).map(m=>isIMenuItem(m)?m.command.id:generateUuid()));for(const m of SymbolNavigationAction.all())f.has(m.desc.id)&&g.push(new Action(m.desc.id,MenuItemAction.label(m.desc,{renderShortTitle:!0}),void 0,!0,async()=>{const _=await o.createModelReference(u.uri);try{const C=new SymbolNavigationAnchor(_.object.textEditorModel,Range$2.getStartPosition(u.range)),b=s.item.anchor.range;await c.invokeFunction(m.runEditorCommand.bind(m),e,C,b)}finally{_.dispose()}}));if(s.part.command){const{command:m}=s.part;g.push(new Separator),g.push(new Action(m.id,m.title,void 0,!0,async()=>{try{await l.executeCommand(m.id,...m.arguments??[])}catch(_){d.notify({severity:Severity.Error,source:s.item.provider.displayName,message:_})}}))}const p=e.getOption(144);r.showContextMenu({domForShadowRoot:p?e.getDomNode()??void 0:void 0,getAnchor:()=>{const m=getDomNodePagePosition(t);return{x:m.left,y:m.top+m.height+8}},getActions:()=>g,onHide:()=>{e.focus()},autoSelectFirstItem:!0})}async function goToDefinitionWithLocation(a,e,t,s){const r=await a.get(ITextModelService).createModelReference(s.uri);await t.invokeWithinContext(async l=>{const c=e.hasSideBySideModifier,d=l.get(IContextKeyService),u=PeekContext.inPeekEditor.getValue(d),g=!c&&t.getOption(101)&&!u;return new DefinitionAction({openToSide:c,openInPeek:g,muteMessage:!0},{title:{value:"",original:""},id:"",precondition:void 0}).run(l,new SymbolNavigationAnchor(r.object.textEditorModel,Range$2.getStartPosition(s.range)),Range$2.lift(s.range))}),r.dispose()}var __decorate$1Q=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1P=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},InlayHintsController_1;class InlayHintsCache{constructor(){this._entries=new LRUCache(50)}get(e){const t=InlayHintsCache._key(e);return this._entries.get(t)}set(e,t){const s=InlayHintsCache._key(e);this._entries.set(s,t)}static _key(e){return`${e.uri.toString()}/${e.getVersionId()}`}}const IInlayHintsCache=createDecorator("IInlayHintsCache");registerSingleton(IInlayHintsCache,InlayHintsCache,1);class RenderedInlayHintLabelPart{constructor(e,t){this.item=e,this.index=t}get part(){const e=this.item.hint.label;return typeof e=="string"?{label:e}:e[this.index]}}class ActiveInlayHintInfo{constructor(e,t){this.part=e,this.hasTriggerModifier=t}}var ht;let InlayHintsController=(ht=class{static get(e){return e.getContribution(InlayHintsController_1.ID)??void 0}constructor(e,t,s,o,r,l,c){this._editor=e,this._languageFeaturesService=t,this._inlayHintsCache=o,this._commandService=r,this._notificationService=l,this._instaService=c,this._disposables=new DisposableStore,this._sessionDisposables=new DisposableStore,this._decorationsMetadata=new Map,this._activeRenderMode=0,this._ruleFactory=this._disposables.add(new DynamicCssRules(this._editor)),this._debounceInfo=s.for(t.inlayHintsProvider,"InlayHint",{min:25}),this._disposables.add(t.inlayHintsProvider.onDidChange(()=>this._update())),this._disposables.add(e.onDidChangeModel(()=>this._update())),this._disposables.add(e.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(e.onDidChangeConfiguration(d=>{d.hasChanged(159)&&this._update()})),this._update()}dispose(){this._sessionDisposables.dispose(),this._removeAllDecorations(),this._disposables.dispose()}_update(){this._sessionDisposables.clear(),this._removeAllDecorations();const e=this._editor.getOption(159);if(e.enabled==="off")return;const t=this._editor.getModel();if(!t||!this._languageFeaturesService.inlayHintsProvider.has(t))return;if(e.enabled==="on")this._activeRenderMode=0;else{let d,u;e.enabled==="onUnlessPressed"?(d=0,u=1):(d=1,u=0),this._activeRenderMode=d,this._sessionDisposables.add(ModifierKeyEmitter.getInstance().event(g=>{if(!this._editor.hasModel())return;const f=g.altKey&&g.ctrlKey&&!(g.shiftKey||g.metaKey)?u:d;if(f!==this._activeRenderMode){this._activeRenderMode=f;const p=this._editor.getModel(),m=this._copyInlayHintsWithCurrentAnchor(p);this._updateHintsDecorators([p.getFullModelRange()],m),l.schedule(0)}}))}const s=this._inlayHintsCache.get(t);s&&this._updateHintsDecorators([t.getFullModelRange()],s),this._sessionDisposables.add(toDisposable(()=>{t.isDisposed()||this._cacheHintsForFastRestore(t)}));let o;const r=new Set,l=new RunOnceScheduler(async()=>{const d=Date.now();o==null||o.dispose(!0),o=new CancellationTokenSource$1;const u=t.onWillDispose(()=>o==null?void 0:o.cancel());try{const g=o.token,f=await InlayHintsFragments.create(this._languageFeaturesService.inlayHintsProvider,t,this._getHintsRanges(),g);if(l.delay=this._debounceInfo.update(t,Date.now()-d),g.isCancellationRequested){f.dispose();return}for(const p of f.provider)typeof p.onDidChangeInlayHints=="function"&&!r.has(p)&&(r.add(p),this._sessionDisposables.add(p.onDidChangeInlayHints(()=>{l.isScheduled()||l.schedule()})));this._sessionDisposables.add(f),this._updateHintsDecorators(f.ranges,f.items),this._cacheHintsForFastRestore(t)}catch(g){onUnexpectedError(g)}finally{o.dispose(),u.dispose()}},this._debounceInfo.get(t));this._sessionDisposables.add(l),this._sessionDisposables.add(toDisposable(()=>o==null?void 0:o.dispose(!0))),l.schedule(0),this._sessionDisposables.add(this._editor.onDidScrollChange(d=>{(d.scrollTopChanged||!l.isScheduled())&&l.schedule()}));const c=this._sessionDisposables.add(new MutableDisposable);this._sessionDisposables.add(this._editor.onDidChangeModelContent(d=>{o==null||o.cancel();const u=Math.max(l.delay,800);this._cursorInfo={position:this._editor.getPosition(),notEarlierThan:Date.now()+u},c.value=disposableTimeout(()=>l.schedule(0),u),l.schedule()})),this._sessionDisposables.add(this._editor.onDidChangeConfiguration(d=>{d.hasChanged(159)&&l.schedule()})),this._sessionDisposables.add(this._installDblClickGesture(()=>l.schedule(0))),this._sessionDisposables.add(this._installLinkGesture()),this._sessionDisposables.add(this._installContextMenu())}_installLinkGesture(){const e=new DisposableStore,t=e.add(new ClickLinkGesture(this._editor)),s=new DisposableStore;return e.add(s),e.add(t.onMouseMoveOrRelevantKeyDown(o=>{const[r]=o,l=this._getInlayHintLabelPart(r),c=this._editor.getModel();if(!l||!c){s.clear();return}const d=new CancellationTokenSource$1;s.add(toDisposable(()=>d.dispose(!0))),l.item.resolve(d.token),this._activeInlayHintPart=l.part.command||l.part.location?new ActiveInlayHintInfo(l,r.hasTriggerModifier):void 0;const u=c.validatePosition(l.item.hint.position).lineNumber,g=new Range$2(u,1,u,c.getLineMaxColumn(u)),f=this._getInlineHintsForRange(g);this._updateHintsDecorators([g],f),s.add(toDisposable(()=>{this._activeInlayHintPart=void 0,this._updateHintsDecorators([g],f)}))})),e.add(t.onCancel(()=>s.clear())),e.add(t.onExecute(async o=>{const r=this._getInlayHintLabelPart(o);if(r){const l=r.part;l.location?this._instaService.invokeFunction(goToDefinitionWithLocation,o,this._editor,l.location):Command.is(l.command)&&await this._invokeCommand(l.command,r.item)}})),e}_getInlineHintsForRange(e){const t=new Set;for(const s of this._decorationsMetadata.values())e.containsRange(s.item.anchor.range)&&t.add(s.item);return Array.from(t)}_installDblClickGesture(e){return this._editor.onMouseUp(async t=>{if(t.event.detail!==2)return;const s=this._getInlayHintLabelPart(t);if(s&&(t.event.preventDefault(),await s.item.resolve(CancellationToken.None),isNonEmptyArray(s.item.hint.textEdits))){const o=s.item.hint.textEdits.map(r=>EditOperation.replace(Range$2.lift(r.range),r.text));this._editor.executeEdits("inlayHint.default",o),e()}})}_installContextMenu(){return this._editor.onContextMenu(async e=>{if(!isHTMLElement(e.event.target))return;const t=this._getInlayHintLabelPart(e);t&&await this._instaService.invokeFunction(showGoToContextMenu,this._editor,e.event.target,t)})}_getInlayHintLabelPart(e){var s;if(e.target.type!==6)return;const t=(s=e.target.detail.injectedText)==null?void 0:s.options;if(t instanceof ModelDecorationInjectedTextOptions&&(t==null?void 0:t.attachedData)instanceof RenderedInlayHintLabelPart)return t.attachedData}async _invokeCommand(e,t){try{await this._commandService.executeCommand(e.id,...e.arguments??[])}catch(s){this._notificationService.notify({severity:Severity.Error,source:t.provider.displayName,message:s})}}_cacheHintsForFastRestore(e){const t=this._copyInlayHintsWithCurrentAnchor(e);this._inlayHintsCache.set(e,t)}_copyInlayHintsWithCurrentAnchor(e){const t=new Map;for(const[s,o]of this._decorationsMetadata){if(t.has(o.item))continue;const r=e.getDecorationRange(s);if(r){const l=new InlayHintAnchor(r,o.item.anchor.direction),c=o.item.with({anchor:l});t.set(o.item,c)}}return Array.from(t.values())}_getHintsRanges(){const t=this._editor.getModel(),s=this._editor.getVisibleRangesPlusViewportAboveBelow(),o=[];for(const r of s.sort(Range$2.compareRangesUsingStarts)){const l=t.validateRange(new Range$2(r.startLineNumber-30,r.startColumn,r.endLineNumber+30,r.endColumn));o.length===0||!Range$2.areIntersectingOrTouching(o[o.length-1],l)?o.push(l):o[o.length-1]=Range$2.plusRange(o[o.length-1],l)}return o}_updateHintsDecorators(e,t){var b,v;const s=new Map;if(this._cursorInfo&&this._cursorInfo.notEarlierThan>Date.now()&&e.some(S=>S.containsPosition(this._cursorInfo.position))){const{position:S}=this._cursorInfo;this._cursorInfo=void 0;const y=new Map;for(const E of this._editor.getLineDecorations(S.lineNumber)??[]){const I=this._decorationsMetadata.get(E.id);if(E.range.startColumn>S.column)continue;const D=I==null?void 0:I.decoration.options[I.item.anchor.direction];if(D&&D.attachedData!==InlayHintsController_1._whitespaceData){const k=y.get(I.item)??0;y.set(I.item,k+D.content.length)}}const w=t.filter(E=>E.anchor.range.startLineNumber===S.lineNumber&&E.anchor.range.endColumn<=S.column),L=Array.from(y.values());let x;for(;;){const E=w.shift(),I=L.shift();if(!I&&!E)break;if(E)s.set(E,I??0),x=E;else if(x&&I){let D=s.get(x);D+=I,D+=L.reduce((k,N)=>k+N,0),L.length=0;break}}}const o=[],r=(S,y,w,L,x)=>{const E={content:w,inlineClassNameAffectsLetterSpacing:!0,inlineClassName:y.className,cursorStops:L,attachedData:x};o.push({item:S,classNameRef:y,decoration:{range:S.anchor.range,options:{description:"InlayHint",showIfCollapsed:S.anchor.range.isEmpty(),collapseOnReplaceEdit:!S.anchor.range.isEmpty(),stickiness:0,[S.anchor.direction]:this._activeRenderMode===0?E:void 0}}})},l=(S,y)=>{const w=this._ruleFactory.createClassNameRef({width:`${c/3|0}px`,display:"inline-block"});r(S,w," ",y?InjectedTextCursorStops$1.Right:InjectedTextCursorStops$1.None,InlayHintsController_1._whitespaceData)},{fontSize:c,fontFamily:d,padding:u,isUniform:g}=this._getLayoutInfo(),f=this._editor.getOption(159).maximumLength,p="--code-editorInlayHintsFontFamily";this._editor.getContainerDomNode().style.setProperty(p,d);let m={line:0,totalLen:0};for(let S=0;S<t.length;S++){const y=t[S];if(m.line!==y.anchor.range.startLineNumber&&(m={line:y.anchor.range.startLineNumber,totalLen:0}),f&&m.totalLen>f)continue;y.hint.paddingLeft&&l(y,!1);const w=typeof y.hint.label=="string"?[{label:y.hint.label}]:y.hint.label,L=s.get(y);let x=0;for(let E=0;E<w.length;E++){const I=w[E],D=E===0,k=E===w.length-1,N={fontSize:`${c}px`,fontFamily:`var(${p}), ${EDITOR_FONT_DEFAULTS.fontFamily}`,verticalAlign:g?"baseline":"middle",unicodeBidi:"isolate"};isNonEmptyArray(y.hint.textEdits)&&(N.cursor="default"),this._fillInColors(N,y.hint),(I.command||I.location)&&((b=this._activeInlayHintPart)==null?void 0:b.part.item)===y&&this._activeInlayHintPart.part.index===E&&(N.textDecoration="underline",this._activeInlayHintPart.hasTriggerModifier&&(N.color=themeColorFromId(editorActiveLinkForeground),N.cursor="pointer"));let R=I.label;m.totalLen+=R.length;let M=!1;const A=f!==0?m.totalLen-f:0;if(A>0&&(R=R.slice(0,-A)+"…",M=!0),x+=R.length,L!==void 0){const O=x-L;O>=0&&(x-=O,R=R.slice(0,-(1+O))+"…",M=!0)}if(u&&(D&&(k||M)?(N.padding=`1px ${Math.max(1,c/4)|0}px`,N.borderRadius=`${c/4|0}px`):D?(N.padding=`1px 0 1px ${Math.max(1,c/4)|0}px`,N.borderRadius=`${c/4|0}px 0 0 ${c/4|0}px`):k||M?(N.padding=`1px ${Math.max(1,c/4)|0}px 1px 0`,N.borderRadius=`0 ${c/4|0}px ${c/4|0}px 0`):N.padding="1px 0 1px 0"),r(y,this._ruleFactory.createClassNameRef(N),fixSpace(R),k&&!y.hint.paddingRight?InjectedTextCursorStops$1.Right:InjectedTextCursorStops$1.None,new RenderedInlayHintLabelPart(y,E)),M)break}if(L!==void 0&&x<L){const E=L-x;r(y,this._ruleFactory.createClassNameRef({})," ".repeat(E),InjectedTextCursorStops$1.None)}if(y.hint.paddingRight&&l(y,!0),o.length>InlayHintsController_1._MAX_DECORATORS)break}const _=[];for(const[S,y]of this._decorationsMetadata){const w=(v=this._editor.getModel())==null?void 0:v.getDecorationRange(S);w&&e.some(L=>L.containsRange(w))&&(_.push(S),y.classNameRef.dispose(),this._decorationsMetadata.delete(S))}const C=StableEditorScrollState.capture(this._editor);this._editor.changeDecorations(S=>{const y=S.deltaDecorations(_,o.map(w=>w.decoration));for(let w=0;w<y.length;w++){const L=o[w];this._decorationsMetadata.set(y[w],L)}}),C.restore(this._editor)}_fillInColors(e,t){t.kind===InlayHintKind$1.Parameter?(e.backgroundColor=themeColorFromId(editorInlayHintParameterBackground),e.color=themeColorFromId(editorInlayHintParameterForeground)):t.kind===InlayHintKind$1.Type?(e.backgroundColor=themeColorFromId(editorInlayHintTypeBackground),e.color=themeColorFromId(editorInlayHintTypeForeground)):(e.backgroundColor=themeColorFromId(editorInlayHintBackground),e.color=themeColorFromId(editorInlayHintForeground))}_getLayoutInfo(){const e=this._editor.getOption(159),t=e.padding,s=this._editor.getOption(61),o=this._editor.getOption(58);let r=e.fontSize;(!r||r<5||r>s)&&(r=s);const l=e.fontFamily||o;return{fontSize:r,fontFamily:l,padding:t,isUniform:!t&&l===o&&r===s}}_removeAllDecorations(){this._editor.removeDecorations(Array.from(this._decorationsMetadata.keys()));for(const e of this._decorationsMetadata.values())e.classNameRef.dispose();this._decorationsMetadata.clear()}},InlayHintsController_1=ht,ht.ID="editor.contrib.InlayHints",ht._MAX_DECORATORS=1500,ht._whitespaceData={},ht);InlayHintsController=InlayHintsController_1=__decorate$1Q([__param$1P(1,ILanguageFeaturesService),__param$1P(2,ILanguageFeatureDebounceService),__param$1P(3,IInlayHintsCache),__param$1P(4,ICommandService),__param$1P(5,INotificationService),__param$1P(6,IInstantiationService)],InlayHintsController);function fixSpace(a){const e=" ";return a.replace(/[ \t]/g,e)}CommandsRegistry.registerCommand("_executeInlayHintProvider",async(a,...e)=>{const[t,s]=e;assertType(URI.isUri(t)),assertType(Range$2.isIRange(s));const{inlayHintsProvider:o}=a.get(ILanguageFeaturesService),r=await a.get(ITextModelService).createModelReference(t);try{const l=await InlayHintsFragments.create(o,r.object.textEditorModel,[Range$2.lift(s)],CancellationToken.None),c=l.items.map(d=>d.hint);return setTimeout(()=>l.dispose(),0),c}finally{r.dispose()}});var __decorate$1P=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1O=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class InlayHintsHoverAnchor extends HoverForeignElementAnchor{constructor(e,t,s,o){super(10,t,e.item.anchor.range,s,o,!0),this.part=e}}let InlayHintsHover=class extends MarkdownHoverParticipant{constructor(e,t,s,o,r,l,c,d,u){super(e,t,s,l,d,o,r,u),this._resolverService=c,this.hoverOrdinal=6}suggestHoverAnchor(e){var o;if(!InlayHintsController.get(this._editor)||e.target.type!==6)return null;const s=(o=e.target.detail.injectedText)==null?void 0:o.options;return s instanceof ModelDecorationInjectedTextOptions&&s.attachedData instanceof RenderedInlayHintLabelPart?new InlayHintsHoverAnchor(s.attachedData,this,e.event.posx,e.event.posy):null}computeSync(){return[]}computeAsync(e,t,s,o){return e instanceof InlayHintsHoverAnchor?new AsyncIterableProducer(async r=>{const{part:l}=e;if(await l.item.resolve(o),o.isCancellationRequested)return;let c;typeof l.item.hint.tooltip=="string"?c=new MarkdownString().appendText(l.item.hint.tooltip):l.item.hint.tooltip&&(c=l.item.hint.tooltip),c&&r.emitOne(new MarkdownHover(this,e.range,[c],!1,0)),isNonEmptyArray(l.item.hint.textEdits)&&r.emitOne(new MarkdownHover(this,e.range,[new MarkdownString().appendText(localize(1157,"Double-click to insert"))],!1,10001));let d;if(typeof l.part.tooltip=="string"?d=new MarkdownString().appendText(l.part.tooltip):l.part.tooltip&&(d=l.part.tooltip),d&&r.emitOne(new MarkdownHover(this,e.range,[d],!1,1)),l.part.location||l.part.command){let g;const p=this._editor.getOption(86)==="altKey"?isMacintosh?localize(1158,"cmd + click"):localize(1159,"ctrl + click"):isMacintosh?localize(1160,"option + click"):localize(1161,"alt + click");l.part.location&&l.part.command?g=new MarkdownString().appendText(localize(1162,"Go to Definition ({0}), right click for more",p)):l.part.location?g=new MarkdownString().appendText(localize(1163,"Go to Definition ({0})",p)):l.part.command&&(g=new MarkdownString(`[${localize(1164,"Execute Command")}](${asCommandLink(l.part.command)} "${l.part.command.title}") (${p})`,{isTrusted:!0})),g&&r.emitOne(new MarkdownHover(this,e.range,[g],!1,1e4))}const u=this._resolveInlayHintLabelPartHover(l,o);for await(const g of u)r.emitOne(g)}):AsyncIterableProducer.EMPTY}async*_resolveInlayHintLabelPartHover(e,t){if(!e.part.location)return;const{uri:s,range:o}=e.part.location,r=await this._resolverService.createModelReference(s);try{const l=r.object.textEditorModel;if(!this._languageFeaturesService.hoverProvider.has(l))return;for await(const c of getHoverProviderResultsAsAsyncIterable(this._languageFeaturesService.hoverProvider,l,new Position$1(o.startLineNumber,o.startColumn),t))isEmptyMarkdownString(c.hover.contents)||(yield new MarkdownHover(this,e.item.anchor.range,c.hover.contents,!1,2+c.ordinal))}finally{r.dispose()}}};InlayHintsHover=__decorate$1P([__param$1O(1,ILanguageService),__param$1O(2,IOpenerService),__param$1O(3,IKeybindingService),__param$1O(4,IHoverService),__param$1O(5,IConfigurationService),__param$1O(6,ITextModelService),__param$1O(7,ILanguageFeaturesService),__param$1O(8,ICommandService)],InlayHintsHover);var __decorate$1O=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1N=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},RenderedContentHover_1,RenderedContentHoverParts_1;let RenderedContentHover=RenderedContentHover_1=class extends Disposable{constructor(e,t,s,o,r,l){super();const c=t.hoverParts;this._renderedHoverParts=this._register(new RenderedContentHoverParts(e,s,c,o,r,l));const d=t.options,u=d.anchor,{showAtPosition:g,showAtSecondaryPosition:f}=RenderedContentHover_1.computeHoverPositions(e,u.range,c);this.shouldAppearBeforeContent=c.some(p=>p.isBeforeContent),this.showAtPosition=g,this.showAtSecondaryPosition=f,this.initialMousePosX=u.initialMousePosX,this.initialMousePosY=u.initialMousePosY,this.shouldFocus=d.shouldFocus,this.source=d.source}get domNode(){return this._renderedHoverParts.domNode}get domNodeHasChildren(){return this._renderedHoverParts.domNodeHasChildren}get focusedHoverPartIndex(){return this._renderedHoverParts.focusedHoverPartIndex}get hoverPartsCount(){return this._renderedHoverParts.hoverPartsCount}focusHoverPartWithIndex(e){this._renderedHoverParts.focusHoverPartWithIndex(e)}async updateHoverVerbosityLevel(e,t,s){this._renderedHoverParts.updateHoverVerbosityLevel(e,t,s)}isColorPickerVisible(){return this._renderedHoverParts.isColorPickerVisible()}static computeHoverPositions(e,t,s){let o=1;if(e.hasModel()){const g=e._getViewModel(),f=g.coordinatesConverter,p=f.convertModelRangeToViewRange(t),m=g.getLineMinColumn(p.startLineNumber),_=new Position$1(p.startLineNumber,m);o=f.convertViewPositionToModelPosition(_).column}const r=t.startLineNumber;let l=t.startColumn,c;for(const g of s){const f=g.range,p=f.startLineNumber===r,m=f.endLineNumber===r;if(p&&m){const C=f.startColumn,b=Math.min(l,C);l=Math.max(b,o)}g.forceShowAtRange&&(c=f)}let d,u;if(c){const g=c.getStartPosition();d=g,u=g}else d=t.getStartPosition(),u=new Position$1(r,l);return{showAtPosition:d,showAtSecondaryPosition:u}}};RenderedContentHover=RenderedContentHover_1=__decorate$1O([__param$1N(4,IKeybindingService),__param$1N(5,IHoverService)],RenderedContentHover);class RenderedStatusBar{constructor(e,t){this._statusBar=t,e.appendChild(this._statusBar.hoverElement)}get hoverElement(){return this._statusBar.hoverElement}get actions(){return this._statusBar.actions}dispose(){this._statusBar.dispose()}}var ki;let RenderedContentHoverParts=(ki=class extends Disposable{constructor(e,t,s,o,r,l){super(),this._renderedParts=[],this._focusedHoverPartIndex=-1,this._context=o,this._fragment=document.createDocumentFragment(),this._register(this._renderParts(t,s,o,r,l)),this._register(this._registerListenersOnRenderedParts()),this._register(this._createEditorDecorations(e,s)),this._updateMarkdownAndColorParticipantInfo(t)}_createEditorDecorations(e,t){if(t.length===0)return Disposable.None;let s=t[0].range;for(const r of t){const l=r.range;s=Range$2.plusRange(s,l)}const o=e.createDecorationsCollection();return o.set([{range:s,options:RenderedContentHoverParts_1._DECORATION_OPTIONS}]),toDisposable(()=>{o.clear()})}_renderParts(e,t,s,o,r){const l=new EditorHoverStatusBar(o,r),c={fragment:this._fragment,statusBar:l,...s},d=new DisposableStore;d.add(l);for(const g of e){const f=this._renderHoverPartsForParticipant(t,g,c);d.add(f);for(const p of f.renderedHoverParts)this._renderedParts.push({type:"hoverPart",participant:g,hoverPart:p.hoverPart,hoverElement:p.hoverElement})}const u=this._renderStatusBar(this._fragment,l);return u&&(d.add(u),this._renderedParts.push({type:"statusBar",hoverElement:u.hoverElement,actions:u.actions})),d}_renderHoverPartsForParticipant(e,t,s){const o=e.filter(l=>l.owner===t);return o.length>0?t.renderHoverParts(s,o):new RenderedHoverParts([])}_renderStatusBar(e,t){if(t.hasContent)return new RenderedStatusBar(e,t)}_registerListenersOnRenderedParts(){const e=new DisposableStore;return this._renderedParts.forEach((t,s)=>{const o=t.hoverElement;o.tabIndex=0,e.add(addDisposableListener(o,EventType$1.FOCUS_IN,r=>{r.stopPropagation(),this._focusedHoverPartIndex=s})),e.add(addDisposableListener(o,EventType$1.FOCUS_OUT,r=>{r.stopPropagation(),this._focusedHoverPartIndex=-1}))}),e}_updateMarkdownAndColorParticipantInfo(e){const t=e.find(s=>s instanceof MarkdownHoverParticipant&&!(s instanceof InlayHintsHover));t&&(this._markdownHoverParticipant=t),this._colorHoverParticipant=e.find(s=>s instanceof HoverColorPickerParticipant)}focusHoverPartWithIndex(e){e<0||e>=this._renderedParts.length||this._renderedParts[e].hoverElement.focus()}async updateHoverVerbosityLevel(e,t,s){if(!this._markdownHoverParticipant)return;let o;t>=0?o={start:t,endExclusive:t+1}:o=this._findRangeOfMarkdownHoverParts(this._markdownHoverParticipant);for(let r=o.start;r<o.endExclusive;r++){const l=this._normalizedIndexToMarkdownHoverIndexRange(this._markdownHoverParticipant,r);if(l===void 0)continue;const c=await this._markdownHoverParticipant.updateMarkdownHoverVerbosityLevel(e,l);c&&(this._renderedParts[r]={type:"hoverPart",participant:this._markdownHoverParticipant,hoverPart:c.hoverPart,hoverElement:c.hoverElement})}s&&(t>=0?this.focusHoverPartWithIndex(t):this._context.focus()),this._context.onContentsChanged()}isColorPickerVisible(){var e;return((e=this._colorHoverParticipant)==null?void 0:e.isColorPickerVisible())??!1}_normalizedIndexToMarkdownHoverIndexRange(e,t){const s=this._renderedParts[t];if(!s||s.type!=="hoverPart"||!(s.participant===e))return;const r=this._renderedParts.findIndex(l=>l.type==="hoverPart"&&l.participant===e);if(r===-1)throw new BugIndicatingError;return t-r}_findRangeOfMarkdownHoverParts(e){const t=this._renderedParts.slice(),s=t.findIndex(l=>l.type==="hoverPart"&&l.participant===e),o=t.reverse().findIndex(l=>l.type==="hoverPart"&&l.participant===e),r=o>=0?t.length-o:o;return{start:s,endExclusive:r+1}}get domNode(){return this._fragment}get domNodeHasChildren(){return this._fragment.hasChildNodes()}get focusedHoverPartIndex(){return this._focusedHoverPartIndex}get hoverPartsCount(){return this._renderedParts.length}},RenderedContentHoverParts_1=ki,ki._DECORATION_OPTIONS=ModelDecorationOptions.register({description:"content-hover-highlight",className:"hoverHighlight"}),ki);RenderedContentHoverParts=RenderedContentHoverParts_1=__decorate$1O([__param$1N(4,IKeybindingService),__param$1N(5,IHoverService)],RenderedContentHoverParts);var __decorate$1N=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1M=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let ContentHoverWidgetWrapper=class extends Disposable{constructor(e,t,s,o){super(),this._editor=e,this._instantiationService=t,this._keybindingService=s,this._hoverService=o,this._currentResult=null,this._renderedContentHover=this._register(new MutableDisposable),this._onContentsChanged=this._register(new Emitter$1),this.onContentsChanged=this._onContentsChanged.event,this._contentHoverWidget=this._register(this._instantiationService.createInstance(ContentHoverWidget,this._editor)),this._participants=this._initializeHoverParticipants(),this._hoverOperation=this._register(new HoverOperation(this._editor,new ContentHoverComputer(this._editor,this._participants))),this._registerListeners()}_initializeHoverParticipants(){const e=[];for(const t of HoverParticipantRegistry.getAll()){const s=this._instantiationService.createInstance(t,this._editor);e.push(s)}return e.sort((t,s)=>t.hoverOrdinal-s.hoverOrdinal),this._register(this._contentHoverWidget.onDidResize(()=>{this._participants.forEach(t=>{var s;return(s=t.handleResize)==null?void 0:s.call(t)})})),this._register(this._contentHoverWidget.onDidScroll(t=>{this._participants.forEach(s=>{var o;return(o=s.handleScroll)==null?void 0:o.call(s,t)})})),this._register(this._contentHoverWidget.onContentsChanged(()=>{this._participants.forEach(t=>{var s;return(s=t.handleContentsChanged)==null?void 0:s.call(t)})})),e}_registerListeners(){this._register(this._hoverOperation.onResult(t=>{const s=t.hasLoadingMessage?this._addLoadingMessage(t):t.value;this._withResult(new ContentHoverResult(s,t.isComplete,t.options))}));const e=this._contentHoverWidget.getDomNode();this._register(addStandardDisposableListener(e,"keydown",t=>{t.equals(9)&&this.hide()})),this._register(addStandardDisposableListener(e,"mouseleave",t=>{this._onMouseLeave(t)})),this._register(TokenizationRegistry.onDidChange(()=>{this._contentHoverWidget.position&&this._currentResult&&this._setCurrentResult(this._currentResult)})),this._register(this._contentHoverWidget.onContentsChanged(()=>{this._onContentsChanged.fire()}))}_startShowingOrUpdateHover(e,t,s,o,r){if(!(this._contentHoverWidget.position&&this._currentResult))return e?(this._startHoverOperationIfNecessary(e,t,s,o,!1),!0):!1;const c=this._editor.getOption(69).sticky,d=r&&this._contentHoverWidget.isMouseGettingCloser(r.event.posx,r.event.posy);return c&&d?(e&&this._startHoverOperationIfNecessary(e,t,s,o,!0),!0):e?this._currentResult&&this._currentResult.options.anchor.equals(e)?!0:this._currentResult&&e.canAdoptVisibleHover(this._currentResult.options.anchor,this._contentHoverWidget.position)?(this._currentResult&&this._setCurrentResult(this._currentResult.filter(e)),this._startHoverOperationIfNecessary(e,t,s,o,!1),!0):(this._setCurrentResult(null),this._startHoverOperationIfNecessary(e,t,s,o,!1),!0):(this._setCurrentResult(null),!1)}_startHoverOperationIfNecessary(e,t,s,o,r){if(this._hoverOperation.options&&this._hoverOperation.options.anchor.equals(e))return;this._hoverOperation.cancel();const c={anchor:e,source:s,shouldFocus:o,insistOnKeepingHoverVisible:r};this._hoverOperation.start(t,c)}_setCurrentResult(e){let t=e;if(this._currentResult===t)return;t&&t.hoverParts.length===0&&(t=null),this._currentResult=t,this._currentResult?this._showHover(this._currentResult):this._hideHover()}_addLoadingMessage(e){for(const t of this._participants){if(!t.createLoadingMessage)continue;const s=t.createLoadingMessage(e.options.anchor);if(s)return e.value.slice(0).concat([s])}return e.value}_withResult(e){if(this._contentHoverWidget.position&&this._currentResult&&this._currentResult.isComplete||this._setCurrentResult(e),!e.isComplete)return;const o=e.hoverParts.length===0,r=e.options.insistOnKeepingHoverVisible;o&&r||this._setCurrentResult(e)}_showHover(e){const t=this._getHoverContext();this._renderedContentHover.value=new RenderedContentHover(this._editor,e,this._participants,t,this._keybindingService,this._hoverService),this._renderedContentHover.value.domNodeHasChildren?this._contentHoverWidget.show(this._renderedContentHover.value):this._renderedContentHover.clear()}_hideHover(){this._contentHoverWidget.hide(),this._participants.forEach(e=>{var t;return(t=e.handleHide)==null?void 0:t.call(e)})}_getHoverContext(){return{hide:()=>{this.hide()},onContentsChanged:()=>{this._contentHoverWidget.handleContentsChanged()},setMinimumDimensions:r=>{this._contentHoverWidget.setMinimumDimensions(r)},focus:()=>this.focus()}}showsOrWillShow(e){if(this._contentHoverWidget.isResizing)return!0;const s=this._findHoverAnchorCandidates(e);if(!(s.length>0))return this._startShowingOrUpdateHover(null,0,0,!1,e);const r=s[0];return this._startShowingOrUpdateHover(r,0,0,!1,e)}_findHoverAnchorCandidates(e){const t=[];for(const o of this._participants){if(!o.suggestHoverAnchor)continue;const r=o.suggestHoverAnchor(e);r&&t.push(r)}const s=e.target;switch(s.type){case 6:{t.push(new HoverRangeAnchor(0,s.range,e.event.posx,e.event.posy));break}case 7:{const o=this._editor.getOption(59).typicalHalfwidthCharacterWidth/2;if(!(!s.detail.isAfterLines&&typeof s.detail.horizontalDistanceToText=="number"&&s.detail.horizontalDistanceToText<o))break;t.push(new HoverRangeAnchor(0,s.range,e.event.posx,e.event.posy));break}}return t.sort((o,r)=>r.priority-o.priority),t}_onMouseLeave(e){const t=this._editor.getDomNode();(!t||!isMousePositionWithinElement(t,e.x,e.y))&&this.hide()}startShowingAtRange(e,t,s,o){this._startShowingOrUpdateHover(new HoverRangeAnchor(0,e,void 0,void 0),t,s,o,null)}async updateHoverVerbosityLevel(e,t,s){var o;(o=this._renderedContentHover.value)==null||o.updateHoverVerbosityLevel(e,t,s)}focusedHoverPartIndex(){var e;return((e=this._renderedContentHover.value)==null?void 0:e.focusedHoverPartIndex)??-1}containsNode(e){return e?this._contentHoverWidget.getDomNode().contains(e):!1}focus(){var t;if(((t=this._renderedContentHover.value)==null?void 0:t.hoverPartsCount)===1){this.focusHoverPartWithIndex(0);return}this._contentHoverWidget.focus()}focusHoverPartWithIndex(e){var t;(t=this._renderedContentHover.value)==null||t.focusHoverPartWithIndex(e)}scrollUp(){this._contentHoverWidget.scrollUp()}scrollDown(){this._contentHoverWidget.scrollDown()}scrollLeft(){this._contentHoverWidget.scrollLeft()}scrollRight(){this._contentHoverWidget.scrollRight()}pageUp(){this._contentHoverWidget.pageUp()}pageDown(){this._contentHoverWidget.pageDown()}goToTop(){this._contentHoverWidget.goToTop()}goToBottom(){this._contentHoverWidget.goToBottom()}hide(){this._hoverOperation.cancel(),this._setCurrentResult(null)}getDomNode(){return this._contentHoverWidget.getDomNode()}get isColorPickerVisible(){var e;return((e=this._renderedContentHover.value)==null?void 0:e.isColorPickerVisible())??!1}get isVisibleFromKeyboard(){return this._contentHoverWidget.isVisibleFromKeyboard}get isVisible(){return this._contentHoverWidget.isVisible}get isFocused(){return this._contentHoverWidget.isFocused}get isResizing(){return this._contentHoverWidget.isResizing}get widget(){return this._contentHoverWidget}};ContentHoverWidgetWrapper=__decorate$1N([__param$1M(1,IInstantiationService),__param$1M(2,IKeybindingService),__param$1M(3,IHoverService)],ContentHoverWidgetWrapper);const hover$1="";function isOnColorDecorator(a){var t;const e=a.target;return!!e&&e.type===6&&((t=e.detail.injectedText)==null?void 0:t.options.attachedData)===ColorDecorationInjectedTextMarker}var __decorate$1M=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1L=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},ContentHoverController_1,Ri;let ContentHoverController=(Ri=class extends Disposable{constructor(e,t,s,o){super(),this._editor=e,this._instantiationService=s,this._keybindingService=o,this._onHoverContentsChanged=this._register(new Emitter$1),this.shouldKeepOpenOnEditorMouseMoveOrLeave=!1,this._listenersStore=new DisposableStore,this._isMouseDown=!1,this._ignoreMouseEvents=!1,this._reactToEditorMouseMoveRunner=this._register(new RunOnceScheduler(()=>{this._mouseMoveEvent&&this._reactToEditorMouseMove(this._mouseMoveEvent)},0)),this._register(t.onDidShowContextMenu(()=>{this.hideContentHover(),this._ignoreMouseEvents=!0})),this._register(t.onDidHideContextMenu(()=>{this._ignoreMouseEvents=!1})),this._hookListeners(),this._register(this._editor.onDidChangeConfiguration(r=>{r.hasChanged(69)&&(this._unhookListeners(),this._hookListeners())}))}static get(e){return e.getContribution(ContentHoverController_1.ID)}_hookListeners(){const e=this._editor.getOption(69);this._hoverSettings={enabled:e.enabled,sticky:e.sticky,hidingDelay:e.hidingDelay},e.enabled||this._cancelSchedulerAndHide(),this._listenersStore.add(this._editor.onMouseDown(t=>this._onEditorMouseDown(t))),this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp())),this._listenersStore.add(this._editor.onMouseMove(t=>this._onEditorMouseMove(t))),this._listenersStore.add(this._editor.onKeyDown(t=>this._onKeyDown(t))),this._listenersStore.add(this._editor.onMouseLeave(t=>this._onEditorMouseLeave(t))),this._listenersStore.add(this._editor.onDidChangeModel(()=>this._cancelSchedulerAndHide())),this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler())),this._listenersStore.add(this._editor.onDidScrollChange(t=>this._onEditorScrollChanged(t)))}_unhookListeners(){this._listenersStore.clear()}_cancelSchedulerAndHide(){this._cancelScheduler(),this.hideContentHover()}_cancelScheduler(){this._mouseMoveEvent=void 0,this._reactToEditorMouseMoveRunner.cancel()}_onEditorScrollChanged(e){this._ignoreMouseEvents||(e.scrollTopChanged||e.scrollLeftChanged)&&this.hideContentHover()}_onEditorMouseDown(e){this._ignoreMouseEvents||(this._isMouseDown=!0,this._shouldKeepHoverWidgetVisible(e))||this.hideContentHover()}_shouldKeepHoverWidgetVisible(e){return this._isMouseOnContentHoverWidget(e)||this._isContentWidgetResizing()||isOnColorDecorator(e)}_isMouseOnContentHoverWidget(e){return this._contentWidget?isMousePositionWithinElement(this._contentWidget.getDomNode(),e.event.posx,e.event.posy):!1}_onEditorMouseUp(){this._ignoreMouseEvents||(this._isMouseDown=!1)}_onEditorMouseLeave(e){this._ignoreMouseEvents||this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._cancelScheduler(),this._shouldKeepHoverWidgetVisible(e))||this.hideContentHover()}_shouldKeepCurrentHover(e){const t=this._contentWidget;if(!t)return!1;const s=this._hoverSettings.sticky,o=(g,f)=>{const p=this._isMouseOnContentHoverWidget(g);return f&&p},r=g=>{const f=t.isColorPickerVisible,p=this._isMouseOnContentHoverWidget(g),m=f&&p,_=f&&this._isMouseDown;return m||_},l=(g,f)=>{var m;const p=g.event.browserEvent.view;return p?f&&t.containsNode(p.document.activeElement)&&!((m=p.getSelection())!=null&&m.isCollapsed):!1},c=t.isFocused,d=t.isResizing,u=this._hoverSettings.sticky&&t.isVisibleFromKeyboard;return this.shouldKeepOpenOnEditorMouseMoveOrLeave||c||d||u||o(e,s)||r(e)||l(e,s)}_onEditorMouseMove(e){if(this._ignoreMouseEvents)return;if(this._mouseMoveEvent=e,this._shouldKeepCurrentHover(e)){this._reactToEditorMouseMoveRunner.cancel();return}if(this._shouldRescheduleHoverComputation()){this._reactToEditorMouseMoveRunner.isScheduled()||this._reactToEditorMouseMoveRunner.schedule(this._hoverSettings.hidingDelay);return}this._reactToEditorMouseMove(e)}_shouldRescheduleHoverComputation(){var s;const e=this._hoverSettings.hidingDelay;return(((s=this._contentWidget)==null?void 0:s.isVisible)??!1)&&this._hoverSettings.sticky&&e>0}_reactToEditorMouseMove(e){this._hoverSettings.enabled&&this._getOrCreateContentWidget().showsOrWillShow(e)||this.hideContentHover()}_onKeyDown(e){if(this._ignoreMouseEvents||!this._contentWidget)return;const t=this._isPotentialKeyboardShortcut(e),s=this._isModifierKeyPressed(e);t||s||this._contentWidget.isFocused&&e.keyCode===2||this.hideContentHover()}_isPotentialKeyboardShortcut(e){if(!this._editor.hasModel()||!this._contentWidget)return!1;const t=this._keybindingService.softDispatch(e,this._editor.getDomNode()),s=t.kind===1,o=t.kind===2&&(t.commandId===SHOW_OR_FOCUS_HOVER_ACTION_ID||t.commandId===INCREASE_HOVER_VERBOSITY_ACTION_ID||t.commandId===DECREASE_HOVER_VERBOSITY_ACTION_ID)&&this._contentWidget.isVisible;return s||o}_isModifierKeyPressed(e){return e.keyCode===5||e.keyCode===6||e.keyCode===57||e.keyCode===4}hideContentHover(){var e;InlineSuggestionHintsContentWidget.dropDownVisible||(e=this._contentWidget)==null||e.hide()}_getOrCreateContentWidget(){return this._contentWidget||(this._contentWidget=this._instantiationService.createInstance(ContentHoverWidgetWrapper,this._editor),this._listenersStore.add(this._contentWidget.onContentsChanged(()=>this._onHoverContentsChanged.fire()))),this._contentWidget}showContentHover(e,t,s,o){this._getOrCreateContentWidget().startShowingAtRange(e,t,s,o)}_isContentWidgetResizing(){var e;return((e=this._contentWidget)==null?void 0:e.widget.isResizing)||!1}focusedHoverPartIndex(){return this._getOrCreateContentWidget().focusedHoverPartIndex()}updateHoverVerbosityLevel(e,t,s){this._getOrCreateContentWidget().updateHoverVerbosityLevel(e,t,s)}focus(){var e;(e=this._contentWidget)==null||e.focus()}scrollUp(){var e;(e=this._contentWidget)==null||e.scrollUp()}scrollDown(){var e;(e=this._contentWidget)==null||e.scrollDown()}scrollLeft(){var e;(e=this._contentWidget)==null||e.scrollLeft()}scrollRight(){var e;(e=this._contentWidget)==null||e.scrollRight()}pageUp(){var e;(e=this._contentWidget)==null||e.pageUp()}pageDown(){var e;(e=this._contentWidget)==null||e.pageDown()}goToTop(){var e;(e=this._contentWidget)==null||e.goToTop()}goToBottom(){var e;(e=this._contentWidget)==null||e.goToBottom()}get isColorPickerVisible(){var e;return(e=this._contentWidget)==null?void 0:e.isColorPickerVisible}get isHoverVisible(){var e;return(e=this._contentWidget)==null?void 0:e.isVisible}dispose(){var e;super.dispose(),this._unhookListeners(),this._listenersStore.dispose(),(e=this._contentWidget)==null||e.dispose()}},ContentHoverController_1=Ri,Ri.ID="editor.contrib.contentHover",Ri);ContentHoverController=ContentHoverController_1=__decorate$1M([__param$1L(1,IContextMenuService),__param$1L(2,IInstantiationService),__param$1L(3,IKeybindingService)],ContentHoverController);const jo=class jo extends Disposable{constructor(e){super(),this._editor=e,this._register(e.onMouseDown(t=>this.onMouseDown(t)))}dispose(){super.dispose()}onMouseDown(e){const t=this._editor.getOption(168);if(t!=="click"&&t!=="clickAndHover"||!isOnColorDecorator(e))return;const s=this._editor.getContribution(ContentHoverController.ID);if(!s||s.isColorPickerVisible)return;const o=e.target.range;if(!o)return;const r=new Range$2(o.startLineNumber,o.startColumn+1,o.endLineNumber,o.endColumn+1);s.showContentHover(r,1,1,!1)}};jo.ID="editor.contrib.colorContribution";let HoverColorPickerContribution=jo;var __decorate$1L=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1K=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class StandaloneColorPickerHover{constructor(e,t,s,o){this.owner=e,this.range=t,this.model=s,this.provider=o}static fromBaseColor(e,t){return new StandaloneColorPickerHover(e,t.range,t.model,t.provider)}}class StandaloneColorPickerRenderedParts extends Disposable{constructor(e,t,s,o){super();const r=e.getModel(),l=s.model;this.color=s.model.color,this.colorPicker=this._register(new ColorPickerWidget(t.fragment,l,e.getOption(163),o,"standalone")),this._register(l.onColorFlushed(c=>{this.color=c})),this._register(l.onDidChangeColor(c=>{updateColorPresentations(r,l,c,s.range,s)})),this._register(e.onDidChangeModelContent(c=>{t.hide(),e.focus()})),updateColorPresentations(r,l,this.color,s.range,s)}}let StandaloneColorPickerParticipant=class{constructor(e,t){this._editor=e,this._themeService=t}async createColorHover(e,t,s){if(!this._editor.hasModel()||!ColorDetector.get(this._editor))return null;const r=await getColors(s,this._editor.getModel(),CancellationToken.None);let l=null,c=null;for(const p of r){const m=p.colorInfo;Range$2.containsRange(m.range,e.range)&&(l=m,c=p.provider)}const d=l??e,u=c??t,g=!!l;return{colorHover:StandaloneColorPickerHover.fromBaseColor(this,await createColorHover(this._editor.getModel(),d,u)),foundInEditor:g}}async updateEditorModel(e){if(!this._editor.hasModel())return;const t=e.model;let s=new Range$2(e.range.startLineNumber,e.range.startColumn,e.range.endLineNumber,e.range.endColumn);this._color&&(await updateColorPresentations(this._editor.getModel(),t,this._color,s,e),s=updateEditorModel(this._editor,s,t))}renderHoverParts(e,t){if(!(t.length===0||!this._editor.hasModel()))return this._setMinimumDimensions(e),this._renderedParts=new StandaloneColorPickerRenderedParts(this._editor,e,t[0],this._themeService),this._renderedParts}_setMinimumDimensions(e){const t=this._editor.getOption(75)+8;e.setMinimumDimensions(new Dimension(302,t))}get _color(){var e;return(e=this._renderedParts)==null?void 0:e.color}};StandaloneColorPickerParticipant=__decorate$1L([__param$1K(1,IThemeService)],StandaloneColorPickerParticipant);var __decorate$1K=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1J=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},StandaloneColorPickerWidget_1;class StandaloneColorPickerResult{constructor(e,t){this.value=e,this.foundInEditor=t}}const PADDING=8,CLOSE_BUTTON_WIDTH=22;var Ni;let StandaloneColorPickerWidget=(Ni=class extends Disposable{constructor(e,t,s,o,r,l,c,d){var p;super(),this._editor=e,this._standaloneColorPickerVisible=t,this._standaloneColorPickerFocused=s,this._keybindingService=r,this._languageFeaturesService=l,this._editorWorkerService=c,this._hoverService=d,this.allowEditorOverflow=!0,this._position=void 0,this._body=document.createElement("div"),this._colorHover=null,this._selectionSetInEditor=!1,this._onResult=this._register(new Emitter$1),this.onResult=this._onResult.event,this._renderedHoverParts=this._register(new MutableDisposable),this._renderedStatusBar=this._register(new MutableDisposable),this._standaloneColorPickerVisible.set(!0),this._standaloneColorPickerParticipant=o.createInstance(StandaloneColorPickerParticipant,this._editor),this._position=(p=this._editor._getViewModel())==null?void 0:p.getPrimaryCursorState().modelState.position;const u=this._editor.getSelection(),g=u?{startLineNumber:u.startLineNumber,startColumn:u.startColumn,endLineNumber:u.endLineNumber,endColumn:u.endColumn}:{startLineNumber:0,endLineNumber:0,endColumn:0,startColumn:0},f=this._register(trackFocus(this._body));this._register(f.onDidBlur(m=>{this.hide()})),this._register(f.onDidFocus(m=>{this.focus()})),this._register(this._editor.onDidChangeCursorPosition(()=>{this._selectionSetInEditor?this._selectionSetInEditor=!1:this.hide()})),this._register(this._editor.onMouseMove(m=>{var C;const _=(C=m.target.element)==null?void 0:C.classList;_&&_.contains("colorpicker-color-decoration")&&this.hide()})),this._register(this.onResult(m=>{this._render(m.value,m.foundInEditor)})),this._start(g),this._body.style.zIndex="50",this._editor.addContentWidget(this)}updateEditor(){this._colorHover&&this._standaloneColorPickerParticipant.updateEditorModel(this._colorHover)}getId(){return StandaloneColorPickerWidget_1.ID}getDomNode(){return this._body}getPosition(){if(!this._position)return null;const e=this._editor.getOption(69).above;return{position:this._position,secondaryPosition:this._position,preference:e?[1,2]:[2,1],positionAffinity:2}}hide(){this.dispose(),this._standaloneColorPickerVisible.set(!1),this._standaloneColorPickerFocused.set(!1),this._editor.removeContentWidget(this),this._editor.focus()}focus(){this._standaloneColorPickerFocused.set(!0),this._body.focus()}async _start(e){const t=await this._computeAsync(e);t&&this._onResult.fire(new StandaloneColorPickerResult(t.result,t.foundInEditor))}async _computeAsync(e){if(!this._editor.hasModel())return null;const t={range:e,color:{red:0,green:0,blue:0,alpha:1}},s=await this._standaloneColorPickerParticipant.createColorHover(t,new DefaultDocumentColorProvider(this._editorWorkerService),this._languageFeaturesService.colorProvider);return s?{result:s.colorHover,foundInEditor:s.foundInEditor}:null}_render(e,t){const s=document.createDocumentFragment();this._renderedStatusBar.value=this._register(new EditorHoverStatusBar(this._keybindingService,this._hoverService));const o={fragment:s,statusBar:this._renderedStatusBar.value,onContentsChanged:()=>{},setMinimumDimensions:()=>{},hide:()=>this.hide(),focus:()=>this.focus()};if(this._colorHover=e,this._renderedHoverParts.value=this._standaloneColorPickerParticipant.renderHoverParts(o,[e]),!this._renderedHoverParts.value){this._renderedStatusBar.clear(),this._renderedHoverParts.clear();return}const r=this._renderedHoverParts.value.colorPicker;this._body.classList.add("standalone-colorpicker-body"),this._body.style.maxHeight=Math.max(this._editor.getLayoutInfo().height/4,250)+"px",this._body.style.maxWidth=Math.max(this._editor.getLayoutInfo().width*.66,500)+"px",this._body.tabIndex=0,this._body.appendChild(s),r.layout();const l=r.body,c=l.saturationBox.domNode.clientWidth,d=l.domNode.clientWidth-c-CLOSE_BUTTON_WIDTH-PADDING,u=r.body.enterButton;u==null||u.onClicked(()=>{this.updateEditor(),this.hide()});const g=r.header,f=g.pickedColorNode;f.style.width=c+PADDING+"px";const p=g.originalColorNode;p.style.width=d+"px";const m=r.header.closeButton;m==null||m.onClicked(()=>{this.hide()}),t&&(u&&(u.button.textContent="Replace"),this._selectionSetInEditor=!0,this._editor.setSelection(e.range)),this._editor.layoutContentWidget(this)}},StandaloneColorPickerWidget_1=Ni,Ni.ID="editor.contrib.standaloneColorPickerWidget",Ni);StandaloneColorPickerWidget=StandaloneColorPickerWidget_1=__decorate$1K([__param$1J(3,IInstantiationService),__param$1J(4,IKeybindingService),__param$1J(5,ILanguageFeaturesService),__param$1J(6,IEditorWorkerService),__param$1J(7,IHoverService)],StandaloneColorPickerWidget);var __decorate$1J=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1I=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},StandaloneColorPickerController_1,Mi;let StandaloneColorPickerController=(Mi=class extends Disposable{constructor(e,t,s){super(),this._editor=e,this._instantiationService=s,this._standaloneColorPickerWidget=null,this._standaloneColorPickerVisible=EditorContextKeys.standaloneColorPickerVisible.bindTo(t),this._standaloneColorPickerFocused=EditorContextKeys.standaloneColorPickerFocused.bindTo(t)}showOrFocus(){var e;this._editor.hasModel()&&(this._standaloneColorPickerVisible.get()?this._standaloneColorPickerFocused.get()||(e=this._standaloneColorPickerWidget)==null||e.focus():this._standaloneColorPickerWidget=this._instantiationService.createInstance(StandaloneColorPickerWidget,this._editor,this._standaloneColorPickerVisible,this._standaloneColorPickerFocused))}hide(){var e;this._standaloneColorPickerFocused.set(!1),this._standaloneColorPickerVisible.set(!1),(e=this._standaloneColorPickerWidget)==null||e.hide(),this._editor.focus()}insertColor(){var e;(e=this._standaloneColorPickerWidget)==null||e.updateEditor(),this.hide()}static get(e){return e.getContribution(StandaloneColorPickerController_1.ID)}},StandaloneColorPickerController_1=Mi,Mi.ID="editor.contrib.standaloneColorPickerController",Mi);StandaloneColorPickerController=StandaloneColorPickerController_1=__decorate$1J([__param$1I(1,IContextKeyService),__param$1I(2,IInstantiationService)],StandaloneColorPickerController);class ShowOrFocusStandaloneColorPicker extends EditorAction2{constructor(){super({id:"editor.action.showOrFocusStandaloneColorPicker",title:{...localize2(884,"Show or Focus Standalone Color Picker"),mnemonicTitle:localize(883,"&&Show or Focus Standalone Color Picker")},precondition:void 0,menu:[{id:MenuId.CommandPalette}],metadata:{description:localize2(885,"Show or focus a standalone color picker which uses the default color provider. It displays hex/rgb/hsl colors.")}})}runEditorCommand(e,t){var s;(s=StandaloneColorPickerController.get(t))==null||s.showOrFocus()}}class HideStandaloneColorPicker extends EditorAction{constructor(){super({id:"editor.action.hideColorPicker",label:localize2(886,"Hide the Color Picker"),precondition:EditorContextKeys.standaloneColorPickerVisible.isEqualTo(!0),kbOpts:{primary:9,weight:100},metadata:{description:localize2(887,"Hide the standalone color picker.")}})}run(e,t){var s;(s=StandaloneColorPickerController.get(t))==null||s.hide()}}class InsertColorWithStandaloneColorPicker extends EditorAction{constructor(){super({id:"editor.action.insertColorWithStandaloneColorPicker",label:localize2(888,"Insert Color with Standalone Color Picker"),precondition:EditorContextKeys.standaloneColorPickerFocused.isEqualTo(!0),kbOpts:{primary:3,weight:100},metadata:{description:localize2(889,"Insert hex/rgb/hsl colors with the focused standalone color picker.")}})}run(e,t){var s;(s=StandaloneColorPickerController.get(t))==null||s.insertColor()}}registerEditorAction(HideStandaloneColorPicker);registerEditorAction(InsertColorWithStandaloneColorPicker);registerAction2(ShowOrFocusStandaloneColorPicker);registerEditorContribution(HoverColorPickerContribution.ID,HoverColorPickerContribution,2);registerEditorContribution(StandaloneColorPickerController.ID,StandaloneColorPickerController,1);registerEditorContribution(ColorDetector.ID,ColorDetector,1);registerEditorFeature(DefaultDocumentColorProviderFeature);HoverParticipantRegistry.register(HoverColorPickerParticipant);CommandsRegistry.registerCommand("_executeDocumentColorProvider",function(a,...e){const[t]=e;if(!(t instanceof URI))throw illegalArgument();const{model:s,colorProviderRegistry:o,defaultColorDecoratorsEnablement:r}=_setupColorCommand(a,t);return _findColorData(new ExtColorDataCollector,o,s,CancellationToken.None,r)});CommandsRegistry.registerCommand("_executeColorPresentationProvider",function(a,...e){const[t,s]=e,{uri:o,range:r}=s;if(!(o instanceof URI)||!Array.isArray(t)||t.length!==4||!Range$2.isIRange(r))throw illegalArgument();const{model:l,colorProviderRegistry:c,defaultColorDecoratorsEnablement:d}=_setupColorCommand(a,o),[u,g,f,p]=t;return _findColorData(new ColorPresentationsCollector({range:r,color:{red:u,green:g,blue:f,alpha:p}}),c,l,CancellationToken.None,d)});class BlockCommentCommand{constructor(e,t,s){this.languageConfigurationService=s,this._selection=e,this._insertSpace=t,this._usedEndToken=null}static _haystackHasNeedleAtOffset(e,t,s){if(s<0)return!1;const o=t.length,r=e.length;if(s+o>r)return!1;for(let l=0;l<o;l++){const c=e.charCodeAt(s+l),d=t.charCodeAt(l);if(c!==d&&!(c>=65&&c<=90&&c+32===d)&&!(d>=65&&d<=90&&d+32===c))return!1}return!0}_createOperationsForBlockComment(e,t,s,o,r,l){const c=e.startLineNumber,d=e.startColumn,u=e.endLineNumber,g=e.endColumn,f=r.getLineContent(c),p=r.getLineContent(u);let m=f.lastIndexOf(t,d-1+t.length),_=p.indexOf(s,g-1-s.length);if(m!==-1&&_!==-1)if(c===u)f.substring(m+t.length,_).indexOf(s)>=0&&(m=-1,_=-1);else{const b=f.substring(m+t.length),v=p.substring(0,_);(b.indexOf(s)>=0||v.indexOf(s)>=0)&&(m=-1,_=-1)}let C;m!==-1&&_!==-1?(o&&m+t.length<f.length&&f.charCodeAt(m+t.length)===32&&(t=t+" "),o&&_>0&&p.charCodeAt(_-1)===32&&(s=" "+s,_-=1),C=BlockCommentCommand._createRemoveBlockCommentOperations(new Range$2(c,m+t.length+1,u,_+1),t,s)):(C=BlockCommentCommand._createAddBlockCommentOperations(e,t,s,this._insertSpace),this._usedEndToken=C.length===1?s:null);for(const b of C)l.addTrackedEditOperation(b.range,b.text)}static _createRemoveBlockCommentOperations(e,t,s){const o=[];return Range$2.isEmpty(e)?o.push(EditOperation.delete(new Range$2(e.startLineNumber,e.startColumn-t.length,e.endLineNumber,e.endColumn+s.length))):(o.push(EditOperation.delete(new Range$2(e.startLineNumber,e.startColumn-t.length,e.startLineNumber,e.startColumn))),o.push(EditOperation.delete(new Range$2(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn+s.length)))),o}static _createAddBlockCommentOperations(e,t,s,o){const r=[];return Range$2.isEmpty(e)?r.push(EditOperation.replace(new Range$2(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),t+"  "+s)):(r.push(EditOperation.insert(new Position$1(e.startLineNumber,e.startColumn),t+(o?" ":""))),r.push(EditOperation.insert(new Position$1(e.endLineNumber,e.endColumn),(o?" ":"")+s))),r}getEditOperations(e,t){const s=this._selection.startLineNumber,o=this._selection.startColumn;e.tokenization.tokenizeIfCheap(s);const r=e.getLanguageIdAtPosition(s,o),l=this.languageConfigurationService.getLanguageConfiguration(r).comments;!l||!l.blockCommentStartToken||!l.blockCommentEndToken||this._createOperationsForBlockComment(this._selection,l.blockCommentStartToken,l.blockCommentEndToken,this._insertSpace,e,t)}computeCursorState(e,t){const s=t.getInverseEditOperations();if(s.length===2){const o=s[0],r=s[1];return new Selection$1(o.range.endLineNumber,o.range.endColumn,r.range.startLineNumber,r.range.startColumn)}else{const o=s[0].range,r=this._usedEndToken?-this._usedEndToken.length-1:0;return new Selection$1(o.endLineNumber,o.endColumn+r,o.endLineNumber,o.endColumn+r)}}}class LineCommentCommand{constructor(e,t,s,o,r,l,c){this.languageConfigurationService=e,this._selection=t,this._indentSize=s,this._type=o,this._insertSpace=r,this._selectionId=null,this._deltaColumn=0,this._moveEndPositionDown=!1,this._ignoreEmptyLines=l,this._ignoreFirstLine=c||!1}static _gatherPreflightCommentStrings(e,t,s,o){e.tokenization.tokenizeIfCheap(t);const r=e.getLanguageIdAtPosition(t,1),l=o.getLanguageConfiguration(r).comments,c=l?l.lineCommentToken:null;if(!c)return null;const d=[];for(let u=0,g=s-t+1;u<g;u++)d[u]={ignore:!1,commentStr:c,commentStrOffset:0,commentStrLength:c.length};return d}static _analyzeLines(e,t,s,o,r,l,c,d,u){let g=!0;const f=d.getLanguageConfiguration(u).comments,p=(f==null?void 0:f.lineCommentNoIndent)??!1;let m;e===0?m=!0:e===1?m=!1:m=!0;for(let _=0,C=o.length;_<C;_++){const b=o[_],v=r+_;if(v===r&&c){b.ignore=!0;continue}const S=s.getLineContent(v),y=firstNonWhitespaceIndex(S);if(y===-1){b.ignore=l,b.commentStrOffset=p?0:S.length;continue}g=!1;const w=p?0:y;if(b.ignore=!1,b.commentStrOffset=w,m&&!BlockCommentCommand._haystackHasNeedleAtOffset(S,b.commentStr,w)&&(e===0?m=!1:e===1||(b.ignore=!0)),m&&t){const L=y+b.commentStrLength;L<S.length&&S.charCodeAt(L)===32&&(b.commentStrLength+=1)}}if(e===0&&g){m=!1;for(let _=0,C=o.length;_<C;_++)o[_].ignore=!1}return{supported:!0,shouldRemoveComments:m,lines:o}}static _gatherPreflightData(e,t,s,o,r,l,c,d){const u=LineCommentCommand._gatherPreflightCommentStrings(s,o,r,d),g=s.getLanguageIdAtPosition(o,1);return u===null?{supported:!1}:LineCommentCommand._analyzeLines(e,t,s,u,o,l,c,d,g)}_executeLineComments(e,t,s,o){let r;s.shouldRemoveComments?r=LineCommentCommand._createRemoveLineCommentsOperations(s.lines,o.startLineNumber):(LineCommentCommand._normalizeInsertionPoint(e,s.lines,o.startLineNumber,this._indentSize),r=this._createAddLineCommentsOperations(s.lines,o.startLineNumber));const l=new Position$1(o.positionLineNumber,o.positionColumn);for(let c=0,d=r.length;c<d;c++)t.addEditOperation(r[c].range,r[c].text),Range$2.isEmpty(r[c].range)&&Range$2.getStartPosition(r[c].range).equals(l)&&e.getLineContent(l.lineNumber).length+1===l.column&&(this._deltaColumn=(r[c].text||"").length);this._selectionId=t.trackSelection(o)}_attemptRemoveBlockComment(e,t,s,o){let r=t.startLineNumber,l=t.endLineNumber;const c=o.length+Math.max(e.getLineFirstNonWhitespaceColumn(t.startLineNumber),t.startColumn);let d=e.getLineContent(r).lastIndexOf(s,c-1),u=e.getLineContent(l).indexOf(o,t.endColumn-1-s.length);return d!==-1&&u===-1&&(u=e.getLineContent(r).indexOf(o,d+s.length),l=r),d===-1&&u!==-1&&(d=e.getLineContent(l).lastIndexOf(s,u),r=l),t.isEmpty()&&(d===-1||u===-1)&&(d=e.getLineContent(r).indexOf(s),d!==-1&&(u=e.getLineContent(r).indexOf(o,d+s.length))),d!==-1&&e.getLineContent(r).charCodeAt(d+s.length)===32&&(s+=" "),u!==-1&&e.getLineContent(l).charCodeAt(u-1)===32&&(o=" "+o,u-=1),d!==-1&&u!==-1?BlockCommentCommand._createRemoveBlockCommentOperations(new Range$2(r,d+s.length+1,l,u+1),s,o):null}_executeBlockComment(e,t,s){e.tokenization.tokenizeIfCheap(s.startLineNumber);const o=e.getLanguageIdAtPosition(s.startLineNumber,1),r=this.languageConfigurationService.getLanguageConfiguration(o).comments;if(!r||!r.blockCommentStartToken||!r.blockCommentEndToken)return;const l=r.blockCommentStartToken,c=r.blockCommentEndToken;let d=this._attemptRemoveBlockComment(e,s,l,c);if(!d){if(s.isEmpty()){const u=e.getLineContent(s.startLineNumber);let g=firstNonWhitespaceIndex(u);g===-1&&(g=u.length),d=BlockCommentCommand._createAddBlockCommentOperations(new Range$2(s.startLineNumber,g+1,s.startLineNumber,u.length+1),l,c,this._insertSpace)}else d=BlockCommentCommand._createAddBlockCommentOperations(new Range$2(s.startLineNumber,e.getLineFirstNonWhitespaceColumn(s.startLineNumber),s.endLineNumber,e.getLineMaxColumn(s.endLineNumber)),l,c,this._insertSpace);d.length===1&&(this._deltaColumn=l.length+1)}this._selectionId=t.trackSelection(s);for(const u of d)t.addEditOperation(u.range,u.text)}getEditOperations(e,t){let s=this._selection;if(this._moveEndPositionDown=!1,s.startLineNumber===s.endLineNumber&&this._ignoreFirstLine){t.addEditOperation(new Range$2(s.startLineNumber,e.getLineMaxColumn(s.startLineNumber),s.startLineNumber+1,1),s.startLineNumber===e.getLineCount()?"":`
`),this._selectionId=t.trackSelection(s);return}s.startLineNumber<s.endLineNumber&&s.endColumn===1&&(this._moveEndPositionDown=!0,s=s.setEndPosition(s.endLineNumber-1,e.getLineMaxColumn(s.endLineNumber-1)));const o=LineCommentCommand._gatherPreflightData(this._type,this._insertSpace,e,s.startLineNumber,s.endLineNumber,this._ignoreEmptyLines,this._ignoreFirstLine,this.languageConfigurationService);return o.supported?this._executeLineComments(e,t,o,s):this._executeBlockComment(e,t,s)}computeCursorState(e,t){let s=t.getTrackedSelection(this._selectionId);return this._moveEndPositionDown&&(s=s.setEndPosition(s.endLineNumber+1,1)),new Selection$1(s.selectionStartLineNumber,s.selectionStartColumn+this._deltaColumn,s.positionLineNumber,s.positionColumn+this._deltaColumn)}static _createRemoveLineCommentsOperations(e,t){const s=[];for(let o=0,r=e.length;o<r;o++){const l=e[o];l.ignore||s.push(EditOperation.delete(new Range$2(t+o,l.commentStrOffset+1,t+o,l.commentStrOffset+l.commentStrLength+1)))}return s}_createAddLineCommentsOperations(e,t){const s=[],o=this._insertSpace?" ":"";for(let r=0,l=e.length;r<l;r++){const c=e[r];c.ignore||s.push(EditOperation.insert(new Position$1(t+r,c.commentStrOffset+1),c.commentStr+o))}return s}static nextVisibleColumn(e,t,s,o){return s?e+(t-e%t):e+o}static _normalizeInsertionPoint(e,t,s,o){let r=1073741824,l,c;for(let d=0,u=t.length;d<u;d++){if(t[d].ignore)continue;const g=e.getLineContent(s+d);let f=0;for(let p=0,m=t[d].commentStrOffset;f<r&&p<m;p++)f=LineCommentCommand.nextVisibleColumn(f,o,g.charCodeAt(p)===9,1);f<r&&(r=f)}r=Math.floor(r/o)*o;for(let d=0,u=t.length;d<u;d++){if(t[d].ignore)continue;const g=e.getLineContent(s+d);let f=0;for(l=0,c=t[d].commentStrOffset;f<r&&l<c;l++)f=LineCommentCommand.nextVisibleColumn(f,o,g.charCodeAt(l)===9,1);f>r?t[d].commentStrOffset=l-1:t[d].commentStrOffset=l}}}class CommentLineAction extends EditorAction{constructor(e,t){super(t),this._type=e}run(e,t){const s=e.get(ILanguageConfigurationService);if(!t.hasModel())return;const o=t.getModel(),r=[],l=o.getOptions(),c=t.getOption(29),d=t.getSelections().map((g,f)=>({selection:g,index:f,ignoreFirstLine:!1}));d.sort((g,f)=>Range$2.compareRangesUsingStarts(g.selection,f.selection));let u=d[0];for(let g=1;g<d.length;g++){const f=d[g];u.selection.endLineNumber===f.selection.startLineNumber&&(u.index<f.index?f.ignoreFirstLine=!0:(u.ignoreFirstLine=!0,u=f))}for(const g of d)r.push(new LineCommentCommand(s,g.selection,l.indentSize,this._type,c.insertSpace,c.ignoreEmptyLines,g.ignoreFirstLine));t.pushUndoStop(),t.executeCommands(this.id,r),t.pushUndoStop()}}class ToggleCommentLineAction extends CommentLineAction{constructor(){super(0,{id:"editor.action.commentLine",label:localize2(892,"Toggle Line Comment"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2138,weight:100},menuOpts:{menuId:MenuId.MenubarEditMenu,group:"5_insert",title:localize(890,"&&Toggle Line Comment"),order:1}})}}class AddLineCommentAction extends CommentLineAction{constructor(){super(1,{id:"editor.action.addCommentLine",label:localize2(893,"Add Line Comment"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2081),weight:100}})}}class RemoveLineCommentAction extends CommentLineAction{constructor(){super(2,{id:"editor.action.removeCommentLine",label:localize2(894,"Remove Line Comment"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2099),weight:100}})}}class BlockCommentAction extends EditorAction{constructor(){super({id:"editor.action.blockComment",label:localize2(895,"Toggle Block Comment"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1567,linux:{primary:3103},weight:100},menuOpts:{menuId:MenuId.MenubarEditMenu,group:"5_insert",title:localize(891,"Toggle &&Block Comment"),order:2}})}run(e,t){const s=e.get(ILanguageConfigurationService);if(!t.hasModel())return;const o=t.getOption(29),r=[],l=t.getSelections();for(const c of l)r.push(new BlockCommentCommand(c,o.insertSpace,s));t.pushUndoStop(),t.executeCommands(this.id,r),t.pushUndoStop()}}registerEditorAction(ToggleCommentLineAction);registerEditorAction(AddLineCommentAction);registerEditorAction(RemoveLineCommentAction);registerEditorAction(BlockCommentAction);var __decorate$1I=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1H=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},ContextMenuController_1,Ai;let ContextMenuController=(Ai=class{static get(e){return e.getContribution(ContextMenuController_1.ID)}constructor(e,t,s,o,r,l,c,d){this._contextMenuService=t,this._contextViewService=s,this._contextKeyService=o,this._keybindingService=r,this._menuService=l,this._configurationService=c,this._workspaceContextService=d,this._toDispose=new DisposableStore,this._contextMenuIsBeingShownCount=0,this._editor=e,this._toDispose.add(this._editor.onContextMenu(u=>this._onContextMenu(u))),this._toDispose.add(this._editor.onMouseWheel(u=>{if(this._contextMenuIsBeingShownCount>0){const g=this._contextViewService.getContextViewElement(),f=u.srcElement;f.shadowRoot&&getShadowRoot(g)===f.shadowRoot||this._contextViewService.hideContextView()}})),this._toDispose.add(this._editor.onKeyDown(u=>{this._editor.getOption(30)&&u.keyCode===58&&(u.preventDefault(),u.stopPropagation(),this.showContextMenu())}))}_onContextMenu(e){if(!this._editor.hasModel())return;if(!this._editor.getOption(30)){this._editor.focus(),e.target.position&&!this._editor.getSelection().containsPosition(e.target.position)&&this._editor.setPosition(e.target.position);return}if(e.target.type===12||e.target.type===6&&e.target.detail.injectedText)return;if(e.event.preventDefault(),e.event.stopPropagation(),e.target.type===11)return this._showScrollbarContextMenu(e.event);if(e.target.type!==6&&e.target.type!==7&&e.target.type!==1)return;if(this._editor.focus(),e.target.position){let s=!1;for(const o of this._editor.getSelections())if(o.containsPosition(e.target.position)){s=!0;break}s||this._editor.setPosition(e.target.position)}let t=null;e.target.type!==1&&(t=e.event),this.showContextMenu(t)}showContextMenu(e){if(!this._editor.getOption(30)||!this._editor.hasModel())return;const t=this._getMenuActions(this._editor.getModel(),this._editor.contextMenuId);t.length>0&&this._doShowContextMenu(t,e)}_getMenuActions(e,t){const s=[],o=this._menuService.getMenuActions(t,this._contextKeyService,{arg:e.uri});for(const r of o){const[,l]=r;let c=0;for(const d of l)if(d instanceof SubmenuItemAction){const u=this._getMenuActions(e,d.item.submenu);u.length>0&&(s.push(new SubmenuAction(d.id,d.label,u)),c++)}else s.push(d),c++;c&&s.push(new Separator)}return s.length&&s.pop(),s}_doShowContextMenu(e,t=null){if(!this._editor.hasModel())return;let s=t;if(!s){this._editor.revealPosition(this._editor.getPosition(),1),this._editor.render();const r=this._editor.getScrolledVisiblePosition(this._editor.getPosition()),l=getDomNodePagePosition(this._editor.getDomNode()),c=l.left+r.left,d=l.top+r.top+r.height;s={x:c,y:d}}const o=this._editor.getOption(144)&&!isIOS;this._contextMenuIsBeingShownCount++,this._contextMenuService.showContextMenu({domForShadowRoot:o?this._editor.getOverflowWidgetsDomNode()??this._editor.getDomNode():void 0,getAnchor:()=>s,getActions:()=>e,getActionViewItem:r=>{const l=this._keybindingFor(r);if(l)return new ActionViewItem(r,r,{label:!0,keybinding:l.getLabel(),isMenu:!0});const c=r;return typeof c.getActionViewItem=="function"?c.getActionViewItem():new ActionViewItem(r,r,{icon:!0,label:!0,isMenu:!0})},getKeyBinding:r=>this._keybindingFor(r),onHide:r=>{this._contextMenuIsBeingShownCount--}})}_showScrollbarContextMenu(e){if(!this._editor.hasModel()||isStandaloneEditorWorkspace(this._workspaceContextService.getWorkspace()))return;const t=this._editor.getOption(81);let s=0;const o=u=>({id:`menu-action-${++s}`,label:u.label,tooltip:"",class:void 0,enabled:typeof u.enabled>"u"?!0:u.enabled,checked:u.checked,run:u.run}),r=(u,g)=>new SubmenuAction(`menu-action-${++s}`,u,g,void 0),l=(u,g,f,p,m)=>{if(!g)return o({label:u,enabled:g,run:()=>{}});const _=b=>()=>{this._configurationService.updateValue(f,b)},C=[];for(const b of m)C.push(o({label:b.label,checked:p===b.value,run:_(b.value)}));return r(u,C)},c=[];c.push(o({label:localize(896,"Minimap"),checked:t.enabled,run:()=>{this._configurationService.updateValue("editor.minimap.enabled",!t.enabled)}})),c.push(new Separator),c.push(o({label:localize(897,"Render Characters"),enabled:t.enabled,checked:t.renderCharacters,run:()=>{this._configurationService.updateValue("editor.minimap.renderCharacters",!t.renderCharacters)}})),c.push(l(localize(898,"Vertical size"),t.enabled,"editor.minimap.size",t.size,[{label:localize(899,"Proportional"),value:"proportional"},{label:localize(900,"Fill"),value:"fill"},{label:localize(901,"Fit"),value:"fit"}])),c.push(l(localize(902,"Slider"),t.enabled,"editor.minimap.showSlider",t.showSlider,[{label:localize(903,"Mouse Over"),value:"mouseover"},{label:localize(904,"Always"),value:"always"}]));const d=this._editor.getOption(144)&&!isIOS;this._contextMenuIsBeingShownCount++,this._contextMenuService.showContextMenu({domForShadowRoot:d?this._editor.getDomNode():void 0,getAnchor:()=>e,getActions:()=>c,onHide:u=>{this._contextMenuIsBeingShownCount--,this._editor.focus()}})}_keybindingFor(e){return this._keybindingService.lookupKeybinding(e.id)}dispose(){this._contextMenuIsBeingShownCount>0&&this._contextViewService.hideContextView(),this._toDispose.dispose()}},ContextMenuController_1=Ai,Ai.ID="editor.contrib.contextmenu",Ai);ContextMenuController=ContextMenuController_1=__decorate$1I([__param$1H(1,IContextMenuService),__param$1H(2,IContextViewService),__param$1H(3,IContextKeyService),__param$1H(4,IKeybindingService),__param$1H(5,IMenuService),__param$1H(6,IConfigurationService),__param$1H(7,IWorkspaceContextService)],ContextMenuController);class ShowContextMenu extends EditorAction{constructor(){super({id:"editor.action.showContextMenu",label:localize2(905,"Show Editor Context Menu"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:1092,weight:100}})}run(e,t){var s;(s=ContextMenuController.get(t))==null||s.showContextMenu()}}registerEditorContribution(ContextMenuController.ID,ContextMenuController,2);registerEditorAction(ShowContextMenu);class CursorState{constructor(e){this.selections=e}equals(e){const t=this.selections.length,s=e.selections.length;if(t!==s)return!1;for(let o=0;o<t;o++)if(!this.selections[o].equalsSelection(e.selections[o]))return!1;return!0}}class StackElement{constructor(e,t,s){this.cursorState=e,this.scrollTop=t,this.scrollLeft=s}}const Fs=class Fs extends Disposable{static get(e){return e.getContribution(Fs.ID)}constructor(e){super(),this._editor=e,this._isCursorUndoRedo=!1,this._undoStack=[],this._redoStack=[],this._register(e.onDidChangeModel(t=>{this._undoStack=[],this._redoStack=[]})),this._register(e.onDidChangeModelContent(t=>{this._undoStack=[],this._redoStack=[]})),this._register(e.onDidChangeCursorSelection(t=>{if(this._isCursorUndoRedo||!t.oldSelections||t.oldModelVersionId!==t.modelVersionId)return;const s=new CursorState(t.oldSelections);this._undoStack.length>0&&this._undoStack[this._undoStack.length-1].cursorState.equals(s)||(this._undoStack.push(new StackElement(s,e.getScrollTop(),e.getScrollLeft())),this._redoStack=[],this._undoStack.length>50&&this._undoStack.shift())}))}cursorUndo(){!this._editor.hasModel()||this._undoStack.length===0||(this._redoStack.push(new StackElement(new CursorState(this._editor.getSelections()),this._editor.getScrollTop(),this._editor.getScrollLeft())),this._applyState(this._undoStack.pop()))}cursorRedo(){!this._editor.hasModel()||this._redoStack.length===0||(this._undoStack.push(new StackElement(new CursorState(this._editor.getSelections()),this._editor.getScrollTop(),this._editor.getScrollLeft())),this._applyState(this._redoStack.pop()))}_applyState(e){this._isCursorUndoRedo=!0,this._editor.setSelections(e.cursorState.selections),this._editor.setScrollPosition({scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}),this._isCursorUndoRedo=!1}};Fs.ID="editor.contrib.cursorUndoRedoController";let CursorUndoRedoController=Fs;class CursorUndo extends EditorAction{constructor(){super({id:"cursorUndo",label:localize2(906,"Cursor Undo"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:2099,weight:100}})}run(e,t,s){var o;(o=CursorUndoRedoController.get(t))==null||o.cursorUndo()}}class CursorRedo extends EditorAction{constructor(){super({id:"cursorRedo",label:localize2(907,"Cursor Redo"),precondition:void 0})}run(e,t,s){var o;(o=CursorUndoRedoController.get(t))==null||o.cursorRedo()}}registerEditorContribution(CursorUndoRedoController.ID,CursorUndoRedoController,0);registerEditorAction(CursorUndo);registerEditorAction(CursorRedo);const dnd="";class DragAndDropCommand{constructor(e,t,s){this.selection=e,this.targetPosition=t,this.copy=s,this.targetSelection=null}getEditOperations(e,t){const s=e.getValueInRange(this.selection);if(this.copy||t.addEditOperation(this.selection,null),t.addEditOperation(new Range$2(this.targetPosition.lineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.targetPosition.column),s),this.selection.containsPosition(this.targetPosition)&&!(this.copy&&(this.selection.getEndPosition().equals(this.targetPosition)||this.selection.getStartPosition().equals(this.targetPosition)))){this.targetSelection=this.selection;return}if(this.copy){this.targetSelection=new Selection$1(this.targetPosition.lineNumber,this.targetPosition.column,this.selection.endLineNumber-this.selection.startLineNumber+this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}if(this.targetPosition.lineNumber>this.selection.endLineNumber){this.targetSelection=new Selection$1(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}if(this.targetPosition.lineNumber<this.selection.endLineNumber){this.targetSelection=new Selection$1(this.targetPosition.lineNumber,this.targetPosition.column,this.targetPosition.lineNumber+this.selection.endLineNumber-this.selection.startLineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}this.selection.endColumn<=this.targetPosition.column?this.targetSelection=new Selection$1(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column-this.selection.endColumn+this.selection.startColumn:this.targetPosition.column-this.selection.endColumn+this.selection.startColumn,this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column:this.selection.endColumn):this.targetSelection=new Selection$1(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.targetPosition.column+this.selection.endColumn-this.selection.startColumn)}computeCursorState(e,t){return this.targetSelection}}function hasTriggerModifier(a){return isMacintosh?a.altKey:a.ctrlKey}const it=class it extends Disposable{constructor(e){super(),this._editor=e,this._dndDecorationIds=this._editor.createDecorationsCollection(),this._register(this._editor.onMouseDown(t=>this._onEditorMouseDown(t))),this._register(this._editor.onMouseUp(t=>this._onEditorMouseUp(t))),this._register(this._editor.onMouseDrag(t=>this._onEditorMouseDrag(t))),this._register(this._editor.onMouseDrop(t=>this._onEditorMouseDrop(t))),this._register(this._editor.onMouseDropCanceled(()=>this._onEditorMouseDropCanceled())),this._register(this._editor.onKeyDown(t=>this.onEditorKeyDown(t))),this._register(this._editor.onKeyUp(t=>this.onEditorKeyUp(t))),this._register(this._editor.onDidBlurEditorWidget(()=>this.onEditorBlur())),this._register(this._editor.onDidBlurEditorText(()=>this.onEditorBlur())),this._mouseDown=!1,this._modifierPressed=!1,this._dragSelection=null}onEditorBlur(){this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1,this._modifierPressed=!1}onEditorKeyDown(e){!this._editor.getOption(42)||this._editor.getOption(28)||(hasTriggerModifier(e)&&(this._modifierPressed=!0),this._mouseDown&&hasTriggerModifier(e)&&this._editor.updateOptions({mouseStyle:"copy"}))}onEditorKeyUp(e){!this._editor.getOption(42)||this._editor.getOption(28)||(hasTriggerModifier(e)&&(this._modifierPressed=!1),this._mouseDown&&e.keyCode===it.TRIGGER_KEY_VALUE&&this._editor.updateOptions({mouseStyle:"default"}))}_onEditorMouseDown(e){this._mouseDown=!0}_onEditorMouseUp(e){this._mouseDown=!1,this._editor.updateOptions({mouseStyle:"text"})}_onEditorMouseDrag(e){const t=e.target;if(this._dragSelection===null){const o=(this._editor.getSelections()||[]).filter(r=>t.position&&r.containsPosition(t.position));if(o.length===1)this._dragSelection=o[0];else return}hasTriggerModifier(e.event)?this._editor.updateOptions({mouseStyle:"copy"}):this._editor.updateOptions({mouseStyle:"default"}),t.position&&(this._dragSelection.containsPosition(t.position)?this._removeDecoration():this.showAt(t.position))}_onEditorMouseDropCanceled(){this._editor.updateOptions({mouseStyle:"text"}),this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1}_onEditorMouseDrop(e){if(e.target&&(this._hitContent(e.target)||this._hitMargin(e.target))&&e.target.position){const t=new Position$1(e.target.position.lineNumber,e.target.position.column);if(this._dragSelection===null){let s=null;if(e.event.shiftKey){const o=this._editor.getSelection();if(o){const{selectionStartLineNumber:r,selectionStartColumn:l}=o;s=[new Selection$1(r,l,t.lineNumber,t.column)]}}else s=(this._editor.getSelections()||[]).map(o=>o.containsPosition(t)?new Selection$1(t.lineNumber,t.column,t.lineNumber,t.column):o);this._editor.setSelections(s||[],"mouse",3)}else(!this._dragSelection.containsPosition(t)||(hasTriggerModifier(e.event)||this._modifierPressed)&&(this._dragSelection.getEndPosition().equals(t)||this._dragSelection.getStartPosition().equals(t)))&&(this._editor.pushUndoStop(),this._editor.executeCommand(it.ID,new DragAndDropCommand(this._dragSelection,t,hasTriggerModifier(e.event)||this._modifierPressed)),this._editor.pushUndoStop())}this._editor.updateOptions({mouseStyle:"text"}),this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1}showAt(e){this._dndDecorationIds.set([{range:new Range$2(e.lineNumber,e.column,e.lineNumber,e.column),options:it._DECORATION_OPTIONS}]),this._editor.revealPosition(e,1)}_removeDecoration(){this._dndDecorationIds.clear()}_hitContent(e){return e.type===6||e.type===7}_hitMargin(e){return e.type===2||e.type===3||e.type===4}dispose(){this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1,this._modifierPressed=!1,super.dispose()}};it.ID="editor.contrib.dragAndDrop",it.TRIGGER_KEY_VALUE=isMacintosh?6:5,it._DECORATION_OPTIONS=ModelDecorationOptions.register({description:"dnd-target",className:"dnd-target"});let DragAndDropController=it;registerEditorContribution(DragAndDropController.ID,DragAndDropController,2);const pasteAsCommandId="editor.action.pasteAs";registerEditorContribution(CopyPasteController.ID,CopyPasteController,0);registerEditorFeature(DefaultPasteProvidersFeature);registerEditorCommand(new class extends EditorCommand{constructor(){super({id:changePasteTypeCommandId,precondition:pasteWidgetVisibleCtx,kbOpts:{weight:100,primary:2137}})}runEditorCommand(a,e){var t;return(t=CopyPasteController.get(e))==null?void 0:t.changePasteType()}});registerEditorCommand(new class extends EditorCommand{constructor(){super({id:"editor.hidePasteWidget",precondition:pasteWidgetVisibleCtx,kbOpts:{weight:100,primary:9}})}runEditorCommand(a,e){var t;(t=CopyPasteController.get(e))==null||t.clearWidgets()}});var Oi;registerEditorAction((Oi=class extends EditorAction{constructor(){super({id:pasteAsCommandId,label:localize2(910,"Paste As..."),precondition:EditorContextKeys.writable,metadata:{description:"Paste as",args:[{name:"args",schema:Oi.argsSchema}]}})}run(e,t,s){var r;let o;return s&&("kind"in s?o={only:new HierarchicalKind(s.kind)}:"preferences"in s&&(o={preferences:s.preferences.map(l=>new HierarchicalKind(l))})),(r=CopyPasteController.get(t))==null?void 0:r.pasteAs(o)}},Oi.argsSchema={oneOf:[{type:"object",required:["kind"],properties:{kind:{type:"string",description:localize(908,`The kind of the paste edit to try pasting with.
If there are multiple edits for this kind, the editor will show a picker. If there are no edits of this kind, the editor will show an error message.`)}}},{type:"object",required:["preferences"],properties:{preferences:{type:"array",description:localize(909,`List of preferred paste edit kind to try applying.
The first edit matching the preferences will be applied.`),items:{type:"string"}}}}]},Oi));registerEditorAction(class extends EditorAction{constructor(){super({id:"editor.action.pasteAsText",label:localize2(911,"Paste as Text"),precondition:EditorContextKeys.writable})}run(a,e){var t;return(t=CopyPasteController.get(e))==null?void 0:t.pasteAs({providerId:DefaultTextPasteOrDropEditProvider.id})}});class TreeViewsDnDService{constructor(){this._dragOperations=new Map}removeDragOperationTransfer(e){if(e&&this._dragOperations.has(e)){const t=this._dragOperations.get(e);return this._dragOperations.delete(e),t}}}class DraggedTreeItemsIdentifier{constructor(e){this.identifier=e}}const ITreeViewsDnDService=createDecorator("treeViewsDndService");registerSingleton(ITreeViewsDnDService,TreeViewsDnDService,1);var __decorate$1H=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1G=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},DropIntoEditorController_1;const dropAsPreferenceConfig="editor.dropIntoEditor.preferences",changeDropTypeCommandId="editor.changeDropType",dropWidgetVisibleCtx=new RawContextKey("dropWidgetVisible",!1,localize(929,"Whether the drop widget is showing"));var Pi;let DropIntoEditorController=(Pi=class extends Disposable{static get(e){return e.getContribution(DropIntoEditorController_1.ID)}constructor(e,t,s,o,r){super(),this._configService=s,this._languageFeaturesService=o,this._treeViewsDragAndDropService=r,this.treeItemsTransfer=LocalSelectionTransfer.getInstance(),this._dropProgressManager=this._register(t.createInstance(InlineProgressManager,"dropIntoEditor",e)),this._postDropWidgetManager=this._register(t.createInstance(PostEditWidgetManager,"dropIntoEditor",e,dropWidgetVisibleCtx,{id:changeDropTypeCommandId,label:localize(930,"Show drop options...")},()=>DropIntoEditorController_1._configureDefaultAction?[DropIntoEditorController_1._configureDefaultAction]:[])),this._register(e.onDropIntoEditor(l=>this.onDropIntoEditor(e,l.position,l.event)))}clearWidgets(){this._postDropWidgetManager.clear()}changeDropType(){this._postDropWidgetManager.tryShowSelector()}async onDropIntoEditor(e,t,s){var r;if(!s.dataTransfer||!e.hasModel())return;(r=DropIntoEditorController_1._currentDropOperation)==null||r.cancel(),e.focus(),e.setPosition(t);const o=createCancelablePromise(async l=>{const c=new DisposableStore,d=c.add(new EditorStateCancellationTokenSource(e,1,void 0,l));try{const u=await this.extractDataTransferData(s);if(u.size===0||d.token.isCancellationRequested)return;const g=e.getModel();if(!g)return;const f=this._languageFeaturesService.documentDropEditProvider.ordered(g).filter(m=>m.dropMimeTypes?m.dropMimeTypes.some(_=>u.matches(_)):!0),p=c.add(await this.getDropEdits(f,g,t,u,d.token));if(d.token.isCancellationRequested)return;if(p.edits.length){const m=this.getInitialActiveEditIndex(g,p.edits),_=e.getOption(43).showDropSelector==="afterDrop";await this._postDropWidgetManager.applyEditAndShowIfNeeded([Range$2.fromPositions(t)],{activeEditIndex:m,allEdits:p.edits},_,async C=>C,l)}}finally{c.dispose(),DropIntoEditorController_1._currentDropOperation===o&&(DropIntoEditorController_1._currentDropOperation=void 0)}});this._dropProgressManager.showWhile(t,localize(931,"Running drop handlers. Click to cancel"),o,{cancel:()=>o.cancel()}),DropIntoEditorController_1._currentDropOperation=o}async getDropEdits(e,t,s,o,r){const l=new DisposableStore,c=await raceCancellation(Promise.all(e.map(async u=>{try{const g=await u.provideDocumentDropEdits(t,s,o,r);return g&&l.add(g),g==null?void 0:g.edits.map(f=>({...f,providerId:u.id}))}catch(g){isCancellationError(g)||console.error(g),console.error(g)}})),r),d=coalesce(c??[]).flat();return{edits:sortEditsByYieldTo(d),dispose:()=>l.dispose()}}getInitialActiveEditIndex(e,t){const s=this._configService.getValue(dropAsPreferenceConfig,{resource:e.uri});for(const o of Array.isArray(s)?s:[]){const r=new HierarchicalKind(o),l=t.findIndex(c=>c.kind&&r.contains(c.kind));if(l>=0)return l}return 0}async extractDataTransferData(e){if(!e.dataTransfer)return new VSDataTransfer;const t=toExternalVSDataTransfer(e.dataTransfer);if(this.treeItemsTransfer.hasData(DraggedTreeItemsIdentifier.prototype)){const s=this.treeItemsTransfer.getData(DraggedTreeItemsIdentifier.prototype);if(Array.isArray(s))for(const o of s){const r=await this._treeViewsDragAndDropService.removeDragOperationTransfer(o.identifier);if(r)for(const[l,c]of r)t.replace(l,c)}}return t}},DropIntoEditorController_1=Pi,Pi.ID="editor.contrib.dropIntoEditorController",Pi);DropIntoEditorController=DropIntoEditorController_1=__decorate$1H([__param$1G(1,IInstantiationService),__param$1G(2,IConfigurationService),__param$1G(3,ILanguageFeaturesService),__param$1G(4,ITreeViewsDnDService)],DropIntoEditorController);registerEditorContribution(DropIntoEditorController.ID,DropIntoEditorController,2);registerEditorFeature(DefaultDropProvidersFeature);registerEditorCommand(new class extends EditorCommand{constructor(){super({id:changeDropTypeCommandId,precondition:dropWidgetVisibleCtx,kbOpts:{weight:100,primary:2137}})}runEditorCommand(a,e,t){var s;(s=DropIntoEditorController.get(e))==null||s.changeDropType()}});registerEditorCommand(new class extends EditorCommand{constructor(){super({id:"editor.hideDropWidget",precondition:dropWidgetVisibleCtx,kbOpts:{weight:100,primary:9}})}runEditorCommand(a,e,t){var s;(s=DropIntoEditorController.get(e))==null||s.clearWidgets()}});const ge=class ge{constructor(e){this._editor=e,this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null,this._startPosition=this._editor.getPosition()}dispose(){this._editor.removeDecorations(this._allDecorations()),this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null}reset(){this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null}getCount(){return this._decorations.length}getFindScope(){return this._findScopeDecorationIds[0]?this._editor.getModel().getDecorationRange(this._findScopeDecorationIds[0]):null}getFindScopes(){if(this._findScopeDecorationIds.length){const e=this._findScopeDecorationIds.map(t=>this._editor.getModel().getDecorationRange(t)).filter(t=>!!t);if(e.length)return e}return null}getStartPosition(){return this._startPosition}setStartPosition(e){this._startPosition=e,this.setCurrentFindMatch(null)}_getDecorationIndex(e){const t=this._decorations.indexOf(e);return t>=0?t+1:1}getDecorationRangeAt(e){const t=e<this._decorations.length?this._decorations[e]:null;return t?this._editor.getModel().getDecorationRange(t):null}getCurrentMatchesPosition(e){const t=this._editor.getModel().getDecorationsInRange(e);for(const s of t){const o=s.options;if(o===ge._FIND_MATCH_DECORATION||o===ge._CURRENT_FIND_MATCH_DECORATION)return this._getDecorationIndex(s.id)}return 0}setCurrentFindMatch(e){let t=null,s=0;if(e)for(let o=0,r=this._decorations.length;o<r;o++){const l=this._editor.getModel().getDecorationRange(this._decorations[o]);if(e.equalsRange(l)){t=this._decorations[o],s=o+1;break}}return(this._highlightedDecorationId!==null||t!==null)&&this._editor.changeDecorations(o=>{if(this._highlightedDecorationId!==null&&(o.changeDecorationOptions(this._highlightedDecorationId,ge._FIND_MATCH_DECORATION),this._highlightedDecorationId=null),t!==null&&(this._highlightedDecorationId=t,o.changeDecorationOptions(this._highlightedDecorationId,ge._CURRENT_FIND_MATCH_DECORATION)),this._rangeHighlightDecorationId!==null&&(o.removeDecoration(this._rangeHighlightDecorationId),this._rangeHighlightDecorationId=null),t!==null){let r=this._editor.getModel().getDecorationRange(t);if(r.startLineNumber!==r.endLineNumber&&r.endColumn===1){const l=r.endLineNumber-1,c=this._editor.getModel().getLineMaxColumn(l);r=new Range$2(r.startLineNumber,r.startColumn,l,c)}this._rangeHighlightDecorationId=o.addDecoration(r,ge._RANGE_HIGHLIGHT_DECORATION)}}),s}set(e,t){this._editor.changeDecorations(s=>{let o=ge._FIND_MATCH_DECORATION;const r=[];if(e.length>1e3){o=ge._FIND_MATCH_NO_OVERVIEW_DECORATION;const c=this._editor.getModel().getLineCount(),u=this._editor.getLayoutInfo().height/c,g=Math.max(2,Math.ceil(3/u));let f=e[0].range.startLineNumber,p=e[0].range.endLineNumber;for(let m=1,_=e.length;m<_;m++){const C=e[m].range;p+g>=C.startLineNumber?C.endLineNumber>p&&(p=C.endLineNumber):(r.push({range:new Range$2(f,1,p,1),options:ge._FIND_MATCH_ONLY_OVERVIEW_DECORATION}),f=C.startLineNumber,p=C.endLineNumber)}r.push({range:new Range$2(f,1,p,1),options:ge._FIND_MATCH_ONLY_OVERVIEW_DECORATION})}const l=new Array(e.length);for(let c=0,d=e.length;c<d;c++)l[c]={range:e[c].range,options:o};this._decorations=s.deltaDecorations(this._decorations,l),this._overviewRulerApproximateDecorations=s.deltaDecorations(this._overviewRulerApproximateDecorations,r),this._rangeHighlightDecorationId&&(s.removeDecoration(this._rangeHighlightDecorationId),this._rangeHighlightDecorationId=null),this._findScopeDecorationIds.length&&(this._findScopeDecorationIds.forEach(c=>s.removeDecoration(c)),this._findScopeDecorationIds=[]),t!=null&&t.length&&(this._findScopeDecorationIds=t.map(c=>s.addDecoration(c,ge._FIND_SCOPE_DECORATION)))})}matchBeforePosition(e){if(this._decorations.length===0)return null;for(let t=this._decorations.length-1;t>=0;t--){const s=this._decorations[t],o=this._editor.getModel().getDecorationRange(s);if(!(!o||o.endLineNumber>e.lineNumber)){if(o.endLineNumber<e.lineNumber)return o;if(!(o.endColumn>e.column))return o}}return this._editor.getModel().getDecorationRange(this._decorations[this._decorations.length-1])}matchAfterPosition(e){if(this._decorations.length===0)return null;for(let t=0,s=this._decorations.length;t<s;t++){const o=this._decorations[t],r=this._editor.getModel().getDecorationRange(o);if(!(!r||r.startLineNumber<e.lineNumber)){if(r.startLineNumber>e.lineNumber)return r;if(!(r.startColumn<e.column))return r}}return this._editor.getModel().getDecorationRange(this._decorations[0])}_allDecorations(){let e=[];return e=e.concat(this._decorations),e=e.concat(this._overviewRulerApproximateDecorations),this._findScopeDecorationIds.length&&e.push(...this._findScopeDecorationIds),this._rangeHighlightDecorationId&&e.push(this._rangeHighlightDecorationId),e}};ge._CURRENT_FIND_MATCH_DECORATION=ModelDecorationOptions.register({description:"current-find-match",stickiness:1,zIndex:13,className:"currentFindMatch",inlineClassName:"currentFindMatchInline",showIfCollapsed:!0,overviewRuler:{color:themeColorFromId(overviewRulerFindMatchForeground),position:OverviewRulerLane$1.Center},minimap:{color:themeColorFromId(minimapFindMatch),position:1}}),ge._FIND_MATCH_DECORATION=ModelDecorationOptions.register({description:"find-match",stickiness:1,zIndex:10,className:"findMatch",inlineClassName:"findMatchInline",showIfCollapsed:!0,overviewRuler:{color:themeColorFromId(overviewRulerFindMatchForeground),position:OverviewRulerLane$1.Center},minimap:{color:themeColorFromId(minimapFindMatch),position:1}}),ge._FIND_MATCH_NO_OVERVIEW_DECORATION=ModelDecorationOptions.register({description:"find-match-no-overview",stickiness:1,className:"findMatch",showIfCollapsed:!0}),ge._FIND_MATCH_ONLY_OVERVIEW_DECORATION=ModelDecorationOptions.register({description:"find-match-only-overview",stickiness:1,overviewRuler:{color:themeColorFromId(overviewRulerFindMatchForeground),position:OverviewRulerLane$1.Center}}),ge._RANGE_HIGHLIGHT_DECORATION=ModelDecorationOptions.register({description:"find-range-highlight",stickiness:1,className:"rangeHighlight",isWholeLine:!0}),ge._FIND_SCOPE_DECORATION=ModelDecorationOptions.register({description:"find-scope",className:"findScope",isWholeLine:!0});let FindDecorations=ge;class ReplaceAllCommand{constructor(e,t,s){this._editorSelection=e,this._ranges=t,this._replaceStrings=s,this._trackedEditorSelectionId=null}getEditOperations(e,t){if(this._ranges.length>0){const s=[];for(let l=0;l<this._ranges.length;l++)s.push({range:this._ranges[l],text:this._replaceStrings[l]});s.sort((l,c)=>Range$2.compareRangesUsingStarts(l.range,c.range));const o=[];let r=s[0];for(let l=1;l<s.length;l++)r.range.endLineNumber===s[l].range.startLineNumber&&r.range.endColumn===s[l].range.startColumn?(r.range=r.range.plusRange(s[l].range),r.text=r.text+s[l].text):(o.push(r),r=s[l]);o.push(r);for(const l of o)t.addEditOperation(l.range,l.text)}this._trackedEditorSelectionId=t.trackSelection(this._editorSelection)}computeCursorState(e,t){return t.getTrackedSelection(this._trackedEditorSelectionId)}}function buildReplaceStringWithCasePreserved(a,e){if(a&&a[0]!==""){const t=validateSpecificSpecialCharacter(a,e,"-"),s=validateSpecificSpecialCharacter(a,e,"_");return t&&!s?buildReplaceStringForSpecificSpecialCharacter(a,e,"-"):!t&&s?buildReplaceStringForSpecificSpecialCharacter(a,e,"_"):a[0].toUpperCase()===a[0]?e.toUpperCase():a[0].toLowerCase()===a[0]?e.toLowerCase():containsUppercaseCharacter(a[0][0])&&e.length>0?e[0].toUpperCase()+e.substr(1):a[0][0].toUpperCase()!==a[0][0]&&e.length>0?e[0].toLowerCase()+e.substr(1):e}else return e}function validateSpecificSpecialCharacter(a,e,t){return a[0].indexOf(t)!==-1&&e.indexOf(t)!==-1&&a[0].split(t).length===e.split(t).length}function buildReplaceStringForSpecificSpecialCharacter(a,e,t){const s=e.split(t),o=a[0].split(t);let r="";return s.forEach((l,c)=>{r+=buildReplaceStringWithCasePreserved([o[c]],l)+t}),r.slice(0,-1)}class StaticValueReplacePattern{constructor(e){this.staticValue=e,this.kind=0}}class DynamicPiecesReplacePattern{constructor(e){this.pieces=e,this.kind=1}}class ReplacePattern{static fromStaticValue(e){return new ReplacePattern([ReplacePiece.staticValue(e)])}get hasReplacementPatterns(){return this._state.kind===1}constructor(e){!e||e.length===0?this._state=new StaticValueReplacePattern(""):e.length===1&&e[0].staticValue!==null?this._state=new StaticValueReplacePattern(e[0].staticValue):this._state=new DynamicPiecesReplacePattern(e)}buildReplaceString(e,t){if(this._state.kind===0)return t?buildReplaceStringWithCasePreserved(e,this._state.staticValue):this._state.staticValue;let s="";for(let o=0,r=this._state.pieces.length;o<r;o++){const l=this._state.pieces[o];if(l.staticValue!==null){s+=l.staticValue;continue}let c=ReplacePattern._substitute(l.matchIndex,e);if(l.caseOps!==null&&l.caseOps.length>0){const d=[],u=l.caseOps.length;let g=0;for(let f=0,p=c.length;f<p;f++){if(g>=u){d.push(c.slice(f));break}switch(l.caseOps[g]){case"U":d.push(c[f].toUpperCase());break;case"u":d.push(c[f].toUpperCase()),g++;break;case"L":d.push(c[f].toLowerCase());break;case"l":d.push(c[f].toLowerCase()),g++;break;default:d.push(c[f])}}c=d.join("")}s+=c}return s}static _substitute(e,t){if(t===null)return"";if(e===0)return t[0];let s="";for(;e>0;){if(e<t.length)return(t[e]||"")+s;s=String(e%10)+s,e=Math.floor(e/10)}return"$"+s}}class ReplacePiece{static staticValue(e){return new ReplacePiece(e,-1,null)}static caseOps(e,t){return new ReplacePiece(null,e,t)}constructor(e,t,s){this.staticValue=e,this.matchIndex=t,!s||s.length===0?this.caseOps=null:this.caseOps=s.slice(0)}}class ReplacePieceBuilder{constructor(e){this._source=e,this._lastCharIndex=0,this._result=[],this._resultLen=0,this._currentStaticPiece=""}emitUnchanged(e){this._emitStatic(this._source.substring(this._lastCharIndex,e)),this._lastCharIndex=e}emitStatic(e,t){this._emitStatic(e),this._lastCharIndex=t}_emitStatic(e){e.length!==0&&(this._currentStaticPiece+=e)}emitMatchIndex(e,t,s){this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=ReplacePiece.staticValue(this._currentStaticPiece),this._currentStaticPiece=""),this._result[this._resultLen++]=ReplacePiece.caseOps(e,s),this._lastCharIndex=t}finalize(){return this.emitUnchanged(this._source.length),this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=ReplacePiece.staticValue(this._currentStaticPiece),this._currentStaticPiece=""),new ReplacePattern(this._result)}}function parseReplaceString(a){if(!a||a.length===0)return new ReplacePattern(null);const e=[],t=new ReplacePieceBuilder(a);for(let s=0,o=a.length;s<o;s++){const r=a.charCodeAt(s);if(r===92){if(s++,s>=o)break;const l=a.charCodeAt(s);switch(l){case 92:t.emitUnchanged(s-1),t.emitStatic("\\",s+1);break;case 110:t.emitUnchanged(s-1),t.emitStatic(`
`,s+1);break;case 116:t.emitUnchanged(s-1),t.emitStatic("	",s+1);break;case 117:case 85:case 108:case 76:t.emitUnchanged(s-1),t.emitStatic("",s+1),e.push(String.fromCharCode(l));break}continue}if(r===36){if(s++,s>=o)break;const l=a.charCodeAt(s);if(l===36){t.emitUnchanged(s-1),t.emitStatic("$",s+1);continue}if(l===48||l===38){t.emitUnchanged(s-1),t.emitMatchIndex(0,s+1,e),e.length=0;continue}if(49<=l&&l<=57){let c=l-48;if(s+1<o){const d=a.charCodeAt(s+1);if(48<=d&&d<=57){s++,c=c*10+(d-48),t.emitUnchanged(s-2),t.emitMatchIndex(c,s+1,e),e.length=0;continue}}t.emitUnchanged(s-1),t.emitMatchIndex(c,s+1,e),e.length=0;continue}}}return t.finalize()}const CONTEXT_FIND_WIDGET_VISIBLE=new RawContextKey("findWidgetVisible",!1);CONTEXT_FIND_WIDGET_VISIBLE.toNegated();const CONTEXT_FIND_INPUT_FOCUSED=new RawContextKey("findInputFocussed",!1),CONTEXT_REPLACE_INPUT_FOCUSED=new RawContextKey("replaceInputFocussed",!1),ToggleCaseSensitiveKeybinding={primary:545,mac:{primary:2593}},ToggleWholeWordKeybinding={primary:565,mac:{primary:2613}},ToggleRegexKeybinding={primary:560,mac:{primary:2608}},ToggleSearchScopeKeybinding={primary:554,mac:{primary:2602}},TogglePreserveCaseKeybinding={primary:558,mac:{primary:2606}},FIND_IDS={StartFindAction:"actions.find",StartFindWithSelection:"actions.findWithSelection",StartFindWithArgs:"editor.actions.findWithArgs",NextMatchFindAction:"editor.action.nextMatchFindAction",PreviousMatchFindAction:"editor.action.previousMatchFindAction",GoToMatchFindAction:"editor.action.goToMatchFindAction",NextSelectionMatchFindAction:"editor.action.nextSelectionMatchFindAction",PreviousSelectionMatchFindAction:"editor.action.previousSelectionMatchFindAction",StartFindReplaceAction:"editor.action.startFindReplaceAction",CloseFindWidgetCommand:"closeFindWidget",ToggleCaseSensitiveCommand:"toggleFindCaseSensitive",ToggleWholeWordCommand:"toggleFindWholeWord",ToggleRegexCommand:"toggleFindRegex",ToggleSearchScopeCommand:"toggleFindInSelection",TogglePreserveCaseCommand:"togglePreserveCase",ReplaceOneAction:"editor.action.replaceOne",ReplaceAllAction:"editor.action.replaceAll",SelectAllMatchesAction:"editor.action.selectAllMatches"},MATCHES_LIMIT=19999,RESEARCH_DELAY=240;class FindModelBoundToEditorModel{constructor(e,t){this._toDispose=new DisposableStore,this._editor=e,this._state=t,this._isDisposed=!1,this._startSearchingTimer=new TimeoutTimer,this._decorations=new FindDecorations(e),this._toDispose.add(this._decorations),this._updateDecorationsScheduler=new RunOnceScheduler(()=>{if(this._editor.hasModel())return this.research(!1)},100),this._toDispose.add(this._updateDecorationsScheduler),this._toDispose.add(this._editor.onDidChangeCursorPosition(s=>{(s.reason===3||s.reason===5||s.reason===6)&&this._decorations.setStartPosition(this._editor.getPosition())})),this._ignoreModelContentChanged=!1,this._toDispose.add(this._editor.onDidChangeModelContent(s=>{this._ignoreModelContentChanged||(s.isFlush&&this._decorations.reset(),this._decorations.setStartPosition(this._editor.getPosition()),this._updateDecorationsScheduler.schedule())})),this._toDispose.add(this._state.onFindReplaceStateChange(s=>this._onStateChanged(s))),this.research(!1,this._state.searchScope)}dispose(){this._isDisposed=!0,dispose(this._startSearchingTimer),this._toDispose.dispose()}_onStateChanged(e){this._isDisposed||this._editor.hasModel()&&(e.searchString||e.isReplaceRevealed||e.isRegex||e.wholeWord||e.matchCase||e.searchScope)&&(this._editor.getModel().isTooLargeForSyncing()?(this._startSearchingTimer.cancel(),this._startSearchingTimer.setIfNotSet(()=>{e.searchScope?this.research(e.moveCursor,this._state.searchScope):this.research(e.moveCursor)},RESEARCH_DELAY)):e.searchScope?this.research(e.moveCursor,this._state.searchScope):this.research(e.moveCursor))}static _getSearchRange(e,t){return t||e.getFullModelRange()}research(e,t){let s=null;typeof t<"u"?t!==null&&(Array.isArray(t)?s=t:s=[t]):s=this._decorations.getFindScopes(),s!==null&&(s=s.map(c=>{if(c.startLineNumber!==c.endLineNumber){let d=c.endLineNumber;return c.endColumn===1&&(d=d-1),new Range$2(c.startLineNumber,1,d,this._editor.getModel().getLineMaxColumn(d))}return c}));const o=this._findMatches(s,!1,MATCHES_LIMIT);this._decorations.set(o,s);const r=this._editor.getSelection();let l=this._decorations.getCurrentMatchesPosition(r);if(l===0&&o.length>0){const c=findFirstIdxMonotonousOrArrLen(o.map(d=>d.range),d=>Range$2.compareRangesUsingStarts(d,r)>=0);l=c>0?c-1+1:l}this._state.changeMatchInfo(l,this._decorations.getCount(),void 0),e&&this._editor.getOption(50).cursorMoveOnType&&this._moveToNextMatch(this._decorations.getStartPosition())}_hasMatches(){return this._state.matchesCount>0}_cannotFind(){if(!this._hasMatches()){const e=this._decorations.getFindScope();return e&&this._editor.revealRangeInCenterIfOutsideViewport(e,0),!0}return!1}_setCurrentFindMatch(e){const t=this._decorations.setCurrentFindMatch(e);this._state.changeMatchInfo(t,this._decorations.getCount(),e),this._editor.setSelection(e),this._editor.revealRangeInCenterIfOutsideViewport(e,0)}_prevSearchPosition(e){const t=this._state.isRegex&&(this._state.searchString.indexOf("^")>=0||this._state.searchString.indexOf("$")>=0);let{lineNumber:s,column:o}=e;const r=this._editor.getModel();return t||o===1?(s===1?s=r.getLineCount():s--,o=r.getLineMaxColumn(s)):o--,new Position$1(s,o)}_moveToPrevMatch(e,t=!1){if(!this._state.canNavigateBack()){const g=this._decorations.matchAfterPosition(e);g&&this._setCurrentFindMatch(g);return}if(this._decorations.getCount()<MATCHES_LIMIT){let g=this._decorations.matchBeforePosition(e);g&&g.isEmpty()&&g.getStartPosition().equals(e)&&(e=this._prevSearchPosition(e),g=this._decorations.matchBeforePosition(e)),g&&this._setCurrentFindMatch(g);return}if(this._cannotFind())return;const s=this._decorations.getFindScope(),o=FindModelBoundToEditorModel._getSearchRange(this._editor.getModel(),s);o.getEndPosition().isBefore(e)&&(e=o.getEndPosition()),e.isBefore(o.getStartPosition())&&(e=o.getEndPosition());const{lineNumber:r,column:l}=e,c=this._editor.getModel();let d=new Position$1(r,l),u=c.findPreviousMatch(this._state.searchString,d,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(148):null,!1);if(u&&u.range.isEmpty()&&u.range.getStartPosition().equals(d)&&(d=this._prevSearchPosition(d),u=c.findPreviousMatch(this._state.searchString,d,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(148):null,!1)),!!u){if(!t&&!o.containsRange(u.range))return this._moveToPrevMatch(u.range.getStartPosition(),!0);this._setCurrentFindMatch(u.range)}}moveToPrevMatch(){this._moveToPrevMatch(this._editor.getSelection().getStartPosition())}_nextSearchPosition(e){const t=this._state.isRegex&&(this._state.searchString.indexOf("^")>=0||this._state.searchString.indexOf("$")>=0);let{lineNumber:s,column:o}=e;const r=this._editor.getModel();return t||o===r.getLineMaxColumn(s)?(s===r.getLineCount()?s=1:s++,o=1):o++,new Position$1(s,o)}_moveToNextMatch(e){if(!this._state.canNavigateForward()){const s=this._decorations.matchBeforePosition(e);s&&this._setCurrentFindMatch(s);return}if(this._decorations.getCount()<MATCHES_LIMIT){let s=this._decorations.matchAfterPosition(e);s&&s.isEmpty()&&s.getStartPosition().equals(e)&&(e=this._nextSearchPosition(e),s=this._decorations.matchAfterPosition(e)),s&&this._setCurrentFindMatch(s);return}const t=this._getNextMatch(e,!1,!0);t&&this._setCurrentFindMatch(t.range)}_getNextMatch(e,t,s,o=!1){if(this._cannotFind())return null;const r=this._decorations.getFindScope(),l=FindModelBoundToEditorModel._getSearchRange(this._editor.getModel(),r);l.getEndPosition().isBefore(e)&&(e=l.getStartPosition()),e.isBefore(l.getStartPosition())&&(e=l.getStartPosition());const{lineNumber:c,column:d}=e,u=this._editor.getModel();let g=new Position$1(c,d),f=u.findNextMatch(this._state.searchString,g,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(148):null,t);return s&&f&&f.range.isEmpty()&&f.range.getStartPosition().equals(g)&&(g=this._nextSearchPosition(g),f=u.findNextMatch(this._state.searchString,g,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(148):null,t)),f?!o&&!l.containsRange(f.range)?this._getNextMatch(f.range.getEndPosition(),t,s,!0):f:null}moveToNextMatch(){this._moveToNextMatch(this._editor.getSelection().getEndPosition())}_moveToMatch(e){const t=this._decorations.getDecorationRangeAt(e);t&&this._setCurrentFindMatch(t)}moveToMatch(e){this._moveToMatch(e)}_getReplacePattern(){return this._state.isRegex?parseReplaceString(this._state.replaceString):ReplacePattern.fromStaticValue(this._state.replaceString)}replace(){if(!this._hasMatches())return;const e=this._getReplacePattern(),t=this._editor.getSelection(),s=this._getNextMatch(t.getStartPosition(),!0,!1);if(s)if(t.equalsRange(s.range)){const o=e.buildReplaceString(s.matches,this._state.preserveCase),r=new ReplaceCommand(t,o);this._executeEditorCommand("replace",r),this._decorations.setStartPosition(new Position$1(t.startLineNumber,t.startColumn+o.length)),this.research(!0)}else this._decorations.setStartPosition(this._editor.getPosition()),this._setCurrentFindMatch(s.range)}_findMatches(e,t,s){const o=(e||[null]).map(r=>FindModelBoundToEditorModel._getSearchRange(this._editor.getModel(),r));return this._editor.getModel().findMatches(this._state.searchString,o,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(148):null,t,s)}replaceAll(){if(!this._hasMatches())return;const e=this._decorations.getFindScopes();e===null&&this._state.matchesCount>=MATCHES_LIMIT?this._largeReplaceAll():this._regularReplaceAll(e),this.research(!1)}_largeReplaceAll(){const t=new SearchParams(this._state.searchString,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(148):null).parseSearchRequest();if(!t)return;let s=t.regex;if(!s.multiline){let f="mu";s.ignoreCase&&(f+="i"),s.global&&(f+="g"),s=new RegExp(s.source,f)}const o=this._editor.getModel(),r=o.getValue(1),l=o.getFullModelRange(),c=this._getReplacePattern();let d;const u=this._state.preserveCase;c.hasReplacementPatterns||u?d=r.replace(s,function(){return c.buildReplaceString(arguments,u)}):d=r.replace(s,c.buildReplaceString(null,u));const g=new ReplaceCommandThatPreservesSelection(l,d,this._editor.getSelection());this._executeEditorCommand("replaceAll",g)}_regularReplaceAll(e){const t=this._getReplacePattern(),s=this._findMatches(e,t.hasReplacementPatterns||this._state.preserveCase,1073741824),o=[];for(let l=0,c=s.length;l<c;l++)o[l]=t.buildReplaceString(s[l].matches,this._state.preserveCase);const r=new ReplaceAllCommand(this._editor.getSelection(),s.map(l=>l.range),o);this._executeEditorCommand("replaceAll",r)}selectAllMatches(){if(!this._hasMatches())return;const e=this._decorations.getFindScopes();let s=this._findMatches(e,!1,1073741824).map(r=>new Selection$1(r.range.startLineNumber,r.range.startColumn,r.range.endLineNumber,r.range.endColumn));const o=this._editor.getSelection();for(let r=0,l=s.length;r<l;r++)if(s[r].equalsRange(o)){s=[o].concat(s.slice(0,r)).concat(s.slice(r+1));break}this._editor.setSelections(s)}_executeEditorCommand(e,t){try{this._ignoreModelContentChanged=!0,this._editor.pushUndoStop(),this._editor.executeCommand(e,t),this._editor.pushUndoStop()}finally{this._ignoreModelContentChanged=!1}}}const findOptionsWidget="",$s=class $s extends Widget$1{constructor(e,t,s){super(),this._hideSoon=this._register(new RunOnceScheduler(()=>this._hide(),2e3)),this._isVisible=!1,this._editor=e,this._state=t,this._keybindingService=s,this._domNode=document.createElement("div"),this._domNode.className="findOptionsWidget",this._domNode.style.display="none",this._domNode.style.top="10px",this._domNode.style.zIndex="12",this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true");const o={inputActiveOptionBorder:asCssVariable(inputActiveOptionBorder),inputActiveOptionForeground:asCssVariable(inputActiveOptionForeground),inputActiveOptionBackground:asCssVariable(inputActiveOptionBackground)},r=this._register(createInstantHoverDelegate());this.caseSensitive=this._register(new CaseSensitiveToggle({appendTitle:this._keybindingLabelFor(FIND_IDS.ToggleCaseSensitiveCommand),isChecked:this._state.matchCase,hoverDelegate:r,...o})),this._domNode.appendChild(this.caseSensitive.domNode),this._register(this.caseSensitive.onChange(()=>{this._state.change({matchCase:this.caseSensitive.checked},!1)})),this.wholeWords=this._register(new WholeWordsToggle({appendTitle:this._keybindingLabelFor(FIND_IDS.ToggleWholeWordCommand),isChecked:this._state.wholeWord,hoverDelegate:r,...o})),this._domNode.appendChild(this.wholeWords.domNode),this._register(this.wholeWords.onChange(()=>{this._state.change({wholeWord:this.wholeWords.checked},!1)})),this.regex=this._register(new RegexToggle({appendTitle:this._keybindingLabelFor(FIND_IDS.ToggleRegexCommand),isChecked:this._state.isRegex,hoverDelegate:r,...o})),this._domNode.appendChild(this.regex.domNode),this._register(this.regex.onChange(()=>{this._state.change({isRegex:this.regex.checked},!1)})),this._editor.addOverlayWidget(this),this._register(this._state.onFindReplaceStateChange(l=>{let c=!1;l.isRegex&&(this.regex.checked=this._state.isRegex,c=!0),l.wholeWord&&(this.wholeWords.checked=this._state.wholeWord,c=!0),l.matchCase&&(this.caseSensitive.checked=this._state.matchCase,c=!0),!this._state.isRevealed&&c&&this._revealTemporarily()})),this._register(addDisposableListener(this._domNode,EventType$1.MOUSE_LEAVE,l=>this._onMouseLeave())),this._register(addDisposableListener(this._domNode,"mouseover",l=>this._onMouseOver()))}_keybindingLabelFor(e){const t=this._keybindingService.lookupKeybinding(e);return t?` (${t.getLabel()})`:""}dispose(){this._editor.removeOverlayWidget(this),super.dispose()}getId(){return $s.ID}getDomNode(){return this._domNode}getPosition(){return{preference:0}}highlightFindOptions(){this._revealTemporarily()}_revealTemporarily(){this._show(),this._hideSoon.schedule()}_onMouseLeave(){this._hideSoon.schedule()}_onMouseOver(){this._hideSoon.cancel()}_show(){this._isVisible||(this._isVisible=!0,this._domNode.style.display="block")}_hide(){this._isVisible&&(this._isVisible=!1,this._domNode.style.display="none")}};$s.ID="editor.contrib.findOptionsWidget";let FindOptionsWidget=$s;function effectiveOptionValue(a,e){return a===1?!0:a===2?!1:e}class FindReplaceState extends Disposable{get searchString(){return this._searchString}get replaceString(){return this._replaceString}get isRevealed(){return this._isRevealed}get isReplaceRevealed(){return this._isReplaceRevealed}get isRegex(){return effectiveOptionValue(this._isRegexOverride,this._isRegex)}get wholeWord(){return effectiveOptionValue(this._wholeWordOverride,this._wholeWord)}get matchCase(){return effectiveOptionValue(this._matchCaseOverride,this._matchCase)}get preserveCase(){return effectiveOptionValue(this._preserveCaseOverride,this._preserveCase)}get actualIsRegex(){return this._isRegex}get actualWholeWord(){return this._wholeWord}get actualMatchCase(){return this._matchCase}get actualPreserveCase(){return this._preserveCase}get searchScope(){return this._searchScope}get matchesPosition(){return this._matchesPosition}get matchesCount(){return this._matchesCount}get currentMatch(){return this._currentMatch}constructor(){super(),this._onFindReplaceStateChange=this._register(new Emitter$1),this.onFindReplaceStateChange=this._onFindReplaceStateChange.event,this._searchString="",this._replaceString="",this._isRevealed=!1,this._isReplaceRevealed=!1,this._isRegex=!1,this._isRegexOverride=0,this._wholeWord=!1,this._wholeWordOverride=0,this._matchCase=!1,this._matchCaseOverride=0,this._preserveCase=!1,this._preserveCaseOverride=0,this._searchScope=null,this._matchesPosition=0,this._matchesCount=0,this._currentMatch=null,this._loop=!0,this._isSearching=!1,this._filters=null}changeMatchInfo(e,t,s){const o={moveCursor:!1,updateHistory:!1,searchString:!1,replaceString:!1,isRevealed:!1,isReplaceRevealed:!1,isRegex:!1,wholeWord:!1,matchCase:!1,preserveCase:!1,searchScope:!1,matchesPosition:!1,matchesCount:!1,currentMatch:!1,loop:!1,isSearching:!1,filters:!1};let r=!1;t===0&&(e=0),e>t&&(e=t),this._matchesPosition!==e&&(this._matchesPosition=e,o.matchesPosition=!0,r=!0),this._matchesCount!==t&&(this._matchesCount=t,o.matchesCount=!0,r=!0),typeof s<"u"&&(Range$2.equalsRange(this._currentMatch,s)||(this._currentMatch=s,o.currentMatch=!0,r=!0)),r&&this._onFindReplaceStateChange.fire(o)}change(e,t,s=!0){var g;const o={moveCursor:t,updateHistory:s,searchString:!1,replaceString:!1,isRevealed:!1,isReplaceRevealed:!1,isRegex:!1,wholeWord:!1,matchCase:!1,preserveCase:!1,searchScope:!1,matchesPosition:!1,matchesCount:!1,currentMatch:!1,loop:!1,isSearching:!1,filters:!1};let r=!1;const l=this.isRegex,c=this.wholeWord,d=this.matchCase,u=this.preserveCase;typeof e.searchString<"u"&&this._searchString!==e.searchString&&(this._searchString=e.searchString,o.searchString=!0,r=!0),typeof e.replaceString<"u"&&this._replaceString!==e.replaceString&&(this._replaceString=e.replaceString,o.replaceString=!0,r=!0),typeof e.isRevealed<"u"&&this._isRevealed!==e.isRevealed&&(this._isRevealed=e.isRevealed,o.isRevealed=!0,r=!0),typeof e.isReplaceRevealed<"u"&&this._isReplaceRevealed!==e.isReplaceRevealed&&(this._isReplaceRevealed=e.isReplaceRevealed,o.isReplaceRevealed=!0,r=!0),typeof e.isRegex<"u"&&(this._isRegex=e.isRegex),typeof e.wholeWord<"u"&&(this._wholeWord=e.wholeWord),typeof e.matchCase<"u"&&(this._matchCase=e.matchCase),typeof e.preserveCase<"u"&&(this._preserveCase=e.preserveCase),typeof e.searchScope<"u"&&((g=e.searchScope)!=null&&g.every(f=>{var p;return(p=this._searchScope)==null?void 0:p.some(m=>!Range$2.equalsRange(m,f))})||(this._searchScope=e.searchScope,o.searchScope=!0,r=!0)),typeof e.loop<"u"&&this._loop!==e.loop&&(this._loop=e.loop,o.loop=!0,r=!0),typeof e.isSearching<"u"&&this._isSearching!==e.isSearching&&(this._isSearching=e.isSearching,o.isSearching=!0,r=!0),typeof e.filters<"u"&&(this._filters?this._filters.update(e.filters):this._filters=e.filters,o.filters=!0,r=!0),this._isRegexOverride=typeof e.isRegexOverride<"u"?e.isRegexOverride:0,this._wholeWordOverride=typeof e.wholeWordOverride<"u"?e.wholeWordOverride:0,this._matchCaseOverride=typeof e.matchCaseOverride<"u"?e.matchCaseOverride:0,this._preserveCaseOverride=typeof e.preserveCaseOverride<"u"?e.preserveCaseOverride:0,l!==this.isRegex&&(r=!0,o.isRegex=!0),c!==this.wholeWord&&(r=!0,o.wholeWord=!0),d!==this.matchCase&&(r=!0,o.matchCase=!0),u!==this.preserveCase&&(r=!0,o.preserveCase=!0),r&&this._onFindReplaceStateChange.fire(o)}canNavigateBack(){return this.canNavigateInLoop()||this.matchesPosition!==1}canNavigateForward(){return this.canNavigateInLoop()||this.matchesPosition<this.matchesCount}canNavigateInLoop(){return this._loop||this.matchesCount>=MATCHES_LIMIT}}const findWidget="",NLS_DEFAULT_LABEL=localize(5,"input"),NLS_PRESERVE_CASE_LABEL=localize(6,"Preserve Case");class PreserveCaseToggle extends Toggle{constructor(e){super({icon:Codicon.preserveCase,title:NLS_PRESERVE_CASE_LABEL+e.appendTitle,isChecked:e.isChecked,hoverDelegate:e.hoverDelegate??getDefaultHoverDelegate("element"),inputActiveOptionBorder:e.inputActiveOptionBorder,inputActiveOptionForeground:e.inputActiveOptionForeground,inputActiveOptionBackground:e.inputActiveOptionBackground})}}class ReplaceInput extends Widget$1{get onDidOptionChange(){return this._onDidOptionChange.event}get onKeyDown(){return this._onKeyDown.event}get onPreserveCaseKeyDown(){return this._onPreserveCaseKeyDown.event}constructor(e,t,s,o){super(),this._showOptionButtons=s,this.fixFocusOnOptionClickEnabled=!0,this.cachedOptionsWidth=0,this._onDidOptionChange=this._register(new Emitter$1),this._onKeyDown=this._register(new Emitter$1),this._onMouseDown=this._register(new Emitter$1),this._onInput=this._register(new Emitter$1),this._onKeyUp=this._register(new Emitter$1),this._onPreserveCaseKeyDown=this._register(new Emitter$1),this.contextViewProvider=t,this.placeholder=o.placeholder||"",this.validation=o.validation,this.label=o.label||NLS_DEFAULT_LABEL;const r=o.appendPreserveCaseLabel||"",l=o.history||new Set([]),c=!!o.flexibleHeight,d=!!o.flexibleWidth,u=o.flexibleMaxHeight;this.domNode=document.createElement("div"),this.domNode.classList.add("monaco-findInput"),this.inputBox=this._register(new HistoryInputBox(this.domNode,this.contextViewProvider,{ariaLabel:this.label||"",placeholder:this.placeholder||"",validationOptions:{validation:this.validation},history:l,showHistoryHint:o.showHistoryHint,flexibleHeight:c,flexibleWidth:d,flexibleMaxHeight:u,inputBoxStyles:o.inputBoxStyles})),this.preserveCase=this._register(new PreserveCaseToggle({appendTitle:r,isChecked:!1,...o.toggleStyles})),this._register(this.preserveCase.onChange(p=>{this._onDidOptionChange.fire(p),!p&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this._register(this.preserveCase.onKeyDown(p=>{this._onPreserveCaseKeyDown.fire(p)})),this._showOptionButtons?this.cachedOptionsWidth=this.preserveCase.width():this.cachedOptionsWidth=0;const g=[this.preserveCase.domNode];this.onkeydown(this.domNode,p=>{if(p.equals(15)||p.equals(17)||p.equals(9)){const m=g.indexOf(this.domNode.ownerDocument.activeElement);if(m>=0){let _=-1;p.equals(17)?_=(m+1)%g.length:p.equals(15)&&(m===0?_=g.length-1:_=m-1),p.equals(9)?(g[m].blur(),this.inputBox.focus()):_>=0&&g[_].focus(),EventHelper.stop(p,!0)}}});const f=document.createElement("div");f.className="controls",f.style.display=this._showOptionButtons?"block":"none",f.appendChild(this.preserveCase.domNode),this.domNode.appendChild(f),e==null||e.appendChild(this.domNode),this.onkeydown(this.inputBox.inputElement,p=>this._onKeyDown.fire(p)),this.onkeyup(this.inputBox.inputElement,p=>this._onKeyUp.fire(p)),this.oninput(this.inputBox.inputElement,p=>this._onInput.fire()),this.onmousedown(this.inputBox.inputElement,p=>this._onMouseDown.fire(p))}enable(){this.domNode.classList.remove("disabled"),this.inputBox.enable(),this.preserveCase.enable()}disable(){this.domNode.classList.add("disabled"),this.inputBox.disable(),this.preserveCase.disable()}setEnabled(e){e?this.enable():this.disable()}select(){this.inputBox.select()}focus(){this.inputBox.focus()}getPreserveCase(){return this.preserveCase.checked}setPreserveCase(e){this.preserveCase.checked=e}focusOnPreserve(){this.preserveCase.focus()}validate(){var e;(e=this.inputBox)==null||e.validate()}set width(e){this.inputBox.paddingRight=this.cachedOptionsWidth,this.domNode.style.width=e+"px"}dispose(){super.dispose()}}var __decorate$1G=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1F=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const historyNavigationVisible=new RawContextKey("suggestWidgetVisible",!1,localize(1683,"Whether suggestion are visible")),HistoryNavigationWidgetFocusContext="historyNavigationWidgetFocus",HistoryNavigationForwardsEnablementContext="historyNavigationForwardsEnabled",HistoryNavigationBackwardsEnablementContext="historyNavigationBackwardsEnabled";let lastFocusedWidget;const widgets=[];function registerAndCreateHistoryNavigationContext(a,e){if(widgets.includes(e))throw new Error("Cannot register the same widget multiple times");widgets.push(e);const t=new DisposableStore,s=new RawContextKey(HistoryNavigationWidgetFocusContext,!1).bindTo(a),o=new RawContextKey(HistoryNavigationForwardsEnablementContext,!0).bindTo(a),r=new RawContextKey(HistoryNavigationBackwardsEnablementContext,!0).bindTo(a),l=()=>{s.set(!0),lastFocusedWidget=e},c=()=>{s.set(!1),lastFocusedWidget===e&&(lastFocusedWidget=void 0)};return isActiveElement(e.element)&&l(),t.add(e.onDidFocus(()=>l())),t.add(e.onDidBlur(()=>c())),t.add(toDisposable(()=>{widgets.splice(widgets.indexOf(e),1),c()})),{historyNavigationForwardsEnablement:o,historyNavigationBackwardsEnablement:r,dispose(){t.dispose()}}}let ContextScopedFindInput=class extends FindInput{constructor(e,t,s,o){super(e,t,s);const r=this._register(o.createScoped(this.inputBox.element));this._register(registerAndCreateHistoryNavigationContext(r,this.inputBox))}};ContextScopedFindInput=__decorate$1G([__param$1F(3,IContextKeyService)],ContextScopedFindInput);let ContextScopedReplaceInput=class extends ReplaceInput{constructor(e,t,s,o,r=!1){super(e,t,r,s);const l=this._register(o.createScoped(this.inputBox.element));this._register(registerAndCreateHistoryNavigationContext(l,this.inputBox))}};ContextScopedReplaceInput=__decorate$1G([__param$1F(3,IContextKeyService)],ContextScopedReplaceInput);KeybindingsRegistry.registerCommandAndKeybindingRule({id:"history.showPrevious",weight:200,when:ContextKeyExpr.and(ContextKeyExpr.has(HistoryNavigationWidgetFocusContext),ContextKeyExpr.equals(HistoryNavigationBackwardsEnablementContext,!0),ContextKeyExpr.not("isComposing"),historyNavigationVisible.isEqualTo(!1)),primary:16,secondary:[528],handler:a=>{lastFocusedWidget==null||lastFocusedWidget.showPreviousValue()}});KeybindingsRegistry.registerCommandAndKeybindingRule({id:"history.showNext",weight:200,when:ContextKeyExpr.and(ContextKeyExpr.has(HistoryNavigationWidgetFocusContext),ContextKeyExpr.equals(HistoryNavigationForwardsEnablementContext,!0),ContextKeyExpr.not("isComposing"),historyNavigationVisible.isEqualTo(!1)),primary:18,secondary:[530],handler:a=>{lastFocusedWidget==null||lastFocusedWidget.showNextValue()}});function showHistoryKeybindingHint(a){var e,t;return((e=a.lookupKeybinding("history.showPrevious"))==null?void 0:e.getElectronAccelerator())==="Up"&&((t=a.lookupKeybinding("history.showNext"))==null?void 0:t.getElectronAccelerator())==="Down"}const findCollapsedIcon=registerIcon("find-collapsed",Codicon.chevronRight,localize(951,"Icon to indicate that the editor find widget is collapsed.")),findExpandedIcon=registerIcon("find-expanded",Codicon.chevronDown,localize(952,"Icon to indicate that the editor find widget is expanded.")),findSelectionIcon=registerIcon("find-selection",Codicon.selection,localize(953,"Icon for 'Find in Selection' in the editor find widget.")),findReplaceIcon=registerIcon("find-replace",Codicon.replace,localize(954,"Icon for 'Replace' in the editor find widget.")),findReplaceAllIcon=registerIcon("find-replace-all",Codicon.replaceAll,localize(955,"Icon for 'Replace All' in the editor find widget.")),findPreviousMatchIcon=registerIcon("find-previous-match",Codicon.arrowUp,localize(956,"Icon for 'Find Previous' in the editor find widget.")),findNextMatchIcon=registerIcon("find-next-match",Codicon.arrowDown,localize(957,"Icon for 'Find Next' in the editor find widget.")),NLS_FIND_DIALOG_LABEL=localize(958,"Find / Replace"),NLS_FIND_INPUT_LABEL=localize(959,"Find"),NLS_FIND_INPUT_PLACEHOLDER=localize(960,"Find"),NLS_PREVIOUS_MATCH_BTN_LABEL=localize(961,"Previous Match"),NLS_NEXT_MATCH_BTN_LABEL=localize(962,"Next Match"),NLS_TOGGLE_SELECTION_FIND_TITLE=localize(963,"Find in Selection"),NLS_CLOSE_BTN_LABEL=localize(964,"Close"),NLS_REPLACE_INPUT_LABEL=localize(965,"Replace"),NLS_REPLACE_INPUT_PLACEHOLDER=localize(966,"Replace"),NLS_REPLACE_BTN_LABEL=localize(967,"Replace"),NLS_REPLACE_ALL_BTN_LABEL=localize(968,"Replace All"),NLS_TOGGLE_REPLACE_MODE_BTN_LABEL=localize(969,"Toggle Replace"),NLS_MATCHES_COUNT_LIMIT_TITLE=localize(970,"Only the first {0} results are highlighted, but all find operations work on the entire text.",MATCHES_LIMIT),NLS_MATCHES_LOCATION=localize(971,"{0} of {1}"),NLS_NO_RESULTS=localize(972,"No results"),FIND_WIDGET_INITIAL_WIDTH=419,PART_WIDTH=275,FIND_INPUT_AREA_WIDTH=PART_WIDTH-54;let MAX_MATCHES_COUNT_WIDTH=69;const FIND_INPUT_AREA_HEIGHT=33,ctrlKeyMod$1=isMacintosh?256:2048;class FindWidgetViewZone{constructor(e){this.afterLineNumber=e,this.heightInPx=FIND_INPUT_AREA_HEIGHT,this.suppressMouseDown=!1,this.domNode=document.createElement("div"),this.domNode.className="dock-find-viewzone"}}function stopPropagationForMultiLineUpwards(a,e,t){const s=!!e.match(/\n/);if(t&&s&&t.selectionStart>0){a.stopPropagation();return}}function stopPropagationForMultiLineDownwards(a,e,t){const s=!!e.match(/\n/);if(t&&s&&t.selectionEnd<t.value.length){a.stopPropagation();return}}const Ws=class Ws extends Widget$1{constructor(e,t,s,o,r,l,c,d,u){super(),this._hoverService=c,this._findWidgetSearchHistory=d,this._replaceWidgetHistory=u,this._cachedHeight=null,this._revealTimeouts=[],this._codeEditor=e,this._controller=t,this._state=s,this._contextViewProvider=o,this._keybindingService=r,this._contextKeyService=l,this._isVisible=!1,this._isReplaceVisible=!1,this._ignoreChangeEvent=!1,this._updateHistoryDelayer=new Delayer(500),this._register(toDisposable(()=>this._updateHistoryDelayer.cancel())),this._register(this._state.onFindReplaceStateChange(g=>this._onStateChanged(g))),this._buildDomNode(),this._updateButtons(),this._tryUpdateWidgetWidth(),this._findInput.inputBox.layout(),this._register(this._codeEditor.onDidChangeConfiguration(g=>{if(g.hasChanged(104)&&(this._codeEditor.getOption(104)&&this._state.change({isReplaceRevealed:!1},!1),this._updateButtons()),g.hasChanged(165)&&this._tryUpdateWidgetWidth(),g.hasChanged(2)&&this.updateAccessibilitySupport(),g.hasChanged(50)){const f=this._codeEditor.getOption(50).loop;this._state.change({loop:f},!1);const p=this._codeEditor.getOption(50).addExtraSpaceOnTop;p&&!this._viewZone&&(this._viewZone=new FindWidgetViewZone(0),this._showViewZone()),!p&&this._viewZone&&this._removeViewZone()}})),this.updateAccessibilitySupport(),this._register(this._codeEditor.onDidChangeCursorSelection(()=>{this._isVisible&&this._updateToggleSelectionFindButton()})),this._register(this._codeEditor.onDidFocusEditorWidget(async()=>{if(this._isVisible){const g=await this._controller.getGlobalBufferTerm();g&&g!==this._state.searchString&&(this._state.change({searchString:g},!1),this._findInput.select())}})),this._findInputFocused=CONTEXT_FIND_INPUT_FOCUSED.bindTo(l),this._findFocusTracker=this._register(trackFocus(this._findInput.inputBox.inputElement)),this._register(this._findFocusTracker.onDidFocus(()=>{this._findInputFocused.set(!0),this._updateSearchScope()})),this._register(this._findFocusTracker.onDidBlur(()=>{this._findInputFocused.set(!1)})),this._replaceInputFocused=CONTEXT_REPLACE_INPUT_FOCUSED.bindTo(l),this._replaceFocusTracker=this._register(trackFocus(this._replaceInput.inputBox.inputElement)),this._register(this._replaceFocusTracker.onDidFocus(()=>{this._replaceInputFocused.set(!0),this._updateSearchScope()})),this._register(this._replaceFocusTracker.onDidBlur(()=>{this._replaceInputFocused.set(!1)})),this._codeEditor.addOverlayWidget(this),this._codeEditor.getOption(50).addExtraSpaceOnTop&&(this._viewZone=new FindWidgetViewZone(0)),this._register(this._codeEditor.onDidChangeModel(()=>{this._isVisible&&(this._viewZoneId=void 0)})),this._register(this._codeEditor.onDidScrollChange(g=>{if(g.scrollTopChanged){this._layoutViewZone();return}setTimeout(()=>{this._layoutViewZone()},0)}))}getId(){return Ws.ID}getDomNode(){return this._domNode}getPosition(){return this._isVisible?{preference:0}:null}_onStateChanged(e){if(e.searchString){try{this._ignoreChangeEvent=!0,this._findInput.setValue(this._state.searchString)}finally{this._ignoreChangeEvent=!1}this._updateButtons()}if(e.replaceString&&(this._replaceInput.inputBox.value=this._state.replaceString),e.isRevealed&&(this._state.isRevealed?this._reveal():this._hide(!0)),e.isReplaceRevealed&&(this._state.isReplaceRevealed?!this._codeEditor.getOption(104)&&!this._isReplaceVisible&&(this._isReplaceVisible=!0,this._replaceInput.width=getTotalWidth(this._findInput.domNode),this._updateButtons(),this._replaceInput.inputBox.layout()):this._isReplaceVisible&&(this._isReplaceVisible=!1,this._updateButtons())),(e.isRevealed||e.isReplaceRevealed)&&(this._state.isRevealed||this._state.isReplaceRevealed)&&this._tryUpdateHeight()&&this._showViewZone(),e.isRegex&&this._findInput.setRegex(this._state.isRegex),e.wholeWord&&this._findInput.setWholeWords(this._state.wholeWord),e.matchCase&&this._findInput.setCaseSensitive(this._state.matchCase),e.preserveCase&&this._replaceInput.setPreserveCase(this._state.preserveCase),e.searchScope&&(this._state.searchScope?this._toggleSelectionFind.checked=!0:this._toggleSelectionFind.checked=!1,this._updateToggleSelectionFindButton()),e.searchString||e.matchesCount||e.matchesPosition){const t=this._state.searchString.length>0&&this._state.matchesCount===0;this._domNode.classList.toggle("no-results",t),this._updateMatchesCount(),this._updateButtons()}(e.searchString||e.currentMatch)&&this._layoutViewZone(),e.updateHistory&&this._delayedUpdateHistory(),e.loop&&this._updateButtons()}_delayedUpdateHistory(){this._updateHistoryDelayer.trigger(this._updateHistory.bind(this)).then(void 0,onUnexpectedError)}_updateHistory(){this._state.searchString&&this._findInput.inputBox.addToHistory(),this._state.replaceString&&this._replaceInput.inputBox.addToHistory()}_updateMatchesCount(){var t;this._matchesCount.style.minWidth=MAX_MATCHES_COUNT_WIDTH+"px",this._state.matchesCount>=MATCHES_LIMIT?this._matchesCount.title=NLS_MATCHES_COUNT_LIMIT_TITLE:this._matchesCount.title="",(t=this._matchesCount.firstChild)==null||t.remove();let e;if(this._state.matchesCount>0){let s=String(this._state.matchesCount);this._state.matchesCount>=MATCHES_LIMIT&&(s+="+");let o=String(this._state.matchesPosition);o==="0"&&(o="?"),e=format(NLS_MATCHES_LOCATION,o,s)}else e=NLS_NO_RESULTS;this._matchesCount.appendChild(document.createTextNode(e)),alert$1(this._getAriaLabel(e,this._state.currentMatch,this._state.searchString)),MAX_MATCHES_COUNT_WIDTH=Math.max(MAX_MATCHES_COUNT_WIDTH,this._matchesCount.clientWidth)}_getAriaLabel(e,t,s){if(e===NLS_NO_RESULTS)return s===""?localize(973,"{0} found",e):localize(974,"{0} found for '{1}'",e,s);if(t){const o=localize(975,"{0} found for '{1}', at {2}",e,s,t.startLineNumber+":"+t.startColumn),r=this._codeEditor.getModel();return r&&t.startLineNumber<=r.getLineCount()&&t.startLineNumber>=1?`${r.getLineContent(t.startLineNumber)}, ${o}`:o}return localize(976,"{0} found for '{1}'",e,s)}_updateToggleSelectionFindButton(){const e=this._codeEditor.getSelection(),t=e?e.startLineNumber!==e.endLineNumber||e.startColumn!==e.endColumn:!1,s=this._toggleSelectionFind.checked;this._isVisible&&(s||t)?this._toggleSelectionFind.enable():this._toggleSelectionFind.disable()}_updateButtons(){this._findInput.setEnabled(this._isVisible),this._replaceInput.setEnabled(this._isVisible&&this._isReplaceVisible),this._updateToggleSelectionFindButton(),this._closeBtn.setEnabled(this._isVisible);const e=this._state.searchString.length>0,t=!!this._state.matchesCount;this._prevBtn.setEnabled(this._isVisible&&e&&t&&this._state.canNavigateBack()),this._nextBtn.setEnabled(this._isVisible&&e&&t&&this._state.canNavigateForward()),this._replaceBtn.setEnabled(this._isVisible&&this._isReplaceVisible&&e),this._replaceAllBtn.setEnabled(this._isVisible&&this._isReplaceVisible&&e),this._domNode.classList.toggle("replaceToggled",this._isReplaceVisible),this._toggleReplaceBtn.setExpanded(this._isReplaceVisible);const s=!this._codeEditor.getOption(104);this._toggleReplaceBtn.setEnabled(this._isVisible&&s)}_reveal(){if(this._revealTimeouts.forEach(e=>{clearTimeout(e)}),this._revealTimeouts=[],!this._isVisible){this._isVisible=!0;const e=this._codeEditor.getSelection();switch(this._codeEditor.getOption(50).autoFindInSelection){case"always":this._toggleSelectionFind.checked=!0;break;case"never":this._toggleSelectionFind.checked=!1;break;case"multiline":{const s=!!e&&e.startLineNumber!==e.endLineNumber;this._toggleSelectionFind.checked=s;break}}this._tryUpdateWidgetWidth(),this._updateButtons(),this._revealTimeouts.push(setTimeout(()=>{this._domNode.classList.add("visible"),this._domNode.setAttribute("aria-hidden","false")},0)),this._revealTimeouts.push(setTimeout(()=>{this._findInput.validate()},200)),this._codeEditor.layoutOverlayWidget(this);let t=!0;if(this._codeEditor.getOption(50).seedSearchStringFromSelection&&e){const s=this._codeEditor.getDomNode();if(s){const o=getDomNodePagePosition(s),r=this._codeEditor.getScrolledVisiblePosition(e.getStartPosition()),l=o.left+(r?r.left:0),c=r?r.top:0;if(this._viewZone&&c<this._viewZone.heightInPx){e.endLineNumber>e.startLineNumber&&(t=!1);const d=getTopLeftOffset(this._domNode).left;l>d&&(t=!1);const u=this._codeEditor.getScrolledVisiblePosition(e.getEndPosition());o.left+(u?u.left:0)>d&&(t=!1)}}}this._showViewZone(t)}}_hide(e){this._revealTimeouts.forEach(t=>{clearTimeout(t)}),this._revealTimeouts=[],this._isVisible&&(this._isVisible=!1,this._updateButtons(),this._domNode.classList.remove("visible"),this._domNode.setAttribute("aria-hidden","true"),this._findInput.clearMessage(),e&&this._codeEditor.focus(),this._codeEditor.layoutOverlayWidget(this),this._removeViewZone())}_layoutViewZone(e){if(!this._codeEditor.getOption(50).addExtraSpaceOnTop){this._removeViewZone();return}if(!this._isVisible)return;const s=this._viewZone;this._viewZoneId!==void 0||!s||this._codeEditor.changeViewZones(o=>{s.heightInPx=this._getHeight(),this._viewZoneId=o.addZone(s),this._codeEditor.setScrollTop(e||this._codeEditor.getScrollTop()+s.heightInPx)})}_showViewZone(e=!0){if(!this._isVisible||!this._codeEditor.getOption(50).addExtraSpaceOnTop)return;this._viewZone===void 0&&(this._viewZone=new FindWidgetViewZone(0));const s=this._viewZone;this._codeEditor.changeViewZones(o=>{if(this._viewZoneId!==void 0){const r=this._getHeight();if(r===s.heightInPx)return;const l=r-s.heightInPx;s.heightInPx=r,o.layoutZone(this._viewZoneId),e&&this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()+l);return}else{let r=this._getHeight();if(r-=this._codeEditor.getOption(96).top,r<=0)return;s.heightInPx=r,this._viewZoneId=o.addZone(s),e&&this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()+r)}})}_removeViewZone(){this._codeEditor.changeViewZones(e=>{this._viewZoneId!==void 0&&(e.removeZone(this._viewZoneId),this._viewZoneId=void 0,this._viewZone&&(this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()-this._viewZone.heightInPx),this._viewZone=void 0))})}_tryUpdateWidgetWidth(){if(!this._isVisible||!this._domNode.isConnected)return;const e=this._codeEditor.getLayoutInfo();if(e.contentWidth<=0){this._domNode.classList.add("hiddenEditor");return}else this._domNode.classList.contains("hiddenEditor")&&this._domNode.classList.remove("hiddenEditor");const s=e.width,o=e.minimap.minimapWidth;let r=!1,l=!1,c=!1;if(this._resized&&getTotalWidth(this._domNode)>FIND_WIDGET_INITIAL_WIDTH){this._domNode.style.maxWidth=`${s-28-o-15}px`,this._replaceInput.width=getTotalWidth(this._findInput.domNode);return}if(FIND_WIDGET_INITIAL_WIDTH+28+o>=s&&(l=!0),FIND_WIDGET_INITIAL_WIDTH+28+o-MAX_MATCHES_COUNT_WIDTH>=s&&(c=!0),FIND_WIDGET_INITIAL_WIDTH+28+o-MAX_MATCHES_COUNT_WIDTH>=s+50&&(r=!0),this._domNode.classList.toggle("collapsed-find-widget",r),this._domNode.classList.toggle("narrow-find-widget",c),this._domNode.classList.toggle("reduced-find-widget",l),!c&&!r&&(this._domNode.style.maxWidth=`${s-28-o-15}px`),this._findInput.layout({collapsedFindWidget:r,narrowFindWidget:c,reducedFindWidget:l}),this._resized){const d=this._findInput.inputBox.element.clientWidth;d>0&&(this._replaceInput.width=d)}else this._isReplaceVisible&&(this._replaceInput.width=getTotalWidth(this._findInput.domNode))}_getHeight(){let e=0;return e+=4,e+=this._findInput.inputBox.height+2,this._isReplaceVisible&&(e+=4,e+=this._replaceInput.inputBox.height+2),e+=4,e}_tryUpdateHeight(){const e=this._getHeight();return this._cachedHeight!==null&&this._cachedHeight===e?!1:(this._cachedHeight=e,this._domNode.style.height=`${e}px`,!0)}focusFindInput(){this._findInput.select(),this._findInput.focus()}focusReplaceInput(){this._replaceInput.select(),this._replaceInput.focus()}highlightFindOptions(){this._findInput.highlightFindOptions()}_updateSearchScope(){if(this._codeEditor.hasModel()&&this._toggleSelectionFind.checked){const e=this._codeEditor.getSelections();e.map(t=>{t.endColumn===1&&t.endLineNumber>t.startLineNumber&&(t=t.setEndPosition(t.endLineNumber-1,this._codeEditor.getModel().getLineMaxColumn(t.endLineNumber-1)));const s=this._state.currentMatch;return t.startLineNumber!==t.endLineNumber&&!Range$2.equalsRange(t,s)?t:null}).filter(t=>!!t),e.length&&this._state.change({searchScope:e},!0)}}_onFindInputMouseDown(e){e.middleButton&&e.stopPropagation()}_onFindInputKeyDown(e){if(e.equals(ctrlKeyMod$1|3))if(this._keybindingService.dispatchEvent(e,e.target)){e.preventDefault();return}else{this._findInput.inputBox.insertAtCursor(`
`),e.preventDefault();return}if(e.equals(2)){this._isReplaceVisible?this._replaceInput.focus():this._findInput.focusOnCaseSensitive(),e.preventDefault();return}if(e.equals(2066)){this._codeEditor.focus(),e.preventDefault();return}if(e.equals(16))return stopPropagationForMultiLineUpwards(e,this._findInput.getValue(),this._findInput.domNode.querySelector("textarea"));if(e.equals(18))return stopPropagationForMultiLineDownwards(e,this._findInput.getValue(),this._findInput.domNode.querySelector("textarea"))}_onReplaceInputKeyDown(e){if(e.equals(ctrlKeyMod$1|3))if(this._keybindingService.dispatchEvent(e,e.target)){e.preventDefault();return}else{this._replaceInput.inputBox.insertAtCursor(`
`),e.preventDefault();return}if(e.equals(2)){this._findInput.focusOnCaseSensitive(),e.preventDefault();return}if(e.equals(1026)){this._findInput.focus(),e.preventDefault();return}if(e.equals(2066)){this._codeEditor.focus(),e.preventDefault();return}if(e.equals(16))return stopPropagationForMultiLineUpwards(e,this._replaceInput.inputBox.value,this._replaceInput.inputBox.element.querySelector("textarea"));if(e.equals(18))return stopPropagationForMultiLineDownwards(e,this._replaceInput.inputBox.value,this._replaceInput.inputBox.element.querySelector("textarea"))}getVerticalSashLeft(e){return 0}_keybindingLabelFor(e){const t=this._keybindingService.lookupKeybinding(e);return t?` (${t.getLabel()})`:""}_buildDomNode(){const s=this._codeEditor.getOption(50).history,o=this._codeEditor.getOption(50).replaceHistory;this._findInput=this._register(new ContextScopedFindInput(null,this._contextViewProvider,{width:FIND_INPUT_AREA_WIDTH,label:NLS_FIND_INPUT_LABEL,placeholder:NLS_FIND_INPUT_PLACEHOLDER,appendCaseSensitiveLabel:this._keybindingLabelFor(FIND_IDS.ToggleCaseSensitiveCommand),appendWholeWordsLabel:this._keybindingLabelFor(FIND_IDS.ToggleWholeWordCommand),appendRegexLabel:this._keybindingLabelFor(FIND_IDS.ToggleRegexCommand),validation:p=>{if(p.length===0||!this._findInput.getRegex())return null;try{return new RegExp(p,"gu"),null}catch(m){return{content:m.message}}},flexibleHeight:!0,flexibleWidth:!0,flexibleMaxHeight:118,showCommonFindToggles:!0,showHistoryHint:()=>showHistoryKeybindingHint(this._keybindingService),inputBoxStyles:defaultInputBoxStyles,toggleStyles:defaultToggleStyles,history:s==="workspace"?this._findWidgetSearchHistory:new Set([])},this._contextKeyService)),this._findInput.setRegex(!!this._state.isRegex),this._findInput.setCaseSensitive(!!this._state.matchCase),this._findInput.setWholeWords(!!this._state.wholeWord),this._register(this._findInput.onKeyDown(p=>{p.equals(3)&&!this._codeEditor.getOption(50).findOnType&&this._state.change({searchString:this._findInput.getValue()},!0),this._onFindInputKeyDown(p)})),this._register(this._findInput.inputBox.onDidChange(()=>{this._ignoreChangeEvent||!this._codeEditor.getOption(50).findOnType||this._state.change({searchString:this._findInput.getValue()},!0)})),this._register(this._findInput.onDidOptionChange(()=>{this._state.change({isRegex:this._findInput.getRegex(),wholeWord:this._findInput.getWholeWords(),matchCase:this._findInput.getCaseSensitive()},!0)})),this._register(this._findInput.onCaseSensitiveKeyDown(p=>{p.equals(1026)&&this._isReplaceVisible&&(this._replaceInput.focus(),p.preventDefault())})),this._register(this._findInput.onRegexKeyDown(p=>{p.equals(2)&&this._isReplaceVisible&&(this._replaceInput.focusOnPreserve(),p.preventDefault())})),this._register(this._findInput.inputBox.onDidHeightChange(p=>{this._tryUpdateHeight()&&this._showViewZone()})),isLinux&&this._register(this._findInput.onMouseDown(p=>this._onFindInputMouseDown(p))),this._matchesCount=document.createElement("div"),this._matchesCount.className="matchesCount",this._updateMatchesCount();const r=this._register(createInstantHoverDelegate());this._prevBtn=this._register(new SimpleButton({label:NLS_PREVIOUS_MATCH_BTN_LABEL+this._keybindingLabelFor(FIND_IDS.PreviousMatchFindAction),icon:findPreviousMatchIcon,hoverDelegate:r,onTrigger:()=>{assertReturnsDefined(this._codeEditor.getAction(FIND_IDS.PreviousMatchFindAction)).run().then(void 0,onUnexpectedError)}},this._hoverService)),this._nextBtn=this._register(new SimpleButton({label:NLS_NEXT_MATCH_BTN_LABEL+this._keybindingLabelFor(FIND_IDS.NextMatchFindAction),icon:findNextMatchIcon,hoverDelegate:r,onTrigger:()=>{assertReturnsDefined(this._codeEditor.getAction(FIND_IDS.NextMatchFindAction)).run().then(void 0,onUnexpectedError)}},this._hoverService));const l=document.createElement("div");l.className="find-part",l.appendChild(this._findInput.domNode);const c=document.createElement("div");c.className="find-actions",l.appendChild(c),c.appendChild(this._matchesCount),c.appendChild(this._prevBtn.domNode),c.appendChild(this._nextBtn.domNode),this._toggleSelectionFind=this._register(new Toggle({icon:findSelectionIcon,title:NLS_TOGGLE_SELECTION_FIND_TITLE+this._keybindingLabelFor(FIND_IDS.ToggleSearchScopeCommand),isChecked:!1,hoverDelegate:r,inputActiveOptionBackground:asCssVariable(inputActiveOptionBackground),inputActiveOptionBorder:asCssVariable(inputActiveOptionBorder),inputActiveOptionForeground:asCssVariable(inputActiveOptionForeground)})),this._register(this._toggleSelectionFind.onChange(()=>{if(this._toggleSelectionFind.checked){if(this._codeEditor.hasModel()){let p=this._codeEditor.getSelections();p=p.map(m=>(m.endColumn===1&&m.endLineNumber>m.startLineNumber&&(m=m.setEndPosition(m.endLineNumber-1,this._codeEditor.getModel().getLineMaxColumn(m.endLineNumber-1))),m.isEmpty()?null:m)).filter(m=>!!m),p.length&&this._state.change({searchScope:p},!0)}}else this._state.change({searchScope:null},!0)})),c.appendChild(this._toggleSelectionFind.domNode),this._closeBtn=this._register(new SimpleButton({label:NLS_CLOSE_BTN_LABEL+this._keybindingLabelFor(FIND_IDS.CloseFindWidgetCommand),icon:widgetClose,hoverDelegate:r,onTrigger:()=>{this._state.change({isRevealed:!1,searchScope:null},!1)},onKeyDown:p=>{p.equals(2)&&this._isReplaceVisible&&(this._replaceBtn.isEnabled()?this._replaceBtn.focus():this._codeEditor.focus(),p.preventDefault())}},this._hoverService)),this._replaceInput=this._register(new ContextScopedReplaceInput(null,void 0,{label:NLS_REPLACE_INPUT_LABEL,placeholder:NLS_REPLACE_INPUT_PLACEHOLDER,appendPreserveCaseLabel:this._keybindingLabelFor(FIND_IDS.TogglePreserveCaseCommand),history:o==="workspace"?this._replaceWidgetHistory:new Set([]),flexibleHeight:!0,flexibleWidth:!0,flexibleMaxHeight:118,showHistoryHint:()=>showHistoryKeybindingHint(this._keybindingService),inputBoxStyles:defaultInputBoxStyles,toggleStyles:defaultToggleStyles},this._contextKeyService,!0)),this._replaceInput.setPreserveCase(!!this._state.preserveCase),this._register(this._replaceInput.onKeyDown(p=>this._onReplaceInputKeyDown(p))),this._register(this._replaceInput.inputBox.onDidChange(()=>{this._state.change({replaceString:this._replaceInput.inputBox.value},!1)})),this._register(this._replaceInput.inputBox.onDidHeightChange(p=>{this._isReplaceVisible&&this._tryUpdateHeight()&&this._showViewZone()})),this._register(this._replaceInput.onDidOptionChange(()=>{this._state.change({preserveCase:this._replaceInput.getPreserveCase()},!0)})),this._register(this._replaceInput.onPreserveCaseKeyDown(p=>{p.equals(2)&&(this._prevBtn.isEnabled()?this._prevBtn.focus():this._nextBtn.isEnabled()?this._nextBtn.focus():this._toggleSelectionFind.enabled?this._toggleSelectionFind.focus():this._closeBtn.isEnabled()&&this._closeBtn.focus(),p.preventDefault())}));const d=this._register(createInstantHoverDelegate());this._replaceBtn=this._register(new SimpleButton({label:NLS_REPLACE_BTN_LABEL+this._keybindingLabelFor(FIND_IDS.ReplaceOneAction),icon:findReplaceIcon,hoverDelegate:d,onTrigger:()=>{this._controller.replace()},onKeyDown:p=>{p.equals(1026)&&(this._closeBtn.focus(),p.preventDefault())}},this._hoverService)),this._replaceAllBtn=this._register(new SimpleButton({label:NLS_REPLACE_ALL_BTN_LABEL+this._keybindingLabelFor(FIND_IDS.ReplaceAllAction),icon:findReplaceAllIcon,hoverDelegate:d,onTrigger:()=>{this._controller.replaceAll()}},this._hoverService));const u=document.createElement("div");u.className="replace-part",u.appendChild(this._replaceInput.domNode);const g=document.createElement("div");g.className="replace-actions",u.appendChild(g),g.appendChild(this._replaceBtn.domNode),g.appendChild(this._replaceAllBtn.domNode),this._toggleReplaceBtn=this._register(new SimpleButton({label:NLS_TOGGLE_REPLACE_MODE_BTN_LABEL,className:"codicon toggle left",onTrigger:()=>{this._state.change({isReplaceRevealed:!this._isReplaceVisible},!1),this._isReplaceVisible&&(this._replaceInput.width=getTotalWidth(this._findInput.domNode),this._replaceInput.inputBox.layout()),this._showViewZone()}},this._hoverService)),this._toggleReplaceBtn.setExpanded(this._isReplaceVisible),this._domNode=document.createElement("div"),this._domNode.className="editor-widget find-widget",this._domNode.setAttribute("aria-hidden","true"),this._domNode.ariaLabel=NLS_FIND_DIALOG_LABEL,this._domNode.role="dialog",this._domNode.style.width=`${FIND_WIDGET_INITIAL_WIDTH}px`,this._domNode.appendChild(this._toggleReplaceBtn.domNode),this._domNode.appendChild(l),this._domNode.appendChild(this._closeBtn.domNode),this._domNode.appendChild(u),this._resizeSash=this._register(new Sash(this._domNode,this,{orientation:0,size:2})),this._resized=!1;let f=FIND_WIDGET_INITIAL_WIDTH;this._register(this._resizeSash.onDidStart(()=>{f=getTotalWidth(this._domNode)})),this._register(this._resizeSash.onDidChange(p=>{this._resized=!0;const m=f+p.startX-p.currentX;if(m<FIND_WIDGET_INITIAL_WIDTH)return;const _=parseFloat(getComputedStyle(this._domNode).maxWidth)||0;m>_||(this._domNode.style.width=`${m}px`,this._isReplaceVisible&&(this._replaceInput.width=getTotalWidth(this._findInput.domNode)),this._findInput.inputBox.layout(),this._tryUpdateHeight())})),this._register(this._resizeSash.onDidReset(()=>{const p=getTotalWidth(this._domNode);if(p<FIND_WIDGET_INITIAL_WIDTH)return;let m=FIND_WIDGET_INITIAL_WIDTH;if(!this._resized||p===FIND_WIDGET_INITIAL_WIDTH){const _=this._codeEditor.getLayoutInfo();m=_.width-28-_.minimap.minimapWidth-15,this._resized=!0}this._domNode.style.width=`${m}px`,this._isReplaceVisible&&(this._replaceInput.width=getTotalWidth(this._findInput.domNode)),this._findInput.inputBox.layout()}))}updateAccessibilitySupport(){const e=this._codeEditor.getOption(2);this._findInput.setFocusInputOnOptionClick(e!==2)}getViewState(){let e=!1;return this._viewZone&&this._viewZoneId&&(e=this._viewZone.heightInPx>this._codeEditor.getScrollTop()),{widgetViewZoneVisible:e,scrollTop:this._codeEditor.getScrollTop()}}setViewState(e){e&&e.widgetViewZoneVisible&&this._layoutViewZone(e.scrollTop)}};Ws.ID="editor.contrib.findWidget";let FindWidget=Ws;class SimpleButton extends Widget$1{constructor(e,t){super(),this._opts=e;let s="button";this._opts.className&&(s=s+" "+this._opts.className),this._opts.icon&&(s=s+" "+ThemeIcon.asClassName(this._opts.icon)),this._domNode=document.createElement("div"),this._domNode.tabIndex=0,this._domNode.className=s,this._domNode.setAttribute("role","button"),this._domNode.setAttribute("aria-label",this._opts.label),this._register(t.setupManagedHover(e.hoverDelegate??getDefaultHoverDelegate("element"),this._domNode,this._opts.label)),this.onclick(this._domNode,o=>{this._opts.onTrigger(),o.preventDefault()}),this.onkeydown(this._domNode,o=>{var r,l;if(o.equals(10)||o.equals(3)){this._opts.onTrigger(),o.preventDefault();return}(l=(r=this._opts).onKeyDown)==null||l.call(r,o)})}get domNode(){return this._domNode}isEnabled(){return this._domNode.tabIndex>=0}focus(){this._domNode.focus()}setEnabled(e){this._domNode.classList.toggle("disabled",!e),this._domNode.setAttribute("aria-disabled",String(!e)),this._domNode.tabIndex=e?0:-1}setExpanded(e){this._domNode.setAttribute("aria-expanded",String(!!e)),e?(this._domNode.classList.remove(...ThemeIcon.asClassNameArray(findCollapsedIcon)),this._domNode.classList.add(...ThemeIcon.asClassNameArray(findExpandedIcon))):(this._domNode.classList.remove(...ThemeIcon.asClassNameArray(findExpandedIcon)),this._domNode.classList.add(...ThemeIcon.asClassNameArray(findCollapsedIcon)))}}registerThemingParticipant((a,e)=>{const t=a.getColor(editorFindMatchHighlightBorder);t&&e.addRule(`.monaco-editor .findMatch { border: 1px ${isHighContrast(a.type)?"dotted":"solid"} ${t}; box-sizing: border-box; }`);const s=a.getColor(editorFindRangeHighlightBorder);s&&e.addRule(`.monaco-editor .findScope { border: 1px ${isHighContrast(a.type)?"dashed":"solid"} ${s}; }`);const o=a.getColor(contrastBorder);o&&e.addRule(`.monaco-editor .find-widget { border: 1px solid ${o}; }`);const r=a.getColor(editorFindMatchForeground);r&&e.addRule(`.monaco-editor .findMatchInline { color: ${r}; }`);const l=a.getColor(editorFindMatchHighlightForeground);l&&e.addRule(`.monaco-editor .currentFindMatchInline { color: ${l}; }`)});var __decorate$1F=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1E=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},FindWidgetSearchHistory_1,Pt;let FindWidgetSearchHistory=(Pt=class{static getOrCreate(e){return FindWidgetSearchHistory_1._instance||(FindWidgetSearchHistory_1._instance=new FindWidgetSearchHistory_1(e)),FindWidgetSearchHistory_1._instance}constructor(e){this.storageService=e,this.inMemoryValues=new Set,this._onDidChangeEmitter=new Emitter$1,this.onDidChange=this._onDidChangeEmitter.event,this.load()}delete(e){const t=this.inMemoryValues.delete(e);return this.save(),t}add(e){return this.inMemoryValues.add(e),this.save(),this}has(e){return this.inMemoryValues.has(e)}forEach(e,t){return this.load(),this.inMemoryValues.forEach(e)}replace(e){this.inMemoryValues=new Set(e),this.save()}load(){let e;const t=this.storageService.get(FindWidgetSearchHistory_1.FIND_HISTORY_KEY,1);if(t)try{e=JSON.parse(t)}catch{}this.inMemoryValues=new Set(e||[])}save(){const e=[];return this.inMemoryValues.forEach(t=>e.push(t)),new Promise(t=>{this.storageService.store(FindWidgetSearchHistory_1.FIND_HISTORY_KEY,JSON.stringify(e),1,0),this._onDidChangeEmitter.fire(e),t()})}},FindWidgetSearchHistory_1=Pt,Pt.FIND_HISTORY_KEY="workbench.find.history",Pt._instance=null,Pt);FindWidgetSearchHistory=FindWidgetSearchHistory_1=__decorate$1F([__param$1E(0,IStorageService)],FindWidgetSearchHistory);var __decorate$1E=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1D=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},ReplaceWidgetHistory_1,Ft;let ReplaceWidgetHistory=(Ft=class{static getOrCreate(e){return ReplaceWidgetHistory_1._instance||(ReplaceWidgetHistory_1._instance=new ReplaceWidgetHistory_1(e)),ReplaceWidgetHistory_1._instance}constructor(e){this.storageService=e,this.inMemoryValues=new Set,this._onDidChangeEmitter=new Emitter$1,this.onDidChange=this._onDidChangeEmitter.event,this.load()}delete(e){const t=this.inMemoryValues.delete(e);return this.save(),t}add(e){return this.inMemoryValues.add(e),this.save(),this}has(e){return this.inMemoryValues.has(e)}forEach(e,t){return this.load(),this.inMemoryValues.forEach(e)}replace(e){this.inMemoryValues=new Set(e),this.save()}load(){let e;const t=this.storageService.get(ReplaceWidgetHistory_1.FIND_HISTORY_KEY,1);if(t)try{e=JSON.parse(t)}catch{}this.inMemoryValues=new Set(e||[])}save(){const e=[];return this.inMemoryValues.forEach(t=>e.push(t)),new Promise(t=>{this.storageService.store(ReplaceWidgetHistory_1.FIND_HISTORY_KEY,JSON.stringify(e),1,0),this._onDidChangeEmitter.fire(e),t()})}},ReplaceWidgetHistory_1=Ft,Ft.FIND_HISTORY_KEY="workbench.replace.history",Ft._instance=null,Ft);ReplaceWidgetHistory=ReplaceWidgetHistory_1=__decorate$1E([__param$1D(0,IStorageService)],ReplaceWidgetHistory);var __decorate$1D=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1C=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},CommonFindController_1;const SEARCH_STRING_MAX_LENGTH=524288;function getSelectionSearchString(a,e="single",t=!1){if(!a.hasModel())return null;const s=a.getSelection();if(e==="single"&&s.startLineNumber===s.endLineNumber||e==="multiple"){if(s.isEmpty()){const o=a.getConfiguredWordAtPosition(s.getStartPosition());if(o&&t===!1)return o.word}else if(a.getModel().getValueLengthInRange(s)<SEARCH_STRING_MAX_LENGTH)return a.getModel().getValueInRange(s)}return null}var Fi;let CommonFindController=(Fi=class extends Disposable{get editor(){return this._editor}static get(e){return e.getContribution(CommonFindController_1.ID)}constructor(e,t,s,o,r,l){super(),this._editor=e,this._findWidgetVisible=CONTEXT_FIND_WIDGET_VISIBLE.bindTo(t),this._contextKeyService=t,this._storageService=s,this._clipboardService=o,this._notificationService=r,this._hoverService=l,this._updateHistoryDelayer=new Delayer(500),this._state=this._register(new FindReplaceState),this.loadQueryState(),this._register(this._state.onFindReplaceStateChange(c=>this._onStateChanged(c))),this._model=null,this._register(this._editor.onDidChangeModel(()=>{const c=this._editor.getModel()&&this._state.isRevealed;this.disposeModel(),this._state.change({searchScope:null,matchCase:this._storageService.getBoolean("editor.matchCase",1,!1),wholeWord:this._storageService.getBoolean("editor.wholeWord",1,!1),isRegex:this._storageService.getBoolean("editor.isRegex",1,!1),preserveCase:this._storageService.getBoolean("editor.preserveCase",1,!1)},!1),c&&this._start({forceRevealReplace:!1,seedSearchStringFromSelection:"none",seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:0,shouldAnimate:!1,updateSearchScope:!1,loop:this._editor.getOption(50).loop})}))}dispose(){this.disposeModel(),super.dispose()}disposeModel(){this._model&&(this._model.dispose(),this._model=null)}_onStateChanged(e){this.saveQueryState(e),e.isRevealed&&(this._state.isRevealed?this._findWidgetVisible.set(!0):(this._findWidgetVisible.reset(),this.disposeModel())),e.searchString&&this.setGlobalBufferTerm(this._state.searchString)}saveQueryState(e){e.isRegex&&this._storageService.store("editor.isRegex",this._state.actualIsRegex,1,1),e.wholeWord&&this._storageService.store("editor.wholeWord",this._state.actualWholeWord,1,1),e.matchCase&&this._storageService.store("editor.matchCase",this._state.actualMatchCase,1,1),e.preserveCase&&this._storageService.store("editor.preserveCase",this._state.actualPreserveCase,1,1)}loadQueryState(){this._state.change({matchCase:this._storageService.getBoolean("editor.matchCase",1,this._state.matchCase),wholeWord:this._storageService.getBoolean("editor.wholeWord",1,this._state.wholeWord),isRegex:this._storageService.getBoolean("editor.isRegex",1,this._state.isRegex),preserveCase:this._storageService.getBoolean("editor.preserveCase",1,this._state.preserveCase)},!1)}isFindInputFocused(){return!!CONTEXT_FIND_INPUT_FOCUSED.getValue(this._contextKeyService)}getState(){return this._state}closeFindWidget(){this._state.change({isRevealed:!1,searchScope:null},!1),this._editor.focus()}toggleCaseSensitive(){this._state.change({matchCase:!this._state.matchCase},!1),this._state.isRevealed||this.highlightFindOptions()}toggleWholeWords(){this._state.change({wholeWord:!this._state.wholeWord},!1),this._state.isRevealed||this.highlightFindOptions()}toggleRegex(){this._state.change({isRegex:!this._state.isRegex},!1),this._state.isRevealed||this.highlightFindOptions()}togglePreserveCase(){this._state.change({preserveCase:!this._state.preserveCase},!1),this._state.isRevealed||this.highlightFindOptions()}toggleSearchScope(){if(this._state.searchScope)this._state.change({searchScope:null},!0);else if(this._editor.hasModel()){let e=this._editor.getSelections();e=e.map(t=>(t.endColumn===1&&t.endLineNumber>t.startLineNumber&&(t=t.setEndPosition(t.endLineNumber-1,this._editor.getModel().getLineMaxColumn(t.endLineNumber-1))),t.isEmpty()?null:t)).filter(t=>!!t),e.length&&this._state.change({searchScope:e},!0)}}setSearchString(e){this._state.isRegex&&(e=escapeRegExpCharacters(e)),this._state.change({searchString:e},!1)}highlightFindOptions(e=!1){}async _start(e,t){if(this.disposeModel(),!this._editor.hasModel())return;const s={...t,isRevealed:!0};if(e.seedSearchStringFromSelection==="single"){const o=getSelectionSearchString(this._editor,e.seedSearchStringFromSelection,e.seedSearchStringFromNonEmptySelection);o&&(this._state.isRegex?s.searchString=escapeRegExpCharacters(o):s.searchString=o)}else if(e.seedSearchStringFromSelection==="multiple"&&!e.updateSearchScope){const o=getSelectionSearchString(this._editor,e.seedSearchStringFromSelection);o&&(s.searchString=o)}if(!s.searchString&&e.seedSearchStringFromGlobalClipboard){const o=await this.getGlobalBufferTerm();if(!this._editor.hasModel())return;o&&(s.searchString=o)}if(e.forceRevealReplace||s.isReplaceRevealed?s.isReplaceRevealed=!0:this._findWidgetVisible.get()||(s.isReplaceRevealed=!1),e.updateSearchScope){const o=this._editor.getSelections();o.some(r=>!r.isEmpty())&&(s.searchScope=o)}s.loop=e.loop,this._state.change(s,!1),this._model||(this._model=new FindModelBoundToEditorModel(this._editor,this._state))}start(e,t){return this._start(e,t)}moveToNextMatch(){return this._model?(this._model.moveToNextMatch(),!0):!1}moveToPrevMatch(){return this._model?(this._model.moveToPrevMatch(),!0):!1}goToMatch(e){return this._model?(this._model.moveToMatch(e),!0):!1}replace(){return this._model?(this._model.replace(),!0):!1}replaceAll(){var e;return this._model?(e=this._editor.getModel())!=null&&e.isTooLargeForHeapOperation()?(this._notificationService.warn(localize(935,"The file is too large to perform a replace all operation.")),!1):(this._model.replaceAll(),!0):!1}selectAllMatches(){return this._model?(this._model.selectAllMatches(),this._editor.focus(),!0):!1}async getGlobalBufferTerm(){return this._editor.getOption(50).globalFindClipboard&&this._editor.hasModel()&&!this._editor.getModel().isTooLargeForSyncing()?this._clipboardService.readFindText():""}setGlobalBufferTerm(e){this._editor.getOption(50).globalFindClipboard&&this._editor.hasModel()&&!this._editor.getModel().isTooLargeForSyncing()&&this._clipboardService.writeFindText(e)}},CommonFindController_1=Fi,Fi.ID="editor.contrib.findController",Fi);CommonFindController=CommonFindController_1=__decorate$1D([__param$1C(1,IContextKeyService),__param$1C(2,IStorageService),__param$1C(3,IClipboardService),__param$1C(4,INotificationService),__param$1C(5,IHoverService)],CommonFindController);let FindController=class extends CommonFindController{constructor(e,t,s,o,r,l,c,d){super(e,s,l,c,r,d),this._contextViewService=t,this._keybindingService=o,this._widget=null,this._findOptionsWidget=null,this._findWidgetSearchHistory=FindWidgetSearchHistory.getOrCreate(l),this._replaceWidgetHistory=ReplaceWidgetHistory.getOrCreate(l)}async _start(e,t){this._widget||this._createFindWidget();const s=this._editor.getSelection();let o=!1;switch(this._editor.getOption(50).autoFindInSelection){case"always":o=!0;break;case"never":o=!1;break;case"multiline":{o=!!s&&s.startLineNumber!==s.endLineNumber;break}}e.updateSearchScope=e.updateSearchScope||o,await super._start(e,t),this._widget&&(e.shouldFocus===2?this._widget.focusReplaceInput():e.shouldFocus===1&&this._widget.focusFindInput())}highlightFindOptions(e=!1){this._widget||this._createFindWidget(),this._state.isRevealed&&!e?this._widget.highlightFindOptions():this._findOptionsWidget.highlightFindOptions()}_createFindWidget(){this._widget=this._register(new FindWidget(this._editor,this,this._state,this._contextViewService,this._keybindingService,this._contextKeyService,this._hoverService,this._findWidgetSearchHistory,this._replaceWidgetHistory)),this._findOptionsWidget=this._register(new FindOptionsWidget(this._editor,this._state,this._keybindingService))}saveViewState(){var e;return(e=this._widget)==null?void 0:e.getViewState()}restoreViewState(e){var t;(t=this._widget)==null||t.setViewState(e)}};FindController=__decorate$1D([__param$1C(1,IContextViewService),__param$1C(2,IContextKeyService),__param$1C(3,IKeybindingService),__param$1C(4,INotificationService),__param$1C(5,IStorageService),__param$1C(6,IClipboardService),__param$1C(7,IHoverService)],FindController);const StartFindAction=registerMultiEditorAction(new MultiEditorAction({id:FIND_IDS.StartFindAction,label:localize2(942,"Find"),precondition:ContextKeyExpr.or(EditorContextKeys.focus,ContextKeyExpr.has("editorIsOpen")),kbOpts:{kbExpr:null,primary:2084,weight:100},menuOpts:{menuId:MenuId.MenubarEditMenu,group:"3_find",title:localize(936,"&&Find"),order:1}}));StartFindAction.addImplementation(0,(a,e,t)=>{const s=CommonFindController.get(e);return s?s.start({forceRevealReplace:!1,seedSearchStringFromSelection:e.getOption(50).seedSearchStringFromSelection!=="never"?"single":"none",seedSearchStringFromNonEmptySelection:e.getOption(50).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:e.getOption(50).globalFindClipboard,shouldFocus:1,shouldAnimate:!0,updateSearchScope:!1,loop:e.getOption(50).loop}):!1});const findArgDescription={description:"Open a new In-Editor Find Widget.",args:[{name:"Open a new In-Editor Find Widget args",schema:{properties:{searchString:{type:"string"},replaceString:{type:"string"},isRegex:{type:"boolean"},matchWholeWord:{type:"boolean"},isCaseSensitive:{type:"boolean"},preserveCase:{type:"boolean"},findInSelection:{type:"boolean"}}}}]};class StartFindWithArgsAction extends EditorAction{constructor(){super({id:FIND_IDS.StartFindWithArgs,label:localize2(943,"Find with Arguments"),precondition:void 0,kbOpts:{kbExpr:null,primary:0,weight:100},metadata:findArgDescription})}async run(e,t,s){const o=CommonFindController.get(t);if(o){const r=s?{searchString:s.searchString,replaceString:s.replaceString,isReplaceRevealed:s.replaceString!==void 0,isRegex:s.isRegex,wholeWord:s.matchWholeWord,matchCase:s.isCaseSensitive,preserveCase:s.preserveCase}:{};await o.start({forceRevealReplace:!1,seedSearchStringFromSelection:o.getState().searchString.length===0&&t.getOption(50).seedSearchStringFromSelection!=="never"?"single":"none",seedSearchStringFromNonEmptySelection:t.getOption(50).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:!0,shouldFocus:1,shouldAnimate:!0,updateSearchScope:(s==null?void 0:s.findInSelection)||!1,loop:t.getOption(50).loop},r),o.setGlobalBufferTerm(o.getState().searchString)}}}class StartFindWithSelectionAction extends EditorAction{constructor(){super({id:FIND_IDS.StartFindWithSelection,label:localize2(944,"Find with Selection"),precondition:void 0,kbOpts:{kbExpr:null,primary:0,mac:{primary:2083},weight:100}})}async run(e,t){const s=CommonFindController.get(t);s&&(await s.start({forceRevealReplace:!1,seedSearchStringFromSelection:"multiple",seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:0,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(50).loop}),s.setGlobalBufferTerm(s.getState().searchString))}}class MatchFindAction extends EditorAction{async run(e,t){const s=CommonFindController.get(t);s&&!this._run(s)&&(await s.start({forceRevealReplace:!1,seedSearchStringFromSelection:s.getState().searchString.length===0&&t.getOption(50).seedSearchStringFromSelection!=="never"?"single":"none",seedSearchStringFromNonEmptySelection:t.getOption(50).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:!0,shouldFocus:0,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(50).loop}),this._run(s))}}class NextMatchFindAction extends MatchFindAction{constructor(){super({id:FIND_IDS.NextMatchFindAction,label:localize2(945,"Find Next"),precondition:void 0,kbOpts:[{kbExpr:EditorContextKeys.focus,primary:61,mac:{primary:2085,secondary:[61]},weight:100},{kbExpr:ContextKeyExpr.and(EditorContextKeys.focus,CONTEXT_FIND_INPUT_FOCUSED),primary:3,weight:100}]})}_run(e){return e.moveToNextMatch()?(e.editor.pushUndoStop(),!0):!1}}class PreviousMatchFindAction extends MatchFindAction{constructor(){super({id:FIND_IDS.PreviousMatchFindAction,label:localize2(946,"Find Previous"),precondition:void 0,kbOpts:[{kbExpr:EditorContextKeys.focus,primary:1085,mac:{primary:3109,secondary:[1085]},weight:100},{kbExpr:ContextKeyExpr.and(EditorContextKeys.focus,CONTEXT_FIND_INPUT_FOCUSED),primary:1027,weight:100}]})}_run(e){return e.moveToPrevMatch()}}class MoveToMatchFindAction extends EditorAction{constructor(){super({id:FIND_IDS.GoToMatchFindAction,label:localize2(947,"Go to Match..."),precondition:CONTEXT_FIND_WIDGET_VISIBLE}),this._highlightDecorations=[]}run(e,t,s){const o=CommonFindController.get(t);if(!o)return;const r=o.getState().matchesCount;if(r<1){e.get(INotificationService).notify({severity:Severity.Warning,message:localize(937,"No matches. Try searching for something else.")});return}const l=e.get(IQuickInputService),c=new DisposableStore,d=c.add(l.createInputBox());d.placeholder=localize(938,"Type a number to go to a specific match (between 1 and {0})",r);const u=f=>{const p=parseInt(f);if(isNaN(p))return;const m=o.getState().matchesCount;if(p>0&&p<=m)return p-1;if(p<0&&p>=-m)return m+p},g=f=>{const p=u(f);if(typeof p=="number"){d.validationMessage=void 0,o.goToMatch(p);const m=o.getState().currentMatch;m&&this.addDecorations(t,m)}else d.validationMessage=localize(939,"Please type a number between 1 and {0}",o.getState().matchesCount),this.clearDecorations(t)};c.add(d.onDidChangeValue(f=>{g(f)})),c.add(d.onDidAccept(()=>{const f=u(d.value);typeof f=="number"?(o.goToMatch(f),d.hide()):d.validationMessage=localize(940,"Please type a number between 1 and {0}",o.getState().matchesCount)})),c.add(d.onDidHide(()=>{this.clearDecorations(t),c.dispose()})),d.show()}clearDecorations(e){e.changeDecorations(t=>{this._highlightDecorations=t.deltaDecorations(this._highlightDecorations,[])})}addDecorations(e,t){e.changeDecorations(s=>{this._highlightDecorations=s.deltaDecorations(this._highlightDecorations,[{range:t,options:{description:"find-match-quick-access-range-highlight",className:"rangeHighlight",isWholeLine:!0}},{range:t,options:{description:"find-match-quick-access-range-highlight-overview",overviewRuler:{color:themeColorFromId(overviewRulerRangeHighlight),position:OverviewRulerLane$1.Full}}}])})}}class SelectionMatchFindAction extends EditorAction{async run(e,t){const s=CommonFindController.get(t);if(!s)return;const o=getSelectionSearchString(t,"single",!1);o&&s.setSearchString(o),this._run(s)||(await s.start({forceRevealReplace:!1,seedSearchStringFromSelection:"none",seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:0,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(50).loop}),this._run(s))}}class NextSelectionMatchFindAction extends SelectionMatchFindAction{constructor(){super({id:FIND_IDS.NextSelectionMatchFindAction,label:localize2(948,"Find Next Selection"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:2109,weight:100}})}_run(e){return e.moveToNextMatch()}}class PreviousSelectionMatchFindAction extends SelectionMatchFindAction{constructor(){super({id:FIND_IDS.PreviousSelectionMatchFindAction,label:localize2(949,"Find Previous Selection"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:3133,weight:100}})}_run(e){return e.moveToPrevMatch()}}const StartFindReplaceAction=registerMultiEditorAction(new MultiEditorAction({id:FIND_IDS.StartFindReplaceAction,label:localize2(950,"Replace"),precondition:ContextKeyExpr.or(EditorContextKeys.focus,ContextKeyExpr.has("editorIsOpen")),kbOpts:{kbExpr:null,primary:2086,mac:{primary:2596},weight:100},menuOpts:{menuId:MenuId.MenubarEditMenu,group:"3_find",title:localize(941,"&&Replace"),order:2}}));StartFindReplaceAction.addImplementation(0,(a,e,t)=>{if(!e.hasModel()||e.getOption(104))return!1;const s=CommonFindController.get(e);if(!s)return!1;const o=e.getSelection(),r=s.isFindInputFocused(),l=!o.isEmpty()&&o.startLineNumber===o.endLineNumber&&e.getOption(50).seedSearchStringFromSelection!=="never"&&!r,c=r||l?2:1;return s.start({forceRevealReplace:!0,seedSearchStringFromSelection:l?"single":"none",seedSearchStringFromNonEmptySelection:e.getOption(50).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:e.getOption(50).seedSearchStringFromSelection!=="never",shouldFocus:c,shouldAnimate:!0,updateSearchScope:!1,loop:e.getOption(50).loop})});registerEditorContribution(CommonFindController.ID,FindController,0);registerEditorAction(StartFindWithArgsAction);registerEditorAction(StartFindWithSelectionAction);registerEditorAction(NextMatchFindAction);registerEditorAction(PreviousMatchFindAction);registerEditorAction(MoveToMatchFindAction);registerEditorAction(NextSelectionMatchFindAction);registerEditorAction(PreviousSelectionMatchFindAction);const FindCommand=EditorCommand.bindToContribution(CommonFindController.get);registerEditorCommand(new FindCommand({id:FIND_IDS.CloseFindWidgetCommand,precondition:CONTEXT_FIND_WIDGET_VISIBLE,handler:a=>a.closeFindWidget(),kbOpts:{weight:100+5,kbExpr:ContextKeyExpr.and(EditorContextKeys.focus,ContextKeyExpr.not("isComposing")),primary:9,secondary:[1033]}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ToggleCaseSensitiveCommand,precondition:void 0,handler:a=>a.toggleCaseSensitive(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:ToggleCaseSensitiveKeybinding.primary,mac:ToggleCaseSensitiveKeybinding.mac,win:ToggleCaseSensitiveKeybinding.win,linux:ToggleCaseSensitiveKeybinding.linux}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ToggleWholeWordCommand,precondition:void 0,handler:a=>a.toggleWholeWords(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:ToggleWholeWordKeybinding.primary,mac:ToggleWholeWordKeybinding.mac,win:ToggleWholeWordKeybinding.win,linux:ToggleWholeWordKeybinding.linux}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ToggleRegexCommand,precondition:void 0,handler:a=>a.toggleRegex(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:ToggleRegexKeybinding.primary,mac:ToggleRegexKeybinding.mac,win:ToggleRegexKeybinding.win,linux:ToggleRegexKeybinding.linux}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ToggleSearchScopeCommand,precondition:void 0,handler:a=>a.toggleSearchScope(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:ToggleSearchScopeKeybinding.primary,mac:ToggleSearchScopeKeybinding.mac,win:ToggleSearchScopeKeybinding.win,linux:ToggleSearchScopeKeybinding.linux}}));registerEditorCommand(new FindCommand({id:FIND_IDS.TogglePreserveCaseCommand,precondition:void 0,handler:a=>a.togglePreserveCase(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:TogglePreserveCaseKeybinding.primary,mac:TogglePreserveCaseKeybinding.mac,win:TogglePreserveCaseKeybinding.win,linux:TogglePreserveCaseKeybinding.linux}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ReplaceOneAction,precondition:CONTEXT_FIND_WIDGET_VISIBLE,handler:a=>a.replace(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:3094}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ReplaceOneAction,precondition:CONTEXT_FIND_WIDGET_VISIBLE,handler:a=>a.replace(),kbOpts:{weight:100+5,kbExpr:ContextKeyExpr.and(EditorContextKeys.focus,CONTEXT_REPLACE_INPUT_FOCUSED),primary:3}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ReplaceAllAction,precondition:CONTEXT_FIND_WIDGET_VISIBLE,handler:a=>a.replaceAll(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:2563}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ReplaceAllAction,precondition:CONTEXT_FIND_WIDGET_VISIBLE,handler:a=>a.replaceAll(),kbOpts:{weight:100+5,kbExpr:ContextKeyExpr.and(EditorContextKeys.focus,CONTEXT_REPLACE_INPUT_FOCUSED),primary:void 0,mac:{primary:2051}}}));registerEditorCommand(new FindCommand({id:FIND_IDS.SelectAllMatchesAction,precondition:CONTEXT_FIND_WIDGET_VISIBLE,handler:a=>a.selectAllMatches(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:515}}));const folding="",foldSourceAbbr={0:" ",1:"u",2:"r"},MAX_FOLDING_REGIONS=65535,MAX_LINE_NUMBER=16777215,MASK_INDENT=4278190080;class BitField{constructor(e){const t=Math.ceil(e/32);this._states=new Uint32Array(t)}get(e){const t=e/32|0,s=e%32;return(this._states[t]&1<<s)!==0}set(e,t){const s=e/32|0,o=e%32,r=this._states[s];t?this._states[s]=r|1<<o:this._states[s]=r&~(1<<o)}}class FoldingRegions{constructor(e,t,s){if(e.length!==t.length||e.length>MAX_FOLDING_REGIONS)throw new Error("invalid startIndexes or endIndexes size");this._startIndexes=e,this._endIndexes=t,this._collapseStates=new BitField(e.length),this._userDefinedStates=new BitField(e.length),this._recoveredStates=new BitField(e.length),this._types=s,this._parentsComputed=!1}ensureParentIndices(){if(!this._parentsComputed){this._parentsComputed=!0;const e=[],t=(s,o)=>{const r=e[e.length-1];return this.getStartLineNumber(r)<=s&&this.getEndLineNumber(r)>=o};for(let s=0,o=this._startIndexes.length;s<o;s++){const r=this._startIndexes[s],l=this._endIndexes[s];if(r>MAX_LINE_NUMBER||l>MAX_LINE_NUMBER)throw new Error("startLineNumber or endLineNumber must not exceed "+MAX_LINE_NUMBER);for(;e.length>0&&!t(r,l);)e.pop();const c=e.length>0?e[e.length-1]:-1;e.push(s),this._startIndexes[s]=r+((c&255)<<24),this._endIndexes[s]=l+((c&65280)<<16)}}}get length(){return this._startIndexes.length}getStartLineNumber(e){return this._startIndexes[e]&MAX_LINE_NUMBER}getEndLineNumber(e){return this._endIndexes[e]&MAX_LINE_NUMBER}getType(e){return this._types?this._types[e]:void 0}hasTypes(){return!!this._types}isCollapsed(e){return this._collapseStates.get(e)}setCollapsed(e,t){this._collapseStates.set(e,t)}isUserDefined(e){return this._userDefinedStates.get(e)}setUserDefined(e,t){return this._userDefinedStates.set(e,t)}isRecovered(e){return this._recoveredStates.get(e)}setRecovered(e,t){return this._recoveredStates.set(e,t)}getSource(e){return this.isUserDefined(e)?1:this.isRecovered(e)?2:0}setSource(e,t){t===1?(this.setUserDefined(e,!0),this.setRecovered(e,!1)):t===2?(this.setUserDefined(e,!1),this.setRecovered(e,!0)):(this.setUserDefined(e,!1),this.setRecovered(e,!1))}setCollapsedAllOfType(e,t){let s=!1;if(this._types)for(let o=0;o<this._types.length;o++)this._types[o]===e&&(this.setCollapsed(o,t),s=!0);return s}toRegion(e){return new FoldingRegion(this,e)}getParentIndex(e){this.ensureParentIndices();const t=((this._startIndexes[e]&MASK_INDENT)>>>24)+((this._endIndexes[e]&MASK_INDENT)>>>16);return t===MAX_FOLDING_REGIONS?-1:t}contains(e,t){return this.getStartLineNumber(e)<=t&&this.getEndLineNumber(e)>=t}findIndex(e){let t=0,s=this._startIndexes.length;if(s===0)return-1;for(;t<s;){const o=Math.floor((t+s)/2);e<this.getStartLineNumber(o)?s=o:t=o+1}return t-1}findRange(e){let t=this.findIndex(e);if(t>=0){if(this.getEndLineNumber(t)>=e)return t;for(t=this.getParentIndex(t);t!==-1;){if(this.contains(t,e))return t;t=this.getParentIndex(t)}}return-1}toString(){const e=[];for(let t=0;t<this.length;t++)e[t]=`[${foldSourceAbbr[this.getSource(t)]}${this.isCollapsed(t)?"+":"-"}] ${this.getStartLineNumber(t)}/${this.getEndLineNumber(t)}`;return e.join(", ")}toFoldRange(e){return{startLineNumber:this._startIndexes[e]&MAX_LINE_NUMBER,endLineNumber:this._endIndexes[e]&MAX_LINE_NUMBER,type:this._types?this._types[e]:void 0,isCollapsed:this.isCollapsed(e),source:this.getSource(e)}}static fromFoldRanges(e){const t=e.length,s=new Uint32Array(t),o=new Uint32Array(t);let r=[],l=!1;for(let d=0;d<t;d++){const u=e[d];s[d]=u.startLineNumber,o[d]=u.endLineNumber,r.push(u.type),u.type&&(l=!0)}l||(r=void 0);const c=new FoldingRegions(s,o,r);for(let d=0;d<t;d++)e[d].isCollapsed&&c.setCollapsed(d,!0),c.setSource(d,e[d].source);return c}static sanitizeAndMerge(e,t,s,o){s=s??Number.MAX_VALUE;const r=(b,v)=>Array.isArray(b)?S=>S<v?b[S]:void 0:S=>S<v?b.toFoldRange(S):void 0,l=r(e,e.length),c=r(t,t.length);let d=0,u=0,g=l(0),f=c(0);const p=[];let m,_=0;const C=[];for(;g||f;){let b;if(f&&(!g||g.startLineNumber>=f.startLineNumber))g&&g.startLineNumber===f.startLineNumber?(f.source===1?b=f:(b=g,b.isCollapsed=f.isCollapsed&&(g.endLineNumber===f.endLineNumber||!(o!=null&&o.startsInside(g.startLineNumber+1,g.endLineNumber+1))),b.source=0),g=l(++d)):(b=f,f.isCollapsed&&f.source===0&&(b.source=2)),f=c(++u);else{let v=u,S=f;for(;;){if(!S||S.startLineNumber>g.endLineNumber){b=g;break}if(S.source===1&&S.endLineNumber>g.endLineNumber)break;S=c(++v)}g=l(++d)}if(b){for(;m&&m.endLineNumber<b.startLineNumber;)m=p.pop();b.endLineNumber>b.startLineNumber&&b.startLineNumber>_&&b.endLineNumber<=s&&(!m||m.endLineNumber>=b.endLineNumber)&&(C.push(b),_=b.startLineNumber,m&&p.push(m),m=b)}}return C}}class FoldingRegion{constructor(e,t){this.ranges=e,this.index=t}get startLineNumber(){return this.ranges.getStartLineNumber(this.index)}get endLineNumber(){return this.ranges.getEndLineNumber(this.index)}get regionIndex(){return this.index}get parentIndex(){return this.ranges.getParentIndex(this.index)}get isCollapsed(){return this.ranges.isCollapsed(this.index)}containedBy(e){return e.startLineNumber<=this.startLineNumber&&e.endLineNumber>=this.endLineNumber}containsLine(e){return this.startLineNumber<=e&&e<=this.endLineNumber}}class FoldingModel{get regions(){return this._regions}get textModel(){return this._textModel}constructor(e,t){this._updateEventEmitter=new Emitter$1,this.onDidChange=this._updateEventEmitter.event,this._textModel=e,this._decorationProvider=t,this._regions=new FoldingRegions(new Uint32Array(0),new Uint32Array(0)),this._editorDecorationIds=[]}toggleCollapseState(e){if(!e.length)return;e=e.sort((s,o)=>s.regionIndex-o.regionIndex);const t={};this._decorationProvider.changeDecorations(s=>{let o=0,r=-1,l=-1;const c=d=>{for(;o<d;){const u=this._regions.getEndLineNumber(o),g=this._regions.isCollapsed(o);if(u<=r){const f=this.regions.getSource(o)!==0;s.changeDecorationOptions(this._editorDecorationIds[o],this._decorationProvider.getDecorationOption(g,u<=l,f))}g&&u>l&&(l=u),o++}};for(const d of e){const u=d.regionIndex,g=this._editorDecorationIds[u];if(g&&!t[g]){t[g]=!0,c(u);const f=!this._regions.isCollapsed(u);this._regions.setCollapsed(u,f),r=Math.max(r,this._regions.getEndLineNumber(u))}}c(this._regions.length)}),this._updateEventEmitter.fire({model:this,collapseStateChanged:e})}removeManualRanges(e){const t=new Array,s=o=>{for(const r of e)if(!(r.startLineNumber>o.endLineNumber||o.startLineNumber>r.endLineNumber))return!0;return!1};for(let o=0;o<this._regions.length;o++){const r=this._regions.toFoldRange(o);(r.source===0||!s(r))&&t.push(r)}this.updatePost(FoldingRegions.fromFoldRanges(t))}update(e,t){const s=this._currentFoldedOrManualRanges(t),o=FoldingRegions.sanitizeAndMerge(e,s,this._textModel.getLineCount(),t);this.updatePost(FoldingRegions.fromFoldRanges(o))}updatePost(e){const t=[];let s=-1;for(let o=0,r=e.length;o<r;o++){const l=e.getStartLineNumber(o),c=e.getEndLineNumber(o),d=e.isCollapsed(o),u=e.getSource(o)!==0,g={startLineNumber:l,startColumn:this._textModel.getLineMaxColumn(l),endLineNumber:c,endColumn:this._textModel.getLineMaxColumn(c)+1};t.push({range:g,options:this._decorationProvider.getDecorationOption(d,c<=s,u)}),d&&c>s&&(s=c)}this._decorationProvider.changeDecorations(o=>this._editorDecorationIds=o.deltaDecorations(this._editorDecorationIds,t)),this._regions=e,this._updateEventEmitter.fire({model:this})}_currentFoldedOrManualRanges(e){const t=[];for(let s=0,o=this._regions.length;s<o;s++){let r=this.regions.isCollapsed(s);const l=this.regions.getSource(s);if(r||l!==0){const c=this._regions.toFoldRange(s),d=this._textModel.getDecorationRange(this._editorDecorationIds[s]);d&&(r&&(e!=null&&e.startsInside(d.startLineNumber+1,d.endLineNumber))&&(r=!1),t.push({startLineNumber:d.startLineNumber,endLineNumber:d.endLineNumber,type:c.type,isCollapsed:r,source:l}))}}return t}getMemento(){const e=this._currentFoldedOrManualRanges(),t=[],s=this._textModel.getLineCount();for(let o=0,r=e.length;o<r;o++){const l=e[o];if(l.startLineNumber>=l.endLineNumber||l.startLineNumber<1||l.endLineNumber>s)continue;const c=this._getLinesChecksum(l.startLineNumber+1,l.endLineNumber);t.push({startLineNumber:l.startLineNumber,endLineNumber:l.endLineNumber,isCollapsed:l.isCollapsed,source:l.source,checksum:c})}return t.length>0?t:void 0}applyMemento(e){if(!Array.isArray(e))return;const t=[],s=this._textModel.getLineCount();for(const r of e){if(r.startLineNumber>=r.endLineNumber||r.startLineNumber<1||r.endLineNumber>s)continue;const l=this._getLinesChecksum(r.startLineNumber+1,r.endLineNumber);(!r.checksum||l===r.checksum)&&t.push({startLineNumber:r.startLineNumber,endLineNumber:r.endLineNumber,type:void 0,isCollapsed:r.isCollapsed??!0,source:r.source??0})}const o=FoldingRegions.sanitizeAndMerge(this._regions,t,s);this.updatePost(FoldingRegions.fromFoldRanges(o))}_getLinesChecksum(e,t){return hash(this._textModel.getLineContent(e)+this._textModel.getLineContent(t))%1e6}dispose(){this._decorationProvider.removeDecorations(this._editorDecorationIds)}getAllRegionsAtLine(e,t){const s=[];if(this._regions){let o=this._regions.findRange(e),r=1;for(;o>=0;){const l=this._regions.toRegion(o);(!t||t(l,r))&&s.push(l),r++,o=l.parentIndex}}return s}getRegionAtLine(e){if(this._regions){const t=this._regions.findRange(e);if(t>=0)return this._regions.toRegion(t)}return null}getRegionsInside(e,t){const s=[],o=e?e.regionIndex+1:0,r=e?e.endLineNumber:Number.MAX_VALUE;if(t&&t.length===2){const l=[];for(let c=o,d=this._regions.length;c<d;c++){const u=this._regions.toRegion(c);if(this._regions.getStartLineNumber(c)<r){for(;l.length>0&&!u.containedBy(l[l.length-1]);)l.pop();l.push(u),t(u,l.length)&&s.push(u)}else break}}else for(let l=o,c=this._regions.length;l<c;l++){const d=this._regions.toRegion(l);if(this._regions.getStartLineNumber(l)<r)(!t||t(d))&&s.push(d);else break}return s}}function toggleCollapseState(a,e,t){const s=[];for(const o of t){const r=a.getRegionAtLine(o);if(r){const l=!r.isCollapsed;if(s.push(r),e>1){const c=a.getRegionsInside(r,(d,u)=>d.isCollapsed!==l&&u<e);s.push(...c)}}}a.toggleCollapseState(s)}function setCollapseStateLevelsDown(a,e,t=Number.MAX_VALUE,s){const o=[];if(s&&s.length>0)for(const r of s){const l=a.getRegionAtLine(r);if(l&&(l.isCollapsed!==e&&o.push(l),t>1)){const c=a.getRegionsInside(l,(d,u)=>d.isCollapsed!==e&&u<t);o.push(...c)}}else{const r=a.getRegionsInside(null,(l,c)=>l.isCollapsed!==e&&c<t);o.push(...r)}a.toggleCollapseState(o)}function setCollapseStateLevelsUp(a,e,t,s){const o=[];for(const r of s){const l=a.getAllRegionsAtLine(r,(c,d)=>c.isCollapsed!==e&&d<=t);o.push(...l)}a.toggleCollapseState(o)}function setCollapseStateUp(a,e,t){const s=[];for(const o of t){const r=a.getAllRegionsAtLine(o,l=>l.isCollapsed!==e);r.length>0&&s.push(r[0])}a.toggleCollapseState(s)}function setCollapseStateAtLevel(a,e,t,s){const o=(l,c)=>c===e&&l.isCollapsed!==t&&!s.some(d=>l.containsLine(d)),r=a.getRegionsInside(null,o);a.toggleCollapseState(r)}function setCollapseStateForRest(a,e,t){const s=[];for(const l of t){const c=a.getAllRegionsAtLine(l,void 0);c.length>0&&s.push(c[0])}const o=l=>s.every(c=>!c.containedBy(l)&&!l.containedBy(c))&&l.isCollapsed!==e,r=a.getRegionsInside(null,o);a.toggleCollapseState(r)}function setCollapseStateForMatchingLines(a,e,t){const s=a.textModel,o=a.regions,r=[];for(let l=o.length-1;l>=0;l--)if(t!==o.isCollapsed(l)){const c=o.getStartLineNumber(l);e.test(s.getLineContent(c))&&r.push(o.toRegion(l))}a.toggleCollapseState(r)}function setCollapseStateForType(a,e,t){const s=a.regions,o=[];for(let r=s.length-1;r>=0;r--)t!==s.isCollapsed(r)&&e===s.getType(r)&&o.push(s.toRegion(r));a.toggleCollapseState(o)}function getParentFoldLine(a,e){let t=null;const s=e.getRegionAtLine(a);if(s!==null&&(t=s.startLineNumber,a===t)){const o=s.parentIndex;o!==-1?t=e.regions.getStartLineNumber(o):t=null}return t}function getPreviousFoldLine(a,e){let t=e.getRegionAtLine(a);if(t!==null&&t.startLineNumber===a){if(a!==t.startLineNumber)return t.startLineNumber;{const s=t.parentIndex;let o=0;for(s!==-1&&(o=e.regions.getStartLineNumber(t.parentIndex));t!==null;)if(t.regionIndex>0){if(t=e.regions.toRegion(t.regionIndex-1),t.startLineNumber<=o)return null;if(t.parentIndex===s)return t.startLineNumber}else return null}}else if(e.regions.length>0)for(t=e.regions.toRegion(e.regions.length-1);t!==null;){if(t.startLineNumber<a)return t.startLineNumber;t.regionIndex>0?t=e.regions.toRegion(t.regionIndex-1):t=null}return null}function getNextFoldLine(a,e){let t=e.getRegionAtLine(a);if(t!==null&&t.startLineNumber===a){const s=t.parentIndex;let o=0;if(s!==-1)o=e.regions.getEndLineNumber(t.parentIndex);else{if(e.regions.length===0)return null;o=e.regions.getEndLineNumber(e.regions.length-1)}for(;t!==null;)if(t.regionIndex<e.regions.length){if(t=e.regions.toRegion(t.regionIndex+1),t.startLineNumber>=o)return null;if(t.parentIndex===s)return t.startLineNumber}else return null}else if(e.regions.length>0)for(t=e.regions.toRegion(0);t!==null;){if(t.startLineNumber>a)return t.startLineNumber;t.regionIndex<e.regions.length?t=e.regions.toRegion(t.regionIndex+1):t=null}return null}class HiddenRangeModel{get onDidChange(){return this._updateEventEmitter.event}get hiddenRanges(){return this._hiddenRanges}constructor(e){this._updateEventEmitter=new Emitter$1,this._hasLineChanges=!1,this._foldingModel=e,this._foldingModelListener=e.onDidChange(t=>this.updateHiddenRanges()),this._hiddenRanges=[],e.regions.length&&this.updateHiddenRanges()}notifyChangeModelContent(e){this._hiddenRanges.length&&!this._hasLineChanges&&(this._hasLineChanges=e.changes.some(t=>t.range.endLineNumber!==t.range.startLineNumber||countEOL(t.text)[0]!==0))}updateHiddenRanges(){let e=!1;const t=[];let s=0,o=0,r=Number.MAX_VALUE,l=-1;const c=this._foldingModel.regions;for(;s<c.length;s++){if(!c.isCollapsed(s))continue;const d=c.getStartLineNumber(s)+1,u=c.getEndLineNumber(s);r<=d&&u<=l||(!e&&o<this._hiddenRanges.length&&this._hiddenRanges[o].startLineNumber===d&&this._hiddenRanges[o].endLineNumber===u?(t.push(this._hiddenRanges[o]),o++):(e=!0,t.push(new Range$2(d,1,u,1))),r=d,l=u)}(this._hasLineChanges||e||o<this._hiddenRanges.length)&&this.applyHiddenRanges(t)}applyHiddenRanges(e){this._hiddenRanges=e,this._hasLineChanges=!1,this._updateEventEmitter.fire(e)}hasRanges(){return this._hiddenRanges.length>0}isHidden(e){return findRange(this._hiddenRanges,e)!==null}adjustSelections(e){let t=!1;const s=this._foldingModel.textModel;let o=null;const r=l=>((!o||!isInside(l,o))&&(o=findRange(this._hiddenRanges,l)),o?o.startLineNumber-1:null);for(let l=0,c=e.length;l<c;l++){let d=e[l];const u=r(d.startLineNumber);u&&(d=d.setStartPosition(u,s.getLineMaxColumn(u)),t=!0);const g=r(d.endLineNumber);g&&(d=d.setEndPosition(g,s.getLineMaxColumn(g)),t=!0),e[l]=d}return t}dispose(){this.hiddenRanges.length>0&&(this._hiddenRanges=[],this._updateEventEmitter.fire(this._hiddenRanges)),this._foldingModelListener&&(this._foldingModelListener.dispose(),this._foldingModelListener=null)}}function isInside(a,e){return a>=e.startLineNumber&&a<=e.endLineNumber}function findRange(a,e){const t=findFirstIdxMonotonousOrArrLen(a,s=>e<s.startLineNumber)-1;return t>=0&&a[t].endLineNumber>=e?a[t]:null}const MAX_FOLDING_REGIONS_FOR_INDENT_DEFAULT=5e3,ID_INDENT_PROVIDER="indent";class IndentRangeProvider{constructor(e,t,s){this.editorModel=e,this.languageConfigurationService=t,this.foldingRangesLimit=s,this.id=ID_INDENT_PROVIDER}dispose(){}compute(e){const t=this.languageConfigurationService.getLanguageConfiguration(this.editorModel.getLanguageId()).foldingRules,s=t&&!!t.offSide,o=t&&t.markers;return Promise.resolve(computeRanges(this.editorModel,s,o,this.foldingRangesLimit))}}let RangesCollector$1=class{constructor(e){this._startIndexes=[],this._endIndexes=[],this._indentOccurrences=[],this._length=0,this._foldingRangesLimit=e}insertFirst(e,t,s){if(e>MAX_LINE_NUMBER||t>MAX_LINE_NUMBER)return;const o=this._length;this._startIndexes[o]=e,this._endIndexes[o]=t,this._length++,s<1e3&&(this._indentOccurrences[s]=(this._indentOccurrences[s]||0)+1)}toIndentRanges(e){const t=this._foldingRangesLimit.limit;if(this._length<=t){this._foldingRangesLimit.update(this._length,!1);const s=new Uint32Array(this._length),o=new Uint32Array(this._length);for(let r=this._length-1,l=0;r>=0;r--,l++)s[l]=this._startIndexes[r],o[l]=this._endIndexes[r];return new FoldingRegions(s,o)}else{this._foldingRangesLimit.update(this._length,t);let s=0,o=this._indentOccurrences.length;for(let d=0;d<this._indentOccurrences.length;d++){const u=this._indentOccurrences[d];if(u){if(u+s>t){o=d;break}s+=u}}const r=e.getOptions().tabSize,l=new Uint32Array(t),c=new Uint32Array(t);for(let d=this._length-1,u=0;d>=0;d--){const g=this._startIndexes[d],f=e.getLineContent(g),p=computeIndentLevel(f,r);(p<o||p===o&&s++<t)&&(l[u]=g,c[u]=this._endIndexes[d],u++)}return new FoldingRegions(l,c)}}};const foldingRangesLimitDefault={limit:MAX_FOLDING_REGIONS_FOR_INDENT_DEFAULT,update:()=>{}};function computeRanges(a,e,t,s=foldingRangesLimitDefault){const o=a.getOptions().tabSize,r=new RangesCollector$1(s);let l;t&&(l=new RegExp(`(${t.start.source})|(?:${t.end.source})`));const c=[],d=a.getLineCount()+1;c.push({indent:-1,endAbove:d,line:d});for(let u=a.getLineCount();u>0;u--){const g=a.getLineContent(u),f=computeIndentLevel(g,o);let p=c[c.length-1];if(f===-1){e&&(p.endAbove=u);continue}let m;if(l&&(m=g.match(l)))if(m[1]){let _=c.length-1;for(;_>0&&c[_].indent!==-2;)_--;if(_>0){c.length=_+1,p=c[_],r.insertFirst(u,p.line,f),p.line=u,p.indent=f,p.endAbove=u;continue}}else{c.push({indent:-2,endAbove:u,line:u});continue}if(p.indent>f){do c.pop(),p=c[c.length-1];while(p.indent>f);const _=p.endAbove-1;_-u>=1&&r.insertFirst(u,_,f)}p.indent===f?p.endAbove=u:c.push({indent:f,endAbove:u,line:u})}return r.toIndentRanges(a)}const foldBackground=registerColor("editor.foldBackground",{light:transparent(editorSelectionBackground,.3),dark:transparent(editorSelectionBackground,.3),hcDark:null,hcLight:null},localize(997,"Background color behind folded ranges. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("editor.foldPlaceholderForeground",{light:"#808080",dark:"#808080",hcDark:null,hcLight:null},localize(998,"Color of the collapsed text after the first line of a folded range."));registerColor("editorGutter.foldingControlForeground",iconForeground,localize(999,"Color of the folding control in the editor gutter."));const foldingExpandedIcon=registerIcon("folding-expanded",Codicon.chevronDown,localize(1e3,"Icon for expanded ranges in the editor glyph margin.")),foldingCollapsedIcon=registerIcon("folding-collapsed",Codicon.chevronRight,localize(1001,"Icon for collapsed ranges in the editor glyph margin.")),foldingManualCollapsedIcon=registerIcon("folding-manual-collapsed",foldingCollapsedIcon,localize(1002,"Icon for manually collapsed ranges in the editor glyph margin.")),foldingManualExpandedIcon=registerIcon("folding-manual-expanded",foldingExpandedIcon,localize(1003,"Icon for manually expanded ranges in the editor glyph margin.")),foldedBackgroundMinimap={color:themeColorFromId(foldBackground),position:1},collapsed=localize(1004,"Click to expand the range."),expanded=localize(1005,"Click to collapse the range."),re=class re{constructor(e){this.editor=e,this.showFoldingControls="mouseover",this.showFoldingHighlights=!0}getDecorationOption(e,t,s){return t?re.HIDDEN_RANGE_DECORATION:this.showFoldingControls==="never"?e?this.showFoldingHighlights?re.NO_CONTROLS_COLLAPSED_HIGHLIGHTED_RANGE_DECORATION:re.NO_CONTROLS_COLLAPSED_RANGE_DECORATION:re.NO_CONTROLS_EXPANDED_RANGE_DECORATION:e?s?this.showFoldingHighlights?re.MANUALLY_COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION:re.MANUALLY_COLLAPSED_VISUAL_DECORATION:this.showFoldingHighlights?re.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION:re.COLLAPSED_VISUAL_DECORATION:this.showFoldingControls==="mouseover"?s?re.MANUALLY_EXPANDED_AUTO_HIDE_VISUAL_DECORATION:re.EXPANDED_AUTO_HIDE_VISUAL_DECORATION:s?re.MANUALLY_EXPANDED_VISUAL_DECORATION:re.EXPANDED_VISUAL_DECORATION}changeDecorations(e){return this.editor.changeDecorations(e)}removeDecorations(e){this.editor.removeDecorations(e)}};re.COLLAPSED_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-collapsed-visual-decoration",stickiness:0,afterContentClassName:"inline-folded",isWholeLine:!0,linesDecorationsTooltip:collapsed,firstLineDecorationClassName:ThemeIcon.asClassName(foldingCollapsedIcon)}),re.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-collapsed-highlighted-visual-decoration",stickiness:0,afterContentClassName:"inline-folded",className:"folded-background",minimap:foldedBackgroundMinimap,isWholeLine:!0,linesDecorationsTooltip:collapsed,firstLineDecorationClassName:ThemeIcon.asClassName(foldingCollapsedIcon)}),re.MANUALLY_COLLAPSED_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-manually-collapsed-visual-decoration",stickiness:0,afterContentClassName:"inline-folded",isWholeLine:!0,linesDecorationsTooltip:collapsed,firstLineDecorationClassName:ThemeIcon.asClassName(foldingManualCollapsedIcon)}),re.MANUALLY_COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-manually-collapsed-highlighted-visual-decoration",stickiness:0,afterContentClassName:"inline-folded",className:"folded-background",minimap:foldedBackgroundMinimap,isWholeLine:!0,linesDecorationsTooltip:collapsed,firstLineDecorationClassName:ThemeIcon.asClassName(foldingManualCollapsedIcon)}),re.NO_CONTROLS_COLLAPSED_RANGE_DECORATION=ModelDecorationOptions.register({description:"folding-no-controls-range-decoration",stickiness:0,afterContentClassName:"inline-folded",isWholeLine:!0,linesDecorationsTooltip:collapsed}),re.NO_CONTROLS_COLLAPSED_HIGHLIGHTED_RANGE_DECORATION=ModelDecorationOptions.register({description:"folding-no-controls-range-decoration",stickiness:0,afterContentClassName:"inline-folded",className:"folded-background",minimap:foldedBackgroundMinimap,isWholeLine:!0,linesDecorationsTooltip:collapsed}),re.EXPANDED_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-expanded-visual-decoration",stickiness:1,isWholeLine:!0,firstLineDecorationClassName:"alwaysShowFoldIcons "+ThemeIcon.asClassName(foldingExpandedIcon),linesDecorationsTooltip:expanded}),re.EXPANDED_AUTO_HIDE_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-expanded-auto-hide-visual-decoration",stickiness:1,isWholeLine:!0,firstLineDecorationClassName:ThemeIcon.asClassName(foldingExpandedIcon),linesDecorationsTooltip:expanded}),re.MANUALLY_EXPANDED_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-manually-expanded-visual-decoration",stickiness:0,isWholeLine:!0,firstLineDecorationClassName:"alwaysShowFoldIcons "+ThemeIcon.asClassName(foldingManualExpandedIcon),linesDecorationsTooltip:expanded}),re.MANUALLY_EXPANDED_AUTO_HIDE_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-manually-expanded-auto-hide-visual-decoration",stickiness:0,isWholeLine:!0,firstLineDecorationClassName:ThemeIcon.asClassName(foldingManualExpandedIcon),linesDecorationsTooltip:expanded}),re.NO_CONTROLS_EXPANDED_RANGE_DECORATION=ModelDecorationOptions.register({description:"folding-no-controls-range-decoration",stickiness:0,isWholeLine:!0}),re.HIDDEN_RANGE_DECORATION=ModelDecorationOptions.register({description:"folding-hidden-range-decoration",stickiness:1});let FoldingDecorationProvider=re;const foldingContext={},ID_SYNTAX_PROVIDER="syntax";class SyntaxRangeProvider{constructor(e,t,s,o,r){this.editorModel=e,this.providers=t,this.handleFoldingRangesChange=s,this.foldingRangesLimit=o,this.fallbackRangeProvider=r,this.id=ID_SYNTAX_PROVIDER,this.disposables=new DisposableStore,r&&this.disposables.add(r);for(const l of t)typeof l.onDidChange=="function"&&this.disposables.add(l.onDidChange(s))}compute(e){return collectSyntaxRanges(this.providers,this.editorModel,e).then(t=>{var s;return this.editorModel.isDisposed()?null:t?sanitizeRanges(t,this.foldingRangesLimit):((s=this.fallbackRangeProvider)==null?void 0:s.compute(e))??null})}dispose(){this.disposables.dispose()}}function collectSyntaxRanges(a,e,t){let s=null;const o=a.map((r,l)=>Promise.resolve(r.provideFoldingRanges(e,foldingContext,t)).then(c=>{if(!t.isCancellationRequested&&Array.isArray(c)){Array.isArray(s)||(s=[]);const d=e.getLineCount();for(const u of c)u.start>0&&u.end>u.start&&u.end<=d&&s.push({start:u.start,end:u.end,rank:l,kind:u.kind})}},onUnexpectedExternalError));return Promise.all(o).then(r=>s)}class RangesCollector{constructor(e){this._startIndexes=[],this._endIndexes=[],this._nestingLevels=[],this._nestingLevelCounts=[],this._types=[],this._length=0,this._foldingRangesLimit=e}add(e,t,s,o){if(e>MAX_LINE_NUMBER||t>MAX_LINE_NUMBER)return;const r=this._length;this._startIndexes[r]=e,this._endIndexes[r]=t,this._nestingLevels[r]=o,this._types[r]=s,this._length++,o<30&&(this._nestingLevelCounts[o]=(this._nestingLevelCounts[o]||0)+1)}toIndentRanges(){const e=this._foldingRangesLimit.limit;if(this._length<=e){this._foldingRangesLimit.update(this._length,!1);const t=new Uint32Array(this._length),s=new Uint32Array(this._length);for(let o=0;o<this._length;o++)t[o]=this._startIndexes[o],s[o]=this._endIndexes[o];return new FoldingRegions(t,s,this._types)}else{this._foldingRangesLimit.update(this._length,e);let t=0,s=this._nestingLevelCounts.length;for(let c=0;c<this._nestingLevelCounts.length;c++){const d=this._nestingLevelCounts[c];if(d){if(d+t>e){s=c;break}t+=d}}const o=new Uint32Array(e),r=new Uint32Array(e),l=[];for(let c=0,d=0;c<this._length;c++){const u=this._nestingLevels[c];(u<s||u===s&&t++<e)&&(o[d]=this._startIndexes[c],r[d]=this._endIndexes[c],l[d]=this._types[c],d++)}return new FoldingRegions(o,r,l)}}}function sanitizeRanges(a,e){const t=a.sort((l,c)=>{let d=l.start-c.start;return d===0&&(d=l.rank-c.rank),d}),s=new RangesCollector(e);let o;const r=[];for(const l of t)if(!o)o=l,s.add(l.start,l.end,l.kind&&l.kind.value,r.length);else if(l.start>o.start)if(l.end<=o.end)r.push(o),o=l,s.add(l.start,l.end,l.kind&&l.kind.value,r.length);else{if(l.start>o.end){do o=r.pop();while(o&&l.start>o.end);o&&r.push(o),o=l}s.add(l.start,l.end,l.kind&&l.kind.value,r.length)}return s.toIndentRanges()}var __decorate$1C=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1B=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},FoldingController_1;const CONTEXT_FOLDING_ENABLED=new RawContextKey("foldingEnabled",!1);var $i;let FoldingController=($i=class extends Disposable{static get(e){return e.getContribution(FoldingController_1.ID)}static getFoldingRangeProviders(e,t){var o;const s=e.foldingRangeProvider.ordered(t);return((o=FoldingController_1._foldingRangeSelector)==null?void 0:o.call(FoldingController_1,s,t))??s}constructor(e,t,s,o,r,l){super(),this.contextKeyService=t,this.languageConfigurationService=s,this.languageFeaturesService=l,this.localToDispose=this._register(new DisposableStore),this.editor=e,this._foldingLimitReporter=this._register(new RangesLimitReporter(e));const c=this.editor.getOptions();this._isEnabled=c.get(52),this._useFoldingProviders=c.get(53)!=="indentation",this._unfoldOnClickAfterEndOfLine=c.get(57),this._restoringViewState=!1,this._currentModelHasFoldedImports=!1,this._foldingImportsByDefault=c.get(55),this.updateDebounceInfo=r.for(l.foldingRangeProvider,"Folding",{min:200}),this.foldingModel=null,this.hiddenRangeModel=null,this.rangeProvider=null,this.foldingRegionPromise=null,this.foldingModelPromise=null,this.updateScheduler=null,this.cursorChangedScheduler=null,this.mouseDownInfo=null,this.foldingDecorationProvider=new FoldingDecorationProvider(e),this.foldingDecorationProvider.showFoldingControls=c.get(126),this.foldingDecorationProvider.showFoldingHighlights=c.get(54),this.foldingEnabled=CONTEXT_FOLDING_ENABLED.bindTo(this.contextKeyService),this.foldingEnabled.set(this._isEnabled),this._register(this.editor.onDidChangeModel(()=>this.onModelChanged())),this._register(this.editor.onDidChangeConfiguration(d=>{if(d.hasChanged(52)&&(this._isEnabled=this.editor.getOptions().get(52),this.foldingEnabled.set(this._isEnabled),this.onModelChanged()),d.hasChanged(56)&&this.onModelChanged(),d.hasChanged(126)||d.hasChanged(54)){const u=this.editor.getOptions();this.foldingDecorationProvider.showFoldingControls=u.get(126),this.foldingDecorationProvider.showFoldingHighlights=u.get(54),this.triggerFoldingModelChanged()}d.hasChanged(53)&&(this._useFoldingProviders=this.editor.getOptions().get(53)!=="indentation",this.onFoldingStrategyChanged()),d.hasChanged(57)&&(this._unfoldOnClickAfterEndOfLine=this.editor.getOptions().get(57)),d.hasChanged(55)&&(this._foldingImportsByDefault=this.editor.getOptions().get(55))})),this.onModelChanged()}saveViewState(){const e=this.editor.getModel();if(!e||!this._isEnabled||e.isTooLargeForTokenization())return{};if(this.foldingModel){const t=this.foldingModel.getMemento(),s=this.rangeProvider?this.rangeProvider.id:void 0;return{collapsedRegions:t,lineCount:e.getLineCount(),provider:s,foldedImports:this._currentModelHasFoldedImports}}}restoreViewState(e){const t=this.editor.getModel();if(!(!t||!this._isEnabled||t.isTooLargeForTokenization()||!this.hiddenRangeModel)&&e&&(this._currentModelHasFoldedImports=!!e.foldedImports,e.collapsedRegions&&e.collapsedRegions.length>0&&this.foldingModel)){this._restoringViewState=!0;try{this.foldingModel.applyMemento(e.collapsedRegions)}finally{this._restoringViewState=!1}}}onModelChanged(){this.localToDispose.clear();const e=this.editor.getModel();!this._isEnabled||!e||e.isTooLargeForTokenization()||(this._currentModelHasFoldedImports=!1,this.foldingModel=new FoldingModel(e,this.foldingDecorationProvider),this.localToDispose.add(this.foldingModel),this.hiddenRangeModel=new HiddenRangeModel(this.foldingModel),this.localToDispose.add(this.hiddenRangeModel),this.localToDispose.add(this.hiddenRangeModel.onDidChange(t=>this.onHiddenRangesChanges(t))),this.updateScheduler=new Delayer(this.updateDebounceInfo.get(e)),this.localToDispose.add(this.updateScheduler),this.cursorChangedScheduler=new RunOnceScheduler(()=>this.revealCursor(),200),this.localToDispose.add(this.cursorChangedScheduler),this.localToDispose.add(this.languageFeaturesService.foldingRangeProvider.onDidChange(()=>this.onFoldingStrategyChanged())),this.localToDispose.add(this.editor.onDidChangeModelLanguageConfiguration(()=>this.onFoldingStrategyChanged())),this.localToDispose.add(this.editor.onDidChangeModelContent(t=>this.onDidChangeModelContent(t))),this.localToDispose.add(this.editor.onDidChangeCursorPosition(()=>this.onCursorPositionChanged())),this.localToDispose.add(this.editor.onMouseDown(t=>this.onEditorMouseDown(t))),this.localToDispose.add(this.editor.onMouseUp(t=>this.onEditorMouseUp(t))),this.localToDispose.add({dispose:()=>{var t,s;this.foldingRegionPromise&&(this.foldingRegionPromise.cancel(),this.foldingRegionPromise=null),(t=this.updateScheduler)==null||t.cancel(),this.updateScheduler=null,this.foldingModel=null,this.foldingModelPromise=null,this.hiddenRangeModel=null,this.cursorChangedScheduler=null,(s=this.rangeProvider)==null||s.dispose(),this.rangeProvider=null}}),this.triggerFoldingModelChanged())}onFoldingStrategyChanged(){var e;(e=this.rangeProvider)==null||e.dispose(),this.rangeProvider=null,this.triggerFoldingModelChanged()}getRangeProvider(e){if(this.rangeProvider)return this.rangeProvider;const t=new IndentRangeProvider(e,this.languageConfigurationService,this._foldingLimitReporter);if(this.rangeProvider=t,this._useFoldingProviders&&this.foldingModel){const s=FoldingController_1.getFoldingRangeProviders(this.languageFeaturesService,e);s.length>0&&(this.rangeProvider=new SyntaxRangeProvider(e,s,()=>this.triggerFoldingModelChanged(),this._foldingLimitReporter,t))}return this.rangeProvider}getFoldingModel(){return this.foldingModelPromise}onDidChangeModelContent(e){var t;(t=this.hiddenRangeModel)==null||t.notifyChangeModelContent(e),this.triggerFoldingModelChanged()}triggerFoldingModelChanged(){this.updateScheduler&&(this.foldingRegionPromise&&(this.foldingRegionPromise.cancel(),this.foldingRegionPromise=null),this.foldingModelPromise=this.updateScheduler.trigger(()=>{const e=this.foldingModel;if(!e)return null;const t=new StopWatch,s=this.getRangeProvider(e.textModel),o=this.foldingRegionPromise=createCancelablePromise(r=>s.compute(r));return o.then(r=>{if(r&&o===this.foldingRegionPromise){let l;if(this._foldingImportsByDefault&&!this._currentModelHasFoldedImports){const u=r.setCollapsedAllOfType(FoldingRangeKind.Imports.value,!0);u&&(l=StableEditorScrollState.capture(this.editor),this._currentModelHasFoldedImports=u)}const c=this.editor.getSelections();e.update(r,toSelectedLines(c)),l==null||l.restore(this.editor);const d=this.updateDebounceInfo.update(e.textModel,t.elapsed());this.updateScheduler&&(this.updateScheduler.defaultDelay=d)}return e})}).then(void 0,e=>(onUnexpectedError(e),null)))}onHiddenRangesChanges(e){if(this.hiddenRangeModel&&e.length&&!this._restoringViewState){const t=this.editor.getSelections();t&&this.hiddenRangeModel.adjustSelections(t)&&this.editor.setSelections(t)}this.editor.setHiddenAreas(e,this)}onCursorPositionChanged(){this.hiddenRangeModel&&this.hiddenRangeModel.hasRanges()&&this.cursorChangedScheduler.schedule()}revealCursor(){const e=this.getFoldingModel();e&&e.then(t=>{if(t){const s=this.editor.getSelections();if(s&&s.length>0){const o=[];for(const r of s){const l=r.selectionStartLineNumber;this.hiddenRangeModel&&this.hiddenRangeModel.isHidden(l)&&o.push(...t.getAllRegionsAtLine(l,c=>c.isCollapsed&&l>c.startLineNumber))}o.length&&(t.toggleCollapseState(o),this.reveal(s[0].getPosition()))}}}).then(void 0,onUnexpectedError)}onEditorMouseDown(e){if(this.mouseDownInfo=null,!this.hiddenRangeModel||!e.target||!e.target.range||!e.event.leftButton&&!e.event.middleButton)return;const t=e.target.range;let s=!1;switch(e.target.type){case 4:{const o=e.target.detail,r=e.target.element.offsetLeft;if(o.offsetX-r<4)return;s=!0;break}case 7:{if(this._unfoldOnClickAfterEndOfLine&&this.hiddenRangeModel.hasRanges()&&!e.target.detail.isAfterLines)break;return}case 6:{if(this.hiddenRangeModel.hasRanges()){const o=this.editor.getModel();if(o&&t.startColumn===o.getLineMaxColumn(t.startLineNumber))break}return}default:return}this.mouseDownInfo={lineNumber:t.startLineNumber,iconClicked:s}}onEditorMouseUp(e){const t=this.foldingModel;if(!t||!this.mouseDownInfo||!e.target)return;const s=this.mouseDownInfo.lineNumber,o=this.mouseDownInfo.iconClicked,r=e.target.range;if(!r||r.startLineNumber!==s)return;if(o){if(e.target.type!==4)return}else{const c=this.editor.getModel();if(!c||r.startColumn!==c.getLineMaxColumn(s))return}const l=t.getRegionAtLine(s);if(l&&l.startLineNumber===s){const c=l.isCollapsed;if(o||c){const d=e.event.altKey;let u=[];if(d){const g=p=>!p.containedBy(l)&&!l.containedBy(p),f=t.getRegionsInside(null,g);for(const p of f)p.isCollapsed&&u.push(p);u.length===0&&(u=f)}else{const g=e.event.middleButton||e.event.shiftKey;if(g)for(const f of t.getRegionsInside(l))f.isCollapsed===c&&u.push(f);(c||!g||u.length===0)&&u.push(l)}t.toggleCollapseState(u),this.reveal({lineNumber:s,column:1})}}}reveal(e){this.editor.revealPositionInCenterIfOutsideViewport(e,0)}},FoldingController_1=$i,$i.ID="editor.contrib.folding",$i);FoldingController=FoldingController_1=__decorate$1C([__param$1B(1,IContextKeyService),__param$1B(2,ILanguageConfigurationService),__param$1B(3,INotificationService),__param$1B(4,ILanguageFeatureDebounceService),__param$1B(5,ILanguageFeaturesService)],FoldingController);class RangesLimitReporter extends Disposable{constructor(e){super(),this.editor=e,this._onDidChange=this._register(new Emitter$1),this._computed=0,this._limited=!1}get limit(){return this.editor.getOptions().get(56)}update(e,t){(e!==this._computed||t!==this._limited)&&(this._computed=e,this._limited=t,this._onDidChange.fire())}}class FoldingAction extends EditorAction{runEditorCommand(e,t,s){const o=e.get(ILanguageConfigurationService),r=FoldingController.get(t);if(!r)return;const l=r.getFoldingModel();if(l)return this.reportTelemetry(e,t),l.then(c=>{if(c){this.invoke(r,c,t,s,o);const d=t.getSelection();d&&r.reveal(d.getStartPosition())}})}getSelectedLines(e){const t=e.getSelections();return t?t.map(s=>s.startLineNumber):[]}getLineNumbers(e,t){return e&&e.selectionLines?e.selectionLines.map(s=>s+1):this.getSelectedLines(t)}run(e,t){}}function toSelectedLines(a){return!a||a.length===0?{startsInside:()=>!1}:{startsInside(e,t){for(const s of a){const o=s.startLineNumber;if(o>=e&&o<=t)return!0}return!1}}}function foldingArgumentsConstraint(a){if(!isUndefined(a)){if(!isObject(a))return!1;const e=a;if(!isUndefined(e.levels)&&!isNumber$1(e.levels)||!isUndefined(e.direction)&&!isString$1(e.direction)||!isUndefined(e.selectionLines)&&(!Array.isArray(e.selectionLines)||!e.selectionLines.every(isNumber$1)))return!1}return!0}class UnfoldAction extends FoldingAction{constructor(){super({id:"editor.unfold",label:localize2(977,"Unfold"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3166,mac:{primary:2654},weight:100},metadata:{description:"Unfold the content in the editor",args:[{name:"Unfold editor argument",description:`Property-value pairs that can be passed through this argument:
						* 'levels': Number of levels to unfold. If not set, defaults to 1.
						* 'direction': If 'up', unfold given number of levels up otherwise unfolds down.
						* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the unfold action to. If not set, the active selection(s) will be used.
						`,constraint:foldingArgumentsConstraint,schema:{type:"object",properties:{levels:{type:"number",default:1},direction:{type:"string",enum:["up","down"],default:"down"},selectionLines:{type:"array",items:{type:"number"}}}}}]}})}invoke(e,t,s,o){const r=o&&o.levels||1,l=this.getLineNumbers(o,s);o&&o.direction==="up"?setCollapseStateLevelsUp(t,!1,r,l):setCollapseStateLevelsDown(t,!1,r,l)}}class UnFoldRecursivelyAction extends FoldingAction{constructor(){super({id:"editor.unfoldRecursively",label:localize2(978,"Unfold Recursively"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2142),weight:100}})}invoke(e,t,s,o){setCollapseStateLevelsDown(t,!1,Number.MAX_VALUE,this.getSelectedLines(s))}}class FoldAction extends FoldingAction{constructor(){super({id:"editor.fold",label:localize2(979,"Fold"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3164,mac:{primary:2652},weight:100},metadata:{description:"Fold the content in the editor",args:[{name:"Fold editor argument",description:`Property-value pairs that can be passed through this argument:
							* 'levels': Number of levels to fold.
							* 'direction': If 'up', folds given number of levels up otherwise folds down.
							* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the fold action to. If not set, the active selection(s) will be used.
							If no levels or direction is set, folds the region at the locations or if already collapsed, the first uncollapsed parent instead.
						`,constraint:foldingArgumentsConstraint,schema:{type:"object",properties:{levels:{type:"number"},direction:{type:"string",enum:["up","down"]},selectionLines:{type:"array",items:{type:"number"}}}}}]}})}invoke(e,t,s,o){const r=this.getLineNumbers(o,s),l=o&&o.levels,c=o&&o.direction;typeof l!="number"&&typeof c!="string"?setCollapseStateUp(t,!0,r):c==="up"?setCollapseStateLevelsUp(t,!0,l||1,r):setCollapseStateLevelsDown(t,!0,l||1,r)}}class ToggleFoldAction extends FoldingAction{constructor(){super({id:"editor.toggleFold",label:localize2(980,"Toggle Fold"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2090),weight:100}})}invoke(e,t,s){const o=this.getSelectedLines(s);toggleCollapseState(t,1,o)}}class FoldRecursivelyAction extends FoldingAction{constructor(){super({id:"editor.foldRecursively",label:localize2(981,"Fold Recursively"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2140),weight:100}})}invoke(e,t,s){const o=this.getSelectedLines(s);setCollapseStateLevelsDown(t,!0,Number.MAX_VALUE,o)}}class ToggleFoldRecursivelyAction extends FoldingAction{constructor(){super({id:"editor.toggleFoldRecursively",label:localize2(982,"Toggle Fold Recursively"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,3114),weight:100}})}invoke(e,t,s){const o=this.getSelectedLines(s);toggleCollapseState(t,Number.MAX_VALUE,o)}}class FoldAllBlockCommentsAction extends FoldingAction{constructor(){super({id:"editor.foldAllBlockComments",label:localize2(983,"Fold All Block Comments"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2138),weight:100}})}invoke(e,t,s,o,r){if(t.regions.hasTypes())setCollapseStateForType(t,FoldingRangeKind.Comment.value,!0);else{const l=s.getModel();if(!l)return;const c=r.getLanguageConfiguration(l.getLanguageId()).comments;if(c&&c.blockCommentStartToken){const d=new RegExp("^\\s*"+escapeRegExpCharacters(c.blockCommentStartToken));setCollapseStateForMatchingLines(t,d,!0)}}}}class FoldAllRegionsAction extends FoldingAction{constructor(){super({id:"editor.foldAllMarkerRegions",label:localize2(984,"Fold All Regions"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2077),weight:100}})}invoke(e,t,s,o,r){if(t.regions.hasTypes())setCollapseStateForType(t,FoldingRangeKind.Region.value,!0);else{const l=s.getModel();if(!l)return;const c=r.getLanguageConfiguration(l.getLanguageId()).foldingRules;if(c&&c.markers&&c.markers.start){const d=new RegExp(c.markers.start);setCollapseStateForMatchingLines(t,d,!0)}}}}class UnfoldAllRegionsAction extends FoldingAction{constructor(){super({id:"editor.unfoldAllMarkerRegions",label:localize2(985,"Unfold All Regions"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2078),weight:100}})}invoke(e,t,s,o,r){if(t.regions.hasTypes())setCollapseStateForType(t,FoldingRangeKind.Region.value,!1);else{const l=s.getModel();if(!l)return;const c=r.getLanguageConfiguration(l.getLanguageId()).foldingRules;if(c&&c.markers&&c.markers.start){const d=new RegExp(c.markers.start);setCollapseStateForMatchingLines(t,d,!1)}}}}class FoldAllExceptAction extends FoldingAction{constructor(){super({id:"editor.foldAllExcept",label:localize2(986,"Fold All Except Selected"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2136),weight:100}})}invoke(e,t,s){const o=this.getSelectedLines(s);setCollapseStateForRest(t,!0,o)}}class UnfoldAllExceptAction extends FoldingAction{constructor(){super({id:"editor.unfoldAllExcept",label:localize2(987,"Unfold All Except Selected"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2134),weight:100}})}invoke(e,t,s){const o=this.getSelectedLines(s);setCollapseStateForRest(t,!1,o)}}class FoldAllAction extends FoldingAction{constructor(){super({id:"editor.foldAll",label:localize2(988,"Fold All"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2069),weight:100}})}invoke(e,t,s){setCollapseStateLevelsDown(t,!0)}}class UnfoldAllAction extends FoldingAction{constructor(){super({id:"editor.unfoldAll",label:localize2(989,"Unfold All"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2088),weight:100}})}invoke(e,t,s){setCollapseStateLevelsDown(t,!1)}}const li=class li extends FoldingAction{getFoldingLevel(){return parseInt(this.id.substr(li.ID_PREFIX.length))}invoke(e,t,s){setCollapseStateAtLevel(t,this.getFoldingLevel(),!0,this.getSelectedLines(s))}};li.ID_PREFIX="editor.foldLevel",li.ID=e=>li.ID_PREFIX+e;let FoldLevelAction=li;class GotoParentFoldAction extends FoldingAction{constructor(){super({id:"editor.gotoParentFold",label:localize2(990,"Go to Parent Fold"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,weight:100}})}invoke(e,t,s){const o=this.getSelectedLines(s);if(o.length>0){const r=getParentFoldLine(o[0],t);r!==null&&s.setSelection({startLineNumber:r,startColumn:1,endLineNumber:r,endColumn:1})}}}class GotoPreviousFoldAction extends FoldingAction{constructor(){super({id:"editor.gotoPreviousFold",label:localize2(991,"Go to Previous Folding Range"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,weight:100}})}invoke(e,t,s){const o=this.getSelectedLines(s);if(o.length>0){const r=getPreviousFoldLine(o[0],t);r!==null&&s.setSelection({startLineNumber:r,startColumn:1,endLineNumber:r,endColumn:1})}}}class GotoNextFoldAction extends FoldingAction{constructor(){super({id:"editor.gotoNextFold",label:localize2(992,"Go to Next Folding Range"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,weight:100}})}invoke(e,t,s){const o=this.getSelectedLines(s);if(o.length>0){const r=getNextFoldLine(o[0],t);r!==null&&s.setSelection({startLineNumber:r,startColumn:1,endLineNumber:r,endColumn:1})}}}class FoldRangeFromSelectionAction extends FoldingAction{constructor(){super({id:"editor.createFoldingRangeFromSelection",label:localize2(993,"Create Folding Range from Selection"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2135),weight:100}})}invoke(e,t,s){var l;const o=[],r=s.getSelections();if(r){for(const c of r){let d=c.endLineNumber;c.endColumn===1&&--d,d>c.startLineNumber&&(o.push({startLineNumber:c.startLineNumber,endLineNumber:d,type:void 0,isCollapsed:!0,source:1}),s.setSelection({startLineNumber:c.startLineNumber,startColumn:1,endLineNumber:c.startLineNumber,endColumn:1}))}if(o.length>0){o.sort((d,u)=>d.startLineNumber-u.startLineNumber);const c=FoldingRegions.sanitizeAndMerge(t.regions,o,(l=s.getModel())==null?void 0:l.getLineCount());t.updatePost(FoldingRegions.fromFoldRanges(c))}}}}class RemoveFoldRangeFromSelectionAction extends FoldingAction{constructor(){super({id:"editor.removeManualFoldingRanges",label:localize2(994,"Remove Manual Folding Ranges"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2137),weight:100}})}invoke(e,t,s){const o=s.getSelections();if(o){const r=[];for(const l of o){const{startLineNumber:c,endLineNumber:d}=l;r.push(d>=c?{startLineNumber:c,endLineNumber:d}:{endLineNumber:d,startLineNumber:c})}t.removeManualRanges(r),e.triggerFoldingModelChanged()}}}class ToggleImportFoldAction extends FoldingAction{constructor(){super({id:"editor.toggleImportFold",label:localize2(995,"Toggle Import Fold"),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,weight:100}})}async invoke(e,t){const s=[],o=t.regions;for(let r=o.length-1;r>=0;r--)o.getType(r)===FoldingRangeKind.Imports.value&&s.push(o.toRegion(r));t.toggleCollapseState(s),e.triggerFoldingModelChanged()}}registerEditorContribution(FoldingController.ID,FoldingController,0);registerEditorAction(UnfoldAction);registerEditorAction(UnFoldRecursivelyAction);registerEditorAction(FoldAction);registerEditorAction(FoldRecursivelyAction);registerEditorAction(ToggleFoldRecursivelyAction);registerEditorAction(FoldAllAction);registerEditorAction(UnfoldAllAction);registerEditorAction(FoldAllBlockCommentsAction);registerEditorAction(FoldAllRegionsAction);registerEditorAction(UnfoldAllRegionsAction);registerEditorAction(FoldAllExceptAction);registerEditorAction(UnfoldAllExceptAction);registerEditorAction(ToggleFoldAction);registerEditorAction(GotoParentFoldAction);registerEditorAction(GotoPreviousFoldAction);registerEditorAction(GotoNextFoldAction);registerEditorAction(FoldRangeFromSelectionAction);registerEditorAction(RemoveFoldRangeFromSelectionAction);registerEditorAction(ToggleImportFoldAction);for(let a=1;a<=7;a++)registerInstantiatedEditorAction(new FoldLevelAction({id:FoldLevelAction.ID(a),label:localize2(996,"Fold Level {0}",a),precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2048|21+a),weight:100}}));CommandsRegistry.registerCommand("_executeFoldingRangeProvider",async function(a,...e){const[t]=e;if(!(t instanceof URI))throw illegalArgument();const s=a.get(ILanguageFeaturesService),o=a.get(IModelService).getModel(t);if(!o)throw illegalArgument();const r=a.get(IConfigurationService);if(!r.getValue("editor.folding",{resource:t}))return[];const l=a.get(ILanguageConfigurationService),c=r.getValue("editor.foldingStrategy",{resource:t}),d={get limit(){return r.getValue("editor.foldingMaximumRegions",{resource:t})},update:(m,_)=>{}},u=new IndentRangeProvider(o,l,d);let g=u;if(c!=="indentation"){const m=FoldingController.getFoldingRangeProviders(s,o);m.length&&(g=new SyntaxRangeProvider(o,m,()=>{},d,u))}const f=await g.compute(CancellationToken.None),p=[];try{if(f)for(let m=0;m<f.length;m++){const _=f.getType(m);p.push({start:f.getStartLineNumber(m),end:f.getEndLineNumber(m),kind:_?FoldingRangeKind.fromValue(_):void 0})}return p}finally{g.dispose()}});class EditorFontZoomIn extends EditorAction{constructor(){super({id:"editor.action.fontZoomIn",label:localize2(1006,"Increase Editor Font Size"),precondition:void 0})}run(e,t){EditorZoom.setZoomLevel(EditorZoom.getZoomLevel()+1)}}class EditorFontZoomOut extends EditorAction{constructor(){super({id:"editor.action.fontZoomOut",label:localize2(1007,"Decrease Editor Font Size"),precondition:void 0})}run(e,t){EditorZoom.setZoomLevel(EditorZoom.getZoomLevel()-1)}}class EditorFontZoomReset extends EditorAction{constructor(){super({id:"editor.action.fontZoomReset",label:localize2(1008,"Reset Editor Font Size"),precondition:void 0})}run(e,t){EditorZoom.setZoomLevel(0)}}registerEditorAction(EditorFontZoomIn);registerEditorAction(EditorFontZoomOut);registerEditorAction(EditorFontZoomReset);class FormattingEdit{static _handleEolEdits(e,t){let s;const o=[];for(const r of t)typeof r.eol=="number"&&(s=r.eol),r.range&&typeof r.text=="string"&&o.push(r);return typeof s=="number"&&e.hasModel()&&e.getModel().pushEOL(s),o}static _isFullModelReplaceEdit(e,t){if(!e.hasModel())return!1;const s=e.getModel(),o=s.validateRange(t.range);return s.getFullModelRange().equalsRange(o)}static execute(e,t,s){s&&e.pushUndoStop();const o=StableEditorScrollState.capture(e),r=FormattingEdit._handleEolEdits(e,t);r.length===1&&FormattingEdit._isFullModelReplaceEdit(e,r[0])?e.executeEdits("formatEditsCommand",r.map(l=>EditOperation.replace(Range$2.lift(l.range),l.text))):e.executeEdits("formatEditsCommand",r.map(l=>EditOperation.replaceMove(Range$2.lift(l.range),l.text))),s&&e.pushUndoStop(),o.restoreRelativeVerticalPositionOfCursor(e)}}class ExtensionIdentifier{constructor(e){this.value=e,this._lower=e.toLowerCase()}static toKey(e){return typeof e=="string"?e.toLowerCase():e._lower}}class ExtensionIdentifierSet{constructor(e){if(this._set=new Set,e)for(const t of e)this.add(t)}add(e){this._set.add(ExtensionIdentifier.toKey(e))}has(e){return this._set.has(ExtensionIdentifier.toKey(e))}}function getRealAndSyntheticDocumentFormattersOrdered(a,e,t){const s=[],o=new ExtensionIdentifierSet,r=a.ordered(t);for(const c of r)s.push(c),c.extensionId&&o.add(c.extensionId);const l=e.ordered(t);for(const c of l){if(c.extensionId){if(o.has(c.extensionId))continue;o.add(c.extensionId)}s.push({displayName:c.displayName,extensionId:c.extensionId,provideDocumentFormattingEdits(d,u,g){return c.provideDocumentRangeFormattingEdits(d,d.getFullModelRange(),u,g)}})}return s}const vn=class vn{static setFormatterSelector(e){return{dispose:vn._selectors.unshift(e)}}static async select(e,t,s,o){if(e.length===0)return;const r=Iterable.first(vn._selectors);if(r)return await r(e,t,s,o)}};vn._selectors=new LinkedList;let FormattingConflicts=vn;async function formatDocumentRangesWithSelectedProvider(a,e,t,s,o,r,l){const c=a.get(IInstantiationService),{documentRangeFormattingEditProvider:d}=a.get(ILanguageFeaturesService),u=isCodeEditor(e)?e.getModel():e,g=d.ordered(u),f=await FormattingConflicts.select(g,u,s,2);f&&(o.report(f),await c.invokeFunction(formatDocumentRangesWithProvider,f,e,t,r,l))}async function formatDocumentRangesWithProvider(a,e,t,s,o,r){var v,S;const l=a.get(IEditorWorkerService),c=a.get(ILogService),d=a.get(IAccessibilitySignalService);let u,g;isCodeEditor(t)?(u=t.getModel(),g=new EditorStateCancellationTokenSource(t,5,void 0,o)):(u=t,g=new TextModelCancellationTokenSource(t,o));const f=[];let p=0;for(const y of asArray(s).sort(Range$2.compareRangesUsingStarts))p>0&&Range$2.areIntersectingOrTouching(f[p-1],y)?f[p-1]=Range$2.fromPositions(f[p-1].getStartPosition(),y.getEndPosition()):p=f.push(y);const m=async y=>{var L,x;c.trace("[format][provideDocumentRangeFormattingEdits] (request)",(L=e.extensionId)==null?void 0:L.value,y);const w=await e.provideDocumentRangeFormattingEdits(u,y,u.getFormattingOptions(),g.token)||[];return c.trace("[format][provideDocumentRangeFormattingEdits] (response)",(x=e.extensionId)==null?void 0:x.value,w),w},_=(y,w)=>{if(!y.length||!w.length)return!1;const L=y.reduce((x,E)=>Range$2.plusRange(x,E.range),y[0].range);if(!w.some(x=>Range$2.intersectRanges(L,x.range)))return!1;for(const x of y)for(const E of w)if(Range$2.intersectRanges(x.range,E.range))return!0;return!1},C=[],b=[];try{if(typeof e.provideDocumentRangesFormattingEdits=="function"){c.trace("[format][provideDocumentRangeFormattingEdits] (request)",(v=e.extensionId)==null?void 0:v.value,f);const y=await e.provideDocumentRangesFormattingEdits(u,f,u.getFormattingOptions(),g.token)||[];c.trace("[format][provideDocumentRangeFormattingEdits] (response)",(S=e.extensionId)==null?void 0:S.value,y),b.push(y)}else{for(const y of f){if(g.token.isCancellationRequested)return!0;b.push(await m(y))}for(let y=0;y<f.length;++y)for(let w=y+1;w<f.length;++w){if(g.token.isCancellationRequested)return!0;if(_(b[y],b[w])){const L=Range$2.plusRange(f[y],f[w]),x=await m(L);f.splice(w,1),f.splice(y,1),f.push(L),b.splice(w,1),b.splice(y,1),b.push(x),y=0,w=0}}}for(const y of b){if(g.token.isCancellationRequested)return!0;const w=await l.computeMoreMinimalEdits(u.uri,y);w&&C.push(...w)}if(g.token.isCancellationRequested)return!0}finally{g.dispose()}if(C.length===0)return!1;if(isCodeEditor(t))FormattingEdit.execute(t,C,!0),t.revealPositionInCenterIfOutsideViewport(t.getPosition(),1);else{const[{range:y}]=C,w=new Selection$1(y.startLineNumber,y.startColumn,y.endLineNumber,y.endColumn);u.pushEditOperations([w],C.map(L=>({text:L.text,range:Range$2.lift(L.range),forceMoveMarkers:!0})),L=>{for(const{range:x}of L)if(Range$2.areIntersectingOrTouching(x,w))return[new Selection$1(x.startLineNumber,x.startColumn,x.endLineNumber,x.endColumn)];return null})}return d.playSignal(AccessibilitySignal.format,{userGesture:r}),!0}async function formatDocumentWithSelectedProvider(a,e,t,s,o,r){const l=a.get(IInstantiationService),c=a.get(ILanguageFeaturesService),d=isCodeEditor(e)?e.getModel():e,u=getRealAndSyntheticDocumentFormattersOrdered(c.documentFormattingEditProvider,c.documentRangeFormattingEditProvider,d),g=await FormattingConflicts.select(u,d,t,1);g&&(s.report(g),await l.invokeFunction(formatDocumentWithProvider,g,e,t,o,r))}async function formatDocumentWithProvider(a,e,t,s,o,r){const l=a.get(IEditorWorkerService),c=a.get(IAccessibilitySignalService);let d,u;isCodeEditor(t)?(d=t.getModel(),u=new EditorStateCancellationTokenSource(t,5,void 0,o)):(d=t,u=new TextModelCancellationTokenSource(t,o));let g;try{const f=await e.provideDocumentFormattingEdits(d,d.getFormattingOptions(),u.token);if(g=await l.computeMoreMinimalEdits(d.uri,f),u.token.isCancellationRequested)return!0}finally{u.dispose()}if(!g||g.length===0)return!1;if(isCodeEditor(t))FormattingEdit.execute(t,g,s!==2),s!==2&&t.revealPositionInCenterIfOutsideViewport(t.getPosition(),1);else{const[{range:f}]=g,p=new Selection$1(f.startLineNumber,f.startColumn,f.endLineNumber,f.endColumn);d.pushEditOperations([p],g.map(m=>({text:m.text,range:Range$2.lift(m.range),forceMoveMarkers:!0})),m=>{for(const{range:_}of m)if(Range$2.areIntersectingOrTouching(_,p))return[new Selection$1(_.startLineNumber,_.startColumn,_.endLineNumber,_.endColumn)];return null})}return c.playSignal(AccessibilitySignal.format,{userGesture:r}),!0}async function getDocumentRangeFormattingEditsUntilResult(a,e,t,s,o,r){const l=e.documentRangeFormattingEditProvider.ordered(t);for(const c of l){const d=await Promise.resolve(c.provideDocumentRangeFormattingEdits(t,s,o,r)).catch(onUnexpectedExternalError);if(isNonEmptyArray(d))return await a.computeMoreMinimalEdits(t.uri,d)}}async function getDocumentFormattingEditsUntilResult(a,e,t,s,o){const r=getRealAndSyntheticDocumentFormattersOrdered(e.documentFormattingEditProvider,e.documentRangeFormattingEditProvider,t);for(const l of r){const c=await Promise.resolve(l.provideDocumentFormattingEdits(t,s,o)).catch(onUnexpectedExternalError);if(isNonEmptyArray(c))return await a.computeMoreMinimalEdits(t.uri,c)}}function getOnTypeFormattingEdits(a,e,t,s,o,r,l){const c=e.onTypeFormattingEditProvider.ordered(t);return c.length===0||c[0].autoFormatTriggerCharacters.indexOf(o)<0?Promise.resolve(void 0):Promise.resolve(c[0].provideOnTypeFormattingEdits(t,s,o,r,l)).catch(onUnexpectedExternalError).then(d=>a.computeMoreMinimalEdits(t.uri,d))}CommandsRegistry.registerCommand("_executeFormatRangeProvider",async function(a,...e){const[t,s,o]=e;assertType(URI.isUri(t)),assertType(Range$2.isIRange(s));const r=a.get(ITextModelService),l=a.get(IEditorWorkerService),c=a.get(ILanguageFeaturesService),d=await r.createModelReference(t);try{return getDocumentRangeFormattingEditsUntilResult(l,c,d.object.textEditorModel,Range$2.lift(s),o,CancellationToken.None)}finally{d.dispose()}});CommandsRegistry.registerCommand("_executeFormatDocumentProvider",async function(a,...e){const[t,s]=e;assertType(URI.isUri(t));const o=a.get(ITextModelService),r=a.get(IEditorWorkerService),l=a.get(ILanguageFeaturesService),c=await o.createModelReference(t);try{return getDocumentFormattingEditsUntilResult(r,l,c.object.textEditorModel,s,CancellationToken.None)}finally{c.dispose()}});CommandsRegistry.registerCommand("_executeFormatOnTypeProvider",async function(a,...e){const[t,s,o,r]=e;assertType(URI.isUri(t)),assertType(Position$1.isIPosition(s)),assertType(typeof o=="string");const l=a.get(ITextModelService),c=a.get(IEditorWorkerService),d=a.get(ILanguageFeaturesService),u=await l.createModelReference(t);try{return getOnTypeFormattingEdits(c,d,u.object.textEditorModel,Position$1.lift(s),o,r,CancellationToken.None)}finally{u.dispose()}});var __decorate$1B=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1A=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},Mn;let FormatOnType=(Mn=class{constructor(e,t,s,o){this._editor=e,this._languageFeaturesService=t,this._workerService=s,this._accessibilitySignalService=o,this._disposables=new DisposableStore,this._sessionDisposables=new DisposableStore,this._disposables.add(t.onTypeFormattingEditProvider.onDidChange(this._update,this)),this._disposables.add(e.onDidChangeModel(()=>this._update())),this._disposables.add(e.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(e.onDidChangeConfiguration(r=>{r.hasChanged(65)&&this._update()})),this._update()}dispose(){this._disposables.dispose(),this._sessionDisposables.dispose()}_update(){if(this._sessionDisposables.clear(),!this._editor.getOption(65)||!this._editor.hasModel())return;const e=this._editor.getModel(),[t]=this._languageFeaturesService.onTypeFormattingEditProvider.ordered(e);if(!t||!t.autoFormatTriggerCharacters)return;const s=new CharacterSet;for(const o of t.autoFormatTriggerCharacters)s.add(o.charCodeAt(0));this._sessionDisposables.add(this._editor.onDidType(o=>{const r=o.charCodeAt(o.length-1);s.has(r)&&this._trigger(String.fromCharCode(r))}))}_trigger(e){if(!this._editor.hasModel()||this._editor.getSelections().length>1||!this._editor.getSelection().isEmpty())return;const t=this._editor.getModel(),s=this._editor.getPosition(),o=new CancellationTokenSource$1,r=this._editor.onDidChangeModelContent(l=>{if(l.isFlush){o.cancel(),r.dispose();return}for(let c=0,d=l.changes.length;c<d;c++)if(l.changes[c].range.endLineNumber<=s.lineNumber){o.cancel(),r.dispose();return}});getOnTypeFormattingEdits(this._workerService,this._languageFeaturesService,t,s,e,t.getFormattingOptions(),o.token).then(l=>{o.token.isCancellationRequested||isNonEmptyArray(l)&&(this._accessibilitySignalService.playSignal(AccessibilitySignal.format,{userGesture:!1}),FormattingEdit.execute(this._editor,l,!0))}).finally(()=>{r.dispose()})}},Mn.ID="editor.contrib.autoFormat",Mn);FormatOnType=__decorate$1B([__param$1A(1,ILanguageFeaturesService),__param$1A(2,IEditorWorkerService),__param$1A(3,IAccessibilitySignalService)],FormatOnType);var An;let FormatOnPaste=(An=class{constructor(e,t,s){this.editor=e,this._languageFeaturesService=t,this._instantiationService=s,this._callOnDispose=new DisposableStore,this._callOnModel=new DisposableStore,this._callOnDispose.add(e.onDidChangeConfiguration(()=>this._update())),this._callOnDispose.add(e.onDidChangeModel(()=>this._update())),this._callOnDispose.add(e.onDidChangeModelLanguage(()=>this._update())),this._callOnDispose.add(t.documentRangeFormattingEditProvider.onDidChange(this._update,this))}dispose(){this._callOnDispose.dispose(),this._callOnModel.dispose()}_update(){this._callOnModel.clear(),this.editor.getOption(64)&&this.editor.hasModel()&&this._languageFeaturesService.documentRangeFormattingEditProvider.has(this.editor.getModel())&&this._callOnModel.add(this.editor.onDidPaste(({range:e})=>this._trigger(e)))}_trigger(e){this.editor.hasModel()&&(this.editor.getSelections().length>1||this._instantiationService.invokeFunction(formatDocumentRangesWithSelectedProvider,this.editor,e,2,Progress.None,CancellationToken.None,!1).catch(onUnexpectedError))}},An.ID="editor.contrib.formatOnPaste",An);FormatOnPaste=__decorate$1B([__param$1A(1,ILanguageFeaturesService),__param$1A(2,IInstantiationService)],FormatOnPaste);class FormatDocumentAction extends EditorAction{constructor(){super({id:"editor.action.formatDocument",label:localize2(1009,"Format Document"),precondition:ContextKeyExpr.and(EditorContextKeys.notInCompositeEditor,EditorContextKeys.writable,EditorContextKeys.hasDocumentFormattingProvider),kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1572,linux:{primary:3111},weight:100},contextMenuOpts:{group:"1_modification",order:1.3}})}async run(e,t){if(t.hasModel()){const s=e.get(IInstantiationService);await e.get(IEditorProgressService).showWhile(s.invokeFunction(formatDocumentWithSelectedProvider,t,1,Progress.None,CancellationToken.None,!0),250)}}}class FormatSelectionAction extends EditorAction{constructor(){super({id:"editor.action.formatSelection",label:localize2(1010,"Format Selection"),precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasDocumentSelectionFormattingProvider),kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2084),weight:100},contextMenuOpts:{when:EditorContextKeys.hasNonEmptySelection,group:"1_modification",order:1.31}})}async run(e,t){if(!t.hasModel())return;const s=e.get(IInstantiationService),o=t.getModel(),r=t.getSelections().map(c=>c.isEmpty()?new Range$2(c.startLineNumber,1,c.startLineNumber,o.getLineMaxColumn(c.startLineNumber)):c);await e.get(IEditorProgressService).showWhile(s.invokeFunction(formatDocumentRangesWithSelectedProvider,t,r,1,Progress.None,CancellationToken.None,!0),250)}}registerEditorContribution(FormatOnType.ID,FormatOnType,2);registerEditorContribution(FormatOnPaste.ID,FormatOnPaste,2);registerEditorAction(FormatDocumentAction);registerEditorAction(FormatSelectionAction);CommandsRegistry.registerCommand("editor.action.format",async a=>{const e=a.get(ICodeEditorService).getFocusedCodeEditor();if(!e||!e.hasModel())return;const t=a.get(ICommandService);e.getSelection().isEmpty()?await t.executeCommand("editor.action.formatDocument"):await t.executeCommand("editor.action.formatSelection")});var __decorate$1A=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1z=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class TreeElement{remove(){var e;(e=this.parent)==null||e.children.delete(this.id)}static findId(e,t){let s;typeof e=="string"?s=`${t.id}/${e}`:(s=`${t.id}/${e.name}`,t.children.get(s)!==void 0&&(s=`${t.id}/${e.name}_${e.range.startLineNumber}_${e.range.startColumn}`));let o=s;for(let r=0;t.children.get(o)!==void 0;r++)o=`${s}_${r}`;return o}static empty(e){return e.children.size===0}}class OutlineElement extends TreeElement{constructor(e,t,s){super(),this.id=e,this.parent=t,this.symbol=s,this.children=new Map}}class OutlineGroup extends TreeElement{constructor(e,t,s,o){super(),this.id=e,this.parent=t,this.label=s,this.order=o,this.children=new Map}}class OutlineModel extends TreeElement{static create(e,t,s){const o=new CancellationTokenSource$1(s),r=new OutlineModel(t.uri),l=e.ordered(t),c=l.map((u,g)=>{const f=TreeElement.findId(`provider_${g}`,r),p=new OutlineGroup(f,r,u.displayName??"Unknown Outline Provider",g);return Promise.resolve(u.provideDocumentSymbols(t,o.token)).then(m=>{for(const _ of m||[])OutlineModel._makeOutlineElement(_,p);return p},m=>(onUnexpectedExternalError(m),p)).then(m=>{TreeElement.empty(m)?m.remove():r._groups.set(f,m)})}),d=e.onDidChange(()=>{const u=e.ordered(t);equals$1(u,l)||o.cancel()});return Promise.all(c).then(()=>o.token.isCancellationRequested&&!s.isCancellationRequested?OutlineModel.create(e,t,s):r._compact()).finally(()=>{o.dispose(),d.dispose(),o.dispose()})}static _makeOutlineElement(e,t){const s=TreeElement.findId(e,t),o=new OutlineElement(s,t,e);if(e.children)for(const r of e.children)OutlineModel._makeOutlineElement(r,o);t.children.set(o.id,o)}constructor(e){super(),this.uri=e,this.id="root",this.parent=void 0,this._groups=new Map,this.children=new Map,this.id="root",this.parent=void 0}_compact(){let e=0;for(const[t,s]of this._groups)s.children.size===0?this._groups.delete(t):e+=1;if(e!==1)this.children=this._groups;else{const t=Iterable.first(this._groups.values());for(const[,s]of t.children)s.parent=this,this.children.set(s.id,s)}return this}getTopLevelSymbols(){const e=[];for(const t of this.children.values())t instanceof OutlineElement?e.push(t.symbol):e.push(...Iterable.map(t.children.values(),s=>s.symbol));return e.sort((t,s)=>Range$2.compareRangesUsingStarts(t.range,s.range))}asListOfDocumentSymbols(){const e=this.getTopLevelSymbols(),t=[];return OutlineModel._flattenDocumentSymbols(t,e,""),t.sort((s,o)=>Position$1.compare(Range$2.getStartPosition(s.range),Range$2.getStartPosition(o.range))||Position$1.compare(Range$2.getEndPosition(o.range),Range$2.getEndPosition(s.range)))}static _flattenDocumentSymbols(e,t,s){for(const o of t)e.push({kind:o.kind,tags:o.tags,name:o.name,detail:o.detail,containerName:o.containerName||s,range:o.range,selectionRange:o.selectionRange,children:void 0}),o.children&&OutlineModel._flattenDocumentSymbols(e,o.children,o.name)}}const IOutlineModelService=createDecorator("IOutlineModelService");let OutlineModelService=class{constructor(e,t,s){this._languageFeaturesService=e,this._disposables=new DisposableStore,this._cache=new LRUCache(15,.7),this._debounceInformation=t.for(e.documentSymbolProvider,"DocumentSymbols",{min:350}),this._disposables.add(s.onModelRemoved(o=>{this._cache.delete(o.id)}))}dispose(){this._disposables.dispose()}async getOrCreate(e,t){const s=this._languageFeaturesService.documentSymbolProvider,o=s.ordered(e);let r=this._cache.get(e.id);if(!r||r.versionId!==e.getVersionId()||!equals$1(r.provider,o)){const c=new CancellationTokenSource$1;r={versionId:e.getVersionId(),provider:o,promiseCnt:0,source:c,promise:OutlineModel.create(s,e,c.token),model:void 0},this._cache.set(e.id,r);const d=Date.now();r.promise.then(u=>{r.model=u,this._debounceInformation.update(e,Date.now()-d)}).catch(u=>{this._cache.delete(e.id)})}if(r.model)return r.model;r.promiseCnt+=1;const l=t.onCancellationRequested(()=>{--r.promiseCnt===0&&(r.source.cancel(),this._cache.delete(e.id))});try{return await r.promise}finally{l.dispose()}}};OutlineModelService=__decorate$1A([__param$1z(0,ILanguageFeaturesService),__param$1z(1,ILanguageFeatureDebounceService),__param$1z(2,IModelService)],OutlineModelService);registerSingleton(IOutlineModelService,OutlineModelService,1);CommandsRegistry.registerCommand("_executeDocumentSymbolProvider",async function(a,...e){const[t]=e;assertType(URI.isUri(t));const s=a.get(IOutlineModelService),r=await a.get(ITextModelService).createModelReference(t);try{return(await s.getOrCreate(r.object.textEditorModel,CancellationToken.None)).getTopLevelSymbols()}finally{r.dispose()}});const AccessibleViewRegistry=new class{constructor(){this._implementations=[]}register(e){return this._implementations.push(e),{dispose:()=>{const t=this._implementations.indexOf(e);t!==-1&&this._implementations.splice(t,1)}}}getImplementations(){return this._implementations}};var __decorate$1z=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1y=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};function hotClassGetOriginalInstance(a){return a instanceof BaseClass$1?a._instance:a}let BaseClass$1=class{constructor(e){this.instantiationService=e}init(...e){}};function wrapInHotClass1(a){return a.get()}let BaseClass1$1=class extends BaseClass$1{constructor(e,t){super(t),this.init(e)}};BaseClass1$1=__decorate$1z([__param$1y(1,IInstantiationService)],BaseClass1$1);const Context$2={Visible:historyNavigationVisible,HasFocusedSuggestion:new RawContextKey("suggestWidgetHasFocusedSuggestion",!1,localize(1440,"Whether any suggestion is focused")),DetailsVisible:new RawContextKey("suggestWidgetDetailsVisible",!1,localize(1441,"Whether suggestion details are visible")),MultipleSuggestions:new RawContextKey("suggestWidgetMultipleSuggestions",!1,localize(1442,"Whether there are multiple suggestions to pick from")),MakesTextEdit:new RawContextKey("suggestionMakesTextEdit",!0,localize(1443,"Whether inserting the current suggestion yields in a change or has everything already been typed")),AcceptSuggestionsOnEnter:new RawContextKey("acceptSuggestionOnEnter",!0,localize(1444,"Whether suggestions are inserted when pressing Enter")),HasInsertAndReplaceRange:new RawContextKey("suggestionHasInsertAndReplaceRange",!1,localize(1445,"Whether the current suggestion has insert and replace behaviour")),InsertMode:new RawContextKey("suggestionInsertMode",void 0,{type:"string",description:localize(1446,"Whether the default behaviour is to insert or replace")}),CanResolve:new RawContextKey("suggestionCanResolve",!1,localize(1447,"Whether the current suggestion supports to resolve further details"))},suggestWidgetStatusbarMenu=new MenuId("suggestWidgetStatusBar");class CompletionItem{constructor(e,t,s,o){var r;this.position=e,this.completion=t,this.container=s,this.provider=o,this.isInvalid=!1,this.score=FuzzyScore.Default,this.distance=0,this.textLabel=typeof t.label=="string"?t.label:(r=t.label)==null?void 0:r.label,this.labelLow=this.textLabel.toLowerCase(),this.isInvalid=!this.textLabel,this.sortTextLow=t.sortText&&t.sortText.toLowerCase(),this.filterTextLow=t.filterText&&t.filterText.toLowerCase(),this.extensionId=t.extensionId,Range$2.isIRange(t.range)?(this.editStart=new Position$1(t.range.startLineNumber,t.range.startColumn),this.editInsertEnd=new Position$1(t.range.endLineNumber,t.range.endColumn),this.editReplaceEnd=new Position$1(t.range.endLineNumber,t.range.endColumn),this.isInvalid=this.isInvalid||Range$2.spansMultipleLines(t.range)||t.range.startLineNumber!==e.lineNumber):(this.editStart=new Position$1(t.range.insert.startLineNumber,t.range.insert.startColumn),this.editInsertEnd=new Position$1(t.range.insert.endLineNumber,t.range.insert.endColumn),this.editReplaceEnd=new Position$1(t.range.replace.endLineNumber,t.range.replace.endColumn),this.isInvalid=this.isInvalid||Range$2.spansMultipleLines(t.range.insert)||Range$2.spansMultipleLines(t.range.replace)||t.range.insert.startLineNumber!==e.lineNumber||t.range.replace.startLineNumber!==e.lineNumber||t.range.insert.startColumn!==t.range.replace.startColumn),typeof o.resolveCompletionItem!="function"&&(this._resolveCache=Promise.resolve(),this._resolveDuration=0)}get isResolved(){return this._resolveDuration!==void 0}get resolveDuration(){return this._resolveDuration!==void 0?this._resolveDuration:-1}async resolve(e){if(!this._resolveCache){const t=e.onCancellationRequested(()=>{this._resolveCache=void 0,this._resolveDuration=void 0}),s=new StopWatch(!0);this._resolveCache=Promise.resolve(this.provider.resolveCompletionItem(this.completion,e)).then(o=>{Object.assign(this.completion,o),this._resolveDuration=s.elapsed()},o=>{isCancellationError(o)&&(this._resolveCache=void 0,this._resolveDuration=void 0)}).finally(()=>{t.dispose()})}return this._resolveCache}}const Bs=class Bs{constructor(e=2,t=new Set,s=new Set,o=new Map,r=!0){this.snippetSortOrder=e,this.kindFilter=t,this.providerFilter=s,this.providerItemsToReuse=o,this.showDeprecated=r}};Bs.default=new Bs;let CompletionOptions=Bs;class CompletionItemModel{constructor(e,t,s,o){this.items=e,this.needsClipboard=t,this.durations=s,this.disposable=o}}async function provideSuggestionItems(a,e,t,s=CompletionOptions.default,o={triggerKind:0},r=CancellationToken.None){const l=new StopWatch;t=t.clone();const c=e.getWordAtPosition(t),d=c?new Range$2(t.lineNumber,c.startColumn,t.lineNumber,c.endColumn):Range$2.fromPositions(t),u={replace:d,insert:d.setEndPosition(t.lineNumber,t.column)},g=[],f=new DisposableStore,p=[];let m=!1;const _=(b,v,S)=>{var w;let y=!1;if(!v)return y;for(const L of v.suggestions)if(!s.kindFilter.has(L.kind)){if(!s.showDeprecated&&((w=L==null?void 0:L.tags)!=null&&w.includes(1)))continue;L.range||(L.range=u),L.sortText||(L.sortText=typeof L.label=="string"?L.label:L.label.label),!m&&L.insertTextRules&&L.insertTextRules&4&&(m=SnippetParser.guessNeedsClipboard(L.insertText)),g.push(new CompletionItem(t,L,v,b)),y=!0}return isDisposable(v)&&f.add(v),p.push({providerName:b._debugDisplayName??"unknown_provider",elapsedProvider:v.duration??-1,elapsedOverall:S.elapsed()}),y},C=(async()=>{})();for(const b of a.orderedGroups(e)){let v=!1;if(await Promise.all(b.map(async S=>{if(s.providerItemsToReuse.has(S)){const y=s.providerItemsToReuse.get(S);y.forEach(w=>g.push(w)),v=v||y.length>0;return}if(!(s.providerFilter.size>0&&!s.providerFilter.has(S)))try{const y=new StopWatch,w=await S.provideCompletionItems(e,t,o,r);v=_(S,w,y)||v}catch(y){onUnexpectedExternalError(y)}})),v||r.isCancellationRequested)break}return await C,r.isCancellationRequested?(f.dispose(),Promise.reject(new CancellationError)):new CompletionItemModel(g.sort(getSuggestionComparator(s.snippetSortOrder)),m,{entries:p,elapsed:l.elapsed()},f)}function defaultComparator(a,e){if(a.sortTextLow&&e.sortTextLow){if(a.sortTextLow<e.sortTextLow)return-1;if(a.sortTextLow>e.sortTextLow)return 1}return a.textLabel<e.textLabel?-1:a.textLabel>e.textLabel?1:a.completion.kind-e.completion.kind}function snippetUpComparator(a,e){if(a.completion.kind!==e.completion.kind){if(a.completion.kind===28)return-1;if(e.completion.kind===28)return 1}return defaultComparator(a,e)}function snippetDownComparator(a,e){if(a.completion.kind!==e.completion.kind){if(a.completion.kind===28)return 1;if(e.completion.kind===28)return-1}return defaultComparator(a,e)}const _snippetComparators=new Map;_snippetComparators.set(0,snippetUpComparator);_snippetComparators.set(2,snippetDownComparator);_snippetComparators.set(1,defaultComparator);function getSuggestionComparator(a){return _snippetComparators.get(a)}CommandsRegistry.registerCommand("_executeCompletionItemProvider",async(a,...e)=>{const[t,s,o,r]=e;assertType(URI.isUri(t)),assertType(Position$1.isIPosition(s)),assertType(typeof o=="string"||!o),assertType(typeof r=="number"||!r);const{completionProvider:l}=a.get(ILanguageFeaturesService),c=await a.get(ITextModelService).createModelReference(t);try{const d={incomplete:!1,suggestions:[]},u=[],g=c.object.textEditorModel.validatePosition(s),f=await provideSuggestionItems(l,c.object.textEditorModel,g,void 0,{triggerCharacter:o??void 0,triggerKind:o?1:0});for(const p of f.items)u.length<(r??0)&&u.push(p.resolve(CancellationToken.None)),d.incomplete=d.incomplete||p.container.incomplete,d.suggestions.push(p.completion);try{return await Promise.all(u),d}finally{setTimeout(()=>f.disposable.dispose(),100)}}finally{c.dispose()}});function showSimpleSuggestions(a,e){var t;(t=a.getContribution("editor.contrib.suggestController"))==null||t.triggerSuggest(new Set().add(e),void 0,!0)}class QuickSuggestionsOptions{static isAllOff(e){return e.other==="off"&&e.comments==="off"&&e.strings==="off"}static isAllOn(e){return e.other==="on"&&e.comments==="on"&&e.strings==="on"}static valueFor(e,t){switch(t){case 1:return e.comments;case 2:return e.strings;default:return e.other}}}const ve=class ve{};ve.inlineSuggestionVisible=new RawContextKey("inlineSuggestionVisible",!1,localize(1184,"Whether an inline suggestion is visible")),ve.inlineSuggestionHasIndentation=new RawContextKey("inlineSuggestionHasIndentation",!1,localize(1185,"Whether the inline suggestion starts with whitespace")),ve.inlineSuggestionHasIndentationLessThanTabSize=new RawContextKey("inlineSuggestionHasIndentationLessThanTabSize",!0,localize(1186,"Whether the inline suggestion starts with whitespace that is less than what would be inserted by tab")),ve.suppressSuggestions=new RawContextKey("inlineSuggestionSuppressSuggestions",void 0,localize(1187,"Whether suggestions should be suppressed for the current suggestion")),ve.cursorBeforeGhostText=new RawContextKey("cursorBeforeGhostText",!1,localize(1188,"Whether the cursor is at ghost text")),ve.cursorInIndentation=new RawContextKey("cursorInIndentation",!1,localize(1189,"Whether the cursor is in indentation")),ve.hasSelection=new RawContextKey("editor.hasSelection",!1,localize(1190,"Whether the editor has a selection")),ve.cursorAtInlineEdit=new RawContextKey("cursorAtInlineEdit",!1,localize(1191,"Whether the cursor is at an inline edit")),ve.inlineEditVisible=new RawContextKey("inlineEditIsVisible",!1,localize(1192,"Whether an inline edit is visible")),ve.tabShouldJumpToInlineEdit=new RawContextKey("tabShouldJumpToInlineEdit",!1,localize(1193,"Whether tab should jump to an inline edit.")),ve.tabShouldAcceptInlineEdit=new RawContextKey("tabShouldAcceptInlineEdit",!1,localize(1194,"Whether tab should accept the inline edit.")),ve.inInlineEditsPreviewEditor=new RawContextKey("inInlineEditsPreviewEditor",!0,localize(1195,"Whether the current code editor is showing an inline edits preview"));let InlineCompletionContextKeys=ve;const IDataChannelService=createDecorator("dataChannelService");class NullDataChannelService{getDataChannel(e){return{sendData:()=>{}}}}var __decorate$1y=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1x=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};function formatRecordableLogEntry(a){var e;return a.sourceId+" @@ "+JSON.stringify({...a,modelUri:(e=a.modelUri)==null?void 0:e.toString(),sourceId:void 0})}let StructuredLogger=class extends Disposable{static cast(){return this}constructor(e,t,s){super(),this._key=e,this._contextKeyService=t,this._dataChannelService=s,this._isEnabledContextKeyValue=observableContextKey("structuredLogger.enabled:"+this._key,this._contextKeyService).recomputeInitiallyAndOnChange(this._store),this.isEnabled=this._isEnabledContextKeyValue.map(o=>o!==void 0)}log(e){return this._isEnabledContextKeyValue.get()?(this._dataChannelService.getDataChannel("structuredLogger:"+this._key).sendData(e),!0):!1}};StructuredLogger=__decorate$1y([__param$1x(1,IContextKeyService),__param$1x(2,IDataChannelService)],StructuredLogger);function observableContextKey(a,e){return observableFromEvent(e.onDidChangeContext,()=>e.getContextKeyValue(a))}var __decorate$1x=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1w=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let TextModelChangeRecorder=class extends Disposable{constructor(e,t,s){var l;super(),this._editor=e,this._instantiationService=t,this._loggerService=s,this._structuredLogger=this._register(this._instantiationService.createInstance(StructuredLogger.cast(),"editor.inlineSuggest.logChangeReason.commandId"));const o=(l=this._loggerService)==null?void 0:l.createLogger("textModelChanges",{hidden:!1,name:"Text Model Changes Reason"}),r=observableFromEvent(this,o.onDidChangeLogLevel,()=>o.getLevel());this._register(autorun(c=>{canLog(r.read(c),LogLevel.Trace)&&c.store.add(this._editor.onDidChangeModelContent(d=>{var u;((u=this._editor.getModel())==null?void 0:u.uri.scheme)!=="output"&&o.trace("onDidChangeModelContent: "+d.detailedReasons.map(g=>g.toKey(Number.MAX_VALUE)).join(", "))}))})),this._register(autorun(c=>{this._editor instanceof CodeEditorWidget&&this._structuredLogger.isEnabled.read(c)&&c.store.add(this._editor.onDidChangeModelContent(d=>{const u=this._editor.getModel();if(!u)return;const g=d.detailedReasons[0],f={...g.metadata,sourceId:"TextModel.setChangeReason",source:g.metadata.source,time:Date.now(),modelUri:u.uri,modelVersion:u.getVersionId()};setTimeout(()=>{this._structuredLogger.log(f)},0)}))}))}};TextModelChangeRecorder=__decorate$1x([__param$1w(1,IInstantiationService),__param$1w(2,ILoggerService)],TextModelChangeRecorder);const snippetSession="";function normalizeDriveLetter(a,e=isWindows){return hasDriveLetter(a,e)?a.charAt(0).toUpperCase()+a.slice(1):a}var __decorate$1w=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1v=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class CompositeSnippetVariableResolver{constructor(e){this._delegates=e}resolve(e){for(const t of this._delegates){const s=t.resolve(e);if(s!==void 0)return s}}}class SelectionBasedVariableResolver{constructor(e,t,s,o){this._model=e,this._selection=t,this._selectionIdx=s,this._overtypingCapturer=o}resolve(e){const{name:t}=e;if(t==="SELECTION"||t==="TM_SELECTED_TEXT"){let s=this._model.getValueInRange(this._selection)||void 0,o=this._selection.startLineNumber!==this._selection.endLineNumber;if(!s&&this._overtypingCapturer){const r=this._overtypingCapturer.getLastOvertypedInfo(this._selectionIdx);r&&(s=r.value,o=r.multiline)}if(s&&o&&e.snippet){const r=this._model.getLineContent(this._selection.startLineNumber),l=getLeadingWhitespace(r,0,this._selection.startColumn-1);let c=l;e.snippet.walk(u=>u===e?!1:(u instanceof Text&&(c=getLeadingWhitespace(splitLines(u.value).pop())),!0));const d=commonPrefixLength(c,l);s=s.replace(/(\r\n|\r|\n)(.*)/g,(u,g,f)=>`${g}${c.substr(d)}${f}`)}return s}else{if(t==="TM_CURRENT_LINE")return this._model.getLineContent(this._selection.positionLineNumber);if(t==="TM_CURRENT_WORD"){const s=this._model.getWordAtPosition({lineNumber:this._selection.positionLineNumber,column:this._selection.positionColumn});return s&&s.word||void 0}else{if(t==="TM_LINE_INDEX")return String(this._selection.positionLineNumber-1);if(t==="TM_LINE_NUMBER")return String(this._selection.positionLineNumber);if(t==="CURSOR_INDEX")return String(this._selectionIdx);if(t==="CURSOR_NUMBER")return String(this._selectionIdx+1)}}}}class ModelBasedVariableResolver{constructor(e,t){this._labelService=e,this._model=t}resolve(e){const{name:t}=e;if(t==="TM_FILENAME")return basename$1(this._model.uri.fsPath);if(t==="TM_FILENAME_BASE"){const s=basename$1(this._model.uri.fsPath),o=s.lastIndexOf(".");return o<=0?s:s.slice(0,o)}else{if(t==="TM_DIRECTORY")return dirname$1(this._model.uri.fsPath)==="."?"":this._labelService.getUriLabel(dirname(this._model.uri));if(t==="TM_FILEPATH")return this._labelService.getUriLabel(this._model.uri);if(t==="RELATIVE_FILEPATH")return this._labelService.getUriLabel(this._model.uri,{relative:!0,noPrefix:!0})}}}class ClipboardBasedVariableResolver{constructor(e,t,s,o){this._readClipboardText=e,this._selectionIdx=t,this._selectionCount=s,this._spread=o}resolve(e){if(e.name!=="CLIPBOARD")return;const t=this._readClipboardText();if(t){if(this._spread){const s=t.split(/\r\n|\n|\r/).filter(o=>!isFalsyOrWhitespace(o));if(s.length===this._selectionCount)return s[this._selectionIdx]}return t}}}let CommentBasedVariableResolver=class{constructor(e,t,s){this._model=e,this._selection=t,this._languageConfigurationService=s}resolve(e){const{name:t}=e,s=this._model.getLanguageIdAtPosition(this._selection.selectionStartLineNumber,this._selection.selectionStartColumn),o=this._languageConfigurationService.getLanguageConfiguration(s).comments;if(o){if(t==="LINE_COMMENT")return o.lineCommentToken||void 0;if(t==="BLOCK_COMMENT_START")return o.blockCommentStartToken||void 0;if(t==="BLOCK_COMMENT_END")return o.blockCommentEndToken||void 0}}};CommentBasedVariableResolver=__decorate$1w([__param$1v(2,ILanguageConfigurationService)],CommentBasedVariableResolver);const Be=class Be{constructor(){this._date=new Date}resolve(e){const{name:t}=e;if(t==="CURRENT_YEAR")return String(this._date.getFullYear());if(t==="CURRENT_YEAR_SHORT")return String(this._date.getFullYear()).slice(-2);if(t==="CURRENT_MONTH")return String(this._date.getMonth().valueOf()+1).padStart(2,"0");if(t==="CURRENT_DATE")return String(this._date.getDate().valueOf()).padStart(2,"0");if(t==="CURRENT_HOUR")return String(this._date.getHours().valueOf()).padStart(2,"0");if(t==="CURRENT_MINUTE")return String(this._date.getMinutes().valueOf()).padStart(2,"0");if(t==="CURRENT_SECOND")return String(this._date.getSeconds().valueOf()).padStart(2,"0");if(t==="CURRENT_DAY_NAME")return Be.dayNames[this._date.getDay()];if(t==="CURRENT_DAY_NAME_SHORT")return Be.dayNamesShort[this._date.getDay()];if(t==="CURRENT_MONTH_NAME")return Be.monthNames[this._date.getMonth()];if(t==="CURRENT_MONTH_NAME_SHORT")return Be.monthNamesShort[this._date.getMonth()];if(t==="CURRENT_SECONDS_UNIX")return String(Math.floor(this._date.getTime()/1e3));if(t==="CURRENT_TIMEZONE_OFFSET"){const s=this._date.getTimezoneOffset(),o=s>0?"-":"+",r=Math.trunc(Math.abs(s/60)),l=r<10?"0"+r:r,c=Math.abs(s)-r*60,d=c<10?"0"+c:c;return o+l+":"+d}}};Be.dayNames=[localize(1391,"Sunday"),localize(1392,"Monday"),localize(1393,"Tuesday"),localize(1394,"Wednesday"),localize(1395,"Thursday"),localize(1396,"Friday"),localize(1397,"Saturday")],Be.dayNamesShort=[localize(1398,"Sun"),localize(1399,"Mon"),localize(1400,"Tue"),localize(1401,"Wed"),localize(1402,"Thu"),localize(1403,"Fri"),localize(1404,"Sat")],Be.monthNames=[localize(1405,"January"),localize(1406,"February"),localize(1407,"March"),localize(1408,"April"),localize(1409,"May"),localize(1410,"June"),localize(1411,"July"),localize(1412,"August"),localize(1413,"September"),localize(1414,"October"),localize(1415,"November"),localize(1416,"December")],Be.monthNamesShort=[localize(1417,"Jan"),localize(1418,"Feb"),localize(1419,"Mar"),localize(1420,"Apr"),localize(1421,"May"),localize(1422,"Jun"),localize(1423,"Jul"),localize(1424,"Aug"),localize(1425,"Sep"),localize(1426,"Oct"),localize(1427,"Nov"),localize(1428,"Dec")];let TimeBasedVariableResolver=Be;class WorkspaceBasedVariableResolver{constructor(e){this._workspaceService=e}resolve(e){if(!this._workspaceService)return;const t=toWorkspaceIdentifier(this._workspaceService.getWorkspace());if(!isEmptyWorkspaceIdentifier(t)){if(e.name==="WORKSPACE_NAME")return this._resolveWorkspaceName(t);if(e.name==="WORKSPACE_FOLDER")return this._resoveWorkspacePath(t)}}_resolveWorkspaceName(e){if(isSingleFolderWorkspaceIdentifier(e))return basename$1(e.uri.path);let t=basename$1(e.configPath.path);return t.endsWith(WORKSPACE_EXTENSION)&&(t=t.substr(0,t.length-WORKSPACE_EXTENSION.length-1)),t}_resoveWorkspacePath(e){if(isSingleFolderWorkspaceIdentifier(e))return normalizeDriveLetter(e.uri.fsPath);const t=basename$1(e.configPath.path);let s=e.configPath.fsPath;return s.endsWith(t)&&(s=s.substr(0,s.length-t.length-1)),s?normalizeDriveLetter(s):"/"}}class RandomBasedVariableResolver{resolve(e){const{name:t}=e;if(t==="RANDOM")return Math.random().toString().slice(-6);if(t==="RANDOM_HEX")return Math.random().toString(16).slice(-6);if(t==="UUID")return generateUuid()}}var __decorate$1v=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1u=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},SnippetSession_1;const Re=class Re{constructor(e,t,s){this._editor=e,this._snippet=t,this._snippetLineLeadingWhitespace=s,this._offset=-1,this._nestingLevel=1,this._placeholderGroups=groupBy(t.placeholders,Placeholder.compareByIndex),this._placeholderGroupsIdx=-1}initialize(e){this._offset=e.newPosition}dispose(){this._placeholderDecorations&&this._editor.removeDecorations([...this._placeholderDecorations.values()]),this._placeholderGroups.length=0}_initDecorations(){if(this._offset===-1)throw new Error("Snippet not initialized!");if(this._placeholderDecorations)return;this._placeholderDecorations=new Map;const e=this._editor.getModel();this._editor.changeDecorations(t=>{for(const s of this._snippet.placeholders){const o=this._snippet.offset(s),r=this._snippet.fullLen(s),l=Range$2.fromPositions(e.getPositionAt(this._offset+o),e.getPositionAt(this._offset+o+r)),c=s.isFinalTabstop?Re._decor.inactiveFinal:Re._decor.inactive,d=t.addDecoration(l,c);this._placeholderDecorations.set(s,d)}})}move(e){if(!this._editor.hasModel())return[];if(this._initDecorations(),this._placeholderGroupsIdx>=0){const o=[];for(const r of this._placeholderGroups[this._placeholderGroupsIdx])if(r.transform){const l=this._placeholderDecorations.get(r),c=this._editor.getModel().getDecorationRange(l),d=this._editor.getModel().getValueInRange(c),u=r.transform.resolve(d).split(/\r\n|\r|\n/);for(let g=1;g<u.length;g++)u[g]=this._editor.getModel().normalizeIndentation(this._snippetLineLeadingWhitespace+u[g]);o.push(EditOperation.replace(c,u.join(this._editor.getModel().getEOL())))}o.length>0&&this._editor.executeEdits("snippet.placeholderTransform",o)}let t=!1;e===!0&&this._placeholderGroupsIdx<this._placeholderGroups.length-1?(this._placeholderGroupsIdx+=1,t=!0):e===!1&&this._placeholderGroupsIdx>0&&(this._placeholderGroupsIdx-=1,t=!0);const s=this._editor.getModel().changeDecorations(o=>{const r=new Set,l=[];for(const c of this._placeholderGroups[this._placeholderGroupsIdx]){const d=this._placeholderDecorations.get(c),u=this._editor.getModel().getDecorationRange(d);l.push(new Selection$1(u.startLineNumber,u.startColumn,u.endLineNumber,u.endColumn)),t=t&&this._hasPlaceholderBeenCollapsed(c),o.changeDecorationOptions(d,c.isFinalTabstop?Re._decor.activeFinal:Re._decor.active),r.add(c);for(const g of this._snippet.enclosingPlaceholders(c)){const f=this._placeholderDecorations.get(g);o.changeDecorationOptions(f,g.isFinalTabstop?Re._decor.activeFinal:Re._decor.active),r.add(g)}}for(const[c,d]of this._placeholderDecorations)r.has(c)||o.changeDecorationOptions(d,c.isFinalTabstop?Re._decor.inactiveFinal:Re._decor.inactive);return l});return t?this.move(e):s??[]}_hasPlaceholderBeenCollapsed(e){let t=e;for(;t;){if(t instanceof Placeholder){const s=this._placeholderDecorations.get(t);if(this._editor.getModel().getDecorationRange(s).isEmpty()&&t.toString().length>0)return!0}t=t.parent}return!1}get isAtFirstPlaceholder(){return this._placeholderGroupsIdx<=0||this._placeholderGroups.length===0}get isAtLastPlaceholder(){return this._placeholderGroupsIdx===this._placeholderGroups.length-1}get hasPlaceholder(){return this._snippet.placeholders.length>0}get isTrivialSnippet(){if(this._snippet.placeholders.length===0)return!0;if(this._snippet.placeholders.length===1){const[e]=this._snippet.placeholders;if(e.isFinalTabstop&&this._snippet.rightMostDescendant===e)return!0}return!1}computePossibleSelections(){const e=new Map;for(const t of this._placeholderGroups){let s;for(const o of t){if(o.isFinalTabstop)break;s||(s=[],e.set(o.index,s));const r=this._placeholderDecorations.get(o),l=this._editor.getModel().getDecorationRange(r);if(!l){e.delete(o.index);break}s.push(l)}}return e}get activeChoice(){if(!this._placeholderDecorations)return;const e=this._placeholderGroups[this._placeholderGroupsIdx][0];if(!(e!=null&&e.choice))return;const t=this._placeholderDecorations.get(e);if(!t)return;const s=this._editor.getModel().getDecorationRange(t);if(s)return{range:s,choice:e.choice}}get hasChoice(){let e=!1;return this._snippet.walk(t=>(e=t instanceof Choice,!e)),e}merge(e){const t=this._editor.getModel();this._nestingLevel*=10,this._editor.changeDecorations(s=>{for(const o of this._placeholderGroups[this._placeholderGroupsIdx]){const r=e.shift();console.assert(r._offset!==-1),console.assert(!r._placeholderDecorations);const l=r._snippet.placeholderInfo.last.index;for(const d of r._snippet.placeholderInfo.all)d.isFinalTabstop?d.index=o.index+(l+1)/this._nestingLevel:d.index=o.index+d.index/this._nestingLevel;this._snippet.replace(o,r._snippet.children);const c=this._placeholderDecorations.get(o);s.removeDecoration(c),this._placeholderDecorations.delete(o);for(const d of r._snippet.placeholders){const u=r._snippet.offset(d),g=r._snippet.fullLen(d),f=Range$2.fromPositions(t.getPositionAt(r._offset+u),t.getPositionAt(r._offset+u+g)),p=s.addDecoration(f,Re._decor.inactive);this._placeholderDecorations.set(d,p)}}this._placeholderGroups=groupBy(this._snippet.placeholders,Placeholder.compareByIndex)})}};Re._decor={active:ModelDecorationOptions.register({description:"snippet-placeholder-1",stickiness:0,className:"snippet-placeholder"}),inactive:ModelDecorationOptions.register({description:"snippet-placeholder-2",stickiness:1,className:"snippet-placeholder"}),activeFinal:ModelDecorationOptions.register({description:"snippet-placeholder-3",stickiness:1,className:"finish-snippet-placeholder"}),inactiveFinal:ModelDecorationOptions.register({description:"snippet-placeholder-4",stickiness:1,className:"finish-snippet-placeholder"})};let OneSnippet=Re;const _defaultOptions$1={overwriteBefore:0,overwriteAfter:0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0};let SnippetSession=SnippetSession_1=class{static adjustWhitespace(e,t,s,o,r){const l=e.getLineContent(t.lineNumber),c=getLeadingWhitespace(l,0,t.column-1);let d;return o.walk(u=>{if(!(u instanceof Text)||u.parent instanceof Choice||r&&!r.has(u))return!0;const g=u.value.split(/\r\n|\r|\n/);if(s){const p=o.offset(u);if(p===0)g[0]=e.normalizeIndentation(g[0]);else{d=d??o.toString();const m=d.charCodeAt(p-1);(m===10||m===13)&&(g[0]=e.normalizeIndentation(c+g[0]))}for(let m=1;m<g.length;m++)g[m]=e.normalizeIndentation(c+g[m])}const f=g.join(e.getEOL());return f!==u.value&&(u.parent.replace(u,[new Text(f)]),d=void 0),!0}),c}static adjustSelection(e,t,s,o){if(s!==0||o!==0){const{positionLineNumber:r,positionColumn:l}=t,c=l-s,d=l+o,u=e.validateRange({startLineNumber:r,startColumn:c,endLineNumber:r,endColumn:d});t=Selection$1.createWithDirection(u.startLineNumber,u.startColumn,u.endLineNumber,u.endColumn,t.getDirection())}return t}static createEditsAndSnippetsFromSelections(e,t,s,o,r,l,c,d,u){const g=[],f=[];if(!e.hasModel())return{edits:g,snippets:f};const p=e.getModel(),m=e.invokeWithinContext(w=>w.get(IWorkspaceContextService)),_=e.invokeWithinContext(w=>new ModelBasedVariableResolver(w.get(ILabelService),p)),C=()=>c,b=p.getValueInRange(SnippetSession_1.adjustSelection(p,e.getSelection(),s,0)),v=p.getValueInRange(SnippetSession_1.adjustSelection(p,e.getSelection(),0,o)),S=p.getLineFirstNonWhitespaceColumn(e.getSelection().positionLineNumber),y=e.getSelections().map((w,L)=>({selection:w,idx:L})).sort((w,L)=>Range$2.compareRangesUsingStarts(w.selection,L.selection));for(const{selection:w,idx:L}of y){let x=SnippetSession_1.adjustSelection(p,w,s,0),E=SnippetSession_1.adjustSelection(p,w,0,o);b!==p.getValueInRange(x)&&(x=w),v!==p.getValueInRange(E)&&(E=w);const I=w.setStartPosition(x.startLineNumber,x.startColumn).setEndPosition(E.endLineNumber,E.endColumn),D=new SnippetParser().parse(t,!0,r),k=I.getStartPosition(),N=SnippetSession_1.adjustWhitespace(p,k,l||L>0&&S!==p.getLineFirstNonWhitespaceColumn(w.positionLineNumber),D);D.resolveVariables(new CompositeSnippetVariableResolver([_,new ClipboardBasedVariableResolver(C,L,y.length,e.getOption(88)==="spread"),new SelectionBasedVariableResolver(p,w,L,d),new CommentBasedVariableResolver(p,w,u),new TimeBasedVariableResolver,new WorkspaceBasedVariableResolver(m),new RandomBasedVariableResolver])),g[L]=EditOperation.replace(I,D.toString()),g[L].identifier={major:L,minor:0},g[L]._isTracked=!0,f[L]=new OneSnippet(e,D,N)}return{edits:g,snippets:f}}static createEditsAndSnippetsFromEdits(e,t,s,o,r,l,c){if(!e.hasModel()||t.length===0)return{edits:[],snippets:[]};const d=[],u=e.getModel(),g=new SnippetParser,f=new TextmateSnippet,p=new CompositeSnippetVariableResolver([e.invokeWithinContext(_=>new ModelBasedVariableResolver(_.get(ILabelService),u)),new ClipboardBasedVariableResolver(()=>r,0,e.getSelections().length,e.getOption(88)==="spread"),new SelectionBasedVariableResolver(u,e.getSelection(),0,l),new CommentBasedVariableResolver(u,e.getSelection(),c),new TimeBasedVariableResolver,new WorkspaceBasedVariableResolver(e.invokeWithinContext(_=>_.get(IWorkspaceContextService))),new RandomBasedVariableResolver]);t=t.sort((_,C)=>Range$2.compareRangesUsingStarts(_.range,C.range));let m=0;for(let _=0;_<t.length;_++){const{range:C,template:b,keepWhitespace:v}=t[_];if(_>0){const x=t[_-1].range,E=Range$2.fromPositions(x.getEndPosition(),C.getStartPosition()),I=new Text(u.getValueInRange(E));f.appendChild(I),m+=I.value.length}const S=g.parseFragment(b,f);SnippetSession_1.adjustWhitespace(u,C.getStartPosition(),v!==void 0?!v:o,f,new Set(S)),f.resolveVariables(p);const y=f.toString(),w=y.slice(m);m=y.length;const L=EditOperation.replace(C,w);L.identifier={major:_,minor:0},L._isTracked=!0,d.push(L)}return g.ensureFinalTabstop(f,s,!0),{edits:d,snippets:[new OneSnippet(e,f,"")]}}constructor(e,t,s=_defaultOptions$1,o){this._editor=e,this._template=t,this._options=s,this._languageConfigurationService=o,this._templateMerges=[],this._snippets=[]}dispose(){dispose(this._snippets)}_logInfo(){return`template="${this._template}", merged_templates="${this._templateMerges.join(" -> ")}"`}insert(e){if(!this._editor.hasModel())return;const{edits:t,snippets:s}=typeof this._template=="string"?SnippetSession_1.createEditsAndSnippetsFromSelections(this._editor,this._template,this._options.overwriteBefore,this._options.overwriteAfter,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService):SnippetSession_1.createEditsAndSnippetsFromEdits(this._editor,this._template,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService);this._snippets=s,this._editor.executeEdits(e??EditSources.snippet(),t,o=>{const r=o.filter(l=>!!l.identifier);for(let l=0;l<s.length;l++)s[l].initialize(r[l].textChange);return this._snippets[0].hasPlaceholder?this._move(!0):r.map(l=>Selection$1.fromPositions(l.range.getEndPosition()))}),this._editor.revealRange(this._editor.getSelections()[0])}merge(e,t=_defaultOptions$1){if(!this._editor.hasModel())return;this._templateMerges.push([this._snippets[0]._nestingLevel,this._snippets[0]._placeholderGroupsIdx,e]);const{edits:s,snippets:o}=SnippetSession_1.createEditsAndSnippetsFromSelections(this._editor,e,t.overwriteBefore,t.overwriteAfter,!0,t.adjustWhitespace,t.clipboardText,t.overtypingCapturer,this._languageConfigurationService);this._editor.executeEdits("snippet",s,r=>{const l=r.filter(d=>!!d.identifier);for(let d=0;d<o.length;d++)o[d].initialize(l[d].textChange);const c=o[0].isTrivialSnippet;if(!c){for(const d of this._snippets)d.merge(o);console.assert(o.length===0)}return this._snippets[0].hasPlaceholder&&!c?this._move(void 0):l.map(d=>Selection$1.fromPositions(d.range.getEndPosition()))})}next(){const e=this._move(!0);this._editor.setSelections(e),this._editor.revealPositionInCenterIfOutsideViewport(e[0].getPosition())}prev(){const e=this._move(!1);this._editor.setSelections(e),this._editor.revealPositionInCenterIfOutsideViewport(e[0].getPosition())}_move(e){const t=[];for(const s of this._snippets){const o=s.move(e);t.push(...o)}return t}get isAtFirstPlaceholder(){return this._snippets[0].isAtFirstPlaceholder}get isAtLastPlaceholder(){return this._snippets[0].isAtLastPlaceholder}get hasPlaceholder(){return this._snippets[0].hasPlaceholder}get hasChoice(){return this._snippets[0].hasChoice}get activeChoice(){return this._snippets[0].activeChoice}isSelectionWithinPlaceholders(){if(!this.hasPlaceholder)return!1;const e=this._editor.getSelections();if(e.length<this._snippets.length)return!1;const t=new Map;for(const s of this._snippets){const o=s.computePossibleSelections();if(t.size===0)for(const[r,l]of o){l.sort(Range$2.compareRangesUsingStarts);for(const c of e)if(l[0].containsRange(c)){t.set(r,[]);break}}if(t.size===0)return!1;t.forEach((r,l)=>{r.push(...o.get(l))})}e.sort(Range$2.compareRangesUsingStarts);for(const[s,o]of t){if(o.length!==e.length){t.delete(s);continue}o.sort(Range$2.compareRangesUsingStarts);for(let r=0;r<o.length;r++)if(!o[r].containsRange(e[r])){t.delete(s);continue}}return t.size>0}};SnippetSession=SnippetSession_1=__decorate$1v([__param$1u(3,ILanguageConfigurationService)],SnippetSession);var __decorate$1u=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1t=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},SnippetController2_1;const _defaultOptions={overwriteBefore:0,overwriteAfter:0,undoStopBefore:!0,undoStopAfter:!0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0};var Xe;let SnippetController2=(Xe=class{static get(e){return e.getContribution(SnippetController2_1.ID)}constructor(e,t,s,o,r){this._editor=e,this._logService=t,this._languageFeaturesService=s,this._languageConfigurationService=r,this._inSnippetObservable=observableValue(this,!1),this._snippetListener=new DisposableStore,this._modelVersionId=-1,this._inSnippet=SnippetController2_1.InSnippetMode.bindTo(o),this._hasNextTabstop=SnippetController2_1.HasNextTabstop.bindTo(o),this._hasPrevTabstop=SnippetController2_1.HasPrevTabstop.bindTo(o)}dispose(){var e;this._inSnippet.reset(),this._inSnippetObservable.set(!1,void 0),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),(e=this._session)==null||e.dispose(),this._snippetListener.dispose()}insert(e,t){try{this._doInsert(e,typeof t>"u"?_defaultOptions:{..._defaultOptions,...t})}catch(s){this.cancel(),this._logService.error(s),this._logService.error("snippet_error"),this._logService.error("insert_template=",e),this._logService.error("existing_template=",this._session?this._session._logInfo():"<no_session>")}}_doInsert(e,t){var s;if(this._editor.hasModel()){if(this._snippetListener.clear(),t.undoStopBefore&&this._editor.getModel().pushStackElement(),this._session&&typeof e!="string"&&this.cancel(),this._session?(assertType(typeof e=="string"),this._session.merge(e,t)):(this._modelVersionId=this._editor.getModel().getAlternativeVersionId(),this._session=new SnippetSession(this._editor,e,t,this._languageConfigurationService),this._session.insert(t.reason)),t.undoStopAfter&&this._editor.getModel().pushStackElement(),(s=this._session)!=null&&s.hasChoice){const o={_debugDisplayName:"snippetChoiceCompletions",provideCompletionItems:(g,f)=>{if(!this._session||g!==this._editor.getModel()||!Position$1.equals(this._editor.getPosition(),f))return;const{activeChoice:p}=this._session;if(!p||p.choice.options.length===0)return;const m=g.getValueInRange(p.range),_=!!p.choice.options.find(b=>b.value===m),C=[];for(let b=0;b<p.choice.options.length;b++){const v=p.choice.options[b];C.push({kind:13,label:v.value,insertText:v.value,sortText:"a".repeat(b+1),range:p.range,filterText:_?`${m}_${v.value}`:void 0,command:{id:"jumpToNextSnippetPlaceholder",title:localize(1390,"Go to next placeholder...")}})}return{suggestions:C}}},r=this._editor.getModel();let l,c=!1;const d=()=>{l==null||l.dispose(),c=!1},u=()=>{c||(l=this._languageFeaturesService.completionProvider.register({language:r.getLanguageId(),pattern:r.uri.fsPath,scheme:r.uri.scheme,exclusive:!0},o),this._snippetListener.add(l),c=!0)};this._choiceCompletions={provider:o,enable:u,disable:d}}this._updateState(),this._snippetListener.add(this._editor.onDidChangeModelContent(o=>o.isFlush&&this.cancel())),this._snippetListener.add(this._editor.onDidChangeModel(()=>this.cancel())),this._snippetListener.add(this._editor.onDidChangeCursorSelection(()=>this._updateState()))}}_updateState(){if(!(!this._session||!this._editor.hasModel())){if(this._modelVersionId===this._editor.getModel().getAlternativeVersionId())return this.cancel();if(!this._session.hasPlaceholder)return this.cancel();if(this._session.isAtLastPlaceholder||!this._session.isSelectionWithinPlaceholders())return this._editor.getModel().pushStackElement(),this.cancel();this._inSnippet.set(!0),this._inSnippetObservable.set(!0,void 0),this._hasPrevTabstop.set(!this._session.isAtFirstPlaceholder),this._hasNextTabstop.set(!this._session.isAtLastPlaceholder),this._handleChoice()}}_handleChoice(){var t;if(!this._session||!this._editor.hasModel()){this._currentChoice=void 0;return}const{activeChoice:e}=this._session;if(!e||!this._choiceCompletions){(t=this._choiceCompletions)==null||t.disable(),this._currentChoice=void 0;return}this._currentChoice!==e.choice&&(this._currentChoice=e.choice,this._choiceCompletions.enable(),queueMicrotask(()=>{showSimpleSuggestions(this._editor,this._choiceCompletions.provider)}))}finish(){for(;this._inSnippet.get();)this.next()}cancel(e=!1){var t;this._inSnippet.reset(),this._inSnippetObservable.set(!1,void 0),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),this._snippetListener.clear(),this._currentChoice=void 0,(t=this._session)==null||t.dispose(),this._session=void 0,this._modelVersionId=-1,e&&this._editor.setSelections([this._editor.getSelection()])}prev(){var e;(e=this._session)==null||e.prev(),this._updateState()}next(){var e;(e=this._session)==null||e.next(),this._updateState()}isInSnippet(){return!!this._inSnippet.get()}get isInSnippetObservable(){return this._inSnippetObservable}},SnippetController2_1=Xe,Xe.ID="snippetController2",Xe.InSnippetMode=new RawContextKey("inSnippetMode",!1,localize(1387,"Whether the editor in current in snippet mode")),Xe.HasNextTabstop=new RawContextKey("hasNextTabstop",!1,localize(1388,"Whether there is a next tab stop when in snippet mode")),Xe.HasPrevTabstop=new RawContextKey("hasPrevTabstop",!1,localize(1389,"Whether there is a previous tab stop when in snippet mode")),Xe);SnippetController2=SnippetController2_1=__decorate$1u([__param$1t(1,ILogService),__param$1t(2,ILanguageFeaturesService),__param$1t(3,IContextKeyService),__param$1t(4,ILanguageConfigurationService)],SnippetController2);registerEditorContribution(SnippetController2.ID,SnippetController2,4);const CommandCtor=EditorCommand.bindToContribution(SnippetController2.get);registerEditorCommand(new CommandCtor({id:"jumpToNextSnippetPlaceholder",precondition:ContextKeyExpr.and(SnippetController2.InSnippetMode,SnippetController2.HasNextTabstop),handler:a=>a.next(),kbOpts:{weight:100+30,kbExpr:EditorContextKeys.textInputFocus,primary:2}}));registerEditorCommand(new CommandCtor({id:"jumpToPrevSnippetPlaceholder",precondition:ContextKeyExpr.and(SnippetController2.InSnippetMode,SnippetController2.HasPrevTabstop),handler:a=>a.prev(),kbOpts:{weight:100+30,kbExpr:EditorContextKeys.textInputFocus,primary:1026}}));registerEditorCommand(new CommandCtor({id:"leaveSnippet",precondition:SnippetController2.InSnippetMode,handler:a=>a.cancel(!0),kbOpts:{weight:100+30,kbExpr:EditorContextKeys.textInputFocus,primary:9,secondary:[1033]}}));registerEditorCommand(new CommandCtor({id:"acceptSnippet",precondition:SnippetController2.InSnippetMode,handler:a=>a.finish()}));function getPositionOffsetTransformerFromTextModel(a){return new PositionOffsetTransformerWithTextModel(a)}class PositionOffsetTransformerWithTextModel extends PositionOffsetTransformerBase{constructor(e){super(),this._textModel=e}getOffset(e){return this._textModel.getOffsetAt(e)}getPosition(e){return this._textModel.getPositionAt(e)}}const array=[];function getReadonlyEmptyArray(){return array}function getEndPositionsAfterApplying(a){return getModifiedRangesAfterApplying(a).map(t=>t.getEndPosition())}function getModifiedRangesAfterApplying(a){const e=Permutation.createSortPermutation(a,compareBy(o=>o.range,Range$2.compareRangesUsingStarts)),s=new TextEdit(e.apply(a)).getNewRanges();return e.inverse().apply(s)}function removeTextReplacementCommonSuffixPrefix(a,e){const t=getPositionOffsetTransformerFromTextModel(e),s=e.getValue();return a.map(l=>t.getStringReplacement(l)).map(l=>l.removeCommonSuffixPrefix(s)).map(l=>t.getTextReplacement(l))}function convertItemsToStableObservables(a,e){const t=observableValue("result",[]),s=[];return e.add(autorun(o=>{const r=a.read(o);transaction(l=>{if(r.length!==s.length){s.length=r.length;for(let c=0;c<s.length;c++)s[c]||(s[c]=observableValue("item",r[c]));t.set([...s],l)}s.forEach((c,d)=>c.set(r[d],l))})})),t}class ObservableContextKeyService{constructor(e){this._contextKeyService=e}bind(e,t){return bindContextKey(e,this._contextKeyService,t instanceof Function?t:s=>t.read(s))}}function wait(a,e){return new Promise(t=>{let s;const o=setTimeout(()=>{s&&s.dispose(),t()},a);e&&(s=e.onCancellationRequested(()=>{clearTimeout(o),s&&s.dispose(),t()}))})}class AnimatedValue{constructor(e,t,s,o=easeOutExpo){this.startValue=e,this.endValue=t,this.durationMs=s,this._interpolationFunction=o,this.startTimeMs=Date.now(),e===t&&(this.durationMs=0)}isFinished(){return Date.now()>=this.startTimeMs+this.durationMs}getValue(){const e=Date.now()-this.startTimeMs;return e>=this.durationMs?this.endValue:this._interpolationFunction(e,this.startValue,this.endValue-this.startValue,this.durationMs)}}function easeOutExpo(a,e,t,s){return a===s?e+t:t*(-Math.pow(2,-10*a/s)+1)+e}function easeOutCubic(a,e,t,s){return t*((a=a/s-1)*a*a+1)+e}class ObservableAnimatedValue{constructor(e){this._value=observableValue(this,e)}getValue(e){const t=this._value.read(e);return t.isFinished()||AnimationFrameScheduler.instance.invalidateOnNextAnimationFrame(e),t.getValue()}}const Hs=class Hs{constructor(){this._counter=observableSignal(this),this._isScheduled=!1}invalidateOnNextAnimationFrame(e){this._counter.read(e),this._isScheduled||(this._isScheduled=!0,getActiveWindow().requestAnimationFrame(()=>{this._isScheduled=!1,this._update()}))}_update(){this._counter.trigger(void 0)}};Hs.instance=new Hs;let AnimationFrameScheduler=Hs;class GhostText{constructor(e,t){this.lineNumber=e,this.parts=t,assertFn(()=>checkAdjacentItems(t,(s,o)=>s.column<=o.column))}equals(e){return this.lineNumber===e.lineNumber&&this.parts.length===e.parts.length&&this.parts.every((t,s)=>t.equals(e.parts[s]))}renderForScreenReader(e){if(this.parts.length===0)return"";const t=this.parts[this.parts.length-1],s=e.substr(0,t.column-1);return new TextEdit([...this.parts.map(r=>new TextReplacement(Range$2.fromPositions(new Position$1(1,r.column)),r.lines.map(l=>l.line).join(`
`)))]).applyToString(s).substring(this.parts[0].column-1)}isEmpty(){return this.parts.every(e=>e.lines.length===0)}get lineCount(){return 1+this.parts.reduce((e,t)=>e+t.lines.length-1,0)}}class GhostTextPart{constructor(e,t,s,o=[]){this.column=e,this.text=t,this.preview=s,this._inlineDecorations=o,this.lines=splitLines(this.text).map((r,l)=>({line:r,lineDecorations:LineDecoration.filter(this._inlineDecorations,l+1,1,r.length+1)}))}equals(e){return this.column===e.column&&this.lines.length===e.lines.length&&this.lines.every((t,s)=>t.line===e.lines[s].line&&LineDecoration.equalsArr(t.lineDecorations,e.lines[s].lineDecorations))}}class GhostTextReplacement{constructor(e,t,s,o=0){this.lineNumber=e,this.columnRange=t,this.text=s,this.additionalReservedLineCount=o,this.parts=[new GhostTextPart(this.columnRange.endColumnExclusive,this.text,!1)],this.newLines=splitLines(this.text)}renderForScreenReader(e){return this.newLines.join(`
`)}get lineCount(){return this.newLines.length}isEmpty(){return this.parts.every(e=>e.lines.length===0)}equals(e){return this.lineNumber===e.lineNumber&&this.columnRange.equals(e.columnRange)&&this.newLines.length===e.newLines.length&&this.newLines.every((t,s)=>t===e.newLines[s])&&this.additionalReservedLineCount===e.additionalReservedLineCount}}function ghostTextsOrReplacementsEqual(a,e){return equals$1(a,e,ghostTextOrReplacementEquals)}function ghostTextOrReplacementEquals(a,e){return a===e?!0:!a||!e?!1:a instanceof GhostText&&e instanceof GhostText||a instanceof GhostTextReplacement&&e instanceof GhostTextReplacement?a.equals(e):!1}function singleTextRemoveCommonPrefix(a,e,t){const s=t?a.range.intersectRanges(t):a.range;if(!s)return a;const o=a.text.replaceAll(`\r
`,`
`),r=e.getValueInRange(s,1),l=commonPrefixLength(r,o),c=TextLength.ofText(r.substring(0,l)).addToPosition(a.range.getStartPosition()),d=o.substring(l),u=Range$2.fromPositions(c,a.range.getEndPosition());return new TextReplacement(u,d)}function singleTextEditAugments(a,e){return a.text.startsWith(e.text)&&rangeExtends(a.range,e.range)}function rangeExtends(a,e){return e.getStartPosition().equals(a.getStartPosition())&&e.getEndPosition().isBeforeOrEqual(a.getEndPosition())}function computeGhostText(a,e,t,s,o=0){let r=singleTextRemoveCommonPrefix(a,e);if(r.range.endLineNumber!==r.range.startLineNumber)return;const l=e.getLineContent(r.range.startLineNumber),c=getLeadingWhitespace(l).length;if(r.range.startColumn-1<=c){const _=getLeadingWhitespace(r.text).length,C=l.substring(r.range.startColumn-1,c),[b,v]=[r.range.getStartPosition(),r.range.getEndPosition()],S=b.column+C.length<=v.column?b.delta(0,C.length):v,y=Range$2.fromPositions(S,v),w=r.text.startsWith(C)?r.text.substring(C.length):r.text.substring(_);r=new TextReplacement(y,w)}const u=e.getValueInRange(r.range),g=cachingDiff(u,r.text);if(!g)return;const f=r.range.startLineNumber,p=new Array;if(t==="prefix"){const _=g.filter(C=>C.originalLength===0);if(_.length>1||_.length===1&&_[0].originalStart!==u.length)return}const m=r.text.length-o;for(const _ of g){const C=r.range.startColumn+_.originalStart+_.originalLength;if(t==="subwordSmart"&&s&&s.lineNumber===r.range.startLineNumber&&C<s.column||_.originalLength>0)return;if(_.modifiedLength===0)continue;const b=_.modifiedStart+_.modifiedLength,v=Math.max(_.modifiedStart,Math.min(b,m)),S=r.text.substring(_.modifiedStart,v),y=r.text.substring(v,Math.max(_.modifiedStart,b));S.length>0&&p.push(new GhostTextPart(C,S,!1)),y.length>0&&p.push(new GhostTextPart(C,y,!0))}return new GhostText(f,p)}let lastRequest;function cachingDiff(a,e){if((lastRequest==null?void 0:lastRequest.originalValue)===a&&(lastRequest==null?void 0:lastRequest.newValue)===e)return lastRequest==null?void 0:lastRequest.changes;{let t=smartDiff(a,e,!0);if(t){const s=deletedCharacters(t);if(s>0){const o=smartDiff(a,e,!1);o&&deletedCharacters(o)<s&&(t=o)}}return lastRequest={originalValue:a,newValue:e,changes:t},t}}function deletedCharacters(a){let e=0;for(const t of a)e+=t.originalLength;return e}function smartDiff(a,e,t){if(a.length>5e3||e.length>5e3)return;function s(u){let g=0;for(let f=0,p=u.length;f<p;f++){const m=u.charCodeAt(f);m>g&&(g=m)}return g}const o=Math.max(s(a),s(e));function r(u){if(u<0)throw new Error("unexpected");return o+u+1}function l(u){let g=0,f=0;const p=new Int32Array(u.length);for(let m=0,_=u.length;m<_;m++)if(t&&u[m]==="("){const C=f*100+g;p[m]=r(2*C),g++}else if(t&&u[m]===")"){g=Math.max(g-1,0);const C=f*100+g;p[m]=r(2*C+1),g===0&&f++}else p[m]=u.charCodeAt(m);return p}const c=l(a),d=l(e);return new LcsDiff({getElements:()=>c},{getElements:()=>d}).ComputeDiff(!1).changes}function observableReducerSettable(a,e){let t,s=!1;const o=new DerivedWithSetter(new DebugNameData(a,void 0,e.update),(r,l)=>{s||(t=e.initial instanceof Function?e.initial():e.initial,s=!0);const c=e.update(r,t,l);return t=c,c},e.changeTracker,()=>{var r;s&&((r=e.disposeFinal)==null||r.call(e,t),s=!1)},e.equalityComparer??strictEquals,(r,l,c)=>{if(!s)throw new BugIndicatingError("Can only set when there is a listener! This is to prevent leaks.");subtransaction(l,d=>{t=r,o.setValue(r,d,c)})},DebugLocation.ofCaller());return o}var __decorate$1t=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1s=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class InterceptingTelemetryService{constructor(e,t){this._baseService=e,this._intercept=t}publicLog2(e,t){this._intercept(e,t),this._baseService.publicLog2(e,t)}}let DataChannelForwardingTelemetryService=class extends InterceptingTelemetryService{constructor(e,t){super(e,(s,o)=>{let r=!0;o&&shouldForwardToChannel in o&&(r=!!o[shouldForwardToChannel]),r&&t.getDataChannel("editTelemetry").sendData({eventName:s,data:o})})}};DataChannelForwardingTelemetryService=__decorate$1t([__param$1s(0,ITelemetryService),__param$1s(1,IDataChannelService)],DataChannelForwardingTelemetryService);const shouldForwardToChannel=Symbol("shouldForwardToChannel");function forwardToChannelIf(a){return{[shouldForwardToChannel]:a}}function isCopilotLikeExtension(a){if(!a)return!1;const e=a.toLowerCase();return e==="github.copilot"||e==="github.copilot-chat"}function offsetEditFromContentChanges(a){const e=a.map(s=>new StringReplacement(OffsetRange.ofStartAndLength(s.rangeOffset,s.rangeLength),s.text));return e.reverse(),new StringEdit(e)}function sendInlineCompletionsEndOfLifeTelemetry(a,e){a.publicLog2("inlineCompletion.endOfLife",e)}const MINIMUM_MATCHING_CHARACTER_LENGTH=3;class LegacyLinesDiffComputer{computeDiff(e,t,s){var d;const r=new DiffComputer(e,t,{maxComputationTime:s.maxComputationTimeMs,shouldIgnoreTrimWhitespace:s.ignoreTrimWhitespace,shouldComputeCharChanges:!0,shouldMakePrettyDiff:!0,shouldPostProcessCharChanges:!0}).computeDiff(),l=[];let c=null;for(const u of r.changes){let g;u.originalEndLineNumber===0?g=new LineRange(u.originalStartLineNumber+1,u.originalStartLineNumber+1):g=new LineRange(u.originalStartLineNumber,u.originalEndLineNumber+1);let f;u.modifiedEndLineNumber===0?f=new LineRange(u.modifiedStartLineNumber+1,u.modifiedStartLineNumber+1):f=new LineRange(u.modifiedStartLineNumber,u.modifiedEndLineNumber+1);let p=new DetailedLineRangeMapping(g,f,(d=u.charChanges)==null?void 0:d.map(m=>new RangeMapping(new Range$2(m.originalStartLineNumber,m.originalStartColumn,m.originalEndLineNumber,m.originalEndColumn),new Range$2(m.modifiedStartLineNumber,m.modifiedStartColumn,m.modifiedEndLineNumber,m.modifiedEndColumn))));c&&(c.modified.endLineNumberExclusive===p.modified.startLineNumber||c.original.endLineNumberExclusive===p.original.startLineNumber)&&(p=new DetailedLineRangeMapping(c.original.join(p.original),c.modified.join(p.modified),c.innerChanges&&p.innerChanges?c.innerChanges.concat(p.innerChanges):void 0),l.pop()),l.push(p),c=p}return assertFn(()=>checkAdjacentItems(l,(u,g)=>g.original.startLineNumber-u.original.endLineNumberExclusive===g.modified.startLineNumber-u.modified.endLineNumberExclusive&&u.original.endLineNumberExclusive<g.original.startLineNumber&&u.modified.endLineNumberExclusive<g.modified.startLineNumber)),new LinesDiff(l,[],r.quitEarly)}}function computeDiff(a,e,t,s){return new LcsDiff(a,e,t).ComputeDiff(s)}class LineSequence{constructor(e){const t=[],s=[];for(let o=0,r=e.length;o<r;o++)t[o]=getFirstNonBlankColumn(e[o],1),s[o]=getLastNonBlankColumn(e[o],1);this.lines=e,this._startColumns=t,this._endColumns=s}getElements(){const e=[];for(let t=0,s=this.lines.length;t<s;t++)e[t]=this.lines[t].substring(this._startColumns[t]-1,this._endColumns[t]-1);return e}getStrictElement(e){return this.lines[e]}getStartLineNumber(e){return e+1}getEndLineNumber(e){return e+1}createCharSequence(e,t,s){const o=[],r=[],l=[];let c=0;for(let d=t;d<=s;d++){const u=this.lines[d],g=e?this._startColumns[d]:1,f=e?this._endColumns[d]:u.length+1;for(let p=g;p<f;p++)o[c]=u.charCodeAt(p-1),r[c]=d+1,l[c]=p,c++;!e&&d<s&&(o[c]=10,r[c]=d+1,l[c]=u.length+1,c++)}return new CharSequence(o,r,l)}}class CharSequence{constructor(e,t,s){this._charCodes=e,this._lineNumbers=t,this._columns=s}toString(){return"["+this._charCodes.map((e,t)=>(e===10?"\\n":String.fromCharCode(e))+`-(${this._lineNumbers[t]},${this._columns[t]})`).join(", ")+"]"}_assertIndex(e,t){if(e<0||e>=t.length)throw new Error("Illegal index")}getElements(){return this._charCodes}getStartLineNumber(e){return e>0&&e===this._lineNumbers.length?this.getEndLineNumber(e-1):(this._assertIndex(e,this._lineNumbers),this._lineNumbers[e])}getEndLineNumber(e){return e===-1?this.getStartLineNumber(e+1):(this._assertIndex(e,this._lineNumbers),this._charCodes[e]===10?this._lineNumbers[e]+1:this._lineNumbers[e])}getStartColumn(e){return e>0&&e===this._columns.length?this.getEndColumn(e-1):(this._assertIndex(e,this._columns),this._columns[e])}getEndColumn(e){return e===-1?this.getStartColumn(e+1):(this._assertIndex(e,this._columns),this._charCodes[e]===10?1:this._columns[e]+1)}}class CharChange{constructor(e,t,s,o,r,l,c,d){this.originalStartLineNumber=e,this.originalStartColumn=t,this.originalEndLineNumber=s,this.originalEndColumn=o,this.modifiedStartLineNumber=r,this.modifiedStartColumn=l,this.modifiedEndLineNumber=c,this.modifiedEndColumn=d}static createFromDiffChange(e,t,s){const o=t.getStartLineNumber(e.originalStart),r=t.getStartColumn(e.originalStart),l=t.getEndLineNumber(e.originalStart+e.originalLength-1),c=t.getEndColumn(e.originalStart+e.originalLength-1),d=s.getStartLineNumber(e.modifiedStart),u=s.getStartColumn(e.modifiedStart),g=s.getEndLineNumber(e.modifiedStart+e.modifiedLength-1),f=s.getEndColumn(e.modifiedStart+e.modifiedLength-1);return new CharChange(o,r,l,c,d,u,g,f)}}function postProcessCharChanges(a){if(a.length<=1)return a;const e=[a[0]];let t=e[0];for(let s=1,o=a.length;s<o;s++){const r=a[s],l=r.originalStart-(t.originalStart+t.originalLength),c=r.modifiedStart-(t.modifiedStart+t.modifiedLength);Math.min(l,c)<MINIMUM_MATCHING_CHARACTER_LENGTH?(t.originalLength=r.originalStart+r.originalLength-t.originalStart,t.modifiedLength=r.modifiedStart+r.modifiedLength-t.modifiedStart):(e.push(r),t=r)}return e}class LineChange{constructor(e,t,s,o,r){this.originalStartLineNumber=e,this.originalEndLineNumber=t,this.modifiedStartLineNumber=s,this.modifiedEndLineNumber=o,this.charChanges=r}static createFromDiffResult(e,t,s,o,r,l,c){let d,u,g,f,p;if(t.originalLength===0?(d=s.getStartLineNumber(t.originalStart)-1,u=0):(d=s.getStartLineNumber(t.originalStart),u=s.getEndLineNumber(t.originalStart+t.originalLength-1)),t.modifiedLength===0?(g=o.getStartLineNumber(t.modifiedStart)-1,f=0):(g=o.getStartLineNumber(t.modifiedStart),f=o.getEndLineNumber(t.modifiedStart+t.modifiedLength-1)),l&&t.originalLength>0&&t.originalLength<20&&t.modifiedLength>0&&t.modifiedLength<20&&r()){const m=s.createCharSequence(e,t.originalStart,t.originalStart+t.originalLength-1),_=o.createCharSequence(e,t.modifiedStart,t.modifiedStart+t.modifiedLength-1);if(m.getElements().length>0&&_.getElements().length>0){let C=computeDiff(m,_,r,!0).changes;c&&(C=postProcessCharChanges(C)),p=[];for(let b=0,v=C.length;b<v;b++)p.push(CharChange.createFromDiffChange(C[b],m,_))}}return new LineChange(d,u,g,f,p)}}class DiffComputer{constructor(e,t,s){this.shouldComputeCharChanges=s.shouldComputeCharChanges,this.shouldPostProcessCharChanges=s.shouldPostProcessCharChanges,this.shouldIgnoreTrimWhitespace=s.shouldIgnoreTrimWhitespace,this.shouldMakePrettyDiff=s.shouldMakePrettyDiff,this.originalLines=e,this.modifiedLines=t,this.original=new LineSequence(e),this.modified=new LineSequence(t),this.continueLineDiff=createContinueProcessingPredicate(s.maxComputationTime),this.continueCharDiff=createContinueProcessingPredicate(s.maxComputationTime===0?0:Math.min(s.maxComputationTime,5e3))}computeDiff(){if(this.original.lines.length===1&&this.original.lines[0].length===0)return this.modified.lines.length===1&&this.modified.lines[0].length===0?{quitEarly:!1,changes:[]}:{quitEarly:!1,changes:[{originalStartLineNumber:1,originalEndLineNumber:1,modifiedStartLineNumber:1,modifiedEndLineNumber:this.modified.lines.length,charChanges:void 0}]};if(this.modified.lines.length===1&&this.modified.lines[0].length===0)return{quitEarly:!1,changes:[{originalStartLineNumber:1,originalEndLineNumber:this.original.lines.length,modifiedStartLineNumber:1,modifiedEndLineNumber:1,charChanges:void 0}]};const e=computeDiff(this.original,this.modified,this.continueLineDiff,this.shouldMakePrettyDiff),t=e.changes,s=e.quitEarly;if(this.shouldIgnoreTrimWhitespace){const c=[];for(let d=0,u=t.length;d<u;d++)c.push(LineChange.createFromDiffResult(this.shouldIgnoreTrimWhitespace,t[d],this.original,this.modified,this.continueCharDiff,this.shouldComputeCharChanges,this.shouldPostProcessCharChanges));return{quitEarly:s,changes:c}}const o=[];let r=0,l=0;for(let c=-1,d=t.length;c<d;c++){const u=c+1<d?t[c+1]:null,g=u?u.originalStart:this.originalLines.length,f=u?u.modifiedStart:this.modifiedLines.length;for(;r<g&&l<f;){const p=this.originalLines[r],m=this.modifiedLines[l];if(p!==m){{let _=getFirstNonBlankColumn(p,1),C=getFirstNonBlankColumn(m,1);for(;_>1&&C>1;){const b=p.charCodeAt(_-2),v=m.charCodeAt(C-2);if(b!==v)break;_--,C--}(_>1||C>1)&&this._pushTrimWhitespaceCharChange(o,r+1,1,_,l+1,1,C)}{let _=getLastNonBlankColumn(p,1),C=getLastNonBlankColumn(m,1);const b=p.length+1,v=m.length+1;for(;_<b&&C<v;){const S=p.charCodeAt(_-1),y=p.charCodeAt(C-1);if(S!==y)break;_++,C++}(_<b||C<v)&&this._pushTrimWhitespaceCharChange(o,r+1,_,b,l+1,C,v)}}r++,l++}u&&(o.push(LineChange.createFromDiffResult(this.shouldIgnoreTrimWhitespace,u,this.original,this.modified,this.continueCharDiff,this.shouldComputeCharChanges,this.shouldPostProcessCharChanges)),r+=u.originalLength,l+=u.modifiedLength)}return{quitEarly:s,changes:o}}_pushTrimWhitespaceCharChange(e,t,s,o,r,l,c){if(this._mergeTrimWhitespaceCharChange(e,t,s,o,r,l,c))return;let d;this.shouldComputeCharChanges&&(d=[new CharChange(t,s,t,o,r,l,r,c)]),e.push(new LineChange(t,t,r,r,d))}_mergeTrimWhitespaceCharChange(e,t,s,o,r,l,c){const d=e.length;if(d===0)return!1;const u=e[d-1];return u.originalEndLineNumber===0||u.modifiedEndLineNumber===0?!1:u.originalEndLineNumber===t&&u.modifiedEndLineNumber===r?(this.shouldComputeCharChanges&&u.charChanges&&u.charChanges.push(new CharChange(t,s,t,o,r,l,r,c)),!0):u.originalEndLineNumber+1===t&&u.modifiedEndLineNumber+1===r?(u.originalEndLineNumber=t,u.modifiedEndLineNumber=r,this.shouldComputeCharChanges&&u.charChanges&&u.charChanges.push(new CharChange(t,s,t,o,r,l,r,c)),!0):!1}}function getFirstNonBlankColumn(a,e){const t=firstNonWhitespaceIndex(a);return t===-1?e:t+1}function getLastNonBlankColumn(a,e){const t=lastNonWhitespaceIndex(a);return t===-1?e:t+2}function createContinueProcessingPredicate(a){if(a===0)return()=>!0;const e=Date.now();return()=>Date.now()-e<a}const linesDiffComputers={getLegacy:()=>new LegacyLinesDiffComputer,getDefault:()=>new DefaultLinesDiffComputer};var InlineSuggestionItem;(function(a){function e(t,s){return t.isInlineEdit?InlineEditItem.create(t,s):InlineCompletionItem.create(t,s)}a.create=e})(InlineSuggestionItem||(InlineSuggestionItem={}));class InlineSuggestionItemBase{constructor(e,t,s){this._data=e,this.identity=t,this.displayLocation=s}get source(){return this._data.source}get isFromExplicitRequest(){return this._data.context.triggerKind===InlineCompletionTriggerKind$1.Explicit}get forwardStable(){return this.source.inlineSuggestions.enableForwardStability??!1}get editRange(){return this.getSingleTextEdit().range}get targetRange(){var e;return((e=this.displayLocation)==null?void 0:e.range)??this.editRange}get insertText(){return this.getSingleTextEdit().text}get semanticId(){return this.hash}get action(){return this._sourceInlineCompletion.action}get command(){return this._sourceInlineCompletion.command}get warning(){return this._sourceInlineCompletion.warning}get showInlineEditMenu(){return!!this._sourceInlineCompletion.showInlineEditMenu}get hash(){return JSON.stringify([this.getSingleTextEdit().text,this.getSingleTextEdit().range.getStartPosition().toString()])}get requestUuid(){return this._data.context.requestUuid}get partialAccepts(){return this._data.partialAccepts}get _sourceInlineCompletion(){return this._data.sourceInlineCompletion}addRef(){this.identity.addRef(),this.source.addRef()}removeRef(){this.identity.removeRef(),this.source.removeRef()}reportInlineEditShown(e,t,s){this._data.reportInlineEditShown(e,this.insertText,t,s)}reportPartialAccept(e,t,s){this._data.reportPartialAccept(e,t,s)}reportEndOfLife(e){this._data.reportEndOfLife(e)}setEndOfLifeReason(e){this._data.setEndOfLifeReason(e)}reportInlineEditError(e){this._data.reportInlineEditError(e)}setIsPreceeded(e){this._data.setIsPreceeded(e.partialAccepts)}setNotShownReasonIfNotSet(e){this._data.setNotShownReason(e)}getSourceCompletion(){return this._sourceInlineCompletion}}const Vs=class Vs{constructor(){this._onDispose=observableSignal(this),this._refCount=1,this.id="InlineCompletionIdentity"+Vs.idCounter++}addRef(){this._refCount++}removeRef(){this._refCount--,this._refCount===0&&this._onDispose.trigger(void 0)}};Vs.idCounter=0;let InlineSuggestionIdentity=Vs;class InlineSuggestDisplayLocation{static create(e){return new InlineSuggestDisplayLocation(e.range,e.label,e.kind)}constructor(e,t,s){this.range=e,this.label=t,this.kind=s}withEdit(e,t){const s=new OffsetRange(t.getOffset(this.range.getStartPosition()),t.getOffset(this.range.getEndPosition())),o=applyEditsToRanges([s],e)[0];if(!o)return;const r=t.getRange(o);return new InlineSuggestDisplayLocation(r,this.label,this.kind)}}class InlineCompletionItem extends InlineSuggestionItemBase{static create(e,t){const s=new InlineSuggestionIdentity,o=getPositionOffsetTransformerFromTextModel(t),r=e.insertText.replace(/\r\n|\r|\n/g,t.getEOL()),l=reshapeInlineCompletion(new StringReplacement(o.getOffsetRange(e.range),r),t),c=l.removeCommonSuffixAndPrefix(t.getValue()),d=o.getTextReplacement(l),u=e.displayLocation?InlineSuggestDisplayLocation.create(e.displayLocation):void 0;return new InlineCompletionItem(l,c,d,d.range,e.snippetInfo,e.additionalTextEdits,e,s,u)}constructor(e,t,s,o,r,l,c,d,u){super(c,d,u),this._edit=e,this._trimmedEdit=t,this._textEdit=s,this._originalRange=o,this.snippetInfo=r,this.additionalTextEdits=l,this.isInlineEdit=!1}get hash(){return JSON.stringify(this._trimmedEdit.toJson())}getSingleTextEdit(){return this._textEdit}withIdentity(e){return new InlineCompletionItem(this._edit,this._trimmedEdit,this._textEdit,this._originalRange,this.snippetInfo,this.additionalTextEdits,this._data,e,this.displayLocation)}withEdit(e,t){const s=applyEditsToRanges([this._edit.replaceRange],e);if(s.length===0)return;const o=new StringReplacement(s[0],this._textEdit.text),r=getPositionOffsetTransformerFromTextModel(t),l=r.getTextReplacement(o);let c=this.displayLocation;if(c&&(c=c.withEdit(e,r),!c))return;const d=o.removeCommonSuffixAndPrefix(t.getValue());return new InlineCompletionItem(o,d,l,this._originalRange,this.snippetInfo,this.additionalTextEdits,this._data,this.identity,c)}canBeReused(e,t){const s=this._textEdit.range;return!!s&&s.containsPosition(t)&&this.isVisible(e,t)&&TextLength.ofRange(s).isGreaterThanOrEqualTo(TextLength.ofRange(this._originalRange))}isVisible(e,t){const s=this.getSingleTextEdit();return inlineCompletionIsVisible(s,this._originalRange,e,t)}}function inlineCompletionIsVisible(a,e,t,s){const o=singleTextRemoveCommonPrefix(a,t),r=a.range;if(!r||e&&!e.getStartPosition().equals(r.getStartPosition())||s.lineNumber!==o.range.startLineNumber||o.isEmpty)return!1;const l=t.getValueInRange(o.range,1),c=o.text,d=Math.max(0,s.column-o.range.startColumn);let u=c.substring(0,d),g=c.substring(d),f=l.substring(0,d),p=l.substring(d);const m=t.getLineIndentColumn(o.range.startLineNumber);return o.range.startColumn<=m&&(f=f.trimStart(),f.length===0&&(p=p.trimStart()),u=u.trimStart(),u.length===0&&(g=g.trimStart())),u.startsWith(f)&&!!matchesSubString(p,g)}class InlineEditItem extends InlineSuggestionItemBase{static create(e,t){const s=getStringEdit(t,e.range,e.insertText),o=new TextModelText(t),l=TextEdit.fromStringEdit(s,o).toReplacement(o),c=new InlineSuggestionIdentity,d=s.replacements.map(g=>{const f=Range$2.fromPositions(t.getPositionAt(g.replaceRange.start),t.getPositionAt(g.replaceRange.endExclusive)),p=t.getValueInRange(f);return SingleUpdatedNextEdit.create(g,p)}),u=e.displayLocation?InlineSuggestDisplayLocation.create(e.displayLocation):void 0;return new InlineEditItem(s,l,e,c,d,u,!1,t.getVersionId())}constructor(e,t,s,o,r,l,c=!1,d){super(s,o,l),this._edit=e,this._textEdit=t,this._edits=r,this._lastChangePartOfInlineEdit=c,this._inlineEditModelVersion=d,this.snippetInfo=void 0,this.additionalTextEdits=[],this.isInlineEdit=!0}get updatedEditModelVersion(){return this._inlineEditModelVersion}get updatedEdit(){return this._edit}getSingleTextEdit(){return this._textEdit}withIdentity(e){return new InlineEditItem(this._edit,this._textEdit,this._data,e,this._edits,this.displayLocation,this._lastChangePartOfInlineEdit,this._inlineEditModelVersion)}canBeReused(e,t){return this._lastChangePartOfInlineEdit&&this.updatedEditModelVersion===e.getVersionId()}withEdit(e,t){return this._applyTextModelChanges(e,this._edits,t)}_applyTextModelChanges(e,t,s){if(t=t.map(f=>f.applyTextModelChanges(e)),t.some(f=>f.edit===void 0))return;const o=s.getVersionId();let r=this._inlineEditModelVersion;const l=t.some(f=>f.lastChangeUpdatedEdit);if(l&&(r=o??-1),o===null||r+20<o||(t=t.filter(f=>!f.edit.isEmpty),t.length===0))return;const c=new StringEdit(t.map(f=>f.edit)),d=getPositionOffsetTransformerFromTextModel(s),u=d.getTextEdit(c).toReplacement(new TextModelText(s));let g=this.displayLocation;if(!(g&&(g=g.withEdit(e,d),!g)))return new InlineEditItem(c,u,this._data,this.identity,t,g,l,r)}}function getStringEdit(a,e,t){const s=a.getEOL(),o=a.getValueInRange(e),r=t.replace(/\r\n|\r|\n/g,s),d=linesDiffComputers.getDefault().computeDiff(splitLines(o),splitLines(r),{ignoreTrimWhitespace:!1,computeMoves:!1,extendToSubwords:!0,maxComputationTimeMs:500}).changes.flatMap(p=>p.innerChanges??[]);function u(p,m){const _=TextLength.fromPosition(m.getStartPosition());return TextLength.ofRange(m).createRange(_.addToPosition(p))}const g=new StringText(r);return new StringEdit(d.map(p=>{const m=u(e.getStartPosition(),p.originalRange),_=getPositionOffsetTransformerFromTextModel(a).getOffsetRange(m),C=g.getValueOfRange(p.modifiedRange),b=new StringReplacement(_,C),v=a.getValueInRange(m);return reshapeInlineEdit(b,v,d.length,a)}))}class SingleUpdatedNextEdit{static create(e,t){const s=commonPrefixLength(e.newText,t),o=commonSuffixLength(e.newText,t),r=e.newText.substring(s,e.newText.length-o);return new SingleUpdatedNextEdit(e,r,s,o)}get edit(){return this._edit}get lastChangeUpdatedEdit(){return this._lastChangeUpdatedEdit}constructor(e,t,s,o,r=!1){this._edit=e,this._trimmedNewText=t,this._prefixLength=s,this._suffixLength=o,this._lastChangeUpdatedEdit=r}applyTextModelChanges(e){const t=this._clone();return t._applyTextModelChanges(e),t}_clone(){return new SingleUpdatedNextEdit(this._edit,this._trimmedNewText,this._prefixLength,this._suffixLength,this._lastChangeUpdatedEdit)}_applyTextModelChanges(e){if(this._lastChangeUpdatedEdit=!1,!this._edit)throw new BugIndicatingError("UpdatedInnerEdits: No edit to apply changes to");const t=this._applyChanges(this._edit,e);if(!t){this._edit=void 0;return}this._edit=t.edit,this._lastChangeUpdatedEdit=t.editHasChanged}_applyChanges(e,t){let s=e.replaceRange.start,o=e.replaceRange.endExclusive,r=e.newText,l=!1;const c=this._prefixLength>0||this._suffixLength>0;for(let d=t.replacements.length-1;d>=0;d--){const u=t.replacements[d],g=u.newText.length>0&&u.replaceRange.isEmpty;if(g&&!c&&u.replaceRange.start===s&&r.startsWith(u.newText)){s+=u.newText.length,r=r.substring(u.newText.length),o=Math.max(s,o),l=!0;continue}if(g&&c&&u.replaceRange.start===s+this._prefixLength&&this._trimmedNewText.startsWith(u.newText)){o+=u.newText.length,l=!0,this._prefixLength+=u.newText.length,this._trimmedNewText=this._trimmedNewText.substring(u.newText.length);continue}if(u.newText.length===0&&u.replaceRange.length>0&&u.replaceRange.start>=s+this._prefixLength&&u.replaceRange.endExclusive<=o-this._suffixLength){o-=u.replaceRange.length,l=!0;continue}if(u.equals(e)){l=!0,s=u.replaceRange.endExclusive,r="";continue}if(!(u.replaceRange.start>o)){if(u.replaceRange.endExclusive<s){s+=u.newText.length-u.replaceRange.length,o+=u.newText.length-u.replaceRange.length;continue}return}}return this._trimmedNewText.length===0&&s+this._prefixLength===o-this._suffixLength?{edit:new StringReplacement(new OffsetRange(s+this._prefixLength,s+this._prefixLength),""),editHasChanged:!0}:{edit:new StringReplacement(new OffsetRange(s,o),r),editHasChanged:l}}}function reshapeInlineCompletion(a,e){const t=e.getEOL();return a.replaceRange.isEmpty&&a.newText.includes(t)&&(a=reshapeMultiLineInsertion(a,e)),a}function reshapeInlineEdit(a,e,t,s){const o=s.getEOL();if(a.newText.endsWith(o)&&e.endsWith(o)&&(a=new StringReplacement(a.replaceRange.deltaEnd(-o.length),a.newText.slice(0,-o.length))),t===1&&a.replaceRange.isEmpty&&a.newText.includes(o)){const r=s.getPositionAt(a.replaceRange.start);s.getLineLength(r.lineNumber)!==0&&(a=reshapeMultiLineInsertion(a,s))}if(t===1){const r=commonPrefixLength(e,a.newText),l=commonSuffixLength(e.slice(r),a.newText.slice(r));if(r+l===e.length)return new StringReplacement(a.replaceRange.deltaStart(r).deltaEnd(-l),a.newText.substring(r,a.newText.length-l));if(r+l===a.newText.length)return new StringReplacement(a.replaceRange.deltaStart(r).deltaEnd(-l),"")}return a}function reshapeMultiLineInsertion(a,e){if(!a.replaceRange.isEmpty)throw new BugIndicatingError("Unexpected original range");if(a.replaceRange.start===0)return a;const t=e.getEOL(),s=e.getPositionAt(a.replaceRange.start),o=s.column,r=s.lineNumber;return o===1&&r>1&&a.newText.endsWith(t)&&!a.newText.startsWith(t)?new StringReplacement(a.replaceRange.delta(-1),t+a.newText.slice(0,-t.length)):a}function fixBracketsInLine(a,e){const t=new DenseKeyProvider,s=new LanguageAgnosticBracketTokens(t,u=>e.getLanguageConfiguration(u)),o=new TextBufferTokenizer(new StaticTokenizerSource([a]),s),r=parseDocument(o,[],void 0,!0);let l="";const c=a.getLineContent();function d(u,g){if(u.kind===2)if(d(u.openingBracket,g),g=lengthAdd(g,u.openingBracket.length),u.child&&(d(u.child,g),g=lengthAdd(g,u.child.length)),u.closingBracket)d(u.closingBracket,g),g=lengthAdd(g,u.closingBracket.length);else{const p=s.getSingleLanguageBracketTokens(u.openingBracket.languageId).findClosingTokenText(u.openingBracket.bracketIds);l+=p}else if(u.kind!==3){if(u.kind===0||u.kind===1)l+=c.substring(g,lengthAdd(g,u.length));else if(u.kind===4)for(const f of u.children)d(f,g),g=lengthAdd(g,f.length)}}return d(r,lengthZero),l}class StaticTokenizerSource{constructor(e){this.lines=e,this.tokenization={getLineTokens:t=>this.lines[t-1]}}getLineCount(){return this.lines.length}getLineLength(e){return this.lines[e-1].getLineContent().length}}class DirectedGraph{constructor(){this._nodes=new Set,this._outgoingEdges=new Map}static from(e,t){const s=new DirectedGraph;for(const o of e)s._nodes.add(o);for(const o of e){const r=t(o);if(r.length>0){const l=new Set;for(const c of r)l.add(c);s._outgoingEdges.set(o,l)}}return s}removeCycles(){const e=[],t=new Set,s=new Set,o=[],r=l=>{t.add(l),s.add(l);const c=this._outgoingEdges.get(l);if(c)for(const d of c)t.has(d)?s.has(d)&&(e.push(d),o.push({from:l,to:d})):r(d);s.delete(l)};for(const l of this._nodes)t.has(l)||r(l);for(const{from:l,to:c}of o){const d=this._outgoingEdges.get(l);d&&d.delete(c)}return{foundCycles:e}}getOutgoing(e){const t=this._outgoingEdges.get(e);return t?Array.from(t):[]}}var InlineEditTabAction;(function(a){a.Jump="jump",a.Accept="accept",a.Inactive="inactive"})(InlineEditTabAction||(InlineEditTabAction={}));var InlineCompletionViewKind;(function(a){a.GhostText="ghostText",a.Custom="custom",a.SideBySide="sideBySide",a.Deletion="deletion",a.InsertionInline="insertionInline",a.InsertionMultiLine="insertionMultiLine",a.WordReplacements="wordReplacements",a.LineReplacement="lineReplacement",a.Collapsed="collapsed"})(InlineCompletionViewKind||(InlineCompletionViewKind={}));function provideInlineCompletions(a,e,t,s,o,r){const l=prefixedUuid("icr"),c=new CancellationTokenSource$1;let d;const u={...s,requestUuid:l},g=getDefaultRange(e,t),f=groupByMap(a,v=>v.groupId),p=DirectedGraph.from(a,v=>{var S;return((S=v.yieldsToGroupIds)==null?void 0:S.flatMap(y=>f.get(y)??[]))??[]}),{foundCycles:m}=p.removeCycles();m.length>0&&onUnexpectedExternalError(new Error(`Inline completions: cyclic yield-to dependency detected. Path: ${m.map(v=>v.toString?v.toString():""+v).join(" -> ")}`));let _=0;const C=new CachedFunction(async v=>{try{if(_++,c.token.isCancellationRequested)return;const S=p.getOutgoing(v);for(const I of S){const D=await C.get(I);if(D)for(const k of D.inlineSuggestions.items){if(k.isInlineEdit||typeof k.insertText!="string")return;const N=new TextReplacement(Range$2.lift(k.range)??g,k.insertText);if(inlineCompletionIsVisible(N,void 0,t,e))return}}let y;const w=Date.now();try{y=await v.provideInlineCompletions(t,e,u,c.token)}catch(I){onUnexpectedExternalError(I);return}const L=Date.now();if(!y)return;const x=[],E=new InlineSuggestionList(y,x,v);if(E.addRef(),runWhenCancelled(c.token,()=>E.removeRef(d)),c.token.isCancellationRequested)return;for(const I of y.items)x.push(toInlineSuggestData(I,E,g,t,r,u,o,{startTime:w,endTime:L}));return E}finally{_--}}),b=AsyncIterableProducer.fromPromisesResolveOrder(a.map(v=>C.get(v))).filter(isDefined);return{contextWithUuid:u,get didAllProvidersReturn(){return _===0},lists:b,cancelAndDispose:v=>{d===void 0&&(d=v,c.dispose(!0))}}}function runWhenCancelled(a,e){if(a.isCancellationRequested)return e(),Disposable.None;{const t=a.onCancellationRequested(()=>{t.dispose(),e()});return{dispose:()=>t.dispose()}}}function toInlineSuggestData(a,e,t,s,o,r,l,c){let d,u,g=a.range?Range$2.lift(a.range):t;if(typeof a.insertText=="string"){if(d=a.insertText,o&&a.completeBracketPairs){d=closeBrackets(d,g.getStartPosition(),s,o);const p=d.length-a.insertText.length;p!==0&&(g=new Range$2(g.startLineNumber,g.startColumn,g.endLineNumber,g.endColumn+p))}u=void 0}else if("snippet"in a.insertText){const p=a.insertText.snippet.length;if(o&&a.completeBracketPairs){a.insertText.snippet=closeBrackets(a.insertText.snippet,g.getStartPosition(),s,o);const _=a.insertText.snippet.length-p;_!==0&&(g=new Range$2(g.startLineNumber,g.startColumn,g.endLineNumber,g.endColumn+_))}const m=new SnippetParser().parse(a.insertText.snippet);m.children.length===1&&m.children[0]instanceof Text?(d=m.children[0].value,u=void 0):(d=m.toString(),u={snippet:a.insertText.snippet,range:g})}else assertNever(a.insertText);const f=a.displayLocation?{range:Range$2.lift(a.displayLocation.range),label:a.displayLocation.label,kind:a.displayLocation.kind}:void 0;return new InlineSuggestData(g,d,u,f,a.additionalTextEdits||getReadonlyEmptyArray(),a,e,r,a.isInlineEdit??!1,l,c,a.correlationId)}class InlineSuggestData{constructor(e,t,s,o,r,l,c,d,u,g,f,p){this.range=e,this.insertText=t,this.snippetInfo=s,this.displayLocation=o,this.additionalTextEdits=r,this.sourceInlineCompletion=l,this.source=c,this.context=d,this.isInlineEdit=u,this._requestInfo=g,this._providerRequestInfo=f,this._correlationId=p,this._didShow=!1,this._timeUntilShown=void 0,this._showStartTime=void 0,this._shownDuration=0,this._showUncollapsedStartTime=void 0,this._showUncollapsedDuration=0,this._notShownReason=void 0,this._didReportEndOfLife=!1,this._lastSetEndOfLifeReason=void 0,this._isPreceeded=!1,this._partiallyAcceptedCount=0,this._partiallyAcceptedSinceOriginal={characters:0,ratio:0,count:0},this._viewData={editorType:g.editorType}}get showInlineEditMenu(){return this.sourceInlineCompletion.showInlineEditMenu??!1}get partialAccepts(){return this._partiallyAcceptedSinceOriginal}async reportInlineEditShown(e,t,s,o){var l,c;if(this.updateShownDuration(s),this._didShow)return;this._didShow=!0,this._viewData.viewKind=s,this._viewData.renderData=o,this._timeUntilShown=Date.now()-this._requestInfo.startTime;const r=new EditDeltaInfo(o.lineCountModified,o.lineCountOriginal,o.characterCountModified,o.characterCountOriginal);(c=(l=this.source.provider).handleItemDidShow)==null||c.call(l,this.source.inlineSuggestions,this.sourceInlineCompletion,t,r),this.sourceInlineCompletion.shownCommand&&await e.executeCommand(this.sourceInlineCompletion.shownCommand.id,...this.sourceInlineCompletion.shownCommand.arguments||[])}reportPartialAccept(e,t,s){var o,r;this._partiallyAcceptedCount++,this._partiallyAcceptedSinceOriginal.characters+=s.characters,this._partiallyAcceptedSinceOriginal.ratio=Math.min(this._partiallyAcceptedSinceOriginal.ratio+(1-this._partiallyAcceptedSinceOriginal.ratio)*s.ratio,1),this._partiallyAcceptedSinceOriginal.count+=s.count,(r=(o=this.source.provider).handlePartialAccept)==null||r.call(o,this.source.inlineSuggestions,this.sourceInlineCompletion,e,t)}reportEndOfLife(e){if(!this._didReportEndOfLife&&(this._didReportEndOfLife=!0,this.reportInlineEditHidden(),e||(e=this._lastSetEndOfLifeReason??{kind:InlineCompletionEndOfLifeReasonKind$1.Ignored,userTypingDisagreed:!1,supersededBy:void 0}),e.kind===InlineCompletionEndOfLifeReasonKind$1.Rejected&&this.source.provider.handleRejection&&this.source.provider.handleRejection(this.source.inlineSuggestions,this.sourceInlineCompletion),this.source.provider.handleEndOfLifetime)){const t={requestUuid:this.context.requestUuid,correlationId:this._correlationId,selectedSuggestionInfo:!!this.context.selectedSuggestionInfo,partiallyAccepted:this._partiallyAcceptedCount,partiallyAcceptedCountSinceOriginal:this._partiallyAcceptedSinceOriginal.count,partiallyAcceptedRatioSinceOriginal:this._partiallyAcceptedSinceOriginal.ratio,partiallyAcceptedCharactersSinceOriginal:this._partiallyAcceptedSinceOriginal.characters,shown:this._didShow,shownDuration:this._shownDuration,shownDurationUncollapsed:this._showUncollapsedDuration,preceeded:this._isPreceeded,timeUntilShown:this._timeUntilShown,timeUntilProviderRequest:this._providerRequestInfo.startTime-this._requestInfo.startTime,timeUntilProviderResponse:this._providerRequestInfo.endTime-this._requestInfo.startTime,editorType:this._viewData.editorType,languageId:this._requestInfo.languageId,requestReason:this._requestInfo.reason,viewKind:this._viewData.viewKind,notShownReason:this._notShownReason,error:this._viewData.error,typingInterval:this._requestInfo.typingInterval,typingIntervalCharacterCount:this._requestInfo.typingIntervalCharacterCount,availableProviders:this._requestInfo.availableProviders.map(s=>s.toString()).join(","),...this._viewData.renderData};this.source.provider.handleEndOfLifetime(this.source.inlineSuggestions,this.sourceInlineCompletion,e,t)}}reportInlineEditError(e){this._viewData.error?this._viewData.error+=`; ${e}`:this._viewData.error=e}setIsPreceeded(e){this._isPreceeded=!0,(this._partiallyAcceptedSinceOriginal.characters!==0||this._partiallyAcceptedSinceOriginal.ratio!==0||this._partiallyAcceptedSinceOriginal.count!==0)&&console.warn("Expected partiallyAcceptedCountSinceOriginal to be { characters: 0, rate: 0, partialAcceptances: 0 } before setIsPreceeded."),this._partiallyAcceptedSinceOriginal=e}setNotShownReason(e){this._notShownReason??(this._notShownReason=e)}setEndOfLifeReason(e){this.reportInlineEditHidden(),this._lastSetEndOfLifeReason=e}updateShownDuration(e){const t=Date.now();this._showStartTime||(this._showStartTime=t);const s=e===InlineCompletionViewKind.Collapsed;!s&&this._showUncollapsedStartTime===void 0&&(this._showUncollapsedStartTime=t),s&&this._showUncollapsedStartTime!==void 0&&(this._showUncollapsedDuration+=t-this._showUncollapsedStartTime)}reportInlineEditHidden(){if(this._showStartTime===void 0)return;const e=Date.now();this._shownDuration+=e-this._showStartTime,this._showStartTime=void 0,this._showUncollapsedStartTime!==void 0&&(this._showUncollapsedDuration+=e-this._showUncollapsedStartTime,this._showUncollapsedStartTime=void 0)}}var InlineCompletionEditorType;(function(a){a.TextEditor="textEditor",a.DiffEditor="diffEditor",a.Notebook="notebook"})(InlineCompletionEditorType||(InlineCompletionEditorType={}));class InlineSuggestionList{constructor(e,t,s){this.inlineSuggestions=e,this.inlineSuggestionsData=t,this.provider=s,this.refCount=0}addRef(){this.refCount++}removeRef(e={kind:"other"}){if(this.refCount--,this.refCount===0){for(const t of this.inlineSuggestionsData)t.reportEndOfLife();this.provider.disposeInlineCompletions(this.inlineSuggestions,e)}}}function getDefaultRange(a,e){const t=e.getWordAtPosition(a),s=e.getLineMaxColumn(a.lineNumber);return t?new Range$2(a.lineNumber,t.startColumn,a.lineNumber,s):Range$2.fromPositions(a,a.with(void 0,s))}function closeBrackets(a,e,t,s){const o=t.getLineContent(e.lineNumber),r=StringReplacement.replace(new OffsetRange(e.column-1,o.length),a),l=t.tokenization.tokenizeLinesAt(e.lineNumber,[r.replace(o)]),c=l==null?void 0:l[0].sliceZeroCopy(r.getRangeAfterReplace());return c?fixBracketsInLine(c,s):a}var __decorate$1s=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1r=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},InlineCompletionsSource_1,Wi;let InlineCompletionsSource=(Wi=class extends Disposable{constructor(e,t,s,o,r,l,c,d){super(),this._textModel=e,this._versionId=t,this._debounceValue=s,this._cursorPosition=o,this._languageConfigurationService=r,this._logService=l,this._configurationService=c,this._instantiationService=d,this._updateOperation=this._register(new MutableDisposable),this._state=observableReducerSettable(this,{initial:()=>({inlineCompletions:InlineCompletionsState.createEmpty(),suggestWidgetInlineCompletions:InlineCompletionsState.createEmpty()}),disposeFinal:u=>{u.inlineCompletions.dispose(),u.suggestWidgetInlineCompletions.dispose()},changeTracker:recordChangesLazy(()=>({versionId:this._versionId})),update:(u,g,f)=>{const p=StringEdit.compose(f.changes.map(m=>m.change?offsetEditFromContentChanges(m.change.changes):StringEdit.empty).filter(isDefined));if(p.isEmpty())return g;try{return{inlineCompletions:g.inlineCompletions.createStateWithAppliedEdit(p,this._textModel),suggestWidgetInlineCompletions:g.suggestWidgetInlineCompletions.createStateWithAppliedEdit(p,this._textModel)}}finally{g.inlineCompletions.dispose(),g.suggestWidgetInlineCompletions.dispose()}}}),this.inlineCompletions=this._state.map(this,u=>u.inlineCompletions),this.suggestWidgetInlineCompletions=this._state.map(this,u=>u.suggestWidgetInlineCompletions),this.clearOperationOnTextModelChange=derived(this,u=>{this._versionId.read(u),this._updateOperation.clear()}),this._loadingCount=observableValue(this,0),this._loggingEnabled=observableConfigValue("editor.inlineSuggest.logFetch",!1,this._configurationService).recomputeInitiallyAndOnChange(this._store),this._sendRequestData=observableConfigValue("editor.inlineSuggest.emptyResponseInformation",!0,this._configurationService).recomputeInitiallyAndOnChange(this._store),this._structuredFetchLogger=this._register(this._instantiationService.createInstance(StructuredLogger.cast(),"editor.inlineSuggest.logFetch.commandId")),this.clearOperationOnTextModelChange.recomputeInitiallyAndOnChange(this._store)}_log(e){this._loggingEnabled.get()&&this._logService.info(formatRecordableLogEntry(e)),this._structuredFetchLogger.log(e)}fetch(e,t,s,o,r,l,c){var C,b;const d=this._cursorPosition.get(),u=new UpdateRequest(d,s,this._textModel.getVersionId(),new Set(e)),g=s.selectedSuggestionInfo?this.suggestWidgetInlineCompletions.get():this.inlineCompletions.get();if((C=this._updateOperation.value)!=null&&C.request.satisfies(u))return this._updateOperation.value.promise;if((b=g==null?void 0:g.request)!=null&&b.satisfies(u))return Promise.resolve(!0);const f=!!this._updateOperation.value;this._updateOperation.clear();const p=new CancellationTokenSource$1,m=(async()=>{this._loadingCount.set(this._loadingCount.get()+1,void 0);const v=new DisposableStore,S=e.filter(w=>w.providerId),y=new RequestResponseData(s,c,S);try{const w=this._debounceValue.get(this._textModel),L=findLastMax(e.map(P=>P.debounceDelayMs),compareUndefinedSmallest(numberComparator))??w;if((f||r&&s.triggerKind===InlineCompletionTriggerKind$1.Automatic)&&await wait(L,p.token),p.token.isCancellationRequested||this._store.isDisposed||this._textModel.getVersionId()!==u.versionId)return y.setNoSuggestionReasonIfNotSet("canceled:beforeFetch"),!1;const E=InlineCompletionsSource_1._requestId++;(this._loggingEnabled.get()||this._structuredFetchLogger.isEnabled.get())&&this._log({sourceId:"InlineCompletions.fetch",kind:"start",requestId:E,modelUri:this._textModel.uri,modelVersion:this._textModel.getVersionId(),context:{triggerKind:s.triggerKind,suggestInfo:s.selectedSuggestionInfo?!0:void 0},time:Date.now(),provider:t});const I=new Date,D=provideInlineCompletions(e,this._cursorPosition.get(),this._textModel,s,c,this._languageConfigurationService);runWhenCancelled(p.token,()=>D.cancelAndDispose({kind:"tokenCancellation"}));let k=!1,N=!1;const R=[];for await(const P of D.lists)if(P){P.addRef(),v.add(toDisposable(()=>P.removeRef(P.inlineSuggestionsData.length===0?{kind:"empty"}:{kind:"notTaken"})));for(const W of P.inlineSuggestionsData){if(N=!0,!s.includeInlineEdits&&(W.isInlineEdit||W.showInlineEditMenu)){W.setNotShownReason("notInlineEditRequested");continue}if(!s.includeInlineCompletions&&!(W.isInlineEdit||W.showInlineEditMenu)){W.setNotShownReason("notInlineCompletionRequested");continue}const B=InlineSuggestionItem.create(W,this._textModel);R.push(B),!B.isInlineEdit&&!B.showInlineEditMenu&&s.triggerKind===InlineCompletionTriggerKind$1.Automatic&&B.isVisible(this._textModel,this._cursorPosition.get())&&(k=!0)}if(k)break}if(D.cancelAndDispose({kind:"lostRace"}),this._loggingEnabled.get()||this._structuredFetchLogger.isEnabled.get()){const P=D.didAllProvidersReturn;let W;(p.token.isCancellationRequested||this._store.isDisposed||this._textModel.getVersionId()!==u.versionId)&&(W="canceled");const B=R.map(H=>({range:H.editRange.toString(),text:H.insertText,isInlineEdit:!!H.isInlineEdit,source:H.source.provider.groupId}));this._log({sourceId:"InlineCompletions.fetch",kind:"end",requestId:E,durationMs:Date.now()-I.getTime(),error:W,result:B,time:Date.now(),didAllProvidersReturn:P})}y.setRequestUuid(D.contextWithUuid.requestUuid),N?(y.setHasProducedSuggestion(),R.length>0&&p.token.isCancellationRequested&&R.forEach(P=>P.setNotShownReasonIfNotSet("canceled:whileAwaitingOtherProviders"))):p.token.isCancellationRequested?y.setNoSuggestionReasonIfNotSet("canceled:whileFetching"):y.setNoSuggestionReasonIfNotSet("noSuggestion");const M=s.earliestShownDateTime-Date.now();if(M>0&&await wait(M,p.token),p.token.isCancellationRequested||this._store.isDisposed||this._textModel.getVersionId()!==u.versionId||l.get()){const P=p.token.isCancellationRequested?"canceled:afterMinShowDelay":this._store.isDisposed?"canceled:disposed":this._textModel.getVersionId()!==u.versionId?"canceled:documentChanged":l.get()?"canceled:userJumped":"unknown";return R.forEach(W=>W.setNotShownReasonIfNotSet(P)),!1}const A=new Date;this._debounceValue.update(this._textModel,A.getTime()-I.getTime());const O=this._cursorPosition.get();this._updateOperation.clear(),transaction(P=>{const W=this._state.get();s.selectedSuggestionInfo?this._state.set({inlineCompletions:InlineCompletionsState.createEmpty(),suggestWidgetInlineCompletions:W.suggestWidgetInlineCompletions.createStateWithAppliedResults(R,u,this._textModel,O,o)},P):this._state.set({inlineCompletions:W.inlineCompletions.createStateWithAppliedResults(R,u,this._textModel,O,o),suggestWidgetInlineCompletions:InlineCompletionsState.createEmpty()},P),W.inlineCompletions.dispose(),W.suggestWidgetInlineCompletions.dispose()})}finally{this._loadingCount.set(this._loadingCount.get()-1,void 0),v.dispose(),this.sendInlineCompletionsRequestTelemetry(y)}return!0})(),_=new UpdateOperation(u,p,m);return this._updateOperation.value=_,m}clear(e){this._updateOperation.clear();const t=this._state.get();this._state.set({inlineCompletions:InlineCompletionsState.createEmpty(),suggestWidgetInlineCompletions:InlineCompletionsState.createEmpty()},e),t.inlineCompletions.dispose(),t.suggestWidgetInlineCompletions.dispose()}seedInlineCompletionsWithSuggestWidget(){const e=this.inlineCompletions.get(),t=this.suggestWidgetInlineCompletions.get();t&&transaction(s=>{var o,r;if(!e||(((o=t.request)==null?void 0:o.versionId)??-1)>(((r=e.request)==null?void 0:r.versionId)??-1)){e==null||e.dispose();const l=this._state.get();this._state.set({inlineCompletions:t.clone(),suggestWidgetInlineCompletions:InlineCompletionsState.createEmpty()},s),l.inlineCompletions.dispose(),l.suggestWidgetInlineCompletions.dispose()}this.clearSuggestWidgetInlineCompletions(s)})}sendInlineCompletionsRequestTelemetry(e){if(!this._sendRequestData.get()||e.requestUuid===void 0||e.hasProducedSuggestion)return;const t={id:e.requestUuid,opportunityId:e.requestUuid,noSuggestionReason:e.noSuggestionReason??"unknown",extensionId:"vscode-core",extensionVersion:"0.0.0",groupId:"empty",shown:!1,editorType:e.requestInfo.editorType,requestReason:e.requestInfo.reason,typingInterval:e.requestInfo.typingInterval,typingIntervalCharacterCount:e.requestInfo.typingIntervalCharacterCount,languageId:e.requestInfo.languageId,selectedSuggestionInfo:!!e.context.selectedSuggestionInfo,availableProviders:e.providers.map(o=>{var r;return(r=o.providerId)==null?void 0:r.toString()}).filter(isDefined).join(","),...forwardToChannelIf(e.providers.some(o=>{var r;return isCopilotLikeExtension((r=o.providerId)==null?void 0:r.extensionId)})),timeUntilProviderRequest:void 0,timeUntilProviderResponse:void 0,viewKind:void 0,preceeded:void 0,error:void 0,superseded:void 0,reason:void 0,correlationId:void 0,shownDuration:void 0,shownDurationUncollapsed:void 0,timeUntilShown:void 0,partiallyAccepted:void 0,partiallyAcceptedCountSinceOriginal:void 0,partiallyAcceptedRatioSinceOriginal:void 0,partiallyAcceptedCharactersSinceOriginal:void 0,cursorColumnDistance:void 0,cursorLineDistance:void 0,lineCountOriginal:void 0,lineCountModified:void 0,characterCountOriginal:void 0,characterCountModified:void 0,disjointReplacements:void 0,sameShapeReplacements:void 0,notShownReason:void 0},s=this._instantiationService.createInstance(DataChannelForwardingTelemetryService);sendInlineCompletionsEndOfLifeTelemetry(s,t)}clearSuggestWidgetInlineCompletions(e){var t;(t=this._updateOperation.value)!=null&&t.request.context.selectedSuggestionInfo&&this._updateOperation.clear()}cancelUpdate(){this._updateOperation.clear()}},InlineCompletionsSource_1=Wi,Wi._requestId=0,Wi);InlineCompletionsSource=InlineCompletionsSource_1=__decorate$1s([__param$1r(4,ILanguageConfigurationService),__param$1r(5,ILogService),__param$1r(6,IConfigurationService),__param$1r(7,IInstantiationService)],InlineCompletionsSource);class UpdateRequest{constructor(e,t,s,o){this.position=e,this.context=t,this.versionId=s,this.providers=o}satisfies(e){return this.position.equals(e.position)&&equalsIfDefined(this.context.selectedSuggestionInfo,e.context.selectedSuggestionInfo,itemEquals())&&(e.context.triggerKind===InlineCompletionTriggerKind$1.Automatic||this.context.triggerKind===InlineCompletionTriggerKind$1.Explicit)&&this.versionId===e.versionId&&isSubset(e.providers,this.providers)}}class RequestResponseData{constructor(e,t,s){this.context=e,this.requestInfo=t,this.providers=s,this.hasProducedSuggestion=!1}setRequestUuid(e){this.requestUuid=e}setNoSuggestionReasonIfNotSet(e){this.noSuggestionReason??(this.noSuggestionReason=e)}setHasProducedSuggestion(){this.hasProducedSuggestion=!0}}function isSubset(a,e){return[...a].every(t=>e.has(t))}class UpdateOperation{constructor(e,t,s){this.request=e,this.cancellationTokenSource=t,this.promise=s}dispose(){this.cancellationTokenSource.cancel()}}class InlineCompletionsState extends Disposable{static createEmpty(){return new InlineCompletionsState([],void 0)}constructor(e,t){for(const s of e)s.addRef();super(),this.inlineCompletions=e,this.request=t,this._register({dispose:()=>{for(const s of this.inlineCompletions)s.removeRef()}})}_findById(e){return this.inlineCompletions.find(t=>t.identity===e)}_findByHash(e){return this.inlineCompletions.find(t=>t.hash===e)}createStateWithAppliedEdit(e,t){const s=this.inlineCompletions.map(o=>o.withEdit(e,t)).filter(isDefined);return new InlineCompletionsState(s,this.request)}createStateWithAppliedResults(e,t,s,o,r){let l;if(r){const u=this._findById(r);if(u&&u.canBeReused(s,t.position)){l=u;const g=e.find(f=>f.hash===u.hash);g?e=moveToFront(g,e):e=[u,...e]}}const c=l?!l.isInlineEdit:e.some(u=>!u.isInlineEdit&&u.isVisible(s,o));let d=[];for(const u of e){const g=this._findByHash(u.hash);let f;g&&g!==u?(f=u.withIdentity(g.identity),u.setIsPreceeded(g),g.setEndOfLifeReason({kind:InlineCompletionEndOfLifeReasonKind$1.Ignored,userTypingDisagreed:!1,supersededBy:u.getSourceCompletion()})):f=u,c!==f.isInlineEdit&&d.push(f)}return d.sort(compareBy(u=>u.showInlineEditMenu,booleanComparator)),d=distinctByKey(d,u=>u.semanticId),new InlineCompletionsState(d,t)}clone(){return new InlineCompletionsState(this.inlineCompletions,this.request)}}function distinctByKey(a,e){const t=new Set;return a.filter(s=>{const o=e(s);return t.has(o)?!1:(t.add(o),!0)})}function moveToFront(a,e){const t=e.indexOf(a);return t>-1?[a,...e.slice(0,t),...e.slice(t+1)]:e}class InlineEdit{constructor(e,t,s){this.edit=e,this.commands=t,this.inlineCompletion=s}equals(e){return this.edit.equals(e.edit)&&this.inlineCompletion===e.inlineCompletion}}var __decorate$1r=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1q=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const IInlineCompletionsService=createDecorator("IInlineCompletionsService"),InlineCompletionsSnoozing=new RawContextKey("inlineCompletions.snoozed",!1,localize(76,"Whether inline completions are currently snoozed"));let InlineCompletionsService=class extends Disposable{get snoozeTimeLeft(){return this._snoozeTimeEnd===void 0?0:Math.max(0,this._snoozeTimeEnd-Date.now())}constructor(e,t){super(),this._contextKeyService=e,this._telemetryService=t,this._onDidChangeIsSnoozing=this._register(new Emitter$1),this.onDidChangeIsSnoozing=this._onDidChangeIsSnoozing.event,this._snoozeTimeEnd=void 0,this._recentCompletionIds=[],this._timer=this._register(new WindowIntervalTimer);const s=InlineCompletionsSnoozing.bindTo(this._contextKeyService);this._register(this.onDidChangeIsSnoozing(()=>s.set(this.isSnoozing())))}setSnoozeDuration(e){if(e<0)throw new BugIndicatingError(`Invalid snooze duration: ${e}. Duration must be non-negative.`);if(e===0){this.cancelSnooze();return}const t=this.isSnoozing(),s=this.snoozeTimeLeft;this._snoozeTimeEnd=Date.now()+e,t||this._onDidChangeIsSnoozing.fire(!0),this._timer.cancelAndSet(()=>{if(!this.isSnoozing())this._onDidChangeIsSnoozing.fire(!1);else throw new BugIndicatingError("Snooze timer did not fire as expected")},this.snoozeTimeLeft+1),this._reportSnooze(e-s,e)}isSnoozing(){return this.snoozeTimeLeft>0}cancelSnooze(){this.isSnoozing()&&(this._reportSnooze(-this.snoozeTimeLeft,0),this._snoozeTimeEnd=void 0,this._timer.cancel(),this._onDidChangeIsSnoozing.fire(!1))}reportNewCompletion(e){this._lastCompletionId=e,this._recentCompletionIds.unshift(e),this._recentCompletionIds.length>5&&this._recentCompletionIds.pop()}_reportSnooze(e,t){const s=Math.round(e/1e3),o=Math.round(t/1e3);this._telemetryService.publicLog2("inlineCompletions.snooze",{deltaSeconds:s,totalSeconds:o,lastCompletionId:this._lastCompletionId,recentCompletionIds:this._recentCompletionIds})}};InlineCompletionsService=__decorate$1r([__param$1q(0,IContextKeyService),__param$1q(1,ITelemetryService)],InlineCompletionsService);registerSingleton(IInlineCompletionsService,InlineCompletionsService,1);const snoozeInlineSuggestId="editor.action.inlineSuggest.snooze",cancelSnoozeInlineSuggestId="editor.action.inlineSuggest.cancelSnooze",LAST_SNOOZE_DURATION_KEY="inlineCompletions.lastSnoozeDuration",zs=class zs extends Action2{constructor(){super({id:zs.ID,title:localize2(78,"Snooze Inline Suggestions"),precondition:ContextKeyExpr.true(),f1:!0})}async run(e,...t){const s=e.get(IQuickInputService),o=e.get(IInlineCompletionsService),r=e.get(IStorageService);let l;t.length>0&&typeof t[0]=="number"&&(l=t[0]),l||(l=await this.getDurationFromUser(s,r)),l&&o.setSnoozeDuration(l)}async getDurationFromUser(e,t){const s=t.getNumber(LAST_SNOOZE_DURATION_KEY,0,3e5),o=[{label:"1 minute",id:"1",value:6e4},{label:"5 minutes",id:"5",value:3e5},{label:"10 minutes",id:"10",value:6e5},{label:"15 minutes",id:"15",value:9e5},{label:"30 minutes",id:"30",value:18e5},{label:"60 minutes",id:"60",value:36e5}],r=await e.pick(o,{placeHolder:localize(77,"Select snooze duration for Code completions and NES"),activeItem:o.find(l=>l.value===s)});if(r)return t.store(LAST_SNOOZE_DURATION_KEY,r.value,0,0),r.value}};zs.ID=snoozeInlineSuggestId;let SnoozeInlineCompletion=zs;const Us=class Us extends Action2{constructor(){super({id:Us.ID,title:localize2(79,"Cancel Snooze Inline Suggestions"),precondition:InlineCompletionsSnoozing,f1:!0})}async run(e){e.get(IInlineCompletionsService).cancelSnooze()}};Us.ID=cancelSnoozeInlineSuggestId;let CancelSnoozeInlineCompletion=Us;const Ee=class Ee extends Disposable{getTypingInterval(){return(this._cacheInvalidated||this._cachedTypingIntervalResult===null)&&(this._cachedTypingIntervalResult=this._calculateTypingInterval(),this._cacheInvalidated=!1),this._cachedTypingIntervalResult}constructor(e){super(),this._textModel=e,this._typingSessions=[],this._currentSession=null,this._lastChangeTime=0,this._cachedTypingIntervalResult=null,this._cacheInvalidated=!0,this._register(this._textModel.onDidChangeContent(t=>this._updateTypingSpeed(t)))}_updateTypingSpeed(e){const t=Date.now();if(!this._isUserTyping(e)){this._finalizeCurrentSession();return}this._currentSession&&t-this._lastChangeTime>Ee.MAX_SESSION_GAP_MS&&this._finalizeCurrentSession(),this._currentSession||(this._currentSession={startTime:t,endTime:t,characterCount:0}),this._currentSession.endTime=t,this._currentSession.characterCount+=this._getActualCharacterCount(e),this._lastChangeTime=t,this._cacheInvalidated=!0}_getActualCharacterCount(e){let t=0;for(const s of e.changes)t+=Math.max(s.text.length,s.rangeLength);return t}_isUserTyping(e){if(!e.detailedReasons||e.detailedReasons.length===0)return!1;for(const t of e.detailedReasons)if(this._isUserTypingReason(t))return!0;return!1}_isUserTypingReason(e){if(e.metadata.isUndoing||e.metadata.isRedoing)return!1;switch(e.metadata.source){case"cursor":{const t=e.metadata.kind;return t==="type"||t==="compositionType"||t==="compositionEnd"}default:return!1}}_finalizeCurrentSession(){if(!this._currentSession)return;this._currentSession.endTime-this._currentSession.startTime>=Ee.MIN_SESSION_DURATION_MS&&this._currentSession.characterCount>0&&(this._typingSessions.push(this._currentSession),this._typingSessions.length>Ee.SESSION_HISTORY_LIMIT&&this._typingSessions.shift()),this._currentSession=null}_calculateTypingInterval(){if(this._currentSession){const e={...this._currentSession};if(e.endTime-e.startTime>=Ee.MIN_SESSION_DURATION_MS&&e.characterCount>0){const s=[...this._typingSessions,e];return this._calculateSpeedFromSessions(s)}}return this._calculateSpeedFromSessions(this._typingSessions)}_calculateSpeedFromSessions(e){if(e.length===0)return{averageInterval:0,characterCount:0};const t=[...e].sort((g,f)=>f.endTime-g.endTime),s=Date.now()-Ee.TYPING_SPEED_WINDOW_MS,o=t.filter(g=>g.endTime>s),r=t.splice(o.length);let l=sum(o.map(g=>g.characterCount));for(let g=0;g<r.length&&l<Ee.MIN_CHARS_FOR_RELIABLE_SPEED;g++)o.push(r[g]),l+=r[g].characterCount;const c=sum(o.map(g=>g.endTime-g.startTime));if(c===0||l<=1)return{averageInterval:0,characterCount:l};const d=Math.max(1,l-1),u=c/d;return{averageInterval:Math.round(u),characterCount:l}}dispose(){this._finalizeCurrentSession(),super.dispose()}};Ee.MAX_SESSION_GAP_MS=3e3,Ee.MIN_SESSION_DURATION_MS=1e3,Ee.SESSION_HISTORY_LIMIT=50,Ee.TYPING_SPEED_WINDOW_MS=3e5,Ee.MIN_CHARS_FOR_RELIABLE_SPEED=20;let TypingInterval=Ee;var __decorate$1q=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1p=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let InlineCompletionsModel=class extends Disposable{get isAcceptingPartially(){return this._isAcceptingPartially}constructor(e,t,s,o,r,l,c,d,u,g,f,p,m,_){super(),this.textModel=e,this._selectedSuggestItem=t,this._textModelVersionId=s,this._positions=o,this._debounceValue=r,this._enabled=l,this._editor=c,this._instantiationService=d,this._commandService=u,this._languageConfigurationService=g,this._accessibilityService=f,this._languageFeaturesService=p,this._codeEditorService=m,this._inlineCompletionsService=_,this._isActive=observableValue(this,!1),this._onlyRequestInlineEditsSignal=observableSignal(this),this._forceUpdateExplicitlySignal=observableSignal(this),this._noDelaySignal=observableSignal(this),this._fetchSpecificProviderSignal=observableSignal(this),this._selectedInlineCompletionId=observableValue(this,void 0),this.primaryPosition=derived(this,w=>this._positions.read(w)[0]??new Position$1(1,1)),this._isAcceptingPartially=!1,this._appearedInsideViewport=derived(this,w=>{const L=this.state.read(w);if(!L||!L.inlineCompletion)return!1;const x=L.inlineCompletion.targetRange,E=this._editorObs.editor.getVisibleRanges();return E.length<1?!1:new Range$2(E[0].startLineNumber,E[0].startColumn,E[E.length-1].endLineNumber,E[E.length-1].endColumn).containsRange(x)}),this._onDidAccept=new Emitter$1,this.onDidAccept=this._onDidAccept.event,this._lastShownInlineCompletionInfo=void 0,this._lastAcceptedInlineCompletionInfo=void 0,this._didUndoInlineEdits=derivedHandleChanges({owner:this,changeTracker:{createChangeSummary:()=>({didUndo:!1}),handleChange:(w,L)=>{var x;return L.didUndo=w.didChange(this._textModelVersionId)&&!!((x=w.change)!=null&&x.isUndoing),!0}}},(w,L)=>{const x=this._textModelVersionId.read(w);return x!==null&&this._lastAcceptedInlineCompletionInfo&&this._lastAcceptedInlineCompletionInfo.textModelVersionIdAfter===x-1&&this._lastAcceptedInlineCompletionInfo.inlineCompletion.isInlineEdit&&L.didUndo?(this._lastAcceptedInlineCompletionInfo=void 0,!0):!1}),this._preserveCurrentCompletionReasons=new Set([VersionIdChangeReason.Redo,VersionIdChangeReason.Undo,VersionIdChangeReason.AcceptWord]),this.dontRefetchSignal=observableSignal(this),this._fetchInlineCompletionsPromise=derivedHandleChanges({owner:this,changeTracker:{createChangeSummary:()=>({dontRefetch:!1,preserveCurrentCompletion:!1,inlineCompletionTriggerKind:InlineCompletionTriggerKind$1.Automatic,onlyRequestInlineEdits:!1,shouldDebounce:!0,provider:void 0,textChange:!1,changeReason:""}),handleChange:(w,L)=>{var x;if(w.didChange(this._textModelVersionId)){this._preserveCurrentCompletionReasons.has(this._getReason(w.change))&&(L.preserveCurrentCompletion=!0);const E=((x=w.change)==null?void 0:x.detailedReasons)??[];L.changeReason=E.length>0?E[0].getType():"",L.textChange=!0}else w.didChange(this._forceUpdateExplicitlySignal)?(L.preserveCurrentCompletion=!0,L.inlineCompletionTriggerKind=InlineCompletionTriggerKind$1.Explicit):w.didChange(this.dontRefetchSignal)?L.dontRefetch=!0:w.didChange(this._onlyRequestInlineEditsSignal)?L.onlyRequestInlineEdits=!0:w.didChange(this._fetchSpecificProviderSignal)&&(L.provider=w.change);return!0}}},(w,L)=>{var B,H,V;if(this._source.clearOperationOnTextModelChange.read(w),this._noDelaySignal.read(w),this.dontRefetchSignal.read(w),this._onlyRequestInlineEditsSignal.read(w),this._forceUpdateExplicitlySignal.read(w),this._fetchSpecificProviderSignal.read(w),!((this._enabled.read(w)&&this._selectedSuggestItem.read(w)||this._isActive.read(w))&&(!this._inlineCompletionsService.isSnoozing()||L.inlineCompletionTriggerKind===InlineCompletionTriggerKind$1.Explicit))){this._source.cancelUpdate();return}this._textModelVersionId.read(w);const E=this._source.suggestWidgetInlineCompletions.read(void 0);let I=this._selectedSuggestItem.read(w);if(this._shouldShowOnSuggestConflict.read(void 0)&&(I=void 0),E&&!I&&this._source.seedInlineCompletionsWithSuggestWidget(),L.dontRefetch)return Promise.resolve(!0);if(this._didUndoInlineEdits.read(w)&&L.inlineCompletionTriggerKind!==InlineCompletionTriggerKind$1.Explicit){transaction(K=>{this._source.clear(K)});return}let D="";L.provider?D+="providerOnDidChange":L.inlineCompletionTriggerKind===InlineCompletionTriggerKind$1.Explicit&&(D+="explicit"),L.changeReason&&(D+=D.length>0?`:${L.changeReason}`:L.changeReason);const k=this._typing.getTypingInterval(),N={editorType:this.editorType,startTime:Date.now(),languageId:this.textModel.getLanguageId(),reason:D,typingInterval:k.averageInterval,typingIntervalCharacterCount:k.characterCount,availableProviders:[]};let R={triggerKind:L.inlineCompletionTriggerKind,selectedSuggestionInfo:I==null?void 0:I.toSelectedSuggestionInfo(),includeInlineCompletions:!L.onlyRequestInlineEdits,includeInlineEdits:this._inlineEditsEnabled.read(w),requestIssuedDateTime:N.startTime,earliestShownDateTime:N.startTime+(L.inlineCompletionTriggerKind===InlineCompletionTriggerKind$1.Explicit||this.inAcceptFlow.read(void 0)?0:this._minShowDelay.read(void 0))};R.triggerKind===InlineCompletionTriggerKind$1.Automatic&&L.textChange&&this.textModel.getAlternativeVersionId()===((B=this._lastShownInlineCompletionInfo)==null?void 0:B.alternateTextModelVersionId)&&(R={...R,includeInlineCompletions:!this._lastShownInlineCompletionInfo.inlineCompletion.isInlineEdit,includeInlineEdits:this._lastShownInlineCompletionInfo.inlineCompletion.isInlineEdit});const M=this.selectedInlineCompletion.read(void 0)??((H=this._inlineCompletionItems.read(void 0))==null?void 0:H.inlineEdit),A=L.preserveCurrentCompletion||M!=null&&M.forwardStable?M:void 0,O=this._jumpedToId.map(K=>{var z,G;return!!K&&K===((G=(z=this._inlineCompletionItems.read(void 0))==null?void 0:z.inlineEdit)==null?void 0:G.semanticId)}),P=L.provider?{providers:[L.provider],label:"single:"+((V=L.provider.providerId)==null?void 0:V.toString())}:{providers:this._languageFeaturesService.inlineCompletionsProvider.all(this.textModel),label:void 0},W=this.getAvailableProviders(P.providers);return N.availableProviders=W.map(K=>K.providerId).filter(isDefined),this._source.fetch(W,P.label,R,A==null?void 0:A.identity,L.shouldDebounce,O,N)}),this._inlineCompletionItems=derivedOpts({owner:this},w=>{const L=this._source.inlineCompletions.read(w);if(!L)return;const x=this.primaryPosition.read(w);let E;const I=[];for(const D of L.inlineCompletions)D.isInlineEdit?E=D:D.isVisible(this.textModel,x)&&I.push(D);return I.length!==0&&(E=void 0),{inlineCompletions:I,inlineEdit:E}}),this._filteredInlineCompletionItems=derivedOpts({owner:this,equalsFn:itemsEquals()},w=>{const L=this._inlineCompletionItems.read(w);return(L==null?void 0:L.inlineCompletions)??[]}),this.selectedInlineCompletionIndex=derived(this,w=>{const L=this._selectedInlineCompletionId.read(w),x=this._filteredInlineCompletionItems.read(w),E=this._selectedInlineCompletionId===void 0?-1:x.findIndex(I=>I.semanticId===L);return E===-1?(this._selectedInlineCompletionId.set(void 0,void 0),0):E}),this.selectedInlineCompletion=derived(this,w=>{const L=this._filteredInlineCompletionItems.read(w),x=this.selectedInlineCompletionIndex.read(w);return L[x]}),this.activeCommands=derivedOpts({owner:this,equalsFn:itemsEquals()},w=>{var L;return((L=this.selectedInlineCompletion.read(w))==null?void 0:L.source.inlineSuggestions.commands)??[]}),this.inlineCompletionsCount=derived(this,w=>{if(this.lastTriggerKind.read(w)===InlineCompletionTriggerKind$1.Explicit)return this._filteredInlineCompletionItems.read(w).length}),this._hasVisiblePeekWidgets=derived(this,w=>this._editorObs.openedPeekWidgets.read(w)>0),this._shouldShowOnSuggestConflict=derived(this,w=>{const L=this._showOnSuggestConflict.read(w);if(L!=="never"&&!!this.selectedInlineCompletion.read(w)){const E=this._selectedSuggestItem.read(w);return E?L==="whenSuggestListIsIncomplete"?E.listIncomplete:!0:!1}return!1}),this.state=derivedOpts({owner:this,equalsFn:(w,L)=>!w||!L?w===L:w.kind==="ghostText"&&L.kind==="ghostText"?ghostTextsOrReplacementsEqual(w.ghostTexts,L.ghostTexts)&&w.inlineCompletion===L.inlineCompletion&&w.suggestItem===L.suggestItem:w.kind==="inlineEdit"&&L.kind==="inlineEdit"?w.inlineEdit.equals(L.inlineEdit):!1},w=>{var D,k,N,R,M,A,O;const L=this.textModel;if(this._suppressInSnippetMode.read(w)&&this._isInSnippetMode.read(w))return;const x=this._inlineCompletionItems.read(w),E=x==null?void 0:x.inlineEdit;if(E){if(this._hasVisiblePeekWidgets.read(w))return;let P=E.getSingleTextEdit();P=singleTextRemoveCommonPrefix(P,L);const W=this.primaryPosition.map(G=>LineRange.fromRangeInclusive(E.targetRange).addMargin(1,1).contains(G.lineNumber)),B=E.source.inlineSuggestions.commands,H=new InlineEdit(P,B??[],E),V=E.updatedEdit,K=V?TextEdit.fromStringEdit(V,new TextModelText(this.textModel)).replacements:[P],z=(((k=(D=x.inlineEdit)==null?void 0:D.command)==null?void 0:k.id)==="vscode.open"||((R=(N=x.inlineEdit)==null?void 0:N.command)==null?void 0:R.id)==="_workbench.open")&&((A=(M=x.inlineEdit)==null?void 0:M.command.arguments)!=null&&A.length)?URI.from((O=x.inlineEdit)==null?void 0:O.command.arguments[0]):void 0;return{kind:"inlineEdit",inlineEdit:H,inlineCompletion:E,edits:K,cursorAtInlineEdit:W,nextEditUri:z}}const I=this._selectedSuggestItem.read(w);if(!this._shouldShowOnSuggestConflict.read(w)&&I){const P=singleTextRemoveCommonPrefix(I.getSingleTextEdit(),L),W=this._computeAugmentation(P,w);if(!this._suggestPreviewEnabled.read(w)&&!W)return;const H=(W==null?void 0:W.edit)??P,V=W?W.edit.text.length-P.text.length:0,K=this._suggestPreviewMode.read(w),z=this._positions.read(w),X=[H,...getSecondaryEdits(this.textModel,z,H)].map((ne,me)=>({edit:ne,ghostText:ne?computeGhostText(ne,L,K,z[me],V):void 0})).filter(({edit:ne,ghostText:me})=>ne!==void 0&&me!==void 0),Y=X.map(({edit:ne})=>ne),ee=X.map(({ghostText:ne})=>ne),le=ee[0]??new GhostText(H.range.endLineNumber,[]);return{kind:"ghostText",edits:Y,primaryGhostText:le,ghostTexts:ee,inlineCompletion:W==null?void 0:W.completion,suggestItem:I}}else{if(!this._isActive.read(w))return;const P=this.selectedInlineCompletion.read(w);if(!P)return;const W=P.getSingleTextEdit(),B=this._inlineSuggestMode.read(w),H=this._positions.read(w),K=[W,...getSecondaryEdits(this.textModel,H,W)].map((X,Y)=>({edit:X,ghostText:X?computeGhostText(X,L,B,H[Y],0):void 0})).filter(({edit:X,ghostText:Y})=>X!==void 0&&Y!==void 0),z=K.map(({edit:X})=>X),G=K.map(({ghostText:X})=>X);return G[0]?{kind:"ghostText",edits:z,primaryGhostText:G[0],ghostTexts:G,inlineCompletion:P,suggestItem:void 0}:void 0}}),this.inlineCompletionState=derived(this,w=>{const L=this.state.read(w);if(!(!L||L.kind!=="ghostText")&&!this._editorObs.inComposition.read(w))return L}),this.inlineEditState=derived(this,w=>{const L=this.state.read(w);if(!(!L||L.kind!=="inlineEdit"))return L}),this.inlineEditAvailable=derived(this,w=>!!this.inlineEditState.read(w)),this.warning=derived(this,w=>{var L,x;return(x=(L=this.inlineCompletionState.read(w))==null?void 0:L.inlineCompletion)==null?void 0:x.warning}),this.ghostTexts=derivedOpts({owner:this,equalsFn:ghostTextsOrReplacementsEqual},w=>{const L=this.inlineCompletionState.read(w);if(L)return L.ghostTexts}),this.primaryGhostText=derivedOpts({owner:this,equalsFn:ghostTextOrReplacementEquals},w=>{const L=this.inlineCompletionState.read(w);if(L)return L==null?void 0:L.primaryGhostText}),this.showCollapsed=derived(this,w=>{const L=this.state.read(w);if(!L||L.kind!=="inlineEdit"||L.inlineCompletion.displayLocation)return!1;const x=L.inlineCompletion.updatedEditModelVersion===this._textModelVersionId.read(w);return(this._inlineEditsShowCollapsedEnabled.read(w)||!x)&&this._jumpedToId.read(w)!==L.inlineCompletion.semanticId&&!this._inAcceptFlow.read(w)}),this._tabShouldIndent=derived(this,w=>{if(this._inAcceptFlow.read(w))return!1;function L(I){return I.startLineNumber!==I.endLineNumber}function x(I,D){const k=I.getLineIndentColumn(D),N=I.getLineLastNonWhitespaceColumn(D),R=Math.max(N,k);return new Range$2(D,k,D,R)}const E=this._editorObs.selections.read(w);return E==null?void 0:E.some(I=>I.isEmpty()?this.textModel.getLineLength(I.startLineNumber)===0:L(I)||I.containsRange(x(this.textModel,I.startLineNumber)))}),this.tabShouldJumpToInlineEdit=derived(this,w=>{if(this._tabShouldIndent.read(w))return!1;const L=this.inlineEditState.read(w);return L?this.showCollapsed.read(w)?!0:this._inAcceptFlow.read(w)&&this._appearedInsideViewport.read(w)?!1:!L.cursorAtInlineEdit.read(w):!1}),this.tabShouldAcceptInlineEdit=derived(this,w=>{const L=this.inlineEditState.read(w);return!L||this.showCollapsed.read(w)?!1:this._inAcceptFlow.read(w)&&this._appearedInsideViewport.read(w)||L.inlineCompletion.targetRange.startLineNumber===this._editorObs.cursorLineNumber.read(w)||this._jumpedToId.read(w)===L.inlineCompletion.semanticId?!0:this._tabShouldIndent.read(w)?!1:L.cursorAtInlineEdit.read(w)}),this._jumpedToId=observableValue(this,void 0),this._inAcceptFlow=observableValue(this,!1),this.inAcceptFlow=this._inAcceptFlow,this._source=this._register(this._instantiationService.createInstance(InlineCompletionsSource,this.textModel,this._textModelVersionId,this._debounceValue,this.primaryPosition)),this.lastTriggerKind=this._source.inlineCompletions.map(this,w=>{var L;return(L=w==null?void 0:w.request)==null?void 0:L.context.triggerKind}),this._editorObs=observableCodeEditor(this._editor);const C=this._editorObs.getOption(134);this._suggestPreviewEnabled=C.map(w=>w.preview),this._suggestPreviewMode=C.map(w=>w.previewMode);const b=this._editorObs.getOption(71);this._inlineSuggestMode=b.map(w=>w.mode),this._suppressedInlineCompletionGroupIds=b.map(w=>new Set(w.experimental.suppressInlineSuggestions.split(","))),this._inlineEditsEnabled=b.map(w=>!!w.edits.enabled),this._inlineEditsShowCollapsedEnabled=b.map(w=>w.edits.showCollapsed),this._triggerCommandOnProviderChange=b.map(w=>w.triggerCommandOnProviderChange),this._minShowDelay=b.map(w=>w.minShowDelay),this._showOnSuggestConflict=b.map(w=>w.experimental.showOnSuggestConflict),this._suppressInSnippetMode=b.map(w=>w.suppressInSnippetMode);const v=SnippetController2.get(this._editor);this._isInSnippetMode=(v==null?void 0:v.isInSnippetObservable)??constObservable(!1),this._typing=this._register(new TypingInterval(this.textModel)),this._register(this._inlineCompletionsService.onDidChangeIsSnoozing(w=>{w&&this.stop()}));{const w=this.textModel.uri.scheme==="vscode-notebook-cell",[L]=this._codeEditorService.listDiffEditors().filter(x=>x.getOriginalEditor().getId()===this._editor.getId()||x.getModifiedEditor().getId()===this._editor.getId());this.isInDiffEditor=!!L,this.editorType=w?InlineCompletionEditorType.Notebook:this.isInDiffEditor?InlineCompletionEditorType.DiffEditor:InlineCompletionEditorType.TextEditor}this._register(recomputeInitiallyAndOnChange(this.state,w=>{w&&w.inlineCompletion&&this._inlineCompletionsService.reportNewCompletion(w.inlineCompletion.requestUuid)})),this._register(recomputeInitiallyAndOnChange(this._fetchInlineCompletionsPromise)),this._register(autorun(w=>{this._editorObs.versionId.read(w),this._inAcceptFlow.set(!1,void 0)})),this._register(autorun(w=>{this.state.map((x,E)=>!x||x.kind==="inlineEdit"&&!x.cursorAtInlineEdit.read(E)).read(w)&&this._jumpedToId.set(void 0,void 0)}));const S=this.inlineEditState.map(w=>w==null?void 0:w.inlineCompletion.semanticId);this._register(autorun(w=>{S.read(w)&&(this._editor.pushUndoStop(),this._lastShownInlineCompletionInfo={alternateTextModelVersionId:this.textModel.getAlternativeVersionId(),inlineCompletion:this.state.get().inlineCompletion})}));const y=observableFromEvent(this._languageFeaturesService.inlineCompletionsProvider.onDidChange,()=>this._languageFeaturesService.inlineCompletionsProvider.all(e));mapObservableArrayCached(this,y,(w,L)=>{w.onDidChangeInlineCompletions&&L.add(w.onDidChangeInlineCompletions(()=>{var I;if(!this._enabled.get()||(this._codeEditorService.getFocusedCodeEditor()||this._codeEditorService.getActiveCodeEditor())!==this._editor)return;if(this._triggerCommandOnProviderChange.get()){this.trigger(void 0,{onlyFetchInlineEdits:!0});return}const E=this.state.get();E&&(E.inlineCompletion||E.edits)&&((I=E.inlineCompletion)==null?void 0:I.source.provider)!==w||transaction(D=>{this._fetchSpecificProviderSignal.trigger(D,w),this.trigger(D)})}))}).recomputeInitiallyAndOnChange(this._store),this._didUndoInlineEdits.recomputeInitiallyAndOnChange(this._store)}getIndentationInfo(e){let t=!1,s=!0;const o=this==null?void 0:this.primaryGhostText.read(e);if(this!=null&&this._selectedSuggestItem&&o&&o.parts.length>0){const{column:r,lines:l}=o.parts[0],c=l[0].line,d=this.textModel.getLineIndentColumn(o.lineNumber);if(r<=d){let g=firstNonWhitespaceIndex(c);g===-1&&(g=c.length-1),t=g>0;const f=this.textModel.getOptions().tabSize;s=CursorColumns.visibleColumnFromColumn(c,g+1,f)<f}}return{startsWithIndentation:t,startsWithIndentationLessThanTabSize:s}}_getReason(e){return e!=null&&e.isUndoing?VersionIdChangeReason.Undo:e!=null&&e.isRedoing?VersionIdChangeReason.Redo:this.isAcceptingPartially?VersionIdChangeReason.AcceptWord:VersionIdChangeReason.Other}getAvailableProviders(e){var l;const t=this._suppressedInlineCompletionGroupIds.get(),s=e.filter(c=>!(c.groupId&&t.has(c.groupId))),o=new Set;for(const c of s)(l=c.excludesGroupIds)==null||l.forEach(d=>o.add(d));const r=[];for(const c of s)c.groupId&&o.has(c.groupId)||r.push(c);return r}async trigger(e,t){subtransaction(e,s=>{t!=null&&t.onlyFetchInlineEdits&&this._onlyRequestInlineEditsSignal.trigger(s),t!=null&&t.noDelay&&this._noDelaySignal.trigger(s),this._isActive.set(!0,s)}),await this._fetchInlineCompletionsPromise.get()}async triggerExplicitly(e,t=!1){subtransaction(e,s=>{t&&this._onlyRequestInlineEditsSignal.trigger(s),this._isActive.set(!0,s),this._inAcceptFlow.set(!0,s),this._forceUpdateExplicitlySignal.trigger(s)}),await this._fetchInlineCompletionsPromise.get()}stop(e="automatic",t){subtransaction(t,s=>{var o;if(e==="explicitCancel"){const r=(o=this.state.get())==null?void 0:o.inlineCompletion;r&&r.reportEndOfLife({kind:InlineCompletionEndOfLifeReasonKind$1.Rejected})}this._isActive.set(!1,s),this._source.clear(s)})}_computeAugmentation(e,t){const s=this.textModel,o=this._source.suggestWidgetInlineCompletions.read(t),r=o?o.inlineCompletions.filter(c=>!c.isInlineEdit):[this.selectedInlineCompletion.read(t)].filter(isDefined);return mapFindFirst(r,c=>{let d=c.getSingleTextEdit();return d=singleTextRemoveCommonPrefix(d,s,Range$2.fromPositions(d.range.getStartPosition(),e.range.getEndPosition())),singleTextEditAugments(d,e)?{completion:c,edit:d}:void 0})}async _deltaSelectedInlineCompletionIndex(e){await this.triggerExplicitly();const t=this._filteredInlineCompletionItems.get()||[];if(t.length>0){const s=(this.selectedInlineCompletionIndex.get()+e+t.length)%t.length;this._selectedInlineCompletionId.set(t[s].semanticId,void 0)}else this._selectedInlineCompletionId.set(void 0,void 0)}async next(){await this._deltaSelectedInlineCompletionIndex(1)}async previous(){await this._deltaSelectedInlineCompletionIndex(-1)}_getMetadata(e,t,s=void 0){return s?EditSources.inlineCompletionPartialAccept({nes:e.isInlineEdit,requestUuid:e.requestUuid,providerId:e.source.provider.providerId,languageId:t,type:s}):EditSources.inlineCompletionAccept({nes:e.isInlineEdit,requestUuid:e.requestUuid,providerId:e.source.provider.providerId,languageId:t})}async accept(e=this._editor){var r;if(e.getModel()!==this.textModel)throw new BugIndicatingError;let t,s=!1;const o=this.state.get();if((o==null?void 0:o.kind)==="ghostText"){if(!o||o.primaryGhostText.isEmpty()||!o.inlineCompletion)return;t=o.inlineCompletion}else if((o==null?void 0:o.kind)==="inlineEdit")t=o.inlineCompletion,s=!!o.nextEditUri;else return;t.addRef();try{if(e.pushUndoStop(),!s)if(t.snippetInfo){const l=TextReplacement.delete(t.editRange),c=t.additionalTextEdits.map(u=>new TextReplacement(Range$2.lift(u.range),u.text??"")),d=TextEdit.fromParallelReplacementsUnsorted([l,...c]);e.edit(d,this._getMetadata(t,this.textModel.getLanguageId())),e.setPosition(t.snippetInfo.range.getStartPosition(),"inlineCompletionAccept"),(r=SnippetController2.get(e))==null||r.insert(t.snippetInfo.snippet,{undoStopBefore:!1})}else{const l=o.edits;let c=l;o.kind==="ghostText"&&(c=removeTextReplacementCommonSuffixPrefix(l,this.textModel));const d=getEndPositionsAfterApplying(c).map(f=>Selection$1.fromPositions(f)),u=t.additionalTextEdits.map(f=>new TextReplacement(Range$2.lift(f.range),f.text??"")),g=TextEdit.fromParallelReplacementsUnsorted([...l,...u]);if(e.edit(g,this._getMetadata(t,this.textModel.getLanguageId())),t.displayLocation===void 0&&e.setSelections(o.kind==="inlineEdit"?d.slice(-1):d,"inlineCompletionAccept"),o.kind==="inlineEdit"&&!this._accessibilityService.isMotionReduced()){const f=g.getNewRanges(),p=this._store.add(new FadeoutDecoration(e,f,()=>{this._store.delete(p)}))}}this._onDidAccept.fire(),this.stop(),t.command&&await this._commandService.executeCommand(t.command.id,...t.command.arguments||[]).then(void 0,onUnexpectedExternalError),t.reportEndOfLife({kind:InlineCompletionEndOfLifeReasonKind$1.Accepted})}finally{t.removeRef(),this._inAcceptFlow.set(!0,void 0),this._lastAcceptedInlineCompletionInfo={textModelVersionIdAfter:this.textModel.getVersionId(),inlineCompletion:t}}}async acceptNextWord(){await this._acceptNext(this._editor,"word",(e,t)=>{const s=this.textModel.getLanguageIdAtPosition(e.lineNumber,e.column),o=this._languageConfigurationService.getLanguageConfiguration(s),r=new RegExp(o.wordDefinition.source,o.wordDefinition.flags.replace("g","")),l=t.match(r);let c=0;l&&l.index!==void 0?l.index===0?c=l[0].length:c=l.index:c=t.length;const u=/\s+/g.exec(t);return u&&u.index!==void 0&&u.index+u[0].length<c&&(c=u.index+u[0].length),c},0)}async acceptNextLine(){await this._acceptNext(this._editor,"line",(e,t)=>{const s=t.match(/\n/);return s&&s.index!==void 0?s.index+1:t.length},1)}async _acceptNext(e,t,s,o){if(e.getModel()!==this.textModel)throw new BugIndicatingError;const r=this.inlineCompletionState.get();if(!r||r.primaryGhostText.isEmpty()||!r.inlineCompletion)return;const l=r.primaryGhostText,c=r.inlineCompletion;if(c.snippetInfo){await this.accept(e);return}const d=l.parts[0],u=new Position$1(l.lineNumber,d.column),g=d.text,f=s(u,g);if(f===g.length&&l.parts.length===1){this.accept(e);return}const p=g.substring(0,f),m=this._positions.get(),_=m[0];c.addRef();try{this._isAcceptingPartially=!0;try{e.pushUndoStop();const S=Range$2.fromPositions(_,u),y=e.getModel().getValueInRange(S)+p,w=new TextReplacement(S,y),L=[w,...getSecondaryEdits(this.textModel,m,w)].filter(isDefined),x=getEndPositionsAfterApplying(L).map(E=>Selection$1.fromPositions(E));e.edit(TextEdit.fromParallelReplacementsUnsorted(L),this._getMetadata(c,t)),e.setSelections(x,"inlineCompletionPartialAccept"),e.revealPositionInCenterIfOutsideViewport(e.getPosition(),1)}finally{this._isAcceptingPartially=!1}const C=Range$2.fromPositions(c.editRange.getStartPosition(),TextLength.ofText(p).addToPosition(u)),v=e.getModel().getValueInRange(C,1).length;c.reportPartialAccept(v,{kind:o,acceptedLength:v},{characters:f,ratio:f/g.length,count:1})}finally{c.removeRef()}}handleSuggestAccepted(e){const t=singleTextRemoveCommonPrefix(e.getSingleTextEdit(),this.textModel),s=this._computeAugmentation(t,void 0);if(!s)return;const r=this.textModel.getValueInRange(s.completion.editRange,1).length+t.text.length;s.completion.reportPartialAccept(t.text.length,{kind:2,acceptedLength:r},{characters:t.text.length,count:1,ratio:1})}extractReproSample(){var s;const e=this.textModel.getValue(),t=(s=this.state.get())==null?void 0:s.inlineCompletion;return{documentValue:e,inlineCompletion:t==null?void 0:t.getSourceCompletion()}}jump(){const e=this.inlineEditState.get();e&&transaction(t=>{this._jumpedToId.set(e.inlineCompletion.semanticId,t),this.dontRefetchSignal.trigger(t);const s=e.inlineCompletion.targetRange,o=s.getStartPosition();if(this._editor.setPosition(o,"inlineCompletions.jump"),s.isSingleLine()&&(e.inlineCompletion.displayLocation||!e.inlineCompletion.insertText.includes(`
`)))this._editor.revealPosition(o);else{const l=new Range$2(s.startLineNumber-1,1,s.endLineNumber+1,1);this._editor.revealRange(l,1)}this._editor.focus()})}async handleInlineSuggestionShown(e,t,s){await e.reportInlineEditShown(this._commandService,t,s)}};InlineCompletionsModel=__decorate$1q([__param$1p(7,IInstantiationService),__param$1p(8,ICommandService),__param$1p(9,ILanguageConfigurationService),__param$1p(10,IAccessibilityService),__param$1p(11,ILanguageFeaturesService),__param$1p(12,ICodeEditorService),__param$1p(13,IInlineCompletionsService)],InlineCompletionsModel);var VersionIdChangeReason;(function(a){a[a.Undo=0]="Undo",a[a.Redo=1]="Redo",a[a.AcceptWord=2]="AcceptWord",a[a.Other=3]="Other"})(VersionIdChangeReason||(VersionIdChangeReason={}));function getSecondaryEdits(a,e,t){if(e.length===1)return[];const s=new TextModelText(a),o=s.getTransformer(),r=o.getOffset(e[0]),l=e.slice(1).map(p=>o.getOffset(p));t=t.removeCommonPrefixAndSuffix(s);const c=o.getStringReplacement(t),d=c.replaceRange.start-r,u=c.replaceRange.join(OffsetRange.emptyAt(r)),g=s.getValueOfOffsetRange(u);return l.map(p=>{const m=p+d,_=m+c.replaceRange.length,C=new OffsetRange(m,_),b=C.join(OffsetRange.emptyAt(p));if(s.getValueOfOffsetRange(b)!==g)return;const S=new StringReplacement(C,c.newText);return o.getTextReplacement(S)}).filter(isDefined)}class FadeoutDecoration extends Disposable{constructor(e,t,s){super(),s&&this._register({dispose:()=>s()}),this._register(observableCodeEditor(e).setDecorations(constObservable(t.map(l=>({range:l,options:{description:"animation",className:"edits-fadeout-decoration",zIndex:1}})))));const o=new AnimatedValue(1,0,1e3,easeOutCubic),r=new ObservableAnimatedValue(o);this._register(autorun(l=>{const c=r.getValue(l);e.getContainerDomNode().style.setProperty("--animation-opacity",c.toString()),o.isFinished()&&this.dispose()}))}}var __decorate$1p=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1o=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},SuggestMemoryService_1;class Memory{constructor(e){this.name=e}select(e,t,s){if(s.length===0)return 0;const o=s[0].score[0];for(let r=0;r<s.length;r++){const{score:l,completion:c}=s[r];if(l[0]!==o)break;if(c.preselect)return r}return 0}}class NoMemory extends Memory{constructor(){super("first")}memorize(e,t,s){}toJSON(){}fromJSON(){}}class LRUMemory extends Memory{constructor(){super("recentlyUsed"),this._cache=new LRUCache(300,.66),this._seq=0}memorize(e,t,s){const o=`${e.getLanguageId()}/${s.textLabel}`;this._cache.set(o,{touch:this._seq++,type:s.completion.kind,insertText:s.completion.insertText})}select(e,t,s){if(s.length===0)return 0;const o=e.getLineContent(t.lineNumber).substr(t.column-10,t.column-1);if(/\s$/.test(o))return super.select(e,t,s);const r=s[0].score[0];let l=-1,c=-1,d=-1;for(let u=0;u<s.length&&s[u].score[0]===r;u++){const g=`${e.getLanguageId()}/${s[u].textLabel}`,f=this._cache.peek(g);if(f&&f.touch>d&&f.type===s[u].completion.kind&&f.insertText===s[u].completion.insertText&&(d=f.touch,c=u),s[u].completion.preselect&&l===-1)return l=u}return c!==-1?c:l!==-1?l:0}toJSON(){return this._cache.toJSON()}fromJSON(e){this._cache.clear();const t=0;for(const[s,o]of e)o.touch=t,o.type=typeof o.type=="number"?o.type:CompletionItemKinds.fromString(o.type),this._cache.set(s,o);this._seq=this._cache.size}}class PrefixMemory extends Memory{constructor(){super("recentlyUsedByPrefix"),this._trie=TernarySearchTree.forStrings(),this._seq=0}memorize(e,t,s){const{word:o}=e.getWordUntilPosition(t),r=`${e.getLanguageId()}/${o}`;this._trie.set(r,{type:s.completion.kind,insertText:s.completion.insertText,touch:this._seq++})}select(e,t,s){const{word:o}=e.getWordUntilPosition(t);if(!o)return super.select(e,t,s);const r=`${e.getLanguageId()}/${o}`;let l=this._trie.get(r);if(l||(l=this._trie.findSubstr(r)),l)for(let c=0;c<s.length;c++){const{kind:d,insertText:u}=s[c].completion;if(d===l.type&&u===l.insertText)return c}return super.select(e,t,s)}toJSON(){const e=[];return this._trie.forEach((t,s)=>e.push([s,t])),e.sort((t,s)=>-(t[1].touch-s[1].touch)).forEach((t,s)=>t[1].touch=s),e.slice(0,200)}fromJSON(e){if(this._trie.clear(),e.length>0){this._seq=e[0][1].touch+1;for(const[t,s]of e)s.type=typeof s.type=="number"?s.type:CompletionItemKinds.fromString(s.type),this._trie.set(t,s)}}}var $t;let SuggestMemoryService=($t=class{constructor(e,t){this._storageService=e,this._configService=t,this._disposables=new DisposableStore,this._persistSoon=new RunOnceScheduler(()=>this._saveState(),500),this._disposables.add(e.onWillSaveState(s=>{s.reason===WillSaveStateReason.SHUTDOWN&&this._saveState()}))}dispose(){this._disposables.dispose(),this._persistSoon.dispose()}memorize(e,t,s){this._withStrategy(e,t).memorize(e,t,s),this._persistSoon.schedule()}select(e,t,s){return this._withStrategy(e,t).select(e,t,s)}_withStrategy(e,t){var o;const s=this._configService.getValue("editor.suggestSelection",{overrideIdentifier:e.getLanguageIdAtPosition(t.lineNumber,t.column),resource:e.uri});if(((o=this._strategy)==null?void 0:o.name)!==s){this._saveState();const r=SuggestMemoryService_1._strategyCtors.get(s)||NoMemory;this._strategy=new r;try{const c=this._configService.getValue("editor.suggest.shareSuggestSelections")?0:1,d=this._storageService.get(`${SuggestMemoryService_1._storagePrefix}/${s}`,c);d&&this._strategy.fromJSON(JSON.parse(d))}catch{}}return this._strategy}_saveState(){if(this._strategy){const t=this._configService.getValue("editor.suggest.shareSuggestSelections")?0:1,s=JSON.stringify(this._strategy);this._storageService.store(`${SuggestMemoryService_1._storagePrefix}/${this._strategy.name}`,s,t,1)}}},SuggestMemoryService_1=$t,$t._strategyCtors=new Map([["recentlyUsedByPrefix",PrefixMemory],["recentlyUsed",LRUMemory],["first",NoMemory]]),$t._storagePrefix="suggest/memories",$t);SuggestMemoryService=SuggestMemoryService_1=__decorate$1p([__param$1o(0,IStorageService),__param$1o(1,IConfigurationService)],SuggestMemoryService);const ISuggestMemoryService=createDecorator("ISuggestMemories");registerSingleton(ISuggestMemoryService,SuggestMemoryService,1);var __decorate$1o=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1n=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},WordContextKey_1,Bi;let WordContextKey=(Bi=class{constructor(e,t){this._editor=e,this._enabled=!1,this._ckAtEnd=WordContextKey_1.AtEnd.bindTo(t),this._configListener=this._editor.onDidChangeConfiguration(s=>s.hasChanged(139)&&this._update()),this._update()}dispose(){var e;this._configListener.dispose(),(e=this._selectionListener)==null||e.dispose(),this._ckAtEnd.reset()}_update(){const e=this._editor.getOption(139)==="on";if(this._enabled!==e)if(this._enabled=e,this._enabled){const t=()=>{if(!this._editor.hasModel()){this._ckAtEnd.set(!1);return}const s=this._editor.getModel(),o=this._editor.getSelection(),r=s.getWordAtPosition(o.getStartPosition());if(!r){this._ckAtEnd.set(!1);return}this._ckAtEnd.set(r.endColumn===o.getStartPosition().column&&o.getStartPosition().lineNumber===o.getEndPosition().lineNumber)};this._selectionListener=this._editor.onDidChangeCursorSelection(t),t()}else this._selectionListener&&(this._ckAtEnd.reset(),this._selectionListener.dispose(),this._selectionListener=void 0)}},WordContextKey_1=Bi,Bi.AtEnd=new RawContextKey("atEndOfWord",!1,{type:"boolean",description:localize(1479,"A context key that is true when at the end of a word. Note that this is only defined when tab-completions are enabled")}),Bi);WordContextKey=WordContextKey_1=__decorate$1o([__param$1n(1,IContextKeyService)],WordContextKey);var __decorate$1n=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1m=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},SuggestAlternatives_1,Hi;let SuggestAlternatives=(Hi=class{constructor(e,t){this._editor=e,this._index=0,this._ckOtherSuggestions=SuggestAlternatives_1.OtherSuggestions.bindTo(t)}dispose(){this.reset()}reset(){var e;this._ckOtherSuggestions.reset(),(e=this._listener)==null||e.dispose(),this._model=void 0,this._acceptNext=void 0,this._ignore=!1}set({model:e,index:t},s){if(e.items.length===0){this.reset();return}if(SuggestAlternatives_1._moveIndex(!0,e,t)===t){this.reset();return}this._acceptNext=s,this._model=e,this._index=t,this._listener=this._editor.onDidChangeCursorPosition(()=>{this._ignore||this.reset()}),this._ckOtherSuggestions.set(!0)}static _moveIndex(e,t,s){let o=s;for(let r=t.items.length;r>0&&(o=(o+t.items.length+(e?1:-1))%t.items.length,!(o===s||!t.items[o].completion.additionalTextEdits));r--);return o}next(){this._move(!0)}prev(){this._move(!1)}_move(e){if(this._model)try{this._ignore=!0,this._index=SuggestAlternatives_1._moveIndex(e,this._model,this._index),this._acceptNext({index:this._index,item:this._model.items[this._index],model:this._model})}finally{this._ignore=!1}}},SuggestAlternatives_1=Hi,Hi.OtherSuggestions=new RawContextKey("hasOtherSuggestions",!1),Hi);SuggestAlternatives=SuggestAlternatives_1=__decorate$1n([__param$1m(1,IContextKeyService)],SuggestAlternatives);class CommitCharacterController{constructor(e,t,s,o){this._disposables=new DisposableStore,this._disposables.add(s.onDidSuggest(r=>{r.completionModel.items.length===0&&this.reset()})),this._disposables.add(s.onDidCancel(r=>{this.reset()})),this._disposables.add(t.onDidShow(()=>this._onItem(t.getFocusedItem()))),this._disposables.add(t.onDidFocus(this._onItem,this)),this._disposables.add(t.onDidHide(this.reset,this)),this._disposables.add(e.onWillType(r=>{if(this._active&&!t.isFrozen()&&s.state!==0){const l=r.charCodeAt(r.length-1);this._active.acceptCharacters.has(l)&&e.getOption(0)&&o(this._active.item)}}))}_onItem(e){if(!e||!isNonEmptyArray(e.item.completion.commitCharacters)){this.reset();return}if(this._active&&this._active.item.item===e.item)return;const t=new CharacterSet;for(const s of e.item.completion.commitCharacters)s.length>0&&t.add(s.charCodeAt(0));this._active={acceptCharacters:t,item:e}}reset(){this._active=void 0}dispose(){this._disposables.dispose()}}const xe=class xe{async provideSelectionRanges(e,t){const s=[];for(const o of t){const r=[];s.push(r);const l=new Map;await new Promise(c=>xe._bracketsRightYield(c,0,e,o,l)),await new Promise(c=>xe._bracketsLeftYield(c,0,e,o,l,r))}return s}static _bracketsRightYield(e,t,s,o,r){const l=new Map,c=Date.now();for(;;){if(t>=xe._maxRounds){e();break}if(!o){e();break}const d=s.bracketPairs.findNextBracket(o);if(!d){e();break}if(Date.now()-c>xe._maxDuration){setTimeout(()=>xe._bracketsRightYield(e,t+1,s,o,r));break}if(d.bracketInfo.isOpeningBracket){const g=d.bracketInfo.bracketText,f=l.has(g)?l.get(g):0;l.set(g,f+1)}else{const g=d.bracketInfo.getOpeningBrackets()[0].bracketText;let f=l.has(g)?l.get(g):0;if(f-=1,l.set(g,Math.max(0,f)),f<0){let p=r.get(g);p||(p=new LinkedList,r.set(g,p)),p.push(d.range)}}o=d.range.getEndPosition()}}static _bracketsLeftYield(e,t,s,o,r,l){const c=new Map,d=Date.now();for(;;){if(t>=xe._maxRounds&&r.size===0){e();break}if(!o){e();break}const u=s.bracketPairs.findPrevBracket(o);if(!u){e();break}if(Date.now()-d>xe._maxDuration){setTimeout(()=>xe._bracketsLeftYield(e,t+1,s,o,r,l));break}if(u.bracketInfo.isOpeningBracket){const f=u.bracketInfo.bracketText;let p=c.has(f)?c.get(f):0;if(p-=1,c.set(f,Math.max(0,p)),p<0){const m=r.get(f);if(m){const _=m.shift();m.size===0&&r.delete(f);const C=Range$2.fromPositions(u.range.getEndPosition(),_.getStartPosition()),b=Range$2.fromPositions(u.range.getStartPosition(),_.getEndPosition());l.push({range:C}),l.push({range:b}),xe._addBracketLeading(s,b,l)}}}else{const f=u.bracketInfo.getOpeningBrackets()[0].bracketText,p=c.has(f)?c.get(f):0;c.set(f,p+1)}o=u.range.getStartPosition()}}static _addBracketLeading(e,t,s){if(t.startLineNumber===t.endLineNumber)return;const o=t.startLineNumber,r=e.getLineFirstNonWhitespaceColumn(o);r!==0&&r!==t.startColumn&&(s.push({range:Range$2.fromPositions(new Position$1(o,r),t.getEndPosition())}),s.push({range:Range$2.fromPositions(new Position$1(o,1),t.getEndPosition())}));const l=o-1;if(l>0){const c=e.getLineFirstNonWhitespaceColumn(l);c===t.startColumn&&c!==e.getLineLastNonWhitespaceColumn(l)&&(s.push({range:Range$2.fromPositions(new Position$1(l,c),t.getEndPosition())}),s.push({range:Range$2.fromPositions(new Position$1(l,1),t.getEndPosition())}))}}};xe._maxDuration=30,xe._maxRounds=2;let BracketSelectionRangeProvider=xe;const He=class He{static async create(e,t){if(!t.getOption(134).localityBonus||!t.hasModel())return He.None;const s=t.getModel(),o=t.getPosition();if(!e.canComputeWordRanges(s.uri))return He.None;const[r]=await new BracketSelectionRangeProvider().provideSelectionRanges(s,[o]);if(r.length===0)return He.None;const l=await e.computeWordRanges(s.uri,r[0].range);if(!l)return He.None;const c=s.getWordUntilPosition(o);return delete l[c.word],new class extends He{distance(d,u){if(!o.equals(t.getPosition()))return 0;if(u.kind===17)return 2<<20;const g=typeof u.label=="string"?u.label:u.label.label,f=l[g];if(isFalsyOrEmpty(f))return 2<<20;const p=binarySearch(f,Range$2.fromPositions(d),Range$2.compareRangesUsingStarts),m=p>=0?f[p]:f[Math.max(0,~p-1)];let _=r.length;for(const C of r){if(!Range$2.containsRange(C.range,m))break;_-=1}return _}}}};He.None=new class extends He{distance(){return 0}};let WordDistance=He,LineContext$1=class{constructor(e,t){this.leadingLineContent=e,this.characterCountDelta=t}};class CompletionModel{constructor(e,t,s,o,r,l,c=FuzzyScoreOptions.default,d=void 0){this.clipboardText=d,this._snippetCompareFn=CompletionModel._compareCompletionItems,this._items=e,this._column=t,this._wordDistance=o,this._options=r,this._refilterKind=1,this._lineContext=s,this._fuzzyScoreOptions=c,l==="top"?this._snippetCompareFn=CompletionModel._compareCompletionItemsSnippetsUp:l==="bottom"&&(this._snippetCompareFn=CompletionModel._compareCompletionItemsSnippetsDown)}get lineContext(){return this._lineContext}set lineContext(e){(this._lineContext.leadingLineContent!==e.leadingLineContent||this._lineContext.characterCountDelta!==e.characterCountDelta)&&(this._refilterKind=this._lineContext.characterCountDelta<e.characterCountDelta&&this._filteredItems?2:1,this._lineContext=e)}get items(){return this._ensureCachedState(),this._filteredItems}getItemsByProvider(){return this._ensureCachedState(),this._itemsByProvider}getIncompleteProvider(){this._ensureCachedState();const e=new Set;for(const[t,s]of this.getItemsByProvider())s.length>0&&s[0].container.incomplete&&e.add(t);return e}get stats(){return this._ensureCachedState(),this._stats}_ensureCachedState(){this._refilterKind!==0&&this._createCachedState()}_createCachedState(){this._itemsByProvider=new Map;const e=[],{leadingLineContent:t,characterCountDelta:s}=this._lineContext;let o="",r="";const l=this._refilterKind===1?this._items:this._filteredItems,c=[],d=!this._options.filterGraceful||l.length>2e3?fuzzyScore:fuzzyScoreGracefulAggressive;for(let u=0;u<l.length;u++){const g=l[u];if(g.isInvalid)continue;const f=this._itemsByProvider.get(g.provider);f?f.push(g):this._itemsByProvider.set(g.provider,[g]);const p=g.position.column-g.editStart.column,m=p+s-(g.position.column-this._column);if(o.length!==m&&(o=m===0?"":t.slice(-m),r=o.toLowerCase()),g.word=o,m===0)g.score=FuzzyScore.Default;else{let _=0;for(;_<p;){const C=o.charCodeAt(_);if(C===32||C===9)_+=1;else break}if(_>=m)g.score=FuzzyScore.Default;else if(typeof g.completion.filterText=="string"){const C=d(o,r,_,g.completion.filterText,g.filterTextLow,0,this._fuzzyScoreOptions);if(!C)continue;compareIgnoreCase(g.completion.filterText,g.textLabel)===0?g.score=C:(g.score=anyScore(o,r,_,g.textLabel,g.labelLow,0),g.score[0]=C[0])}else{const C=d(o,r,_,g.textLabel,g.labelLow,0,this._fuzzyScoreOptions);if(!C)continue;g.score=C}}g.idx=u,g.distance=this._wordDistance.distance(g.position,g.completion),c.push(g),e.push(g.textLabel.length)}this._filteredItems=c.sort(this._snippetCompareFn),this._refilterKind=0,this._stats={pLabelLen:e.length?quickSelect(e.length-.85,e,(u,g)=>u-g):0}}static _compareCompletionItems(e,t){return e.score[0]>t.score[0]?-1:e.score[0]<t.score[0]?1:e.distance<t.distance?-1:e.distance>t.distance?1:e.idx<t.idx?-1:e.idx>t.idx?1:0}static _compareCompletionItemsSnippetsDown(e,t){if(e.completion.kind!==t.completion.kind){if(e.completion.kind===28)return 1;if(t.completion.kind===28)return-1}return CompletionModel._compareCompletionItems(e,t)}static _compareCompletionItemsSnippetsUp(e,t){if(e.completion.kind!==t.completion.kind){if(e.completion.kind===28)return-1;if(t.completion.kind===28)return 1}return CompletionModel._compareCompletionItems(e,t)}}var __decorate$1m=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1l=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},SuggestModel_1;class LineContext{static shouldAutoTrigger(e){if(!e.hasModel())return!1;const t=e.getModel(),s=e.getPosition();t.tokenization.tokenizeIfCheap(s.lineNumber);const o=t.getWordAtPosition(s);return!(!o||o.endColumn!==s.column&&o.startColumn+1!==s.column||!isNaN(Number(o.word)))}constructor(e,t,s){this.leadingLineContent=e.getLineContent(t.lineNumber).substr(0,t.column-1),this.leadingWord=e.getWordUntilPosition(t),this.lineNumber=t.lineNumber,this.column=t.column,this.triggerOptions=s}}function canShowQuickSuggest(a,e,t){if(!e.getContextKeyValue(InlineCompletionContextKeys.inlineSuggestionVisible.key))return!0;const s=e.getContextKeyValue(InlineCompletionContextKeys.suppressSuggestions.key);return s!==void 0?!s:!a.getOption(71).suppressSuggestions}function canShowSuggestOnTriggerCharacters(a,e,t){if(!e.getContextKeyValue("inlineSuggestionVisible"))return!0;const s=e.getContextKeyValue(InlineCompletionContextKeys.suppressSuggestions.key);return s!==void 0?!s:!a.getOption(71).suppressSuggestions}let SuggestModel=SuggestModel_1=class{constructor(e,t,s,o,r,l,c,d,u){this._editor=e,this._editorWorkerService=t,this._clipboardService=s,this._telemetryService=o,this._logService=r,this._contextKeyService=l,this._configurationService=c,this._languageFeaturesService=d,this._envService=u,this._toDispose=new DisposableStore,this._triggerCharacterListener=new DisposableStore,this._triggerQuickSuggest=new TimeoutTimer,this._triggerState=void 0,this._completionDisposables=new DisposableStore,this._onDidCancel=new Emitter$1,this._onDidTrigger=new Emitter$1,this._onDidSuggest=new Emitter$1,this.onDidCancel=this._onDidCancel.event,this.onDidTrigger=this._onDidTrigger.event,this.onDidSuggest=this._onDidSuggest.event,this._currentSelection=this._editor.getSelection()||new Selection$1(1,1,1,1),this._toDispose.add(this._editor.onDidChangeModel(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeModelLanguage(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeConfiguration(()=>{this._updateTriggerCharacters()})),this._toDispose.add(this._languageFeaturesService.completionProvider.onDidChange(()=>{this._updateTriggerCharacters(),this._updateActiveSuggestSession()}));let g=!1;this._toDispose.add(this._editor.onDidCompositionStart(()=>{g=!0})),this._toDispose.add(this._editor.onDidCompositionEnd(()=>{g=!1,this._onCompositionEnd()})),this._toDispose.add(this._editor.onDidChangeCursorSelection(f=>{g||this._onCursorChange(f)})),this._toDispose.add(this._editor.onDidChangeModelContent(()=>{!g&&this._triggerState!==void 0&&this._refilterCompletionItems()})),this._updateTriggerCharacters()}dispose(){dispose(this._triggerCharacterListener),dispose([this._onDidCancel,this._onDidSuggest,this._onDidTrigger,this._triggerQuickSuggest]),this._toDispose.dispose(),this._completionDisposables.dispose(),this.cancel()}_updateTriggerCharacters(){if(this._triggerCharacterListener.clear(),this._editor.getOption(104)||!this._editor.hasModel()||!this._editor.getOption(137))return;const e=new Map;for(const s of this._languageFeaturesService.completionProvider.all(this._editor.getModel()))for(const o of s.triggerCharacters||[]){let r=e.get(o);r||(r=new Set,e.set(o,r)),r.add(s)}const t=s=>{var l;if(!canShowSuggestOnTriggerCharacters(this._editor,this._contextKeyService,this._configurationService)||LineContext.shouldAutoTrigger(this._editor))return;if(!s){const c=this._editor.getPosition();s=this._editor.getModel().getLineContent(c.lineNumber).substr(0,c.column-1)}let o="";isLowSurrogate(s.charCodeAt(s.length-1))?isHighSurrogate(s.charCodeAt(s.length-2))&&(o=s.substr(s.length-2)):o=s.charAt(s.length-1);const r=e.get(o);if(r){const c=new Map;if(this._completionModel)for(const[d,u]of this._completionModel.getItemsByProvider())r.has(d)||c.set(d,u);this.trigger({auto:!0,triggerKind:1,triggerCharacter:o,retrigger:!!this._completionModel,clipboardText:(l=this._completionModel)==null?void 0:l.clipboardText,completionOptions:{providerFilter:r,providerItemsToReuse:c}})}};this._triggerCharacterListener.add(this._editor.onDidType(t)),this._triggerCharacterListener.add(this._editor.onDidCompositionEnd(()=>t()))}get state(){return this._triggerState?this._triggerState.auto?2:1:0}cancel(e=!1){var t;this._triggerState!==void 0&&(this._triggerQuickSuggest.cancel(),(t=this._requestToken)==null||t.cancel(),this._requestToken=void 0,this._triggerState=void 0,this._completionModel=void 0,this._context=void 0,this._onDidCancel.fire({retrigger:e}))}clear(){this._completionDisposables.clear()}_updateActiveSuggestSession(){this._triggerState!==void 0&&(!this._editor.hasModel()||!this._languageFeaturesService.completionProvider.has(this._editor.getModel())?this.cancel():this.trigger({auto:this._triggerState.auto,retrigger:!0}))}_onCursorChange(e){if(!this._editor.hasModel())return;const t=this._currentSelection;if(this._currentSelection=this._editor.getSelection(),!e.selection.isEmpty()||e.reason!==0&&e.reason!==3||e.source!=="keyboard"&&e.source!=="deleteLeft"){this.cancel();return}this._triggerState===void 0&&e.reason===0?(t.containsRange(this._currentSelection)||t.getEndPosition().isBeforeOrEqual(this._currentSelection.getPosition()))&&this._doTriggerQuickSuggest():this._triggerState!==void 0&&e.reason===3&&this._refilterCompletionItems()}_onCompositionEnd(){this._triggerState===void 0?this._doTriggerQuickSuggest():this._refilterCompletionItems()}_doTriggerQuickSuggest(){var e;QuickSuggestionsOptions.isAllOff(this._editor.getOption(102))||this._editor.getOption(134).snippetsPreventQuickSuggestions&&((e=SnippetController2.get(this._editor))!=null&&e.isInSnippet())||(this.cancel(),this._triggerQuickSuggest.cancelAndSet(()=>{if(this._triggerState!==void 0||!LineContext.shouldAutoTrigger(this._editor)||!this._editor.hasModel()||!this._editor.hasWidgetFocus())return;const t=this._editor.getModel(),s=this._editor.getPosition(),o=this._editor.getOption(102);if(!QuickSuggestionsOptions.isAllOff(o)){if(!QuickSuggestionsOptions.isAllOn(o)){t.tokenization.tokenizeIfCheap(s.lineNumber);const r=t.tokenization.getLineTokens(s.lineNumber),l=r.getStandardTokenType(r.findTokenIndexAtOffset(Math.max(s.column-1-1,0)));if(QuickSuggestionsOptions.valueFor(o,l)!=="on")return}canShowQuickSuggest(this._editor,this._contextKeyService,this._configurationService)&&this._languageFeaturesService.completionProvider.has(t)&&this.trigger({auto:!0})}},this._editor.getOption(103)))}_refilterCompletionItems(){assertType(this._editor.hasModel()),assertType(this._triggerState!==void 0);const e=this._editor.getModel(),t=this._editor.getPosition(),s=new LineContext(e,t,{...this._triggerState,refilter:!0});this._onNewContext(s)}trigger(e){var p,m,_;if(!this._editor.hasModel())return;const t=this._editor.getModel(),s=new LineContext(t,this._editor.getPosition(),e);this.cancel(e.retrigger),this._triggerState=e,this._onDidTrigger.fire({auto:e.auto,shy:e.shy??!1,position:this._editor.getPosition()}),this._context=s;let o={triggerKind:e.triggerKind??0};e.triggerCharacter&&(o={triggerKind:1,triggerCharacter:e.triggerCharacter}),this._requestToken=new CancellationTokenSource$1;const r=this._editor.getOption(128);let l=1;switch(r){case"top":l=0;break;case"bottom":l=2;break}const{itemKind:c,showDeprecated:d}=SuggestModel_1.createSuggestFilter(this._editor),u=new CompletionOptions(l,((p=e.completionOptions)==null?void 0:p.kindFilter)??c,(m=e.completionOptions)==null?void 0:m.providerFilter,(_=e.completionOptions)==null?void 0:_.providerItemsToReuse,d),g=WordDistance.create(this._editorWorkerService,this._editor),f=provideSuggestionItems(this._languageFeaturesService.completionProvider,t,this._editor.getPosition(),u,o,this._requestToken.token);Promise.all([f,g]).then(async([C,b])=>{var L;if((L=this._requestToken)==null||L.dispose(),!this._editor.hasModel()){C.disposable.dispose();return}let v=e==null?void 0:e.clipboardText;if(!v&&C.needsClipboard&&(v=await this._clipboardService.readText()),this._triggerState===void 0){C.disposable.dispose();return}const S=this._editor.getModel(),y=new LineContext(S,this._editor.getPosition(),e),w={...FuzzyScoreOptions.default,firstMatchCanBeWeak:!this._editor.getOption(134).matchOnWordStartOnly};if(this._completionModel=new CompletionModel(C.items,this._context.column,{leadingLineContent:y.leadingLineContent,characterCountDelta:y.column-this._context.column},b,this._editor.getOption(134),this._editor.getOption(128),w,v),this._completionDisposables.add(C.disposable),this._onNewContext(y),this._reportDurationsTelemetry(C.durations),!this._envService.isBuilt||this._envService.isExtensionDevelopment)for(const x of C.items)x.isInvalid&&this._logService.warn(`[suggest] did IGNORE invalid completion item from ${x.provider._debugDisplayName}`,x.completion)}).catch(onUnexpectedError)}_reportDurationsTelemetry(e){Math.random()>1e-4||setTimeout(()=>{this._telemetryService.publicLog2("suggest.durations.json",{data:JSON.stringify(e)}),this._logService.debug("suggest.durations.json",e)})}static createSuggestFilter(e){const t=new Set;e.getOption(128)==="none"&&t.add(28);const o=e.getOption(134);return o.showMethods||t.add(0),o.showFunctions||t.add(1),o.showConstructors||t.add(2),o.showFields||t.add(3),o.showVariables||t.add(4),o.showClasses||t.add(5),o.showStructs||t.add(6),o.showInterfaces||t.add(7),o.showModules||t.add(8),o.showProperties||t.add(9),o.showEvents||t.add(10),o.showOperators||t.add(11),o.showUnits||t.add(12),o.showValues||t.add(13),o.showConstants||t.add(14),o.showEnums||t.add(15),o.showEnumMembers||t.add(16),o.showKeywords||t.add(17),o.showWords||t.add(18),o.showColors||t.add(19),o.showFiles||t.add(20),o.showReferences||t.add(21),o.showColors||t.add(22),o.showFolders||t.add(23),o.showTypeParameters||t.add(24),o.showSnippets||t.add(28),o.showUsers||t.add(25),o.showIssues||t.add(26),{itemKind:t,showDeprecated:o.showDeprecated}}_onNewContext(e){if(this._context){if(e.lineNumber!==this._context.lineNumber){this.cancel();return}if(getLeadingWhitespace(e.leadingLineContent)!==getLeadingWhitespace(this._context.leadingLineContent)){this.cancel();return}if(e.column<this._context.column){e.leadingWord.word?this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0}):this.cancel();return}if(this._completionModel){if(e.leadingWord.word.length!==0&&e.leadingWord.startColumn>this._context.leadingWord.startColumn){if(LineContext.shouldAutoTrigger(this._editor)&&this._context){const s=this._completionModel.getItemsByProvider();this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerItemsToReuse:s}})}return}if(e.column>this._context.column&&this._completionModel.getIncompleteProvider().size>0&&e.leadingWord.word.length!==0){const t=new Map,s=new Set;for(const[o,r]of this._completionModel.getItemsByProvider())r.length>0&&r[0].container.incomplete?s.add(o):t.set(o,r);this.trigger({auto:this._context.triggerOptions.auto,triggerKind:2,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerFilter:s,providerItemsToReuse:t}})}else{const t=this._completionModel.lineContext;let s=!1;if(this._completionModel.lineContext={leadingLineContent:e.leadingLineContent,characterCountDelta:e.column-this._context.column},this._completionModel.items.length===0){const o=LineContext.shouldAutoTrigger(this._editor);if(!this._context){this.cancel();return}if(o&&this._context.leadingWord.endColumn<e.leadingWord.startColumn){this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0});return}if(this._context.triggerOptions.auto){this.cancel();return}else if(this._completionModel.lineContext=t,s=this._completionModel.items.length>0,s&&e.leadingWord.word.length===0){this.cancel();return}}this._onDidSuggest.fire({completionModel:this._completionModel,triggerOptions:e.triggerOptions,isFrozen:s})}}}}};SuggestModel=SuggestModel_1=__decorate$1m([__param$1l(1,IEditorWorkerService),__param$1l(2,IClipboardService),__param$1l(3,ITelemetryService),__param$1l(4,ILogService),__param$1l(5,IContextKeyService),__param$1l(6,IConfigurationService),__param$1l(7,ILanguageFeaturesService),__param$1l(8,IEnvironmentService)],SuggestModel);const Ks=class Ks{constructor(e,t){this._disposables=new DisposableStore,this._lastOvertyped=[],this._locked=!1,this._disposables.add(e.onWillType(()=>{if(this._locked||!e.hasModel())return;const s=e.getSelections(),o=s.length;let r=!1;for(let c=0;c<o;c++)if(!s[c].isEmpty()){r=!0;break}if(!r){this._lastOvertyped.length!==0&&(this._lastOvertyped.length=0);return}this._lastOvertyped=[];const l=e.getModel();for(let c=0;c<o;c++){const d=s[c];if(l.getValueLengthInRange(d)>Ks._maxSelectionLength)return;this._lastOvertyped[c]={value:l.getValueInRange(d),multiline:d.startLineNumber!==d.endLineNumber}}})),this._disposables.add(t.onDidTrigger(s=>{this._locked=!0})),this._disposables.add(t.onDidCancel(s=>{this._locked=!1}))}getLastOvertypedInfo(e){if(e>=0&&e<this._lastOvertyped.length)return this._lastOvertyped[e]}dispose(){this._disposables.dispose()}};Ks._maxSelectionLength=51200;let OvertypingCapturer=Ks;const suggest="";var __decorate$1l=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1k=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let SuggestWidgetStatus=class{constructor(e,t,s,o,r){this._menuId=t,this._menuService=o,this._contextKeyService=r,this._menuDisposables=new DisposableStore,this.element=append$2(e,$$l(".suggest-status-bar"));const l=c=>c instanceof MenuItemAction?s.createInstance(TextOnlyMenuEntryActionViewItem,c,{useComma:!1}):void 0;this._leftActions=new ActionBar(this.element,{actionViewItemProvider:l}),this._rightActions=new ActionBar(this.element,{actionViewItemProvider:l}),this._leftActions.domNode.classList.add("left"),this._rightActions.domNode.classList.add("right")}dispose(){this._menuDisposables.dispose(),this._leftActions.dispose(),this._rightActions.dispose(),this.element.remove()}show(){const e=this._menuService.createMenu(this._menuId,this._contextKeyService),t=()=>{const s=[],o=[];for(const[r,l]of e.getActions())r==="left"?s.push(...l):o.push(...l);this._leftActions.clear(),this._leftActions.push(s),this._rightActions.clear(),this._rightActions.push(o)};this._menuDisposables.add(e.onDidChange(()=>t())),this._menuDisposables.add(e)}hide(){this._menuDisposables.clear()}};SuggestWidgetStatus=__decorate$1l([__param$1k(2,IInstantiationService),__param$1k(3,IMenuService),__param$1k(4,IContextKeyService)],SuggestWidgetStatus);var __decorate$1k=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1j=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};function canExpandCompletionItem(a){return!!a&&!!(a.completion.documentation||a.completion.detail&&a.completion.detail!==a.completion.label)}let SuggestDetailsWidget=class{constructor(e,t){this._editor=e,this._onDidClose=new Emitter$1,this.onDidClose=this._onDidClose.event,this._onDidChangeContents=new Emitter$1,this.onDidChangeContents=this._onDidChangeContents.event,this._disposables=new DisposableStore,this._renderDisposeable=new DisposableStore,this._borderWidth=1,this._size=new Dimension(330,0),this.domNode=$$l(".suggest-details"),this.domNode.classList.add("no-docs"),this._markdownRenderer=t.createInstance(MarkdownRenderer,{editor:e}),this._body=$$l(".body"),this._scrollbar=new DomScrollableElement(this._body,{alwaysConsumeMouseWheel:!0}),append$2(this.domNode,this._scrollbar.getDomNode()),this._disposables.add(this._scrollbar),this._header=append$2(this._body,$$l(".header")),this._close=append$2(this._header,$$l("span"+ThemeIcon.asCSSSelector(Codicon.close))),this._close.title=localize(1475,"Close"),this._close.role="button",this._close.tabIndex=-1,this._type=append$2(this._header,$$l("p.type")),this._docs=append$2(this._body,$$l("p.docs")),this._configureFont(),this._disposables.add(this._editor.onDidChangeConfiguration(s=>{s.hasChanged(59)&&this._configureFont()}))}dispose(){this._disposables.dispose(),this._renderDisposeable.dispose()}_configureFont(){const e=this._editor.getOptions(),t=e.get(59),s=t.getMassagedFontFamily(),o=e.get(135)||t.fontSize,r=e.get(136)||t.lineHeight,l=t.fontWeight,c=`${o}px`,d=`${r}px`;this.domNode.style.fontSize=c,this.domNode.style.lineHeight=`${r/o}`,this.domNode.style.fontWeight=l,this.domNode.style.fontFeatureSettings=t.fontFeatureSettings,this._type.style.fontFamily=s,this._close.style.height=d,this._close.style.width=d}getLayoutInfo(){const e=this._editor.getOption(136)||this._editor.getOption(59).lineHeight,t=this._borderWidth,s=t*2;return{lineHeight:e,borderWidth:t,borderHeight:s,verticalPadding:22,horizontalPadding:14}}renderLoading(){this._type.textContent=localize(1476,"Loading..."),this._docs.textContent="",this.domNode.classList.remove("no-docs","no-type"),this.layout(this.size.width,this.getLayoutInfo().lineHeight*2),this._onDidChangeContents.fire(this)}renderItem(e,t){var r;this._renderDisposeable.clear();let{detail:s,documentation:o}=e.completion;if(t){let l="";l+=`score: ${e.score[0]}
`,l+=`prefix: ${e.word??"(no prefix)"}
`,l+=`word: ${e.completion.filterText?e.completion.filterText+" (filterText)":e.textLabel}
`,l+=`distance: ${e.distance} (localityBonus-setting)
`,l+=`index: ${e.idx}, based on ${e.completion.sortText&&`sortText: "${e.completion.sortText}"`||"label"}
`,l+=`commit_chars: ${(r=e.completion.commitCharacters)==null?void 0:r.join("")}
`,o=new MarkdownString().appendCodeblock("empty",l),s=`Provider: ${e.provider._debugDisplayName}`}if(!t&&!canExpandCompletionItem(e)){this.clearContents();return}if(this.domNode.classList.remove("no-docs","no-type"),s){const l=s.length>1e5?`${s.substr(0,1e5)}…`:s;this._type.textContent=l,this._type.title=l,show(this._type),this._type.classList.toggle("auto-wrap",!/\r?\n^\s+/gmi.test(l))}else clearNode(this._type),this._type.title="",hide(this._type),this.domNode.classList.add("no-type");if(clearNode(this._docs),typeof o=="string")this._docs.classList.remove("markdown-docs"),this._docs.textContent=o;else if(o){this._docs.classList.add("markdown-docs"),clearNode(this._docs);const l=this._markdownRenderer.render(o,{asyncRenderCallback:()=>{this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}});this._docs.appendChild(l.element),this._renderDisposeable.add(l)}this.domNode.classList.toggle("detail-and-doc",!!s&&!!o),this.domNode.style.userSelect="text",this.domNode.tabIndex=-1,this._close.onmousedown=l=>{l.preventDefault(),l.stopPropagation()},this._close.onclick=l=>{l.preventDefault(),l.stopPropagation(),this._onDidClose.fire()},this._body.scrollTop=0,this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}clearContents(){this.domNode.classList.add("no-docs"),this._type.textContent="",this._docs.textContent=""}get isEmpty(){return this.domNode.classList.contains("no-docs")}get size(){return this._size}layout(e,t){const s=new Dimension(e,t);Dimension.equals(s,this._size)||(this._size=s,size(this.domNode,e,t)),this._scrollbar.scanDomNode()}scrollDown(e=8){this._body.scrollTop+=e}scrollUp(e=8){this._body.scrollTop-=e}scrollTop(){this._body.scrollTop=0}scrollBottom(){this._body.scrollTop=this._body.scrollHeight}pageDown(){this.scrollDown(80)}pageUp(){this.scrollUp(80)}set borderWidth(e){this._borderWidth=e}get borderWidth(){return this._borderWidth}focus(){this.domNode.focus()}};SuggestDetailsWidget=__decorate$1k([__param$1j(1,IInstantiationService)],SuggestDetailsWidget);class SuggestDetailsOverlay{constructor(e,t){this.widget=e,this._editor=t,this.allowEditorOverflow=!0,this._disposables=new DisposableStore,this._added=!1,this._preferAlignAtTop=!0,this._resizable=new ResizableHTMLElement,this._resizable.domNode.classList.add("suggest-details-container"),this._resizable.domNode.appendChild(e.domNode),this._resizable.enableSashes(!1,!0,!0,!1);let s,o,r=0,l=0;this._disposables.add(this._resizable.onDidWillResize(()=>{s=this._topLeft,o=this._resizable.size})),this._disposables.add(this._resizable.onDidResize(c=>{if(s&&o){this.widget.layout(c.dimension.width,c.dimension.height);let d=!1;c.west&&(l=o.width-c.dimension.width,d=!0),c.north&&(r=o.height-c.dimension.height,d=!0),d&&this._applyTopLeft({top:s.top+r,left:s.left+l})}c.done&&(s=void 0,o=void 0,r=0,l=0,this._userSize=c.dimension)})),this._disposables.add(this.widget.onDidChangeContents(()=>{this._anchorBox&&this._placeAtAnchor(this._anchorBox,this._userSize??this.widget.size,this._preferAlignAtTop)}))}dispose(){this._resizable.dispose(),this._disposables.dispose(),this.hide()}getId(){return"suggest.details"}getDomNode(){return this._resizable.domNode}getPosition(){return this._topLeft?{preference:this._topLeft}:null}show(){this._added||(this._editor.addOverlayWidget(this),this._added=!0)}hide(e=!1){this._resizable.clearSashHoverState(),this._added&&(this._editor.removeOverlayWidget(this),this._added=!1,this._anchorBox=void 0,this._topLeft=void 0),e&&(this._userSize=void 0,this.widget.clearContents())}placeAtAnchor(e,t){const s=e.getBoundingClientRect();this._anchorBox=s,this._preferAlignAtTop=t,this._placeAtAnchor(this._anchorBox,this._userSize??this.widget.size,t)}_placeAtAnchor(e,t,s){const o=getClientArea(this.getDomNode().ownerDocument.body),r=this.widget.getLayoutInfo(),l=new Dimension(220,2*r.lineHeight),c=e.top,d=function(){const L=o.width-(e.left+e.width+r.borderWidth+r.horizontalPadding),x=-r.borderWidth+e.left+e.width,E=new Dimension(L,o.height-e.top-r.borderHeight-r.verticalPadding),I=E.with(void 0,e.top+e.height-r.borderHeight-r.verticalPadding);return{top:c,left:x,fit:L-t.width,maxSizeTop:E,maxSizeBottom:I,minSize:l.with(Math.min(L,l.width))}}(),u=function(){const L=e.left-r.borderWidth-r.horizontalPadding,x=Math.max(r.horizontalPadding,e.left-t.width-r.borderWidth),E=new Dimension(L,o.height-e.top-r.borderHeight-r.verticalPadding),I=E.with(void 0,e.top+e.height-r.borderHeight-r.verticalPadding);return{top:c,left:x,fit:L-t.width,maxSizeTop:E,maxSizeBottom:I,minSize:l.with(Math.min(L,l.width))}}(),g=function(){const L=e.left,x=-r.borderWidth+e.top+e.height,E=new Dimension(e.width-r.borderHeight,o.height-e.top-e.height-r.verticalPadding);return{top:x,left:L,fit:E.height-t.height,maxSizeBottom:E,maxSizeTop:E,minSize:l.with(E.width)}}(),f=[d,u,g],p=f.find(L=>L.fit>=0)??f.sort((L,x)=>x.fit-L.fit)[0],m=e.top+e.height-r.borderHeight;let _,C=t.height;const b=Math.max(p.maxSizeTop.height,p.maxSizeBottom.height);C>b&&(C=b);let v;s?C<=p.maxSizeTop.height?(_=!0,v=p.maxSizeTop):(_=!1,v=p.maxSizeBottom):C<=p.maxSizeBottom.height?(_=!1,v=p.maxSizeBottom):(_=!0,v=p.maxSizeTop);let{top:S,left:y}=p;!_&&C>e.height&&(S=m-C);const w=this._editor.getDomNode();if(w){const L=w.getBoundingClientRect();S-=L.top,y-=L.left}this._applyTopLeft({left:y,top:S}),this._resizable.enableSashes(!_,p===d,_,p!==d),this._resizable.minSize=p.minSize,this._resizable.maxSize=v,this._resizable.layout(C,Math.min(v.width,t.width)),this.widget.layout(this._resizable.size.width,this._resizable.size.height)}_applyTopLeft(e){this._topLeft=e,this._editor.layoutOverlayWidget(this)}}const IFileService=createDecorator("fileService");var FileKind;(function(a){a[a.FILE=0]="FILE",a[a.FOLDER=1]="FOLDER",a[a.ROOT_FOLDER=2]="ROOT_FOLDER"})(FileKind||(FileKind={}));const fileIconDirectoryRegex=/(?:\/|^)(?:([^\/]+)\/)?([^\/]+)$/;function getIconClasses(a,e,t,s,o){if(ThemeIcon.isThemeIcon(o))return[`codicon-${o.id}`,"predefined-file-icon"];if(URI.isUri(o))return[];const r=s===FileKind.ROOT_FOLDER?["rootfolder-icon"]:s===FileKind.FOLDER?["folder-icon"]:["file-icon"];if(t){let l;if(t.scheme===Schemas.data)l=DataUri.parseMetaData(t).get(DataUri.META_DATA_LABEL);else{const c=t.path.match(fileIconDirectoryRegex);c?(l=fileIconSelectorEscape(c[2].toLowerCase()),c[1]&&r.push(`${fileIconSelectorEscape(c[1].toLowerCase())}-name-dir-icon`)):l=fileIconSelectorEscape(t.authority.toLowerCase())}if(s===FileKind.ROOT_FOLDER)r.push(`${l}-root-name-folder-icon`);else if(s===FileKind.FOLDER)r.push(`${l}-name-folder-icon`);else{if(l){if(r.push(`${l}-name-file-icon`),r.push("name-file-icon"),l.length<=255){const d=l.split(".");for(let u=1;u<d.length;u++)r.push(`${d.slice(u).join(".")}-ext-file-icon`)}r.push("ext-file-icon")}const c=detectLanguageId(a,e,t);c&&r.push(`${fileIconSelectorEscape(c)}-lang-file-icon`)}}return r}function detectLanguageId(a,e,t){if(!t)return null;let s=null;if(t.scheme===Schemas.data){const r=DataUri.parseMetaData(t).get(DataUri.META_DATA_MIME);r&&(s=e.getLanguageIdByMimeType(r))}else{const o=a.getModel(t);o&&(s=o.getLanguageId())}return s&&s!==PLAINTEXT_LANGUAGE_ID?s:e.guessLanguageIdByFilepathOrFirstLine(t)}function fileIconSelectorEscape(a){return a.replace(/[\s]/g,"/")}var __decorate$1j=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1i=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const suggestMoreInfoIcon=registerIcon("suggest-more-info",Codicon.chevronRight,localize(1477,"Icon for more information in the suggest widget."));var ze;const _completionItemColor=new(ze=class{extract(e,t){if(e.textLabel.match(ze._regexStrict))return t[0]=e.textLabel,!0;if(e.completion.detail&&e.completion.detail.match(ze._regexStrict))return t[0]=e.completion.detail,!0;if(e.completion.documentation){const s=typeof e.completion.documentation=="string"?e.completion.documentation:e.completion.documentation.value,o=ze._regexRelaxed.exec(s);if(o&&(o.index===0||o.index+o[0].length===s.length))return t[0]=o[0],!0}return!1}},ze._regexRelaxed=/(#([\da-fA-F]{3}){1,2}|(rgb|hsl)a\(\s*(\d{1,3}%?\s*,\s*){3}(1|0?\.\d+)\)|(rgb|hsl)\(\s*\d{1,3}%?(\s*,\s*\d{1,3}%?){2}\s*\))/,ze._regexStrict=new RegExp(`^${ze._regexRelaxed.source}$`,"i"),ze);let ItemRenderer=class{constructor(e,t,s,o){this._editor=e,this._modelService=t,this._languageService=s,this._themeService=o,this._onDidToggleDetails=new Emitter$1,this.onDidToggleDetails=this._onDidToggleDetails.event,this.templateId="suggestion"}dispose(){this._onDidToggleDetails.dispose()}renderTemplate(e){const t=new DisposableStore,s=e;s.classList.add("show-file-icons");const o=append$2(e,$$l(".icon")),r=append$2(o,$$l("span.colorspan")),l=append$2(e,$$l(".contents")),c=append$2(l,$$l(".main")),d=append$2(c,$$l(".icon-label.codicon")),u=append$2(c,$$l("span.left")),g=append$2(c,$$l("span.right")),f=new IconLabel(u,{supportHighlights:!0,supportIcons:!0});t.add(f);const p=append$2(u,$$l("span.signature-label")),m=append$2(u,$$l("span.qualifier-label")),_=append$2(g,$$l("span.details-label")),C=append$2(g,$$l("span.readMore"+ThemeIcon.asCSSSelector(suggestMoreInfoIcon)));return C.title=localize(1478,"Read More"),{root:s,left:u,right:g,icon:o,colorspan:r,iconLabel:f,iconContainer:d,parametersLabel:p,qualifierLabel:m,detailsLabel:_,readMore:C,disposables:t,configureFont:()=>{const v=this._editor.getOptions(),S=v.get(59),y=S.getMassagedFontFamily(),w=S.fontFeatureSettings,L=S.fontVariationSettings,x=v.get(135)||S.fontSize,E=v.get(136)||S.lineHeight,I=S.fontWeight,D=S.letterSpacing,k=`${x}px`,N=`${E}px`,R=`${D}px`;s.style.fontSize=k,s.style.fontWeight=I,s.style.letterSpacing=R,c.style.fontFamily=y,c.style.fontFeatureSettings=w,c.style.fontVariationSettings=L,c.style.lineHeight=N,o.style.height=N,o.style.width=N,C.style.height=N,C.style.width=N}}}renderElement(e,t,s){s.configureFont();const{completion:o}=e;s.colorspan.style.backgroundColor="";const r={labelEscapeNewLines:!0,matches:createMatches(e.score)},l=[];if(o.kind===19&&_completionItemColor.extract(e,l))s.icon.className="icon customcolor",s.iconContainer.className="icon hide",s.colorspan.style.backgroundColor=l[0];else if(o.kind===20&&this._themeService.getFileIconTheme().hasFileIcons){s.icon.className="icon hide",s.iconContainer.className="icon hide";const c=getIconClasses(this._modelService,this._languageService,URI.from({scheme:"fake",path:e.textLabel}),FileKind.FILE),d=getIconClasses(this._modelService,this._languageService,URI.from({scheme:"fake",path:o.detail}),FileKind.FILE);r.extraClasses=c.length>d.length?c:d}else o.kind===23&&this._themeService.getFileIconTheme().hasFolderIcons?(s.icon.className="icon hide",s.iconContainer.className="icon hide",r.extraClasses=[getIconClasses(this._modelService,this._languageService,URI.from({scheme:"fake",path:e.textLabel}),FileKind.FOLDER),getIconClasses(this._modelService,this._languageService,URI.from({scheme:"fake",path:o.detail}),FileKind.FOLDER)].flat()):(s.icon.className="icon hide",s.iconContainer.className="",s.iconContainer.classList.add("suggest-icon",...ThemeIcon.asClassNameArray(CompletionItemKinds.toIcon(o.kind))));o.tags&&o.tags.indexOf(1)>=0&&(r.extraClasses=(r.extraClasses||[]).concat(["deprecated"]),r.matches=[]),s.iconLabel.setLabel(e.textLabel,void 0,r),typeof o.label=="string"?(s.parametersLabel.textContent="",s.detailsLabel.textContent=stripNewLines(o.detail||""),s.root.classList.add("string-label")):(s.parametersLabel.textContent=stripNewLines(o.label.detail||""),s.detailsLabel.textContent=stripNewLines(o.label.description||""),s.root.classList.remove("string-label")),this._editor.getOption(134).showInlineDetails?show(s.detailsLabel):hide(s.detailsLabel),canExpandCompletionItem(e)?(s.right.classList.add("can-expand-details"),show(s.readMore),s.readMore.onmousedown=c=>{c.stopPropagation(),c.preventDefault()},s.readMore.onclick=c=>{c.stopPropagation(),c.preventDefault(),this._onDidToggleDetails.fire()}):(s.right.classList.remove("can-expand-details"),hide(s.readMore),s.readMore.onmousedown=null,s.readMore.onclick=null)}disposeTemplate(e){e.disposables.dispose()}};ItemRenderer=__decorate$1j([__param$1i(1,IModelService),__param$1i(2,ILanguageService),__param$1i(3,IThemeService)],ItemRenderer);function stripNewLines(a){return a.replace(/\r\n|\r|\n/g,"")}var __decorate$1i=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1h=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},SuggestWidget_1;registerColor("editorSuggestWidget.background",editorWidgetBackground,localize(1458,"Background color of the suggest widget."));registerColor("editorSuggestWidget.border",editorWidgetBorder,localize(1459,"Border color of the suggest widget."));const editorSuggestWidgetForeground=registerColor("editorSuggestWidget.foreground",editorForeground,localize(1460,"Foreground color of the suggest widget."));registerColor("editorSuggestWidget.selectedForeground",quickInputListFocusForeground,localize(1461,"Foreground color of the selected entry in the suggest widget."));registerColor("editorSuggestWidget.selectedIconForeground",quickInputListFocusIconForeground,localize(1462,"Icon foreground color of the selected entry in the suggest widget."));const editorSuggestWidgetSelectedBackground=registerColor("editorSuggestWidget.selectedBackground",quickInputListFocusBackground,localize(1463,"Background color of the selected entry in the suggest widget."));registerColor("editorSuggestWidget.highlightForeground",listHighlightForeground,localize(1464,"Color of the match highlights in the suggest widget."));registerColor("editorSuggestWidget.focusHighlightForeground",listFocusHighlightForeground,localize(1465,"Color of the match highlights in the suggest widget when an item is focused."));registerColor("editorSuggestWidgetStatus.foreground",transparent(editorSuggestWidgetForeground,.5),localize(1466,"Foreground color of the suggest widget status."));class PersistedWidgetSize{constructor(e,t){this._service=e,this._key=`suggestWidget.size/${t.getEditorType()}/${t instanceof EmbeddedCodeEditorWidget}`}restore(){const e=this._service.get(this._key,0)??"";try{const t=JSON.parse(e);if(Dimension.is(t))return Dimension.lift(t)}catch{}}store(e){this._service.store(this._key,JSON.stringify(e),0,1)}reset(){this._service.remove(this._key,0)}}var Wt;let SuggestWidget=(Wt=class{constructor(e,t,s,o,r){this.editor=e,this._storageService=t,this._state=0,this._isAuto=!1,this._pendingLayout=new MutableDisposable,this._pendingShowDetails=new MutableDisposable,this._ignoreFocusEvents=!1,this._forceRenderingAbove=!1,this._explainMode=!1,this._showTimeout=new TimeoutTimer,this._disposables=new DisposableStore,this._onDidSelect=new PauseableEmitter,this._onDidFocus=new PauseableEmitter,this._onDidHide=new Emitter$1,this._onDidShow=new Emitter$1,this.onDidSelect=this._onDidSelect.event,this.onDidFocus=this._onDidFocus.event,this.onDidHide=this._onDidHide.event,this.onDidShow=this._onDidShow.event,this._onDetailsKeydown=new Emitter$1,this.onDetailsKeyDown=this._onDetailsKeydown.event,this.element=new ResizableHTMLElement,this.element.domNode.classList.add("editor-widget","suggest-widget"),this._contentWidget=new SuggestContentWidget(this,e),this._persistedSize=new PersistedWidgetSize(t,e);class l{constructor(m,_,C=!1,b=!1){this.persistedSize=m,this.currentSize=_,this.persistHeight=C,this.persistWidth=b}}let c;this._disposables.add(this.element.onDidWillResize(()=>{this._contentWidget.lockPreference(),c=new l(this._persistedSize.restore(),this.element.size)})),this._disposables.add(this.element.onDidResize(p=>{var m,_;if(this._resize(p.dimension.width,p.dimension.height),c&&(c.persistHeight=c.persistHeight||!!p.north||!!p.south,c.persistWidth=c.persistWidth||!!p.east||!!p.west),!!p.done){if(c){const{itemHeight:C,defaultSize:b}=this.getLayoutInfo(),v=Math.round(C/2);let{width:S,height:y}=this.element.size;(!c.persistHeight||Math.abs(c.currentSize.height-y)<=v)&&(y=((m=c.persistedSize)==null?void 0:m.height)??b.height),(!c.persistWidth||Math.abs(c.currentSize.width-S)<=v)&&(S=((_=c.persistedSize)==null?void 0:_.width)??b.width),this._persistedSize.store(new Dimension(S,y))}this._contentWidget.unlockPreference(),c=void 0}})),this._messageElement=append$2(this.element.domNode,$$l(".message")),this._listElement=append$2(this.element.domNode,$$l(".tree"));const d=this._disposables.add(r.createInstance(SuggestDetailsWidget,this.editor));d.onDidClose(()=>this.toggleDetails(),this,this._disposables),this._details=new SuggestDetailsOverlay(d,this.editor);const u=()=>this.element.domNode.classList.toggle("no-icons",!this.editor.getOption(134).showIcons);u();const g=r.createInstance(ItemRenderer,this.editor);this._disposables.add(g),this._disposables.add(g.onDidToggleDetails(()=>this.toggleDetails())),this._list=new List("SuggestWidget",this._listElement,{getHeight:p=>this.getLayoutInfo().itemHeight,getTemplateId:p=>"suggestion"},[g],{alwaysConsumeMouseWheel:!0,useShadows:!1,mouseSupport:!1,multipleSelectionSupport:!1,accessibilityProvider:{getRole:()=>isWindows?"listitem":"option",getWidgetAriaLabel:()=>localize(1469,"Suggest"),getWidgetRole:()=>"listbox",getAriaLabel:p=>{let m=p.textLabel;const _=CompletionItemKinds.toLabel(p.completion.kind);if(typeof p.completion.label!="string"){const{detail:S,description:y}=p.completion.label;S&&y?m=localize(1470,"{0} {1}, {2}, {3}",m,S,y,_):S?m=localize(1471,"{0} {1}, {2}",m,S,_):y&&(m=localize(1472,"{0}, {1}, {2}",m,y,_))}else m=localize(1473,"{0}, {1}",m,_);if(!p.isResolved||!this._isDetailsVisible())return m;const{documentation:C,detail:b}=p.completion,v=format("{0}{1}",b||"",C?typeof C=="string"?C:C.value:"");return localize(1474,"{0}, docs: {1}",m,v)}}}),this._list.style(getListStyles({listInactiveFocusBackground:editorSuggestWidgetSelectedBackground,listInactiveFocusOutline:activeContrastBorder})),this._status=r.createInstance(SuggestWidgetStatus,this.element.domNode,suggestWidgetStatusbarMenu);const f=()=>this.element.domNode.classList.toggle("with-status-bar",this.editor.getOption(134).showStatusBar);f(),this._disposables.add(o.onDidColorThemeChange(p=>this._onThemeChange(p))),this._onThemeChange(o.getColorTheme()),this._disposables.add(this._list.onMouseDown(p=>this._onListMouseDownOrTap(p))),this._disposables.add(this._list.onTap(p=>this._onListMouseDownOrTap(p))),this._disposables.add(this._list.onDidChangeSelection(p=>this._onListSelection(p))),this._disposables.add(this._list.onDidChangeFocus(p=>this._onListFocus(p))),this._disposables.add(this.editor.onDidChangeCursorSelection(()=>this._onCursorSelectionChanged())),this._disposables.add(this.editor.onDidChangeConfiguration(p=>{p.hasChanged(134)&&(f(),u()),this._completionModel&&(p.hasChanged(59)||p.hasChanged(135)||p.hasChanged(136))&&this._list.splice(0,this._list.length,this._completionModel.items)})),this._ctxSuggestWidgetVisible=Context$2.Visible.bindTo(s),this._ctxSuggestWidgetDetailsVisible=Context$2.DetailsVisible.bindTo(s),this._ctxSuggestWidgetMultipleSuggestions=Context$2.MultipleSuggestions.bindTo(s),this._ctxSuggestWidgetHasFocusedSuggestion=Context$2.HasFocusedSuggestion.bindTo(s),this._disposables.add(addStandardDisposableListener(this._details.widget.domNode,"keydown",p=>{this._onDetailsKeydown.fire(p)})),this._disposables.add(this.editor.onMouseDown(p=>this._onEditorMouseDown(p)))}dispose(){var e;this._details.widget.dispose(),this._details.dispose(),this._list.dispose(),this._status.dispose(),this._disposables.dispose(),(e=this._loadingTimeout)==null||e.dispose(),this._pendingLayout.dispose(),this._pendingShowDetails.dispose(),this._showTimeout.dispose(),this._contentWidget.dispose(),this.element.dispose()}_onEditorMouseDown(e){this._details.widget.domNode.contains(e.target.element)?this._details.widget.domNode.focus():this.element.domNode.contains(e.target.element)&&this.editor.focus()}_onCursorSelectionChanged(){this._state!==0&&this._contentWidget.layout()}_onListMouseDownOrTap(e){typeof e.element>"u"||typeof e.index>"u"||(e.browserEvent.preventDefault(),e.browserEvent.stopPropagation(),this._select(e.element,e.index))}_onListSelection(e){e.elements.length&&this._select(e.elements[0],e.indexes[0])}_select(e,t){const s=this._completionModel;s&&(this._onDidSelect.fire({item:e,index:t,model:s}),this.editor.focus())}_onThemeChange(e){this._details.widget.borderWidth=isHighContrast(e.type)?2:1}_onListFocus(e){var o;if(this._ignoreFocusEvents)return;if(this._state===5&&this._setState(3),!e.elements.length){this._currentSuggestionDetails&&(this._currentSuggestionDetails.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=void 0),this.editor.setAriaOptions({activeDescendant:void 0}),this._ctxSuggestWidgetHasFocusedSuggestion.set(!1);return}if(!this._completionModel)return;this._ctxSuggestWidgetHasFocusedSuggestion.set(!0);const t=e.elements[0],s=e.indexes[0];t!==this._focusedItem&&((o=this._currentSuggestionDetails)==null||o.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=t,this._list.reveal(s),this._currentSuggestionDetails=createCancelablePromise(async r=>{const l=disposableTimeout(()=>{this._isDetailsVisible()&&this._showDetails(!0,!1)},250),c=r.onCancellationRequested(()=>l.dispose());try{return await t.resolve(r)}finally{l.dispose(),c.dispose()}}),this._currentSuggestionDetails.then(()=>{s>=this._list.length||t!==this._list.element(s)||(this._ignoreFocusEvents=!0,this._list.splice(s,1,[t]),this._list.setFocus([s]),this._ignoreFocusEvents=!1,this._isDetailsVisible()?this._showDetails(!1,!1):this.element.domNode.classList.remove("docs-side"),this.editor.setAriaOptions({activeDescendant:this._list.getElementID(s)}))}).catch(onUnexpectedError)),this._onDidFocus.fire({item:t,index:s,model:this._completionModel})}_setState(e){if(this._state!==e)switch(this._state=e,this.element.domNode.classList.toggle("frozen",e===4),this.element.domNode.classList.remove("message"),e){case 0:hide(this._messageElement,this._listElement,this._status.element),this._details.hide(!0),this._status.hide(),this._contentWidget.hide(),this._ctxSuggestWidgetVisible.reset(),this._ctxSuggestWidgetMultipleSuggestions.reset(),this._ctxSuggestWidgetHasFocusedSuggestion.reset(),this._showTimeout.cancel(),this.element.domNode.classList.remove("visible"),this._list.splice(0,this._list.length),this._focusedItem=void 0,this._cappedHeight=void 0,this._explainMode=!1;break;case 1:this.element.domNode.classList.add("message"),this._messageElement.textContent=SuggestWidget_1.LOADING_MESSAGE,hide(this._listElement,this._status.element),show(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,status(SuggestWidget_1.LOADING_MESSAGE);break;case 2:this.element.domNode.classList.add("message"),this._messageElement.textContent=SuggestWidget_1.NO_SUGGESTIONS_MESSAGE,hide(this._listElement,this._status.element),show(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,status(SuggestWidget_1.NO_SUGGESTIONS_MESSAGE);break;case 3:hide(this._messageElement),show(this._listElement,this._status.element),this._show();break;case 4:hide(this._messageElement),show(this._listElement,this._status.element),this._show();break;case 5:hide(this._messageElement),show(this._listElement,this._status.element),this._details.show(),this._show(),this._details.widget.focus();break}}_show(){this._status.show(),this._contentWidget.show(),this._layout(this._persistedSize.restore()),this._ctxSuggestWidgetVisible.set(!0),this._showTimeout.cancelAndSet(()=>{this.element.domNode.classList.add("visible"),this._onDidShow.fire(this)},100)}showTriggered(e,t){this._state===0&&(this._contentWidget.setPosition(this.editor.getPosition()),this._isAuto=!!e,this._isAuto||(this._loadingTimeout=disposableTimeout(()=>this._setState(1),t)))}showSuggestions(e,t,s,o,r){var d,u;if(this._contentWidget.setPosition(this.editor.getPosition()),(d=this._loadingTimeout)==null||d.dispose(),(u=this._currentSuggestionDetails)==null||u.cancel(),this._currentSuggestionDetails=void 0,this._completionModel!==e&&(this._completionModel=e),s&&this._state!==2&&this._state!==0){this._setState(4);return}const l=this._completionModel.items.length,c=l===0;if(this._ctxSuggestWidgetMultipleSuggestions.set(l>1),c){this._setState(o?0:2),this._completionModel=void 0;return}this._focusedItem=void 0,this._onDidFocus.pause(),this._onDidSelect.pause();try{this._list.splice(0,this._list.length,this._completionModel.items),this._setState(s?4:3),this._list.reveal(t,0,t===0?0:this.getLayoutInfo().itemHeight*.33),this._list.setFocus(r?[]:[t])}finally{this._onDidFocus.resume(),this._onDidSelect.resume()}this._pendingLayout.value=runAtThisOrScheduleAtNextAnimationFrame(getWindow(this.element.domNode),()=>{this._pendingLayout.clear(),this._layout(this.element.size),this._details.widget.domNode.classList.remove("focused")})}focusSelected(){this._list.length>0&&this._list.setFocus([0])}selectNextPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageDown(),!0;case 1:return!this._isAuto;default:return this._list.focusNextPage(),!0}}selectNext(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusNext(1,!0),!0}}selectLast(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollBottom(),!0;case 1:return!this._isAuto;default:return this._list.focusLast(),!0}}selectPreviousPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageUp(),!0;case 1:return!this._isAuto;default:return this._list.focusPreviousPage(),!0}}selectPrevious(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusPrevious(1,!0),!1}}selectFirst(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollTop(),!0;case 1:return!this._isAuto;default:return this._list.focusFirst(),!0}}getFocusedItem(){if(this._state!==0&&this._state!==2&&this._state!==1&&this._completionModel&&this._list.getFocus().length>0)return{item:this._list.getFocusedElements()[0],index:this._list.getFocus()[0],model:this._completionModel}}toggleDetailsFocus(){this._state===5?(this._list.setFocus(this._list.getFocus()),this._setState(3)):this._state===3&&(this._setState(5),this._isDetailsVisible()?this._details.widget.focus():this.toggleDetails(!0))}toggleDetails(e=!1){this._isDetailsVisible()?(this._pendingShowDetails.clear(),this._ctxSuggestWidgetDetailsVisible.set(!1),this._setDetailsVisible(!1),this._details.hide(),this.element.domNode.classList.remove("shows-details")):(canExpandCompletionItem(this._list.getFocusedElements()[0])||this._explainMode)&&(this._state===3||this._state===5||this._state===4)&&(this._ctxSuggestWidgetDetailsVisible.set(!0),this._setDetailsVisible(!0),this._showDetails(!1,e))}_showDetails(e,t){this._pendingShowDetails.value=runAtThisOrScheduleAtNextAnimationFrame(getWindow(this.element.domNode),()=>{this._pendingShowDetails.clear(),this._details.show();let s=!1;e?this._details.widget.renderLoading():this._details.widget.renderItem(this._list.getFocusedElements()[0],this._explainMode),this._details.widget.isEmpty?this._details.hide():(this._positionDetails(),this.element.domNode.classList.add("shows-details"),t&&(this._details.widget.focus(),s=!0)),s||this.editor.focus()})}toggleExplainMode(){this._list.getFocusedElements()[0]&&(this._explainMode=!this._explainMode,this._isDetailsVisible()?this._showDetails(!1,!1):this.toggleDetails())}resetPersistedSize(){this._persistedSize.reset()}hideWidget(){var s;this._pendingLayout.clear(),this._pendingShowDetails.clear(),(s=this._loadingTimeout)==null||s.dispose(),this._setState(0),this._onDidHide.fire(this),this.element.clearSashHoverState();const e=this._persistedSize.restore(),t=Math.ceil(this.getLayoutInfo().itemHeight*4.3);e&&e.height<t&&this._persistedSize.store(e.with(void 0,t))}isFrozen(){return this._state===4}_afterRender(e){if(e===null){this._isDetailsVisible()&&this._details.hide();return}this._state===2||this._state===1||(this._isDetailsVisible()&&!this._details.widget.isEmpty&&this._details.show(),this._positionDetails())}_layout(e){var l,c;if(!this.editor.hasModel()||!this.editor.getDomNode())return;const t=getClientArea(this.element.domNode.ownerDocument.body),s=this.getLayoutInfo();e||(e=s.defaultSize);let o=e.height,r=e.width;if(this._status.element.style.height=`${s.itemHeight}px`,this._state===2||this._state===1)o=s.itemHeight+s.borderHeight,r=s.defaultSize.width/2,this.element.enableSashes(!1,!1,!1,!1),this.element.minSize=this.element.maxSize=new Dimension(r,o),this._contentWidget.setPreference(2);else{const d=t.width-s.borderHeight-2*s.horizontalPadding;r>d&&(r=d);const u=this._completionModel?this._completionModel.stats.pLabelLen*s.typicalHalfwidthCharacterWidth:r,g=s.statusBarHeight+this._list.contentHeight+s.borderHeight,f=s.itemHeight+s.statusBarHeight,p=getDomNodePagePosition(this.editor.getDomNode()),m=this.editor.getScrolledVisiblePosition(this.editor.getPosition()),_=p.top+m.top+m.height,C=Math.min(t.height-_-s.verticalPadding,g),b=p.top+m.top-s.verticalPadding,v=Math.min(b,g);let S=Math.min(Math.max(v,C)+s.borderHeight,g);o===((l=this._cappedHeight)==null?void 0:l.capped)&&(o=this._cappedHeight.wanted),o<f&&(o=f),o>S&&(o=S);const y=150;o>C&&v>C||this._forceRenderingAbove&&b>y?(this._contentWidget.setPreference(1),this.element.enableSashes(!0,!0,!1,!1),S=v):(this._contentWidget.setPreference(2),this.element.enableSashes(!1,!0,!0,!1),S=C),this.element.preferredSize=new Dimension(u,s.defaultSize.height),this.element.maxSize=new Dimension(d,S),this.element.minSize=new Dimension(220,f),this._cappedHeight=o===g?{wanted:((c=this._cappedHeight)==null?void 0:c.wanted)??e.height,capped:o}:void 0}this._resize(r,o)}_resize(e,t){const{width:s,height:o}=this.element.maxSize;e=Math.min(s,e),t=Math.min(o,t);const{statusBarHeight:r}=this.getLayoutInfo();this._list.layout(t-r,e),this._listElement.style.height=`${t-r}px`,this.element.layout(t,e),this._contentWidget.layout(),this._positionDetails()}_positionDetails(){var e;this._isDetailsVisible()&&this._details.placeAtAnchor(this.element.domNode,((e=this._contentWidget.getPosition())==null?void 0:e.preference[0])===2)}getLayoutInfo(){const e=this.editor.getOption(59),t=clamp(this.editor.getOption(136)||e.lineHeight,8,1e3),s=!this.editor.getOption(134).showStatusBar||this._state===2||this._state===1?0:t,o=this._details.widget.borderWidth,r=2*o;return{itemHeight:t,statusBarHeight:s,borderWidth:o,borderHeight:r,typicalHalfwidthCharacterWidth:e.typicalHalfwidthCharacterWidth,verticalPadding:22,horizontalPadding:14,defaultSize:new Dimension(430,s+12*t)}}_isDetailsVisible(){return this._storageService.getBoolean("expandSuggestionDocs",0,!1)}_setDetailsVisible(e){this._storageService.store("expandSuggestionDocs",e,0,0)}forceRenderingAbove(){this._forceRenderingAbove||(this._forceRenderingAbove=!0,this._layout(this._persistedSize.restore()))}stopForceRenderingAbove(){this._forceRenderingAbove=!1}},SuggestWidget_1=Wt,Wt.LOADING_MESSAGE=localize(1467,"Loading..."),Wt.NO_SUGGESTIONS_MESSAGE=localize(1468,"No suggestions."),Wt);SuggestWidget=SuggestWidget_1=__decorate$1i([__param$1h(1,IStorageService),__param$1h(2,IContextKeyService),__param$1h(3,IThemeService),__param$1h(4,IInstantiationService)],SuggestWidget);class SuggestContentWidget{constructor(e,t){this._widget=e,this._editor=t,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._preferenceLocked=!1,this._added=!1,this._hidden=!1}dispose(){this._added&&(this._added=!1,this._editor.removeContentWidget(this))}getId(){return"editor.widget.suggestWidget"}getDomNode(){return this._widget.element.domNode}show(){this._hidden=!1,this._added||(this._added=!0,this._editor.addContentWidget(this))}hide(){this._hidden||(this._hidden=!0,this.layout())}layout(){this._editor.layoutContentWidget(this)}getPosition(){return this._hidden||!this._position||!this._preference?null:{position:this._position,preference:[this._preference]}}beforeRender(){const{height:e,width:t}=this._widget.element.size,{borderWidth:s,horizontalPadding:o}=this._widget.getLayoutInfo();return new Dimension(t+2*s+o,e+2*s)}afterRender(e){this._widget._afterRender(e)}setPreference(e){this._preferenceLocked||(this._preference=e)}lockPreference(){this._preferenceLocked=!0}unlockPreference(){this._preferenceLocked=!1}setPosition(e){this._position=e}}var __decorate$1h=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1g=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},SuggestController_1;class LineSuffix{constructor(e,t){if(this._model=e,this._position=t,this._decorationOptions=ModelDecorationOptions.register({description:"suggest-line-suffix",stickiness:1}),e.getLineMaxColumn(t.lineNumber)!==t.column){const o=e.getOffsetAt(t),r=e.getPositionAt(o+1);e.changeDecorations(l=>{this._marker&&l.removeDecoration(this._marker),this._marker=l.addDecoration(Range$2.fromPositions(t,r),this._decorationOptions)})}}dispose(){this._marker&&!this._model.isDisposed()&&this._model.changeDecorations(e=>{e.removeDecoration(this._marker),this._marker=void 0})}delta(e){if(this._model.isDisposed()||this._position.lineNumber!==e.lineNumber)return 0;if(this._marker){const t=this._model.getDecorationRange(this._marker);return this._model.getOffsetAt(t.getStartPosition())-this._model.getOffsetAt(e)}else return this._model.getLineMaxColumn(e.lineNumber)-e.column}}var Vi;let SuggestController=(Vi=class{static get(e){return e.getContribution(SuggestController_1.ID)}get onWillInsertSuggestItem(){return this._onWillInsertSuggestItem.event}constructor(e,t,s,o,r,l,c){this._memoryService=t,this._commandService=s,this._contextKeyService=o,this._instantiationService=r,this._logService=l,this._telemetryService=c,this._lineSuffix=new MutableDisposable,this._toDispose=new DisposableStore,this._selectors=new PriorityRegistry(f=>f.priority),this._onWillInsertSuggestItem=new Emitter$1,this._wantsForceRenderingAbove=!1,this.editor=e,this.model=r.createInstance(SuggestModel,this.editor),this._selectors.register({priority:0,select:(f,p,m)=>this._memoryService.select(f,p,m)});const d=Context$2.InsertMode.bindTo(o);d.set(e.getOption(134).insertMode),this._toDispose.add(this.model.onDidTrigger(()=>d.set(e.getOption(134).insertMode))),this.widget=this._toDispose.add(new WindowIdleValue(getWindow(e.getDomNode()),()=>{const f=this._instantiationService.createInstance(SuggestWidget,this.editor);this._toDispose.add(f),this._toDispose.add(f.onDidSelect(b=>this._insertSuggestion(b,0),this));const p=new CommitCharacterController(this.editor,f,this.model,b=>this._insertSuggestion(b,2));this._toDispose.add(p);const m=Context$2.MakesTextEdit.bindTo(this._contextKeyService),_=Context$2.HasInsertAndReplaceRange.bindTo(this._contextKeyService),C=Context$2.CanResolve.bindTo(this._contextKeyService);return this._toDispose.add(toDisposable(()=>{m.reset(),_.reset(),C.reset()})),this._toDispose.add(f.onDidFocus(({item:b})=>{const v=this.editor.getPosition(),S=b.editStart.column,y=v.column;let w=!0;this.editor.getOption(1)==="smart"&&this.model.state===2&&!b.completion.additionalTextEdits&&!(b.completion.insertTextRules&4)&&y-S===b.completion.insertText.length&&(w=this.editor.getModel().getValueInRange({startLineNumber:v.lineNumber,startColumn:S,endLineNumber:v.lineNumber,endColumn:y})!==b.completion.insertText),m.set(w),_.set(!Position$1.equals(b.editInsertEnd,b.editReplaceEnd)),C.set(!!b.provider.resolveCompletionItem||!!b.completion.documentation||b.completion.detail!==b.completion.label)})),this._toDispose.add(f.onDetailsKeyDown(b=>{if(b.toKeyCodeChord().equals(new KeyCodeChord(!0,!1,!1,!1,33))||isMacintosh&&b.toKeyCodeChord().equals(new KeyCodeChord(!1,!1,!1,!0,33))){b.stopPropagation();return}b.toKeyCodeChord().isModifierKey()||this.editor.focus()})),this._wantsForceRenderingAbove&&f.forceRenderingAbove(),f})),this._overtypingCapturer=this._toDispose.add(new WindowIdleValue(getWindow(e.getDomNode()),()=>this._toDispose.add(new OvertypingCapturer(this.editor,this.model)))),this._alternatives=this._toDispose.add(new WindowIdleValue(getWindow(e.getDomNode()),()=>this._toDispose.add(new SuggestAlternatives(this.editor,this._contextKeyService)))),this._toDispose.add(r.createInstance(WordContextKey,e)),this._toDispose.add(this.model.onDidTrigger(f=>{this.widget.value.showTriggered(f.auto,f.shy?250:50),this._lineSuffix.value=new LineSuffix(this.editor.getModel(),f.position)})),this._toDispose.add(this.model.onDidSuggest(f=>{if(f.triggerOptions.shy)return;let p=-1;for(const _ of this._selectors.itemsOrderedByPriorityDesc)if(p=_.select(this.editor.getModel(),this.editor.getPosition(),f.completionModel.items),p!==-1)break;if(p===-1&&(p=0),this.model.state===0)return;let m=!1;if(f.triggerOptions.auto){const _=this.editor.getOption(134);_.selectionMode==="never"||_.selectionMode==="always"?m=_.selectionMode==="never":_.selectionMode==="whenTriggerCharacter"?m=f.triggerOptions.triggerKind!==1:_.selectionMode==="whenQuickSuggestion"&&(m=f.triggerOptions.triggerKind===1&&!f.triggerOptions.refilter)}this.widget.value.showSuggestions(f.completionModel,p,f.isFrozen,f.triggerOptions.auto,m)})),this._toDispose.add(this.model.onDidCancel(f=>{f.retrigger||this.widget.value.hideWidget()})),this._toDispose.add(this.editor.onDidBlurEditorWidget(()=>{this.model.cancel(),this.model.clear()}));const u=Context$2.AcceptSuggestionsOnEnter.bindTo(o),g=()=>{const f=this.editor.getOption(1);u.set(f==="on"||f==="smart")};this._toDispose.add(this.editor.onDidChangeConfiguration(()=>g())),g()}dispose(){this._alternatives.dispose(),this._toDispose.dispose(),this.widget.dispose(),this.model.dispose(),this._lineSuffix.dispose(),this._onWillInsertSuggestItem.dispose()}_insertSuggestion(e,t){var _;if(!e||!e.item){this._alternatives.value.reset(),this.model.cancel(),this.model.clear();return}if(!this.editor.hasModel())return;const s=SnippetController2.get(this.editor);if(!s)return;this._onWillInsertSuggestItem.fire({item:e.item});const o=this.editor.getModel(),r=o.getAlternativeVersionId(),{item:l}=e,c=[],d=new CancellationTokenSource$1;t&1||this.editor.pushUndoStop();const u=this.getOverwriteInfo(l,!!(t&8));this._memoryService.memorize(o,this.editor.getPosition(),l);const g=l.isResolved;let f=-1,p=-1;if(Array.isArray(l.completion.additionalTextEdits)){this.model.cancel();const C=StableEditorScrollState.capture(this.editor);this.editor.executeEdits("suggestController.additionalTextEdits.sync",l.completion.additionalTextEdits.map(b=>{let v=Range$2.lift(b.range);if(v.startLineNumber===l.position.lineNumber&&v.startColumn>l.position.column){const S=this.editor.getPosition().column-l.position.column,y=S,w=Range$2.spansMultipleLines(v)?0:S;v=new Range$2(v.startLineNumber,v.startColumn+y,v.endLineNumber,v.endColumn+w)}return EditOperation.replaceMove(v,b.text)})),C.restoreRelativeVerticalPositionOfCursor(this.editor)}else if(!g){const C=new StopWatch;let b;const v=o.onDidChangeContent(L=>{if(L.isFlush){d.cancel(),v.dispose();return}for(const x of L.changes){const E=Range$2.getEndPosition(x.range);(!b||Position$1.isBefore(E,b))&&(b=E)}}),S=t;t|=2;let y=!1;const w=this.editor.onWillType(()=>{w.dispose(),y=!0,S&2||this.editor.pushUndoStop()});c.push(l.resolve(d.token).then(()=>{if(!l.completion.additionalTextEdits||d.token.isCancellationRequested)return;if(b&&l.completion.additionalTextEdits.some(x=>Position$1.isBefore(b,Range$2.getStartPosition(x.range))))return!1;y&&this.editor.pushUndoStop();const L=StableEditorScrollState.capture(this.editor);return this.editor.executeEdits("suggestController.additionalTextEdits.async",l.completion.additionalTextEdits.map(x=>EditOperation.replaceMove(Range$2.lift(x.range),x.text))),L.restoreRelativeVerticalPositionOfCursor(this.editor),(y||!(S&2))&&this.editor.pushUndoStop(),!0}).then(L=>{this._logService.trace("[suggest] async resolving of edits DONE (ms, applied?)",C.elapsed(),L),p=L===!0?1:L===!1?0:-2}).finally(()=>{v.dispose(),w.dispose()}))}let{insertText:m}=l.completion;if(l.completion.insertTextRules&4||(m=SnippetParser.escape(m)),this.model.cancel(),s.insert(m,{overwriteBefore:u.overwriteBefore,overwriteAfter:u.overwriteAfter,undoStopBefore:!1,undoStopAfter:!1,adjustWhitespace:!(l.completion.insertTextRules&1),clipboardText:e.model.clipboardText,overtypingCapturer:this._overtypingCapturer.value,reason:EditSources.suggest({providerId:ProviderId.fromExtensionId((_=l.extensionId)==null?void 0:_.value)})}),t&2||this.editor.pushUndoStop(),l.completion.command)if(l.completion.command.id===TriggerSuggestAction.id)this.model.trigger({auto:!0,retrigger:!0});else{const C=new StopWatch;c.push(this._commandService.executeCommand(l.completion.command.id,...l.completion.command.arguments?[...l.completion.command.arguments]:[]).catch(b=>{l.completion.extensionId?onUnexpectedExternalError(b):onUnexpectedError(b)}).finally(()=>{f=C.elapsed()}))}t&4&&this._alternatives.value.set(e,C=>{for(d.cancel();o.canUndo();){r!==o.getAlternativeVersionId()&&o.undo(),this._insertSuggestion(C,3|(t&8?8:0));break}}),this._alertCompletionItem(l),Promise.all(c).finally(()=>{this._reportSuggestionAcceptedTelemetry(l,o,g,f,p,e.index,e.model.items),this.model.clear(),d.dispose()})}_reportSuggestionAcceptedTelemetry(e,t,s,o,r,l,c){var p;if(Math.random()>1e-4)return;const d=new Map;for(let m=0;m<Math.min(30,c.length);m++){const _=c[m].textLabel;d.has(_)?d.get(_).push(m):d.set(_,[m])}const u=d.get(e.textLabel),f=u&&u.length>1?u[0]:-1;this._telemetryService.publicLog2("suggest.acceptedSuggestion",{extensionId:((p=e.extensionId)==null?void 0:p.value)??"unknown",providerId:e.provider._debugDisplayName??"unknown",kind:e.completion.kind,basenameHash:hash(basename(t.uri)).toString(16),languageId:t.getLanguageId(),fileExtension:extname(t.uri),resolveInfo:e.provider.resolveCompletionItem?s?1:0:-1,resolveDuration:e.resolveDuration,commandDuration:o,additionalEditsAsync:r,index:l,firstIndex:f})}getOverwriteInfo(e,t){assertType(this.editor.hasModel());let s=this.editor.getOption(134).insertMode==="replace";t&&(s=!s);const o=e.position.column-e.editStart.column,r=(s?e.editReplaceEnd.column:e.editInsertEnd.column)-e.position.column,l=this.editor.getPosition().column-e.position.column,c=this._lineSuffix.value?this._lineSuffix.value.delta(this.editor.getPosition()):0;return{overwriteBefore:o+l,overwriteAfter:r+c}}_alertCompletionItem(e){if(isNonEmptyArray(e.completion.additionalTextEdits)){const t=localize(1448,"Accepting '{0}' made {1} additional edits",e.textLabel,e.completion.additionalTextEdits.length);alert$1(t)}}triggerSuggest(e,t,s){this.editor.hasModel()&&(this.model.trigger({auto:t??!1,completionOptions:{providerFilter:e,kindFilter:s?new Set:void 0}}),this.editor.revealPosition(this.editor.getPosition(),0),this.editor.focus())}triggerSuggestAndAcceptBest(e){if(!this.editor.hasModel())return;const t=this.editor.getPosition(),s=()=>{t.equals(this.editor.getPosition())&&this._commandService.executeCommand(e.fallback)},o=r=>{if(r.completion.insertTextRules&4||r.completion.additionalTextEdits)return!0;const l=this.editor.getPosition(),c=r.editStart.column,d=l.column;return d-c!==r.completion.insertText.length?!0:this.editor.getModel().getValueInRange({startLineNumber:l.lineNumber,startColumn:c,endLineNumber:l.lineNumber,endColumn:d})!==r.completion.insertText};Event$1.once(this.model.onDidTrigger)(r=>{const l=[];Event$1.any(this.model.onDidTrigger,this.model.onDidCancel)(()=>{dispose(l),s()},void 0,l),this.model.onDidSuggest(({completionModel:c})=>{if(dispose(l),c.items.length===0){s();return}const d=this._memoryService.select(this.editor.getModel(),this.editor.getPosition(),c.items),u=c.items[d];if(!o(u)){s();return}this.editor.pushUndoStop(),this._insertSuggestion({index:d,item:u,model:c},7)},void 0,l)}),this.model.trigger({auto:!1,shy:!0}),this.editor.revealPosition(t,0),this.editor.focus()}acceptSelectedSuggestion(e,t){const s=this.widget.value.getFocusedItem();let o=0;e&&(o|=4),t&&(o|=8),this._insertSuggestion(s,o)}acceptNextSuggestion(){this._alternatives.value.next()}acceptPrevSuggestion(){this._alternatives.value.prev()}cancelSuggestWidget(){this.model.cancel(),this.model.clear(),this.widget.value.hideWidget()}focusSuggestion(){this.widget.value.focusSelected()}selectNextSuggestion(){this.widget.value.selectNext()}selectNextPageSuggestion(){this.widget.value.selectNextPage()}selectLastSuggestion(){this.widget.value.selectLast()}selectPrevSuggestion(){this.widget.value.selectPrevious()}selectPrevPageSuggestion(){this.widget.value.selectPreviousPage()}selectFirstSuggestion(){this.widget.value.selectFirst()}toggleSuggestionDetails(){this.widget.value.toggleDetails()}toggleExplainMode(){this.widget.value.toggleExplainMode()}toggleSuggestionFocus(){this.widget.value.toggleDetailsFocus()}resetWidgetSize(){this.widget.value.resetPersistedSize()}forceRenderingAbove(){this.widget.isInitialized?this.widget.value.forceRenderingAbove():this._wantsForceRenderingAbove=!0}stopForceRenderingAbove(){this.widget.isInitialized?this.widget.value.stopForceRenderingAbove():this._wantsForceRenderingAbove=!1}registerSelector(e){return this._selectors.register(e)}},SuggestController_1=Vi,Vi.ID="editor.contrib.suggestController",Vi);SuggestController=SuggestController_1=__decorate$1h([__param$1g(1,ISuggestMemoryService),__param$1g(2,ICommandService),__param$1g(3,IContextKeyService),__param$1g(4,IInstantiationService),__param$1g(5,ILogService),__param$1g(6,ITelemetryService)],SuggestController);class PriorityRegistry{constructor(e){this.prioritySelector=e,this._items=new Array}register(e){if(this._items.indexOf(e)!==-1)throw new Error("Value is already registered");return this._items.push(e),this._items.sort((t,s)=>this.prioritySelector(s)-this.prioritySelector(t)),{dispose:()=>{const t=this._items.indexOf(e);t>=0&&this._items.splice(t,1)}}}get itemsOrderedByPriorityDesc(){return this._items}}const Gs=class Gs extends EditorAction{constructor(){super({id:Gs.id,label:localize2(1456,"Trigger Suggest"),precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasCompletionItemProvider,Context$2.Visible.toNegated()),kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[521,2087]},weight:100}})}run(e,t,s){const o=SuggestController.get(t);if(!o)return;let r;s&&typeof s=="object"&&s.auto===!0&&(r=!0),o.triggerSuggest(void 0,r,void 0)}};Gs.id="editor.action.triggerSuggest";let TriggerSuggestAction=Gs;registerEditorContribution(SuggestController.ID,SuggestController,2);registerEditorAction(TriggerSuggestAction);const weight$2=100+90,SuggestCommand=EditorCommand.bindToContribution(SuggestController.get);registerEditorCommand(new SuggestCommand({id:"acceptSelectedSuggestion",precondition:ContextKeyExpr.and(Context$2.Visible,Context$2.HasFocusedSuggestion),handler(a){a.acceptSelectedSuggestion(!0,!1)},kbOpts:[{primary:2,kbExpr:ContextKeyExpr.and(Context$2.Visible,EditorContextKeys.textInputFocus),weight:weight$2},{primary:3,kbExpr:ContextKeyExpr.and(Context$2.Visible,EditorContextKeys.textInputFocus,Context$2.AcceptSuggestionsOnEnter,Context$2.MakesTextEdit),weight:weight$2}],menuOpts:[{menuId:suggestWidgetStatusbarMenu,title:localize(1449,"Insert"),group:"left",order:1,when:Context$2.HasInsertAndReplaceRange.toNegated()},{menuId:suggestWidgetStatusbarMenu,title:localize(1450,"Insert"),group:"left",order:1,when:ContextKeyExpr.and(Context$2.HasInsertAndReplaceRange,Context$2.InsertMode.isEqualTo("insert"))},{menuId:suggestWidgetStatusbarMenu,title:localize(1451,"Replace"),group:"left",order:1,when:ContextKeyExpr.and(Context$2.HasInsertAndReplaceRange,Context$2.InsertMode.isEqualTo("replace"))}]}));registerEditorCommand(new SuggestCommand({id:"acceptAlternativeSelectedSuggestion",precondition:ContextKeyExpr.and(Context$2.Visible,EditorContextKeys.textInputFocus,Context$2.HasFocusedSuggestion),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:1027,secondary:[1026]},handler(a){a.acceptSelectedSuggestion(!1,!0)},menuOpts:[{menuId:suggestWidgetStatusbarMenu,group:"left",order:2,when:ContextKeyExpr.and(Context$2.HasInsertAndReplaceRange,Context$2.InsertMode.isEqualTo("insert")),title:localize(1452,"Replace")},{menuId:suggestWidgetStatusbarMenu,group:"left",order:2,when:ContextKeyExpr.and(Context$2.HasInsertAndReplaceRange,Context$2.InsertMode.isEqualTo("replace")),title:localize(1453,"Insert")}]}));CommandsRegistry.registerCommandAlias("acceptSelectedSuggestionOnEnter","acceptSelectedSuggestion");registerEditorCommand(new SuggestCommand({id:"hideSuggestWidget",precondition:Context$2.Visible,handler:a=>a.cancelSuggestWidget(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:9,secondary:[1033]}}));registerEditorCommand(new SuggestCommand({id:"selectNextSuggestion",precondition:ContextKeyExpr.and(Context$2.Visible,ContextKeyExpr.or(Context$2.MultipleSuggestions,Context$2.HasFocusedSuggestion.negate())),handler:a=>a.selectNextSuggestion(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:18,secondary:[2066],mac:{primary:18,secondary:[2066,300]}}}));registerEditorCommand(new SuggestCommand({id:"selectNextPageSuggestion",precondition:ContextKeyExpr.and(Context$2.Visible,ContextKeyExpr.or(Context$2.MultipleSuggestions,Context$2.HasFocusedSuggestion.negate())),handler:a=>a.selectNextPageSuggestion(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:12,secondary:[2060]}}));registerEditorCommand(new SuggestCommand({id:"selectLastSuggestion",precondition:ContextKeyExpr.and(Context$2.Visible,ContextKeyExpr.or(Context$2.MultipleSuggestions,Context$2.HasFocusedSuggestion.negate())),handler:a=>a.selectLastSuggestion()}));registerEditorCommand(new SuggestCommand({id:"selectPrevSuggestion",precondition:ContextKeyExpr.and(Context$2.Visible,ContextKeyExpr.or(Context$2.MultipleSuggestions,Context$2.HasFocusedSuggestion.negate())),handler:a=>a.selectPrevSuggestion(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:16,secondary:[2064],mac:{primary:16,secondary:[2064,302]}}}));registerEditorCommand(new SuggestCommand({id:"selectPrevPageSuggestion",precondition:ContextKeyExpr.and(Context$2.Visible,ContextKeyExpr.or(Context$2.MultipleSuggestions,Context$2.HasFocusedSuggestion.negate())),handler:a=>a.selectPrevPageSuggestion(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:11,secondary:[2059]}}));registerEditorCommand(new SuggestCommand({id:"selectFirstSuggestion",precondition:ContextKeyExpr.and(Context$2.Visible,ContextKeyExpr.or(Context$2.MultipleSuggestions,Context$2.HasFocusedSuggestion.negate())),handler:a=>a.selectFirstSuggestion()}));registerEditorCommand(new SuggestCommand({id:"focusSuggestion",precondition:ContextKeyExpr.and(Context$2.Visible,Context$2.HasFocusedSuggestion.negate()),handler:a=>a.focusSuggestion(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[2087]}}}));registerEditorCommand(new SuggestCommand({id:"focusAndAcceptSuggestion",precondition:ContextKeyExpr.and(Context$2.Visible,Context$2.HasFocusedSuggestion.negate()),handler:a=>{a.focusSuggestion(),a.acceptSelectedSuggestion(!0,!1)}}));registerEditorCommand(new SuggestCommand({id:"toggleSuggestionDetails",precondition:ContextKeyExpr.and(Context$2.Visible,Context$2.HasFocusedSuggestion),handler:a=>a.toggleSuggestionDetails(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[2087]}},menuOpts:[{menuId:suggestWidgetStatusbarMenu,group:"right",order:1,when:ContextKeyExpr.and(Context$2.DetailsVisible,Context$2.CanResolve),title:localize(1454,"Show Less")},{menuId:suggestWidgetStatusbarMenu,group:"right",order:1,when:ContextKeyExpr.and(Context$2.DetailsVisible.toNegated(),Context$2.CanResolve),title:localize(1455,"Show More")}]}));registerEditorCommand(new SuggestCommand({id:"toggleExplainMode",precondition:Context$2.Visible,handler:a=>a.toggleExplainMode(),kbOpts:{weight:100,primary:2138}}));registerEditorCommand(new SuggestCommand({id:"toggleSuggestionFocus",precondition:Context$2.Visible,handler:a=>a.toggleSuggestionFocus(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:2570,mac:{primary:778}}}));registerEditorCommand(new SuggestCommand({id:"insertBestCompletion",precondition:ContextKeyExpr.and(EditorContextKeys.textInputFocus,ContextKeyExpr.equals("config.editor.tabCompletion","on"),WordContextKey.AtEnd,Context$2.Visible.toNegated(),SuggestAlternatives.OtherSuggestions.toNegated(),SnippetController2.InSnippetMode.toNegated()),handler:(a,e)=>{a.triggerSuggestAndAcceptBest(isObject(e)?{fallback:"tab",...e}:{fallback:"tab"})},kbOpts:{weight:weight$2,primary:2}}));registerEditorCommand(new SuggestCommand({id:"insertNextSuggestion",precondition:ContextKeyExpr.and(EditorContextKeys.textInputFocus,ContextKeyExpr.equals("config.editor.tabCompletion","on"),SuggestAlternatives.OtherSuggestions,Context$2.Visible.toNegated(),SnippetController2.InSnippetMode.toNegated()),handler:a=>a.acceptNextSuggestion(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:2}}));registerEditorCommand(new SuggestCommand({id:"insertPrevSuggestion",precondition:ContextKeyExpr.and(EditorContextKeys.textInputFocus,ContextKeyExpr.equals("config.editor.tabCompletion","on"),SuggestAlternatives.OtherSuggestions,Context$2.Visible.toNegated(),SnippetController2.InSnippetMode.toNegated()),handler:a=>a.acceptPrevSuggestion(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:1026}}));registerEditorAction(class extends EditorAction{constructor(){super({id:"editor.action.resetSuggestSize",label:localize2(1457,"Reset Suggest Widget Size"),precondition:void 0})}run(a,e){var t;(t=SuggestController.get(e))==null||t.resetWidgetSize()}});class SuggestWidgetAdaptor extends Disposable{get selectedItem(){return this._currentSuggestItemInfo}constructor(e,t,s){super(),this.editor=e,this.suggestControllerPreselector=t,this.onWillAccept=s,this.isSuggestWidgetVisible=!1,this.isShiftKeyPressed=!1,this._isActive=!1,this._currentSuggestItemInfo=void 0,this._onDidSelectedItemChange=this._register(new Emitter$1),this.onDidSelectedItemChange=this._onDidSelectedItemChange.event,this._register(e.onKeyDown(r=>{r.shiftKey&&!this.isShiftKeyPressed&&(this.isShiftKeyPressed=!0,this.update(this._isActive))})),this._register(e.onKeyUp(r=>{r.shiftKey&&this.isShiftKeyPressed&&(this.isShiftKeyPressed=!1,this.update(this._isActive))}));const o=SuggestController.get(this.editor);if(o){this._register(o.registerSelector({priority:100,select:(c,d,u)=>{const g=this.editor.getModel();if(!g)return-1;const f=this.suggestControllerPreselector(),p=f?singleTextRemoveCommonPrefix(f,g):void 0;if(!p)return-1;const m=Position$1.lift(d),_=u.map((b,v)=>{const S=SuggestItemInfo.fromSuggestion(o,g,m,b,this.isShiftKeyPressed),y=singleTextRemoveCommonPrefix(S.getSingleTextEdit(),g),w=singleTextEditAugments(p,y);return{index:v,valid:w,prefixLength:y.text.length,suggestItem:b}}).filter(b=>b&&b.valid&&b.prefixLength>0),C=findFirstMax(_,compareBy(b=>b.prefixLength,numberComparator));return C?C.index:-1}}));let r=!1;const l=()=>{r||(r=!0,this._register(o.widget.value.onDidShow(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})),this._register(o.widget.value.onDidHide(()=>{this.isSuggestWidgetVisible=!1,this.update(!1)})),this._register(o.widget.value.onDidFocus(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})))};this._register(Event$1.once(o.model.onDidTrigger)(c=>{l()})),this._register(o.onWillInsertSuggestItem(c=>{const d=this.editor.getPosition(),u=this.editor.getModel();if(!d||!u)return;const g=SuggestItemInfo.fromSuggestion(o,u,d,c.item,this.isShiftKeyPressed);this.onWillAccept(g)}))}this.update(this._isActive)}update(e){const t=this.getSuggestItemInfo();(this._isActive!==e||!suggestItemInfoEquals(this._currentSuggestItemInfo,t))&&(this._isActive=e,this._currentSuggestItemInfo=t,this._onDidSelectedItemChange.fire())}getSuggestItemInfo(){const e=SuggestController.get(this.editor);if(!e||!this.isSuggestWidgetVisible)return;const t=e.widget.value.getFocusedItem(),s=this.editor.getPosition(),o=this.editor.getModel();if(!(!t||!s||!o))return SuggestItemInfo.fromSuggestion(e,o,s,t.item,this.isShiftKeyPressed)}stopForceRenderingAbove(){const e=SuggestController.get(this.editor);e==null||e.stopForceRenderingAbove()}forceRenderingAbove(){const e=SuggestController.get(this.editor);e==null||e.forceRenderingAbove()}}class SuggestItemInfo{static fromSuggestion(e,t,s,o,r){let{insertText:l}=o.completion,c=!1;if(o.completion.insertTextRules&4){const u=new SnippetParser().parse(l);u.children.length<100&&SnippetSession.adjustWhitespace(t,s,!0,u),l=u.toString(),c=!0}const d=e.getOverwriteInfo(o,r);return new SuggestItemInfo(Range$2.fromPositions(s.delta(0,-d.overwriteBefore),s.delta(0,Math.max(d.overwriteAfter,0))),l,o.completion.kind,c,o.container.incomplete??!1)}constructor(e,t,s,o,r){this.range=e,this.insertText=t,this.completionItemKind=s,this.isSnippetText=o,this.listIncomplete=r}equals(e){return this.range.equalsRange(e.range)&&this.insertText===e.insertText&&this.completionItemKind===e.completionItemKind&&this.isSnippetText===e.isSnippetText}toSelectedSuggestionInfo(){return new SelectedSuggestionInfo(this.range,this.insertText,this.completionItemKind,this.isSnippetText)}getSingleTextEdit(){return new TextReplacement(this.range,this.insertText)}}function suggestItemInfoEquals(a,e){return a===e?!0:!a||!e?!1:a.equals(e)}class ObservableSuggestWidgetAdapter extends Disposable{constructor(e,t,s){super(),this._editorObs=e,this._handleSuggestAccepted=t,this._suggestControllerPreselector=s,this._suggestWidgetAdaptor=this._register(new SuggestWidgetAdaptor(this._editorObs.editor,()=>(this._editorObs.forceUpdate(),this._suggestControllerPreselector()),o=>this._editorObs.forceUpdate(r=>{this._handleSuggestAccepted(o)}))),this.selectedItem=observableFromEvent(this,o=>this._suggestWidgetAdaptor.onDidSelectedItemChange(()=>{this._editorObs.forceUpdate(r=>o(void 0))}),()=>this._suggestWidgetAdaptor.selectedItem)}stopForceRenderingAbove(){this._suggestWidgetAdaptor.stopForceRenderingAbove()}forceRenderingAbove(){this._suggestWidgetAdaptor.forceRenderingAbove()}}class RangeSingleLine{constructor(e,t){this.lineNumber=e,this.columnRange=t}}class ColumnRange{constructor(e,t){if(this.startColumn=e,this.endColumnExclusive=t,e>t)throw new BugIndicatingError(`startColumn ${e} cannot be after endColumnExclusive ${t}`)}toRange(e){return new Range$2(e,this.startColumn,e,this.endColumnExclusive)}equals(e){return this.startColumn===e.startColumn&&this.endColumnExclusive===e.endColumnExclusive}toZeroBasedOffsetRange(){return new OffsetRange(this.startColumn-1,this.endColumnExclusive-1)}}const ghostTextView="";class TokenWithTextArray{static fromLineTokens(e){const t=[];for(let s=0;s<e.getCount();s++)t.push(new TokenWithTextInfo(e.getTokenText(s),e.getMetadata(s)));return TokenWithTextArray.create(t)}static create(e){return new TokenWithTextArray(e)}constructor(e){this._tokenInfo=e}toLineTokens(e){return LineTokens.createFromTextAndMetadata(this.map((t,s)=>({text:s.text,metadata:s.metadata})),e)}map(e){const t=[];let s=0;for(const o of this._tokenInfo){const r=new OffsetRange(s,s+o.text.length);t.push(e(r,o)),s+=o.text.length}return t}slice(e){const t=[];let s=0;for(const o of this._tokenInfo){const r=s,l=r+o.text.length;if(l>e.start){if(r>=e.endExclusive)break;const c=Math.max(0,e.start-r),d=Math.max(0,l-e.endExclusive);t.push(new TokenWithTextInfo(o.text.slice(c,o.text.length-d),o.metadata))}s+=o.text.length}return TokenWithTextArray.create(t)}append(e){const t=this._tokenInfo.concat(e._tokenInfo);return TokenWithTextArray.create(t)}}class TokenWithTextInfo{constructor(e,t){this.text=e,this.metadata=t}}var __decorate$1g=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1f=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},GhostTextView_1;const GHOST_TEXT_CLASS_NAME="ghost-text";var zi;let GhostTextView=(zi=class extends Disposable{constructor(e,t,s,o,r,l){super(),this._editor=e,this._model=t,this._options=s,this._shouldKeepCursorStable=o,this._isClickable=r,this._languageService=l,this._isDisposed=observableValue(this,!1),this._editorObs=observableCodeEditor(this._editor),this._warningState=derived(c=>{const d=this._model.ghostText.read(c);if(!d)return;const u=this._model.warning.read(c);if(u)return{lineNumber:d.lineNumber,position:new Position$1(d.lineNumber,d.parts[0].column),icon:u.icon}}),this._onDidClick=this._register(new Emitter$1),this.onDidClick=this._onDidClick.event,this._useSyntaxHighlighting=this._options.map(c=>c.syntaxHighlightingEnabled),this._extraClassNames=derived(this,c=>{const d=[...this._options.read(c).extraClasses??[]];return this._useSyntaxHighlighting.read(c)&&d.push("syntax-highlighted"),this._warningState.read(c)&&d.push("warning"),d.map(g=>` ${g}`).join("")}),this.uiState=derived(this,c=>{var N,R;if(this._isDisposed.read(c))return;const d=this._editorObs.model.read(c);if(d!==this._model.targetTextModel.read(c))return;const u=this._model.ghostText.read(c);if(!u)return;const g=u instanceof GhostTextReplacement?u.columnRange:void 0,f=this._useSyntaxHighlighting.read(c),p=this._extraClassNames.read(c),{inlineTexts:m,additionalLines:_,hiddenRange:C,additionalLinesOriginalSuffix:b}=computeGhostTextViewData(u,d,GHOST_TEXT_CLASS_NAME+p),v=d.getLineContent(u.lineNumber),S=new StringEdit(m.map(M=>StringReplacement.insert(M.column-1,M.text))),y=f?d.tokenization.tokenizeLinesAt(u.lineNumber,[S.apply(v),..._.map(M=>M.content)]):void 0,w=S.getNewRanges(),L=m.map((M,A)=>{var O;return{...M,tokens:(O=y==null?void 0:y[0])==null?void 0:O.getTokensInRange(w[A])}}),x=_.map((M,A)=>{let O=(y==null?void 0:y[A+1])??LineTokens.createEmpty(M.content,this._languageService.languageIdCodec);if(A===_.length-1&&b){const W=TokenWithTextArray.fromLineTokens(d.tokenization.getLineTokens(b.lineNumber)).slice(b.columnRange.toZeroBasedOffsetRange());O=TokenWithTextArray.fromLineTokens(O).append(W).toLineTokens(O.languageIdCodec)}return{content:O,decorations:M.decorations}}),E=(N=this._editor.getSelection())==null?void 0:N.getStartPosition().column,I=L.filter(M=>M.text!==""),D=I.length!==0,k={cursorColumnDistance:(D?I[0].column:1)-E,cursorLineDistance:D?0:_.findIndex(M=>M.content!=="")+1,lineCountOriginal:D?1:0,lineCountModified:_.length+(D?1:0),characterCountOriginal:0,characterCountModified:sum(I.map(M=>M.text.length))+sum(x.map(M=>M.content.getTextLength())),disjointReplacements:I.length+(_.length>0?1:0),sameShapeReplacements:I.length>1&&x.length===0?I.every(M=>M.text===I[0].text):void 0};return(R=this._model.handleInlineCompletionShown.read(c))==null||R(k),{replacedRange:g,inlineTexts:L,additionalLines:x,hiddenRange:C,lineNumber:u.lineNumber,additionalReservedLineCount:this._model.minReservedLineCount.read(c),targetTextModel:d,syntaxHighlightingEnabled:f}}),this.decorations=derived(this,c=>{const d=this.uiState.read(c);if(!d)return[];const u=[],g=this._extraClassNames.read(c);d.replacedRange&&u.push({range:d.replacedRange.toRange(d.lineNumber),options:{inlineClassName:"inline-completion-text-to-replace"+g,description:"GhostTextReplacement"}}),d.hiddenRange&&u.push({range:d.hiddenRange.toRange(d.lineNumber),options:{inlineClassName:"ghost-text-hidden",description:"ghost-text-hidden"}});for(const f of d.inlineTexts)u.push({range:Range$2.fromPositions(new Position$1(d.lineNumber,f.column)),options:{description:"ghost-text-decoration",after:{content:f.text,tokens:f.tokens,inlineClassName:(f.preview?"ghost-text-decoration-preview":"ghost-text-decoration")+(this._isClickable?" clickable":"")+g+f.lineDecorations.map(p=>" "+p.className).join(" "),cursorStops:InjectedTextCursorStops$1.Left,attachedData:new GhostTextAttachedData(this)},showIfCollapsed:!0}});return u}),this._additionalLinesWidget=this._register(new AdditionalLinesWidget(this._editor,derived(c=>{const d=this.uiState.read(c);return d?{lineNumber:d.lineNumber,additionalLines:d.additionalLines,minReservedLineCount:d.additionalReservedLineCount,targetTextModel:d.targetTextModel}:void 0}),this._shouldKeepCursorStable,this._isClickable)),this._isInlineTextHovered=this._editorObs.isTargetHovered(c=>{var d;return c.target.type===6&&((d=c.target.detail.injectedText)==null?void 0:d.options.attachedData)instanceof GhostTextAttachedData&&c.target.detail.injectedText.options.attachedData.owner===this},this._store),this.isHovered=derived(this,c=>this._isDisposed.read(c)?!1:this._isInlineTextHovered.read(c)||this._additionalLinesWidget.isHovered.read(c)),this.height=derived(this,c=>this._editorObs.getOption(75).read(c)+(this._additionalLinesWidget.viewZoneHeight.read(c)??0)),this._register(toDisposable(()=>{this._isDisposed.set(!0,void 0)})),this._register(this._editorObs.setDecorations(this.decorations)),this._isClickable&&(this._register(this._additionalLinesWidget.onDidClick(c=>this._onDidClick.fire(c))),this._register(this._editor.onMouseUp(c=>{var u;if(c.target.type!==6)return;const d=(u=c.target.detail.injectedText)==null?void 0:u.options.attachedData;d instanceof GhostTextAttachedData&&d.owner===this&&this._onDidClick.fire(c.event)}))),this._register(autorunWithStore((c,d)=>{}))}static getWarningWidgetContext(e){const t=e.ghostTextViewWarningWidgetData;if(t)return t;if(e.parentElement)return this.getWarningWidgetContext(e.parentElement)}ownsViewZone(e){return this._additionalLinesWidget.viewZoneId===e}},GhostTextView_1=zi,zi.hot=createHotClass(GhostTextView_1),zi);GhostTextView=GhostTextView_1=__decorate$1g([__param$1f(5,ILanguageService)],GhostTextView);class GhostTextAttachedData{constructor(e){this.owner=e}}function computeGhostTextViewData(a,e,t){const s=[],o=[];function r(f,p){if(o.length>0){const m=o[o.length-1];p&&m.decorations.push(new LineDecoration(m.content.length+1,m.content.length+1+f[0].line.length,p,0)),m.content+=f[0].line,f=f.slice(1)}for(const m of f)o.push({content:m.line,decorations:p?[new LineDecoration(1,m.line.length+1,p,0),...m.lineDecorations]:[...m.lineDecorations]})}const l=e.getLineContent(a.lineNumber);let c,d=0;for(const f of a.parts){let p=f.lines;c===void 0?(s.push({column:f.column,text:p[0].line,preview:f.preview,lineDecorations:p[0].lineDecorations}),p=p.slice(1)):r([{line:l.substring(d,f.column-1),lineDecorations:[]}],void 0),p.length>0&&(r(p,t),c===void 0&&f.column<=l.length&&(c=f.column)),d=f.column-1}let u;c!==void 0&&(u=new RangeSingleLine(a.lineNumber,new ColumnRange(d+1,l.length+1)));const g=c!==void 0?new ColumnRange(c,l.length+1):void 0;return{inlineTexts:s,additionalLines:o,hiddenRange:g,additionalLinesOriginalSuffix:u}}class AdditionalLinesWidget extends Disposable{get viewZoneId(){var e;return(e=this._viewZoneInfo)==null?void 0:e.viewZoneId}get viewZoneHeight(){return this._viewZoneHeight}constructor(e,t,s,o){super(),this._editor=e,this._lines=t,this._shouldKeepCursorStable=s,this._isClickable=o,this._viewZoneHeight=observableValue("viewZoneHeight",void 0),this.editorOptionsChanged=observableSignalFromEvent("editorOptionChanged",Event$1.filter(this._editor.onDidChangeConfiguration,r=>r.hasChanged(40)||r.hasChanged(133)||r.hasChanged(113)||r.hasChanged(108)||r.hasChanged(60)||r.hasChanged(59)||r.hasChanged(75))),this._onDidClick=this._register(new Emitter$1),this.onDidClick=this._onDidClick.event,this._viewZoneListener=this._register(new MutableDisposable),this.isHovered=observableCodeEditor(this._editor).isTargetHovered(r=>isTargetGhostText(r.target.element),this._store),this.hasBeenAccepted=!1,this._editor instanceof CodeEditorWidget&&this._shouldKeepCursorStable&&this._register(this._editor.onBeforeExecuteEdit(r=>this.hasBeenAccepted=r.source==="inlineSuggestion.accept")),this._register(autorun(r=>{const l=this._lines.read(r);this.editorOptionsChanged.read(r),l?(this.hasBeenAccepted=!1,this.updateLines(l.lineNumber,l.additionalLines,l.minReservedLineCount)):this.clear()}))}dispose(){super.dispose(),this.clear()}clear(){this._viewZoneListener.clear(),this._editor.changeViewZones(e=>{this.removeActiveViewZone(e)})}updateLines(e,t,s){const o=this._editor.getModel();if(!o)return;const{tabSize:r}=o.getOptions();this._editor.changeViewZones(l=>{const c=new DisposableStore;this.removeActiveViewZone(l);const d=Math.max(t.length,s);if(d>0){const u=document.createElement("div");renderLines(u,r,t,this._editor.getOptions(),this._isClickable),this._isClickable&&(c.add(addDisposableListener(u,"mousedown",g=>{g.preventDefault()})),c.add(addDisposableListener(u,"click",g=>{isTargetGhostText(g.target)&&this._onDidClick.fire(new StandardMouseEvent(getWindow(g),g))}))),this.addViewZone(l,e,d,u)}this._viewZoneListener.value=c})}addViewZone(e,t,s,o){const r=e.addZone({afterLineNumber:t,heightInLines:s,domNode:o,afterColumnAffinity:1,onComputedHeight:l=>{this._viewZoneHeight.set(l,void 0)}});this.keepCursorStable(t,s),this._viewZoneInfo={viewZoneId:r,heightInLines:s,lineNumber:t}}removeActiveViewZone(e){this._viewZoneInfo&&(e.removeZone(this._viewZoneInfo.viewZoneId),this.hasBeenAccepted||this.keepCursorStable(this._viewZoneInfo.lineNumber,-this._viewZoneInfo.heightInLines),this._viewZoneInfo=void 0,this._viewZoneHeight.set(void 0,void 0))}keepCursorStable(e,t){var o,r;if(!this._shouldKeepCursorStable)return;const s=(r=(o=this._editor.getSelection())==null?void 0:o.getStartPosition())==null?void 0:r.lineNumber;s!==void 0&&e<s&&this._editor.setScrollTop(this._editor.getScrollTop()+t*this._editor.getOption(75))}}function isTargetGhostText(a){return isHTMLElement(a)&&a.classList.contains(GHOST_TEXT_CLASS_NAME)}function renderLines(a,e,t,s,o){const r=s.get(40),l=s.get(133),c="none",d=s.get(108),u=s.get(60),g=s.get(59),f=s.get(75);let p="suggest-preview-text";o&&(p+=" clickable");const m=new StringBuilder(1e4);m.appendString(`<div class="${p}">`);for(let b=0,v=t.length;b<v;b++){const S=t[b],y=S.content;m.appendString('<div class="view-line'),m.appendString('" style="top:'),m.appendString(String(b*f)),m.appendString('px;width:1000000px;">');const w=y.getLineContent(),L=isBasicASCII(w),x=containsRTL(w);renderViewLine(new RenderLineInput(g.isMonospace&&!r,g.canUseHalfwidthRightwardsArrow,w,!1,L,x,0,y,S.decorations,e,0,g.spaceWidth,g.middotWidth,g.wsmiddotWidth,l,c,d,u!==EditorFontLigatures.OFF,null,null,0),m),m.appendString("</div>")}m.appendString("</div>"),applyFontInfo(a,g);const _=m.build(),C=ttPolicy$3?ttPolicy$3.createHTML(_):_;a.innerHTML=C}const ttPolicy$3=createTrustedTypesPolicy$1("editorGhostText",{createHTML:a=>a}),js=class js{constructor(e){this.replacements=e,assert(checkAdjacentItems(e,(t,s)=>t.lineRange.endLineNumberExclusive<=s.lineRange.startLineNumber))}toString(){return this.replacements.map(e=>e.toString()).join(",")}getNewLineRanges(){const e=[];let t=0;for(const s of this.replacements)e.push(LineRange.ofLength(s.lineRange.startLineNumber+t,s.newLines.length)),t+=s.newLines.length-s.lineRange.length;return e}};js.empty=new js([]);let LineEdit=js;class LineReplacement{static fromSingleTextEdit(e,t){const s=splitLines(e.text);let o=e.range.startLineNumber;const r=t.getValueOfRange(Range$2.fromPositions(new Position$1(e.range.startLineNumber,1),e.range.getStartPosition()));s[0]=r+s[0];let l=e.range.endLineNumber+1;const c=t.getTransformer().getLineLength(e.range.endLineNumber)+1,d=t.getValueOfRange(Range$2.fromPositions(e.range.getEndPosition(),new Position$1(e.range.endLineNumber,c)));s[s.length-1]=s[s.length-1]+d;const u=e.range.startColumn===t.getTransformer().getLineLength(e.range.startLineNumber)+1,g=e.range.endColumn===1;return u&&s[0].length===r.length&&(o++,s.shift()),s.length>0&&o<l&&g&&s[s.length-1].length===d.length&&(l--,s.pop()),new LineReplacement(new LineRange(o,l),s)}constructor(e,t){this.lineRange=e,this.newLines=t}toString(){return`${this.lineRange}->${JSON.stringify(this.newLines)}`}toLineEdit(){return new LineEdit([this])}}class InlineEditWithChanges{get lineEdit(){return LineReplacement.fromSingleTextEdit(this.edit.toReplacement(this.originalText),this.originalText)}get originalLineRange(){return this.lineEdit.lineRange}get modifiedLineRange(){return this.lineEdit.toLineEdit().getNewLineRanges()[0]}get displayRange(){return this.originalText.lineRange.intersect(this.originalLineRange.join(LineRange.ofLength(this.originalLineRange.startLineNumber,this.lineEdit.newLines.length)))}constructor(e,t,s,o,r){this.originalText=e,this.edit=t,this.cursorPosition=s,this.commands=o,this.inlineCompletion=r}}class InlineEditModel{constructor(e,t,s){this._model=e,this.inlineEdit=t,this.tabAction=s,this.action=this.inlineEdit.inlineCompletion.action,this.displayName=this.inlineEdit.inlineCompletion.source.provider.displayName??localize(1209,"Inline Edit"),this.extensionCommands=this.inlineEdit.inlineCompletion.source.inlineSuggestions.commands??[],this.isInDiffEditor=this._model.isInDiffEditor,this.displayLocation=this.inlineEdit.inlineCompletion.displayLocation,this.showCollapsed=this._model.showCollapsed}accept(){this._model.accept()}jump(){this._model.jump()}abort(e){console.error(e),this.inlineEdit.inlineCompletion.reportInlineEditError(e),this._model.stop()}handleInlineEditShown(e,t){this._model.handleInlineSuggestionShown(this.inlineEdit.inlineCompletion,e,t)}}class InlineEditHost{constructor(e){this._model=e,this.onDidAccept=this._model.onDidAccept,this.inAcceptFlow=this._model.inAcceptFlow}}class GhostTextIndicator{constructor(e,t,s,o){this.lineRange=s;const r=observableCodeEditor(e),l=derived(this,c=>r.isFocused.read(c)&&o.showInlineEditMenu?InlineEditTabAction.Accept:InlineEditTabAction.Inactive);this.model=new InlineEditModel(t,new InlineEditWithChanges(new StringText(""),new TextEdit([o.getSingleTextEdit()]),t.primaryPosition.get(),o.source.inlineSuggestions.commands??[],o),l)}}class Rect{static fromPoints(e,t){return new Rect(e.x,e.y,t.x,t.y)}static fromPointSize(e,t){return new Rect(e.x,e.y,e.x+t.x,e.y+t.y)}static fromLeftTopRightBottom(e,t,s,o){return new Rect(e,t,s,o)}static fromLeftTopWidthHeight(e,t,s,o){return new Rect(e,t,e+s,t+o)}static fromRanges(e,t){return new Rect(e.start,t.start,e.endExclusive,t.endExclusive)}static hull(e){let t=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(const l of e)t=Math.min(t,l.left),s=Math.min(s,l.top),o=Math.max(o,l.right),r=Math.max(r,l.bottom);return new Rect(t,s,o,r)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}constructor(e,t,s,o){if(this.left=e,this.top=t,this.right=s,this.bottom=o,e>s)throw new BugIndicatingError("Invalid arguments: Horizontally offset by "+(e-s));if(t>o)throw new BugIndicatingError("Invalid arguments: Vertically offset by "+(t-o))}withMargin(e,t,s,o){let r,l,c,d;return t===void 0&&s===void 0&&o===void 0?r=l=c=d=e:s===void 0&&o===void 0?(r=l=t,c=d=e):(r=o,l=t,c=e,d=s),new Rect(this.left-r,this.top-c,this.right+l,this.bottom+d)}intersectVertical(e){const t=Math.max(this.top,e.start),s=Math.min(this.bottom,e.endExclusive);return new Rect(this.left,t,this.right,Math.max(t,s))}intersectHorizontal(e){const t=Math.max(this.left,e.start),s=Math.min(this.right,e.endExclusive);return new Rect(t,this.top,Math.max(t,s),this.bottom)}toString(){return`Rect{(${this.left},${this.top}), (${this.right},${this.bottom})}`}intersect(e){const t=Math.max(this.left,e.left),s=Math.min(this.right,e.right),o=Math.max(this.top,e.top),r=Math.min(this.bottom,e.bottom);if(!(t>s||o>r))return new Rect(t,o,s,r)}containsRect(e){return this.left<=e.left&&this.top<=e.top&&this.right>=e.right&&this.bottom>=e.bottom}containsPoint(e){return this.left<=e.x&&this.top<=e.y&&this.right>=e.x&&this.bottom>=e.y}moveToBeContainedIn(e){const t=this.width,s=this.height;let o=this.left,r=this.top;return o<e.left?o=e.left:o+t>e.right&&(o=e.right-t),r<e.top?r=e.top:r+s>e.bottom&&(r=e.bottom-s),new Rect(o,r,o+t,r+s)}withWidth(e){return new Rect(this.left,this.top,this.left+e,this.bottom)}withHeight(e){return new Rect(this.left,this.top,this.right,this.top+e)}withTop(e){return new Rect(this.left,e,this.right,this.bottom)}withLeft(e){return new Rect(e,this.top,this.right,this.bottom)}translateX(e){return new Rect(this.left+e,this.top,this.right+e,this.bottom)}translateY(e){return new Rect(this.left,this.top+e,this.right,this.bottom+e)}getLeftBottom(){return new Point(this.left,this.bottom)}getRightBottom(){return new Point(this.right,this.bottom)}getRightTop(){return new Point(this.right,this.top)}toStyles(){return{position:"absolute",left:`${this.left}px`,top:`${this.top}px`,width:`${this.width}px`,height:`${this.height}px`}}}const stickyScroll="";class StickyScrollWidgetState{constructor(e,t,s,o=null){this.startLineNumbers=e,this.endLineNumbers=t,this.lastLineRelativePosition=s,this.showEndForLine=o}equals(e){return!!e&&this.lastLineRelativePosition===e.lastLineRelativePosition&&this.showEndForLine===e.showEndForLine&&equals$1(this.startLineNumbers,e.startLineNumbers)&&equals$1(this.endLineNumbers,e.endLineNumbers)}static get Empty(){return new StickyScrollWidgetState([],[],0)}}const _ttPolicy=createTrustedTypesPolicy$1("stickyScrollViewLayer",{createHTML:a=>a}),STICKY_INDEX_ATTR="data-sticky-line-index",STICKY_IS_LINE_ATTR="data-sticky-is-line",STICKY_IS_LINE_NUMBER_ATTR="data-sticky-is-line-number",STICKY_IS_FOLDING_ICON_ATTR="data-sticky-is-folding-icon";class StickyScrollWidget extends Disposable{get height(){return this._height}constructor(e){super(),this._foldingIconStore=new DisposableStore,this._rootDomNode=document.createElement("div"),this._lineNumbersDomNode=document.createElement("div"),this._linesDomNodeScrollable=document.createElement("div"),this._linesDomNode=document.createElement("div"),this._renderedStickyLines=[],this._lineNumbers=[],this._lastLineRelativePosition=0,this._minContentWidthInPx=0,this._isOnGlyphMargin=!1,this._height=-1,this._onDidChangeStickyScrollHeight=this._register(new Emitter$1),this.onDidChangeStickyScrollHeight=this._onDidChangeStickyScrollHeight.event,this._editor=e,this._lineHeight=e.getOption(75),this._lineNumbersDomNode.className="sticky-widget-line-numbers",this._lineNumbersDomNode.setAttribute("role","none"),this._linesDomNode.className="sticky-widget-lines",this._linesDomNode.setAttribute("role","list"),this._linesDomNodeScrollable.className="sticky-widget-lines-scrollable",this._linesDomNodeScrollable.appendChild(this._linesDomNode),this._rootDomNode.className="sticky-widget",this._rootDomNode.classList.toggle("peek",e instanceof EmbeddedCodeEditorWidget),this._rootDomNode.appendChild(this._lineNumbersDomNode),this._rootDomNode.appendChild(this._linesDomNodeScrollable),this._setHeight(0);const t=()=>{this._linesDomNode.style.left=this._editor.getOption(131).scrollWithEditor?`-${this._editor.getScrollLeft()}px`:"0px"};this._register(this._editor.onDidChangeConfiguration(s=>{s.hasChanged(131)&&t(),s.hasChanged(75)&&(this._lineHeight=this._editor.getOption(75))})),this._register(this._editor.onDidScrollChange(s=>{s.scrollLeftChanged&&t(),s.scrollWidthChanged&&this._updateWidgetWidth()})),this._register(this._editor.onDidChangeModel(()=>{t(),this._updateWidgetWidth()})),this._register(this._foldingIconStore),t(),this._register(this._editor.onDidLayoutChange(s=>{this._updateWidgetWidth()})),this._updateWidgetWidth()}get lineNumbers(){return this._lineNumbers}get lineNumberCount(){return this._lineNumbers.length}getRenderedStickyLine(e){return this._renderedStickyLines.find(t=>t.lineNumber===e)}getCurrentLines(){return this._lineNumbers}setState(e,t,s){const o=!this._state&&!e,r=this._state&&this._state.equals(e);if(s===void 0&&(o||r))return;const l=this._findRenderingData(e),c=this._lineNumbers;this._lineNumbers=l.lineNumbers,this._lastLineRelativePosition=l.lastLineRelativePosition;const d=this._findIndexToRebuildFrom(c,this._lineNumbers,s);this._renderRootNode(this._lineNumbers,this._lastLineRelativePosition,t,d),this._state=e}_findRenderingData(e){if(!e)return{lineNumbers:[],lastLineRelativePosition:0};const t=[...e.startLineNumbers];e.showEndForLine!==null&&(t[e.showEndForLine]=e.endLineNumbers[e.showEndForLine]);let s=0;for(let o=0;o<t.length;o++)s+=this._editor.getLineHeightForPosition(new Position$1(t[o],1));return s===0?{lineNumbers:[],lastLineRelativePosition:0}:{lineNumbers:t,lastLineRelativePosition:e.lastLineRelativePosition}}_findIndexToRebuildFrom(e,t,s){if(t.length===0)return 0;if(s!==void 0)return s;const o=t.findIndex(r=>!e.includes(r));return o===-1?0:o}_updateWidgetWidth(){const e=this._editor.getLayoutInfo(),t=e.contentLeft;this._lineNumbersDomNode.style.width=`${t}px`,this._linesDomNodeScrollable.style.setProperty("--vscode-editorStickyScroll-scrollableWidth",`${this._editor.getScrollWidth()-e.verticalScrollbarWidth}px`),this._rootDomNode.style.width=`${e.width-e.verticalScrollbarWidth}px`}_useFoldingOpacityTransition(e){this._lineNumbersDomNode.style.setProperty("--vscode-editorStickyScroll-foldingOpacityTransition",`opacity ${e?.5:0}s`)}_setFoldingIconsVisibility(e){for(const t of this._renderedStickyLines){const s=t.foldingIcon;s&&s.setVisible(e?!0:s.isCollapsed)}}async _renderRootNode(e,t,s,o){const r=this._editor._getViewModel();if(!r){this._clearWidget();return}if(e.length===0){this._clearWidget();return}const l=[],c=e[e.length-1];let d=0;for(let g=0;g<this._renderedStickyLines.length;g++)if(g<o){const f=this._renderedStickyLines[g];l.push(this._updatePosition(f,d,f.lineNumber===c)),d+=f.height}else{const f=this._renderedStickyLines[g];f.lineNumberDomNode.remove(),f.lineDomNode.remove()}const u=this._editor.getLayoutInfo();for(let g=o;g<e.length;g++){const f=this._renderChildNode(r,g,e[g],d,c===e[g],s,u);d+=f.height,this._linesDomNode.appendChild(f.lineDomNode),this._lineNumbersDomNode.appendChild(f.lineNumberDomNode),l.push(f)}s&&(this._setFoldingHoverListeners(),this._useFoldingOpacityTransition(!this._isOnGlyphMargin)),this._minContentWidthInPx=Math.max(...this._renderedStickyLines.map(g=>g.scrollWidth))+u.verticalScrollbarWidth,this._renderedStickyLines=l,this._setHeight(d+t),this._editor.layoutOverlayWidget(this)}_clearWidget(){for(let e=0;e<this._renderedStickyLines.length;e++){const t=this._renderedStickyLines[e];t.lineNumberDomNode.remove(),t.lineDomNode.remove()}this._setHeight(0)}_setHeight(e){this._height!==e&&(this._height=e,this._height===0?this._rootDomNode.style.display="none":(this._rootDomNode.style.display="block",this._lineNumbersDomNode.style.height=`${this._height}px`,this._linesDomNodeScrollable.style.height=`${this._height}px`,this._rootDomNode.style.height=`${this._height}px`),this._onDidChangeStickyScrollHeight.fire({height:this._height}))}_setFoldingHoverListeners(){this._editor.getOption(126)==="mouseover"&&(this._foldingIconStore.add(addDisposableListener(this._lineNumbersDomNode,EventType$1.MOUSE_ENTER,()=>{this._isOnGlyphMargin=!0,this._setFoldingIconsVisibility(!0)})),this._foldingIconStore.add(addDisposableListener(this._lineNumbersDomNode,EventType$1.MOUSE_LEAVE,()=>{this._isOnGlyphMargin=!1,this._useFoldingOpacityTransition(!0),this._setFoldingIconsVisibility(!1)})))}_renderChildNode(e,t,s,o,r,l,c){const d=e.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(s,1)).lineNumber,u=e.getViewLineRenderingData(d),g=this._editor.getOption(76),f=this._editor.getOption(117).verticalScrollbarSize;let p;try{p=LineDecoration.filter(u.inlineDecorations,d,u.minColumn,u.maxColumn)}catch{p=[]}const m=this._editor.getLineHeightForPosition(new Position$1(s,1)),_=e.getTextDirection(s),C=new RenderLineInput(!0,!0,u.content,u.continuesWithWrappedLine,u.isBasicASCII,u.containsRTL,0,u.tokens,p,u.tabSize,u.startVisibleColumn,1,1,1,500,"none",!0,!0,null,_,f),b=new StringBuilder(2e3),v=renderViewLine(C,b);let S;_ttPolicy?S=_ttPolicy.createHTML(b.build()):S=b.build();const y=document.createElement("span");y.setAttribute(STICKY_INDEX_ATTR,String(t)),y.setAttribute(STICKY_IS_LINE_ATTR,""),y.setAttribute("role","listitem"),y.tabIndex=0,y.className="sticky-line-content",y.classList.add(`stickyLine${s}`),y.style.lineHeight=`${m}px`,y.innerHTML=S;const w=document.createElement("span");w.setAttribute(STICKY_INDEX_ATTR,String(t)),w.setAttribute(STICKY_IS_LINE_NUMBER_ATTR,""),w.className="sticky-line-number",w.style.lineHeight=`${m}px`;const L=c.contentLeft;w.style.width=`${L}px`;const x=document.createElement("span");g.renderType===1||g.renderType===3&&s%10===0?x.innerText=s.toString():g.renderType===2&&(x.innerText=Math.abs(s-this._editor.getPosition().lineNumber).toString()),x.className="sticky-line-number-inner",x.style.width=`${c.lineNumbersWidth}px`,x.style.paddingLeft=`${c.lineNumbersLeft}px`,w.appendChild(x);const E=this._renderFoldingIconForLine(l,s);E&&(w.appendChild(E.domNode),E.domNode.style.left=`${c.lineNumbersWidth+c.lineNumbersLeft}px`,E.domNode.style.lineHeight=`${m}px`),this._editor.applyFontInfo(y),this._editor.applyFontInfo(w),w.style.lineHeight=`${m}px`,y.style.lineHeight=`${m}px`,w.style.height=`${m}px`,y.style.height=`${m}px`;const I=new RenderedStickyLine(t,s,y,w,E,v.characterMapping,y.scrollWidth,m);return this._updatePosition(I,o,r)}_updatePosition(e,t,s){var l;const o=e.lineDomNode,r=e.lineNumberDomNode;if(s){const c="0";o.style.zIndex=c,r.style.zIndex=c;const d=`${t+this._lastLineRelativePosition+((l=e.foldingIcon)!=null&&l.isCollapsed?1:0)}px`;o.style.top=d,r.style.top=d}else{const c="1";o.style.zIndex=c,r.style.zIndex=c,o.style.top=`${t}px`,r.style.top=`${t}px`}return e}_renderFoldingIconForLine(e,t){const s=this._editor.getOption(126);if(!e||s==="never")return;const o=e.regions,r=o.findRange(t),l=o.getStartLineNumber(r);if(!(t===l))return;const d=o.isCollapsed(r),u=new StickyFoldingIcon(d,l,o.getEndLineNumber(r),this._lineHeight);return u.setVisible(this._isOnGlyphMargin?!0:d||s==="always"),u.domNode.setAttribute(STICKY_IS_FOLDING_ICON_ATTR,""),u}getId(){return"editor.contrib.stickyScrollWidget"}getDomNode(){return this._rootDomNode}getPosition(){return{preference:2,stackOridinal:10}}getMinContentWidthInPx(){return this._minContentWidthInPx}focusLineWithIndex(e){0<=e&&e<this._renderedStickyLines.length&&this._renderedStickyLines[e].lineDomNode.focus()}getEditorPositionFromNode(e){if(!e||e.children.length>0)return null;const t=this._getRenderedStickyLineFromChildDomNode(e);if(!t)return null;const s=getColumnOfNodeOffset(t.characterMapping,e,0);return new Position$1(t.lineNumber,s)}getLineNumberFromChildDomNode(e){var t;return((t=this._getRenderedStickyLineFromChildDomNode(e))==null?void 0:t.lineNumber)??null}_getRenderedStickyLineFromChildDomNode(e){const t=this.getLineIndexFromChildDomNode(e);return t===null||t<0||t>=this._renderedStickyLines.length?null:this._renderedStickyLines[t]}getLineIndexFromChildDomNode(e){const t=this._getAttributeValue(e,STICKY_INDEX_ATTR);return t?parseInt(t,10):null}isInStickyLine(e){return this._getAttributeValue(e,STICKY_IS_LINE_ATTR)!==void 0}isInFoldingIconDomNode(e){return this._getAttributeValue(e,STICKY_IS_FOLDING_ICON_ATTR)!==void 0}_getAttributeValue(e,t){for(;e&&e!==this._rootDomNode;){const s=e.getAttribute(t);if(s!==null)return s;e=e.parentElement}}}class RenderedStickyLine{constructor(e,t,s,o,r,l,c,d){this.index=e,this.lineNumber=t,this.lineDomNode=s,this.lineNumberDomNode=o,this.foldingIcon=r,this.characterMapping=l,this.scrollWidth=c,this.height=d}}class StickyFoldingIcon{constructor(e,t,s,o){this.isCollapsed=e,this.foldingStartLine=t,this.foldingEndLine=s,this.dimension=o,this.domNode=document.createElement("div"),this.domNode.style.width="26px",this.domNode.style.height=`${o}px`,this.domNode.style.lineHeight=`${o}px`,this.domNode.className=ThemeIcon.asClassName(e?foldingCollapsedIcon:foldingExpandedIcon)}setVisible(e){this.domNode.style.cursor=e?"pointer":"default",this.domNode.style.opacity=e?"1":"0"}}class StickyRange{constructor(e,t){this.startLineNumber=e,this.endLineNumber=t}}class StickyElement{constructor(e,t,s){this.range=e,this.children=t,this.parent=s}}class StickyModel{constructor(e,t,s,o){this.uri=e,this.version=t,this.element=s,this.outlineProviderId=o}}var __decorate$1f=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1e=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},ModelProvider;(function(a){a.OUTLINE_MODEL="outlineModel",a.FOLDING_PROVIDER_MODEL="foldingProviderModel",a.INDENTATION_MODEL="indentationModel"})(ModelProvider||(ModelProvider={}));var Status;(function(a){a[a.VALID=0]="VALID",a[a.INVALID=1]="INVALID",a[a.CANCELED=2]="CANCELED"})(Status||(Status={}));let StickyModelProvider=class extends Disposable{constructor(e,t,s,o){switch(super(),this._editor=e,this._modelProviders=[],this._modelPromise=null,this._updateScheduler=this._register(new Delayer(300)),this._updateOperation=this._register(new DisposableStore),this._editor.getOption(131).defaultModel){case ModelProvider.OUTLINE_MODEL:this._modelProviders.push(new StickyModelFromCandidateOutlineProvider(this._editor,o));case ModelProvider.FOLDING_PROVIDER_MODEL:this._modelProviders.push(new StickyModelFromCandidateSyntaxFoldingProvider(this._editor,t,o));case ModelProvider.INDENTATION_MODEL:this._modelProviders.push(new StickyModelFromCandidateIndentationFoldingProvider(this._editor,s));break}}dispose(){this._modelProviders.forEach(e=>e.dispose()),this._updateOperation.clear(),this._cancelModelPromise(),super.dispose()}_cancelModelPromise(){this._modelPromise&&(this._modelPromise.cancel(),this._modelPromise=null)}async update(e){return this._updateOperation.clear(),this._updateOperation.add({dispose:()=>{this._cancelModelPromise(),this._updateScheduler.cancel()}}),this._cancelModelPromise(),await this._updateScheduler.trigger(async()=>{for(const t of this._modelProviders){const{statusPromise:s,modelPromise:o}=t.computeStickyModel(e);this._modelPromise=o;const r=await s;if(this._modelPromise!==o)return null;switch(r){case Status.CANCELED:return this._updateOperation.clear(),null;case Status.VALID:return t.stickyModel}}return null}).catch(t=>(onUnexpectedError(t),null))}};StickyModelProvider=__decorate$1f([__param$1e(2,IInstantiationService),__param$1e(3,ILanguageFeaturesService)],StickyModelProvider);class StickyModelCandidateProvider extends Disposable{constructor(e){super(),this._editor=e,this._stickyModel=null}get stickyModel(){return this._stickyModel}_invalid(){return this._stickyModel=null,Status.INVALID}computeStickyModel(e){if(e.isCancellationRequested||!this.isProviderValid())return{statusPromise:this._invalid(),modelPromise:null};const t=createCancelablePromise(s=>this.createModelFromProvider(s));return{statusPromise:t.then(s=>this.isModelValid(s)?e.isCancellationRequested?Status.CANCELED:(this._stickyModel=this.createStickyModel(e,s),Status.VALID):this._invalid()).then(void 0,s=>(onUnexpectedError(s),Status.CANCELED)),modelPromise:t}}isModelValid(e){return!0}isProviderValid(){return!0}}let StickyModelFromCandidateOutlineProvider=class extends StickyModelCandidateProvider{constructor(e,t){super(e),this._languageFeaturesService=t}createModelFromProvider(e){return OutlineModel.create(this._languageFeaturesService.documentSymbolProvider,this._editor.getModel(),e)}createStickyModel(e,t){var l;const{stickyOutlineElement:s,providerID:o}=this._stickyModelFromOutlineModel(t,(l=this._stickyModel)==null?void 0:l.outlineProviderId),r=this._editor.getModel();return new StickyModel(r.uri,r.getVersionId(),s,o)}isModelValid(e){return e&&e.children.size>0}_stickyModelFromOutlineModel(e,t){let s;if(Iterable.first(e.children.values())instanceof OutlineGroup){const c=Iterable.find(e.children.values(),d=>d.id===t);if(c)s=c.children;else{let d="",u=-1,g;for(const[f,p]of e.children.entries()){const m=this._findSumOfRangesOfGroup(p);m>u&&(g=p,u=m,d=p.id)}t=d,s=g.children}}else s=e.children;const o=[],r=Array.from(s.values()).sort((c,d)=>{const u=new StickyRange(c.symbol.range.startLineNumber,c.symbol.range.endLineNumber),g=new StickyRange(d.symbol.range.startLineNumber,d.symbol.range.endLineNumber);return this._comparator(u,g)});for(const c of r)o.push(this._stickyModelFromOutlineElement(c,c.symbol.selectionRange.startLineNumber));return{stickyOutlineElement:new StickyElement(void 0,o,void 0),providerID:t}}_stickyModelFromOutlineElement(e,t){const s=[];for(const r of e.children.values())if(r.symbol.selectionRange.startLineNumber!==r.symbol.range.endLineNumber)if(r.symbol.selectionRange.startLineNumber!==t)s.push(this._stickyModelFromOutlineElement(r,r.symbol.selectionRange.startLineNumber));else for(const l of r.children.values())s.push(this._stickyModelFromOutlineElement(l,r.symbol.selectionRange.startLineNumber));s.sort((r,l)=>this._comparator(r.range,l.range));const o=new StickyRange(e.symbol.selectionRange.startLineNumber,e.symbol.range.endLineNumber);return new StickyElement(o,s,void 0)}_comparator(e,t){return e.startLineNumber!==t.startLineNumber?e.startLineNumber-t.startLineNumber:t.endLineNumber-e.endLineNumber}_findSumOfRangesOfGroup(e){let t=0;for(const s of e.children.values())t+=this._findSumOfRangesOfGroup(s);return e instanceof OutlineElement?t+e.symbol.range.endLineNumber-e.symbol.selectionRange.startLineNumber:t}};StickyModelFromCandidateOutlineProvider=__decorate$1f([__param$1e(1,ILanguageFeaturesService)],StickyModelFromCandidateOutlineProvider);class StickyModelFromCandidateFoldingProvider extends StickyModelCandidateProvider{constructor(e){super(e),this._foldingLimitReporter=this._register(new RangesLimitReporter(e))}createStickyModel(e,t){const s=this._fromFoldingRegions(t),o=this._editor.getModel();return new StickyModel(o.uri,o.getVersionId(),s,void 0)}isModelValid(e){return e!==null}_fromFoldingRegions(e){const t=e.length,s=[],o=new StickyElement(void 0,[],void 0);for(let r=0;r<t;r++){const l=e.getParentIndex(r);let c;l!==-1?c=s[l]:c=o;const d=new StickyElement(new StickyRange(e.getStartLineNumber(r),e.getEndLineNumber(r)+1),[],c);c.children.push(d),s.push(d)}return o}}let StickyModelFromCandidateIndentationFoldingProvider=class extends StickyModelFromCandidateFoldingProvider{constructor(e,t){super(e),this._languageConfigurationService=t,this.provider=this._register(new IndentRangeProvider(e.getModel(),this._languageConfigurationService,this._foldingLimitReporter))}async createModelFromProvider(e){return this.provider.compute(e)}};StickyModelFromCandidateIndentationFoldingProvider=__decorate$1f([__param$1e(1,ILanguageConfigurationService)],StickyModelFromCandidateIndentationFoldingProvider);let StickyModelFromCandidateSyntaxFoldingProvider=class extends StickyModelFromCandidateFoldingProvider{constructor(e,t,s){super(e),this._languageFeaturesService=s,this.provider=this._register(new MutableDisposable),this._register(this._languageFeaturesService.foldingRangeProvider.onDidChange(()=>{this._updateProvider(e,t)})),this._updateProvider(e,t)}_updateProvider(e,t){const s=FoldingController.getFoldingRangeProviders(this._languageFeaturesService,e.getModel());s.length!==0&&(this.provider.value=new SyntaxRangeProvider(e.getModel(),s,t,this._foldingLimitReporter,void 0))}isProviderValid(){return this.provider!==void 0}async createModelFromProvider(e){var t;return((t=this.provider.value)==null?void 0:t.compute(e))??null}};StickyModelFromCandidateSyntaxFoldingProvider=__decorate$1f([__param$1e(2,ILanguageFeaturesService)],StickyModelFromCandidateSyntaxFoldingProvider);var __decorate$1e=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1d=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class StickyLineCandidate{constructor(e,t,s,o){this.startLineNumber=e,this.endLineNumber=t,this.top=s,this.height=o}}let StickyLineCandidateProvider=class extends Disposable{constructor(e,t,s){super(),this._languageFeaturesService=t,this._languageConfigurationService=s,this._onDidChangeStickyScroll=this._register(new Emitter$1),this.onDidChangeStickyScroll=this._onDidChangeStickyScroll.event,this._model=null,this._cts=null,this._stickyModelProvider=null,this._editor=e,this._sessionStore=this._register(new DisposableStore),this._updateSoon=this._register(new RunOnceScheduler(()=>this.update(),50)),this._register(this._editor.onDidChangeConfiguration(o=>{o.hasChanged(131)&&this.readConfiguration()})),this.readConfiguration()}readConfiguration(){this._sessionStore.clear(),this._editor.getOption(131).enabled&&(this._sessionStore.add(this._editor.onDidChangeModel(()=>{this._model=null,this.updateStickyModelProvider(),this._onDidChangeStickyScroll.fire(),this.update()})),this._sessionStore.add(this._editor.onDidChangeHiddenAreas(()=>this.update())),this._sessionStore.add(this._editor.onDidChangeModelContent(()=>this._updateSoon.schedule())),this._sessionStore.add(this._languageFeaturesService.documentSymbolProvider.onDidChange(()=>this.update())),this._sessionStore.add(toDisposable(()=>{var t;(t=this._stickyModelProvider)==null||t.dispose(),this._stickyModelProvider=null})),this.updateStickyModelProvider(),this.update())}getVersionId(){var e;return(e=this._model)==null?void 0:e.version}updateStickyModelProvider(){var e;(e=this._stickyModelProvider)==null||e.dispose(),this._stickyModelProvider=null,this._editor.hasModel()&&(this._stickyModelProvider=new StickyModelProvider(this._editor,()=>this._updateSoon.schedule(),this._languageConfigurationService,this._languageFeaturesService))}async update(){var e;(e=this._cts)==null||e.dispose(!0),this._cts=new CancellationTokenSource$1,await this.updateStickyModel(this._cts.token),this._onDidChangeStickyScroll.fire()}async updateStickyModel(e){if(!this._editor.hasModel()||!this._stickyModelProvider||this._editor.getModel().isTooLargeForTokenization()){this._model=null;return}const t=await this._stickyModelProvider.update(e);e.isCancellationRequested||(this._model=t)}getCandidateStickyLinesIntersecting(e){var s;if(!((s=this._model)!=null&&s.element))return[];const t=[];return this.getCandidateStickyLinesIntersectingFromStickyModel(e,this._model.element,t,0,0,-1),this.filterHiddenRanges(t)}getCandidateStickyLinesIntersectingFromStickyModel(e,t,s,o,r,l){const c=this._editor.getModel();if(!c||t.children.length===0)return;let d=l;const u=[];for(let p=0;p<t.children.length;p++){const m=t.children[p];m.range&&u.push(m.range.startLineNumber)}const g=this.updateIndex(binarySearch(u,e.startLineNumber,(p,m)=>p-m)),f=this.updateIndex(binarySearch(u,e.endLineNumber,(p,m)=>p-m));for(let p=g;p<=f;p++){const m=t.children[p];if(!m||!m.range)continue;const{startLineNumber:_,endLineNumber:C}=m.range;if(C>_+1&&e.startLineNumber<=C+1&&_-1<=e.endLineNumber&&_!==d&&c.isValidRange(new Range$2(_,1,C,1))){d=_;const b=this._editor.getLineHeightForPosition(new Position$1(_,1));s.push(new StickyLineCandidate(_,C-1,r,b)),this.getCandidateStickyLinesIntersectingFromStickyModel(e,m,s,o+1,r+b,_)}}}filterHiddenRanges(e){var s;const t=(s=this._editor._getViewModel())==null?void 0:s.getHiddenAreas();return t?e.filter(o=>!t.some(r=>o.startLineNumber>=r.startLineNumber&&o.endLineNumber<=r.endLineNumber+1)):e}updateIndex(e){return e===-1?0:e<0?-e-2:e}};StickyLineCandidateProvider=__decorate$1e([__param$1d(1,ILanguageFeaturesService),__param$1d(2,ILanguageConfigurationService)],StickyLineCandidateProvider);var __decorate$1d=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1c=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},StickyScrollController_1,Ui;let StickyScrollController=(Ui=class extends Disposable{constructor(e,t,s,o,r,l,c){super(),this._editor=e,this._contextMenuService=t,this._languageFeaturesService=s,this._instaService=o,this._contextKeyService=c,this._sessionStore=new DisposableStore,this._maxStickyLines=Number.MAX_SAFE_INTEGER,this._candidateDefinitionsLength=-1,this._focusedStickyElementIndex=-1,this._enabled=!1,this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1,this._endLineNumbers=[],this._mouseTarget=null,this._onDidChangeStickyScrollHeight=this._register(new Emitter$1),this.onDidChangeStickyScrollHeight=this._onDidChangeStickyScrollHeight.event,this._stickyScrollWidget=new StickyScrollWidget(this._editor),this._stickyLineCandidateProvider=new StickyLineCandidateProvider(this._editor,s,r),this._register(this._stickyScrollWidget),this._register(this._stickyLineCandidateProvider),this._widgetState=StickyScrollWidgetState.Empty;const d=this._stickyScrollWidget.getDomNode();this._register(this._editor.onDidChangeLineHeight(g=>{g.changes.forEach(f=>{const p=f.lineNumber;this._widgetState.startLineNumbers.includes(p)&&this._renderStickyScroll(p)})})),this._register(this._editor.onDidChangeFont(g=>{g.changes.forEach(f=>{const p=f.lineNumber;this._widgetState.startLineNumbers.includes(p)&&this._renderStickyScroll(p)})})),this._register(this._editor.onDidChangeConfiguration(g=>{this._readConfigurationChange(g)})),this._register(addDisposableListener(d,EventType$1.CONTEXT_MENU,async g=>{this._onContextMenu(getWindow(d),g)})),this._stickyScrollFocusedContextKey=EditorContextKeys.stickyScrollFocused.bindTo(this._contextKeyService),this._stickyScrollVisibleContextKey=EditorContextKeys.stickyScrollVisible.bindTo(this._contextKeyService);const u=this._register(trackFocus(d));this._register(u.onDidBlur(g=>{this._positionRevealed===!1&&d.clientHeight===0?(this._focusedStickyElementIndex=-1,this.focus()):this._disposeFocusStickyScrollStore()})),this._register(u.onDidFocus(g=>{this.focus()})),this._registerMouseListeners(),this._register(addDisposableListener(d,EventType$1.MOUSE_DOWN,g=>{this._onMouseDown=!0})),this._register(this._stickyScrollWidget.onDidChangeStickyScrollHeight(g=>{this._onDidChangeStickyScrollHeight.fire(g)})),this._onDidResize(),this._readConfiguration()}get stickyScrollWidgetHeight(){return this._stickyScrollWidget.height}static get(e){return e.getContribution(StickyScrollController_1.ID)}_disposeFocusStickyScrollStore(){var e;this._stickyScrollFocusedContextKey.set(!1),(e=this._focusDisposableStore)==null||e.dispose(),this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1}isFocused(){return this._focused}focus(){if(this._onMouseDown){this._onMouseDown=!1,this._editor.focus();return}this._stickyScrollFocusedContextKey.get()!==!0&&(this._focused=!0,this._focusDisposableStore=new DisposableStore,this._stickyScrollFocusedContextKey.set(!0),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumbers.length-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex))}focusNext(){this._focusedStickyElementIndex<this._stickyScrollWidget.lineNumberCount-1&&this._focusNav(!0)}focusPrevious(){this._focusedStickyElementIndex>0&&this._focusNav(!1)}selectEditor(){this._editor.focus()}_focusNav(e){this._focusedStickyElementIndex=e?this._focusedStickyElementIndex+1:this._focusedStickyElementIndex-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex)}goToFocused(){const e=this._stickyScrollWidget.lineNumbers;this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:e[this._focusedStickyElementIndex],column:1})}_revealPosition(e){this._reveaInEditor(e,()=>this._editor.revealPosition(e))}_revealLineInCenterIfOutsideViewport(e){this._reveaInEditor(e,()=>this._editor.revealLineInCenterIfOutsideViewport(e.lineNumber,0))}_reveaInEditor(e,t){this._focused&&this._disposeFocusStickyScrollStore(),this._positionRevealed=!0,t(),this._editor.setSelection(Range$2.fromPositions(e)),this._editor.focus()}_registerMouseListeners(){const e=this._register(new DisposableStore),t=this._register(new ClickLinkGesture(this._editor,{extractLineNumberFromMouseEvent:r=>{const l=this._stickyScrollWidget.getEditorPositionFromNode(r.target.element);return l?l.lineNumber:0}})),s=r=>{if(!this._editor.hasModel()||r.target.type!==12||r.target.detail!==this._stickyScrollWidget.getId())return null;const l=r.target.element;if(!l||l.innerText!==l.innerHTML)return null;const c=this._stickyScrollWidget.getEditorPositionFromNode(l);return c?{range:new Range$2(c.lineNumber,c.column,c.lineNumber,c.column+l.innerText.length),textElement:l}:null},o=this._stickyScrollWidget.getDomNode();this._register(addStandardDisposableListener(o,EventType$1.CLICK,r=>{if(r.ctrlKey||r.altKey||r.metaKey||!r.leftButton)return;if(r.shiftKey){const u=this._stickyScrollWidget.getLineIndexFromChildDomNode(r.target);if(u===null)return;const g=new Position$1(this._endLineNumbers[u],1);this._revealLineInCenterIfOutsideViewport(g);return}if(this._stickyScrollWidget.isInFoldingIconDomNode(r.target)){const u=this._stickyScrollWidget.getLineNumberFromChildDomNode(r.target);this._toggleFoldingRegionForLine(u);return}if(!this._stickyScrollWidget.isInStickyLine(r.target))return;let d=this._stickyScrollWidget.getEditorPositionFromNode(r.target);if(!d){const u=this._stickyScrollWidget.getLineNumberFromChildDomNode(r.target);if(u===null)return;d=new Position$1(u,1)}this._revealPosition(d)})),this._register(addDisposableListener(mainWindow,EventType$1.MOUSE_MOVE,r=>{this._mouseTarget=r.target,this._onMouseMoveOrKeyDown(r)})),this._register(addDisposableListener(mainWindow,EventType$1.KEY_DOWN,r=>{this._onMouseMoveOrKeyDown(r)})),this._register(addDisposableListener(mainWindow,EventType$1.KEY_UP,()=>{this._showEndForLine!==void 0&&(this._showEndForLine=void 0,this._renderStickyScroll())})),this._register(t.onMouseMoveOrRelevantKeyDown(([r,l])=>{const c=s(r);if(!c||!r.hasTriggerModifier||!this._editor.hasModel()){e.clear();return}const{range:d,textElement:u}=c;if(!d.equalsRange(this._stickyRangeProjectedOnEditor))this._stickyRangeProjectedOnEditor=d,e.clear();else if(u.style.textDecoration==="underline")return;const g=new CancellationTokenSource$1;e.add(toDisposable(()=>g.dispose(!0)));let f;getDefinitionsAtPosition(this._languageFeaturesService.definitionProvider,this._editor.getModel(),new Position$1(d.startLineNumber,d.startColumn+1),!1,g.token).then(p=>{if(!g.token.isCancellationRequested)if(p.length!==0){this._candidateDefinitionsLength=p.length;const m=u;f!==m?(e.clear(),f=m,f.style.textDecoration="underline",e.add(toDisposable(()=>{f.style.textDecoration="none"}))):f||(f=m,f.style.textDecoration="underline",e.add(toDisposable(()=>{f.style.textDecoration="none"})))}else e.clear()})})),this._register(t.onCancel(()=>{e.clear()})),this._register(t.onExecute(async r=>{if(r.target.type!==12||r.target.detail!==this._stickyScrollWidget.getId())return;const l=this._stickyScrollWidget.getEditorPositionFromNode(r.target.element);l&&(!this._editor.hasModel()||!this._stickyRangeProjectedOnEditor||(this._candidateDefinitionsLength>1&&(this._focused&&this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:l.lineNumber,column:1})),this._instaService.invokeFunction(goToDefinitionWithLocation,r,this._editor,{uri:this._editor.getModel().uri,range:this._stickyRangeProjectedOnEditor})))}))}_onContextMenu(e,t){const s=new StandardMouseEvent(e,t);this._contextMenuService.showContextMenu({menuId:MenuId.StickyScrollContext,getAnchor:()=>s})}_onMouseMoveOrKeyDown(e){if(!e.shiftKey||!this._mouseTarget||!isHTMLElement(this._mouseTarget))return;const t=this._stickyScrollWidget.getLineIndexFromChildDomNode(this._mouseTarget);t===null||this._showEndForLine===t||(this._showEndForLine=t,this._renderStickyScroll())}_toggleFoldingRegionForLine(e){if(!this._foldingModel||e===null)return;const t=this._stickyScrollWidget.getRenderedStickyLine(e),s=t==null?void 0:t.foldingIcon;if(!s)return;toggleCollapseState(this._foldingModel,1,[e]),s.isCollapsed=!s.isCollapsed;const o=(s.isCollapsed?this._editor.getTopForLineNumber(s.foldingEndLine):this._editor.getTopForLineNumber(s.foldingStartLine))-this._editor.getOption(75)*t.index+1;this._editor.setScrollTop(o),this._renderStickyScroll(e)}_readConfiguration(){const e=this._editor.getOption(131);if(e.enabled===!1){this._editor.removeOverlayWidget(this._stickyScrollWidget),this._resetState(),this._sessionStore.clear(),this._enabled=!1;return}else e.enabled&&!this._enabled&&(this._editor.addOverlayWidget(this._stickyScrollWidget),this._sessionStore.add(this._editor.onDidScrollChange(s=>{s.scrollTopChanged&&(this._showEndForLine=void 0,this._renderStickyScroll())})),this._sessionStore.add(this._editor.onDidLayoutChange(()=>this._onDidResize())),this._sessionStore.add(this._editor.onDidChangeModelTokens(s=>this._onTokensChange(s))),this._sessionStore.add(this._stickyLineCandidateProvider.onDidChangeStickyScroll(()=>{this._showEndForLine=void 0,this._renderStickyScroll()})),this._enabled=!0);this._editor.getOption(76).renderType===2&&this._sessionStore.add(this._editor.onDidChangeCursorPosition(()=>{this._showEndForLine=void 0,this._renderStickyScroll(0)}))}_readConfigurationChange(e){(e.hasChanged(131)||e.hasChanged(81)||e.hasChanged(75)||e.hasChanged(126)||e.hasChanged(76))&&this._readConfiguration(),(e.hasChanged(76)||e.hasChanged(52)||e.hasChanged(126))&&this._renderStickyScroll(0)}_needsUpdate(e){const t=this._stickyScrollWidget.getCurrentLines();for(const s of t)for(const o of e.ranges)if(s>=o.fromLineNumber&&s<=o.toLineNumber)return!0;return!1}_onTokensChange(e){this._needsUpdate(e)&&this._renderStickyScroll(0)}_onDidResize(){const t=this._editor.getLayoutInfo().height/this._editor.getOption(75);this._maxStickyLines=Math.round(t*.25),this._renderStickyScroll(0)}async _renderStickyScroll(e){const t=this._editor.getModel();if(!t||t.isTooLargeForTokenization()){this._resetState();return}const s=this._updateAndGetMinRebuildFromLine(e),o=this._stickyLineCandidateProvider.getVersionId();if(o===void 0||o===t.getVersionId())if(!this._focused)await this._updateState(s);else if(this._focusedStickyElementIndex===-1)await this._updateState(s),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1,this._focusedStickyElementIndex!==-1&&this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);else{const l=this._stickyScrollWidget.lineNumbers[this._focusedStickyElementIndex];await this._updateState(s),this._stickyScrollWidget.lineNumberCount===0?this._focusedStickyElementIndex=-1:(this._stickyScrollWidget.lineNumbers.includes(l)||(this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1),this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex))}}_updateAndGetMinRebuildFromLine(e){if(e!==void 0){const t=this._minRebuildFromLine!==void 0?this._minRebuildFromLine:1/0;this._minRebuildFromLine=Math.min(e,t)}return this._minRebuildFromLine}async _updateState(e){var s;this._minRebuildFromLine=void 0,this._foldingModel=await((s=FoldingController.get(this._editor))==null?void 0:s.getFoldingModel())??void 0,this._widgetState=this.findScrollWidgetState();const t=this._widgetState.startLineNumbers.length>0;this._stickyScrollVisibleContextKey.set(t),this._stickyScrollWidget.setState(this._widgetState,this._foldingModel,e)}async _resetState(){this._minRebuildFromLine=void 0,this._foldingModel=void 0,this._widgetState=StickyScrollWidgetState.Empty,this._stickyScrollVisibleContextKey.set(!1),this._stickyScrollWidget.setState(void 0,void 0)}findScrollWidgetState(){const e=Math.min(this._maxStickyLines,this._editor.getOption(131).maxLineCount),t=this._editor.getScrollTop();let s=0;const o=[],r=[],l=this._editor.getVisibleRanges();if(l.length!==0){const c=new StickyRange(l[0].startLineNumber,l[l.length-1].endLineNumber),d=this._stickyLineCandidateProvider.getCandidateStickyLinesIntersecting(c);for(const u of d){const g=u.startLineNumber,f=u.endLineNumber,p=u.top,m=p+u.height,_=this._editor.getTopForLineNumber(g)-t,C=this._editor.getBottomForLineNumber(f)-t;if(p>_&&p<=C&&(o.push(g),r.push(f+1),m>C&&(s=C-m)),o.length===e)break}}return this._endLineNumbers=r,new StickyScrollWidgetState(o,r,s,this._showEndForLine)}dispose(){super.dispose(),this._sessionStore.dispose()}},StickyScrollController_1=Ui,Ui.ID="store.contrib.stickyScrollController",Ui);StickyScrollController=StickyScrollController_1=__decorate$1d([__param$1c(1,IContextMenuService),__param$1c(2,ILanguageFeaturesService),__param$1c(3,IInstantiationService),__param$1c(4,ILanguageConfigurationService),__param$1c(5,ILanguageFeatureDebounceService),__param$1c(6,IContextKeyService)],StickyScrollController);const originalBackgroundColor=registerColor("inlineEdit.originalBackground",transparent(diffRemoved,.2),localize(1210,"Background color for the original text in inline edits."),!0),modifiedBackgroundColor=registerColor("inlineEdit.modifiedBackground",transparent(diffInserted,.3),localize(1211,"Background color for the modified text in inline edits."),!0);registerColor("inlineEdit.originalChangedLineBackground",transparent(diffRemoved,.8),localize(1212,"Background color for the changed lines in the original text of inline edits."),!0);const originalChangedTextOverlayColor=registerColor("inlineEdit.originalChangedTextBackground",transparent(diffRemoved,.8),localize(1213,"Overlay color for the changed text in the original text of inline edits."),!0),modifiedChangedLineBackgroundColor=registerColor("inlineEdit.modifiedChangedLineBackground",{light:transparent(diffInsertedLine,.7),dark:transparent(diffInsertedLine,.7),hcDark:diffInsertedLine,hcLight:diffInsertedLine},localize(1214,"Background color for the changed lines in the modified text of inline edits."),!0),modifiedChangedTextOverlayColor=registerColor("inlineEdit.modifiedChangedTextBackground",transparent(diffInserted,.7),localize(1215,"Overlay color for the changed text in the modified text of inline edits."),!0),inlineEditIndicatorPrimaryForeground=registerColor("inlineEdit.gutterIndicator.primaryForeground",buttonForeground,localize(1216,"Foreground color for the primary inline edit gutter indicator.")),inlineEditIndicatorPrimaryBorder=registerColor("inlineEdit.gutterIndicator.primaryBorder",buttonBackground,localize(1217,"Border color for the primary inline edit gutter indicator.")),inlineEditIndicatorPrimaryBackground=registerColor("inlineEdit.gutterIndicator.primaryBackground",{light:transparent(inlineEditIndicatorPrimaryBorder,.5),dark:transparent(inlineEditIndicatorPrimaryBorder,.4),hcDark:transparent(inlineEditIndicatorPrimaryBorder,.4),hcLight:transparent(inlineEditIndicatorPrimaryBorder,.5)},localize(1218,"Background color for the primary inline edit gutter indicator.")),inlineEditIndicatorSecondaryForeground=registerColor("inlineEdit.gutterIndicator.secondaryForeground",buttonSecondaryForeground,localize(1219,"Foreground color for the secondary inline edit gutter indicator.")),inlineEditIndicatorSecondaryBorder=registerColor("inlineEdit.gutterIndicator.secondaryBorder",buttonSecondaryBackground,localize(1220,"Border color for the secondary inline edit gutter indicator.")),inlineEditIndicatorSecondaryBackground=registerColor("inlineEdit.gutterIndicator.secondaryBackground",inlineEditIndicatorSecondaryBorder,localize(1221,"Background color for the secondary inline edit gutter indicator.")),inlineEditIndicatorsuccessfulForeground=registerColor("inlineEdit.gutterIndicator.successfulForeground",buttonForeground,localize(1222,"Foreground color for the successful inline edit gutter indicator.")),inlineEditIndicatorsuccessfulBorder=registerColor("inlineEdit.gutterIndicator.successfulBorder",buttonBackground,localize(1223,"Border color for the successful inline edit gutter indicator.")),inlineEditIndicatorsuccessfulBackground=registerColor("inlineEdit.gutterIndicator.successfulBackground",inlineEditIndicatorsuccessfulBorder,localize(1224,"Background color for the successful inline edit gutter indicator.")),inlineEditIndicatorBackground=registerColor("inlineEdit.gutterIndicator.background",{hcDark:transparent("tab.inactiveBackground",.5),hcLight:transparent("tab.inactiveBackground",.5),dark:transparent("tab.inactiveBackground",.5),light:"#5f5f5f18"},localize(1225,"Background color for the inline edit gutter indicator.")),originalBorder=registerColor("inlineEdit.originalBorder",{light:diffRemoved,dark:diffRemoved,hcDark:diffRemoved,hcLight:diffRemoved},localize(1226,"Border color for the original text in inline edits.")),modifiedBorder=registerColor("inlineEdit.modifiedBorder",{light:darken(diffInserted,.6),dark:diffInserted,hcDark:diffInserted,hcLight:diffInserted},localize(1227,"Border color for the modified text in inline edits.")),tabWillAcceptModifiedBorder=registerColor("inlineEdit.tabWillAcceptModifiedBorder",{light:darken(modifiedBorder,0),dark:darken(modifiedBorder,0),hcDark:darken(modifiedBorder,0),hcLight:darken(modifiedBorder,0)},localize(1228,"Modified border color for the inline edits widget when tab will accept it.")),tabWillAcceptOriginalBorder=registerColor("inlineEdit.tabWillAcceptOriginalBorder",{light:darken(originalBorder,0),dark:darken(originalBorder,0),hcDark:darken(originalBorder,0),hcLight:darken(originalBorder,0)},localize(1229,"Original border color for the inline edits widget over the original text when tab will accept it."));function getModifiedBorderColor(a){return a.map(e=>e===InlineEditTabAction.Accept?tabWillAcceptModifiedBorder:modifiedBorder)}function getOriginalBorderColor(a){return a.map(e=>e===InlineEditTabAction.Accept?tabWillAcceptOriginalBorder:originalBorder)}function getEditorBlendedColor(a,e){let t;typeof a=="string"?t=observeColor(a,e):t=a.map((o,r)=>observeColor(o,e).read(r));const s=observeColor(editorBackground,e);return t.map((o,r)=>o.makeOpaque(s.read(r)))}function observeColor(a,e){return observableFromEventOpts({owner:{observeColor:a},equalsFn:(t,s)=>t.equals(s),debugName:()=>`observeColor(${a})`},e.onDidColorThemeChange,()=>{const t=e.getColorTheme().getColor(a);if(!t)throw new BugIndicatingError(`Missing color: ${a}`);return t})}function maxContentWidthInRange(a,e,t){a.layoutInfo.read(t),a.value.read(t);const s=a.model.read(t);if(!s)return 0;let o=0;a.scrollTop.read(t);for(let l=e.startLineNumber;l<e.endLineNumberExclusive;l++){const c=s.getLineMaxColumn(l);let d=a.editor.getOffsetForColumn(l,c);if(d===-1){const u=a.editor.getOption(59).typicalHalfwidthCharacterWidth;d=c*u}o=Math.max(o,d)}const r=e.mapToLineArray(l=>s.getLineContent(l));return o<5&&r.some(l=>l.length>0)&&s.uri.scheme!=="file"&&console.error("unexpected width"),o}function getOffsetForPos(a,e,t){return a.layoutInfo.read(t),a.value.read(t),a.model.read(t)?(a.scrollTop.read(t),a.editor.getOffsetForColumn(e.lineNumber,e.column)):0}function getPrefixTrim(a,e,t,s){const o=s.getModel();if(!o)return{prefixTrim:0,prefixLeftOffset:0};const r=a.map(f=>f.isSingleLine()?f.startColumn-1:0),l=e.mapToLineArray(f=>indentOfLine(o.getLineContent(f))),c=t.filter(f=>f!=="").map(f=>indentOfLine(f)),d=Math.min(...r,...l,...c);let u;if(o.getLineIndentColumn(e.startLineNumber)>=d+1)u=s.getOffsetForColumn(e.startLineNumber,d+1);else if(t.length>0)u=getContentRenderWidth(t[0].slice(0,d),s,o);else return{prefixTrim:0,prefixLeftOffset:0};return{prefixTrim:d,prefixLeftOffset:u}}function getContentRenderWidth(a,e,t){const s=e.getOption(59).typicalHalfwidthCharacterWidth,o=t.getOptions().tabSize*s,r=a.split("	").length-1;return(a.length-r)*s+r*o}function getEditorValidOverlayRect(a){const e=a.layoutInfoContentLeft,t=derived({name:"editor.validOverlay.width"},o=>{const r=a.layoutInfoMinimap.read(o).minimapLeft!==0,l=a.layoutInfoWidth.read(o)-e.read(o);if(r){const c=a.layoutInfoMinimap.read(o).minimapWidth+a.layoutInfoVerticalScrollbarWidth.read(o);return l-c}return l}),s=derived({name:"editor.validOverlay.height"},o=>a.layoutInfoHeight.read(o)+a.contentHeight.read(o));return derived({name:"editor.validOverlay"},o=>Rect.fromLeftTopWidthHeight(e.read(o),0,t.read(o),s.read(o)))}function applyEditToModifiedRangeMappings(a,e){const t=[];for(const s of a){const o=e.mapRange(s.modifiedRange);t.push(new RangeMapping(s.originalRange,o))}return t}function classNames(...a){return a.filter(e=>typeof e=="string").join(" ")}function offsetRangeToRange(a,e){return new Range$2(e.lineNumber,e.column+a.start,e.lineNumber,e.column+a.endExclusive)}function getIndentationSize(a,e){let t=0;e:for(let s=0,o=a.length;s<o;s++)switch(a.charCodeAt(s)){case 9:t+=e;break;case 32:t++;break;default:break e}return t-t%e}function indentSizeToIndentLength(a,e,t){let s=e-e%t,o=0;for(;o<a.length&&s!==0;o++)switch(a.charCodeAt(o)){case 9:s-=t;break;case 32:s--;break;default:throw new BugIndicatingError("Unexpected character found while calculating indent length")}return o}function createReindentEdit(a,e,t){const s=splitLines(a),o=[],r=findFirstMin(e.mapToLineArray(l=>getIndentationSize(s[l-1],t)),numberComparator);return e.forEach(l=>{const c=indentSizeToIndentLength(s[l-1],r,t);o.push(new TextReplacement(offsetRangeToRange(new OffsetRange(0,c),new Position$1(l,1)),""))}),new TextEdit(o)}class PathBuilder{constructor(){this._data=""}moveTo(e){return this._data+=`M ${e.x} ${e.y} `,this}lineTo(e){return this._data+=`L ${e.x} ${e.y} `,this}build(){return this._data}}function mapOutFalsy(a){const e=derivedObservableWithCache(void 0,(t,s)=>a.read(t)||s);return derivedOpts({debugName:()=>`${a.debugName}.mapOutFalsy`},t=>{if(e.read(t),!!a.read(t))return e})}function rectToProps(a){return{left:derived({name:"editor.validOverlay.left"},e=>a(e).left),top:derived({name:"editor.validOverlay.top"},e=>a(e).top),width:derived({name:"editor.validOverlay.width"},e=>a(e).right-a(e).left),height:derived({name:"editor.validOverlay.height"},e=>a(e).bottom-a(e).top)}}var __decorate$1c=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1b=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let GutterIndicatorMenuContent=class{constructor(e,t,s,o,r,l){this._model=e,this._close=t,this._editorObs=s,this._contextKeyService=o,this._keybindingService=r,this._commandService=l,this._inlineEditsShowCollapsed=this._editorObs.getOption(71).map(c=>c.edits.showCollapsed)}toDisposableLiveElement(){return this._createHoverContent().toDisposableLiveElement()}_createHoverContent(){const e=observableValue("active",void 0),t=f=>({title:f.title,icon:f.icon,keybinding:typeof f.commandId=="string"?this._getKeybinding(f.commandArgs?void 0:f.commandId):derived(this,p=>typeof f.commandId=="string"?void 0:this._getKeybinding(f.commandArgs?void 0:f.commandId.read(p)).read(p)),isActive:e.map(p=>p===f.id),onHoverChange:p=>e.set(p?f.id:void 0,void 0),onAction:()=>(this._close(!0),this._commandService.executeCommand(typeof f.commandId=="string"?f.commandId:f.commandId.get(),...f.commandArgs??[]))}),s=header(this._model.displayName),o=option(t({id:"gotoAndAccept",title:`${localize(1203,"Go To")} / ${localize(1204,"Accept")}`,icon:Codicon.check,commandId:inlineSuggestCommitId})),r=option(t({id:"reject",title:localize(1205,"Reject"),icon:Codicon.close,commandId:hideInlineCompletionId})),l=this._model.extensionCommands.map((f,p)=>option(t({id:f.command.id+"_"+p,title:f.command.title,icon:f.icon??Codicon.symbolEvent,commandId:f.command.id,commandArgs:f.command.arguments}))),c=this._inlineEditsShowCollapsed.map(f=>option(t(f?{id:"showExpanded",title:localize(1206,"Show Expanded"),icon:Codicon.expandAll,commandId:toggleShowCollapsedId}:{id:"showCollapsed",title:localize(1207,"Show Collapsed"),icon:Codicon.collapseAll,commandId:toggleShowCollapsedId}))),d=option(t({id:"settings",title:localize(1208,"Settings"),icon:Codicon.gear,commandId:"workbench.action.openSettings",commandArgs:["@tag:nextEditSuggestions"]})),u=this._model.action?[this._model.action]:[],g=u.length>0?actionBar(u.map(f=>({id:f.id,label:f.title+"...",enabled:!0,run:()=>this._commandService.executeCommand(f.id,...f.arguments??[]),class:void 0,tooltip:f.tooltip??f.title})),{hoverDelegate:nativeHoverDelegate}):void 0;return hoverContent([s,o,r,c,l.length?separator():void 0,d,...l,g?separator():void 0,g])}_getKeybinding(e){return e?observableFromEvent(this._contextKeyService.onDidChangeContext,()=>this._keybindingService.lookupKeybinding(e)):constObservable(void 0)}};GutterIndicatorMenuContent=__decorate$1c([__param$1b(3,IContextKeyService),__param$1b(4,IKeybindingService),__param$1b(5,ICommandService)],GutterIndicatorMenuContent);function hoverContent(a){return n.div({class:"content",style:{margin:4,minWidth:180}},a)}function header(a){return n.div({class:"header",style:{color:asCssVariable(descriptionForeground),fontSize:"13px",fontWeight:"600",padding:"0 4px",lineHeight:28}},[a])}function option(a){return derived({name:"inlineEdits.option"},e=>{var t;return n.div({class:["monaco-menu-option",(t=a.isActive)==null?void 0:t.map(s=>s&&"active")],onmouseenter:()=>{var s;return(s=a.onHoverChange)==null?void 0:s.call(a,!0)},onmouseleave:()=>{var s;return(s=a.onHoverChange)==null?void 0:s.call(a,!1)},onclick:a.onAction,onkeydown:s=>{var o;s.key==="Enter"&&((o=a.onAction)==null||o.call(a))},tabIndex:0,style:{borderRadius:3}},[n.elem("span",{style:{fontSize:16,display:"flex"}},[ThemeIcon.isThemeIcon(a.icon)?renderIcon(a.icon):a.icon.map(s=>renderIcon(s))]),n.elem("span",{},[a.title]),n.div({style:{marginLeft:"auto"},ref:s=>{const o=e.store.add(new KeybindingLabel(s,OS,{disableTitle:!0,...defaultKeybindingLabelStyles,keybindingLabelShadow:void 0,keybindingLabelForeground:asCssVariable(descriptionForeground),keybindingLabelBackground:"transparent",keybindingLabelBorder:"transparent",keybindingLabelBottomBorder:void 0}));e.store.add(autorun(r=>{o.set(a.keybinding.read(r))}))}})])})}function actionBar(a,e){return derived({name:"inlineEdits.actionBar"},t=>n.div({class:["action-widget-action-bar"],style:{padding:"3px 24px"}},[n.div({ref:s=>{t.store.add(new ActionBar(s,e)).push(a,{icon:!1,label:!0})}})]))}function separator(){return n.div({id:"inline-edit-gutter-indicator-menu-separator",class:"menu-separator",style:{color:asCssVariable(editorActionListForeground),padding:"2px 0"}},n.div({style:{borderBottom:`1px solid ${asCssVariable(editorHoverBorder)}`}}))}var __decorate$1b=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1a=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let InlineEditsGutterIndicator=class extends Disposable{get model(){const e=this._model.get();if(!e)throw new BugIndicatingError("Inline Edit Model not available");return e}constructor(e,t,s,o,r,l,c,d,u,g){super(),this._editorObs=e,this._originalRange=t,this._verticalOffset=s,this._model=o,this._isHoveringOverInlineEdit=r,this._focusIsInMenu=l,this._hoverService=c,this._instantiationService=d,this._accessibilityService=u,this._tabAction=derived(this,f=>{const p=this._model.read(f);return p?p.tabAction.read(f):InlineEditTabAction.Inactive}),this._hoverVisible=observableValue(this,!1),this.isHoverVisible=this._hoverVisible,this._isHoveredOverIcon=observableValue(this,!1),this._isHoveredOverIconDebounced=debouncedObservable(this._isHoveredOverIcon,100),this.isHoveredOverIcon=this._isHoveredOverIconDebounced,this._isHoveredOverInlineEditDebounced=debouncedObservable(this._isHoveringOverInlineEdit,100),this._gutterIndicatorStyles=this._tabAction.map(this,(f,p)=>{switch(f){case InlineEditTabAction.Inactive:return{background:getEditorBlendedColor(inlineEditIndicatorSecondaryBackground,g).read(p).toString(),foreground:getEditorBlendedColor(inlineEditIndicatorSecondaryForeground,g).read(p).toString(),border:getEditorBlendedColor(inlineEditIndicatorSecondaryBorder,g).read(p).toString()};case InlineEditTabAction.Jump:return{background:getEditorBlendedColor(inlineEditIndicatorPrimaryBackground,g).read(p).toString(),foreground:getEditorBlendedColor(inlineEditIndicatorPrimaryForeground,g).read(p).toString(),border:getEditorBlendedColor(inlineEditIndicatorPrimaryBorder,g).read(p).toString()};case InlineEditTabAction.Accept:return{background:getEditorBlendedColor(inlineEditIndicatorsuccessfulBackground,g).read(p).toString(),foreground:getEditorBlendedColor(inlineEditIndicatorsuccessfulForeground,g).read(p).toString(),border:getEditorBlendedColor(inlineEditIndicatorsuccessfulBorder,g).read(p).toString()};default:assertNever()}}),this._originalRangeObs=mapOutFalsy(this._originalRange),this._state=derived(this,f=>{const p=this._originalRangeObs.read(f);if(p)return{range:p,lineOffsetRange:this._editorObs.observeLineOffsetRange(p,this._store)}}),this._stickyScrollController=StickyScrollController.get(this._editorObs.editor),this._stickyScrollHeight=this._stickyScrollController?observableFromEvent(this._stickyScrollController.onDidChangeStickyScrollHeight,()=>this._stickyScrollController.stickyScrollWidgetHeight):constObservable(0),this._lineNumberToRender=derived(this,f=>{var _;if(this._verticalOffset.read(f)!==0)return"";const p=(_=this._originalRange.read(f))==null?void 0:_.startLineNumber,m=this._editorObs.getOption(76).read(f);if(p===void 0||m.renderType===0)return"";if(m.renderType===3){const C=this._editorObs.cursorPosition.read(f);return p%10===0||C&&C.lineNumber===p?p.toString():""}if(m.renderType===2){const C=this._editorObs.cursorPosition.read(f);if(!C)return"";const b=Math.abs(p-C.lineNumber);return b===0?p.toString():b.toString()}return m.renderType===4?m.renderFn?m.renderFn(p):"":p.toString()}),this._availableWidthForIcon=derived(this,f=>{const p=this._editorObs.editor.getModel(),m=this._editorObs.editor,_=this._editorObs.layoutInfo.read(f),C=_.decorationsLeft+_.decorationsWidth-_.glyphMarginLeft;if(!p||C<=0)return()=>0;if(_.lineNumbersLeft===0)return()=>C;const b=this._editorObs.getOption(76).read(f);if(b.renderType===2||b.renderType===0)return()=>C;const v=m.getOption(59).typicalHalfwidthCharacterWidth,S=_.lineNumbersLeft+_.lineNumbersWidth,w=(p.getLineCount()+1).toString().length,L=[];for(let x=1;x<=w;x++){const E=10**(x-1),I=m.getTopForLineNumber(E),D=x*v,k=Math.min(C,Math.max(0,S-D-_.glyphMarginLeft));L.push({firstLineNumberWithDigitCount:E,topOfLineNumber:I,usableWidthLeftOfLineNumber:k})}return x=>{for(let E=L.length-1;E>=0;E--)if(x>=L[E].topOfLineNumber)return L[E].usableWidthLeftOfLineNumber;throw new BugIndicatingError("Could not find avilable width for icon")}}),this._layout=derived(this,f=>{const p=this._state.read(f);if(!p)return;const m=this._editorObs.layoutInfo.read(f),_=this._editorObs.observeLineHeightForLine(p.range.map(z=>z.startLineNumber)).read(f),C=2,b=m.decorationsLeft+m.decorationsWidth-m.glyphMarginLeft-2*C,v=m.height-2*C,S=Rect.fromLeftTopWidthHeight(C,C,b,v),y=S.withTop(this._stickyScrollHeight.read(f)),w=S.withTop(y.top+C),L=p.lineOffsetRange.read(f),x=Rect.fromRanges(OffsetRange.fromTo(w.left,w.right),L),E=_,I=this._verticalOffset.read(f),D=x.withHeight(E).translateY(I),k=y.containsRect(D),N=this._tabAction.map(z=>z===InlineEditTabAction.Accept?Codicon.keyboardTab:Codicon.arrowRight),R=derived(this,z=>{if(this._isHoveredOverIconDebounced.read(z)||this._isHoveredOverInlineEditDebounced.read(z))return Codicon.check;if(this._tabAction.read(z)===InlineEditTabAction.Accept)return Codicon.keyboardTab;const G=this._editorObs.cursorLineNumber.read(z)??0,X=p.range.read(z).startLineNumber;return G<=X?Codicon.keyboardTabAbove:Codicon.keyboardTabBelow}),M=22,A=16,O=z=>{const G=this._availableWidthForIcon.read(void 0)(z.bottom+this._editorObs.editor.getScrollTop())-C;return Math.max(Math.min(G,M),A)};if(k){const z=D;let G;m.lineNumbersWidth===0?G=Math.min(Math.max(m.lineNumbersLeft-S.left,0),z.width-M):G=Math.max(m.lineNumbersLeft+m.lineNumbersWidth-S.left,0);const X=z.withWidth(G),Y=Math.max(Math.min(m.decorationsWidth,M),A),ee=z.withWidth(Y).translateX(G);return{gutterEditArea:x,icon:R,iconDirection:"right",iconRect:ee,pillRect:z,lineNumberRect:X}}const P=S.intersect(x);if(P&&P.height>=E){const z=D.moveToBeContainedIn(w).moveToBeContainedIn(P),G=z.withWidth(O(z));return{gutterEditArea:x,icon:R,iconDirection:"right",iconRect:G,pillRect:G}}const B=D.moveToBeContainedIn(S),H=B.withWidth(O(B)),V=H,K=H.top<D.top?"top":"bottom";return{gutterEditArea:x,icon:N,iconDirection:K,iconRect:V,pillRect:H}}),this._iconRef=n.ref(),this.isVisible=this._layout.map(f=>!!f),this._indicator=n.div({class:"inline-edits-view-gutter-indicator",onclick:()=>{const f=this._layout.get(),p=(f==null?void 0:f.icon.get())===Codicon.check;this._editorObs.editor.focus(),p?this.model.accept():this.model.jump()},tabIndex:0,style:{position:"absolute",overflow:"visible"}},mapOutFalsy(this._layout).map(f=>f?[n.div({style:{position:"absolute",background:asCssVariable(inlineEditIndicatorBackground),borderRadius:"4px",...rectToProps(p=>f.read(p).gutterEditArea)}}),n.div({class:"icon",ref:this._iconRef,onmouseenter:()=>{this._showHover()},style:{cursor:"pointer",zIndex:"20",position:"absolute",backgroundColor:this._gutterIndicatorStyles.map(p=>p.background),"--vscodeIconForeground":this._gutterIndicatorStyles.map(p=>p.foreground),border:this._gutterIndicatorStyles.map(p=>`1px solid ${p.border}`),boxSizing:"border-box",borderRadius:"4px",display:"flex",justifyContent:"flex-end",transition:"background-color 0.2s ease-in-out, width 0.2s ease-in-out",...rectToProps(p=>f.read(p).pillRect)}},[n.div({className:"line-number",style:{lineHeight:f.map(p=>p.lineNumberRect?p.lineNumberRect.height:0),display:f.map(p=>p.lineNumberRect?"flex":"none"),alignItems:"center",justifyContent:"flex-end",width:f.map(p=>p.lineNumberRect?p.lineNumberRect.width:0),height:"100%",color:this._gutterIndicatorStyles.map(p=>p.foreground)}},this._lineNumberToRender),n.div({style:{rotate:f.map(p=>`${getRotationFromDirection(p.iconDirection)}deg`),transition:"rotate 0.2s ease-in-out",display:"flex",alignItems:"center",justifyContent:"center",height:"100%",marginRight:f.map(p=>{var m;return p.pillRect.width-p.iconRect.width-(((m=p.lineNumberRect)==null?void 0:m.width)??0)}),width:f.map(p=>p.iconRect.width)}},[f.map((p,m)=>renderIcon(p.icon.read(m)))])])]:[])).keepUpdated(this._store),this._register(this._editorObs.createOverlayWidget({domNode:this._indicator.element,position:constObservable(null),allowEditorOverflow:!1,minContentWidthInPx:constObservable(0)})),this._register(this._editorObs.editor.onMouseMove(f=>{if(this._state.get()===void 0)return;const _=this._iconRef.element.getBoundingClientRect(),C=Rect.fromLeftTopWidthHeight(_.left,_.top,_.width,_.height),b=new Point(f.event.posx,f.event.posy);this._isHoveredOverIcon.set(C.containsPoint(b),void 0)})),this._register(this._editorObs.editor.onDidScrollChange(()=>{this._isHoveredOverIcon.set(!1,void 0)})),this._register(runOnChange(this._isHoveredOverInlineEditDebounced,f=>{f&&this.triggerAnimation()})),this._register(autorun(f=>{this._indicator.readEffect(f),this._indicator.element&&this._editorObs.editor.applyFontInfo(this._indicator.element)}))}triggerAnimation(){return this._accessibilityService.isMotionReduced()?new Animation(null,null).finished:this._iconRef.element.animate([{outline:`2px solid ${this._gutterIndicatorStyles.map(t=>t.border).get()}`,outlineOffset:"-1px",offset:0},{outline:"2px solid transparent",outlineOffset:"10px",offset:1}],{duration:500}).finished}_showHover(){if(this._hoverVisible.get())return;const e=new DisposableStore,t=e.add(this._instantiationService.createInstance(GutterIndicatorMenuContent,this.model,r=>{r&&this._editorObs.editor.focus(),o==null||o.dispose()},this._editorObs).toDisposableLiveElement()),s=e.add(trackFocus(t.element));e.add(s.onDidBlur(()=>this._focusIsInMenu.set(!1,void 0))),e.add(s.onDidFocus(()=>this._focusIsInMenu.set(!0,void 0))),e.add(toDisposable(()=>this._focusIsInMenu.set(!1,void 0)));const o=this._hoverService.showInstantHover({target:this._iconRef.element,content:t.element});o?(this._hoverVisible.set(!0,void 0),e.add(this._editorObs.editor.onDidScrollChange(()=>o.dispose())),e.add(o.onDispose(()=>{this._hoverVisible.set(!1,void 0),e.dispose()}))):e.dispose()}};InlineEditsGutterIndicator=__decorate$1b([__param$1a(6,IHoverService),__param$1a(7,IInstantiationService),__param$1a(8,IAccessibilityService),__param$1a(9,IThemeService)],InlineEditsGutterIndicator);function getRotationFromDirection(a){switch(a){case"top":return 90;case"bottom":return-90;case"right":return 0}}var __decorate$1a=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$19=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},UserKind;(function(a){a.FirstTime="firstTime",a.SecondTime="secondTime",a.Active="active"})(UserKind||(UserKind={}));let InlineEditsOnboardingExperience=class extends Disposable{constructor(e,t,s,o,r,l){super(),this._host=e,this._model=t,this._indicator=s,this._collapsedView=o,this._storageService=r,this._configurationService=l,this._disposables=this._register(new MutableDisposable),this._setupDone=observableValue({name:"setupDone"},!1),this._activeCompletionId=derived(c=>{const d=this._model.read(c);if(!d||!this._setupDone.read(c))return;const u=this._indicator.read(c);if(!(!u||!u.isVisible.read(c)))return d.inlineEdit.inlineCompletion.identity.id}),this._register(this._initializeDebugSetting()),this._disposables.value=this.setupNewUserExperience(),this._setupDone.set(!0,void 0)}setupNewUserExperience(){if(this.getNewUserType()===UserKind.Active)return;const e=new DisposableStore;let t=!1,s=!1,o=0,r=0;return e.add(runOnChangeWithCancellationToken(this._activeCompletionId,async(l,c,d,u)=>{var f,p;if(l===void 0)return;let g=this.getNewUserType();switch(g){case UserKind.FirstTime:{(o++>=5||t)&&(g=UserKind.SecondTime,this.setNewUserType(g));break}case UserKind.SecondTime:{r++>=3&&s&&(g=UserKind.Active,this.setNewUserType(g));break}}switch(g){case UserKind.FirstTime:{for(let m=0;m<3&&!u.isCancellationRequested;m++)await((f=this._indicator.get())==null?void 0:f.triggerAnimation()),await timeout(500);break}case UserKind.SecondTime:{(p=this._indicator.get())==null||p.triggerAnimation();break}}})),e.add(autorun(l=>{this._collapsedView.isVisible.read(l)&&this.getNewUserType()!==UserKind.Active&&this._collapsedView.triggerAnimation()})),e.add(autorunWithStore((l,c)=>{const d=this._indicator.read(l);d&&c.add(runOnChange(d.isHoveredOverIcon,async u=>{u&&(t=!0)}))})),e.add(autorunWithStore((l,c)=>{const d=this._host.read(l);d&&c.add(d.onDidAccept(()=>{s=!0}))})),e}getNewUserType(){return this._storageService.get("inlineEditsGutterIndicatorUserKind",-1,UserKind.FirstTime)}setNewUserType(e){switch(e){case UserKind.FirstTime:throw new BugIndicatingError("UserKind should not be set to first time");case UserKind.SecondTime:break;case UserKind.Active:this._disposables.clear();break}this._storageService.store("inlineEditsGutterIndicatorUserKind",e,-1,0)}_initializeDebugSetting(){const e="editor.inlineSuggest.edits.resetNewUserExperience";return this._configurationService.getValue(e)&&this._storageService.remove("inlineEditsGutterIndicatorUserKind",-1),this._configurationService.onDidChangeConfiguration(s=>{s.affectsConfiguration(e)&&this._configurationService.getValue(e)&&(this._storageService.remove("inlineEditsGutterIndicatorUserKind",-1),this._disposables.value=this.setupNewUserExperience())})}};InlineEditsOnboardingExperience=__decorate$1a([__param$19(4,IStorageService),__param$19(5,IConfigurationService)],InlineEditsOnboardingExperience);var __decorate$19=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$18=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let InlineEditsCollapsedView=class extends Disposable{constructor(e,t,s){super(),this._editor=e,this._edit=t,this._accessibilityService=s,this._onDidClick=this._register(new Emitter$1),this.onDidClick=this._onDidClick.event,this._iconRef=n.ref(),this.isHovered=constObservable(!1),this._editorObs=observableCodeEditor(this._editor);const r=this._edit.map(u=>(u==null?void 0:u.edit.replacements[0])??null).map(u=>u?singleTextRemoveCommonPrefix(u,this._editor.getModel()).range.getStartPosition():null),l=this._editorObs.observePosition(r,this._store),c=derived(u=>{const g=l.read(u);if(!g)return null;const f=this._editorObs.layoutInfoContentLeft.read(u),p=this._editorObs.scrollLeft.read(u);return new Point(f+g.x-p,g.y)}),d=n.div({class:"inline-edits-collapsed-view",style:{position:"absolute",overflow:"visible",top:"0px",left:"0px",display:"block"}},[[this.getCollapsedIndicator(c)]]).keepUpdated(this._store).element;this._register(this._editorObs.createOverlayWidget({domNode:d,position:constObservable(null),allowEditorOverflow:!1,minContentWidthInPx:constObservable(0)})),this.isVisible=this._edit.map((u,g)=>!!u&&c.read(g)!==null)}triggerAnimation(){return this._accessibilityService.isMotionReduced()?new Animation(null,null).finished:this._iconRef.element.animate([{offset:0,transform:"translateY(-3px)"},{offset:.2,transform:"translateY(1px)"},{offset:.36,transform:"translateY(-1px)"},{offset:.52,transform:"translateY(1px)"},{offset:.68,transform:"translateY(-1px)"},{offset:.84,transform:"translateY(1px)"},{offset:1,transform:"translateY(0px)"}],{duration:2e3}).finished}getCollapsedIndicator(e){const t=this._editorObs.layoutInfoContentLeft,s=e.map((r,l)=>r?r.deltaX(-t.read(l)):null),o=this.createIconPath(s);return n.svg({class:"collapsedView",ref:this._iconRef,style:{position:"absolute",...rectToProps(r=>getEditorValidOverlayRect(this._editorObs).read(r)),overflow:"hidden",pointerEvents:"none"}},[n.svgElem("path",{class:"collapsedViewPath",d:o,fill:asCssVariable(inlineEditIndicatorPrimaryBorder)})])}createIconPath(e){return e.map(r=>{if(!r)return new PathBuilder().build();const l=r.deltaX(-6/2).deltaY(-1),c=l.deltaX(6),d=l.deltaY(1),u=c.deltaY(1),g=d.deltaX(6/2).deltaY(3);return new PathBuilder().moveTo(l).lineTo(c).lineTo(u).lineTo(g).lineTo(d).lineTo(l).build()})}};InlineEditsCollapsedView=__decorate$19([__param$18(2,IAccessibilityService)],InlineEditsCollapsedView);var __decorate$18=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$17=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const MIN_END_OF_LINE_PADDING=14,PADDING_VERTICALLY=0,PADDING_HORIZONTALLY=4,HORIZONTAL_OFFSET_WHEN_ABOVE_BELOW=4,VERTICAL_OFFSET_WHEN_ABOVE_BELOW=2;let InlineEditsCustomView=class extends Disposable{constructor(e,t,s,o,r){super(),this._editor=e,this._languageService=r,this._onDidClick=this._register(new Emitter$1),this.onDidClick=this._onDidClick.event,this._isHovered=observableValue(this,!1),this.isHovered=this._isHovered,this._viewRef=n.ref(),this._editorObs=observableCodeEditor(this._editor);const l=s.map((g,f)=>{let p;switch(g){case InlineEditTabAction.Inactive:p=inlineEditIndicatorSecondaryBackground;break;case InlineEditTabAction.Jump:p=inlineEditIndicatorPrimaryBackground;break;case InlineEditTabAction.Accept:p=inlineEditIndicatorsuccessfulBackground;break}return{border:getEditorBlendedColor(p,o).read(f).toString(),background:asCssVariable(editorBackground)}}),c=t.map(g=>g?this.getState(g):void 0),d=c.map(g=>g?this.getRendering(g,l):void 0);this.minEditorScrollHeight=derived(this,g=>{const f=c.read(g);return f?f.rect.read(g).bottom+this._editor.getScrollTop():0});const u=n.div({class:"inline-edits-custom-view",style:{position:"absolute",overflow:"visible",top:"0px",left:"0px",display:"block"}},[d]).keepUpdated(this._store);this._register(this._editorObs.createOverlayWidget({domNode:u.element,position:constObservable(null),allowEditorOverflow:!1,minContentWidthInPx:derivedObservableWithCache(this,(g,f)=>{const p=c.read(g);if(!p)return f??0;const m=p.rect.map(_=>_.right).read(g)+this._editorObs.layoutInfoVerticalScrollbarWidth.read(g)+PADDING_HORIZONTALLY-this._editorObs.layoutInfoContentLeft.read(g);return Math.max(f??0,m)}).recomputeInitiallyAndOnChange(this._store)})),this._register(autorun(g=>{if(!d.read(g)){this._isHovered.set(!1,void 0);return}this._isHovered.set(u.isHovered.read(g),void 0)}))}fitsInsideViewport(e,t,s){const o=this._editorObs.layoutInfoWidth.read(s),r=this._editorObs.layoutInfoContentLeft.read(s),l=this._editor.getLayoutInfo().verticalScrollbarWidth,c=this._editorObs.layoutInfoMinimap.read(s).minimapLeft!==0?this._editorObs.layoutInfoMinimap.read(s).minimapWidth:0,d=maxContentWidthInRange(this._editorObs,e,void 0),u=getContentRenderWidth(t,this._editor,this._editor.getModel()),g=PADDING_HORIZONTALLY+MIN_END_OF_LINE_PADDING;return d+u+g<o-r-l-c}getState(e){const t=derived(this,c=>{var S;const d=e.range.startLineNumber,u=e.range.endLineNumber,g=e.range.startColumn,f=e.range.endColumn,p=((S=this._editor.getModel())==null?void 0:S.getLineCount())??0,m=maxContentWidthInRange(this._editorObs,new LineRange(d,d+1),c),_=d+1<=p?maxContentWidthInRange(this._editorObs,new LineRange(d+1,d+2),c):void 0,C=d-1>=1?maxContentWidthInRange(this._editorObs,new LineRange(d-1,d),c):void 0,b=this._editor.getOffsetForColumn(d,g),v=this._editor.getOffsetForColumn(u,f);return{lineWidth:m,lineWidthBelow:_,lineWidthAbove:C,startContentLeftOffset:b,endContentLeftOffset:v}}),s=e.range.startLineNumber,o=e.range.endLineNumber,r=this.fitsInsideViewport(new LineRange(s,o+1),e.label,void 0);return{rect:derived(this,c=>{const d=this._editorObs.getOption(59).read(c).typicalHalfwidthCharacterWidth,{lineWidth:u,lineWidthBelow:g,lineWidthAbove:f,startContentLeftOffset:p,endContentLeftOffset:m}=t.read(c),_=this._editorObs.layoutInfoContentLeft.read(c),C=this._editorObs.observeLineHeightForLine(s).recomputeInitiallyAndOnChange(c.store).read(c),b=this._editorObs.scrollTop.read(c),v=this._editorObs.scrollLeft.read(c);let S;s===o&&m+5*d>=u&&r?S="end":g!==void 0&&g+MIN_END_OF_LINE_PADDING-HORIZONTAL_OFFSET_WHEN_ABOVE_BELOW-PADDING_HORIZONTALLY<p?S="below":f!==void 0&&f+MIN_END_OF_LINE_PADDING-HORIZONTAL_OFFSET_WHEN_ABOVE_BELOW-PADDING_HORIZONTALLY<p?S="above":S="end";let y,w,L=0,x=0;switch(S){case"end":{y=this._editorObs.editor.getTopForLineNumber(s),w=u,L=PADDING_HORIZONTALLY+MIN_END_OF_LINE_PADDING;break}case"below":{y=this._editorObs.editor.getTopForLineNumber(s+1),w=p,L=PADDING_HORIZONTALLY+HORIZONTAL_OFFSET_WHEN_ABOVE_BELOW,x=PADDING_VERTICALLY+VERTICAL_OFFSET_WHEN_ABOVE_BELOW;break}case"above":{y=this._editorObs.editor.getTopForLineNumber(s-1),w=p,L=PADDING_HORIZONTALLY+HORIZONTAL_OFFSET_WHEN_ABOVE_BELOW,x=-PADDING_VERTICALLY+VERTICAL_OFFSET_WHEN_ABOVE_BELOW;break}}return Rect.fromLeftTopWidthHeight(_+w-v,y-b,d*e.label.length,C).withMargin(PADDING_VERTICALLY,PADDING_HORIZONTALLY).translateX(L).translateY(x)}),label:e.label,kind:e.kind}}getRendering(e,t){var d;const s=document.createElement("div"),o=(d=this._editor.getModel().tokenization.tokenizeLinesAt(1,[e.label]))==null?void 0:d[0];let r;o&&e.kind===InlineCompletionDisplayLocationKind$1.Code?r=TokenArray.fromLineTokens(o).toLineTokens(e.label,this._languageService.languageIdCodec):r=LineTokens.createEmpty(e.label,this._languageService.languageIdCodec);const l=renderLines$1(new LineSource([r]),RenderOptions.fromEditor(this._editor).withSetWidth(!1).withScrollBeyondLastColumn(0),[],s,!0);s.style.width=`${l.minWidthInPx}px`;const c=e.rect.map(u=>u.withMargin(0,PADDING_HORIZONTALLY));return n.div({class:"collapsedView",ref:this._viewRef,style:{position:"absolute",...rectToProps(u=>c.read(u)),overflow:"hidden",boxSizing:"border-box",cursor:"pointer",border:t.map(u=>`1px solid ${u.border}`),borderRadius:"4px",backgroundColor:t.map(u=>u.background),display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap"},onmousedown:u=>{u.preventDefault()},onclick:u=>{this._onDidClick.fire(new StandardMouseEvent(getWindow(u),u))}},[s])}};InlineEditsCustomView=__decorate$18([__param$17(3,IThemeService),__param$17(4,ILanguageService)],InlineEditsCustomView);const HORIZONTAL_PADDING$1=0,VERTICAL_PADDING$1=0,BORDER_WIDTH$3=1,WIDGET_SEPARATOR_WIDTH$2=1,WIDGET_SEPARATOR_DIFF_EDITOR_WIDTH$2=3,BORDER_RADIUS$2=4;class InlineEditsDeletionView extends Disposable{constructor(e,t,s,o){super(),this._editor=e,this._edit=t,this._uiState=s,this._tabAction=o,this._onDidClick=this._register(new Emitter$1),this.onDidClick=this._onDidClick.event,this._display=derived(this,c=>this._uiState.read(c)?"block":"none"),this._editorMaxContentWidthInRange=derived(this,c=>{const d=this._originalDisplayRange.read(c);return d?(this._editorObs.versionId.read(c),derivedObservableWithCache(this,(u,g)=>{const f=maxContentWidthInRange(this._editorObs,d,u);return Math.max(f,g??0)})):constObservable(0)}).map((c,d)=>c.read(d)),this._maxPrefixTrim=derived(this,c=>{const d=this._uiState.read(c);return d?getPrefixTrim(d.deletions,d.originalRange,[],this._editor):{prefixTrim:0,prefixLeftOffset:0}}),this._editorLayoutInfo=derived(this,c=>{const d=this._edit.read(c);if(!d||!this._uiState.read(c))return null;const g=this._editorObs.layoutInfo.read(c),f=this._editorObs.scrollLeft.read(c),p=this._editorObs.getOption(59).map(y=>y.typicalHalfwidthCharacterWidth).read(c),m=g.contentLeft+Math.max(this._editorMaxContentWidthInRange.read(c),p)-f,_=d.originalLineRange,C=this._originalVerticalStartPosition.read(c)??this._editor.getTopForLineNumber(_.startLineNumber)-this._editorObs.scrollTop.read(c),b=this._originalVerticalEndPosition.read(c)??this._editor.getTopForLineNumber(_.endLineNumberExclusive)-this._editorObs.scrollTop.read(c),v=g.contentLeft+this._maxPrefixTrim.read(c).prefixLeftOffset-f;return m<=v?null:{codeRect:Rect.fromLeftTopRightBottom(v,C,m,b).withMargin(VERTICAL_PADDING$1,HORIZONTAL_PADDING$1),contentLeft:g.contentLeft}}).recomputeInitiallyAndOnChange(this._store),this._originalOverlay=n.div({style:{pointerEvents:"none"}},derived(this,c=>{const d=mapOutFalsy(this._editorLayoutInfo).read(c);if(!d)return;const u=d.map(m=>Rect.fromLeftTopRightBottom(m.contentLeft-BORDER_RADIUS$2-BORDER_WIDTH$3,m.codeRect.top,m.contentLeft,m.codeRect.bottom)),g=derived(this,m=>{const _=d.read(m).codeRect,C=u.read(m);return _.intersectHorizontal(new OffsetRange(C.left,Number.MAX_SAFE_INTEGER))}),f=this._uiState.map(m=>m!=null&&m.inDiffEditor?WIDGET_SEPARATOR_DIFF_EDITOR_WIDTH$2:WIDGET_SEPARATOR_WIDTH$2).read(c),p=g.map(m=>m.withMargin(f,f));return[n.div({class:"originalSeparatorDeletion",style:{...p.read(c).toStyles(),borderRadius:`${BORDER_RADIUS$2}px`,border:`${BORDER_WIDTH$3+f}px solid ${asCssVariable(editorBackground)}`,boxSizing:"border-box"}}),n.div({class:"originalOverlayDeletion",style:{...g.read(c).toStyles(),borderRadius:`${BORDER_RADIUS$2}px`,border:getOriginalBorderColor(this._tabAction).map(m=>`${BORDER_WIDTH$3}px solid ${asCssVariable(m)}`),boxSizing:"border-box",backgroundColor:asCssVariable(originalBackgroundColor)}}),n.div({class:"originalOverlayHiderDeletion",style:{...u.read(c).toStyles(),backgroundColor:asCssVariable(editorBackground)}})]})).keepUpdated(this._store),this._nonOverflowView=n.div({class:"inline-edits-view",style:{position:"absolute",overflow:"visible",top:"0px",left:"0px",display:this._display}},[[this._originalOverlay]]).keepUpdated(this._store),this.isHovered=constObservable(!1),this._editorObs=observableCodeEditor(this._editor);const r=derived(this,c=>{const d=this._edit.read(c);return d?new Position$1(d.originalLineRange.startLineNumber,1):null}),l=derived(this,c=>{const d=this._edit.read(c);return d?new Position$1(d.originalLineRange.endLineNumberExclusive,1):null});this._originalDisplayRange=this._uiState.map(c=>c==null?void 0:c.originalRange),this._originalVerticalStartPosition=this._editorObs.observePosition(r,this._store).map(c=>c==null?void 0:c.y),this._originalVerticalEndPosition=this._editorObs.observePosition(l,this._store).map(c=>c==null?void 0:c.y),this._register(this._editorObs.createOverlayWidget({domNode:this._nonOverflowView.element,position:constObservable(null),allowEditorOverflow:!1,minContentWidthInPx:derived(this,c=>{const d=this._editorLayoutInfo.read(c);return d===null?0:d.codeRect.width})}))}}var __decorate$17=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$16=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const BORDER_WIDTH$2=1,WIDGET_SEPARATOR_WIDTH$1=1,WIDGET_SEPARATOR_DIFF_EDITOR_WIDTH$1=3,BORDER_RADIUS$1=4;let InlineEditsInsertionView=class extends Disposable{constructor(e,t,s,o,r){super(),this._editor=e,this._input=t,this._tabAction=s,this._languageService=r,this._onDidClick=this._register(new Emitter$1),this.onDidClick=this._onDidClick.event,this._state=derived(this,l=>{const c=this._input.read(l);if(!c)return;const d=this._editor.getModel(),u=d.getEOL();if(c.startColumn===1&&c.lineNumber>1&&d.getLineLength(c.lineNumber)!==0&&c.text.endsWith(u)&&!c.text.startsWith(u)){const g=d.getLineLength(c.lineNumber-1)+1;return{lineNumber:c.lineNumber-1,column:g,text:u+c.text.slice(0,-u.length)}}return{lineNumber:c.lineNumber,column:c.startColumn,text:c.text}}),this._trimVertically=derived(this,l=>{const c=this._state.read(l),d=c==null?void 0:c.text;if(!d||d.trim()==="")return{topOffset:0,bottomOffset:0,linesTop:0,linesBottom:0};const u=this._editor.getLineHeightForPosition(new Position$1(c.lineNumber,1)),g=this._editor.getModel().getEOL();let f=0,p=0,m=0;for(;m<d.length&&d.startsWith(g,m);m+=g.length)f+=1;for(let _=d.length;_>m&&d.endsWith(g,_);_-=g.length)p+=1;return{topOffset:f*u,bottomOffset:p*u,linesTop:f,linesBottom:p}}),this._maxPrefixTrim=derived(this,l=>{const c=this._state.read(l);if(!c)return{prefixLeftOffset:0,prefixTrim:0};const d=this._editor.getModel(),u=d.getEOL(),g=this._trimVertically.read(l),f=c.text.split(u),p=f.slice(g.linesTop,f.length-g.linesBottom);g.linesTop===0&&(p[0]=d.getLineContent(c.lineNumber)+p[0]);const m=new LineRange(c.lineNumber,c.lineNumber+(g.linesTop>0?0:1));return getPrefixTrim([],m,p,this._editor)}),this._ghostText=derived(l=>{const c=this._state.read(l),d=this._maxPrefixTrim.read(l);if(!c)return;const g=this._editor.getModel().getEOL(),p=c.text.split(g).map((m,_)=>new InlineDecoration(new Range$2(_+1,_===0?1:d.prefixTrim+1,_+1,m.length+1),"modified-background",0));return new GhostText(c.lineNumber,[new GhostTextPart(c.column,c.text,!1,p)])}),this._display=derived(this,l=>this._state.read(l)?"block":"none"),this._editorMaxContentWidthInRange=derived(this,l=>{const c=this._state.read(l);if(!c)return 0;this._editorObs.versionId.read(l);const d=this._editor.getModel(),u=d.getEOL(),g=c.text.startsWith(u)?"":d.getValueInRange(new Range$2(c.lineNumber,1,c.lineNumber,c.column)),f=d.getValueInRange(new Range$2(c.lineNumber,c.column,c.lineNumber,d.getLineLength(c.lineNumber)+1)),m=(g+c.text+f).split(u),_=RenderOptions.fromEditor(this._editor).withSetWidth(!1).withScrollBeyondLastColumn(0),C=m.map(b=>{var y;const v=(y=d.tokenization.tokenizeLinesAt(c.lineNumber,[b]))==null?void 0:y[0];let S;return v?S=TokenArray.fromLineTokens(v).toLineTokens(b,this._languageService.languageIdCodec):S=LineTokens.createEmpty(b,this._languageService.languageIdCodec),renderLines$1(new LineSource([S]),_,[],$$l("div"),!0).minWidthInPx});return Math.max(...C)}),this.startLineOffset=this._trimVertically.map(l=>l.topOffset),this.originalLines=this._state.map(l=>l?new LineRange(l.lineNumber,Math.min(l.lineNumber+2,this._editor.getModel().getLineCount()+1)):void 0),this._overlayLayout=derived(this,l=>{this._ghostText.read(l);const c=this._state.read(l);if(!c)return null;this._editorObs.observePosition(observableValue(this,new Position$1(c.lineNumber,c.column)),l.store).read(l);const d=this._editorObs.layoutInfo.read(l),u=this._editorObs.scrollLeft.read(l),g=this._editorObs.layoutInfoVerticalScrollbarWidth.read(l),f=d.contentLeft+this._editorMaxContentWidthInRange.read(l)-u,p=this._maxPrefixTrim.read(l).prefixLeftOffset??0,m=d.contentLeft+p-u;if(f<=m)return null;const{topOffset:_,bottomOffset:C}=this._trimVertically.read(l),b=this._editorObs.scrollTop.read(l),v=this._ghostTextView.height.read(l)-_-C,S=this._editor.getTopForLineNumber(c.lineNumber)-b+_,y=S+v,w=new Rect(m,S,f,y);return{overlay:w,startsAtContentLeft:p===0,contentLeft:d.contentLeft,minContentWidthRequired:p+w.width+g}}).recomputeInitiallyAndOnChange(this._store),this._modifiedOverlay=n.div({style:{pointerEvents:"none"}},derived(this,l=>{const c=mapOutFalsy(this._overlayLayout).read(l);if(!c)return;const d=c.map(p=>Rect.fromLeftTopRightBottom(p.contentLeft-BORDER_RADIUS$1-BORDER_WIDTH$2,p.overlay.top,p.contentLeft,p.overlay.bottom)).read(l),u=this._input.map(p=>p!=null&&p.inDiffEditor?WIDGET_SEPARATOR_DIFF_EDITOR_WIDTH$1:WIDGET_SEPARATOR_WIDTH$1).read(l),g=c.map(p=>p.overlay.withMargin(0,BORDER_WIDTH$2,0,p.startsAtContentLeft?0:BORDER_WIDTH$2).intersectHorizontal(new OffsetRange(d.left,Number.MAX_SAFE_INTEGER))),f=g.map(p=>p.withMargin(u,u));return[n.div({class:"originalUnderlayInsertion",style:{...f.read(l).toStyles(),borderRadius:BORDER_RADIUS$1,border:`${BORDER_WIDTH$2+u}px solid ${asCssVariable(editorBackground)}`,boxSizing:"border-box"}}),n.div({class:"originalOverlayInsertion",style:{...g.read(l).toStyles(),borderRadius:BORDER_RADIUS$1,border:getModifiedBorderColor(this._tabAction).map(p=>`${BORDER_WIDTH$2}px solid ${asCssVariable(p)}`),boxSizing:"border-box",backgroundColor:asCssVariable(modifiedBackgroundColor)}}),n.div({class:"originalOverlayHiderInsertion",style:{...d.toStyles(),backgroundColor:asCssVariable(editorBackground)}})]})).keepUpdated(this._store),this._view=n.div({class:"inline-edits-view",style:{position:"absolute",overflow:"visible",top:"0px",left:"0px",display:this._display}},[[this._modifiedOverlay]]).keepUpdated(this._store),this._editorObs=observableCodeEditor(this._editor),this._ghostTextView=this._register(o.createInstance(GhostTextView,this._editor,{ghostText:this._ghostText,minReservedLineCount:constObservable(0),targetTextModel:this._editorObs.model.map(l=>l??void 0),warning:constObservable(void 0),handleInlineCompletionShown:constObservable(()=>{})},observableValue(this,{syntaxHighlightingEnabled:!0,extraClasses:["inline-edit"]}),!0,!0)),this.isHovered=this._ghostTextView.isHovered,this._register(this._ghostTextView.onDidClick(l=>{this._onDidClick.fire(l)})),this._register(this._editorObs.createOverlayWidget({domNode:this._view.element,position:constObservable(null),allowEditorOverflow:!1,minContentWidthInPx:derived(this,l=>{const c=this._overlayLayout.read(l);return c===null?0:c.minContentWidthRequired})}))}};InlineEditsInsertionView=__decorate$17([__param$16(3,IInstantiationService),__param$16(4,ILanguageService)],InlineEditsInsertionView);var __decorate$16=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$15=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let InlineEditsLineReplacementView=class extends Disposable{constructor(e,t,s,o,r,l){super(),this._editor=e,this._edit=t,this._isInDiffEditor=s,this._tabAction=o,this._languageService=r,this._themeService=l,this._onDidClick=this._register(new Emitter$1),this.onDidClick=this._onDidClick.event,this._maxPrefixTrim=this._edit.map(c=>c?getPrefixTrim(c.replacements.flatMap(d=>[d.originalRange,d.modifiedRange]),c.originalRange,c.modifiedLines,this._editor.editor):void 0),this._modifiedLineElements=derived(this,c=>{var b;const d=[];let u=0;const g=this._maxPrefixTrim.read(c),f=this._edit.read(c);if(!f||!g)return;const p=g.prefixTrim,m=rangesToBubbleRanges(f.replacements.map(v=>v.modifiedRange)).map(v=>new Range$2(v.startLineNumber,v.startColumn-p,v.endLineNumber,v.endColumn-p)),_=this._editor.model.get(),C=f.modifiedRange.startLineNumber;for(let v=0;v<f.modifiedRange.length;v++){const S=document.createElement("div"),y=C+v,w=f.modifiedLines[v].slice(p),L=(b=_.tokenization.tokenizeLinesAt(y,[w]))==null?void 0:b[0];let x;L?x=TokenArray.fromLineTokens(L).toLineTokens(w,this._languageService.languageIdCodec):x=LineTokens.createEmpty(w,this._languageService.languageIdCodec);const E=[];for(const D of m.filter(k=>k.startLineNumber===y)){const k=Math.min(D.endColumn,w.length+1);E.push(new InlineDecoration(new Range$2(1,D.startColumn,1,k),"inlineCompletions-modified-bubble",0))}const I=renderLines$1(new LineSource([x]),RenderOptions.fromEditor(this._editor.editor).withSetWidth(!1).withScrollBeyondLastColumn(0),E,S,!0);this._editor.getOption(59).read(c),u=Math.max(u,I.minWidthInPx),d.push(S)}return{lines:d,requiredWidth:u}}),this._layout=derived(this,c=>{const d=this._modifiedLineElements.read(c),u=this._maxPrefixTrim.read(c),g=this._edit.read(c);if(!d||!u||!g)return;const{prefixLeftOffset:f}=u,{requiredWidth:p}=d,m=this._editor.observeLineHeightsForLineRange(g.originalRange).read(c),_=(()=>{const P=m.slice(0,g.modifiedRange.length);for(;P.length<g.modifiedRange.length;)P.push(m[m.length-1]);return P})(),C=this._editor.layoutInfoContentLeft.read(c),b=this._editor.layoutInfoVerticalScrollbarWidth.read(c),v=this._editor.scrollLeft.read(c),S=this._editor.scrollTop.read(c),y=C-v,w=this._editor.editor.getModel(),L=g.originalRange.mapToLineArray(P=>this._editor.editor.getOffsetForColumn(P,w.getLineMaxColumn(P))-f),x=Math.max(...L,p),E=g.originalRange.startLineNumber,I=g.originalRange.endLineNumberExclusive-1,D=this._editor.editor.getTopForLineNumber(E)-S,k=this._editor.editor.getBottomForLineNumber(I)-S,N=Rect.fromLeftTopWidthHeight(y+f,D,x,k-D),R=Rect.fromLeftTopWidthHeight(N.left,N.bottom,N.width,_.reduce((P,W)=>P+W,0)),M=Rect.hull([N,R]),A=M.intersectVertical(new OffsetRange(N.bottom,Number.MAX_SAFE_INTEGER)),O=new Rect(A.left,A.top,A.right,A.bottom);return{originalLinesOverlay:N,modifiedLinesOverlay:R,background:M,lowerBackground:A,lowerText:O,modifiedLineHeights:_,minContentWidthRequired:f+x+b}}),this._viewZoneInfo=derived(c=>{if(!this._editor.getOption(71).map(m=>m.edits.allowCodeShifting==="always").read(c))return;const u=this._layout.read(c),g=this._edit.read(c);if(!u||!g)return;const f=u.lowerBackground.height,p=g.originalRange.endLineNumberExclusive;return{height:f,lineNumber:p}}),this.minEditorScrollHeight=derived(this,c=>{const d=mapOutFalsy(this._layout).read(c);return!d||this._viewZoneInfo.read(c)!==void 0?0:d.read(c).lowerText.bottom+this._editor.editor.getScrollTop()}),this._div=n.div({class:"line-replacement"},[derived(this,c=>{const d=mapOutFalsy(this._layout).read(c),u=this._modifiedLineElements.read(c);if(!d||!u)return[];const g=d.read(c),f=this._editor.layoutInfoContentLeft.read(c),p=this._isInDiffEditor.read(c)?3:1;u.lines.forEach((C,b)=>{C.style.width=`${g.lowerText.width}px`,C.style.height=`${g.modifiedLineHeights[b]}px`,C.style.position="relative"});const m=getModifiedBorderColor(this._tabAction).read(c),_=getOriginalBorderColor(this._tabAction).read(c);return[n.div({style:{position:"absolute",...rectToProps(C=>getEditorValidOverlayRect(this._editor).read(C)),overflow:"hidden",pointerEvents:"none"}},[n.div({class:"borderAroundLineReplacement",style:{position:"absolute",...rectToProps(C=>d.read(C).background.translateX(-f).withMargin(p)),borderRadius:"4px",border:`${p+1}px solid ${asCssVariable(editorBackground)}`,boxSizing:"border-box",pointerEvents:"none"}}),n.div({class:"originalOverlayLineReplacement",style:{position:"absolute",...rectToProps(C=>d.read(C).background.translateX(-f)),borderRadius:"4px",border:getEditorBlendedColor(_,this._themeService).map(C=>`1px solid ${C.toString()}`),pointerEvents:"none",boxSizing:"border-box",background:asCssVariable(originalBackgroundColor)}}),n.div({class:"modifiedOverlayLineReplacement",style:{position:"absolute",...rectToProps(C=>d.read(C).lowerBackground.translateX(-f)),borderRadius:"0 0 4px 4px",background:asCssVariable(editorBackground),boxShadow:`${asCssVariable(scrollbarShadow)} 0 6px 6px -6px`,border:`1px solid ${asCssVariable(m)}`,boxSizing:"border-box",overflow:"hidden",cursor:"pointer",pointerEvents:"auto"},onmousedown:C=>{C.preventDefault()},onclick:C=>this._onDidClick.fire(new StandardMouseEvent(getWindow(C),C))},[n.div({style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:asCssVariable(modifiedChangedLineBackgroundColor)}})]),n.div({class:"modifiedLinesLineReplacement",style:{position:"absolute",boxSizing:"border-box",...rectToProps(C=>d.read(C).lowerText.translateX(-f)),fontFamily:this._editor.getOption(58),fontSize:this._editor.getOption(61),fontWeight:this._editor.getOption(62),pointerEvents:"none",whiteSpace:"nowrap",borderRadius:"0 0 4px 4px",overflow:"hidden"}},[...u.lines])])]})]).keepUpdated(this._store),this.isHovered=this._editor.isTargetHovered(c=>this._isMouseOverWidget(c),this._store),this._previousViewZoneInfo=void 0,this._register(toDisposable(()=>this._editor.editor.changeViewZones(c=>this.removePreviousViewZone(c)))),this._register(autorunDelta(this._viewZoneInfo,({lastValue:c,newValue:d})=>{c===d||(c==null?void 0:c.height)===(d==null?void 0:d.height)&&(c==null?void 0:c.lineNumber)===(d==null?void 0:d.lineNumber)||this._editor.editor.changeViewZones(u=>{this.removePreviousViewZone(u),d&&this.addViewZone(d,u)})})),this._register(this._editor.createOverlayWidget({domNode:this._div.element,minContentWidthInPx:derived(this,c=>{var d;return((d=this._layout.read(c))==null?void 0:d.minContentWidthRequired)??0}),position:constObservable({preference:{top:0,left:0}}),allowEditorOverflow:!1}))}_isMouseOverWidget(e){const t=this._layout.get();return!t||!(e.event instanceof EditorMouseEvent)?!1:t.lowerBackground.containsPoint(new Point(e.event.relativePos.x,e.event.relativePos.y))}removePreviousViewZone(e){if(!this._previousViewZoneInfo)return;e.removeZone(this._previousViewZoneInfo.id);const t=this._editor.cursorLineNumber.get();t!==null&&t>=this._previousViewZoneInfo.lineNumber&&this._editor.editor.setScrollTop(this._editor.scrollTop.get()-this._previousViewZoneInfo.height),this._previousViewZoneInfo=void 0}addViewZone(e,t){const s=t.addZone({afterLineNumber:e.lineNumber-1,heightInPx:e.height,domNode:$$l("div")});this._previousViewZoneInfo={height:e.height,lineNumber:e.lineNumber,id:s};const o=this._editor.cursorLineNumber.get();o!==null&&o>=e.lineNumber&&this._editor.editor.setScrollTop(this._editor.scrollTop.get()+e.height)}};InlineEditsLineReplacementView=__decorate$16([__param$15(4,ILanguageService),__param$15(5,IThemeService)],InlineEditsLineReplacementView);function rangesToBubbleRanges(a){const e=[];for(;a.length;){let t=a.shift();t.startLineNumber!==t.endLineNumber&&(a.push(new Range$2(t.startLineNumber+1,1,t.endLineNumber,t.endColumn)),t=new Range$2(t.startLineNumber,t.startColumn,t.startLineNumber,Number.MAX_SAFE_INTEGER)),e.push(t)}return e}var __decorate$15=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$14=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const HORIZONTAL_PADDING=0,VERTICAL_PADDING=0,BORDER_WIDTH$1=1,WIDGET_SEPARATOR_WIDTH=1,WIDGET_SEPARATOR_DIFF_EDITOR_WIDTH=3,BORDER_RADIUS=4,ORIGINAL_END_PADDING=20,MODIFIED_END_PADDING=12;let InlineEditsSideBySideView=class extends Disposable{static fitsInsideViewport(e,t,s,o){const r=observableCodeEditor(e),l=r.layoutInfoWidth.read(o),c=r.layoutInfoContentLeft.read(o),d=e.getLayoutInfo().verticalScrollbarWidth,u=r.layoutInfoMinimap.read(o).minimapLeft!==0?r.layoutInfoMinimap.read(o).minimapWidth:0,g=maxContentWidthInRange(r,s.displayRange,void 0),f=s.lineEdit.newLines.reduce((_,C)=>Math.max(_,getContentRenderWidth(C,e,t)),0),p=ORIGINAL_END_PADDING,m=MODIFIED_END_PADDING+2*BORDER_WIDTH$1;return g+f+p+m<l-c-d-u}constructor(e,t,s,o,r,l,c){super(),this._editor=e,this._edit=t,this._previewTextModel=s,this._uiState=o,this._tabAction=r,this._instantiationService=l,this._themeService=c,this._editorObs=observableCodeEditor(this._editor),this._onDidClick=this._register(new Emitter$1),this.onDidClick=this._onDidClick.event,this._display=derived(this,u=>this._uiState.read(u)?"block":"none"),this.previewRef=n.ref();const d=this._uiState.map(u=>u!=null&&u.isInDiffEditor?WIDGET_SEPARATOR_DIFF_EDITOR_WIDTH:WIDGET_SEPARATOR_WIDTH);this._editorContainer=n.div({class:["editorContainer"],style:{position:"absolute",overflow:"hidden",cursor:"pointer"},onmousedown:u=>{u.preventDefault()},onclick:u=>{this._onDidClick.fire(new StandardMouseEvent(getWindow(u),u))}},[n.div({class:"preview",style:{pointerEvents:"none"},ref:this.previewRef})]).keepUpdated(this._store),this.isHovered=this._editorContainer.didMouseMoveDuringHover,this.previewEditor=this._register(this._instantiationService.createInstance(EmbeddedCodeEditorWidget,this.previewRef.element,{glyphMargin:!1,lineNumbers:"off",minimap:{enabled:!1},guides:{indentation:!1,bracketPairs:!1,bracketPairsHorizontal:!1,highlightActiveIndentation:!1},rulers:[],padding:{top:0,bottom:0},folding:!1,selectOnLineNumbers:!1,selectionHighlight:!1,columnSelection:!1,overviewRulerBorder:!1,overviewRulerLanes:0,lineDecorationsWidth:0,lineNumbersMinChars:0,revealHorizontalRightPadding:0,bracketPairColorization:{enabled:!0,independentColorPoolPerBracketType:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"hidden",horizontal:"hidden",handleMouseWheel:!1},readOnly:!0,wordWrap:"off",wordWrapOverride1:"off",wordWrapOverride2:"off"},{contextKeyValues:{[InlineCompletionContextKeys.inInlineEditsPreviewEditor.key]:!0},contributions:[]},this._editor)),this._previewEditorObs=observableCodeEditor(this.previewEditor),this._activeViewZones=[],this._updatePreviewEditor=derived(this,u=>{this._editorContainer.readEffect(u),this._previewEditorObs.model.read(u),this._display.read(u),this._nonOverflowView&&(this._nonOverflowView.element.style.display=this._display.read(u));const g=this._uiState.read(u),f=this._edit.read(u);if(!g||!f)return;const p=f.originalLineRange,m=[];p.startLineNumber>1&&m.push(new Range$2(1,1,p.startLineNumber-1,1)),p.startLineNumber+g.newTextLineCount<this._previewTextModel.getLineCount()+1&&m.push(new Range$2(p.startLineNumber+g.newTextLineCount,1,this._previewTextModel.getLineCount()+1,1)),this.previewEditor.setHiddenAreas(m,void 0,!0);const _=[...this._activeViewZones];this._activeViewZones=[];const C=p.endLineNumberExclusive-p.startLineNumber-g.newTextLineCount;this.previewEditor.changeViewZones(b=>{_.forEach(v=>b.removeZone(v)),C>0&&this._activeViewZones.push(b.addZone({afterLineNumber:p.startLineNumber+g.newTextLineCount-1,heightInLines:C,showInHiddenAreas:!0,domNode:$$l("div.diagonal-fill.inline-edits-view-zone")}))})}),this._previewEditorWidth=derived(this,u=>{const g=this._edit.read(u);return g?(this._updatePreviewEditor.read(u),maxContentWidthInRange(this._previewEditorObs,g.modifiedLineRange,u)):0}),this._cursorPosIfTouchesEdit=derived(this,u=>{const g=this._editorObs.cursorPosition.read(u),f=this._edit.read(u);if(!(!f||!g))return f.modifiedLineRange.contains(g.lineNumber)?g:void 0}),this._originalStartPosition=derived(this,u=>{const g=this._edit.read(u);return g?new Position$1(g.originalLineRange.startLineNumber,1):null}),this._originalEndPosition=derived(this,u=>{const g=this._edit.read(u);return g?new Position$1(g.originalLineRange.endLineNumberExclusive,1):null}),this._originalVerticalStartPosition=this._editorObs.observePosition(this._originalStartPosition,this._store).map(u=>u==null?void 0:u.y),this._originalVerticalEndPosition=this._editorObs.observePosition(this._originalEndPosition,this._store).map(u=>u==null?void 0:u.y),this._originalDisplayRange=this._edit.map(u=>u==null?void 0:u.displayRange),this._editorMaxContentWidthInRange=derived(this,u=>{const g=this._originalDisplayRange.read(u);return g?(this._editorObs.versionId.read(u),derivedObservableWithCache(this,(f,p)=>{const m=maxContentWidthInRange(this._editorObs,g,f);return Math.max(m,p??0)})):constObservable(0)}).map((u,g)=>u.read(g)),this._previewEditorLayoutInfo=derived(this,u=>{const g=this._edit.read(u);if(!g||!this._uiState.read(u))return null;const p=g.originalLineRange,m=this._editorObs.scrollLeft.read(u),_=this._editorMaxContentWidthInRange.read(u),C=this._editorObs.layoutInfo.read(u),b=this._previewEditorWidth.read(u),v=C.contentWidth-C.verticalScrollbarWidth,S=this._editor.getContainerDomNode().getBoundingClientRect(),y=C.contentLeft+C.contentWidth+S.left,w=getWindow(this._editor.getContainerDomNode()).innerWidth-y,L=getWindow(this._editor.getContainerDomNode()).innerWidth-S.right,x=Math.min(C.contentWidth*.3,b,100),E=0,I=E+w,D=this._cursorPosIfTouchesEdit.read(u),k=Math.max(v+m-E-Math.max(0,x-I),Math.min(D?getOffsetForPos(this._editorObs,D,u)+50:0,v+m)),N=Math.min(_+ORIGINAL_END_PADDING,k),R=_+ORIGINAL_END_PADDING+b+70,M=k-N;let A,O;N>m?(A=0,O=C.contentLeft+N-m):(A=m-N,O=C.contentLeft);const P=this._originalVerticalStartPosition.read(u)??this._editor.getTopForLineNumber(p.startLineNumber)-this._editorObs.scrollTop.read(u),W=this._originalVerticalEndPosition.read(u)??this._editor.getBottomForLineNumber(p.endLineNumberExclusive-1)-this._editorObs.scrollTop.read(u),B=C.contentLeft-m;let H=Rect.fromLeftTopRightBottom(B,P,O,W);const V=H.height===0;V||(H=H.withMargin(VERTICAL_PADDING,HORIZONTAL_PADDING));const z=this._previewEditorObs.observeLineHeightsForLineRange(g.modifiedLineRange).read(u).reduce((me,ft)=>me+ft,0),G=W-P,X=Math.max(G,z),Y=M===0,ee=0,le=Math.min(b+MODIFIED_END_PADDING,L+C.width-C.contentLeft-ee);let ne=Rect.fromLeftTopWidthHeight(H.right+ee,P,le,X);return V?ne=ne.withMargin(VERTICAL_PADDING,HORIZONTAL_PADDING).translateY(VERTICAL_PADDING):ne=ne.withMargin(VERTICAL_PADDING,HORIZONTAL_PADDING).translateX(HORIZONTAL_PADDING+BORDER_WIDTH$1),{codeRect:H,editRect:ne,codeScrollLeft:m,contentLeft:C.contentLeft,isInsertion:V,maxContentWidth:R,shouldShowShadow:Y,desiredPreviewEditorScrollLeft:A,previewEditorWidth:le}}),this._stickyScrollController=StickyScrollController.get(this._editorObs.editor),this._stickyScrollHeight=this._stickyScrollController?observableFromEvent(this._stickyScrollController.onDidChangeStickyScrollHeight,()=>this._stickyScrollController.stickyScrollWidgetHeight):constObservable(0),this._shouldOverflow=derived(this,u=>!1),this._originalBackgroundColor=observableFromEvent(this,this._themeService.onDidColorThemeChange,()=>this._themeService.getColorTheme().getColor(originalBackgroundColor)??Color.transparent),this._backgroundSvg=n.svg({transform:"translate(-0.5 -0.5)",style:{overflow:"visible",pointerEvents:"none",position:"absolute"}},[n.svgElem("path",{class:"rightOfModifiedBackgroundCoverUp",d:derived(this,u=>{const g=this._previewEditorLayoutInfo.read(u);if(!(!g||this._originalBackgroundColor.read(u).isTransparent()))return new PathBuilder().moveTo(g.codeRect.getRightTop()).lineTo(g.codeRect.getRightTop().deltaX(1e3)).lineTo(g.codeRect.getRightBottom().deltaX(1e3)).lineTo(g.codeRect.getRightBottom()).build()}),style:{fill:asCssVariableWithDefault(editorBackground,"transparent")}})]).keepUpdated(this._store),this._originalOverlay=n.div({style:{pointerEvents:"none",display:this._previewEditorLayoutInfo.map(u=>u!=null&&u.isInsertion?"none":"block")}},derived(this,u=>{const g=mapOutFalsy(this._previewEditorLayoutInfo).read(u);if(!g)return;const f=d.read(u),p=getOriginalBorderColor(this._tabAction).map(x=>`${BORDER_WIDTH$1}px solid ${asCssVariable(x)}`),m=`${BORDER_WIDTH$1+f}px solid ${asCssVariable(editorBackground)}`,_=g.read(u).codeScrollLeft!==0,C=g.map(x=>x.codeRect.bottom<x.editRect.bottom),b=BORDER_RADIUS*2+BORDER_WIDTH$1*2,v=g.map(x=>Rect.fromLeftTopRightBottom(x.contentLeft-BORDER_RADIUS-BORDER_WIDTH$1,x.codeRect.top,x.contentLeft,x.codeRect.bottom+b)).read(u),S=new OffsetRange(v.left,Number.MAX_SAFE_INTEGER),y=g.map(x=>x.codeRect.intersectHorizontal(S)),w=y.map(x=>x.withMargin(f,0,f,f).intersectHorizontal(S)),L=y.map(x=>Rect.fromLeftTopWidthHeight(x.right-b+BORDER_WIDTH$1,x.bottom-BORDER_WIDTH$1,b,b).intersectHorizontal(S));return[n.div({class:"originalSeparatorSideBySide",style:{...w.read(u).toStyles(),boxSizing:"border-box",borderRadius:`${BORDER_RADIUS}px 0 0 ${BORDER_RADIUS}px`,borderTop:m,borderBottom:m,borderLeft:_?"none":m}}),n.div({class:"originalOverlaySideBySide",style:{...y.read(u).toStyles(),boxSizing:"border-box",borderRadius:`${BORDER_RADIUS}px 0 0 ${BORDER_RADIUS}px`,borderTop:p,borderBottom:p,borderLeft:_?"none":p,backgroundColor:asCssVariable(originalBackgroundColor)}}),n.div({class:"originalCornerCutoutSideBySide",style:{pointerEvents:"none",display:C.map(x=>x?"block":"none"),...L.read(u).toStyles()}},[n.div({class:"originalCornerCutoutBackground",style:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",backgroundColor:getEditorBlendedColor(originalBackgroundColor,this._themeService).map(x=>x.toString())}}),n.div({class:"originalCornerCutoutBorder",style:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",boxSizing:"border-box",borderTop:p,borderRight:p,borderRadius:"0 100% 0 0",backgroundColor:asCssVariable(editorBackground)}})]),n.div({class:"originalOverlaySideBySideHider",style:{...v.toStyles(),backgroundColor:asCssVariable(editorBackground)}})]})).keepUpdated(this._store),this._modifiedOverlay=n.div({style:{pointerEvents:"none"}},derived(this,u=>{const g=mapOutFalsy(this._previewEditorLayoutInfo).read(u);if(!g)return;const f=g.map(y=>y.codeRect.bottom<y.editRect.bottom),p=d.read(u),m=f.map(y=>`0 ${BORDER_RADIUS}px ${BORDER_RADIUS}px ${y?BORDER_RADIUS:0}px`),_=getEditorBlendedColor(getModifiedBorderColor(this._tabAction),this._themeService).map(y=>`1px solid ${y.toString()}`),C=`${BORDER_WIDTH$1+p}px solid ${asCssVariable(editorBackground)}`,b=g.map(y=>y.editRect.withMargin(0,BORDER_WIDTH$1)),v=b.map(y=>y.withMargin(p,p,p,0)),S=derived(this,y=>{const w=b.read(y),L=g.read(y);return!L.isInsertion||L.contentLeft>=w.left?Rect.fromLeftTopWidthHeight(w.left,w.top,0,0):new Rect(L.contentLeft,w.top,w.left,w.top+BORDER_WIDTH$1*2)});return[n.div({class:"modifiedInsertionSideBySide",style:{...S.read(u).toStyles(),backgroundColor:getModifiedBorderColor(this._tabAction).map(y=>asCssVariable(y))}}),n.div({class:"modifiedSeparatorSideBySide",style:{...v.read(u).toStyles(),borderRadius:m,borderTop:C,borderBottom:C,borderRight:C,boxSizing:"border-box"}}),n.div({class:"modifiedOverlaySideBySide",style:{...b.read(u).toStyles(),borderRadius:m,border:_,boxSizing:"border-box",backgroundColor:asCssVariable(modifiedBackgroundColor)}})]})).keepUpdated(this._store),this._nonOverflowView=n.div({class:"inline-edits-view",style:{position:"absolute",overflow:"visible",top:"0px",left:"0px",display:this._display}},[this._backgroundSvg,derived(this,u=>this._shouldOverflow.read(u)?[]:[this._editorContainer,this._originalOverlay,this._modifiedOverlay])]).keepUpdated(this._store),this._register(this._editorObs.createOverlayWidget({domNode:this._nonOverflowView.element,position:constObservable(null),allowEditorOverflow:!1,minContentWidthInPx:derived(this,u=>{var f;const g=(f=this._previewEditorLayoutInfo.read(u))==null?void 0:f.maxContentWidth;return g===void 0?0:g})})),this.previewEditor.setModel(this._previewTextModel),this._register(autorun(u=>{const g=this._previewEditorLayoutInfo.read(u);if(!g)return;const f=g.editRect.withMargin(-VERTICAL_PADDING,-HORIZONTAL_PADDING);this.previewEditor.layout({height:f.height,width:g.previewEditorWidth+15}),this._editorContainer.element.style.top=`${f.top}px`,this._editorContainer.element.style.left=`${f.left}px`,this._editorContainer.element.style.width=`${g.previewEditorWidth+HORIZONTAL_PADDING}px`})),this._register(autorun(u=>{const g=this._previewEditorLayoutInfo.read(u);g&&this._previewEditorObs.editor.setScrollLeft(g.desiredPreviewEditorScrollLeft)})),this._updatePreviewEditor.recomputeInitiallyAndOnChange(this._store)}};InlineEditsSideBySideView=__decorate$15([__param$14(5,IInstantiationService),__param$14(6,IThemeService)],InlineEditsSideBySideView);var __decorate$14=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$13=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const BORDER_WIDTH=1;var On;let InlineEditsWordReplacementView=(On=class extends Disposable{constructor(e,t,s,o){super(),this._editor=e,this._edit=t,this._tabAction=s,this._languageService=o,this._onDidClick=this._register(new Emitter$1),this.onDidClick=this._onDidClick.event,this._start=this._editor.observePosition(constObservable(this._edit.range.getStartPosition()),this._store),this._end=this._editor.observePosition(constObservable(this._edit.range.getEndPosition()),this._store),this._line=document.createElement("div"),this._hoverableElement=observableValue(this,null),this.isHovered=this._hoverableElement.map((l,c)=>(l==null?void 0:l.didMouseMoveDuringHover.read(c))??!1),this._renderTextEffect=derived(this,l=>{var _;const c=this._editor.model.get(),d=c.getLineContent(this._edit.range.startLineNumber),u=StringReplacement.replace(new OffsetRange(this._edit.range.startColumn-1,this._edit.range.endColumn-1),this._edit.text),g=u.replace(d),f=(_=c.tokenization.tokenizeLinesAt(this._edit.range.startLineNumber,[g]))==null?void 0:_[0];let p;f?p=TokenArray.fromLineTokens(f).slice(u.getRangeAfterReplace()).toLineTokens(this._edit.text,this._languageService.languageIdCodec):p=LineTokens.createEmpty(this._edit.text,this._languageService.languageIdCodec);const m=renderLines$1(new LineSource([p]),RenderOptions.fromEditor(this._editor.editor).withSetWidth(!1).withScrollBeyondLastColumn(0),[],this._line,!0);this._line.style.width=`${m.minWidthInPx}px`});const r=this._editor.observeLineHeightForPosition(this._edit.range.getStartPosition());this._layout=derived(this,l=>{this._renderTextEffect.read(l);const c=this._start.read(l),d=this._end.read(l);if(!c||!d||c.x>d.x||c.y>d.y)return;const u=r.read(l),g=this._editor.scrollLeft.read(l),f=this._editor.getOption(59).read(l).typicalHalfwidthCharacterWidth,p=3*f,m=4,_=new Point(p,m),C=Rect.fromPoints(c,d).withHeight(u).translateX(-g),b=Rect.fromPointSize(C.getLeftBottom().add(_),new Point(this._edit.text.length*f,C.height)),v=b.withLeft(C.left);return{originalLine:C,modifiedLine:b,lowerBackground:v,lineHeight:u}}),this.minEditorScrollHeight=derived(this,l=>{const c=mapOutFalsy(this._layout).read(l);return c?c.read(l).modifiedLine.bottom+BORDER_WIDTH+this._editor.editor.getScrollTop():0}),this._root=n.div({class:"word-replacement"},[derived(this,l=>{const c=mapOutFalsy(this._layout).read(l);if(!c)return[];const d=getOriginalBorderColor(this._tabAction).map(g=>asCssVariable(g)).read(l),u=getModifiedBorderColor(this._tabAction).map(g=>asCssVariable(g)).read(l);return[n.div({style:{position:"absolute",...rectToProps(g=>getEditorValidOverlayRect(this._editor).read(g)),overflow:"hidden",pointerEvents:"none"}},[n.div({style:{position:"absolute",...rectToProps(g=>c.read(g).lowerBackground.withMargin(BORDER_WIDTH,2*BORDER_WIDTH,BORDER_WIDTH,0)),background:asCssVariable(editorBackground),cursor:"pointer",pointerEvents:"auto"},onmousedown:g=>{g.preventDefault()},onmouseup:g=>this._onDidClick.fire(new StandardMouseEvent(getWindow(g),g)),obsRef:g=>{this._hoverableElement.set(g,void 0)}}),n.div({style:{position:"absolute",...rectToProps(g=>c.read(g).modifiedLine.withMargin(BORDER_WIDTH,2*BORDER_WIDTH)),fontFamily:this._editor.getOption(58),fontSize:this._editor.getOption(61),fontWeight:this._editor.getOption(62),pointerEvents:"none",boxSizing:"border-box",borderRadius:"4px",border:`${BORDER_WIDTH}px solid ${u}`,background:asCssVariable(modifiedChangedTextOverlayColor),display:"flex",justifyContent:"center",alignItems:"center",outline:`2px solid ${asCssVariable(editorBackground)}`}},[this._line]),n.div({style:{position:"absolute",...rectToProps(g=>c.read(g).originalLine.withMargin(BORDER_WIDTH)),boxSizing:"border-box",borderRadius:"4px",border:`${BORDER_WIDTH}px solid ${d}`,background:asCssVariable(originalChangedTextOverlayColor),pointerEvents:"none"}},[]),n.svg({width:11,height:14,viewBox:"0 0 11 14",fill:"none",style:{position:"absolute",left:c.map(g=>g.modifiedLine.left-16),top:c.map(g=>g.modifiedLine.top+Math.round((g.lineHeight-14-5)/2))}},[n.svgElem("path",{d:"M1 0C1 2.98966 1 5.92087 1 8.49952C1 9.60409 1.89543 10.5 3 10.5H10.5",stroke:asCssVariable(editorHoverForeground)}),n.svgElem("path",{d:"M6 7.5L9.99999 10.49998L6 13.5",stroke:asCssVariable(editorHoverForeground)})])])]})]).keepUpdated(this._store),this._register(this._editor.createOverlayWidget({domNode:this._root.element,minContentWidthInPx:constObservable(0),position:constObservable({preference:{top:0,left:0}}),allowEditorOverflow:!1}))}},On.MAX_LENGTH=100,On);InlineEditsWordReplacementView=__decorate$14([__param$13(3,ILanguageService)],InlineEditsWordReplacementView);class OriginalEditorInlineDiffView extends Disposable{constructor(e,t,s){super(),this._originalEditor=e,this._state=t,this._modifiedTextModel=s,this._onDidClick=this._register(new Emitter$1),this.onDidClick=this._onDidClick.event,this.isHovered=observableCodeEditor(this._originalEditor).isTargetHovered(r=>{var l;return r.target.type===6&&((l=r.target.detail.injectedText)==null?void 0:l.options.attachedData)instanceof InlineEditAttachedData&&r.target.detail.injectedText.options.attachedData.owner===this},this._store),this._tokenizationFinished=modelTokenizationFinished(this._modifiedTextModel),this._decorations=derived(this,r=>{var x,E;const l=this._state.read(r);if(!l)return;const c=l.modifiedText,d=l.mode==="insertionInline",u=l.diff.length===1&&((x=l.diff[0].innerChanges)==null?void 0:x.length)===1,g=!0,f=[],p=[],m=ModelDecorationOptions.register({className:"inlineCompletions-line-insert",description:"line-insert",isWholeLine:!0,marginClassName:"gutter-insert"}),_=ModelDecorationOptions.register({className:"inlineCompletions-line-delete",description:"line-delete",isWholeLine:!0,marginClassName:"gutter-delete"}),C=ModelDecorationOptions.register({className:"inlineCompletions-char-delete",description:"char-delete",isWholeLine:!1,zIndex:1}),b=ModelDecorationOptions.register({className:"inlineCompletions-char-insert",description:"char-insert",isWholeLine:!0}),v=ModelDecorationOptions.register({className:"inlineCompletions-char-insert",description:"char-insert",shouldFillLineOnLineBreak:!0}),S=ModelDecorationOptions.register({className:"inlineCompletions-char-insert diff-range-empty",description:"char-insert diff-range-empty"}),y=ModelDecorationOptions.register({className:"inlineCompletions-original-lines",description:"inlineCompletions-original-lines",isWholeLine:!1,shouldFillLineOnLineBreak:!0}),w=l.mode!=="sideBySide"&&l.mode!=="deletion"&&l.mode!=="insertionInline"&&l.mode!=="lineReplacement",L=l.mode==="lineReplacement";for(const I of l.diff)if(w&&(I.original.isEmpty||f.push({range:I.original.toInclusiveRange(),options:_}),I.modified.isEmpty||p.push({range:I.modified.toInclusiveRange(),options:m})),I.modified.isEmpty||I.original.isEmpty)I.original.isEmpty||f.push({range:I.original.toInclusiveRange(),options:C}),I.modified.isEmpty||p.push({range:I.modified.toInclusiveRange(),options:b});else{const D=d&&allowsTrueInlineDiffRendering(I);for(const k of I.innerChanges||[]){if(I.original.contains(k.originalRange.startLineNumber)&&!(L&&k.originalRange.isEmpty())){const N=(E=this._originalEditor.getModel())==null?void 0:E.getValueInRange(k.originalRange,1);f.push({range:k.originalRange,options:{description:"char-delete",shouldFillLineOnLineBreak:!1,className:classNames("inlineCompletions-char-delete",k.originalRange.isSingleLine()&&l.mode==="insertionInline"&&"single-line-inline",k.originalRange.isEmpty()&&"empty",(k.originalRange.isEmpty()&&u||l.mode==="deletion"&&N===`
`)&&g&&!D&&"diff-range-empty"),inlineClassName:D?classNames("strike-through","inlineCompletions"):null,zIndex:1}})}if(I.modified.contains(k.modifiedRange.startLineNumber)&&p.push({range:k.modifiedRange,options:k.modifiedRange.isEmpty()&&g&&!D&&u?S:v}),D){const N=c.getValueOfRange(k.modifiedRange),R=N.length>3?[{text:N.slice(0,1),extraClasses:["start"],offsetRange:new OffsetRange(k.modifiedRange.startColumn-1,k.modifiedRange.startColumn)},{text:N.slice(1,-1),extraClasses:[],offsetRange:new OffsetRange(k.modifiedRange.startColumn,k.modifiedRange.endColumn-2)},{text:N.slice(-1),extraClasses:["end"],offsetRange:new OffsetRange(k.modifiedRange.endColumn-2,k.modifiedRange.endColumn-1)}]:[{text:N,extraClasses:["start","end"],offsetRange:new OffsetRange(k.modifiedRange.startColumn-1,k.modifiedRange.endColumn)}];this._tokenizationFinished.read(r);const M=this._modifiedTextModel.tokenization.getLineTokens(k.modifiedRange.startLineNumber);for(const{text:A,extraClasses:O,offsetRange:P}of R)f.push({range:Range$2.fromPositions(k.originalRange.getEndPosition()),options:{description:"inserted-text",before:{tokens:M.getTokensInRange(P),content:A,inlineClassName:classNames("inlineCompletions-char-insert",k.modifiedRange.isSingleLine()&&l.mode==="insertionInline"&&"single-line-inline",...O),cursorStops:InjectedTextCursorStops$1.None,attachedData:new InlineEditAttachedData(this)},zIndex:2,showIfCollapsed:!0}})}}}if(l.isInDiffEditor)for(const I of l.diff)I.original.isEmpty||f.push({range:I.original.toExclusiveRange(),options:y});return{originalDecorations:f,modifiedDecorations:p}}),this._register(observableCodeEditor(this._originalEditor).setDecorations(this._decorations.map(r=>(r==null?void 0:r.originalDecorations)??[])));const o=this._state.map(r=>r==null?void 0:r.modifiedCodeEditor);this._register(autorunWithStore((r,l)=>{const c=o.read(r);c&&l.add(observableCodeEditor(c).setDecorations(this._decorations.map(d=>(d==null?void 0:d.modifiedDecorations)??[])))})),this._register(this._originalEditor.onMouseUp(r=>{var c;if(r.target.type!==6)return;const l=(c=r.target.detail.injectedText)==null?void 0:c.options.attachedData;l instanceof InlineEditAttachedData&&l.owner===this&&this._onDidClick.fire(r.event)}))}}class InlineEditAttachedData{constructor(e){this.owner=e}}function allowsTrueInlineDiffRendering(a){return a.innerChanges?a.innerChanges.every(e=>rangeIsSingleLine(e.modifiedRange)&&rangeIsSingleLine(e.originalRange)):!1}let i=0;function modelTokenizationFinished(a){return observableFromEvent(a.onDidChangeTokens,()=>i++)}const view="";var __decorate$13=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$12=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let InlineEditsView=class extends Disposable{constructor(e,t,s,o,r,l){super(),this._editor=e,this._host=t,this._model=s,this._ghostTextIndicator=o,this._focusIsInMenu=r,this._instantiationService=l,this._editorObs=observableCodeEditor(this._editor),this._tabAction=derived(g=>{var f;return((f=this._model.read(g))==null?void 0:f.tabAction.read(g))??InlineEditTabAction.Inactive}),this._constructorDone=observableValue(this,!1),this._uiState=derived(this,g=>{var S,y;const f=this._model.read(g);if(!f||!this._constructorDone.read(g))return;const p=f.inlineEdit;let m=RangeMapping.fromEdit(p.edit),_=p.edit.apply(p.originalText),C=lineRangeMappingFromRangeMappings(m,p.originalText,new StringText(_)),b=this.determineRenderState(f,g,C,new StringText(_));if(!b){f.abort(`unable to determine view: tried to render ${(S=this._previousView)==null?void 0:S.view}`);return}if(b.kind===InlineCompletionViewKind.SideBySide){const w=createReindentEdit(_,p.modifiedLineRange,d.getOptions().tabSize);_=w.applyToString(_),m=applyEditToModifiedRangeMappings(m,w),C=lineRangeMappingFromRangeMappings(m,p.originalText,new StringText(_))}return this._previewTextModel.setLanguage(this._editor.getModel().getLanguageId()),this._previewTextModel.getValue()!==_&&this._previewTextModel.setValue(_),f.showCollapsed.read(g)&&!((y=this._indicator.read(g))!=null&&y.isHoverVisible.read(g))&&(b={kind:InlineCompletionViewKind.Collapsed,viewData:b.viewData}),f.handleInlineEditShown(b.kind,b.viewData),{state:b,diff:C,edit:p,newText:_,newTextLineCount:p.modifiedLineRange.length,isInDiffEditor:f.isInDiffEditor}}),this._previewTextModel=this._register(this._instantiationService.createInstance(TextModel,"",this._editor.getModel().getLanguageId(),{...TextModel.DEFAULT_CREATION_OPTIONS,bracketPairColorizationOptions:{enabled:!0,independentColorPoolPerBracketType:!1}},null)),this._indicatorCyclicDependencyCircuitBreaker=observableValue(this,!1),this._indicator=derived(this,g=>{if(!this._indicatorCyclicDependencyCircuitBreaker.read(g))return;const f=derivedOpts({owner:this,equalsFn:equalsIfDefined(itemEquals())},m=>{var b,v,S;const _=this._ghostTextIndicator.read(m);if(_)return _.lineRange;const C=this._uiState.read(m);if(C){if(((b=C.state)==null?void 0:b.kind)==="custom"){const y=(v=C.state.displayLocation)==null?void 0:v.range;if(!y)throw new BugIndicatingError("custom view should have a range");return new LineRange(y.startLineNumber,y.endLineNumber)}return((S=C.state)==null?void 0:S.kind)==="insertionMultiLine"?this._insertion.originalLines.read(m):C.edit.displayRange}}),p=derived(this,m=>{const _=this._model.read(m);if(_)return _;const C=this._ghostTextIndicator.read(m);return C?C.model:_});return g.store.add(this._instantiationService.createInstance(InlineEditsGutterIndicator,this._editorObs,f,this._gutterIndicatorOffset,p,this._inlineEditsIsHovered,this._focusIsInMenu))}),this._inlineEditsIsHovered=derived(this,g=>this._sideBySide.isHovered.read(g)||this._wordReplacementViews.read(g).some(f=>f.isHovered.read(g))||this._deletion.isHovered.read(g)||this._inlineDiffView.isHovered.read(g)||this._lineReplacementView.isHovered.read(g)||this._insertion.isHovered.read(g)||this._customView.isHovered.read(g)),this._gutterIndicatorOffset=derived(this,g=>{var p,m;if(((m=(p=this._uiState.read(g))==null?void 0:p.state)==null?void 0:m.kind)==="insertionMultiLine")return this._insertion.startLineOffset.read(g);const f=this._ghostTextIndicator.read(g);return f?getGhostTextTopOffset(f,this._editor):0}),this._sideBySide=this._register(this._instantiationService.createInstance(InlineEditsSideBySideView,this._editor,this._model.map(g=>g==null?void 0:g.inlineEdit),this._previewTextModel,this._uiState.map(g=>{var f;return g&&((f=g.state)==null?void 0:f.kind)===InlineCompletionViewKind.SideBySide?{newTextLineCount:g.newTextLineCount,isInDiffEditor:g.isInDiffEditor}:void 0}),this._tabAction)),this._deletion=this._register(this._instantiationService.createInstance(InlineEditsDeletionView,this._editor,this._model.map(g=>g==null?void 0:g.inlineEdit),this._uiState.map(g=>{var f;return g&&((f=g.state)==null?void 0:f.kind)===InlineCompletionViewKind.Deletion?{originalRange:g.state.originalRange,deletions:g.state.deletions,inDiffEditor:g.isInDiffEditor}:void 0}),this._tabAction)),this._insertion=this._register(this._instantiationService.createInstance(InlineEditsInsertionView,this._editor,this._uiState.map(g=>{var f;return g&&((f=g.state)==null?void 0:f.kind)===InlineCompletionViewKind.InsertionMultiLine?{lineNumber:g.state.lineNumber,startColumn:g.state.column,text:g.state.text,inDiffEditor:g.isInDiffEditor}:void 0}),this._tabAction)),this._inlineDiffViewState=derived(this,g=>{const f=this._uiState.read(g);if(!(!f||!f.state)&&!(f.state.kind==="wordReplacements"||f.state.kind==="insertionMultiLine"||f.state.kind==="collapsed"||f.state.kind==="custom"))return{modifiedText:new StringText(f.newText),diff:f.diff,mode:f.state.kind,modifiedCodeEditor:this._sideBySide.previewEditor,isInDiffEditor:f.isInDiffEditor}}),this._inlineCollapsedView=this._register(this._instantiationService.createInstance(InlineEditsCollapsedView,this._editor,this._model.map((g,f)=>{var p,m;return((m=(p=this._uiState.read(f))==null?void 0:p.state)==null?void 0:m.kind)==="collapsed"?g==null?void 0:g.inlineEdit:void 0}))),this._customView=this._register(this._instantiationService.createInstance(InlineEditsCustomView,this._editor,this._model.map((g,f)=>{var p,m;return((m=(p=this._uiState.read(f))==null?void 0:p.state)==null?void 0:m.kind)==="custom"?g==null?void 0:g.displayLocation:void 0}),this._tabAction)),this._inlineDiffView=this._register(new OriginalEditorInlineDiffView(this._editor,this._inlineDiffViewState,this._previewTextModel)),this._wordReplacementViews=mapObservableArrayCached(this,this._uiState.map(g=>{var f;return((f=g==null?void 0:g.state)==null?void 0:f.kind)==="wordReplacements"?g.state.replacements:[]}),(g,f)=>f.add(this._instantiationService.createInstance(InlineEditsWordReplacementView,this._editorObs,g,this._tabAction))),this._lineReplacementView=this._register(this._instantiationService.createInstance(InlineEditsLineReplacementView,this._editorObs,this._uiState.map(g=>{var f;return((f=g==null?void 0:g.state)==null?void 0:f.kind)===InlineCompletionViewKind.LineReplacement?{originalRange:g.state.originalRange,modifiedRange:g.state.modifiedRange,modifiedLines:g.state.modifiedLines,replacements:g.state.replacements}:void 0}),this._uiState.map(g=>(g==null?void 0:g.isInDiffEditor)??!1),this._tabAction)),this._useCodeShifting=this._editorObs.getOption(71).map(g=>g.edits.allowCodeShifting),this._renderSideBySide=this._editorObs.getOption(71).map(g=>g.edits.renderSideBySide),this._register(autorunWithStore((g,f)=>{const p=this._model.read(g);p&&f.add(Event$1.any(this._sideBySide.onDidClick,this._deletion.onDidClick,this._lineReplacementView.onDidClick,this._insertion.onDidClick,...this._wordReplacementViews.read(g).map(m=>m.onDidClick),this._inlineDiffView.onDidClick,this._customView.onDidClick)(m=>{this._viewHasBeenShownLongerThan(350)&&(m.preventDefault(),p.accept())}))})),this._indicator.recomputeInitiallyAndOnChange(this._store),this._wordReplacementViews.recomputeInitiallyAndOnChange(this._store),this._indicatorCyclicDependencyCircuitBreaker.set(!0,void 0),this._register(this._instantiationService.createInstance(InlineEditsOnboardingExperience,this._host,this._model,this._indicator,this._inlineCollapsedView));const c=derived(this,g=>Math.max(...this._wordReplacementViews.read(g).map(f=>f.minEditorScrollHeight.read(g)),this._lineReplacementView.minEditorScrollHeight.read(g),this._customView.minEditorScrollHeight.read(g))).recomputeInitiallyAndOnChange(this._store),d=this._editor.getModel();let u;this._register(autorun(g=>{const f=c.read(g);this._editor.changeViewZones(p=>{const m=this._editor.getScrollHeight(),_=f-m+1;_!==0&&u&&(p.removeZone(u),u=void 0),!(_<=0)&&(u=p.addZone({afterLineNumber:d.getLineCount(),heightInPx:_,domNode:$$l("div.minScrollHeightViewZone")}))})})),this._constructorDone.set(!0,void 0)}getCacheId(e){return e.inlineEdit.inlineCompletion.identity.id}determineView(e,t,s,o){var p,m,_,C;const r=e.inlineEdit,l=((p=this._previousView)==null?void 0:p.id)===this.getCacheId(e),c=((m=this._previousView)==null?void 0:m.editorWidth)!==this._editorObs.layoutInfoWidth.read(t)&&(((_=this._previousView)==null?void 0:_.view)===InlineCompletionViewKind.SideBySide||((C=this._previousView)==null?void 0:C.view)===InlineCompletionViewKind.LineReplacement);if(l&&!c)return this._previousView.view;if(e.displayLocation)return InlineCompletionViewKind.Custom;const d=r.originalLineRange.length,u=r.modifiedLineRange.length,g=s.flatMap(b=>b.innerChanges??[]),f=g.length===1;if(!e.isInDiffEditor){if(f&&this._useCodeShifting.read(t)!=="never"&&isSingleLineInsertion(s))return isSingleLineInsertionAfterPosition(s,r.cursorPosition)?InlineCompletionViewKind.InsertionInline:InlineCompletionViewKind.LineReplacement;if(isDeletion(g,r,o))return InlineCompletionViewKind.Deletion;if(isSingleMultiLineInsertion(s)&&this._useCodeShifting.read(t)==="always")return InlineCompletionViewKind.InsertionMultiLine;if(g.every(v=>TextLength.ofRange(v.originalRange).columnCount<InlineEditsWordReplacementView.MAX_LENGTH&&TextLength.ofRange(v.modifiedRange).columnCount<InlineEditsWordReplacementView.MAX_LENGTH)&&f&&d===1&&u===1){const v=g.map(y=>o.getValueOfRange(y.modifiedRange)),S=g.map(y=>e.inlineEdit.originalText.getValueOfRange(y.originalRange));if(!v.some(y=>y.includes("	"))&&!S.some(y=>y.includes("	"))&&(!g.some(y=>y.originalRange.isEmpty())||!growEditsUntilWhitespace(g.map(y=>new TextReplacement(y.originalRange,"")),r.originalText).some(y=>y.range.isEmpty()&&TextLength.ofRange(y.range).columnCount<InlineEditsWordReplacementView.MAX_LENGTH)))return InlineCompletionViewKind.WordReplacements}}if(d>0&&u>0)return d===1&&u===1&&!e.isInDiffEditor?InlineCompletionViewKind.LineReplacement:this._renderSideBySide.read(t)!=="never"&&InlineEditsSideBySideView.fitsInsideViewport(this._editor,this._previewTextModel,r,t)?InlineCompletionViewKind.SideBySide:InlineCompletionViewKind.LineReplacement;if(e.isInDiffEditor){if(isDeletion(g,r,o))return InlineCompletionViewKind.Deletion;if(isSingleMultiLineInsertion(s)&&this._useCodeShifting.read(t)==="always")return InlineCompletionViewKind.InsertionMultiLine}return InlineCompletionViewKind.SideBySide}determineRenderState(e,t,s,o){const r=e.inlineEdit,l=this.determineView(e,t,s,o);this._previousView={id:this.getCacheId(e),view:l,editorWidth:this._editor.getLayoutInfo().width,timestamp:Date.now()};const c=s.flatMap(_=>_.innerChanges??[]),d=this._editor.getModel(),u=c.map(_=>({originalRange:_.originalRange,modifiedRange:_.modifiedRange,original:d.getValueInRange(_.originalRange),modified:o.getValueOfRange(_.modifiedRange)})),g=r.cursorPosition,f=u[0].modified.startsWith(d.getEOL()),p={cursorColumnDistance:r.edit.replacements[0].range.getStartPosition().column-g.column,cursorLineDistance:r.lineEdit.lineRange.startLineNumber-g.lineNumber+(f&&r.lineEdit.lineRange.startLineNumber>=g.lineNumber?1:0),lineCountOriginal:r.lineEdit.lineRange.length,lineCountModified:r.lineEdit.newLines.length,characterCountOriginal:u.reduce((_,C)=>_+C.original.length,0),characterCountModified:u.reduce((_,C)=>_+C.modified.length,0),disjointReplacements:u.length,sameShapeReplacements:u.every(_=>_.original===u[0].original&&_.modified===u[0].modified)};switch(l){case InlineCompletionViewKind.InsertionInline:return{kind:InlineCompletionViewKind.InsertionInline,viewData:p};case InlineCompletionViewKind.SideBySide:return{kind:InlineCompletionViewKind.SideBySide,viewData:p};case InlineCompletionViewKind.Collapsed:return{kind:InlineCompletionViewKind.Collapsed,viewData:p};case InlineCompletionViewKind.Custom:return{kind:InlineCompletionViewKind.Custom,displayLocation:e.displayLocation,viewData:p}}if(l===InlineCompletionViewKind.Deletion)return{kind:InlineCompletionViewKind.Deletion,originalRange:r.originalLineRange,deletions:c.map(_=>_.originalRange),viewData:p};if(l===InlineCompletionViewKind.InsertionMultiLine){const _=c[0];return{kind:InlineCompletionViewKind.InsertionMultiLine,lineNumber:_.originalRange.startLineNumber,column:_.originalRange.startColumn,text:o.getValueOfRange(_.modifiedRange),viewData:p}}const m=u.map(_=>new TextReplacement(_.originalRange,_.modified));if(m.length!==0){if(l===InlineCompletionViewKind.WordReplacements){let _=growEditsToEntireWord(m,r.originalText);return _.some(C=>C.range.isEmpty())&&(_=growEditsUntilWhitespace(m,r.originalText)),{kind:InlineCompletionViewKind.WordReplacements,replacements:_,viewData:p}}if(l===InlineCompletionViewKind.LineReplacement)return{kind:InlineCompletionViewKind.LineReplacement,originalRange:r.originalLineRange,modifiedRange:r.modifiedLineRange,modifiedLines:r.modifiedLineRange.mapToLineArray(_=>o.getLineAt(_)),replacements:c.map(_=>({originalRange:_.originalRange,modifiedRange:_.modifiedRange})),viewData:p}}}_viewHasBeenShownLongerThan(e){var o;const t=(o=this._previousView)==null?void 0:o.timestamp;if(!t)throw new BugIndicatingError("viewHasBeenShownLongThan called before a view has been shown");return Date.now()-t>=e}};InlineEditsView=__decorate$13([__param$12(5,IInstantiationService)],InlineEditsView);function isSingleLineInsertion(a){return a.every(t=>t.innerChanges.every(s=>e(s)));function e(t){return!(!t.originalRange.isEmpty()||!(t.modifiedRange.startLineNumber===t.modifiedRange.endLineNumber))}}function isSingleLineInsertionAfterPosition(a,e){if(!e||!isSingleLineInsertion(a))return!1;const t=e;return a.every(o=>o.innerChanges.every(r=>s(r)));function s(o){const r=o.originalRange.getStartPosition();return!!(t.isBeforeOrEqual(r)||r.lineNumber<t.lineNumber)}}function isSingleMultiLineInsertion(a){const e=a.flatMap(s=>s.innerChanges??[]);if(e.length!==1)return!1;const t=e[0];return!(!t.originalRange.isEmpty()||t.modifiedRange.startLineNumber===t.modifiedRange.endLineNumber)}function isDeletion(a,e,t){return a.map(o=>({original:e.originalText.getValueOfRange(o.originalRange),modified:t.getValueOfRange(o.modifiedRange)})).every(({original:o,modified:r})=>r.trim()===""&&o.length>0&&(o.length>r.length||o.trim()!==""))}function growEditsToEntireWord(a,e){return _growEdits(a,e,t=>/^[a-zA-Z]$/.test(t))}function growEditsUntilWhitespace(a,e){return _growEdits(a,e,t=>!/^\s$/.test(t))}function _growEdits(a,e,t){const s=[];a.sort((r,l)=>Range$2.compareRangesUsingStarts(r.range,l.range));for(const r of a){let l=r.range.startColumn-1,c=r.range.endColumn-2,d="",u="";const g=e.getLineAt(r.range.startLineNumber),f=e.getLineAt(r.range.endLineNumber);if(o(g[l]))for(;o(g[l-1]);)d=g[l-1]+d,l--;if(o(f[c])||c<l)for(;o(f[c+1]);)u+=f[c+1],c++;let p=new TextReplacement(new Range$2(r.range.startLineNumber,l+1,r.range.endLineNumber,c+2),d+r.text+u);s.length>0&&Range$2.areIntersectingOrTouching(s[s.length-1].range,p.range)&&(p=TextReplacement.joinReplacements([s.pop(),p],e)),s.push(p)}function o(r){return r===void 0?!1:t(r)}return s}function getGhostTextTopOffset(a,e){const t=a.model.inlineEdit.edit.replacements;if(t.length!==1)return 0;const s=e.getModel();if(!s)return 0;const o=s.getEOL(),r=t[0];if(r.range.isEmpty()&&r.text.startsWith(o)){const l=e.getLineHeightForPosition(r.range.getStartPosition());return countPrefixRepeats(r.text,o)*l}return 0}function countPrefixRepeats(a,e){if(!e.length)return 0;let t=0,s=0;for(;a.startsWith(e,s);)t++,s+=e.length;return t}var __decorate$12=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$11=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},InlineEditsViewAndDiffProducer_1,Ki;let InlineEditsViewAndDiffProducer=(Ki=class extends Disposable{constructor(e,t,s,o,r){super(),this._editor=e,this._edit=t,this._model=s,this._focusIsInMenu=o,this._inlineEdit=derived(this,l=>{var _;const c=this._model.read(l);if(!c)return;const d=this._edit.read(l);if(!d)return;const u=this._editor.getModel();if(!u)return;const g=(_=c.inlineEditState.read(void 0))==null?void 0:_.inlineCompletion.updatedEdit;if(!g)return;const f=g.replacements.map(C=>{const b=Range$2.fromPositions(u.getPositionAt(C.replaceRange.start),u.getPositionAt(C.replaceRange.endExclusive));return new TextReplacement(b,C.newText)}),p=new TextEdit(f),m=new TextModelText(u);return new InlineEditWithChanges(m,p,c.primaryPosition.read(void 0),d.commands,d.inlineCompletion)}),this._inlineEditModel=derived(this,l=>{const c=this._model.read(l);if(!c)return;const d=this._inlineEdit.read(l);if(!d)return;const u=derived(this,g=>{if(this._editorObs.isFocused.read(g)){if(c.tabShouldJumpToInlineEdit.read(g))return InlineEditTabAction.Jump;if(c.tabShouldAcceptInlineEdit.read(g))return InlineEditTabAction.Accept}return InlineEditTabAction.Inactive});return new InlineEditModel(c,d,u)}),this._inlineEditHost=derived(this,l=>{const c=this._model.read(l);if(c)return new InlineEditHost(c)}),this._ghostTextIndicator=derived(this,l=>{const c=this._model.read(l);if(!c)return;const d=c.inlineCompletionState.read(l);if(!d)return;const u=d.inlineCompletion;if(!u||!u.showInlineEditMenu)return;const g=LineRange.ofLength(d.primaryGhostText.lineNumber,1);return new GhostTextIndicator(this._editor,c,g,u)}),this._editorObs=observableCodeEditor(this._editor),this._register(r.createInstance(InlineEditsView,this._editor,this._inlineEditHost,this._inlineEditModel,this._ghostTextIndicator,this._focusIsInMenu))}},InlineEditsViewAndDiffProducer_1=Ki,Ki.hot=createHotClass(InlineEditsViewAndDiffProducer_1),Ki);InlineEditsViewAndDiffProducer=InlineEditsViewAndDiffProducer_1=__decorate$12([__param$11(4,IInstantiationService)],InlineEditsViewAndDiffProducer);var __decorate$11=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$10=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let InlineCompletionsView=class extends Disposable{constructor(e,t,s,o){super(),this._editor=e,this._model=t,this._focusIsInMenu=s,this._instantiationService=o,this._ghostTexts=derived(this,r=>{const l=this._model.read(r);return(l==null?void 0:l.ghostTexts.read(r))??[]}),this._stablizedGhostTexts=convertItemsToStableObservables(this._ghostTexts,this._store),this._editorObs=observableCodeEditor(this._editor),this._ghostTextWidgets=mapObservableArrayCached(this,this._stablizedGhostTexts,(r,l)=>derivedDisposable(c=>this._instantiationService.createInstance(GhostTextView.hot.read(c),this._editor,{ghostText:r,warning:this._model.map((d,u)=>{var f;const g=(f=d==null?void 0:d.warning)==null?void 0:f.read(u);return g?{icon:g.icon}:void 0}),minReservedLineCount:constObservable(0),targetTextModel:this._model.map(d=>d==null?void 0:d.textModel),handleInlineCompletionShown:this._model.map((d,u)=>{var f;const g=(f=d==null?void 0:d.inlineCompletionState.read(u))==null?void 0:f.inlineCompletion;return g?p=>d.handleInlineSuggestionShown(g,InlineCompletionViewKind.GhostText,p):()=>{}})},this._editorObs.getOption(71).map(d=>({syntaxHighlightingEnabled:d.syntaxHighlightingEnabled})),!1,!1)).recomputeInitiallyAndOnChange(l)).recomputeInitiallyAndOnChange(this._store),this._inlineEdit=derived(this,r=>{var l,c;return(c=(l=this._model.read(r))==null?void 0:l.inlineEditState.read(r))==null?void 0:c.inlineEdit}),this._everHadInlineEdit=derivedObservableWithCache(this,(r,l)=>{var c,d,u;return l||!!this._inlineEdit.read(r)||!!((u=(d=(c=this._model.read(r))==null?void 0:c.inlineCompletionState.read(r))==null?void 0:d.inlineCompletion)!=null&&u.showInlineEditMenu)}),this._inlineEditWidget=derivedDisposable(r=>{if(this._everHadInlineEdit.read(r))return this._instantiationService.createInstance(InlineEditsViewAndDiffProducer.hot.read(r),this._editor,this._inlineEdit,this._model,this._focusIsInMenu)}).recomputeInitiallyAndOnChange(this._store),this._fontFamily=this._editorObs.getOption(71).map(r=>r.fontFamily),this._register(createStyleSheetFromObservable(derived(r=>`
.monaco-editor .ghost-text-decoration,
.monaco-editor .ghost-text-decoration-preview,
.monaco-editor .ghost-text {
	font-family: ${this._fontFamily.read(r)};
}`))),this._register(new InlineCompletionsHintsWidget(this._editor,this._model,this._instantiationService))}shouldShowHoverAtViewZone(e){var t;return((t=this._ghostTextWidgets.get()[0])==null?void 0:t.get().ownsViewZone(e))??!1}};InlineCompletionsView=__decorate$11([__param$10(3,IInstantiationService)],InlineCompletionsView);var __decorate$10=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$$=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},InlineCompletionsController_1,ut;let InlineCompletionsController=(ut=class extends Disposable{static getInFocusedEditorOrParent(e){const t=getOuterEditor(e);return t?InlineCompletionsController_1.get(t):null}static get(e){return hotClassGetOriginalInstance(e.getContribution(InlineCompletionsController_1.ID))}constructor(e,t,s,o,r,l,c,d,u,g){super(),this.editor=e,this._instantiationService=t,this._contextKeyService=s,this._configurationService=o,this._commandService=r,this._debounceService=l,this._languageFeaturesService=c,this._accessibilitySignalService=d,this._keybindingService=u,this._accessibilityService=g,this._editorObs=observableCodeEditor(this.editor),this._positions=derived(this,_=>{var C;return((C=this._editorObs.selections.read(_))==null?void 0:C.map(b=>b.getEndPosition()))??[new Position$1(1,1)]}),this._suggestWidgetAdapter=this._register(new ObservableSuggestWidgetAdapter(this._editorObs,_=>{var C;return(C=this.model.get())==null?void 0:C.handleSuggestAccepted(_)},()=>{var _,C;return(C=(_=this.model.get())==null?void 0:_.selectedInlineCompletion.get())==null?void 0:C.getSingleTextEdit()})),this._enabledInConfig=observableFromEvent(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(71).enabled),this._isScreenReaderEnabled=observableFromEvent(this,this._accessibilityService.onDidChangeScreenReaderOptimized,()=>this._accessibilityService.isScreenReaderOptimized()),this._editorDictationInProgress=observableFromEvent(this,this._contextKeyService.onDidChangeContext,()=>this._contextKeyService.getContext(this.editor.getDomNode()).getValue("editorDictation.inProgress")===!0),this._enabled=derived(this,_=>this._enabledInConfig.read(_)&&(!this._isScreenReaderEnabled.read(_)||!this._editorDictationInProgress.read(_))),this._debounceValue=this._debounceService.for(this._languageFeaturesService.inlineCompletionsProvider,"InlineCompletionsDebounce",{min:50,max:50}),this._focusIsInMenu=observableValue(this,!1),this._focusIsInEditorOrMenu=derived(this,_=>{const C=this._editorObs.isFocused.read(_),b=this._focusIsInMenu.read(_);return C||b}),this._cursorIsInIndentation=derived(this,_=>{const C=this._editorObs.cursorPosition.read(_);if(C===null)return!1;const b=this._editorObs.model.read(_);if(!b)return!1;this._editorObs.versionId.read(_);const v=b.getLineIndentColumn(C.lineNumber);return C.column<=v}),this.model=derivedDisposable(this,_=>{if(this._editorObs.isReadonly.read(_))return;const C=this._editorObs.model.read(_);return C?this._instantiationService.createInstance(InlineCompletionsModel,C,this._suggestWidgetAdapter.selectedItem,this._editorObs.versionId,this._positions,this._debounceValue,this._enabled,this.editor):void 0}).recomputeInitiallyAndOnChange(this._store),this._playAccessibilitySignal=observableSignal(this),this._hideInlineEditOnSelectionChange=this._editorObs.getOption(71).map(_=>!0),this._view=this._register(this._instantiationService.createInstance(InlineCompletionsView,this.editor,this.model,this._focusIsInMenu)),InlineCompletionsController_1._instances.add(this),this._register(toDisposable(()=>InlineCompletionsController_1._instances.delete(this))),this._register(autorun(_=>{var S,y;const C=this.model.read(_);if(!C)return;const b=C.state.read(_);if(!b||!this._focusIsInEditorOrMenu.read(void 0))return;const v=b.kind==="inlineEdit"?b.nextEditUri:void 0;for(const w of InlineCompletionsController_1._instances)w!==this&&(v&&isEqual(v,(S=w.editor.getModel())==null?void 0:S.uri)?(y=w.model.read(void 0))==null||y.trigger():w.reject())})),this._register(autorun(_=>{var v;const C=this.model.read(_),b=(v=this.editor.getModel())==null?void 0:v.uri;!C||!b||_.store.add(C.onDidAccept(()=>{var S,y;for(const w of InlineCompletionsController_1._instances){if(w===this)continue;const L=(S=w.model.read(void 0))==null?void 0:S.state.read(void 0);(L==null?void 0:L.kind)==="inlineEdit"&&isEqual(L.nextEditUri,b)&&((y=w.model.read(void 0))==null||y.stop("automatic"))}}))})),this._register(runOnChange(this._editorObs.onDidType,(_,C)=>{var b;this._enabled.get()&&((b=this.model.get())==null||b.trigger())})),this._register(runOnChange(this._editorObs.onDidPaste,(_,C)=>{var b;this._enabled.get()&&((b=this.model.get())==null||b.trigger())})),this._register(this._commandService.onDidExecuteCommand(_=>{if(new Set([CoreEditingCommands.Tab.id,CoreEditingCommands.DeleteLeft.id,CoreEditingCommands.DeleteRight.id,inlineSuggestCommitId,"acceptSelectedSuggestion"]).has(_.commandId)&&e.hasTextFocus()&&this._enabled.get()){let b=!1;_.commandId===inlineSuggestCommitId&&(b=!0),this._editorObs.forceUpdate(v=>{var S;(S=this.model.get())==null||S.trigger(v,{noDelay:b})})}})),this._register(runOnChange(this._editorObs.selections,(_,C,b)=>{var v,S,y,w;if(b.some(L=>L.reason===3||L.source==="api")){if(!this._hideInlineEditOnSelectionChange.get()&&((S=(v=this.model.get())==null?void 0:v.state.get())==null?void 0:S.kind)==="inlineEdit")return;const L=this.model.get();if(!L)return;((y=L.state.get())==null?void 0:y.kind)==="ghostText"&&((w=this.model.get())==null||w.stop())}})),this._register(autorun(_=>{var v,S;const C=this._focusIsInEditorOrMenu.read(_),b=this.model.read(void 0);if(C){const y=b==null?void 0:b.state.read(void 0);(!y||y.kind!=="inlineEdit"||!y.nextEditUri)&&transaction(w=>{var L;for(const x of InlineCompletionsController_1._instances)x!==this&&((L=x.model.read(void 0))==null||L.stop("automatic",w))});return}this._contextKeyService.getContextKeyValue("accessibleViewIsShown")||this._configurationService.getValue("editor.inlineSuggest.keepOnBlur")||e.getOption(71).keepOnBlur||InlineSuggestionHintsContentWidget.dropDownVisible||b&&((S=(v=b.state.read(void 0))==null?void 0:v.inlineCompletion)!=null&&S.isFromExplicitRequest&&b.inlineEditAvailable.read(void 0)||transaction(y=>{b.stop("automatic",y)}))})),this._register(autorun(_=>{var b;const C=(b=this.model.read(_))==null?void 0:b.inlineCompletionState.read(_);C!=null&&C.suggestItem?C.primaryGhostText.lineCount>=2&&this._suggestWidgetAdapter.forceRenderingAbove():this._suggestWidgetAdapter.stopForceRenderingAbove()})),this._register(toDisposable(()=>{this._suggestWidgetAdapter.stopForceRenderingAbove()}));const f=derivedObservableWithCache(this,(_,C)=>{var S;const b=this.model.read(_),v=b==null?void 0:b.state.read(_);return this._suggestWidgetAdapter.selectedItem.get()?C:(S=v==null?void 0:v.inlineCompletion)==null?void 0:S.semanticId});this._register(runOnChangeWithStore(derived(_=>(this._playAccessibilitySignal.read(_),f.read(_),{})),async(_,C,b,v)=>{let S=this.model.get(),y=S==null?void 0:S.state.get();if(!y||!S||(await timeout(50,cancelOnDispose(v)),await waitForState(this._suggestWidgetAdapter.selectedItem,isUndefined,()=>!1,cancelOnDispose(v)),S=this.model.get(),y=S==null?void 0:S.state.get(),!y||!S))return;const w=y.kind==="ghostText"?S.textModel.getLineContent(y.primaryGhostText.lineNumber):"";this._accessibilitySignalService.playSignal(y.kind==="ghostText"?AccessibilitySignal.inlineSuggestion:AccessibilitySignal.nextEditSuggestion),this.editor.getOption(12)&&(y.kind==="ghostText"?this._provideScreenReaderUpdate(y.primaryGhostText.renderForScreenReader(w)):this._provideScreenReaderUpdate(""))})),this._register(this._configurationService.onDidChangeConfiguration(_=>{_.affectsConfiguration("accessibility.verbosity.inlineCompletions")&&this.editor.updateOptions({inlineCompletionsAccessibilityVerbose:this._configurationService.getValue("accessibility.verbosity.inlineCompletions")})})),this.editor.updateOptions({inlineCompletionsAccessibilityVerbose:this._configurationService.getValue("accessibility.verbosity.inlineCompletions")});const p=new ObservableContextKeyService(this._contextKeyService);this._register(p.bind(InlineCompletionContextKeys.cursorInIndentation,this._cursorIsInIndentation)),this._register(p.bind(InlineCompletionContextKeys.hasSelection,_=>{var C;return!((C=this._editorObs.cursorSelection.read(_))!=null&&C.isEmpty())})),this._register(p.bind(InlineCompletionContextKeys.cursorAtInlineEdit,this.model.map((_,C)=>{var b,v;return(v=(b=_==null?void 0:_.inlineEditState)==null?void 0:b.read(C))==null?void 0:v.cursorAtInlineEdit.read(C)}))),this._register(p.bind(InlineCompletionContextKeys.tabShouldAcceptInlineEdit,this.model.map((_,C)=>!!(_!=null&&_.tabShouldAcceptInlineEdit.read(C))))),this._register(p.bind(InlineCompletionContextKeys.tabShouldJumpToInlineEdit,this.model.map((_,C)=>!!(_!=null&&_.tabShouldJumpToInlineEdit.read(C))))),this._register(p.bind(InlineCompletionContextKeys.inlineEditVisible,_=>{var C;return((C=this.model.read(_))==null?void 0:C.inlineEditState.read(_))!==void 0})),this._register(p.bind(InlineCompletionContextKeys.inlineSuggestionHasIndentation,_=>{var C,b;return(b=(C=this.model.read(_))==null?void 0:C.getIndentationInfo(_))==null?void 0:b.startsWithIndentation})),this._register(p.bind(InlineCompletionContextKeys.inlineSuggestionHasIndentationLessThanTabSize,_=>{var C,b;return(b=(C=this.model.read(_))==null?void 0:C.getIndentationInfo(_))==null?void 0:b.startsWithIndentationLessThanTabSize})),this._register(p.bind(InlineCompletionContextKeys.suppressSuggestions,_=>{const C=this.model.read(_),b=C==null?void 0:C.inlineCompletionState.read(_);return b!=null&&b.primaryGhostText&&(b!=null&&b.inlineCompletion)?b.inlineCompletion.source.inlineSuggestions.suppressSuggestions:void 0})),this._register(p.bind(InlineCompletionContextKeys.inlineSuggestionVisible,_=>{const C=this.model.read(_),b=C==null?void 0:C.inlineCompletionState.read(_);return!!(b!=null&&b.inlineCompletion)&&(b==null?void 0:b.primaryGhostText)!==void 0&&!(b!=null&&b.primaryGhostText.isEmpty())}));const m=derived(this,_=>{const C=this.model.read(_),b=C==null?void 0:C.inlineCompletionState.read(_),v=b==null?void 0:b.primaryGhostText;return!v||v.isEmpty()?void 0:new Position$1(v.lineNumber,v.parts[0].column)});this._register(p.bind(InlineCompletionContextKeys.cursorBeforeGhostText,_=>{const C=m.read(_);if(!C)return!1;const b=this._editorObs.cursorPosition.read(_);return b?C.equals(b):!1})),this._register(this._instantiationService.createInstance(TextModelChangeRecorder,this.editor))}playAccessibilitySignal(e){this._playAccessibilitySignal.trigger(e)}_provideScreenReaderUpdate(e){const t=this._contextKeyService.getContextKeyValue("accessibleViewIsShown"),s=this._keybindingService.lookupKeybinding("editor.action.accessibleView");let o;!t&&s&&this.editor.getOption(169)&&(o=localize(1196,"Inspect this in the accessible view ({0})",s.getAriaLabel())),alert$1(o?e+", "+o:e)}shouldShowHoverAt(e){var s;const t=(s=this.model.get())==null?void 0:s.primaryGhostText.get();return t?t.parts.some(o=>e.containsPosition(new Position$1(t.lineNumber,o.column))):!1}shouldShowHoverAtViewZone(e){return this._view.shouldShowHoverAtViewZone(e)}reject(){transaction(e=>{var s;const t=this.model.get();if(t&&(t.stop("explicitCancel",e),this._focusIsInEditorOrMenu.get()))for(const o of InlineCompletionsController_1._instances)o!==this&&((s=o.model.get())==null||s.stop("automatic",e))})}jump(){const e=this.model.get();e&&e.jump()}},InlineCompletionsController_1=ut,ut._instances=new Set,ut.hot=createHotClass(InlineCompletionsController_1),ut.ID="editor.contrib.inlineCompletionsController",ut);InlineCompletionsController=InlineCompletionsController_1=__decorate$10([__param$$(1,IInstantiationService),__param$$(2,IContextKeyService),__param$$(3,IConfigurationService),__param$$(4,ICommandService),__param$$(5,ILanguageFeatureDebounceService),__param$$(6,ILanguageFeaturesService),__param$$(7,IAccessibilitySignalService),__param$$(8,IKeybindingService),__param$$(9,IAccessibilityService)],InlineCompletionsController);const qs=class qs extends EditorAction{constructor(){super({id:qs.ID,label:localize2(1174,"Show Next Inline Suggestion"),precondition:ContextKeyExpr.and(EditorContextKeys.writable,InlineCompletionContextKeys.inlineSuggestionVisible),kbOpts:{weight:100,primary:606}})}async run(e,t){var o;const s=InlineCompletionsController.get(t);(o=s==null?void 0:s.model.get())==null||o.next()}};qs.ID=showNextInlineSuggestionActionId;let ShowNextInlineSuggestionAction=qs;const Zs=class Zs extends EditorAction{constructor(){super({id:Zs.ID,label:localize2(1175,"Show Previous Inline Suggestion"),precondition:ContextKeyExpr.and(EditorContextKeys.writable,InlineCompletionContextKeys.inlineSuggestionVisible),kbOpts:{weight:100,primary:604}})}async run(e,t){var o;const s=InlineCompletionsController.get(t);(o=s==null?void 0:s.model.get())==null||o.previous()}};Zs.ID=showPreviousInlineSuggestionActionId;let ShowPreviousInlineSuggestionAction=Zs;class TriggerInlineSuggestionAction extends EditorAction{constructor(){super({id:"editor.action.inlineSuggest.trigger",label:localize2(1176,"Trigger Inline Suggestion"),precondition:EditorContextKeys.writable})}async run(e,t){const s=InlineCompletionsController.get(t);await asyncTransaction(async o=>{var r;await((r=s==null?void 0:s.model.get())==null?void 0:r.triggerExplicitly(o)),s==null||s.playAccessibilitySignal(o)})}}class ExplicitTriggerInlineEditAction extends EditorAction{constructor(){super({id:"editor.action.inlineSuggest.triggerInlineEditExplicit",label:localize2(1177,"Trigger Next Edit Suggestion"),precondition:EditorContextKeys.writable})}async run(e,t){var r,l;const s=e.get(INotificationService),o=InlineCompletionsController.get(t);await((r=o==null?void 0:o.model.get())==null?void 0:r.triggerExplicitly(void 0,!0)),(l=o==null?void 0:o.model.get())!=null&&l.inlineEditAvailable.get()||s.notify({severity:Severity.Info,message:localize(1165,"No inline edit is available.")})}}class TriggerInlineEditAction extends EditorCommand{constructor(){super({id:"editor.action.inlineSuggest.triggerInlineEdit",precondition:EditorContextKeys.writable})}async runEditorCommand(e,t,s){var r;const o=InlineCompletionsController.get(t);await((r=o==null?void 0:o.model.get())==null?void 0:r.trigger(void 0,{onlyFetchInlineEdits:!0}))}}class AcceptNextWordOfInlineCompletion extends EditorAction{constructor(){super({id:"editor.action.inlineSuggest.acceptNextWord",label:localize2(1178,"Accept Next Word Of Inline Suggestion"),precondition:ContextKeyExpr.and(EditorContextKeys.writable,InlineCompletionContextKeys.inlineSuggestionVisible),kbOpts:{weight:100+1,primary:2065,kbExpr:ContextKeyExpr.and(EditorContextKeys.writable,InlineCompletionContextKeys.inlineSuggestionVisible,InlineCompletionContextKeys.cursorBeforeGhostText,CONTEXT_ACCESSIBILITY_MODE_ENABLED.negate())},menuOpts:[{menuId:MenuId.InlineSuggestionToolbar,title:localize(1166,"Accept Word"),group:"primary",order:2}]})}async run(e,t){var o;const s=InlineCompletionsController.get(t);await((o=s==null?void 0:s.model.get())==null?void 0:o.acceptNextWord())}}class AcceptNextLineOfInlineCompletion extends EditorAction{constructor(){super({id:"editor.action.inlineSuggest.acceptNextLine",label:localize2(1179,"Accept Next Line Of Inline Suggestion"),precondition:ContextKeyExpr.and(EditorContextKeys.writable,InlineCompletionContextKeys.inlineSuggestionVisible),kbOpts:{weight:100+1},menuOpts:[{menuId:MenuId.InlineSuggestionToolbar,title:localize(1167,"Accept Line"),group:"secondary",order:2}]})}async run(e,t){var o;const s=InlineCompletionsController.get(t);await((o=s==null?void 0:s.model.get())==null?void 0:o.acceptNextLine())}}class AcceptInlineCompletion extends EditorAction{constructor(){super({id:inlineSuggestCommitId,label:localize2(1180,"Accept Inline Suggestion"),precondition:ContextKeyExpr.or(InlineCompletionContextKeys.inlineSuggestionVisible,InlineCompletionContextKeys.inlineEditVisible),menuOpts:[{menuId:MenuId.InlineSuggestionToolbar,title:localize(1168,"Accept"),group:"primary",order:2},{menuId:MenuId.InlineEditsActions,title:localize(1169,"Accept"),group:"primary",order:2}],kbOpts:[{primary:2,weight:200,kbExpr:ContextKeyExpr.or(ContextKeyExpr.and(InlineCompletionContextKeys.inlineSuggestionVisible,EditorContextKeys.tabMovesFocus.toNegated(),Context$2.Visible.toNegated(),EditorContextKeys.hoverFocused.toNegated(),InlineCompletionContextKeys.hasSelection.toNegated(),InlineCompletionContextKeys.inlineSuggestionHasIndentationLessThanTabSize),ContextKeyExpr.and(InlineCompletionContextKeys.inlineEditVisible,EditorContextKeys.tabMovesFocus.toNegated(),Context$2.Visible.toNegated(),EditorContextKeys.hoverFocused.toNegated(),InlineCompletionContextKeys.tabShouldAcceptInlineEdit))}]})}async run(e,t){var o;const s=InlineCompletionsController.getInFocusedEditorOrParent(e);s&&((o=s.model.get())==null||o.accept(s.editor),s.editor.focus())}}KeybindingsRegistry.registerKeybindingRule({id:inlineSuggestCommitId,weight:202,primary:2,when:ContextKeyExpr.and(InlineCompletionContextKeys.inInlineEditsPreviewEditor)});class JumpToNextInlineEdit extends EditorAction{constructor(){super({id:jumpToNextInlineEditId,label:localize2(1181,"Jump to next inline edit"),precondition:InlineCompletionContextKeys.inlineEditVisible,menuOpts:[{menuId:MenuId.InlineEditsActions,title:localize(1170,"Jump"),group:"primary",order:1,when:InlineCompletionContextKeys.cursorAtInlineEdit.toNegated()}],kbOpts:{primary:2,weight:201,kbExpr:ContextKeyExpr.and(InlineCompletionContextKeys.inlineEditVisible,EditorContextKeys.tabMovesFocus.toNegated(),Context$2.Visible.toNegated(),EditorContextKeys.hoverFocused.toNegated(),InlineCompletionContextKeys.tabShouldJumpToInlineEdit)}})}async run(e,t){const s=InlineCompletionsController.get(t);s&&s.jump()}}const Qs=class Qs extends EditorAction{constructor(){super({id:Qs.ID,label:localize2(1182,"Hide Inline Suggestion"),precondition:ContextKeyExpr.or(InlineCompletionContextKeys.inlineSuggestionVisible,InlineCompletionContextKeys.inlineEditVisible),kbOpts:{weight:100+90,primary:9},menuOpts:[{menuId:MenuId.InlineEditsActions,title:localize(1171,"Reject"),group:"primary",order:3}]})}async run(e,t){const s=InlineCompletionsController.getInFocusedEditorOrParent(e);transaction(o=>{var r;(r=s==null?void 0:s.model.get())==null||r.stop("explicitCancel",o)}),s==null||s.editor.focus()}};Qs.ID=hideInlineCompletionId;let HideInlineCompletion=Qs;const Ys=class Ys extends EditorAction{constructor(){super({id:Ys.ID,label:localize2(1183,"Toggle Inline Suggestions Show Collapsed"),precondition:ContextKeyExpr.true()})}async run(e,t){const s=e.get(IConfigurationService),o=s.getValue("editor.inlineSuggest.edits.showCollapsed");s.updateValue("editor.inlineSuggest.edits.showCollapsed",!o)}};Ys.ID=toggleShowCollapsedId;let ToggleInlineCompletionShowCollapsed=Ys;KeybindingsRegistry.registerKeybindingRule({id:HideInlineCompletion.ID,weight:-1,primary:9,secondary:[1033],when:ContextKeyExpr.and(InlineCompletionContextKeys.inInlineEditsPreviewEditor)});const Xs=class Xs extends Action2{constructor(){super({id:Xs.ID,title:localize(1172,"Always Show Toolbar"),f1:!1,precondition:void 0,menu:[{id:MenuId.InlineSuggestionToolbar,group:"secondary",order:10}],toggled:ContextKeyExpr.equals("config.editor.inlineSuggest.showToolbar","always")})}async run(e){const t=e.get(IConfigurationService),o=t.getValue("editor.inlineSuggest.showToolbar")==="always"?"onHover":"always";t.updateValue("editor.inlineSuggest.showToolbar",o)}};Xs.ID="editor.action.inlineSuggest.toggleAlwaysShowToolbar";let ToggleAlwaysShowInlineSuggestionToolbar=Xs;class DevExtractReproSample extends EditorAction{constructor(){super({id:"editor.action.inlineSuggest.dev.extractRepro",label:localize(1173,"Developer: Extract Inline Suggest State"),alias:"Developer: Inline Suggest Extract Repro",precondition:ContextKeyExpr.or(InlineCompletionContextKeys.inlineEditVisible,InlineCompletionContextKeys.inlineSuggestionVisible)})}async run(e,t){const s=e.get(IClipboardService),o=InlineCompletionsController.get(t),r=o==null?void 0:o.model.get();if(!r)return;const l=r.extractReproSample(),d=splitLines(JSON.stringify({inlineCompletion:l.inlineCompletion},null,4)).map(g=>"// "+g).join(`
`),u=`${l.documentValue}

// <json>
${d}
// </json>
`;return await s.writeText(u),{reproCase:u}}}var __decorate$$=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$_=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class InlineCompletionsHover{constructor(e,t,s){this.owner=e,this.range=t,this.controller=s}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}let InlineCompletionsHoverParticipant=class{constructor(e,t,s,o,r,l){this._editor=e,this._languageService=t,this._openerService=s,this.accessibilityService=o,this._instantiationService=r,this._telemetryService=l,this.hoverOrdinal=4}suggestHoverAnchor(e){const t=InlineCompletionsController.get(this._editor);if(!t)return null;const s=e.target;if(s.type===8){const o=s.detail;if(t.shouldShowHoverAtViewZone(o.viewZoneId))return new HoverForeignElementAnchor(1e3,this,Range$2.fromPositions(this._editor.getModel().validatePosition(o.positionBefore||o.position)),e.event.posx,e.event.posy,!1)}if(s.type===7&&t.shouldShowHoverAt(s.range))return new HoverForeignElementAnchor(1e3,this,s.range,e.event.posx,e.event.posy,!1);if(s.type===6&&s.detail.mightBeForeignElement&&t.shouldShowHoverAt(s.range))return new HoverForeignElementAnchor(1e3,this,s.range,e.event.posx,e.event.posy,!1);if(s.type===9&&s.element){const o=GhostTextView.getWarningWidgetContext(s.element);if(o&&t.shouldShowHoverAt(o.range))return new HoverForeignElementAnchor(1e3,this,o.range,e.event.posx,e.event.posy,!1)}return null}computeSync(e,t){if(this._editor.getOption(71).showToolbar!=="onHover")return[];const s=InlineCompletionsController.get(this._editor);return s&&s.shouldShowHoverAt(e.range)?[new InlineCompletionsHover(this,e.range,s)]:[]}renderHoverParts(e,t){const s=new DisposableStore,o=t[0];this._telemetryService.publicLog2("inlineCompletionHover.shown"),this.accessibilityService.isScreenReaderOptimized()&&!this._editor.getOption(12)&&s.add(this.renderScreenReaderText(e,o));const r=o.controller.model.get(),l=document.createElement("div");e.fragment.appendChild(l),s.add(autorunWithStore((d,u)=>{const g=u.add(this._instantiationService.createInstance(InlineSuggestionHintsContentWidget.hot.read(d),this._editor,!1,constObservable(null),r.selectedInlineCompletionIndex,r.inlineCompletionsCount,r.activeCommands,r.warning,()=>{e.onContentsChanged()}));l.replaceChildren(g.getDomNode())})),r.triggerExplicitly();const c={hoverPart:o,hoverElement:l,dispose(){s.dispose()}};return new RenderedHoverParts([c])}renderScreenReaderText(e,t){const s=new DisposableStore,o=$$l,r=o("div.hover-row.markdown-hover"),l=append$2(r,o("div.hover-contents",{"aria-live":"assertive"})),c=new MarkdownRenderer({editor:this._editor},this._languageService,this._openerService),d=u=>{const g=localize(1197,"Suggestion:"),f=s.add(c.render(new MarkdownString().appendText(g).appendCodeblock("text",u),{asyncRenderCallback:()=>{l.className="hover-contents code-hover-contents",e.onContentsChanged()}}));l.replaceChildren(f.element)};return s.add(autorun(u=>{var f;const g=(f=t.controller.model.read(u))==null?void 0:f.primaryGhostText.read(u);if(g){const p=this._editor.getModel().getLineContent(g.lineNumber);d(g.renderForScreenReader(p))}else reset(l)})),e.fragment.appendChild(r),s}};InlineCompletionsHoverParticipant=__decorate$$([__param$_(1,ILanguageService),__param$_(2,IOpenerService),__param$_(3,IAccessibilityService),__param$_(4,IInstantiationService),__param$_(5,ITelemetryService)],InlineCompletionsHoverParticipant);class InlineCompletionsAccessibleView{}registerEditorContribution(InlineCompletionsController.ID,wrapInHotClass1(InlineCompletionsController.hot),3);registerEditorAction(TriggerInlineSuggestionAction);registerEditorAction(ExplicitTriggerInlineEditAction);registerEditorCommand(new TriggerInlineEditAction);registerEditorAction(ShowNextInlineSuggestionAction);registerEditorAction(ShowPreviousInlineSuggestionAction);registerEditorAction(AcceptNextWordOfInlineCompletion);registerEditorAction(AcceptNextLineOfInlineCompletion);registerEditorAction(AcceptInlineCompletion);registerEditorAction(ToggleInlineCompletionShowCollapsed);registerEditorAction(HideInlineCompletion);registerEditorAction(JumpToNextInlineEdit);registerAction2(ToggleAlwaysShowInlineSuggestionToolbar);registerEditorAction(DevExtractReproSample);registerAction2(SnoozeInlineCompletion);registerAction2(CancelSnoozeInlineCompletion);HoverParticipantRegistry.register(InlineCompletionsHoverParticipant);AccessibleViewRegistry.register(new InlineCompletionsAccessibleView);const goToDefinitionAtPosition="";var __decorate$_=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$Z=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},GotoDefinitionAtPositionEditorContribution_1,Bt;let GotoDefinitionAtPositionEditorContribution=(Bt=class{constructor(e,t,s,o){this.textModelResolverService=t,this.languageService=s,this.languageFeaturesService=o,this.toUnhook=new DisposableStore,this.toUnhookForKeyboard=new DisposableStore,this.currentWordAtPosition=null,this.previousPromise=null,this.editor=e,this.linkDecorations=this.editor.createDecorationsCollection();const r=new ClickLinkGesture(e);this.toUnhook.add(r),this.toUnhook.add(r.onMouseMoveOrRelevantKeyDown(([l,c])=>{this.startFindDefinitionFromMouse(l,c??void 0)})),this.toUnhook.add(r.onExecute(l=>{this.isEnabled(l)&&this.gotoDefinition(l.target.position,l.hasSideBySideModifier).catch(c=>{onUnexpectedError(c)}).finally(()=>{this.removeLinkDecorations()})})),this.toUnhook.add(r.onCancel(()=>{this.removeLinkDecorations(),this.currentWordAtPosition=null}))}static get(e){return e.getContribution(GotoDefinitionAtPositionEditorContribution_1.ID)}async startFindDefinitionFromCursor(e){await this.startFindDefinition(e),this.toUnhookForKeyboard.add(this.editor.onDidChangeCursorPosition(()=>{this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear()})),this.toUnhookForKeyboard.add(this.editor.onKeyDown(t=>{t&&(this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear())}))}startFindDefinitionFromMouse(e,t){if(e.target.type===9&&this.linkDecorations.length>0)return;if(!this.editor.hasModel()||!this.isEnabled(e,t)){this.currentWordAtPosition=null,this.removeLinkDecorations();return}const s=e.target.position;this.startFindDefinition(s)}async startFindDefinition(e){var l;this.toUnhookForKeyboard.clear();const t=e?(l=this.editor.getModel())==null?void 0:l.getWordAtPosition(e):null;if(!t){this.currentWordAtPosition=null,this.removeLinkDecorations();return}if(this.currentWordAtPosition&&this.currentWordAtPosition.startColumn===t.startColumn&&this.currentWordAtPosition.endColumn===t.endColumn&&this.currentWordAtPosition.word===t.word)return;this.currentWordAtPosition=t;const s=new EditorState$1(this.editor,15);this.previousPromise&&(this.previousPromise.cancel(),this.previousPromise=null),this.previousPromise=createCancelablePromise(c=>this.findDefinition(e,c));let o;try{o=await this.previousPromise}catch(c){onUnexpectedError(c);return}if(!o||!o.length||!s.validate(this.editor)){this.removeLinkDecorations();return}const r=o[0].originSelectionRange?Range$2.lift(o[0].originSelectionRange):new Range$2(e.lineNumber,t.startColumn,e.lineNumber,t.endColumn);if(o.length>1){let c=r;for(const{originSelectionRange:d}of o)d&&(c=Range$2.plusRange(c,d));this.addDecoration(c,new MarkdownString().appendText(localize(1072,"Click to show {0} definitions.",o.length)))}else{const c=o[0];return c.uri?this.textModelResolverService.createModelReference(c.uri).then(d=>{if(!d.object||!d.object.textEditorModel){d.dispose();return}const{object:{textEditorModel:u}}=d,{startLineNumber:g}=c.range;if(g<1||g>u.getLineCount()){d.dispose();return}const f=this.getPreviewValue(u,g,c),p=this.languageService.guessLanguageIdByFilepathOrFirstLine(u.uri);this.addDecoration(r,f?new MarkdownString().appendCodeblock(p||"",f):void 0),d.dispose()}):void 0}}getPreviewValue(e,t,s){let o=s.range;return o.endLineNumber-o.startLineNumber>=GotoDefinitionAtPositionEditorContribution_1.MAX_SOURCE_PREVIEW_LINES&&(o=this.getPreviewRangeBasedOnIndentation(e,t)),o=e.validateRange(o),this.stripIndentationFromPreviewRange(e,t,o)}stripIndentationFromPreviewRange(e,t,s){let r=e.getLineFirstNonWhitespaceColumn(t);for(let c=t+1;c<s.endLineNumber;c++){const d=e.getLineFirstNonWhitespaceColumn(c);r=Math.min(r,d)}return e.getValueInRange(s).replace(new RegExp(`^\\s{${r-1}}`,"gm"),"").trim()}getPreviewRangeBasedOnIndentation(e,t){const s=e.getLineFirstNonWhitespaceColumn(t),o=Math.min(e.getLineCount(),t+GotoDefinitionAtPositionEditorContribution_1.MAX_SOURCE_PREVIEW_LINES);let r=t+1;for(;r<o;r++){const l=e.getLineFirstNonWhitespaceColumn(r);if(s===l)break}return new Range$2(t,1,r+1,1)}addDecoration(e,t){const s={range:e,options:{description:"goto-definition-link",inlineClassName:"goto-definition-link",hoverMessage:t}};this.linkDecorations.set([s])}removeLinkDecorations(){this.linkDecorations.clear()}isEnabled(e,t){var s;return this.editor.hasModel()&&e.isLeftClick&&e.isNoneOrSingleMouseDown&&e.target.type===6&&!(((s=e.target.detail.injectedText)==null?void 0:s.options)instanceof ModelDecorationInjectedTextOptions)&&(e.hasTriggerModifier||(t?t.keyCodeIsTriggerKey:!1))&&this.languageFeaturesService.definitionProvider.has(this.editor.getModel())}findDefinition(e,t){const s=this.editor.getModel();return s?getDefinitionsAtPosition(this.languageFeaturesService.definitionProvider,s,e,!1,t):Promise.resolve(null)}gotoDefinition(e,t){return this.editor.setPosition(e),this.editor.invokeWithinContext(s=>{const o=!t&&this.editor.getOption(101)&&!this.isInPeekEditor(s);return new DefinitionAction({openToSide:t,openInPeek:o,muteMessage:!0},{title:{value:"",original:""},id:"",precondition:void 0}).run(s)})}isInPeekEditor(e){const t=e.get(IContextKeyService);return PeekContext.inPeekEditor.getValue(t)}dispose(){this.toUnhook.dispose(),this.toUnhookForKeyboard.dispose()}},GotoDefinitionAtPositionEditorContribution_1=Bt,Bt.ID="editor.contrib.gotodefinitionatposition",Bt.MAX_SOURCE_PREVIEW_LINES=8,Bt);GotoDefinitionAtPositionEditorContribution=GotoDefinitionAtPositionEditorContribution_1=__decorate$_([__param$Z(1,ITextModelService),__param$Z(2,ILanguageService),__param$Z(3,ILanguageFeaturesService)],GotoDefinitionAtPositionEditorContribution);registerEditorContribution(GotoDefinitionAtPositionEditorContribution.ID,GotoDefinitionAtPositionEditorContribution,2);var __decorate$Z=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$Y=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class MarkerCoordinate{constructor(e,t,s){this.marker=e,this.index=t,this.total=s}}let MarkerList=class{constructor(e,t,s){this._markerService=t,this._configService=s,this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._dispoables=new DisposableStore,this._markers=[],this._nextIdx=-1,URI.isUri(e)?this._resourceFilter=c=>c.toString()===e.toString():e&&(this._resourceFilter=e);const o=this._configService.getValue("problems.sortOrder"),r=(c,d)=>{let u=compare(c.resource.toString(),d.resource.toString());return u===0&&(o==="position"?u=Range$2.compareRangesUsingStarts(c,d)||MarkerSeverity$2.compare(c.severity,d.severity):u=MarkerSeverity$2.compare(c.severity,d.severity)||Range$2.compareRangesUsingStarts(c,d)),u},l=()=>{let c=this._markerService.read({resource:URI.isUri(e)?e:void 0,severities:MarkerSeverity$2.Error|MarkerSeverity$2.Warning|MarkerSeverity$2.Info});return typeof e=="function"&&(c=c.filter(d=>this._resourceFilter(d.resource))),c.sort(r),equals$1(c,this._markers,(d,u)=>d.resource.toString()===u.resource.toString()&&d.startLineNumber===u.startLineNumber&&d.startColumn===u.startColumn&&d.endLineNumber===u.endLineNumber&&d.endColumn===u.endColumn&&d.severity===u.severity&&d.message===u.message)?!1:(this._markers=c,!0)};l(),this._dispoables.add(t.onMarkerChanged(c=>{(!this._resourceFilter||c.some(d=>this._resourceFilter(d)))&&l()&&(this._nextIdx=-1,this._onDidChange.fire())}))}dispose(){this._dispoables.dispose(),this._onDidChange.dispose()}matches(e){return!this._resourceFilter&&!e?!0:!this._resourceFilter||!e?!1:this._resourceFilter(e)}get selected(){const e=this._markers[this._nextIdx];return e&&new MarkerCoordinate(e,this._nextIdx+1,this._markers.length)}_initIdx(e,t,s){let o=this._markers.findIndex(r=>isEqual(r.resource,e.uri));if(o<0)o=binarySearch2(this._markers.length,r=>compare(this._markers[r].resource.toString(),e.uri.toString())),o<0&&(o=~o),s?this._nextIdx=o:this._nextIdx=(this._markers.length+o-1)%this._markers.length;else{let r=!1,l=!1;for(let c=o;c<this._markers.length;c++){let d=Range$2.lift(this._markers[c]);if(d.isEmpty()){const u=e.getWordAtPosition(d.getStartPosition());u&&(d=new Range$2(d.startLineNumber,u.startColumn,d.startLineNumber,u.endColumn))}if(t&&(d.containsPosition(t)||t.isBeforeOrEqual(d.getStartPosition()))){this._nextIdx=c,r=!0,l=!d.containsPosition(t);break}if(this._markers[c].resource.toString()!==e.uri.toString())break}r?l&&!s&&(this._nextIdx-=1):this._nextIdx=s?0:this._markers.length-1}this._nextIdx<0&&(this._nextIdx=this._markers.length-1)}resetIndex(){this._nextIdx=-1}move(e,t,s){if(this._markers.length===0)return!1;const o=this._nextIdx;return this._nextIdx===-1?this._initIdx(t,s,e):e?this._nextIdx=(this._nextIdx+1)%this._markers.length:e||(this._nextIdx=(this._nextIdx-1+this._markers.length)%this._markers.length),o!==this._nextIdx}find(e,t){let s=this._markers.findIndex(o=>o.resource.toString()===e.toString());if(!(s<0)){for(;s<this._markers.length;s++)if(Range$2.containsPosition(this._markers[s],t))return new MarkerCoordinate(this._markers[s],s+1,this._markers.length)}}};MarkerList=__decorate$Z([__param$Y(1,IMarkerService),__param$Y(2,IConfigurationService)],MarkerList);const IMarkerNavigationService=createDecorator("IMarkerNavigationService");let MarkerNavigationService=class{constructor(e,t){this._markerService=e,this._configService=t,this._provider=new LinkedList}getMarkerList(e){for(const t of this._provider){const s=t.getMarkerList(e);if(s)return s}return new MarkerList(e,this._markerService,this._configService)}};MarkerNavigationService=__decorate$Z([__param$Y(0,IMarkerService),__param$Y(1,IConfigurationService)],MarkerNavigationService);registerSingleton(IMarkerNavigationService,MarkerNavigationService,1);const gotoErrorWidget="",severityIcon="";var SeverityIcon;(function(a){function e(t){switch(t){case Severity$2.Ignore:return"severity-ignore "+ThemeIcon.asClassName(Codicon.info);case Severity$2.Info:return ThemeIcon.asClassName(Codicon.info);case Severity$2.Warning:return ThemeIcon.asClassName(Codicon.warning);case Severity$2.Error:return ThemeIcon.asClassName(Codicon.error);default:return""}}a.className=e})(SeverityIcon||(SeverityIcon={}));var __decorate$Y=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$X=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},MarkerNavigationWidget_1;class MessageWidget{constructor(e,t,s,o,r){this._openerService=o,this._labelService=r,this._lines=0,this._longestLineLength=0,this._relatedDiagnostics=new WeakMap,this._disposables=new DisposableStore,this._editor=t;const l=document.createElement("div");l.className="descriptioncontainer",this._messageBlock=document.createElement("div"),this._messageBlock.classList.add("message"),this._messageBlock.setAttribute("aria-live","assertive"),this._messageBlock.setAttribute("role","alert"),l.appendChild(this._messageBlock),this._relatedBlock=document.createElement("div"),l.appendChild(this._relatedBlock),this._disposables.add(addStandardDisposableListener(this._relatedBlock,"click",c=>{c.preventDefault();const d=this._relatedDiagnostics.get(c.target);d&&s(d)})),this._scrollable=new ScrollableElement(l,{horizontal:1,vertical:1,useShadows:!1,horizontalScrollbarSize:6,verticalScrollbarSize:6}),e.appendChild(this._scrollable.getDomNode()),this._disposables.add(this._scrollable.onScroll(c=>{l.style.left=`-${c.scrollLeft}px`,l.style.top=`-${c.scrollTop}px`})),this._disposables.add(this._scrollable)}dispose(){dispose(this._disposables)}update(e){const{source:t,message:s,relatedInformation:o,code:r}=e;let l=((t==null?void 0:t.length)||0)+2;r&&(typeof r=="string"?l+=r.length:l+=r.value.length);const c=splitLines(s);this._lines=c.length,this._longestLineLength=0;for(const p of c)this._longestLineLength=Math.max(p.length+l,this._longestLineLength);clearNode(this._messageBlock),this._messageBlock.setAttribute("aria-label",this.getAriaLabel(e)),this._editor.applyFontInfo(this._messageBlock);let d=this._messageBlock;for(const p of c)d=document.createElement("div"),d.innerText=p,p===""&&(d.style.height=this._messageBlock.style.lineHeight),this._messageBlock.appendChild(d);if(t||r){const p=document.createElement("span");if(p.classList.add("details"),d.appendChild(p),t){const m=document.createElement("span");m.innerText=t,m.classList.add("source"),p.appendChild(m)}if(r)if(typeof r=="string"){const m=document.createElement("span");m.innerText=`(${r})`,m.classList.add("code"),p.appendChild(m)}else{this._codeLink=$$l("a.code-link"),this._codeLink.setAttribute("href",`${r.target.toString()}`),this._codeLink.onclick=_=>{this._openerService.open(r.target,{allowCommands:!0}),_.preventDefault(),_.stopPropagation()};const m=append$2(this._codeLink,$$l("span"));m.innerText=r.value,p.appendChild(this._codeLink)}}if(clearNode(this._relatedBlock),this._editor.applyFontInfo(this._relatedBlock),isNonEmptyArray(o)){const p=this._relatedBlock.appendChild(document.createElement("div"));p.style.paddingTop=`${Math.floor(this._editor.getOption(75)*.66)}px`,this._lines+=1;for(const m of o){const _=document.createElement("div"),C=document.createElement("a");C.classList.add("filename"),C.innerText=`${this._labelService.getUriBasenameLabel(m.resource)}(${m.startLineNumber}, ${m.startColumn}): `,C.title=this._labelService.getUriLabel(m.resource),this._relatedDiagnostics.set(C,m);const b=document.createElement("span");b.innerText=m.message,_.appendChild(C),_.appendChild(b),this._lines+=1,p.appendChild(_)}}const u=this._editor.getOption(59),g=Math.ceil(u.typicalFullwidthCharacterWidth*this._longestLineLength*.75),f=u.lineHeight*this._lines;this._scrollable.setScrollDimensions({scrollWidth:g,scrollHeight:f})}layout(e,t){this._scrollable.getDomNode().style.height=`${e}px`,this._scrollable.getDomNode().style.width=`${t}px`,this._scrollable.setScrollDimensions({width:t,height:e})}getHeightInLines(){return Math.min(17,this._lines)}getAriaLabel(e){let t="";switch(e.severity){case MarkerSeverity$2.Error:t=localize(1019,"Error");break;case MarkerSeverity$2.Warning:t=localize(1020,"Warning");break;case MarkerSeverity$2.Info:t=localize(1021,"Info");break;case MarkerSeverity$2.Hint:t=localize(1022,"Hint");break}let s=localize(1023,"{0} at {1}. ",t,e.startLineNumber+":"+e.startColumn);const o=this._editor.getModel();return o&&e.startLineNumber<=o.getLineCount()&&e.startLineNumber>=1&&(s=`${o.getLineContent(e.startLineNumber)}, ${s}`),s}}var Gi;let MarkerNavigationWidget=(Gi=class extends PeekViewWidget{constructor(e,t,s,o,r,l,c){super(e,{showArrow:!0,showFrame:!0,isAccessible:!0,frameWidth:1},r),this._themeService=t,this._openerService=s,this._menuService=o,this._contextKeyService=l,this._labelService=c,this._callOnDispose=new DisposableStore,this._onDidSelectRelatedInformation=new Emitter$1,this.onDidSelectRelatedInformation=this._onDidSelectRelatedInformation.event,this._severity=MarkerSeverity$2.Warning,this._backgroundColor=Color.white,this._applyTheme(t.getColorTheme()),this._callOnDispose.add(t.onDidColorThemeChange(this._applyTheme.bind(this))),this.create()}_applyTheme(e){this._backgroundColor=e.getColor(editorMarkerNavigationBackground);let t=editorMarkerNavigationError,s=editorMarkerNavigationErrorHeader;this._severity===MarkerSeverity$2.Warning?(t=editorMarkerNavigationWarning,s=editorMarkerNavigationWarningHeader):this._severity===MarkerSeverity$2.Info&&(t=editorMarkerNavigationInfo,s=editorMarkerNavigationInfoHeader);const o=e.getColor(t),r=e.getColor(s);this.style({arrowColor:o,frameColor:o,headerBackgroundColor:r,primaryHeadingColor:e.getColor(peekViewTitleForeground),secondaryHeadingColor:e.getColor(peekViewTitleInfoForeground)})}_applyStyles(){this._parentContainer&&(this._parentContainer.style.backgroundColor=this._backgroundColor?this._backgroundColor.toString():""),super._applyStyles()}dispose(){this._callOnDispose.dispose(),super.dispose()}_fillHead(e){super._fillHead(e),this._disposables.add(this._actionbarWidget.actionRunner.onWillRun(o=>this.editor.focus()));const t=this._menuService.getMenuActions(MarkerNavigationWidget_1.TitleMenu,this._contextKeyService),s=getFlatActionBarActions(t);this._actionbarWidget.push(s,{label:!1,icon:!0,index:0})}_fillTitleIcon(e){this._icon=append$2(e,$$l(""))}_fillBody(e){this._parentContainer=e,e.classList.add("marker-widget"),this._parentContainer.tabIndex=0,this._parentContainer.setAttribute("role","tooltip"),this._container=document.createElement("div"),e.appendChild(this._container),this._message=new MessageWidget(this._container,this.editor,t=>this._onDidSelectRelatedInformation.fire(t),this._openerService,this._labelService),this._disposables.add(this._message)}show(){throw new Error("call showAtMarker")}showAtMarker(e,t,s){this._container.classList.remove("stale"),this._message.update(e),this._severity=e.severity,this._applyTheme(this._themeService.getColorTheme());const o=Range$2.lift(e),r=this.editor.getPosition(),l=r&&o.containsPosition(r)?r:o.getStartPosition();super.show(l,this.computeRequiredHeight());const c=this.editor.getModel();if(c){const d=s>1?localize(1024,"{0} of {1} problems",t,s):localize(1025,"{0} of {1} problem",t,s);this.setTitle(basename(c.uri),d)}this._icon.className=`codicon ${SeverityIcon.className(MarkerSeverity$2.toSeverity(this._severity))}`,this.editor.revealPositionNearTop(l,0),this.editor.focus()}updateMarker(e){this._container.classList.remove("stale"),this._message.update(e)}showStale(){this._container.classList.add("stale"),this._relayout()}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._heightInPixel=e,this._message.layout(e,t),this._container.style.height=`${e}px`}_onWidth(e){this._message.layout(this._heightInPixel,e)}_relayout(){super._relayout(this.computeRequiredHeight())}computeRequiredHeight(){return 3+this._message.getHeightInLines()}},MarkerNavigationWidget_1=Gi,Gi.TitleMenu=new MenuId("gotoErrorTitleMenu"),Gi);MarkerNavigationWidget=MarkerNavigationWidget_1=__decorate$Y([__param$X(1,IThemeService),__param$X(2,IOpenerService),__param$X(3,IMenuService),__param$X(4,IInstantiationService),__param$X(5,IContextKeyService),__param$X(6,ILabelService)],MarkerNavigationWidget);const errorDefault=oneOf(editorErrorForeground,editorErrorBorder),warningDefault=oneOf(editorWarningForeground,editorWarningBorder),infoDefault=oneOf(editorInfoForeground,editorInfoBorder),editorMarkerNavigationError=registerColor("editorMarkerNavigationError.background",{dark:errorDefault,light:errorDefault,hcDark:contrastBorder,hcLight:contrastBorder},localize(1026,"Editor marker navigation widget error color.")),editorMarkerNavigationErrorHeader=registerColor("editorMarkerNavigationError.headerBackground",{dark:transparent(editorMarkerNavigationError,.1),light:transparent(editorMarkerNavigationError,.1),hcDark:null,hcLight:null},localize(1027,"Editor marker navigation widget error heading background.")),editorMarkerNavigationWarning=registerColor("editorMarkerNavigationWarning.background",{dark:warningDefault,light:warningDefault,hcDark:contrastBorder,hcLight:contrastBorder},localize(1028,"Editor marker navigation widget warning color.")),editorMarkerNavigationWarningHeader=registerColor("editorMarkerNavigationWarning.headerBackground",{dark:transparent(editorMarkerNavigationWarning,.1),light:transparent(editorMarkerNavigationWarning,.1),hcDark:"#0C141F",hcLight:transparent(editorMarkerNavigationWarning,.2)},localize(1029,"Editor marker navigation widget warning heading background.")),editorMarkerNavigationInfo=registerColor("editorMarkerNavigationInfo.background",{dark:infoDefault,light:infoDefault,hcDark:contrastBorder,hcLight:contrastBorder},localize(1030,"Editor marker navigation widget info color.")),editorMarkerNavigationInfoHeader=registerColor("editorMarkerNavigationInfo.headerBackground",{dark:transparent(editorMarkerNavigationInfo,.1),light:transparent(editorMarkerNavigationInfo,.1),hcDark:null,hcLight:null},localize(1031,"Editor marker navigation widget info heading background.")),editorMarkerNavigationBackground=registerColor("editorMarkerNavigation.background",editorBackground,localize(1032,"Editor marker navigation widget background."));var __decorate$X=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$W=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},MarkerController_1,ji;let MarkerController=(ji=class{static get(e){return e.getContribution(MarkerController_1.ID)}constructor(e,t,s,o,r){this._markerNavigationService=t,this._contextKeyService=s,this._editorService=o,this._instantiationService=r,this._sessionDispoables=new DisposableStore,this._editor=e,this._widgetVisible=CONTEXT_MARKERS_NAVIGATION_VISIBLE.bindTo(this._contextKeyService)}dispose(){this._cleanUp(),this._sessionDispoables.dispose()}_cleanUp(){this._widgetVisible.reset(),this._sessionDispoables.clear(),this._widget=void 0,this._model=void 0}_getOrCreateModel(e){if(this._model&&this._model.matches(e))return this._model;let t=!1;return this._model&&(t=!0,this._cleanUp()),this._model=this._markerNavigationService.getMarkerList(e),t&&this._model.move(!0,this._editor.getModel(),this._editor.getPosition()),this._widget=this._instantiationService.createInstance(MarkerNavigationWidget,this._editor),this._widget.onDidClose(()=>this.close(),this,this._sessionDispoables),this._widgetVisible.set(!0),this._sessionDispoables.add(this._model),this._sessionDispoables.add(this._widget),this._sessionDispoables.add(this._editor.onDidChangeCursorPosition(s=>{var o,r,l;(!((o=this._model)!=null&&o.selected)||!Range$2.containsPosition((r=this._model)==null?void 0:r.selected.marker,s.position))&&((l=this._model)==null||l.resetIndex())})),this._sessionDispoables.add(this._model.onDidChange(()=>{if(!this._widget||!this._widget.position||!this._model)return;const s=this._model.find(this._editor.getModel().uri,this._widget.position);s?this._widget.updateMarker(s.marker):this._widget.showStale()})),this._sessionDispoables.add(this._widget.onDidSelectRelatedInformation(s=>{this._editorService.openCodeEditor({resource:s.resource,options:{pinned:!0,revealIfOpened:!0,selection:Range$2.lift(s).collapseToStart()}},this._editor),this.close(!1)})),this._sessionDispoables.add(this._editor.onDidChangeModel(()=>this._cleanUp())),this._model}close(e=!0){this._cleanUp(),e&&this._editor.focus()}showAtMarker(e){if(!this._editor.hasModel())return;const t=this._editor.getModel(),s=this._getOrCreateModel(t.uri);s.resetIndex(),s.move(!0,t,new Position$1(e.startLineNumber,e.startColumn)),s.selected&&this._widget.showAtMarker(s.selected.marker,s.selected.index,s.selected.total)}async navigate(e,t){var r,l;if(!this._editor.hasModel())return;const s=this._editor.getModel(),o=this._getOrCreateModel(t?void 0:s.uri);if(o.move(e,s,this._editor.getPosition()),!!o.selected)if(o.selected.marker.resource.toString()!==s.uri.toString()){this._cleanUp();const c=await this._editorService.openCodeEditor({resource:o.selected.marker.resource,options:{pinned:!1,revealIfOpened:!0,selectionRevealType:2,selection:o.selected.marker}},this._editor);c&&((r=MarkerController_1.get(c))==null||r.close(),(l=MarkerController_1.get(c))==null||l.navigate(e,t))}else this._widget.showAtMarker(o.selected.marker,o.selected.index,o.selected.total)}},MarkerController_1=ji,ji.ID="editor.contrib.markerController",ji);MarkerController=MarkerController_1=__decorate$X([__param$W(1,IMarkerNavigationService),__param$W(2,IContextKeyService),__param$W(3,ICodeEditorService),__param$W(4,IInstantiationService)],MarkerController);class MarkerNavigationAction extends EditorAction{constructor(e,t,s){super(s),this._next=e,this._multiFile=t}async run(e,t){var s;t.hasModel()&&await((s=MarkerController.get(t))==null?void 0:s.navigate(this._next,this._multiFile))}}const Lt=class Lt extends MarkerNavigationAction{constructor(){super(!0,!1,{id:Lt.ID,label:Lt.LABEL,precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:578,weight:100},menuOpts:{menuId:MarkerNavigationWidget.TitleMenu,title:Lt.LABEL.value,icon:registerIcon("marker-navigation-next",Codicon.arrowDown,localize(1011,"Icon for goto next marker.")),group:"navigation",order:1}})}};Lt.ID="editor.action.marker.next",Lt.LABEL=localize2(1015,"Go to Next Problem (Error, Warning, Info)");let NextMarkerAction=Lt;const Et=class Et extends MarkerNavigationAction{constructor(){super(!1,!1,{id:Et.ID,label:Et.LABEL,precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:1602,weight:100},menuOpts:{menuId:MarkerNavigationWidget.TitleMenu,title:Et.LABEL.value,icon:registerIcon("marker-navigation-previous",Codicon.arrowUp,localize(1012,"Icon for goto previous marker.")),group:"navigation",order:2}})}};Et.ID="editor.action.marker.prev",Et.LABEL=localize2(1016,"Go to Previous Problem (Error, Warning, Info)");let PrevMarkerAction=Et;class NextMarkerInFilesAction extends MarkerNavigationAction{constructor(){super(!0,!0,{id:"editor.action.marker.nextInFiles",label:localize2(1017,"Go to Next Problem in Files (Error, Warning, Info)"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:66,weight:100},menuOpts:{menuId:MenuId.MenubarGoMenu,title:localize(1013,"Next &&Problem"),group:"6_problem_nav",order:1}})}}class PrevMarkerInFilesAction extends MarkerNavigationAction{constructor(){super(!1,!0,{id:"editor.action.marker.prevInFiles",label:localize2(1018,"Go to Previous Problem in Files (Error, Warning, Info)"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:1090,weight:100},menuOpts:{menuId:MenuId.MenubarGoMenu,title:localize(1014,"Previous &&Problem"),group:"6_problem_nav",order:2}})}}registerEditorContribution(MarkerController.ID,MarkerController,4);registerEditorAction(NextMarkerAction);registerEditorAction(PrevMarkerAction);registerEditorAction(NextMarkerInFilesAction);registerEditorAction(PrevMarkerInFilesAction);const CONTEXT_MARKERS_NAVIGATION_VISIBLE=new RawContextKey("markersNavigationVisible",!1),MarkerCommand=EditorCommand.bindToContribution(MarkerController.get);registerEditorCommand(new MarkerCommand({id:"closeMarkersNavigation",precondition:CONTEXT_MARKERS_NAVIGATION_VISIBLE,handler:a=>a.close(),kbOpts:{weight:100+50,kbExpr:EditorContextKeys.focus,primary:9,secondary:[1033]}}));class DebugEditorGpuRendererAction extends EditorAction{constructor(){super({id:"editor.action.debugEditorGpuRenderer",label:localize2(1096,"Developer: Debug Editor GPU Renderer"),precondition:ContextKeyExpr.true()})}async run(e,t){const s=e.get(IInstantiationService),r=await e.get(IQuickInputService).pick([{label:localize(1093,"Log Texture Atlas Stats"),id:"logTextureAtlasStats"},{label:localize(1094,"Save Texture Atlas"),id:"saveTextureAtlas"},{label:localize(1095,"Draw Glyph"),id:"drawGlyph"}],{canPickMany:!1});if(r)switch(r.id){case"logTextureAtlasStats":s.invokeFunction(l=>{const c=l.get(ILogService),d=ViewGpuContext.atlas;if(!ViewGpuContext.atlas){c.error("No texture atlas found");return}const u=d.getStats();c.info(["Texture atlas stats",...u].join(`

`))});break;case"saveTextureAtlas":s.invokeFunction(async l=>{const c=l.get(IWorkspaceContextService),d=l.get(IFileService),u=c.getWorkspace().folders;if(u.length>0){const g=ViewGpuContext.atlas,f=[];for(const[p,m]of g.pages.entries())f.push(d.writeFile(URI.joinPath(u[0].uri,`textureAtlasPage${p}_actual.png`),VSBuffer.wrap(new Uint8Array(await(await m.source.convertToBlob()).arrayBuffer()))),d.writeFile(URI.joinPath(u[0].uri,`textureAtlasPage${p}_usage.png`),VSBuffer.wrap(new Uint8Array(await(await m.getUsagePreview()).arrayBuffer()))));await Promise.all(f)}});break;case"drawGlyph":s.invokeFunction(async l=>{var k,N,R;const c=l.get(IConfigurationService),d=l.get(IFileService),u=l.get(IQuickInputService),f=l.get(IWorkspaceContextService).getWorkspace().folders;if(f.length===0)return;const p=ViewGpuContext.atlas,m=c.getValue("editor.fontFamily"),_=c.getValue("editor.fontSize"),C=new GlyphRasterizer(_,m,getActiveWindow().devicePixelRatio,ViewGpuContext.decorationStyleCache);let b=await u.input({prompt:"Enter a character to draw (prefix with 0x for code point))"});if(!b)return;const v=(N=(k=b.match(/0x(?<codePoint>[0-9a-f]+)/i))==null?void 0:k.groups)==null?void 0:N.codePoint;v!==void 0&&(b=String.fromCodePoint(parseInt(v,16)));const S=0,y=0,w=p.getGlyph(C,b,S,y,0);if(!w)return;const L=(R=p.pages[w.pageIndex].source.getContext("2d"))==null?void 0:R.getImageData(w.x,w.y,w.w,w.h);if(!L)return;const x=new OffscreenCanvas(L.width,L.height);ensureNonNullable(x.getContext("2d")).putImageData(L,0,0);const I=await x.convertToBlob({type:"image/png"}),D=URI.joinPath(f[0].uri,`glyph_${b}_${S}_${_}px_${m.replaceAll(/[,\\\/\.'\s]/g,"_")}.png`);await d.writeFile(D,VSBuffer.wrap(new Uint8Array(await I.arrayBuffer())))});break}}}registerEditorAction(DebugEditorGpuRendererAction);var HoverFocusBehavior;(function(a){a.NoAutoFocus="noAutoFocus",a.FocusIfVisible="focusIfVisible",a.AutoFocusImmediately="autoFocusImmediately"})(HoverFocusBehavior||(HoverFocusBehavior={}));class ShowOrFocusHoverAction extends EditorAction{constructor(){super({id:SHOW_OR_FOCUS_HOVER_ACTION_ID,label:localize2(1102,"Show or Focus Hover"),metadata:{description:localize2(1103,"Show or focus the editor hover which shows documentation, references, and other content for a symbol at the current cursor position."),args:[{name:"args",schema:{type:"object",properties:{focus:{description:"Controls if and when the hover should take focus upon being triggered by this action.",enum:[HoverFocusBehavior.NoAutoFocus,HoverFocusBehavior.FocusIfVisible,HoverFocusBehavior.AutoFocusImmediately],enumDescriptions:[localize(1099,"The hover will not automatically take focus."),localize(1100,"The hover will take focus only if it is already visible."),localize(1101,"The hover will automatically take focus when it appears.")],default:HoverFocusBehavior.FocusIfVisible}}}}]},precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2087),weight:100}})}run(e,t,s){if(!t.hasModel())return;const o=ContentHoverController.get(t);if(!o)return;const r=s==null?void 0:s.focus;let l=HoverFocusBehavior.FocusIfVisible;Object.values(HoverFocusBehavior).includes(r)?l=r:typeof r=="boolean"&&r&&(l=HoverFocusBehavior.AutoFocusImmediately);const c=u=>{const g=t.getPosition(),f=new Range$2(g.lineNumber,g.column,g.lineNumber,g.column);o.showContentHover(f,1,2,u)},d=t.getOption(2)===2;o.isHoverVisible?l!==HoverFocusBehavior.NoAutoFocus?o.focus():c(d):c(d||l===HoverFocusBehavior.AutoFocusImmediately)}}class ShowDefinitionPreviewHoverAction extends EditorAction{constructor(){super({id:SHOW_DEFINITION_PREVIEW_HOVER_ACTION_ID,label:localize2(1104,"Show Definition Preview Hover"),precondition:void 0,metadata:{description:localize2(1105,"Show the definition preview hover in the editor.")}})}run(e,t){const s=ContentHoverController.get(t);if(!s)return;const o=t.getPosition();if(!o)return;const r=new Range$2(o.lineNumber,o.column,o.lineNumber,o.column),l=GotoDefinitionAtPositionEditorContribution.get(t);if(!l)return;l.startFindDefinitionFromCursor(o).then(()=>{s.showContentHover(r,1,2,!0)})}}class HideContentHoverAction extends EditorAction{constructor(){super({id:HIDE_HOVER_ACTION_ID,label:localize2(1106,"Hide Hover"),alias:"Hide Content Hover",precondition:void 0})}run(e,t){var s;(s=ContentHoverController.get(t))==null||s.hideContentHover()}}class ScrollUpHoverAction extends EditorAction{constructor(){super({id:SCROLL_UP_HOVER_ACTION_ID,label:localize2(1107,"Scroll Up Hover"),precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:16,weight:100},metadata:{description:localize2(1108,"Scroll up the editor hover.")}})}run(e,t){const s=ContentHoverController.get(t);s&&s.scrollUp()}}class ScrollDownHoverAction extends EditorAction{constructor(){super({id:SCROLL_DOWN_HOVER_ACTION_ID,label:localize2(1109,"Scroll Down Hover"),precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:18,weight:100},metadata:{description:localize2(1110,"Scroll down the editor hover.")}})}run(e,t){const s=ContentHoverController.get(t);s&&s.scrollDown()}}class ScrollLeftHoverAction extends EditorAction{constructor(){super({id:SCROLL_LEFT_HOVER_ACTION_ID,label:localize2(1111,"Scroll Left Hover"),precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:15,weight:100},metadata:{description:localize2(1112,"Scroll left the editor hover.")}})}run(e,t){const s=ContentHoverController.get(t);s&&s.scrollLeft()}}class ScrollRightHoverAction extends EditorAction{constructor(){super({id:SCROLL_RIGHT_HOVER_ACTION_ID,label:localize2(1113,"Scroll Right Hover"),precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:17,weight:100},metadata:{description:localize2(1114,"Scroll right the editor hover.")}})}run(e,t){const s=ContentHoverController.get(t);s&&s.scrollRight()}}class PageUpHoverAction extends EditorAction{constructor(){super({id:PAGE_UP_HOVER_ACTION_ID,label:localize2(1115,"Page Up Hover"),precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:11,secondary:[528],weight:100},metadata:{description:localize2(1116,"Page up the editor hover.")}})}run(e,t){const s=ContentHoverController.get(t);s&&s.pageUp()}}class PageDownHoverAction extends EditorAction{constructor(){super({id:PAGE_DOWN_HOVER_ACTION_ID,label:localize2(1117,"Page Down Hover"),precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:12,secondary:[530],weight:100},metadata:{description:localize2(1118,"Page down the editor hover.")}})}run(e,t){const s=ContentHoverController.get(t);s&&s.pageDown()}}class GoToTopHoverAction extends EditorAction{constructor(){super({id:GO_TO_TOP_HOVER_ACTION_ID,label:localize2(1119,"Go To Top Hover"),precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:14,secondary:[2064],weight:100},metadata:{description:localize2(1120,"Go to the top of the editor hover.")}})}run(e,t){const s=ContentHoverController.get(t);s&&s.goToTop()}}class GoToBottomHoverAction extends EditorAction{constructor(){super({id:GO_TO_BOTTOM_HOVER_ACTION_ID,label:localize2(1121,"Go To Bottom Hover"),precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:13,secondary:[2066],weight:100},metadata:{description:localize2(1122,"Go to the bottom of the editor hover.")}})}run(e,t){const s=ContentHoverController.get(t);s&&s.goToBottom()}}class IncreaseHoverVerbosityLevel extends EditorAction{constructor(){super({id:INCREASE_HOVER_VERBOSITY_ACTION_ID,label:INCREASE_HOVER_VERBOSITY_ACTION_LABEL,alias:"Increase Hover Verbosity Level",precondition:EditorContextKeys.hoverVisible})}run(e,t,s){const o=ContentHoverController.get(t);if(!o)return;const r=(s==null?void 0:s.index)!==void 0?s.index:o.focusedHoverPartIndex();o.updateHoverVerbosityLevel(HoverVerbosityAction$1.Increase,r,s==null?void 0:s.focus)}}class DecreaseHoverVerbosityLevel extends EditorAction{constructor(){super({id:DECREASE_HOVER_VERBOSITY_ACTION_ID,label:DECREASE_HOVER_VERBOSITY_ACTION_LABEL,alias:"Decrease Hover Verbosity Level",precondition:EditorContextKeys.hoverVisible})}run(e,t,s){var l;const o=ContentHoverController.get(t);if(!o)return;const r=(s==null?void 0:s.index)!==void 0?s.index:o.focusedHoverPartIndex();(l=ContentHoverController.get(t))==null||l.updateHoverVerbosityLevel(HoverVerbosityAction$1.Decrease,r,s==null?void 0:s.focus)}}var __decorate$W=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$V=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const $$8=$$l;class MarkerHover{constructor(e,t,s){this.owner=e,this.range=t,this.marker=s}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}const markerCodeActionTrigger={type:1,filter:{include:CodeActionKind.QuickFix},triggerAction:CodeActionTriggerSource.QuickFixHover};let MarkerHoverParticipant=class{constructor(e,t,s,o){this._editor=e,this._markerDecorationsService=t,this._openerService=s,this._languageFeaturesService=o,this.hoverOrdinal=1,this.recentMarkerCodeActionsInfo=void 0}computeSync(e,t){if(!this._editor.hasModel()||e.type!==1&&!e.supportsMarkerHover)return[];const s=this._editor.getModel(),o=e.range;if(!s.isValidRange(e.range))return[];const r=o.startLineNumber,l=s.getLineMaxColumn(r),c=[];for(const d of t){const u=d.range.startLineNumber===r?d.range.startColumn:1,g=d.range.endLineNumber===r?d.range.endColumn:l,f=this._markerDecorationsService.getMarker(s.uri,d);if(!f)continue;const p=new Range$2(e.range.startLineNumber,u,e.range.startLineNumber,g);c.push(new MarkerHover(this,p,f))}return c}renderHoverParts(e,t){if(!t.length)return new RenderedHoverParts([]);const s=[];t.forEach(l=>{const c=this._renderMarkerHover(l);e.fragment.appendChild(c.hoverElement),s.push(c)});const o=t.length===1?t[0]:t.sort((l,c)=>MarkerSeverity$2.compare(l.marker.severity,c.marker.severity))[0],r=this._renderMarkerStatusbar(e,o);return new RenderedHoverParts(s,r)}_renderMarkerHover(e){const t=new DisposableStore,s=$$8("div.hover-row"),o=append$2(s,$$8("div.marker.hover-contents")),{source:r,message:l,code:c,relatedInformation:d}=e.marker;this._editor.applyFontInfo(o);const u=append$2(o,$$8("span"));if(u.style.whiteSpace="pre-wrap",u.innerText=l,r||c)if(c&&typeof c!="string"){const f=$$8("span");if(r){const C=append$2(f,$$8("span"));C.innerText=r}const p=append$2(f,$$8("a.code-link"));p.setAttribute("href",c.target.toString(!0)),t.add(addDisposableListener(p,"click",C=>{this._openerService.open(c.target,{allowCommands:!0}),C.preventDefault(),C.stopPropagation()}));const m=append$2(p,$$8("span"));m.innerText=c.value;const _=append$2(o,f);_.style.opacity="0.6",_.style.paddingLeft="6px"}else{const f=append$2(o,$$8("span"));f.style.opacity="0.6",f.style.paddingLeft="6px",f.innerText=r&&c?`${r}(${c})`:r||`(${c})`}if(isNonEmptyArray(d))for(const{message:f,resource:p,startLineNumber:m,startColumn:_}of d){const C=append$2(o,$$8("div"));C.style.marginTop="8px";const b=append$2(C,$$8("a"));b.innerText=`${basename(p)}(${m}, ${_}): `,b.style.cursor="pointer",t.add(addDisposableListener(b,"click",S=>{if(S.stopPropagation(),S.preventDefault(),this._openerService){const y={selection:{startLineNumber:m,startColumn:_}};this._openerService.open(p,{fromUserGesture:!0,editorOptions:y}).catch(onUnexpectedError)}}));const v=append$2(C,$$8("span"));v.innerText=f,this._editor.applyFontInfo(v)}return{hoverPart:e,hoverElement:s,dispose:()=>t.dispose()}}_renderMarkerStatusbar(e,t){const s=new DisposableStore;if(t.marker.severity===MarkerSeverity$2.Error||t.marker.severity===MarkerSeverity$2.Warning||t.marker.severity===MarkerSeverity$2.Info){const o=MarkerController.get(this._editor);o&&e.statusBar.addAction({label:localize(1132,"View Problem"),commandId:NextMarkerAction.ID,run:()=>{e.hide(),o.showAtMarker(t.marker),this._editor.focus()}})}if(!this._editor.getOption(104)){const o=e.statusBar.append($$8("div"));this.recentMarkerCodeActionsInfo&&(IMarkerData.makeKey(this.recentMarkerCodeActionsInfo.marker)===IMarkerData.makeKey(t.marker)?this.recentMarkerCodeActionsInfo.hasCodeActions||(o.textContent=localize(1133,"No quick fixes available")):this.recentMarkerCodeActionsInfo=void 0);const r=this.recentMarkerCodeActionsInfo&&!this.recentMarkerCodeActionsInfo.hasCodeActions?Disposable.None:disposableTimeout(()=>o.textContent=localize(1134,"Checking for quick fixes..."),200,s);o.textContent||(o.textContent=String.fromCharCode(160));const l=this.getCodeActions(t.marker);s.add(toDisposable(()=>l.cancel())),l.then(c=>{var g;if(r.dispose(),this.recentMarkerCodeActionsInfo={marker:t.marker,hasCodeActions:c.validActions.length>0},!this.recentMarkerCodeActionsInfo.hasCodeActions){c.dispose(),o.textContent=localize(1135,"No quick fixes available");return}o.style.display="none";let d=!1;s.add(toDisposable(()=>{d||c.dispose()})),e.statusBar.addAction({label:localize(1136,"Quick Fix..."),commandId:quickFixCommandId,run:f=>{d=!0;const p=CodeActionController.get(this._editor),m=getDomNodePagePosition(f);e.hide(),p==null||p.showCodeActions(markerCodeActionTrigger,c,{x:m.left,y:m.top,width:m.width,height:m.height})}});const u=c.validActions.find(f=>f.action.isAI);u&&e.statusBar.addAction({label:u.action.title,commandId:((g=u.action.command)==null?void 0:g.id)??"",iconClass:ThemeIcon.asClassName(Codicon.sparkle),run:()=>{const f=CodeActionController.get(this._editor);f==null||f.applyCodeAction(u,!1,!1,ApplyCodeActionReason.FromProblemsHover)}}),e.onContentsChanged()},onUnexpectedError)}return s}getCodeActions(e){return createCancelablePromise(t=>getCodeActions(this._languageFeaturesService.codeActionProvider,this._editor.getModel(),new Range$2(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),markerCodeActionTrigger,Progress.None,t))}};MarkerHoverParticipant=__decorate$W([__param$V(1,IMarkerDecorationsService),__param$V(2,IOpenerService),__param$V(3,ILanguageFeaturesService)],MarkerHoverParticipant);class GlyphHoverComputer{constructor(e){this._editor=e}computeSync(e){var l;const t=c=>({value:c}),s=this._editor.getLineDecorations(e.lineNumber),o=[],r=e.laneOrLine==="lineNo";if(!s)return o;for(const c of s){const d=((l=c.options.glyphMargin)==null?void 0:l.position)??GlyphMarginLane$1.Center;if(!r&&d!==e.laneOrLine)continue;const u=r?c.options.lineNumberHoverMessage:c.options.glyphMarginHoverMessage;!u||isEmptyMarkdownString(u)||o.push(...asArray(u).map(t))}return o}}var __decorate$V=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$U=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},GlyphHoverWidget_1;const $$7=$$l;var qi;let GlyphHoverWidget=(qi=class extends Disposable{constructor(e,t,s){super(),this._renderDisposeables=this._register(new DisposableStore),this._editor=e,this._isVisible=!1,this._messages=[],this._hover=this._register(new HoverWidget$1(!0)),this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible),this._markdownRenderer=new MarkdownRenderer({editor:this._editor},t,s),this._hoverOperation=this._register(new HoverOperation(this._editor,new GlyphHoverComputer(this._editor))),this._register(this._hoverOperation.onResult(o=>this._withResult(o))),this._register(this._editor.onDidChangeModelDecorations(()=>this._onModelDecorationsChanged())),this._register(this._editor.onDidChangeConfiguration(o=>{o.hasChanged(59)&&this._updateFont()})),this._register(addStandardDisposableListener(this._hover.containerDomNode,"mouseleave",o=>{this._onMouseLeave(o)})),this._editor.addOverlayWidget(this)}dispose(){this._hoverComputerOptions=void 0,this._editor.removeOverlayWidget(this),super.dispose()}getId(){return GlyphHoverWidget_1.ID}getDomNode(){return this._hover.containerDomNode}getPosition(){return null}_updateFont(){Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName("code")).forEach(t=>this._editor.applyFontInfo(t))}_onModelDecorationsChanged(){this._isVisible&&this._hoverComputerOptions&&(this._hoverOperation.cancel(),this._hoverOperation.start(0,this._hoverComputerOptions))}showsOrWillShow(e){const t=e.target;return t.type===2&&t.detail.glyphMarginLane?(this._startShowingAt(t.position.lineNumber,t.detail.glyphMarginLane),!0):t.type===3?(this._startShowingAt(t.position.lineNumber,"lineNo"),!0):!1}_startShowingAt(e,t){this._hoverComputerOptions&&this._hoverComputerOptions.lineNumber===e&&this._hoverComputerOptions.laneOrLine===t||(this._hoverOperation.cancel(),this.hide(),this._hoverComputerOptions={lineNumber:e,laneOrLine:t},this._hoverOperation.start(0,this._hoverComputerOptions))}hide(){this._hoverComputerOptions=void 0,this._hoverOperation.cancel(),this._isVisible&&(this._isVisible=!1,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible))}_withResult(e){this._messages=e.value,this._messages.length>0?this._renderMessages(e.options.lineNumber,e.options.laneOrLine,this._messages):this.hide()}_renderMessages(e,t,s){this._renderDisposeables.clear();const o=document.createDocumentFragment();for(const r of s){const l=$$7("div.hover-row.markdown-hover"),c=append$2(l,$$7("div.hover-contents")),d=this._renderDisposeables.add(this._markdownRenderer.render(r.value));c.appendChild(d.element),o.appendChild(l)}this._updateContents(o),this._showAt(e,t)}_updateContents(e){this._hover.contentsDomNode.textContent="",this._hover.contentsDomNode.appendChild(e),this._updateFont()}_showAt(e,t){this._isVisible||(this._isVisible=!0,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible));const s=this._editor.getLayoutInfo(),o=this._editor.getTopForLineNumber(e),r=this._editor.getScrollTop(),l=this._editor.getOption(75),c=this._hover.containerDomNode.clientHeight,d=o-r-(c-l)/2,u=s.glyphMarginLeft+s.glyphMarginWidth+(t==="lineNo"?s.lineNumbersWidth:0);this._hover.containerDomNode.style.left=`${u}px`,this._hover.containerDomNode.style.top=`${Math.max(Math.round(d),0)}px`,this._hover.containerDomNode.style.zIndex="11"}_onMouseLeave(e){const t=this._editor.getDomNode();(!t||!isMousePositionWithinElement(t,e.x,e.y))&&this.hide()}},GlyphHoverWidget_1=qi,qi.ID="editor.contrib.modesGlyphHoverWidget",qi);GlyphHoverWidget=GlyphHoverWidget_1=__decorate$V([__param$U(1,ILanguageService),__param$U(2,IOpenerService)],GlyphHoverWidget);var __decorate$U=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$T=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},Pn;let GlyphHoverController=(Pn=class extends Disposable{constructor(e,t){super(),this._editor=e,this._instantiationService=t,this.shouldKeepOpenOnEditorMouseMoveOrLeave=!1,this._listenersStore=new DisposableStore,this._hoverState={mouseDown:!1},this._reactToEditorMouseMoveRunner=this._register(new RunOnceScheduler(()=>this._reactToEditorMouseMove(this._mouseMoveEvent),0)),this._hookListeners(),this._register(this._editor.onDidChangeConfiguration(s=>{s.hasChanged(69)&&(this._unhookListeners(),this._hookListeners())}))}_hookListeners(){const e=this._editor.getOption(69);this._hoverSettings={enabled:e.enabled,sticky:e.sticky,hidingDelay:e.hidingDelay},e.enabled?(this._listenersStore.add(this._editor.onMouseDown(t=>this._onEditorMouseDown(t))),this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp())),this._listenersStore.add(this._editor.onMouseMove(t=>this._onEditorMouseMove(t))),this._listenersStore.add(this._editor.onKeyDown(t=>this._onKeyDown(t)))):(this._listenersStore.add(this._editor.onMouseMove(t=>this._onEditorMouseMove(t))),this._listenersStore.add(this._editor.onKeyDown(t=>this._onKeyDown(t)))),this._listenersStore.add(this._editor.onMouseLeave(t=>this._onEditorMouseLeave(t))),this._listenersStore.add(this._editor.onDidChangeModel(()=>{this._cancelScheduler(),this.hideGlyphHover()})),this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler())),this._listenersStore.add(this._editor.onDidScrollChange(t=>this._onEditorScrollChanged(t)))}_unhookListeners(){this._listenersStore.clear()}_cancelScheduler(){this._mouseMoveEvent=void 0,this._reactToEditorMouseMoveRunner.cancel()}_onEditorScrollChanged(e){(e.scrollTopChanged||e.scrollLeftChanged)&&this.hideGlyphHover()}_onEditorMouseDown(e){this._hoverState.mouseDown=!0,!this._isMouseOnGlyphHoverWidget(e)&&this.hideGlyphHover()}_isMouseOnGlyphHoverWidget(e){var s;const t=(s=this._glyphWidget)==null?void 0:s.getDomNode();return t?isMousePositionWithinElement(t,e.event.posx,e.event.posy):!1}_onEditorMouseUp(){this._hoverState.mouseDown=!1}_onEditorMouseLeave(e){this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._cancelScheduler(),this._isMouseOnGlyphHoverWidget(e))||this.hideGlyphHover()}_shouldNotRecomputeCurrentHoverWidget(e){const t=this._hoverSettings.sticky,s=this._isMouseOnGlyphHoverWidget(e);return t&&s}_onEditorMouseMove(e){if(this.shouldKeepOpenOnEditorMouseMoveOrLeave)return;if(this._mouseMoveEvent=e,this._shouldNotRecomputeCurrentHoverWidget(e)){this._reactToEditorMouseMoveRunner.cancel();return}this._reactToEditorMouseMove(e)}_reactToEditorMouseMove(e){!e||this._tryShowHoverWidget(e)||this.hideGlyphHover()}_tryShowHoverWidget(e){return this._getOrCreateGlyphWidget().showsOrWillShow(e)}_onKeyDown(e){this._editor.hasModel()&&(e.keyCode===5||e.keyCode===6||e.keyCode===57||e.keyCode===4||this.hideGlyphHover())}hideGlyphHover(){var e;(e=this._glyphWidget)==null||e.hide()}_getOrCreateGlyphWidget(){return this._glyphWidget||(this._glyphWidget=this._instantiationService.createInstance(GlyphHoverWidget,this._editor)),this._glyphWidget}dispose(){var e;super.dispose(),this._unhookListeners(),this._listenersStore.dispose(),(e=this._glyphWidget)==null||e.dispose()}},Pn.ID="editor.contrib.marginHover",Pn);GlyphHoverController=__decorate$U([__param$T(1,IInstantiationService)],GlyphHoverController);class HoverAccessibleView{}class HoverAccessibilityHelp{}class ExtHoverAccessibleView{}registerEditorContribution(ContentHoverController.ID,ContentHoverController,2);registerEditorContribution(GlyphHoverController.ID,GlyphHoverController,2);registerEditorAction(ShowOrFocusHoverAction);registerEditorAction(ShowDefinitionPreviewHoverAction);registerEditorAction(HideContentHoverAction);registerEditorAction(ScrollUpHoverAction);registerEditorAction(ScrollDownHoverAction);registerEditorAction(ScrollLeftHoverAction);registerEditorAction(ScrollRightHoverAction);registerEditorAction(PageUpHoverAction);registerEditorAction(PageDownHoverAction);registerEditorAction(GoToTopHoverAction);registerEditorAction(GoToBottomHoverAction);registerEditorAction(IncreaseHoverVerbosityLevel);registerEditorAction(DecreaseHoverVerbosityLevel);HoverParticipantRegistry.register(MarkdownHoverParticipant);HoverParticipantRegistry.register(MarkerHoverParticipant);registerThemingParticipant((a,e)=>{const t=a.getColor(editorHoverBorder);t&&(e.addRule(`.monaco-editor .monaco-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid ${t.transparent(.5)}; }`),e.addRule(`.monaco-editor .monaco-hover hr { border-top: 1px solid ${t.transparent(.5)}; }`),e.addRule(`.monaco-editor .monaco-hover hr { border-bottom: 0px solid ${t.transparent(.5)}; }`))});AccessibleViewRegistry.register(new HoverAccessibleView);AccessibleViewRegistry.register(new HoverAccessibilityHelp);AccessibleViewRegistry.register(new ExtHoverAccessibleView);function getSpaceCnt(a,e){let t=0;for(let s=0;s<a.length;s++)a.charAt(s)==="	"?t+=e:t++;return t}function generateIndent(a,e,t){a=a<0?0:a;let s="";if(!t){const o=Math.floor(a/e);a=a%e;for(let r=0;r<o;r++)s+="	"}for(let o=0;o<a;o++)s+=" ";return s}function getReindentEditOperations(a,e,t,s){if(a.getLineCount()===1&&a.getLineMaxColumn(1)===1)return[];const o=e.getLanguageConfiguration(a.getLanguageId()).indentRulesSupport;if(!o)return[];const r=new ProcessedIndentRulesSupport(a,o,e);for(s=Math.min(s,a.getLineCount());t<=s&&r.shouldIgnore(t);)t++;if(t>s-1)return[];const{tabSize:l,indentSize:c,insertSpaces:d}=a.getOptions(),u=(C,b)=>(b=b||1,ShiftCommand.shiftIndent(C,C.length+b,l,c,d)),g=(C,b)=>(b=b||1,ShiftCommand.unshiftIndent(C,C.length+b,l,c,d)),f=[],p=a.getLineContent(t);let m=getLeadingWhitespace(p),_=m;r.shouldIncrease(t)?(_=u(_),m=u(m)):r.shouldIndentNextLine(t)&&(_=u(_)),t++;for(let C=t;C<=s;C++){if(doesLineStartWithString(a,C))continue;const b=a.getLineContent(C),v=getLeadingWhitespace(b),S=_;r.shouldDecrease(C,S)&&(_=g(_),m=g(m)),v!==_&&f.push(EditOperation.replaceMove(new Selection$1(C,1,C,v.length+1),normalizeIndentation(_,c,d))),!r.shouldIgnore(C)&&(r.shouldIncrease(C,S)?(m=u(m),_=m):r.shouldIndentNextLine(C,S)?_=u(_):_=m)}return f}function doesLineStartWithString(a,e){return a.tokenization.isCheapToTokenize(e)?a.tokenization.getLineTokens(e).getStandardTokenType(0)===2:!1}var __decorate$T=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$S=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const Js=class Js extends EditorAction{constructor(){super({id:Js.ID,label:localize2(1141,"Convert Indentation to Spaces"),precondition:EditorContextKeys.writable,metadata:{description:localize2(1142,"Convert the tab indentation to spaces.")}})}run(e,t){const s=t.getModel();if(!s)return;const o=s.getOptions(),r=t.getSelection();if(!r)return;const l=new IndentationToSpacesCommand(r,o.tabSize);t.pushUndoStop(),t.executeCommands(this.id,[l]),t.pushUndoStop(),s.updateOptions({insertSpaces:!0})}};Js.ID="editor.action.indentationToSpaces";let IndentationToSpacesAction=Js;const eo=class eo extends EditorAction{constructor(){super({id:eo.ID,label:localize2(1143,"Convert Indentation to Tabs"),precondition:EditorContextKeys.writable,metadata:{description:localize2(1144,"Convert the spaces indentation to tabs.")}})}run(e,t){const s=t.getModel();if(!s)return;const o=s.getOptions(),r=t.getSelection();if(!r)return;const l=new IndentationToTabsCommand(r,o.tabSize);t.pushUndoStop(),t.executeCommands(this.id,[l]),t.pushUndoStop(),s.updateOptions({insertSpaces:!1})}};eo.ID="editor.action.indentationToTabs";let IndentationToTabsAction=eo;class ChangeIndentationSizeAction extends EditorAction{constructor(e,t,s){super(s),this.insertSpaces=e,this.displaySizeOnly=t}run(e,t){const s=e.get(IQuickInputService),o=e.get(IModelService),r=t.getModel();if(!r)return;const l=o.getCreationOptions(r.getLanguageId(),r.uri,r.isForSimpleWidget),c=r.getOptions(),d=[1,2,3,4,5,6,7,8].map(g=>({id:g.toString(),label:g.toString(),description:g===l.tabSize&&g===c.tabSize?localize(1137,"Configured Tab Size"):g===l.tabSize?localize(1138,"Default Tab Size"):g===c.tabSize?localize(1139,"Current Tab Size"):void 0})),u=Math.min(r.getOptions().tabSize-1,7);setTimeout(()=>{s.pick(d,{placeHolder:localize(1140,"Select Tab Size for Current File"),activeItem:d[u]}).then(g=>{if(g&&r&&!r.isDisposed()){const f=parseInt(g.label,10);this.displaySizeOnly?r.updateOptions({tabSize:f}):r.updateOptions({tabSize:f,indentSize:f,insertSpaces:this.insertSpaces})}})},50)}}const to=class to extends ChangeIndentationSizeAction{constructor(){super(!1,!1,{id:to.ID,label:localize2(1145,"Indent Using Tabs"),precondition:void 0,metadata:{description:localize2(1146,"Use indentation with tabs.")}})}};to.ID="editor.action.indentUsingTabs";let IndentUsingTabs=to;const io=class io extends ChangeIndentationSizeAction{constructor(){super(!0,!1,{id:io.ID,label:localize2(1147,"Indent Using Spaces"),precondition:void 0,metadata:{description:localize2(1148,"Use indentation with spaces.")}})}};io.ID="editor.action.indentUsingSpaces";let IndentUsingSpaces=io;const no=class no extends ChangeIndentationSizeAction{constructor(){super(!0,!0,{id:no.ID,label:localize2(1149,"Change Tab Display Size"),precondition:void 0,metadata:{description:localize2(1150,"Change the space size equivalent of the tab.")}})}};no.ID="editor.action.changeTabDisplaySize";let ChangeTabDisplaySize=no;const so=class so extends EditorAction{constructor(){super({id:so.ID,label:localize2(1151,"Detect Indentation from Content"),precondition:void 0,metadata:{description:localize2(1152,"Detect the indentation from content.")}})}run(e,t){const s=e.get(IModelService),o=t.getModel();if(!o)return;const r=s.getCreationOptions(o.getLanguageId(),o.uri,o.isForSimpleWidget);o.detectIndentation(r.insertSpaces,r.tabSize)}};so.ID="editor.action.detectIndentation";let DetectIndentation=so;class ReindentLinesAction extends EditorAction{constructor(){super({id:"editor.action.reindentlines",label:localize2(1153,"Reindent Lines"),precondition:EditorContextKeys.writable,metadata:{description:localize2(1154,"Reindent the lines of the editor.")}})}run(e,t){const s=e.get(ILanguageConfigurationService),o=t.getModel();if(!o)return;const r=getReindentEditOperations(o,s,1,o.getLineCount());r.length>0&&(t.pushUndoStop(),t.executeEdits(this.id,r),t.pushUndoStop())}}class ReindentSelectedLinesAction extends EditorAction{constructor(){super({id:"editor.action.reindentselectedlines",label:localize2(1155,"Reindent Selected Lines"),precondition:EditorContextKeys.writable,metadata:{description:localize2(1156,"Reindent the selected lines of the editor.")}})}run(e,t){const s=e.get(ILanguageConfigurationService),o=t.getModel();if(!o)return;const r=t.getSelections();if(r===null)return;const l=[];for(const c of r){let d=c.startLineNumber,u=c.endLineNumber;if(d!==u&&c.endColumn===1&&u--,d===1){if(d===u)continue}else d--;const g=getReindentEditOperations(o,s,d,u);l.push(...g)}l.length>0&&(t.pushUndoStop(),t.executeEdits(this.id,l),t.pushUndoStop())}}class AutoIndentOnPasteCommand{constructor(e,t){this._initialSelection=t,this._edits=[],this._selectionId=null;for(const s of e)s.range&&typeof s.text=="string"&&this._edits.push(s)}getEditOperations(e,t){for(const o of this._edits)t.addEditOperation(Range$2.lift(o.range),o.text);let s=!1;Array.isArray(this._edits)&&this._edits.length===1&&this._initialSelection.isEmpty()&&(this._edits[0].range.startColumn===this._initialSelection.endColumn&&this._edits[0].range.startLineNumber===this._initialSelection.endLineNumber?(s=!0,this._selectionId=t.trackSelection(this._initialSelection,!0)):this._edits[0].range.endColumn===this._initialSelection.startColumn&&this._edits[0].range.endLineNumber===this._initialSelection.startLineNumber&&(s=!0,this._selectionId=t.trackSelection(this._initialSelection,!1))),s||(this._selectionId=t.trackSelection(this._initialSelection))}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}}var Fn;let AutoIndentOnPaste=(Fn=class{constructor(e,t){this.editor=e,this._languageConfigurationService=t,this.callOnDispose=new DisposableStore,this.callOnModel=new DisposableStore,this.callOnDispose.add(e.onDidChangeConfiguration(()=>this.update())),this.callOnDispose.add(e.onDidChangeModel(()=>this.update())),this.callOnDispose.add(e.onDidChangeModelLanguage(()=>this.update()))}update(){this.callOnModel.clear(),!(!this.editor.getOption(17)||this.editor.getOption(16)<4)&&this.editor.hasModel()&&this.callOnModel.add(this.editor.onDidPaste(({range:e})=>{this.trigger(e)}))}trigger(e){const t=this.editor.getSelections();if(t===null||t.length>1)return;const s=this.editor.getModel();if(!s||this.rangeContainsOnlyWhitespaceCharacters(s,e)||!this.editor.getOption(18)&&isStartOrEndInString(s,e)||!s.tokenization.isCheapToTokenize(e.getStartPosition().lineNumber))return;const r=this.editor.getOption(16),{tabSize:l,indentSize:c,insertSpaces:d}=s.getOptions(),u=[],g={shiftIndent:_=>ShiftCommand.shiftIndent(_,_.length+1,l,c,d),unshiftIndent:_=>ShiftCommand.unshiftIndent(_,_.length+1,l,c,d)};let f=e.startLineNumber,p=s.getLineContent(f);if(!/\S/.test(p.substring(0,e.startColumn-1))){const _=getGoodIndentForLine(r,s,s.getLanguageId(),f,g,this._languageConfigurationService);if(_!==null){const C=getLeadingWhitespace(p),b=getSpaceCnt(_,l),v=getSpaceCnt(C,l);if(b!==v){const S=generateIndent(b,l,d);u.push({range:new Range$2(f,1,f,C.length+1),text:S}),p=S+p.substring(C.length)}else{const S=getIndentMetadata(s,f,this._languageConfigurationService);if(S===0||S===8)return}}}const m=f;for(;f<e.endLineNumber;){if(!/\S/.test(s.getLineContent(f+1))){f++;continue}break}if(f!==e.endLineNumber){const C=getGoodIndentForLine(r,{tokenization:{getLineTokens:b=>s.tokenization.getLineTokens(b),getLanguageId:()=>s.getLanguageId(),getLanguageIdAtPosition:(b,v)=>s.getLanguageIdAtPosition(b,v)},getLineContent:b=>b===m?p:s.getLineContent(b)},s.getLanguageId(),f+1,g,this._languageConfigurationService);if(C!==null){const b=getSpaceCnt(C,l),v=getSpaceCnt(getLeadingWhitespace(s.getLineContent(f+1)),l);if(b!==v){const S=b-v;for(let y=f+1;y<=e.endLineNumber;y++){const w=s.getLineContent(y),L=getLeadingWhitespace(w),E=getSpaceCnt(L,l)+S,I=generateIndent(E,l,d);I!==L&&u.push({range:new Range$2(y,1,y,L.length+1),text:I})}}}}if(u.length>0){this.editor.pushUndoStop();const _=new AutoIndentOnPasteCommand(u,this.editor.getSelection());this.editor.executeCommand("autoIndentOnPaste",_),this.editor.pushUndoStop()}}rangeContainsOnlyWhitespaceCharacters(e,t){const s=r=>r.trim().length===0;let o=!0;if(t.startLineNumber===t.endLineNumber){const l=e.getLineContent(t.startLineNumber).substring(t.startColumn-1,t.endColumn-1);o=s(l)}else for(let r=t.startLineNumber;r<=t.endLineNumber;r++){const l=e.getLineContent(r);if(r===t.startLineNumber){const c=l.substring(t.startColumn-1);o=s(c)}else if(r===t.endLineNumber){const c=l.substring(0,t.endColumn-1);o=s(c)}else o=e.getLineFirstNonWhitespaceColumn(r)===0;if(!o)break}return o}dispose(){this.callOnDispose.dispose(),this.callOnModel.dispose()}},Fn.ID="editor.contrib.autoIndentOnPaste",Fn);AutoIndentOnPaste=__decorate$T([__param$S(1,ILanguageConfigurationService)],AutoIndentOnPaste);function isStartOrEndInString(a,e){const t=s=>getStandardTokenTypeAtPosition(a,s)===2;return t(e.getStartPosition())||t(e.getEndPosition())}function getIndentationEditOperations(a,e,t,s){if(a.getLineCount()===1&&a.getLineMaxColumn(1)===1)return;let o="";for(let l=0;l<t;l++)o+=" ";const r=new RegExp(o,"gi");for(let l=1,c=a.getLineCount();l<=c;l++){let d=a.getLineFirstNonWhitespaceColumn(l);if(d===0&&(d=a.getLineMaxColumn(l)),d===1)continue;const u=new Range$2(l,1,l,d),g=a.getValueInRange(u),f=s?g.replace(/\t/ig,o):g.replace(r,"	");e.addEditOperation(u,f)}}class IndentationToSpacesCommand{constructor(e,t){this.selection=e,this.tabSize=t,this.selectionId=null}getEditOperations(e,t){this.selectionId=t.trackSelection(this.selection),getIndentationEditOperations(e,t,this.tabSize,!0)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}}class IndentationToTabsCommand{constructor(e,t){this.selection=e,this.tabSize=t,this.selectionId=null}getEditOperations(e,t){this.selectionId=t.trackSelection(this.selection),getIndentationEditOperations(e,t,this.tabSize,!1)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}}registerEditorContribution(AutoIndentOnPaste.ID,AutoIndentOnPaste,2);registerEditorAction(IndentationToSpacesAction);registerEditorAction(IndentationToTabsAction);registerEditorAction(IndentUsingTabs);registerEditorAction(IndentUsingSpaces);registerEditorAction(ChangeTabDisplaySize);registerEditorAction(DetectIndentation);registerEditorAction(ReindentLinesAction);registerEditorAction(ReindentSelectedLinesAction);registerEditorContribution(InlayHintsController.ID,InlayHintsController,1);HoverParticipantRegistry.register(InlayHintsHover);class InPlaceReplaceCommand{constructor(e,t,s){this._editRange=e,this._originalSelection=t,this._text=s}getEditOperations(e,t){t.addTrackedEditOperation(this._editRange,this._text)}computeCursorState(e,t){const o=t.getInverseEditOperations()[0].range;return this._originalSelection.isEmpty()?new Selection$1(o.endLineNumber,Math.min(this._originalSelection.positionColumn,o.endColumn),o.endLineNumber,Math.min(this._originalSelection.positionColumn,o.endColumn)):new Selection$1(o.endLineNumber,o.endColumn-this._text.length,o.endLineNumber,o.endColumn)}}const inPlaceReplace="";var __decorate$S=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$R=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},InPlaceReplaceController_1,Ht;let InPlaceReplaceController=(Ht=class{static get(e){return e.getContribution(InPlaceReplaceController_1.ID)}constructor(e,t){this.editor=e,this.editorWorkerService=t,this.decorations=this.editor.createDecorationsCollection()}dispose(){}run(e,t){var d;(d=this.currentRequest)==null||d.cancel();const s=this.editor.getSelection(),o=this.editor.getModel();if(!o||!s)return;let r=s;if(r.startLineNumber!==r.endLineNumber)return;const l=new EditorState$1(this.editor,5),c=o.uri;return this.editorWorkerService.canNavigateValueSet(c)?(this.currentRequest=createCancelablePromise(u=>this.editorWorkerService.navigateValueSet(c,r,t)),this.currentRequest.then(u=>{var _;if(!u||!u.range||!u.value||!l.validate(this.editor))return;const g=Range$2.lift(u.range);let f=u.range;const p=u.value.length-(r.endColumn-r.startColumn);f={startLineNumber:f.startLineNumber,startColumn:f.startColumn,endLineNumber:f.endLineNumber,endColumn:f.startColumn+u.value.length},p>1&&(r=new Selection$1(r.startLineNumber,r.startColumn,r.endLineNumber,r.endColumn+p-1));const m=new InPlaceReplaceCommand(g,r,u.value);this.editor.pushUndoStop(),this.editor.executeCommand(e,m),this.editor.pushUndoStop(),this.decorations.set([{range:f,options:InPlaceReplaceController_1.DECORATION}]),(_=this.decorationRemover)==null||_.cancel(),this.decorationRemover=timeout(350),this.decorationRemover.then(()=>this.decorations.clear()).catch(onUnexpectedError)}).catch(onUnexpectedError)):Promise.resolve(void 0)}},InPlaceReplaceController_1=Ht,Ht.ID="editor.contrib.inPlaceReplaceController",Ht.DECORATION=ModelDecorationOptions.register({description:"in-place-replace",className:"valueSetReplacement"}),Ht);InPlaceReplaceController=InPlaceReplaceController_1=__decorate$S([__param$R(1,IEditorWorkerService)],InPlaceReplaceController);class InPlaceReplaceUp extends EditorAction{constructor(){super({id:"editor.action.inPlaceReplace.up",label:localize2(1230,"Replace with Previous Value"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3159,weight:100}})}run(e,t){const s=InPlaceReplaceController.get(t);return s?s.run(this.id,!1):Promise.resolve(void 0)}}class InPlaceReplaceDown extends EditorAction{constructor(){super({id:"editor.action.inPlaceReplace.down",label:localize2(1231,"Replace with Next Value"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3161,weight:100}})}run(e,t){const s=InPlaceReplaceController.get(t);return s?s.run(this.id,!0):Promise.resolve(void 0)}}registerEditorContribution(InPlaceReplaceController.ID,InPlaceReplaceController,4);registerEditorAction(InPlaceReplaceUp);registerEditorAction(InPlaceReplaceDown);class InsertFinalNewLineCommand{constructor(e){this._selection=e,this._selectionId=null}getEditOperations(e,t){const s=insertFinalNewLine(e);s&&t.addEditOperation(s.range,s.text),this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}}function insertFinalNewLine(a){const e=a.getLineCount(),t=a.getLineContent(e),s=lastNonWhitespaceIndex(t)===-1;if(!(!e||s))return EditOperation.insert(new Position$1(e,a.getLineMaxColumn(e)),a.getEOL())}const oo=class oo extends EditorAction{constructor(){super({id:oo.ID,label:localize2(1232,"Insert Final New Line"),precondition:EditorContextKeys.writable})}run(e,t,s){const o=t.getSelection();if(o===null)return;const r=new InsertFinalNewLineCommand(o);t.pushUndoStop(),t.executeCommands(this.id,[r]),t.pushUndoStop()}};oo.ID="editor.action.insertFinalNewLine";let InsertFinalNewLineAction=oo;registerEditorAction(InsertFinalNewLineAction);class ExpandLineSelectionAction extends EditorAction{constructor(){super({id:"expandLineSelection",label:localize2(1233,"Expand Line Selection"),precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:2090}})}run(e,t,s){if(s=s||{},!t.hasModel())return;const o=t._getViewModel();o.model.pushStackElement(),o.setCursorStates(s.source,3,CursorMoveCommands.expandLineSelection(o,o.getCursorStates())),o.revealAllCursors(s.source,!0)}}registerEditorAction(ExpandLineSelectionAction);class TrimTrailingWhitespaceCommand{constructor(e,t,s){this._selection=e,this._cursors=t,this._selectionId=null,this._trimInRegexesAndStrings=s}getEditOperations(e,t){const s=trimTrailingWhitespace(e,this._cursors,this._trimInRegexesAndStrings);for(let o=0,r=s.length;o<r;o++){const l=s[o];t.addEditOperation(l.range,l.text)}this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}}function trimTrailingWhitespace(a,e,t){e.sort((c,d)=>c.lineNumber===d.lineNumber?c.column-d.column:c.lineNumber-d.lineNumber);for(let c=e.length-2;c>=0;c--)e[c].lineNumber===e[c+1].lineNumber&&e.splice(c,1);const s=[];let o=0,r=0;const l=e.length;for(let c=1,d=a.getLineCount();c<=d;c++){const u=a.getLineContent(c),g=u.length+1;let f=0;if(r<l&&e[r].lineNumber===c&&(f=e[r].column,r++,f===g)||u.length===0)continue;const p=lastNonWhitespaceIndex(u);let m=0;if(p===-1)m=1;else if(p!==u.length-1)m=p+2;else continue;if(!t){if(!a.tokenization.hasAccurateTokensForLine(c))continue;const _=a.tokenization.getLineTokens(c),C=_.getStandardTokenType(_.findTokenIndexAtOffset(m));if(C===2||C===3)continue}m=Math.max(f,m),s[o++]=EditOperation.delete(new Range$2(c,m,c,g))}return s}class CopyLinesCommand{constructor(e,t,s){this._selection=e,this._isCopyingDown=t,this._noop=s||!1,this._selectionDirection=0,this._selectionId=null,this._startLineNumberDelta=0,this._endLineNumberDelta=0}getEditOperations(e,t){let s=this._selection;this._startLineNumberDelta=0,this._endLineNumberDelta=0,s.startLineNumber<s.endLineNumber&&s.endColumn===1&&(this._endLineNumberDelta=1,s=s.setEndPosition(s.endLineNumber-1,e.getLineMaxColumn(s.endLineNumber-1)));const o=[];for(let l=s.startLineNumber;l<=s.endLineNumber;l++)o.push(e.getLineContent(l));const r=o.join(`
`);r===""&&this._isCopyingDown&&(this._startLineNumberDelta++,this._endLineNumberDelta++),this._noop?t.addEditOperation(new Range$2(s.endLineNumber,e.getLineMaxColumn(s.endLineNumber),s.endLineNumber+1,1),s.endLineNumber===e.getLineCount()?"":`
`):this._isCopyingDown?t.addEditOperation(new Range$2(s.startLineNumber,1,s.startLineNumber,1),r+`
`):t.addEditOperation(new Range$2(s.endLineNumber,e.getLineMaxColumn(s.endLineNumber),s.endLineNumber,e.getLineMaxColumn(s.endLineNumber)),`
`+r),this._selectionId=t.trackSelection(s),this._selectionDirection=this._selection.getDirection()}computeCursorState(e,t){let s=t.getTrackedSelection(this._selectionId);if(this._startLineNumberDelta!==0||this._endLineNumberDelta!==0){let o=s.startLineNumber,r=s.startColumn,l=s.endLineNumber,c=s.endColumn;this._startLineNumberDelta!==0&&(o=o+this._startLineNumberDelta,r=1),this._endLineNumberDelta!==0&&(l=l+this._endLineNumberDelta,c=1),s=Selection$1.createWithDirection(o,r,l,c,this._selectionDirection)}return s}}var __decorate$R=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$Q=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let MoveLinesCommand=class{constructor(e,t,s,o){this._languageConfigurationService=o,this._selection=e,this._isMovingDown=t,this._autoIndent=s,this._selectionId=null,this._moveEndLineSelectionShrink=!1}getEditOperations(e,t){const s=()=>e.getLanguageId(),o=(f,p)=>e.getLanguageIdAtPosition(f,p),r=e.getLineCount();if(this._isMovingDown&&this._selection.endLineNumber===r){this._selectionId=t.trackSelection(this._selection);return}if(!this._isMovingDown&&this._selection.startLineNumber===1){this._selectionId=t.trackSelection(this._selection);return}this._moveEndPositionDown=!1;let l=this._selection;l.startLineNumber<l.endLineNumber&&l.endColumn===1&&(this._moveEndPositionDown=!0,l=l.setEndPosition(l.endLineNumber-1,e.getLineMaxColumn(l.endLineNumber-1)));const{tabSize:c,indentSize:d,insertSpaces:u}=e.getOptions(),g=this.buildIndentConverter(c,d,u);if(l.startLineNumber===l.endLineNumber&&e.getLineMaxColumn(l.startLineNumber)===1){const f=l.startLineNumber,p=this._isMovingDown?f+1:f-1;e.getLineMaxColumn(p)===1?t.addEditOperation(new Range$2(1,1,1,1),null):(t.addEditOperation(new Range$2(f,1,f,1),e.getLineContent(p)),t.addEditOperation(new Range$2(p,1,p,e.getLineMaxColumn(p)),null)),l=new Selection$1(p,1,p,1)}else{let f,p;if(this._isMovingDown){f=l.endLineNumber+1,p=e.getLineContent(f),t.addEditOperation(new Range$2(f-1,e.getLineMaxColumn(f-1),f,e.getLineMaxColumn(f)),null);let m=p;if(this.shouldAutoIndent(e,l)){const _=this.matchEnterRule(e,g,c,f,l.startLineNumber-1);if(_!==null){const b=getLeadingWhitespace(e.getLineContent(f)),v=_+getSpaceCnt(b,c);m=generateIndent(v,c,u)+this.trimStart(p)}else{const b={tokenization:{getLineTokens:S=>S===l.startLineNumber?e.tokenization.getLineTokens(f):e.tokenization.getLineTokens(S),getLanguageId:s,getLanguageIdAtPosition:o},getLineContent:S=>S===l.startLineNumber?e.getLineContent(f):e.getLineContent(S)},v=getGoodIndentForLine(this._autoIndent,b,e.getLanguageIdAtPosition(f,1),l.startLineNumber,g,this._languageConfigurationService);if(v!==null){const S=getLeadingWhitespace(e.getLineContent(f)),y=getSpaceCnt(v,c),w=getSpaceCnt(S,c);y!==w&&(m=generateIndent(y,c,u)+this.trimStart(p))}}t.addEditOperation(new Range$2(l.startLineNumber,1,l.startLineNumber,1),m+`
`);const C=this.matchEnterRuleMovingDown(e,g,c,l.startLineNumber,f,m);if(C!==null)C!==0&&this.getIndentEditsOfMovingBlock(e,t,l,c,u,C);else{const b={tokenization:{getLineTokens:S=>S===l.startLineNumber?e.tokenization.getLineTokens(f):S>=l.startLineNumber+1&&S<=l.endLineNumber+1?e.tokenization.getLineTokens(S-1):e.tokenization.getLineTokens(S),getLanguageId:s,getLanguageIdAtPosition:o},getLineContent:S=>S===l.startLineNumber?m:S>=l.startLineNumber+1&&S<=l.endLineNumber+1?e.getLineContent(S-1):e.getLineContent(S)},v=getGoodIndentForLine(this._autoIndent,b,e.getLanguageIdAtPosition(f,1),l.startLineNumber+1,g,this._languageConfigurationService);if(v!==null){const S=getLeadingWhitespace(e.getLineContent(l.startLineNumber)),y=getSpaceCnt(v,c),w=getSpaceCnt(S,c);if(y!==w){const L=y-w;this.getIndentEditsOfMovingBlock(e,t,l,c,u,L)}}}}else t.addEditOperation(new Range$2(l.startLineNumber,1,l.startLineNumber,1),m+`
`)}else if(f=l.startLineNumber-1,p=e.getLineContent(f),t.addEditOperation(new Range$2(f,1,f+1,1),null),t.addEditOperation(new Range$2(l.endLineNumber,e.getLineMaxColumn(l.endLineNumber),l.endLineNumber,e.getLineMaxColumn(l.endLineNumber)),`
`+p),this.shouldAutoIndent(e,l)){const m={tokenization:{getLineTokens:C=>C===f?e.tokenization.getLineTokens(l.startLineNumber):e.tokenization.getLineTokens(C),getLanguageId:s,getLanguageIdAtPosition:o},getLineContent:C=>C===f?e.getLineContent(l.startLineNumber):e.getLineContent(C)},_=this.matchEnterRule(e,g,c,l.startLineNumber,l.startLineNumber-2);if(_!==null)_!==0&&this.getIndentEditsOfMovingBlock(e,t,l,c,u,_);else{const C=getGoodIndentForLine(this._autoIndent,m,e.getLanguageIdAtPosition(l.startLineNumber,1),f,g,this._languageConfigurationService);if(C!==null){const b=getLeadingWhitespace(e.getLineContent(l.startLineNumber)),v=getSpaceCnt(C,c),S=getSpaceCnt(b,c);if(v!==S){const y=v-S;this.getIndentEditsOfMovingBlock(e,t,l,c,u,y)}}}}}this._selectionId=t.trackSelection(l)}buildIndentConverter(e,t,s){return{shiftIndent:o=>ShiftCommand.shiftIndent(o,o.length+1,e,t,s),unshiftIndent:o=>ShiftCommand.unshiftIndent(o,o.length+1,e,t,s)}}parseEnterResult(e,t,s,o,r){if(r){let l=r.indentation;r.indentAction===IndentAction$1.None||r.indentAction===IndentAction$1.Indent?l=r.indentation+r.appendText:r.indentAction===IndentAction$1.IndentOutdent?l=r.indentation:r.indentAction===IndentAction$1.Outdent&&(l=t.unshiftIndent(r.indentation)+r.appendText);const c=e.getLineContent(o);if(this.trimStart(c).indexOf(this.trimStart(l))>=0){const d=getLeadingWhitespace(e.getLineContent(o));let u=getLeadingWhitespace(l);const g=getIndentMetadata(e,o,this._languageConfigurationService);g!==null&&g&2&&(u=t.unshiftIndent(u));const f=getSpaceCnt(u,s),p=getSpaceCnt(d,s);return f-p}}return null}matchEnterRuleMovingDown(e,t,s,o,r,l){if(lastNonWhitespaceIndex(l)>=0){const c=e.getLineMaxColumn(r),d=getEnterAction(this._autoIndent,e,new Range$2(r,c,r,c),this._languageConfigurationService);return this.parseEnterResult(e,t,s,o,d)}else{let c=o-1;for(;c>=1;){const g=e.getLineContent(c);if(lastNonWhitespaceIndex(g)>=0)break;c--}if(c<1||o>e.getLineCount())return null;const d=e.getLineMaxColumn(c),u=getEnterAction(this._autoIndent,e,new Range$2(c,d,c,d),this._languageConfigurationService);return this.parseEnterResult(e,t,s,o,u)}}matchEnterRule(e,t,s,o,r,l){let c=r;for(;c>=1;){let g;if(c===r&&l!==void 0?g=l:g=e.getLineContent(c),lastNonWhitespaceIndex(g)>=0)break;c--}if(c<1||o>e.getLineCount())return null;const d=e.getLineMaxColumn(c),u=getEnterAction(this._autoIndent,e,new Range$2(c,d,c,d),this._languageConfigurationService);return this.parseEnterResult(e,t,s,o,u)}trimStart(e){return e.replace(/^\s+/,"")}shouldAutoIndent(e,t){if(this._autoIndent<4||!e.tokenization.isCheapToTokenize(t.startLineNumber))return!1;const s=e.getLanguageIdAtPosition(t.startLineNumber,1),o=e.getLanguageIdAtPosition(t.endLineNumber,1);return!(s!==o||this._languageConfigurationService.getLanguageConfiguration(s).indentRulesSupport===null)}getIndentEditsOfMovingBlock(e,t,s,o,r,l){for(let c=s.startLineNumber;c<=s.endLineNumber;c++){const d=e.getLineContent(c),u=getLeadingWhitespace(d),f=getSpaceCnt(u,o)+l,p=generateIndent(f,o,r);p!==u&&(t.addEditOperation(new Range$2(c,1,c,u.length+1),p),c===s.endLineNumber&&s.endColumn<=u.length+1&&p===""&&(this._moveEndLineSelectionShrink=!0))}}computeCursorState(e,t){let s=t.getTrackedSelection(this._selectionId);return this._moveEndPositionDown&&(s=s.setEndPosition(s.endLineNumber+1,1)),this._moveEndLineSelectionShrink&&s.startLineNumber<s.endLineNumber&&(s=s.setEndPosition(s.endLineNumber,2)),s}};MoveLinesCommand=__decorate$R([__param$Q(3,ILanguageConfigurationService)],MoveLinesCommand);const qo=class qo{constructor(e,t){this.selection=e,this.descending=t,this.selectionId=null}getEditOperations(e,t){const s=sortLines(e,this.selection,this.descending);s&&t.addEditOperation(s.range,s.text),this.selectionId=t.trackSelection(this.selection)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}static canRun(e,t,s){if(e===null)return!1;const o=getSortData(e,t,s);if(!o)return!1;for(let r=0,l=o.before.length;r<l;r++)if(o.before[r]!==o.after[r])return!0;return!1}};qo._COLLATOR=safeIntl.Collator();let SortLinesCommand=qo;function getSortData(a,e,t){const s=e.startLineNumber;let o=e.endLineNumber;if(e.endColumn===1&&o--,s>=o)return null;const r=[];for(let c=s;c<=o;c++)r.push(a.getLineContent(c));let l=r.slice(0);return l.sort(SortLinesCommand._COLLATOR.value.compare),t===!0&&(l=l.reverse()),{startLineNumber:s,endLineNumber:o,before:r,after:l}}function sortLines(a,e,t){const s=getSortData(a,e,t);return s?EditOperation.replace(new Range$2(s.startLineNumber,1,s.endLineNumber,a.getLineMaxColumn(s.endLineNumber)),s.after.join(`
`)):null}class AbstractCopyLinesAction extends EditorAction{constructor(e,t){super(t),this.down=e}run(e,t){if(!t.hasModel())return;const s=t.getSelections().map((l,c)=>({selection:l,index:c,ignore:!1}));s.sort((l,c)=>Range$2.compareRangesUsingStarts(l.selection,c.selection));let o=s[0];for(let l=1;l<s.length;l++){const c=s[l];o.selection.endLineNumber===c.selection.startLineNumber&&(o.index<c.index?c.ignore=!0:(o.ignore=!0,o=c))}const r=[];for(const l of s)r.push(new CopyLinesCommand(l.selection,this.down,l.ignore));t.pushUndoStop(),t.executeCommands(this.id,r),t.pushUndoStop()}}class CopyLinesUpAction extends AbstractCopyLinesAction{constructor(){super(!1,{id:"editor.action.copyLinesUpAction",label:localize2(1239,"Copy Line Up"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1552,linux:{primary:3600},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"2_line",title:localize(1234,"&&Copy Line Up"),order:1}})}}class CopyLinesDownAction extends AbstractCopyLinesAction{constructor(){super(!0,{id:"editor.action.copyLinesDownAction",label:localize2(1240,"Copy Line Down"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1554,linux:{primary:3602},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"2_line",title:localize(1235,"Co&&py Line Down"),order:2}})}}class DuplicateSelectionAction extends EditorAction{constructor(){super({id:"editor.action.duplicateSelection",label:localize2(1241,"Duplicate Selection"),precondition:EditorContextKeys.writable,menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"2_line",title:localize(1236,"&&Duplicate Selection"),order:5}})}run(e,t,s){if(!t.hasModel())return;const o=[],r=t.getSelections(),l=t.getModel();for(const c of r)if(c.isEmpty())o.push(new CopyLinesCommand(c,!0));else{const d=new Selection$1(c.endLineNumber,c.endColumn,c.endLineNumber,c.endColumn);o.push(new ReplaceCommandThatSelectsText(d,l.getValueInRange(c)))}t.pushUndoStop(),t.executeCommands(this.id,o),t.pushUndoStop()}}class AbstractMoveLinesAction extends EditorAction{constructor(e,t){super(t),this.down=e}run(e,t){const s=e.get(ILanguageConfigurationService),o=[],r=t.getSelections()||[],l=t.getOption(16);for(const c of r)o.push(new MoveLinesCommand(c,this.down,l,s));t.pushUndoStop(),t.executeCommands(this.id,o),t.pushUndoStop()}}class MoveLinesUpAction extends AbstractMoveLinesAction{constructor(){super(!1,{id:"editor.action.moveLinesUpAction",label:localize2(1242,"Move Line Up"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:528,linux:{primary:528},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"2_line",title:localize(1237,"Mo&&ve Line Up"),order:3}})}}class MoveLinesDownAction extends AbstractMoveLinesAction{constructor(){super(!0,{id:"editor.action.moveLinesDownAction",label:localize2(1243,"Move Line Down"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:530,linux:{primary:530},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"2_line",title:localize(1238,"Move &&Line Down"),order:4}})}}class AbstractSortLinesAction extends EditorAction{constructor(e,t){super(t),this.descending=e}run(e,t){if(!t.hasModel())return;const s=t.getModel();let o=t.getSelections();o.length===1&&o[0].isEmpty()&&(o=[new Selection$1(1,1,s.getLineCount(),s.getLineMaxColumn(s.getLineCount()))]);for(const l of o)if(!SortLinesCommand.canRun(t.getModel(),l,this.descending))return;const r=[];for(let l=0,c=o.length;l<c;l++)r[l]=new SortLinesCommand(o[l],this.descending);t.pushUndoStop(),t.executeCommands(this.id,r),t.pushUndoStop()}}class SortLinesAscendingAction extends AbstractSortLinesAction{constructor(){super(!1,{id:"editor.action.sortLinesAscending",label:localize2(1244,"Sort Lines Ascending"),precondition:EditorContextKeys.writable})}}class SortLinesDescendingAction extends AbstractSortLinesAction{constructor(){super(!0,{id:"editor.action.sortLinesDescending",label:localize2(1245,"Sort Lines Descending"),precondition:EditorContextKeys.writable})}}class DeleteDuplicateLinesAction extends EditorAction{constructor(){super({id:"editor.action.removeDuplicateLines",label:localize2(1246,"Delete Duplicate Lines"),precondition:EditorContextKeys.writable})}run(e,t){if(!t.hasModel())return;const s=t.getModel();if(s.getLineCount()===1&&s.getLineMaxColumn(1)===1)return;const o=[],r=[];let l=0,c=!0,d=t.getSelections();d.length===1&&d[0].isEmpty()&&(d=[new Selection$1(1,1,s.getLineCount(),s.getLineMaxColumn(s.getLineCount()))],c=!1);for(const u of d){const g=new Set,f=[];for(let C=u.startLineNumber;C<=u.endLineNumber;C++){const b=s.getLineContent(C);g.has(b)||(f.push(b),g.add(b))}const p=new Selection$1(u.startLineNumber,1,u.endLineNumber,s.getLineMaxColumn(u.endLineNumber)),m=u.startLineNumber-l,_=new Selection$1(m,1,m+f.length-1,f[f.length-1].length);o.push(EditOperation.replace(p,f.join(`
`))),r.push(_),l+=u.endLineNumber-u.startLineNumber+1-f.length}t.pushUndoStop(),t.executeEdits(this.id,o,c?r:void 0),t.pushUndoStop()}}class ReverseLinesAction extends EditorAction{constructor(){super({id:"editor.action.reverseLines",label:localize2(1247,"Reverse lines"),precondition:EditorContextKeys.writable})}run(e,t){if(!t.hasModel())return;const s=t.getModel(),o=t.getSelections();let r=o;r.length===1&&r[0].isEmpty()&&(r=[new Selection$1(1,1,s.getLineCount(),s.getLineMaxColumn(s.getLineCount()))]);const l=[],c=[];for(let d=0;d<r.length;d++){const u=r[d],g=o[d];let f=u.endLineNumber;u.startLineNumber<u.endLineNumber&&u.endColumn===1&&f--;let p=new Range$2(u.startLineNumber,1,f,s.getLineMaxColumn(f));f===s.getLineCount()&&s.getLineContent(p.endLineNumber)===""&&(p=p.setEndPosition(p.endLineNumber-1,s.getLineMaxColumn(p.endLineNumber-1)));const m=[];for(let v=p.endLineNumber;v>=p.startLineNumber;v--)m.push(s.getLineContent(v));const _=EditOperation.replace(p,m.join(`
`));l.push(_);const C=function(v){return v<=p.endLineNumber?p.endLineNumber-v+p.startLineNumber:v},b=function(v){if(v.isEmpty())return new Selection$1(C(v.positionLineNumber),v.positionColumn,C(v.positionLineNumber),v.positionColumn);{const S=C(v.selectionStartLineNumber),y=C(v.positionLineNumber),w=v.selectionStartColumn,L=v.positionColumn;return new Selection$1(S,w,y,L)}};c.push(b(g))}t.pushUndoStop(),t.executeEdits(this.id,l,c),t.pushUndoStop()}}const ro=class ro extends EditorAction{constructor(){super({id:ro.ID,label:localize2(1248,"Trim Trailing Whitespace"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2102),weight:100}})}run(e,t,s){let o=[];s.reason==="auto-save"&&(o=(t.getSelections()||[]).map(g=>new Position$1(g.positionLineNumber,g.positionColumn)));const r=t.getSelection();if(r===null)return;const l=e.get(IConfigurationService),c=t.getModel(),d=l.getValue("files.trimTrailingWhitespaceInRegexAndStrings",{overrideIdentifier:c==null?void 0:c.getLanguageId(),resource:c==null?void 0:c.uri}),u=new TrimTrailingWhitespaceCommand(r,o,d);t.pushUndoStop(),t.executeCommands(this.id,[u]),t.pushUndoStop()}};ro.ID="editor.action.trimTrailingWhitespace";let TrimTrailingWhitespaceAction=ro;class DeleteLinesAction extends EditorAction{constructor(){super({id:"editor.action.deleteLines",label:localize2(1249,"Delete Line"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:3113,weight:100}})}run(e,t){if(!t.hasModel())return;const s=this._getLinesToRemove(t),o=t.getModel();if(o.getLineCount()===1&&o.getLineMaxColumn(1)===1)return;let r=0;const l=[],c=[];for(let d=0,u=s.length;d<u;d++){const g=s[d];let f=g.startLineNumber,p=g.endLineNumber,m=1,_=o.getLineMaxColumn(p);p<o.getLineCount()?(p+=1,_=1):f>1&&(f-=1,m=o.getLineMaxColumn(f)),l.push(EditOperation.replace(new Selection$1(f,m,p,_),"")),c.push(new Selection$1(f-r,g.positionColumn,f-r,g.positionColumn)),r+=g.endLineNumber-g.startLineNumber+1}t.pushUndoStop(),t.executeEdits(this.id,l,c),t.pushUndoStop()}_getLinesToRemove(e){const t=e.getSelections().map(r=>{let l=r.endLineNumber;return r.startLineNumber<r.endLineNumber&&r.endColumn===1&&(l-=1),{startLineNumber:r.startLineNumber,selectionStartColumn:r.selectionStartColumn,endLineNumber:l,positionColumn:r.positionColumn}});t.sort((r,l)=>r.startLineNumber===l.startLineNumber?r.endLineNumber-l.endLineNumber:r.startLineNumber-l.startLineNumber);const s=[];let o=t[0];for(let r=1;r<t.length;r++)o.endLineNumber+1>=t[r].startLineNumber?o.endLineNumber=t[r].endLineNumber:(s.push(o),o=t[r]);return s.push(o),s}}class IndentLinesAction extends EditorAction{constructor(){super({id:"editor.action.indentLines",label:localize2(1250,"Indent Line"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2142,weight:100}})}run(e,t){const s=t._getViewModel();s&&(t.pushUndoStop(),t.executeCommands(this.id,TypeOperations.indent(s.cursorConfig,t.getModel(),t.getSelections())),t.pushUndoStop())}}class OutdentLinesAction extends EditorAction{constructor(){super({id:"editor.action.outdentLines",label:localize2(1251,"Outdent Line"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2140,weight:100}})}run(e,t){CoreEditingCommands.Outdent.runEditorCommand(e,t,null)}}class InsertLineBeforeAction extends EditorAction{constructor(){super({id:"editor.action.insertLineBefore",label:localize2(1252,"Insert Line Above"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3075,weight:100}})}run(e,t){const s=t._getViewModel();s&&(t.pushUndoStop(),t.executeCommands(this.id,EnterOperation.lineInsertBefore(s.cursorConfig,t.getModel(),t.getSelections())))}}class InsertLineAfterAction extends EditorAction{constructor(){super({id:"editor.action.insertLineAfter",label:localize2(1253,"Insert Line Below"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2051,weight:100}})}run(e,t){const s=t._getViewModel();s&&(t.pushUndoStop(),t.executeCommands(this.id,EnterOperation.lineInsertAfter(s.cursorConfig,t.getModel(),t.getSelections())))}}class AbstractDeleteAllToBoundaryAction extends EditorAction{run(e,t){if(!t.hasModel())return;const s=t.getSelection(),o=this._getRangesToDelete(t),r=[];for(let d=0,u=o.length-1;d<u;d++){const g=o[d],f=o[d+1];Range$2.intersectRanges(g,f)===null?r.push(g):o[d+1]=Range$2.plusRange(g,f)}r.push(o[o.length-1]);const l=this._getEndCursorState(s,r),c=r.map(d=>EditOperation.replace(d,""));t.pushUndoStop(),t.executeEdits(this.id,c,l),t.pushUndoStop()}}class DeleteAllLeftAction extends AbstractDeleteAllToBoundaryAction{constructor(){super({id:"deleteAllLeft",label:localize2(1254,"Delete All Left"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:2049},weight:100}})}_getEndCursorState(e,t){let s=null;const o=[];let r=0;return t.forEach(l=>{let c;if(l.endColumn===1&&r>0){const d=l.startLineNumber-r;c=new Selection$1(d,l.startColumn,d,l.startColumn)}else c=new Selection$1(l.startLineNumber,l.startColumn,l.startLineNumber,l.startColumn);r+=l.endLineNumber-l.startLineNumber,l.intersectRanges(e)?s=c:o.push(c)}),s&&o.unshift(s),o}_getRangesToDelete(e){const t=e.getSelections();if(t===null)return[];let s=t;const o=e.getModel();return o===null?[]:(s.sort(Range$2.compareRangesUsingStarts),s=s.map(r=>{if(r.isEmpty())if(r.startColumn===1){const l=Math.max(1,r.startLineNumber-1),c=r.startLineNumber===1?1:o.getLineLength(l)+1;return new Range$2(l,c,r.startLineNumber,1)}else return new Range$2(r.startLineNumber,1,r.startLineNumber,r.startColumn);else return new Range$2(r.startLineNumber,1,r.endLineNumber,r.endColumn)}),s)}}class DeleteAllRightAction extends AbstractDeleteAllToBoundaryAction{constructor(){super({id:"deleteAllRight",label:localize2(1255,"Delete All Right"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:297,secondary:[2068]},weight:100}})}_getEndCursorState(e,t){let s=null;const o=[];for(let r=0,l=t.length,c=0;r<l;r++){const d=t[r],u=new Selection$1(d.startLineNumber-c,d.startColumn,d.startLineNumber-c,d.startColumn);d.intersectRanges(e)?s=u:o.push(u)}return s&&o.unshift(s),o}_getRangesToDelete(e){const t=e.getModel();if(t===null)return[];const s=e.getSelections();if(s===null)return[];const o=s.map(r=>{if(r.isEmpty()){const l=t.getLineMaxColumn(r.startLineNumber);return r.startColumn===l?new Range$2(r.startLineNumber,r.startColumn,r.startLineNumber+1,1):new Range$2(r.startLineNumber,r.startColumn,r.startLineNumber,l)}return r});return o.sort(Range$2.compareRangesUsingStarts),o}}class JoinLinesAction extends EditorAction{constructor(){super({id:"editor.action.joinLines",label:localize2(1256,"Join Lines"),precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:0,mac:{primary:296},weight:100}})}run(e,t){const s=t.getSelections();if(s===null)return;let o=t.getSelection();if(o===null)return;s.sort(Range$2.compareRangesUsingStarts);const r=[],l=s.reduce((p,m)=>p.isEmpty()?p.endLineNumber===m.startLineNumber?(o.equalsSelection(p)&&(o=m),m):m.startLineNumber>p.endLineNumber+1?(r.push(p),m):new Selection$1(p.startLineNumber,p.startColumn,m.endLineNumber,m.endColumn):m.startLineNumber>p.endLineNumber?(r.push(p),m):new Selection$1(p.startLineNumber,p.startColumn,m.endLineNumber,m.endColumn));r.push(l);const c=t.getModel();if(c===null)return;const d=[],u=[];let g=o,f=0;for(let p=0,m=r.length;p<m;p++){const _=r[p],C=_.startLineNumber,b=1;let v=0,S,y;const w=c.getLineLength(_.endLineNumber)-_.endColumn;if(_.isEmpty()||_.startLineNumber===_.endLineNumber){const E=_.getStartPosition();E.lineNumber<c.getLineCount()?(S=C+1,y=c.getLineMaxColumn(S)):(S=E.lineNumber,y=c.getLineMaxColumn(E.lineNumber))}else S=_.endLineNumber,y=c.getLineMaxColumn(S);let L=c.getLineContent(C);for(let E=C+1;E<=S;E++){const I=c.getLineContent(E),D=c.getLineFirstNonWhitespaceColumn(E);if(D>=1){let k=!0;L===""&&(k=!1),k&&(L.charAt(L.length-1)===" "||L.charAt(L.length-1)==="	")&&(k=!1,L=L.replace(/[\s\uFEFF\xA0]+$/g," "));const N=I.substr(D-1);L+=(k?" ":"")+N,k?v=N.length+1:v=N.length}else v=0}const x=new Range$2(C,b,S,y);if(!x.isEmpty()){let E;_.isEmpty()?(d.push(EditOperation.replace(x,L)),E=new Selection$1(x.startLineNumber-f,L.length-v+1,C-f,L.length-v+1)):_.startLineNumber===_.endLineNumber?(d.push(EditOperation.replace(x,L)),E=new Selection$1(_.startLineNumber-f,_.startColumn,_.endLineNumber-f,_.endColumn)):(d.push(EditOperation.replace(x,L)),E=new Selection$1(_.startLineNumber-f,_.startColumn,_.startLineNumber-f,L.length-w)),Range$2.intersectRanges(x,o)!==null?g=E:u.push(E)}f+=x.endLineNumber-x.startLineNumber}u.unshift(g),t.pushUndoStop(),t.executeEdits(this.id,d,u),t.pushUndoStop()}}class TransposeAction extends EditorAction{constructor(){super({id:"editor.action.transpose",label:localize2(1257,"Transpose Characters around the Cursor"),precondition:EditorContextKeys.writable})}run(e,t){const s=t.getSelections();if(s===null)return;const o=t.getModel();if(o===null)return;const r=[];for(let l=0,c=s.length;l<c;l++){const d=s[l];if(!d.isEmpty())continue;const u=d.getStartPosition(),g=o.getLineMaxColumn(u.lineNumber);if(u.column>=g){if(u.lineNumber===o.getLineCount())continue;const f=new Range$2(u.lineNumber,Math.max(1,u.column-1),u.lineNumber+1,1),p=o.getValueInRange(f).split("").reverse().join("");r.push(new ReplaceCommand(new Selection$1(u.lineNumber,Math.max(1,u.column-1),u.lineNumber+1,1),p))}else{const f=new Range$2(u.lineNumber,Math.max(1,u.column-1),u.lineNumber,u.column+1),p=o.getValueInRange(f).split("").reverse().join("");r.push(new ReplaceCommandThatPreservesSelection(f,p,new Selection$1(u.lineNumber,u.column+1,u.lineNumber,u.column+1)))}}t.pushUndoStop(),t.executeCommands(this.id,r),t.pushUndoStop()}}class AbstractCaseAction extends EditorAction{run(e,t){const s=t.getSelections();if(s===null)return;const o=t.getModel();if(o===null)return;const r=t.getOption(148),l=[];for(const c of s)if(c.isEmpty()){const d=c.getStartPosition(),u=t.getConfiguredWordAtPosition(d);if(!u)continue;const g=new Range$2(d.lineNumber,u.startColumn,d.lineNumber,u.endColumn),f=o.getValueInRange(g);l.push(EditOperation.replace(g,this._modifyText(f,r)))}else{const d=o.getValueInRange(c);l.push(EditOperation.replace(c,this._modifyText(d,r)))}t.pushUndoStop(),t.executeEdits(this.id,l),t.pushUndoStop()}}class UpperCaseAction extends AbstractCaseAction{constructor(){super({id:"editor.action.transformToUppercase",label:localize2(1258,"Transform to Uppercase"),precondition:EditorContextKeys.writable})}_modifyText(e,t){return e.toLocaleUpperCase()}}class LowerCaseAction extends AbstractCaseAction{constructor(){super({id:"editor.action.transformToLowercase",label:localize2(1259,"Transform to Lowercase"),precondition:EditorContextKeys.writable})}_modifyText(e,t){return e.toLocaleLowerCase()}}class BackwardsCompatibleRegExp{constructor(e,t){this._pattern=e,this._flags=t,this._actual=null,this._evaluated=!1}get(){if(!this._evaluated){this._evaluated=!0;try{this._actual=new RegExp(this._pattern,this._flags)}catch{}}return this._actual}isSupported(){return this.get()!==null}}const ao=class ao extends AbstractCaseAction{constructor(){super({id:"editor.action.transformToTitlecase",label:localize2(1260,"Transform to Title Case"),precondition:EditorContextKeys.writable})}_modifyText(e,t){const s=ao.titleBoundary.get();return s?e.toLocaleLowerCase().replace(s,o=>o.toLocaleUpperCase()):e}};ao.titleBoundary=new BackwardsCompatibleRegExp("(^|[^\\p{L}\\p{N}']|((^|\\P{L})'))\\p{L}","gmu");let TitleCaseAction=ao;const ci=class ci extends AbstractCaseAction{constructor(){super({id:"editor.action.transformToSnakecase",label:localize2(1261,"Transform to Snake Case"),precondition:EditorContextKeys.writable})}_modifyText(e,t){const s=ci.caseBoundary.get(),o=ci.singleLetters.get();return!s||!o?e:e.replace(s,"$1_$2").replace(o,"$1_$2$3").toLocaleLowerCase()}};ci.caseBoundary=new BackwardsCompatibleRegExp("(\\p{Ll})(\\p{Lu})","gmu"),ci.singleLetters=new BackwardsCompatibleRegExp("(\\p{Lu}|\\p{N})(\\p{Lu})(\\p{Ll})","gmu");let SnakeCaseAction=ci;const nt=class nt extends AbstractCaseAction{constructor(){super({id:"editor.action.transformToCamelcase",label:localize2(1262,"Transform to Camel Case"),precondition:EditorContextKeys.writable})}_modifyText(e,t){var c;const s=/\r\n|\r|\n/.test(e)?nt.multiLineWordBoundary.get():nt.singleLineWordBoundary.get(),o=nt.validWordStart.get();if(!s||!o)return e;const r=e.split(s);return((c=r.shift())==null?void 0:c.replace(o,d=>d.toLocaleLowerCase()))+r.map(d=>d.substring(0,1).toLocaleUpperCase()+d.substring(1)).join("")}};nt.singleLineWordBoundary=new BackwardsCompatibleRegExp("[_\\s-]+","gm"),nt.multiLineWordBoundary=new BackwardsCompatibleRegExp("[_-]+","gm"),nt.validWordStart=new BackwardsCompatibleRegExp("^(\\p{Lu}[^\\p{Lu}])","gmu");let CamelCaseAction=nt;const di=class di extends AbstractCaseAction{constructor(){super({id:"editor.action.transformToPascalcase",label:localize2(1263,"Transform to Pascal Case"),precondition:EditorContextKeys.writable})}_modifyText(e,t){const s=di.wordBoundary.get(),o=di.wordBoundaryToMaintain.get();return!s||!o?e:e.split(o).map(c=>c.split(s)).flat().map(c=>c.substring(0,1).toLocaleUpperCase()+c.substring(1)).join("")}};di.wordBoundary=new BackwardsCompatibleRegExp("[_ \\t-]","gm"),di.wordBoundaryToMaintain=new BackwardsCompatibleRegExp("(?<=\\.)","gm");let PascalCaseAction=di;const st=class st extends AbstractCaseAction{static isSupported(){return[this.caseBoundary,this.singleLetters,this.underscoreBoundary].every(t=>t.isSupported())}constructor(){super({id:"editor.action.transformToKebabcase",label:localize2(1264,"Transform to Kebab Case"),precondition:EditorContextKeys.writable})}_modifyText(e,t){const s=st.caseBoundary.get(),o=st.singleLetters.get(),r=st.underscoreBoundary.get();return!s||!o||!r?e:e.replace(r,"$1-$3").replace(s,"$1-$2").replace(o,"$1-$2").toLocaleLowerCase()}};st.caseBoundary=new BackwardsCompatibleRegExp("(\\p{Ll})(\\p{Lu})","gmu"),st.singleLetters=new BackwardsCompatibleRegExp("(\\p{Lu}|\\p{N})(\\p{Lu}\\p{Ll})","gmu"),st.underscoreBoundary=new BackwardsCompatibleRegExp("(\\S)(_)(\\S)","gm");let KebabCaseAction=st;registerEditorAction(CopyLinesUpAction);registerEditorAction(CopyLinesDownAction);registerEditorAction(DuplicateSelectionAction);registerEditorAction(MoveLinesUpAction);registerEditorAction(MoveLinesDownAction);registerEditorAction(SortLinesAscendingAction);registerEditorAction(SortLinesDescendingAction);registerEditorAction(DeleteDuplicateLinesAction);registerEditorAction(TrimTrailingWhitespaceAction);registerEditorAction(DeleteLinesAction);registerEditorAction(IndentLinesAction);registerEditorAction(OutdentLinesAction);registerEditorAction(InsertLineBeforeAction);registerEditorAction(InsertLineAfterAction);registerEditorAction(DeleteAllLeftAction);registerEditorAction(DeleteAllRightAction);registerEditorAction(JoinLinesAction);registerEditorAction(TransposeAction);registerEditorAction(UpperCaseAction);registerEditorAction(LowerCaseAction);registerEditorAction(ReverseLinesAction);SnakeCaseAction.caseBoundary.isSupported()&&SnakeCaseAction.singleLetters.isSupported()&&registerEditorAction(SnakeCaseAction);CamelCaseAction.singleLineWordBoundary.isSupported()&&CamelCaseAction.multiLineWordBoundary.isSupported()&&registerEditorAction(CamelCaseAction);PascalCaseAction.wordBoundary.isSupported()&&registerEditorAction(PascalCaseAction);TitleCaseAction.titleBoundary.isSupported()&&registerEditorAction(TitleCaseAction);KebabCaseAction.isSupported()&&registerEditorAction(KebabCaseAction);const linkedEditing="";var __decorate$Q=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$P=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},LinkedEditingContribution_1;const CONTEXT_ONTYPE_RENAME_INPUT_VISIBLE=new RawContextKey("LinkedEditingInputVisible",!1),DECORATION_CLASS_NAME="linked-editing-decoration";var Vt;let LinkedEditingContribution=(Vt=class extends Disposable{static get(e){return e.getContribution(LinkedEditingContribution_1.ID)}constructor(e,t,s,o,r){super(),this.languageConfigurationService=o,this._syncRangesToken=0,this._localToDispose=this._register(new DisposableStore),this._editor=e,this._providers=s.linkedEditingRangeProvider,this._enabled=!1,this._visibleContextKey=CONTEXT_ONTYPE_RENAME_INPUT_VISIBLE.bindTo(t),this._debounceInformation=r.for(this._providers,"Linked Editing",{max:200}),this._currentDecorations=this._editor.createDecorationsCollection(),this._languageWordPattern=null,this._currentWordPattern=null,this._ignoreChangeEvent=!1,this._localToDispose=this._register(new DisposableStore),this._rangeUpdateTriggerPromise=null,this._rangeSyncTriggerPromise=null,this._currentRequestCts=null,this._currentRequestPosition=null,this._currentRequestModelVersion=null,this._register(this._editor.onDidChangeModel(()=>this.reinitialize(!0))),this._register(this._editor.onDidChangeConfiguration(l=>{(l.hasChanged(78)||l.hasChanged(106))&&this.reinitialize(!1)})),this._register(this._providers.onDidChange(()=>this.reinitialize(!1))),this._register(this._editor.onDidChangeModelLanguage(()=>this.reinitialize(!0))),this.reinitialize(!0)}reinitialize(e){const t=this._editor.getModel(),s=t!==null&&(this._editor.getOption(78)||this._editor.getOption(106))&&this._providers.has(t);if(s===this._enabled&&!e||(this._enabled=s,this.clearRanges(),this._localToDispose.clear(),!s||t===null))return;this._localToDispose.add(Event$1.runAndSubscribe(t.onDidChangeLanguageConfiguration,()=>{this._languageWordPattern=this.languageConfigurationService.getLanguageConfiguration(t.getLanguageId()).getWordDefinition()}));const o=new Delayer(this._debounceInformation.get(t)),r=()=>{this._rangeUpdateTriggerPromise=o.trigger(()=>this.updateRanges(),this._debounceDuration??this._debounceInformation.get(t))},l=new Delayer(0),c=d=>{this._rangeSyncTriggerPromise=l.trigger(()=>this._syncRanges(d))};this._localToDispose.add(this._editor.onDidChangeCursorPosition(()=>{r()})),this._localToDispose.add(this._editor.onDidChangeModelContent(d=>{if(!this._ignoreChangeEvent&&this._currentDecorations.length>0){const u=this._currentDecorations.getRange(0);if(u&&d.changes.every(g=>u.intersectRanges(g.range))){c(this._syncRangesToken);return}}r()})),this._localToDispose.add({dispose:()=>{o.dispose(),l.dispose()}}),this.updateRanges()}_syncRanges(e){if(!this._editor.hasModel()||e!==this._syncRangesToken||this._currentDecorations.length===0)return;const t=this._editor.getModel(),s=this._currentDecorations.getRange(0);if(!s||s.startLineNumber!==s.endLineNumber)return this.clearRanges();const o=t.getValueInRange(s);if(this._currentWordPattern){const l=o.match(this._currentWordPattern);if((l?l[0].length:0)!==o.length)return this.clearRanges()}const r=[];for(let l=1,c=this._currentDecorations.length;l<c;l++){const d=this._currentDecorations.getRange(l);if(d)if(d.startLineNumber!==d.endLineNumber)r.push({range:d,text:o});else{let u=t.getValueInRange(d),g=o,f=d.startColumn,p=d.endColumn;const m=commonPrefixLength(u,g);f+=m,u=u.substr(m),g=g.substr(m);const _=commonSuffixLength(u,g);p-=_,u=u.substr(0,u.length-_),g=g.substr(0,g.length-_),(f!==p||g.length!==0)&&r.push({range:new Range$2(d.startLineNumber,f,d.endLineNumber,p),text:g})}}if(r.length!==0)try{this._editor.popUndoStop(),this._ignoreChangeEvent=!0;const l=this._editor._getViewModel().getPrevEditOperationType();this._editor.executeEdits("linkedEditing",r),this._editor._getViewModel().setPrevEditOperationType(l)}finally{this._ignoreChangeEvent=!1}}dispose(){this.clearRanges(),super.dispose()}clearRanges(){this._visibleContextKey.set(!1),this._currentDecorations.clear(),this._currentRequestCts&&(this._currentRequestCts.cancel(),this._currentRequestCts=null,this._currentRequestPosition=null)}async updateRanges(e=!1){var l;if(!this._editor.hasModel()){this.clearRanges();return}const t=this._editor.getPosition();if(!this._enabled&&!e||this._editor.getSelections().length>1){this.clearRanges();return}const s=this._editor.getModel(),o=s.getVersionId();if(this._currentRequestPosition&&this._currentRequestModelVersion===o){if(t.equals(this._currentRequestPosition))return;if(this._currentDecorations.length>0){const c=this._currentDecorations.getRange(0);if(c&&c.containsPosition(t))return}}if(!((l=this._currentRequestPosition)!=null&&l.equals(t))){const c=this._currentDecorations.getRange(0);c!=null&&c.containsPosition(t)||this.clearRanges()}this._currentRequestPosition=t,this._currentRequestModelVersion=o;const r=this._currentRequestCts=new CancellationTokenSource$1;try{const c=new StopWatch(!1),d=await getLinkedEditingRanges(this._providers,s,t,r.token);if(this._debounceInformation.update(s,c.elapsed()),r!==this._currentRequestCts||(this._currentRequestCts=null,o!==s.getVersionId()))return;let u=[];d!=null&&d.ranges&&(u=d.ranges),this._currentWordPattern=(d==null?void 0:d.wordPattern)||this._languageWordPattern;let g=!1;for(let p=0,m=u.length;p<m;p++)if(Range$2.containsPosition(u[p],t)){if(g=!0,p!==0){const _=u[p];u.splice(p,1),u.unshift(_)}break}if(!g){this.clearRanges();return}const f=u.map(p=>({range:p,options:LinkedEditingContribution_1.DECORATION}));this._visibleContextKey.set(!0),this._currentDecorations.set(f),this._syncRangesToken++}catch(c){isCancellationError(c)||onUnexpectedError(c),(this._currentRequestCts===r||!this._currentRequestCts)&&this.clearRanges()}}},LinkedEditingContribution_1=Vt,Vt.ID="editor.contrib.linkedEditing",Vt.DECORATION=ModelDecorationOptions.register({description:"linked-editing",stickiness:0,className:DECORATION_CLASS_NAME}),Vt);LinkedEditingContribution=LinkedEditingContribution_1=__decorate$Q([__param$P(1,IContextKeyService),__param$P(2,ILanguageFeaturesService),__param$P(3,ILanguageConfigurationService),__param$P(4,ILanguageFeatureDebounceService)],LinkedEditingContribution);class LinkedEditingAction extends EditorAction{constructor(){super({id:"editor.action.linkedEditing",label:localize2(1266,"Start Linked Editing"),precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasRenameProvider),kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3132,weight:100}})}runCommand(e,t){const s=e.get(ICodeEditorService),[o,r]=Array.isArray(t)&&t||[void 0,void 0];return URI.isUri(o)&&Position$1.isIPosition(r)?s.openCodeEditor({resource:o},s.getActiveCodeEditor()).then(l=>{l&&(l.setPosition(r),l.invokeWithinContext(c=>(this.reportTelemetry(c,l),this.run(c,l))))},onUnexpectedError):super.runCommand(e,t)}run(e,t){const s=LinkedEditingContribution.get(t);return s?Promise.resolve(s.updateRanges(!0)):Promise.resolve()}}const LinkedEditingCommand=EditorCommand.bindToContribution(LinkedEditingContribution.get);registerEditorCommand(new LinkedEditingCommand({id:"cancelLinkedEditingInput",precondition:CONTEXT_ONTYPE_RENAME_INPUT_VISIBLE,handler:a=>a.clearRanges(),kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,weight:100+99,primary:9,secondary:[1033]}}));function getLinkedEditingRanges(a,e,t,s){const o=a.ordered(e);return first(o.map(r=>async()=>{try{return await r.provideLinkedEditingRanges(e,t,s)}catch(l){onUnexpectedExternalError(l);return}}),r=>!!r&&isNonEmptyArray(r==null?void 0:r.ranges))}registerColor("editor.linkedEditingBackground",{dark:Color.fromHex("#f00").transparent(.3),light:Color.fromHex("#f00").transparent(.3),hcDark:Color.fromHex("#f00").transparent(.3),hcLight:Color.white},localize(1265,"Background color when the editor auto renames on type."));registerModelAndPositionCommand("_executeLinkedEditingProvider",(a,e,t)=>{const{linkedEditingRangeProvider:s}=a.get(ILanguageFeaturesService);return getLinkedEditingRanges(s,e,t,CancellationToken.None)});registerEditorContribution(LinkedEditingContribution.ID,LinkedEditingContribution,1);registerEditorAction(LinkedEditingAction);const links="";let Link$1=class{constructor(e,t){this._link=e,this._provider=t}toJSON(){return{range:this.range,url:this.url,tooltip:this.tooltip}}get range(){return this._link.range}get url(){return this._link.url}get tooltip(){return this._link.tooltip}async resolve(e){return this._link.url?this._link.url:typeof this._provider.resolveLink=="function"?Promise.resolve(this._provider.resolveLink(this._link,e)).then(t=>(this._link=t||this._link,this._link.url?this.resolve(e):Promise.reject(new Error("missing")))):Promise.reject(new Error("missing"))}};const Sn=class Sn{constructor(e){this._disposables=new DisposableStore;let t=[];for(const[s,o]of e){const r=s.links.map(l=>new Link$1(l,o));t=Sn._union(t,r),isDisposable(s)&&(this._disposables??(this._disposables=new DisposableStore),this._disposables.add(s))}this.links=t}dispose(){var e;(e=this._disposables)==null||e.dispose(),this.links.length=0}static _union(e,t){const s=[];let o,r,l,c;for(o=0,l=0,r=e.length,c=t.length;o<r&&l<c;){const d=e[o],u=t[l];if(Range$2.areIntersectingOrTouching(d.range,u.range)){o++;continue}Range$2.compareRangesUsingStarts(d.range,u.range)<0?(s.push(d),o++):(s.push(u),l++)}for(;o<r;o++)s.push(e[o]);for(;l<c;l++)s.push(t[l]);return s}};Sn.Empty=new Sn([]);let LinksList=Sn;async function getLinks(a,e,t){const s=[],o=a.ordered(e).reverse().map(async(l,c)=>{try{const d=await l.provideLinks(e,t);d&&(s[c]=[d,l])}catch(d){onUnexpectedExternalError(d)}});await Promise.all(o);let r=new LinksList(coalesce(s));return t.isCancellationRequested&&(r.dispose(),r=LinksList.Empty),r}CommandsRegistry.registerCommand("_executeLinkProvider",async(a,...e)=>{let[t,s]=e;assertType(t instanceof URI),typeof s!="number"&&(s=0);const{linkProvider:o}=a.get(ILanguageFeaturesService),r=a.get(IModelService).getModel(t);if(!r)return[];const l=await getLinks(o,r,CancellationToken.None);if(!l)return[];for(let d=0;d<Math.min(s,l.links.length);d++)await l.links[d].resolve(CancellationToken.None);const c=l.links.slice(0);return l.dispose(),c});var __decorate$P=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$O=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},LinkDetector_1,Zi;let LinkDetector=(Zi=class extends Disposable{static get(e){return e.getContribution(LinkDetector_1.ID)}constructor(e,t,s,o,r){super(),this.editor=e,this.openerService=t,this.notificationService=s,this.languageFeaturesService=o,this.providers=this.languageFeaturesService.linkProvider,this.debounceInformation=r.for(this.providers,"Links",{min:1e3,max:4e3}),this.computeLinks=this._register(new RunOnceScheduler(()=>this.computeLinksNow(),1e3)),this.computePromise=null,this.activeLinksList=null,this.currentOccurrences={},this.activeLinkDecorationId=null;const l=this._register(new ClickLinkGesture(e));this._register(l.onMouseMoveOrRelevantKeyDown(([c,d])=>{this._onEditorMouseMove(c,d)})),this._register(l.onExecute(c=>{this.onEditorMouseUp(c)})),this._register(l.onCancel(c=>{this.cleanUpActiveLinkDecoration()})),this._register(e.onDidChangeConfiguration(c=>{c.hasChanged(79)&&(this.updateDecorations([]),this.stop(),this.computeLinks.schedule(0))})),this._register(e.onDidChangeModelContent(c=>{this.editor.hasModel()&&this.computeLinks.schedule(this.debounceInformation.get(this.editor.getModel()))})),this._register(e.onDidChangeModel(c=>{this.currentOccurrences={},this.activeLinkDecorationId=null,this.stop(),this.computeLinks.schedule(0)})),this._register(e.onDidChangeModelLanguage(c=>{this.stop(),this.computeLinks.schedule(0)})),this._register(this.providers.onDidChange(c=>{this.stop(),this.computeLinks.schedule(0)})),this.computeLinks.schedule(0)}async computeLinksNow(){if(!this.editor.hasModel()||!this.editor.getOption(79))return;const e=this.editor.getModel();if(!e.isTooLargeForSyncing()&&this.providers.has(e)){this.activeLinksList&&(this.activeLinksList.dispose(),this.activeLinksList=null),this.computePromise=createCancelablePromise(t=>getLinks(this.providers,e,t));try{const t=new StopWatch(!1);if(this.activeLinksList=await this.computePromise,this.debounceInformation.update(e,t.elapsed()),e.isDisposed())return;this.updateDecorations(this.activeLinksList.links)}catch(t){onUnexpectedError(t)}finally{this.computePromise=null}}}updateDecorations(e){const t=this.editor.getOption(86)==="altKey",s=[],o=Object.keys(this.currentOccurrences);for(const l of o){const c=this.currentOccurrences[l];s.push(c.decorationId)}const r=[];if(e)for(const l of e)r.push(LinkOccurrence.decoration(l,t));this.editor.changeDecorations(l=>{const c=l.deltaDecorations(s,r);this.currentOccurrences={},this.activeLinkDecorationId=null;for(let d=0,u=c.length;d<u;d++){const g=new LinkOccurrence(e[d],c[d]);this.currentOccurrences[g.decorationId]=g}})}_onEditorMouseMove(e,t){const s=this.editor.getOption(86)==="altKey";if(this.isEnabled(e,t)){this.cleanUpActiveLinkDecoration();const o=this.getLinkOccurrence(e.target.position);o&&this.editor.changeDecorations(r=>{o.activate(r,s),this.activeLinkDecorationId=o.decorationId})}else this.cleanUpActiveLinkDecoration()}cleanUpActiveLinkDecoration(){const e=this.editor.getOption(86)==="altKey";if(this.activeLinkDecorationId){const t=this.currentOccurrences[this.activeLinkDecorationId];t&&this.editor.changeDecorations(s=>{t.deactivate(s,e)}),this.activeLinkDecorationId=null}}onEditorMouseUp(e){if(!this.isEnabled(e))return;const t=this.getLinkOccurrence(e.target.position);t&&this.openLinkOccurrence(t,e.hasSideBySideModifier,!0)}openLinkOccurrence(e,t,s=!1){if(!this.openerService)return;const{link:o}=e;o.resolve(CancellationToken.None).then(r=>{if(typeof r=="string"&&this.editor.hasModel()){const l=this.editor.getModel().uri;if(l.scheme===Schemas.file&&r.startsWith(`${Schemas.file}:`)){const c=URI.parse(r);if(c.scheme===Schemas.file){const d=originalFSPath(c);let u=null;d.startsWith("/./")||d.startsWith("\\.\\")?u=`.${d.substr(1)}`:(d.startsWith("//./")||d.startsWith("\\\\.\\"))&&(u=`.${d.substr(2)}`),u&&(r=joinPath(l,u))}}}return this.openerService.open(r,{openToSide:t,fromUserGesture:s,allowContributedOpeners:!0,allowCommands:!0,fromWorkspace:!0})},r=>{const l=r instanceof Error?r.message:r;l==="invalid"?this.notificationService.warn(localize(1267,"Failed to open this link because it is not well-formed: {0}",o.url.toString())):l==="missing"?this.notificationService.warn(localize(1268,"Failed to open this link because its target is missing.")):onUnexpectedError(r)})}getLinkOccurrence(e){if(!this.editor.hasModel()||!e)return null;const t=this.editor.getModel().getDecorationsInRange({startLineNumber:e.lineNumber,startColumn:e.column,endLineNumber:e.lineNumber,endColumn:e.column},0,!0);for(const s of t){const o=this.currentOccurrences[s.id];if(o)return o}return null}isEnabled(e,t){return!!(e.target.type===6&&(e.hasTriggerModifier||t&&t.keyCodeIsTriggerKey||e.isMiddleClick&&e.mouseMiddleClickAction==="openLink"))}stop(){var e;this.computeLinks.cancel(),this.activeLinksList&&((e=this.activeLinksList)==null||e.dispose(),this.activeLinksList=null),this.computePromise&&(this.computePromise.cancel(),this.computePromise=null)}dispose(){super.dispose(),this.stop()}},LinkDetector_1=Zi,Zi.ID="editor.linkDetector",Zi);LinkDetector=LinkDetector_1=__decorate$P([__param$O(1,IOpenerService),__param$O(2,INotificationService),__param$O(3,ILanguageFeaturesService),__param$O(4,ILanguageFeatureDebounceService)],LinkDetector);const decoration$1={general:ModelDecorationOptions.register({description:"detected-link",stickiness:1,collapseOnReplaceEdit:!0,inlineClassName:"detected-link"}),active:ModelDecorationOptions.register({description:"detected-link-active",stickiness:1,collapseOnReplaceEdit:!0,inlineClassName:"detected-link-active"})};class LinkOccurrence{static decoration(e,t){return{range:e.range,options:LinkOccurrence._getOptions(e,t,!1)}}static _getOptions(e,t,s){const o={...s?decoration$1.active:decoration$1.general};return o.hoverMessage=getHoverMessage(e,t),o}constructor(e,t){this.link=e,this.decorationId=t}activate(e,t){e.changeDecorationOptions(this.decorationId,LinkOccurrence._getOptions(this.link,t,!0))}deactivate(e,t){e.changeDecorationOptions(this.decorationId,LinkOccurrence._getOptions(this.link,t,!1))}}function getHoverMessage(a,e){const t=a.url&&/^command:/i.test(a.url.toString()),s=a.tooltip?a.tooltip:t?localize(1269,"Execute command"):localize(1270,"Follow link"),o=e?isMacintosh?localize(1271,"cmd + click"):localize(1272,"ctrl + click"):isMacintosh?localize(1273,"option + click"):localize(1274,"alt + click");if(a.url){let r="";if(/^command:/i.test(a.url.toString())){const c=a.url.toString().match(/^command:([^?#]+)/);if(c){const d=c[1];r=localize(1275,"Execute command {0}",d)}}return new MarkdownString("",!0).appendLink(a.url.toString(!0).replace(/ /g,"%20"),s,r).appendMarkdown(` (${o})`)}else return new MarkdownString().appendText(`${s} (${o})`)}class OpenLinkAction extends EditorAction{constructor(){super({id:"editor.action.openLink",label:localize2(1276,"Open Link"),precondition:void 0})}run(e,t){const s=LinkDetector.get(t);if(!s||!t.hasModel())return;const o=t.getSelections();for(const r of o){const l=s.getLinkOccurrence(r.getEndPosition());l&&s.openLinkOccurrence(l,!1)}}}registerEditorContribution(LinkDetector.ID,LinkDetector,1);registerEditorAction(OpenLinkAction);const Zo=class Zo extends Disposable{constructor(e){super(),this._editor=e,this._register(this._editor.onMouseDown(t=>{const s=this._editor.getOption(133);s>=0&&t.target.type===6&&t.target.position.column>=s&&this._editor.updateOptions({stopRenderingLineAfter:-1})}))}};Zo.ID="editor.contrib.longLinesHelper";let LongLinesHelper=Zo;registerEditorContribution(LongLinesHelper.ID,LongLinesHelper,2);const middleScroll="",Qo=class Qo extends Disposable{constructor(e){super(),this._editor=e;const t=observableCodeEditor(this._editor),s=t.getOption(171);this._register(autorun(o=>{if(!s.read(o))return;const r=t.domNode.read(o);if(!r)return;const l=o.store.add(disposableObservableValue("scrollingSession",void 0));o.store.add(this._editor.onMouseDown(d=>{if(l.read(void 0)){l.set(void 0,void 0);return}if(!d.event.middleButton)return;d.event.stopPropagation(),d.event.preventDefault();const g=new DisposableStore,f=new Point(d.event.posx,d.event.posy),m=observeWindowMousePos(getWindow(r),f,g).map(b=>b.subtract(f).withThreshold(5)),_=r.getBoundingClientRect(),C=new Point(f.x-_.left,f.y-_.top);l.set({mouseDeltaAfterThreshold:m,initialMousePosInEditor:C,didScroll:!1,dispose:()=>g.dispose()},void 0),g.add(this._editor.onMouseUp(b=>{const v=l.read(void 0);v&&v.didScroll&&l.set(void 0,void 0)})),g.add(this._editor.onKeyDown(b=>{l.set(void 0,void 0)}))})),o.store.add(autorun(d=>{const u=l.read(d);if(!u)return;let g=Date.now();d.store.add(autorun(p=>{AnimationFrameScheduler.instance.invalidateOnNextAnimationFrame(p);const m=Date.now(),_=m-g;g=m;const C=u.mouseDeltaAfterThreshold.read(void 0),b=_/32,v=C.scale(b),S=new Point(this._editor.getScrollLeft(),this._editor.getScrollTop());this._editor.setScrollPosition(toScrollPosition(S.add(v))),v.isZero()||(u.didScroll=!0)}));const f=derived(p=>{const m=u.mouseDeltaAfterThreshold.read(p);let _="";return _+=m.y<0?"n":m.y>0?"s":"",_+=m.x<0?"w":m.x>0?"e":"",_});d.store.add(autorun(p=>{r.setAttribute("data-scroll-direction",f.read(p))}))}));const c=o.store.add(n.div({class:["scroll-editor-on-middle-click-dot",l.map(d=>d?"":"hidden")],style:{left:l.map(d=>d?d.initialMousePosInEditor.x:0),top:l.map(d=>d?d.initialMousePosInEditor.y:0)}}).toDisposableLiveElement());o.store.add(appendRemoveOnDispose(r,c.element)),o.store.add(autorun(d=>{const u=l.read(d);r.classList.toggle("scroll-editor-on-middle-click-editor",!!u)}))}))}};Qo.ID="editor.contrib.middleScroll";let MiddleScrollController=Qo;function observeWindowMousePos(a,e,t){const s=observableValue("pos",e);return t.add(addDisposableListener(a,"mousemove",o=>{s.set(new Point(o.pageX,o.pageY),void 0)})),s}function toScrollPosition(a){return{scrollLeft:a.x,scrollTop:a.y}}registerEditorContribution(MiddleScrollController.ID,MiddleScrollController,2);const highlightDecorations="",wordHighlightBackground=registerColor("editor.wordHighlightBackground",{dark:"#575757B8",light:"#57575740",hcDark:null,hcLight:null},localize(1548,"Background color of a symbol during read-access, like reading a variable. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("editor.wordHighlightStrongBackground",{dark:"#004972B8",light:"#0e639c40",hcDark:null,hcLight:null},localize(1549,"Background color of a symbol during write-access, like writing to a variable. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("editor.wordHighlightTextBackground",wordHighlightBackground,localize(1550,"Background color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations."),!0);const wordHighlightBorder=registerColor("editor.wordHighlightBorder",{light:null,dark:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize(1551,"Border color of a symbol during read-access, like reading a variable."));registerColor("editor.wordHighlightStrongBorder",{light:null,dark:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize(1552,"Border color of a symbol during write-access, like writing to a variable."));registerColor("editor.wordHighlightTextBorder",wordHighlightBorder,localize(1553,"Border color of a textual occurrence for a symbol."));const overviewRulerWordHighlightForeground=registerColor("editorOverviewRuler.wordHighlightForeground","#A0A0A0CC",localize(1554,"Overview ruler marker color for symbol highlights. The color must not be opaque so as not to hide underlying decorations."),!0),overviewRulerWordHighlightStrongForeground=registerColor("editorOverviewRuler.wordHighlightStrongForeground","#C0A0C0CC",localize(1555,"Overview ruler marker color for write-access symbol highlights. The color must not be opaque so as not to hide underlying decorations."),!0),overviewRulerWordHighlightTextForeground=registerColor("editorOverviewRuler.wordHighlightTextForeground",overviewRulerSelectionHighlightForeground,localize(1556,"Overview ruler marker color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations."),!0),_WRITE_OPTIONS=ModelDecorationOptions.register({description:"word-highlight-strong",stickiness:1,className:"wordHighlightStrong",overviewRuler:{color:themeColorFromId(overviewRulerWordHighlightStrongForeground),position:OverviewRulerLane$1.Center},minimap:{color:themeColorFromId(minimapSelectionOccurrenceHighlight),position:1}}),_TEXT_OPTIONS=ModelDecorationOptions.register({description:"word-highlight-text",stickiness:1,className:"wordHighlightText",overviewRuler:{color:themeColorFromId(overviewRulerWordHighlightTextForeground),position:OverviewRulerLane$1.Center},minimap:{color:themeColorFromId(minimapSelectionOccurrenceHighlight),position:1}}),_SELECTION_HIGHLIGHT_OPTIONS=ModelDecorationOptions.register({description:"selection-highlight-overview",stickiness:1,className:"selectionHighlight",overviewRuler:{color:themeColorFromId(overviewRulerSelectionHighlightForeground),position:OverviewRulerLane$1.Center},minimap:{color:themeColorFromId(minimapSelectionOccurrenceHighlight),position:1}}),_SELECTION_HIGHLIGHT_OPTIONS_NO_OVERVIEW=ModelDecorationOptions.register({description:"selection-highlight",stickiness:1,className:"selectionHighlight"}),_REGULAR_OPTIONS=ModelDecorationOptions.register({description:"word-highlight",stickiness:1,className:"wordHighlight",overviewRuler:{color:themeColorFromId(overviewRulerWordHighlightForeground),position:OverviewRulerLane$1.Center},minimap:{color:themeColorFromId(minimapSelectionOccurrenceHighlight),position:1}});function getHighlightDecorationOptions(a){return a===DocumentHighlightKind$1.Write?_WRITE_OPTIONS:a===DocumentHighlightKind$1.Text?_TEXT_OPTIONS:_REGULAR_OPTIONS}function getSelectionHighlightDecorationOptions(a){return a?_SELECTION_HIGHLIGHT_OPTIONS_NO_OVERVIEW:_SELECTION_HIGHLIGHT_OPTIONS}registerThemingParticipant((a,e)=>{const t=a.getColor(editorSelectionHighlight);t&&e.addRule(`.monaco-editor .selectionHighlight { background-color: ${t.transparent(.5)}; }`)});var __decorate$O=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$N=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},SelectionHighlighter_1;function announceCursorChange(a,e){const t=e.filter(s=>!a.find(o=>o.equals(s)));if(t.length>=1){const s=t.map(r=>`line ${r.viewState.position.lineNumber} column ${r.viewState.position.column}`).join(", "),o=t.length===1?localize(1278,"Cursor added: {0}",s):localize(1279,"Cursors added: {0}",s);status(o)}}class InsertCursorAbove extends EditorAction{constructor(){super({id:"editor.action.insertCursorAbove",label:localize2(1288,"Add Cursor Above"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2576,linux:{primary:1552,secondary:[3088]},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"3_multi",title:localize(1280,"&&Add Cursor Above"),order:2}})}run(e,t,s){if(!t.hasModel())return;let o=!0;s&&s.logicalLine===!1&&(o=!1);const r=t._getViewModel();if(r.cursorConfig.readOnly)return;r.model.pushStackElement();const l=r.getCursorStates();r.setCursorStates(s.source,3,CursorMoveCommands.addCursorUp(r,l,o)),r.revealTopMostCursor(s.source),announceCursorChange(l,r.getCursorStates())}}class InsertCursorBelow extends EditorAction{constructor(){super({id:"editor.action.insertCursorBelow",label:localize2(1289,"Add Cursor Below"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2578,linux:{primary:1554,secondary:[3090]},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"3_multi",title:localize(1281,"A&&dd Cursor Below"),order:3}})}run(e,t,s){if(!t.hasModel())return;let o=!0;s&&s.logicalLine===!1&&(o=!1);const r=t._getViewModel();if(r.cursorConfig.readOnly)return;r.model.pushStackElement();const l=r.getCursorStates();r.setCursorStates(s.source,3,CursorMoveCommands.addCursorDown(r,l,o)),r.revealBottomMostCursor(s.source),announceCursorChange(l,r.getCursorStates())}}class InsertCursorAtEndOfEachLineSelected extends EditorAction{constructor(){super({id:"editor.action.insertCursorAtEndOfEachLineSelected",label:localize2(1290,"Add Cursors to Line Ends"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1575,weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"3_multi",title:localize(1282,"Add C&&ursors to Line Ends"),order:4}})}getCursorsForSelection(e,t,s){if(!e.isEmpty()){for(let o=e.startLineNumber;o<e.endLineNumber;o++){const r=t.getLineMaxColumn(o);s.push(new Selection$1(o,r,o,r))}e.endColumn>1&&s.push(new Selection$1(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn))}}run(e,t){if(!t.hasModel())return;const s=t.getModel(),o=t.getSelections(),r=t._getViewModel(),l=r.getCursorStates(),c=[];o.forEach(d=>this.getCursorsForSelection(d,s,c)),c.length>0&&t.setSelections(c),announceCursorChange(l,r.getCursorStates())}}class InsertCursorAtEndOfLineSelected extends EditorAction{constructor(){super({id:"editor.action.addCursorsToBottom",label:localize2(1291,"Add Cursors to Bottom"),precondition:void 0})}run(e,t){if(!t.hasModel())return;const s=t.getSelections(),o=t.getModel().getLineCount(),r=[];for(let d=s[0].startLineNumber;d<=o;d++)r.push(new Selection$1(d,s[0].startColumn,d,s[0].endColumn));const l=t._getViewModel(),c=l.getCursorStates();r.length>0&&t.setSelections(r),announceCursorChange(c,l.getCursorStates())}}class InsertCursorAtTopOfLineSelected extends EditorAction{constructor(){super({id:"editor.action.addCursorsToTop",label:localize2(1292,"Add Cursors to Top"),precondition:void 0})}run(e,t){if(!t.hasModel())return;const s=t.getSelections(),o=[];for(let c=s[0].startLineNumber;c>=1;c--)o.push(new Selection$1(c,s[0].startColumn,c,s[0].endColumn));const r=t._getViewModel(),l=r.getCursorStates();o.length>0&&t.setSelections(o),announceCursorChange(l,r.getCursorStates())}}class MultiCursorSessionResult{constructor(e,t,s){this.selections=e,this.revealRange=t,this.revealScrollType=s}}class MultiCursorSession{static create(e,t){if(!e.hasModel())return null;const s=t.getState();if(!e.hasTextFocus()&&s.isRevealed&&s.searchString.length>0)return new MultiCursorSession(e,t,!1,s.searchString,s.wholeWord,s.matchCase,null);let o=!1,r,l;const c=e.getSelections();c.length===1&&c[0].isEmpty()?(o=!0,r=!0,l=!0):(r=s.wholeWord,l=s.matchCase);const d=e.getSelection();let u,g=null;if(d.isEmpty()){const f=e.getConfiguredWordAtPosition(d.getStartPosition());if(!f)return null;u=f.word,g=new Selection$1(d.startLineNumber,f.startColumn,d.startLineNumber,f.endColumn)}else u=e.getModel().getValueInRange(d).replace(/\r\n/g,`
`);return new MultiCursorSession(e,t,o,u,r,l,g)}constructor(e,t,s,o,r,l,c){this._editor=e,this.findController=t,this.isDisconnectedFromFindController=s,this.searchText=o,this.wholeWord=r,this.matchCase=l,this.currentMatch=c}addSelectionToNextFindMatch(){if(!this._editor.hasModel())return null;const e=this._getNextMatch();if(!e)return null;const t=this._editor.getSelections();return new MultiCursorSessionResult(t.concat(e),e,0)}moveSelectionToNextFindMatch(){if(!this._editor.hasModel())return null;const e=this._getNextMatch();if(!e)return null;const t=this._editor.getSelections();return new MultiCursorSessionResult(t.slice(0,t.length-1).concat(e),e,0)}_getNextMatch(){if(!this._editor.hasModel())return null;if(this.currentMatch){const o=this.currentMatch;return this.currentMatch=null,o}this.findController.highlightFindOptions();const e=this._editor.getSelections(),t=e[e.length-1],s=this._editor.getModel().findNextMatch(this.searchText,t.getEndPosition(),!1,this.matchCase,this.wholeWord?this._editor.getOption(148):null,!1);return s?new Selection$1(s.range.startLineNumber,s.range.startColumn,s.range.endLineNumber,s.range.endColumn):null}addSelectionToPreviousFindMatch(){if(!this._editor.hasModel())return null;const e=this._getPreviousMatch();if(!e)return null;const t=this._editor.getSelections();return new MultiCursorSessionResult(t.concat(e),e,0)}moveSelectionToPreviousFindMatch(){if(!this._editor.hasModel())return null;const e=this._getPreviousMatch();if(!e)return null;const t=this._editor.getSelections();return new MultiCursorSessionResult(t.slice(0,t.length-1).concat(e),e,0)}_getPreviousMatch(){if(!this._editor.hasModel())return null;if(this.currentMatch){const o=this.currentMatch;return this.currentMatch=null,o}this.findController.highlightFindOptions();const e=this._editor.getSelections(),t=e[e.length-1],s=this._editor.getModel().findPreviousMatch(this.searchText,t.getStartPosition(),!1,this.matchCase,this.wholeWord?this._editor.getOption(148):null,!1);return s?new Selection$1(s.range.startLineNumber,s.range.startColumn,s.range.endLineNumber,s.range.endColumn):null}selectAll(e){if(!this._editor.hasModel())return[];this.findController.highlightFindOptions();const t=this._editor.getModel();return e?t.findMatches(this.searchText,e,!1,this.matchCase,this.wholeWord?this._editor.getOption(148):null,!1,1073741824):t.findMatches(this.searchText,!0,!1,this.matchCase,this.wholeWord?this._editor.getOption(148):null,!1,1073741824)}}const lo=class lo extends Disposable{static get(e){return e.getContribution(lo.ID)}constructor(e){super(),this._sessionDispose=this._register(new DisposableStore),this._editor=e,this._ignoreSelectionChange=!1,this._session=null}dispose(){this._endSession(),super.dispose()}_beginSessionIfNeeded(e){if(!this._session){const t=MultiCursorSession.create(this._editor,e);if(!t)return;this._session=t;const s={searchString:this._session.searchText};this._session.isDisconnectedFromFindController&&(s.wholeWordOverride=1,s.matchCaseOverride=1,s.isRegexOverride=2),e.getState().change(s,!1),this._sessionDispose.add(this._editor.onDidChangeCursorSelection(o=>{this._ignoreSelectionChange||this._endSession()})),this._sessionDispose.add(this._editor.onDidBlurEditorText(()=>{this._endSession()})),this._sessionDispose.add(e.getState().onFindReplaceStateChange(o=>{(o.matchCase||o.wholeWord)&&this._endSession()}))}}_endSession(){if(this._sessionDispose.clear(),this._session&&this._session.isDisconnectedFromFindController){const e={wholeWordOverride:0,matchCaseOverride:0,isRegexOverride:0};this._session.findController.getState().change(e,!1)}this._session=null}_setSelections(e){this._ignoreSelectionChange=!0,this._editor.setSelections(e),this._ignoreSelectionChange=!1}_expandEmptyToWord(e,t){if(!t.isEmpty())return t;const s=this._editor.getConfiguredWordAtPosition(t.getStartPosition());return s?new Selection$1(t.startLineNumber,s.startColumn,t.startLineNumber,s.endColumn):t}_applySessionResult(e){e&&(this._setSelections(e.selections),e.revealRange&&this._editor.revealRangeInCenterIfOutsideViewport(e.revealRange,e.revealScrollType))}getSession(e){return this._session}addSelectionToNextFindMatch(e){if(this._editor.hasModel()){if(!this._session){const t=this._editor.getSelections();if(t.length>1){const o=e.getState().matchCase;if(!modelRangesContainSameText(this._editor.getModel(),t,o)){const l=this._editor.getModel(),c=[];for(let d=0,u=t.length;d<u;d++)c[d]=this._expandEmptyToWord(l,t[d]);this._editor.setSelections(c);return}}}this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.addSelectionToNextFindMatch())}}addSelectionToPreviousFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.addSelectionToPreviousFindMatch())}moveSelectionToNextFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.moveSelectionToNextFindMatch())}moveSelectionToPreviousFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.moveSelectionToPreviousFindMatch())}selectAll(e){if(!this._editor.hasModel())return;let t=null;const s=e.getState();if(s.isRevealed&&s.searchString.length>0&&s.isRegex){const o=this._editor.getModel();s.searchScope?t=o.findMatches(s.searchString,s.searchScope,s.isRegex,s.matchCase,s.wholeWord?this._editor.getOption(148):null,!1,1073741824):t=o.findMatches(s.searchString,!0,s.isRegex,s.matchCase,s.wholeWord?this._editor.getOption(148):null,!1,1073741824)}else{if(this._beginSessionIfNeeded(e),!this._session)return;t=this._session.selectAll(s.searchScope)}if(t.length>0){const o=this._editor.getSelection();for(let r=0,l=t.length;r<l;r++){const c=t[r];if(c.range.intersectRanges(o)){t[r]=t[0],t[0]=c;break}}this._setSelections(t.map(r=>new Selection$1(r.range.startLineNumber,r.range.startColumn,r.range.endLineNumber,r.range.endColumn)))}}};lo.ID="editor.contrib.multiCursorController";let MultiCursorSelectionController=lo;class MultiCursorSelectionControllerAction extends EditorAction{run(e,t){const s=MultiCursorSelectionController.get(t);if(!s)return;const o=t._getViewModel();if(o){const r=o.getCursorStates(),l=CommonFindController.get(t);if(l)this._run(s,l);else{const c=e.get(IInstantiationService).createInstance(CommonFindController,t);this._run(s,c),c.dispose()}announceCursorChange(r,o.getCursorStates())}}}class AddSelectionToNextFindMatchAction extends MultiCursorSelectionControllerAction{constructor(){super({id:"editor.action.addSelectionToNextFindMatch",label:localize2(1293,"Add Selection to Next Find Match"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:2082,weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"3_multi",title:localize(1283,"Add &&Next Occurrence"),order:5}})}_run(e,t){e.addSelectionToNextFindMatch(t)}}class AddSelectionToPreviousFindMatchAction extends MultiCursorSelectionControllerAction{constructor(){super({id:"editor.action.addSelectionToPreviousFindMatch",label:localize2(1294,"Add Selection to Previous Find Match"),precondition:void 0,menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"3_multi",title:localize(1284,"Add P&&revious Occurrence"),order:6}})}_run(e,t){e.addSelectionToPreviousFindMatch(t)}}class MoveSelectionToNextFindMatchAction extends MultiCursorSelectionControllerAction{constructor(){super({id:"editor.action.moveSelectionToNextFindMatch",label:localize2(1295,"Move Last Selection to Next Find Match"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:KeyChord(2089,2082),weight:100}})}_run(e,t){e.moveSelectionToNextFindMatch(t)}}class MoveSelectionToPreviousFindMatchAction extends MultiCursorSelectionControllerAction{constructor(){super({id:"editor.action.moveSelectionToPreviousFindMatch",label:localize2(1296,"Move Last Selection to Previous Find Match"),precondition:void 0})}_run(e,t){e.moveSelectionToPreviousFindMatch(t)}}class SelectHighlightsAction extends MultiCursorSelectionControllerAction{constructor(){super({id:"editor.action.selectHighlights",label:localize2(1297,"Select All Occurrences of Find Match"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:3114,weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"3_multi",title:localize(1285,"Select All &&Occurrences"),order:7}})}_run(e,t){e.selectAll(t)}}class CompatChangeAll extends MultiCursorSelectionControllerAction{constructor(){super({id:"editor.action.changeAll",label:localize2(1298,"Change All Occurrences"),precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.editorTextFocus),kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2108,weight:100},contextMenuOpts:{group:"1_modification",order:1.2}})}_run(e,t){e.selectAll(t)}}class SelectionHighlighterState{constructor(e,t,s,o,r){this._model=e,this._searchText=t,this._matchCase=s,this._wordSeparators=o,this._cachedFindMatches=null,this._modelVersionId=this._model.getVersionId(),r&&this._model===r._model&&this._searchText===r._searchText&&this._matchCase===r._matchCase&&this._wordSeparators===r._wordSeparators&&this._modelVersionId===r._modelVersionId&&(this._cachedFindMatches=r._cachedFindMatches)}findMatches(){return this._cachedFindMatches===null&&(this._cachedFindMatches=this._model.findMatches(this._searchText,!0,!1,this._matchCase,this._wordSeparators,!1).map(e=>e.range),this._cachedFindMatches.sort(Range$2.compareRangesUsingStarts)),this._cachedFindMatches}}var Qi;let SelectionHighlighter=(Qi=class extends Disposable{constructor(e,t){super(),this._languageFeaturesService=t,this.editor=e,this._isEnabled=e.getOption(122),this._isEnabledMultiline=e.getOption(124),this._maxLength=e.getOption(123),this._decorations=e.createDecorationsCollection(),this.updateSoon=this._register(new RunOnceScheduler(()=>this._update(),300)),this.state=null,this._register(e.onDidChangeConfiguration(o=>{this._isEnabled=e.getOption(122),this._isEnabledMultiline=e.getOption(124),this._maxLength=e.getOption(123)})),this._register(e.onDidChangeCursorSelection(o=>{this._isEnabled&&(o.selection.isEmpty()?o.reason===3?(this.state&&this._setState(null),this.updateSoon.schedule()):this._setState(null):this._update())})),this._register(e.onDidChangeModel(o=>{this._setState(null)})),this._register(e.onDidChangeModelContent(o=>{this._isEnabled&&this.updateSoon.schedule()}));const s=CommonFindController.get(e);s&&this._register(s.getState().onFindReplaceStateChange(o=>{this._update()})),this.updateSoon.schedule()}_update(){this._setState(SelectionHighlighter_1._createState(this.state,this._isEnabled,this._isEnabledMultiline,this._maxLength,this.editor))}static _createState(e,t,s,o,r){if(!t||!r.hasModel())return null;if(!s){const f=r.getSelection();if(f.startLineNumber!==f.endLineNumber)return null}const l=MultiCursorSelectionController.get(r);if(!l)return null;const c=CommonFindController.get(r);if(!c)return null;let d=l.getSession(c);if(!d){const f=r.getSelections();if(f.length>1){const m=c.getState().matchCase;if(!modelRangesContainSameText(r.getModel(),f,m))return null}d=MultiCursorSession.create(r,c)}if(!d||d.currentMatch||/^[ \t]+$/.test(d.searchText)||o>0&&d.searchText.length>o)return null;const u=c.getState(),g=u.matchCase;if(u.isRevealed){let f=u.searchString;g||(f=f.toLowerCase());let p=d.searchText;if(g||(p=p.toLowerCase()),f===p&&d.matchCase===u.matchCase&&d.wholeWord===u.wholeWord&&!u.isRegex)return null}return new SelectionHighlighterState(r.getModel(),d.searchText,d.matchCase,d.wholeWord?r.getOption(148):null,e)}_setState(e){if(this.state=e,!this.state){this._decorations.clear();return}if(!this.editor.hasModel())return;const t=this.editor.getModel();if(t.isTooLargeForTokenization())return;const s=this.state.findMatches(),o=this.editor.getSelections();o.sort(Range$2.compareRangesUsingStarts);const r=[];for(let u=0,g=0,f=s.length,p=o.length;u<f;){const m=s[u];if(g>=p)r.push(m),u++;else{const _=Range$2.compareRangesUsingStarts(m,o[g]);_<0?((o[g].isEmpty()||!Range$2.areIntersecting(m,o[g]))&&r.push(m),u++):(_>0||u++,g++)}}const l=this.editor.getOption(90)!=="off",c=this._languageFeaturesService.documentHighlightProvider.has(t)&&l,d=r.map(u=>({range:u,options:getSelectionHighlightDecorationOptions(c)}));this._decorations.set(d)}dispose(){this._setState(null),super.dispose()}},SelectionHighlighter_1=Qi,Qi.ID="editor.contrib.selectionHighlighter",Qi);SelectionHighlighter=SelectionHighlighter_1=__decorate$O([__param$N(1,ILanguageFeaturesService)],SelectionHighlighter);function modelRangesContainSameText(a,e,t){const s=getValueInRange(a,e[0],!t);for(let o=1,r=e.length;o<r;o++){const l=e[o];if(l.isEmpty())return!1;const c=getValueInRange(a,l,!t);if(s!==c)return!1}return!0}function getValueInRange(a,e,t){const s=a.getValueInRange(e);return t?s.toLowerCase():s}class FocusNextCursor extends EditorAction{constructor(){super({id:"editor.action.focusNextCursor",label:localize2(1299,"Focus Next Cursor"),metadata:{description:localize(1286,"Focuses the next cursor"),args:[]},precondition:void 0})}run(e,t,s){if(!t.hasModel())return;const o=t._getViewModel();if(o.cursorConfig.readOnly)return;o.model.pushStackElement();const r=Array.from(o.getCursorStates()),l=r.shift();l&&(r.push(l),o.setCursorStates(s.source,3,r),o.revealPrimaryCursor(s.source,!0),announceCursorChange(r,o.getCursorStates()))}}class FocusPreviousCursor extends EditorAction{constructor(){super({id:"editor.action.focusPreviousCursor",label:localize2(1300,"Focus Previous Cursor"),metadata:{description:localize(1287,"Focuses the previous cursor"),args:[]},precondition:void 0})}run(e,t,s){if(!t.hasModel())return;const o=t._getViewModel();if(o.cursorConfig.readOnly)return;o.model.pushStackElement();const r=Array.from(o.getCursorStates()),l=r.pop();l&&(r.unshift(l),o.setCursorStates(s.source,3,r),o.revealPrimaryCursor(s.source,!0),announceCursorChange(r,o.getCursorStates()))}}registerEditorContribution(MultiCursorSelectionController.ID,MultiCursorSelectionController,4);registerEditorContribution(SelectionHighlighter.ID,SelectionHighlighter,1);registerEditorAction(InsertCursorAbove);registerEditorAction(InsertCursorBelow);registerEditorAction(InsertCursorAtEndOfEachLineSelected);registerEditorAction(AddSelectionToNextFindMatchAction);registerEditorAction(AddSelectionToPreviousFindMatchAction);registerEditorAction(MoveSelectionToNextFindMatchAction);registerEditorAction(MoveSelectionToPreviousFindMatchAction);registerEditorAction(SelectHighlightsAction);registerEditorAction(CompatChangeAll);registerEditorAction(InsertCursorAtEndOfLineSelected);registerEditorAction(InsertCursorAtTopOfLineSelected);registerEditorAction(FocusNextCursor);registerEditorAction(FocusPreviousCursor);const Context$1={Visible:new RawContextKey("parameterHintsVisible",!1),MultipleSignatures:new RawContextKey("parameterHintsMultipleSignatures",!1)};async function provideSignatureHelp(a,e,t,s,o){const r=a.ordered(e);for(const l of r)try{const c=await l.provideSignatureHelp(e,t,o,s);if(c)return c}catch(c){onUnexpectedExternalError(c)}}CommandsRegistry.registerCommand("_executeSignatureHelpProvider",async(a,...e)=>{const[t,s,o]=e;assertType(URI.isUri(t)),assertType(Position$1.isIPosition(s)),assertType(typeof o=="string"||!o);const r=a.get(ILanguageFeaturesService),l=await a.get(ITextModelService).createModelReference(t);try{const c=await provideSignatureHelp(r.signatureHelpProvider,l.object.textEditorModel,Position$1.lift(s),{triggerKind:SignatureHelpTriggerKind$1.Invoke,isRetrigger:!1,triggerCharacter:o},CancellationToken.None);return c?(setTimeout(()=>c.dispose(),0),c.value):void 0}finally{l.dispose()}});var ParameterHintState;(function(a){a.Default={type:0};class e{constructor(o,r){this.request=o,this.previouslyActiveHints=r,this.type=2}}a.Pending=e;class t{constructor(o){this.hints=o,this.type=1}}a.Active=t})(ParameterHintState||(ParameterHintState={}));const co=class co extends Disposable{constructor(e,t,s=co.DEFAULT_DELAY){super(),this._onChangedHints=this._register(new Emitter$1),this.onChangedHints=this._onChangedHints.event,this.triggerOnType=!1,this._state=ParameterHintState.Default,this._pendingTriggers=[],this._lastSignatureHelpResult=this._register(new MutableDisposable),this.triggerChars=new CharacterSet,this.retriggerChars=new CharacterSet,this.triggerId=0,this.editor=e,this.providers=t,this.throttledDelayer=new Delayer(s),this._register(this.editor.onDidBlurEditorWidget(()=>this.cancel())),this._register(this.editor.onDidChangeConfiguration(()=>this.onEditorConfigurationChange())),this._register(this.editor.onDidChangeModel(o=>this.onModelChanged())),this._register(this.editor.onDidChangeModelLanguage(o=>this.onModelChanged())),this._register(this.editor.onDidChangeCursorSelection(o=>this.onCursorChange(o))),this._register(this.editor.onDidChangeModelContent(o=>this.onModelContentChange())),this._register(this.providers.onDidChange(this.onModelChanged,this)),this._register(this.editor.onDidType(o=>this.onDidType(o))),this.onEditorConfigurationChange(),this.onModelChanged()}get state(){return this._state}set state(e){this._state.type===2&&this._state.request.cancel(),this._state=e}cancel(e=!1){this.state=ParameterHintState.Default,this.throttledDelayer.cancel(),e||this._onChangedHints.fire(void 0)}trigger(e,t){const s=this.editor.getModel();if(!s||!this.providers.has(s))return;const o=++this.triggerId;this._pendingTriggers.push(e),this.throttledDelayer.trigger(()=>this.doTrigger(o),t).catch(onUnexpectedError)}next(){if(this.state.type!==1)return;const e=this.state.hints.signatures.length,t=this.state.hints.activeSignature,s=t%e===e-1,o=this.editor.getOption(98).cycle;if((e<2||s)&&!o){this.cancel();return}this.updateActiveSignature(s&&o?0:t+1)}previous(){if(this.state.type!==1)return;const e=this.state.hints.signatures.length,t=this.state.hints.activeSignature,s=t===0,o=this.editor.getOption(98).cycle;if((e<2||s)&&!o){this.cancel();return}this.updateActiveSignature(s&&o?e-1:t-1)}updateActiveSignature(e){this.state.type===1&&(this.state=new ParameterHintState.Active({...this.state.hints,activeSignature:e}),this._onChangedHints.fire(this.state.hints))}async doTrigger(e){const t=this.state.type===1||this.state.type===2,s=this.getLastActiveHints();if(this.cancel(!0),this._pendingTriggers.length===0)return!1;const o=this._pendingTriggers.reduce(mergeTriggerContexts);this._pendingTriggers=[];const r={triggerKind:o.triggerKind,triggerCharacter:o.triggerCharacter,isRetrigger:t,activeSignatureHelp:s};if(!this.editor.hasModel())return!1;const l=this.editor.getModel(),c=this.editor.getPosition();this.state=new ParameterHintState.Pending(createCancelablePromise(d=>provideSignatureHelp(this.providers,l,c,r,d)),s);try{const d=await this.state.request;return e!==this.triggerId?(d==null||d.dispose(),!1):!d||!d.value.signatures||d.value.signatures.length===0?(d==null||d.dispose(),this._lastSignatureHelpResult.clear(),this.cancel(),!1):(this.state=new ParameterHintState.Active(d.value),this._lastSignatureHelpResult.value=d,this._onChangedHints.fire(this.state.hints),!0)}catch(d){return e===this.triggerId&&(this.state=ParameterHintState.Default),onUnexpectedError(d),!1}}getLastActiveHints(){switch(this.state.type){case 1:return this.state.hints;case 2:return this.state.previouslyActiveHints;default:return}}get isTriggered(){return this.state.type===1||this.state.type===2||this.throttledDelayer.isTriggered()}onModelChanged(){this.cancel(),this.triggerChars.clear(),this.retriggerChars.clear();const e=this.editor.getModel();if(e)for(const t of this.providers.ordered(e)){for(const s of t.signatureHelpTriggerCharacters||[])if(s.length){const o=s.charCodeAt(0);this.triggerChars.add(o),this.retriggerChars.add(o)}for(const s of t.signatureHelpRetriggerCharacters||[])s.length&&this.retriggerChars.add(s.charCodeAt(0))}}onDidType(e){if(!this.triggerOnType)return;const t=e.length-1,s=e.charCodeAt(t);(this.triggerChars.has(s)||this.isTriggered&&this.retriggerChars.has(s))&&this.trigger({triggerKind:SignatureHelpTriggerKind$1.TriggerCharacter,triggerCharacter:e.charAt(t)})}onCursorChange(e){e.source==="mouse"?this.cancel():this.isTriggered&&this.trigger({triggerKind:SignatureHelpTriggerKind$1.ContentChange})}onModelContentChange(){this.isTriggered&&this.trigger({triggerKind:SignatureHelpTriggerKind$1.ContentChange})}onEditorConfigurationChange(){this.triggerOnType=this.editor.getOption(98).enabled,this.triggerOnType||this.cancel()}dispose(){this.cancel(!0),super.dispose()}};co.DEFAULT_DELAY=120;let ParameterHintsModel=co;function mergeTriggerContexts(a,e){switch(e.triggerKind){case SignatureHelpTriggerKind$1.Invoke:return e;case SignatureHelpTriggerKind$1.ContentChange:return a;case SignatureHelpTriggerKind$1.TriggerCharacter:default:return e}}const parameterHints="";var __decorate$N=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$M=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},ParameterHintsWidget_1;const $$6=$$l,parameterHintsNextIcon=registerIcon("parameter-hints-next",Codicon.chevronDown,localize(1302,"Icon for show next parameter hint.")),parameterHintsPreviousIcon=registerIcon("parameter-hints-previous",Codicon.chevronUp,localize(1303,"Icon for show previous parameter hint."));var Yi;let ParameterHintsWidget=(Yi=class extends Disposable{constructor(e,t,s,o,r){super(),this.editor=e,this.model=t,this.renderDisposeables=this._register(new DisposableStore),this.visible=!1,this.announcedLabel=null,this.allowEditorOverflow=!0,this.markdownRenderer=new MarkdownRenderer({editor:e},r,o),this.keyVisible=Context$1.Visible.bindTo(s),this.keyMultipleSignatures=Context$1.MultipleSignatures.bindTo(s)}createParameterHintDOMNodes(){const e=$$6(".editor-widget.parameter-hints-widget"),t=append$2(e,$$6(".phwrapper"));t.tabIndex=-1;const s=append$2(t,$$6(".controls")),o=append$2(s,$$6(".button"+ThemeIcon.asCSSSelector(parameterHintsPreviousIcon))),r=append$2(s,$$6(".overloads")),l=append$2(s,$$6(".button"+ThemeIcon.asCSSSelector(parameterHintsNextIcon)));this._register(addDisposableListener(o,"click",p=>{EventHelper.stop(p),this.previous()})),this._register(addDisposableListener(l,"click",p=>{EventHelper.stop(p),this.next()}));const c=$$6(".body"),d=new DomScrollableElement(c,{alwaysConsumeMouseWheel:!0});this._register(d),t.appendChild(d.getDomNode());const u=append$2(c,$$6(".signature")),g=append$2(c,$$6(".docs"));e.style.userSelect="text",this.domNodes={element:e,signature:u,overloads:r,docs:g,scrollbar:d},this.editor.addContentWidget(this),this.hide(),this._register(this.editor.onDidChangeCursorSelection(p=>{this.visible&&this.editor.layoutContentWidget(this)}));const f=()=>{if(!this.domNodes)return;const p=this.editor.getOption(59),m=this.domNodes.element;m.style.fontSize=`${p.fontSize}px`,m.style.lineHeight=`${p.lineHeight/p.fontSize}`,m.style.setProperty("--vscode-parameterHintsWidget-editorFontFamily",p.fontFamily),m.style.setProperty("--vscode-parameterHintsWidget-editorFontFamilyDefault",EDITOR_FONT_DEFAULTS.fontFamily)};f(),this._register(Event$1.chain(this.editor.onDidChangeConfiguration.bind(this.editor),p=>p.filter(m=>m.hasChanged(59)))(f)),this._register(this.editor.onDidLayoutChange(p=>this.updateMaxHeight())),this.updateMaxHeight()}show(){this.visible||(this.domNodes||this.createParameterHintDOMNodes(),this.keyVisible.set(!0),this.visible=!0,setTimeout(()=>{var e;(e=this.domNodes)==null||e.element.classList.add("visible")},100),this.editor.layoutContentWidget(this))}hide(){var e;this.renderDisposeables.clear(),this.visible&&(this.keyVisible.reset(),this.visible=!1,this.announcedLabel=null,(e=this.domNodes)==null||e.element.classList.remove("visible"),this.editor.layoutContentWidget(this))}getPosition(){return this.visible?{position:this.editor.getPosition(),preference:[1,2]}:null}render(e){if(this.renderDisposeables.clear(),!this.domNodes)return;const t=e.signatures.length>1;this.domNodes.element.classList.toggle("multiple",t),this.keyMultipleSignatures.set(t),this.domNodes.signature.innerText="",this.domNodes.docs.innerText="";const s=e.signatures[e.activeSignature];if(!s)return;const o=append$2(this.domNodes.signature,$$6(".code")),r=s.parameters.length>0,l=s.activeParameter??e.activeParameter;if(r)this.renderParameters(o,s,l);else{const u=append$2(o,$$6("span"));u.textContent=s.label}const c=s.parameters[l];if(c!=null&&c.documentation){const u=$$6("span.documentation");if(typeof c.documentation=="string")u.textContent=c.documentation;else{const g=this.renderMarkdownDocs(c.documentation);u.appendChild(g.element)}append$2(this.domNodes.docs,$$6("p",{},u))}if(s.documentation!==void 0)if(typeof s.documentation=="string")append$2(this.domNodes.docs,$$6("p",{},s.documentation));else{const u=this.renderMarkdownDocs(s.documentation);append$2(this.domNodes.docs,u.element)}const d=this.hasDocs(s,c);if(this.domNodes.signature.classList.toggle("has-docs",d),this.domNodes.docs.classList.toggle("empty",!d),this.domNodes.overloads.textContent=String(e.activeSignature+1).padStart(e.signatures.length.toString().length,"0")+"/"+e.signatures.length,c){let u="";const g=s.parameters[l];Array.isArray(g.label)?u=s.label.substring(g.label[0],g.label[1]):u=g.label,g.documentation&&(u+=typeof g.documentation=="string"?`, ${g.documentation}`:`, ${g.documentation.value}`),s.documentation&&(u+=typeof s.documentation=="string"?`, ${s.documentation}`:`, ${s.documentation.value}`),this.announcedLabel!==u&&(alert$1(localize(1304,"{0}, hint",u)),this.announcedLabel=u)}this.editor.layoutContentWidget(this),this.domNodes.scrollbar.scanDomNode()}renderMarkdownDocs(e){const t=this.renderDisposeables.add(this.markdownRenderer.render(e,{asyncRenderCallback:()=>{var s;(s=this.domNodes)==null||s.scrollbar.scanDomNode()}}));return t.element.classList.add("markdown-docs"),t}hasDocs(e,t){return!!(t&&typeof t.documentation=="string"&&assertReturnsDefined(t.documentation).length>0||t&&typeof t.documentation=="object"&&assertReturnsDefined(t.documentation).value.length>0||e.documentation&&typeof e.documentation=="string"&&assertReturnsDefined(e.documentation).length>0||e.documentation&&typeof e.documentation=="object"&&assertReturnsDefined(e.documentation.value).length>0)}renderParameters(e,t,s){const[o,r]=this.getParameterLabelOffsets(t,s),l=document.createElement("span");l.textContent=t.label.substring(0,o);const c=document.createElement("span");c.textContent=t.label.substring(o,r),c.className="parameter active";const d=document.createElement("span");d.textContent=t.label.substring(r),append$2(e,l,c,d)}getParameterLabelOffsets(e,t){const s=e.parameters[t];if(s){if(Array.isArray(s.label))return s.label;if(s.label.length){const o=new RegExp(`(\\W|^)${escapeRegExpCharacters(s.label)}(?=\\W|$)`,"g");o.test(e.label);const r=o.lastIndex-s.label.length;return r>=0?[r,o.lastIndex]:[0,0]}else return[0,0]}else return[0,0]}next(){this.editor.focus(),this.model.next()}previous(){this.editor.focus(),this.model.previous()}getDomNode(){return this.domNodes||this.createParameterHintDOMNodes(),this.domNodes.element}getId(){return ParameterHintsWidget_1.ID}updateMaxHeight(){if(!this.domNodes)return;const t=`${Math.max(this.editor.getLayoutInfo().height/4,250)}px`;this.domNodes.element.style.maxHeight=t;const s=this.domNodes.element.getElementsByClassName("phwrapper");s.length&&(s[0].style.maxHeight=t)}},ParameterHintsWidget_1=Yi,Yi.ID="editor.widget.parameterHintsWidget",Yi);ParameterHintsWidget=ParameterHintsWidget_1=__decorate$N([__param$M(2,IContextKeyService),__param$M(3,IOpenerService),__param$M(4,ILanguageService)],ParameterHintsWidget);registerColor("editorHoverWidget.highlightForeground",listHighlightForeground,localize(1305,"Foreground color of the active item in the parameter hint."));var __decorate$M=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$L=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},ParameterHintsController_1,Xi;let ParameterHintsController=(Xi=class extends Disposable{static get(e){return e.getContribution(ParameterHintsController_1.ID)}constructor(e,t,s){super(),this.editor=e,this.model=this._register(new ParameterHintsModel(e,s.signatureHelpProvider)),this._register(this.model.onChangedHints(o=>{var r;o?(this.widget.value.show(),this.widget.value.render(o)):(r=this.widget.rawValue)==null||r.hide()})),this.widget=new Lazy(()=>this._register(t.createInstance(ParameterHintsWidget,this.editor,this.model)))}cancel(){this.model.cancel()}previous(){var e;(e=this.widget.rawValue)==null||e.previous()}next(){var e;(e=this.widget.rawValue)==null||e.next()}trigger(e){this.model.trigger(e,0)}},ParameterHintsController_1=Xi,Xi.ID="editor.controller.parameterHints",Xi);ParameterHintsController=ParameterHintsController_1=__decorate$M([__param$L(1,IInstantiationService),__param$L(2,ILanguageFeaturesService)],ParameterHintsController);class TriggerParameterHintsAction extends EditorAction{constructor(){super({id:"editor.action.triggerParameterHints",label:localize2(1301,"Trigger Parameter Hints"),precondition:EditorContextKeys.hasSignatureHelpProvider,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3082,weight:100}})}run(e,t){const s=ParameterHintsController.get(t);s==null||s.trigger({triggerKind:SignatureHelpTriggerKind$1.Invoke})}}registerEditorContribution(ParameterHintsController.ID,ParameterHintsController,2);registerEditorAction(TriggerParameterHintsAction);const weight$1=100+75,ParameterHintsCommand=EditorCommand.bindToContribution(ParameterHintsController.get);registerEditorCommand(new ParameterHintsCommand({id:"closeParameterHints",precondition:Context$1.Visible,handler:a=>a.cancel(),kbOpts:{weight:weight$1,kbExpr:EditorContextKeys.focus,primary:9,secondary:[1033]}}));registerEditorCommand(new ParameterHintsCommand({id:"showPrevParameterHint",precondition:ContextKeyExpr.and(Context$1.Visible,Context$1.MultipleSignatures),handler:a=>a.previous(),kbOpts:{weight:weight$1,kbExpr:EditorContextKeys.focus,primary:16,secondary:[528],mac:{primary:16,secondary:[528,302]}}}));registerEditorCommand(new ParameterHintsCommand({id:"showNextParameterHint",precondition:ContextKeyExpr.and(Context$1.Visible,Context$1.MultipleSignatures),handler:a=>a.next(),kbOpts:{weight:weight$1,kbExpr:EditorContextKeys.focus,primary:18,secondary:[530],mac:{primary:18,secondary:[530,300]}}}));const placeholderText="",Yo=class Yo extends Disposable{constructor(e){super(),this._editor=e,this._editorObs=observableCodeEditor(this._editor),this._placeholderText=this._editorObs.getOption(100),this._state=derivedOpts({owner:this,equalsFn:structuralEquals},t=>{const s=this._placeholderText.read(t);if(s&&this._editorObs.valueIsEmpty.read(t))return{placeholder:s}}),this._shouldViewBeAlive=isOrWasTrue(this,t=>{var s;return((s=this._state.read(t))==null?void 0:s.placeholder)!==void 0}),this._view=derived(t=>{if(!this._shouldViewBeAlive.read(t))return;const s=h("div.editorPlaceholder");t.store.add(autorun(o=>{const r=this._state.read(o),l=(r==null?void 0:r.placeholder)!==void 0;s.root.style.display=l?"block":"none",s.root.innerText=(r==null?void 0:r.placeholder)??""})),t.store.add(autorun(o=>{const r=this._editorObs.layoutInfo.read(o);s.root.style.left=`${r.contentLeft}px`,s.root.style.width=r.contentWidth-r.verticalScrollbarWidth+"px",s.root.style.top=`${this._editor.getTopForLineNumber(0)}px`})),t.store.add(autorun(o=>{s.root.style.fontFamily=this._editorObs.getOption(58).read(o),s.root.style.fontSize=this._editorObs.getOption(61).read(o)+"px",s.root.style.lineHeight=this._editorObs.getOption(75).read(o)+"px"})),t.store.add(this._editorObs.createOverlayWidget({allowEditorOverflow:!1,minContentWidthInPx:constObservable(0),position:constObservable(null),domNode:s.root}))}),this._view.recomputeInitiallyAndOnChange(this._store)}};Yo.ID="editor.contrib.placeholderText";let PlaceholderTextContribution=Yo;function isOrWasTrue(a,e){return derivedObservableWithCache(a,(t,s)=>s===!0?!0:e(t))}var __decorate$L=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$K=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class BaseClass{constructor(e){this.instantiationService=e}init(...e){}}function wrapInReloadableClass1(a){return a()}let BaseClass1=class extends BaseClass{constructor(e,t){super(t),this.init(e)}};BaseClass1=__decorate$L([__param$K(1,IInstantiationService)],BaseClass1);registerEditorContribution(PlaceholderTextContribution.ID,wrapInReloadableClass1(()=>PlaceholderTextContribution),0);registerColor("editor.placeholder.foreground",ghostTextForeground,localize(1324,"Foreground color of the placeholder text in the editor."));const ITextResourceConfigurationService=createDecorator("textResourceConfigurationService"),ITextResourcePropertiesService=createDecorator("textResourcePropertiesService"),renameWidget="";var __decorate$K=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$J=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const CONTEXT_RENAME_INPUT_VISIBLE=new RawContextKey("renameInputVisible",!1,localize(1376,"Whether the rename input widget is visible"));new RawContextKey("renameInputFocused",!1,localize(1377,"Whether the rename input widget is focused"));let RenameWidget=class{constructor(e,t,s,o,r,l){this._editor=e,this._acceptKeybindings=t,this._themeService=s,this._keybindingService=o,this._logService=l,this.allowEditorOverflow=!0,this._disposables=new DisposableStore,this._visibleContextKey=CONTEXT_RENAME_INPUT_VISIBLE.bindTo(r),this._isEditingRenameCandidate=!1,this._nRenameSuggestionsInvocations=0,this._hadAutomaticRenameSuggestionsInvocation=!1,this._candidates=new Set,this._beforeFirstInputFieldEditSW=new StopWatch,this._inputWithButton=new InputWithButton,this._disposables.add(this._inputWithButton),this._editor.addContentWidget(this),this._disposables.add(this._editor.onDidChangeConfiguration(c=>{c.hasChanged(59)&&this._updateFont()})),this._disposables.add(s.onDidColorThemeChange(this._updateStyles,this))}dispose(){this._disposables.dispose(),this._editor.removeContentWidget(this)}getId(){return"__renameInputWidget"}getDomNode(){return this._domNode||(this._domNode=document.createElement("div"),this._domNode.className="monaco-editor rename-box",this._domNode.appendChild(this._inputWithButton.domNode),this._renameCandidateListView=this._disposables.add(new RenameCandidateListView(this._domNode,{fontInfo:this._editor.getOption(59),onFocusChange:e=>{this._inputWithButton.input.value=e,this._isEditingRenameCandidate=!1},onSelectionChange:()=>{this._isEditingRenameCandidate=!1,this.acceptInput(!1)}})),this._disposables.add(this._inputWithButton.onDidInputChange(()=>{var e,t,s;((e=this._renameCandidateListView)==null?void 0:e.focusedCandidate)!==void 0&&(this._isEditingRenameCandidate=!0),this._timeBeforeFirstInputFieldEdit??(this._timeBeforeFirstInputFieldEdit=this._beforeFirstInputFieldEditSW.elapsed()),((t=this._renameCandidateProvidersCts)==null?void 0:t.token.isCancellationRequested)===!1&&this._renameCandidateProvidersCts.cancel(),(s=this._renameCandidateListView)==null||s.clearFocus()})),this._label=document.createElement("div"),this._label.className="rename-label",this._domNode.appendChild(this._label),this._updateFont(),this._updateStyles(this._themeService.getColorTheme())),this._domNode}_updateStyles(e){if(!this._domNode)return;const t=e.getColor(widgetShadow),s=e.getColor(widgetBorder);this._domNode.style.backgroundColor=String(e.getColor(editorWidgetBackground)??""),this._domNode.style.boxShadow=t?` 0 0 8px 2px ${t}`:"",this._domNode.style.border=s?`1px solid ${s}`:"",this._domNode.style.color=String(e.getColor(inputForeground)??"");const o=e.getColor(inputBorder);this._inputWithButton.domNode.style.backgroundColor=String(e.getColor(inputBackground)??""),this._inputWithButton.input.style.backgroundColor=String(e.getColor(inputBackground)??""),this._inputWithButton.domNode.style.borderWidth=o?"1px":"0px",this._inputWithButton.domNode.style.borderStyle=o?"solid":"none",this._inputWithButton.domNode.style.borderColor=(o==null?void 0:o.toString())??"none"}_updateFont(){if(this._domNode===void 0)return;assertType(this._label!==void 0,"RenameWidget#_updateFont: _label must not be undefined given _domNode is defined"),this._editor.applyFontInfo(this._inputWithButton.input);const e=this._editor.getOption(59);this._label.style.fontSize=`${this._computeLabelFontSize(e.fontSize)}px`}_computeLabelFontSize(e){return e*.8}getPosition(){if(!this._visible||!this._editor.hasModel()||!this._editor.getDomNode())return null;const e=getClientArea(this.getDomNode().ownerDocument.body),t=getDomNodePagePosition(this._editor.getDomNode()),s=this._getTopForPosition();this._nPxAvailableAbove=s+t.top,this._nPxAvailableBelow=e.height-this._nPxAvailableAbove;const o=this._editor.getOption(75),{totalHeight:r}=RenameCandidateView.getLayoutInfo({lineHeight:o}),l=this._nPxAvailableBelow>r*6?[2,1]:[1,2];return{position:this._position,preference:l}}beforeRender(){var s,o;const[e,t]=this._acceptKeybindings;return this._label.innerText=localize(1378,"{0} to Rename, {1} to Preview",(s=this._keybindingService.lookupKeybinding(e))==null?void 0:s.getLabel(),(o=this._keybindingService.lookupKeybinding(t))==null?void 0:o.getLabel()),this._domNode.style.minWidth="200px",null}afterRender(e){if(e===null){this.cancelInput(!0,"afterRender (because position is null)");return}if(!this._editor.hasModel()||!this._editor.getDomNode())return;assertType(this._renameCandidateListView),assertType(this._nPxAvailableAbove!==void 0),assertType(this._nPxAvailableBelow!==void 0);const t=getTotalHeight(this._inputWithButton.domNode),s=getTotalHeight(this._label);let o;e===2?o=this._nPxAvailableBelow:o=this._nPxAvailableAbove,this._renameCandidateListView.layout({height:o-s-t,width:getTotalWidth(this._inputWithButton.domNode)})}acceptInput(e){var t;this._trace("invoking acceptInput"),(t=this._currentAcceptInput)==null||t.call(this,e)}cancelInput(e,t){var s;(s=this._currentCancelInput)==null||s.call(this,e)}focusNextRenameSuggestion(){var e;(e=this._renameCandidateListView)!=null&&e.focusNext()||(this._inputWithButton.input.value=this._currentName)}focusPreviousRenameSuggestion(){var e;(e=this._renameCandidateListView)!=null&&e.focusPrevious()||(this._inputWithButton.input.value=this._currentName)}getInput(e,t,s,o,r){const{start:l,end:c}=this._getSelection(e,t);this._renameCts=r;const d=new DisposableStore;this._nRenameSuggestionsInvocations=0,this._hadAutomaticRenameSuggestionsInvocation=!1,o===void 0?this._inputWithButton.button.style.display="none":(this._inputWithButton.button.style.display="flex",this._requestRenameCandidatesOnce=o,this._requestRenameCandidates(t,!1),d.add(addDisposableListener(this._inputWithButton.button,"click",()=>this._requestRenameCandidates(t,!0))),d.add(addDisposableListener(this._inputWithButton.button,EventType$1.KEY_DOWN,g=>{const f=new StandardKeyboardEvent(g);(f.equals(3)||f.equals(10))&&(f.stopPropagation(),f.preventDefault(),this._requestRenameCandidates(t,!0))}))),this._isEditingRenameCandidate=!1,this._domNode.classList.toggle("preview",s),this._position=new Position$1(e.startLineNumber,e.startColumn),this._currentName=t,this._inputWithButton.input.value=t,this._inputWithButton.input.setAttribute("selectionStart",l.toString()),this._inputWithButton.input.setAttribute("selectionEnd",c.toString()),this._inputWithButton.input.size=Math.max((e.endColumn-e.startColumn)*1.1,20),this._beforeFirstInputFieldEditSW.reset(),d.add(toDisposable(()=>{this._renameCts=void 0,r.dispose(!0)})),d.add(toDisposable(()=>{this._renameCandidateProvidersCts!==void 0&&(this._renameCandidateProvidersCts.dispose(!0),this._renameCandidateProvidersCts=void 0)})),d.add(toDisposable(()=>this._candidates.clear()));const u=new DeferredPromise;return u.p.finally(()=>{d.dispose(),this._hide()}),this._currentCancelInput=g=>{var f;return this._trace("invoking _currentCancelInput"),this._currentAcceptInput=void 0,this._currentCancelInput=void 0,(f=this._renameCandidateListView)==null||f.clearCandidates(),u.complete(g),!0},this._currentAcceptInput=g=>{this._trace("invoking _currentAcceptInput"),assertType(this._renameCandidateListView!==void 0);const f=this._renameCandidateListView.nCandidates;let p,m;const _=this._renameCandidateListView.focusedCandidate;if(_!==void 0?(this._trace("using new name from renameSuggestion"),p=_,m={k:"renameSuggestion"}):(this._trace("using new name from inputField"),p=this._inputWithButton.input.value,m=this._isEditingRenameCandidate?{k:"userEditedRenameSuggestion"}:{k:"inputField"}),p===t||p.trim().length===0){this.cancelInput(!0,"_currentAcceptInput (because newName === value || newName.trim().length === 0)");return}this._currentAcceptInput=void 0,this._currentCancelInput=void 0,this._renameCandidateListView.clearCandidates(),u.complete({newName:p,wantsPreview:s&&g,stats:{source:m,nRenameSuggestions:f,timeBeforeFirstInputFieldEdit:this._timeBeforeFirstInputFieldEdit,nRenameSuggestionsInvocations:this._nRenameSuggestionsInvocations,hadAutomaticRenameSuggestionsInvocation:this._hadAutomaticRenameSuggestionsInvocation}})},d.add(r.token.onCancellationRequested(()=>this.cancelInput(!0,"cts.token.onCancellationRequested"))),d.add(this._editor.onDidBlurEditorWidget(()=>{var g;return this.cancelInput(!((g=this._domNode)!=null&&g.ownerDocument.hasFocus()),"editor.onDidBlurEditorWidget")})),this._show(),u.p}_requestRenameCandidates(e,t){if(this._requestRenameCandidatesOnce!==void 0&&(this._renameCandidateProvidersCts!==void 0&&this._renameCandidateProvidersCts.dispose(!0),assertType(this._renameCts),this._inputWithButton.buttonState!=="stop")){this._renameCandidateProvidersCts=new CancellationTokenSource$1;const s=t?NewSymbolNameTriggerKind$1.Invoke:NewSymbolNameTriggerKind$1.Automatic,o=this._requestRenameCandidatesOnce(s,this._renameCandidateProvidersCts.token);if(o.length===0){this._inputWithButton.setSparkleButton();return}t||(this._hadAutomaticRenameSuggestionsInvocation=!0),this._nRenameSuggestionsInvocations+=1,this._inputWithButton.setStopButton(),this._updateRenameCandidates(o,e,this._renameCts.token)}}_getSelection(e,t){assertType(this._editor.hasModel());const s=this._editor.getSelection();let o=0,r=t.length;return!Range$2.isEmpty(s)&&!Range$2.spansMultipleLines(s)&&Range$2.containsRange(e,s)&&(o=Math.max(0,s.startColumn-e.startColumn),r=Math.min(e.endColumn,s.endColumn)-e.startColumn),{start:o,end:r}}_show(){this._trace("invoking _show"),this._editor.revealLineInCenterIfOutsideViewport(this._position.lineNumber,0),this._visible=!0,this._visibleContextKey.set(!0),this._editor.layoutContentWidget(this),setTimeout(()=>{this._inputWithButton.input.focus(),this._inputWithButton.input.setSelectionRange(parseInt(this._inputWithButton.input.getAttribute("selectionStart")),parseInt(this._inputWithButton.input.getAttribute("selectionEnd")))},100)}async _updateRenameCandidates(e,t,s){const o=(...u)=>this._trace("_updateRenameCandidates",...u);o("start");const r=await raceCancellation(Promise.allSettled(e),s);if(this._inputWithButton.setSparkleButton(),r===void 0){o("returning early - received updateRenameCandidates results - undefined");return}const l=r.flatMap(u=>u.status==="fulfilled"&&isDefined(u.value)?u.value:[]);o(`received updateRenameCandidates results - total (unfiltered) ${l.length} candidates.`);const c=distinct(l,u=>u.newSymbolName);o(`distinct candidates - ${c.length} candidates.`);const d=c.filter(({newSymbolName:u})=>u.trim().length>0&&u!==this._inputWithButton.input.value&&u!==t&&!this._candidates.has(u));if(o(`valid distinct candidates - ${l.length} candidates.`),d.forEach(u=>this._candidates.add(u.newSymbolName)),d.length<1){o("returning early - no valid distinct candidates");return}o("setting candidates"),this._renameCandidateListView.setCandidates(d),o("asking editor to re-layout"),this._editor.layoutContentWidget(this)}_hide(){this._trace("invoked _hide"),this._visible=!1,this._visibleContextKey.reset(),this._editor.layoutContentWidget(this)}_getTopForPosition(){const e=this._editor.getVisibleRanges();let t;return e.length>0?t=e[0].startLineNumber:(this._logService.warn("RenameWidget#_getTopForPosition: this should not happen - visibleRanges is empty"),t=Math.max(1,this._position.lineNumber-5)),this._editor.getTopForLineNumber(this._position.lineNumber)-this._editor.getTopForLineNumber(t)}_trace(...e){this._logService.trace("RenameWidget",...e)}};RenameWidget=__decorate$K([__param$J(2,IThemeService),__param$J(3,IKeybindingService),__param$J(4,IContextKeyService),__param$J(5,ILogService)],RenameWidget);class RenameCandidateListView{constructor(e,t){this._disposables=new DisposableStore,this._availableHeight=0,this._minimumWidth=0,this._lineHeight=t.fontInfo.lineHeight,this._typicalHalfwidthCharacterWidth=t.fontInfo.typicalHalfwidthCharacterWidth,this._listContainer=document.createElement("div"),this._listContainer.className="rename-box rename-candidate-list-container",e.appendChild(this._listContainer),this._listWidget=RenameCandidateListView._createListWidget(this._listContainer,this._candidateViewHeight,t.fontInfo),this._disposables.add(this._listWidget.onDidChangeFocus(s=>{s.elements.length===1&&t.onFocusChange(s.elements[0].newSymbolName)},this._disposables)),this._disposables.add(this._listWidget.onDidChangeSelection(s=>{s.elements.length===1&&t.onSelectionChange()},this._disposables)),this._disposables.add(this._listWidget.onDidBlur(s=>{this._listWidget.setFocus([])})),this._listWidget.style(getListStyles({listInactiveFocusForeground:quickInputListFocusForeground,listInactiveFocusBackground:quickInputListFocusBackground}))}dispose(){this._listWidget.dispose(),this._disposables.dispose()}layout({height:e,width:t}){this._availableHeight=e,this._minimumWidth=t}setCandidates(e){this._listWidget.splice(0,0,e);const t=this._pickListHeight(this._listWidget.length),s=this._pickListWidth(e);this._listWidget.layout(t,s),this._listContainer.style.height=`${t}px`,this._listContainer.style.width=`${s}px`,status(localize(1379,"Received {0} rename suggestions",e.length))}clearCandidates(){this._listContainer.style.height="0px",this._listContainer.style.width="0px",this._listWidget.splice(0,this._listWidget.length,[])}get nCandidates(){return this._listWidget.length}get focusedCandidate(){if(this._listWidget.length===0)return;const e=this._listWidget.getSelectedElements()[0];if(e!==void 0)return e.newSymbolName;const t=this._listWidget.getFocusedElements()[0];if(t!==void 0)return t.newSymbolName}focusNext(){if(this._listWidget.length===0)return!1;const e=this._listWidget.getFocus();if(e.length===0)return this._listWidget.focusFirst(),this._listWidget.reveal(0),!0;if(e[0]===this._listWidget.length-1)return this._listWidget.setFocus([]),this._listWidget.reveal(0),!1;{this._listWidget.focusNext();const t=this._listWidget.getFocus()[0];return this._listWidget.reveal(t),!0}}focusPrevious(){if(this._listWidget.length===0)return!1;const e=this._listWidget.getFocus();if(e.length===0){this._listWidget.focusLast();const t=this._listWidget.getFocus()[0];return this._listWidget.reveal(t),!0}else{if(e[0]===0)return this._listWidget.setFocus([]),!1;{this._listWidget.focusPrevious();const t=this._listWidget.getFocus()[0];return this._listWidget.reveal(t),!0}}}clearFocus(){this._listWidget.setFocus([])}get _candidateViewHeight(){const{totalHeight:e}=RenameCandidateView.getLayoutInfo({lineHeight:this._lineHeight});return e}_pickListHeight(e){const t=this._candidateViewHeight*e,s=7;return Math.min(t,this._availableHeight,this._candidateViewHeight*s)}_pickListWidth(e){const t=Math.ceil(Math.max(...e.map(o=>o.newSymbolName.length))*this._typicalHalfwidthCharacterWidth);return Math.max(this._minimumWidth,4+16+5+t+10)}static _createListWidget(e,t,s){const o=new class{getTemplateId(l){return"candidate"}getHeight(l){return t}},r=new class{constructor(){this.templateId="candidate"}renderTemplate(l){return new RenameCandidateView(l,s)}renderElement(l,c,d){d.populate(l)}disposeTemplate(l){l.dispose()}};return new List("NewSymbolNameCandidates",e,o,[r],{keyboardSupport:!1,mouseSupport:!0,multipleSelectionSupport:!1})}}class InputWithButton{constructor(){this._buttonHoverContent="",this._onDidInputChange=new Emitter$1,this.onDidInputChange=this._onDidInputChange.event,this._disposables=new DisposableStore}get domNode(){return this._domNode||(this._domNode=document.createElement("div"),this._domNode.className="rename-input-with-button",this._domNode.style.display="flex",this._domNode.style.flexDirection="row",this._domNode.style.alignItems="center",this._inputNode=document.createElement("input"),this._inputNode.className="rename-input",this._inputNode.type="text",this._inputNode.style.border="none",this._inputNode.setAttribute("aria-label",localize(1380,"Rename input. Type new name and press Enter to commit.")),this._domNode.appendChild(this._inputNode),this._buttonNode=document.createElement("div"),this._buttonNode.className="rename-suggestions-button",this._buttonNode.setAttribute("tabindex","0"),this._buttonGenHoverText=localize(1381,"Generate new name suggestions"),this._buttonCancelHoverText=localize(1382,"Cancel"),this._buttonHoverContent=this._buttonGenHoverText,this._disposables.add(getBaseLayerHoverDelegate().setupDelayedHover(this._buttonNode,()=>({content:this._buttonHoverContent,appearance:{showPointer:!0,compact:!0}}))),this._domNode.appendChild(this._buttonNode),this._disposables.add(addDisposableListener(this.input,EventType$1.INPUT,()=>this._onDidInputChange.fire())),this._disposables.add(addDisposableListener(this.input,EventType$1.KEY_DOWN,e=>{const t=new StandardKeyboardEvent(e);(t.keyCode===15||t.keyCode===17)&&this._onDidInputChange.fire()})),this._disposables.add(addDisposableListener(this.input,EventType$1.CLICK,()=>this._onDidInputChange.fire())),this._disposables.add(addDisposableListener(this.input,EventType$1.FOCUS,()=>{this.domNode.style.outlineWidth="1px",this.domNode.style.outlineStyle="solid",this.domNode.style.outlineOffset="-1px",this.domNode.style.outlineColor="var(--vscode-focusBorder)"})),this._disposables.add(addDisposableListener(this.input,EventType$1.BLUR,()=>{this.domNode.style.outline="none"}))),this._domNode}get input(){return assertType(this._inputNode),this._inputNode}get button(){return assertType(this._buttonNode),this._buttonNode}get buttonState(){return this._buttonState}setSparkleButton(){this._buttonState="sparkle",this._sparkleIcon??(this._sparkleIcon=renderIcon(Codicon.sparkle)),clearNode(this.button),this.button.appendChild(this._sparkleIcon),this.button.setAttribute("aria-label","Generating new name suggestions"),this._buttonHoverContent=this._buttonGenHoverText,this.input.focus()}setStopButton(){this._buttonState="stop",this._stopIcon??(this._stopIcon=renderIcon(Codicon.stopCircle)),clearNode(this.button),this.button.appendChild(this._stopIcon),this.button.setAttribute("aria-label","Cancel generating new name suggestions"),this._buttonHoverContent=this._buttonCancelHoverText,this.input.focus()}dispose(){this._disposables.dispose()}}const wn=class wn{constructor(e,t){this._domNode=document.createElement("div"),this._domNode.className="rename-box rename-candidate",this._domNode.style.display="flex",this._domNode.style.columnGap="5px",this._domNode.style.alignItems="center",this._domNode.style.height=`${t.lineHeight}px`,this._domNode.style.padding=`${wn._PADDING}px`;const s=document.createElement("div");s.style.display="flex",s.style.alignItems="center",s.style.width=s.style.height=`${t.lineHeight*.8}px`,this._domNode.appendChild(s),this._icon=renderIcon(Codicon.sparkle),this._icon.style.display="none",s.appendChild(this._icon),this._label=document.createElement("div"),applyFontInfo(this._label,t),this._domNode.appendChild(this._label),e.appendChild(this._domNode)}populate(e){this._updateIcon(e),this._updateLabel(e)}_updateIcon(e){var s;const t=!!((s=e.tags)!=null&&s.includes(NewSymbolNameTag$1.AIGenerated));this._icon.style.display=t?"inherit":"none"}_updateLabel(e){this._label.innerText=e.newSymbolName}static getLayoutInfo({lineHeight:e}){return{totalHeight:e+wn._PADDING*2}}dispose(){}};wn._PADDING=2;let RenameCandidateView=wn;var __decorate$J=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$I=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},RenameController_1;class RenameSkeleton{constructor(e,t,s){this.model=e,this.position=t,this._providerRenameIdx=0,this._providers=s.ordered(e)}hasProvider(){return this._providers.length>0}async resolveRenameLocation(e){const t=[];for(this._providerRenameIdx=0;this._providerRenameIdx<this._providers.length;this._providerRenameIdx++){const o=this._providers[this._providerRenameIdx];if(!o.resolveRenameLocation)break;const r=await o.resolveRenameLocation(this.model,this.position,e);if(r){if(r.rejectReason){t.push(r.rejectReason);continue}return r}}this._providerRenameIdx=0;const s=this.model.getWordAtPosition(this.position);return s?{range:new Range$2(this.position.lineNumber,s.startColumn,this.position.lineNumber,s.endColumn),text:s.word,rejectReason:t.length>0?t.join(`
`):void 0}:{range:Range$2.fromPositions(this.position),text:"",rejectReason:t.length>0?t.join(`
`):void 0}}async provideRenameEdits(e,t){return this._provideRenameEdits(e,this._providerRenameIdx,[],t)}async _provideRenameEdits(e,t,s,o){const r=this._providers[t];if(!r)return{edits:[],rejectReason:s.join(`
`)};const l=await r.provideRenameEdits(this.model,this.position,e,o);if(l){if(l.rejectReason)return this._provideRenameEdits(e,t+1,s.concat(l.rejectReason),o)}else return this._provideRenameEdits(e,t+1,s.concat(localize(1365,"No result.")),o);return l}}async function rename(a,e,t,s){const o=new RenameSkeleton(e,t,a),r=await o.resolveRenameLocation(CancellationToken.None);return r!=null&&r.rejectReason?{edits:[],rejectReason:r.rejectReason}:o.provideRenameEdits(s,CancellationToken.None)}var Ji;let RenameController=(Ji=class{static get(e){return e.getContribution(RenameController_1.ID)}constructor(e,t,s,o,r,l,c,d){this.editor=e,this._instaService=t,this._notificationService=s,this._bulkEditService=o,this._progressService=r,this._logService=l,this._configService=c,this._languageFeaturesService=d,this._disposableStore=new DisposableStore,this._cts=new CancellationTokenSource$1,this._renameWidget=this._disposableStore.add(this._instaService.createInstance(RenameWidget,this.editor,["acceptRenameInput","acceptRenameInputWithPreview"]))}dispose(){this._disposableStore.dispose(),this._cts.dispose(!0)}async run(){var _,C;const e=this._logService.trace.bind(this._logService,"[rename]");if(this._cts.dispose(!0),this._cts=new CancellationTokenSource$1,!this.editor.hasModel()){e("editor has no model");return}const t=this.editor.getPosition(),s=new RenameSkeleton(this.editor.getModel(),t,this._languageFeaturesService.renameProvider);if(!s.hasProvider()){e("skeleton has no provider");return}const o=new EditorStateCancellationTokenSource(this.editor,5,void 0,this._cts.token);let r;try{e("resolving rename location");const b=s.resolveRenameLocation(o.token);this._progressService.showWhile(b,250),r=await b,e("resolved rename location")}catch(b){b instanceof CancellationError?e("resolve rename location cancelled",JSON.stringify(b,null,"	")):(e("resolve rename location failed",b instanceof Error?b:JSON.stringify(b,null,"	")),(typeof b=="string"||isMarkdownString(b))&&((_=MessageController.get(this.editor))==null||_.showMessage(b||localize(1366,"An unknown error occurred while resolving rename location"),t)));return}finally{o.dispose()}if(!r){e("returning early - no loc");return}if(r.rejectReason){e(`returning early - rejected with reason: ${r.rejectReason}`,r.rejectReason),(C=MessageController.get(this.editor))==null||C.showMessage(r.rejectReason,t);return}if(o.token.isCancellationRequested){e("returning early - cts1 cancelled");return}const l=new EditorStateCancellationTokenSource(this.editor,5,r.range,this._cts.token),c=this.editor.getModel(),d=this._languageFeaturesService.newSymbolNamesProvider.all(c),u=await Promise.all(d.map(async b=>[b,await b.supportsAutomaticNewSymbolNamesTriggerKind??!1])),g=(b,v)=>{let S=u.slice();return b===NewSymbolNameTriggerKind$1.Automatic&&(S=S.filter(([y,w])=>w)),S.map(([y])=>y.provideNewSymbolNames(c,r.range,b,v))};e("creating rename input field and awaiting its result");const f=this._bulkEditService.hasPreviewHandler()&&this._configService.getValue(this.editor.getModel().uri,"editor.rename.enablePreview"),p=await this._renameWidget.getInput(r.range,r.text,f,d.length>0?g:void 0,l);if(e("received response from rename input field"),typeof p=="boolean"){e(`returning early - rename input field response - ${p}`),p&&this.editor.focus(),l.dispose();return}this.editor.focus(),e("requesting rename edits");const m=raceCancellation(s.provideRenameEdits(p.newName,l.token),l.token).then(async b=>{if(!b){e("returning early - no rename edits result");return}if(!this.editor.hasModel()){e("returning early - no model after rename edits are provided");return}if(b.rejectReason){e(`returning early - rejected with reason: ${b.rejectReason}`),this._notificationService.info(b.rejectReason);return}this.editor.setSelection(Range$2.fromPositions(this.editor.getSelection().getPosition())),e("applying edits"),this._bulkEditService.apply(b,{editor:this.editor,showPreview:p.wantsPreview,label:localize(1367,"Renaming '{0}' to '{1}'",r==null?void 0:r.text,p.newName),code:"undoredo.rename",quotableLabel:localize(1368,"Renaming {0} to {1}",r==null?void 0:r.text,p.newName),respectAutoSaveConfig:!0,reason:EditSources.rename()}).then(v=>{e("edits applied"),v.ariaSummary&&alert$1(localize(1369,"Successfully renamed '{0}' to '{1}'. Summary: {2}",r.text,p.newName,v.ariaSummary))}).catch(v=>{e(`error when applying edits ${JSON.stringify(v,null,"	")}`),this._notificationService.error(localize(1370,"Rename failed to apply edits")),this._logService.error(v)})},b=>{e("error when providing rename edits",JSON.stringify(b,null,"	")),this._notificationService.error(localize(1371,"Rename failed to compute edits")),this._logService.error(b)}).finally(()=>{l.dispose()});return e("returning rename operation"),this._progressService.showWhile(m,250),m}acceptRenameInput(e){this._renameWidget.acceptInput(e)}cancelRenameInput(){this._renameWidget.cancelInput(!0,"cancelRenameInput command")}focusNextRenameSuggestion(){this._renameWidget.focusNextRenameSuggestion()}focusPreviousRenameSuggestion(){this._renameWidget.focusPreviousRenameSuggestion()}},RenameController_1=Ji,Ji.ID="editor.contrib.renameController",Ji);RenameController=RenameController_1=__decorate$J([__param$I(1,IInstantiationService),__param$I(2,INotificationService),__param$I(3,IBulkEditService),__param$I(4,IEditorProgressService),__param$I(5,ILogService),__param$I(6,ITextResourceConfigurationService),__param$I(7,ILanguageFeaturesService)],RenameController);class RenameAction extends EditorAction{constructor(){super({id:"editor.action.rename",label:localize2(1373,"Rename Symbol"),precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasRenameProvider),kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:60,weight:100},contextMenuOpts:{group:"1_modification",order:1.1}})}runCommand(e,t){const s=e.get(ICodeEditorService),[o,r]=Array.isArray(t)&&t||[void 0,void 0];return URI.isUri(o)&&Position$1.isIPosition(r)?s.openCodeEditor({resource:o},s.getActiveCodeEditor()).then(l=>{l&&(l.setPosition(r),l.invokeWithinContext(c=>(this.reportTelemetry(c,l),this.run(c,l))))},onUnexpectedError):super.runCommand(e,t)}run(e,t){const s=e.get(ILogService),o=RenameController.get(t);return o?(s.trace("[RenameAction] got controller, running..."),o.run()):(s.trace("[RenameAction] returning early - controller missing"),Promise.resolve())}}registerEditorContribution(RenameController.ID,RenameController,4);registerEditorAction(RenameAction);const RenameCommand=EditorCommand.bindToContribution(RenameController.get);registerEditorCommand(new RenameCommand({id:"acceptRenameInput",precondition:CONTEXT_RENAME_INPUT_VISIBLE,handler:a=>a.acceptRenameInput(!1),kbOpts:{weight:100+99,kbExpr:ContextKeyExpr.and(EditorContextKeys.focus,ContextKeyExpr.not("isComposing")),primary:3}}));registerEditorCommand(new RenameCommand({id:"acceptRenameInputWithPreview",precondition:ContextKeyExpr.and(CONTEXT_RENAME_INPUT_VISIBLE,ContextKeyExpr.has("config.editor.rename.enablePreview")),handler:a=>a.acceptRenameInput(!0),kbOpts:{weight:100+99,kbExpr:ContextKeyExpr.and(EditorContextKeys.focus,ContextKeyExpr.not("isComposing")),primary:2048+3}}));registerEditorCommand(new RenameCommand({id:"cancelRenameInput",precondition:CONTEXT_RENAME_INPUT_VISIBLE,handler:a=>a.cancelRenameInput(),kbOpts:{weight:100+99,kbExpr:EditorContextKeys.focus,primary:9,secondary:[1033]}}));registerAction2(class extends Action2{constructor(){super({id:"focusNextRenameSuggestion",title:{...localize2(1374,"Focus Next Rename Suggestion")},precondition:CONTEXT_RENAME_INPUT_VISIBLE,keybinding:[{primary:18,weight:100+99}]})}run(e){const t=e.get(ICodeEditorService).getFocusedCodeEditor();if(!t)return;const s=RenameController.get(t);s&&s.focusNextRenameSuggestion()}});registerAction2(class extends Action2{constructor(){super({id:"focusPreviousRenameSuggestion",title:{...localize2(1375,"Focus Previous Rename Suggestion")},precondition:CONTEXT_RENAME_INPUT_VISIBLE,keybinding:[{primary:16,weight:100+99}]})}run(e){const t=e.get(ICodeEditorService).getFocusedCodeEditor();if(!t)return;const s=RenameController.get(t);s&&s.focusPreviousRenameSuggestion()}});registerModelAndPositionCommand("_executeDocumentRenameProvider",function(a,e,t,...s){const[o]=s;assertType(typeof o=="string");const{renameProvider:r}=a.get(ILanguageFeaturesService);return rename(r,e,t,o)});registerModelAndPositionCommand("_executePrepareRename",async function(a,e,t){const{renameProvider:s}=a.get(ILanguageFeaturesService),r=await new RenameSkeleton(e,t,s).resolveRenameLocation(CancellationToken.None);if(r!=null&&r.rejectReason)throw new Error(r.rejectReason);return r});Registry.as(Extensions$6.Configuration).registerConfiguration({id:"editor",properties:{"editor.rename.enablePreview":{scope:6,description:localize(1372,"Enable/disable the ability to preview changes before renaming"),default:!0,type:"boolean"}}});var __decorate$I=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$H=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},$n;let SectionHeaderDetector=($n=class extends Disposable{constructor(e,t,s){super(),this.editor=e,this.languageConfigurationService=t,this.editorWorkerService=s,this.decorations=this.editor.createDecorationsCollection(),this.options=this.createOptions(e.getOption(81)),this.computePromise=null,this.currentOccurrences={},this._register(e.onDidChangeModel(o=>{this.currentOccurrences={},this.options=this.createOptions(e.getOption(81)),this.stop(),this.computeSectionHeaders.schedule(0)})),this._register(e.onDidChangeModelLanguage(o=>{this.currentOccurrences={},this.options=this.createOptions(e.getOption(81)),this.stop(),this.computeSectionHeaders.schedule(0)})),this._register(t.onDidChange(o=>{var l;const r=(l=this.editor.getModel())==null?void 0:l.getLanguageId();r&&o.affects(r)&&(this.currentOccurrences={},this.options=this.createOptions(e.getOption(81)),this.stop(),this.computeSectionHeaders.schedule(0))})),this._register(e.onDidChangeConfiguration(o=>{this.options&&!o.hasChanged(81)||(this.options=this.createOptions(e.getOption(81)),this.updateDecorations([]),this.stop(),this.computeSectionHeaders.schedule(0))})),this._register(this.editor.onDidChangeModelContent(o=>{this.computeSectionHeaders.schedule()})),this._register(e.onDidChangeModelTokens(o=>{this.computeSectionHeaders.isScheduled()||this.computeSectionHeaders.schedule(1e3)})),this.computeSectionHeaders=this._register(new RunOnceScheduler(()=>{this.findSectionHeaders()},250)),this.computeSectionHeaders.schedule(0)}createOptions(e){if(!e||!this.editor.hasModel())return;const t=this.editor.getModel().getLanguageId();if(!t)return;const s=this.languageConfigurationService.getLanguageConfiguration(t).comments,o=this.languageConfigurationService.getLanguageConfiguration(t).foldingRules;if(!(!s&&!(o!=null&&o.markers)))return{foldingRules:o,markSectionHeaderRegex:e.markSectionHeaderRegex,findMarkSectionHeaders:e.showMarkSectionHeaders,findRegionSectionHeaders:e.showRegionSectionHeaders}}findSectionHeaders(){var s,o;if(!this.editor.hasModel()||!((s=this.options)!=null&&s.findMarkSectionHeaders)&&!((o=this.options)!=null&&o.findRegionSectionHeaders))return;const e=this.editor.getModel();if(e.isDisposed()||e.isTooLargeForSyncing())return;const t=e.getVersionId();this.editorWorkerService.findSectionHeaders(e.uri,this.options).then(r=>{e.isDisposed()||e.getVersionId()!==t||this.updateDecorations(r)})}updateDecorations(e){const t=this.editor.getModel();t&&(e=e.filter(r=>{if(!r.shouldBeInComments)return!0;const l=t.validateRange(r.range),c=t.tokenization.getLineTokens(l.startLineNumber),d=c.findTokenIndexAtOffset(l.startColumn-1),u=c.getStandardTokenType(d);return c.getLanguageId(d)===t.getLanguageId()&&u===1}));const s=Object.values(this.currentOccurrences).map(r=>r.decorationId),o=e.map(r=>decoration(r));this.editor.changeDecorations(r=>{const l=r.deltaDecorations(s,o);this.currentOccurrences={};for(let c=0,d=l.length;c<d;c++){const u={sectionHeader:e[c],decorationId:l[c]};this.currentOccurrences[u.decorationId]=u}})}stop(){this.computeSectionHeaders.cancel(),this.computePromise&&(this.computePromise.cancel(),this.computePromise=null)}dispose(){super.dispose(),this.stop(),this.decorations.clear()}},$n.ID="editor.sectionHeaderDetector",$n);SectionHeaderDetector=__decorate$I([__param$H(1,ILanguageConfigurationService),__param$H(2,IEditorWorkerService)],SectionHeaderDetector);function decoration(a){return{range:a.range,options:ModelDecorationOptions.createDynamic({description:"section-header",stickiness:3,collapseOnReplaceEdit:!0,minimap:{color:void 0,position:1,sectionHeaderStyle:a.hasSeparatorLine?2:1,sectionHeaderText:a.text}})}}registerEditorContribution(SectionHeaderDetector.ID,SectionHeaderDetector,1);class RateLimiter{constructor(e=5){this.timesPerSecond=e,this._lastRun=0,this._minimumTimeBetweenRuns=1e3/e}runIfNotLimited(e){const t=Date.now();t-this._lastRun>=this._minimumTimeBetweenRuns&&(this._lastRun=t,e())}}class SparseMultilineTokens{static create(e,t){return new SparseMultilineTokens(e,new SparseMultilineTokensStorage(t))}get startLineNumber(){return this._startLineNumber}get endLineNumber(){return this._endLineNumber}constructor(e,t){this._startLineNumber=e,this._tokens=t,this._endLineNumber=this._startLineNumber+this._tokens.getMaxDeltaLine()}toString(){return this._tokens.toString(this._startLineNumber)}_updateEndLineNumber(){this._endLineNumber=this._startLineNumber+this._tokens.getMaxDeltaLine()}isEmpty(){return this._tokens.isEmpty()}getLineTokens(e){return this._startLineNumber<=e&&e<=this._endLineNumber?this._tokens.getLineTokens(e-this._startLineNumber):null}getRange(){const e=this._tokens.getRange();return e&&new Range$2(this._startLineNumber+e.startLineNumber,e.startColumn,this._startLineNumber+e.endLineNumber,e.endColumn)}removeTokens(e){const t=e.startLineNumber-this._startLineNumber,s=e.endLineNumber-this._startLineNumber;this._startLineNumber+=this._tokens.removeTokens(t,e.startColumn-1,s,e.endColumn-1),this._updateEndLineNumber()}split(e){const t=e.startLineNumber-this._startLineNumber,s=e.endLineNumber-this._startLineNumber,[o,r,l]=this._tokens.split(t,e.startColumn-1,s,e.endColumn-1);return[new SparseMultilineTokens(this._startLineNumber,o),new SparseMultilineTokens(this._startLineNumber+l,r)]}applyEdit(e,t){const[s,o,r]=countEOL(t);this.acceptEdit(e,s,o,r,t.length>0?t.charCodeAt(0):0)}acceptEdit(e,t,s,o,r){this._acceptDeleteRange(e),this._acceptInsertText(new Position$1(e.startLineNumber,e.startColumn),t,s,o,r),this._updateEndLineNumber()}_acceptDeleteRange(e){if(e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn)return;const t=e.startLineNumber-this._startLineNumber,s=e.endLineNumber-this._startLineNumber;if(s<0){const r=s-t;this._startLineNumber-=r;return}const o=this._tokens.getMaxDeltaLine();if(!(t>=o+1)){if(t<0&&s>=o+1){this._startLineNumber=0,this._tokens.clear();return}if(t<0){const r=-t;this._startLineNumber-=r,this._tokens.acceptDeleteRange(e.startColumn-1,0,0,s,e.endColumn-1)}else this._tokens.acceptDeleteRange(0,t,e.startColumn-1,s,e.endColumn-1)}}_acceptInsertText(e,t,s,o,r){if(t===0&&s===0)return;const l=e.lineNumber-this._startLineNumber;if(l<0){this._startLineNumber+=t;return}const c=this._tokens.getMaxDeltaLine();l>=c+1||this._tokens.acceptInsertText(l,e.column-1,t,s,o,r)}reportIfInvalid(e){this._tokens.reportIfInvalid(e,this._startLineNumber)}}const ot=class ot{constructor(e){this._tokens=e,this._tokenCount=e.length/4}toString(e){const t=[];for(let s=0;s<this._tokenCount;s++)t.push(`(${this._getDeltaLine(s)+e},${this._getStartCharacter(s)}-${this._getEndCharacter(s)})`);return`[${t.join(",")}]`}getMaxDeltaLine(){const e=this._getTokenCount();return e===0?-1:this._getDeltaLine(e-1)}getRange(){const e=this._getTokenCount();if(e===0)return null;const t=this._getStartCharacter(0),s=this._getDeltaLine(e-1),o=this._getEndCharacter(e-1);return new Range$2(0,t+1,s,o+1)}_getTokenCount(){return this._tokenCount}_getDeltaLine(e){return this._tokens[4*e]}_getStartCharacter(e){return this._tokens[4*e+1]}_getEndCharacter(e){return this._tokens[4*e+2]}isEmpty(){return this._getTokenCount()===0}getLineTokens(e){let t=0,s=this._getTokenCount()-1;for(;t<s;){const o=t+Math.floor((s-t)/2),r=this._getDeltaLine(o);if(r<e)t=o+1;else if(r>e)s=o-1;else{let l=o;for(;l>t&&this._getDeltaLine(l-1)===e;)l--;let c=o;for(;c<s&&this._getDeltaLine(c+1)===e;)c++;return new SparseLineTokens(this._tokens.subarray(4*l,4*c+4))}}return this._getDeltaLine(t)===e?new SparseLineTokens(this._tokens.subarray(4*t,4*t+4)):null}clear(){this._tokenCount=0}removeTokens(e,t,s,o){const r=this._tokens,l=this._tokenCount;let c=0,d=!1,u=0;for(let g=0;g<l;g++){const f=4*g,p=r[f],m=r[f+1],_=r[f+2],C=r[f+3];if((p>e||p===e&&_>=t)&&(p<s||p===s&&m<=o))d=!0;else{if(c===0&&(u=p),d){const b=4*c;r[b]=p-u,r[b+1]=m,r[b+2]=_,r[b+3]=C}c++}}return this._tokenCount=c,u}split(e,t,s,o){const r=this._tokens,l=this._tokenCount,c=[],d=[];let u=c,g=0,f=0;for(let p=0;p<l;p++){const m=4*p,_=r[m],C=r[m+1],b=r[m+2],v=r[m+3];if(_>e||_===e&&b>=t){if(_<s||_===s&&C<=o)continue;u!==d&&(u=d,g=0,f=_)}u[g++]=_-f,u[g++]=C,u[g++]=b,u[g++]=v}return[new ot(new Uint32Array(c)),new ot(new Uint32Array(d)),f]}acceptDeleteRange(e,t,s,o,r){const l=this._tokens,c=this._tokenCount,d=o-t;let u=0,g=!1;for(let f=0;f<c;f++){const p=4*f;let m=l[p],_=l[p+1],C=l[p+2];const b=l[p+3];if(m<t||m===t&&C<=s){u++;continue}else if(m===t&&_<s)m===o&&C>r?C-=r-s:C=s;else if(m===t&&_===s)if(m===o&&C>r)C-=r-s;else{g=!0;continue}else if(m<o||m===o&&_<r)if(m===o&&C>r)m=t,_=s,C=_+(C-r);else{g=!0;continue}else if(m>o){if(d===0&&!g){u=c;break}m-=d}else if(m===o&&_>=r)e&&m===0&&(_+=e,C+=e),m-=d,_-=r-s,C-=r-s;else throw new Error("Not possible!");const v=4*u;l[v]=m,l[v+1]=_,l[v+2]=C,l[v+3]=b,u++}this._tokenCount=u}acceptInsertText(e,t,s,o,r,l){const c=s===0&&o===1&&(l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122),d=this._tokens,u=this._tokenCount;for(let g=0;g<u;g++){const f=4*g;let p=d[f],m=d[f+1],_=d[f+2];if(!(p<e||p===e&&_<t)){if(p===e&&_===t)if(c)_+=1;else continue;else if(p===e&&m<t&&t<_)s===0?_+=o:_=t;else{if(p===e&&m===t&&c)continue;if(p===e)if(p+=s,s===0)m+=o,_+=o;else{const C=_-m;m=r+(m-t),_=m+C}else p+=s}d[f]=p,d[f+1]=m,d[f+2]=_}}}reportIfInvalid(e,t){for(let s=0;s<this._tokenCount;s++){const o=this._getDeltaLine(s)+t;o<1?ot._rateLimiter.runIfNotLimited(()=>{console.error("Invalid Semantic Tokens Data From Extension: lineNumber < 1")}):o>e.getLineCount()?ot._rateLimiter.runIfNotLimited(()=>{console.error("Invalid Semantic Tokens Data From Extension: lineNumber > model.getLineCount()")}):this._getEndCharacter(s)>e.getLineLength(o)&&ot._rateLimiter.runIfNotLimited(()=>{console.error("Invalid Semantic Tokens Data From Extension: end character > model.getLineLength(lineNumber)")})}}};ot._rateLimiter=new RateLimiter(10/60);let SparseMultilineTokensStorage=ot;class SparseLineTokens{constructor(e){this._tokens=e}getCount(){return this._tokens.length/4}getStartCharacter(e){return this._tokens[4*e+1]}getEndCharacter(e){return this._tokens[4*e+2]}getMetadata(e){return this._tokens[4*e+3]}}var __decorate$H=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$G=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let SemanticTokensProviderStyling=class{constructor(e,t,s,o){this._legend=e,this._themeService=t,this._languageService=s,this._logService=o,this._hasWarnedOverlappingTokens=!1,this._hasWarnedInvalidLengthTokens=!1,this._hasWarnedInvalidEditStart=!1,this._hashTable=new HashTable}getMetadata(e,t,s){const o=this._languageService.languageIdCodec.encodeLanguageId(s),r=this._hashTable.get(e,t,o);let l;if(r)l=r.metadata;else{let c=this._legend.tokenTypes[e];const d=[];if(c){let u=t;for(let f=0;u>0&&f<this._legend.tokenModifiers.length;f++)u&1&&d.push(this._legend.tokenModifiers[f]),u=u>>1;const g=this._themeService.getColorTheme().getTokenStyleMetadata(c,d,s);if(typeof g>"u")l=2147483647;else{if(l=0,typeof g.italic<"u"){const f=(g.italic?1:0)<<11;l|=f|1}if(typeof g.bold<"u"){const f=(g.bold?2:0)<<11;l|=f|2}if(typeof g.underline<"u"){const f=(g.underline?4:0)<<11;l|=f|4}if(typeof g.strikethrough<"u"){const f=(g.strikethrough?8:0)<<11;l|=f|8}if(g.foreground){const f=g.foreground<<15;l|=f|16}l===0&&(l=2147483647)}}else l=2147483647,c="not-in-legend";this._hashTable.add(e,t,o,l)}return l}warnOverlappingSemanticTokens(e,t){this._hasWarnedOverlappingTokens||(this._hasWarnedOverlappingTokens=!0,this._logService.warn(`Overlapping semantic tokens detected at lineNumber ${e}, column ${t}`))}warnInvalidLengthSemanticTokens(e,t){this._hasWarnedInvalidLengthTokens||(this._hasWarnedInvalidLengthTokens=!0,this._logService.warn(`Semantic token with invalid length detected at lineNumber ${e}, column ${t}`))}warnInvalidEditStart(e,t,s,o,r){this._hasWarnedInvalidEditStart||(this._hasWarnedInvalidEditStart=!0,this._logService.warn(`Invalid semantic tokens edit detected (previousResultId: ${e}, resultId: ${t}) at edit #${s}: The provided start offset ${o} is outside the previous data (length ${r}).`))}};SemanticTokensProviderStyling=__decorate$H([__param$G(1,IThemeService),__param$G(2,ILanguageService),__param$G(3,ILogService)],SemanticTokensProviderStyling);function toMultilineTokens2(a,e,t){const s=a.data,o=a.data.length/5|0,r=Math.max(Math.ceil(o/1024),400),l=[];let c=0,d=1,u=0;for(;c<o;){const g=c;let f=Math.min(g+r,o);if(f<o){let S=f;for(;S-1>g&&s[5*S]===0;)S--;if(S-1===g){let y=f;for(;y+1<o&&s[5*y]===0;)y++;f=y}else f=S}let p=new Uint32Array((f-g)*4),m=0,_=0,C=0,b=0;for(;c<f;){const S=5*c,y=s[S],w=s[S+1],L=d+y|0,x=y===0?u+w|0:w,E=s[S+2],I=x+E|0,D=s[S+3],k=s[S+4];if(I<=x)e.warnInvalidLengthSemanticTokens(L,x+1);else if(C===L&&b>x)e.warnOverlappingSemanticTokens(L,x+1);else{const N=e.getMetadata(D,k,t);N!==2147483647&&(_===0&&(_=L),p[m]=L-_,p[m+1]=x,p[m+2]=I,p[m+3]=N,m+=4,C=L,b=I)}d=L,u=x,c++}m!==p.length&&(p=p.subarray(0,m));const v=SparseMultilineTokens.create(_,p);l.push(v)}return l}class HashTableEntry{constructor(e,t,s,o){this.tokenTypeIndex=e,this.tokenModifierSet=t,this.languageId=s,this.metadata=o,this.next=null}}const Qe=class Qe{constructor(){this._elementsCount=0,this._currentLengthIndex=0,this._currentLength=Qe._SIZES[this._currentLengthIndex],this._growCount=Math.round(this._currentLengthIndex+1<Qe._SIZES.length?2/3*this._currentLength:0),this._elements=[],Qe._nullOutEntries(this._elements,this._currentLength)}static _nullOutEntries(e,t){for(let s=0;s<t;s++)e[s]=null}_hash2(e,t){return(e<<5)-e+t|0}_hashFunc(e,t,s){return this._hash2(this._hash2(e,t),s)%this._currentLength}get(e,t,s){const o=this._hashFunc(e,t,s);let r=this._elements[o];for(;r;){if(r.tokenTypeIndex===e&&r.tokenModifierSet===t&&r.languageId===s)return r;r=r.next}return null}add(e,t,s,o){if(this._elementsCount++,this._growCount!==0&&this._elementsCount>=this._growCount){const r=this._elements;this._currentLengthIndex++,this._currentLength=Qe._SIZES[this._currentLengthIndex],this._growCount=Math.round(this._currentLengthIndex+1<Qe._SIZES.length?2/3*this._currentLength:0),this._elements=[],Qe._nullOutEntries(this._elements,this._currentLength);for(const l of r){let c=l;for(;c;){const d=c.next;c.next=null,this._add(c),c=d}}}this._add(new HashTableEntry(e,t,s,o))}_add(e){const t=this._hashFunc(e.tokenTypeIndex,e.tokenModifierSet,e.languageId);e.next=this._elements[t],this._elements[t]=e}};Qe._SIZES=[3,7,13,31,61,127,251,509,1021,2039,4093,8191,16381,32749,65521,131071,262139,524287,1048573,2097143];let HashTable=Qe;const ISemanticTokensStylingService=createDecorator("semanticTokensStylingService");function reverseEndianness(a){for(let e=0,t=a.length;e<t;e+=4){const s=a[e+0],o=a[e+1],r=a[e+2],l=a[e+3];a[e+0]=l,a[e+1]=r,a[e+2]=o,a[e+3]=s}}function toLittleEndianBuffer(a){const e=new Uint8Array(a.buffer,a.byteOffset,a.length*4);return isLittleEndian()||reverseEndianness(e),VSBuffer.wrap(e)}function encodeSemanticTokensDto(a){const e=new Uint32Array(encodeSemanticTokensDtoSize(a));let t=0;if(e[t++]=a.id,a.type==="full")e[t++]=1,e[t++]=a.data.length,e.set(a.data,t),t+=a.data.length;else{e[t++]=2,e[t++]=a.deltas.length;for(const s of a.deltas)e[t++]=s.start,e[t++]=s.deleteCount,s.data?(e[t++]=s.data.length,e.set(s.data,t),t+=s.data.length):e[t++]=0}return toLittleEndianBuffer(e)}function encodeSemanticTokensDtoSize(a){let e=0;if(e+=1+1,a.type==="full")e+=1+a.data.length;else{e+=1,e+=(1+1+1)*a.deltas.length;for(const t of a.deltas)t.data&&(e+=t.data.length)}return e}function isSemanticTokens(a){return a&&!!a.data}function isSemanticTokensEdits(a){return a&&Array.isArray(a.edits)}class DocumentSemanticTokensResult{constructor(e,t,s){this.provider=e,this.tokens=t,this.error=s}}function hasDocumentSemanticTokensProvider(a,e){return a.has(e)}function getDocumentSemanticTokensProviders(a,e){const t=a.orderedGroups(e);return t.length>0?t[0]:[]}async function getDocumentSemanticTokens(a,e,t,s,o){const r=getDocumentSemanticTokensProviders(a,e),l=await Promise.all(r.map(async c=>{let d,u=null;try{d=await c.provideDocumentSemanticTokens(e,c===t?s:null,o)}catch(g){u=g,d=null}return(!d||!isSemanticTokens(d)&&!isSemanticTokensEdits(d))&&(d=null),new DocumentSemanticTokensResult(c,d,u)}));for(const c of l){if(c.error)throw c.error;if(c.tokens)return c}return l.length>0?l[0]:null}function _getDocumentSemanticTokensProviderHighestGroup(a,e){const t=a.orderedGroups(e);return t.length>0?t[0]:null}class DocumentRangeSemanticTokensResult{constructor(e,t){this.provider=e,this.tokens=t}}function hasDocumentRangeSemanticTokensProvider(a,e){return a.has(e)}function getDocumentRangeSemanticTokensProviders(a,e){const t=a.orderedGroups(e);return t.length>0?t[0]:[]}async function getDocumentRangeSemanticTokens(a,e,t,s){const o=getDocumentRangeSemanticTokensProviders(a,e),r=await Promise.all(o.map(async l=>{let c;try{c=await l.provideDocumentRangeSemanticTokens(e,t,s)}catch(d){onUnexpectedExternalError(d),c=null}return(!c||!isSemanticTokens(c))&&(c=null),new DocumentRangeSemanticTokensResult(l,c)}));for(const l of r)if(l.tokens)return l;return r.length>0?r[0]:null}CommandsRegistry.registerCommand("_provideDocumentSemanticTokensLegend",async(a,...e)=>{const[t]=e;assertType(t instanceof URI);const s=a.get(IModelService).getModel(t);if(!s)return;const{documentSemanticTokensProvider:o}=a.get(ILanguageFeaturesService),r=_getDocumentSemanticTokensProviderHighestGroup(o,s);return r?r[0].getLegend():a.get(ICommandService).executeCommand("_provideDocumentRangeSemanticTokensLegend",t)});CommandsRegistry.registerCommand("_provideDocumentSemanticTokens",async(a,...e)=>{const[t]=e;assertType(t instanceof URI);const s=a.get(IModelService).getModel(t);if(!s)return;const{documentSemanticTokensProvider:o}=a.get(ILanguageFeaturesService);if(!hasDocumentSemanticTokensProvider(o,s))return a.get(ICommandService).executeCommand("_provideDocumentRangeSemanticTokens",t,s.getFullModelRange());const r=await getDocumentSemanticTokens(o,s,null,null,CancellationToken.None);if(!r)return;const{provider:l,tokens:c}=r;if(!c||!isSemanticTokens(c))return;const d=encodeSemanticTokensDto({id:0,type:"full",data:c.data});return c.resultId&&l.releaseDocumentSemanticTokens(c.resultId),d});CommandsRegistry.registerCommand("_provideDocumentRangeSemanticTokensLegend",async(a,...e)=>{const[t,s]=e;assertType(t instanceof URI);const o=a.get(IModelService).getModel(t);if(!o)return;const{documentRangeSemanticTokensProvider:r}=a.get(ILanguageFeaturesService),l=getDocumentRangeSemanticTokensProviders(r,o);if(l.length===0)return;if(l.length===1)return l[0].getLegend();if(!s||!Range$2.isIRange(s))return console.warn("provideDocumentRangeSemanticTokensLegend might be out-of-sync with provideDocumentRangeSemanticTokens unless a range argument is passed in"),l[0].getLegend();const c=await getDocumentRangeSemanticTokens(r,o,Range$2.lift(s),CancellationToken.None);if(c)return c.provider.getLegend()});CommandsRegistry.registerCommand("_provideDocumentRangeSemanticTokens",async(a,...e)=>{const[t,s]=e;assertType(t instanceof URI),assertType(Range$2.isIRange(s));const o=a.get(IModelService).getModel(t);if(!o)return;const{documentRangeSemanticTokensProvider:r}=a.get(ILanguageFeaturesService),l=await getDocumentRangeSemanticTokens(r,o,Range$2.lift(s),CancellationToken.None);if(!(!l||!l.tokens))return encodeSemanticTokensDto({id:0,type:"full",data:l.tokens.data})});const SEMANTIC_HIGHLIGHTING_SETTING_ID="editor.semanticHighlighting";function isSemanticColoringEnabled(a,e,t){var o;const s=(o=t.getValue(SEMANTIC_HIGHLIGHTING_SETTING_ID,{overrideIdentifier:a.getLanguageId(),resource:a.uri}))==null?void 0:o.enabled;return typeof s=="boolean"?s:e.getColorTheme().semanticHighlighting}var __decorate$G=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$F=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},ModelSemanticColoring_1;let DocumentSemanticTokensFeature=class extends Disposable{constructor(e,t,s,o,r,l){super(),this._watchers=new ResourceMap;const c=g=>{var f;(f=this._watchers.get(g.uri))==null||f.dispose(),this._watchers.set(g.uri,new ModelSemanticColoring(g,e,s,r,l))},d=(g,f)=>{f.dispose(),this._watchers.delete(g.uri)},u=()=>{for(const g of t.getModels()){const f=this._watchers.get(g.uri);isSemanticColoringEnabled(g,s,o)?f||c(g):f&&d(g,f)}};t.getModels().forEach(g=>{isSemanticColoringEnabled(g,s,o)&&c(g)}),this._register(t.onModelAdded(g=>{isSemanticColoringEnabled(g,s,o)&&c(g)})),this._register(t.onModelRemoved(g=>{const f=this._watchers.get(g.uri);f&&d(g,f)})),this._register(o.onDidChangeConfiguration(g=>{g.affectsConfiguration(SEMANTIC_HIGHLIGHTING_SETTING_ID)&&u()})),this._register(s.onDidColorThemeChange(u))}dispose(){dispose(this._watchers.values()),this._watchers.clear(),super.dispose()}};DocumentSemanticTokensFeature=__decorate$G([__param$F(0,ISemanticTokensStylingService),__param$F(1,IModelService),__param$F(2,IThemeService),__param$F(3,IConfigurationService),__param$F(4,ILanguageFeatureDebounceService),__param$F(5,ILanguageFeaturesService)],DocumentSemanticTokensFeature);var zt;let ModelSemanticColoring=(zt=class extends Disposable{constructor(e,t,s,o,r){super(),this._semanticTokensStylingService=t,this._isDisposed=!1,this._model=e,this._provider=r.documentSemanticTokensProvider,this._debounceInformation=o.for(this._provider,"DocumentSemanticTokens",{min:ModelSemanticColoring_1.REQUEST_MIN_DELAY,max:ModelSemanticColoring_1.REQUEST_MAX_DELAY}),this._fetchDocumentSemanticTokens=this._register(new RunOnceScheduler(()=>this._fetchDocumentSemanticTokensNow(),ModelSemanticColoring_1.REQUEST_MIN_DELAY)),this._currentDocumentResponse=null,this._currentDocumentRequestCancellationTokenSource=null,this._documentProvidersChangeListeners=[],this._providersChangedDuringRequest=!1,this._register(this._model.onDidChangeContent(()=>{this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(this._model.onDidChangeAttached(()=>{this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(this._model.onDidChangeLanguage(()=>{this._currentDocumentResponse&&(this._currentDocumentResponse.dispose(),this._currentDocumentResponse=null),this._currentDocumentRequestCancellationTokenSource&&(this._currentDocumentRequestCancellationTokenSource.cancel(),this._currentDocumentRequestCancellationTokenSource=null),this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(0)}));const l=()=>{dispose(this._documentProvidersChangeListeners),this._documentProvidersChangeListeners=[];for(const c of this._provider.all(e))typeof c.onDidChange=="function"&&this._documentProvidersChangeListeners.push(c.onDidChange(()=>{if(this._currentDocumentRequestCancellationTokenSource){this._providersChangedDuringRequest=!0;return}this._fetchDocumentSemanticTokens.schedule(0)}))};l(),this._register(this._provider.onDidChange(()=>{l(),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(s.onDidColorThemeChange(c=>{this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._fetchDocumentSemanticTokens.schedule(0)}dispose(){this._currentDocumentResponse&&(this._currentDocumentResponse.dispose(),this._currentDocumentResponse=null),this._currentDocumentRequestCancellationTokenSource&&(this._currentDocumentRequestCancellationTokenSource.cancel(),this._currentDocumentRequestCancellationTokenSource=null),dispose(this._documentProvidersChangeListeners),this._documentProvidersChangeListeners=[],this._setDocumentSemanticTokens(null,null,null,[]),this._isDisposed=!0,super.dispose()}_fetchDocumentSemanticTokensNow(){if(this._currentDocumentRequestCancellationTokenSource)return;if(!hasDocumentSemanticTokensProvider(this._provider,this._model)){this._currentDocumentResponse&&this._model.tokenization.setSemanticTokens(null,!1);return}if(!this._model.isAttachedToEditor())return;const e=new CancellationTokenSource$1,t=this._currentDocumentResponse?this._currentDocumentResponse.provider:null,s=this._currentDocumentResponse&&this._currentDocumentResponse.resultId||null,o=getDocumentSemanticTokens(this._provider,this._model,t,s,e.token);this._currentDocumentRequestCancellationTokenSource=e,this._providersChangedDuringRequest=!1;const r=[],l=this._model.onDidChangeContent(d=>{r.push(d)}),c=new StopWatch(!1);o.then(d=>{if(this._debounceInformation.update(this._model,c.elapsed()),this._currentDocumentRequestCancellationTokenSource=null,l.dispose(),!d)this._setDocumentSemanticTokens(null,null,null,r);else{const{provider:u,tokens:g}=d,f=this._semanticTokensStylingService.getStyling(u);this._setDocumentSemanticTokens(u,g||null,f,r)}},d=>{d&&(isCancellationError(d)||typeof d.message=="string"&&d.message.indexOf("busy")!==-1)||onUnexpectedError(d),this._currentDocumentRequestCancellationTokenSource=null,l.dispose(),(r.length>0||this._providersChangedDuringRequest)&&(this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model)))})}static _copy(e,t,s,o,r){r=Math.min(r,s.length-o,e.length-t);for(let l=0;l<r;l++)s[o+l]=e[t+l]}_setDocumentSemanticTokens(e,t,s,o){const r=this._currentDocumentResponse,l=()=>{(o.length>0||this._providersChangedDuringRequest)&&!this._fetchDocumentSemanticTokens.isScheduled()&&this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))};if(this._currentDocumentResponse&&(this._currentDocumentResponse.dispose(),this._currentDocumentResponse=null),this._isDisposed){e&&t&&e.releaseDocumentSemanticTokens(t.resultId);return}if(!e||!s){this._model.tokenization.setSemanticTokens(null,!1);return}if(!t){this._model.tokenization.setSemanticTokens(null,!0),l();return}if(isSemanticTokensEdits(t)){if(!r){this._model.tokenization.setSemanticTokens(null,!0);return}if(t.edits.length===0)t={resultId:t.resultId,data:r.data};else{let c=0;for(const p of t.edits)c+=(p.data?p.data.length:0)-p.deleteCount;const d=r.data,u=new Uint32Array(d.length+c);let g=d.length,f=u.length;for(let p=t.edits.length-1;p>=0;p--){const m=t.edits[p];if(m.start>d.length){s.warnInvalidEditStart(r.resultId,t.resultId,p,m.start,d.length),this._model.tokenization.setSemanticTokens(null,!0);return}const _=g-(m.start+m.deleteCount);_>0&&(ModelSemanticColoring_1._copy(d,g-_,u,f-_,_),f-=_),m.data&&(ModelSemanticColoring_1._copy(m.data,0,u,f-m.data.length,m.data.length),f-=m.data.length),g=m.start}g>0&&ModelSemanticColoring_1._copy(d,0,u,0,g),t={resultId:t.resultId,data:u}}}if(isSemanticTokens(t)){this._currentDocumentResponse=new SemanticTokensResponse(e,t.resultId,t.data);const c=toMultilineTokens2(t,s,this._model.getLanguageId());if(o.length>0)for(const d of o)for(const u of c)for(const g of d.changes)u.applyEdit(g.range,g.text);this._model.tokenization.setSemanticTokens(c,!0)}else this._model.tokenization.setSemanticTokens(null,!0);l()}},ModelSemanticColoring_1=zt,zt.REQUEST_MIN_DELAY=300,zt.REQUEST_MAX_DELAY=2e3,zt);ModelSemanticColoring=ModelSemanticColoring_1=__decorate$G([__param$F(1,ISemanticTokensStylingService),__param$F(2,IThemeService),__param$F(3,ILanguageFeatureDebounceService),__param$F(4,ILanguageFeaturesService)],ModelSemanticColoring);class SemanticTokensResponse{constructor(e,t,s){this.provider=e,this.resultId=t,this.data=s}dispose(){this.provider.releaseDocumentSemanticTokens(this.resultId)}}registerEditorFeature(DocumentSemanticTokensFeature);var __decorate$F=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$E=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},Wn;let ViewportSemanticTokensContribution=(Wn=class extends Disposable{constructor(e,t,s,o,r,l){super(),this._semanticTokensStylingService=t,this._themeService=s,this._configurationService=o,this._editor=e,this._provider=l.documentRangeSemanticTokensProvider,this._debounceInformation=r.for(this._provider,"DocumentRangeSemanticTokens",{min:100,max:500}),this._tokenizeViewport=this._register(new RunOnceScheduler(()=>this._tokenizeViewportNow(),100)),this._outstandingRequests=[];const c=()=>{this._editor.hasModel()&&this._tokenizeViewport.schedule(this._debounceInformation.get(this._editor.getModel()))};this._register(this._editor.onDidScrollChange(()=>{c()})),this._register(this._editor.onDidChangeModel(()=>{this._cancelAll(),c()})),this._register(this._editor.onDidChangeModelContent(d=>{this._cancelAll(),c()})),this._register(this._provider.onDidChange(()=>{this._cancelAll(),c()})),this._register(this._configurationService.onDidChangeConfiguration(d=>{d.affectsConfiguration(SEMANTIC_HIGHLIGHTING_SETTING_ID)&&(this._cancelAll(),c())})),this._register(this._themeService.onDidColorThemeChange(()=>{this._cancelAll(),c()})),c()}_cancelAll(){for(const e of this._outstandingRequests)e.cancel();this._outstandingRequests=[]}_removeOutstandingRequest(e){for(let t=0,s=this._outstandingRequests.length;t<s;t++)if(this._outstandingRequests[t]===e){this._outstandingRequests.splice(t,1);return}}_tokenizeViewportNow(){if(!this._editor.hasModel())return;const e=this._editor.getModel();if(e.tokenization.hasCompleteSemanticTokens())return;if(!isSemanticColoringEnabled(e,this._themeService,this._configurationService)){e.tokenization.hasSomeSemanticTokens()&&e.tokenization.setSemanticTokens(null,!1);return}if(!hasDocumentRangeSemanticTokensProvider(this._provider,e)){e.tokenization.hasSomeSemanticTokens()&&e.tokenization.setSemanticTokens(null,!1);return}const t=this._editor.getVisibleRangesPlusViewportAboveBelow();this._outstandingRequests=this._outstandingRequests.concat(t.map(s=>this._requestRange(e,s)))}_requestRange(e,t){const s=e.getVersionId(),o=createCancelablePromise(l=>Promise.resolve(getDocumentRangeSemanticTokens(this._provider,e,t,l))),r=new StopWatch(!1);return o.then(l=>{if(this._debounceInformation.update(e,r.elapsed()),!l||!l.tokens||e.isDisposed()||e.getVersionId()!==s)return;const{provider:c,tokens:d}=l,u=this._semanticTokensStylingService.getStyling(c);e.tokenization.setPartialSemanticTokens(t,toMultilineTokens2(d,u,e.getLanguageId()))}).then(()=>this._removeOutstandingRequest(o),()=>this._removeOutstandingRequest(o)),o}},Wn.ID="editor.contrib.viewportSemanticTokens",Wn);ViewportSemanticTokensContribution=__decorate$F([__param$E(1,ISemanticTokensStylingService),__param$E(2,IThemeService),__param$E(3,IConfigurationService),__param$E(4,ILanguageFeatureDebounceService),__param$E(5,ILanguageFeaturesService)],ViewportSemanticTokensContribution);registerEditorContribution(ViewportSemanticTokensContribution.ID,ViewportSemanticTokensContribution,1);class WordSelectionRangeProvider{constructor(e=!0){this.selectSubwords=e}provideSelectionRanges(e,t){const s=[];for(const o of t){const r=[];s.push(r),this.selectSubwords&&this._addInWordRanges(r,e,o),this._addWordRanges(r,e,o),this._addWhitespaceLine(r,e,o),r.push({range:e.getFullModelRange()})}return s}_addInWordRanges(e,t,s){const o=t.getWordAtPosition(s);if(!o)return;const{word:r,startColumn:l}=o,c=s.column-l;let d=c,u=c,g=0;for(;d>=0;d--){const f=r.charCodeAt(d);if(d!==c&&(f===95||f===45))break;if(isLowerAsciiLetter(f)&&isUpperAsciiLetter(g))break;g=f}for(d+=1;u<r.length;u++){const f=r.charCodeAt(u);if(isUpperAsciiLetter(f)&&isLowerAsciiLetter(g))break;if(f===95||f===45)break;g=f}d<u&&e.push({range:new Range$2(s.lineNumber,l+d,s.lineNumber,l+u)})}_addWordRanges(e,t,s){const o=t.getWordAtPosition(s);o&&e.push({range:new Range$2(s.lineNumber,o.startColumn,s.lineNumber,o.endColumn)})}_addWhitespaceLine(e,t,s){t.getLineLength(s.lineNumber)>0&&t.getLineFirstNonWhitespaceColumn(s.lineNumber)===0&&t.getLineLastNonWhitespaceColumn(s.lineNumber)===0&&e.push({range:new Range$2(s.lineNumber,1,s.lineNumber,t.getLineMaxColumn(s.lineNumber))})}}var __decorate$E=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$D=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},SmartSelectController_1;class SelectionRanges{constructor(e,t){this.index=e,this.ranges=t}mov(e){const t=this.index+(e?1:-1);if(t<0||t>=this.ranges.length)return this;const s=new SelectionRanges(t,this.ranges);return s.ranges[t].equalsRange(this.ranges[this.index])?s.mov(e):s}}var en;let SmartSelectController=(en=class{static get(e){return e.getContribution(SmartSelectController_1.ID)}constructor(e,t){this._editor=e,this._languageFeaturesService=t,this._ignoreSelection=!1}dispose(){var e;(e=this._selectionListener)==null||e.dispose()}async run(e){if(!this._editor.hasModel())return;const t=this._editor.getSelections(),s=this._editor.getModel();if(this._state||await provideSelectionRanges(this._languageFeaturesService.selectionRangeProvider,s,t.map(r=>r.getPosition()),this._editor.getOption(129),CancellationToken.None).then(r=>{var l;if(!(!isNonEmptyArray(r)||r.length!==t.length)&&!(!this._editor.hasModel()||!equals$1(this._editor.getSelections(),t,(c,d)=>c.equalsSelection(d)))){for(let c=0;c<r.length;c++)r[c]=r[c].filter(d=>d.containsPosition(t[c].getStartPosition())&&d.containsPosition(t[c].getEndPosition())),r[c].unshift(t[c]);this._state=r.map(c=>new SelectionRanges(0,c)),(l=this._selectionListener)==null||l.dispose(),this._selectionListener=this._editor.onDidChangeCursorPosition(()=>{var c;this._ignoreSelection||((c=this._selectionListener)==null||c.dispose(),this._state=void 0)})}}),!this._state)return;this._state=this._state.map(r=>r.mov(e));const o=this._state.map(r=>Selection$1.fromPositions(r.ranges[r.index].getStartPosition(),r.ranges[r.index].getEndPosition()));this._ignoreSelection=!0;try{this._editor.setSelections(o)}finally{this._ignoreSelection=!1}}},SmartSelectController_1=en,en.ID="editor.contrib.smartSelectController",en);SmartSelectController=SmartSelectController_1=__decorate$E([__param$D(1,ILanguageFeaturesService)],SmartSelectController);class AbstractSmartSelect extends EditorAction{constructor(e,t){super(t),this._forward=e}async run(e,t){const s=SmartSelectController.get(t);s&&await s.run(this._forward)}}class GrowSelectionAction extends AbstractSmartSelect{constructor(){super(!0,{id:"editor.action.smartSelect.expand",label:localize2(1385,"Expand Selection"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1553,mac:{primary:3345,secondary:[1297]},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"1_basic",title:localize(1383,"&&Expand Selection"),order:2}})}}CommandsRegistry.registerCommandAlias("editor.action.smartSelect.grow","editor.action.smartSelect.expand");class ShrinkSelectionAction extends AbstractSmartSelect{constructor(){super(!1,{id:"editor.action.smartSelect.shrink",label:localize2(1386,"Shrink Selection"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1551,mac:{primary:3343,secondary:[1295]},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"1_basic",title:localize(1384,"&&Shrink Selection"),order:3}})}}registerEditorContribution(SmartSelectController.ID,SmartSelectController,4);registerEditorAction(GrowSelectionAction);registerEditorAction(ShrinkSelectionAction);async function provideSelectionRanges(a,e,t,s,o){const r=a.all(e).concat(new WordSelectionRangeProvider(s.selectSubwords));r.length===1&&r.unshift(new BracketSelectionRangeProvider);const l=[],c=[];for(const d of r)l.push(Promise.resolve(d.provideSelectionRanges(e,t,o)).then(u=>{if(isNonEmptyArray(u)&&u.length===t.length)for(let g=0;g<t.length;g++){c[g]||(c[g]=[]);for(const f of u[g])Range$2.isIRange(f.range)&&Range$2.containsPosition(f.range,t[g])&&c[g].push(Range$2.lift(f.range))}},onUnexpectedExternalError));return await Promise.all(l),c.map(d=>{if(d.length===0)return[];d.sort((p,m)=>Position$1.isBefore(p.getStartPosition(),m.getStartPosition())?1:Position$1.isBefore(m.getStartPosition(),p.getStartPosition())||Position$1.isBefore(p.getEndPosition(),m.getEndPosition())?-1:Position$1.isBefore(m.getEndPosition(),p.getEndPosition())?1:0);const u=[];let g;for(const p of d)(!g||Range$2.containsRange(p,g)&&!Range$2.equalsRange(p,g))&&(u.push(p),g=p);if(!s.selectLeadingAndTrailingWhitespace)return u;const f=[u[0]];for(let p=1;p<u.length;p++){const m=u[p-1],_=u[p];if(_.startLineNumber!==m.startLineNumber||_.endLineNumber!==m.endLineNumber){const C=new Range$2(m.startLineNumber,e.getLineFirstNonWhitespaceColumn(m.startLineNumber),m.endLineNumber,e.getLineLastNonWhitespaceColumn(m.endLineNumber));C.containsRange(m)&&!C.equalsRange(m)&&_.containsRange(C)&&!_.equalsRange(C)&&f.push(C);const b=new Range$2(m.startLineNumber,1,m.endLineNumber,e.getLineMaxColumn(m.endLineNumber));b.containsRange(m)&&!b.equalsRange(C)&&_.containsRange(b)&&!_.equalsRange(b)&&f.push(b)}f.push(_)}return f})}CommandsRegistry.registerCommand("_executeSelectionRangeProvider",async function(a,...e){const[t,s]=e;assertType(URI.isUri(t));const o=a.get(ILanguageFeaturesService).selectionRangeProvider,r=await a.get(ITextModelService).createModelReference(t);try{return provideSelectionRanges(o,r.object.textEditorModel,s,{selectLeadingAndTrailingWhitespace:!0,selectSubwords:!0},CancellationToken.None)}finally{r.dispose()}});const Categories=Object.freeze({View:localize2(1623,"View"),Help:localize2(1624,"Help"),Test:localize2(1625,"Test"),File:localize2(1626,"File"),Preferences:localize2(1627,"Preferences"),Developer:localize2(1628,"Developer")});class ToggleStickyScroll extends EditorAction2{constructor(){super({id:"editor.action.toggleStickyScroll",title:{...localize2(1433,"Toggle Editor Sticky Scroll"),mnemonicTitle:localize(1429,"&&Toggle Editor Sticky Scroll")},metadata:{description:localize2(1434,"Toggle/enable the editor sticky scroll which shows the nested scopes at the top of the viewport")},category:Categories.View,toggled:{condition:ContextKeyExpr.equals("config.editor.stickyScroll.enabled",!0),title:localize(1430,"Sticky Scroll"),mnemonicTitle:localize(1431,"&&Sticky Scroll")},menu:[{id:MenuId.CommandPalette},{id:MenuId.MenubarAppearanceMenu,group:"4_editor",order:3},{id:MenuId.StickyScrollContext}]})}async runEditorCommand(e,t){var l;const s=e.get(IConfigurationService),o=!s.getValue("editor.stickyScroll.enabled"),r=(l=StickyScrollController.get(t))==null?void 0:l.isFocused();s.updateValue("editor.stickyScroll.enabled",o),r&&t.focus()}}const weight=100;class FocusStickyScroll extends EditorAction2{constructor(){super({id:"editor.action.focusStickyScroll",title:{...localize2(1435,"Focus Editor Sticky Scroll"),mnemonicTitle:localize(1432,"&&Focus Editor Sticky Scroll")},precondition:ContextKeyExpr.and(ContextKeyExpr.has("config.editor.stickyScroll.enabled"),EditorContextKeys.stickyScrollVisible),menu:[{id:MenuId.CommandPalette}]})}runEditorCommand(e,t){var s;(s=StickyScrollController.get(t))==null||s.focus()}}class SelectNextStickyScrollLine extends EditorAction2{constructor(){super({id:"editor.action.selectNextStickyScrollLine",title:localize2(1436,"Select the next editor sticky scroll line"),precondition:EditorContextKeys.stickyScrollFocused.isEqualTo(!0),keybinding:{weight,primary:18}})}runEditorCommand(e,t){var s;(s=StickyScrollController.get(t))==null||s.focusNext()}}class SelectPreviousStickyScrollLine extends EditorAction2{constructor(){super({id:"editor.action.selectPreviousStickyScrollLine",title:localize2(1437,"Select the previous sticky scroll line"),precondition:EditorContextKeys.stickyScrollFocused.isEqualTo(!0),keybinding:{weight,primary:16}})}runEditorCommand(e,t){var s;(s=StickyScrollController.get(t))==null||s.focusPrevious()}}class GoToStickyScrollLine extends EditorAction2{constructor(){super({id:"editor.action.goToFocusedStickyScrollLine",title:localize2(1438,"Go to the focused sticky scroll line"),precondition:EditorContextKeys.stickyScrollFocused.isEqualTo(!0),keybinding:{weight,primary:3}})}runEditorCommand(e,t){var s;(s=StickyScrollController.get(t))==null||s.goToFocused()}}class SelectEditor extends EditorAction2{constructor(){super({id:"editor.action.selectEditor",title:localize2(1439,"Select Editor"),precondition:EditorContextKeys.stickyScrollFocused.isEqualTo(!0),keybinding:{weight,primary:9}})}runEditorCommand(e,t){var s;(s=StickyScrollController.get(t))==null||s.selectEditor()}}registerEditorContribution(StickyScrollController.ID,StickyScrollController,1);registerAction2(ToggleStickyScroll);registerAction2(FocusStickyScroll);registerAction2(SelectPreviousStickyScrollLine);registerAction2(SelectNextStickyScrollLine);registerAction2(GoToStickyScrollLine);registerAction2(SelectEditor);var __decorate$D=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$C=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class SuggestInlineCompletion{constructor(e,t,s,o,r,l,c){this.range=e,this.insertText=t,this.filterText=s,this.additionalTextEdits=o,this.command=r,this.action=l,this.completion=c}}let InlineCompletionResults=class extends RefCountedDisposable{constructor(e,t,s,o,r,l){super(r.disposable),this.model=e,this.line=t,this.word=s,this.completionModel=o,this._suggestMemoryService=l}canBeReused(e,t,s){return this.model===e&&this.line===t&&this.word.word.length>0&&this.word.startColumn===s.startColumn&&this.word.endColumn<s.endColumn&&this.completionModel.getIncompleteProvider().size===0}get items(){const e=[],{items:t}=this.completionModel,s=this._suggestMemoryService.select(this.model,{lineNumber:this.line,column:this.word.endColumn+this.completionModel.lineContext.characterCountDelta},t),o=Iterable.slice(t,s),r=Iterable.slice(t,0,s);let l=5;for(const c of Iterable.concat(o,r)){if(c.score===FuzzyScore.Default)continue;const d=new Range$2(c.editStart.lineNumber,c.editStart.column,c.editInsertEnd.lineNumber,c.editInsertEnd.column+this.completionModel.lineContext.characterCountDelta),u=c.completion.insertTextRules&&c.completion.insertTextRules&4?{snippet:c.completion.insertText}:c.completion.insertText;e.push(new SuggestInlineCompletion(d,u,c.filterTextLow??c.labelLow,c.completion.additionalTextEdits,c.completion.command,c.completion.action,c)),l-->=0&&c.resolve(CancellationToken.None)}return e}};InlineCompletionResults=__decorate$D([__param$C(5,ISuggestMemoryService)],InlineCompletionResults);let SuggestInlineCompletions=class extends Disposable{constructor(e,t,s,o){super(),this._languageFeatureService=e,this._clipboardService=t,this._suggestMemoryService=s,this._editorService=o,this._store.add(e.inlineCompletionsProvider.register("*",this))}async provideInlineCompletions(e,t,s,o){var m;if(s.selectedSuggestionInfo)return;let r;for(const _ of this._editorService.listCodeEditors())if(_.getModel()===e){r=_;break}if(!r)return;const l=r.getOption(102);if(QuickSuggestionsOptions.isAllOff(l))return;e.tokenization.tokenizeIfCheap(t.lineNumber);const c=e.tokenization.getLineTokens(t.lineNumber),d=c.getStandardTokenType(c.findTokenIndexAtOffset(Math.max(t.column-1-1,0)));if(QuickSuggestionsOptions.valueFor(l,d)!=="inline")return;let u=e.getWordAtPosition(t),g;if(u!=null&&u.word||(g=this._getTriggerCharacterInfo(e,t)),!(u!=null&&u.word)&&!g||(u||(u=e.getWordUntilPosition(t)),u.endColumn!==t.column))return;let f;const p=e.getValueInRange(new Range$2(t.lineNumber,1,t.lineNumber,t.column));if(!g&&((m=this._lastResult)!=null&&m.canBeReused(e,t.lineNumber,u))){const _=new LineContext$1(p,t.column-this._lastResult.word.endColumn);this._lastResult.completionModel.lineContext=_,this._lastResult.acquire(),f=this._lastResult}else{const _=await provideSuggestionItems(this._languageFeatureService.completionProvider,e,t,new CompletionOptions(void 0,SuggestModel.createSuggestFilter(r).itemKind,g==null?void 0:g.providers),g&&{triggerKind:1,triggerCharacter:g.ch},o);let C;_.needsClipboard&&(C=await this._clipboardService.readText());const b=new CompletionModel(_.items,t.column,new LineContext$1(p,0),WordDistance.None,r.getOption(134),r.getOption(128),{boostFullMatch:!1,firstMatchCanBeWeak:!1},C);f=new InlineCompletionResults(e,t.lineNumber,u,b,_,this._suggestMemoryService)}return this._lastResult=f,f}handleItemDidShow(e,t){t.completion.resolve(CancellationToken.None)}disposeInlineCompletions(e){e.release()}_getTriggerCharacterInfo(e,t){var r;const s=e.getValueInRange(Range$2.fromPositions({lineNumber:t.lineNumber,column:t.column-1},t)),o=new Set;for(const l of this._languageFeatureService.completionProvider.all(e))(r=l.triggerCharacters)!=null&&r.includes(s)&&o.add(l);if(o.size!==0)return{providers:o,ch:s}}};SuggestInlineCompletions=__decorate$D([__param$C(0,ILanguageFeaturesService),__param$C(1,IClipboardService),__param$C(2,ISuggestMemoryService),__param$C(3,ICodeEditorService)],SuggestInlineCompletions);registerEditorFeature(SuggestInlineCompletions);class ForceRetokenizeAction extends EditorAction{constructor(){super({id:"editor.action.forceRetokenize",label:localize2(1517,"Developer: Force Retokenize"),precondition:void 0})}run(e,t){if(!t.hasModel())return;const s=t.getModel();s.tokenization.resetTokenization();const o=new StopWatch;s.tokenization.forceTokenization(s.getLineCount()),o.stop(),console.log(`tokenization took ${o.elapsed()}`)}}registerEditorAction(ForceRetokenizeAction);const ho=class ho extends Action2{constructor(){super({id:ho.ID,title:localize2(1515,"Toggle Tab Key Moves Focus"),precondition:void 0,keybinding:{primary:2091,mac:{primary:1323},weight:100},metadata:{description:localize2(1516,"Determines whether the tab key moves focus around the workbench or inserts the tab character in the current editor. This is also called tab trapping, tab navigation, or tab focus mode.")},f1:!0})}run(){const t=!TabFocus.getTabFocusMode();TabFocus.setTabFocusMode(t),alert$1(t?localize(1513,"Pressing Tab will now move focus to the next focusable element"):localize(1514,"Pressing Tab will now insert the tab character"))}};ho.ID="editor.action.toggleTabFocusMode";let ToggleTabFocusModeAction=ho;registerAction2(ToggleTabFocusModeAction);const unicodeHighlighter="";class UnicodeTextModelHighlighter{static computeUnicodeHighlights(e,t,s){const o=s?s.startLineNumber:1,r=s?s.endLineNumber:e.getLineCount(),l=new CodePointHighlighter(t),c=l.getCandidateCodePoints();let d;c==="allNonBasicAscii"?d=new RegExp("[^\\t\\n\\r\\x20-\\x7E]","g"):d=new RegExp(`${buildRegExpCharClassExpr(Array.from(c))}`,"g");const u=new Searcher(null,d),g=[];let f=!1,p,m=0,_=0,C=0;e:for(let b=o,v=r;b<=v;b++){const S=e.getLineContent(b),y=S.length;u.reset(0);do if(p=u.next(S),p){let w=p.index,L=p.index+p[0].length;if(w>0){const D=S.charCodeAt(w-1);isHighSurrogate(D)&&w--}if(L+1<y){const D=S.charCodeAt(L-1);isHighSurrogate(D)&&L++}const x=S.substring(w,L);let E=getWordAtText(w+1,DEFAULT_WORD_REGEXP,S,0);E&&E.endColumn<=w+1&&(E=null);const I=l.shouldHighlightNonBasicASCII(x,E?E.word:null);if(I!==0){I===3?m++:I===2?_++:I===1?C++:assertNever();const D=1e3;if(g.length>=D){f=!0;break e}g.push(new Range$2(b,w+1,b,L+1))}}while(p)}return{ranges:g,hasMore:f,ambiguousCharacterCount:m,invisibleCharacterCount:_,nonBasicAsciiCharacterCount:C}}static computeUnicodeHighlightReason(e,t){const s=new CodePointHighlighter(t);switch(s.shouldHighlightNonBasicASCII(e,null)){case 0:return null;case 2:return{kind:1};case 3:{const r=e.codePointAt(0),l=s.ambiguousCharacters.getPrimaryConfusable(r),c=AmbiguousCharacters.getLocales().filter(d=>!AmbiguousCharacters.getInstance(new Set([...t.allowedLocales,d])).isAmbiguous(r));return{kind:0,confusableWith:String.fromCodePoint(l),notAmbiguousInLocales:c}}case 1:return{kind:2}}}}function buildRegExpCharClassExpr(a,e){return`[${escapeRegExpCharacters(a.map(s=>String.fromCodePoint(s)).join(""))}]`}class CodePointHighlighter{constructor(e){this.options=e,this.allowedCodePoints=new Set(e.allowedCodePoints),this.ambiguousCharacters=AmbiguousCharacters.getInstance(new Set(e.allowedLocales))}getCandidateCodePoints(){if(this.options.nonBasicASCII)return"allNonBasicAscii";const e=new Set;if(this.options.invisibleCharacters)for(const t of InvisibleCharacters.codePoints)isAllowedInvisibleCharacter(String.fromCodePoint(t))||e.add(t);if(this.options.ambiguousCharacters)for(const t of this.ambiguousCharacters.getConfusableCodePoints())e.add(t);for(const t of this.allowedCodePoints)e.delete(t);return e}shouldHighlightNonBasicASCII(e,t){const s=e.codePointAt(0);if(this.allowedCodePoints.has(s))return 0;if(this.options.nonBasicASCII)return 1;let o=!1,r=!1;if(t)for(const l of t){const c=l.codePointAt(0),d=isBasicASCII(l);o=o||d,!d&&!this.ambiguousCharacters.isAmbiguous(c)&&!InvisibleCharacters.isInvisibleCharacter(c)&&(r=!0)}return!o&&r?0:this.options.invisibleCharacters&&!isAllowedInvisibleCharacter(e)&&InvisibleCharacters.isInvisibleCharacter(s)?2:this.options.ambiguousCharacters&&this.ambiguousCharacters.isAmbiguous(s)?3:0}}function isAllowedInvisibleCharacter(a){return a===" "||a===`
`||a==="	"}const bannerController="",link="";var __decorate$C=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$B=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let Link=class extends Disposable{get enabled(){return this._enabled}set enabled(e){e?(this.el.setAttribute("aria-disabled","false"),this.el.tabIndex=0,this.el.style.pointerEvents="auto",this.el.style.opacity="1",this.el.style.cursor="pointer",this._enabled=!1):(this.el.setAttribute("aria-disabled","true"),this.el.tabIndex=-1,this.el.style.pointerEvents="none",this.el.style.opacity="0.4",this.el.style.cursor="default",this._enabled=!0),this._enabled=e}constructor(e,t,s={},o,r){super(),this._link=t,this._hoverService=o,this._enabled=!0,this.el=append$2(e,$$l("a.monaco-link",{tabIndex:t.tabIndex??0,href:t.href},t.label)),this.hoverDelegate=s.hoverDelegate??getDefaultHoverDelegate("mouse"),this.setTooltip(t.title),this.el.setAttribute("role","button");const l=this._register(new DomEmitter(this.el,"click")),c=this._register(new DomEmitter(this.el,"keypress")),d=Event$1.chain(c.event,f=>f.map(p=>new StandardKeyboardEvent(p)).filter(p=>p.keyCode===3)),u=this._register(new DomEmitter(this.el,EventType.Tap)).event;this._register(Gesture.addTarget(this.el));const g=Event$1.any(l.event,d,u);this._register(g(f=>{this.enabled&&(EventHelper.stop(f,!0),s!=null&&s.opener?s.opener(this._link.href):r.open(this._link.href,{allowCommands:!0}))})),this.enabled=!0}setTooltip(e){!this.hover&&e?this.hover=this._register(this._hoverService.setupManagedHover(this.hoverDelegate,this.el,e)):this.hover&&this.hover.update(e)}};Link=__decorate$C([__param$B(3,IHoverService),__param$B(4,IOpenerService)],Link);var __decorate$B=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$A=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const BANNER_ELEMENT_HEIGHT=26;let BannerController=class extends Disposable{constructor(e,t){super(),this._editor=e,this.instantiationService=t,this.banner=this._register(this.instantiationService.createInstance(Banner))}hide(){this._editor.setBanner(null,0),this.banner.clear()}show(e){this.banner.show({...e,onClose:()=>{var t;this.hide(),(t=e.onClose)==null||t.call(e)}}),this._editor.setBanner(this.banner.element,BANNER_ELEMENT_HEIGHT)}};BannerController=__decorate$B([__param$A(1,IInstantiationService)],BannerController);let Banner=class extends Disposable{constructor(e){super(),this.instantiationService=e,this.markdownRenderer=this.instantiationService.createInstance(MarkdownRenderer,{}),this.element=$$l("div.editor-banner"),this.element.tabIndex=0}getAriaLabel(e){if(e.ariaLabel)return e.ariaLabel;if(typeof e.message=="string")return e.message}getBannerMessage(e){if(typeof e=="string"){const t=$$l("span");return t.innerText=e,t}return this.markdownRenderer.render(e).element}clear(){clearNode(this.element)}show(e){clearNode(this.element);const t=this.getAriaLabel(e);t&&this.element.setAttribute("aria-label",t);const s=append$2(this.element,$$l("div.icon-container"));s.setAttribute("aria-hidden","true"),e.icon&&s.appendChild($$l(`div${ThemeIcon.asCSSSelector(e.icon)}`));const o=append$2(this.element,$$l("div.message-container"));if(o.setAttribute("aria-hidden","true"),o.appendChild(this.getBannerMessage(e.message)),this.messageActionsContainer=append$2(this.element,$$l("div.message-actions-container")),e.actions)for(const l of e.actions)this._register(this.instantiationService.createInstance(Link,this.messageActionsContainer,{...l,tabIndex:-1},{}));const r=append$2(this.element,$$l("div.action-container"));this.actionBar=this._register(new ActionBar(r)),this.actionBar.push(this._register(new Action("banner.close",localize(1518,"Close Banner"),ThemeIcon.asClassName(widgetClose),!0,()=>{typeof e.onClose=="function"&&e.onClose()})),{icon:!0,label:!1}),this.actionBar.setFocusable(!1)}};Banner=__decorate$B([__param$A(0,IInstantiationService)],Banner);const IWorkspaceTrustManagementService=createDecorator("workspaceTrustManagementService");var __decorate$A=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$z=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const warningIcon=registerIcon("extensions-warning-message",Codicon.warning,localize(1519,"Icon shown with a warning message in the extensions editor."));var Bn;let UnicodeHighlighter=(Bn=class extends Disposable{constructor(e,t,s,o){super(),this._editor=e,this._editorWorkerService=t,this._workspaceTrustService=s,this._highlighter=null,this._bannerClosed=!1,this._updateState=r=>{if(r&&r.hasMore){if(this._bannerClosed)return;const l=Math.max(r.ambiguousCharacterCount,r.nonBasicAsciiCharacterCount,r.invisibleCharacterCount);let c;if(r.nonBasicAsciiCharacterCount>=l)c={message:localize(1520,"This document contains many non-basic ASCII unicode characters"),command:new DisableHighlightingOfNonBasicAsciiCharactersAction};else if(r.ambiguousCharacterCount>=l)c={message:localize(1521,"This document contains many ambiguous unicode characters"),command:new DisableHighlightingOfAmbiguousCharactersAction};else if(r.invisibleCharacterCount>=l)c={message:localize(1522,"This document contains many invisible unicode characters"),command:new DisableHighlightingOfInvisibleCharactersAction};else throw new Error("Unreachable");this._bannerController.show({id:"unicodeHighlightBanner",message:c.message,icon:warningIcon,actions:[{label:c.command.shortLabel,href:`command:${c.command.desc.id}`}],onClose:()=>{this._bannerClosed=!0}})}else this._bannerController.hide()},this._bannerController=this._register(o.createInstance(BannerController,e)),this._register(this._editor.onDidChangeModel(()=>{this._bannerClosed=!1,this._updateHighlighter()})),this._options=e.getOption(142),this._register(s.onDidChangeTrust(r=>{this._updateHighlighter()})),this._register(e.onDidChangeConfiguration(r=>{r.hasChanged(142)&&(this._options=e.getOption(142),this._updateHighlighter())})),this._updateHighlighter()}dispose(){this._highlighter&&(this._highlighter.dispose(),this._highlighter=null),super.dispose()}_updateHighlighter(){if(this._updateState(null),this._highlighter&&(this._highlighter.dispose(),this._highlighter=null),!this._editor.hasModel())return;const e=resolveOptions(this._workspaceTrustService.isWorkspaceTrusted(),this._options);if([e.nonBasicASCII,e.ambiguousCharacters,e.invisibleCharacters].every(s=>s===!1))return;const t={nonBasicASCII:e.nonBasicASCII,ambiguousCharacters:e.ambiguousCharacters,invisibleCharacters:e.invisibleCharacters,includeComments:e.includeComments,includeStrings:e.includeStrings,allowedCodePoints:Object.keys(e.allowedCharacters).map(s=>s.codePointAt(0)),allowedLocales:Object.keys(e.allowedLocales).map(s=>s==="_os"?safeIntl.NumberFormat().value.resolvedOptions().locale:s==="_vscode"?language:s)};this._editorWorkerService.canComputeUnicodeHighlights(this._editor.getModel().uri)?this._highlighter=new DocumentUnicodeHighlighter(this._editor,t,this._updateState,this._editorWorkerService):this._highlighter=new ViewportUnicodeHighlighter(this._editor,t,this._updateState)}getDecorationInfo(e){return this._highlighter?this._highlighter.getDecorationInfo(e):null}},Bn.ID="editor.contrib.unicodeHighlighter",Bn);UnicodeHighlighter=__decorate$A([__param$z(1,IEditorWorkerService),__param$z(2,IWorkspaceTrustManagementService),__param$z(3,IInstantiationService)],UnicodeHighlighter);function resolveOptions(a,e){return{nonBasicASCII:e.nonBasicASCII===inUntrustedWorkspace?!a:e.nonBasicASCII,ambiguousCharacters:e.ambiguousCharacters,invisibleCharacters:e.invisibleCharacters,includeComments:e.includeComments===inUntrustedWorkspace?!a:e.includeComments,includeStrings:e.includeStrings===inUntrustedWorkspace?!a:e.includeStrings,allowedCharacters:e.allowedCharacters,allowedLocales:e.allowedLocales}}let DocumentUnicodeHighlighter=class extends Disposable{constructor(e,t,s,o){super(),this._editor=e,this._options=t,this._updateState=s,this._editorWorkerService=o,this._model=this._editor.getModel(),this._decorations=this._editor.createDecorationsCollection(),this._updateSoon=this._register(new RunOnceScheduler(()=>this._update(),250)),this._register(this._editor.onDidChangeModelContent(()=>{this._updateSoon.schedule()})),this._updateSoon.schedule()}dispose(){this._decorations.clear(),super.dispose()}_update(){if(this._model.isDisposed())return;if(!this._model.mightContainNonBasicASCII()){this._decorations.clear();return}const e=this._model.getVersionId();this._editorWorkerService.computedUnicodeHighlights(this._model.uri,this._options).then(t=>{if(this._model.isDisposed()||this._model.getVersionId()!==e)return;this._updateState(t);const s=[];if(!t.hasMore)for(const o of t.ranges)s.push({range:o,options:Decorations.instance.getDecorationFromOptions(this._options)});this._decorations.set(s)})}getDecorationInfo(e){if(!this._decorations.has(e))return null;const t=this._editor.getModel();if(!isModelDecorationVisible(t,e))return null;const s=t.getValueInRange(e.range);return{reason:computeReason(s,this._options),inComment:isModelDecorationInComment(t,e),inString:isModelDecorationInString(t,e)}}};DocumentUnicodeHighlighter=__decorate$A([__param$z(3,IEditorWorkerService)],DocumentUnicodeHighlighter);class ViewportUnicodeHighlighter extends Disposable{constructor(e,t,s){super(),this._editor=e,this._options=t,this._updateState=s,this._model=this._editor.getModel(),this._decorations=this._editor.createDecorationsCollection(),this._updateSoon=this._register(new RunOnceScheduler(()=>this._update(),250)),this._register(this._editor.onDidLayoutChange(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidScrollChange(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidChangeHiddenAreas(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidChangeModelContent(()=>{this._updateSoon.schedule()})),this._updateSoon.schedule()}dispose(){this._decorations.clear(),super.dispose()}_update(){if(this._model.isDisposed())return;if(!this._model.mightContainNonBasicASCII()){this._decorations.clear();return}const e=this._editor.getVisibleRanges(),t=[],s={ranges:[],ambiguousCharacterCount:0,invisibleCharacterCount:0,nonBasicAsciiCharacterCount:0,hasMore:!1};for(const o of e){const r=UnicodeTextModelHighlighter.computeUnicodeHighlights(this._model,this._options,o);for(const l of r.ranges)s.ranges.push(l);s.ambiguousCharacterCount+=s.ambiguousCharacterCount,s.invisibleCharacterCount+=s.invisibleCharacterCount,s.nonBasicAsciiCharacterCount+=s.nonBasicAsciiCharacterCount,s.hasMore=s.hasMore||r.hasMore}if(!s.hasMore)for(const o of s.ranges)t.push({range:o,options:Decorations.instance.getDecorationFromOptions(this._options)});this._updateState(s),this._decorations.set(t)}getDecorationInfo(e){if(!this._decorations.has(e))return null;const t=this._editor.getModel(),s=t.getValueInRange(e.range);return isModelDecorationVisible(t,e)?{reason:computeReason(s,this._options),inComment:isModelDecorationInComment(t,e),inString:isModelDecorationInString(t,e)}:null}}const configureUnicodeHighlightOptionsStr=localize(1523,"Configure Unicode Highlight Options");let UnicodeHighlighterHoverParticipant=class{constructor(e,t,s){this._editor=e,this._languageService=t,this._openerService=s,this.hoverOrdinal=5}computeSync(e,t){if(!this._editor.hasModel()||e.type!==1)return[];const s=this._editor.getModel(),o=this._editor.getContribution(UnicodeHighlighter.ID);if(!o)return[];const r=[],l=new Set;let c=300;for(const d of t){const u=o.getDecorationInfo(d);if(!u)continue;const f=s.getValueInRange(d.range).codePointAt(0),p=formatCodePointMarkdown(f);let m;switch(u.reason.kind){case 0:{isBasicASCII(u.reason.confusableWith)?m=localize(1524,"The character {0} could be confused with the ASCII character {1}, which is more common in source code.",p,formatCodePointMarkdown(u.reason.confusableWith.codePointAt(0))):m=localize(1525,"The character {0} could be confused with the character {1}, which is more common in source code.",p,formatCodePointMarkdown(u.reason.confusableWith.codePointAt(0)));break}case 1:m=localize(1526,"The character {0} is invisible.",p);break;case 2:m=localize(1527,"The character {0} is not a basic ASCII character.",p);break}if(l.has(m))continue;l.add(m);const _={codePoint:f,reason:u.reason,inComment:u.inComment,inString:u.inString},C=localize(1528,"Adjust settings"),b=createCommandUri(ShowExcludeOptions.ID,_),v=new MarkdownString("",!0).appendMarkdown(m).appendText(" ").appendLink(b,C,configureUnicodeHighlightOptionsStr);r.push(new MarkdownHover(this,d.range,[v],!1,c++))}return r}renderHoverParts(e,t){return renderMarkdownHovers(e,t,this._editor,this._languageService,this._openerService)}};UnicodeHighlighterHoverParticipant=__decorate$A([__param$z(1,ILanguageService),__param$z(2,IOpenerService)],UnicodeHighlighterHoverParticipant);function codePointToHex(a){return`U+${a.toString(16).padStart(4,"0")}`}function formatCodePointMarkdown(a){let e=`\`${codePointToHex(a)}\``;return InvisibleCharacters.isInvisibleCharacter(a)||(e+=` "${`${renderCodePointAsInlineCode(a)}`}"`),e}function renderCodePointAsInlineCode(a){return a===96?"`` ` ``":"`"+String.fromCodePoint(a)+"`"}function computeReason(a,e){return UnicodeTextModelHighlighter.computeUnicodeHighlightReason(a,e)}const uo=class uo{constructor(){this.map=new Map}getDecorationFromOptions(e){return this.getDecoration(!e.includeComments,!e.includeStrings)}getDecoration(e,t){const s=`${e}${t}`;let o=this.map.get(s);return o||(o=ModelDecorationOptions.createDynamic({description:"unicode-highlight",stickiness:1,className:"unicode-highlight",showIfCollapsed:!0,overviewRuler:null,minimap:null,hideInCommentTokens:e,hideInStringTokens:t}),this.map.set(s,o)),o}};uo.instance=new uo;let Decorations=uo;class DisableHighlightingInCommentsAction extends EditorAction{constructor(){super({id:DisableHighlightingOfAmbiguousCharactersAction.ID,label:localize2(1537,"Disable highlighting of characters in comments"),precondition:void 0}),this.shortLabel=localize(1529,"Disable Highlight In Comments")}async run(e,t,s){const o=e.get(IConfigurationService);o&&this.runAction(o)}async runAction(e){await e.updateValue(unicodeHighlightConfigKeys.includeComments,!1,2)}}class DisableHighlightingInStringsAction extends EditorAction{constructor(){super({id:DisableHighlightingOfAmbiguousCharactersAction.ID,label:localize2(1538,"Disable highlighting of characters in strings"),precondition:void 0}),this.shortLabel=localize(1530,"Disable Highlight In Strings")}async run(e,t,s){const o=e.get(IConfigurationService);o&&this.runAction(o)}async runAction(e){await e.updateValue(unicodeHighlightConfigKeys.includeStrings,!1,2)}}const go=class go extends Action2{constructor(){super({id:go.ID,title:localize2(1539,"Disable highlighting of ambiguous characters"),precondition:void 0,f1:!1}),this.shortLabel=localize(1531,"Disable Ambiguous Highlight")}async run(e,t,s){const o=e.get(IConfigurationService);o&&this.runAction(o)}async runAction(e){await e.updateValue(unicodeHighlightConfigKeys.ambiguousCharacters,!1,2)}};go.ID="editor.action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters";let DisableHighlightingOfAmbiguousCharactersAction=go;const fo=class fo extends Action2{constructor(){super({id:fo.ID,title:localize2(1540,"Disable highlighting of invisible characters"),precondition:void 0,f1:!1}),this.shortLabel=localize(1532,"Disable Invisible Highlight")}async run(e,t,s){const o=e.get(IConfigurationService);o&&this.runAction(o)}async runAction(e){await e.updateValue(unicodeHighlightConfigKeys.invisibleCharacters,!1,2)}};fo.ID="editor.action.unicodeHighlight.disableHighlightingOfInvisibleCharacters";let DisableHighlightingOfInvisibleCharactersAction=fo;const po=class po extends Action2{constructor(){super({id:po.ID,title:localize2(1541,"Disable highlighting of non basic ASCII characters"),precondition:void 0,f1:!1}),this.shortLabel=localize(1533,"Disable Non ASCII Highlight")}async run(e,t,s){const o=e.get(IConfigurationService);o&&this.runAction(o)}async runAction(e){await e.updateValue(unicodeHighlightConfigKeys.nonBasicASCII,!1,2)}};po.ID="editor.action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters";let DisableHighlightingOfNonBasicAsciiCharactersAction=po;const mo=class mo extends Action2{constructor(){super({id:mo.ID,title:localize2(1542,"Show Exclude Options"),precondition:void 0,f1:!1})}async run(e,t){const{codePoint:s,reason:o,inString:r,inComment:l}=t,c=String.fromCodePoint(s),d=e.get(IQuickInputService),u=e.get(IConfigurationService);function g(_){return InvisibleCharacters.isInvisibleCharacter(_)?localize(1534,"Exclude {0} (invisible character) from being highlighted",codePointToHex(_)):localize(1535,"Exclude {0} from being highlighted",`${codePointToHex(_)} "${c}"`)}const f=[];if(o.kind===0)for(const _ of o.notAmbiguousInLocales)f.push({label:localize(1536,'Allow unicode characters that are more common in the language "{0}".',_),run:async()=>{excludeLocaleFromBeingHighlighted(u,[_])}});if(f.push({label:g(s),run:()=>excludeCharFromBeingHighlighted(u,[s])}),l){const _=new DisableHighlightingInCommentsAction;f.push({label:_.label,run:async()=>_.runAction(u)})}else if(r){const _=new DisableHighlightingInStringsAction;f.push({label:_.label,run:async()=>_.runAction(u)})}function p(_){return typeof _.desc.title=="string"?_.desc.title:_.desc.title.value}if(o.kind===0){const _=new DisableHighlightingOfAmbiguousCharactersAction;f.push({label:p(_),run:async()=>_.runAction(u)})}else if(o.kind===1){const _=new DisableHighlightingOfInvisibleCharactersAction;f.push({label:p(_),run:async()=>_.runAction(u)})}else if(o.kind===2){const _=new DisableHighlightingOfNonBasicAsciiCharactersAction;f.push({label:p(_),run:async()=>_.runAction(u)})}else expectNever(o);const m=await d.pick(f,{title:configureUnicodeHighlightOptionsStr});m&&await m.run()}};mo.ID="editor.action.unicodeHighlight.showExcludeOptions";let ShowExcludeOptions=mo;async function excludeCharFromBeingHighlighted(a,e){const t=a.getValue(unicodeHighlightConfigKeys.allowedCharacters);let s;typeof t=="object"&&t?s=t:s={};for(const o of e)s[String.fromCodePoint(o)]=!0;await a.updateValue(unicodeHighlightConfigKeys.allowedCharacters,s,2)}async function excludeLocaleFromBeingHighlighted(a,e){var o;const t=(o=a.inspect(unicodeHighlightConfigKeys.allowedLocales).user)==null?void 0:o.value;let s;typeof t=="object"&&t?s=Object.assign({},t):s={};for(const r of e)s[r]=!0;await a.updateValue(unicodeHighlightConfigKeys.allowedLocales,s,2)}function expectNever(a){throw new Error(`Unexpected value: ${a}`)}registerAction2(DisableHighlightingOfAmbiguousCharactersAction);registerAction2(DisableHighlightingOfInvisibleCharactersAction);registerAction2(DisableHighlightingOfNonBasicAsciiCharactersAction);registerAction2(ShowExcludeOptions);registerEditorContribution(UnicodeHighlighter.ID,UnicodeHighlighter,1);HoverParticipantRegistry.register(UnicodeHighlighterHoverParticipant);const IDialogService=createDecorator("dialogService");var __decorate$z=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$y=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const ignoreUnusualLineTerminators="ignoreUnusualLineTerminators";function writeIgnoreState(a,e,t){a.setModelProperty(e.uri,ignoreUnusualLineTerminators,t)}function readIgnoreState(a,e){return a.getModelProperty(e.uri,ignoreUnusualLineTerminators)}var Hn;let UnusualLineTerminatorsDetector=(Hn=class extends Disposable{constructor(e,t,s){super(),this._editor=e,this._dialogService=t,this._codeEditorService=s,this._isPresentingDialog=!1,this._config=this._editor.getOption(143),this._register(this._editor.onDidChangeConfiguration(o=>{o.hasChanged(143)&&(this._config=this._editor.getOption(143),this._checkForUnusualLineTerminators())})),this._register(this._editor.onDidChangeModel(()=>{this._checkForUnusualLineTerminators()})),this._register(this._editor.onDidChangeModelContent(o=>{o.isUndoing||this._checkForUnusualLineTerminators()})),this._checkForUnusualLineTerminators()}async _checkForUnusualLineTerminators(){if(this._config==="off"||!this._editor.hasModel())return;const e=this._editor.getModel();if(!e.mightContainUnusualLineTerminators()||readIgnoreState(this._codeEditorService,e)===!0||this._editor.getOption(104))return;if(this._config==="auto"){e.removeUnusualLineTerminators(this._editor.getSelections());return}if(this._isPresentingDialog)return;let s;try{this._isPresentingDialog=!0,s=await this._dialogService.confirm({title:localize(1543,"Unusual Line Terminators"),message:localize(1544,"Detected unusual line terminators"),detail:localize(1545,"The file '{0}' contains one or more unusual line terminator characters, like Line Separator (LS) or Paragraph Separator (PS).\n\nIt is recommended to remove them from the file. This can be configured via `editor.unusualLineTerminators`.",basename(e.uri)),primaryButton:localize(1546,"&&Remove Unusual Line Terminators"),cancelButton:localize(1547,"Ignore")})}finally{this._isPresentingDialog=!1}if(!s.confirmed){writeIgnoreState(this._codeEditorService,e,!0);return}e.removeUnusualLineTerminators(this._editor.getSelections())}},Hn.ID="editor.contrib.unusualLineTerminatorsDetector",Hn);UnusualLineTerminatorsDetector=__decorate$z([__param$y(1,IDialogService),__param$y(2,ICodeEditorService)],UnusualLineTerminatorsDetector);registerEditorContribution(UnusualLineTerminatorsDetector.ID,UnusualLineTerminatorsDetector,1);const GLOBSTAR="**",GLOB_SPLIT="/",PATH_REGEX="[/\\\\]",NO_PATH_REGEX="[^/\\\\]",ALL_FORWARD_SLASHES=/\//g;function starsToRegExp(a,e){switch(a){case 0:return"";case 1:return`${NO_PATH_REGEX}*?`;default:return`(?:${PATH_REGEX}|${NO_PATH_REGEX}+${PATH_REGEX}${e?`|${PATH_REGEX}${NO_PATH_REGEX}+`:""})*?`}}function splitGlobAware(a,e){if(!a)return[];const t=[];let s=!1,o=!1,r="";for(const l of a){switch(l){case e:if(!s&&!o){t.push(r),r="";continue}break;case"{":s=!0;break;case"}":s=!1;break;case"[":o=!0;break;case"]":o=!1;break}r+=l}return r&&t.push(r),t}function parseRegExp(a){if(!a)return"";let e="";const t=splitGlobAware(a,GLOB_SPLIT);if(t.every(s=>s===GLOBSTAR))e=".*";else{let s=!1;t.forEach((o,r)=>{if(o===GLOBSTAR){if(s)return;e+=starsToRegExp(2,r===t.length-1)}else{let l=!1,c="",d=!1,u="";for(const g of o){if(g!=="}"&&l){c+=g;continue}if(d&&(g!=="]"||!u)){let f;g==="-"?f=g:(g==="^"||g==="!")&&!u?f="^":g===GLOB_SPLIT?f="":f=escapeRegExpCharacters(g),u+=f;continue}switch(g){case"{":l=!0;continue;case"[":d=!0;continue;case"}":{const p=`(?:${splitGlobAware(c,",").map(m=>parseRegExp(m)).join("|")})`;e+=p,l=!1,c="";break}case"]":{e+="["+u+"]",d=!1,u="";break}case"?":e+=NO_PATH_REGEX;continue;case"*":e+=starsToRegExp(1);continue;default:e+=escapeRegExpCharacters(g)}}r<t.length-1&&(t[r+1]!==GLOBSTAR||r+2<t.length)&&(e+=PATH_REGEX)}s=o===GLOBSTAR})}return e}const T1=/^\*\*\/\*\.[\w\.-]+$/,T2=/^\*\*\/([\w\.-]+)\/?$/,T3=/^{\*\*\/\*?[\w\.-]+\/?(,\*\*\/\*?[\w\.-]+\/?)*}$/,T3_2=/^{\*\*\/\*?[\w\.-]+(\/(\*\*)?)?(,\*\*\/\*?[\w\.-]+(\/(\*\*)?)?)*}$/,T4=/^\*\*((\/[\w\.-]+)+)\/?$/,T5=/^([\w\.-]+(\/[\w\.-]+)*)\/?$/,CACHE=new LRUCache(1e4),FALSE=function(){return!1},NULL=function(){return null};function parsePattern(a,e){if(!a)return NULL;let t;typeof a!="string"?t=a.pattern:t=a,t=t.trim();const s=`${t}_${!!e.trimForExclusions}`;let o=CACHE.get(s);if(o)return wrapRelativePattern(o,a);let r;return T1.test(t)?o=trivia1(t.substr(4),t):(r=T2.exec(trimForExclusions(t,e)))?o=trivia2(r[1],t):(e.trimForExclusions?T3_2:T3).test(t)?o=trivia3(t,e):(r=T4.exec(trimForExclusions(t,e)))?o=trivia4and5(r[1].substr(1),t,!0):(r=T5.exec(trimForExclusions(t,e)))?o=trivia4and5(r[1],t,!1):o=toRegExp(t),CACHE.set(s,o),wrapRelativePattern(o,a)}function wrapRelativePattern(a,e){if(typeof e=="string")return a;const t=function(s,o){return isEqualOrParent(s,e.base,!isLinux)?a(ltrim(s.substr(e.base.length),sep),o):null};return t.allBasenames=a.allBasenames,t.allPaths=a.allPaths,t.basenames=a.basenames,t.patterns=a.patterns,t}function trimForExclusions(a,e){return e.trimForExclusions&&a.endsWith("/**")?a.substr(0,a.length-2):a}function trivia1(a,e){return function(t,s){return typeof t=="string"&&t.endsWith(a)?e:null}}function trivia2(a,e){const t=`/${a}`,s=`\\${a}`,o=function(l,c){return typeof l!="string"?null:c?c===a?e:null:l===a||l.endsWith(t)||l.endsWith(s)?e:null},r=[a];return o.basenames=r,o.patterns=[e],o.allBasenames=r,o}function trivia3(a,e){const t=aggregateBasenameMatches(a.slice(1,-1).split(",").map(c=>parsePattern(c,e)).filter(c=>c!==NULL),a),s=t.length;if(!s)return NULL;if(s===1)return t[0];const o=function(c,d){for(let u=0,g=t.length;u<g;u++)if(t[u](c,d))return a;return null},r=t.find(c=>!!c.allBasenames);r&&(o.allBasenames=r.allBasenames);const l=t.reduce((c,d)=>d.allPaths?c.concat(d.allPaths):c,[]);return l.length&&(o.allPaths=l),o}function trivia4and5(a,e,t){const s=sep===posix.sep,o=s?a:a.replace(ALL_FORWARD_SLASHES,sep),r=sep+o,l=posix.sep+a;let c;return t?c=function(d,u){return typeof d=="string"&&(d===o||d.endsWith(r)||!s&&(d===a||d.endsWith(l)))?e:null}:c=function(d,u){return typeof d=="string"&&(d===o||!s&&d===a)?e:null},c.allPaths=[(t?"*/":"./")+a],c}function toRegExp(a){try{const e=new RegExp(`^${parseRegExp(a)}$`);return function(t){return e.lastIndex=0,typeof t=="string"&&e.test(t)?a:null}}catch{return NULL}}function match(a,e,t){return!a||typeof e!="string"?!1:parse(a)(e,void 0,t)}function parse(a,e={}){if(!a)return FALSE;if(typeof a=="string"||isRelativePattern(a)){const t=parsePattern(a,e);if(t===NULL)return FALSE;const s=function(o,r){return!!t(o,r)};return t.allBasenames&&(s.allBasenames=t.allBasenames),t.allPaths&&(s.allPaths=t.allPaths),s}return parsedExpression(a,e)}function isRelativePattern(a){const e=a;return e?typeof e.base=="string"&&typeof e.pattern=="string":!1}function parsedExpression(a,e){const t=aggregateBasenameMatches(Object.getOwnPropertyNames(a).map(c=>parseExpressionPattern(c,a[c],e)).filter(c=>c!==NULL)),s=t.length;if(!s)return NULL;if(!t.some(c=>!!c.requiresSiblings)){if(s===1)return t[0];const c=function(g,f){let p;for(let m=0,_=t.length;m<_;m++){const C=t[m](g,f);if(typeof C=="string")return C;isThenable$1(C)&&(p||(p=[]),p.push(C))}return p?(async()=>{for(const m of p){const _=await m;if(typeof _=="string")return _}return null})():null},d=t.find(g=>!!g.allBasenames);d&&(c.allBasenames=d.allBasenames);const u=t.reduce((g,f)=>f.allPaths?g.concat(f.allPaths):g,[]);return u.length&&(c.allPaths=u),c}const o=function(c,d,u){let g,f;for(let p=0,m=t.length;p<m;p++){const _=t[p];_.requiresSiblings&&u&&(d||(d=basename$1(c)),g||(g=d.substr(0,d.length-extname$1(c).length)));const C=_(c,d,g,u);if(typeof C=="string")return C;isThenable$1(C)&&(f||(f=[]),f.push(C))}return f?(async()=>{for(const p of f){const m=await p;if(typeof m=="string")return m}return null})():null},r=t.find(c=>!!c.allBasenames);r&&(o.allBasenames=r.allBasenames);const l=t.reduce((c,d)=>d.allPaths?c.concat(d.allPaths):c,[]);return l.length&&(o.allPaths=l),o}function parseExpressionPattern(a,e,t){if(e===!1)return NULL;const s=parsePattern(a,t);if(s===NULL)return NULL;if(typeof e=="boolean")return s;if(e){const o=e.when;if(typeof o=="string"){const r=(l,c,d,u)=>{if(!u||!s(l,c))return null;const g=o.replace("$(basename)",()=>d),f=u(g);return isThenable$1(f)?f.then(p=>p?a:null):f?a:null};return r.requiresSiblings=!0,r}}return s}function aggregateBasenameMatches(a,e){const t=a.filter(c=>!!c.basenames);if(t.length<2)return a;const s=t.reduce((c,d)=>{const u=d.basenames;return u?c.concat(u):c},[]);let o;if(e){o=[];for(let c=0,d=s.length;c<d;c++)o.push(e)}else o=t.reduce((c,d)=>{const u=d.patterns;return u?c.concat(u):c},[]);const r=function(c,d){if(typeof c!="string")return null;if(!d){let g;for(g=c.length;g>0;g--){const f=c.charCodeAt(g-1);if(f===47||f===92)break}d=c.substr(g)}const u=s.indexOf(d);return u!==-1?o[u]:null};r.basenames=s,r.patterns=o,r.allBasenames=s;const l=a.filter(c=>!c.basenames);return l.push(r),l}function score(a,e,t,s,o,r){if(Array.isArray(a)){let l=0;for(const c of a){const d=score(c,e,t,s,o,r);if(d===10)return d;d>l&&(l=d)}return l}else{if(typeof a=="string")return s?a==="*"?5:a===t?10:0:0;if(a){const{language:l,pattern:c,scheme:d,hasAccessToAllModels:u,notebookType:g}=a;if(!s&&!u)return 0;g&&o&&(e=o);let f=0;if(d)if(d===e.scheme)f=10;else if(d==="*")f=5;else return 0;if(l)if(l===t)f=10;else if(l==="*")f=Math.max(f,5);else return 0;if(g)if(g===r)f=10;else if(g==="*"&&r!==void 0)f=Math.max(f,5);else return 0;if(c){let p;if(typeof c=="string"?p=c:p={...c,base:normalize(c.base)},p===e.fsPath||match(p,e.fsPath))f=10;else return 0}return f}else return 0}}var __decorate$y=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$x=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class TextualDocumentHighlightProvider{constructor(){this.selector={language:"*"}}provideDocumentHighlights(e,t,s){const o=[],r=e.getWordAtPosition({lineNumber:t.lineNumber,column:t.column});return r?e.isDisposed()?void 0:e.findMatches(r.word,!0,!1,!0,USUAL_WORD_SEPARATORS,!1).map(c=>({range:c.range,kind:DocumentHighlightKind$1.Text})):Promise.resolve(o)}provideMultiDocumentHighlights(e,t,s,o){const r=new ResourceMap,l=e.getWordAtPosition({lineNumber:t.lineNumber,column:t.column});if(!l)return Promise.resolve(r);for(const c of[e,...s]){if(c.isDisposed())continue;const u=c.findMatches(l.word,!0,!1,!0,USUAL_WORD_SEPARATORS,!1).map(g=>({range:g.range,kind:DocumentHighlightKind$1.Text}));u&&r.set(c.uri,u)}return r}}let TextualMultiDocumentHighlightFeature=class extends Disposable{constructor(e){super(),this._register(e.documentHighlightProvider.register("*",new TextualDocumentHighlightProvider)),this._register(e.multiDocumentHighlightProvider.register("*",new TextualDocumentHighlightProvider))}};TextualMultiDocumentHighlightFeature=__decorate$y([__param$x(0,ILanguageFeaturesService)],TextualMultiDocumentHighlightFeature);var __decorate$x=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$w=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},WordHighlighter_1,WordHighlighterContribution_1;const ctxHasWordHighlights=new RawContextKey("hasWordHighlights",!1);function getOccurrencesAtPosition(a,e,t,s){const o=a.ordered(e);return first(o.map(r=>()=>Promise.resolve(r.provideDocumentHighlights(e,t,s)).then(void 0,onUnexpectedExternalError)),r=>r!=null).then(r=>{if(r){const l=new ResourceMap;return l.set(e.uri,r),l}return new ResourceMap})}function getOccurrencesAcrossMultipleModels(a,e,t,s,o){const r=a.ordered(e);return first(r.map(l=>()=>{const c=o.filter(d=>shouldSynchronizeModel(d)).filter(d=>score(l.selector,d.uri,d.getLanguageId(),!0,void 0,void 0)>0);return Promise.resolve(l.provideMultiDocumentHighlights(e,t,c,s)).then(void 0,onUnexpectedExternalError)}),l=>l!=null)}class OccurenceAtPositionRequest{constructor(e,t,s){this._model=e,this._selection=t,this._wordSeparators=s,this._wordRange=this._getCurrentWordRange(e,t),this._result=null}get result(){return this._result||(this._result=createCancelablePromise(e=>this._compute(this._model,this._selection,this._wordSeparators,e))),this._result}_getCurrentWordRange(e,t){const s=e.getWordAtPosition(t.getPosition());return s?new Range$2(t.startLineNumber,s.startColumn,t.startLineNumber,s.endColumn):null}cancel(){this.result.cancel()}}class SemanticOccurenceAtPositionRequest extends OccurenceAtPositionRequest{constructor(e,t,s,o){super(e,t,s),this._providers=o}_compute(e,t,s,o){return getOccurrencesAtPosition(this._providers,e,t.getPosition(),o).then(r=>r||new ResourceMap)}}class MultiModelOccurenceRequest extends OccurenceAtPositionRequest{constructor(e,t,s,o,r){super(e,t,s),this._providers=o,this._otherModels=r}_compute(e,t,s,o){return getOccurrencesAcrossMultipleModels(this._providers,e,t.getPosition(),o,this._otherModels).then(r=>r||new ResourceMap)}}function computeOccurencesAtPosition(a,e,t,s){return new SemanticOccurenceAtPositionRequest(e,t,s,a)}function computeOccurencesMultiModel(a,e,t,s,o){return new MultiModelOccurenceRequest(e,t,s,a,o)}registerModelAndPositionCommand("_executeDocumentHighlights",async(a,e,t)=>{const s=a.get(ILanguageFeaturesService),o=await getOccurrencesAtPosition(s.documentHighlightProvider,e,t,CancellationToken.None);return o==null?void 0:o.get(e.uri)});var Ut;let WordHighlighter=(Ut=class{constructor(e,t,s,o,r,l,c,d){this.toUnhook=new DisposableStore,this.workerRequestTokenId=0,this.workerRequestCompleted=!1,this.workerRequestValue=new ResourceMap,this.lastCursorPositionChangeTime=0,this.renderDecorationsTimer=void 0,this.runDelayer=this.toUnhook.add(new Delayer(50)),this.editor=e,this.providers=t,this.multiDocumentProviders=s,this.codeEditorService=l,this.textModelService=r,this.configurationService=c,this.logService=d,this._hasWordHighlights=ctxHasWordHighlights.bindTo(o),this._ignorePositionChangeEvent=!1,this.occurrencesHighlightEnablement=this.editor.getOption(90),this.occurrencesHighlightDelay=this.configurationService.getValue("editor.occurrencesHighlightDelay"),this.model=this.editor.getModel(),this.toUnhook.add(e.onDidChangeCursorPosition(u=>{this._ignorePositionChangeEvent||this.occurrencesHighlightEnablement!=="off"&&this.runDelayer.trigger(()=>{this._onPositionChanged(u)})})),this.toUnhook.add(e.onDidFocusEditorText(u=>{this.occurrencesHighlightEnablement!=="off"&&(this.workerRequest||this.runDelayer.trigger(()=>{this._run()}))})),this.toUnhook.add(e.onDidChangeModelContent(u=>{matchesScheme(this.model.uri,"output")||this._stopAll()})),this.toUnhook.add(e.onDidChangeModel(u=>{!u.newModelUrl&&u.oldModelUrl?this._stopSingular():WordHighlighter_1.query&&this._run()})),this.toUnhook.add(e.onDidChangeConfiguration(u=>{var f,p;const g=this.editor.getOption(90);if(this.occurrencesHighlightEnablement!==g)switch(this.occurrencesHighlightEnablement=g,g){case"off":this._stopAll();break;case"singleFile":this._stopAll((p=(f=WordHighlighter_1.query)==null?void 0:f.modelInfo)==null?void 0:p.modelURI);break;case"multiFile":WordHighlighter_1.query&&this._run(!0);break;default:console.warn("Unknown occurrencesHighlight setting value:",g);break}})),this.toUnhook.add(this.configurationService.onDidChangeConfiguration(u=>{if(u.affectsConfiguration("editor.occurrencesHighlightDelay")){const g=c.getValue("editor.occurrencesHighlightDelay");this.occurrencesHighlightDelay!==g&&(this.occurrencesHighlightDelay=g)}})),this.toUnhook.add(e.onDidBlurEditorWidget(()=>{var g,f;const u=this.codeEditorService.getFocusedCodeEditor();u?((g=u.getModel())==null?void 0:g.uri.scheme)===Schemas.vscodeNotebookCell&&((f=this.editor.getModel())==null?void 0:f.uri.scheme)!==Schemas.vscodeNotebookCell&&this._stopAll():this._stopAll()})),this.decorations=this.editor.createDecorationsCollection(),this.workerRequestTokenId=0,this.workerRequest=null,this.workerRequestCompleted=!1,this.lastCursorPositionChangeTime=0,this.renderDecorationsTimer=void 0,WordHighlighter_1.query&&this._run()}hasDecorations(){return this.decorations.length>0}restore(e){this.occurrencesHighlightEnablement!=="off"&&(this.runDelayer.cancel(),this.runDelayer.trigger(()=>{this._run(!1,e)}))}stop(){this.occurrencesHighlightEnablement!=="off"&&this._stopAll()}_getSortedHighlights(){return this.decorations.getRanges().sort(Range$2.compareRangesUsingStarts)}moveNext(){const e=this._getSortedHighlights(),s=(e.findIndex(r=>r.containsPosition(this.editor.getPosition()))+1)%e.length,o=e[s];try{this._ignorePositionChangeEvent=!0,this.editor.setPosition(o.getStartPosition()),this.editor.revealRangeInCenterIfOutsideViewport(o);const r=this._getWord();if(r){const l=this.editor.getModel().getLineContent(o.startLineNumber);alert$1(`${l}, ${s+1} of ${e.length} for '${r.word}'`)}}finally{this._ignorePositionChangeEvent=!1}}moveBack(){const e=this._getSortedHighlights(),s=(e.findIndex(r=>r.containsPosition(this.editor.getPosition()))-1+e.length)%e.length,o=e[s];try{this._ignorePositionChangeEvent=!0,this.editor.setPosition(o.getStartPosition()),this.editor.revealRangeInCenterIfOutsideViewport(o);const r=this._getWord();if(r){const l=this.editor.getModel().getLineContent(o.startLineNumber);alert$1(`${l}, ${s+1} of ${e.length} for '${r.word}'`)}}finally{this._ignorePositionChangeEvent=!1}}_removeSingleDecorations(){if(!this.editor.hasModel())return;const e=WordHighlighter_1.storedDecorationIDs.get(this.editor.getModel().uri);e&&(this.editor.removeDecorations(e),WordHighlighter_1.storedDecorationIDs.delete(this.editor.getModel().uri),this.decorations.length>0&&(this.decorations.clear(),this._hasWordHighlights.set(!1)))}_removeAllDecorations(e){const t=this.codeEditorService.listCodeEditors(),s=[];for(const o of t){if(!o.hasModel()||isEqual(o.getModel().uri,e))continue;const r=WordHighlighter_1.storedDecorationIDs.get(o.getModel().uri);if(!r)continue;o.removeDecorations(r),s.push(o.getModel().uri);const l=WordHighlighterContribution.get(o);l!=null&&l.wordHighlighter&&l.wordHighlighter.decorations.length>0&&(l.wordHighlighter.decorations.clear(),l.wordHighlighter.workerRequest=null,l.wordHighlighter._hasWordHighlights.set(!1))}for(const o of s)WordHighlighter_1.storedDecorationIDs.delete(o)}_stopSingular(){var e,t,s,o;this._removeSingleDecorations(),this.editor.hasTextFocus()&&(((e=this.editor.getModel())==null?void 0:e.uri.scheme)!==Schemas.vscodeNotebookCell&&((s=(t=WordHighlighter_1.query)==null?void 0:t.modelInfo)==null?void 0:s.modelURI.scheme)!==Schemas.vscodeNotebookCell?(WordHighlighter_1.query=null,this._run()):(o=WordHighlighter_1.query)!=null&&o.modelInfo&&(WordHighlighter_1.query.modelInfo=null)),this.renderDecorationsTimer!==void 0&&(clearTimeout(this.renderDecorationsTimer),this.renderDecorationsTimer=void 0),this.workerRequest!==null&&(this.workerRequest.cancel(),this.workerRequest=null),this.workerRequestCompleted||(this.workerRequestTokenId++,this.workerRequestCompleted=!0)}_stopAll(e){this._removeAllDecorations(e),this.renderDecorationsTimer!==void 0&&(clearTimeout(this.renderDecorationsTimer),this.renderDecorationsTimer=void 0),this.workerRequest!==null&&(this.workerRequest.cancel(),this.workerRequest=null),this.workerRequestCompleted||(this.workerRequestTokenId++,this.workerRequestCompleted=!0)}_onPositionChanged(e){if(this.occurrencesHighlightEnablement==="off"){this._stopAll();return}if(e.source!=="api"&&e.reason!==3){this._stopAll();return}this._run()}_getWord(){const e=this.editor.getSelection(),t=e.startLineNumber,s=e.startColumn;return this.model.isDisposed()?null:this.model.getWordAtPosition({lineNumber:t,column:s})}getOtherModelsToHighlight(e){if(!e)return[];if(e.uri.scheme===Schemas.vscodeNotebookCell){const r=[],l=this.codeEditorService.listCodeEditors();for(const c of l){const d=c.getModel();d&&d!==e&&d.uri.scheme===Schemas.vscodeNotebookCell&&r.push(d)}return r}const s=[],o=this.codeEditorService.listCodeEditors();for(const r of o){if(!isDiffEditor(r))continue;const l=r.getModel();l&&e===l.modified&&s.push(l.modified)}if(s.length)return s;if(this.occurrencesHighlightEnablement==="singleFile")return[];for(const r of o){const l=r.getModel();l&&l!==e&&s.push(l)}return s}async _run(e,t){var o,r,l;if(this.editor.hasTextFocus()){const c=this.editor.getSelection();if(!c||c.startLineNumber!==c.endLineNumber){WordHighlighter_1.query=null,this._stopAll();return}const d=c.startColumn,u=c.endColumn,g=this._getWord();if(!g||g.startColumn>d||g.endColumn<u){WordHighlighter_1.query=null,this._stopAll();return}WordHighlighter_1.query={modelInfo:{modelURI:this.model.uri,selection:c}}}else if(!WordHighlighter_1.query){this._stopAll();return}if(this.lastCursorPositionChangeTime=new Date().getTime(),isEqual(this.editor.getModel().uri,(o=WordHighlighter_1.query.modelInfo)==null?void 0:o.modelURI)){if(!e){const g=this.decorations.getRanges();for(const f of g)if(f.containsPosition(this.editor.getPosition()))return}this._stopAll(e?this.model.uri:void 0);const c=++this.workerRequestTokenId;this.workerRequestCompleted=!1;const d=this.getOtherModelsToHighlight(this.editor.getModel());if(!WordHighlighter_1.query||!WordHighlighter_1.query.modelInfo)return;const u=await this.textModelService.createModelReference(WordHighlighter_1.query.modelInfo.modelURI);try{this.workerRequest=this.computeWithModel(u.object.textEditorModel,WordHighlighter_1.query.modelInfo.selection,d),(r=this.workerRequest)==null||r.result.then(g=>{c===this.workerRequestTokenId&&(this.workerRequestCompleted=!0,this.workerRequestValue=g||[],this._beginRenderDecorations(t??this.occurrencesHighlightDelay))},onUnexpectedError)}catch(g){this.logService.error("Unexpected error during occurrence request. Log: ",g)}finally{u.dispose()}}else if(this.model.uri.scheme===Schemas.vscodeNotebookCell){const c=++this.workerRequestTokenId;if(this.workerRequestCompleted=!1,!WordHighlighter_1.query||!WordHighlighter_1.query.modelInfo)return;const d=await this.textModelService.createModelReference(WordHighlighter_1.query.modelInfo.modelURI);try{this.workerRequest=this.computeWithModel(d.object.textEditorModel,WordHighlighter_1.query.modelInfo.selection,[this.model]),(l=this.workerRequest)==null||l.result.then(u=>{c===this.workerRequestTokenId&&(this.workerRequestCompleted=!0,this.workerRequestValue=u||[],this._beginRenderDecorations(t??this.occurrencesHighlightDelay))},onUnexpectedError)}catch(u){this.logService.error("Unexpected error during occurrence request. Log: ",u)}finally{d.dispose()}}}computeWithModel(e,t,s){return s.length?computeOccurencesMultiModel(this.multiDocumentProviders,e,t,this.editor.getOption(148),s):computeOccurencesAtPosition(this.providers,e,t,this.editor.getOption(148))}_beginRenderDecorations(e){const t=new Date().getTime(),s=this.lastCursorPositionChangeTime+e;t>=s?(this.renderDecorationsTimer=void 0,this.renderDecorations()):this.renderDecorationsTimer=setTimeout(()=>{this.renderDecorations()},s-t)}renderDecorations(){var t,s,o;this.renderDecorationsTimer=void 0;const e=this.codeEditorService.listCodeEditors();for(const r of e){const l=WordHighlighterContribution.get(r);if(!l)continue;const c=[],d=(t=r.getModel())==null?void 0:t.uri;if(d&&this.workerRequestValue.has(d)){const u=WordHighlighter_1.storedDecorationIDs.get(d),g=this.workerRequestValue.get(d);if(g)for(const p of g)p.range&&c.push({range:p.range,options:getHighlightDecorationOptions(p.kind)});let f=[];r.changeDecorations(p=>{f=p.deltaDecorations(u??[],c)}),WordHighlighter_1.storedDecorationIDs=WordHighlighter_1.storedDecorationIDs.set(d,f),c.length>0&&((s=l.wordHighlighter)==null||s.decorations.set(c),(o=l.wordHighlighter)==null||o._hasWordHighlights.set(!0))}}this.workerRequest=null}dispose(){this._stopSingular(),this.toUnhook.dispose()}},WordHighlighter_1=Ut,Ut.storedDecorationIDs=new ResourceMap,Ut.query=null,Ut);WordHighlighter=WordHighlighter_1=__decorate$x([__param$w(4,ITextModelService),__param$w(5,ICodeEditorService),__param$w(6,IConfigurationService),__param$w(7,ILogService)],WordHighlighter);var tn;let WordHighlighterContribution=(tn=class extends Disposable{static get(e){return e.getContribution(WordHighlighterContribution_1.ID)}constructor(e,t,s,o,r,l,c){super(),this._wordHighlighter=null;const d=()=>{e.hasModel()&&!e.getModel().isTooLargeForTokenization()&&e.getModel().uri.scheme!==Schemas.accessibleView&&(this._wordHighlighter=new WordHighlighter(e,s.documentHighlightProvider,s.multiDocumentHighlightProvider,t,r,o,l,c))};this._register(e.onDidChangeModel(u=>{var g,f;this._wordHighlighter&&(!u.newModelUrl&&((g=u.oldModelUrl)==null?void 0:g.scheme)!==Schemas.vscodeNotebookCell&&((f=this.wordHighlighter)==null||f.stop()),this._wordHighlighter.dispose(),this._wordHighlighter=null),d()})),d()}get wordHighlighter(){return this._wordHighlighter}saveViewState(){return!!(this._wordHighlighter&&this._wordHighlighter.hasDecorations())}moveNext(){var e;(e=this._wordHighlighter)==null||e.moveNext()}moveBack(){var e;(e=this._wordHighlighter)==null||e.moveBack()}restoreViewState(e){this._wordHighlighter&&e&&this._wordHighlighter.restore(250)}dispose(){this._wordHighlighter&&(this._wordHighlighter.dispose(),this._wordHighlighter=null),super.dispose()}},WordHighlighterContribution_1=tn,tn.ID="editor.contrib.wordHighlighter",tn);WordHighlighterContribution=WordHighlighterContribution_1=__decorate$x([__param$w(1,IContextKeyService),__param$w(2,ILanguageFeaturesService),__param$w(3,ICodeEditorService),__param$w(4,ITextModelService),__param$w(5,IConfigurationService),__param$w(6,ILogService)],WordHighlighterContribution);class WordHighlightNavigationAction extends EditorAction{constructor(e,t){super(t),this._isNext=e}run(e,t){const s=WordHighlighterContribution.get(t);s&&(this._isNext?s.moveNext():s.moveBack())}}class NextWordHighlightAction extends WordHighlightNavigationAction{constructor(){super(!0,{id:"editor.action.wordHighlight.next",label:localize2(1557,"Go to Next Symbol Highlight"),precondition:ctxHasWordHighlights,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:65,weight:100}})}}class PrevWordHighlightAction extends WordHighlightNavigationAction{constructor(){super(!1,{id:"editor.action.wordHighlight.prev",label:localize2(1558,"Go to Previous Symbol Highlight"),precondition:ctxHasWordHighlights,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1089,weight:100}})}}class TriggerWordHighlightAction extends EditorAction{constructor(){super({id:"editor.action.wordHighlight.trigger",label:localize2(1559,"Trigger Symbol Highlight"),precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:0,weight:100}})}run(e,t,s){const o=WordHighlighterContribution.get(t);o&&o.restoreViewState(!0)}}registerEditorContribution(WordHighlighterContribution.ID,WordHighlighterContribution,0);registerEditorAction(NextWordHighlightAction);registerEditorAction(PrevWordHighlightAction);registerEditorAction(TriggerWordHighlightAction);registerEditorFeature(TextualMultiDocumentHighlightFeature);class MoveWordCommand extends EditorCommand{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode,this._wordNavigationType=e.wordNavigationType}runEditorCommand(e,t,s){if(!t.hasModel())return;const o=getMapForWordSeparators(t.getOption(148),t.getOption(147)),r=t.getModel(),l=t.getSelections(),c=l.length>1,d=l.map(u=>{const g=new Position$1(u.positionLineNumber,u.positionColumn),f=this._move(o,r,g,this._wordNavigationType,c);return this._moveTo(u,f,this._inSelectionMode)});if(r.pushStackElement(),t._getViewModel().setCursorStates("moveWordCommand",3,d.map(u=>CursorState$1.fromModelSelection(u))),d.length===1){const u=new Position$1(d[0].positionLineNumber,d[0].positionColumn);t.revealPosition(u,0)}}_moveTo(e,t,s){return s?new Selection$1(e.selectionStartLineNumber,e.selectionStartColumn,t.lineNumber,t.column):new Selection$1(t.lineNumber,t.column,t.lineNumber,t.column)}}class WordLeftCommand extends MoveWordCommand{_move(e,t,s,o,r){return WordOperations.moveWordLeft(e,t,s,o,r)}}class WordRightCommand extends MoveWordCommand{_move(e,t,s,o,r){return WordOperations.moveWordRight(e,t,s,o)}}class CursorWordStartLeft extends WordLeftCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:0,id:"cursorWordStartLeft",precondition:void 0})}}class CursorWordEndLeft extends WordLeftCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:"cursorWordEndLeft",precondition:void 0})}}class CursorWordLeft extends WordLeftCommand{constructor(){var e;super({inSelectionMode:!1,wordNavigationType:1,id:"cursorWordLeft",precondition:void 0,kbOpts:{kbExpr:ContextKeyExpr.and(EditorContextKeys.textInputFocus,(e=ContextKeyExpr.and(CONTEXT_ACCESSIBILITY_MODE_ENABLED,IsWindowsContext))==null?void 0:e.negate()),primary:2063,mac:{primary:527},weight:100}})}}class CursorWordStartLeftSelect extends WordLeftCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:0,id:"cursorWordStartLeftSelect",precondition:void 0})}}class CursorWordEndLeftSelect extends WordLeftCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:"cursorWordEndLeftSelect",precondition:void 0})}}class CursorWordLeftSelect extends WordLeftCommand{constructor(){var e;super({inSelectionMode:!0,wordNavigationType:1,id:"cursorWordLeftSelect",precondition:void 0,kbOpts:{kbExpr:ContextKeyExpr.and(EditorContextKeys.textInputFocus,(e=ContextKeyExpr.and(CONTEXT_ACCESSIBILITY_MODE_ENABLED,IsWindowsContext))==null?void 0:e.negate()),primary:3087,mac:{primary:1551},weight:100}})}}class CursorWordAccessibilityLeft extends WordLeftCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:3,id:"cursorWordAccessibilityLeft",precondition:void 0})}_move(e,t,s,o,r){return super._move(getMapForWordSeparators(EditorOptions.wordSeparators.defaultValue,e.intlSegmenterLocales),t,s,o,r)}}class CursorWordAccessibilityLeftSelect extends WordLeftCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:3,id:"cursorWordAccessibilityLeftSelect",precondition:void 0})}_move(e,t,s,o,r){return super._move(getMapForWordSeparators(EditorOptions.wordSeparators.defaultValue,e.intlSegmenterLocales),t,s,o,r)}}class CursorWordStartRight extends WordRightCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:0,id:"cursorWordStartRight",precondition:void 0})}}class CursorWordEndRight extends WordRightCommand{constructor(){var e;super({inSelectionMode:!1,wordNavigationType:2,id:"cursorWordEndRight",precondition:void 0,kbOpts:{kbExpr:ContextKeyExpr.and(EditorContextKeys.textInputFocus,(e=ContextKeyExpr.and(CONTEXT_ACCESSIBILITY_MODE_ENABLED,IsWindowsContext))==null?void 0:e.negate()),primary:2065,mac:{primary:529},weight:100}})}}class CursorWordRight extends WordRightCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:"cursorWordRight",precondition:void 0})}}class CursorWordStartRightSelect extends WordRightCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:0,id:"cursorWordStartRightSelect",precondition:void 0})}}class CursorWordEndRightSelect extends WordRightCommand{constructor(){var e;super({inSelectionMode:!0,wordNavigationType:2,id:"cursorWordEndRightSelect",precondition:void 0,kbOpts:{kbExpr:ContextKeyExpr.and(EditorContextKeys.textInputFocus,(e=ContextKeyExpr.and(CONTEXT_ACCESSIBILITY_MODE_ENABLED,IsWindowsContext))==null?void 0:e.negate()),primary:3089,mac:{primary:1553},weight:100}})}}class CursorWordRightSelect extends WordRightCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:"cursorWordRightSelect",precondition:void 0})}}class CursorWordAccessibilityRight extends WordRightCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:3,id:"cursorWordAccessibilityRight",precondition:void 0})}_move(e,t,s,o,r){return super._move(getMapForWordSeparators(EditorOptions.wordSeparators.defaultValue,e.intlSegmenterLocales),t,s,o,r)}}class CursorWordAccessibilityRightSelect extends WordRightCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:3,id:"cursorWordAccessibilityRightSelect",precondition:void 0})}_move(e,t,s,o,r){return super._move(getMapForWordSeparators(EditorOptions.wordSeparators.defaultValue,e.intlSegmenterLocales),t,s,o,r)}}class DeleteWordCommand extends EditorCommand{constructor(e){super(e),this._whitespaceHeuristics=e.whitespaceHeuristics,this._wordNavigationType=e.wordNavigationType}runEditorCommand(e,t,s){const o=e==null?void 0:e.get(ILanguageConfigurationService);if(!t.hasModel()||!o)return;const r=getMapForWordSeparators(t.getOption(148),t.getOption(147)),l=t.getModel(),c=t.getSelections(),d=t.getOption(10),u=t.getOption(15),g=o.getLanguageConfiguration(l.getLanguageId()).getAutoClosingPairs(),f=t._getViewModel(),p=c.map(m=>{const _=this._delete({wordSeparators:r,model:l,selection:m,whitespaceHeuristics:this._whitespaceHeuristics,autoClosingDelete:t.getOption(13),autoClosingBrackets:d,autoClosingQuotes:u,autoClosingPairs:g,autoClosedCharacters:f.getCursorAutoClosedCharacters()},this._wordNavigationType);return new ReplaceCommand(_,"")});t.pushUndoStop(),t.executeCommands(this.id,p),t.pushUndoStop()}}class DeleteWordLeftCommand extends DeleteWordCommand{_delete(e,t){const s=WordOperations.deleteWordLeft(e,t);return s||new Range$2(1,1,1,1)}}class DeleteWordRightCommand extends DeleteWordCommand{_delete(e,t){const s=WordOperations.deleteWordRight(e,t);if(s)return s;const o=e.model.getLineCount(),r=e.model.getLineMaxColumn(o);return new Range$2(o,r,o,r)}}class DeleteWordStartLeft extends DeleteWordLeftCommand{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:0,id:"deleteWordStartLeft",precondition:EditorContextKeys.writable})}}class DeleteWordEndLeft extends DeleteWordLeftCommand{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:2,id:"deleteWordEndLeft",precondition:EditorContextKeys.writable})}}class DeleteWordLeft extends DeleteWordLeftCommand{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:0,id:"deleteWordLeft",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:2049,mac:{primary:513},weight:100}})}}class DeleteWordStartRight extends DeleteWordRightCommand{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:0,id:"deleteWordStartRight",precondition:EditorContextKeys.writable})}}class DeleteWordEndRight extends DeleteWordRightCommand{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:2,id:"deleteWordEndRight",precondition:EditorContextKeys.writable})}}class DeleteWordRight extends DeleteWordRightCommand{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:2,id:"deleteWordRight",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:2068,mac:{primary:532},weight:100}})}}class DeleteInsideWord extends EditorAction{constructor(){super({id:"deleteInsideWord",precondition:EditorContextKeys.writable,label:localize2(1560,"Delete Word")})}run(e,t,s){if(!t.hasModel())return;const o=getMapForWordSeparators(t.getOption(148),t.getOption(147)),r=t.getModel(),c=t.getSelections().map(d=>{const u=WordOperations.deleteInsideWord(o,r,d);return new ReplaceCommand(u,"")});t.pushUndoStop(),t.executeCommands(this.id,c),t.pushUndoStop()}}registerEditorCommand(new CursorWordStartLeft);registerEditorCommand(new CursorWordEndLeft);registerEditorCommand(new CursorWordLeft);registerEditorCommand(new CursorWordStartLeftSelect);registerEditorCommand(new CursorWordEndLeftSelect);registerEditorCommand(new CursorWordLeftSelect);registerEditorCommand(new CursorWordStartRight);registerEditorCommand(new CursorWordEndRight);registerEditorCommand(new CursorWordRight);registerEditorCommand(new CursorWordStartRightSelect);registerEditorCommand(new CursorWordEndRightSelect);registerEditorCommand(new CursorWordRightSelect);registerEditorCommand(new CursorWordAccessibilityLeft);registerEditorCommand(new CursorWordAccessibilityLeftSelect);registerEditorCommand(new CursorWordAccessibilityRight);registerEditorCommand(new CursorWordAccessibilityRightSelect);registerEditorCommand(new DeleteWordStartLeft);registerEditorCommand(new DeleteWordEndLeft);registerEditorCommand(new DeleteWordLeft);registerEditorCommand(new DeleteWordStartRight);registerEditorCommand(new DeleteWordEndRight);registerEditorCommand(new DeleteWordRight);registerEditorAction(DeleteInsideWord);class DeleteWordPartLeft extends DeleteWordCommand{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:0,id:"deleteWordPartLeft",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:769},weight:100}})}_delete(e,t){const s=WordPartOperations.deleteWordPartLeft(e);return s||new Range$2(1,1,1,1)}}class DeleteWordPartRight extends DeleteWordCommand{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:2,id:"deleteWordPartRight",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:788},weight:100}})}_delete(e,t){const s=WordPartOperations.deleteWordPartRight(e);if(s)return s;const o=e.model.getLineCount(),r=e.model.getLineMaxColumn(o);return new Range$2(o,r,o,r)}}class WordPartLeftCommand extends MoveWordCommand{_move(e,t,s,o,r){return WordPartOperations.moveWordPartLeft(e,t,s,r)}}class CursorWordPartLeft extends WordPartLeftCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:0,id:"cursorWordPartLeft",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:783},weight:100}})}}CommandsRegistry.registerCommandAlias("cursorWordPartStartLeft","cursorWordPartLeft");class CursorWordPartLeftSelect extends WordPartLeftCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:0,id:"cursorWordPartLeftSelect",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:1807},weight:100}})}}CommandsRegistry.registerCommandAlias("cursorWordPartStartLeftSelect","cursorWordPartLeftSelect");class WordPartRightCommand extends MoveWordCommand{_move(e,t,s,o,r){return WordPartOperations.moveWordPartRight(e,t,s)}}class CursorWordPartRight extends WordPartRightCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:"cursorWordPartRight",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:785},weight:100}})}}class CursorWordPartRightSelect extends WordPartRightCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:"cursorWordPartRightSelect",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:1809},weight:100}})}}registerEditorCommand(new DeleteWordPartLeft);registerEditorCommand(new DeleteWordPartRight);registerEditorCommand(new CursorWordPartLeft);registerEditorCommand(new CursorWordPartLeftSelect);registerEditorCommand(new CursorWordPartRight);registerEditorCommand(new CursorWordPartRightSelect);const Xo=class Xo extends Disposable{constructor(e){super(),this.editor=e,this._register(this.editor.onDidAttemptReadOnlyEdit(()=>this._onDidAttemptReadOnlyEdit()))}_onDidAttemptReadOnlyEdit(){const e=MessageController.get(this.editor);if(e&&this.editor.hasModel()){let t=this.editor.getOptions().get(105);t||(this.editor.isSimpleWidget?t=new MarkdownString(localize(1363,"Cannot edit in read-only input")):t=new MarkdownString(localize(1364,"Cannot edit in read-only editor"))),e.showMessage(t,this.editor.getPosition())}}};Xo.ID="editor.contrib.readOnlyMessageController";let ReadOnlyMessageController=Xo;registerEditorContribution(ReadOnlyMessageController.ID,ReadOnlyMessageController,2);var __decorate$w=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$v=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let DiffEditorBreadcrumbsSource=class extends Disposable{constructor(e,t,s){super(),this._textModel=e,this._languageFeaturesService=t,this._outlineModelService=s,this._currentModel=observableValue(this,void 0);const o=observableSignalFromEvent("documentSymbolProvider.onDidChange",this._languageFeaturesService.documentSymbolProvider.onDidChange),r=observableSignalFromEvent("_textModel.onDidChangeContent",Event$1.debounce(l=>this._textModel.onDidChangeContent(l),()=>{},100));this._register(autorunWithStore(async(l,c)=>{o.read(l),r.read(l);const d=c.add(new DisposableCancellationTokenSource),u=await this._outlineModelService.getOrCreate(this._textModel,d.token);c.isDisposed||this._currentModel.set(u,void 0)}))}getBreadcrumbItems(e,t){const s=this._currentModel.read(t);if(!s)return[];const o=s.asListOfDocumentSymbols().filter(r=>e.contains(r.range.startLineNumber)&&!e.contains(r.range.endLineNumber));return o.sort(reverseOrder(compareBy(r=>r.range.endLineNumber-r.range.startLineNumber,numberComparator))),o.map(r=>({name:r.name,kind:r.kind,startLineNumber:r.range.startLineNumber}))}};DiffEditorBreadcrumbsSource=__decorate$w([__param$v(1,ILanguageFeaturesService),__param$v(2,IOutlineModelService)],DiffEditorBreadcrumbsSource);HideUnchangedRegionsFeature.setBreadcrumbsSourceFactory((a,e)=>e.createInstance(DiffEditorBreadcrumbsSource,a));const floatingMenu="";var __decorate$v=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$u=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},Vn;let FloatingEditorToolbar=(Vn=class extends Disposable{constructor(e,t,s,o){super();const r=this._register(observableCodeEditor(e)),l=this._register(o.createMenu(MenuId.EditorContent,e.contextKeyService)),c=observableFromEvent(this,l.onDidChange,()=>l.getActions().length===0);this._register(autorun(d=>{if(c.read(d))return;const g=h("div.floating-menu-overlay-widget");g.root.style.height="28px";const f=t.createInstance(MenuWorkbenchToolBar,g.root,MenuId.EditorContent,{actionViewItemProvider:(p,m)=>{if(!(p instanceof MenuItemAction))return;const _=s.lookupKeybinding(p.id);if(_)return t.createInstance(class extends MenuEntryActionViewItem{updateLabel(){this.options.label&&this.label&&(this.label.textContent=`${this._commandAction.label} (${_.getLabel()})`)}},p,{...m,keybindingNotRenderedWithLabel:!0})},hiddenItemStrategy:0,menuOptions:{shouldForwardArgs:!0},telemetrySource:"editor.overlayToolbar",toolbarOptions:{primaryGroup:()=>!0,useSeparatorsInPrimaryActions:!0}});d.store.add(f),d.store.add(autorun(p=>{const m=r.model.read(p);f.context=m==null?void 0:m.uri})),d.store.add(r.createOverlayWidget({allowEditorOverflow:!1,domNode:g.root,minContentWidthInPx:constObservable(0),position:constObservable({preference:1})}))}))}},Vn.ID="editor.contrib.floatingToolbar",Vn);FloatingEditorToolbar=__decorate$v([__param$u(1,IInstantiationService),__param$u(2,IKeybindingService),__param$u(3,IMenuService)],FloatingEditorToolbar);registerEditorContribution(FloatingEditorToolbar.ID,FloatingEditorToolbar,1);var InspectTokensNLS;(function(a){a.inspectTokensAction=localize(782,"Developer: Inspect Tokens")})(InspectTokensNLS||(InspectTokensNLS={}));var GoToLineNLS;(function(a){a.gotoLineActionLabel=localize(783,"Go to Line/Column...")})(GoToLineNLS||(GoToLineNLS={}));var QuickHelpNLS;(function(a){a.helpQuickAccessActionLabel=localize(784,"Show all Quick Access Providers")})(QuickHelpNLS||(QuickHelpNLS={}));var QuickCommandNLS;(function(a){a.quickCommandActionLabel=localize(785,"Command Palette"),a.quickCommandHelp=localize(786,"Show And Run Commands")})(QuickCommandNLS||(QuickCommandNLS={}));var QuickOutlineNLS;(function(a){a.quickOutlineActionLabel=localize(787,"Go to Symbol..."),a.quickOutlineByCategoryActionLabel=localize(788,"Go to Symbol by Category...")})(QuickOutlineNLS||(QuickOutlineNLS={}));var StandaloneCodeEditorNLS;(function(a){a.editorViewAccessibleLabel=localize(789,"Editor content")})(StandaloneCodeEditorNLS||(StandaloneCodeEditorNLS={}));var ToggleHighContrastNLS;(function(a){a.toggleHighContrast=localize(790,"Toggle High Contrast Theme")})(ToggleHighContrastNLS||(ToggleHighContrastNLS={}));var StandaloneServicesNLS;(function(a){a.bulkEditServiceSummary=localize(791,"Made {0} edits in {1} files")})(StandaloneServicesNLS||(StandaloneServicesNLS={}));const scriptRel="modulepreload",assetsURL=function(a){return"/"+a},seen={},__vitePreload=function(e,t,s){if(!t||t.length===0)return e();const o=document.getElementsByTagName("link");return Promise.all(t.map(r=>{if(r=assetsURL(r),r in seen)return;seen[r]=!0;const l=r.endsWith(".css"),c=l?'[rel="stylesheet"]':"";if(!!s)for(let g=o.length-1;g>=0;g--){const f=o[g];if(f.href===r&&(!l||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${c}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":scriptRel,l||(u.as="script",u.crossOrigin=""),u.href=r,document.head.appendChild(u),l)return new Promise((g,f)=>{u.addEventListener("load",g),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>e()).catch(r=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r})};var AccessibilitySupport;(function(a){a[a.Unknown=0]="Unknown",a[a.Disabled=1]="Disabled",a[a.Enabled=2]="Enabled"})(AccessibilitySupport||(AccessibilitySupport={}));var CodeActionTriggerType;(function(a){a[a.Invoke=1]="Invoke",a[a.Auto=2]="Auto"})(CodeActionTriggerType||(CodeActionTriggerType={}));var CompletionItemInsertTextRule;(function(a){a[a.None=0]="None",a[a.KeepWhitespace=1]="KeepWhitespace",a[a.InsertAsSnippet=4]="InsertAsSnippet"})(CompletionItemInsertTextRule||(CompletionItemInsertTextRule={}));var CompletionItemKind;(function(a){a[a.Method=0]="Method",a[a.Function=1]="Function",a[a.Constructor=2]="Constructor",a[a.Field=3]="Field",a[a.Variable=4]="Variable",a[a.Class=5]="Class",a[a.Struct=6]="Struct",a[a.Interface=7]="Interface",a[a.Module=8]="Module",a[a.Property=9]="Property",a[a.Event=10]="Event",a[a.Operator=11]="Operator",a[a.Unit=12]="Unit",a[a.Value=13]="Value",a[a.Constant=14]="Constant",a[a.Enum=15]="Enum",a[a.EnumMember=16]="EnumMember",a[a.Keyword=17]="Keyword",a[a.Text=18]="Text",a[a.Color=19]="Color",a[a.File=20]="File",a[a.Reference=21]="Reference",a[a.Customcolor=22]="Customcolor",a[a.Folder=23]="Folder",a[a.TypeParameter=24]="TypeParameter",a[a.User=25]="User",a[a.Issue=26]="Issue",a[a.Tool=27]="Tool",a[a.Snippet=28]="Snippet"})(CompletionItemKind||(CompletionItemKind={}));var CompletionItemTag;(function(a){a[a.Deprecated=1]="Deprecated"})(CompletionItemTag||(CompletionItemTag={}));var CompletionTriggerKind;(function(a){a[a.Invoke=0]="Invoke",a[a.TriggerCharacter=1]="TriggerCharacter",a[a.TriggerForIncompleteCompletions=2]="TriggerForIncompleteCompletions"})(CompletionTriggerKind||(CompletionTriggerKind={}));var ContentWidgetPositionPreference;(function(a){a[a.EXACT=0]="EXACT",a[a.ABOVE=1]="ABOVE",a[a.BELOW=2]="BELOW"})(ContentWidgetPositionPreference||(ContentWidgetPositionPreference={}));var CursorChangeReason;(function(a){a[a.NotSet=0]="NotSet",a[a.ContentFlush=1]="ContentFlush",a[a.RecoverFromMarkers=2]="RecoverFromMarkers",a[a.Explicit=3]="Explicit",a[a.Paste=4]="Paste",a[a.Undo=5]="Undo",a[a.Redo=6]="Redo"})(CursorChangeReason||(CursorChangeReason={}));var DefaultEndOfLine;(function(a){a[a.LF=1]="LF",a[a.CRLF=2]="CRLF"})(DefaultEndOfLine||(DefaultEndOfLine={}));var DocumentHighlightKind;(function(a){a[a.Text=0]="Text",a[a.Read=1]="Read",a[a.Write=2]="Write"})(DocumentHighlightKind||(DocumentHighlightKind={}));var EditorAutoIndentStrategy;(function(a){a[a.None=0]="None",a[a.Keep=1]="Keep",a[a.Brackets=2]="Brackets",a[a.Advanced=3]="Advanced",a[a.Full=4]="Full"})(EditorAutoIndentStrategy||(EditorAutoIndentStrategy={}));var EditorOption;(function(a){a[a.acceptSuggestionOnCommitCharacter=0]="acceptSuggestionOnCommitCharacter",a[a.acceptSuggestionOnEnter=1]="acceptSuggestionOnEnter",a[a.accessibilitySupport=2]="accessibilitySupport",a[a.accessibilityPageSize=3]="accessibilityPageSize",a[a.allowOverflow=4]="allowOverflow",a[a.allowVariableLineHeights=5]="allowVariableLineHeights",a[a.allowVariableFonts=6]="allowVariableFonts",a[a.allowVariableFontsInAccessibilityMode=7]="allowVariableFontsInAccessibilityMode",a[a.ariaLabel=8]="ariaLabel",a[a.ariaRequired=9]="ariaRequired",a[a.autoClosingBrackets=10]="autoClosingBrackets",a[a.autoClosingComments=11]="autoClosingComments",a[a.screenReaderAnnounceInlineSuggestion=12]="screenReaderAnnounceInlineSuggestion",a[a.autoClosingDelete=13]="autoClosingDelete",a[a.autoClosingOvertype=14]="autoClosingOvertype",a[a.autoClosingQuotes=15]="autoClosingQuotes",a[a.autoIndent=16]="autoIndent",a[a.autoIndentOnPaste=17]="autoIndentOnPaste",a[a.autoIndentOnPasteWithinString=18]="autoIndentOnPasteWithinString",a[a.automaticLayout=19]="automaticLayout",a[a.autoSurround=20]="autoSurround",a[a.bracketPairColorization=21]="bracketPairColorization",a[a.guides=22]="guides",a[a.codeLens=23]="codeLens",a[a.codeLensFontFamily=24]="codeLensFontFamily",a[a.codeLensFontSize=25]="codeLensFontSize",a[a.colorDecorators=26]="colorDecorators",a[a.colorDecoratorsLimit=27]="colorDecoratorsLimit",a[a.columnSelection=28]="columnSelection",a[a.comments=29]="comments",a[a.contextmenu=30]="contextmenu",a[a.copyWithSyntaxHighlighting=31]="copyWithSyntaxHighlighting",a[a.cursorBlinking=32]="cursorBlinking",a[a.cursorSmoothCaretAnimation=33]="cursorSmoothCaretAnimation",a[a.cursorStyle=34]="cursorStyle",a[a.cursorSurroundingLines=35]="cursorSurroundingLines",a[a.cursorSurroundingLinesStyle=36]="cursorSurroundingLinesStyle",a[a.cursorWidth=37]="cursorWidth",a[a.cursorHeight=38]="cursorHeight",a[a.disableLayerHinting=39]="disableLayerHinting",a[a.disableMonospaceOptimizations=40]="disableMonospaceOptimizations",a[a.domReadOnly=41]="domReadOnly",a[a.dragAndDrop=42]="dragAndDrop",a[a.dropIntoEditor=43]="dropIntoEditor",a[a.editContext=44]="editContext",a[a.emptySelectionClipboard=45]="emptySelectionClipboard",a[a.experimentalGpuAcceleration=46]="experimentalGpuAcceleration",a[a.experimentalWhitespaceRendering=47]="experimentalWhitespaceRendering",a[a.extraEditorClassName=48]="extraEditorClassName",a[a.fastScrollSensitivity=49]="fastScrollSensitivity",a[a.find=50]="find",a[a.fixedOverflowWidgets=51]="fixedOverflowWidgets",a[a.folding=52]="folding",a[a.foldingStrategy=53]="foldingStrategy",a[a.foldingHighlight=54]="foldingHighlight",a[a.foldingImportsByDefault=55]="foldingImportsByDefault",a[a.foldingMaximumRegions=56]="foldingMaximumRegions",a[a.unfoldOnClickAfterEndOfLine=57]="unfoldOnClickAfterEndOfLine",a[a.fontFamily=58]="fontFamily",a[a.fontInfo=59]="fontInfo",a[a.fontLigatures=60]="fontLigatures",a[a.fontSize=61]="fontSize",a[a.fontWeight=62]="fontWeight",a[a.fontVariations=63]="fontVariations",a[a.formatOnPaste=64]="formatOnPaste",a[a.formatOnType=65]="formatOnType",a[a.glyphMargin=66]="glyphMargin",a[a.gotoLocation=67]="gotoLocation",a[a.hideCursorInOverviewRuler=68]="hideCursorInOverviewRuler",a[a.hover=69]="hover",a[a.inDiffEditor=70]="inDiffEditor",a[a.inlineSuggest=71]="inlineSuggest",a[a.letterSpacing=72]="letterSpacing",a[a.lightbulb=73]="lightbulb",a[a.lineDecorationsWidth=74]="lineDecorationsWidth",a[a.lineHeight=75]="lineHeight",a[a.lineNumbers=76]="lineNumbers",a[a.lineNumbersMinChars=77]="lineNumbersMinChars",a[a.linkedEditing=78]="linkedEditing",a[a.links=79]="links",a[a.matchBrackets=80]="matchBrackets",a[a.minimap=81]="minimap",a[a.mouseStyle=82]="mouseStyle",a[a.mouseWheelScrollSensitivity=83]="mouseWheelScrollSensitivity",a[a.mouseWheelZoom=84]="mouseWheelZoom",a[a.multiCursorMergeOverlapping=85]="multiCursorMergeOverlapping",a[a.multiCursorModifier=86]="multiCursorModifier",a[a.mouseMiddleClickAction=87]="mouseMiddleClickAction",a[a.multiCursorPaste=88]="multiCursorPaste",a[a.multiCursorLimit=89]="multiCursorLimit",a[a.occurrencesHighlight=90]="occurrencesHighlight",a[a.occurrencesHighlightDelay=91]="occurrencesHighlightDelay",a[a.overtypeCursorStyle=92]="overtypeCursorStyle",a[a.overtypeOnPaste=93]="overtypeOnPaste",a[a.overviewRulerBorder=94]="overviewRulerBorder",a[a.overviewRulerLanes=95]="overviewRulerLanes",a[a.padding=96]="padding",a[a.pasteAs=97]="pasteAs",a[a.parameterHints=98]="parameterHints",a[a.peekWidgetDefaultFocus=99]="peekWidgetDefaultFocus",a[a.placeholder=100]="placeholder",a[a.definitionLinkOpensInPeek=101]="definitionLinkOpensInPeek",a[a.quickSuggestions=102]="quickSuggestions",a[a.quickSuggestionsDelay=103]="quickSuggestionsDelay",a[a.readOnly=104]="readOnly",a[a.readOnlyMessage=105]="readOnlyMessage",a[a.renameOnType=106]="renameOnType",a[a.renderRichScreenReaderContent=107]="renderRichScreenReaderContent",a[a.renderControlCharacters=108]="renderControlCharacters",a[a.renderFinalNewline=109]="renderFinalNewline",a[a.renderLineHighlight=110]="renderLineHighlight",a[a.renderLineHighlightOnlyWhenFocus=111]="renderLineHighlightOnlyWhenFocus",a[a.renderValidationDecorations=112]="renderValidationDecorations",a[a.renderWhitespace=113]="renderWhitespace",a[a.revealHorizontalRightPadding=114]="revealHorizontalRightPadding",a[a.roundedSelection=115]="roundedSelection",a[a.rulers=116]="rulers",a[a.scrollbar=117]="scrollbar",a[a.scrollBeyondLastColumn=118]="scrollBeyondLastColumn",a[a.scrollBeyondLastLine=119]="scrollBeyondLastLine",a[a.scrollPredominantAxis=120]="scrollPredominantAxis",a[a.selectionClipboard=121]="selectionClipboard",a[a.selectionHighlight=122]="selectionHighlight",a[a.selectionHighlightMaxLength=123]="selectionHighlightMaxLength",a[a.selectionHighlightMultiline=124]="selectionHighlightMultiline",a[a.selectOnLineNumbers=125]="selectOnLineNumbers",a[a.showFoldingControls=126]="showFoldingControls",a[a.showUnused=127]="showUnused",a[a.snippetSuggestions=128]="snippetSuggestions",a[a.smartSelect=129]="smartSelect",a[a.smoothScrolling=130]="smoothScrolling",a[a.stickyScroll=131]="stickyScroll",a[a.stickyTabStops=132]="stickyTabStops",a[a.stopRenderingLineAfter=133]="stopRenderingLineAfter",a[a.suggest=134]="suggest",a[a.suggestFontSize=135]="suggestFontSize",a[a.suggestLineHeight=136]="suggestLineHeight",a[a.suggestOnTriggerCharacters=137]="suggestOnTriggerCharacters",a[a.suggestSelection=138]="suggestSelection",a[a.tabCompletion=139]="tabCompletion",a[a.tabIndex=140]="tabIndex",a[a.trimWhitespaceOnDelete=141]="trimWhitespaceOnDelete",a[a.unicodeHighlighting=142]="unicodeHighlighting",a[a.unusualLineTerminators=143]="unusualLineTerminators",a[a.useShadowDOM=144]="useShadowDOM",a[a.useTabStops=145]="useTabStops",a[a.wordBreak=146]="wordBreak",a[a.wordSegmenterLocales=147]="wordSegmenterLocales",a[a.wordSeparators=148]="wordSeparators",a[a.wordWrap=149]="wordWrap",a[a.wordWrapBreakAfterCharacters=150]="wordWrapBreakAfterCharacters",a[a.wordWrapBreakBeforeCharacters=151]="wordWrapBreakBeforeCharacters",a[a.wordWrapColumn=152]="wordWrapColumn",a[a.wordWrapOverride1=153]="wordWrapOverride1",a[a.wordWrapOverride2=154]="wordWrapOverride2",a[a.wrappingIndent=155]="wrappingIndent",a[a.wrappingStrategy=156]="wrappingStrategy",a[a.showDeprecated=157]="showDeprecated",a[a.inertialScroll=158]="inertialScroll",a[a.inlayHints=159]="inlayHints",a[a.wrapOnEscapedLineFeeds=160]="wrapOnEscapedLineFeeds",a[a.effectiveCursorStyle=161]="effectiveCursorStyle",a[a.editorClassName=162]="editorClassName",a[a.pixelRatio=163]="pixelRatio",a[a.tabFocusMode=164]="tabFocusMode",a[a.layoutInfo=165]="layoutInfo",a[a.wrappingInfo=166]="wrappingInfo",a[a.defaultColorDecorators=167]="defaultColorDecorators",a[a.colorDecoratorsActivatedOn=168]="colorDecoratorsActivatedOn",a[a.inlineCompletionsAccessibilityVerbose=169]="inlineCompletionsAccessibilityVerbose",a[a.effectiveEditContext=170]="effectiveEditContext",a[a.scrollOnMiddleClick=171]="scrollOnMiddleClick",a[a.effectiveAllowVariableFonts=172]="effectiveAllowVariableFonts"})(EditorOption||(EditorOption={}));var EndOfLinePreference;(function(a){a[a.TextDefined=0]="TextDefined",a[a.LF=1]="LF",a[a.CRLF=2]="CRLF"})(EndOfLinePreference||(EndOfLinePreference={}));var EndOfLineSequence;(function(a){a[a.LF=0]="LF",a[a.CRLF=1]="CRLF"})(EndOfLineSequence||(EndOfLineSequence={}));var GlyphMarginLane;(function(a){a[a.Left=1]="Left",a[a.Center=2]="Center",a[a.Right=3]="Right"})(GlyphMarginLane||(GlyphMarginLane={}));var HoverVerbosityAction;(function(a){a[a.Increase=0]="Increase",a[a.Decrease=1]="Decrease"})(HoverVerbosityAction||(HoverVerbosityAction={}));var IndentAction;(function(a){a[a.None=0]="None",a[a.Indent=1]="Indent",a[a.IndentOutdent=2]="IndentOutdent",a[a.Outdent=3]="Outdent"})(IndentAction||(IndentAction={}));var InjectedTextCursorStops;(function(a){a[a.Both=0]="Both",a[a.Right=1]="Right",a[a.Left=2]="Left",a[a.None=3]="None"})(InjectedTextCursorStops||(InjectedTextCursorStops={}));var InlayHintKind;(function(a){a[a.Type=1]="Type",a[a.Parameter=2]="Parameter"})(InlayHintKind||(InlayHintKind={}));var InlineCompletionDisplayLocationKind;(function(a){a[a.Code=1]="Code",a[a.Label=2]="Label"})(InlineCompletionDisplayLocationKind||(InlineCompletionDisplayLocationKind={}));var InlineCompletionEndOfLifeReasonKind;(function(a){a[a.Accepted=0]="Accepted",a[a.Rejected=1]="Rejected",a[a.Ignored=2]="Ignored"})(InlineCompletionEndOfLifeReasonKind||(InlineCompletionEndOfLifeReasonKind={}));var InlineCompletionTriggerKind;(function(a){a[a.Automatic=0]="Automatic",a[a.Explicit=1]="Explicit"})(InlineCompletionTriggerKind||(InlineCompletionTriggerKind={}));var KeyCode$1;(function(a){a[a.DependsOnKbLayout=-1]="DependsOnKbLayout",a[a.Unknown=0]="Unknown",a[a.Backspace=1]="Backspace",a[a.Tab=2]="Tab",a[a.Enter=3]="Enter",a[a.Shift=4]="Shift",a[a.Ctrl=5]="Ctrl",a[a.Alt=6]="Alt",a[a.PauseBreak=7]="PauseBreak",a[a.CapsLock=8]="CapsLock",a[a.Escape=9]="Escape",a[a.Space=10]="Space",a[a.PageUp=11]="PageUp",a[a.PageDown=12]="PageDown",a[a.End=13]="End",a[a.Home=14]="Home",a[a.LeftArrow=15]="LeftArrow",a[a.UpArrow=16]="UpArrow",a[a.RightArrow=17]="RightArrow",a[a.DownArrow=18]="DownArrow",a[a.Insert=19]="Insert",a[a.Delete=20]="Delete",a[a.Digit0=21]="Digit0",a[a.Digit1=22]="Digit1",a[a.Digit2=23]="Digit2",a[a.Digit3=24]="Digit3",a[a.Digit4=25]="Digit4",a[a.Digit5=26]="Digit5",a[a.Digit6=27]="Digit6",a[a.Digit7=28]="Digit7",a[a.Digit8=29]="Digit8",a[a.Digit9=30]="Digit9",a[a.KeyA=31]="KeyA",a[a.KeyB=32]="KeyB",a[a.KeyC=33]="KeyC",a[a.KeyD=34]="KeyD",a[a.KeyE=35]="KeyE",a[a.KeyF=36]="KeyF",a[a.KeyG=37]="KeyG",a[a.KeyH=38]="KeyH",a[a.KeyI=39]="KeyI",a[a.KeyJ=40]="KeyJ",a[a.KeyK=41]="KeyK",a[a.KeyL=42]="KeyL",a[a.KeyM=43]="KeyM",a[a.KeyN=44]="KeyN",a[a.KeyO=45]="KeyO",a[a.KeyP=46]="KeyP",a[a.KeyQ=47]="KeyQ",a[a.KeyR=48]="KeyR",a[a.KeyS=49]="KeyS",a[a.KeyT=50]="KeyT",a[a.KeyU=51]="KeyU",a[a.KeyV=52]="KeyV",a[a.KeyW=53]="KeyW",a[a.KeyX=54]="KeyX",a[a.KeyY=55]="KeyY",a[a.KeyZ=56]="KeyZ",a[a.Meta=57]="Meta",a[a.ContextMenu=58]="ContextMenu",a[a.F1=59]="F1",a[a.F2=60]="F2",a[a.F3=61]="F3",a[a.F4=62]="F4",a[a.F5=63]="F5",a[a.F6=64]="F6",a[a.F7=65]="F7",a[a.F8=66]="F8",a[a.F9=67]="F9",a[a.F10=68]="F10",a[a.F11=69]="F11",a[a.F12=70]="F12",a[a.F13=71]="F13",a[a.F14=72]="F14",a[a.F15=73]="F15",a[a.F16=74]="F16",a[a.F17=75]="F17",a[a.F18=76]="F18",a[a.F19=77]="F19",a[a.F20=78]="F20",a[a.F21=79]="F21",a[a.F22=80]="F22",a[a.F23=81]="F23",a[a.F24=82]="F24",a[a.NumLock=83]="NumLock",a[a.ScrollLock=84]="ScrollLock",a[a.Semicolon=85]="Semicolon",a[a.Equal=86]="Equal",a[a.Comma=87]="Comma",a[a.Minus=88]="Minus",a[a.Period=89]="Period",a[a.Slash=90]="Slash",a[a.Backquote=91]="Backquote",a[a.BracketLeft=92]="BracketLeft",a[a.Backslash=93]="Backslash",a[a.BracketRight=94]="BracketRight",a[a.Quote=95]="Quote",a[a.OEM_8=96]="OEM_8",a[a.IntlBackslash=97]="IntlBackslash",a[a.Numpad0=98]="Numpad0",a[a.Numpad1=99]="Numpad1",a[a.Numpad2=100]="Numpad2",a[a.Numpad3=101]="Numpad3",a[a.Numpad4=102]="Numpad4",a[a.Numpad5=103]="Numpad5",a[a.Numpad6=104]="Numpad6",a[a.Numpad7=105]="Numpad7",a[a.Numpad8=106]="Numpad8",a[a.Numpad9=107]="Numpad9",a[a.NumpadMultiply=108]="NumpadMultiply",a[a.NumpadAdd=109]="NumpadAdd",a[a.NUMPAD_SEPARATOR=110]="NUMPAD_SEPARATOR",a[a.NumpadSubtract=111]="NumpadSubtract",a[a.NumpadDecimal=112]="NumpadDecimal",a[a.NumpadDivide=113]="NumpadDivide",a[a.KEY_IN_COMPOSITION=114]="KEY_IN_COMPOSITION",a[a.ABNT_C1=115]="ABNT_C1",a[a.ABNT_C2=116]="ABNT_C2",a[a.AudioVolumeMute=117]="AudioVolumeMute",a[a.AudioVolumeUp=118]="AudioVolumeUp",a[a.AudioVolumeDown=119]="AudioVolumeDown",a[a.BrowserSearch=120]="BrowserSearch",a[a.BrowserHome=121]="BrowserHome",a[a.BrowserBack=122]="BrowserBack",a[a.BrowserForward=123]="BrowserForward",a[a.MediaTrackNext=124]="MediaTrackNext",a[a.MediaTrackPrevious=125]="MediaTrackPrevious",a[a.MediaStop=126]="MediaStop",a[a.MediaPlayPause=127]="MediaPlayPause",a[a.LaunchMediaPlayer=128]="LaunchMediaPlayer",a[a.LaunchMail=129]="LaunchMail",a[a.LaunchApp2=130]="LaunchApp2",a[a.Clear=131]="Clear",a[a.MAX_VALUE=132]="MAX_VALUE"})(KeyCode$1||(KeyCode$1={}));var MarkerSeverity$1;(function(a){a[a.Hint=1]="Hint",a[a.Info=2]="Info",a[a.Warning=4]="Warning",a[a.Error=8]="Error"})(MarkerSeverity$1||(MarkerSeverity$1={}));var MarkerTag$1;(function(a){a[a.Unnecessary=1]="Unnecessary",a[a.Deprecated=2]="Deprecated"})(MarkerTag$1||(MarkerTag$1={}));var MinimapPosition;(function(a){a[a.Inline=1]="Inline",a[a.Gutter=2]="Gutter"})(MinimapPosition||(MinimapPosition={}));var MinimapSectionHeaderStyle;(function(a){a[a.Normal=1]="Normal",a[a.Underlined=2]="Underlined"})(MinimapSectionHeaderStyle||(MinimapSectionHeaderStyle={}));var MouseTargetType;(function(a){a[a.UNKNOWN=0]="UNKNOWN",a[a.TEXTAREA=1]="TEXTAREA",a[a.GUTTER_GLYPH_MARGIN=2]="GUTTER_GLYPH_MARGIN",a[a.GUTTER_LINE_NUMBERS=3]="GUTTER_LINE_NUMBERS",a[a.GUTTER_LINE_DECORATIONS=4]="GUTTER_LINE_DECORATIONS",a[a.GUTTER_VIEW_ZONE=5]="GUTTER_VIEW_ZONE",a[a.CONTENT_TEXT=6]="CONTENT_TEXT",a[a.CONTENT_EMPTY=7]="CONTENT_EMPTY",a[a.CONTENT_VIEW_ZONE=8]="CONTENT_VIEW_ZONE",a[a.CONTENT_WIDGET=9]="CONTENT_WIDGET",a[a.OVERVIEW_RULER=10]="OVERVIEW_RULER",a[a.SCROLLBAR=11]="SCROLLBAR",a[a.OVERLAY_WIDGET=12]="OVERLAY_WIDGET",a[a.OUTSIDE_EDITOR=13]="OUTSIDE_EDITOR"})(MouseTargetType||(MouseTargetType={}));var NewSymbolNameTag;(function(a){a[a.AIGenerated=1]="AIGenerated"})(NewSymbolNameTag||(NewSymbolNameTag={}));var NewSymbolNameTriggerKind;(function(a){a[a.Invoke=0]="Invoke",a[a.Automatic=1]="Automatic"})(NewSymbolNameTriggerKind||(NewSymbolNameTriggerKind={}));var OverlayWidgetPositionPreference;(function(a){a[a.TOP_RIGHT_CORNER=0]="TOP_RIGHT_CORNER",a[a.BOTTOM_RIGHT_CORNER=1]="BOTTOM_RIGHT_CORNER",a[a.TOP_CENTER=2]="TOP_CENTER"})(OverlayWidgetPositionPreference||(OverlayWidgetPositionPreference={}));var OverviewRulerLane;(function(a){a[a.Left=1]="Left",a[a.Center=2]="Center",a[a.Right=4]="Right",a[a.Full=7]="Full"})(OverviewRulerLane||(OverviewRulerLane={}));var PartialAcceptTriggerKind;(function(a){a[a.Word=0]="Word",a[a.Line=1]="Line",a[a.Suggest=2]="Suggest"})(PartialAcceptTriggerKind||(PartialAcceptTriggerKind={}));var PositionAffinity;(function(a){a[a.Left=0]="Left",a[a.Right=1]="Right",a[a.None=2]="None",a[a.LeftOfInjectedText=3]="LeftOfInjectedText",a[a.RightOfInjectedText=4]="RightOfInjectedText"})(PositionAffinity||(PositionAffinity={}));var RenderLineNumbersType;(function(a){a[a.Off=0]="Off",a[a.On=1]="On",a[a.Relative=2]="Relative",a[a.Interval=3]="Interval",a[a.Custom=4]="Custom"})(RenderLineNumbersType||(RenderLineNumbersType={}));var RenderMinimap;(function(a){a[a.None=0]="None",a[a.Text=1]="Text",a[a.Blocks=2]="Blocks"})(RenderMinimap||(RenderMinimap={}));var ScrollType;(function(a){a[a.Smooth=0]="Smooth",a[a.Immediate=1]="Immediate"})(ScrollType||(ScrollType={}));var ScrollbarVisibility;(function(a){a[a.Auto=1]="Auto",a[a.Hidden=2]="Hidden",a[a.Visible=3]="Visible"})(ScrollbarVisibility||(ScrollbarVisibility={}));var SelectionDirection$1;(function(a){a[a.LTR=0]="LTR",a[a.RTL=1]="RTL"})(SelectionDirection$1||(SelectionDirection$1={}));var ShowLightbulbIconMode;(function(a){a.Off="off",a.OnCode="onCode",a.On="on"})(ShowLightbulbIconMode||(ShowLightbulbIconMode={}));var SignatureHelpTriggerKind;(function(a){a[a.Invoke=1]="Invoke",a[a.TriggerCharacter=2]="TriggerCharacter",a[a.ContentChange=3]="ContentChange"})(SignatureHelpTriggerKind||(SignatureHelpTriggerKind={}));var SymbolKind;(function(a){a[a.File=0]="File",a[a.Module=1]="Module",a[a.Namespace=2]="Namespace",a[a.Package=3]="Package",a[a.Class=4]="Class",a[a.Method=5]="Method",a[a.Property=6]="Property",a[a.Field=7]="Field",a[a.Constructor=8]="Constructor",a[a.Enum=9]="Enum",a[a.Interface=10]="Interface",a[a.Function=11]="Function",a[a.Variable=12]="Variable",a[a.Constant=13]="Constant",a[a.String=14]="String",a[a.Number=15]="Number",a[a.Boolean=16]="Boolean",a[a.Array=17]="Array",a[a.Object=18]="Object",a[a.Key=19]="Key",a[a.Null=20]="Null",a[a.EnumMember=21]="EnumMember",a[a.Struct=22]="Struct",a[a.Event=23]="Event",a[a.Operator=24]="Operator",a[a.TypeParameter=25]="TypeParameter"})(SymbolKind||(SymbolKind={}));var SymbolTag;(function(a){a[a.Deprecated=1]="Deprecated"})(SymbolTag||(SymbolTag={}));var TextDirection;(function(a){a[a.LTR=0]="LTR",a[a.RTL=1]="RTL"})(TextDirection||(TextDirection={}));var TextEditorCursorBlinkingStyle;(function(a){a[a.Hidden=0]="Hidden",a[a.Blink=1]="Blink",a[a.Smooth=2]="Smooth",a[a.Phase=3]="Phase",a[a.Expand=4]="Expand",a[a.Solid=5]="Solid"})(TextEditorCursorBlinkingStyle||(TextEditorCursorBlinkingStyle={}));var TextEditorCursorStyle;(function(a){a[a.Line=1]="Line",a[a.Block=2]="Block",a[a.Underline=3]="Underline",a[a.LineThin=4]="LineThin",a[a.BlockOutline=5]="BlockOutline",a[a.UnderlineThin=6]="UnderlineThin"})(TextEditorCursorStyle||(TextEditorCursorStyle={}));var TrackedRangeStickiness;(function(a){a[a.AlwaysGrowsWhenTypingAtEdges=0]="AlwaysGrowsWhenTypingAtEdges",a[a.NeverGrowsWhenTypingAtEdges=1]="NeverGrowsWhenTypingAtEdges",a[a.GrowsOnlyWhenTypingBefore=2]="GrowsOnlyWhenTypingBefore",a[a.GrowsOnlyWhenTypingAfter=3]="GrowsOnlyWhenTypingAfter"})(TrackedRangeStickiness||(TrackedRangeStickiness={}));var WrappingIndent;(function(a){a[a.None=0]="None",a[a.Same=1]="Same",a[a.Indent=2]="Indent",a[a.DeepIndent=3]="DeepIndent"})(WrappingIndent||(WrappingIndent={}));var gt;let KeyMod$1=(gt=class{static chord(e,t){return KeyChord(e,t)}},gt.CtrlCmd=2048,gt.Shift=1024,gt.Alt=512,gt.WinCtrl=256,gt);function createMonacoBaseAPI(){return{editor:void 0,languages:void 0,CancellationTokenSource:CancellationTokenSource$1,Emitter:Emitter$1,KeyCode:KeyCode$1,KeyMod:KeyMod$1,Position:Position$1,Range:Range$2,Selection:Selection$1,SelectionDirection:SelectionDirection$1,MarkerSeverity:MarkerSeverity$1,MarkerTag:MarkerTag$1,Uri:URI,Token:Token$2}}const standaloneTokens="",DEFAULT_CHANNEL="default",INITIALIZE="$initialize";let webWorkerWarningLogged=!1;function logOnceWebWorkerWarning(a){isWeb&&(webWorkerWarningLogged||(webWorkerWarningLogged=!0,console.warn("Could not create web worker(s). Falling back to loading web worker code in main thread, which might cause UI freezes. Please see https://github.com/microsoft/monaco-editor#faq")),console.warn(a.message))}class RequestMessage{constructor(e,t,s,o,r){this.vsWorker=e,this.req=t,this.channel=s,this.method=o,this.args=r,this.type=0}}class ReplyMessage{constructor(e,t,s,o){this.vsWorker=e,this.seq=t,this.res=s,this.err=o,this.type=1}}class SubscribeEventMessage{constructor(e,t,s,o,r){this.vsWorker=e,this.req=t,this.channel=s,this.eventName=o,this.arg=r,this.type=2}}class EventMessage{constructor(e,t,s){this.vsWorker=e,this.req=t,this.event=s,this.type=3}}class UnsubscribeEventMessage{constructor(e,t){this.vsWorker=e,this.req=t,this.type=4}}class WebWorkerProtocol{constructor(e){this._workerId=-1,this._handler=e,this._lastSentReq=0,this._pendingReplies=Object.create(null),this._pendingEmitters=new Map,this._pendingEvents=new Map}setWorkerId(e){this._workerId=e}sendMessage(e,t,s){const o=String(++this._lastSentReq);return new Promise((r,l)=>{this._pendingReplies[o]={resolve:r,reject:l},this._send(new RequestMessage(this._workerId,o,e,t,s))})}listen(e,t,s){let o=null;const r=new Emitter$1({onWillAddFirstListener:()=>{o=String(++this._lastSentReq),this._pendingEmitters.set(o,r),this._send(new SubscribeEventMessage(this._workerId,o,e,t,s))},onDidRemoveLastListener:()=>{this._pendingEmitters.delete(o),this._send(new UnsubscribeEventMessage(this._workerId,o)),o=null}});return r.event}handleMessage(e){!e||!e.vsWorker||this._workerId!==-1&&e.vsWorker!==this._workerId||this._handleMessage(e)}createProxyToRemoteChannel(e,t){const s={get:(o,r)=>(typeof r=="string"&&!o[r]&&(propertyIsDynamicEvent(r)?o[r]=l=>this.listen(e,r,l):propertyIsEvent(r)?o[r]=this.listen(e,r,void 0):r.charCodeAt(0)===36&&(o[r]=async(...l)=>(await(t==null?void 0:t()),this.sendMessage(e,r,l)))),o[r])};return new Proxy(Object.create(null),s)}_handleMessage(e){switch(e.type){case 1:return this._handleReplyMessage(e);case 0:return this._handleRequestMessage(e);case 2:return this._handleSubscribeEventMessage(e);case 3:return this._handleEventMessage(e);case 4:return this._handleUnsubscribeEventMessage(e)}}_handleReplyMessage(e){if(!this._pendingReplies[e.seq]){console.warn("Got reply to unknown seq");return}const t=this._pendingReplies[e.seq];if(delete this._pendingReplies[e.seq],e.err){let s=e.err;e.err.$isError&&(s=new Error,s.name=e.err.name,s.message=e.err.message,s.stack=e.err.stack),t.reject(s);return}t.resolve(e.res)}_handleRequestMessage(e){const t=e.req;this._handler.handleMessage(e.channel,e.method,e.args).then(o=>{this._send(new ReplyMessage(this._workerId,t,o,void 0))},o=>{o.detail instanceof Error&&(o.detail=transformErrorForSerialization(o.detail)),this._send(new ReplyMessage(this._workerId,t,void 0,transformErrorForSerialization(o)))})}_handleSubscribeEventMessage(e){const t=e.req,s=this._handler.handleEvent(e.channel,e.eventName,e.arg)(o=>{this._send(new EventMessage(this._workerId,t,o))});this._pendingEvents.set(t,s)}_handleEventMessage(e){if(!this._pendingEmitters.has(e.req)){console.warn("Got event for unknown req");return}this._pendingEmitters.get(e.req).fire(e.event)}_handleUnsubscribeEventMessage(e){if(!this._pendingEvents.has(e.req)){console.warn("Got unsubscribe for unknown req");return}this._pendingEvents.get(e.req).dispose(),this._pendingEvents.delete(e.req)}_send(e){const t=[];if(e.type===0)for(let s=0;s<e.args.length;s++)e.args[s]instanceof ArrayBuffer&&t.push(e.args[s]);else e.type===1&&e.res instanceof ArrayBuffer&&t.push(e.res);this._handler.sendMessage(e,t)}}class WebWorkerClient extends Disposable{constructor(e){super(),this._localChannels=new Map,this._worker=this._register(e),this._register(this._worker.onMessage(t=>{this._protocol.handleMessage(t)})),this._register(this._worker.onError(t=>{logOnceWebWorkerWarning(t),onUnexpectedError(t)})),this._protocol=new WebWorkerProtocol({sendMessage:(t,s)=>{this._worker.postMessage(t,s)},handleMessage:(t,s,o)=>this._handleMessage(t,s,o),handleEvent:(t,s,o)=>this._handleEvent(t,s,o)}),this._protocol.setWorkerId(this._worker.getId()),this._onModuleLoaded=this._protocol.sendMessage(DEFAULT_CHANNEL,INITIALIZE,[this._worker.getId()]),this.proxy=this._protocol.createProxyToRemoteChannel(DEFAULT_CHANNEL,async()=>{await this._onModuleLoaded}),this._onModuleLoaded.catch(t=>{this._onError("Worker failed to load ",t)})}_handleMessage(e,t,s){const o=this._localChannels.get(e);if(!o)return Promise.reject(new Error(`Missing channel ${e} on main thread`));if(typeof o[t]!="function")return Promise.reject(new Error(`Missing method ${t} on main thread channel ${e}`));try{return Promise.resolve(o[t].apply(o,s))}catch(r){return Promise.reject(r)}}_handleEvent(e,t,s){const o=this._localChannels.get(e);if(!o)throw new Error(`Missing channel ${e} on main thread`);if(propertyIsDynamicEvent(t)){const r=o[t].call(o,s);if(typeof r!="function")throw new Error(`Missing dynamic event ${t} on main thread channel ${e}.`);return r}if(propertyIsEvent(t)){const r=o[t];if(typeof r!="function")throw new Error(`Missing event ${t} on main thread channel ${e}.`);return r}throw new Error(`Malformed event name ${t}`)}setChannel(e,t){this._localChannels.set(e,t)}_onError(e,t){console.error(e),console.info(t)}}function propertyIsEvent(a){return a[0]==="o"&&a[1]==="n"&&isUpperAsciiLetter(a.charCodeAt(2))}function propertyIsDynamicEvent(a){return/^onDynamic/.test(a)&&isUpperAsciiLetter(a.charCodeAt(9))}let ttPolicy$2;typeof self=="object"&&self.constructor&&self.constructor.name==="DedicatedWorkerGlobalScope"&&globalThis.workerttPolicy!==void 0?ttPolicy$2=globalThis.workerttPolicy:ttPolicy$2=createTrustedTypesPolicy$1("defaultWorkerFactory",{createScriptURL:a=>a});function getWorker$1(a,e){const t=a.label||"anonymous"+e,s=globalThis.MonacoEnvironment;if(s){if(typeof s.getWorker=="function")return s.getWorker("workerMain.js",t);if(typeof s.getWorkerUrl=="function"){const r=s.getWorkerUrl("workerMain.js",t);return new Worker(ttPolicy$2?ttPolicy$2.createScriptURL(r):r,{name:t,type:"module"})}}const o=a.esmModuleLocation;if(o){const r=getWorkerBootstrapUrl(t,o.toString(!0)),l=new Worker(ttPolicy$2?ttPolicy$2.createScriptURL(r):r,{name:t,type:"module"});return whenESMWorkerReady(l)}throw new Error("You must define a function MonacoEnvironment.getWorkerUrl or MonacoEnvironment.getWorker")}function getWorkerBootstrapUrl(a,e){if(!(/^((http:)|(https:)|(file:))/.test(e)&&e.substring(0,globalThis.origin.length)!==globalThis.origin)){const s=e.lastIndexOf("?"),o=e.lastIndexOf("#",s),r=s>0?new URLSearchParams(e.substring(s+1,~o?o:void 0)):new URLSearchParams;COI.addSearchParam(r,!0,!0),r.toString()?e=`${e}?${r.toString()}#${a}`:e=`${e}#${a}`}const t=new Blob([coalesce([`/*${a}*/`,`globalThis._VSCODE_NLS_MESSAGES = ${JSON.stringify(getNLSMessages())};`,`globalThis._VSCODE_NLS_LANGUAGE = ${JSON.stringify(getNLSLanguage())};`,`globalThis._VSCODE_FILE_ROOT = ${JSON.stringify(globalThis._VSCODE_FILE_ROOT)};`,"const ttPolicy = globalThis.trustedTypes?.createPolicy('defaultWorkerFactory', { createScriptURL: value => value });","globalThis.workerttPolicy = ttPolicy;",`await import(ttPolicy?.createScriptURL(${JSON.stringify(e)}) ?? ${JSON.stringify(e)});`,"globalThis.postMessage({ type: 'vscode-worker-ready' });",`/*${a}*/`]).join("")],{type:"application/javascript"});return URL.createObjectURL(t)}function whenESMWorkerReady(a){return new Promise((e,t)=>{a.onmessage=function(s){s.data.type==="vscode-worker-ready"&&(a.onmessage=null,e(a))},a.onerror=t})}function isPromiseLike(a){return!!a&&typeof a.then=="function"}const _o=class _o extends Disposable{constructor(e){super(),this._onMessage=this._register(new Emitter$1),this.onMessage=this._onMessage.event,this._onError=this._register(new Emitter$1),this.onError=this._onError.event,this.id=++_o.LAST_WORKER_ID;const t=e instanceof Worker||"then"in e?e:getWorker$1(e,this.id);isPromiseLike(t)?this.worker=t:this.worker=Promise.resolve(t),this.postMessage("-please-ignore-",[]);const s=o=>{this._onError.fire(o)};this.worker.then(o=>{o.onmessage=r=>{this._onMessage.fire(r.data)},o.onmessageerror=r=>{this._onError.fire(r)},typeof o.addEventListener=="function"&&o.addEventListener("error",s)}),this._register(toDisposable(()=>{var o;(o=this.worker)==null||o.then(r=>{r.onmessage=null,r.onmessageerror=null,r.removeEventListener("error",s),r.terminate()}),this.worker=null}))}getId(){return this.id}postMessage(e,t){var s;(s=this.worker)==null||s.then(o=>{try{o.postMessage(e,t)}catch(r){onUnexpectedError(r),onUnexpectedError(new Error("FAILED to post message to worker",{cause:r}))}})}};_o.LAST_WORKER_ID=0;let WebWorker=_o;class WebWorkerDescriptor{constructor(e,t){this.esmModuleLocation=e,this.label=t}}function createWebWorker$3(a,e){const t=URI.isUri(a)?new WebWorkerDescriptor(a,e):a;return new WebWorkerClient(new WebWorker(t))}class Uint8Matrix{constructor(e,t,s){const o=new Uint8Array(e*t);for(let r=0,l=e*t;r<l;r++)o[r]=s;this._data=o,this.rows=e,this.cols=t}get(e,t){return this._data[e*this.cols+t]}set(e,t,s){this._data[e*this.cols+t]=s}}class StateMachine{constructor(e){let t=0,s=0;for(let r=0,l=e.length;r<l;r++){const[c,d,u]=e[r];d>t&&(t=d),c>s&&(s=c),u>s&&(s=u)}t++,s++;const o=new Uint8Matrix(s,t,0);for(let r=0,l=e.length;r<l;r++){const[c,d,u]=e[r];o.set(c,d,u)}this._states=o,this._maxCharCode=t}nextState(e,t){return t<0||t>=this._maxCharCode?0:this._states.get(e,t)}}let _stateMachine=null;function getStateMachine(){return _stateMachine===null&&(_stateMachine=new StateMachine([[1,104,2],[1,72,2],[1,102,6],[1,70,6],[2,116,3],[2,84,3],[3,116,4],[3,84,4],[4,112,5],[4,80,5],[5,115,9],[5,83,9],[5,58,10],[6,105,7],[6,73,7],[7,108,8],[7,76,8],[8,101,9],[8,69,9],[9,58,10],[10,47,11],[11,47,12]])),_stateMachine}let _classifier=null;function getClassifier(){if(_classifier===null){_classifier=new CharacterClassifier(0);const a=` 	<>'"、。｡､，．：；‘〈「『〔（［｛｢｣｝］）〕』」〉’｀～…|`;for(let t=0;t<a.length;t++)_classifier.set(a.charCodeAt(t),1);const e=".,;:";for(let t=0;t<e.length;t++)_classifier.set(e.charCodeAt(t),2)}return _classifier}class LinkComputer{static _createLink(e,t,s,o,r){let l=r-1;do{const c=t.charCodeAt(l);if(e.get(c)!==2)break;l--}while(l>o);if(o>0){const c=t.charCodeAt(o-1),d=t.charCodeAt(l);(c===40&&d===41||c===91&&d===93||c===123&&d===125)&&l--}return{range:{startLineNumber:s,startColumn:o+1,endLineNumber:s,endColumn:l+2},url:t.substring(o,l+1)}}static computeLinks(e,t=getStateMachine()){const s=getClassifier(),o=[];for(let r=1,l=e.getLineCount();r<=l;r++){const c=e.getLineContent(r),d=c.length;let u=0,g=0,f=0,p=1,m=!1,_=!1,C=!1,b=!1;for(;u<d;){let v=!1;const S=c.charCodeAt(u);if(p===13){let y;switch(S){case 40:m=!0,y=0;break;case 41:y=m?0:1;break;case 91:C=!0,_=!0,y=0;break;case 93:C=!1,y=_?0:1;break;case 123:b=!0,y=0;break;case 125:y=b?0:1;break;case 39:case 34:case 96:f===S?y=1:f===39||f===34||f===96?y=0:y=1;break;case 42:y=f===42?1:0;break;case 32:y=C?0:1;break;default:y=s.get(S)}y===1&&(o.push(LinkComputer._createLink(s,c,r,g,u)),v=!0)}else if(p===12){let y;S===91?(_=!0,y=0):y=s.get(S),y===1?v=!0:p=13}else p=t.nextState(p,S),p===0&&(v=!0);v&&(p=1,m=!1,_=!1,b=!1,g=u+1,f=S),u++}p===13&&o.push(LinkComputer._createLink(s,c,r,g,d))}return o}}function computeLinks(a){return!a||typeof a.getLineCount!="function"||typeof a.getLineContent!="function"?[]:LinkComputer.computeLinks(a)}const Co=class Co{constructor(){this._defaultValueSet=[["true","false"],["True","False"],["Private","Public","Friend","ReadOnly","Partial","Protected","WriteOnly"],["public","protected","private"]]}navigateValueSet(e,t,s,o,r){if(e&&t){const l=this.doNavigateValueSet(t,r);if(l)return{range:e,value:l}}if(s&&o){const l=this.doNavigateValueSet(o,r);if(l)return{range:s,value:l}}return null}doNavigateValueSet(e,t){const s=this.numberReplace(e,t);return s!==null?s:this.textReplace(e,t)}numberReplace(e,t){const s=Math.pow(10,e.length-(e.lastIndexOf(".")+1));let o=Number(e);const r=parseFloat(e);return!isNaN(o)&&!isNaN(r)&&o===r?o===0&&!t?null:(o=Math.floor(o*s),o+=t?s:-s,String(o/s)):null}textReplace(e,t){return this.valueSetsReplace(this._defaultValueSet,e,t)}valueSetsReplace(e,t,s){let o=null;for(let r=0,l=e.length;o===null&&r<l;r++)o=this.valueSetReplace(e[r],t,s);return o}valueSetReplace(e,t,s){let o=e.indexOf(t);return o>=0?(o+=s?1:-1,o<0?o=e.length-1:o%=e.length,e[o]):null}};Co.INSTANCE=new Co;let BasicInplaceReplace=Co;function _parseCaptureGroups(a){const e=[];for(const t of a){const s=Number(t);(s||s===0&&t.replace(/\s/g,"")!=="")&&e.push(s)}return e}function _toIColor(a,e,t,s){return{red:a/255,blue:t/255,green:e/255,alpha:s}}function _findRange(a,e){const t=e.index,s=e[0].length;if(t===void 0)return;const o=a.positionAt(t);return{startLineNumber:o.lineNumber,startColumn:o.column,endLineNumber:o.lineNumber,endColumn:o.column+s}}function _findHexColorInformation(a,e){if(!a)return;const t=Color.Format.CSS.parseHex(e);if(t)return{range:a,color:_toIColor(t.rgba.r,t.rgba.g,t.rgba.b,t.rgba.a)}}function _findRGBColorInformation(a,e,t){if(!a||e.length!==1)return;const o=e[0].values(),r=_parseCaptureGroups(o);return{range:a,color:_toIColor(r[0],r[1],r[2],t?r[3]:1)}}function _findHSLColorInformation(a,e,t){if(!a||e.length!==1)return;const o=e[0].values(),r=_parseCaptureGroups(o),l=new Color(new HSLA(r[0],r[1]/100,r[2]/100,t?r[3]:1));return{range:a,color:_toIColor(l.rgba.r,l.rgba.g,l.rgba.b,l.rgba.a)}}function _findMatches(a,e){return typeof a=="string"?[...a.matchAll(e)]:a.findMatches(e)}function computeColors(a){const e=[],t=new RegExp(`\\b(rgb|rgba|hsl|hsla)(\\([0-9\\s,.\\%]*\\))|^(#)([A-Fa-f0-9]{3})\\b|^(#)([A-Fa-f0-9]{4})\\b|^(#)([A-Fa-f0-9]{6})\\b|^(#)([A-Fa-f0-9]{8})\\b|(?<=['"\\s])(#)([A-Fa-f0-9]{3})\\b|(?<=['"\\s])(#)([A-Fa-f0-9]{4})\\b|(?<=['"\\s])(#)([A-Fa-f0-9]{6})\\b|(?<=['"\\s])(#)([A-Fa-f0-9]{8})\\b`,"gm"),s=_findMatches(a,t);if(s.length>0)for(const o of s){const r=o.filter(u=>u!==void 0),l=r[1],c=r[2];if(!c)continue;let d;if(l==="rgb"){const u=/^\(\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*\)$/gm;d=_findRGBColorInformation(_findRange(a,o),_findMatches(c,u),!1)}else if(l==="rgba"){const u=/^\(\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*,\s*(0[.][0-9]+|[.][0-9]+|[01][.]|[01])\s*\)$/gm;d=_findRGBColorInformation(_findRange(a,o),_findMatches(c,u),!0)}else if(l==="hsl"){const u=/^\(\s*((?:360(?:\.0+)?|(?:36[0]|3[0-5][0-9]|[12][0-9][0-9]|[1-9]?[0-9])(?:\.\d+)?))\s*[\s,]\s*(100|\d{1,2}[.]\d*|\d{1,2})%\s*[\s,]\s*(100|\d{1,2}[.]\d*|\d{1,2})%\s*\)$/gm;d=_findHSLColorInformation(_findRange(a,o),_findMatches(c,u),!1)}else if(l==="hsla"){const u=/^\(\s*((?:360(?:\.0+)?|(?:36[0]|3[0-5][0-9]|[12][0-9][0-9]|[1-9]?[0-9])(?:\.\d+)?))\s*[\s,]\s*(100|\d{1,2}[.]\d*|\d{1,2})%\s*[\s,]\s*(100|\d{1,2}[.]\d*|\d{1,2})%\s*[\s,]\s*(0[.][0-9]+|[.][0-9]+|[01][.]0*|[01])\s*\)$/gm;d=_findHSLColorInformation(_findRange(a,o),_findMatches(c,u),!0)}else l==="#"&&(d=_findHexColorInformation(_findRange(a,o),l+c));d&&e.push(d)}return e}function computeDefaultDocumentColors(a){return!a||typeof a.getValue!="function"||typeof a.positionAt!="function"?[]:computeColors(a)}const trimDashesRegex=/^-+|-+$/g,CHUNK_SIZE=100,MAX_SECTION_LINES=5;function findSectionHeaders(a,e){var s;let t=[];if(e.findRegionSectionHeaders&&((s=e.foldingRules)!=null&&s.markers)){const o=collectRegionHeaders(a,e);t=t.concat(o)}if(e.findMarkSectionHeaders){const o=collectMarkHeaders(a,e);t=t.concat(o)}return t}function collectRegionHeaders(a,e){const t=[],s=a.getLineCount();for(let o=1;o<=s;o++){const r=a.getLineContent(o),l=r.match(e.foldingRules.markers.start);if(l){const c={startLineNumber:o,startColumn:l[0].length+1,endLineNumber:o,endColumn:r.length+1};if(c.endColumn>c.startColumn){const d={range:c,...getHeaderText(r.substring(l[0].length)),shouldBeInComments:!1};(d.text||d.hasSeparatorLine)&&t.push(d)}}}return t}function collectMarkHeaders(a,e){const t=[],s=a.getLineCount();if(!e.markSectionHeaderRegex||e.markSectionHeaderRegex.trim()==="")return t;const o=isMultilineRegexSource(e.markSectionHeaderRegex),r=new RegExp(e.markSectionHeaderRegex,`gdm${o?"s":""}`);if(regExpLeadsToEndlessLoop(r))return t;for(let l=1;l<=s;l+=CHUNK_SIZE-MAX_SECTION_LINES){const c=Math.min(l+CHUNK_SIZE-1,s),d=[];for(let f=l;f<=c;f++)d.push(a.getLineContent(f));const u=d.join(`
`);r.lastIndex=0;let g;for(;(g=r.exec(u))!==null;){const f=u.substring(0,g.index),p=(f.match(/\n/g)||[]).length,m=l+p,_=g[0].split(`
`),C=_.length,b=m+C-1,v=f.lastIndexOf(`
`)+1,S=g.index-v+1,y=_[_.length-1],w=C===1?S+g[0].length:y.length+1,L={startLineNumber:m,startColumn:S,endLineNumber:b,endColumn:w},x=(g.groups??{}).label??"",E=((g.groups??{}).separator??"")!=="",I={range:L,text:x,hasSeparatorLine:E,shouldBeInComments:!0};(I.text||I.hasSeparatorLine)&&(t.length===0||t[t.length-1].range.endLineNumber<I.range.startLineNumber)&&t.push(I),r.lastIndex=g.index+g[0].length}}return t}function getHeaderText(a){a=a.trim();const e=a.startsWith("-");return a=a.replace(trimDashesRegex,""),{text:a,hasSeparatorLine:e}}class MirrorTextModel{constructor(e,t,s,o){this._uri=e,this._lines=t,this._eol=s,this._versionId=o,this._lineStarts=null,this._cachedTextValue=null}dispose(){this._lines.length=0}get version(){return this._versionId}getText(){return this._cachedTextValue===null&&(this._cachedTextValue=this._lines.join(this._eol)),this._cachedTextValue}onEvents(e){e.eol&&e.eol!==this._eol&&(this._eol=e.eol,this._lineStarts=null);const t=e.changes;for(const s of t)this._acceptDeleteRange(s.range),this._acceptInsertText(new Position$1(s.range.startLineNumber,s.range.startColumn),s.text);this._versionId=e.versionId,this._cachedTextValue=null}_ensureLineStarts(){if(!this._lineStarts){const e=this._eol.length,t=this._lines.length,s=new Uint32Array(t);for(let o=0;o<t;o++)s[o]=this._lines[o].length+e;this._lineStarts=new PrefixSumComputer(s)}}_setLineText(e,t){this._lines[e]=t,this._lineStarts&&this._lineStarts.setValue(e,this._lines[e].length+this._eol.length)}_acceptDeleteRange(e){if(e.startLineNumber===e.endLineNumber){if(e.startColumn===e.endColumn)return;this._setLineText(e.startLineNumber-1,this._lines[e.startLineNumber-1].substring(0,e.startColumn-1)+this._lines[e.startLineNumber-1].substring(e.endColumn-1));return}this._setLineText(e.startLineNumber-1,this._lines[e.startLineNumber-1].substring(0,e.startColumn-1)+this._lines[e.endLineNumber-1].substring(e.endColumn-1)),this._lines.splice(e.startLineNumber,e.endLineNumber-e.startLineNumber),this._lineStarts&&this._lineStarts.removeValues(e.startLineNumber,e.endLineNumber-e.startLineNumber)}_acceptInsertText(e,t){if(t.length===0)return;const s=splitLines(t);if(s.length===1){this._setLineText(e.lineNumber-1,this._lines[e.lineNumber-1].substring(0,e.column-1)+s[0]+this._lines[e.lineNumber-1].substring(e.column-1));return}s[s.length-1]+=this._lines[e.lineNumber-1].substring(e.column-1),this._setLineText(e.lineNumber-1,this._lines[e.lineNumber-1].substring(0,e.column-1)+s[0]);const o=new Uint32Array(s.length-1);for(let r=1;r<s.length;r++)this._lines.splice(e.lineNumber+r-1,0,s[r]),o[r-1]=s[r].length+this._eol.length;this._lineStarts&&this._lineStarts.insertValues(e.lineNumber,o)}}const STOP_SYNC_MODEL_DELTA_TIME_MS=60*1e3;class WorkerTextModelSyncClient extends Disposable{constructor(e,t,s=!1){if(super(),this._syncedModels=Object.create(null),this._syncedModelsLastUsedTime=Object.create(null),this._proxy=e,this._modelService=t,!s){const o=new IntervalTimer;o.cancelAndSet(()=>this._checkStopModelSync(),Math.round(STOP_SYNC_MODEL_DELTA_TIME_MS/2)),this._register(o)}}dispose(){for(const e in this._syncedModels)dispose(this._syncedModels[e]);this._syncedModels=Object.create(null),this._syncedModelsLastUsedTime=Object.create(null),super.dispose()}ensureSyncedResources(e,t=!1){for(const s of e){const o=s.toString();this._syncedModels[o]||this._beginModelSync(s,t),this._syncedModels[o]&&(this._syncedModelsLastUsedTime[o]=new Date().getTime())}}_checkStopModelSync(){const e=new Date().getTime(),t=[];for(const s in this._syncedModelsLastUsedTime)e-this._syncedModelsLastUsedTime[s]>STOP_SYNC_MODEL_DELTA_TIME_MS&&t.push(s);for(const s of t)this._stopModelSync(s)}_beginModelSync(e,t){const s=this._modelService.getModel(e);if(!s||!t&&s.isTooLargeForSyncing())return;const o=e.toString();this._proxy.$acceptNewModel({url:s.uri.toString(),lines:s.getLinesContent(),EOL:s.getEOL(),versionId:s.getVersionId()});const r=new DisposableStore;r.add(s.onDidChangeContent(l=>{this._proxy.$acceptModelChanged(o.toString(),l)})),r.add(s.onWillDispose(()=>{this._stopModelSync(o)})),r.add(toDisposable(()=>{this._proxy.$acceptRemovedModel(o)})),this._syncedModels[o]=r}_stopModelSync(e){const t=this._syncedModels[e];delete this._syncedModels[e],delete this._syncedModelsLastUsedTime[e],dispose(t)}}class WorkerTextModelSyncServer{constructor(){this._models=Object.create(null)}getModel(e){return this._models[e]}getModels(){const e=[];return Object.keys(this._models).forEach(t=>e.push(this._models[t])),e}$acceptNewModel(e){this._models[e.url]=new MirrorModel(URI.parse(e.url),e.lines,e.EOL,e.versionId)}$acceptModelChanged(e,t){if(!this._models[e])return;this._models[e].onEvents(t)}$acceptRemovedModel(e){this._models[e]&&delete this._models[e]}}class MirrorModel extends MirrorTextModel{get uri(){return this._uri}get eol(){return this._eol}getValue(){return this.getText()}findMatches(e){const t=[];for(let s=0;s<this._lines.length;s++){const o=this._lines[s],r=this.offsetAt(new Position$1(s+1,1)),l=o.matchAll(e);for(const c of l)(c.index||c.index===0)&&(c.index=c.index+r),t.push(c)}return t}getLinesContent(){return this._lines.slice(0)}getLineCount(){return this._lines.length}getLineContent(e){return this._lines[e-1]}getWordAtPosition(e,t){const s=getWordAtText(e.column,ensureValidWordDefinition(t),this._lines[e.lineNumber-1],0);return s?new Range$2(e.lineNumber,s.startColumn,e.lineNumber,s.endColumn):null}words(e){const t=this._lines,s=this._wordenize.bind(this);let o=0,r="",l=0,c=[];return{*[Symbol.iterator](){for(;;)if(l<c.length){const d=r.substring(c[l].start,c[l].end);l+=1,yield d}else if(o<t.length)r=t[o],c=s(r,e),l=0,o+=1;else break}}}getLineWords(e,t){const s=this._lines[e-1],o=this._wordenize(s,t),r=[];for(const l of o)r.push({word:s.substring(l.start,l.end),startColumn:l.start+1,endColumn:l.end+1});return r}_wordenize(e,t){const s=[];let o;for(t.lastIndex=0;(o=t.exec(e))&&o[0].length!==0;)s.push({start:o.index,end:o.index+o[0].length});return s}getValueInRange(e){if(e=this._validateRange(e),e.startLineNumber===e.endLineNumber)return this._lines[e.startLineNumber-1].substring(e.startColumn-1,e.endColumn-1);const t=this._eol,s=e.startLineNumber-1,o=e.endLineNumber-1,r=[];r.push(this._lines[s].substring(e.startColumn-1));for(let l=s+1;l<o;l++)r.push(this._lines[l]);return r.push(this._lines[o].substring(0,e.endColumn-1)),r.join(t)}offsetAt(e){return e=this._validatePosition(e),this._ensureLineStarts(),this._lineStarts.getPrefixSum(e.lineNumber-2)+(e.column-1)}positionAt(e){e=Math.floor(e),e=Math.max(0,e),this._ensureLineStarts();const t=this._lineStarts.getIndexOf(e),s=this._lines[t.index].length;return{lineNumber:1+t.index,column:1+Math.min(t.remainder,s)}}_validateRange(e){const t=this._validatePosition({lineNumber:e.startLineNumber,column:e.startColumn}),s=this._validatePosition({lineNumber:e.endLineNumber,column:e.endColumn});return t.lineNumber!==e.startLineNumber||t.column!==e.startColumn||s.lineNumber!==e.endLineNumber||s.column!==e.endColumn?{startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:s.lineNumber,endColumn:s.column}:e}_validatePosition(e){if(!Position$1.isIPosition(e))throw new Error("bad position");let{lineNumber:t,column:s}=e,o=!1;if(t<1)t=1,s=1,o=!0;else if(t>this._lines.length)t=this._lines.length,s=this._lines[t-1].length+1,o=!0;else{const r=this._lines[t-1].length+1;s<1?(s=1,o=!0):s>r&&(s=r,o=!0)}return o?{lineNumber:t,column:s}:e}}const xt=class xt{constructor(e=null){this._foreignModule=e,this._workerTextModelSyncServer=new WorkerTextModelSyncServer}dispose(){}async $ping(){return"pong"}_getModel(e){return this._workerTextModelSyncServer.getModel(e)}getModels(){return this._workerTextModelSyncServer.getModels()}$acceptNewModel(e){this._workerTextModelSyncServer.$acceptNewModel(e)}$acceptModelChanged(e,t){this._workerTextModelSyncServer.$acceptModelChanged(e,t)}$acceptRemovedModel(e){this._workerTextModelSyncServer.$acceptRemovedModel(e)}async $computeUnicodeHighlights(e,t,s){const o=this._getModel(e);return o?UnicodeTextModelHighlighter.computeUnicodeHighlights(o,t,s):{ranges:[],hasMore:!1,ambiguousCharacterCount:0,invisibleCharacterCount:0,nonBasicAsciiCharacterCount:0}}async $findSectionHeaders(e,t){const s=this._getModel(e);return s?findSectionHeaders(s,t):[]}async $computeDiff(e,t,s,o){const r=this._getModel(e),l=this._getModel(t);return!r||!l?null:xt.computeDiff(r,l,s,o)}static computeDiff(e,t,s,o){const r=o==="advanced"?linesDiffComputers.getDefault():linesDiffComputers.getLegacy(),l=e.getLinesContent(),c=t.getLinesContent(),d=r.computeDiff(l,c,s),u=d.changes.length>0?!1:this._modelsAreIdentical(e,t);function g(f){return f.map(p=>{var m;return[p.original.startLineNumber,p.original.endLineNumberExclusive,p.modified.startLineNumber,p.modified.endLineNumberExclusive,(m=p.innerChanges)==null?void 0:m.map(_=>[_.originalRange.startLineNumber,_.originalRange.startColumn,_.originalRange.endLineNumber,_.originalRange.endColumn,_.modifiedRange.startLineNumber,_.modifiedRange.startColumn,_.modifiedRange.endLineNumber,_.modifiedRange.endColumn])]})}return{identical:u,quitEarly:d.hitTimeout,changes:g(d.changes),moves:d.moves.map(f=>[f.lineRangeMapping.original.startLineNumber,f.lineRangeMapping.original.endLineNumberExclusive,f.lineRangeMapping.modified.startLineNumber,f.lineRangeMapping.modified.endLineNumberExclusive,g(f.changes)])}}static _modelsAreIdentical(e,t){const s=e.getLineCount(),o=t.getLineCount();if(s!==o)return!1;for(let r=1;r<=s;r++){const l=e.getLineContent(r),c=t.getLineContent(r);if(l!==c)return!1}return!0}async $computeMoreMinimalEdits(e,t,s){const o=this._getModel(e);if(!o)return t;const r=[];let l;t=t.slice(0).sort((d,u)=>{if(d.range&&u.range)return Range$2.compareRangesUsingStarts(d.range,u.range);const g=d.range?0:1,f=u.range?0:1;return g-f});let c=0;for(let d=1;d<t.length;d++)Range$2.getEndPosition(t[c].range).equals(Range$2.getStartPosition(t[d].range))?(t[c].range=Range$2.fromPositions(Range$2.getStartPosition(t[c].range),Range$2.getEndPosition(t[d].range)),t[c].text+=t[d].text):(c++,t[c]=t[d]);t.length=c+1;for(let{range:d,text:u,eol:g}of t){if(typeof g=="number"&&(l=g),Range$2.isEmpty(d)&&!u)continue;const f=o.getValueInRange(d);if(u=u.replace(/\r\n|\n|\r/g,o.eol),f===u)continue;if(Math.max(u.length,f.length)>xt._diffLimit){r.push({range:d,text:u});continue}const p=stringDiff(f,u,s),m=o.offsetAt(Range$2.lift(d).getStartPosition());for(const _ of p){const C=o.positionAt(m+_.originalStart),b=o.positionAt(m+_.originalStart+_.originalLength),v={text:u.substr(_.modifiedStart,_.modifiedLength),range:{startLineNumber:C.lineNumber,startColumn:C.column,endLineNumber:b.lineNumber,endColumn:b.column}};o.getValueInRange(v.range)!==v.text&&r.push(v)}}return typeof l=="number"&&r.push({eol:l,text:"",range:{startLineNumber:0,startColumn:0,endLineNumber:0,endColumn:0}}),r}async $computeLinks(e){const t=this._getModel(e);return t?computeLinks(t):null}async $computeDefaultDocumentColors(e){const t=this._getModel(e);return t?computeDefaultDocumentColors(t):null}async $textualSuggest(e,t,s,o){const r=new StopWatch,l=new RegExp(s,o),c=new Set;e:for(const d of e){const u=this._getModel(d);if(u){for(const g of u.words(l))if(!(g===t||!isNaN(Number(g)))&&(c.add(g),c.size>xt._suggestionsLimit))break e}}return{words:Array.from(c),duration:r.elapsed()}}async $computeWordRanges(e,t,s,o){const r=this._getModel(e);if(!r)return Object.create(null);const l=new RegExp(s,o),c=Object.create(null);for(let d=t.startLineNumber;d<t.endLineNumber;d++){const u=r.getLineWords(d,l);for(const g of u){if(!isNaN(Number(g.word)))continue;let f=c[g.word];f||(f=[],c[g.word]=f),f.push({startLineNumber:d,startColumn:g.startColumn,endLineNumber:d,endColumn:g.endColumn})}}return c}async $navigateValueSet(e,t,s,o,r){const l=this._getModel(e);if(!l)return null;const c=new RegExp(o,r);t.startColumn===t.endColumn&&(t={startLineNumber:t.startLineNumber,startColumn:t.startColumn,endLineNumber:t.endLineNumber,endColumn:t.endColumn+1});const d=l.getValueInRange(t),u=l.getWordAtPosition({lineNumber:t.startLineNumber,column:t.startColumn},c);if(!u)return null;const g=l.getValueInRange(u);return BasicInplaceReplace.INSTANCE.navigateValueSet(t,d,u,g,s)}$fmr(e,t){if(!this._foreignModule||typeof this._foreignModule[e]!="function")return Promise.reject(new Error("Missing requestHandler or method: "+e));try{return Promise.resolve(this._foreignModule[e].apply(this._foreignModule,t))}catch(s){return Promise.reject(s)}}};xt._diffLimit=1e5,xt._suggestionsLimit=1e4;let EditorWorker=xt;typeof importScripts=="function"&&(globalThis.monaco=createMonacoBaseAPI());const yn=class yn{static getChannel(e){return e.getChannel(yn.CHANNEL_NAME)}static setChannel(e,t){e.setChannel(yn.CHANNEL_NAME,t)}};yn.CHANNEL_NAME="editorWorkerHost";let EditorWorkerHost=yn;var __decorate$u=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$t=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const STOP_WORKER_DELTA_TIME_MS=5*60*1e3;function canSyncModel(a,e){const t=a.getModel(e);return!(!t||t.isTooLargeForSyncing())}let EditorWorkerService=class extends Disposable{constructor(e,t,s,o,r,l){super(),this._languageConfigurationService=r,this._modelService=t,this._workerManager=this._register(new WorkerManager$1(e,this._modelService)),this._logService=o,this._register(l.linkProvider.register({language:"*",hasAccessToAllModels:!0},{provideLinks:async(c,d)=>{if(!canSyncModel(this._modelService,c.uri))return Promise.resolve({links:[]});const g=await(await this._workerWithResources([c.uri])).$computeLinks(c.uri.toString());return g&&{links:g}}})),this._register(l.completionProvider.register("*",new WordBasedCompletionItemProvider(this._workerManager,s,this._modelService,this._languageConfigurationService,this._logService)))}dispose(){super.dispose()}canComputeUnicodeHighlights(e){return canSyncModel(this._modelService,e)}async computedUnicodeHighlights(e,t,s){return(await this._workerWithResources([e])).$computeUnicodeHighlights(e.toString(),t,s)}async computeDiff(e,t,s,o){const l=await(await this._workerWithResources([e,t],!0)).$computeDiff(e.toString(),t.toString(),s,o);if(!l)return null;return{identical:l.identical,quitEarly:l.quitEarly,changes:d(l.changes),moves:l.moves.map(u=>new MovedText(new LineRangeMapping(new LineRange(u[0],u[1]),new LineRange(u[2],u[3])),d(u[4])))};function d(u){return u.map(g=>{var f;return new DetailedLineRangeMapping(new LineRange(g[0],g[1]),new LineRange(g[2],g[3]),(f=g[4])==null?void 0:f.map(p=>new RangeMapping(new Range$2(p[0],p[1],p[2],p[3]),new Range$2(p[4],p[5],p[6],p[7]))))})}}async computeMoreMinimalEdits(e,t,s=!1){if(isNonEmptyArray(t)){if(!canSyncModel(this._modelService,e))return Promise.resolve(t);const o=StopWatch.create(),r=this._workerWithResources([e]).then(l=>l.$computeMoreMinimalEdits(e.toString(),t,s));return r.finally(()=>this._logService.trace("FORMAT#computeMoreMinimalEdits",e.toString(!0),o.elapsed())),Promise.race([r,timeout(1e3).then(()=>t)])}else return Promise.resolve(void 0)}canNavigateValueSet(e){return canSyncModel(this._modelService,e)}async navigateValueSet(e,t,s){const o=this._modelService.getModel(e);if(!o)return null;const r=this._languageConfigurationService.getLanguageConfiguration(o.getLanguageId()).getWordDefinition(),l=r.source,c=r.flags;return(await this._workerWithResources([e])).$navigateValueSet(e.toString(),t,s,l,c)}canComputeWordRanges(e){return canSyncModel(this._modelService,e)}async computeWordRanges(e,t){const s=this._modelService.getModel(e);if(!s)return Promise.resolve(null);const o=this._languageConfigurationService.getLanguageConfiguration(s.getLanguageId()).getWordDefinition(),r=o.source,l=o.flags;return(await this._workerWithResources([e])).$computeWordRanges(e.toString(),t,r,l)}async findSectionHeaders(e,t){return(await this._workerWithResources([e])).$findSectionHeaders(e.toString(),t)}async computeDefaultDocumentColors(e){return(await this._workerWithResources([e])).$computeDefaultDocumentColors(e.toString())}async _workerWithResources(e,t=!1){return await(await this._workerManager.withWorker()).workerWithSyncedResources(e,t)}};EditorWorkerService=__decorate$u([__param$t(1,IModelService),__param$t(2,ITextResourceConfigurationService),__param$t(3,ILogService),__param$t(4,ILanguageConfigurationService),__param$t(5,ILanguageFeaturesService)],EditorWorkerService);class WordBasedCompletionItemProvider{constructor(e,t,s,o,r){this.languageConfigurationService=o,this.logService=r,this._debugDisplayName="wordbasedCompletions",this._workerManager=e,this._configurationService=t,this._modelService=s}async provideCompletionItems(e,t){const s=this._configurationService.getValue(e.uri,t,"editor");if(s.wordBasedSuggestions==="off")return;const o=[];if(s.wordBasedSuggestions==="currentDocument")canSyncModel(this._modelService,e.uri)&&o.push(e.uri);else for(const f of this._modelService.getModels())canSyncModel(this._modelService,f.uri)&&(f===e?o.unshift(f.uri):(s.wordBasedSuggestions==="allDocuments"||f.getLanguageId()===e.getLanguageId())&&o.push(f.uri));if(o.length===0)return;const r=this.languageConfigurationService.getLanguageConfiguration(e.getLanguageId()).getWordDefinition(),l=e.getWordAtPosition(t),c=l?new Range$2(t.lineNumber,l.startColumn,t.lineNumber,l.endColumn):Range$2.fromPositions(t),d=c.setEndPosition(t.lineNumber,t.column);this.logService.trace("[WordBasedCompletionItemProvider]",`word: "${(l==null?void 0:l.word)||""}", wordDef: "${r}", replace: [${c.toString()}], insert: [${d.toString()}]`);const g=await(await this._workerManager.withWorker()).textualSuggest(o,l==null?void 0:l.word,r);if(g)return{duration:g.duration,suggestions:g.words.map(f=>({kind:18,label:f,insertText:f,range:{insert:d,replace:c}}))}}}let WorkerManager$1=class extends Disposable{constructor(e,t){super(),this._workerDescriptor=e,this._modelService=t,this._editorWorkerClient=null,this._lastWorkerUsedTime=new Date().getTime(),this._register(new WindowIntervalTimer).cancelAndSet(()=>this._checkStopIdleWorker(),Math.round(STOP_WORKER_DELTA_TIME_MS/2),mainWindow),this._register(this._modelService.onModelRemoved(o=>this._checkStopEmptyWorker()))}dispose(){this._editorWorkerClient&&(this._editorWorkerClient.dispose(),this._editorWorkerClient=null),super.dispose()}_checkStopEmptyWorker(){if(!this._editorWorkerClient)return;this._modelService.getModels().length===0&&(this._editorWorkerClient.dispose(),this._editorWorkerClient=null)}_checkStopIdleWorker(){if(!this._editorWorkerClient)return;new Date().getTime()-this._lastWorkerUsedTime>STOP_WORKER_DELTA_TIME_MS&&(this._editorWorkerClient.dispose(),this._editorWorkerClient=null)}withWorker(){return this._lastWorkerUsedTime=new Date().getTime(),this._editorWorkerClient||(this._editorWorkerClient=new EditorWorkerClient(this._workerDescriptor,!1,this._modelService)),Promise.resolve(this._editorWorkerClient)}};WorkerManager$1=__decorate$u([__param$t(1,IModelService)],WorkerManager$1);class SynchronousWorkerClient{constructor(e){this._instance=e,this.proxy=this._instance}dispose(){this._instance.dispose()}setChannel(e,t){throw new Error("Not supported")}}let EditorWorkerClient=class extends Disposable{constructor(e,t,s){super(),this._workerDescriptorOrWorker=e,this._disposed=!1,this._modelService=s,this._keepIdleModels=t,this._worker=null,this._modelManager=null}fhr(e,t){throw new Error("Not implemented!")}_getOrCreateWorker(){if(!this._worker)try{this._worker=this._register(createWebWorker$3(this._workerDescriptorOrWorker)),EditorWorkerHost.setChannel(this._worker,this._createEditorWorkerHost())}catch(e){logOnceWebWorkerWarning(e),this._worker=this._createFallbackLocalWorker()}return this._worker}async _getProxy(){try{const e=this._getOrCreateWorker().proxy;return await e.$ping(),e}catch(e){return logOnceWebWorkerWarning(e),this._worker=this._createFallbackLocalWorker(),this._worker.proxy}}_createFallbackLocalWorker(){return new SynchronousWorkerClient(new EditorWorker(null))}_createEditorWorkerHost(){return{$fhr:(e,t)=>this.fhr(e,t)}}_getOrCreateModelManager(e){return this._modelManager||(this._modelManager=this._register(new WorkerTextModelSyncClient(e,this._modelService,this._keepIdleModels))),this._modelManager}async workerWithSyncedResources(e,t=!1){if(this._disposed)return Promise.reject(canceled());const s=await this._getProxy();return this._getOrCreateModelManager(s).ensureSyncedResources(e,t),s}async textualSuggest(e,t,s){const o=await this.workerWithSyncedResources(e),r=s.source,l=s.flags;return o.$textualSuggest(e.map(c=>c.toString()),t,r,l)}dispose(){super.dispose(),this._disposed=!0}};EditorWorkerClient=__decorate$u([__param$t(2,IModelService)],EditorWorkerClient);function createWebWorker$2(a,e){return new MonacoWebWorkerImpl(a,e)}class MonacoWebWorkerImpl extends EditorWorkerClient{constructor(e,t){super(t.worker,t.keepIdleModels||!1,e),this._foreignModuleHost=t.host||null,this._foreignProxy=this._getProxy().then(s=>new Proxy({},{get(o,r,l){if(r!=="then"){if(typeof r!="string")throw new Error("Not supported");return(...c)=>s.$fmr(r,c)}}}))}fhr(e,t){if(!this._foreignModuleHost||typeof this._foreignModuleHost[e]!="function")return Promise.reject(new Error("Missing method "+e+" or missing main thread foreign host."));try{return Promise.resolve(this._foreignModuleHost[e].apply(this._foreignModuleHost,t))}catch(s){return Promise.reject(s)}}getProxy(){return this._foreignProxy}withSyncedResources(e){return this.workerWithSyncedResources(e).then(t=>this.getProxy())}}function isFuzzyActionArr(a){return Array.isArray(a)}function isFuzzyAction(a){return!isFuzzyActionArr(a)}function isString(a){return typeof a=="string"}function isIAction(a){return!isString(a)}function empty(a){return!a}function fixCase(a,e){return a.ignoreCase&&e?e.toLowerCase():e}function sanitize(a){return a.replace(/[&<>'"_]/g,"-")}function log(a,e){console.log(`${a.languageId}: ${e}`)}function createError(a,e){return new Error(`${a.languageId}: ${e}`)}function substituteMatches(a,e,t,s,o){const r=/\$((\$)|(#)|(\d\d?)|[sS](\d\d?)|@(\w+))/g;let l=null;return e.replace(r,function(c,d,u,g,f,p,m,_,C){return empty(u)?empty(g)?!empty(f)&&f<s.length?fixCase(a,s[f]):!empty(m)&&a&&typeof a[m]=="string"?a[m]:(l===null&&(l=o.split("."),l.unshift(o)),!empty(p)&&p<l.length?fixCase(a,l[p]):""):fixCase(a,t):"$"})}function substituteMatchesRe(a,e,t){const s=/\$[sS](\d\d?)/g;let o=null;return e.replace(s,function(r,l){return o===null&&(o=t.split("."),o.unshift(t)),!empty(l)&&l<o.length?escapeRegExpCharacters(fixCase(a,o[l])):""})}function findRules(a,e){let t=e;for(;t&&t.length>0;){const s=a.tokenizer[t];if(s)return s;const o=t.lastIndexOf(".");o<0?t=null:t=t.substr(0,o)}return null}function stateExists(a,e){let t=e;for(;t&&t.length>0;){if(a.stateNames[t])return!0;const o=t.lastIndexOf(".");o<0?t=null:t=t.substr(0,o)}return!1}var __decorate$t=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$s=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},MonarchTokenizer_1;const CACHE_STACK_DEPTH=5,bo=class bo{static create(e,t){return this._INSTANCE.create(e,t)}constructor(e){this._maxCacheDepth=e,this._entries=Object.create(null)}create(e,t){if(e!==null&&e.depth>=this._maxCacheDepth)return new MonarchStackElement(e,t);let s=MonarchStackElement.getStackElementId(e);s.length>0&&(s+="|"),s+=t;let o=this._entries[s];return o||(o=new MonarchStackElement(e,t),this._entries[s]=o,o)}};bo._INSTANCE=new bo(CACHE_STACK_DEPTH);let MonarchStackElementFactory=bo;class MonarchStackElement{constructor(e,t){this.parent=e,this.state=t,this.depth=(this.parent?this.parent.depth:0)+1}static getStackElementId(e){let t="";for(;e!==null;)t.length>0&&(t+="|"),t+=e.state,e=e.parent;return t}static _equals(e,t){for(;e!==null&&t!==null;){if(e===t)return!0;if(e.state!==t.state)return!1;e=e.parent,t=t.parent}return e===null&&t===null}equals(e){return MonarchStackElement._equals(this,e)}push(e){return MonarchStackElementFactory.create(this,e)}pop(){return this.parent}popall(){let e=this;for(;e.parent;)e=e.parent;return e}switchTo(e){return MonarchStackElementFactory.create(this.parent,e)}}class EmbeddedLanguageData{constructor(e,t){this.languageId=e,this.state=t}equals(e){return this.languageId===e.languageId&&this.state.equals(e.state)}clone(){return this.state.clone()===this.state?this:new EmbeddedLanguageData(this.languageId,this.state)}}const vo=class vo{static create(e,t){return this._INSTANCE.create(e,t)}constructor(e){this._maxCacheDepth=e,this._entries=Object.create(null)}create(e,t){if(t!==null)return new MonarchLineState(e,t);if(e!==null&&e.depth>=this._maxCacheDepth)return new MonarchLineState(e,t);const s=MonarchStackElement.getStackElementId(e);let o=this._entries[s];return o||(o=new MonarchLineState(e,null),this._entries[s]=o,o)}};vo._INSTANCE=new vo(CACHE_STACK_DEPTH);let MonarchLineStateFactory=vo;class MonarchLineState{constructor(e,t){this.stack=e,this.embeddedLanguageData=t}clone(){return(this.embeddedLanguageData?this.embeddedLanguageData.clone():null)===this.embeddedLanguageData?this:MonarchLineStateFactory.create(this.stack,this.embeddedLanguageData)}equals(e){return!(e instanceof MonarchLineState)||!this.stack.equals(e.stack)?!1:this.embeddedLanguageData===null&&e.embeddedLanguageData===null?!0:this.embeddedLanguageData===null||e.embeddedLanguageData===null?!1:this.embeddedLanguageData.equals(e.embeddedLanguageData)}}class MonarchClassicTokensCollector{constructor(){this._tokens=[],this._languageId=null,this._lastTokenType=null,this._lastTokenLanguage=null}enterLanguage(e){this._languageId=e}emit(e,t){this._lastTokenType===t&&this._lastTokenLanguage===this._languageId||(this._lastTokenType=t,this._lastTokenLanguage=this._languageId,this._tokens.push(new Token$2(e,t,this._languageId)))}nestedLanguageTokenize(e,t,s,o){const r=s.languageId,l=s.state,c=TokenizationRegistry.get(r);if(!c)return this.enterLanguage(r),this.emit(o,""),l;const d=c.tokenize(e,t,l);if(o!==0)for(const u of d.tokens)this._tokens.push(new Token$2(u.offset+o,u.type,u.language));else this._tokens=this._tokens.concat(d.tokens);return this._lastTokenType=null,this._lastTokenLanguage=null,this._languageId=null,d.endState}finalize(e){return new TokenizationResult(this._tokens,e)}}class MonarchModernTokensCollector{constructor(e,t){this._languageService=e,this._theme=t,this._prependTokens=null,this._tokens=[],this._currentLanguageId=0,this._lastTokenMetadata=0}enterLanguage(e){this._currentLanguageId=this._languageService.languageIdCodec.encodeLanguageId(e)}emit(e,t){const s=this._theme.match(this._currentLanguageId,t)|1024;this._lastTokenMetadata!==s&&(this._lastTokenMetadata=s,this._tokens.push(e),this._tokens.push(s))}static _merge(e,t,s){const o=e!==null?e.length:0,r=t.length,l=s!==null?s.length:0;if(o===0&&r===0&&l===0)return new Uint32Array(0);if(o===0&&r===0)return s;if(r===0&&l===0)return e;const c=new Uint32Array(o+r+l);e!==null&&c.set(e);for(let d=0;d<r;d++)c[o+d]=t[d];return s!==null&&c.set(s,o+r),c}nestedLanguageTokenize(e,t,s,o){const r=s.languageId,l=s.state,c=TokenizationRegistry.get(r);if(!c)return this.enterLanguage(r),this.emit(o,""),l;const d=c.tokenizeEncoded(e,t,l);if(o!==0)for(let u=0,g=d.tokens.length;u<g;u+=2)d.tokens[u]+=o;return this._prependTokens=MonarchModernTokensCollector._merge(this._prependTokens,this._tokens,d.tokens),this._tokens=[],this._currentLanguageId=0,this._lastTokenMetadata=0,d.endState}finalize(e){return new EncodedTokenizationResult(MonarchModernTokensCollector._merge(this._prependTokens,this._tokens,null),e)}}let MonarchTokenizer=MonarchTokenizer_1=class extends Disposable{constructor(e,t,s,o,r){super(),this._configurationService=r,this._languageService=e,this._standaloneThemeService=t,this._languageId=s,this._lexer=o,this._embeddedLanguages=Object.create(null),this.embeddedLoaded=Promise.resolve(void 0);let l=!1;this._register(TokenizationRegistry.onDidChange(c=>{if(l)return;let d=!1;for(let u=0,g=c.changedLanguages.length;u<g;u++){const f=c.changedLanguages[u];if(this._embeddedLanguages[f]){d=!0;break}}d&&(l=!0,TokenizationRegistry.handleChange([this._languageId]),l=!1)})),this._maxTokenizationLineLength=this._configurationService.getValue("editor.maxTokenizationLineLength",{overrideIdentifier:this._languageId}),this._register(this._configurationService.onDidChangeConfiguration(c=>{c.affectsConfiguration("editor.maxTokenizationLineLength")&&(this._maxTokenizationLineLength=this._configurationService.getValue("editor.maxTokenizationLineLength",{overrideIdentifier:this._languageId}))}))}getLoadStatus(){const e=[];for(const t in this._embeddedLanguages){const s=TokenizationRegistry.get(t);if(s){if(s instanceof MonarchTokenizer_1){const o=s.getLoadStatus();o.loaded===!1&&e.push(o.promise)}continue}TokenizationRegistry.isResolved(t)||e.push(TokenizationRegistry.getOrCreate(t))}return e.length===0?{loaded:!0}:{loaded:!1,promise:Promise.all(e).then(t=>{})}}getInitialState(){const e=MonarchStackElementFactory.create(null,this._lexer.start);return MonarchLineStateFactory.create(e,null)}tokenize(e,t,s){if(e.length>=this._maxTokenizationLineLength)return nullTokenize(this._languageId,s);const o=new MonarchClassicTokensCollector,r=this._tokenize(e,t,s,o);return o.finalize(r)}tokenizeEncoded(e,t,s){if(e.length>=this._maxTokenizationLineLength)return nullTokenizeEncoded(this._languageService.languageIdCodec.encodeLanguageId(this._languageId),s);const o=new MonarchModernTokensCollector(this._languageService,this._standaloneThemeService.getColorTheme().tokenTheme),r=this._tokenize(e,t,s,o);return o.finalize(r)}_tokenize(e,t,s,o){return s.embeddedLanguageData?this._nestedTokenize(e,t,s,0,o):this._myTokenize(e,t,s,0,o)}_findLeavingNestedLanguageOffset(e,t){let s=this._lexer.tokenizer[t.stack.state];if(!s&&(s=findRules(this._lexer,t.stack.state),!s))throw createError(this._lexer,"tokenizer state is not defined: "+t.stack.state);let o=-1,r=!1;for(const l of s){if(!isIAction(l.action)||!(l.action.nextEmbedded==="@pop"||l.action.hasEmbeddedEndInCases))continue;r=!0;let c=l.resolveRegex(t.stack.state);const d=c.source;if(d.substr(0,4)==="^(?:"&&d.substr(d.length-1,1)===")"){const g=(c.ignoreCase?"i":"")+(c.unicode?"u":"");c=new RegExp(d.substr(4,d.length-5),g)}const u=e.search(c);u===-1||u!==0&&l.matchOnlyAtLineStart||(o===-1||u<o)&&(o=u)}if(!r)throw createError(this._lexer,'no rule containing nextEmbedded: "@pop" in tokenizer embedded state: '+t.stack.state);return o}_nestedTokenize(e,t,s,o,r){const l=this._findLeavingNestedLanguageOffset(e,s);if(l===-1){const u=r.nestedLanguageTokenize(e,t,s.embeddedLanguageData,o);return MonarchLineStateFactory.create(s.stack,new EmbeddedLanguageData(s.embeddedLanguageData.languageId,u))}const c=e.substring(0,l);c.length>0&&r.nestedLanguageTokenize(c,!1,s.embeddedLanguageData,o);const d=e.substring(l);return this._myTokenize(d,t,s,o+l,r)}_safeRuleName(e){return e?e.name:"(unknown)"}_myTokenize(e,t,s,o,r){r.enterLanguage(this._languageId);const l=e.length,c=t&&this._lexer.includeLF?e+`
`:e,d=c.length;let u=s.embeddedLanguageData,g=s.stack,f=0,p=null,m=!0;for(;m||f<d;){const _=f,C=g.depth,b=p?p.groups.length:0,v=g.state;let S=null,y=null,w=null,L=null,x=null;if(p){S=p.matches;const D=p.groups.shift();y=D.matched,w=D.action,L=p.rule,p.groups.length===0&&(p=null)}else{if(!m&&f>=d)break;m=!1;let D=this._lexer.tokenizer[v];if(!D&&(D=findRules(this._lexer,v),!D))throw createError(this._lexer,"tokenizer state is not defined: "+v);const k=c.substr(f);for(const N of D)if((f===0||!N.matchOnlyAtLineStart)&&(S=k.match(N.resolveRegex(v)),S)){y=S[0],w=N.action;break}}if(S||(S=[""],y=""),w||(f<d&&(S=[c.charAt(f)],y=S[0]),w=this._lexer.defaultToken),y===null)break;for(f+=y.length;isFuzzyAction(w)&&isIAction(w)&&w.test;)w=w.test(y,S,v,f===d);let E=null;if(typeof w=="string"||Array.isArray(w))E=w;else if(w.group)E=w.group;else if(w.token!==null&&w.token!==void 0){if(w.tokenSubst?E=substituteMatches(this._lexer,w.token,y,S,v):E=w.token,w.nextEmbedded)if(w.nextEmbedded==="@pop"){if(!u)throw createError(this._lexer,"cannot pop embedded language if not inside one");u=null}else{if(u)throw createError(this._lexer,"cannot enter embedded language from within an embedded language");x=substituteMatches(this._lexer,w.nextEmbedded,y,S,v)}if(w.goBack&&(f=Math.max(0,f-w.goBack)),w.switchTo&&typeof w.switchTo=="string"){let D=substituteMatches(this._lexer,w.switchTo,y,S,v);if(D[0]==="@"&&(D=D.substr(1)),findRules(this._lexer,D))g=g.switchTo(D);else throw createError(this._lexer,"trying to switch to a state '"+D+"' that is undefined in rule: "+this._safeRuleName(L))}else{if(w.transform&&typeof w.transform=="function")throw createError(this._lexer,"action.transform not supported");if(w.next)if(w.next==="@push"){if(g.depth>=this._lexer.maxStack)throw createError(this._lexer,"maximum tokenizer stack size reached: ["+g.state+","+g.parent.state+",...]");g=g.push(v)}else if(w.next==="@pop"){if(g.depth<=1)throw createError(this._lexer,"trying to pop an empty stack in rule: "+this._safeRuleName(L));g=g.pop()}else if(w.next==="@popall")g=g.popall();else{let D=substituteMatches(this._lexer,w.next,y,S,v);if(D[0]==="@"&&(D=D.substr(1)),findRules(this._lexer,D))g=g.push(D);else throw createError(this._lexer,"trying to set a next state '"+D+"' that is undefined in rule: "+this._safeRuleName(L))}}w.log&&typeof w.log=="string"&&log(this._lexer,this._lexer.languageId+": "+substituteMatches(this._lexer,w.log,y,S,v))}if(E===null)throw createError(this._lexer,"lexer rule has no well-defined action in rule: "+this._safeRuleName(L));const I=D=>{const k=this._languageService.getLanguageIdByLanguageName(D)||this._languageService.getLanguageIdByMimeType(D)||D,N=this._getNestedEmbeddedLanguageData(k);if(f<d){const R=e.substr(f);return this._nestedTokenize(R,t,MonarchLineStateFactory.create(g,N),o+f,r)}else return MonarchLineStateFactory.create(g,N)};if(Array.isArray(E)){if(p&&p.groups.length>0)throw createError(this._lexer,"groups cannot be nested: "+this._safeRuleName(L));if(S.length!==E.length+1)throw createError(this._lexer,"matched number of groups does not match the number of actions in rule: "+this._safeRuleName(L));let D=0;for(let k=1;k<S.length;k++)D+=S[k].length;if(D!==y.length)throw createError(this._lexer,"with groups, all characters should be matched in consecutive groups in rule: "+this._safeRuleName(L));p={rule:L,matches:S,groups:[]};for(let k=0;k<E.length;k++)p.groups[k]={action:E[k],matched:S[k+1]};f-=y.length;continue}else{if(E==="@rematch"&&(f-=y.length,y="",S=null,E="",x!==null))return I(x);if(y.length===0){if(d===0||C!==g.depth||v!==g.state||(p?p.groups.length:0)!==b)continue;throw createError(this._lexer,"no progress in tokenizer in rule: "+this._safeRuleName(L))}let D=null;if(isString(E)&&E.indexOf("@brackets")===0){const k=E.substr(9),N=findBracket(this._lexer,y);if(!N)throw createError(this._lexer,"@brackets token returned but no bracket defined as: "+y);D=sanitize(N.token+k)}else{const k=E===""?"":E+this._lexer.tokenPostfix;D=sanitize(k)}_<l&&r.emit(_+o,D)}if(x!==null)return I(x)}return MonarchLineStateFactory.create(g,u)}_getNestedEmbeddedLanguageData(e){if(!this._languageService.isRegisteredLanguageId(e))return new EmbeddedLanguageData(e,NullState);e!==this._languageId&&(this._languageService.requestBasicLanguageFeatures(e),TokenizationRegistry.getOrCreate(e),this._embeddedLanguages[e]=!0);const t=TokenizationRegistry.get(e);return t?new EmbeddedLanguageData(e,t.getInitialState()):new EmbeddedLanguageData(e,NullState)}};MonarchTokenizer=MonarchTokenizer_1=__decorate$t([__param$s(4,IConfigurationService)],MonarchTokenizer);function findBracket(a,e){if(!e)return null;e=fixCase(a,e);const t=a.brackets;for(const s of t){if(s.open===e)return{token:s.token,bracketType:1};if(s.close===e)return{token:s.token,bracketType:-1}}return null}const ttPolicy$1=createTrustedTypesPolicy$1("standaloneColorizer",{createHTML:a=>a});class Colorizer{static colorizeElement(e,t,s,o){o=o||{};const r=o.theme||"vs",l=o.mimeType||s.getAttribute("lang")||s.getAttribute("data-lang");if(!l)return console.error("Mode not detected"),Promise.resolve();const c=t.getLanguageIdByMimeType(l)||l;e.setTheme(r);const d=s.firstChild?s.firstChild.nodeValue:"";s.className+=" "+r;const u=g=>{const f=(ttPolicy$1==null?void 0:ttPolicy$1.createHTML(g))??g;s.innerHTML=f};return this.colorize(t,d||"",c,o).then(u,g=>console.error(g))}static async colorize(e,t,s,o){const r=e.languageIdCodec;let l=4;o&&typeof o.tabSize=="number"&&(l=o.tabSize),startsWithUTF8BOM(t)&&(t=t.substr(1));const c=splitLines(t);if(!e.isRegisteredLanguageId(s))return _fakeColorize(c,l,r);const d=await TokenizationRegistry.getOrCreate(s);return d?_colorize(c,l,d,r):_fakeColorize(c,l,r)}static colorizeLine(e,t,s,o,r=4){const l=ViewLineRenderingData.isBasicASCII(e,t),c=ViewLineRenderingData.containsRTL(e,l,s);return renderViewLine2(new RenderLineInput(!1,!0,e,!1,l,c,0,o,[],r,0,0,0,0,-1,"none",!1,!1,null,null,0)).html}static colorizeModelLine(e,t,s=4){const o=e.getLineContent(t);e.tokenization.forceTokenization(t);const l=e.tokenization.getLineTokens(t).inflate();return this.colorizeLine(o,e.mightContainNonBasicASCII(),e.mightContainRTL(),l,s)}}function _colorize(a,e,t,s){return new Promise((o,r)=>{const l=()=>{const c=_actualColorize(a,e,t,s);if(t instanceof MonarchTokenizer){const d=t.getLoadStatus();if(d.loaded===!1){d.promise.then(l,r);return}}o(c)};l()})}function _fakeColorize(a,e,t){let s=[];const r=new Uint32Array(2);r[0]=0,r[1]=33587200;for(let l=0,c=a.length;l<c;l++){const d=a[l];r[0]=d.length;const u=new LineTokens(r,d,t),g=ViewLineRenderingData.isBasicASCII(d,!0),f=ViewLineRenderingData.containsRTL(d,g,!0),p=renderViewLine2(new RenderLineInput(!1,!0,d,!1,g,f,0,u,[],e,0,0,0,0,-1,"none",!1,!1,null,null,0));s=s.concat(p.html),s.push("<br/>")}return s.join("")}function _actualColorize(a,e,t,s){let o=[],r=t.getInitialState();for(let l=0,c=a.length;l<c;l++){const d=a[l],u=t.tokenizeEncoded(d,!0,r);LineTokens.convertToEndOffset(u.tokens,d.length);const g=new LineTokens(u.tokens,d,s),f=ViewLineRenderingData.isBasicASCII(d,!0),p=ViewLineRenderingData.containsRTL(d,f,!0),m=renderViewLine2(new RenderLineInput(!1,!0,d,!1,f,p,0,g.inflate(),[],e,0,0,0,0,-1,"none",!1,!1,null,null,0));o=o.concat(m.html),o.push("<br/>"),r=u.endState}return o.join("")}var __decorate$s=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$r=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let AbstractCodeEditorService=class extends Disposable{constructor(e){super(),this._themeService=e,this._onWillCreateCodeEditor=this._register(new Emitter$1),this._onCodeEditorAdd=this._register(new Emitter$1),this.onCodeEditorAdd=this._onCodeEditorAdd.event,this._onCodeEditorRemove=this._register(new Emitter$1),this.onCodeEditorRemove=this._onCodeEditorRemove.event,this._onWillCreateDiffEditor=this._register(new Emitter$1),this._onDiffEditorAdd=this._register(new Emitter$1),this.onDiffEditorAdd=this._onDiffEditorAdd.event,this._onDiffEditorRemove=this._register(new Emitter$1),this.onDiffEditorRemove=this._onDiffEditorRemove.event,this._decorationOptionProviders=new Map,this._codeEditorOpenHandlers=new LinkedList,this._modelProperties=new Map,this._codeEditors=Object.create(null),this._diffEditors=Object.create(null),this._globalStyleSheet=null}willCreateCodeEditor(){this._onWillCreateCodeEditor.fire()}addCodeEditor(e){this._codeEditors[e.getId()]=e,this._onCodeEditorAdd.fire(e)}removeCodeEditor(e){delete this._codeEditors[e.getId()]&&this._onCodeEditorRemove.fire(e)}listCodeEditors(){return Object.keys(this._codeEditors).map(e=>this._codeEditors[e])}willCreateDiffEditor(){this._onWillCreateDiffEditor.fire()}addDiffEditor(e){this._diffEditors[e.getId()]=e,this._onDiffEditorAdd.fire(e)}listDiffEditors(){return Object.keys(this._diffEditors).map(e=>this._diffEditors[e])}getFocusedCodeEditor(){let e=null;const t=this.listCodeEditors();for(const s of t){if(s.hasTextFocus())return s;s.hasWidgetFocus()&&(e=s)}return e}removeDecorationType(e){const t=this._decorationOptionProviders.get(e);t&&(t.refCount--,t.refCount<=0&&(this._decorationOptionProviders.delete(e),t.dispose(),this.listCodeEditors().forEach(s=>s.removeDecorationsByType(e))))}setModelProperty(e,t,s){const o=e.toString();let r;this._modelProperties.has(o)?r=this._modelProperties.get(o):(r=new Map,this._modelProperties.set(o,r)),r.set(t,s)}getModelProperty(e,t){const s=e.toString();if(this._modelProperties.has(s))return this._modelProperties.get(s).get(t)}async openCodeEditor(e,t,s){for(const o of this._codeEditorOpenHandlers){const r=await o(e,t,s);if(r!==null)return r}return null}registerCodeEditorOpenHandler(e){const t=this._codeEditorOpenHandlers.unshift(e);return toDisposable(t)}};AbstractCodeEditorService=__decorate$s([__param$r(0,IThemeService)],AbstractCodeEditorService);var __decorate$r=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$q=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let StandaloneCodeEditorService=class extends AbstractCodeEditorService{constructor(e,t){super(t),this._register(this.onCodeEditorAdd(()=>this._checkContextKey())),this._register(this.onCodeEditorRemove(()=>this._checkContextKey())),this._editorIsOpen=e.createKey("editorIsOpen",!1),this._activeCodeEditor=null,this._register(this.registerCodeEditorOpenHandler(async(s,o,r)=>o?this.doOpenEditor(o,s):null))}_checkContextKey(){let e=!1;for(const t of this.listCodeEditors())if(!t.isSimpleWidget){e=!0;break}this._editorIsOpen.set(e)}setActiveCodeEditor(e){this._activeCodeEditor=e}getActiveCodeEditor(){return this._activeCodeEditor}doOpenEditor(e,t){if(!this.findModel(e,t.resource)){if(t.resource){const r=t.resource.scheme;if(r===Schemas.http||r===Schemas.https)return windowOpenNoOpener(t.resource.toString()),e}return null}const o=t.options?t.options.selection:null;if(o)if(typeof o.endLineNumber=="number"&&typeof o.endColumn=="number")e.setSelection(o),e.revealRangeInCenter(o,1);else{const r={lineNumber:o.startLineNumber,column:o.startColumn};e.setPosition(r),e.revealPositionInCenter(r,1)}return e}findModel(e,t){const s=e.getModel();return s&&s.uri.toString()!==t.toString()?null:s}};StandaloneCodeEditorService=__decorate$r([__param$q(0,IContextKeyService),__param$q(1,IThemeService)],StandaloneCodeEditorService);registerSingleton(ICodeEditorService,StandaloneCodeEditorService,0);var __decorate$q=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$p=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let StandaloneLayoutService=class{get mainContainer(){var e;return((e=this._codeEditorService.listCodeEditors().at(0))==null?void 0:e.getContainerDomNode())??mainWindow.document.body}get activeContainer(){const e=this._codeEditorService.getFocusedCodeEditor()??this._codeEditorService.getActiveCodeEditor();return(e==null?void 0:e.getContainerDomNode())??this.mainContainer}get mainContainerDimension(){return getClientArea(this.mainContainer)}get activeContainerDimension(){return getClientArea(this.activeContainer)}get containers(){return coalesce(this._codeEditorService.listCodeEditors().map(e=>e.getContainerDomNode()))}getContainer(){return this.activeContainer}whenContainerStylesLoaded(){}focus(){var e;(e=this._codeEditorService.getFocusedCodeEditor())==null||e.focus()}constructor(e){this._codeEditorService=e,this.onDidLayoutMainContainer=Event$1.None,this.onDidLayoutActiveContainer=Event$1.None,this.onDidLayoutContainer=Event$1.None,this.onDidChangeActiveContainer=Event$1.None,this.onDidAddContainer=Event$1.None,this.mainContainerOffset={top:0,quickPickTop:0},this.activeContainerOffset={top:0,quickPickTop:0}}};StandaloneLayoutService=__decorate$q([__param$p(0,ICodeEditorService)],StandaloneLayoutService);let EditorScopedLayoutService=class extends StandaloneLayoutService{get mainContainer(){return this._container}constructor(e,t){super(t),this._container=e}};EditorScopedLayoutService=__decorate$q([__param$p(1,ICodeEditorService)],EditorScopedLayoutService);registerSingleton(ILayoutService,StandaloneLayoutService,1);var __decorate$p=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$o=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};function getResourceLabel(a){return a.scheme===Schemas.file?a.fsPath:a.path}let stackElementCounter=0;class ResourceStackElement{constructor(e,t,s,o,r,l,c){this.id=++stackElementCounter,this.type=0,this.actual=e,this.label=e.label,this.confirmBeforeUndo=e.confirmBeforeUndo||!1,this.resourceLabel=t,this.strResource=s,this.resourceLabels=[this.resourceLabel],this.strResources=[this.strResource],this.groupId=o,this.groupOrder=r,this.sourceId=l,this.sourceOrder=c,this.isValid=!0}setValid(e){this.isValid=e}toString(){return`[id:${this.id}] [group:${this.groupId}] [${this.isValid?"  VALID":"INVALID"}] ${this.actual.constructor.name} - ${this.actual}`}}class ResourceReasonPair{constructor(e,t){this.resourceLabel=e,this.reason=t}}class RemovedResources{constructor(){this.elements=new Map}createMessage(){const e=[],t=[];for(const[,o]of this.elements)(o.reason===0?e:t).push(o.resourceLabel);const s=[];return e.length>0&&s.push(localize(2012,"The following files have been closed and modified on disk: {0}.",e.join(", "))),t.length>0&&s.push(localize(2013,"The following files have been modified in an incompatible way: {0}.",t.join(", "))),s.join(`
`)}get size(){return this.elements.size}has(e){return this.elements.has(e)}set(e,t){this.elements.set(e,t)}delete(e){return this.elements.delete(e)}}class WorkspaceStackElement{constructor(e,t,s,o,r,l,c){this.id=++stackElementCounter,this.type=1,this.actual=e,this.label=e.label,this.confirmBeforeUndo=e.confirmBeforeUndo||!1,this.resourceLabels=t,this.strResources=s,this.groupId=o,this.groupOrder=r,this.sourceId=l,this.sourceOrder=c,this.removedResources=null,this.invalidatedResources=null}canSplit(){return typeof this.actual.split=="function"}removeResource(e,t,s){this.removedResources||(this.removedResources=new RemovedResources),this.removedResources.has(t)||this.removedResources.set(t,new ResourceReasonPair(e,s))}setValid(e,t,s){s?this.invalidatedResources&&(this.invalidatedResources.delete(t),this.invalidatedResources.size===0&&(this.invalidatedResources=null)):(this.invalidatedResources||(this.invalidatedResources=new RemovedResources),this.invalidatedResources.has(t)||this.invalidatedResources.set(t,new ResourceReasonPair(e,0)))}toString(){return`[id:${this.id}] [group:${this.groupId}] [${this.invalidatedResources?"INVALID":"  VALID"}] ${this.actual.constructor.name} - ${this.actual}`}}class ResourceEditStack{constructor(e,t){this.resourceLabel=e,this.strResource=t,this._past=[],this._future=[],this.locked=!1,this.versionId=1}dispose(){for(const e of this._past)e.type===1&&e.removeResource(this.resourceLabel,this.strResource,0);for(const e of this._future)e.type===1&&e.removeResource(this.resourceLabel,this.strResource,0);this.versionId++}toString(){const e=[];e.push(`* ${this.strResource}:`);for(let t=0;t<this._past.length;t++)e.push(`   * [UNDO] ${this._past[t]}`);for(let t=this._future.length-1;t>=0;t--)e.push(`   * [REDO] ${this._future[t]}`);return e.join(`
`)}flushAllElements(){this._past=[],this._future=[],this.versionId++}_setElementValidFlag(e,t){e.type===1?e.setValid(this.resourceLabel,this.strResource,t):e.setValid(t)}setElementsValidFlag(e,t){for(const s of this._past)t(s.actual)&&this._setElementValidFlag(s,e);for(const s of this._future)t(s.actual)&&this._setElementValidFlag(s,e)}pushElement(e){for(const t of this._future)t.type===1&&t.removeResource(this.resourceLabel,this.strResource,1);this._future=[],this._past.push(e),this.versionId++}createSnapshot(e){const t=[];for(let s=0,o=this._past.length;s<o;s++)t.push(this._past[s].id);for(let s=this._future.length-1;s>=0;s--)t.push(this._future[s].id);return new ResourceEditStackSnapshot(e,t)}restoreSnapshot(e){const t=e.elements.length;let s=!0,o=0,r=-1;for(let c=0,d=this._past.length;c<d;c++,o++){const u=this._past[c];s&&(o>=t||u.id!==e.elements[o])&&(s=!1,r=0),!s&&u.type===1&&u.removeResource(this.resourceLabel,this.strResource,0)}let l=-1;for(let c=this._future.length-1;c>=0;c--,o++){const d=this._future[c];s&&(o>=t||d.id!==e.elements[o])&&(s=!1,l=c),!s&&d.type===1&&d.removeResource(this.resourceLabel,this.strResource,0)}r!==-1&&(this._past=this._past.slice(0,r)),l!==-1&&(this._future=this._future.slice(l+1)),this.versionId++}getElements(){const e=[],t=[];for(const s of this._past)e.push(s.actual);for(const s of this._future)t.push(s.actual);return{past:e,future:t}}getClosestPastElement(){return this._past.length===0?null:this._past[this._past.length-1]}getSecondClosestPastElement(){return this._past.length<2?null:this._past[this._past.length-2]}getClosestFutureElement(){return this._future.length===0?null:this._future[this._future.length-1]}hasPastElements(){return this._past.length>0}hasFutureElements(){return this._future.length>0}splitPastWorkspaceElement(e,t){for(let s=this._past.length-1;s>=0;s--)if(this._past[s]===e){t.has(this.strResource)?this._past[s]=t.get(this.strResource):this._past.splice(s,1);break}this.versionId++}splitFutureWorkspaceElement(e,t){for(let s=this._future.length-1;s>=0;s--)if(this._future[s]===e){t.has(this.strResource)?this._future[s]=t.get(this.strResource):this._future.splice(s,1);break}this.versionId++}moveBackward(e){this._past.pop(),this._future.push(e),this.versionId++}moveForward(e){this._future.pop(),this._past.push(e),this.versionId++}}class EditStackSnapshot{constructor(e){this.editStacks=e,this._versionIds=[];for(let t=0,s=this.editStacks.length;t<s;t++)this._versionIds[t]=this.editStacks[t].versionId}isValid(){for(let e=0,t=this.editStacks.length;e<t;e++)if(this._versionIds[e]!==this.editStacks[e].versionId)return!1;return!0}}const missingEditStack=new ResourceEditStack("","");missingEditStack.locked=!0;let UndoRedoService=class{constructor(e,t){this._dialogService=e,this._notificationService=t,this._editStacks=new Map,this._uriComparisonKeyComputers=[]}getUriComparisonKey(e){for(const t of this._uriComparisonKeyComputers)if(t[0]===e.scheme)return t[1].getComparisonKey(e);return e.toString()}_print(e){console.log("------------------------------------"),console.log(`AFTER ${e}: `);const t=[];for(const s of this._editStacks)t.push(s[1].toString());console.log(t.join(`
`))}pushElement(e,t=UndoRedoGroup.None,s=UndoRedoSource.None){if(e.type===0){const o=getResourceLabel(e.resource),r=this.getUriComparisonKey(e.resource);this._pushElement(new ResourceStackElement(e,o,r,t.id,t.nextOrder(),s.id,s.nextOrder()))}else{const o=new Set,r=[],l=[];for(const c of e.resources){const d=getResourceLabel(c),u=this.getUriComparisonKey(c);o.has(u)||(o.add(u),r.push(d),l.push(u))}r.length===1?this._pushElement(new ResourceStackElement(e,r[0],l[0],t.id,t.nextOrder(),s.id,s.nextOrder())):this._pushElement(new WorkspaceStackElement(e,r,l,t.id,t.nextOrder(),s.id,s.nextOrder()))}}_pushElement(e){for(let t=0,s=e.strResources.length;t<s;t++){const o=e.resourceLabels[t],r=e.strResources[t];let l;this._editStacks.has(r)?l=this._editStacks.get(r):(l=new ResourceEditStack(o,r),this._editStacks.set(r,l)),l.pushElement(e)}}getLastElement(e){const t=this.getUriComparisonKey(e);if(this._editStacks.has(t)){const s=this._editStacks.get(t);if(s.hasFutureElements())return null;const o=s.getClosestPastElement();return o?o.actual:null}return null}_splitPastWorkspaceElement(e,t){const s=e.actual.split(),o=new Map;for(const r of s){const l=getResourceLabel(r.resource),c=this.getUriComparisonKey(r.resource),d=new ResourceStackElement(r,l,c,0,0,0,0);o.set(d.strResource,d)}for(const r of e.strResources){if(t&&t.has(r))continue;this._editStacks.get(r).splitPastWorkspaceElement(e,o)}}_splitFutureWorkspaceElement(e,t){const s=e.actual.split(),o=new Map;for(const r of s){const l=getResourceLabel(r.resource),c=this.getUriComparisonKey(r.resource),d=new ResourceStackElement(r,l,c,0,0,0,0);o.set(d.strResource,d)}for(const r of e.strResources){if(t&&t.has(r))continue;this._editStacks.get(r).splitFutureWorkspaceElement(e,o)}}removeElements(e){const t=typeof e=="string"?e:this.getUriComparisonKey(e);this._editStacks.has(t)&&(this._editStacks.get(t).dispose(),this._editStacks.delete(t))}setElementsValidFlag(e,t,s){const o=this.getUriComparisonKey(e);this._editStacks.has(o)&&this._editStacks.get(o).setElementsValidFlag(t,s)}createSnapshot(e){const t=this.getUriComparisonKey(e);return this._editStacks.has(t)?this._editStacks.get(t).createSnapshot(e):new ResourceEditStackSnapshot(e,[])}restoreSnapshot(e){const t=this.getUriComparisonKey(e.resource);if(this._editStacks.has(t)){const s=this._editStacks.get(t);s.restoreSnapshot(e),!s.hasPastElements()&&!s.hasFutureElements()&&(s.dispose(),this._editStacks.delete(t))}}getElements(e){const t=this.getUriComparisonKey(e);return this._editStacks.has(t)?this._editStacks.get(t).getElements():{past:[],future:[]}}_findClosestUndoElementWithSource(e){if(!e)return[null,null];let t=null,s=null;for(const[o,r]of this._editStacks){const l=r.getClosestPastElement();l&&l.sourceId===e&&(!t||l.sourceOrder>t.sourceOrder)&&(t=l,s=o)}return[t,s]}canUndo(e){if(e instanceof UndoRedoSource){const[,s]=this._findClosestUndoElementWithSource(e.id);return!!s}const t=this.getUriComparisonKey(e);return this._editStacks.has(t)?this._editStacks.get(t).hasPastElements():!1}_onError(e,t){onUnexpectedError(e);for(const s of t.strResources)this.removeElements(s);this._notificationService.error(e)}_acquireLocks(e){for(const t of e.editStacks)if(t.locked)throw new Error("Cannot acquire edit stack lock");for(const t of e.editStacks)t.locked=!0;return()=>{for(const t of e.editStacks)t.locked=!1}}_safeInvokeWithLocks(e,t,s,o,r){const l=this._acquireLocks(s);let c;try{c=t()}catch(d){return l(),o.dispose(),this._onError(d,e)}return c?c.then(()=>(l(),o.dispose(),r()),d=>(l(),o.dispose(),this._onError(d,e))):(l(),o.dispose(),r())}async _invokeWorkspacePrepare(e){if(typeof e.actual.prepareUndoRedo>"u")return Disposable.None;const t=e.actual.prepareUndoRedo();return typeof t>"u"?Disposable.None:t}_invokeResourcePrepare(e,t){if(e.actual.type!==1||typeof e.actual.prepareUndoRedo>"u")return t(Disposable.None);const s=e.actual.prepareUndoRedo();return s?isDisposable(s)?t(s):s.then(o=>t(o)):t(Disposable.None)}_getAffectedEditStacks(e){const t=[];for(const s of e.strResources)t.push(this._editStacks.get(s)||missingEditStack);return new EditStackSnapshot(t)}_tryToSplitAndUndo(e,t,s,o){if(t.canSplit())return this._splitPastWorkspaceElement(t,s),this._notificationService.warn(o),new WorkspaceVerificationError(this._undo(e,0,!0));for(const r of t.strResources)this.removeElements(r);return this._notificationService.warn(o),new WorkspaceVerificationError}_checkWorkspaceUndo(e,t,s,o){if(t.removedResources)return this._tryToSplitAndUndo(e,t,t.removedResources,localize(2014,"Could not undo '{0}' across all files. {1}",t.label,t.removedResources.createMessage()));if(o&&t.invalidatedResources)return this._tryToSplitAndUndo(e,t,t.invalidatedResources,localize(2015,"Could not undo '{0}' across all files. {1}",t.label,t.invalidatedResources.createMessage()));const r=[];for(const c of s.editStacks)c.getClosestPastElement()!==t&&r.push(c.resourceLabel);if(r.length>0)return this._tryToSplitAndUndo(e,t,null,localize(2016,"Could not undo '{0}' across all files because changes were made to {1}",t.label,r.join(", ")));const l=[];for(const c of s.editStacks)c.locked&&l.push(c.resourceLabel);return l.length>0?this._tryToSplitAndUndo(e,t,null,localize(2017,"Could not undo '{0}' across all files because there is already an undo or redo operation running on {1}",t.label,l.join(", "))):s.isValid()?null:this._tryToSplitAndUndo(e,t,null,localize(2018,"Could not undo '{0}' across all files because an undo or redo operation occurred in the meantime",t.label))}_workspaceUndo(e,t,s){const o=this._getAffectedEditStacks(t),r=this._checkWorkspaceUndo(e,t,o,!1);return r?r.returnValue:this._confirmAndExecuteWorkspaceUndo(e,t,o,s)}_isPartOfUndoGroup(e){if(!e.groupId)return!1;for(const[,t]of this._editStacks){const s=t.getClosestPastElement();if(s){if(s===e){const o=t.getSecondClosestPastElement();if(o&&o.groupId===e.groupId)return!0}if(s.groupId===e.groupId)return!0}}return!1}async _confirmAndExecuteWorkspaceUndo(e,t,s,o){if(t.canSplit()&&!this._isPartOfUndoGroup(t)){let c;(function(g){g[g.All=0]="All",g[g.This=1]="This",g[g.Cancel=2]="Cancel"})(c||(c={}));const{result:d}=await this._dialogService.prompt({type:Severity$2.Info,message:localize(2019,"Would you like to undo '{0}' across all files?",t.label),buttons:[{label:localize(2020,"&&Undo in {0} Files",s.editStacks.length),run:()=>c.All},{label:localize(2021,"Undo this &&File"),run:()=>c.This}],cancelButton:{run:()=>c.Cancel}});if(d===c.Cancel)return;if(d===c.This)return this._splitPastWorkspaceElement(t,null),this._undo(e,0,!0);const u=this._checkWorkspaceUndo(e,t,s,!1);if(u)return u.returnValue;o=!0}let r;try{r=await this._invokeWorkspacePrepare(t)}catch(c){return this._onError(c,t)}const l=this._checkWorkspaceUndo(e,t,s,!0);if(l)return r.dispose(),l.returnValue;for(const c of s.editStacks)c.moveBackward(t);return this._safeInvokeWithLocks(t,()=>t.actual.undo(),s,r,()=>this._continueUndoInGroup(t.groupId,o))}_resourceUndo(e,t,s){if(!t.isValid){e.flushAllElements();return}if(e.locked){const o=localize(2022,"Could not undo '{0}' because there is already an undo or redo operation running.",t.label);this._notificationService.warn(o);return}return this._invokeResourcePrepare(t,o=>(e.moveBackward(t),this._safeInvokeWithLocks(t,()=>t.actual.undo(),new EditStackSnapshot([e]),o,()=>this._continueUndoInGroup(t.groupId,s))))}_findClosestUndoElementInGroup(e){if(!e)return[null,null];let t=null,s=null;for(const[o,r]of this._editStacks){const l=r.getClosestPastElement();l&&l.groupId===e&&(!t||l.groupOrder>t.groupOrder)&&(t=l,s=o)}return[t,s]}_continueUndoInGroup(e,t){if(!e)return;const[,s]=this._findClosestUndoElementInGroup(e);if(s)return this._undo(s,0,t)}undo(e){if(e instanceof UndoRedoSource){const[,t]=this._findClosestUndoElementWithSource(e.id);return t?this._undo(t,e.id,!1):void 0}return typeof e=="string"?this._undo(e,0,!1):this._undo(this.getUriComparisonKey(e),0,!1)}_undo(e,t=0,s){if(!this._editStacks.has(e))return;const o=this._editStacks.get(e),r=o.getClosestPastElement();if(!r)return;if(r.groupId){const[c,d]=this._findClosestUndoElementInGroup(r.groupId);if(r!==c&&d)return this._undo(d,t,s)}if((r.sourceId!==t||r.confirmBeforeUndo)&&!s)return this._confirmAndContinueUndo(e,t,r);try{return r.type===1?this._workspaceUndo(e,r,s):this._resourceUndo(o,r,s)}finally{}}async _confirmAndContinueUndo(e,t,s){if((await this._dialogService.confirm({message:localize(2023,"Would you like to undo '{0}'?",s.label),primaryButton:localize(2024,"&&Yes"),cancelButton:localize(2025,"No")})).confirmed)return this._undo(e,t,!0)}_findClosestRedoElementWithSource(e){if(!e)return[null,null];let t=null,s=null;for(const[o,r]of this._editStacks){const l=r.getClosestFutureElement();l&&l.sourceId===e&&(!t||l.sourceOrder<t.sourceOrder)&&(t=l,s=o)}return[t,s]}canRedo(e){if(e instanceof UndoRedoSource){const[,s]=this._findClosestRedoElementWithSource(e.id);return!!s}const t=this.getUriComparisonKey(e);return this._editStacks.has(t)?this._editStacks.get(t).hasFutureElements():!1}_tryToSplitAndRedo(e,t,s,o){if(t.canSplit())return this._splitFutureWorkspaceElement(t,s),this._notificationService.warn(o),new WorkspaceVerificationError(this._redo(e));for(const r of t.strResources)this.removeElements(r);return this._notificationService.warn(o),new WorkspaceVerificationError}_checkWorkspaceRedo(e,t,s,o){if(t.removedResources)return this._tryToSplitAndRedo(e,t,t.removedResources,localize(2026,"Could not redo '{0}' across all files. {1}",t.label,t.removedResources.createMessage()));if(o&&t.invalidatedResources)return this._tryToSplitAndRedo(e,t,t.invalidatedResources,localize(2027,"Could not redo '{0}' across all files. {1}",t.label,t.invalidatedResources.createMessage()));const r=[];for(const c of s.editStacks)c.getClosestFutureElement()!==t&&r.push(c.resourceLabel);if(r.length>0)return this._tryToSplitAndRedo(e,t,null,localize(2028,"Could not redo '{0}' across all files because changes were made to {1}",t.label,r.join(", ")));const l=[];for(const c of s.editStacks)c.locked&&l.push(c.resourceLabel);return l.length>0?this._tryToSplitAndRedo(e,t,null,localize(2029,"Could not redo '{0}' across all files because there is already an undo or redo operation running on {1}",t.label,l.join(", "))):s.isValid()?null:this._tryToSplitAndRedo(e,t,null,localize(2030,"Could not redo '{0}' across all files because an undo or redo operation occurred in the meantime",t.label))}_workspaceRedo(e,t){const s=this._getAffectedEditStacks(t),o=this._checkWorkspaceRedo(e,t,s,!1);return o?o.returnValue:this._executeWorkspaceRedo(e,t,s)}async _executeWorkspaceRedo(e,t,s){let o;try{o=await this._invokeWorkspacePrepare(t)}catch(l){return this._onError(l,t)}const r=this._checkWorkspaceRedo(e,t,s,!0);if(r)return o.dispose(),r.returnValue;for(const l of s.editStacks)l.moveForward(t);return this._safeInvokeWithLocks(t,()=>t.actual.redo(),s,o,()=>this._continueRedoInGroup(t.groupId))}_resourceRedo(e,t){if(!t.isValid){e.flushAllElements();return}if(e.locked){const s=localize(2031,"Could not redo '{0}' because there is already an undo or redo operation running.",t.label);this._notificationService.warn(s);return}return this._invokeResourcePrepare(t,s=>(e.moveForward(t),this._safeInvokeWithLocks(t,()=>t.actual.redo(),new EditStackSnapshot([e]),s,()=>this._continueRedoInGroup(t.groupId))))}_findClosestRedoElementInGroup(e){if(!e)return[null,null];let t=null,s=null;for(const[o,r]of this._editStacks){const l=r.getClosestFutureElement();l&&l.groupId===e&&(!t||l.groupOrder<t.groupOrder)&&(t=l,s=o)}return[t,s]}_continueRedoInGroup(e){if(!e)return;const[,t]=this._findClosestRedoElementInGroup(e);if(t)return this._redo(t)}redo(e){if(e instanceof UndoRedoSource){const[,t]=this._findClosestRedoElementWithSource(e.id);return t?this._redo(t):void 0}return typeof e=="string"?this._redo(e):this._redo(this.getUriComparisonKey(e))}_redo(e){if(!this._editStacks.has(e))return;const t=this._editStacks.get(e),s=t.getClosestFutureElement();if(s){if(s.groupId){const[o,r]=this._findClosestRedoElementInGroup(s.groupId);if(s!==o&&r)return this._redo(r)}try{return s.type===1?this._workspaceRedo(e,s):this._resourceRedo(t,s)}finally{}}}};UndoRedoService=__decorate$p([__param$o(0,IDialogService),__param$o(1,INotificationService)],UndoRedoService);class WorkspaceVerificationError{constructor(e){this.returnValue=e}}registerSingleton(IUndoRedoService,UndoRedoService,1);var __decorate$o=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$n=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let SemanticTokensStylingService=class extends Disposable{constructor(e,t,s){super(),this._themeService=e,this._logService=t,this._languageService=s,this._caches=new WeakMap,this._register(this._themeService.onDidColorThemeChange(()=>{this._caches=new WeakMap}))}getStyling(e){return this._caches.has(e)||this._caches.set(e,new SemanticTokensProviderStyling(e.getLegend(),this._themeService,this._languageService,this._logService)),this._caches.get(e)}};SemanticTokensStylingService=__decorate$o([__param$n(0,IThemeService),__param$n(1,ILogService),__param$n(2,ILanguageService)],SemanticTokensStylingService);registerSingleton(ISemanticTokensStylingService,SemanticTokensStylingService,1);function isExclusive(a){return typeof a=="string"?!1:Array.isArray(a)?a.every(isExclusive):!!a.exclusive}class MatchCandidate{constructor(e,t,s,o,r){this.uri=e,this.languageId=t,this.notebookUri=s,this.notebookType=o,this.recursive=r}equals(e){var t,s;return this.notebookType===e.notebookType&&this.languageId===e.languageId&&this.uri.toString()===e.uri.toString()&&((t=this.notebookUri)==null?void 0:t.toString())===((s=e.notebookUri)==null?void 0:s.toString())&&this.recursive===e.recursive}}class LanguageFeatureRegistry{get onDidChange(){return this._onDidChange.event}constructor(e){this._notebookInfoResolver=e,this._clock=0,this._entries=[],this._onDidChange=new Emitter$1}register(e,t){let s={selector:e,provider:t,_score:-1,_time:this._clock++};return this._entries.push(s),this._lastCandidate=void 0,this._onDidChange.fire(this._entries.length),toDisposable(()=>{if(s){const o=this._entries.indexOf(s);o>=0&&(this._entries.splice(o,1),this._lastCandidate=void 0,this._onDidChange.fire(this._entries.length),s=void 0)}})}has(e){return this.all(e).length>0}all(e){if(!e)return[];this._updateScores(e,!1);const t=[];for(const s of this._entries)s._score>0&&t.push(s.provider);return t}ordered(e,t=!1){const s=[];return this._orderedForEach(e,t,o=>s.push(o.provider)),s}orderedGroups(e){const t=[];let s,o;return this._orderedForEach(e,!1,r=>{s&&o===r._score?s.push(r.provider):(o=r._score,s=[r.provider],t.push(s))}),t}_orderedForEach(e,t,s){this._updateScores(e,t);for(const o of this._entries)o._score>0&&s(o)}_updateScores(e,t){var r,l;const s=(r=this._notebookInfoResolver)==null?void 0:r.call(this,e.uri),o=s?new MatchCandidate(e.uri,e.getLanguageId(),s.uri,s.type,t):new MatchCandidate(e.uri,e.getLanguageId(),void 0,void 0,t);if(!((l=this._lastCandidate)!=null&&l.equals(o))){this._lastCandidate=o;for(const c of this._entries)if(c._score=score(c.selector,o.uri,o.languageId,shouldSynchronizeModel(e),o.notebookUri,o.notebookType),isExclusive(c.selector)&&c._score>0)if(t)c._score=0;else{for(const d of this._entries)d._score=0;c._score=1e3;break}this._entries.sort(LanguageFeatureRegistry._compareByScoreAndTime)}}static _compareByScoreAndTime(e,t){return e._score<t._score?1:e._score>t._score?-1:isBuiltinSelector(e.selector)&&!isBuiltinSelector(t.selector)?1:!isBuiltinSelector(e.selector)&&isBuiltinSelector(t.selector)?-1:e._time<t._time?1:e._time>t._time?-1:0}}function isBuiltinSelector(a){return typeof a=="string"?!1:Array.isArray(a)?a.some(isBuiltinSelector):!!a.isBuiltin}class LanguageFeaturesService{constructor(){this.referenceProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.renameProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.newSymbolNamesProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.codeActionProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.definitionProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.typeDefinitionProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.declarationProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.implementationProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentSymbolProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.inlayHintsProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.colorProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.codeLensProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentFormattingEditProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentRangeFormattingEditProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.onTypeFormattingEditProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.signatureHelpProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.hoverProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentHighlightProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.multiDocumentHighlightProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.selectionRangeProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.foldingRangeProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.linkProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.inlineCompletionsProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.completionProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.linkedEditingRangeProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentRangeSemanticTokensProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentSemanticTokensProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentDropEditProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentPasteEditProvider=new LanguageFeatureRegistry(this._score.bind(this))}_score(e){var t;return(t=this._notebookTypeResolver)==null?void 0:t.call(this,e)}}registerSingleton(ILanguageFeaturesService,LanguageFeaturesService,1);const hover="";var __decorate$n=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$m=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const $$5=$$l;let HoverWidget=class extends Widget$1{get _targetWindow(){return getWindow(this._target.targetElements[0])}get _targetDocumentElement(){return getWindow(this._target.targetElements[0]).document.documentElement}get isDisposed(){return this._isDisposed}get isMouseIn(){return this._lockMouseTracker.isMouseIn}get domNode(){return this._hover.containerDomNode}get onDispose(){return this._onDispose.event}get onRequestLayout(){return this._onRequestLayout.event}get anchor(){return this._hoverPosition===2?0:1}get x(){return this._x}get y(){return this._y}get isLocked(){return this._isLocked}set isLocked(e){this._isLocked!==e&&(this._isLocked=e,this._hoverContainer.classList.toggle("locked",this._isLocked))}constructor(e,t,s,o,r,l){var m,_,C,b,v,S,y,w;super(),this._keybindingService=t,this._configurationService=s,this._openerService=o,this._instantiationService=r,this._accessibilityService=l,this._messageListeners=new DisposableStore,this._isDisposed=!1,this._forcePosition=!1,this._x=0,this._y=0,this._isLocked=!1,this._enableFocusTraps=!1,this._addedFocusTrap=!1,this._maxHeightRatioRelativeToWindow=.5,this._onDispose=this._register(new Emitter$1),this._onRequestLayout=this._register(new Emitter$1),this._linkHandler=e.linkHandler||(L=>openLinkFromMarkdown(this._openerService,L,isMarkdownString(e.content)?e.content.isTrusted:void 0)),this._target="targetElements"in e.target?e.target:new ElementHoverTarget(e.target),this._hoverPointer=(m=e.appearance)!=null&&m.showPointer?$$5("div.workbench-hover-pointer"):void 0,this._hover=this._register(new HoverWidget$1(!((_=e.appearance)!=null&&_.skipFadeInAnimation))),this._hover.containerDomNode.classList.add("workbench-hover"),(C=e.appearance)!=null&&C.compact&&this._hover.containerDomNode.classList.add("workbench-hover","compact"),e.additionalClasses&&this._hover.containerDomNode.classList.add(...e.additionalClasses),(b=e.position)!=null&&b.forcePosition&&(this._forcePosition=!0),e.trapFocus&&(this._enableFocusTraps=!0);const c=(v=e.appearance)==null?void 0:v.maxHeightRatio;c!==void 0&&c>0&&c<=1&&(this._maxHeightRatioRelativeToWindow=c),this._hoverPosition=((S=e.position)==null?void 0:S.hoverPosition)===void 0?3:isNumber$1(e.position.hoverPosition)?e.position.hoverPosition:2,this.onmousedown(this._hover.containerDomNode,L=>L.stopPropagation()),this.onkeydown(this._hover.containerDomNode,L=>{L.equals(9)&&this.dispose()}),this._register(addDisposableListener(this._targetWindow,"blur",()=>this.dispose()));const d=$$5("div.hover-row.markdown-hover"),u=$$5("div.hover-contents");if(typeof e.content=="string")u.textContent=e.content,u.style.whiteSpace="pre-wrap";else if(isHTMLElement(e.content))u.appendChild(e.content),u.classList.add("html-hover-contents");else{const L=e.content,x=this._instantiationService.createInstance(MarkdownRenderer,{codeBlockFontFamily:this._configurationService.getValue("editor").fontFamily||EDITOR_FONT_DEFAULTS.fontFamily}),{element:E,dispose:I}=x.render(L,{actionHandler:D=>this._linkHandler(D),asyncRenderCallback:()=>{u.classList.add("code-hover-contents"),this.layout(),this._onRequestLayout.fire()}});u.appendChild(E),this._register(toDisposable(I))}if(d.appendChild(u),this._hover.contentsDomNode.appendChild(d),e.actions&&e.actions.length>0){const L=$$5("div.hover-row.status-bar"),x=$$5("div.actions");e.actions.forEach(E=>{const I=this._keybindingService.lookupKeybinding(E.commandId),D=I?I.getLabel():null;this._register(HoverAction.render(x,{label:E.label,commandId:E.commandId,run:k=>{E.run(k),this.dispose()},iconClass:E.iconClass},D))}),L.appendChild(x),this._hover.containerDomNode.appendChild(L)}this._hoverContainer=$$5("div.workbench-hover-container"),this._hoverPointer&&this._hoverContainer.appendChild(this._hoverPointer),this._hoverContainer.appendChild(this._hover.containerDomNode);let g;if(e.actions&&e.actions.length>0?g=!1:((y=e.persistence)==null?void 0:y.hideOnHover)===void 0?g=typeof e.content=="string"||isMarkdownString(e.content)&&!e.content.value.includes("](")&&!e.content.value.includes("</a>"):g=e.persistence.hideOnHover,(w=e.appearance)!=null&&w.showHoverHint){const L=$$5("div.hover-row.status-bar"),x=$$5("div.info");x.textContent=localize(74,"Hold {0} key to mouse over",isMacintosh?"Option":"Alt"),L.appendChild(x),this._hover.containerDomNode.appendChild(L)}const f=[...this._target.targetElements];g||f.push(this._hoverContainer);const p=this._register(new CompositeMouseTracker(f));if(this._register(p.onMouseOut(()=>{this._isLocked||this.dispose()})),g){const L=[...this._target.targetElements,this._hoverContainer];this._lockMouseTracker=this._register(new CompositeMouseTracker(L)),this._register(this._lockMouseTracker.onMouseOut(()=>{this._isLocked||this.dispose()}))}else this._lockMouseTracker=p}addFocusTrap(){if(!this._enableFocusTraps||this._addedFocusTrap)return;this._addedFocusTrap=!0;const e=this._hover.containerDomNode,t=this.findLastFocusableChild(this._hover.containerDomNode);if(t){const s=prepend$2(this._hoverContainer,$$5("div")),o=append$2(this._hoverContainer,$$5("div"));s.tabIndex=0,o.tabIndex=0,this._register(addDisposableListener(o,"focus",r=>{e.focus(),r.preventDefault()})),this._register(addDisposableListener(s,"focus",r=>{t.focus(),r.preventDefault()}))}}findLastFocusableChild(e){if(e.hasChildNodes())for(let t=0;t<e.childNodes.length;t++){const s=e.childNodes.item(e.childNodes.length-t-1);if(s.nodeType===s.ELEMENT_NODE){const r=s;if(typeof r.tabIndex=="number"&&r.tabIndex>=0)return r}const o=this.findLastFocusableChild(s);if(o)return o}}render(e){var o;e.appendChild(this._hoverContainer);const s=this._hoverContainer.contains(this._hoverContainer.ownerDocument.activeElement)&&getHoverAccessibleViewHint(this._configurationService.getValue("accessibility.verbosity.hover")===!0&&this._accessibilityService.isScreenReaderOptimized(),(o=this._keybindingService.lookupKeybinding("editor.action.accessibleView"))==null?void 0:o.getAriaLabel());s&&status(s),this.layout(),this.addFocusTrap()}layout(){this._hover.containerDomNode.classList.remove("right-aligned"),this._hover.contentsDomNode.style.maxHeight="";const e=g=>{const f=getDomNodeZoomLevel(g),p=g.getBoundingClientRect();return{top:p.top*f,bottom:p.bottom*f,right:p.right*f,left:p.left*f}},t=this._target.targetElements.map(g=>e(g)),{top:s,right:o,bottom:r,left:l}=t[0],c=o-l,d=r-s,u={top:s,right:o,bottom:r,left:l,width:c,height:d,center:{x:l+c/2,y:s+d/2}};if(this.adjustHorizontalHoverPosition(u),this.adjustVerticalHoverPosition(u),this.adjustHoverMaxHeight(u),this._hoverContainer.style.padding="",this._hoverContainer.style.margin="",this._hoverPointer){switch(this._hoverPosition){case 1:u.left+=3,u.right+=3,this._hoverContainer.style.paddingLeft="3px",this._hoverContainer.style.marginLeft="-3px";break;case 0:u.left-=3,u.right-=3,this._hoverContainer.style.paddingRight="3px",this._hoverContainer.style.marginRight="-3px";break;case 2:u.top+=3,u.bottom+=3,this._hoverContainer.style.paddingTop="3px",this._hoverContainer.style.marginTop="-3px";break;case 3:u.top-=3,u.bottom-=3,this._hoverContainer.style.paddingBottom="3px",this._hoverContainer.style.marginBottom="-3px";break}u.center.x=u.left+c/2,u.center.y=u.top+d/2}this.computeXCordinate(u),this.computeYCordinate(u),this._hoverPointer&&(this._hoverPointer.classList.remove("top"),this._hoverPointer.classList.remove("left"),this._hoverPointer.classList.remove("right"),this._hoverPointer.classList.remove("bottom"),this.setHoverPointerPosition(u)),this._hover.onContentsChanged()}computeXCordinate(e){const t=this._hover.containerDomNode.clientWidth+2;this._target.x!==void 0?this._x=this._target.x:this._hoverPosition===1?this._x=e.right:this._hoverPosition===0?this._x=e.left-t:(this._hoverPointer?this._x=e.center.x-this._hover.containerDomNode.clientWidth/2:this._x=e.left,this._x+t>=this._targetDocumentElement.clientWidth&&(this._hover.containerDomNode.classList.add("right-aligned"),this._x=Math.max(this._targetDocumentElement.clientWidth-t-2,this._targetDocumentElement.clientLeft))),this._x<this._targetDocumentElement.clientLeft&&(this._x=e.left+2)}computeYCordinate(e){this._target.y!==void 0?this._y=this._target.y:this._hoverPosition===3?this._y=e.top:this._hoverPosition===2?this._y=e.bottom-2:this._hoverPointer?this._y=e.center.y+this._hover.containerDomNode.clientHeight/2:this._y=e.bottom,this._y>this._targetWindow.innerHeight&&(this._y=e.bottom)}adjustHorizontalHoverPosition(e){if(this._target.x!==void 0)return;const t=this._hoverPointer?3:0;if(this._forcePosition){const s=t+2;this._hoverPosition===1?this._hover.containerDomNode.style.maxWidth=`${this._targetDocumentElement.clientWidth-e.right-s}px`:this._hoverPosition===0&&(this._hover.containerDomNode.style.maxWidth=`${e.left-s}px`);return}this._hoverPosition===1?this._targetDocumentElement.clientWidth-e.right<this._hover.containerDomNode.clientWidth+t&&(e.left>=this._hover.containerDomNode.clientWidth+t?this._hoverPosition=0:this._hoverPosition=2):this._hoverPosition===0&&(e.left<this._hover.containerDomNode.clientWidth+t&&(this._targetDocumentElement.clientWidth-e.right>=this._hover.containerDomNode.clientWidth+t?this._hoverPosition=1:this._hoverPosition=2),e.left-this._hover.containerDomNode.clientWidth-t<=this._targetDocumentElement.clientLeft&&(this._hoverPosition=1))}adjustVerticalHoverPosition(e){if(this._target.y!==void 0||this._forcePosition)return;const t=this._hoverPointer?3:0;this._hoverPosition===3?e.top-this._hover.containerDomNode.clientHeight-t<0&&(this._hoverPosition=2):this._hoverPosition===2&&e.bottom+this._hover.containerDomNode.clientHeight+t>this._targetWindow.innerHeight&&(this._hoverPosition=3)}adjustHoverMaxHeight(e){let t=this._targetWindow.innerHeight*this._maxHeightRatioRelativeToWindow;if(this._forcePosition){const s=(this._hoverPointer?3:0)+2;this._hoverPosition===3?t=Math.min(t,e.top-s):this._hoverPosition===2&&(t=Math.min(t,this._targetWindow.innerHeight-e.bottom-s))}if(this._hover.containerDomNode.style.maxHeight=`${t}px`,this._hover.contentsDomNode.clientHeight<this._hover.contentsDomNode.scrollHeight){const s=`${this._hover.scrollbar.options.verticalScrollbarSize}px`;this._hover.contentsDomNode.style.paddingRight!==s&&(this._hover.contentsDomNode.style.paddingRight=s)}}setHoverPointerPosition(e){if(this._hoverPointer)switch(this._hoverPosition){case 0:case 1:{this._hoverPointer.classList.add(this._hoverPosition===0?"right":"left");const t=this._hover.containerDomNode.clientHeight;t>e.height?this._hoverPointer.style.top=`${e.center.y-(this._y-t)-3}px`:this._hoverPointer.style.top=`${Math.round(t/2)-3}px`;break}case 3:case 2:{this._hoverPointer.classList.add(this._hoverPosition===3?"bottom":"top");const t=this._hover.containerDomNode.clientWidth;let s=Math.round(t/2)-3;const o=this._x+s;(o<e.left||o>e.right)&&(s=e.center.x-this._x-3),this._hoverPointer.style.left=`${s}px`;break}}}focus(){this._hover.containerDomNode.focus()}dispose(){var e,t;this._isDisposed||(this._onDispose.fire(),(t=(e=this._target).dispose)==null||t.call(e),this._hoverContainer.remove(),this._messageListeners.dispose(),super.dispose()),this._isDisposed=!0}};HoverWidget=__decorate$n([__param$m(1,IKeybindingService),__param$m(2,IConfigurationService),__param$m(3,IOpenerService),__param$m(4,IInstantiationService),__param$m(5,IAccessibilityService)],HoverWidget);class CompositeMouseTracker extends Widget$1{get onMouseOut(){return this._onMouseOut.event}get isMouseIn(){return this._isMouseIn}constructor(e,t=200){super(),this._elements=e,this._eventDebounceDelay=t,this._isMouseIn=!0,this._mouseTimer=this._register(new MutableDisposable),this._onMouseOut=this._register(new Emitter$1);for(const s of this._elements)this.onmouseover(s,()=>this._onTargetMouseOver()),this.onmouseleave(s,()=>this._onTargetMouseLeave())}_onTargetMouseOver(){this._isMouseIn=!0,this._mouseTimer.clear()}_onTargetMouseLeave(){this._isMouseIn=!1,this._mouseTimer.value=new TimeoutTimer(()=>this._fireIfMouseOutside(),this._eventDebounceDelay)}_fireIfMouseOutside(){this._isMouseIn||this._onMouseOut.fire()}}class ElementHoverTarget{constructor(e){this._element=e,this.targetElements=[this._element]}dispose(){}}const contextview="";function isAnchor(a){const e=a;return!!e&&typeof e.x=="number"&&typeof e.y=="number"}var LayoutAnchorMode;(function(a){a[a.AVOID=0]="AVOID",a[a.ALIGN=1]="ALIGN"})(LayoutAnchorMode||(LayoutAnchorMode={}));function layout(a,e,t){const s=t.mode===LayoutAnchorMode.ALIGN?t.offset:t.offset+t.size,o=t.mode===LayoutAnchorMode.ALIGN?t.offset+t.size:t.offset;return t.position===0?e<=a-s?s:e<=o?o-e:Math.max(a-e,0):e<=o?o-e:e<=a-s?s:0}const hi=class hi extends Disposable{constructor(e,t){super(),this.container=null,this.useFixedPosition=!1,this.useShadowDOM=!1,this.delegate=null,this.toDisposeOnClean=Disposable.None,this.toDisposeOnSetContainer=Disposable.None,this.shadowRoot=null,this.shadowRootHostElement=null,this.view=$$l(".context-view"),hide(this.view),this.setContainer(e,t),this._register(toDisposable(()=>this.setContainer(null,1)))}setContainer(e,t){var o;this.useFixedPosition=t!==1;const s=this.useShadowDOM;if(this.useShadowDOM=t===3,!(e===this.container&&s===this.useShadowDOM)&&(this.container&&(this.toDisposeOnSetContainer.dispose(),this.view.remove(),this.shadowRoot&&(this.shadowRoot=null,(o=this.shadowRootHostElement)==null||o.remove(),this.shadowRootHostElement=null),this.container=null),e)){if(this.container=e,this.useShadowDOM){this.shadowRootHostElement=$$l(".shadow-root-host"),this.container.appendChild(this.shadowRootHostElement),this.shadowRoot=this.shadowRootHostElement.attachShadow({mode:"open"});const l=document.createElement("style");l.textContent=SHADOW_ROOT_CSS,this.shadowRoot.appendChild(l),this.shadowRoot.appendChild(this.view),this.shadowRoot.appendChild($$l("slot"))}else this.container.appendChild(this.view);const r=new DisposableStore;hi.BUBBLE_UP_EVENTS.forEach(l=>{r.add(addStandardDisposableListener(this.container,l,c=>{this.onDOMEvent(c,!1)}))}),hi.BUBBLE_DOWN_EVENTS.forEach(l=>{r.add(addStandardDisposableListener(this.container,l,c=>{this.onDOMEvent(c,!0)},!0))}),this.toDisposeOnSetContainer=r}}show(e){var t,s;this.isVisible()&&this.hide(),clearNode(this.view),this.view.className="context-view monaco-component",this.view.style.top="0px",this.view.style.left="0px",this.view.style.zIndex=`${2575+(e.layer??0)}`,this.view.style.position=this.useFixedPosition?"fixed":"absolute",show(this.view),this.toDisposeOnClean=e.render(this.view)||Disposable.None,this.delegate=e,this.doLayout(),(s=(t=this.delegate).focus)==null||s.call(t)}getViewElement(){return this.view}layout(){var e,t;if(this.isVisible()){if(this.delegate.canRelayout===!1&&!(isIOS&&BrowserFeatures.pointerEvents)){this.hide();return}(t=(e=this.delegate)==null?void 0:e.layout)==null||t.call(e),this.doLayout()}}doLayout(){if(!this.isVisible())return;const e=this.delegate.getAnchor();let t;if(isHTMLElement(e)){const _=getDomNodePagePosition(e),C=getDomNodeZoomLevel(e);t={top:_.top*C,left:_.left*C,width:_.width*C,height:_.height*C}}else isAnchor(e)?t={top:e.y,left:e.x,width:e.width||1,height:e.height||2}:t={top:e.posy,left:e.posx,width:2,height:2};const s=getTotalWidth(this.view),o=getTotalHeight(this.view),r=this.delegate.anchorPosition??0,l=this.delegate.anchorAlignment??0,c=this.delegate.anchorAxisAlignment??0;let d,u;const g=getActiveWindow();if(c===0){const _={offset:t.top-g.pageYOffset,size:t.height,position:r===0?0:1},C={offset:t.left,size:t.width,position:l===0?0:1,mode:LayoutAnchorMode.ALIGN};d=layout(g.innerHeight,o,_)+g.pageYOffset,Range$1.intersects({start:d,end:d+o},{start:_.offset,end:_.offset+_.size})&&(C.mode=LayoutAnchorMode.AVOID),u=layout(g.innerWidth,s,C)}else{const _={offset:t.left,size:t.width,position:l===0?0:1},C={offset:t.top,size:t.height,position:r===0?0:1,mode:LayoutAnchorMode.ALIGN};u=layout(g.innerWidth,s,_),Range$1.intersects({start:u,end:u+s},{start:_.offset,end:_.offset+_.size})&&(C.mode=LayoutAnchorMode.AVOID),d=layout(g.innerHeight,o,C)+g.pageYOffset}this.view.classList.remove("top","bottom","left","right"),this.view.classList.add(r===0?"bottom":"top"),this.view.classList.add(l===0?"left":"right"),this.view.classList.toggle("fixed",this.useFixedPosition);const f=getDomNodePagePosition(this.container),p=this.container.scrollTop||0,m=this.container.scrollLeft||0;this.view.style.top=`${d-(this.useFixedPosition?getDomNodePagePosition(this.view).top:f.top)+p}px`,this.view.style.left=`${u-(this.useFixedPosition?getDomNodePagePosition(this.view).left:f.left)+m}px`,this.view.style.width="initial"}hide(e){const t=this.delegate;this.delegate=null,t!=null&&t.onHide&&t.onHide(e),this.toDisposeOnClean.dispose(),hide(this.view)}isVisible(){return!!this.delegate}onDOMEvent(e,t){this.delegate&&(this.delegate.onDOMEvent?this.delegate.onDOMEvent(e,getWindow(e).document.activeElement):t&&!isAncestor$1(e.target,this.container)&&this.hide())}dispose(){this.hide(),super.dispose()}};hi.BUBBLE_UP_EVENTS=["click","keydown","focus","blur"],hi.BUBBLE_DOWN_EVENTS=["click"];let ContextView=hi;const SHADOW_ROOT_CSS=`
	:host {
		all: initial; /* 1st rule so subsequent properties are reset. */
	}

	.codicon[class*='codicon-'] {
		font: normal normal normal 16px/1 codicon;
		display: inline-block;
		text-decoration: none;
		text-rendering: auto;
		text-align: center;
		-webkit-font-smoothing: antialiased;
		-moz-osx-font-smoothing: grayscale;
		user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
	}

	:host {
		font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "HelveticaNeue-Light", system-ui, "Ubuntu", "Droid Sans", sans-serif;
	}

	:host-context(.mac) { font-family: -apple-system, BlinkMacSystemFont, sans-serif; }
	:host-context(.mac:lang(zh-Hans)) { font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB", sans-serif; }
	:host-context(.mac:lang(zh-Hant)) { font-family: -apple-system, BlinkMacSystemFont, "PingFang TC", sans-serif; }
	:host-context(.mac:lang(ja)) { font-family: -apple-system, BlinkMacSystemFont, "Hiragino Kaku Gothic Pro", sans-serif; }
	:host-context(.mac:lang(ko)) { font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Nanum Gothic", "AppleGothic", sans-serif; }

	:host-context(.windows) { font-family: "Segoe WPC", "Segoe UI", sans-serif; }
	:host-context(.windows:lang(zh-Hans)) { font-family: "Segoe WPC", "Segoe UI", "Microsoft YaHei", sans-serif; }
	:host-context(.windows:lang(zh-Hant)) { font-family: "Segoe WPC", "Segoe UI", "Microsoft Jhenghei", sans-serif; }
	:host-context(.windows:lang(ja)) { font-family: "Segoe WPC", "Segoe UI", "Yu Gothic UI", "Meiryo UI", sans-serif; }
	:host-context(.windows:lang(ko)) { font-family: "Segoe WPC", "Segoe UI", "Malgun Gothic", "Dotom", sans-serif; }

	:host-context(.linux) { font-family: system-ui, "Ubuntu", "Droid Sans", sans-serif; }
	:host-context(.linux:lang(zh-Hans)) { font-family: system-ui, "Ubuntu", "Droid Sans", "Source Han Sans SC", "Source Han Sans CN", "Source Han Sans", sans-serif; }
	:host-context(.linux:lang(zh-Hant)) { font-family: system-ui, "Ubuntu", "Droid Sans", "Source Han Sans TC", "Source Han Sans TW", "Source Han Sans", sans-serif; }
	:host-context(.linux:lang(ja)) { font-family: system-ui, "Ubuntu", "Droid Sans", "Source Han Sans J", "Source Han Sans JP", "Source Han Sans", sans-serif; }
	:host-context(.linux:lang(ko)) { font-family: system-ui, "Ubuntu", "Droid Sans", "Source Han Sans K", "Source Han Sans JR", "Source Han Sans", "UnDotum", "FBaekmuk Gulim", sans-serif; }
`;var __decorate$m=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$l=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let ContextViewHandler=class extends Disposable{constructor(e){super(),this.layoutService=e,this.contextView=this._register(new ContextView(this.layoutService.mainContainer,1)),this.layout(),this._register(e.onDidLayoutContainer(()=>this.layout()))}showContextView(e,t,s){let o;t?t===this.layoutService.getContainer(getWindow(t))?o=1:s?o=3:o=2:o=1,this.contextView.setContainer(t??this.layoutService.activeContainer,o),this.contextView.show(e);const r={close:()=>{this.openContextView===r&&this.hideContextView()}};return this.openContextView=r,r}layout(){this.contextView.layout()}hideContextView(e){this.contextView.hide(e),this.openContextView=void 0}};ContextViewHandler=__decorate$m([__param$l(0,ILayoutService)],ContextViewHandler);class ContextViewService extends ContextViewHandler{getContextViewElement(){return this.contextView.getViewElement()}}function isManagedHoverTooltipMarkdownString(a){const e=a;return typeof e=="object"&&"markdown"in e&&"markdownNotSupportedFallback"in e}class ManagedHoverWidget{constructor(e,t,s){this.hoverDelegate=e,this.target=t,this.fadeInAnimation=s}async update(e,t,s){if(this._cancellationTokenSource&&(this._cancellationTokenSource.dispose(!0),this._cancellationTokenSource=void 0),this.isDisposed)return;let o;if(isString$1(e)||isHTMLElement(e)||e===void 0)o=e;else{this._cancellationTokenSource=new CancellationTokenSource$1;const r=this._cancellationTokenSource.token;let l;if(isManagedHoverTooltipMarkdownString(e)?isFunction(e.markdown)?l=e.markdown(r).then(c=>c??e.markdownNotSupportedFallback):l=e.markdown??e.markdownNotSupportedFallback:l=e.element(r),l instanceof Promise?(this._hoverWidget||this.show(localize(75,"Loading..."),t,s),o=await l):o=l,this.isDisposed||r.isCancellationRequested)return}this.show(o,t,s)}show(e,t,s){var r;const o=this._hoverWidget;if(this.hasContent(e)){const l={content:e,target:this.target,actions:s==null?void 0:s.actions,linkHandler:s==null?void 0:s.linkHandler,trapFocus:s==null?void 0:s.trapFocus,appearance:{showPointer:this.hoverDelegate.placement==="element",skipFadeInAnimation:!this.fadeInAnimation||!!o,showHoverHint:(r=s==null?void 0:s.appearance)==null?void 0:r.showHoverHint},position:{hoverPosition:2}};this._hoverWidget=this.hoverDelegate.showHover(l,t)}o==null||o.dispose()}hasContent(e){return e?isMarkdownString(e)?!!e.value:!0:!1}get isDisposed(){var e;return(e=this._hoverWidget)==null?void 0:e.isDisposed}dispose(){var e,t;(e=this._hoverWidget)==null||e.dispose(),(t=this._cancellationTokenSource)==null||t.dispose(!0),this._cancellationTokenSource=void 0}}var __decorate$l=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$k=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let HoverService=class extends Disposable{constructor(e,t,s,o,r,l){super(),this._instantiationService=e,this._configurationService=t,this._keybindingService=o,this._layoutService=r,this._accessibilityService=l,this._currentDelayedHoverWasShown=!1,this._delayedHovers=new Map,this._managedHovers=new Map,this._register(s.onDidShowContextMenu(()=>this.hideHover())),this._contextViewHandler=this._register(new ContextViewHandler(this._layoutService)),this._register(KeybindingsRegistry.registerCommandAndKeybindingRule({id:"workbench.action.showHover",weight:200-1,when:EditorContextKeys.editorTextFocus.negate(),primary:KeyChord(2089,2087),handler:()=>{this._showAndFocusHoverForActiveElement()}}))}showInstantHover(e,t,s,o){const r=this._createHover(e,s);if(r)return this._showHover(r,e,t),r}showDelayedHover(e,t){var o;if(e.id===void 0&&(e.id=getHoverIdFromContent(e.content)),!this._currentDelayedHover||this._currentDelayedHoverWasShown){if((o=this._currentHover)!=null&&o.isLocked)return;if(getHoverOptionsIdentity(this._currentHoverOptions)===getHoverOptionsIdentity(e))return this._currentHover;if(this._currentHover&&!this._currentHover.isDisposed&&this._currentDelayedHoverGroupId!==void 0&&this._currentDelayedHoverGroupId===(t==null?void 0:t.groupId))return this.showInstantHover({...e,appearance:{...e.appearance,skipFadeInAnimation:!0}})}else if(this._currentDelayedHover&&getHoverOptionsIdentity(this._currentHoverOptions)===getHoverOptionsIdentity(e))return this._currentDelayedHover;const s=this._createHover(e,void 0);if(!s){this._currentDelayedHover=void 0,this._currentDelayedHoverWasShown=!1,this._currentDelayedHoverGroupId=void 0;return}return this._currentDelayedHover=s,this._currentDelayedHoverWasShown=!1,this._currentDelayedHoverGroupId=t==null?void 0:t.groupId,timeout(this._configurationService.getValue("workbench.hover.delay")).then(()=>{s&&!s.isDisposed&&(this._currentDelayedHoverWasShown=!0,this._showHover(s,e))}),s}setupDelayedHover(e,t,s){const o=()=>({...typeof t=="function"?t():t,target:e});return this._setupDelayedHover(e,o,s)}setupDelayedHoverAtMouse(e,t,s){const o=r=>({...typeof t=="function"?t():t,target:{targetElements:[e],x:r!==void 0?r.x+10:void 0}});return this._setupDelayedHover(e,o,s)}_setupDelayedHover(e,t,s){const o=new DisposableStore;return o.add(addDisposableListener(e,EventType$1.MOUSE_OVER,r=>{this.showDelayedHover(t(r),{groupId:s==null?void 0:s.groupId})})),s!=null&&s.setupKeyboardEvents&&o.add(addDisposableListener(e,EventType$1.KEY_DOWN,r=>{const l=new StandardKeyboardEvent(r);(l.equals(10)||l.equals(3))&&this.showInstantHover(t(),!0)})),this._delayedHovers.set(e,{show:r=>{this.showInstantHover(t(),r)}}),o.add(toDisposable(()=>this._delayedHovers.delete(e))),o}_createHover(e,t){var c,d,u,g;if(this._currentDelayedHover=void 0,(c=this._currentHover)!=null&&c.isLocked||(e.id===void 0&&(e.id=getHoverIdFromContent(e.content)),getHoverOptionsIdentity(this._currentHoverOptions)===getHoverOptionsIdentity(e)))return;this._currentHoverOptions=e,this._lastHoverOptions=e;const s=e.trapFocus||this._accessibilityService.isScreenReaderOptimized(),o=getActiveElement();t||(s&&o?o.classList.contains("monaco-hover")||(this._lastFocusedElementBeforeOpen=o):this._lastFocusedElementBeforeOpen=void 0);const r=new DisposableStore,l=this._instantiationService.createInstance(HoverWidget,e);if((d=e.persistence)!=null&&d.sticky&&(l.isLocked=!0),(u=e.position)!=null&&u.hoverPosition&&!isNumber$1(e.position.hoverPosition)&&(e.target={targetElements:isHTMLElement(e.target)?[e.target]:e.target.targetElements,x:e.position.hoverPosition.x+10}),l.onDispose(()=>{var p,m;((p=this._currentHover)==null?void 0:p.domNode)&&isAncestorOfActiveElement(this._currentHover.domNode)&&((m=this._lastFocusedElementBeforeOpen)==null||m.focus()),getHoverOptionsIdentity(this._currentHoverOptions)===getHoverOptionsIdentity(e)&&this.doHideHover(),r.dispose()},void 0,r),!e.container){const f=isHTMLElement(e.target)?e.target:e.target.targetElements[0];e.container=this._layoutService.getContainer(getWindow(f))}if(l.onRequestLayout(()=>this._contextViewHandler.layout(),void 0,r),(g=e.persistence)!=null&&g.sticky)r.add(addDisposableListener(getWindow(e.container).document,EventType$1.MOUSE_DOWN,f=>{isAncestor$1(f.target,l.domNode)||this.doHideHover()}));else{if("targetElements"in e.target)for(const p of e.target.targetElements)r.add(addDisposableListener(p,EventType$1.CLICK,()=>this.hideHover()));else r.add(addDisposableListener(e.target,EventType$1.CLICK,()=>this.hideHover()));const f=getActiveElement();if(f){const p=getWindow(f).document;r.add(addDisposableListener(f,EventType$1.KEY_DOWN,m=>{var _;return this._keyDown(m,l,!!((_=e.persistence)!=null&&_.hideOnKeyDown))})),r.add(addDisposableListener(p,EventType$1.KEY_DOWN,m=>{var _;return this._keyDown(m,l,!!((_=e.persistence)!=null&&_.hideOnKeyDown))})),r.add(addDisposableListener(f,EventType$1.KEY_UP,m=>this._keyUp(m,l))),r.add(addDisposableListener(p,EventType$1.KEY_UP,m=>this._keyUp(m,l)))}}if("IntersectionObserver"in mainWindow){const f=new IntersectionObserver(m=>this._intersectionChange(m,l),{threshold:0}),p="targetElements"in e.target?e.target.targetElements[0]:e.target;f.observe(p),r.add(toDisposable(()=>f.disconnect()))}return this._currentHover=l,l}_showHover(e,t,s){this._contextViewHandler.showContextView(new HoverContextViewDelegate(e,s),t.container)}hideHover(e){var t;!e&&((t=this._currentHover)!=null&&t.isLocked)||!this._currentHoverOptions||this.doHideHover()}doHideHover(){this._currentHover=void 0,this._currentHoverOptions=void 0,this._contextViewHandler.hideContextView()}_intersectionChange(e,t){e[e.length-1].isIntersecting||t.dispose()}showAndFocusLastHover(){this._lastHoverOptions&&this.showInstantHover(this._lastHoverOptions,!0,!0)}_showAndFocusHoverForActiveElement(){let e=getActiveElement();for(;e;){const t=this._delayedHovers.get(e)??this._managedHovers.get(e);if(t){t.show(!0);return}e=e.parentElement}}_keyDown(e,t,s){var l,c;if(e.key==="Alt"){t.isLocked=!0;return}const o=new StandardKeyboardEvent(e);this._keybindingService.resolveKeyboardEvent(o).getSingleModifierDispatchChords().some(d=>!!d)||this._keybindingService.softDispatch(o,o.target).kind!==0||s&&(!((l=this._currentHoverOptions)!=null&&l.trapFocus)||e.key!=="Tab")&&(this.hideHover(),(c=this._lastFocusedElementBeforeOpen)==null||c.focus())}_keyUp(e,t){var s;e.key==="Alt"&&(t.isLocked=!1,t.isMouseIn||(this.hideHover(),(s=this._lastFocusedElementBeforeOpen)==null||s.focus()))}setupManagedHover(e,t,s,o){if(e.showNativeHover)return setupNativeHover(t,s);t.setAttribute("custom-hover","true"),t.title!==""&&(console.warn("HTML element already has a title attribute, which will conflict with the custom hover. Please remove the title attribute."),console.trace("Stack trace:",t.title),t.title="");let r,l;const c=(m,_)=>{var b;const C=l!==void 0;m&&(l==null||l.dispose(),l=void 0),_&&(r==null||r.dispose(),r=void 0),C&&((b=e.onDidHideHover)==null||b.call(e),l=void 0)},d=(m,_,C,b)=>new TimeoutTimer(async()=>{(!l||l.isDisposed)&&(l=new ManagedHoverWidget(e,C||t,m>0),await l.update(typeof s=="function"?s():s,_,{...o,trapFocus:b}))},m),u=new DisposableStore;let g=!1;u.add(addDisposableListener(t,EventType$1.MOUSE_DOWN,()=>{g=!0,c(!0,!0)},!0)),u.add(addDisposableListener(t,EventType$1.MOUSE_UP,()=>{g=!1},!0)),u.add(addDisposableListener(t,EventType$1.MOUSE_LEAVE,m=>{g=!1,c(!1,m.fromElement===t)},!0)),u.add(addDisposableListener(t,EventType$1.MOUSE_OVER,m=>{if(r)return;const _=new DisposableStore,C={targetElements:[t],dispose:()=>{}};if(e.placement===void 0||e.placement==="mouse"){const b=v=>{C.x=v.x+10,isHTMLElement(v.target)&&getHoverTargetElement(v.target,t)!==t&&c(!0,!0)};_.add(addDisposableListener(t,EventType$1.MOUSE_MOVE,b,!0))}r=_,!(isHTMLElement(m.target)&&getHoverTargetElement(m.target,t)!==t)&&_.add(d(typeof e.delay=="function"?e.delay(s):e.delay,!1,C))},!0));const f=()=>{if(g||r)return;const m={targetElements:[t],dispose:()=>{}},_=new DisposableStore,C=()=>c(!0,!0);_.add(addDisposableListener(t,EventType$1.BLUR,C,!0)),_.add(d(typeof e.delay=="function"?e.delay(s):e.delay,!1,m)),r=_};isEditableElement(t)||u.add(addDisposableListener(t,EventType$1.FOCUS,f,!0));const p={show:m=>{c(!1,!0),d(0,m,void 0,m)},hide:()=>{c(!0,!0)},update:async(m,_)=>{s=m,await(l==null?void 0:l.update(s,void 0,_))},dispose:()=>{this._managedHovers.delete(t),u.dispose(),c(!0,!0)}};return this._managedHovers.set(t,p),p}showManagedHover(e){const t=this._managedHovers.get(e);t&&t.show(!0)}dispose(){this._managedHovers.forEach(e=>e.dispose()),super.dispose()}};HoverService=__decorate$l([__param$k(0,IInstantiationService),__param$k(1,IConfigurationService),__param$k(2,IContextMenuService),__param$k(3,IKeybindingService),__param$k(4,ILayoutService),__param$k(5,IAccessibilityService)],HoverService);function getHoverOptionsIdentity(a){if(a!==void 0)return(a==null?void 0:a.id)??a}function getHoverIdFromContent(a){if(!isHTMLElement(a))return typeof a=="string"?a.toString():a.value}function getStringContent(a){const e=typeof a=="function"?a():a;if(isString$1(e))return stripIcons(e);if(isManagedHoverTooltipMarkdownString(e))return e.markdownNotSupportedFallback}function setupNativeHover(a,e){function t(s){s?a.setAttribute("title",s):a.removeAttribute("title")}return t(getStringContent(e)),{update:s=>t(getStringContent(s)),show:()=>{},hide:()=>{},dispose:()=>t(void 0)}}class HoverContextViewDelegate{get anchorPosition(){return this._hover.anchor}constructor(e,t=!1){this._hover=e,this._focus=t,this.layer=1}render(e){return this._hover.render(e),this._focus&&this._hover.focus(),this._hover}getAnchor(){return{x:this._hover.x,y:this._hover.y}}layout(){this._hover.layout()}}function getHoverTargetElement(a,e){for(e=e??getWindow(a).document.body;!a.hasAttribute("custom-hover")&&a!==e;)a=a.parentElement;return a}registerSingleton(IHoverService,HoverService,1);registerThemingParticipant((a,e)=>{const t=a.getColor(editorHoverBorder);t&&(e.addRule(`.monaco-workbench .workbench-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid ${t.transparent(.5)}; }`),e.addRule(`.monaco-workbench .workbench-hover hr { border-top: 1px solid ${t.transparent(.5)}; }`))});function freeze(a){return Object.isFrozen(a)?a:deepFreeze(a)}class ConfigurationModel{static createEmptyModel(e){return new ConfigurationModel({},[],[],void 0,e)}constructor(e,t,s,o,r){this._contents=e,this._keys=t,this._overrides=s,this.raw=o,this.logService=r,this.overrideConfigurations=new Map}get rawConfiguration(){if(!this._rawConfiguration)if(this.raw){const e=(Array.isArray(this.raw)?this.raw:[this.raw]).map(t=>{if(t instanceof ConfigurationModel)return t;const s=new ConfigurationModelParser("",this.logService);return s.parseRaw(t),s.configurationModel});this._rawConfiguration=e.reduce((t,s)=>s===t?s:t.merge(s),e[0])}else this._rawConfiguration=this;return this._rawConfiguration}get contents(){return this._contents}get overrides(){return this._overrides}get keys(){return this._keys}isEmpty(){return this._keys.length===0&&Object.keys(this._contents).length===0&&this._overrides.length===0}getValue(e){return e?getConfigurationValue(this.contents,e):this.contents}inspect(e,t){const s=this;return{get value(){return freeze(s.rawConfiguration.getValue(e))},get override(){return t?freeze(s.rawConfiguration.getOverrideValue(e,t)):void 0},get merged(){return freeze(t?s.rawConfiguration.override(t).getValue(e):s.rawConfiguration.getValue(e))},get overrides(){const o=[];for(const{contents:r,identifiers:l,keys:c}of s.rawConfiguration.overrides){const d=new ConfigurationModel(r,c,[],void 0,s.logService).getValue(e);d!==void 0&&o.push({identifiers:l,value:d})}return o.length?freeze(o):void 0}}}getOverrideValue(e,t){const s=this.getContentsForOverrideIdentifer(t);return s?e?getConfigurationValue(s,e):s:void 0}override(e){let t=this.overrideConfigurations.get(e);return t||(t=this.createOverrideConfigurationModel(e),this.overrideConfigurations.set(e,t)),t}merge(...e){const t=deepClone(this.contents),s=deepClone(this.overrides),o=[...this.keys],r=this.raw?Array.isArray(this.raw)?[...this.raw]:[this.raw]:[this];for(const l of e)if(r.push(...l.raw?Array.isArray(l.raw)?l.raw:[l.raw]:[l]),!l.isEmpty()){this.mergeContents(t,l.contents);for(const c of l.overrides){const[d]=s.filter(u=>equals$1(u.identifiers,c.identifiers));d?(this.mergeContents(d.contents,c.contents),d.keys.push(...c.keys),d.keys=distinct(d.keys)):s.push(deepClone(c))}for(const c of l.keys)o.indexOf(c)===-1&&o.push(c)}return new ConfigurationModel(t,o,s,!r.length||r.every(l=>l instanceof ConfigurationModel)?void 0:r,this.logService)}createOverrideConfigurationModel(e){const t=this.getContentsForOverrideIdentifer(e);if(!t||typeof t!="object"||!Object.keys(t).length)return this;const s={};for(const o of distinct([...Object.keys(this.contents),...Object.keys(t)])){let r=this.contents[o];const l=t[o];l&&(typeof r=="object"&&typeof l=="object"?(r=deepClone(r),this.mergeContents(r,l)):r=l),s[o]=r}return new ConfigurationModel(s,this.keys,this.overrides,void 0,this.logService)}mergeContents(e,t){for(const s of Object.keys(t)){if(s in e&&isObject(e[s])&&isObject(t[s])){this.mergeContents(e[s],t[s]);continue}e[s]=deepClone(t[s])}}getContentsForOverrideIdentifer(e){let t=null,s=null;const o=r=>{r&&(s?this.mergeContents(s,r):s=deepClone(r))};for(const r of this.overrides)r.identifiers.length===1&&r.identifiers[0]===e?t=r.contents:r.identifiers.includes(e)&&o(r.contents);return o(t),s}toJSON(){return{contents:this.contents,overrides:this.overrides,keys:this.keys}}setValue(e,t){this.updateValue(e,t,!1)}removeValue(e){const t=this.keys.indexOf(e);t!==-1&&(this.keys.splice(t,1),removeFromValueTree(this.contents,e),OVERRIDE_PROPERTY_REGEX.test(e)&&this.overrides.splice(this.overrides.findIndex(s=>equals$1(s.identifiers,overrideIdentifiersFromKey(e))),1))}updateValue(e,t,s){if(addToValueTree(this.contents,e,t,o=>this.logService.error(o)),s=s||this.keys.indexOf(e)===-1,s&&this.keys.push(e),OVERRIDE_PROPERTY_REGEX.test(e)){const o=overrideIdentifiersFromKey(e),r={identifiers:o,keys:Object.keys(this.contents[e]),contents:toValuesTree(this.contents[e],c=>this.logService.error(c))},l=this.overrides.findIndex(c=>equals$1(c.identifiers,o));l!==-1?this.overrides[l]=r:this.overrides.push(r)}}}class ConfigurationModelParser{constructor(e,t){this._name=e,this.logService=t,this._raw=null,this._configurationModel=null,this._restrictedConfigurations=[]}get configurationModel(){return this._configurationModel||ConfigurationModel.createEmptyModel(this.logService)}parseRaw(e,t){this._raw=e;const{contents:s,keys:o,overrides:r,restricted:l,hasExcludedProperties:c}=this.doParseRaw(e,t);this._configurationModel=new ConfigurationModel(s,o,r,c?[e]:void 0,this.logService),this._restrictedConfigurations=l||[]}doParseRaw(e,t){const s=Registry.as(Extensions$6.Configuration),o=s.getConfigurationProperties(),r=s.getExcludedConfigurationProperties(),l=this.filter(e,o,r,!0,t);e=l.raw;const c=toValuesTree(e,g=>this.logService.error(`Conflict in settings file ${this._name}: ${g}`)),d=Object.keys(e),u=this.toOverrides(e,g=>this.logService.error(`Conflict in settings file ${this._name}: ${g}`));return{contents:c,keys:d,overrides:u,restricted:l.restricted,hasExcludedProperties:l.hasExcludedProperties}}filter(e,t,s,o,r){var u;let l=!1;if(!(r!=null&&r.scopes)&&!(r!=null&&r.skipRestricted)&&!(r!=null&&r.skipUnregistered)&&!((u=r==null?void 0:r.exclude)!=null&&u.length))return{raw:e,restricted:[],hasExcludedProperties:l};const c={},d=[];for(const g in e)if(OVERRIDE_PROPERTY_REGEX.test(g)&&o){const f=this.filter(e[g],t,s,!1,r);c[g]=f.raw,l=l||f.hasExcludedProperties,d.push(...f.restricted)}else{const f=t[g];f!=null&&f.restricted&&d.push(g),this.shouldInclude(g,f,s,r)?c[g]=e[g]:l=!0}return{raw:c,restricted:d,hasExcludedProperties:l}}shouldInclude(e,t,s,o){var c,d;if((c=o.exclude)!=null&&c.includes(e))return!1;if((d=o.include)!=null&&d.includes(e))return!0;if(o.skipRestricted&&(t!=null&&t.restricted)||o.skipUnregistered&&!t)return!1;const r=t??s[e],l=r?typeof r.scope<"u"?r.scope:4:void 0;return l===void 0||o.scopes===void 0?!0:o.scopes.includes(l)}toOverrides(e,t){const s=[];for(const o of Object.keys(e))if(OVERRIDE_PROPERTY_REGEX.test(o)){const r={};for(const l in e[o])r[l]=e[o][l];s.push({identifiers:overrideIdentifiersFromKey(o),keys:Object.keys(r),contents:toValuesTree(r,t)})}return s}}class ConfigurationInspectValue{constructor(e,t,s,o,r,l,c,d,u,g,f,p,m){this.key=e,this.overrides=t,this._value=s,this.overrideIdentifiers=o,this.defaultConfiguration=r,this.policyConfiguration=l,this.applicationConfiguration=c,this.userConfiguration=d,this.localUserConfiguration=u,this.remoteUserConfiguration=g,this.workspaceConfiguration=f,this.folderConfigurationModel=p,this.memoryConfigurationModel=m}toInspectValue(e){return(e==null?void 0:e.value)!==void 0||(e==null?void 0:e.override)!==void 0||(e==null?void 0:e.overrides)!==void 0?e:void 0}get userInspectValue(){return this._userInspectValue||(this._userInspectValue=this.userConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._userInspectValue}get user(){return this.toInspectValue(this.userInspectValue)}}class Configuration{constructor(e,t,s,o,r,l,c,d,u,g){this._defaultConfiguration=e,this._policyConfiguration=t,this._applicationConfiguration=s,this._localUserConfiguration=o,this._remoteUserConfiguration=r,this._workspaceConfiguration=l,this._folderConfigurations=c,this._memoryConfiguration=d,this._memoryConfigurationByResource=u,this.logService=g,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations=new ResourceMap,this._userConfiguration=null}getValue(e,t,s){return this.getConsolidatedConfigurationModel(e,t,s).getValue(e)}updateValue(e,t,s={}){let o;s.resource?(o=this._memoryConfigurationByResource.get(s.resource),o||(o=ConfigurationModel.createEmptyModel(this.logService),this._memoryConfigurationByResource.set(s.resource,o))):o=this._memoryConfiguration,t===void 0?o.removeValue(e):o.setValue(e,t),s.resource||(this._workspaceConsolidatedConfiguration=null)}inspect(e,t,s){const o=this.getConsolidatedConfigurationModel(e,t,s),r=this.getFolderConfigurationModelForResource(t.resource,s),l=t.resource?this._memoryConfigurationByResource.get(t.resource)||this._memoryConfiguration:this._memoryConfiguration,c=new Set;for(const d of o.overrides)for(const u of d.identifiers)o.getOverrideValue(e,u)!==void 0&&c.add(u);return new ConfigurationInspectValue(e,t,o.getValue(e),c.size?[...c]:void 0,this._defaultConfiguration,this._policyConfiguration.isEmpty()?void 0:this._policyConfiguration,this.applicationConfiguration.isEmpty()?void 0:this.applicationConfiguration,this.userConfiguration,this.localUserConfiguration,this.remoteUserConfiguration,s?this._workspaceConfiguration:void 0,r||void 0,l)}get applicationConfiguration(){return this._applicationConfiguration}get userConfiguration(){if(!this._userConfiguration)if(this._remoteUserConfiguration.isEmpty())this._userConfiguration=this._localUserConfiguration;else{const e=this._localUserConfiguration.merge(this._remoteUserConfiguration);this._userConfiguration=new ConfigurationModel(e.contents,e.keys,e.overrides,void 0,this.logService)}return this._userConfiguration}get localUserConfiguration(){return this._localUserConfiguration}get remoteUserConfiguration(){return this._remoteUserConfiguration}getConsolidatedConfigurationModel(e,t,s){let o=this.getConsolidatedConfigurationModelForResource(t,s);if(t.overrideIdentifier&&(o=o.override(t.overrideIdentifier)),!this._policyConfiguration.isEmpty()&&this._policyConfiguration.getValue(e)!==void 0){o=o.merge();for(const r of this._policyConfiguration.keys)o.setValue(r,this._policyConfiguration.getValue(r))}return o}getConsolidatedConfigurationModelForResource({resource:e},t){let s=this.getWorkspaceConsolidatedConfiguration();if(t&&e){const o=t.getFolder(e);o&&(s=this.getFolderConsolidatedConfiguration(o.uri)||s);const r=this._memoryConfigurationByResource.get(e);r&&(s=s.merge(r))}return s}getWorkspaceConsolidatedConfiguration(){return this._workspaceConsolidatedConfiguration||(this._workspaceConsolidatedConfiguration=this._defaultConfiguration.merge(this.applicationConfiguration,this.userConfiguration,this._workspaceConfiguration,this._memoryConfiguration)),this._workspaceConsolidatedConfiguration}getFolderConsolidatedConfiguration(e){let t=this._foldersConsolidatedConfigurations.get(e);if(!t){const s=this.getWorkspaceConsolidatedConfiguration(),o=this._folderConfigurations.get(e);o?(t=s.merge(o),this._foldersConsolidatedConfigurations.set(e,t)):t=s}return t}getFolderConfigurationModelForResource(e,t){if(t&&e){const s=t.getFolder(e);if(s)return this._folderConfigurations.get(s.uri)}}toData(){return{defaults:{contents:this._defaultConfiguration.contents,overrides:this._defaultConfiguration.overrides,keys:this._defaultConfiguration.keys},policy:{contents:this._policyConfiguration.contents,overrides:this._policyConfiguration.overrides,keys:this._policyConfiguration.keys},application:{contents:this.applicationConfiguration.contents,overrides:this.applicationConfiguration.overrides,keys:this.applicationConfiguration.keys,raw:Array.isArray(this.applicationConfiguration.raw)?void 0:this.applicationConfiguration.raw},userLocal:{contents:this.localUserConfiguration.contents,overrides:this.localUserConfiguration.overrides,keys:this.localUserConfiguration.keys,raw:Array.isArray(this.localUserConfiguration.raw)?void 0:this.localUserConfiguration.raw},userRemote:{contents:this.remoteUserConfiguration.contents,overrides:this.remoteUserConfiguration.overrides,keys:this.remoteUserConfiguration.keys,raw:Array.isArray(this.remoteUserConfiguration.raw)?void 0:this.remoteUserConfiguration.raw},workspace:{contents:this._workspaceConfiguration.contents,overrides:this._workspaceConfiguration.overrides,keys:this._workspaceConfiguration.keys},folders:[...this._folderConfigurations.keys()].reduce((e,t)=>{const{contents:s,overrides:o,keys:r}=this._folderConfigurations.get(t);return e.push([t,{contents:s,overrides:o,keys:r}]),e},[])}}static parse(e,t){const s=this.parseConfigurationModel(e.defaults,t),o=this.parseConfigurationModel(e.policy,t),r=this.parseConfigurationModel(e.application,t),l=this.parseConfigurationModel(e.userLocal,t),c=this.parseConfigurationModel(e.userRemote,t),d=this.parseConfigurationModel(e.workspace,t),u=e.folders.reduce((g,f)=>(g.set(URI.revive(f[0]),this.parseConfigurationModel(f[1],t)),g),new ResourceMap);return new Configuration(s,o,r,l,c,d,u,ConfigurationModel.createEmptyModel(t),new ResourceMap,t)}static parseConfigurationModel(e,t){return new ConfigurationModel(e.contents,e.keys,e.overrides,e.raw,t)}}class ConfigurationChangeEvent{constructor(e,t,s,o,r){this.change=e,this.previous=t,this.currentConfiguraiton=s,this.currentWorkspace=o,this.logService=r,this._marker=`
`,this._markerCode1=this._marker.charCodeAt(0),this._markerCode2=".".charCodeAt(0),this.affectedKeys=new Set,this._previousConfiguration=void 0;for(const l of e.keys)this.affectedKeys.add(l);for(const[,l]of e.overrides)for(const c of l)this.affectedKeys.add(c);this._affectsConfigStr=this._marker;for(const l of this.affectedKeys)this._affectsConfigStr+=l+this._marker}get previousConfiguration(){return!this._previousConfiguration&&this.previous&&(this._previousConfiguration=Configuration.parse(this.previous.data,this.logService)),this._previousConfiguration}affectsConfiguration(e,t){var c;const s=this._marker+e,o=this._affectsConfigStr.indexOf(s);if(o<0)return!1;const r=o+s.length;if(r>=this._affectsConfigStr.length)return!1;const l=this._affectsConfigStr.charCodeAt(r);if(l!==this._markerCode1&&l!==this._markerCode2)return!1;if(t){const d=this.previousConfiguration?this.previousConfiguration.getValue(e,t,(c=this.previous)==null?void 0:c.workspace):void 0,u=this.currentConfiguraiton.getValue(e,t,this.currentWorkspace);return!equals(d,u)}return!0}}const NoMatchingKb={kind:0},MoreChordsNeeded={kind:1};function KbFound(a,e,t){return{kind:2,commandId:a,commandArgs:e,isBubble:t}}class KeybindingResolver{constructor(e,t,s){var o;this._log=s,this._defaultKeybindings=e,this._defaultBoundCommands=new Map;for(const r of e){const l=r.command;l&&l.charAt(0)!=="-"&&this._defaultBoundCommands.set(l,!0)}this._map=new Map,this._lookupMap=new Map,this._keybindings=KeybindingResolver.handleRemovals([].concat(e).concat(t));for(let r=0,l=this._keybindings.length;r<l;r++){const c=this._keybindings[r];if(c.chords.length===0)continue;const d=(o=c.when)==null?void 0:o.substituteConstants();d&&d.type===0||this._addKeyPress(c.chords[0],c)}}static _isTargetedForRemoval(e,t,s){if(t){for(let o=0;o<t.length;o++)if(t[o]!==e.chords[o])return!1}return!(s&&s.type!==1&&(!e.when||!expressionsAreEqualWithConstantSubstitution(s,e.when)))}static handleRemovals(e){const t=new Map;for(let o=0,r=e.length;o<r;o++){const l=e[o];if(l.command&&l.command.charAt(0)==="-"){const c=l.command.substring(1);t.has(c)?t.get(c).push(l):t.set(c,[l])}}if(t.size===0)return e;const s=[];for(let o=0,r=e.length;o<r;o++){const l=e[o];if(!l.command||l.command.length===0){s.push(l);continue}if(l.command.charAt(0)==="-")continue;const c=t.get(l.command);if(!c||!l.isDefault){s.push(l);continue}let d=!1;for(const u of c){const g=u.when;if(this._isTargetedForRemoval(l,u.chords,g)){d=!0;break}}if(!d){s.push(l);continue}}return s}_addKeyPress(e,t){const s=this._map.get(e);if(typeof s>"u"){this._map.set(e,[t]),this._addToLookupMap(t);return}for(let o=s.length-1;o>=0;o--){const r=s[o];if(r.command===t.command)continue;let l=!0;for(let c=1;c<r.chords.length&&c<t.chords.length;c++)if(r.chords[c]!==t.chords[c]){l=!1;break}l&&KeybindingResolver.whenIsEntirelyIncluded(r.when,t.when)&&this._removeFromLookupMap(r)}s.push(t),this._addToLookupMap(t)}_addToLookupMap(e){if(!e.command)return;let t=this._lookupMap.get(e.command);typeof t>"u"?(t=[e],this._lookupMap.set(e.command,t)):t.push(e)}_removeFromLookupMap(e){if(!e.command)return;const t=this._lookupMap.get(e.command);if(!(typeof t>"u")){for(let s=0,o=t.length;s<o;s++)if(t[s]===e){t.splice(s,1);return}}}static whenIsEntirelyIncluded(e,t){return!t||t.type===1?!0:!e||e.type===1?!1:implies(e,t)}getKeybindings(){return this._keybindings}lookupPrimaryKeybinding(e,t,s=!1){const o=this._lookupMap.get(e);if(typeof o>"u"||o.length===0)return null;if(o.length===1&&!s)return o[0];for(let r=o.length-1;r>=0;r--){const l=o[r];if(t.contextMatchesRules(l.when))return l}return s?null:o[o.length-1]}resolve(e,t,s){const o=[...t,s];this._log(`| Resolving ${o}`);const r=this._map.get(o[0]);if(r===void 0)return this._log("\\ No keybinding entries."),NoMatchingKb;let l=null;if(o.length<2)l=r;else{l=[];for(let d=0,u=r.length;d<u;d++){const g=r[d];if(o.length>g.chords.length)continue;let f=!0;for(let p=1;p<o.length;p++)if(g.chords[p]!==o[p]){f=!1;break}f&&l.push(g)}}const c=this._findCommand(e,l);return c?o.length<c.chords.length?(this._log(`\\ From ${l.length} keybinding entries, awaiting ${c.chords.length-o.length} more chord(s), when: ${printWhenExplanation(c.when)}, source: ${printSourceExplanation(c)}.`),MoreChordsNeeded):(this._log(`\\ From ${l.length} keybinding entries, matched ${c.command}, when: ${printWhenExplanation(c.when)}, source: ${printSourceExplanation(c)}.`),KbFound(c.command,c.commandArgs,c.bubble)):(this._log(`\\ From ${l.length} keybinding entries, no when clauses matched the context.`),NoMatchingKb)}_findCommand(e,t){for(let s=t.length-1;s>=0;s--){const o=t[s];if(KeybindingResolver._contextMatchesRules(e,o.when))return o}return null}static _contextMatchesRules(e,t){return t?t.evaluate(e):!0}}function printWhenExplanation(a){return a?`${a.serialize()}`:"no when condition"}function printSourceExplanation(a){return a.extensionId?a.isBuiltinExtension?`built-in extension ${a.extensionId}`:`user extension ${a.extensionId}`:a.isDefault?"built-in":"user"}const HIGH_FREQ_COMMANDS=/^(cursor|delete|undo|redo|tab|editor\.action\.clipboard)/;class AbstractKeybindingService extends Disposable{get onDidUpdateKeybindings(){return this._onDidUpdateKeybindings?this._onDidUpdateKeybindings.event:Event$1.None}get inChordMode(){return this._currentChords.length>0}constructor(e,t,s,o,r){super(),this._contextKeyService=e,this._commandService=t,this._telemetryService=s,this._notificationService=o,this._logService=r,this._onDidUpdateKeybindings=this._register(new Emitter$1),this._currentChords=[],this._currentChordChecker=new IntervalTimer,this._currentChordStatusMessage=null,this._ignoreSingleModifiers=KeybindingModifierSet.EMPTY,this._currentSingleModifier=null,this._currentSingleModifierClearTimeout=new TimeoutTimer,this._currentlyDispatchingCommandId=null,this._logging=!1}dispose(){super.dispose()}_log(e){this._logging&&this._logService.info(`[KeybindingService]: ${e}`)}getKeybindings(){return this._getResolver().getKeybindings()}lookupKeybinding(e,t,s=!1){const o=this._getResolver().lookupPrimaryKeybinding(e,t||this._contextKeyService,s);if(o)return o.resolvedKeybinding}dispatchEvent(e,t){return this._dispatch(e,t)}softDispatch(e,t){this._log("/ Soft dispatching keyboard event");const s=this.resolveKeyboardEvent(e);if(s.hasMultipleChords())return console.warn("keyboard event should not be mapped to multiple chords"),NoMatchingKb;const[o]=s.getDispatchChords();if(o===null)return this._log("\\ Keyboard event cannot be dispatched"),NoMatchingKb;const r=this._contextKeyService.getContext(t),l=this._currentChords.map(({keypress:c})=>c);return this._getResolver().resolve(r,l,o)}_scheduleLeaveChordMode(){const e=Date.now();this._currentChordChecker.cancelAndSet(()=>{if(!this._documentHasFocus()){this._leaveChordMode();return}Date.now()-e>5e3&&this._leaveChordMode()},500)}_expectAnotherChord(e,t){switch(this._currentChords.push({keypress:e,label:t}),this._currentChords.length){case 0:throw illegalState("impossible");case 1:this._currentChordStatusMessage=this._notificationService.status(localize(1684,"({0}) was pressed. Waiting for second key of chord...",t));break;default:{const s=this._currentChords.map(({label:o})=>o).join(", ");this._currentChordStatusMessage=this._notificationService.status(localize(1685,"({0}) was pressed. Waiting for next key of chord...",s))}}this._scheduleLeaveChordMode(),IME.enabled&&IME.disable()}_leaveChordMode(){this._currentChordStatusMessage&&(this._currentChordStatusMessage.close(),this._currentChordStatusMessage=null),this._currentChordChecker.cancel(),this._currentChords=[],IME.enable()}_dispatch(e,t){return this._doDispatch(this.resolveKeyboardEvent(e),t,!1)}_singleModifierDispatch(e,t){const s=this.resolveKeyboardEvent(e),[o]=s.getSingleModifierDispatchChords();if(o)return this._ignoreSingleModifiers.has(o)?(this._log(`+ Ignoring single modifier ${o} due to it being pressed together with other keys.`),this._ignoreSingleModifiers=KeybindingModifierSet.EMPTY,this._currentSingleModifierClearTimeout.cancel(),this._currentSingleModifier=null,!1):(this._ignoreSingleModifiers=KeybindingModifierSet.EMPTY,this._currentSingleModifier===null?(this._log(`+ Storing single modifier for possible chord ${o}.`),this._currentSingleModifier=o,this._currentSingleModifierClearTimeout.cancelAndSet(()=>{this._log("+ Clearing single modifier due to 300ms elapsed."),this._currentSingleModifier=null},300),!1):o===this._currentSingleModifier?(this._log(`/ Dispatching single modifier chord ${o} ${o}`),this._currentSingleModifierClearTimeout.cancel(),this._currentSingleModifier=null,this._doDispatch(s,t,!0)):(this._log(`+ Clearing single modifier due to modifier mismatch: ${this._currentSingleModifier} ${o}`),this._currentSingleModifierClearTimeout.cancel(),this._currentSingleModifier=null,!1));const[r]=s.getChords();return this._ignoreSingleModifiers=new KeybindingModifierSet(r),this._currentSingleModifier!==null&&this._log("+ Clearing single modifier due to other key up."),this._currentSingleModifierClearTimeout.cancel(),this._currentSingleModifier=null,!1}_doDispatch(e,t,s=!1){let o=!1;if(e.hasMultipleChords())return console.warn("Unexpected keyboard event mapped to multiple chords"),!1;let r=null,l=null;if(s){const[g]=e.getSingleModifierDispatchChords();r=g,l=g?[g]:[]}else[r]=e.getDispatchChords(),l=this._currentChords.map(({keypress:g})=>g);if(r===null)return this._log("\\ Keyboard event cannot be dispatched in keydown phase."),o;const c=this._contextKeyService.getContext(t),d=e.getLabel(),u=this._getResolver().resolve(c,l,r);switch(u.kind){case 0:{if(this._logService.trace("KeybindingService#dispatch",d,"[ No matching keybinding ]"),this.inChordMode){const g=this._currentChords.map(({label:f})=>f).join(", ");this._log(`+ Leaving multi-chord mode: Nothing bound to "${g}, ${d}".`),this._notificationService.status(localize(1686,"The key combination ({0}, {1}) is not a command.",g,d),{hideAfter:10*1e3}),this._leaveChordMode(),o=!0}return o}case 1:return this._logService.trace("KeybindingService#dispatch",d,"[ Several keybindings match - more chords needed ]"),o=!0,this._expectAnotherChord(r,d),this._log(this._currentChords.length===1?"+ Entering multi-chord mode...":"+ Continuing multi-chord mode..."),o;case 2:{if(this._logService.trace("KeybindingService#dispatch",d,`[ Will dispatch command ${u.commandId} ]`),u.commandId===null||u.commandId===""){if(this.inChordMode){const g=this._currentChords.map(({label:f})=>f).join(", ");this._log(`+ Leaving chord mode: Nothing bound to "${g}, ${d}".`),this._notificationService.status(localize(1687,"The key combination ({0}, {1}) is not a command.",g,d),{hideAfter:10*1e3}),this._leaveChordMode(),o=!0}}else{this.inChordMode&&this._leaveChordMode(),u.isBubble||(o=!0),this._log(`+ Invoking command ${u.commandId}.`),this._currentlyDispatchingCommandId=u.commandId;try{typeof u.commandArgs>"u"?this._commandService.executeCommand(u.commandId).then(void 0,g=>this._notificationService.warn(g)):this._commandService.executeCommand(u.commandId,u.commandArgs).then(void 0,g=>this._notificationService.warn(g))}finally{this._currentlyDispatchingCommandId=null}HIGH_FREQ_COMMANDS.test(u.commandId)||this._telemetryService.publicLog2("workbenchActionExecuted",{id:u.commandId,from:"keybinding",detail:e.getUserSettingsLabel()??void 0})}return o}}}mightProducePrintableCharacter(e){return e.ctrlKey||e.metaKey?!1:e.keyCode>=31&&e.keyCode<=56||e.keyCode>=21&&e.keyCode<=30}}const So=class So{constructor(e){this._ctrlKey=e?e.ctrlKey:!1,this._shiftKey=e?e.shiftKey:!1,this._altKey=e?e.altKey:!1,this._metaKey=e?e.metaKey:!1}has(e){switch(e){case"ctrl":return this._ctrlKey;case"shift":return this._shiftKey;case"alt":return this._altKey;case"meta":return this._metaKey}}};So.EMPTY=new So(null);let KeybindingModifierSet=So;class ResolvedKeybindingItem{constructor(e,t,s,o,r,l,c){this._resolvedKeybindingItemBrand=void 0,this.resolvedKeybinding=e,this.chords=e?toEmptyArrayIfContainsNull(e.getDispatchChords()):[],e&&this.chords.length===0&&(this.chords=toEmptyArrayIfContainsNull(e.getSingleModifierDispatchChords())),this.bubble=t?t.charCodeAt(0)===94:!1,this.command=this.bubble?t.substr(1):t,this.commandArgs=s,this.when=o,this.isDefault=r,this.extensionId=l,this.isBuiltinExtension=c}}function toEmptyArrayIfContainsNull(a){const e=[];for(let t=0,s=a.length;t<s;t++){const o=a[t];if(!o)return[];e.push(o)}return e}class BaseResolvedKeybinding extends ResolvedKeybinding{constructor(e,t){if(super(),t.length===0)throw illegalArgument("chords");this._os=e,this._chords=t}getLabel(){return UILabelProvider.toLabel(this._os,this._chords,e=>this._getLabel(e))}getAriaLabel(){return AriaLabelProvider.toLabel(this._os,this._chords,e=>this._getAriaLabel(e))}getElectronAccelerator(){return this._chords.length>1||this._chords[0].isDuplicateModifierCase()?null:ElectronAcceleratorLabelProvider.toLabel(this._os,this._chords,e=>this._getElectronAccelerator(e))}getUserSettingsLabel(){return UserSettingsLabelProvider.toLabel(this._os,this._chords,e=>this._getUserSettingsLabel(e))}hasMultipleChords(){return this._chords.length>1}getChords(){return this._chords.map(e=>this._getChord(e))}_getChord(e){return new ResolvedChord(e.ctrlKey,e.shiftKey,e.altKey,e.metaKey,this._getLabel(e),this._getAriaLabel(e))}getDispatchChords(){return this._chords.map(e=>this._getChordDispatch(e))}getSingleModifierDispatchChords(){return this._chords.map(e=>this._getSingleModifierChordDispatch(e))}}class USLayoutResolvedKeybinding extends BaseResolvedKeybinding{constructor(e,t){super(t,e)}_keyCodeToUILabel(e){if(this._os===2)switch(e){case 15:return"←";case 16:return"↑";case 17:return"→";case 18:return"↓"}return KeyCodeUtils.toString(e)}_getLabel(e){return e.isDuplicateModifierCase()?"":this._keyCodeToUILabel(e.keyCode)}_getAriaLabel(e){return e.isDuplicateModifierCase()?"":KeyCodeUtils.toString(e.keyCode)}_getElectronAccelerator(e){return KeyCodeUtils.toElectronAccelerator(e.keyCode)}_getUserSettingsLabel(e){if(e.isDuplicateModifierCase())return"";const t=KeyCodeUtils.toUserSettingsUS(e.keyCode);return t&&t.toLowerCase()}_getChordDispatch(e){return USLayoutResolvedKeybinding.getDispatchStr(e)}static getDispatchStr(e){if(e.isModifierKey())return null;let t="";return e.ctrlKey&&(t+="ctrl+"),e.shiftKey&&(t+="shift+"),e.altKey&&(t+="alt+"),e.metaKey&&(t+="meta+"),t+=KeyCodeUtils.toString(e.keyCode),t}_getSingleModifierChordDispatch(e){return e.keyCode===5&&!e.shiftKey&&!e.altKey&&!e.metaKey?"ctrl":e.keyCode===4&&!e.ctrlKey&&!e.altKey&&!e.metaKey?"shift":e.keyCode===6&&!e.ctrlKey&&!e.shiftKey&&!e.metaKey?"alt":e.keyCode===57&&!e.ctrlKey&&!e.shiftKey&&!e.altKey?"meta":null}static _scanCodeToKeyCode(e){const t=IMMUTABLE_CODE_TO_KEY_CODE[e];if(t!==-1)return t;switch(e){case 10:return 31;case 11:return 32;case 12:return 33;case 13:return 34;case 14:return 35;case 15:return 36;case 16:return 37;case 17:return 38;case 18:return 39;case 19:return 40;case 20:return 41;case 21:return 42;case 22:return 43;case 23:return 44;case 24:return 45;case 25:return 46;case 26:return 47;case 27:return 48;case 28:return 49;case 29:return 50;case 30:return 51;case 31:return 52;case 32:return 53;case 33:return 54;case 34:return 55;case 35:return 56;case 36:return 22;case 37:return 23;case 38:return 24;case 39:return 25;case 40:return 26;case 41:return 27;case 42:return 28;case 43:return 29;case 44:return 30;case 45:return 21;case 51:return 88;case 52:return 86;case 53:return 92;case 54:return 94;case 55:return 93;case 56:return 0;case 57:return 85;case 58:return 95;case 59:return 91;case 60:return 87;case 61:return 89;case 62:return 90;case 106:return 97}return 0}static _toKeyCodeChord(e){if(!e)return null;if(e instanceof KeyCodeChord)return e;const t=this._scanCodeToKeyCode(e.scanCode);return t===0?null:new KeyCodeChord(e.ctrlKey,e.shiftKey,e.altKey,e.metaKey,t)}static resolveKeybinding(e,t){const s=toEmptyArrayIfContainsNull(e.chords.map(o=>this._toKeyCodeChord(o)));return s.length>0?[new USLayoutResolvedKeybinding(s,t)]:[]}}let registeredAssociations=[],nonUserRegisteredAssociations=[],userRegisteredAssociations=[];function registerPlatformLanguageAssociation(a,e=!1){_registerLanguageAssociation(a,!1,e)}function _registerLanguageAssociation(a,e,t){const s=toLanguageAssociationItem(a,e);registeredAssociations.push(s),s.userConfigured?userRegisteredAssociations.push(s):nonUserRegisteredAssociations.push(s),t&&!s.userConfigured&&registeredAssociations.forEach(o=>{o.mime===s.mime||o.userConfigured||(s.extension&&o.extension===s.extension&&console.warn(`Overwriting extension <<${s.extension}>> to now point to mime <<${s.mime}>>`),s.filename&&o.filename===s.filename&&console.warn(`Overwriting filename <<${s.filename}>> to now point to mime <<${s.mime}>>`),s.filepattern&&o.filepattern===s.filepattern&&console.warn(`Overwriting filepattern <<${s.filepattern}>> to now point to mime <<${s.mime}>>`),s.firstline&&o.firstline===s.firstline&&console.warn(`Overwriting firstline <<${s.firstline}>> to now point to mime <<${s.mime}>>`))})}function toLanguageAssociationItem(a,e){return{id:a.id,mime:a.mime,filename:a.filename,extension:a.extension,filepattern:a.filepattern,firstline:a.firstline,userConfigured:e,filenameLowercase:a.filename?a.filename.toLowerCase():void 0,extensionLowercase:a.extension?a.extension.toLowerCase():void 0,filepatternLowercase:a.filepattern?parse(a.filepattern.toLowerCase()):void 0,filepatternOnPath:a.filepattern?a.filepattern.indexOf(posix.sep)>=0:!1}}function clearPlatformLanguageAssociations(){registeredAssociations=registeredAssociations.filter(a=>a.userConfigured),nonUserRegisteredAssociations=[]}function getLanguageIds(a,e){return getAssociations(a,e).map(t=>t.id)}function getAssociations(a,e){let t;if(a)switch(a.scheme){case Schemas.file:t=a.fsPath;break;case Schemas.data:{t=DataUri.parseMetaData(a).get(DataUri.META_DATA_LABEL);break}case Schemas.vscodeNotebookCell:t=void 0;break;default:t=a.path}if(!t)return[{id:"unknown",mime:Mimes.unknown}];t=t.toLowerCase();const s=basename$1(t),o=getAssociationByPath(t,s,userRegisteredAssociations);if(o)return[o,{id:PLAINTEXT_LANGUAGE_ID,mime:Mimes.text}];const r=getAssociationByPath(t,s,nonUserRegisteredAssociations);if(r)return[r,{id:PLAINTEXT_LANGUAGE_ID,mime:Mimes.text}];if(e){const l=getAssociationByFirstline(e);if(l)return[l,{id:PLAINTEXT_LANGUAGE_ID,mime:Mimes.text}]}return[{id:"unknown",mime:Mimes.unknown}]}function getAssociationByPath(a,e,t){var l;let s,o,r;for(let c=t.length-1;c>=0;c--){const d=t[c];if(e===d.filenameLowercase){s=d;break}if(d.filepattern&&(!o||d.filepattern.length>o.filepattern.length)){const u=d.filepatternOnPath?a:e;(l=d.filepatternLowercase)!=null&&l.call(d,u)&&(o=d)}d.extension&&(!r||d.extension.length>r.extension.length)&&e.endsWith(d.extensionLowercase)&&(r=d)}if(s)return s;if(o)return o;if(r)return r}function getAssociationByFirstline(a){if(startsWithUTF8BOM(a)&&(a=a.substr(1)),a.length>0)for(let e=registeredAssociations.length-1;e>=0;e--){const t=registeredAssociations[e];if(!t.firstline)continue;const s=a.match(t.firstline);if(s&&s.length>0)return t}}const hasOwnProperty=Object.prototype.hasOwnProperty,NULL_LANGUAGE_ID="vs.editor.nullLanguage";class LanguageIdCodec{constructor(){this._languageIdToLanguage=[],this._languageToLanguageId=new Map,this._register(NULL_LANGUAGE_ID,0),this._register(PLAINTEXT_LANGUAGE_ID,1),this._nextLanguageId=2}_register(e,t){this._languageIdToLanguage[t]=e,this._languageToLanguageId.set(e,t)}register(e){if(this._languageToLanguageId.has(e))return;const t=this._nextLanguageId++;this._register(e,t)}encodeLanguageId(e){return this._languageToLanguageId.get(e)||0}decodeLanguageId(e){return this._languageIdToLanguage[e]||NULL_LANGUAGE_ID}}const Ln=class Ln extends Disposable{constructor(e=!0,t=!1){super(),this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,Ln.instanceCount++,this._warnOnOverwrite=t,this.languageIdCodec=new LanguageIdCodec,this._dynamicLanguages=[],this._languages={},this._mimeTypesMap={},this._nameMap={},this._lowercaseNameMap={},e&&(this._initializeFromRegistry(),this._register(ModesRegistry.onDidChangeLanguages(s=>{this._initializeFromRegistry()})))}dispose(){Ln.instanceCount--,super.dispose()}_initializeFromRegistry(){this._languages={},this._mimeTypesMap={},this._nameMap={},this._lowercaseNameMap={},clearPlatformLanguageAssociations();const e=[].concat(ModesRegistry.getLanguages()).concat(this._dynamicLanguages);this._registerLanguages(e)}_registerLanguages(e){for(const t of e)this._registerLanguage(t);this._mimeTypesMap={},this._nameMap={},this._lowercaseNameMap={},Object.keys(this._languages).forEach(t=>{const s=this._languages[t];s.name&&(this._nameMap[s.name]=s.identifier),s.aliases.forEach(o=>{this._lowercaseNameMap[o.toLowerCase()]=s.identifier}),s.mimetypes.forEach(o=>{this._mimeTypesMap[o]=s.identifier})}),Registry.as(Extensions$6.Configuration).registerOverrideIdentifiers(this.getRegisteredLanguageIds()),this._onDidChange.fire()}_registerLanguage(e){const t=e.id;let s;hasOwnProperty.call(this._languages,t)?s=this._languages[t]:(this.languageIdCodec.register(t),s={identifier:t,name:null,mimetypes:[],aliases:[],extensions:[],filenames:[],configurationFiles:[],icons:[]},this._languages[t]=s),this._mergeLanguage(s,e)}_mergeLanguage(e,t){const s=t.id;let o=null;if(Array.isArray(t.mimetypes)&&t.mimetypes.length>0&&(e.mimetypes.push(...t.mimetypes),o=t.mimetypes[0]),o||(o=`text/x-${s}`,e.mimetypes.push(o)),Array.isArray(t.extensions)){t.configuration?e.extensions=t.extensions.concat(e.extensions):e.extensions=e.extensions.concat(t.extensions);for(const c of t.extensions)registerPlatformLanguageAssociation({id:s,mime:o,extension:c},this._warnOnOverwrite)}if(Array.isArray(t.filenames))for(const c of t.filenames)registerPlatformLanguageAssociation({id:s,mime:o,filename:c},this._warnOnOverwrite),e.filenames.push(c);if(Array.isArray(t.filenamePatterns))for(const c of t.filenamePatterns)registerPlatformLanguageAssociation({id:s,mime:o,filepattern:c},this._warnOnOverwrite);if(typeof t.firstLine=="string"&&t.firstLine.length>0){let c=t.firstLine;c.charAt(0)!=="^"&&(c="^"+c);try{const d=new RegExp(c);regExpLeadsToEndlessLoop(d)||registerPlatformLanguageAssociation({id:s,mime:o,firstline:d},this._warnOnOverwrite)}catch(d){console.warn(`[${t.id}]: Invalid regular expression \`${c}\`: `,d)}}e.aliases.push(s);let r=null;if(typeof t.aliases<"u"&&Array.isArray(t.aliases)&&(t.aliases.length===0?r=[null]:r=t.aliases),r!==null)for(const c of r)!c||c.length===0||e.aliases.push(c);const l=r!==null&&r.length>0;if(!(l&&r[0]===null)){const c=(l?r[0]:null)||s;(l||!e.name)&&(e.name=c)}t.configuration&&e.configurationFiles.push(t.configuration),t.icon&&e.icons.push(t.icon)}isRegisteredLanguageId(e){return e?hasOwnProperty.call(this._languages,e):!1}getRegisteredLanguageIds(){return Object.keys(this._languages)}getLanguageIdByLanguageName(e){const t=e.toLowerCase();return hasOwnProperty.call(this._lowercaseNameMap,t)?this._lowercaseNameMap[t]:null}getLanguageIdByMimeType(e){return e&&hasOwnProperty.call(this._mimeTypesMap,e)?this._mimeTypesMap[e]:null}guessLanguageIdByFilepathOrFirstLine(e,t){return!e&&!t?[]:getLanguageIds(e,t)}};Ln.instanceCount=0;let LanguagesRegistry=Ln;const En=class En extends Disposable{constructor(e=!1){super(),this._onDidRequestBasicLanguageFeatures=this._register(new Emitter$1),this.onDidRequestBasicLanguageFeatures=this._onDidRequestBasicLanguageFeatures.event,this._onDidRequestRichLanguageFeatures=this._register(new Emitter$1),this.onDidRequestRichLanguageFeatures=this._onDidRequestRichLanguageFeatures.event,this._onDidChange=this._register(new Emitter$1({leakWarningThreshold:200})),this.onDidChange=this._onDidChange.event,this._requestedBasicLanguages=new Set,this._requestedRichLanguages=new Set,En.instanceCount++,this._registry=this._register(new LanguagesRegistry(!0,e)),this.languageIdCodec=this._registry.languageIdCodec,this._register(this._registry.onDidChange(()=>this._onDidChange.fire()))}dispose(){En.instanceCount--,super.dispose()}isRegisteredLanguageId(e){return this._registry.isRegisteredLanguageId(e)}getLanguageIdByLanguageName(e){return this._registry.getLanguageIdByLanguageName(e)}getLanguageIdByMimeType(e){return this._registry.getLanguageIdByMimeType(e)}guessLanguageIdByFilepathOrFirstLine(e,t){return this._registry.guessLanguageIdByFilepathOrFirstLine(e,t).at(0)??null}createById(e){return new LanguageSelection(this.onDidChange,()=>this._createAndGetLanguageIdentifier(e))}createByFilepathOrFirstLine(e,t){return new LanguageSelection(this.onDidChange,()=>{const s=this.guessLanguageIdByFilepathOrFirstLine(e,t);return this._createAndGetLanguageIdentifier(s)})}_createAndGetLanguageIdentifier(e){return(!e||!this.isRegisteredLanguageId(e))&&(e=PLAINTEXT_LANGUAGE_ID),e}requestBasicLanguageFeatures(e){this._requestedBasicLanguages.has(e)||(this._requestedBasicLanguages.add(e),this._onDidRequestBasicLanguageFeatures.fire(e))}requestRichLanguageFeatures(e){this._requestedRichLanguages.has(e)||(this._requestedRichLanguages.add(e),this.requestBasicLanguageFeatures(e),TokenizationRegistry.getOrCreate(e),this._onDidRequestRichLanguageFeatures.fire(e))}};En.instanceCount=0;let LanguageService=En;class LanguageSelection{constructor(e,t){this._value=observableFromEvent(this,e,()=>t()),this.onDidChange=Event$1.fromObservable(this._value)}get languageId(){return this._value.get()}}const MENU_MNEMONIC_REGEX=/\(&([^\s&])\)|(^|[^&])&([^\s&])/,MENU_ESCAPED_MNEMONIC_REGEX=/(&amp;)?(&amp;)([^\s&])/g;var HorizontalDirection;(function(a){a[a.Right=0]="Right",a[a.Left=1]="Left"})(HorizontalDirection||(HorizontalDirection={}));var VerticalDirection;(function(a){a[a.Above=0]="Above",a[a.Below=1]="Below"})(VerticalDirection||(VerticalDirection={}));class Menu extends ActionBar{constructor(e,t,s,o){e.classList.add("monaco-menu-container"),e.setAttribute("role","presentation");const r=document.createElement("div");r.classList.add("monaco-menu"),r.setAttribute("role","presentation"),super(r,{orientation:1,actionViewItemProvider:u=>this.doGetActionViewItem(u,s,l),context:s.context,actionRunner:s.actionRunner,ariaLabel:s.ariaLabel,ariaRole:"menu",focusOnlyEnabledItems:!0,triggerKeys:{keys:[3,...isMacintosh||isLinux?[10]:[]],keyDown:!0}}),this.menuStyles=o,this.menuElement=r,this.actionsList.tabIndex=0,this.initializeOrUpdateStyleSheet(e,o),this._register(Gesture.addTarget(r)),this._register(addDisposableListener(r,EventType$1.KEY_DOWN,u=>{new StandardKeyboardEvent(u).equals(2)&&u.preventDefault()})),s.enableMnemonics&&this._register(addDisposableListener(r,EventType$1.KEY_DOWN,u=>{const g=u.key.toLocaleLowerCase();if(this.mnemonics.has(g)){EventHelper.stop(u,!0);const f=this.mnemonics.get(g);if(f.length===1&&(f[0]instanceof SubmenuMenuActionViewItem&&f[0].container&&this.focusItemByElement(f[0].container),f[0].onClick(u)),f.length>1){const p=f.shift();p&&p.container&&(this.focusItemByElement(p.container),f.push(p)),this.mnemonics.set(g,f)}}})),isLinux&&this._register(addDisposableListener(r,EventType$1.KEY_DOWN,u=>{const g=new StandardKeyboardEvent(u);g.equals(14)||g.equals(11)?(this.focusedItem=this.viewItems.length-1,this.focusNext(),EventHelper.stop(u,!0)):(g.equals(13)||g.equals(12))&&(this.focusedItem=0,this.focusPrevious(),EventHelper.stop(u,!0))})),this._register(addDisposableListener(this.domNode,EventType$1.MOUSE_OUT,u=>{const g=u.relatedTarget;isAncestor$1(g,this.domNode)||(this.focusedItem=void 0,this.updateFocus(),u.stopPropagation())})),this._register(addDisposableListener(this.actionsList,EventType$1.MOUSE_OVER,u=>{let g=u.target;if(!(!g||!isAncestor$1(g,this.actionsList)||g===this.actionsList)){for(;g.parentElement!==this.actionsList&&g.parentElement!==null;)g=g.parentElement;if(g.classList.contains("action-item")){const f=this.focusedItem;this.setFocusedItem(g),f!==this.focusedItem&&this.updateFocus()}}})),this._register(Gesture.addTarget(this.actionsList)),this._register(addDisposableListener(this.actionsList,EventType.Tap,u=>{let g=u.initialTarget;if(!(!g||!isAncestor$1(g,this.actionsList)||g===this.actionsList)){for(;g.parentElement!==this.actionsList&&g.parentElement!==null;)g=g.parentElement;if(g.classList.contains("action-item")){const f=this.focusedItem;this.setFocusedItem(g),f!==this.focusedItem&&this.updateFocus()}}}));const l={parent:this};this.mnemonics=new Map,this.scrollableElement=this._register(new DomScrollableElement(r,{alwaysConsumeMouseWheel:!0,horizontal:2,vertical:3,verticalScrollbarSize:7,handleMouseWheel:!0,useShadows:!0}));const c=this.scrollableElement.getDomNode();c.style.position="",this.styleScrollElement(c,o),this._register(addDisposableListener(r,EventType.Change,u=>{EventHelper.stop(u,!0);const g=this.scrollableElement.getScrollPosition().scrollTop;this.scrollableElement.setScrollPosition({scrollTop:g-u.translationY})})),this._register(addDisposableListener(c,EventType$1.MOUSE_UP,u=>{u.preventDefault()}));const d=getWindow(e);r.style.maxHeight=`${Math.max(10,d.innerHeight-e.getBoundingClientRect().top-35)}px`,t=t.filter((u,g)=>{var f;return(f=s.submenuIds)!=null&&f.has(u.id)?(console.warn(`Found submenu cycle: ${u.id}`),!1):!(u instanceof Separator&&(g===t.length-1||g===0||t[g-1]instanceof Separator))}),this.push(t,{icon:!0,label:!0,isMenu:!0}),e.appendChild(this.scrollableElement.getDomNode()),this.scrollableElement.scanDomNode(),this.viewItems.filter(u=>!(u instanceof MenuSeparatorActionViewItem)).forEach((u,g,f)=>{u.updatePositionInSet(g+1,f.length)})}initializeOrUpdateStyleSheet(e,t){this.styleSheet||(isInShadowDOM(e)?this.styleSheet=createStyleSheet(e):(Menu.globalStyleSheet||(Menu.globalStyleSheet=createStyleSheet()),this.styleSheet=Menu.globalStyleSheet)),this.styleSheet.textContent=getMenuWidgetCSS(t,isInShadowDOM(e))}styleScrollElement(e,t){const s=t.foregroundColor??"",o=t.backgroundColor??"",r=t.borderColor?`1px solid ${t.borderColor}`:"",l="5px",c=t.shadowColor?`0 2px 8px ${t.shadowColor}`:"";e.style.outline=r,e.style.borderRadius=l,e.style.color=s,e.style.backgroundColor=o,e.style.boxShadow=c}getContainer(){return this.scrollableElement.getDomNode()}get onScroll(){return this.scrollableElement.onScroll}focusItemByElement(e){const t=this.focusedItem;this.setFocusedItem(e),t!==this.focusedItem&&this.updateFocus()}setFocusedItem(e){for(let t=0;t<this.actionsList.children.length;t++){const s=this.actionsList.children[t];if(e===s){this.focusedItem=t;break}}}updateFocus(e){super.updateFocus(e,!0,!0),typeof this.focusedItem<"u"&&this.scrollableElement.setScrollPosition({scrollTop:Math.round(this.menuElement.scrollTop)})}doGetActionViewItem(e,t,s){var o,r;if(e instanceof Separator)return new MenuSeparatorActionViewItem(t.context,e,{icon:!0},this.menuStyles);if(e instanceof SubmenuAction){const l=new SubmenuMenuActionViewItem(e,e.actions,s,{...t,submenuIds:new Set([...t.submenuIds||[],e.id])},this.menuStyles);if(t.enableMnemonics){const c=l.getMnemonic();if(c&&l.isEnabled()){let d=[];this.mnemonics.has(c)&&(d=this.mnemonics.get(c)),d.push(l),this.mnemonics.set(c,d)}}return l}else{const l=(r=(o=t.getKeyBinding)==null?void 0:o.call(t,e))==null?void 0:r.getLabel(),c={enableMnemonics:t.enableMnemonics,useEventAsContext:t.useEventAsContext,keybinding:l},d=new BaseMenuActionViewItem(t.context,e,c,this.menuStyles);if(t.enableMnemonics){const u=d.getMnemonic();if(u&&d.isEnabled()){let g=[];this.mnemonics.has(u)&&(g=this.mnemonics.get(u)),g.push(d),this.mnemonics.set(u,g)}}return d}}}class BaseMenuActionViewItem extends BaseActionViewItem{constructor(e,t,s,o){if(s={...s,isMenu:!0,icon:s.icon!==void 0?s.icon:!1,label:s.label!==void 0?s.label:!0},super(t,t,s),this.menuStyle=o,this.options=s,this.cssClass="",this.options.label&&s.enableMnemonics){const r=this.action.label;if(r){const l=MENU_MNEMONIC_REGEX.exec(r);l&&(this.mnemonic=(l[1]?l[1]:l[3]).toLocaleLowerCase())}}this.runOnceToEnableMouseUp=new RunOnceScheduler(()=>{this.element&&(this._register(addDisposableListener(this.element,EventType$1.MOUSE_UP,r=>{if(EventHelper.stop(r,!0),isFirefox$1){if(new StandardMouseEvent(getWindow(this.element),r).rightButton)return;this.onClick(r)}else setTimeout(()=>{this.onClick(r)},0)})),this._register(addDisposableListener(this.element,EventType$1.CONTEXT_MENU,r=>{EventHelper.stop(r,!0)})))},100),this._register(this.runOnceToEnableMouseUp)}render(e){super.render(e),this.element&&(this.container=e,this.item=append$2(this.element,$$l("a.action-menu-item")),this._action.id===Separator.ID?this.item.setAttribute("role","presentation"):(this.item.setAttribute("role","menuitem"),this.mnemonic&&this.item.setAttribute("aria-keyshortcuts",`${this.mnemonic}`)),this.check=append$2(this.item,$$l("span.menu-item-check"+ThemeIcon.asCSSSelector(Codicon.menuSelection))),this.check.setAttribute("role","none"),this.label=append$2(this.item,$$l("span.action-label")),this.options.label&&this.options.keybinding&&(append$2(this.item,$$l("span.keybinding")).textContent=this.options.keybinding),this.runOnceToEnableMouseUp.schedule(),this.updateClass(),this.updateLabel(),this.updateTooltip(),this.updateEnabled(),this.updateChecked(),this.applyStyle())}blur(){super.blur(),this.applyStyle()}focus(){var e;super.focus(),(e=this.item)==null||e.focus(),this.applyStyle()}updatePositionInSet(e,t){this.item&&(this.item.setAttribute("aria-posinset",`${e}`),this.item.setAttribute("aria-setsize",`${t}`))}updateLabel(){var e;if(this.label&&this.options.label){clearNode(this.label);let t=stripIcons(this.action.label);if(t){const s=cleanMnemonic(t);this.options.enableMnemonics||(t=s),this.label.setAttribute("aria-label",s.replace(/&&/g,"&"));const o=MENU_MNEMONIC_REGEX.exec(t);if(o){t=escape$2(t),MENU_ESCAPED_MNEMONIC_REGEX.lastIndex=0;let r=MENU_ESCAPED_MNEMONIC_REGEX.exec(t);for(;r&&r[1];)r=MENU_ESCAPED_MNEMONIC_REGEX.exec(t);const l=c=>c.replace(/&amp;&amp;/g,"&amp;");r?this.label.append(ltrim(l(t.substr(0,r.index))," "),$$l("u",{"aria-hidden":"true"},r[3]),rtrim$1(l(t.substr(r.index+r[0].length))," ")):this.label.textContent=l(t).trim(),(e=this.item)==null||e.setAttribute("aria-keyshortcuts",(o[1]?o[1]:o[3]).toLocaleLowerCase())}else this.label.textContent=t.replace(/&&/g,"&").trim()}}}updateTooltip(){}updateClass(){this.cssClass&&this.item&&this.item.classList.remove(...this.cssClass.split(" ")),this.options.icon&&this.label?(this.cssClass=this.action.class||"",this.label.classList.add("icon"),this.cssClass&&this.label.classList.add(...this.cssClass.split(" ")),this.updateEnabled()):this.label&&this.label.classList.remove("icon")}updateEnabled(){this.action.enabled?(this.element&&(this.element.classList.remove("disabled"),this.element.removeAttribute("aria-disabled")),this.item&&(this.item.classList.remove("disabled"),this.item.removeAttribute("aria-disabled"),this.item.tabIndex=0)):(this.element&&(this.element.classList.add("disabled"),this.element.setAttribute("aria-disabled","true")),this.item&&(this.item.classList.add("disabled"),this.item.setAttribute("aria-disabled","true")))}updateChecked(){if(!this.item)return;const e=this.action.checked;this.item.classList.toggle("checked",!!e),e!==void 0?(this.item.setAttribute("role","menuitemcheckbox"),this.item.setAttribute("aria-checked",e?"true":"false")):(this.item.setAttribute("role","menuitem"),this.item.setAttribute("aria-checked",""))}getMnemonic(){return this.mnemonic}applyStyle(){const e=this.element&&this.element.classList.contains("focused"),t=e&&this.menuStyle.selectionForegroundColor?this.menuStyle.selectionForegroundColor:this.menuStyle.foregroundColor,s=e&&this.menuStyle.selectionBackgroundColor?this.menuStyle.selectionBackgroundColor:void 0,o=e&&this.menuStyle.selectionBorderColor?`1px solid ${this.menuStyle.selectionBorderColor}`:"",r=e&&this.menuStyle.selectionBorderColor?"-1px":"";this.item&&(this.item.style.color=t??"",this.item.style.backgroundColor=s??"",this.item.style.outline=o,this.item.style.outlineOffset=r),this.check&&(this.check.style.color=t??"")}}class SubmenuMenuActionViewItem extends BaseMenuActionViewItem{constructor(e,t,s,o,r){super(e,e,o,r),this.submenuActions=t,this.parentData=s,this.submenuOptions=o,this.mysubmenu=null,this.submenuDisposables=this._register(new DisposableStore),this.mouseOver=!1,this.expandDirection=o&&o.expandDirection!==void 0?o.expandDirection:{horizontal:HorizontalDirection.Right,vertical:VerticalDirection.Below},this.showScheduler=new RunOnceScheduler(()=>{this.mouseOver&&(this.cleanupExistingSubmenu(!1),this.createSubmenu(!1))},250),this.hideScheduler=new RunOnceScheduler(()=>{this.element&&!isAncestor$1(getActiveElement(),this.element)&&this.parentData.submenu===this.mysubmenu&&(this.parentData.parent.focus(!1),this.cleanupExistingSubmenu(!0))},750)}render(e){super.render(e),this.element&&(this.item&&(this.item.classList.add("monaco-submenu-item"),this.item.tabIndex=0,this.item.setAttribute("aria-haspopup","true"),this.updateAriaExpanded("false"),this.submenuIndicator=append$2(this.item,$$l("span.submenu-indicator"+ThemeIcon.asCSSSelector(Codicon.menuSubmenu))),this.submenuIndicator.setAttribute("aria-hidden","true")),this._register(addDisposableListener(this.element,EventType$1.KEY_UP,t=>{const s=new StandardKeyboardEvent(t);(s.equals(17)||s.equals(3))&&(EventHelper.stop(t,!0),this.createSubmenu(!0))})),this._register(addDisposableListener(this.element,EventType$1.KEY_DOWN,t=>{const s=new StandardKeyboardEvent(t);getActiveElement()===this.item&&(s.equals(17)||s.equals(3))&&EventHelper.stop(t,!0)})),this._register(addDisposableListener(this.element,EventType$1.MOUSE_OVER,t=>{this.mouseOver||(this.mouseOver=!0,this.showScheduler.schedule())})),this._register(addDisposableListener(this.element,EventType$1.MOUSE_LEAVE,t=>{this.mouseOver=!1})),this._register(addDisposableListener(this.element,EventType$1.FOCUS_OUT,t=>{this.element&&!isAncestor$1(getActiveElement(),this.element)&&this.hideScheduler.schedule()})),this._register(this.parentData.parent.onScroll(()=>{this.parentData.submenu===this.mysubmenu&&(this.parentData.parent.focus(!1),this.cleanupExistingSubmenu(!0))})))}updateEnabled(){}onClick(e){EventHelper.stop(e,!0),this.cleanupExistingSubmenu(!1),this.createSubmenu(!0)}cleanupExistingSubmenu(e){if(this.parentData.submenu&&(e||this.parentData.submenu!==this.mysubmenu)){try{this.parentData.submenu.dispose()}catch{}this.parentData.submenu=void 0,this.updateAriaExpanded("false"),this.submenuContainer&&(this.submenuDisposables.clear(),this.submenuContainer=void 0)}}calculateSubmenuMenuLayout(e,t,s,o){const r={top:0,left:0};return r.left=layout(e.width,t.width,{position:o.horizontal===HorizontalDirection.Right?0:1,offset:s.left,size:s.width}),r.left>=s.left&&r.left<s.left+s.width&&(s.left+10+t.width<=e.width&&(r.left=s.left+10),s.top+=10,s.height=0),r.top=layout(e.height,t.height,{position:0,offset:s.top,size:0}),r.top+t.height===s.top&&r.top+s.height+t.height<=e.height&&(r.top+=s.height),r}createSubmenu(e=!0){if(this.element)if(this.parentData.submenu)this.parentData.submenu.focus(!1);else{this.updateAriaExpanded("true"),this.submenuContainer=append$2(this.element,$$l("div.monaco-submenu")),this.submenuContainer.classList.add("menubar-menu-items-holder","context-view");const t=getWindow(this.parentData.parent.domNode).getComputedStyle(this.parentData.parent.domNode),s=parseFloat(t.paddingTop||"0")||0;this.submenuContainer.style.position="fixed",this.submenuContainer.style.top="0",this.submenuContainer.style.left="0",this.submenuContainer.style.zIndex="1",this.parentData.submenu=new Menu(this.submenuContainer,this.submenuActions.length?this.submenuActions:[new EmptySubmenuAction],this.submenuOptions,this.menuStyle);const o=this.element.getBoundingClientRect(),r={top:o.top-s,left:o.left,height:o.height+2*s,width:o.width},l=this.submenuContainer.getBoundingClientRect(),c=getWindow(this.element),{top:d,left:u}=this.calculateSubmenuMenuLayout(new Dimension(c.innerWidth,c.innerHeight),Dimension.lift(l),r,this.expandDirection);this.submenuContainer.style.left=`${u-l.left}px`,this.submenuContainer.style.top=`${d-l.top}px`,this.submenuDisposables.add(addDisposableListener(this.submenuContainer,EventType$1.KEY_UP,g=>{new StandardKeyboardEvent(g).equals(15)&&(EventHelper.stop(g,!0),this.parentData.parent.focus(),this.cleanupExistingSubmenu(!0))})),this.submenuDisposables.add(addDisposableListener(this.submenuContainer,EventType$1.KEY_DOWN,g=>{new StandardKeyboardEvent(g).equals(15)&&EventHelper.stop(g,!0)})),this.submenuDisposables.add(this.parentData.submenu.onDidCancel(()=>{this.parentData.parent.focus(),this.cleanupExistingSubmenu(!0)})),this.parentData.submenu.focus(e),this.mysubmenu=this.parentData.submenu}}updateAriaExpanded(e){var t;this.item&&((t=this.item)==null||t.setAttribute("aria-expanded",e))}applyStyle(){super.applyStyle();const t=this.element&&this.element.classList.contains("focused")&&this.menuStyle.selectionForegroundColor?this.menuStyle.selectionForegroundColor:this.menuStyle.foregroundColor;this.submenuIndicator&&(this.submenuIndicator.style.color=t??"")}dispose(){super.dispose(),this.hideScheduler.dispose(),this.mysubmenu&&(this.mysubmenu.dispose(),this.mysubmenu=null),this.submenuContainer&&(this.submenuContainer=void 0)}}class MenuSeparatorActionViewItem extends ActionViewItem{constructor(e,t,s,o){super(e,t,s),this.menuStyles=o}render(e){super.render(e),this.label&&(this.label.style.borderBottomColor=this.menuStyles.separatorColor?`${this.menuStyles.separatorColor}`:"")}}function cleanMnemonic(a){const e=MENU_MNEMONIC_REGEX,t=e.exec(a);if(!t)return a;const s=!t[1];return a.replace(e,s?"$2$3":"").trim()}function formatRule(a){const e=getCodiconFontCharacters()[a.id];return`.codicon-${a.id}:before { content: '\\${e.toString(16)}'; }`}function getMenuWidgetCSS(a,e){let t=`
.monaco-menu {
	font-size: 13px;
	border-radius: 5px;
	min-width: 160px;
}

${formatRule(Codicon.menuSelection)}
${formatRule(Codicon.menuSubmenu)}

.monaco-menu .monaco-action-bar {
	text-align: right;
	overflow: hidden;
	white-space: nowrap;
}

.monaco-menu .monaco-action-bar .actions-container {
	display: flex;
	margin: 0 auto;
	padding: 0;
	width: 100%;
	justify-content: flex-end;
}

.monaco-menu .monaco-action-bar.vertical .actions-container {
	display: inline-block;
}

.monaco-menu .monaco-action-bar.reverse .actions-container {
	flex-direction: row-reverse;
}

.monaco-menu .monaco-action-bar .action-item {
	cursor: pointer;
	display: inline-block;
	transition: transform 50ms ease;
	position: relative;  /* DO NOT REMOVE - this is the key to preventing the ghosting icon bug in Chrome 42 */
}

.monaco-menu .monaco-action-bar .action-item.disabled {
	cursor: default;
}

.monaco-menu .monaco-action-bar .action-item .icon,
.monaco-menu .monaco-action-bar .action-item .codicon {
	display: inline-block;
}

.monaco-menu .monaco-action-bar .action-item .codicon {
	display: flex;
	align-items: center;
}

.monaco-menu .monaco-action-bar .action-label {
	font-size: 11px;
	margin-right: 4px;
}

.monaco-menu .monaco-action-bar .action-item.disabled .action-label,
.monaco-menu .monaco-action-bar .action-item.disabled .action-label:hover {
	color: var(--vscode-disabledForeground);
}

/* Vertical actions */

.monaco-menu .monaco-action-bar.vertical {
	text-align: left;
}

.monaco-menu .monaco-action-bar.vertical .action-item {
	display: block;
}

.monaco-menu .monaco-action-bar.vertical .action-label.separator {
	display: block;
	border-bottom: 1px solid var(--vscode-menu-separatorBackground);
	padding-top: 1px;
	padding: 30px;
}

.monaco-menu .secondary-actions .monaco-action-bar .action-label {
	margin-left: 6px;
}

/* Action Items */
.monaco-menu .monaco-action-bar .action-item.select-container {
	overflow: hidden; /* somehow the dropdown overflows its container, we prevent it here to not push */
	flex: 1;
	max-width: 170px;
	min-width: 60px;
	display: flex;
	align-items: center;
	justify-content: center;
	margin-right: 10px;
}

.monaco-menu .monaco-action-bar.vertical {
	margin-left: 0;
	overflow: visible;
}

.monaco-menu .monaco-action-bar.vertical .actions-container {
	display: block;
}

.monaco-menu .monaco-action-bar.vertical .action-item {
	padding: 0;
	transform: none;
	display: flex;
}

.monaco-menu .monaco-action-bar.vertical .action-item.active {
	transform: none;
}

.monaco-menu .monaco-action-bar.vertical .action-menu-item {
	flex: 1 1 auto;
	display: flex;
	height: 2em;
	align-items: center;
	position: relative;
	margin: 0 4px;
	border-radius: 4px;
}

.monaco-menu .monaco-action-bar.vertical .action-menu-item:hover .keybinding,
.monaco-menu .monaco-action-bar.vertical .action-menu-item:focus .keybinding {
	opacity: unset;
}

.monaco-menu .monaco-action-bar.vertical .action-label {
	flex: 1 1 auto;
	text-decoration: none;
	padding: 0 1em;
	background: none;
	font-size: 12px;
	line-height: 1;
}

.monaco-menu .monaco-action-bar.vertical .keybinding,
.monaco-menu .monaco-action-bar.vertical .submenu-indicator {
	display: inline-block;
	flex: 2 1 auto;
	padding: 0 1em;
	text-align: right;
	font-size: 12px;
	line-height: 1;
	opacity: 0.7;
}

.monaco-menu .monaco-action-bar.vertical .submenu-indicator {
	height: 100%;
}

.monaco-menu .monaco-action-bar.vertical .submenu-indicator.codicon {
	font-size: 16px !important;
	display: flex;
	align-items: center;
}

.monaco-menu .monaco-action-bar.vertical .submenu-indicator.codicon::before {
	margin-left: auto;
	margin-right: -20px;
}

.monaco-menu .monaco-action-bar.vertical .action-item.disabled .keybinding,
.monaco-menu .monaco-action-bar.vertical .action-item.disabled .submenu-indicator {
	opacity: 0.4;
}

.monaco-menu .monaco-action-bar.vertical .action-label:not(.separator) {
	display: inline-block;
	box-sizing: border-box;
	margin: 0;
}

.monaco-menu .monaco-action-bar.vertical .action-item {
	position: static;
	overflow: visible;
}

.monaco-menu .monaco-action-bar.vertical .action-item .monaco-submenu {
	position: absolute;
}

.monaco-menu .monaco-action-bar.vertical .action-label.separator {
	width: 100%;
	height: 0px !important;
	opacity: 1;
}

.monaco-menu .monaco-action-bar.vertical .action-label.separator.text {
	padding: 0.7em 1em 0.1em 1em;
	font-weight: bold;
	opacity: 1;
}

.monaco-menu .monaco-action-bar.vertical .action-label:hover {
	color: inherit;
}

.monaco-menu .monaco-action-bar.vertical .menu-item-check {
	position: absolute;
	visibility: hidden;
	width: 1em;
	height: 100%;
}

.monaco-menu .monaco-action-bar.vertical .action-menu-item.checked .menu-item-check {
	visibility: visible;
	display: flex;
	align-items: center;
	justify-content: center;
}

/* Context Menu */

.context-view.monaco-menu-container {
	outline: 0;
	border: none;
	animation: fadeIn 0.083s linear;
	-webkit-app-region: no-drag;
}

.context-view.monaco-menu-container :focus,
.context-view.monaco-menu-container .monaco-action-bar.vertical:focus,
.context-view.monaco-menu-container .monaco-action-bar.vertical :focus {
	outline: 0;
}

.hc-black .context-view.monaco-menu-container,
.hc-light .context-view.monaco-menu-container,
:host-context(.hc-black) .context-view.monaco-menu-container,
:host-context(.hc-light) .context-view.monaco-menu-container {
	box-shadow: none;
}

.hc-black .monaco-menu .monaco-action-bar.vertical .action-item.focused,
.hc-light .monaco-menu .monaco-action-bar.vertical .action-item.focused,
:host-context(.hc-black) .monaco-menu .monaco-action-bar.vertical .action-item.focused,
:host-context(.hc-light) .monaco-menu .monaco-action-bar.vertical .action-item.focused {
	background: none;
}

/* Vertical Action Bar Styles */

.monaco-menu .monaco-action-bar.vertical {
	padding: 4px 0;
}

.monaco-menu .monaco-action-bar.vertical .action-menu-item {
	height: 2em;
}

.monaco-menu .monaco-action-bar.vertical .action-label:not(.separator),
.monaco-menu .monaco-action-bar.vertical .keybinding {
	font-size: inherit;
	padding: 0 2em;
	max-height: 100%;
}

.monaco-menu .monaco-action-bar.vertical .menu-item-check {
	font-size: inherit;
	width: 2em;
}

.monaco-menu .monaco-action-bar.vertical .action-label.separator {
	font-size: inherit;
	margin: 5px 0 !important;
	padding: 0;
	border-radius: 0;
}

.linux .monaco-menu .monaco-action-bar.vertical .action-label.separator,
:host-context(.linux) .monaco-menu .monaco-action-bar.vertical .action-label.separator {
	margin-left: 0;
	margin-right: 0;
}

.monaco-menu .monaco-action-bar.vertical .submenu-indicator {
	font-size: 60%;
	padding: 0 1.8em;
}

.linux .monaco-menu .monaco-action-bar.vertical .submenu-indicator,
:host-context(.linux) .monaco-menu .monaco-action-bar.vertical .submenu-indicator {
	height: 100%;
	mask-size: 10px 10px;
	-webkit-mask-size: 10px 10px;
}

.monaco-menu .action-item {
	cursor: default;
}`;if(e){t+=`
			/* Arrows */
			.monaco-scrollable-element > .scrollbar > .scra {
				cursor: pointer;
				font-size: 11px !important;
			}

			.monaco-scrollable-element > .visible {
				opacity: 1;

				/* Background rule added for IE9 - to allow clicks on dom node */
				background:rgba(0,0,0,0);

				transition: opacity 100ms linear;
			}
			.monaco-scrollable-element > .invisible {
				opacity: 0;
				pointer-events: none;
			}
			.monaco-scrollable-element > .invisible.fade {
				transition: opacity 800ms linear;
			}

			/* Scrollable Content Inset Shadow */
			.monaco-scrollable-element > .shadow {
				position: absolute;
				display: none;
			}
			.monaco-scrollable-element > .shadow.top {
				display: block;
				top: 0;
				left: 3px;
				height: 3px;
				width: 100%;
			}
			.monaco-scrollable-element > .shadow.left {
				display: block;
				top: 3px;
				left: 0;
				height: 100%;
				width: 3px;
			}
			.monaco-scrollable-element > .shadow.top-left-corner {
				display: block;
				top: 0;
				left: 0;
				height: 3px;
				width: 3px;
			}
			/* Fix for https://github.com/microsoft/vscode/issues/103170 */
			.monaco-menu .action-item .monaco-submenu {
				z-index: 1;
			}
		`;const s=a.scrollbarShadow;s&&(t+=`
				.monaco-scrollable-element > .shadow.top {
					box-shadow: ${s} 0 6px 6px -6px inset;
				}

				.monaco-scrollable-element > .shadow.left {
					box-shadow: ${s} 6px 0 6px -6px inset;
				}

				.monaco-scrollable-element > .shadow.top.left {
					box-shadow: ${s} 6px 6px 6px -6px inset;
				}
			`);const o=a.scrollbarSliderBackground;o&&(t+=`
				.monaco-scrollable-element > .scrollbar > .slider {
					background: ${o};
				}
			`);const r=a.scrollbarSliderHoverBackground;r&&(t+=`
				.monaco-scrollable-element > .scrollbar > .slider:hover {
					background: ${r};
				}
			`);const l=a.scrollbarSliderActiveBackground;l&&(t+=`
				.monaco-scrollable-element > .scrollbar > .slider.active {
					background: ${l};
				}
			`)}return t}class ContextMenuHandler{constructor(e,t,s,o){this.contextViewService=e,this.telemetryService=t,this.notificationService=s,this.keybindingService=o,this.focusToReturn=null,this.lastContainer=null,this.block=null,this.blockDisposable=null,this.options={blockMouse:!0}}configure(e){this.options=e}showContextMenu(e){const t=e.getActions();if(!t.length)return;this.focusToReturn=getActiveElement();let s;const o=isHTMLElement(e.domForShadowRoot)?e.domForShadowRoot:void 0;this.contextViewService.showContextView({getAnchor:()=>e.getAnchor(),canRelayout:!1,anchorAlignment:e.anchorAlignment,anchorAxisAlignment:e.anchorAxisAlignment,layer:e.layer,render:r=>{var g;this.lastContainer=r;const l=e.getMenuClassName?e.getMenuClassName():"";l&&(r.className+=" "+l),this.options.blockMouse&&(this.block=r.appendChild($$l(".context-view-block")),this.block.style.position="fixed",this.block.style.cursor="initial",this.block.style.left="0",this.block.style.top="0",this.block.style.width="100%",this.block.style.height="100%",this.block.style.zIndex="-1",(g=this.blockDisposable)==null||g.dispose(),this.blockDisposable=addDisposableListener(this.block,EventType$1.MOUSE_DOWN,f=>f.stopPropagation()));const c=new DisposableStore,d=e.actionRunner||c.add(new ActionRunner);d.onWillRun(f=>this.onActionRun(f,!e.skipTelemetry),this,c),d.onDidRun(this.onDidActionRun,this,c),s=new Menu(r,t,{actionViewItemProvider:e.getActionViewItem,context:e.getActionsContext?e.getActionsContext():null,actionRunner:d,getKeyBinding:e.getKeyBinding?e.getKeyBinding:f=>this.keybindingService.lookupKeybinding(f.id)},defaultMenuStyles),s.onDidCancel(()=>this.contextViewService.hideContextView(!0),null,c),s.onDidBlur(()=>this.contextViewService.hideContextView(!0),null,c);const u=getWindow(r);return c.add(addDisposableListener(u,EventType$1.BLUR,()=>this.contextViewService.hideContextView(!0))),c.add(addDisposableListener(u,EventType$1.MOUSE_DOWN,f=>{if(f.defaultPrevented)return;const p=new StandardMouseEvent(u,f);let m=p.target;if(!p.rightButton){for(;m;){if(m===r)return;m=m.parentElement}this.contextViewService.hideContextView(!0)}})),combinedDisposable(c,s)},focus:()=>{s==null||s.focus(!!e.autoSelectFirstItem)},onHide:r=>{var l,c,d;(l=e.onHide)==null||l.call(e,!!r),this.block&&(this.block.remove(),this.block=null),(c=this.blockDisposable)==null||c.dispose(),this.blockDisposable=null,this.lastContainer&&(getActiveElement()===this.lastContainer||isAncestor$1(getActiveElement(),this.lastContainer))&&((d=this.focusToReturn)==null||d.focus()),this.lastContainer=null}},o,!!o)}onActionRun(e,t){t&&this.telemetryService.publicLog2("workbenchActionExecuted",{id:e.action.id,from:"contextMenu"}),this.contextViewService.hideContextView(!1)}onDidActionRun(e){e.error&&!isCancellationError(e.error)&&this.notificationService.error(e.error)}}var __decorate$k=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$j=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let ContextMenuService=class extends Disposable{get contextMenuHandler(){return this._contextMenuHandler||(this._contextMenuHandler=new ContextMenuHandler(this.contextViewService,this.telemetryService,this.notificationService,this.keybindingService)),this._contextMenuHandler}constructor(e,t,s,o,r,l){super(),this.telemetryService=e,this.notificationService=t,this.contextViewService=s,this.keybindingService=o,this.menuService=r,this.contextKeyService=l,this._contextMenuHandler=void 0,this._onDidShowContextMenu=this._store.add(new Emitter$1),this.onDidShowContextMenu=this._onDidShowContextMenu.event,this._onDidHideContextMenu=this._store.add(new Emitter$1),this.onDidHideContextMenu=this._onDidHideContextMenu.event}configure(e){this.contextMenuHandler.configure(e)}showContextMenu(e){e=ContextMenuMenuDelegate.transform(e,this.menuService,this.contextKeyService),this.contextMenuHandler.showContextMenu({...e,onHide:t=>{var s;(s=e.onHide)==null||s.call(e,t),this._onDidHideContextMenu.fire()}}),ModifierKeyEmitter.getInstance().resetKeyStatus(),this._onDidShowContextMenu.fire()}};ContextMenuService=__decorate$k([__param$j(0,ITelemetryService),__param$j(1,INotificationService),__param$j(2,IContextViewService),__param$j(3,IKeybindingService),__param$j(4,IMenuService),__param$j(5,IContextKeyService)],ContextMenuService);var ContextMenuMenuDelegate;(function(a){function e(s){return s&&s.menuId instanceof MenuId}function t(s,o,r){if(!e(s))return s;const{menuId:l,menuActionOptions:c,contextKeyService:d}=s;return{...s,getActions:()=>{let u=[];if(l){const g=o.getMenuActions(l,d??r,c);u=getFlatContextMenuActions(g)}return s.getActions?Separator.join(s.getActions(),u):u}}}a.transform=t})(ContextMenuMenuDelegate||(ContextMenuMenuDelegate={}));var EditorOpenSource;(function(a){a[a.API=0]="API",a[a.USER=1]="USER"})(EditorOpenSource||(EditorOpenSource={}));var __decorate$j=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$i=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let CommandOpener=class{constructor(e){this._commandService=e}async open(e,t){if(!matchesScheme(e,Schemas.command))return!1;if(!(t!=null&&t.allowCommands)||(typeof e=="string"&&(e=URI.parse(e)),Array.isArray(t.allowCommands)&&!t.allowCommands.includes(e.path)))return!0;let s=[];try{s=parse$1(decodeURIComponent(e.query))}catch{try{s=parse$1(e.query)}catch{}}return Array.isArray(s)||(s=[s]),await this._commandService.executeCommand(e.path,...s),!0}};CommandOpener=__decorate$j([__param$i(0,ICommandService)],CommandOpener);let EditorOpener=class{constructor(e){this._editorService=e}async open(e,t){typeof e=="string"&&(e=URI.parse(e));const{selection:s,uri:o}=extractSelection(e);return e=o,e.scheme===Schemas.file&&(e=normalizePath(e)),await this._editorService.openCodeEditor({resource:e,options:{selection:s,source:t!=null&&t.fromUserGesture?EditorOpenSource.USER:EditorOpenSource.API,...t==null?void 0:t.editorOptions}},this._editorService.getFocusedCodeEditor(),t==null?void 0:t.openToSide),!0}};EditorOpener=__decorate$j([__param$i(0,ICodeEditorService)],EditorOpener);let OpenerService=class{constructor(e,t){this._openers=new LinkedList,this._validators=new LinkedList,this._resolvers=new LinkedList,this._resolvedUriTargets=new ResourceMap(s=>s.with({path:null,fragment:null,query:null}).toString()),this._externalOpeners=new LinkedList,this._defaultExternalOpener={openExternal:async s=>(matchesSomeScheme(s,Schemas.http,Schemas.https)?windowOpenNoOpener(s):mainWindow.location.href=s,!0)},this._openers.push({open:async(s,o)=>o!=null&&o.openExternal||matchesSomeScheme(s,Schemas.mailto,Schemas.http,Schemas.https,Schemas.vsls)?(await this._doOpenExternal(s,o),!0):!1}),this._openers.push(new CommandOpener(t)),this._openers.push(new EditorOpener(e))}registerOpener(e){return{dispose:this._openers.unshift(e)}}async open(e,t){if(!(t!=null&&t.skipValidation)){const s=typeof e=="string"?URI.parse(e):e,o=this._resolvedUriTargets.get(s)??e;for(const r of this._validators)if(!await r.shouldOpen(o,t))return!1}for(const s of this._openers)if(await s.open(e,t))return!0;return!1}async resolveExternalUri(e,t){for(const s of this._resolvers)try{const o=await s.resolveExternalUri(e,t);if(o)return this._resolvedUriTargets.has(o.resolved)||this._resolvedUriTargets.set(o.resolved,e),o}catch{}throw new Error("Could not resolve external URI: "+e.toString())}async _doOpenExternal(e,t){const s=typeof e=="string"?URI.parse(e):e;let o;try{o=(await this.resolveExternalUri(s,t)).resolved}catch{o=s}let r;if(typeof e=="string"&&s.toString()===o.toString()?r=e:r=encodeURI(o.toString(!0)),t!=null&&t.allowContributedOpeners){const l=typeof(t==null?void 0:t.allowContributedOpeners)=="string"?t==null?void 0:t.allowContributedOpeners:void 0;for(const c of this._externalOpeners)if(await c.openExternal(r,{sourceUri:s,preferredOpenerId:l},CancellationToken.None))return!0}return this._defaultExternalOpener.openExternal(r,{sourceUri:s},CancellationToken.None)}dispose(){this._validators.clear()}};OpenerService=__decorate$j([__param$i(0,ICodeEditorService),__param$i(1,ICommandService)],OpenerService);var __decorate$i=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$h=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let MarkerDecorationsService=class extends Disposable{constructor(e,t){super(),this._markerService=t,this._onDidChangeMarker=this._register(new Emitter$1),this._suppressedRanges=new ResourceMap,this._markerDecorations=new ResourceMap,e.getModels().forEach(s=>this._onModelAdded(s)),this._register(e.onModelAdded(this._onModelAdded,this)),this._register(e.onModelRemoved(this._onModelRemoved,this)),this._register(this._markerService.onMarkerChanged(this._handleMarkerChange,this))}dispose(){super.dispose(),this._markerDecorations.forEach(e=>e.dispose()),this._markerDecorations.clear()}getMarker(e,t){const s=this._markerDecorations.get(e);return s&&s.getMarker(t)||null}_handleMarkerChange(e){e.forEach(t=>{const s=this._markerDecorations.get(t);s&&this._updateDecorations(s)})}_onModelAdded(e){const t=new MarkerDecorations(e);this._markerDecorations.set(e.uri,t),this._updateDecorations(t)}_onModelRemoved(e){var s;const t=this._markerDecorations.get(e.uri);t&&(t.dispose(),this._markerDecorations.delete(e.uri)),(e.uri.scheme===Schemas.inMemory||e.uri.scheme===Schemas.internal||e.uri.scheme===Schemas.vscode)&&((s=this._markerService)==null||s.read({resource:e.uri}).map(o=>o.owner).forEach(o=>this._markerService.remove(o,[e.uri])))}_updateDecorations(e){let t=this._markerService.read({resource:e.model.uri,take:500});const s=this._suppressedRanges.get(e.model.uri);s&&(t=t.filter(o=>!Iterable.some(s,r=>Range$2.areIntersectingOrTouching(r,o)))),e.update(t)&&this._onDidChangeMarker.fire(e.model)}};MarkerDecorationsService=__decorate$i([__param$h(0,IModelService),__param$h(1,IMarkerService)],MarkerDecorationsService);class MarkerDecorations extends Disposable{constructor(e){super(),this.model=e,this._map=new BidirectionalMap,this._register(toDisposable(()=>{this.model.deltaDecorations([...this._map.values()],[]),this._map.clear()}))}update(e){const{added:t,removed:s}=diffSets(new Set(this._map.keys()),new Set(e));if(t.length===0&&s.length===0)return!1;const o=s.map(c=>this._map.get(c)),r=t.map(c=>({range:this._createDecorationRange(this.model,c),options:this._createDecorationOption(c)})),l=this.model.deltaDecorations(o,r);for(const c of s)this._map.delete(c);for(let c=0;c<l.length;c++)this._map.set(t[c],l[c]);return!0}getMarker(e){return this._map.getKey(e.id)}_createDecorationRange(e,t){let s=Range$2.lift(t);if(t.severity===MarkerSeverity$2.Hint&&!this._hasMarkerTag(t,1)&&!this._hasMarkerTag(t,2)&&(s=s.setEndPosition(s.startLineNumber,s.startColumn+2)),s=e.validateRange(s),s.isEmpty()){const o=e.getLineLastNonWhitespaceColumn(s.startLineNumber)||e.getLineMaxColumn(s.startLineNumber);if(o===1||s.endColumn>=o)return s;const r=e.getWordAtPosition(s.getStartPosition());r&&(s=new Range$2(s.startLineNumber,r.startColumn,s.endLineNumber,r.endColumn))}else if(t.endColumn===Number.MAX_VALUE&&t.startColumn===1&&s.startLineNumber===s.endLineNumber){const o=e.getLineFirstNonWhitespaceColumn(t.startLineNumber);o<s.endColumn&&(s=new Range$2(s.startLineNumber,o,s.endLineNumber,s.endColumn),t.startColumn=o)}return s}_createDecorationOption(e){let t,s,o,r,l;switch(e.severity){case MarkerSeverity$2.Hint:this._hasMarkerTag(e,2)?t=void 0:this._hasMarkerTag(e,1)?t="squiggly-unnecessary":t="squiggly-hint",o=0;break;case MarkerSeverity$2.Info:t="squiggly-info",s=themeColorFromId(overviewRulerInfo),o=10,l={color:themeColorFromId(minimapInfo),position:1};break;case MarkerSeverity$2.Warning:t="squiggly-warning",s=themeColorFromId(overviewRulerWarning),o=20,l={color:themeColorFromId(minimapWarning),position:1};break;case MarkerSeverity$2.Error:default:t="squiggly-error",s=themeColorFromId(overviewRulerError),o=30,l={color:themeColorFromId(minimapError),position:1};break}return e.tags&&(e.tags.indexOf(1)!==-1&&(r="squiggly-inline-unnecessary"),e.tags.indexOf(2)!==-1&&(r="squiggly-inline-deprecated")),{description:"marker-decoration",stickiness:1,className:t,showIfCollapsed:!0,overviewRuler:{color:s,position:OverviewRulerLane$1.Right},minimap:l,zIndex:o,inlineClassName:r}}_hasMarkerTag(e,t){return e.tags?e.tags.indexOf(t)>=0:!1}}var __decorate$h=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$g=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},ModelService_1;function MODEL_ID(a){return a.toString()}class ModelData{constructor(e,t,s){this.model=e,this._modelEventListeners=new DisposableStore,this.model=e,this._modelEventListeners.add(e.onWillDispose(()=>t(e))),this._modelEventListeners.add(e.onDidChangeLanguage(o=>s(e,o)))}dispose(){this._modelEventListeners.dispose()}}const DEFAULT_EOL=isLinux||isMacintosh?1:2;class DisposedModelInfo{constructor(e,t,s,o,r,l,c,d){this.uri=e,this.initialUndoRedoSnapshot=t,this.time=s,this.sharesUndoRedoStack=o,this.heapSize=r,this.sha1=l,this.versionId=c,this.alternativeVersionId=d}}var nn;let ModelService=(nn=class extends Disposable{constructor(e,t,s,o){super(),this._configurationService=e,this._resourcePropertiesService=t,this._undoRedoService=s,this._instantiationService=o,this._onModelAdded=this._register(new Emitter$1),this.onModelAdded=this._onModelAdded.event,this._onModelRemoved=this._register(new Emitter$1),this.onModelRemoved=this._onModelRemoved.event,this._onModelModeChanged=this._register(new Emitter$1),this.onModelLanguageChanged=this._onModelModeChanged.event,this._modelCreationOptionsByLanguageAndResource=Object.create(null),this._models={},this._disposedModels=new Map,this._disposedModelsHeapSize=0,this._register(this._configurationService.onDidChangeConfiguration(r=>this._updateModelOptions(r))),this._updateModelOptions(void 0)}static _readModelOptions(e,t){var p;let s=EDITOR_MODEL_DEFAULTS.tabSize;if(e.editor&&typeof e.editor.tabSize<"u"){const m=parseInt(e.editor.tabSize,10);isNaN(m)||(s=m),s<1&&(s=1)}let o="tabSize";if(e.editor&&typeof e.editor.indentSize<"u"&&e.editor.indentSize!=="tabSize"){const m=parseInt(e.editor.indentSize,10);isNaN(m)||(o=Math.max(m,1))}let r=EDITOR_MODEL_DEFAULTS.insertSpaces;e.editor&&typeof e.editor.insertSpaces<"u"&&(r=e.editor.insertSpaces==="false"?!1:!!e.editor.insertSpaces);let l=DEFAULT_EOL;const c=e.eol;c===`\r
`?l=2:c===`
`&&(l=1);let d=EDITOR_MODEL_DEFAULTS.trimAutoWhitespace;e.editor&&typeof e.editor.trimAutoWhitespace<"u"&&(d=e.editor.trimAutoWhitespace==="false"?!1:!!e.editor.trimAutoWhitespace);let u=EDITOR_MODEL_DEFAULTS.detectIndentation;e.editor&&typeof e.editor.detectIndentation<"u"&&(u=e.editor.detectIndentation==="false"?!1:!!e.editor.detectIndentation);let g=EDITOR_MODEL_DEFAULTS.largeFileOptimizations;e.editor&&typeof e.editor.largeFileOptimizations<"u"&&(g=e.editor.largeFileOptimizations==="false"?!1:!!e.editor.largeFileOptimizations);let f=EDITOR_MODEL_DEFAULTS.bracketPairColorizationOptions;return(p=e.editor)!=null&&p.bracketPairColorization&&typeof e.editor.bracketPairColorization=="object"&&(f={enabled:!!e.editor.bracketPairColorization.enabled,independentColorPoolPerBracketType:!!e.editor.bracketPairColorization.independentColorPoolPerBracketType}),{isForSimpleWidget:t,tabSize:s,indentSize:o,insertSpaces:r,detectIndentation:u,defaultEOL:l,trimAutoWhitespace:d,largeFileOptimizations:g,bracketPairColorizationOptions:f}}_getEOL(e,t){if(e)return this._resourcePropertiesService.getEOL(e,t);const s=this._configurationService.getValue("files.eol",{overrideIdentifier:t});return s&&typeof s=="string"&&s!=="auto"?s:OS===3||OS===2?`
`:`\r
`}_shouldRestoreUndoStack(){const e=this._configurationService.getValue("files.restoreUndoStack");return typeof e=="boolean"?e:!0}getCreationOptions(e,t,s){const o=typeof e=="string"?e:e.languageId;let r=this._modelCreationOptionsByLanguageAndResource[o+t];if(!r){const l=this._configurationService.getValue("editor",{overrideIdentifier:o,resource:t}),c=this._getEOL(t,o);r=ModelService_1._readModelOptions({editor:l,eol:c},s),this._modelCreationOptionsByLanguageAndResource[o+t]=r}return r}_updateModelOptions(e){const t=this._modelCreationOptionsByLanguageAndResource;this._modelCreationOptionsByLanguageAndResource=Object.create(null);const s=Object.keys(this._models);for(let o=0,r=s.length;o<r;o++){const l=s[o],c=this._models[l],d=c.model.getLanguageId(),u=c.model.uri;if(e&&!e.affectsConfiguration("editor",{overrideIdentifier:d,resource:u})&&!e.affectsConfiguration("files.eol",{overrideIdentifier:d,resource:u}))continue;const g=t[d+u],f=this.getCreationOptions(d,u,c.model.isForSimpleWidget);ModelService_1._setModelOptionsForModel(c.model,f,g)}}static _setModelOptionsForModel(e,t,s){s&&s.defaultEOL!==t.defaultEOL&&e.getLineCount()===1&&e.setEOL(t.defaultEOL===1?0:1),!(s&&s.detectIndentation===t.detectIndentation&&s.insertSpaces===t.insertSpaces&&s.tabSize===t.tabSize&&s.indentSize===t.indentSize&&s.trimAutoWhitespace===t.trimAutoWhitespace&&equals(s.bracketPairColorizationOptions,t.bracketPairColorizationOptions))&&(t.detectIndentation?(e.detectIndentation(t.insertSpaces,t.tabSize),e.updateOptions({trimAutoWhitespace:t.trimAutoWhitespace,bracketColorizationOptions:t.bracketPairColorizationOptions})):e.updateOptions({insertSpaces:t.insertSpaces,tabSize:t.tabSize,indentSize:t.indentSize,trimAutoWhitespace:t.trimAutoWhitespace,bracketColorizationOptions:t.bracketPairColorizationOptions}))}_insertDisposedModel(e){this._disposedModels.set(MODEL_ID(e.uri),e),this._disposedModelsHeapSize+=e.heapSize}_removeDisposedModel(e){const t=this._disposedModels.get(MODEL_ID(e));return t&&(this._disposedModelsHeapSize-=t.heapSize),this._disposedModels.delete(MODEL_ID(e)),t}_ensureDisposedModelsHeapSize(e){if(this._disposedModelsHeapSize>e){const t=[];for(this._disposedModels.forEach(s=>{s.sharesUndoRedoStack||t.push(s)}),t.sort((s,o)=>s.time-o.time);t.length>0&&this._disposedModelsHeapSize>e;){const s=t.shift();this._removeDisposedModel(s.uri),s.initialUndoRedoSnapshot!==null&&this._undoRedoService.restoreSnapshot(s.initialUndoRedoSnapshot)}}}_createModelData(e,t,s,o){const r=this.getCreationOptions(t,s,o),l=this._instantiationService.createInstance(TextModel,e,t,r,s);if(s&&this._disposedModels.has(MODEL_ID(s))){const u=this._removeDisposedModel(s),g=this._undoRedoService.getElements(s),f=this._getSHA1Computer(),p=f.canComputeSHA1(l)?f.computeSHA1(l)===u.sha1:!1;if(p||u.sharesUndoRedoStack){for(const m of g.past)isEditStackElement(m)&&m.matchesResource(s)&&m.setModel(l);for(const m of g.future)isEditStackElement(m)&&m.matchesResource(s)&&m.setModel(l);this._undoRedoService.setElementsValidFlag(s,!0,m=>isEditStackElement(m)&&m.matchesResource(s)),p&&(l._overwriteVersionId(u.versionId),l._overwriteAlternativeVersionId(u.alternativeVersionId),l._overwriteInitialUndoRedoSnapshot(u.initialUndoRedoSnapshot))}else u.initialUndoRedoSnapshot!==null&&this._undoRedoService.restoreSnapshot(u.initialUndoRedoSnapshot)}const c=MODEL_ID(l.uri);if(this._models[c])throw new Error("ModelService: Cannot add model because it already exists!");const d=new ModelData(l,u=>this._onWillDispose(u),(u,g)=>this._onDidChangeLanguage(u,g));return this._models[c]=d,d}createModel(e,t,s,o=!1){let r;return t?r=this._createModelData(e,t,s,o):r=this._createModelData(e,PLAINTEXT_LANGUAGE_ID,s,o),this._onModelAdded.fire(r.model),r.model}getModels(){const e=[],t=Object.keys(this._models);for(let s=0,o=t.length;s<o;s++){const r=t[s];e.push(this._models[r].model)}return e}getModel(e){const t=MODEL_ID(e),s=this._models[t];return s?s.model:null}_schemaShouldMaintainUndoRedoElements(e){return e.scheme===Schemas.file||e.scheme===Schemas.vscodeRemote||e.scheme===Schemas.vscodeUserData||e.scheme===Schemas.vscodeNotebookCell||e.scheme==="fake-fs"}_onWillDispose(e){const t=MODEL_ID(e.uri),s=this._models[t],o=this._undoRedoService.getUriComparisonKey(e.uri)!==e.uri.toString();let r=!1,l=0;if(o||this._shouldRestoreUndoStack()&&this._schemaShouldMaintainUndoRedoElements(e.uri)){const u=this._undoRedoService.getElements(e.uri);if(u.past.length>0||u.future.length>0){for(const g of u.past)isEditStackElement(g)&&g.matchesResource(e.uri)&&(r=!0,l+=g.heapSize(e.uri),g.setModel(e.uri));for(const g of u.future)isEditStackElement(g)&&g.matchesResource(e.uri)&&(r=!0,l+=g.heapSize(e.uri),g.setModel(e.uri))}}const c=ModelService_1.MAX_MEMORY_FOR_CLOSED_FILES_UNDO_STACK,d=this._getSHA1Computer();if(r)if(!o&&(l>c||!d.canComputeSHA1(e))){const u=s.model.getInitialUndoRedoSnapshot();u!==null&&this._undoRedoService.restoreSnapshot(u)}else this._ensureDisposedModelsHeapSize(c-l),this._undoRedoService.setElementsValidFlag(e.uri,!1,u=>isEditStackElement(u)&&u.matchesResource(e.uri)),this._insertDisposedModel(new DisposedModelInfo(e.uri,s.model.getInitialUndoRedoSnapshot(),Date.now(),o,l,d.computeSHA1(e),e.getVersionId(),e.getAlternativeVersionId()));else if(!o){const u=s.model.getInitialUndoRedoSnapshot();u!==null&&this._undoRedoService.restoreSnapshot(u)}delete this._models[t],s.dispose(),delete this._modelCreationOptionsByLanguageAndResource[e.getLanguageId()+e.uri],this._onModelRemoved.fire(e)}_onDidChangeLanguage(e,t){const s=t.oldLanguage,o=e.getLanguageId(),r=this.getCreationOptions(s,e.uri,e.isForSimpleWidget),l=this.getCreationOptions(o,e.uri,e.isForSimpleWidget);ModelService_1._setModelOptionsForModel(e,l,r),this._onModelModeChanged.fire({model:e,oldLanguageId:s})}_getSHA1Computer(){return new DefaultModelSHA1Computer}},ModelService_1=nn,nn.MAX_MEMORY_FOR_CLOSED_FILES_UNDO_STACK=20*1024*1024,nn);ModelService=ModelService_1=__decorate$h([__param$g(0,IConfigurationService),__param$g(1,ITextResourcePropertiesService),__param$g(2,IUndoRedoService),__param$g(3,IInstantiationService)],ModelService);const wo=class wo{canComputeSHA1(e){return e.getValueLength()<=wo.MAX_MODEL_SIZE}computeSHA1(e){const t=new StringSHA1,s=e.createSnapshot();let o;for(;o=s.read();)t.update(o);return t.digest()}};wo.MAX_MODEL_SIZE=10*1024*1024;let DefaultModelSHA1Computer=wo;const standaloneQuickInput="";var DefaultQuickAccessFilterValue;(function(a){a[a.PRESERVE=0]="PRESERVE",a[a.LAST=1]="LAST"})(DefaultQuickAccessFilterValue||(DefaultQuickAccessFilterValue={}));const Extensions={Quickaccess:"workbench.contributions.quickaccess"};class QuickAccessRegistry{constructor(){this.providers=[],this.defaultProvider=void 0}registerQuickAccessProvider(e){return e.prefix.length===0?this.defaultProvider=e:this.providers.push(e),this.providers.sort((t,s)=>s.prefix.length-t.prefix.length),toDisposable(()=>{this.providers.splice(this.providers.indexOf(e),1),this.defaultProvider===e&&(this.defaultProvider=void 0)})}getQuickAccessProviders(){return coalesce([this.defaultProvider,...this.providers])}getQuickAccessProvider(e){return e&&this.providers.find(s=>e.startsWith(s.prefix))||void 0||this.defaultProvider}}Registry.add(Extensions.Quickaccess,new QuickAccessRegistry);var __decorate$g=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$f=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let QuickAccessController=class extends Disposable{constructor(e,t){super(),this.quickInputService=e,this.instantiationService=t,this.registry=Registry.as(Extensions.Quickaccess),this.mapProviderToDescriptor=new Map,this.lastAcceptedPickerValues=new Map,this.visibleQuickAccess=void 0,this._register(toDisposable(()=>{var s;for(const o of this.mapProviderToDescriptor.values())isDisposable(o)&&o.dispose();(s=this.visibleQuickAccess)==null||s.picker.dispose()}))}show(e="",t){this.doShowOrPick(e,!1,t)}doShowOrPick(e,t,s){var _,C;const[o,r]=this.getOrInstantiateProvider(e,s==null?void 0:s.enabledProviderPrefixes),l=this.visibleQuickAccess,c=l==null?void 0:l.descriptor;if(l&&r&&c===r){e!==r.prefix&&!(s!=null&&s.preserveValue)&&(l.picker.value=e),this.adjustValueSelection(l.picker,r,s);return}if(r&&!(s!=null&&s.preserveValue)){let b;if(l&&c&&c!==r){const v=l.value.substr(c.prefix.length);v&&(b=`${r.prefix}${v}`)}if(!b){const v=o==null?void 0:o.defaultFilterValue;v===DefaultQuickAccessFilterValue.LAST?b=this.lastAcceptedPickerValues.get(r):typeof v=="string"&&(b=`${r.prefix}${v}`)}typeof b=="string"&&(e=b)}const d=(_=l==null?void 0:l.picker)==null?void 0:_.valueSelection,u=(C=l==null?void 0:l.picker)==null?void 0:C.value,g=new DisposableStore,f=g.add(this.quickInputService.createQuickPick({useSeparators:!0}));f.value=e,this.adjustValueSelection(f,r,s),f.placeholder=(s==null?void 0:s.placeholder)??(r==null?void 0:r.placeholder),f.quickNavigate=s==null?void 0:s.quickNavigateConfiguration,f.hideInput=!!f.quickNavigate&&!l,(typeof(s==null?void 0:s.itemActivation)=="number"||s!=null&&s.quickNavigateConfiguration)&&(f.itemActivation=(s==null?void 0:s.itemActivation)??ItemActivation.SECOND),f.contextKey=r==null?void 0:r.contextKey,f.filterValue=b=>b.substring(r?r.prefix.length:0);let p;t&&(p=new DeferredPromise,g.add(Event$1.once(f.onWillAccept)(b=>{b.veto(),f.hide()}))),g.add(this.registerPickerListeners(f,o,r,e,s));const m=g.add(new CancellationTokenSource$1);if(o&&g.add(o.provide(f,m.token,s==null?void 0:s.providerOptions)),Event$1.once(f.onDidHide)(()=>{f.selectedItems.length===0&&m.cancel(),g.dispose(),p==null||p.complete(f.selectedItems.slice(0))}),f.show(),d&&u===e&&(f.valueSelection=d),t)return p==null?void 0:p.p}adjustValueSelection(e,t,s){let o;s!=null&&s.preserveValue?o=[e.value.length,e.value.length]:o=[(t==null?void 0:t.prefix.length)??0,e.value.length],e.valueSelection=o}registerPickerListeners(e,t,s,o,r){const l=new DisposableStore,c=this.visibleQuickAccess={picker:e,descriptor:s,value:o};return l.add(toDisposable(()=>{c===this.visibleQuickAccess&&(this.visibleQuickAccess=void 0)})),l.add(e.onDidChangeValue(d=>{const[u]=this.getOrInstantiateProvider(d,r==null?void 0:r.enabledProviderPrefixes);u!==t?this.show(d,{enabledProviderPrefixes:r==null?void 0:r.enabledProviderPrefixes,preserveValue:!0,providerOptions:r==null?void 0:r.providerOptions}):c.value=d})),s&&l.add(e.onDidAccept(()=>{this.lastAcceptedPickerValues.set(s,e.value)})),l}getOrInstantiateProvider(e,t){const s=this.registry.getQuickAccessProvider(e);if(!s||t&&!(t!=null&&t.includes(s.prefix)))return[void 0,void 0];let o=this.mapProviderToDescriptor.get(s);return o||(o=this.instantiationService.createInstance(s.ctor),this.mapProviderToDescriptor.set(s,o)),[o,s]}};QuickAccessController=__decorate$g([__param$f(0,IQuickInputService),__param$f(1,IInstantiationService)],QuickAccessController);const quickInput="";var __decorate$f=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};class LinkedText{constructor(e){this.nodes=e}toString(){return this.nodes.map(e=>typeof e=="string"?e:e.label).join("")}}__decorate$f([memoize],LinkedText.prototype,"toString",null);const LINK_REGEX=/\[([^\]]+)\]\(((?:https?:\/\/|command:|file:)[^\)\s]+)(?: (["'])(.+?)(\3))?\)/gi;function parseLinkedText(a){const e=[];let t=0,s;for(;s=LINK_REGEX.exec(a);){s.index-t>0&&e.push(a.substring(t,s.index));const[,o,r,,l]=s;l?e.push({label:o,href:r,title:l}):e.push({label:o,href:r}),t=s.index+s[0].length}return t<a.length&&e.push(a.substring(t)),new LinkedText(e)}const iconPathToClass={},iconClassGenerator=new IdGenerator("quick-input-button-icon-");function getIconClass(a){if(!a)return;let e;const t=a.dark.toString();return iconPathToClass[t]?e=iconPathToClass[t]:(e=iconClassGenerator.nextId(),createCSSRule(`.${e}, .hc-light .${e}`,`background-image: ${asCSSUrl(a.light||a.dark)}`),createCSSRule(`.vs-dark .${e}, .hc-black .${e}`,`background-image: ${asCSSUrl(a.dark)}`),iconPathToClass[t]=e),e}function quickInputButtonToAction(a,e,t){let s=a.iconClass||getIconClass(a.iconPath);return a.alwaysVisible&&(s=s?`${s} always-visible`:"always-visible"),{id:e,label:"",tooltip:a.tooltip||"",class:s,enabled:!0,run:t}}function renderQuickInputDescription(a,e,t){reset(e);const s=parseLinkedText(a);let o=0;for(const r of s.nodes)if(typeof r=="string")e.append(...renderLabelWithIcons(r));else{let l=r.title;!l&&r.href.startsWith("command:")?l=localize(1754,"Click to execute command '{0}'",r.href.substring(8)):l||(l=r.href);const c=$$l("a",{href:r.href,title:l,tabIndex:o++},r.label);c.style.textDecoration="underline";const d=m=>{isEventLike(m)&&EventHelper.stop(m,!0),t.callback(r.href)},u=t.disposables.add(new DomEmitter(c,EventType$1.CLICK)).event,g=t.disposables.add(new DomEmitter(c,EventType$1.KEY_DOWN)).event,f=Event$1.chain(g,m=>m.filter(_=>{const C=new StandardKeyboardEvent(_);return C.equals(10)||C.equals(3)}));t.disposables.add(Gesture.addTarget(c));const p=t.disposables.add(new DomEmitter(c,EventType.Tap)).event;Event$1.any(u,p,f)(d,null,t.disposables),e.appendChild(c)}}var __decorate$e=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$e=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const inQuickInputContextKeyValue="inQuickInput",InQuickInputContextKey=new RawContextKey(inQuickInputContextKeyValue,!1,localize(1731,"Whether keyboard focus is inside the quick input control")),inQuickInputContext=ContextKeyExpr.has(inQuickInputContextKeyValue),quickInputAlignmentContextKeyValue="quickInputAlignment",QuickInputAlignmentContextKey=new RawContextKey(quickInputAlignmentContextKeyValue,"top",localize(1732,"The alignment of the quick input")),quickInputTypeContextKeyValue="quickInputType",QuickInputTypeContextKey=new RawContextKey(quickInputTypeContextKeyValue,void 0,localize(1733,"The type of the currently visible quick input")),endOfQuickInputBoxContextKeyValue="cursorAtEndOfQuickInputBox",EndOfQuickInputBoxContextKey=new RawContextKey(endOfQuickInputBoxContextKeyValue,!1,localize(1734,"Whether the cursor in the quick input is at the end of the input box")),endOfQuickInputBoxContext=ContextKeyExpr.has(endOfQuickInputBoxContextKeyValue),backButton={iconClass:ThemeIcon.asClassName(Codicon.quickInputBack),tooltip:localize(1735,"Back"),handle:-1},yo=class yo extends Disposable{constructor(e){super(),this.ui=e,this._visible=observableValue("visible",!1),this._widgetUpdated=!1,this._enabled=!0,this._busy=!1,this._ignoreFocusOut=!1,this._leftButtons=[],this._rightButtons=[],this._inlineButtons=[],this.buttonsUpdated=!1,this._toggles=[],this.togglesUpdated=!1,this.noValidationMessage=yo.noPromptMessage,this._severity=Severity$2.Ignore,this.onDidTriggerButtonEmitter=this._register(new Emitter$1),this.onDidHideEmitter=this._register(new Emitter$1),this.onWillHideEmitter=this._register(new Emitter$1),this.onDisposeEmitter=this._register(new Emitter$1),this.visibleDisposables=this._register(new DisposableStore),this.onDidHide=this.onDidHideEmitter.event}get visible(){return this._visible.get()}get title(){return this._title}set title(e){this._title=e,this.update()}get description(){return this._description}set description(e){this._description=e,this.update()}get step(){return this._steps}set step(e){this._steps=e,this.update()}get totalSteps(){return this._totalSteps}set totalSteps(e){this._totalSteps=e,this.update()}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.update()}get contextKey(){return this._contextKey}set contextKey(e){this._contextKey=e,this.update()}get busy(){return this._busy}set busy(e){this._busy=e,this.update()}get ignoreFocusOut(){return this._ignoreFocusOut}set ignoreFocusOut(e){const t=this._ignoreFocusOut!==e&&!isIOS;this._ignoreFocusOut=e&&!isIOS,t&&this.update()}get titleButtons(){return this._leftButtons.length?[...this._leftButtons,this._rightButtons]:this._rightButtons}get buttons(){return[...this._leftButtons,...this._rightButtons,...this._inlineButtons]}set buttons(e){this._leftButtons=e.filter(t=>t===backButton),this._rightButtons=e.filter(t=>t!==backButton&&t.location!==QuickInputButtonLocation.Inline),this._inlineButtons=e.filter(t=>t.location===QuickInputButtonLocation.Inline),this.buttonsUpdated=!0,this.update()}get toggles(){return this._toggles}set toggles(e){this._toggles=e??[],this.togglesUpdated=!0,this.update()}get validationMessage(){return this._validationMessage}set validationMessage(e){this._validationMessage=e,this.update()}get severity(){return this._severity}set severity(e){this._severity=e,this.update()}show(){this.visible||(this.visibleDisposables.add(this.ui.onDidTriggerButton(e=>{this.buttons.indexOf(e)!==-1&&this.onDidTriggerButtonEmitter.fire(e)})),this.ui.show(this),this._visible.set(!0,void 0),this._lastValidationMessage=void 0,this._lastSeverity=void 0,this.buttons.length&&(this.buttonsUpdated=!0),this.toggles.length&&(this.togglesUpdated=!0),this.update())}hide(){this.visible&&this.ui.hide()}didHide(e=QuickInputHideReason.Other){this._visible.set(!1,void 0),this.visibleDisposables.clear(),this.onDidHideEmitter.fire({reason:e})}willHide(e=QuickInputHideReason.Other){this.onWillHideEmitter.fire({reason:e})}update(){var o;if(!this.visible)return;const e=this.getTitle();e&&this.ui.title.textContent!==e?this.ui.title.textContent=e:!e&&this.ui.title.innerHTML!=="&nbsp;"&&(this.ui.title.innerText=" ");const t=this.getDescription();if(this.ui.description1.textContent!==t&&(this.ui.description1.textContent=t),this.ui.description2.textContent!==t&&(this.ui.description2.textContent=t),this._widgetUpdated&&(this._widgetUpdated=!1,this._widget?reset(this.ui.widget,this._widget):reset(this.ui.widget)),this.busy&&!this.busyDelay&&(this.busyDelay=new TimeoutTimer,this.busyDelay.setIfNotSet(()=>{this.visible&&this.ui.progressBar.infinite()},800)),!this.busy&&this.busyDelay&&(this.ui.progressBar.stop(),this.busyDelay.cancel(),this.busyDelay=void 0),this.buttonsUpdated){this.buttonsUpdated=!1,this.ui.leftActionBar.clear();const r=this._leftButtons.map((d,u)=>quickInputButtonToAction(d,`id-${u}`,async()=>this.onDidTriggerButtonEmitter.fire(d)));this.ui.leftActionBar.push(r,{icon:!0,label:!1}),this.ui.rightActionBar.clear();const l=this._rightButtons.map((d,u)=>quickInputButtonToAction(d,`id-${u}`,async()=>this.onDidTriggerButtonEmitter.fire(d)));this.ui.rightActionBar.push(l,{icon:!0,label:!1}),this.ui.inlineActionBar.clear();const c=this._inlineButtons.map((d,u)=>quickInputButtonToAction(d,`id-${u}`,async()=>this.onDidTriggerButtonEmitter.fire(d)));this.ui.inlineActionBar.push(c,{icon:!0,label:!1})}if(this.togglesUpdated){this.togglesUpdated=!1;const r=((o=this.toggles)==null?void 0:o.filter(l=>l instanceof Toggle))??[];this.ui.inputBox.toggles=r}this.ui.ignoreFocusOut=this.ignoreFocusOut,this.ui.setEnabled(this.enabled),this.ui.setContextKey(this.contextKey);const s=this.validationMessage||this.noValidationMessage;this._lastValidationMessage!==s&&(this._lastValidationMessage=s,reset(this.ui.message),renderQuickInputDescription(s,this.ui.message,{callback:r=>{this.ui.linkOpenerDelegate(r)},disposables:this.visibleDisposables})),this._lastSeverity!==this.severity&&(this._lastSeverity=this.severity,this.showMessageDecoration(this.severity))}getTitle(){return this.title&&this.step?`${this.title} (${this.getSteps()})`:this.title?this.title:this.step?this.getSteps():""}getDescription(){return this.description||""}getSteps(){return this.step&&this.totalSteps?localize(1737,"{0}/{1}",this.step,this.totalSteps):this.step?String(this.step):""}showMessageDecoration(e){if(this.ui.inputBox.showDecoration(e),e!==Severity$2.Ignore){const t=this.ui.inputBox.stylesForType(e);this.ui.message.style.color=t.foreground?`${t.foreground}`:"",this.ui.message.style.backgroundColor=t.background?`${t.background}`:"",this.ui.message.style.border=t.border?`1px solid ${t.border}`:"",this.ui.message.style.marginBottom="-2px"}else this.ui.message.style.color="",this.ui.message.style.backgroundColor="",this.ui.message.style.border="",this.ui.message.style.marginBottom=""}dispose(){this.hide(),this.onDisposeEmitter.fire(),super.dispose()}};yo.noPromptMessage=localize(1736,"Press 'Enter' to confirm your input or 'Escape' to cancel");let QuickInput=yo;const Lo=class Lo extends QuickInput{constructor(){super(...arguments),this._value="",this.onDidChangeValueEmitter=this._register(new Emitter$1),this.onWillAcceptEmitter=this._register(new Emitter$1),this.onDidAcceptEmitter=this._register(new Emitter$1),this.onDidCustomEmitter=this._register(new Emitter$1),this._items=[],this.itemsUpdated=!1,this._canSelectMany=!1,this._canAcceptInBackground=!1,this._matchOnDescription=!1,this._matchOnDetail=!1,this._matchOnLabel=!0,this._matchOnLabelMode="fuzzy",this._sortByLabel=!0,this._keepScrollPosition=!1,this._itemActivation=ItemActivation.FIRST,this._activeItems=[],this.activeItemsUpdated=!1,this.activeItemsToConfirm=[],this.onDidChangeActiveEmitter=this._register(new Emitter$1),this._selectedItems=[],this.selectedItemsUpdated=!1,this.selectedItemsToConfirm=[],this.onDidChangeSelectionEmitter=this._register(new Emitter$1),this.onDidTriggerItemButtonEmitter=this._register(new Emitter$1),this.onDidTriggerSeparatorButtonEmitter=this._register(new Emitter$1),this.valueSelectionUpdated=!0,this._ok="default",this._customButton=!1,this._focusEventBufferer=new EventBufferer,this.type="quickPick",this.filterValue=e=>e,this.onDidChangeValue=this.onDidChangeValueEmitter.event,this.onWillAccept=this.onWillAcceptEmitter.event,this.onDidAccept=this.onDidAcceptEmitter.event,this.onDidChangeActive=this.onDidChangeActiveEmitter.event,this.onDidChangeSelection=this.onDidChangeSelectionEmitter.event,this.onDidTriggerItemButton=this.onDidTriggerItemButtonEmitter.event,this.onDidTriggerSeparatorButton=this.onDidTriggerSeparatorButtonEmitter.event}get quickNavigate(){return this._quickNavigate}set quickNavigate(e){this._quickNavigate=e,this.update()}get value(){return this._value}set value(e){this.doSetValue(e)}doSetValue(e,t){this._value!==e&&(this._value=e,t||this.update(),this.visible&&this.ui.list.filter(this.filterValue(this._value))&&this.trySelectFirst(),this.onDidChangeValueEmitter.fire(this._value))}set ariaLabel(e){this._ariaLabel=e,this.update()}get ariaLabel(){return this._ariaLabel}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.update()}get items(){return this._items}get scrollTop(){return this.ui.list.scrollTop}set scrollTop(e){this.ui.list.scrollTop=e}set items(e){this._items=e,this.itemsUpdated=!0,this.update()}get canSelectMany(){return this._canSelectMany}set canSelectMany(e){this._canSelectMany=e,this.update()}get canAcceptInBackground(){return this._canAcceptInBackground}set canAcceptInBackground(e){this._canAcceptInBackground=e}get matchOnDescription(){return this._matchOnDescription}set matchOnDescription(e){this._matchOnDescription=e,this.update()}get matchOnDetail(){return this._matchOnDetail}set matchOnDetail(e){this._matchOnDetail=e,this.update()}get matchOnLabel(){return this._matchOnLabel}set matchOnLabel(e){this._matchOnLabel=e,this.update()}get matchOnLabelMode(){return this._matchOnLabelMode}set matchOnLabelMode(e){this._matchOnLabelMode=e,this.update()}get sortByLabel(){return this._sortByLabel}set sortByLabel(e){this._sortByLabel=e,this.update()}get keepScrollPosition(){return this._keepScrollPosition}set keepScrollPosition(e){this._keepScrollPosition=e}get itemActivation(){return this._itemActivation}set itemActivation(e){this._itemActivation=e}get activeItems(){return this._activeItems}set activeItems(e){this._activeItems=e,this.activeItemsUpdated=!0,this.update()}get selectedItems(){return this._selectedItems}set selectedItems(e){this._selectedItems=e,this.selectedItemsUpdated=!0,this.update()}get keyMods(){return this._quickNavigate?NO_KEY_MODS:this.ui.keyMods}get valueSelection(){const e=this.ui.inputBox.getSelection();if(e)return[e.start,e.end]}set valueSelection(e){this._valueSelection=e,this.valueSelectionUpdated=!0,this.update()}get customButton(){return this._customButton}set customButton(e){this._customButton=e,this.update()}get customLabel(){return this._customButtonLabel}set customLabel(e){this._customButtonLabel=e,this.update()}get customHover(){return this._customButtonHover}set customHover(e){this._customButtonHover=e,this.update()}get ok(){return this._ok}set ok(e){this._ok=e,this.update()}get okLabel(){return this._okLabel??localize(1739,"OK")}set okLabel(e){this._okLabel=e,this.update()}get hideInput(){return!!this._hideInput}set hideInput(e){this._hideInput=e,this.update()}trySelectFirst(){this.canSelectMany||this.ui.list.focus(QuickPickFocus.First)}show(){this.visible||(this.visibleDisposables.add(this.ui.inputBox.onDidChange(e=>{this.doSetValue(e,!0)})),this.visibleDisposables.add(this.ui.onDidAccept(()=>{this.canSelectMany?this.ui.list.getCheckedElements().length||(this._selectedItems=[],this.onDidChangeSelectionEmitter.fire(this.selectedItems)):this.activeItems[0]&&(this._selectedItems=[this.activeItems[0]],this.onDidChangeSelectionEmitter.fire(this.selectedItems)),this.handleAccept(!1)})),this.visibleDisposables.add(this.ui.onDidCustom(()=>{this.onDidCustomEmitter.fire()})),this.visibleDisposables.add(this._focusEventBufferer.wrapEvent(this.ui.list.onDidChangeFocus,(e,t)=>t)(e=>{this.activeItemsUpdated||this.activeItemsToConfirm!==this._activeItems&&equals$1(e,this._activeItems,(t,s)=>t===s)||(this._activeItems=e,this.onDidChangeActiveEmitter.fire(e))})),this.visibleDisposables.add(this.ui.list.onDidChangeSelection(({items:e,event:t})=>{if(this.canSelectMany&&!e.some(s=>s.pickable===!1)){e.length&&this.ui.list.setSelectedElements([]);return}this.selectedItemsToConfirm!==this._selectedItems&&equals$1(e,this._selectedItems,(s,o)=>s===o)||(this._selectedItems=e,this.onDidChangeSelectionEmitter.fire(e),e.length&&this.handleAccept(isMouseEvent(t)&&t.button===1))})),this.visibleDisposables.add(this.ui.list.onChangedCheckedElements(e=>{!this.canSelectMany||!this.visible||this.selectedItemsToConfirm!==this._selectedItems&&equals$1(e,this._selectedItems,(t,s)=>t===s)||(this._selectedItems=e,this.onDidChangeSelectionEmitter.fire(e))})),this.visibleDisposables.add(this.ui.list.onButtonTriggered(e=>this.onDidTriggerItemButtonEmitter.fire(e))),this.visibleDisposables.add(this.ui.list.onSeparatorButtonTriggered(e=>this.onDidTriggerSeparatorButtonEmitter.fire(e))),this.visibleDisposables.add(this.registerQuickNavigation()),this.valueSelectionUpdated=!0),super.show()}handleAccept(e){let t=!1;this.onWillAcceptEmitter.fire({veto:()=>t=!0}),t||this.onDidAcceptEmitter.fire({inBackground:e})}registerQuickNavigation(){return addDisposableListener(this.ui.container,EventType$1.KEY_UP,e=>{if(this.canSelectMany||!this._quickNavigate)return;const t=new StandardKeyboardEvent(e),s=t.keyCode;this._quickNavigate.keybindings.some(l=>{const c=l.getChords();return c.length>1?!1:c[0].shiftKey&&s===4?!(t.ctrlKey||t.altKey||t.metaKey):!!(c[0].altKey&&s===6||c[0].ctrlKey&&s===5||c[0].metaKey&&s===57)})&&(this.activeItems[0]&&(this._selectedItems=[this.activeItems[0]],this.onDidChangeSelectionEmitter.fire(this.selectedItems),this.handleAccept(!1)),this._quickNavigate=void 0)})}update(){if(!this.visible)return;const e=this.keepScrollPosition?this.scrollTop:0,t=!!this.description,s={title:!!this.title||!!this.step||!!this.titleButtons.length,description:t,checkAll:this.canSelectMany&&!this._hideCheckAll,checkBox:this.canSelectMany,inputBox:!this._hideInput,progressBar:!this._hideInput||t,visibleCount:!0,count:this.canSelectMany&&!this._hideCountBadge,ok:this.ok==="default"?this.canSelectMany:this.ok,list:!0,message:!!this.validationMessage,customButton:this.customButton};this.ui.setVisibilities(s),super.update(),this.ui.inputBox.value!==this.value&&(this.ui.inputBox.value=this.value),this.valueSelectionUpdated&&(this.valueSelectionUpdated=!1,this.ui.inputBox.select(this._valueSelection&&{start:this._valueSelection[0],end:this._valueSelection[1]})),this.ui.inputBox.placeholder!==(this.placeholder||"")&&(this.ui.inputBox.placeholder=this.placeholder||"");let o=this.ariaLabel;!o&&s.inputBox&&(o=this.placeholder,this.title&&(o=o?`${o} - ${this.title}`:this.title),o||(o=Lo.DEFAULT_ARIA_LABEL)),this.ui.list.ariaLabel!==o&&(this.ui.list.ariaLabel=o??null),this.ui.inputBox.ariaLabel!==o&&(this.ui.inputBox.ariaLabel=o??"input"),this.ui.list.matchOnDescription=this.matchOnDescription,this.ui.list.matchOnDetail=this.matchOnDetail,this.ui.list.matchOnLabel=this.matchOnLabel,this.ui.list.matchOnLabelMode=this.matchOnLabelMode,this.ui.list.sortByLabel=this.sortByLabel,this.itemsUpdated&&(this.itemsUpdated=!1,this._focusEventBufferer.bufferEvents(()=>{switch(this.ui.list.setElements(this.items),this.ui.list.shouldLoop=!this.canSelectMany,this.ui.list.filter(this.filterValue(this.ui.inputBox.value)),this._itemActivation){case ItemActivation.NONE:this._itemActivation=ItemActivation.FIRST;break;case ItemActivation.SECOND:this.ui.list.focus(QuickPickFocus.Second),this._itemActivation=ItemActivation.FIRST;break;case ItemActivation.LAST:this.ui.list.focus(QuickPickFocus.Last),this._itemActivation=ItemActivation.FIRST;break;default:this.trySelectFirst();break}})),this.ui.container.classList.contains("show-checkboxes")!==!!this.canSelectMany&&(this.canSelectMany?this.ui.list.clearFocus():this.trySelectFirst()),this.activeItemsUpdated&&(this.activeItemsUpdated=!1,this.activeItemsToConfirm=this._activeItems,this.ui.list.setFocusedElements(this.activeItems),this.activeItemsToConfirm===this._activeItems&&(this.activeItemsToConfirm=null)),this.selectedItemsUpdated&&(this.selectedItemsUpdated=!1,this.selectedItemsToConfirm=this._selectedItems,this.canSelectMany?this.ui.list.setCheckedElements(this.selectedItems):this.ui.list.setSelectedElements(this.selectedItems),this.selectedItemsToConfirm===this._selectedItems&&(this.selectedItemsToConfirm=null)),this.ui.ok.label=this.okLabel||"",this.ui.customButton.label=this.customLabel||"",this.ui.customButton.element.title=this.customHover||"",s.inputBox||(this.ui.list.domFocus(),this.canSelectMany&&this.ui.list.focus(QuickPickFocus.First)),this.keepScrollPosition&&(this.scrollTop=e)}focus(e){this.ui.list.focus(e),this.canSelectMany&&this.ui.list.domFocus()}accept(e){e&&!this._canAcceptInBackground||(this.activeItems[0]&&(this._selectedItems=[this.activeItems[0]],this.onDidChangeSelectionEmitter.fire(this.selectedItems)),this.handleAccept(e??!1))}};Lo.DEFAULT_ARIA_LABEL=localize(1738,"Type to narrow down results.");let QuickPick=Lo;class InputBox extends QuickInput{constructor(){super(...arguments),this._value="",this.valueSelectionUpdated=!0,this._password=!1,this.onDidValueChangeEmitter=this._register(new Emitter$1),this.onDidAcceptEmitter=this._register(new Emitter$1),this.type="inputBox",this.onDidChangeValue=this.onDidValueChangeEmitter.event,this.onDidAccept=this.onDidAcceptEmitter.event}get value(){return this._value}set value(e){this._value=e||"",this.update()}get valueSelection(){const e=this.ui.inputBox.getSelection();if(e)return[e.start,e.end]}set valueSelection(e){this._valueSelection=e,this.valueSelectionUpdated=!0,this.update()}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.update()}get ariaLabel(){return this._ariaLabel}set ariaLabel(e){this._ariaLabel=e,this.update()}get password(){return this._password}set password(e){this._password=e,this.update()}get prompt(){return this._prompt}set prompt(e){this._prompt=e,this.noValidationMessage=e?localize(1740,"{0} (Press 'Enter' to confirm or 'Escape' to cancel)",e):QuickInput.noPromptMessage,this.update()}show(){this.visible||(this.visibleDisposables.add(this.ui.inputBox.onDidChange(e=>{e!==this.value&&(this._value=e,this.onDidValueChangeEmitter.fire(e))})),this.visibleDisposables.add(this.ui.onDidAccept(()=>this.onDidAcceptEmitter.fire())),this.valueSelectionUpdated=!0),super.show()}accept(){this.onDidAcceptEmitter.fire()}update(){if(!this.visible)return;this.ui.container.classList.remove("hidden-input");const e={title:!!this.title||!!this.step||!!this.titleButtons.length,description:!!this.description||!!this.step,inputBox:!0,message:!0,progressBar:!0};this.ui.setVisibilities(e),super.update(),this.ui.inputBox.value!==this.value&&(this.ui.inputBox.value=this.value),this.valueSelectionUpdated&&(this.valueSelectionUpdated=!1,this.ui.inputBox.select(this._valueSelection&&{start:this._valueSelection[0],end:this._valueSelection[1]})),this.ui.inputBox.placeholder!==(this.placeholder||"")&&(this.ui.inputBox.placeholder=this.placeholder||""),this.ui.inputBox.password!==this.password&&(this.ui.inputBox.password=this.password);let t=this.ariaLabel;!t&&e.inputBox&&(t=this.placeholder?this.title?`${this.placeholder} - ${this.title}`:this.placeholder:this.title?this.title:"input"),this.ui.inputBox.ariaLabel!==t&&(this.ui.inputBox.ariaLabel=t||"input")}}let QuickInputHoverDelegate=class extends WorkbenchHoverDelegate{constructor(e,t){super("mouse",void 0,s=>this.getOverrideOptions(s),e,t)}getOverrideOptions(e){const t=(isHTMLElement(e.content)?e.content.textContent??"":typeof e.content=="string"?e.content:e.content.value).includes(`
`);return{persistence:{hideOnKeyDown:!1},appearance:{showHoverHint:t,skipFadeInAnimation:!0}}}};QuickInputHoverDelegate=__decorate$e([__param$e(0,IConfigurationService),__param$e(1,IHoverService)],QuickInputHoverDelegate);const progressbar="",CSS_DONE="done",CSS_ACTIVE="active",CSS_INFINITE="infinite",CSS_INFINITE_LONG_RUNNING="infinite-long-running",CSS_DISCRETE="discrete",Eo=class Eo extends Disposable{constructor(e,t){super(),this.progressSignal=this._register(new MutableDisposable),this.workedVal=0,this.showDelayedScheduler=this._register(new RunOnceScheduler(()=>show(this.element),0)),this.longRunningScheduler=this._register(new RunOnceScheduler(()=>this.infiniteLongRunning(),Eo.LONG_RUNNING_INFINITE_THRESHOLD)),this.create(e,t)}create(e,t){this.element=document.createElement("div"),this.element.classList.add("monaco-progress-container"),this.element.setAttribute("role","progressbar"),this.element.setAttribute("aria-valuemin","0"),e.appendChild(this.element),this.bit=document.createElement("div"),this.bit.classList.add("progress-bit"),this.bit.style.backgroundColor=(t==null?void 0:t.progressBarBackground)||"#0E70C0",this.element.appendChild(this.bit)}off(){this.bit.style.width="inherit",this.bit.style.opacity="1",this.element.classList.remove(CSS_ACTIVE,CSS_INFINITE,CSS_INFINITE_LONG_RUNNING,CSS_DISCRETE),this.workedVal=0,this.totalWork=void 0,this.longRunningScheduler.cancel(),this.progressSignal.clear()}stop(){return this.doDone(!1)}doDone(e){return this.element.classList.add(CSS_DONE),this.element.classList.contains(CSS_INFINITE)?(this.bit.style.opacity="0",e?setTimeout(()=>this.off(),200):this.off()):(this.bit.style.width="inherit",e?setTimeout(()=>this.off(),200):this.off()),this}infinite(){return this.bit.style.width="2%",this.bit.style.opacity="1",this.element.classList.remove(CSS_DISCRETE,CSS_DONE,CSS_INFINITE_LONG_RUNNING),this.element.classList.add(CSS_ACTIVE,CSS_INFINITE),this.longRunningScheduler.schedule(),this}infiniteLongRunning(){this.element.classList.add(CSS_INFINITE_LONG_RUNNING)}getContainer(){return this.element}};Eo.LONG_RUNNING_INFINITE_THRESHOLD=1e4;let ProgressBar=Eo;const $$4=$$l;class QuickInputBox extends Disposable{constructor(e,t,s){super(),this.parent=e,this.onDidChange=r=>this.findInput.onDidChange(r),this.container=append$2(this.parent,$$4(".quick-input-box")),this.findInput=this._register(new FindInput(this.container,void 0,{label:"",inputBoxStyles:t,toggleStyles:s}));const o=this.findInput.inputBox.inputElement;o.role="textbox",o.ariaHasPopup="menu",o.ariaAutoComplete="list"}get onKeyDown(){return this.findInput.onKeyDown}get value(){return this.findInput.getValue()}set value(e){this.findInput.setValue(e)}select(e=null){this.findInput.inputBox.select(e)}getSelection(){return this.findInput.inputBox.getSelection()}isSelectionAtEnd(){return this.findInput.inputBox.isSelectionAtEnd()}get placeholder(){return this.findInput.inputBox.inputElement.getAttribute("placeholder")||""}set placeholder(e){this.findInput.inputBox.setPlaceHolder(e)}get password(){return this.findInput.inputBox.inputElement.type==="password"}set password(e){this.findInput.inputBox.inputElement.type=e?"password":"text"}set enabled(e){this.findInput.inputBox.inputElement.toggleAttribute("readonly",!e)}set toggles(e){this.findInput.setAdditionalToggles(e)}get ariaLabel(){return this.findInput.inputBox.inputElement.getAttribute("aria-label")||""}set ariaLabel(e){this.findInput.inputBox.inputElement.setAttribute("aria-label",e)}hasFocus(){return this.findInput.inputBox.hasFocus()}setAttribute(e,t){this.findInput.inputBox.inputElement.setAttribute(e,t)}removeAttribute(e){this.findInput.inputBox.inputElement.removeAttribute(e)}showDecoration(e){e===Severity$2.Ignore?this.findInput.clearMessage():this.findInput.showMessage({type:e===Severity$2.Info?1:e===Severity$2.Warning?2:3,content:""})}stylesForType(e){return this.findInput.inputBox.stylesForType(e===Severity$2.Info?1:e===Severity$2.Warning?2:3)}setFocus(){this.findInput.focus()}layout(){this.findInput.inputBox.layout()}}const intlFileNameCollatorBaseNumeric=new Lazy(()=>{const a=safeIntl.Collator(void 0,{numeric:!0,sensitivity:"base"}).value;return{collator:a,collatorIsNumeric:a.resolvedOptions().numeric}});new Lazy(()=>({collator:safeIntl.Collator(void 0,{numeric:!0}).value}));new Lazy(()=>({collator:safeIntl.Collator(void 0,{numeric:!0,sensitivity:"accent"}).value}));function compareFileNames(a,e,t=!1){const s=a||"",o=e||"",r=intlFileNameCollatorBaseNumeric.value.collator.compare(s,o);return intlFileNameCollatorBaseNumeric.value.collatorIsNumeric&&r===0&&s!==o?s<o?-1:1:r}function compareAnything(a,e,t){const s=a.toLowerCase(),o=e.toLowerCase(),r=compareByPrefix(a,e,t);if(r)return r;const l=s.endsWith(t),c=o.endsWith(t);if(l!==c)return l?-1:1;const d=compareFileNames(s,o);return d!==0?d:s.localeCompare(o)}function compareByPrefix(a,e,t){const s=a.toLowerCase(),o=e.toLowerCase(),r=s.startsWith(t),l=o.startsWith(t);if(r!==l)return r?-1:1;if(r&&l){if(s.length<o.length)return-1;if(s.length>o.length)return 1}return 0}var __decorate$d=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$d=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},QuickPickItemElementRenderer_1;const $$3=$$l;class BaseQuickPickItemElement{constructor(e,t,s){this.index=e,this.hasCheckbox=t,this._hidden=!1,this._init=new Lazy(()=>{const o=s.label??"",r=parseLabelWithIcons(o).text.trim(),l=s.ariaLabel||[o,this.saneDescription,this.saneDetail].map(c=>getCodiconAriaLabel(c)).filter(c=>!!c).join(", ");return{saneLabel:o,saneSortLabel:r,saneAriaLabel:l}}),this._saneDescription=s.description,this._saneTooltip=s.tooltip}get saneLabel(){return this._init.value.saneLabel}get saneSortLabel(){return this._init.value.saneSortLabel}get saneAriaLabel(){return this._init.value.saneAriaLabel}get element(){return this._element}set element(e){this._element=e}get hidden(){return this._hidden}set hidden(e){this._hidden=e}get saneDescription(){return this._saneDescription}set saneDescription(e){this._saneDescription=e}get saneDetail(){return this._saneDetail}set saneDetail(e){this._saneDetail=e}get saneTooltip(){return this._saneTooltip}set saneTooltip(e){this._saneTooltip=e}get labelHighlights(){return this._labelHighlights}set labelHighlights(e){this._labelHighlights=e}get descriptionHighlights(){return this._descriptionHighlights}set descriptionHighlights(e){this._descriptionHighlights=e}get detailHighlights(){return this._detailHighlights}set detailHighlights(e){this._detailHighlights=e}}class QuickPickItemElement extends BaseQuickPickItemElement{constructor(e,t,s,o,r,l,c){var d,u,g;super(e,s,l),this.childIndex=t,this.fireButtonTriggered=o,this._onChecked=r,this.item=l,this._separator=c,this._checked=!1,this.onChecked=s?Event$1.map(Event$1.filter(this._onChecked.event,f=>f.element===this),f=>f.checked):Event$1.None,this._saneDetail=l.detail,this._labelHighlights=(d=l.highlights)==null?void 0:d.label,this._descriptionHighlights=(u=l.highlights)==null?void 0:u.description,this._detailHighlights=(g=l.highlights)==null?void 0:g.detail}get separator(){return this._separator}set separator(e){this._separator=e}get checked(){return this._checked}set checked(e){e!==this._checked&&(this._checked=e,this._onChecked.fire({element:this,checked:e}))}get checkboxDisabled(){return!!this.item.disabled}}var QuickPickSeparatorFocusReason;(function(a){a[a.NONE=0]="NONE",a[a.MOUSE_HOVER=1]="MOUSE_HOVER",a[a.ACTIVE_ITEM=2]="ACTIVE_ITEM"})(QuickPickSeparatorFocusReason||(QuickPickSeparatorFocusReason={}));class QuickPickSeparatorElement extends BaseQuickPickItemElement{constructor(e,t,s){super(e,!1,s),this.fireSeparatorButtonTriggered=t,this.separator=s,this.children=new Array,this.focusInsideSeparator=QuickPickSeparatorFocusReason.NONE}}class QuickInputItemDelegate{getHeight(e){return e instanceof QuickPickSeparatorElement?30:e.saneDetail?44:22}getTemplateId(e){return e instanceof QuickPickItemElement?QuickPickItemElementRenderer.ID:QuickPickSeparatorElementRenderer.ID}}class QuickInputAccessibilityProvider{getWidgetAriaLabel(){return localize(1753,"Quick Input")}getAriaLabel(e){var t;return(t=e.separator)!=null&&t.label?`${e.saneAriaLabel}, ${e.separator.label}`:e.saneAriaLabel}getWidgetRole(){return"listbox"}getRole(e){return e.hasCheckbox?"checkbox":"option"}isChecked(e){if(!(!e.hasCheckbox||!(e instanceof QuickPickItemElement)))return{get value(){return e.checked},onDidChange:t=>e.onChecked(()=>t())}}}class BaseQuickInputListRenderer{constructor(e){this.hoverDelegate=e}renderTemplate(e){const t=Object.create(null);t.toDisposeElement=new DisposableStore,t.toDisposeTemplate=new DisposableStore,t.entry=append$2(e,$$3(".quick-input-list-entry"));const s=append$2(t.entry,$$3("label.quick-input-list-label"));t.outerLabel=s,t.checkbox=t.toDisposeTemplate.add(new MutableDisposable),t.toDisposeTemplate.add(addStandardDisposableListener(s,EventType$1.CLICK,u=>{if(t.checkbox.value&&!u.defaultPrevented&&t.checkbox.value.enabled){const g=!t.checkbox.value.checked;t.checkbox.value.checked=g,t.element.checked=g}}));const o=append$2(s,$$3(".quick-input-list-rows")),r=append$2(o,$$3(".quick-input-list-row")),l=append$2(o,$$3(".quick-input-list-row"));t.label=new IconLabel(r,{supportHighlights:!0,supportDescriptionHighlights:!0,supportIcons:!0,hoverDelegate:this.hoverDelegate}),t.toDisposeTemplate.add(t.label),t.icon=prepend$2(t.label.element,$$3(".quick-input-list-icon"));const c=append$2(r,$$3(".quick-input-list-entry-keybinding"));t.keybinding=new KeybindingLabel(c,OS),t.toDisposeTemplate.add(t.keybinding);const d=append$2(l,$$3(".quick-input-list-label-meta"));return t.detail=new IconLabel(d,{supportHighlights:!0,supportIcons:!0,hoverDelegate:this.hoverDelegate}),t.toDisposeTemplate.add(t.detail),t.separator=append$2(t.entry,$$3(".quick-input-list-separator")),t.actionBar=new ActionBar(t.entry,this.hoverDelegate?{hoverDelegate:this.hoverDelegate}:void 0),t.actionBar.domNode.classList.add("quick-input-list-entry-action-bar"),t.toDisposeTemplate.add(t.actionBar),t}disposeTemplate(e){e.toDisposeElement.dispose(),e.toDisposeTemplate.dispose()}disposeElement(e,t,s){s.toDisposeElement.clear(),s.actionBar.clear()}}var sn;let QuickPickItemElementRenderer=(sn=class extends BaseQuickInputListRenderer{constructor(e,t){super(e),this.themeService=t,this._itemsWithSeparatorsFrequency=new Map}get templateId(){return QuickPickItemElementRenderer_1.ID}ensureCheckbox(e,t){var o;if(!e.hasCheckbox){(o=t.checkbox.value)==null||o.domNode.remove(),t.checkbox.clear();return}let s=t.checkbox.value;s?s.setTitle(e.saneLabel):(s=new Checkbox(e.saneLabel,e.checked,{...defaultCheckboxStyles,size:15}),t.checkbox.value=s,t.outerLabel.prepend(s.domNode)),e.checkboxDisabled?s.disable():s.enable(),s.checked=e.checked,t.toDisposeElement.add(e.onChecked(r=>s.checked=r)),t.toDisposeElement.add(s.onChange(()=>e.checked=s.checked))}renderElement(e,t,s){var p;const o=e.element;s.element=o,o.element=s.entry??void 0;const r=o.item;o.element.classList.toggle("not-pickable",o.item.pickable===!1),this.ensureCheckbox(o,s);const{labelHighlights:l,descriptionHighlights:c,detailHighlights:d}=o;if(r.iconPath){const m=isDark(this.themeService.getColorTheme().type)?r.iconPath.dark:r.iconPath.light??r.iconPath.dark,_=URI.revive(m);s.icon.className="quick-input-list-icon",s.icon.style.backgroundImage=asCSSUrl(_)}else s.icon.style.backgroundImage="",s.icon.className=r.iconClass?`quick-input-list-icon ${r.iconClass}`:"";let u;!o.saneTooltip&&o.saneDescription&&(u={markdown:{value:escape$2(o.saneDescription),supportThemeIcons:!0},markdownNotSupportedFallback:o.saneDescription});const g={matches:l||[],descriptionTitle:u,descriptionMatches:c||[],labelEscapeNewLines:!0};if(g.extraClasses=r.iconClasses,g.italic=r.italic,g.strikethrough=r.strikethrough,s.entry.classList.remove("quick-input-list-separator-as-item"),s.label.setLabel(o.saneLabel,o.saneDescription,g),s.keybinding.set(r.keybinding),o.saneDetail){let m;o.saneTooltip||(m={markdown:{value:escape$2(o.saneDetail),supportThemeIcons:!0},markdownNotSupportedFallback:o.saneDetail}),s.detail.element.style.display="",s.detail.setLabel(o.saneDetail,void 0,{matches:d,title:m,labelEscapeNewLines:!0})}else s.detail.element.style.display="none";(p=o.separator)!=null&&p.label?(s.separator.textContent=o.separator.label,s.separator.style.display="",this.addItemWithSeparator(o)):s.separator.style.display="none",s.entry.classList.toggle("quick-input-list-separator-border",!!o.separator&&o.childIndex!==0);const f=r.buttons;f&&f.length?(s.actionBar.push(f.map((m,_)=>quickInputButtonToAction(m,`id-${_}`,()=>o.fireButtonTriggered({button:m,item:o.item}))),{icon:!0,label:!1}),s.entry.classList.add("has-actions")):s.entry.classList.remove("has-actions")}disposeElement(e,t,s){this.removeItemWithSeparator(e.element),super.disposeElement(e,t,s)}isItemWithSeparatorVisible(e){return this._itemsWithSeparatorsFrequency.has(e)}addItemWithSeparator(e){this._itemsWithSeparatorsFrequency.set(e,(this._itemsWithSeparatorsFrequency.get(e)||0)+1)}removeItemWithSeparator(e){const t=this._itemsWithSeparatorsFrequency.get(e)||0;t>1?this._itemsWithSeparatorsFrequency.set(e,t-1):this._itemsWithSeparatorsFrequency.delete(e)}},QuickPickItemElementRenderer_1=sn,sn.ID="quickpickitem",sn);QuickPickItemElementRenderer=QuickPickItemElementRenderer_1=__decorate$d([__param$d(1,IThemeService)],QuickPickItemElementRenderer);const xo=class xo extends BaseQuickInputListRenderer{constructor(){super(...arguments),this._visibleSeparatorsFrequency=new Map}get templateId(){return xo.ID}get visibleSeparators(){return[...this._visibleSeparatorsFrequency.keys()]}isSeparatorVisible(e){return this._visibleSeparatorsFrequency.has(e)}renderElement(e,t,s){const o=e.element;s.element=o,o.element=s.entry??void 0,o.element.classList.toggle("focus-inside",!!o.focusInsideSeparator);const r=o.separator,{labelHighlights:l,descriptionHighlights:c}=o;s.icon.style.backgroundImage="",s.icon.className="";let d;!o.saneTooltip&&o.saneDescription&&(d={markdown:{value:escape$2(o.saneDescription),supportThemeIcons:!0},markdownNotSupportedFallback:o.saneDescription});const u={matches:l||[],descriptionTitle:d,descriptionMatches:c||[],labelEscapeNewLines:!0};s.entry.classList.add("quick-input-list-separator-as-item"),s.label.setLabel(o.saneLabel,o.saneDescription,u),s.separator.style.display="none",s.entry.classList.add("quick-input-list-separator-border");const g=r.buttons;g&&g.length?(s.actionBar.push(g.map((f,p)=>quickInputButtonToAction(f,`id-${p}`,()=>o.fireSeparatorButtonTriggered({button:f,separator:o.separator}))),{icon:!0,label:!1}),s.entry.classList.add("has-actions")):s.entry.classList.remove("has-actions"),this.addSeparator(o)}disposeElement(e,t,s){var o;this.removeSeparator(e.element),this.isSeparatorVisible(e.element)||(o=e.element.element)==null||o.classList.remove("focus-inside"),super.disposeElement(e,t,s)}addSeparator(e){this._visibleSeparatorsFrequency.set(e,(this._visibleSeparatorsFrequency.get(e)||0)+1)}removeSeparator(e){const t=this._visibleSeparatorsFrequency.get(e)||0;t>1?this._visibleSeparatorsFrequency.set(e,t-1):this._visibleSeparatorsFrequency.delete(e)}};xo.ID="quickpickseparator";let QuickPickSeparatorElementRenderer=xo,QuickInputList=class extends Disposable{constructor(e,t,s,o,r,l){super(),this.parent=e,this.hoverDelegate=t,this.linkOpenerDelegate=s,this.accessibilityService=l,this._onKeyDown=new Emitter$1,this._onLeave=new Emitter$1,this.onLeave=this._onLeave.event,this._visibleCountObservable=observableValue("VisibleCount",0),this.onChangedVisibleCount=Event$1.fromObservable(this._visibleCountObservable,this._store),this._allVisibleCheckedObservable=observableValue("AllVisibleChecked",!1),this.onChangedAllVisibleChecked=Event$1.fromObservable(this._allVisibleCheckedObservable,this._store),this._checkedCountObservable=observableValue("CheckedCount",0),this.onChangedCheckedCount=Event$1.fromObservable(this._checkedCountObservable,this._store),this._checkedElementsObservable=observableValueOpts({equalsFn:equals$1},new Array),this.onChangedCheckedElements=Event$1.fromObservable(this._checkedElementsObservable,this._store),this._onButtonTriggered=new Emitter$1,this.onButtonTriggered=this._onButtonTriggered.event,this._onSeparatorButtonTriggered=new Emitter$1,this.onSeparatorButtonTriggered=this._onSeparatorButtonTriggered.event,this._elementChecked=new Emitter$1,this._elementCheckedEventBufferer=new EventBufferer,this._hasCheckboxes=!1,this._inputElements=new Array,this._elementTree=new Array,this._itemElements=new Array,this._elementDisposable=this._register(new DisposableStore),this._matchOnDescription=!1,this._matchOnDetail=!1,this._matchOnLabel=!0,this._matchOnLabelMode="fuzzy",this._sortByLabel=!0,this._shouldLoop=!0,this._container=append$2(this.parent,$$3(".quick-input-list")),this._separatorRenderer=new QuickPickSeparatorElementRenderer(t),this._itemRenderer=r.createInstance(QuickPickItemElementRenderer,t),this._tree=this._register(r.createInstance(WorkbenchObjectTree,"QuickInput",this._container,new QuickInputItemDelegate,[this._itemRenderer,this._separatorRenderer],{filter:{filter(c){return c.hidden?0:c instanceof QuickPickSeparatorElement?2:1}},sorter:{compare:(c,d)=>{if(!this.sortByLabel||!this._lastQueryString)return 0;const u=this._lastQueryString.toLowerCase();return compareEntries(c,d,u)}},accessibilityProvider:new QuickInputAccessibilityProvider,setRowLineHeight:!1,multipleSelectionSupport:!1,hideTwistiesOfChildlessElements:!0,renderIndentGuides:RenderIndentGuides.None,findWidgetEnabled:!1,indent:0,horizontalScrolling:!1,allowNonCollapsibleParents:!0,alwaysConsumeMouseWheel:!0})),this._tree.getHTMLElement().id=o,this._registerListeners()}get onDidChangeFocus(){return Event$1.map(this._tree.onDidChangeFocus,e=>e.elements.filter(t=>t instanceof QuickPickItemElement).map(t=>t.item),this._store)}get onDidChangeSelection(){return Event$1.map(this._tree.onDidChangeSelection,e=>({items:e.elements.filter(t=>t instanceof QuickPickItemElement).map(t=>t.item),event:e.browserEvent}),this._store)}get displayed(){return this._container.style.display!=="none"}set displayed(e){this._container.style.display=e?"":"none"}get scrollTop(){return this._tree.scrollTop}set scrollTop(e){this._tree.scrollTop=e}get ariaLabel(){return this._tree.ariaLabel}set ariaLabel(e){this._tree.ariaLabel=e??""}set enabled(e){this._tree.getHTMLElement().style.pointerEvents=e?"":"none"}get matchOnDescription(){return this._matchOnDescription}set matchOnDescription(e){this._matchOnDescription=e}get matchOnDetail(){return this._matchOnDetail}set matchOnDetail(e){this._matchOnDetail=e}get matchOnLabel(){return this._matchOnLabel}set matchOnLabel(e){this._matchOnLabel=e}get matchOnLabelMode(){return this._matchOnLabelMode}set matchOnLabelMode(e){this._matchOnLabelMode=e}get sortByLabel(){return this._sortByLabel}set sortByLabel(e){this._sortByLabel=e}get shouldLoop(){return this._shouldLoop}set shouldLoop(e){this._shouldLoop=e}_registerListeners(){this._registerOnKeyDown(),this._registerOnContainerClick(),this._registerOnMouseMiddleClick(),this._registerOnTreeModelChanged(),this._registerOnElementChecked(),this._registerOnContextMenu(),this._registerHoverListeners(),this._registerSelectionChangeListener(),this._registerSeparatorActionShowingListeners()}_registerOnKeyDown(){this._register(this._tree.onKeyDown(e=>{const t=new StandardKeyboardEvent(e);switch(t.keyCode){case 10:this.toggleCheckbox();break}this._onKeyDown.fire(t)}))}_registerOnContainerClick(){this._register(addDisposableListener(this._container,EventType$1.CLICK,e=>{(e.x||e.y)&&this._onLeave.fire()}))}_registerOnMouseMiddleClick(){this._register(addDisposableListener(this._container,EventType$1.AUXCLICK,e=>{e.button===1&&this._onLeave.fire()}))}_registerOnTreeModelChanged(){this._register(this._tree.onDidChangeModel(()=>{const e=this._itemElements.filter(t=>!t.hidden).length;this._visibleCountObservable.set(e,void 0),this._hasCheckboxes&&this._updateCheckedObservables()}))}_registerOnElementChecked(){this._register(this._elementCheckedEventBufferer.wrapEvent(this._elementChecked.event,(e,t)=>t)(e=>this._updateCheckedObservables()))}_registerOnContextMenu(){this._register(this._tree.onContextMenu(e=>{e.element&&(e.browserEvent.preventDefault(),this._tree.setSelection([e.element]))}))}_registerHoverListeners(){const e=this._register(new ThrottledDelayer(typeof this.hoverDelegate.delay=="function"?this.hoverDelegate.delay():this.hoverDelegate.delay));this._register(this._tree.onMouseOver(async t=>{var s;if(isHTMLAnchorElement(t.browserEvent.target)){e.cancel();return}if(!(!isHTMLAnchorElement(t.browserEvent.relatedTarget)&&isAncestor$1(t.browserEvent.relatedTarget,(s=t.element)==null?void 0:s.element)))try{await e.trigger(async()=>{t.element instanceof QuickPickItemElement&&this.showHover(t.element)})}catch(o){if(!isCancellationError(o))throw o}})),this._register(this._tree.onMouseOut(t=>{var s;isAncestor$1(t.browserEvent.relatedTarget,(s=t.element)==null?void 0:s.element)||e.cancel()}))}_registerSeparatorActionShowingListeners(){this._register(this._tree.onDidChangeFocus(e=>{const t=e.elements[0]?this._tree.getParentElement(e.elements[0]):null;for(const s of this._separatorRenderer.visibleSeparators){const o=s===t;!!(s.focusInsideSeparator&QuickPickSeparatorFocusReason.ACTIVE_ITEM)!==o&&(o?s.focusInsideSeparator|=QuickPickSeparatorFocusReason.ACTIVE_ITEM:s.focusInsideSeparator&=~QuickPickSeparatorFocusReason.ACTIVE_ITEM,this._tree.rerender(s))}})),this._register(this._tree.onMouseOver(e=>{const t=e.element?this._tree.getParentElement(e.element):null;for(const s of this._separatorRenderer.visibleSeparators){if(s!==t)continue;!!(s.focusInsideSeparator&QuickPickSeparatorFocusReason.MOUSE_HOVER)||(s.focusInsideSeparator|=QuickPickSeparatorFocusReason.MOUSE_HOVER,this._tree.rerender(s))}})),this._register(this._tree.onMouseOut(e=>{const t=e.element?this._tree.getParentElement(e.element):null;for(const s of this._separatorRenderer.visibleSeparators){if(s!==t)continue;!!(s.focusInsideSeparator&QuickPickSeparatorFocusReason.MOUSE_HOVER)&&(s.focusInsideSeparator&=~QuickPickSeparatorFocusReason.MOUSE_HOVER,this._tree.rerender(s))}}))}_registerSelectionChangeListener(){this._register(this._tree.onDidChangeSelection(e=>{const t=e.elements.filter(s=>s instanceof QuickPickItemElement);t.length!==e.elements.length&&(e.elements.length===1&&e.elements[0]instanceof QuickPickSeparatorElement&&(this._tree.setFocus([e.elements[0].children[0]]),this._tree.reveal(e.elements[0],0)),this._tree.setSelection(t))}))}setAllVisibleChecked(e){this._elementCheckedEventBufferer.bufferEvents(()=>{this._itemElements.forEach(t=>{!t.hidden&&!t.checkboxDisabled&&t.item.pickable!==!1&&(t.checked=e)})})}setElements(e){this._elementDisposable.clear(),this._lastQueryString=void 0,this._inputElements=e,this._hasCheckboxes=this.parent.classList.contains("show-checkboxes");let t;this._itemElements=new Array,this._elementTree=e.reduce((s,o,r)=>{let l;if(o.type==="separator"){if(!o.buttons)return s;t=new QuickPickSeparatorElement(r,c=>this._onSeparatorButtonTriggered.fire(c),o),l=t}else{const c=r>0?e[r-1]:void 0;let d;c&&c.type==="separator"&&!c.buttons&&(d=c);const u=new QuickPickItemElement(r,t!=null&&t.children?t.children.length:r,this._hasCheckboxes&&o.pickable!==!1,g=>this._onButtonTriggered.fire(g),this._elementChecked,o,d);if(this._itemElements.push(u),t)return t.children.push(u),s;l=u}return s.push(l),s},new Array),this._setElementsToTree(this._elementTree),this.accessibilityService.isScreenReaderOptimized()&&setTimeout(()=>{const s=this._tree.getHTMLElement().querySelector(".monaco-list-row.focused"),o=s==null?void 0:s.parentNode;if(s&&o){const r=s.nextSibling;s.remove(),o.insertBefore(s,r)}},0)}setFocusedElements(e){const t=e.map(s=>this._itemElements.find(o=>o.item===s)).filter(s=>!!s).filter(s=>!s.hidden);if(this._tree.setFocus(t),e.length>0){const s=this._tree.getFocus()[0];s&&this._tree.reveal(s)}}getActiveDescendant(){return this._tree.getHTMLElement().getAttribute("aria-activedescendant")}setSelectedElements(e){const t=e.map(s=>this._itemElements.find(o=>o.item===s)).filter(s=>!!s);this._tree.setSelection(t)}getCheckedElements(){return this._itemElements.filter(e=>e.checked).map(e=>e.item)}setCheckedElements(e){this._elementCheckedEventBufferer.bufferEvents(()=>{const t=new Set;for(const s of e)t.add(s);for(const s of this._itemElements)s.checked=t.has(s.item)})}focus(e){var t;if(this._itemElements.length)switch(e===QuickPickFocus.Second&&this._itemElements.length<2&&(e=QuickPickFocus.First),e){case QuickPickFocus.First:this._tree.scrollTop=0,this._tree.focusFirst(void 0,s=>s.element instanceof QuickPickItemElement);break;case QuickPickFocus.Second:{this._tree.scrollTop=0;let s=!1;this._tree.focusFirst(void 0,o=>o.element instanceof QuickPickItemElement?s?!0:(s=!s,!1):!1);break}case QuickPickFocus.Last:this._tree.scrollTop=this._tree.scrollHeight,this._tree.focusLast(void 0,s=>s.element instanceof QuickPickItemElement);break;case QuickPickFocus.Next:{const s=this._tree.getFocus();this._tree.focusNext(void 0,this._shouldLoop,void 0,r=>r.element instanceof QuickPickItemElement?(this._tree.reveal(r.element),!0):!1);const o=this._tree.getFocus();s.length&&s[0]===o[0]&&this._onLeave.fire();break}case QuickPickFocus.Previous:{const s=this._tree.getFocus();this._tree.focusPrevious(void 0,this._shouldLoop,void 0,r=>{if(!(r.element instanceof QuickPickItemElement))return!1;const l=this._tree.getParentElement(r.element);return l===null||l.children[0]!==r.element?this._tree.reveal(r.element):this._tree.reveal(l),!0});const o=this._tree.getFocus();s.length&&s[0]===o[0]&&this._onLeave.fire();break}case QuickPickFocus.NextPage:this._tree.focusNextPage(void 0,s=>s.element instanceof QuickPickItemElement?(this._tree.reveal(s.element),!0):!1);break;case QuickPickFocus.PreviousPage:this._tree.focusPreviousPage(void 0,s=>{if(!(s.element instanceof QuickPickItemElement))return!1;const o=this._tree.getParentElement(s.element);return o===null||o.children[0]!==s.element?this._tree.reveal(s.element):this._tree.reveal(o),!0});break;case QuickPickFocus.NextSeparator:{let s=!1;const o=this._tree.getFocus()[0];this._tree.focusNext(void 0,!0,void 0,l=>{if(s)return!0;if(l.element instanceof QuickPickSeparatorElement)s=!0,this._separatorRenderer.isSeparatorVisible(l.element)?this._tree.reveal(l.element.children[0]):this._tree.reveal(l.element,0);else if(l.element instanceof QuickPickItemElement){if(l.element.separator)return this._itemRenderer.isItemWithSeparatorVisible(l.element)?this._tree.reveal(l.element):this._tree.reveal(l.element,0),!0;if(l.element===this._elementTree[0])return this._tree.reveal(l.element,0),!0}return!1});const r=this._tree.getFocus()[0];o===r&&(this._tree.scrollTop=this._tree.scrollHeight,this._tree.focusLast(void 0,l=>l.element instanceof QuickPickItemElement));break}case QuickPickFocus.PreviousSeparator:{let s,o=!!((t=this._tree.getFocus()[0])!=null&&t.separator);this._tree.focusPrevious(void 0,!0,void 0,r=>{if(r.element instanceof QuickPickSeparatorElement)o?s||(this._separatorRenderer.isSeparatorVisible(r.element)?this._tree.reveal(r.element):this._tree.reveal(r.element,0),s=r.element.children[0]):o=!0;else if(r.element instanceof QuickPickItemElement&&!s){if(r.element.separator)this._itemRenderer.isItemWithSeparatorVisible(r.element)?this._tree.reveal(r.element):this._tree.reveal(r.element,0),s=r.element;else if(r.element===this._elementTree[0])return this._tree.reveal(r.element,0),!0}return!1}),s&&this._tree.setFocus([s]);break}}}clearFocus(){this._tree.setFocus([])}domFocus(){this._tree.domFocus()}layout(e){this._tree.getHTMLElement().style.maxHeight=e?`${Math.floor(e/44)*44+6}px`:"",this._tree.layout()}filter(e){if(this._lastQueryString=e,!(this._sortByLabel||this._matchOnLabel||this._matchOnDescription||this._matchOnDetail))return this._tree.layout(),!1;const t=e;if(e=e.trim(),!e||!(this.matchOnLabel||this.matchOnDescription||this.matchOnDetail))this._itemElements.forEach(s=>{s.labelHighlights=void 0,s.descriptionHighlights=void 0,s.detailHighlights=void 0,s.hidden=!1;const o=s.index&&this._inputElements[s.index-1];s.item&&(s.separator=o&&o.type==="separator"&&!o.buttons?o:void 0)});else{let s;this._itemElements.forEach(o=>{let r;this.matchOnLabelMode==="fuzzy"?r=this.matchOnLabel?matchesFuzzyIconAware(e,parseLabelWithIcons(o.saneLabel))??void 0:void 0:r=this.matchOnLabel?matchesContiguousIconAware(t,parseLabelWithIcons(o.saneLabel))??void 0:void 0;const l=this.matchOnDescription?matchesFuzzyIconAware(e,parseLabelWithIcons(o.saneDescription||""))??void 0:void 0,c=this.matchOnDetail?matchesFuzzyIconAware(e,parseLabelWithIcons(o.saneDetail||""))??void 0:void 0;if(r||l||c?(o.labelHighlights=r,o.descriptionHighlights=l,o.detailHighlights=c,o.hidden=!1):(o.labelHighlights=void 0,o.descriptionHighlights=void 0,o.detailHighlights=void 0,o.hidden=o.item?!o.item.alwaysShow:!0),o.item?o.separator=void 0:o.separator&&(o.hidden=!0),!this.sortByLabel){const d=o.index&&this._inputElements[o.index-1]||void 0;(d==null?void 0:d.type)==="separator"&&!d.buttons&&(s=d),s&&!o.hidden&&(o.separator=s,s=void 0)}})}return this._setElementsToTree(this._sortByLabel&&e?this._itemElements:this._elementTree),this._tree.layout(),!0}toggleCheckbox(){this._elementCheckedEventBufferer.bufferEvents(()=>{const e=this._tree.getFocus().filter(s=>s instanceof QuickPickItemElement),t=this._allVisibleChecked(e);for(const s of e)s.checkboxDisabled||(s.checked=!t)})}style(e){this._tree.style(e)}toggleHover(){const e=this._tree.getFocus()[0];if(!(e!=null&&e.saneTooltip)||!(e instanceof QuickPickItemElement))return;if(this._lastHover&&!this._lastHover.isDisposed){this._lastHover.dispose();return}this.showHover(e);const t=new DisposableStore;t.add(this._tree.onDidChangeFocus(s=>{s.elements[0]instanceof QuickPickItemElement&&this.showHover(s.elements[0])})),this._lastHover&&t.add(this._lastHover),this._elementDisposable.add(t)}_setElementsToTree(e){const t=new Array;for(const s of e)s instanceof QuickPickSeparatorElement?t.push({element:s,collapsible:!1,collapsed:!1,children:s.children.map(o=>({element:o,collapsible:!1,collapsed:!1}))}):t.push({element:s,collapsible:!1,collapsed:!1});this._tree.setChildren(null,t)}_allVisibleChecked(e,t=!0){for(let s=0,o=e.length;s<o;s++){const r=e[s];if(!r.hidden&&r.item.pickable!==!1)if(r.checked)t=!0;else return!1}return t}_updateCheckedObservables(){transaction(e=>{this._allVisibleCheckedObservable.set(this._allVisibleChecked(this._itemElements,!1),e);const t=this._itemElements.filter(s=>s.checked).length;this._checkedCountObservable.set(t,e),this._checkedElementsObservable.set(this.getCheckedElements(),e)})}showHover(e){var t,s,o;this._lastHover&&!this._lastHover.isDisposed&&((s=(t=this.hoverDelegate).onDidHideHover)==null||s.call(t),(o=this._lastHover)==null||o.dispose()),!(!e.element||!e.saneTooltip)&&(this._lastHover=this.hoverDelegate.showHover({content:e.saneTooltip,target:e.element,linkHandler:r=>{this.linkOpenerDelegate(r)},appearance:{showPointer:!0},container:this._container,position:{hoverPosition:1}},!1))}};__decorate$d([memoize],QuickInputList.prototype,"onDidChangeFocus",null);__decorate$d([memoize],QuickInputList.prototype,"onDidChangeSelection",null);QuickInputList=__decorate$d([__param$d(4,IInstantiationService),__param$d(5,IAccessibilityService)],QuickInputList);function matchesContiguousIconAware(a,e){const{text:t,iconOffsets:s}=e;if(!s||s.length===0)return matchesContiguous(a,t);const o=ltrim(t," "),r=t.length-o.length,l=matchesContiguous(a,o);if(l)for(const c of l){const d=s[c.start+r]+r;c.start+=d,c.end+=d}return l}function matchesContiguous(a,e){const t=e.toLowerCase().indexOf(a.toLowerCase());return t!==-1?[{start:t,end:t+a.length}]:null}function compareEntries(a,e,t){const s=a.labelHighlights||[],o=e.labelHighlights||[];return s.length&&!o.length?-1:!s.length&&o.length?1:s.length===0&&o.length===0?0:compareAnything(a.saneSortLabel,e.saneSortLabel,t)}function registerQuickInputCommandAndKeybindingRule(a,e={}){KeybindingsRegistry.registerCommandAndKeybindingRule({weight:200,when:inQuickInputContext,metadata:{description:localize(1741,"Used while in the context of any kind of quick input. If you change one keybinding for this command, you should change all of the other keybindings (modifier variants) of this command as well.")},...a,secondary:getSecondary(a.primary,a.secondary??[],e)})}function registerQuickPickCommandAndKeybindingRule(a,e={}){KeybindingsRegistry.registerCommandAndKeybindingRule({weight:200,when:ContextKeyExpr.and(ContextKeyExpr.or(ContextKeyExpr.equals(quickInputTypeContextKeyValue,"quickPick"),ContextKeyExpr.equals(quickInputTypeContextKeyValue,"quickTree")),inQuickInputContext),metadata:{description:localize(1742,"Used while in the context of the quick pick. If you change one keybinding for this command, you should change all of the other keybindings (modifier variants) of this command as well.")},...a,secondary:getSecondary(a.primary,a.secondary??[],e)})}const ctrlKeyMod=isMacintosh?256:2048;function getSecondary(a,e,t={}){return t.withAltMod&&e.push(512+a),t.withCtrlMod&&(e.push(ctrlKeyMod+a),t.withAltMod&&e.push(512+ctrlKeyMod+a)),t.withCmdMod&&isMacintosh&&(e.push(2048+a),t.withCtrlMod&&e.push(2048+256+a),t.withAltMod&&(e.push(2048+512+a),t.withCtrlMod&&e.push(2048+512+256+a))),e}function focusHandler(a,e){return t=>{const s=t.get(IQuickInputService).currentQuickInput;if(s)return e&&s.quickNavigate?s.focus(e):s.focus(a)}}registerQuickPickCommandAndKeybindingRule({id:"quickInput.pageNext",primary:12,handler:focusHandler(QuickPickFocus.NextPage)},{withAltMod:!0,withCtrlMod:!0,withCmdMod:!0});registerQuickPickCommandAndKeybindingRule({id:"quickInput.pagePrevious",primary:11,handler:focusHandler(QuickPickFocus.PreviousPage)},{withAltMod:!0,withCtrlMod:!0,withCmdMod:!0});registerQuickPickCommandAndKeybindingRule({id:"quickInput.first",primary:ctrlKeyMod+14,handler:focusHandler(QuickPickFocus.First)},{withAltMod:!0,withCmdMod:!0});registerQuickPickCommandAndKeybindingRule({id:"quickInput.last",primary:ctrlKeyMod+13,handler:focusHandler(QuickPickFocus.Last)},{withAltMod:!0,withCmdMod:!0});registerQuickPickCommandAndKeybindingRule({id:"quickInput.next",primary:18,handler:focusHandler(QuickPickFocus.Next)},{withCtrlMod:!0});registerQuickPickCommandAndKeybindingRule({id:"quickInput.previous",primary:16,handler:focusHandler(QuickPickFocus.Previous)},{withCtrlMod:!0});const nextSeparatorFallbackDesc=localize(1743,"If we're in quick access mode, this will navigate to the next item. If we are not in quick access mode, this will navigate to the next separator."),prevSeparatorFallbackDesc=localize(1744,"If we're in quick access mode, this will navigate to the previous item. If we are not in quick access mode, this will navigate to the previous separator.");isMacintosh?(registerQuickPickCommandAndKeybindingRule({id:"quickInput.nextSeparatorWithQuickAccessFallback",primary:2048+18,handler:focusHandler(QuickPickFocus.NextSeparator,QuickPickFocus.Next),metadata:{description:nextSeparatorFallbackDesc}}),registerQuickPickCommandAndKeybindingRule({id:"quickInput.nextSeparator",primary:2048+512+18,secondary:[2048+256+18],handler:focusHandler(QuickPickFocus.NextSeparator)},{withCtrlMod:!0}),registerQuickPickCommandAndKeybindingRule({id:"quickInput.previousSeparatorWithQuickAccessFallback",primary:2048+16,handler:focusHandler(QuickPickFocus.PreviousSeparator,QuickPickFocus.Previous),metadata:{description:prevSeparatorFallbackDesc}}),registerQuickPickCommandAndKeybindingRule({id:"quickInput.previousSeparator",primary:2048+512+16,secondary:[2048+256+16],handler:focusHandler(QuickPickFocus.PreviousSeparator)},{withCtrlMod:!0})):(registerQuickPickCommandAndKeybindingRule({id:"quickInput.nextSeparatorWithQuickAccessFallback",primary:512+18,handler:focusHandler(QuickPickFocus.NextSeparator,QuickPickFocus.Next),metadata:{description:nextSeparatorFallbackDesc}}),registerQuickPickCommandAndKeybindingRule({id:"quickInput.nextSeparator",primary:2048+512+18,handler:focusHandler(QuickPickFocus.NextSeparator)}),registerQuickPickCommandAndKeybindingRule({id:"quickInput.previousSeparatorWithQuickAccessFallback",primary:512+16,handler:focusHandler(QuickPickFocus.PreviousSeparator,QuickPickFocus.Previous),metadata:{description:prevSeparatorFallbackDesc}}),registerQuickPickCommandAndKeybindingRule({id:"quickInput.previousSeparator",primary:2048+512+16,handler:focusHandler(QuickPickFocus.PreviousSeparator)}));KeybindingsRegistry.registerCommandAndKeybindingRule({id:"quickInput.accept",primary:3,weight:200,when:ContextKeyExpr.and(ContextKeyExpr.notEquals(quickInputTypeContextKeyValue,"quickWidget"),inQuickInputContext),metadata:{description:localize(1745,"Used while in the context of some quick input. If you change one keybinding for this command, you should change all of the other keybindings (modifier variants) of this command as well.")},handler:a=>{const e=a.get(IQuickInputService).currentQuickInput;e==null||e.accept()},secondary:getSecondary(3,[],{withAltMod:!0,withCtrlMod:!0,withCmdMod:!0})});registerQuickPickCommandAndKeybindingRule({id:"quickInput.acceptInBackground",when:ContextKeyExpr.and(inQuickInputContext,ContextKeyExpr.equals(quickInputTypeContextKeyValue,"quickPick"),ContextKeyExpr.or(InputFocusedContext.negate(),endOfQuickInputBoxContext)),primary:17,weight:200+50,handler:a=>{const e=a.get(IQuickInputService).currentQuickInput;e==null||e.accept(!0)}},{withAltMod:!0,withCtrlMod:!0,withCmdMod:!0});registerQuickInputCommandAndKeybindingRule({id:"quickInput.hide",primary:9,handler:a=>{const e=a.get(IQuickInputService).currentQuickInput;e==null||e.hide()}},{withAltMod:!0,withCtrlMod:!0,withCmdMod:!0});registerQuickPickCommandAndKeybindingRule({id:"quickInput.toggleHover",primary:ctrlKeyMod|10,handler:a=>{a.get(IQuickInputService).toggleHover()}});var __decorate$c=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$c=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},QuickInputTreeRenderer_1;const $$2=$$l;var on;let QuickInputTreeRenderer=(on=class extends Disposable{constructor(e,t,s,o){super(),this._hoverDelegate=e,this._buttonTriggeredEmitter=t,this.onCheckedEvent=s,this._themeService=o,this.templateId=QuickInputTreeRenderer_1.ID}renderTemplate(e){const t=new DisposableStore,s=append$2(e,$$2(".quick-input-tree-entry")),o=t.add(new TriStateCheckbox("",!1,{...defaultCheckboxStyles,size:15}));s.appendChild(o.domNode);const r=append$2(s,$$2("label.quick-input-tree-label")),l=append$2(r,$$2(".quick-input-tree-rows")),c=append$2(l,$$2(".quick-input-tree-row")),d=prepend$2(c,$$2(".quick-input-tree-icon")),u=t.add(new IconLabel(c,{supportHighlights:!0,supportDescriptionHighlights:!0,supportIcons:!0,hoverDelegate:this._hoverDelegate})),g=t.add(new ActionBar(s,this._hoverDelegate?{hoverDelegate:this._hoverDelegate}:void 0));return g.domNode.classList.add("quick-input-tree-entry-action-bar"),{toDisposeTemplate:t,entry:s,checkbox:o,icon:d,label:u,actionBar:g,toDisposeElement:new DisposableStore}}renderElement(e,t,s,o){const r=s.toDisposeElement,l=e.element;if(l.pickable===!1?s.checkbox.domNode.style.display="none":(s.checkbox.domNode.style.display="",s.checkbox.checked=l.checked??!1,r.add(Event$1.filter(this.onCheckedEvent,f=>f.item===l)(f=>s.checkbox.checked=f.checked)),l.disabled&&s.checkbox.disable()),l.iconPath){const f=isDark(this._themeService.getColorTheme().type)?l.iconPath.dark:l.iconPath.light??l.iconPath.dark,p=URI.revive(f);s.icon.className="quick-input-tree-icon",s.icon.style.backgroundImage=asCSSUrl(p)}else s.icon.style.backgroundImage="",s.icon.className=l.iconClass?`quick-input-tree-icon ${l.iconClass}`:"";const{labelHighlights:c,descriptionHighlights:d}=e.filterData||{};let u;l.description&&(u={markdown:{value:escape$2(l.description),supportThemeIcons:!0},markdownNotSupportedFallback:l.description}),s.label.setLabel(l.label,l.description,{matches:c,descriptionMatches:d,extraClasses:l.iconClasses,italic:l.italic,strikethrough:l.strikethrough,labelEscapeNewLines:!0,descriptionTitle:u});const g=l.buttons;g&&g.length?(s.actionBar.push(g.map((f,p)=>quickInputButtonToAction(f,`tree-${p}`,()=>this._buttonTriggeredEmitter.fire({item:l,button:f}))),{icon:!0,label:!1}),s.entry.classList.add("has-actions")):s.entry.classList.remove("has-actions")}disposeElement(e,t,s,o){s.toDisposeElement.clear(),s.actionBar.clear()}disposeTemplate(e){e.toDisposeElement.dispose(),e.toDisposeTemplate.dispose()}},QuickInputTreeRenderer_1=on,on.ID="quickInputTreeElement",on);QuickInputTreeRenderer=QuickInputTreeRenderer_1=__decorate$c([__param$c(3,IThemeService)],QuickInputTreeRenderer);class QuickInputTreeDelegate{getHeight(e){return 22}getTemplateId(e){return QuickInputTreeRenderer.ID}}function getParentNodeState(a){var r;let e=!1,t=!1,s=!1;for(const l of a){switch((r=l.element)==null?void 0:r.checked){case"partial":s=!0;break;case!0:e=!0;break;default:t=!0;break}if(e&&t&&s)break}return t?s||e?"partial":!1:s?"partial":e}class QuickTreeAccessibilityProvider{constructor(e){this.onCheckedEvent=e}getWidgetAriaLabel(){return localize(1755,"Quick Tree")}getAriaLabel(e){return e.ariaLabel||[e.label,e.description].map(t=>getCodiconAriaLabel(t)).filter(t=>!!t).join(", ")}getWidgetRole(){return"tree"}getRole(e){return"checkbox"}isChecked(e){return{get value(){return e.checked===!0},onDidChange:t=>Event$1.filter(this.onCheckedEvent,s=>s.item===e)(s=>t())}}}class QuickInputTreeFilter{constructor(){this.filterValue="",this.matchOnLabel=!0,this.matchOnDescription=!1}filter(e,t){if(!this.filterValue||!(this.matchOnLabel||this.matchOnDescription))return e.children?{visibility:2,data:{}}:{visibility:1,data:{}};const s=this.matchOnLabel?matchesFuzzyIconAware(this.filterValue,parseLabelWithIcons(e.label))??void 0:void 0,o=this.matchOnDescription?matchesFuzzyIconAware(this.filterValue,parseLabelWithIcons(e.description||""))??void 0:void 0;return{visibility:t===1||s||o?1:e.children?2:0,data:{labelHighlights:s,descriptionHighlights:o}}}}var __decorate$b=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$b=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const $$1=$$l;let QuickInputTreeController=class extends Disposable{constructor(e,t,s){super(),this.instantiationService=s,this._onDidTriggerButton=this._register(new Emitter$1),this._onDidChangeCheckboxState=this._register(new Emitter$1),this.onDidChangeCheckboxState=this._onDidChangeCheckboxState.event,this._onDidCheckedLeafItemsChange=this._register(new Emitter$1),this._onLeave=new Emitter$1,this.onLeave=this._onLeave.event,this._onDidAccept=this._register(new Emitter$1),this.onDidAccept=this._onDidAccept.event,this._container=append$2(e,$$1(".quick-input-tree")),this._renderer=this._register(this.instantiationService.createInstance(QuickInputTreeRenderer,t,this._onDidTriggerButton,this.onDidChangeCheckboxState)),this._filter=this.instantiationService.createInstance(QuickInputTreeFilter),this._tree=this._register(this.instantiationService.createInstance(WorkbenchObjectTree,"QuickInputTree",this._container,new QuickInputTreeDelegate,[this._renderer],{accessibilityProvider:new QuickTreeAccessibilityProvider(this.onDidChangeCheckboxState),horizontalScrolling:!1,multipleSelectionSupport:!1,findWidgetEnabled:!1,alwaysConsumeMouseWheel:!0,hideTwistiesOfChildlessElements:!0,renderIndentGuides:RenderIndentGuides.None,expandOnDoubleClick:!0,expandOnlyOnTwistieClick:!0,disableExpandOnSpacebar:!0,sorter:{compare:(o,r)=>{if(o.label<r.label)return-1;if(o.label>r.label)return 1;if(o.description&&r.description){if(o.description<r.description)return-1;if(o.description>r.description)return 1}else{if(o.description)return-1;if(r.description)return 1}return 0}},filter:this._filter})),this.registerOnOpenListener()}get tree(){return this._tree}get displayed(){return this._container.style.display!=="none"}set displayed(e){this._container.style.display=e?"":"none"}getActiveDescendant(){return this._tree.getHTMLElement().getAttribute("aria-activedescendant")}layout(e){this._tree.getHTMLElement().style.maxHeight=e?`${Math.floor(e/44)*44+6}px`:"",this._tree.layout()}registerOnOpenListener(){this._register(this._tree.onDidOpen(e=>{const t=e.element;if(!t||t.disabled)return;if(t.pickable===!1){this._tree.setFocus([t]),this._onDidAccept.fire();return}const s=t.checked!==!0;if((t.checked??!1)===s)return;t.checked=s,this._tree.rerender(t);const o=new Set,r=[...this._tree.getNode(t).children];for(;r.length;){const c=r.shift();c!=null&&c.element&&!o.has(c.element)&&(o.add(c.element),(c.element.checked??!1)!==t.checked&&(c.element.checked=t.checked,this._tree.rerender(c.element)),r.push(...c.children))}let l=this._tree.getParentElement(t);for(;l;){const c=[...this._tree.getNode(l).children],d=getParentNodeState(c);(l.checked??!1)!==d&&(l.checked=d,this._tree.rerender(l)),l=this._tree.getParentElement(l)}this._onDidChangeCheckboxState.fire({item:t,checked:t.checked??!1}),this._onDidCheckedLeafItemsChange.fire(this.getCheckedLeafItems())}))}getCheckedLeafItems(){const e=new Set,t=[...this._tree.getNode().children],s=new Array;for(;t.length;){const o=t.shift();!(o!=null&&o.element)||e.has(o.element)||o.element.checked&&(e.add(o.element),t.push(...o.children),o.element.children||s.push(o.element))}return s}};QuickInputTreeController=__decorate$b([__param$b(2,IInstantiationService)],QuickInputTreeController);var __decorate$a=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$a=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},QuickInputController_1;const $=$$l,VIEWSTATE_STORAGE_KEY="workbench.quickInput.viewState";var rn;let QuickInputController=(rn=class extends Disposable{get currentQuickInput(){return this.controller??void 0}get container(){return this._container}constructor(e,t,s,o,r){super(),this.options=e,this.layoutService=t,this.instantiationService=s,this.storageService=r,this.enabled=!0,this.onDidAcceptEmitter=this._register(new Emitter$1),this.onDidCustomEmitter=this._register(new Emitter$1),this.onDidTriggerButtonEmitter=this._register(new Emitter$1),this.keyMods={ctrlCmd:!1,alt:!1},this.controller=null,this.onShowEmitter=this._register(new Emitter$1),this.onShow=this.onShowEmitter.event,this.onHideEmitter=this._register(new Emitter$1),this.onHide=this.onHideEmitter.event,this.inQuickInputContext=InQuickInputContextKey.bindTo(o),this.quickInputTypeContext=QuickInputTypeContextKey.bindTo(o),this.endOfQuickInputBoxContext=EndOfQuickInputBoxContextKey.bindTo(o),this.idPrefix=e.idPrefix,this._container=e.container,this.styles=e.styles,this._register(Event$1.runAndSubscribe(onDidRegisterWindow,({window:l,disposables:c})=>this.registerKeyModsListeners(l,c),{window:mainWindow,disposables:this._store})),this._register(onWillUnregisterWindow(l=>{this.ui&&getWindow(this.ui.container)===l&&(this.reparentUI(this.layoutService.mainContainer),this.layout(this.layoutService.mainContainerDimension,this.layoutService.mainContainerOffset.quickPickTop))})),this.viewState=this.loadViewState()}registerKeyModsListeners(e,t){const s=o=>{this.keyMods.ctrlCmd=o.ctrlKey||o.metaKey,this.keyMods.alt=o.altKey};for(const o of[EventType$1.KEY_DOWN,EventType$1.KEY_UP,EventType$1.MOUSE_DOWN])t.add(addDisposableListener(e,o,s,!0))}getUI(e){if(this.ui)return e&&getWindow(this._container)!==getWindow(this.layoutService.activeContainer)&&(this.reparentUI(this.layoutService.activeContainer),this.layout(this.layoutService.activeContainerDimension,this.layoutService.activeContainerOffset.quickPickTop)),this.ui;const t=append$2(this._container,$(".quick-input-widget.show-file-icons"));t.tabIndex=-1,t.style.display="none";const s=createStyleSheet(t),o=append$2(t,$(".quick-input-titlebar")),r=this._register(new ActionBar(o,{hoverDelegate:this.options.hoverDelegate}));r.domNode.classList.add("quick-input-left-action-bar");const l=append$2(o,$(".quick-input-title")),c=this._register(new ActionBar(o,{hoverDelegate:this.options.hoverDelegate}));c.domNode.classList.add("quick-input-right-action-bar");const d=append$2(t,$(".quick-input-header")),u=this._register(new TriStateCheckbox(localize(1746,"Toggle all checkboxes"),!1,{...defaultCheckboxStyles,size:15}));append$2(d,u.domNode),this._register(u.onChange(()=>{const O=u.checked;R.setAllVisibleChecked(O===!0)})),this._register(addDisposableListener(u.domNode,EventType$1.CLICK,O=>{(O.x||O.y)&&m.setFocus()}));const g=append$2(d,$(".quick-input-description")),f=append$2(d,$(".quick-input-and-message")),p=append$2(f,$(".quick-input-filter")),m=this._register(new QuickInputBox(p,this.styles.inputBox,this.styles.toggle));m.setAttribute("aria-describedby",`${this.idPrefix}message`);const _=append$2(p,$(".quick-input-visible-count"));_.setAttribute("aria-live","polite"),_.setAttribute("aria-atomic","true");const C=this._register(new CountBadge(_,{countFormat:localize(1747,"{0} Results")},this.styles.countBadge)),b=append$2(p,$(".quick-input-count"));b.setAttribute("aria-live","polite");const v=this._register(new CountBadge(b,{countFormat:localize(1748,"{0} Selected")},this.styles.countBadge)),S=this._register(new ActionBar(d,{hoverDelegate:this.options.hoverDelegate}));S.domNode.classList.add("quick-input-inline-action-bar");const y=append$2(d,$(".quick-input-action")),w=this._register(new Button(y,this.styles.button));w.label=localize(1749,"OK"),this._register(w.onDidClick(O=>{this.onDidAcceptEmitter.fire()}));const L=append$2(d,$(".quick-input-action")),x=this._register(new Button(L,{...this.styles.button,supportIcons:!0}));x.label=localize(1750,"Custom"),this._register(x.onDidClick(O=>{this.onDidCustomEmitter.fire()}));const E=append$2(f,$(`#${this.idPrefix}message.quick-input-message`)),I=this._register(new ProgressBar(t,this.styles.progressBar));I.getContainer().classList.add("quick-input-progress");const D=append$2(t,$(".quick-input-html-widget"));D.tabIndex=-1;const k=append$2(t,$(".quick-input-description")),N=this.idPrefix+"list",R=this._register(this.instantiationService.createInstance(QuickInputList,t,this.options.hoverDelegate,this.options.linkOpenerDelegate,N));m.setAttribute("aria-controls",N),this._register(R.onDidChangeFocus(()=>{m.hasFocus()&&m.setAttribute("aria-activedescendant",R.getActiveDescendant()??"")})),this._register(R.onChangedAllVisibleChecked(O=>{u.checked=O})),this._register(R.onChangedVisibleCount(O=>{C.setCount(O)})),this._register(R.onChangedCheckedCount(O=>{v.setCount(O)})),this._register(R.onLeave(()=>{setTimeout(()=>{this.controller&&(m.setFocus(),this.controller instanceof QuickPick&&this.controller.canSelectMany&&R.clearFocus())},0)}));const M=this._register(this.instantiationService.createInstance(QuickInputTreeController,t,this.options.hoverDelegate));this._register(M.tree.onDidChangeFocus(()=>{m.hasFocus()&&m.setAttribute("aria-activedescendant",M.getActiveDescendant()??"")})),this._register(M.onLeave(()=>{setTimeout(()=>{this.controller&&(m.setFocus(),M.tree.setFocus([]))},0)})),this._register(M.onDidAccept(()=>{this.onDidAcceptEmitter.fire()})),this._register(M.tree.onDidChangeContentHeight(()=>this.updateLayout()));const A=trackFocus(t);return this._register(A),this._register(addDisposableListener(t,EventType$1.FOCUS,O=>{const P=this.getUI();if(isAncestor$1(O.relatedTarget,P.inputContainer)){const W=P.inputBox.isSelectionAtEnd();this.endOfQuickInputBoxContext.get()!==W&&this.endOfQuickInputBoxContext.set(W)}isAncestor$1(O.relatedTarget,P.container)||(this.inQuickInputContext.set(!0),this.previousFocusElement=isHTMLElement(O.relatedTarget)?O.relatedTarget:void 0)},!0)),this._register(A.onDidBlur(()=>{!this.getUI().ignoreFocusOut&&!this.options.ignoreFocusOut()&&this.hide(QuickInputHideReason.Blur),this.inQuickInputContext.set(!1),this.endOfQuickInputBoxContext.set(!1),this.previousFocusElement=void 0})),this._register(m.onKeyDown(O=>{const P=this.getUI().inputBox.isSelectionAtEnd();this.endOfQuickInputBoxContext.get()!==P&&this.endOfQuickInputBoxContext.set(P),m.removeAttribute("aria-activedescendant")})),this._register(addDisposableListener(t,EventType$1.FOCUS,O=>{m.setFocus()})),this.dndController=this._register(this.instantiationService.createInstance(QuickInputDragAndDropController,this._container,t,[{node:o,includeChildren:!0},{node:d,includeChildren:!1}],this.viewState)),this._register(autorun(O=>{var W;const P=(W=this.dndController)==null?void 0:W.dndViewState.read(O);P&&(P.top!==void 0&&P.left!==void 0?this.viewState={...this.viewState,top:P.top,left:P.left}:this.viewState=void 0,this.updateLayout(),P.done&&this.saveViewState(this.viewState))})),this.ui={container:t,styleSheet:s,leftActionBar:r,titleBar:o,title:l,description1:k,description2:g,widget:D,rightActionBar:c,inlineActionBar:S,checkAll:u,inputContainer:f,filterContainer:p,inputBox:m,visibleCountContainer:_,visibleCount:C,countContainer:b,count:v,okContainer:y,ok:w,message:E,customButtonContainer:L,customButton:x,list:R,tree:M,progressBar:I,onDidAccept:this.onDidAcceptEmitter.event,onDidCustom:this.onDidCustomEmitter.event,onDidTriggerButton:this.onDidTriggerButtonEmitter.event,ignoreFocusOut:!1,keyMods:this.keyMods,show:O=>this.show(O),hide:()=>this.hide(),setVisibilities:O=>this.setVisibilities(O),setEnabled:O=>this.setEnabled(O),setContextKey:O=>this.options.setContextKey(O),linkOpenerDelegate:O=>this.options.linkOpenerDelegate(O)},this.updateStyles(),this.ui}reparentUI(e){var t;this.ui&&(this._container=e,append$2(this._container,this.ui.container),(t=this.dndController)==null||t.reparentUI(this._container))}pick(e,t={},s=CancellationToken.None){return new Promise((o,r)=>{let l=g=>{var f;l=o,(f=t.onKeyMods)==null||f.call(t,c.keyMods),o(g)};if(s.isCancellationRequested){l(void 0);return}const c=this.createQuickPick({useSeparators:!0});let d;const u=[c,c.onDidAccept(()=>{if(c.canSelectMany)l(c.selectedItems.slice()),c.hide();else{const g=c.activeItems[0];g&&(l(g),c.hide())}}),c.onDidChangeActive(g=>{const f=g[0];f&&t.onDidFocus&&t.onDidFocus(f)}),c.onDidChangeSelection(g=>{if(!c.canSelectMany){const f=g[0];f&&(l(f),c.hide())}}),c.onDidTriggerItemButton(g=>t.onDidTriggerItemButton&&t.onDidTriggerItemButton({...g,removeItem:()=>{const f=c.items.indexOf(g.item);if(f!==-1){const p=c.items.slice(),m=p.splice(f,1),_=c.activeItems.filter(b=>b!==m[0]),C=c.keepScrollPosition;c.keepScrollPosition=!0,c.items=p,_&&(c.activeItems=_),c.keepScrollPosition=C}}})),c.onDidTriggerSeparatorButton(g=>{var f;return(f=t.onDidTriggerSeparatorButton)==null?void 0:f.call(t,g)}),c.onDidChangeValue(g=>{d&&!g&&(c.activeItems.length!==1||c.activeItems[0]!==d)&&(c.activeItems=[d])}),s.onCancellationRequested(()=>{c.hide()}),c.onDidHide(()=>{dispose(u),l(void 0)})];c.title=t.title,t.value&&(c.value=t.value),c.canSelectMany=!!t.canPickMany,c.placeholder=t.placeHolder,c.ignoreFocusOut=!!t.ignoreFocusLost,c.matchOnDescription=!!t.matchOnDescription,c.matchOnDetail=!!t.matchOnDetail,t.sortByLabel!==void 0&&(c.sortByLabel=t.sortByLabel),c.matchOnLabel=t.matchOnLabel===void 0||t.matchOnLabel,c.quickNavigate=t.quickNavigate,c.hideInput=!!t.hideInput,c.contextKey=t.contextKey,c.busy=!0,Promise.all([e,t.activeItem]).then(([g,f])=>{d=f,c.busy=!1,c.items=g,c.canSelectMany&&(c.selectedItems=g.filter(p=>p.type!=="separator"&&p.picked)),d&&(c.activeItems=[d])}),c.show(),Promise.resolve(e).then(void 0,g=>{r(g),c.hide()})})}setValidationOnInput(e,t){t&&isString$1(t)?(e.severity=Severity$2.Error,e.validationMessage=t):t&&!isString$1(t)?(e.severity=t.severity,e.validationMessage=t.content):(e.severity=Severity$2.Ignore,e.validationMessage=void 0)}input(e={},t=CancellationToken.None){return new Promise(s=>{if(t.isCancellationRequested){s(void 0);return}const o=this.createInputBox(),r=e.validateInput||(()=>Promise.resolve(void 0)),l=Event$1.debounce(o.onDidChangeValue,(g,f)=>f,100);let c=e.value||"",d=Promise.resolve(r(c));const u=[o,l(g=>{g!==c&&(d=Promise.resolve(r(g)),c=g),d.then(f=>{g===c&&this.setValidationOnInput(o,f)})}),o.onDidAccept(()=>{const g=o.value;g!==c&&(d=Promise.resolve(r(g)),c=g),d.then(f=>{!f||!isString$1(f)&&f.severity!==Severity$2.Error?(s(g),o.hide()):g===c&&this.setValidationOnInput(o,f)})}),t.onCancellationRequested(()=>{o.hide()}),o.onDidHide(()=>{dispose(u),s(void 0)})];o.title=e.title,o.value=e.value||"",o.valueSelection=e.valueSelection,o.prompt=e.prompt,o.placeholder=e.placeHolder,o.password=!!e.password,o.ignoreFocusOut=!!e.ignoreFocusLost,o.show()})}createQuickPick(e={useSeparators:!1}){const t=this.getUI(!0);return new QuickPick(t)}createInputBox(){const e=this.getUI(!0);return new InputBox(e)}show(e){var r;const t=this.getUI(!0);this.onShowEmitter.fire();const s=this.controller;this.controller=e,s==null||s.didHide(),this.setEnabled(!0),t.leftActionBar.clear(),t.title.textContent="",t.description1.textContent="",t.description2.textContent="",reset(t.widget),t.rightActionBar.clear(),t.inlineActionBar.clear(),t.checkAll.checked=!1,t.inputBox.placeholder="",t.inputBox.password=!1,t.inputBox.showDecoration(Severity$2.Ignore),t.visibleCount.setCount(0),t.count.setCount(0),reset(t.message),t.progressBar.stop(),t.list.setElements([]),t.list.matchOnDescription=!1,t.list.matchOnDetail=!1,t.list.matchOnLabel=!0,t.list.sortByLabel=!0,t.ignoreFocusOut=!1,t.inputBox.toggles=void 0;const o=this.options.backKeybindingLabel();backButton.tooltip=o?localize(1751,"Back ({0})",o):localize(1752,"Back"),t.container.style.display="",this.updateLayout(),(r=this.dndController)==null||r.layoutContainer(),t.inputBox.setFocus(),this.quickInputTypeContext.set(e.type)}isVisible(){return!!this.ui&&this.ui.container.style.display!=="none"}setVisibilities(e){const t=this.getUI();t.title.style.display=e.title?"":"none",t.description1.style.display=e.description&&(e.inputBox||e.checkAll)?"":"none",t.description2.style.display=e.description&&!(e.inputBox||e.checkAll)?"":"none",t.checkAll.domNode.style.display=e.checkAll?"":"none",t.inputContainer.style.display=e.inputBox?"":"none",t.filterContainer.style.display=e.inputBox?"":"none",t.visibleCountContainer.style.display=e.visibleCount?"":"none",t.countContainer.style.display=e.count?"":"none",t.okContainer.style.display=e.ok?"":"none",t.customButtonContainer.style.display=e.customButton?"":"none",t.message.style.display=e.message?"":"none",t.progressBar.getContainer().style.display=e.progressBar?"":"none",t.list.displayed=!!e.list,t.tree.displayed=!!e.tree,t.container.classList.toggle("show-checkboxes",!!e.checkBox),t.container.classList.toggle("hidden-input",!e.inputBox&&!e.description),this.updateLayout()}setEnabled(e){if(e!==this.enabled){this.enabled=e;const t=this.getUI();for(const s of t.leftActionBar.viewItems)s.action.enabled=e;for(const s of t.rightActionBar.viewItems)s.action.enabled=e;e?t.checkAll.enable():t.checkAll.disable(),t.inputBox.enabled=e,t.ok.enabled=e,t.list.enabled=e}}hide(e){var r;const t=this.controller;if(!t)return;t.willHide(e);const s=(r=this.ui)==null?void 0:r.container,o=s&&!isAncestorOfActiveElement(s);if(this.controller=null,this.onHideEmitter.fire(),s&&(s.style.display="none"),!o){let l=this.previousFocusElement;for(;l&&!l.offsetParent;)l=l.parentElement??void 0;l!=null&&l.offsetParent?(l.focus(),this.previousFocusElement=void 0):this.options.returnFocus()}t.didHide(e)}toggleHover(){this.isVisible()&&this.controller instanceof QuickPick&&this.getUI().list.toggleHover()}layout(e,t){this.dimension=e,this.titleBarOffset=t,this.updateLayout()}updateLayout(){var e,t;if(this.ui&&this.isVisible()){const s=this.ui.container.style,o=Math.min(this.dimension.width*.62,QuickInputController_1.MAX_WIDTH);s.width=o+"px",s.top=`${(e=this.viewState)!=null&&e.top?Math.round(this.dimension.height*this.viewState.top):this.titleBarOffset}px`,s.left=`${Math.round(this.dimension.width*(((t=this.viewState)==null?void 0:t.left)??.5)-o/2)}px`,this.ui.inputBox.layout(),this.ui.list.layout(this.dimension&&this.dimension.height*.4),this.ui.tree.layout(this.dimension&&this.dimension.height*.4)}}applyStyles(e){this.styles=e,this.updateStyles()}updateStyles(){if(this.ui){const{quickInputTitleBackground:e,quickInputBackground:t,quickInputForeground:s,widgetBorder:o,widgetShadow:r}=this.styles.widget;this.ui.titleBar.style.backgroundColor=e??"",this.ui.container.style.backgroundColor=t??"",this.ui.container.style.color=s??"",this.ui.container.style.border=o?`1px solid ${o}`:"",this.ui.container.style.boxShadow=r?`0 0 8px 2px ${r}`:"",this.ui.list.style(this.styles.list),this.ui.tree.tree.style(this.styles.list);const l=[];this.styles.pickerGroup.pickerGroupBorder&&l.push(`.quick-input-list .quick-input-list-entry { border-top-color:  ${this.styles.pickerGroup.pickerGroupBorder}; }`),this.styles.pickerGroup.pickerGroupForeground&&l.push(`.quick-input-list .quick-input-list-separator { color:  ${this.styles.pickerGroup.pickerGroupForeground}; }`),this.styles.pickerGroup.pickerGroupForeground&&l.push(".quick-input-list .quick-input-list-separator-as-item { color: var(--vscode-descriptionForeground); }"),(this.styles.keybindingLabel.keybindingLabelBackground||this.styles.keybindingLabel.keybindingLabelBorder||this.styles.keybindingLabel.keybindingLabelBottomBorder||this.styles.keybindingLabel.keybindingLabelShadow||this.styles.keybindingLabel.keybindingLabelForeground)&&(l.push(".quick-input-list .monaco-keybinding > .monaco-keybinding-key {"),this.styles.keybindingLabel.keybindingLabelBackground&&l.push(`background-color: ${this.styles.keybindingLabel.keybindingLabelBackground};`),this.styles.keybindingLabel.keybindingLabelBorder&&l.push(`border-color: ${this.styles.keybindingLabel.keybindingLabelBorder};`),this.styles.keybindingLabel.keybindingLabelBottomBorder&&l.push(`border-bottom-color: ${this.styles.keybindingLabel.keybindingLabelBottomBorder};`),this.styles.keybindingLabel.keybindingLabelShadow&&l.push(`box-shadow: inset 0 -1px 0 ${this.styles.keybindingLabel.keybindingLabelShadow};`),this.styles.keybindingLabel.keybindingLabelForeground&&l.push(`color: ${this.styles.keybindingLabel.keybindingLabelForeground};`),l.push("}"));const c=l.join(`
`);c!==this.ui.styleSheet.textContent&&(this.ui.styleSheet.textContent=c)}}loadViewState(){try{const e=JSON.parse(this.storageService.get(VIEWSTATE_STORAGE_KEY,-1,"{}"));if(e.top!==void 0||e.left!==void 0)return e}catch{}}saveViewState(e){this.layoutService.activeContainer===this.layoutService.mainContainer&&(e!==void 0?this.storageService.store(VIEWSTATE_STORAGE_KEY,JSON.stringify(e),-1,1):this.storageService.remove(VIEWSTATE_STORAGE_KEY,-1))}},QuickInputController_1=rn,rn.MAX_WIDTH=600,rn);QuickInputController=QuickInputController_1=__decorate$a([__param$a(1,ILayoutService),__param$a(2,IInstantiationService),__param$a(3,IContextKeyService),__param$a(4,IStorageService)],QuickInputController);let QuickInputDragAndDropController=class extends Disposable{constructor(e,t,s,o,r,l,c){super(),this._container=e,this._quickInputContainer=t,this._quickInputDragAreas=s,this._layoutService=r,this.configurationService=c,this.dndViewState=observableValue(this,void 0),this._snapThreshold=20,this._snapLineHorizontalRatio=.25,this._quickInputAlignmentContext=QuickInputAlignmentContextKey.bindTo(l);const d=getWindowControlsStyle(this.configurationService)==="custom";this._controlsOnLeft=d&&platform$1===1,this._controlsOnRight=d&&(platform$1===3||platform$1===2),this._registerLayoutListener(),this.registerMouseListeners(),this.dndViewState.set({...o,done:!0},void 0)}reparentUI(e){this._container=e}layoutContainer(e=this._layoutService.activeContainerDimension){const t=this.dndViewState.get(),s=this._quickInputContainer.getBoundingClientRect();if(t!=null&&t.top&&(t!=null&&t.left)){const o=Math.round(t.left*100)/100,r=e.width,l=s.width,c=o*r-l/2;this._layout(t.top*e.height,c)}}_registerLayoutListener(){this._register(Event$1.filter(this._layoutService.onDidLayoutContainer,e=>e.container===this._container)(e=>this.layoutContainer(e.dimension)))}registerMouseListeners(){const e=this._quickInputContainer;this._register(addDisposableGenericMouseUpListener(e,t=>{const s=new StandardMouseEvent(getWindow(e),t);s.detail===2&&this._quickInputDragAreas.some(({node:o,includeChildren:r})=>r?isAncestor$1(s.target,o):s.target===o)&&this.dndViewState.set({top:void 0,left:void 0,done:!0},void 0)})),this._register(addDisposableGenericMouseDownListener(e,t=>{const s=getWindow(this._layoutService.activeContainer),o=new StandardMouseEvent(s,t);if(!this._quickInputDragAreas.some(({node:f,includeChildren:p})=>p?isAncestor$1(o.target,f):o.target===f))return;const r=this._quickInputContainer.getBoundingClientRect(),l=o.browserEvent.clientX-r.left,c=o.browserEvent.clientY-r.top;let d=!1;const u=addDisposableGenericMouseMoveListener(s,f=>{new StandardMouseEvent(s,f).preventDefault(),d||(d=!0),this._layout(f.clientY-c,f.clientX-l)}),g=addDisposableGenericMouseUpListener(s,f=>{if(d){const p=this.dndViewState.get();this.dndViewState.set({top:p==null?void 0:p.top,left:p==null?void 0:p.left,done:!0},void 0)}u.dispose(),g.dispose()})}))}_layout(e,t){const s=this._getTopSnapValue(),o=this._getCenterYSnapValue(),r=this._getCenterXSnapValue();e=Math.max(0,Math.min(e,this._container.clientHeight-this._quickInputContainer.clientHeight)),e<this._layoutService.activeContainerOffset.top&&(this._controlsOnLeft?t=Math.max(t,80/getZoomFactor(getActiveWindow())):this._controlsOnRight&&(t=Math.min(t,this._container.clientWidth-this._quickInputContainer.clientWidth-140/getZoomFactor(getActiveWindow()))));const l=Math.abs(e-s)<this._snapThreshold;e=l?s:e;const c=Math.abs(e-o)<this._snapThreshold;e=c?o:e;const d=e/this._container.clientHeight;t=Math.max(0,Math.min(t,this._container.clientWidth-this._quickInputContainer.clientWidth));const u=Math.abs(t-r)<this._snapThreshold;t=u?r:t;const g=this._container.clientWidth,f=this._quickInputContainer.clientWidth,m=(t+f/2)/g;if(this.dndViewState.set({top:d,left:m,done:!1},void 0),u){if(l){this._quickInputAlignmentContext.set("top");return}else if(c){this._quickInputAlignmentContext.set("center");return}}this._quickInputAlignmentContext.set(void 0)}_getTopSnapValue(){return this._layoutService.activeContainerOffset.quickPickTop}_getCenterYSnapValue(){return Math.round(this._container.clientHeight*this._snapLineHorizontalRatio)}_getCenterXSnapValue(){return Math.round(this._container.clientWidth/2)-Math.round(this._quickInputContainer.clientWidth/2)}};QuickInputDragAndDropController=__decorate$a([__param$a(4,ILayoutService),__param$a(5,IContextKeyService),__param$a(6,IConfigurationService)],QuickInputDragAndDropController);var __decorate$9=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$9=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let QuickInputService=class extends Themable{get controller(){return this._controller||(this._controller=this._register(this.createController())),this._controller}get hasController(){return!!this._controller}get currentQuickInput(){return this.controller.currentQuickInput}get quickAccess(){return this._quickAccess||(this._quickAccess=this._register(this.instantiationService.createInstance(QuickAccessController))),this._quickAccess}constructor(e,t,s,o,r){super(s),this.instantiationService=e,this.contextKeyService=t,this.layoutService=o,this.configurationService=r,this._onShow=this._register(new Emitter$1),this._onHide=this._register(new Emitter$1),this.contexts=new Map}createController(e=this.layoutService,t){const s={idPrefix:"quickInput_",container:e.activeContainer,ignoreFocusOut:()=>!1,backKeybindingLabel:()=>{},setContextKey:r=>this.setContextKey(r),linkOpenerDelegate:r=>{this.instantiationService.invokeFunction(l=>{l.get(IOpenerService).open(r,{allowCommands:!0,fromUserGesture:!0})})},returnFocus:()=>e.focus(),styles:this.computeStyles(),hoverDelegate:this._register(this.instantiationService.createInstance(QuickInputHoverDelegate))},o=this._register(this.instantiationService.createInstance(QuickInputController,{...s,...t}));return o.layout(e.activeContainerDimension,e.activeContainerOffset.quickPickTop),this._register(e.onDidLayoutActiveContainer(r=>{getWindow(e.activeContainer)===getWindow(o.container)&&o.layout(r,e.activeContainerOffset.quickPickTop)})),this._register(e.onDidChangeActiveContainer(()=>{o.isVisible()||o.layout(e.activeContainerDimension,e.activeContainerOffset.quickPickTop)})),this._register(o.onShow(()=>{this.resetContextKeys(),this._onShow.fire()})),this._register(o.onHide(()=>{this.resetContextKeys(),this._onHide.fire()})),o}setContextKey(e){let t;e&&(t=this.contexts.get(e),t||(t=new RawContextKey(e,!1).bindTo(this.contextKeyService),this.contexts.set(e,t))),!(t&&t.get())&&(this.resetContextKeys(),t==null||t.set(!0))}resetContextKeys(){this.contexts.forEach(e=>{e.get()&&e.reset()})}pick(e,t,s=CancellationToken.None){return this.controller.pick(e,t,s)}input(e={},t=CancellationToken.None){return this.controller.input(e,t)}createQuickPick(e={useSeparators:!1}){return this.controller.createQuickPick(e)}createInputBox(){return this.controller.createInputBox()}toggleHover(){this.hasController&&this.controller.toggleHover()}updateStyles(){this.hasController&&this.controller.applyStyles(this.computeStyles())}computeStyles(){return{widget:{quickInputBackground:asCssVariable(quickInputBackground),quickInputForeground:asCssVariable(quickInputForeground),quickInputTitleBackground:asCssVariable(quickInputTitleBackground),widgetBorder:asCssVariable(widgetBorder),widgetShadow:asCssVariable(widgetShadow)},inputBox:defaultInputBoxStyles,toggle:defaultToggleStyles,countBadge:defaultCountBadgeStyles,button:defaultButtonStyles,progressBar:defaultProgressBarStyles,keybindingLabel:defaultKeybindingLabelStyles,list:getListStyles({listBackground:quickInputBackground,listFocusBackground:quickInputListFocusBackground,listFocusForeground:quickInputListFocusForeground,listInactiveFocusForeground:quickInputListFocusForeground,listInactiveSelectionIconForeground:quickInputListFocusIconForeground,listInactiveFocusBackground:quickInputListFocusBackground,listFocusOutline:activeContrastBorder,listInactiveFocusOutline:activeContrastBorder,treeStickyScrollBackground:quickInputBackground}),pickerGroup:{pickerGroupBorder:asCssVariable(pickerGroupBorder),pickerGroupForeground:asCssVariable(pickerGroupForeground)}}}};QuickInputService=__decorate$9([__param$9(0,IInstantiationService),__param$9(1,IContextKeyService),__param$9(2,IThemeService),__param$9(3,ILayoutService),__param$9(4,IConfigurationService)],QuickInputService);var __decorate$8=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$8=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let EditorScopedQuickInputService=class extends QuickInputService{constructor(e,t,s,o,r,l){super(t,s,o,new EditorScopedLayoutService(e.getContainerDomNode(),r),l),this.host=void 0;const c=QuickInputEditorContribution.get(e);if(c){const d=c.widget;this.host={_serviceBrand:void 0,get mainContainer(){return d.getDomNode()},getContainer(){return d.getDomNode()},whenContainerStylesLoaded(){},get containers(){return[d.getDomNode()]},get activeContainer(){return d.getDomNode()},get mainContainerDimension(){return e.getLayoutInfo()},get activeContainerDimension(){return e.getLayoutInfo()},get onDidLayoutMainContainer(){return e.onDidLayoutChange},get onDidLayoutActiveContainer(){return e.onDidLayoutChange},get onDidLayoutContainer(){return Event$1.map(e.onDidLayoutChange,u=>({container:d.getDomNode(),dimension:u}))},get onDidChangeActiveContainer(){return Event$1.None},get onDidAddContainer(){return Event$1.None},get mainContainerOffset(){return{top:0,quickPickTop:0}},get activeContainerOffset(){return{top:0,quickPickTop:0}},focus:()=>e.focus()}}else this.host=void 0}createController(){return super.createController(this.host)}};EditorScopedQuickInputService=__decorate$8([__param$8(1,IInstantiationService),__param$8(2,IContextKeyService),__param$8(3,IThemeService),__param$8(4,ICodeEditorService),__param$8(5,IConfigurationService)],EditorScopedQuickInputService);let StandaloneQuickInputService=class{get activeService(){const e=this.codeEditorService.getFocusedCodeEditor();if(!e)throw new Error("Quick input service needs a focused editor to work.");let t=this.mapEditorToService.get(e);if(!t){const s=t=this.instantiationService.createInstance(EditorScopedQuickInputService,e);this.mapEditorToService.set(e,t),createSingleCallFunction(e.onDidDispose)(()=>{s.dispose(),this.mapEditorToService.delete(e)})}return t}get currentQuickInput(){return this.activeService.currentQuickInput}get quickAccess(){return this.activeService.quickAccess}constructor(e,t){this.instantiationService=e,this.codeEditorService=t,this.mapEditorToService=new Map}pick(e,t,s=CancellationToken.None){return this.activeService.pick(e,t,s)}input(e,t){return this.activeService.input(e,t)}createQuickPick(e={useSeparators:!1}){return this.activeService.createQuickPick(e)}createInputBox(){return this.activeService.createInputBox()}toggleHover(){return this.activeService.toggleHover()}};StandaloneQuickInputService=__decorate$8([__param$8(0,IInstantiationService),__param$8(1,ICodeEditorService)],StandaloneQuickInputService);const Io=class Io{static get(e){return e.getContribution(Io.ID)}constructor(e){this.editor=e,this.widget=new QuickInputEditorWidget(this.editor)}dispose(){this.widget.dispose()}};Io.ID="editor.controller.quickInput";let QuickInputEditorContribution=Io;const Do=class Do{constructor(e){this.codeEditor=e,this.domNode=document.createElement("div"),this.codeEditor.addOverlayWidget(this)}getId(){return Do.ID}getDomNode(){return this.domNode}getPosition(){return{preference:{top:0,left:0}}}dispose(){this.codeEditor.removeOverlayWidget(this)}};Do.ID="editor.contrib.quickInputWidget";let QuickInputEditorWidget=Do;registerEditorContribution(QuickInputEditorContribution.ID,QuickInputEditorContribution,4);class ParsedTokenThemeRule{constructor(e,t,s,o,r){this._parsedThemeRuleBrand=void 0,this.token=e,this.index=t,this.fontStyle=s,this.foreground=o,this.background=r}}function parseTokenTheme(a){if(!a||!Array.isArray(a))return[];const e=[];let t=0;for(let s=0,o=a.length;s<o;s++){const r=a[s];let l=-1;if(typeof r.fontStyle=="string"){l=0;const u=r.fontStyle.split(" ");for(let g=0,f=u.length;g<f;g++)switch(u[g]){case"italic":l=l|1;break;case"bold":l=l|2;break;case"underline":l=l|4;break;case"strikethrough":l=l|8;break}}let c=null;typeof r.foreground=="string"&&(c=r.foreground);let d=null;typeof r.background=="string"&&(d=r.background),e[t++]=new ParsedTokenThemeRule(r.token||"",s,l,c,d)}return e}function resolveParsedTokenThemeRules(a,e){a.sort((g,f)=>{const p=strcmp(g.token,f.token);return p!==0?p:g.index-f.index});let t=0,s="000000",o="ffffff";for(;a.length>=1&&a[0].token==="";){const g=a.shift();g.fontStyle!==-1&&(t=g.fontStyle),g.foreground!==null&&(s=g.foreground),g.background!==null&&(o=g.background)}const r=new ColorMap;for(const g of e)r.getId(g);const l=r.getId(s),c=r.getId(o),d=new ThemeTrieElementRule(t,l,c),u=new ThemeTrieElement(d);for(let g=0,f=a.length;g<f;g++){const p=a[g];u.insert(p.token,p.fontStyle,r.getId(p.foreground),r.getId(p.background))}return new TokenTheme(r,u)}const colorRegExp=/^#?([0-9A-Fa-f]{6})([0-9A-Fa-f]{2})?$/;class ColorMap{constructor(){this._lastColorId=0,this._id2color=[],this._color2id=new Map}getId(e){if(e===null)return 0;const t=e.match(colorRegExp);if(!t)throw new Error("Illegal value for token color: "+e);e=t[1].toUpperCase();let s=this._color2id.get(e);return s||(s=++this._lastColorId,this._color2id.set(e,s),this._id2color[s]=Color.fromHex("#"+e),s)}getColorMap(){return this._id2color.slice(0)}}class TokenTheme{static createFromRawTokenTheme(e,t){return this.createFromParsedTokenTheme(parseTokenTheme(e),t)}static createFromParsedTokenTheme(e,t){return resolveParsedTokenThemeRules(e,t)}constructor(e,t){this._colorMap=e,this._root=t,this._cache=new Map}getColorMap(){return this._colorMap.getColorMap()}_match(e){return this._root.match(e)}match(e,t){let s=this._cache.get(t);if(typeof s>"u"){const o=this._match(t),r=toStandardTokenType(t);s=(o.metadata|r<<8)>>>0,this._cache.set(t,s)}return(s|e<<0)>>>0}}const STANDARD_TOKEN_TYPE_REGEXP=/\b(comment|string|regex|regexp)\b/;function toStandardTokenType(a){const e=a.match(STANDARD_TOKEN_TYPE_REGEXP);if(!e)return 0;switch(e[1]){case"comment":return 1;case"string":return 2;case"regex":return 3;case"regexp":return 3}throw new Error("Unexpected match for standard token type!")}function strcmp(a,e){return a<e?-1:a>e?1:0}class ThemeTrieElementRule{constructor(e,t,s){this._themeTrieElementRuleBrand=void 0,this._fontStyle=e,this._foreground=t,this._background=s,this.metadata=(this._fontStyle<<11|this._foreground<<15|this._background<<24)>>>0}clone(){return new ThemeTrieElementRule(this._fontStyle,this._foreground,this._background)}acceptOverwrite(e,t,s){e!==-1&&(this._fontStyle=e),t!==0&&(this._foreground=t),s!==0&&(this._background=s),this.metadata=(this._fontStyle<<11|this._foreground<<15|this._background<<24)>>>0}}class ThemeTrieElement{constructor(e){this._themeTrieElementBrand=void 0,this._mainRule=e,this._children=new Map}match(e){if(e==="")return this._mainRule;const t=e.indexOf(".");let s,o;t===-1?(s=e,o=""):(s=e.substring(0,t),o=e.substring(t+1));const r=this._children.get(s);return typeof r<"u"?r.match(o):this._mainRule}insert(e,t,s,o){if(e===""){this._mainRule.acceptOverwrite(t,s,o);return}const r=e.indexOf(".");let l,c;r===-1?(l=e,c=""):(l=e.substring(0,r),c=e.substring(r+1));let d=this._children.get(l);typeof d>"u"&&(d=new ThemeTrieElement(this._mainRule.clone()),this._children.set(l,d)),d.insert(c,t,s,o)}}function generateTokensCSSForColorMap(a){const e=[];for(let t=1,s=a.length;t<s;t++){const o=a[t];e[t]=`.mtk${t} { color: ${o}; }`}return e.push(".mtki { font-style: italic; }"),e.push(".mtkb { font-weight: bold; }"),e.push(".mtku { text-decoration: underline; text-underline-position: under; }"),e.push(".mtks { text-decoration: line-through; }"),e.push(".mtks.mtku { text-decoration: underline line-through; text-underline-position: under; }"),e.join(`
`)}const vs={base:"vs",inherit:!1,rules:[{token:"",foreground:"000000",background:"fffffe"},{token:"invalid",foreground:"cd3131"},{token:"emphasis",fontStyle:"italic"},{token:"strong",fontStyle:"bold"},{token:"variable",foreground:"001188"},{token:"variable.predefined",foreground:"4864AA"},{token:"constant",foreground:"dd0000"},{token:"comment",foreground:"008000"},{token:"number",foreground:"098658"},{token:"number.hex",foreground:"3030c0"},{token:"regexp",foreground:"800000"},{token:"annotation",foreground:"808080"},{token:"type",foreground:"008080"},{token:"delimiter",foreground:"000000"},{token:"delimiter.html",foreground:"383838"},{token:"delimiter.xml",foreground:"0000FF"},{token:"tag",foreground:"800000"},{token:"tag.id.pug",foreground:"4F76AC"},{token:"tag.class.pug",foreground:"4F76AC"},{token:"meta.scss",foreground:"800000"},{token:"metatag",foreground:"e00000"},{token:"metatag.content.html",foreground:"FF0000"},{token:"metatag.html",foreground:"808080"},{token:"metatag.xml",foreground:"808080"},{token:"metatag.php",fontStyle:"bold"},{token:"key",foreground:"863B00"},{token:"string.key.json",foreground:"A31515"},{token:"string.value.json",foreground:"0451A5"},{token:"attribute.name",foreground:"FF0000"},{token:"attribute.value",foreground:"0451A5"},{token:"attribute.value.number",foreground:"098658"},{token:"attribute.value.unit",foreground:"098658"},{token:"attribute.value.html",foreground:"0000FF"},{token:"attribute.value.xml",foreground:"0000FF"},{token:"string",foreground:"A31515"},{token:"string.html",foreground:"0000FF"},{token:"string.sql",foreground:"FF0000"},{token:"string.yaml",foreground:"0451A5"},{token:"keyword",foreground:"0000FF"},{token:"keyword.json",foreground:"0451A5"},{token:"keyword.flow",foreground:"AF00DB"},{token:"keyword.flow.scss",foreground:"0000FF"},{token:"operator.scss",foreground:"666666"},{token:"operator.sql",foreground:"778899"},{token:"operator.swift",foreground:"666666"},{token:"predefined.sql",foreground:"C700C7"}],colors:{[editorBackground]:"#FFFFFE",[editorForeground]:"#000000",[editorInactiveSelection]:"#E5EBF1",[editorIndentGuide1]:"#D3D3D3",[editorActiveIndentGuide1]:"#939393",[editorSelectionHighlight]:"#ADD6FF4D"}},vs_dark={base:"vs-dark",inherit:!1,rules:[{token:"",foreground:"D4D4D4",background:"1E1E1E"},{token:"invalid",foreground:"f44747"},{token:"emphasis",fontStyle:"italic"},{token:"strong",fontStyle:"bold"},{token:"variable",foreground:"74B0DF"},{token:"variable.predefined",foreground:"4864AA"},{token:"variable.parameter",foreground:"9CDCFE"},{token:"constant",foreground:"569CD6"},{token:"comment",foreground:"608B4E"},{token:"number",foreground:"B5CEA8"},{token:"number.hex",foreground:"5BB498"},{token:"regexp",foreground:"B46695"},{token:"annotation",foreground:"cc6666"},{token:"type",foreground:"3DC9B0"},{token:"delimiter",foreground:"DCDCDC"},{token:"delimiter.html",foreground:"808080"},{token:"delimiter.xml",foreground:"808080"},{token:"tag",foreground:"569CD6"},{token:"tag.id.pug",foreground:"4F76AC"},{token:"tag.class.pug",foreground:"4F76AC"},{token:"meta.scss",foreground:"A79873"},{token:"meta.tag",foreground:"CE9178"},{token:"metatag",foreground:"DD6A6F"},{token:"metatag.content.html",foreground:"9CDCFE"},{token:"metatag.html",foreground:"569CD6"},{token:"metatag.xml",foreground:"569CD6"},{token:"metatag.php",fontStyle:"bold"},{token:"key",foreground:"9CDCFE"},{token:"string.key.json",foreground:"9CDCFE"},{token:"string.value.json",foreground:"CE9178"},{token:"attribute.name",foreground:"9CDCFE"},{token:"attribute.value",foreground:"CE9178"},{token:"attribute.value.number.css",foreground:"B5CEA8"},{token:"attribute.value.unit.css",foreground:"B5CEA8"},{token:"attribute.value.hex.css",foreground:"D4D4D4"},{token:"string",foreground:"CE9178"},{token:"string.sql",foreground:"FF0000"},{token:"keyword",foreground:"569CD6"},{token:"keyword.flow",foreground:"C586C0"},{token:"keyword.json",foreground:"CE9178"},{token:"keyword.flow.scss",foreground:"569CD6"},{token:"operator.scss",foreground:"909090"},{token:"operator.sql",foreground:"778899"},{token:"operator.swift",foreground:"909090"},{token:"predefined.sql",foreground:"FF00FF"}],colors:{[editorBackground]:"#1E1E1E",[editorForeground]:"#D4D4D4",[editorInactiveSelection]:"#3A3D41",[editorIndentGuide1]:"#404040",[editorActiveIndentGuide1]:"#707070",[editorSelectionHighlight]:"#ADD6FF26"}},hc_black={base:"hc-black",inherit:!1,rules:[{token:"",foreground:"FFFFFF",background:"000000"},{token:"invalid",foreground:"f44747"},{token:"emphasis",fontStyle:"italic"},{token:"strong",fontStyle:"bold"},{token:"variable",foreground:"1AEBFF"},{token:"variable.parameter",foreground:"9CDCFE"},{token:"constant",foreground:"569CD6"},{token:"comment",foreground:"608B4E"},{token:"number",foreground:"FFFFFF"},{token:"regexp",foreground:"C0C0C0"},{token:"annotation",foreground:"569CD6"},{token:"type",foreground:"3DC9B0"},{token:"delimiter",foreground:"FFFF00"},{token:"delimiter.html",foreground:"FFFF00"},{token:"tag",foreground:"569CD6"},{token:"tag.id.pug",foreground:"4F76AC"},{token:"tag.class.pug",foreground:"4F76AC"},{token:"meta",foreground:"D4D4D4"},{token:"meta.tag",foreground:"CE9178"},{token:"metatag",foreground:"569CD6"},{token:"metatag.content.html",foreground:"1AEBFF"},{token:"metatag.html",foreground:"569CD6"},{token:"metatag.xml",foreground:"569CD6"},{token:"metatag.php",fontStyle:"bold"},{token:"key",foreground:"9CDCFE"},{token:"string.key",foreground:"9CDCFE"},{token:"string.value",foreground:"CE9178"},{token:"attribute.name",foreground:"569CD6"},{token:"attribute.value",foreground:"3FF23F"},{token:"string",foreground:"CE9178"},{token:"string.sql",foreground:"FF0000"},{token:"keyword",foreground:"569CD6"},{token:"keyword.flow",foreground:"C586C0"},{token:"operator.sql",foreground:"778899"},{token:"operator.swift",foreground:"909090"},{token:"predefined.sql",foreground:"FF00FF"}],colors:{[editorBackground]:"#000000",[editorForeground]:"#FFFFFF",[editorIndentGuide1]:"#FFFFFF",[editorActiveIndentGuide1]:"#FFFFFF"}},hc_light={base:"hc-light",inherit:!1,rules:[{token:"",foreground:"292929",background:"FFFFFF"},{token:"invalid",foreground:"B5200D"},{token:"emphasis",fontStyle:"italic"},{token:"strong",fontStyle:"bold"},{token:"variable",foreground:"264F70"},{token:"variable.predefined",foreground:"4864AA"},{token:"constant",foreground:"dd0000"},{token:"comment",foreground:"008000"},{token:"number",foreground:"098658"},{token:"number.hex",foreground:"3030c0"},{token:"regexp",foreground:"800000"},{token:"annotation",foreground:"808080"},{token:"type",foreground:"008080"},{token:"delimiter",foreground:"000000"},{token:"delimiter.html",foreground:"383838"},{token:"tag",foreground:"800000"},{token:"tag.id.pug",foreground:"4F76AC"},{token:"tag.class.pug",foreground:"4F76AC"},{token:"meta.scss",foreground:"800000"},{token:"metatag",foreground:"e00000"},{token:"metatag.content.html",foreground:"B5200D"},{token:"metatag.html",foreground:"808080"},{token:"metatag.xml",foreground:"808080"},{token:"metatag.php",fontStyle:"bold"},{token:"key",foreground:"863B00"},{token:"string.key.json",foreground:"A31515"},{token:"string.value.json",foreground:"0451A5"},{token:"attribute.name",foreground:"264F78"},{token:"attribute.value",foreground:"0451A5"},{token:"string",foreground:"A31515"},{token:"string.sql",foreground:"B5200D"},{token:"keyword",foreground:"0000FF"},{token:"keyword.flow",foreground:"AF00DB"},{token:"operator.sql",foreground:"778899"},{token:"operator.swift",foreground:"666666"},{token:"predefined.sql",foreground:"C700C7"}],colors:{[editorBackground]:"#FFFFFF",[editorForeground]:"#292929",[editorIndentGuide1]:"#292929",[editorActiveIndentGuide1]:"#292929"}};function getIconsStyleSheet(a){const e=new DisposableStore,t=e.add(new Emitter$1),s=getIconRegistry();return e.add(s.onDidChange(()=>t.fire())),a&&e.add(a.onDidProductIconThemeChange(()=>t.fire())),{dispose:()=>e.dispose(),onDidChange:t.event,getCSS(){const o=a?a.getProductIconTheme():new UnthemedProductIconTheme,r={},l=new Builder,c=new Builder;for(const d of s.getIcons()){const u=o.getIcon(d);if(!u)continue;const g=u.font,f=inline$1`--vscode-icon-${className(d.id)}-font-family`,p=inline$1`--vscode-icon-${className(d.id)}-content`;g?(r[g.id]=g.definition,c.push(inline$1`${f}: ${stringValue(g.id)};`,inline$1`${p}: ${stringValue(u.fontCharacter)};`),l.push(inline$1`.codicon-${className(d.id)}:before { content: ${stringValue(u.fontCharacter)}; font-family: ${stringValue(g.id)}; }`)):(c.push(inline$1`${p}: ${stringValue(u.fontCharacter)}; ${f}: 'codicon';`),l.push(inline$1`.codicon-${className(d.id)}:before { content: ${stringValue(u.fontCharacter)}; }`))}for(const d in r){const u=r[d],g=u.weight?inline$1`font-weight: ${identValue(u.weight)};`:inline$1``,f=u.style?inline$1`font-style: ${identValue(u.style)};`:inline$1``,p=new Builder;for(const m of u.src)p.push(inline$1`${asCSSUrl(m.location)} format(${stringValue(m.format)})`);l.push(inline$1`@font-face { src: ${p.join(", ")}; font-family: ${stringValue(d)};${g}${f} font-display: block; }`)}return l.push(inline$1`:root { ${c.join(" ")} }`),l.join(`
`)}}}class UnthemedProductIconTheme{getIcon(e){const t=getIconRegistry();let s=e.defaults;for(;ThemeIcon.isThemeIcon(s);){const o=t.getIcon(s.id);if(!o)return;s=o.defaults}return s}}const VS_LIGHT_THEME_NAME="vs",VS_DARK_THEME_NAME="vs-dark",HC_BLACK_THEME_NAME="hc-black",HC_LIGHT_THEME_NAME="hc-light",colorRegistry=Registry.as(Extensions$4.ColorContribution),themingRegistry=Registry.as(Extensions$3.ThemingContribution);class StandaloneTheme{constructor(e,t){this.semanticHighlighting=!1,this.themeData=t;const s=t.base;e.length>0?(isBuiltinTheme(e)?this.id=e:this.id=s+" "+e,this.themeName=e):(this.id=s,this.themeName=s),this.colors=null,this.defaultColors=Object.create(null),this._tokenTheme=null}get base(){return this.themeData.base}notifyBaseUpdated(){this.themeData.inherit&&(this.colors=null,this._tokenTheme=null)}getColors(){if(!this.colors){const e=new Map;for(const t in this.themeData.colors)e.set(t,Color.fromHex(this.themeData.colors[t]));if(this.themeData.inherit){const t=getBuiltinRules(this.themeData.base);for(const s in t.colors)e.has(s)||e.set(s,Color.fromHex(t.colors[s]))}this.colors=e}return this.colors}getColor(e,t){const s=this.getColors().get(e);if(s)return s;if(t!==!1)return this.getDefault(e)}getDefault(e){let t=this.defaultColors[e];return t||(t=colorRegistry.resolveDefaultColor(e,this),this.defaultColors[e]=t,t)}defines(e){return this.getColors().has(e)}get type(){switch(this.base){case VS_LIGHT_THEME_NAME:return ColorScheme.LIGHT;case HC_BLACK_THEME_NAME:return ColorScheme.HIGH_CONTRAST_DARK;case HC_LIGHT_THEME_NAME:return ColorScheme.HIGH_CONTRAST_LIGHT;default:return ColorScheme.DARK}}get tokenTheme(){if(!this._tokenTheme){let e=[],t=[];if(this.themeData.inherit){const r=getBuiltinRules(this.themeData.base);e=r.rules,r.encodedTokensColors&&(t=r.encodedTokensColors)}const s=this.themeData.colors["editor.foreground"],o=this.themeData.colors["editor.background"];if(s||o){const r={token:""};s&&(r.foreground=s),o&&(r.background=o),e.push(r)}e=e.concat(this.themeData.rules),this.themeData.encodedTokensColors&&(t=this.themeData.encodedTokensColors),this._tokenTheme=TokenTheme.createFromRawTokenTheme(e,t)}return this._tokenTheme}getTokenStyleMetadata(e,t,s){const r=this.tokenTheme._match([e].concat(t).join(".")).metadata,l=TokenMetadata.getForeground(r),c=TokenMetadata.getFontStyle(r);return{foreground:l,italic:!!(c&1),bold:!!(c&2),underline:!!(c&4),strikethrough:!!(c&8)}}get tokenColorMap(){return[]}}function isBuiltinTheme(a){return a===VS_LIGHT_THEME_NAME||a===VS_DARK_THEME_NAME||a===HC_BLACK_THEME_NAME||a===HC_LIGHT_THEME_NAME}function getBuiltinRules(a){switch(a){case VS_LIGHT_THEME_NAME:return vs;case VS_DARK_THEME_NAME:return vs_dark;case HC_BLACK_THEME_NAME:return hc_black;case HC_LIGHT_THEME_NAME:return hc_light}}function newBuiltInTheme(a){const e=getBuiltinRules(a);return new StandaloneTheme(a,e)}class StandaloneThemeService extends Disposable{constructor(){super(),this._onColorThemeChange=this._register(new Emitter$1),this.onDidColorThemeChange=this._onColorThemeChange.event,this._onProductIconThemeChange=this._register(new Emitter$1),this.onDidProductIconThemeChange=this._onProductIconThemeChange.event,this._environment=Object.create(null),this._builtInProductIconTheme=new UnthemedProductIconTheme,this._autoDetectHighContrast=!0,this._knownThemes=new Map,this._knownThemes.set(VS_LIGHT_THEME_NAME,newBuiltInTheme(VS_LIGHT_THEME_NAME)),this._knownThemes.set(VS_DARK_THEME_NAME,newBuiltInTheme(VS_DARK_THEME_NAME)),this._knownThemes.set(HC_BLACK_THEME_NAME,newBuiltInTheme(HC_BLACK_THEME_NAME)),this._knownThemes.set(HC_LIGHT_THEME_NAME,newBuiltInTheme(HC_LIGHT_THEME_NAME));const e=this._register(getIconsStyleSheet(this));this._codiconCSS=e.getCSS(),this._themeCSS="",this._allCSS=`${this._codiconCSS}
${this._themeCSS}`,this._globalStyleElement=null,this._styleElements=[],this._colorMapOverride=null,this.setTheme(VS_LIGHT_THEME_NAME),this._onOSSchemeChanged(),this._register(e.onDidChange(()=>{this._codiconCSS=e.getCSS(),this._updateCSS()})),addMatchMediaChangeListener(mainWindow,"(forced-colors: active)",()=>{this._onOSSchemeChanged()})}registerEditorContainer(e){return isInShadowDOM(e)?this._registerShadowDomContainer(e):this._registerRegularEditorContainer()}_registerRegularEditorContainer(){return this._globalStyleElement||(this._globalStyleElement=createStyleSheet(void 0,e=>{e.className="monaco-colors",e.textContent=this._allCSS}),this._styleElements.push(this._globalStyleElement)),Disposable.None}_registerShadowDomContainer(e){const t=createStyleSheet(e,s=>{s.className="monaco-colors",s.textContent=this._allCSS});return this._styleElements.push(t),{dispose:()=>{for(let s=0;s<this._styleElements.length;s++)if(this._styleElements[s]===t){this._styleElements.splice(s,1);return}}}}defineTheme(e,t){if(!/^[a-z0-9\-]+$/i.test(e))throw new Error("Illegal theme name!");if(!isBuiltinTheme(t.base)&&!isBuiltinTheme(e))throw new Error("Illegal theme base!");this._knownThemes.set(e,new StandaloneTheme(e,t)),isBuiltinTheme(e)&&this._knownThemes.forEach(s=>{s.base===e&&s.notifyBaseUpdated()}),this._theme.themeName===e&&this.setTheme(e)}getColorTheme(){return this._theme}setColorMapOverride(e){this._colorMapOverride=e,this._updateThemeOrColorMap()}setTheme(e){let t;this._knownThemes.has(e)?t=this._knownThemes.get(e):t=this._knownThemes.get(VS_LIGHT_THEME_NAME),this._updateActualTheme(t)}_updateActualTheme(e){!e||this._theme===e||(this._theme=e,this._updateThemeOrColorMap())}_onOSSchemeChanged(){if(this._autoDetectHighContrast){const e=mainWindow.matchMedia("(forced-colors: active)").matches;if(e!==isHighContrast(this._theme.type)){let t;isDark(this._theme.type)?t=e?HC_BLACK_THEME_NAME:VS_DARK_THEME_NAME:t=e?HC_LIGHT_THEME_NAME:VS_LIGHT_THEME_NAME,this._updateActualTheme(this._knownThemes.get(t))}}}setAutoDetectHighContrast(e){this._autoDetectHighContrast=e,this._onOSSchemeChanged()}_updateThemeOrColorMap(){const e=[],t={},s={addRule:l=>{t[l]||(e.push(l),t[l]=!0)}};themingRegistry.getThemingParticipants().forEach(l=>l(this._theme,s,this._environment));const o=[];for(const l of colorRegistry.getColors()){const c=this._theme.getColor(l.id,!0);c&&o.push(`${asCssVariableName(l.id)}: ${c.toString()};`)}s.addRule(`.monaco-editor, .monaco-diff-editor, .monaco-component { ${o.join(`
`)} }`);const r=this._colorMapOverride||this._theme.tokenTheme.getColorMap();s.addRule(generateTokensCSSForColorMap(r)),s.addRule(".monaco-editor, .monaco-diff-editor, .monaco-component { forced-color-adjust: none; }"),this._themeCSS=e.join(`
`),this._updateCSS(),TokenizationRegistry.setColorMap(r),this._onColorThemeChange.fire(this._theme)}_updateCSS(){this._allCSS=`${this._codiconCSS}
${this._themeCSS}`,this._styleElements.forEach(e=>e.textContent=this._allCSS)}getFileIconTheme(){return{hasFileIcons:!1,hasFolderIcons:!1,hidesExplorerArrows:!1}}getProductIconTheme(){return this._builtInProductIconTheme}}const IStandaloneThemeService=createDecorator("themeService");var __decorate$7=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$7=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let AccessibilityService=class extends Disposable{constructor(e,t,s){super(),this._contextKeyService=e,this._layoutService=t,this._configurationService=s,this._accessibilitySupport=0,this._onDidChangeScreenReaderOptimized=new Emitter$1,this._onDidChangeReducedMotion=new Emitter$1,this._onDidChangeLinkUnderline=new Emitter$1,this._accessibilityModeEnabledContext=CONTEXT_ACCESSIBILITY_MODE_ENABLED.bindTo(this._contextKeyService);const o=()=>this._accessibilityModeEnabledContext.set(this.isScreenReaderOptimized());this._register(this._configurationService.onDidChangeConfiguration(l=>{l.affectsConfiguration("editor.accessibilitySupport")&&(o(),this._onDidChangeScreenReaderOptimized.fire()),l.affectsConfiguration("workbench.reduceMotion")&&(this._configMotionReduced=this._configurationService.getValue("workbench.reduceMotion"),this._onDidChangeReducedMotion.fire())})),o(),this._register(this.onDidChangeScreenReaderOptimized(()=>o()));const r=mainWindow.matchMedia("(prefers-reduced-motion: reduce)");this._systemMotionReduced=r.matches,this._configMotionReduced=this._configurationService.getValue("workbench.reduceMotion"),this._linkUnderlinesEnabled=this._configurationService.getValue("accessibility.underlineLinks"),this.initReducedMotionListeners(r),this.initLinkUnderlineListeners()}initReducedMotionListeners(e){this._register(addDisposableListener(e,"change",()=>{this._systemMotionReduced=e.matches,this._configMotionReduced==="auto"&&this._onDidChangeReducedMotion.fire()}));const t=()=>{const s=this.isMotionReduced();this._layoutService.mainContainer.classList.toggle("reduce-motion",s),this._layoutService.mainContainer.classList.toggle("enable-motion",!s)};t(),this._register(this.onDidChangeReducedMotion(()=>t()))}initLinkUnderlineListeners(){this._register(this._configurationService.onDidChangeConfiguration(t=>{if(t.affectsConfiguration("accessibility.underlineLinks")){const s=this._configurationService.getValue("accessibility.underlineLinks");this._linkUnderlinesEnabled=s,this._onDidChangeLinkUnderline.fire()}}));const e=()=>{const t=this._linkUnderlinesEnabled;this._layoutService.mainContainer.classList.toggle("underline-links",t)};e(),this._register(this.onDidChangeLinkUnderlines(()=>e()))}onDidChangeLinkUnderlines(e){return this._onDidChangeLinkUnderline.event(e)}get onDidChangeScreenReaderOptimized(){return this._onDidChangeScreenReaderOptimized.event}isScreenReaderOptimized(){const e=this._configurationService.getValue("editor.accessibilitySupport");return e==="on"||e==="auto"&&this._accessibilitySupport===2}get onDidChangeReducedMotion(){return this._onDidChangeReducedMotion.event}isMotionReduced(){const e=this._configMotionReduced;return e==="on"||e==="auto"&&this._systemMotionReduced}getAccessibilitySupport(){return this._accessibilitySupport}};AccessibilityService=__decorate$7([__param$7(0,IContextKeyService),__param$7(1,ILayoutService),__param$7(2,IConfigurationService)],AccessibilityService);var __decorate$6=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$6=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}},BrowserClipboardService_1;const vscodeResourcesMime="application/vnd.code.resources";var an;let BrowserClipboardService=(an=class extends Disposable{constructor(e,t){super(),this.layoutService=e,this.logService=t,this.mapTextToType=new Map,this.findText="",this.resources=[],this.resourcesStateHash=void 0,(isSafari$1||isWebkitWebView)&&this.installWebKitWriteTextWorkaround(),this._register(Event$1.runAndSubscribe(onDidRegisterWindow,({window:s,disposables:o})=>{o.add(addDisposableListener(s.document,"copy",()=>this.clearResourcesState()))},{window:mainWindow,disposables:this._store}))}triggerPaste(){this.logService.trace("BrowserClipboardService#triggerPaste")}installWebKitWriteTextWorkaround(){const e=()=>{const t=new DeferredPromise;this.webKitPendingClipboardWritePromise&&!this.webKitPendingClipboardWritePromise.isSettled&&this.webKitPendingClipboardWritePromise.cancel(),this.webKitPendingClipboardWritePromise=t,getActiveWindow().navigator.clipboard.write([new ClipboardItem({"text/plain":t.p})]).catch(async s=>{(!(s instanceof Error)||s.name!=="NotAllowedError"||!t.isRejected)&&this.logService.error(s)})};this._register(Event$1.runAndSubscribe(this.layoutService.onDidAddContainer,({container:t,disposables:s})=>{s.add(addDisposableListener(t,"click",e)),s.add(addDisposableListener(t,"keydown",e))},{container:this.layoutService.mainContainer,disposables:this._store}))}async writeText(e,t){if(this.logService.trace("BrowserClipboardService#writeText called with type:",t," text.length:",e.length),this.clearResourcesState(),t){this.mapTextToType.set(t,e),this.logService.trace("BrowserClipboardService#writeText");return}if(this.webKitPendingClipboardWritePromise)return this.webKitPendingClipboardWritePromise.complete(e);try{return this.logService.trace("before navigator.clipboard.writeText"),await getActiveWindow().navigator.clipboard.writeText(e)}catch(s){console.error(s)}this.fallbackWriteText(e)}fallbackWriteText(e){this.logService.trace("BrowserClipboardService#fallbackWriteText");const t=getActiveDocument(),s=t.activeElement,o=t.body.appendChild($$l("textarea",{"aria-hidden":!0}));o.style.height="1px",o.style.width="1px",o.style.position="absolute",o.value=e,o.focus(),o.select(),t.execCommand("copy"),isHTMLElement(s)&&s.focus(),o.remove()}async readText(e){if(this.logService.trace("BrowserClipboardService#readText called with type:",e),e){const t=this.mapTextToType.get(e)||"";return this.logService.trace("BrowserClipboardService#readText text.length:",t.length),t}try{const t=await getActiveWindow().navigator.clipboard.readText();return this.logService.trace("BrowserClipboardService#readText text.length:",t.length),t}catch(t){console.error(t)}return""}async readFindText(){return this.findText}async writeFindText(e){this.findText=e}async readResources(){try{const t=await getActiveWindow().navigator.clipboard.read();for(const s of t)if(s.types.includes(`web ${vscodeResourcesMime}`)){const o=await s.getType(`web ${vscodeResourcesMime}`);return JSON.parse(await o.text()).map(l=>URI.from(l))}}catch{}const e=await this.computeResourcesStateHash();return this.resourcesStateHash!==e&&this.clearResourcesState(),this.resources}async computeResourcesStateHash(){if(this.resources.length===0)return;const e=await this.readText();return hash(e.substring(0,BrowserClipboardService_1.MAX_RESOURCE_STATE_SOURCE_LENGTH))}clearInternalState(){this.clearResourcesState()}clearResourcesState(){this.resources=[],this.resourcesStateHash=void 0}},BrowserClipboardService_1=an,an.MAX_RESOURCE_STATE_SOURCE_LENGTH=1e3,an);BrowserClipboardService=BrowserClipboardService_1=__decorate$6([__param$6(0,ILayoutService),__param$6(1,ILogService)],BrowserClipboardService);var __decorate$5=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$5=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};const KEYBINDING_CONTEXT_ATTR="data-keybinding-context";class Context{constructor(e,t){this._id=e,this._parent=t,this._value=Object.create(null),this._value._contextId=e}get value(){return{...this._value}}setValue(e,t){return this._value[e]!==t?(this._value[e]=t,!0):!1}removeValue(e){return e in this._value?(delete this._value[e],!0):!1}getValue(e){const t=this._value[e];return typeof t>"u"&&this._parent?this._parent.getValue(e):t}}const To=class To extends Context{constructor(){super(-1,null)}setValue(e,t){return!1}removeValue(e){return!1}getValue(e){}};To.INSTANCE=new To;let NullContext=To;const xn=class xn extends Context{constructor(e,t,s){super(e,null),this._configurationService=t,this._values=TernarySearchTree.forConfigKeys(),this._listener=this._configurationService.onDidChangeConfiguration(o=>{if(o.source===7){const r=Array.from(this._values,([l])=>l);this._values.clear(),s.fire(new ArrayContextKeyChangeEvent(r))}else{const r=[];for(const l of o.affectedKeys){const c=`config.${l}`,d=this._values.findSuperstr(c);d!==void 0&&(r.push(...Iterable.map(d,([u])=>u)),this._values.deleteSuperstr(c)),this._values.has(c)&&(r.push(c),this._values.delete(c))}s.fire(new ArrayContextKeyChangeEvent(r))}})}dispose(){this._listener.dispose()}getValue(e){if(e.indexOf(xn._keyPrefix)!==0)return super.getValue(e);if(this._values.has(e))return this._values.get(e);const t=e.substr(xn._keyPrefix.length),s=this._configurationService.getValue(t);let o;switch(typeof s){case"number":case"boolean":case"string":o=s;break;default:Array.isArray(s)?o=JSON.stringify(s):o=s}return this._values.set(e,o),o}setValue(e,t){return super.setValue(e,t)}removeValue(e){return super.removeValue(e)}};xn._keyPrefix="config.";let ConfigAwareContextValuesContainer=xn;class ContextKey{constructor(e,t,s){this._service=e,this._key=t,this._defaultValue=s,this.reset()}set(e){this._service.setContext(this._key,e)}reset(){typeof this._defaultValue>"u"?this._service.removeContext(this._key):this._service.setContext(this._key,this._defaultValue)}get(){return this._service.getContextKeyValue(this._key)}}class SimpleContextKeyChangeEvent{constructor(e){this.key=e}affectsSome(e){return e.has(this.key)}allKeysContainedIn(e){return this.affectsSome(e)}}class ArrayContextKeyChangeEvent{constructor(e){this.keys=e}affectsSome(e){for(const t of this.keys)if(e.has(t))return!0;return!1}allKeysContainedIn(e){return this.keys.every(t=>e.has(t))}}class CompositeContextKeyChangeEvent{constructor(e){this.events=e}affectsSome(e){for(const t of this.events)if(t.affectsSome(e))return!0;return!1}allKeysContainedIn(e){return this.events.every(t=>t.allKeysContainedIn(e))}}function allEventKeysInContext(a,e){return a.allKeysContainedIn(new Set(Object.keys(e)))}class AbstractContextKeyService extends Disposable{get onDidChangeContext(){return this._onDidChangeContext.event}constructor(e){super(),this._onDidChangeContext=this._register(new PauseableEmitter({merge:t=>new CompositeContextKeyChangeEvent(t)})),this._isDisposed=!1,this._myContextId=e}createKey(e,t){if(this._isDisposed)throw new Error("AbstractContextKeyService has been disposed");return new ContextKey(this,e,t)}bufferChangeEvents(e){this._onDidChangeContext.pause();try{e()}finally{this._onDidChangeContext.resume()}}createScoped(e){if(this._isDisposed)throw new Error("AbstractContextKeyService has been disposed");return new ScopedContextKeyService(this,e)}contextMatchesRules(e){if(this._isDisposed)throw new Error("AbstractContextKeyService has been disposed");const t=this.getContextValuesContainer(this._myContextId);return e?e.evaluate(t):!0}getContextKeyValue(e){if(!this._isDisposed)return this.getContextValuesContainer(this._myContextId).getValue(e)}setContext(e,t){if(this._isDisposed)return;const s=this.getContextValuesContainer(this._myContextId);s&&s.setValue(e,t)&&this._onDidChangeContext.fire(new SimpleContextKeyChangeEvent(e))}removeContext(e){this._isDisposed||this.getContextValuesContainer(this._myContextId).removeValue(e)&&this._onDidChangeContext.fire(new SimpleContextKeyChangeEvent(e))}getContext(e){return this._isDisposed?NullContext.INSTANCE:this.getContextValuesContainer(findContextAttr(e))}dispose(){super.dispose(),this._isDisposed=!0}}let ContextKeyService=class extends AbstractContextKeyService{constructor(e){super(0),this._contexts=new Map,this._lastContextId=0,this.inputFocusedContext=InputFocusedContext.bindTo(this);const t=this._register(new ConfigAwareContextValuesContainer(this._myContextId,e,this._onDidChangeContext));this._contexts.set(this._myContextId,t),this._register(Event$1.runAndSubscribe(onDidRegisterWindow,({window:s,disposables:o})=>{const r=o.add(new MutableDisposable);o.add(addDisposableListener(s,EventType$1.FOCUS_IN,()=>{r.value=new DisposableStore,this.updateInputContextKeys(s.document,r.value)},!0))},{window:mainWindow,disposables:this._store}))}updateInputContextKeys(e,t){function s(){return!!e.activeElement&&isEditableElement(e.activeElement)}const o=s();if(this.inputFocusedContext.set(o),o){const r=t.add(trackFocus(e.activeElement));Event$1.once(r.onDidBlur)(()=>{getActiveWindow().document===e&&this.inputFocusedContext.set(s()),r.dispose()},void 0,t)}}getContextValuesContainer(e){return this._isDisposed?NullContext.INSTANCE:this._contexts.get(e)||NullContext.INSTANCE}createChildContext(e=this._myContextId){if(this._isDisposed)throw new Error("ContextKeyService has been disposed");const t=++this._lastContextId;return this._contexts.set(t,new Context(t,this.getContextValuesContainer(e))),t}disposeContext(e){this._isDisposed||this._contexts.delete(e)}};ContextKeyService=__decorate$5([__param$5(0,IConfigurationService)],ContextKeyService);class ScopedContextKeyService extends AbstractContextKeyService{constructor(e,t){if(super(e.createChildContext()),this._parentChangeListener=this._register(new MutableDisposable),this._parent=e,this._updateParentChangeListener(),this._domNode=t,this._domNode.hasAttribute(KEYBINDING_CONTEXT_ATTR)){let s="";this._domNode.classList&&(s=Array.from(this._domNode.classList.values()).join(", ")),console.error(`Element already has context attribute${s?": "+s:""}`)}this._domNode.setAttribute(KEYBINDING_CONTEXT_ATTR,String(this._myContextId))}_updateParentChangeListener(){this._parentChangeListener.value=this._parent.onDidChangeContext(e=>{const s=this._parent.getContextValuesContainer(this._myContextId).value;allEventKeysInContext(e,s)||this._onDidChangeContext.fire(e)})}dispose(){this._isDisposed||(this._parent.disposeContext(this._myContextId),this._domNode.removeAttribute(KEYBINDING_CONTEXT_ATTR),super.dispose())}getContextValuesContainer(e){return this._isDisposed?NullContext.INSTANCE:this._parent.getContextValuesContainer(e)}createChildContext(e=this._myContextId){if(this._isDisposed)throw new Error("ScopedContextKeyService has been disposed");return this._parent.createChildContext(e)}disposeContext(e){this._isDisposed||this._parent.disposeContext(e)}}function findContextAttr(a){for(;a;){if(a.hasAttribute(KEYBINDING_CONTEXT_ATTR)){const e=a.getAttribute(KEYBINDING_CONTEXT_ATTR);return e?parseInt(e,10):NaN}a=a.parentElement}return 0}function setContext(a,e,t){a.get(IContextKeyService).createKey(String(e),stringifyURIs(t))}function stringifyURIs(a){return cloneAndChange(a,e=>{if(typeof e=="object"&&e.$mid===1)return URI.revive(e).toString();if(e instanceof URI)return e.toString()})}CommandsRegistry.registerCommand("_setContext",setContext);CommandsRegistry.registerCommand({id:"getContextKeyInfo",handler(){return[...RawContextKey.all()].sort((a,e)=>a.key.localeCompare(e.key))},metadata:{description:localize(1659,"A command that returns information about context keys"),args:[]}});CommandsRegistry.registerCommand("_generateContextKeyInfo",function(){const a=[],e=new Set;for(const t of RawContextKey.all())e.has(t.key)||(e.add(t.key),a.push(t));a.sort((t,s)=>t.key.localeCompare(s.key)),console.log(JSON.stringify(a,void 0,2))});let Node$1=class{constructor(e,t){this.key=e,this.data=t,this.incoming=new Map,this.outgoing=new Map}};class Graph{constructor(e){this._hashFn=e,this._nodes=new Map}roots(){const e=[];for(const t of this._nodes.values())t.outgoing.size===0&&e.push(t);return e}insertEdge(e,t){const s=this.lookupOrInsertNode(e),o=this.lookupOrInsertNode(t);s.outgoing.set(o.key,o),o.incoming.set(s.key,s)}removeNode(e){const t=this._hashFn(e);this._nodes.delete(t);for(const s of this._nodes.values())s.outgoing.delete(t),s.incoming.delete(t)}lookupOrInsertNode(e){const t=this._hashFn(e);let s=this._nodes.get(t);return s||(s=new Node$1(t,e),this._nodes.set(t,s)),s}isEmpty(){return this._nodes.size===0}toString(){const e=[];for(const[t,s]of this._nodes)e.push(`${t}
	(-> incoming)[${[...s.incoming.keys()].join(", ")}]
	(outgoing ->)[${[...s.outgoing.keys()].join(",")}]
`);return e.join(`
`)}findCycleSlow(){for(const[e,t]of this._nodes){const s=new Set([e]),o=this._findCycle(t,s);if(o)return o}}_findCycle(e,t){for(const[s,o]of e.outgoing){if(t.has(s))return[...t,s].join(" -> ");t.add(s);const r=this._findCycle(o,t);if(r)return r;t.delete(s)}}}const _enableAllTracing=!1;class CyclicDependencyError extends Error{constructor(e){super("cyclic dependency between services"),this.message=e.findCycleSlow()??`UNABLE to detect cycle, dumping graph: 
${e.toString()}`}}class InstantiationService{constructor(e=new ServiceCollection,t=!1,s,o=_enableAllTracing){this._services=e,this._strict=t,this._parent=s,this._enableTracing=o,this._isDisposed=!1,this._servicesToMaybeDispose=new Set,this._children=new Set,this._activeInstantiations=new Set,this._services.set(IInstantiationService,this),this._globalGraph=o?(s==null?void 0:s._globalGraph)??new Graph(r=>r):void 0}dispose(){if(!this._isDisposed){this._isDisposed=!0,dispose(this._children),this._children.clear();for(const e of this._servicesToMaybeDispose)isDisposable(e)&&e.dispose();this._servicesToMaybeDispose.clear()}}_throwIfDisposed(){if(this._isDisposed)throw new Error("InstantiationService has been disposed")}createChild(e,t){this._throwIfDisposed();const s=this,o=new class extends InstantiationService{dispose(){s._children.delete(o),super.dispose()}}(e,this._strict,this,this._enableTracing);return this._children.add(o),t==null||t.add(o),o}invokeFunction(e,...t){this._throwIfDisposed();const s=Trace.traceInvocation(this._enableTracing,e);let o=!1;try{return e({get:l=>{if(o)throw illegalState("service accessor is only valid during the invocation of its target method");const c=this._getOrCreateServiceInstance(l,s);if(!c)throw new Error(`[invokeFunction] unknown service '${l}'`);return c},getIfExists:l=>{if(o)throw illegalState("service accessor is only valid during the invocation of its target method");return this._getOrCreateServiceInstance(l,s)}},...t)}finally{o=!0,s.stop()}}createInstance(e,...t){this._throwIfDisposed();let s,o;return e instanceof SyncDescriptor?(s=Trace.traceCreation(this._enableTracing,e.ctor),o=this._createInstance(e.ctor,e.staticArguments.concat(t),s)):(s=Trace.traceCreation(this._enableTracing,e),o=this._createInstance(e,t,s)),s.stop(),o}_createInstance(e,t=[],s){const o=_util.getServiceDependencies(e).sort((c,d)=>c.index-d.index),r=[];for(const c of o){const d=this._getOrCreateServiceInstance(c.id,s);d||this._throwIfStrict(`[createInstance] ${e.name} depends on UNKNOWN service ${c.id}.`,!1),r.push(d)}const l=o.length>0?o[0].index:t.length;if(t.length!==l){console.trace(`[createInstance] First service dependency of ${e.name} at position ${l+1} conflicts with ${t.length} static arguments`);const c=l-t.length;c>0?t=t.concat(new Array(c)):t=t.slice(0,l)}return Reflect.construct(e,t.concat(r))}_setCreatedServiceInstance(e,t){if(this._services.get(e)instanceof SyncDescriptor)this._services.set(e,t);else if(this._parent)this._parent._setCreatedServiceInstance(e,t);else throw new Error("illegalState - setting UNKNOWN service instance")}_getServiceInstanceOrDescriptor(e){const t=this._services.get(e);return!t&&this._parent?this._parent._getServiceInstanceOrDescriptor(e):t}_getOrCreateServiceInstance(e,t){this._globalGraph&&this._globalGraphImplicitDependency&&this._globalGraph.insertEdge(this._globalGraphImplicitDependency,String(e));const s=this._getServiceInstanceOrDescriptor(e);return s instanceof SyncDescriptor?this._safeCreateAndCacheServiceInstance(e,s,t.branch(e,!0)):(t.branch(e,!1),s)}_safeCreateAndCacheServiceInstance(e,t,s){if(this._activeInstantiations.has(e))throw new Error(`illegal state - RECURSIVELY instantiating service '${e}'`);this._activeInstantiations.add(e);try{return this._createAndCacheServiceInstance(e,t,s)}finally{this._activeInstantiations.delete(e)}}_createAndCacheServiceInstance(e,t,s){var d;const o=new Graph(u=>u.id.toString());let r=0;const l=[{id:e,desc:t,_trace:s}],c=new Set;for(;l.length;){const u=l.pop();if(!c.has(String(u.id))){if(c.add(String(u.id)),o.lookupOrInsertNode(u),r++>1e3)throw new CyclicDependencyError(o);for(const g of _util.getServiceDependencies(u.desc.ctor)){const f=this._getServiceInstanceOrDescriptor(g.id);if(f||this._throwIfStrict(`[createInstance] ${e} depends on ${g.id} which is NOT registered.`,!0),(d=this._globalGraph)==null||d.insertEdge(String(u.id),String(g.id)),f instanceof SyncDescriptor){const p={id:g.id,desc:f,_trace:u._trace.branch(g.id,!0)};o.insertEdge(u,p),l.push(p)}}}}for(;;){const u=o.roots();if(u.length===0){if(!o.isEmpty())throw new CyclicDependencyError(o);break}for(const{data:g}of u){if(this._getServiceInstanceOrDescriptor(g.id)instanceof SyncDescriptor){const p=this._createServiceInstanceWithOwner(g.id,g.desc.ctor,g.desc.staticArguments,g.desc.supportsDelayedInstantiation,g._trace);this._setCreatedServiceInstance(g.id,p)}o.removeNode(g)}}return this._getServiceInstanceOrDescriptor(e)}_createServiceInstanceWithOwner(e,t,s=[],o,r){if(this._services.get(e)instanceof SyncDescriptor)return this._createServiceInstance(e,t,s,o,r,this._servicesToMaybeDispose);if(this._parent)return this._parent._createServiceInstanceWithOwner(e,t,s,o,r);throw new Error(`illegalState - creating UNKNOWN service instance ${t.name}`)}_createServiceInstance(e,t,s=[],o,r,l){if(o){const c=new InstantiationService(void 0,this._strict,this,this._enableTracing);c._globalGraphImplicitDependency=String(e);const d=new Map,u=new GlobalIdleValue(()=>{const g=c._createInstance(t,s,r);for(const[f,p]of d){const m=g[f];if(typeof m=="function")for(const _ of p)_.disposable=m.apply(g,_.listener)}return d.clear(),l.add(g),g});return new Proxy(Object.create(null),{get(g,f){if(!u.isInitialized&&typeof f=="string"&&(f.startsWith("onDid")||f.startsWith("onWill"))){let _=d.get(f);return _||(_=new LinkedList,d.set(f,_)),(b,v,S)=>{if(u.isInitialized)return u.value[f](b,v,S);{const y={listener:[b,v,S],disposable:void 0},w=_.push(y);return toDisposable(()=>{var x;w(),(x=y.disposable)==null||x.dispose()})}}}if(f in g)return g[f];const p=u.value;let m=p[f];return typeof m!="function"||(m=m.bind(p),g[f]=m),m},set(g,f,p){return u.value[f]=p,!0},getPrototypeOf(g){return t.prototype}})}else{const c=this._createInstance(t,s,r);return l.add(c),c}}_throwIfStrict(e,t){if(t&&console.warn(e),this._strict)throw new Error(e)}}const Se=class Se{static traceInvocation(e,t){return e?new Se(2,t.name||new Error().stack.split(`
`).slice(3,4).join(`
`)):Se._None}static traceCreation(e,t){return e?new Se(1,t.name):Se._None}constructor(e,t){this.type=e,this.name=t,this._start=Date.now(),this._dep=[]}branch(e,t){const s=new Se(3,e.toString());return this._dep.push([e,t,s]),s}stop(){const e=Date.now()-this._start;Se._totals+=e;let t=!1;function s(r,l){const c=[],d=new Array(r+1).join("	");for(const[u,g,f]of l._dep)if(g&&f){t=!0,c.push(`${d}CREATES -> ${u}`);const p=s(r+1,f);p&&c.push(p)}else c.push(`${d}uses -> ${u}`);return c.join(`
`)}const o=[`${this.type===1?"CREATE":"CALL"} ${this.name}`,`${s(1,this)}`,`DONE, took ${e.toFixed(2)}ms (grand total ${Se._totals.toFixed(2)}ms)`];(e>2||t)&&Se.all.add(o.join(`
`))}};Se.all=new Set,Se._None=new class extends Se{constructor(){super(0,null)}stop(){}branch(){return this}},Se._totals=0;let Trace=Se;const unsupportedSchemas=new Set([Schemas.inMemory,Schemas.vscodeSourceControl,Schemas.walkThrough,Schemas.walkThroughSnippet,Schemas.vscodeChatCodeBlock,Schemas.vscodeTerminal]);class DoubleResourceMap{constructor(){this._byResource=new ResourceMap,this._byOwner=new Map}set(e,t,s){let o=this._byResource.get(e);o||(o=new Map,this._byResource.set(e,o)),o.set(t,s);let r=this._byOwner.get(t);r||(r=new ResourceMap,this._byOwner.set(t,r)),r.set(e,s)}get(e,t){const s=this._byResource.get(e);return s==null?void 0:s.get(t)}delete(e,t){let s=!1,o=!1;const r=this._byResource.get(e);r&&(s=r.delete(t));const l=this._byOwner.get(t);if(l&&(o=l.delete(e)),s!==o)throw new Error("illegal state");return s&&o}values(e){var t,s;return typeof e=="string"?((t=this._byOwner.get(e))==null?void 0:t.values())??Iterable.empty():URI.isUri(e)?((s=this._byResource.get(e))==null?void 0:s.values())??Iterable.empty():Iterable.map(Iterable.concat(...this._byOwner.values()),o=>o[1])}}class MarkerStats{constructor(e){this.errors=0,this.infos=0,this.warnings=0,this.unknowns=0,this._data=new ResourceMap,this._service=e,this._subscription=e.onMarkerChanged(this._update,this)}dispose(){this._subscription.dispose()}_update(e){for(const t of e){const s=this._data.get(t);s&&this._substract(s);const o=this._resourceStats(t);this._add(o),this._data.set(t,o)}}_resourceStats(e){const t={errors:0,warnings:0,infos:0,unknowns:0};if(unsupportedSchemas.has(e.scheme))return t;for(const{severity:s}of this._service.read({resource:e}))s===MarkerSeverity$2.Error?t.errors+=1:s===MarkerSeverity$2.Warning?t.warnings+=1:s===MarkerSeverity$2.Info?t.infos+=1:t.unknowns+=1;return t}_substract(e){this.errors-=e.errors,this.warnings-=e.warnings,this.infos-=e.infos,this.unknowns-=e.unknowns}_add(e){this.errors+=e.errors,this.warnings+=e.warnings,this.infos+=e.infos,this.unknowns+=e.unknowns}}class MarkerService{constructor(){this._onMarkerChanged=new DebounceEmitter({delay:0,merge:MarkerService._merge}),this.onMarkerChanged=this._onMarkerChanged.event,this._data=new DoubleResourceMap,this._stats=new MarkerStats(this),this._filteredResources=new ResourceMap}dispose(){this._stats.dispose(),this._onMarkerChanged.dispose()}remove(e,t){for(const s of t||[])this.changeOne(e,s,[])}changeOne(e,t,s){if(isFalsyOrEmpty(s))this._data.delete(t,e)&&this._onMarkerChanged.fire([t]);else{const o=[];for(const r of s){const l=MarkerService._toMarker(e,t,r);l&&o.push(l)}this._data.set(t,e,o),this._onMarkerChanged.fire([t])}}static _toMarker(e,t,s){let{code:o,severity:r,message:l,source:c,startLineNumber:d,startColumn:u,endLineNumber:g,endColumn:f,relatedInformation:p,tags:m,origin:_}=s;if(l)return d=d>0?d:1,u=u>0?u:1,g=g>=d?g:d,f=f>0?f:u,{resource:t,owner:e,code:o,severity:r,message:l,source:c,startLineNumber:d,startColumn:u,endLineNumber:g,endColumn:f,relatedInformation:p,tags:m,origin:_}}changeAll(e,t){const s=[],o=this._data.values(e);if(o)for(const r of o){const l=Iterable.first(r);l&&(s.push(l.resource),this._data.delete(l.resource,e))}if(isNonEmptyArray(t)){const r=new ResourceMap;for(const{resource:l,marker:c}of t){const d=MarkerService._toMarker(e,l,c);if(!d)continue;const u=r.get(l);u?u.push(d):(r.set(l,[d]),s.push(l))}for(const[l,c]of r)this._data.set(l,e,c)}s.length>0&&this._onMarkerChanged.fire(s)}_createFilteredMarker(e,t){const s=t.length===1?localize(1721,'Problems are paused because: "{0}"',t[0]):localize(1722,'Problems are paused because: "{0}" and {1} more',t[0],t.length-1);return{owner:"markersFilter",resource:e,severity:MarkerSeverity$2.Info,message:s,startLineNumber:1,startColumn:1,endLineNumber:1,endColumn:1}}read(e=Object.create(null)){let{owner:t,resource:s,severities:o,take:r}=e;if((!r||r<0)&&(r=-1),t&&s){const l=e.ignoreResourceFilters?void 0:this._filteredResources.get(s);if(l!=null&&l.length)return[this._createFilteredMarker(s,l)];const c=this._data.get(s,t);if(!c)return[];const d=[];for(const u of c){if(r>0&&d.length===r)break;const g=e.ignoreResourceFilters?void 0:this._filteredResources.get(s);g!=null&&g.length?d.push(this._createFilteredMarker(s,g)):MarkerService._accept(u,o)&&d.push(u)}return d}else{const l=!t&&!s?this._data.values():this._data.values(s??t),c=[],d=new ResourceSet;for(const u of l)for(const g of u){if(d.has(g.resource))continue;if(r>0&&c.length===r)break;const f=e.ignoreResourceFilters?void 0:this._filteredResources.get(g.resource);f!=null&&f.length?(c.push(this._createFilteredMarker(g.resource,f)),d.add(g.resource)):MarkerService._accept(g,o)&&c.push(g)}return c}}static _accept(e,t){return t===void 0||(t&e.severity)===e.severity}static _merge(e){const t=new ResourceMap;for(const s of e)for(const o of s)t.set(o,!0);return Array.from(t.keys())}}class DefaultConfiguration extends Disposable{get configurationModel(){return this._configurationModel}constructor(e){super(),this.logService=e,this._configurationModel=ConfigurationModel.createEmptyModel(e)}reload(){return this.resetConfigurationModel(),this.configurationModel}getConfigurationDefaultOverrides(){return{}}resetConfigurationModel(){this._configurationModel=ConfigurationModel.createEmptyModel(this.logService);const e=Registry.as(Extensions$6.Configuration).getConfigurationProperties();this.updateConfigurationModel(Object.keys(e),e)}updateConfigurationModel(e,t){const s=this.getConfigurationDefaultOverrides();for(const o of e){const r=s[o],l=t[o];r!==void 0?this._configurationModel.setValue(o,r):l?this._configurationModel.setValue(o,deepClone(l.default)):this._configurationModel.removeValue(o)}}}class LogService extends Disposable{constructor(e,t=[]){super(),this.logger=new MultiplexLogger([e,...t]),this._register(e.onDidChangeLogLevel(s=>this.setLevel(s)))}get onDidChangeLogLevel(){return this.logger.onDidChangeLogLevel}setLevel(e){this.logger.setLevel(e)}getLevel(){return this.logger.getLevel()}trace(e,...t){this.logger.trace(e,...t)}debug(e,...t){this.logger.debug(e,...t)}info(e,...t){this.logger.info(e,...t)}warn(e,...t){this.logger.warn(e,...t)}error(e,...t){this.logger.error(e,...t)}}class StandaloneTreeSitterLibraryService{getParserClass(){throw new Error("getParserClass is not implemented in StandaloneTreeSitterLibraryService")}supportsLanguage(e,t){return!1}getLanguage(e,t){}getInjectionQueries(e,t){return null}getHighlightingQueries(e,t){return null}}var __decorate$4=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$4=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class SimpleModel{constructor(e){this.disposed=!1,this.model=e,this._onWillDispose=new Emitter$1}get textEditorModel(){return this.model}dispose(){this.disposed=!0,this._onWillDispose.fire()}}let StandaloneTextModelService=class{constructor(e){this.modelService=e}createModelReference(e){const t=this.modelService.getModel(e);return t?Promise.resolve(new ImmortalReference(new SimpleModel(t))):Promise.reject(new Error("Model not found"))}};StandaloneTextModelService=__decorate$4([__param$4(0,IModelService)],StandaloneTextModelService);const ko=class ko{show(){return ko.NULL_PROGRESS_RUNNER}async showWhile(e,t){await e}};ko.NULL_PROGRESS_RUNNER={done:()=>{},total:()=>{},worked:()=>{}};let StandaloneEditorProgressService=ko;class StandaloneProgressService{withProgress(e,t,s){return t({report:()=>{}})}}class StandaloneEnvironmentService{constructor(){this.isExtensionDevelopment=!1,this.isBuilt=!1}}class StandaloneDialogService{async confirm(e){return{confirmed:this.doConfirm(e.message,e.detail),checkboxChecked:!1}}doConfirm(e,t){let s=e;return t&&(s=s+`

`+t),mainWindow.confirm(s)}async prompt(e){var o;let t;if(this.doConfirm(e.message,e.detail)){const r=[...e.buttons??[]];e.cancelButton&&typeof e.cancelButton!="string"&&typeof e.cancelButton!="boolean"&&r.push(e.cancelButton),t=await((o=r[0])==null?void 0:o.run({checkboxChecked:!1}))}return{result:t}}async error(e,t){await this.prompt({type:Severity$2.Error,message:e,detail:t})}}const In=class In{info(e){return this.notify({severity:Severity$2.Info,message:e})}warn(e){return this.notify({severity:Severity$2.Warning,message:e})}error(e){return this.notify({severity:Severity$2.Error,message:e})}notify(e){switch(e.severity){case Severity$2.Error:console.error(e.message);break;case Severity$2.Warning:console.warn(e.message);break;default:console.log(e.message);break}return In.NO_OP}prompt(e,t,s,o){return In.NO_OP}status(e,t){return{close:()=>{}}}};In.NO_OP=new NoOpNotification;let StandaloneNotificationService=In,StandaloneCommandService=class{constructor(e){this._onWillExecuteCommand=new Emitter$1,this._onDidExecuteCommand=new Emitter$1,this.onDidExecuteCommand=this._onDidExecuteCommand.event,this._instantiationService=e}executeCommand(e,...t){const s=CommandsRegistry.getCommand(e);if(!s)return Promise.reject(new Error(`command '${e}' not found`));try{this._onWillExecuteCommand.fire({commandId:e,args:t});const o=this._instantiationService.invokeFunction.apply(this._instantiationService,[s.handler,...t]);return this._onDidExecuteCommand.fire({commandId:e,args:t}),Promise.resolve(o)}catch(o){return Promise.reject(o)}}};StandaloneCommandService=__decorate$4([__param$4(0,IInstantiationService)],StandaloneCommandService);let StandaloneKeybindingService=class extends AbstractKeybindingService{constructor(e,t,s,o,r,l){super(e,t,s,o,r),this._cachedResolver=null,this._dynamicKeybindings=[],this._domNodeListeners=[];const c=m=>{const _=new DisposableStore;_.add(addDisposableListener(m,EventType$1.KEY_DOWN,C=>{const b=new StandardKeyboardEvent(C);this._dispatch(b,b.target)&&(b.preventDefault(),b.stopPropagation())})),_.add(addDisposableListener(m,EventType$1.KEY_UP,C=>{const b=new StandardKeyboardEvent(C);this._singleModifierDispatch(b,b.target)&&b.preventDefault()})),this._domNodeListeners.push(new DomNodeListeners(m,_))},d=m=>{for(let _=0;_<this._domNodeListeners.length;_++){const C=this._domNodeListeners[_];C.domNode===m&&(this._domNodeListeners.splice(_,1),C.dispose())}},u=m=>{m.getOption(70)||c(m.getContainerDomNode())},g=m=>{m.getOption(70)||d(m.getContainerDomNode())};this._register(l.onCodeEditorAdd(u)),this._register(l.onCodeEditorRemove(g)),l.listCodeEditors().forEach(u);const f=m=>{c(m.getContainerDomNode())},p=m=>{d(m.getContainerDomNode())};this._register(l.onDiffEditorAdd(f)),this._register(l.onDiffEditorRemove(p)),l.listDiffEditors().forEach(f)}addDynamicKeybinding(e,t,s,o){return combinedDisposable(CommandsRegistry.registerCommand(e,s),this.addDynamicKeybindings([{keybinding:t,command:e,when:o}]))}addDynamicKeybindings(e){const t=e.map(s=>({keybinding:decodeKeybinding(s.keybinding,OS),command:s.command??null,commandArgs:s.commandArgs,when:s.when,weight1:1e3,weight2:0,extensionId:null,isBuiltinExtension:!1}));return this._dynamicKeybindings=this._dynamicKeybindings.concat(t),this.updateResolver(),toDisposable(()=>{for(let s=0;s<this._dynamicKeybindings.length;s++)if(this._dynamicKeybindings[s]===t[0]){this._dynamicKeybindings.splice(s,t.length),this.updateResolver();return}})}updateResolver(){this._cachedResolver=null,this._onDidUpdateKeybindings.fire()}_getResolver(){if(!this._cachedResolver){const e=this._toNormalizedKeybindingItems(KeybindingsRegistry.getDefaultKeybindings(),!0),t=this._toNormalizedKeybindingItems(this._dynamicKeybindings,!1);this._cachedResolver=new KeybindingResolver(e,t,s=>this._log(s))}return this._cachedResolver}_documentHasFocus(){return mainWindow.document.hasFocus()}_toNormalizedKeybindingItems(e,t){const s=[];let o=0;for(const r of e){const l=r.when||void 0,c=r.keybinding;if(!c)s[o++]=new ResolvedKeybindingItem(void 0,r.command,r.commandArgs,l,t,null,!1);else{const d=USLayoutResolvedKeybinding.resolveKeybinding(c,OS);for(const u of d)s[o++]=new ResolvedKeybindingItem(u,r.command,r.commandArgs,l,t,null,!1)}}return s}resolveKeyboardEvent(e){const t=new KeyCodeChord(e.ctrlKey,e.shiftKey,e.altKey,e.metaKey,e.keyCode);return new USLayoutResolvedKeybinding([t],OS)}};StandaloneKeybindingService=__decorate$4([__param$4(0,IContextKeyService),__param$4(1,ICommandService),__param$4(2,ITelemetryService),__param$4(3,INotificationService),__param$4(4,ILogService),__param$4(5,ICodeEditorService)],StandaloneKeybindingService);class DomNodeListeners extends Disposable{constructor(e,t){super(),this.domNode=e,this._register(t)}}function isConfigurationOverrides(a){return a&&typeof a=="object"&&(!a.overrideIdentifier||typeof a.overrideIdentifier=="string")&&(!a.resource||a.resource instanceof URI)}let StandaloneConfigurationService=class{constructor(e){this.logService=e,this._onDidChangeConfiguration=new Emitter$1,this.onDidChangeConfiguration=this._onDidChangeConfiguration.event;const t=new DefaultConfiguration(e);this._configuration=new Configuration(t.reload(),ConfigurationModel.createEmptyModel(e),ConfigurationModel.createEmptyModel(e),ConfigurationModel.createEmptyModel(e),ConfigurationModel.createEmptyModel(e),ConfigurationModel.createEmptyModel(e),new ResourceMap,ConfigurationModel.createEmptyModel(e),new ResourceMap,e),t.dispose()}getValue(e,t){const s=typeof e=="string"?e:void 0,o=isConfigurationOverrides(e)?e:isConfigurationOverrides(t)?t:{};return this._configuration.getValue(s,o,void 0)}updateValues(e){const t={data:this._configuration.toData()},s=[];for(const o of e){const[r,l]=o;this.getValue(r)!==l&&(this._configuration.updateValue(r,l),s.push(r))}if(s.length>0){const o=new ConfigurationChangeEvent({keys:s,overrides:[]},t,this._configuration,void 0,this.logService);o.source=8,this._onDidChangeConfiguration.fire(o)}return Promise.resolve()}updateValue(e,t,s,o){return this.updateValues([[e,t]])}inspect(e,t={}){return this._configuration.inspect(e,t,void 0)}};StandaloneConfigurationService=__decorate$4([__param$4(0,ILogService)],StandaloneConfigurationService);let StandaloneResourceConfigurationService=class{constructor(e,t,s){this.configurationService=e,this.modelService=t,this.languageService=s,this._onDidChangeConfiguration=new Emitter$1,this.configurationService.onDidChangeConfiguration(o=>{this._onDidChangeConfiguration.fire({affectedKeys:o.affectedKeys,affectsConfiguration:(r,l)=>o.affectsConfiguration(l)})})}getValue(e,t,s){const o=Position$1.isIPosition(t)?t:null,r=o?typeof s=="string"?s:void 0:typeof t=="string"?t:void 0,l=e?this.getLanguage(e,o):void 0;return typeof r>"u"?this.configurationService.getValue({resource:e,overrideIdentifier:l}):this.configurationService.getValue(r,{resource:e,overrideIdentifier:l})}getLanguage(e,t){const s=this.modelService.getModel(e);return s?t?s.getLanguageIdAtPosition(t.lineNumber,t.column):s.getLanguageId():this.languageService.guessLanguageIdByFilepathOrFirstLine(e)}};StandaloneResourceConfigurationService=__decorate$4([__param$4(0,IConfigurationService),__param$4(1,IModelService),__param$4(2,ILanguageService)],StandaloneResourceConfigurationService);let StandaloneResourcePropertiesService=class{constructor(e){this.configurationService=e}getEOL(e,t){const s=this.configurationService.getValue("files.eol",{overrideIdentifier:t,resource:e});return s&&typeof s=="string"&&s!=="auto"?s:isLinux||isMacintosh?`
`:`\r
`}};StandaloneResourcePropertiesService=__decorate$4([__param$4(0,IConfigurationService)],StandaloneResourcePropertiesService);class StandaloneTelemetryService{publicLog2(){}}const Dn=class Dn{constructor(){const e=URI.from({scheme:Dn.SCHEME,authority:"model",path:"/"});this.workspace={id:STANDALONE_EDITOR_WORKSPACE_ID,folders:[new WorkspaceFolder({uri:e,name:"",index:0})]}}getWorkspace(){return this.workspace}getWorkspaceFolder(e){return e&&e.scheme===Dn.SCHEME?this.workspace.folders[0]:null}};Dn.SCHEME="inmemory";let StandaloneWorkspaceContextService=Dn;function updateConfigurationService(a,e,t){if(!e||!(a instanceof StandaloneConfigurationService))return;const s=[];Object.keys(e).forEach(o=>{isEditorConfigurationKey(o)&&s.push([`editor.${o}`,e[o]]),t&&isDiffEditorConfigurationKey(o)&&s.push([`diffEditor.${o}`,e[o]])}),s.length>0&&a.updateValues(s)}let StandaloneBulkEditService=class{constructor(e){this._modelService=e}hasPreviewHandler(){return!1}async apply(e,t){const s=Array.isArray(e)?e:ResourceEdit.convert(e),o=new Map;for(const c of s){if(!(c instanceof ResourceTextEdit))throw new Error("bad edit - only text edits are supported");const d=this._modelService.getModel(c.resource);if(!d)throw new Error("bad edit - model not found");if(typeof c.versionId=="number"&&d.getVersionId()!==c.versionId)throw new Error("bad state - model changed in the meantime");let u=o.get(d);u||(u=[],o.set(d,u)),u.push(EditOperation.replaceMove(Range$2.lift(c.textEdit.range),c.textEdit.text))}let r=0,l=0;for(const[c,d]of o)c.pushStackElement(),c.pushEditOperations([],d,()=>[]),c.pushStackElement(),l+=1,r+=d.length;return{ariaSummary:format(StandaloneServicesNLS.bulkEditServiceSummary,r,l),isApplied:r>0}}};StandaloneBulkEditService=__decorate$4([__param$4(0,IModelService)],StandaloneBulkEditService);class StandaloneUriLabelService{getUriLabel(e,t){return e.scheme==="file"?e.fsPath:e.path}getUriBasenameLabel(e){return basename(e)}}let StandaloneContextViewService=class extends ContextViewService{constructor(e,t){super(e),this._codeEditorService=t}showContextView(e,t,s){if(!t){const o=this._codeEditorService.getFocusedCodeEditor()||this._codeEditorService.getActiveCodeEditor();o&&(t=o.getContainerDomNode())}return super.showContextView(e,t,s)}};StandaloneContextViewService=__decorate$4([__param$4(0,ILayoutService),__param$4(1,ICodeEditorService)],StandaloneContextViewService);class StandaloneWorkspaceTrustManagementService{constructor(){this._neverEmitter=new Emitter$1,this.onDidChangeTrust=this._neverEmitter.event}isWorkspaceTrusted(){return!0}}class StandaloneLanguageService extends LanguageService{constructor(){super()}}class StandaloneLogService extends LogService{constructor(){super(new ConsoleLogger)}}let StandaloneContextMenuService=class extends ContextMenuService{constructor(e,t,s,o,r,l){super(e,t,s,o,r,l),this.configure({blockMouse:!1})}};StandaloneContextMenuService=__decorate$4([__param$4(0,ITelemetryService),__param$4(1,INotificationService),__param$4(2,IContextViewService),__param$4(3,IKeybindingService),__param$4(4,IMenuService),__param$4(5,IContextKeyService)],StandaloneContextMenuService);const standaloneEditorWorkerDescriptor={esmModuleLocation:void 0,label:"editorWorkerService"};let StandaloneEditorWorkerService=class extends EditorWorkerService{constructor(e,t,s,o,r){super(standaloneEditorWorkerDescriptor,e,t,s,o,r)}};StandaloneEditorWorkerService=__decorate$4([__param$4(0,IModelService),__param$4(1,ITextResourceConfigurationService),__param$4(2,ILogService),__param$4(3,ILanguageConfigurationService),__param$4(4,ILanguageFeaturesService)],StandaloneEditorWorkerService);class StandaloneAccessbilitySignalService{async playSignal(e,t){}}registerSingleton(ILogService,StandaloneLogService,0);registerSingleton(IConfigurationService,StandaloneConfigurationService,0);registerSingleton(ITextResourceConfigurationService,StandaloneResourceConfigurationService,0);registerSingleton(ITextResourcePropertiesService,StandaloneResourcePropertiesService,0);registerSingleton(IWorkspaceContextService,StandaloneWorkspaceContextService,0);registerSingleton(ILabelService,StandaloneUriLabelService,0);registerSingleton(ITelemetryService,StandaloneTelemetryService,0);registerSingleton(IDialogService,StandaloneDialogService,0);registerSingleton(IEnvironmentService,StandaloneEnvironmentService,0);registerSingleton(INotificationService,StandaloneNotificationService,0);registerSingleton(IMarkerService,MarkerService,0);registerSingleton(ILanguageService,StandaloneLanguageService,0);registerSingleton(IStandaloneThemeService,StandaloneThemeService,0);registerSingleton(IModelService,ModelService,0);registerSingleton(IMarkerDecorationsService,MarkerDecorationsService,0);registerSingleton(IContextKeyService,ContextKeyService,0);registerSingleton(IProgressService,StandaloneProgressService,0);registerSingleton(IEditorProgressService,StandaloneEditorProgressService,0);registerSingleton(IStorageService,InMemoryStorageService,0);registerSingleton(IEditorWorkerService,StandaloneEditorWorkerService,0);registerSingleton(IBulkEditService,StandaloneBulkEditService,0);registerSingleton(IWorkspaceTrustManagementService,StandaloneWorkspaceTrustManagementService,0);registerSingleton(ITextModelService,StandaloneTextModelService,0);registerSingleton(IAccessibilityService,AccessibilityService,0);registerSingleton(IListService,ListService,0);registerSingleton(ICommandService,StandaloneCommandService,0);registerSingleton(IKeybindingService,StandaloneKeybindingService,0);registerSingleton(IQuickInputService,StandaloneQuickInputService,0);registerSingleton(IContextViewService,StandaloneContextViewService,0);registerSingleton(IOpenerService,OpenerService,0);registerSingleton(IClipboardService,BrowserClipboardService,0);registerSingleton(IContextMenuService,StandaloneContextMenuService,0);registerSingleton(IMenuService,MenuService,0);registerSingleton(IAccessibilitySignalService,StandaloneAccessbilitySignalService,0);registerSingleton(ITreeSitterLibraryService,StandaloneTreeSitterLibraryService,0);registerSingleton(ILoggerService,NullLoggerService,0);registerSingleton(IDataChannelService,NullDataChannelService,0);var StandaloneServices;(function(a){const e=new ServiceCollection;for(const[d,u]of getSingletonServiceDescriptors())e.set(d,u);const t=new InstantiationService(e,!0);e.set(IInstantiationService,t);function s(d){o||l({});const u=e.get(d);if(!u)throw new Error("Missing service "+d);return u instanceof SyncDescriptor?t.invokeFunction(g=>g.get(d)):u}a.get=s;let o=!1;const r=new Emitter$1;function l(d){if(o)return t;o=!0;for(const[g,f]of getSingletonServiceDescriptors())e.get(g)||e.set(g,f);for(const g in d)if(d.hasOwnProperty(g)){const f=createDecorator(g);e.get(f)instanceof SyncDescriptor&&e.set(f,d[g])}const u=getEditorFeatures();for(const g of u)try{t.createInstance(g)}catch(f){onUnexpectedError(f)}return r.fire(),t}a.initialize=l;function c(d){if(o)return d();const u=new DisposableStore,g=u.add(r.event(()=>{g.dispose(),u.add(d())}));return u}a.withServices=c})(StandaloneServices||(StandaloneServices={}));var __decorate$3=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$3=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let LAST_GENERATED_COMMAND_ID=0,ariaDomNodeCreated=!1;function createAriaDomNode(a){if(!a){if(ariaDomNodeCreated)return;ariaDomNodeCreated=!0}setARIAContainer(a||mainWindow.document.body)}let StandaloneCodeEditor=class extends CodeEditorWidget{constructor(e,t,s,o,r,l,c,d,u,g,f,p,m){const _={...t};_.ariaLabel=_.ariaLabel||StandaloneCodeEditorNLS.editorViewAccessibleLabel,super(e,_,{},s,o,r,l,u,g,f,p,m),d instanceof StandaloneKeybindingService?this._standaloneKeybindingService=d:this._standaloneKeybindingService=null,createAriaDomNode(_.ariaContainerElement),setHoverDelegateFactory((C,b)=>s.createInstance(WorkbenchHoverDelegate,C,{instantHover:b},{})),setBaseLayerHoverDelegate(c)}addCommand(e,t,s){if(!this._standaloneKeybindingService)return console.warn("Cannot add command because the editor is configured with an unrecognized KeybindingService"),null;const o="DYNAMIC_"+ ++LAST_GENERATED_COMMAND_ID,r=ContextKeyExpr.deserialize(s);return this._standaloneKeybindingService.addDynamicKeybinding(o,e,t,r),o}createContextKey(e,t){return this._contextKeyService.createKey(e,t)}addAction(e){if(typeof e.id!="string"||typeof e.label!="string"||typeof e.run!="function")throw new Error("Invalid action descriptor, `id`, `label` and `run` are required properties!");if(!this._standaloneKeybindingService)return console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService"),Disposable.None;const t=e.id,s=e.label,o=ContextKeyExpr.and(ContextKeyExpr.equals("editorId",this.getId()),ContextKeyExpr.deserialize(e.precondition)),r=e.keybindings,l=ContextKeyExpr.and(o,ContextKeyExpr.deserialize(e.keybindingContext)),c=e.contextMenuGroupId||null,d=e.contextMenuOrder||0,u=(m,..._)=>Promise.resolve(e.run(this,..._)),g=new DisposableStore,f=this.getId()+":"+t;if(g.add(CommandsRegistry.registerCommand(f,u)),c){const m={command:{id:f,title:s},when:o,group:c,order:d};g.add(MenuRegistry.appendMenuItem(MenuId.EditorContext,m))}if(Array.isArray(r))for(const m of r)g.add(this._standaloneKeybindingService.addDynamicKeybinding(f,m,u,l));const p=new InternalEditorAction(f,s,s,void 0,o,(...m)=>Promise.resolve(e.run(this,...m)),this._contextKeyService);return this._actions.set(t,p),g.add(toDisposable(()=>{this._actions.delete(t)})),g}_triggerCommand(e,t){if(this._codeEditorService instanceof StandaloneCodeEditorService)try{this._codeEditorService.setActiveCodeEditor(this),super._triggerCommand(e,t)}finally{this._codeEditorService.setActiveCodeEditor(null)}else super._triggerCommand(e,t)}};StandaloneCodeEditor=__decorate$3([__param$3(2,IInstantiationService),__param$3(3,ICodeEditorService),__param$3(4,ICommandService),__param$3(5,IContextKeyService),__param$3(6,IHoverService),__param$3(7,IKeybindingService),__param$3(8,IThemeService),__param$3(9,INotificationService),__param$3(10,IAccessibilityService),__param$3(11,ILanguageConfigurationService),__param$3(12,ILanguageFeaturesService)],StandaloneCodeEditor);let StandaloneEditor=class extends StandaloneCodeEditor{constructor(e,t,s,o,r,l,c,d,u,g,f,p,m,_,C,b){const v={...t};updateConfigurationService(f,v,!1);const S=u.registerEditorContainer(e);typeof v.theme=="string"&&u.setTheme(v.theme),typeof v.autoDetectHighContrast<"u"&&u.setAutoDetectHighContrast(!!v.autoDetectHighContrast);const y=v.model;delete v.model,super(e,v,s,o,r,l,c,d,u,g,p,C,b),this._configurationService=f,this._standaloneThemeService=u,this._register(S);let w;if(typeof y>"u"){const L=_.getLanguageIdByMimeType(v.language)||v.language||PLAINTEXT_LANGUAGE_ID;w=createTextModel(m,_,v.value||"",L,void 0),this._ownsModel=!0}else w=y,this._ownsModel=!1;if(this._attachModel(w),w){const L={oldModelUrl:null,newModelUrl:w.uri};this._onDidChangeModel.fire(L)}}dispose(){super.dispose()}updateOptions(e){updateConfigurationService(this._configurationService,e,!1),typeof e.theme=="string"&&this._standaloneThemeService.setTheme(e.theme),typeof e.autoDetectHighContrast<"u"&&this._standaloneThemeService.setAutoDetectHighContrast(!!e.autoDetectHighContrast),super.updateOptions(e)}_postDetachModelCleanup(e){super._postDetachModelCleanup(e),e&&this._ownsModel&&(e.dispose(),this._ownsModel=!1)}};StandaloneEditor=__decorate$3([__param$3(2,IInstantiationService),__param$3(3,ICodeEditorService),__param$3(4,ICommandService),__param$3(5,IContextKeyService),__param$3(6,IHoverService),__param$3(7,IKeybindingService),__param$3(8,IStandaloneThemeService),__param$3(9,INotificationService),__param$3(10,IConfigurationService),__param$3(11,IAccessibilityService),__param$3(12,IModelService),__param$3(13,ILanguageService),__param$3(14,ILanguageConfigurationService),__param$3(15,ILanguageFeaturesService)],StandaloneEditor);let StandaloneDiffEditor2=class extends DiffEditorWidget{constructor(e,t,s,o,r,l,c,d,u,g,f,p){const m={...t};updateConfigurationService(d,m,!0);const _=l.registerEditorContainer(e);typeof m.theme=="string"&&l.setTheme(m.theme),typeof m.autoDetectHighContrast<"u"&&l.setAutoDetectHighContrast(!!m.autoDetectHighContrast),super(e,m,{},o,s,r,p,g),this._configurationService=d,this._standaloneThemeService=l,this._register(_)}dispose(){super.dispose()}updateOptions(e){updateConfigurationService(this._configurationService,e,!0),typeof e.theme=="string"&&this._standaloneThemeService.setTheme(e.theme),typeof e.autoDetectHighContrast<"u"&&this._standaloneThemeService.setAutoDetectHighContrast(!!e.autoDetectHighContrast),super.updateOptions(e)}_createInnerEditor(e,t,s){return e.createInstance(StandaloneCodeEditor,t,s)}getOriginalEditor(){return super.getOriginalEditor()}getModifiedEditor(){return super.getModifiedEditor()}addCommand(e,t,s){return this.getModifiedEditor().addCommand(e,t,s)}createContextKey(e,t){return this.getModifiedEditor().createContextKey(e,t)}addAction(e){return this.getModifiedEditor().addAction(e)}};StandaloneDiffEditor2=__decorate$3([__param$3(2,IInstantiationService),__param$3(3,IContextKeyService),__param$3(4,ICodeEditorService),__param$3(5,IStandaloneThemeService),__param$3(6,INotificationService),__param$3(7,IConfigurationService),__param$3(8,IContextMenuService),__param$3(9,IEditorProgressService),__param$3(10,IClipboardService),__param$3(11,IAccessibilitySignalService)],StandaloneDiffEditor2);function createTextModel(a,e,t,s,o){if(t=t||"",!s){const r=t.indexOf(`
`);let l=t;return r!==-1&&(l=t.substring(0,r)),doCreateModel(a,t,e.createByFilepathOrFirstLine(o||null,l),o)}return doCreateModel(a,t,e.createById(s),o)}function doCreateModel(a,e,t,s){return a.createModel(e,t,s)}registerColor("multiDiffEditor.headerBackground",{dark:"#262626",light:"tab.inactiveBackground",hcDark:"tab.inactiveBackground",hcLight:"tab.inactiveBackground"},localize(139,"The background color of the diff editor's header"));registerColor("multiDiffEditor.background",editorBackground,localize(140,"The background color of the multi file diff editor"));registerColor("multiDiffEditor.border",{dark:"sideBarSectionHeader.border",light:"#cccccc",hcDark:"sideBarSectionHeader.border",hcLight:"#cccccc"},localize(141,"The border color of the multi file diff editor"));var __decorate$2=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$2=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};class TemplateData{constructor(e,t){this.viewModel=e,this.deltaScrollVertical=t}getId(){return this.viewModel}}let DiffEditorItemTemplate=class extends Disposable{constructor(e,t,s,o,r){super(),this._container=e,this._overflowWidgetsDomNode=t,this._workbenchUIElementFactory=s,this._instantiationService=o,this._viewModel=observableValue(this,void 0),this._collapsed=derived(this,d=>{var u;return(u=this._viewModel.read(d))==null?void 0:u.collapsed.read(d)}),this._editorContentHeight=observableValue(this,500),this.contentHeight=derived(this,d=>(this._collapsed.read(d)?0:this._editorContentHeight.read(d))+this._outerEditorHeight),this._modifiedContentWidth=observableValue(this,0),this._modifiedWidth=observableValue(this,0),this._originalContentWidth=observableValue(this,0),this._originalWidth=observableValue(this,0),this.maxScroll=derived(this,d=>{const u=this._modifiedContentWidth.read(d)-this._modifiedWidth.read(d),g=this._originalContentWidth.read(d)-this._originalWidth.read(d);return u>g?{maxScroll:u,width:this._modifiedWidth.read(d)}:{maxScroll:g,width:this._originalWidth.read(d)}}),this._elements=h("div.multiDiffEntry",[h("div.header@header",[h("div.header-content",[h("div.collapse-button@collapseButton"),h("div.file-path",[h("div.title.modified.show-file-icons@primaryPath",[]),h("div.status.deleted@status",["R"]),h("div.title.original.show-file-icons@secondaryPath",[])]),h("div.actions@actions")])]),h("div.editorParent",[h("div.editorContainer@editor")])]),this.editor=this._register(this._instantiationService.createInstance(DiffEditorWidget,this._elements.editor,{overflowWidgetsDomNode:this._overflowWidgetsDomNode},{})),this.isModifedFocused=observableCodeEditor(this.editor.getModifiedEditor()).isFocused,this.isOriginalFocused=observableCodeEditor(this.editor.getOriginalEditor()).isFocused,this.isFocused=derived(this,d=>this.isModifedFocused.read(d)||this.isOriginalFocused.read(d)),this._resourceLabel=this._workbenchUIElementFactory.createResourceLabel?this._register(this._workbenchUIElementFactory.createResourceLabel(this._elements.primaryPath)):void 0,this._resourceLabel2=this._workbenchUIElementFactory.createResourceLabel?this._register(this._workbenchUIElementFactory.createResourceLabel(this._elements.secondaryPath)):void 0,this._dataStore=this._register(new DisposableStore),this._headerHeight=40,this._lastScrollTop=-1,this._isSettingScrollTop=!1;const l=new Button(this._elements.collapseButton,{});this._register(autorun(d=>{l.element.className="",l.icon=this._collapsed.read(d)?Codicon.chevronRight:Codicon.chevronDown})),this._register(l.onDidClick(()=>{var d;(d=this._viewModel.get())==null||d.collapsed.set(!this._collapsed.get(),void 0)})),this._register(autorun(d=>{this._elements.editor.style.display=this._collapsed.read(d)?"none":"block"})),this._register(this.editor.getModifiedEditor().onDidLayoutChange(d=>{const u=this.editor.getModifiedEditor().getLayoutInfo().contentWidth;this._modifiedWidth.set(u,void 0)})),this._register(this.editor.getOriginalEditor().onDidLayoutChange(d=>{const u=this.editor.getOriginalEditor().getLayoutInfo().contentWidth;this._originalWidth.set(u,void 0)})),this._register(this.editor.onDidContentSizeChange(d=>{globalTransaction(u=>{this._editorContentHeight.set(d.contentHeight,u),this._modifiedContentWidth.set(this.editor.getModifiedEditor().getContentWidth(),u),this._originalContentWidth.set(this.editor.getOriginalEditor().getContentWidth(),u)})})),this._register(this.editor.getOriginalEditor().onDidScrollChange(d=>{if(this._isSettingScrollTop||!d.scrollTopChanged||!this._data)return;const u=d.scrollTop-this._lastScrollTop;this._data.deltaScrollVertical(u)})),this._register(autorun(d=>{var g;const u=(g=this._viewModel.read(d))==null?void 0:g.isActive.read(d);this._elements.root.classList.toggle("active",u)})),this._container.appendChild(this._elements.root),this._outerEditorHeight=this._headerHeight,this._contextKeyService=this._register(r.createScoped(this._elements.actions));const c=this._register(this._instantiationService.createChild(new ServiceCollection([IContextKeyService,this._contextKeyService])));this._register(c.createInstance(MenuWorkbenchToolBar,this._elements.actions,MenuId.MultiDiffEditorFileToolbar,{actionRunner:this._register(new ActionRunnerWithContext(()=>{var d;return(d=this._viewModel.get())==null?void 0:d.modifiedUri})),menuOptions:{shouldForwardArgs:!0},toolbarOptions:{primaryGroup:d=>d.startsWith("navigation")},actionViewItemProvider:(d,u)=>createActionViewItem(c,d,u)}))}setScrollLeft(e){this._modifiedContentWidth.get()-this._modifiedWidth.get()>this._originalContentWidth.get()-this._originalWidth.get()?this.editor.getModifiedEditor().setScrollLeft(e):this.editor.getOriginalEditor().setScrollLeft(e)}setData(e){this._data=e;function t(o){return{...o,scrollBeyondLastLine:!1,hideUnchangedRegions:{enabled:!0},scrollbar:{vertical:"hidden",horizontal:"hidden",handleMouseWheel:!1,useShadows:!1},renderOverviewRuler:!1,fixedOverflowWidgets:!0,overviewRulerBorder:!1}}if(!e){globalTransaction(o=>{this._viewModel.set(void 0,o),this.editor.setDiffModel(null,o),this._dataStore.clear()});return}const s=e.viewModel.documentDiffItem;if(globalTransaction(o=>{var u,g;(u=this._resourceLabel)==null||u.setUri(e.viewModel.modifiedUri??e.viewModel.originalUri,{strikethrough:e.viewModel.modifiedUri===void 0});let r=!1,l=!1,c=!1,d="";e.viewModel.modifiedUri&&e.viewModel.originalUri&&e.viewModel.modifiedUri.path!==e.viewModel.originalUri.path?(d="R",r=!0):e.viewModel.modifiedUri?e.viewModel.originalUri||(d="A",c=!0):(d="D",l=!0),this._elements.status.classList.toggle("renamed",r),this._elements.status.classList.toggle("deleted",l),this._elements.status.classList.toggle("added",c),this._elements.status.innerText=d,(g=this._resourceLabel2)==null||g.setUri(r?e.viewModel.originalUri:void 0,{strikethrough:!0}),this._dataStore.clear(),this._viewModel.set(e.viewModel,o),this.editor.setDiffModel(e.viewModel.diffEditorViewModelRef,o),this.editor.updateOptions(t(s.options??{}))}),s.onOptionsDidChange&&this._dataStore.add(s.onOptionsDidChange(()=>{this.editor.updateOptions(t(s.options??{}))})),e.viewModel.isAlive.recomputeInitiallyAndOnChange(this._dataStore,o=>{o||this.setData(void 0)}),e.viewModel.documentDiffItem.contextKeys)for(const[o,r]of Object.entries(e.viewModel.documentDiffItem.contextKeys))this._contextKeyService.createKey(o,r)}render(e,t,s,o){this._elements.root.style.visibility="visible",this._elements.root.style.top=`${e.start}px`,this._elements.root.style.height=`${e.length}px`,this._elements.root.style.width=`${t}px`,this._elements.root.style.position="absolute";const r=e.length-this._headerHeight,l=Math.max(0,Math.min(o.start-e.start,r));this._elements.header.style.transform=`translateY(${l}px)`,globalTransaction(c=>{this.editor.layout({width:t-2*8-2*1,height:e.length-this._outerEditorHeight})});try{this._isSettingScrollTop=!0,this._lastScrollTop=s,this.editor.getOriginalEditor().setScrollTop(s)}finally{this._isSettingScrollTop=!1}this._elements.header.classList.toggle("shadow",l>0||s>0),this._elements.header.classList.toggle("collapsed",l===r)}hide(){this._elements.root.style.top="-100000px",this._elements.root.style.visibility="hidden"}};DiffEditorItemTemplate=__decorate$2([__param$2(3,IInstantiationService),__param$2(4,IContextKeyService)],DiffEditorItemTemplate);class ObjectPool{constructor(e){this._create=e,this._unused=new Set,this._used=new Set,this._itemData=new Map}getUnusedObj(e){let t;if(this._unused.size===0)t=this._create(e),this._itemData.set(t,e);else{const s=[...this._unused.values()];t=s.find(o=>this._itemData.get(o).getId()===e.getId())??s[0],this._unused.delete(t),this._itemData.set(t,e),t.setData(e)}return this._used.add(t),{object:t,dispose:()=>{this._used.delete(t),this._unused.size>5?t.dispose():this._unused.add(t)}}}dispose(){for(const e of this._used)e.dispose();for(const e of this._unused)e.dispose();this._used.clear(),this._unused.clear()}}const style="";var __decorate$1=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param$1=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let MultiDiffEditorWidgetImpl=class extends Disposable{constructor(e,t,s,o,r,l){super(),this._element=e,this._dimension=t,this._viewModel=s,this._workbenchUIElementFactory=o,this._parentContextKeyService=r,this._parentInstantiationService=l,this._scrollableElements=h("div.scrollContent",[h("div@content",{style:{overflow:"hidden"}}),h("div.monaco-editor@overflowWidgetsDomNode",{})]),this._scrollable=this._register(new Scrollable({forceIntegerValues:!1,scheduleAtNextAnimationFrame:u=>scheduleAtNextAnimationFrame(getWindow(this._element),u),smoothScrollDuration:100})),this._scrollableElement=this._register(new SmoothScrollableElement(this._scrollableElements.root,{vertical:1,horizontal:1,useShadows:!1},this._scrollable)),this._elements=h("div.monaco-component.multiDiffEditor",{},[h("div",{},[this._scrollableElement.getDomNode()]),h("div.placeholder@placeholder",{},[h("div")])]),this._sizeObserver=this._register(new ObservableElementSizeObserver(this._element,void 0)),this._objectPool=this._register(new ObjectPool(u=>{const g=this._instantiationService.createInstance(DiffEditorItemTemplate,this._scrollableElements.content,this._scrollableElements.overflowWidgetsDomNode,this._workbenchUIElementFactory);return g.setData(u),g})),this.scrollTop=observableFromEvent(this,this._scrollableElement.onScroll,()=>this._scrollableElement.getScrollPosition().scrollTop),this.scrollLeft=observableFromEvent(this,this._scrollableElement.onScroll,()=>this._scrollableElement.getScrollPosition().scrollLeft),this._viewItemsInfo=derived(this,u=>{const g=this._viewModel.read(u);if(!g)return{items:[],getItem:_=>{throw new BugIndicatingError}};const f=g.items.read(u),p=new Map;return{items:f.map(_=>{var v;const C=u.store.add(new VirtualizedViewItem(_,this._objectPool,this.scrollLeft,S=>{this._scrollableElement.setScrollPosition({scrollTop:this._scrollableElement.getScrollPosition().scrollTop+S})})),b=(v=this._lastDocStates)==null?void 0:v[C.getKey()];return b&&transaction(S=>{C.setViewState(b,S)}),p.set(_,C),C}),getItem:_=>p.get(_)}}),this._viewItems=this._viewItemsInfo.map(this,u=>u.items),this._spaceBetweenPx=0,this._totalHeight=this._viewItems.map(this,(u,g)=>u.reduce((f,p)=>f+p.contentHeight.read(g)+this._spaceBetweenPx,0)),this.activeControl=derived(this,u=>{var p,m;const g=(p=this._viewModel.read(u))==null?void 0:p.activeDiffItem.read(u);return g?(m=this._viewItemsInfo.read(u).getItem(g).template.read(u))==null?void 0:m.editor:void 0}),this._contextKeyService=this._register(this._parentContextKeyService.createScoped(this._element)),this._instantiationService=this._register(this._parentInstantiationService.createChild(new ServiceCollection([IContextKeyService,this._contextKeyService]))),this._lastDocStates={},this._register(autorunWithStore((u,g)=>{const f=this._viewModel.read(u);if(f&&f.contextKeys)for(const[p,m]of Object.entries(f.contextKeys)){const _=this._contextKeyService.createKey(p,void 0);_.set(m),g.add(toDisposable(()=>_.reset()))}}));const c=this._parentContextKeyService.createKey(EditorContextKeys.multiDiffEditorAllCollapsed.key,!1);this._register(autorun(u=>{const g=this._viewModel.read(u);if(g){const f=g.items.read(u).every(p=>p.collapsed.read(u));c.set(f)}})),this._register(autorun(u=>{const g=this._dimension.read(u);this._sizeObserver.observe(g)}));const d=derived(u=>{if(this._viewItems.read(u).length>0)return;const f=this._viewModel.read(u);return!f||f.isLoading.read(u)?localize(142,"Loading..."):localize(143,"No Changed Files")});this._register(autorun(u=>{const g=d.read(u);this._elements.placeholder.innerText=g??"",this._elements.placeholder.classList.toggle("visible",!!g)})),this._scrollableElements.content.style.position="relative",this._register(autorun(u=>{const g=this._sizeObserver.height.read(u);this._scrollableElements.root.style.height=`${g}px`;const f=this._totalHeight.read(u);this._scrollableElements.content.style.height=`${f}px`;const p=this._sizeObserver.width.read(u);let m=p;const _=this._viewItems.read(u),C=findFirstMax(_,compareBy(b=>b.maxScroll.read(u).maxScroll,numberComparator));if(C){const b=C.maxScroll.read(u);m=p+b.maxScroll}this._scrollableElement.setScrollDimensions({width:p,height:g,scrollHeight:f,scrollWidth:m})})),e.replaceChildren(this._elements.root),this._register(toDisposable(()=>{e.replaceChildren()})),this._register(this._register(autorun(u=>{globalTransaction(g=>{this.render(u)})})))}render(e){const t=this.scrollTop.read(e);let s=0,o=0,r=0;const l=this._sizeObserver.height.read(e),c=OffsetRange.ofStartAndLength(t,l),d=this._sizeObserver.width.read(e);for(const u of this._viewItems.read(e)){const g=u.contentHeight.read(e),f=Math.min(g,l),p=OffsetRange.ofStartAndLength(o,f),m=OffsetRange.ofStartAndLength(r,g);if(m.isBefore(c))s-=g-f,u.hide();else if(m.isAfter(c))u.hide();else{const _=Math.max(0,Math.min(c.start-m.start,g-f));s-=_;const C=OffsetRange.ofStartAndLength(t+s,l);u.render(p,_,d,C)}o+=f+this._spaceBetweenPx,r+=g+this._spaceBetweenPx}this._scrollableElements.content.style.transform=`translateY(${-(t+s)}px)`}};MultiDiffEditorWidgetImpl=__decorate$1([__param$1(4,IContextKeyService),__param$1(5,IInstantiationService)],MultiDiffEditorWidgetImpl);class VirtualizedViewItem extends Disposable{constructor(e,t,s,o){super(),this.viewModel=e,this._objectPool=t,this._scrollLeft=s,this._deltaScrollVertical=o,this._templateRef=this._register(disposableObservableValue(this,void 0)),this.contentHeight=derived(this,r=>{var l,c;return((c=(l=this._templateRef.read(r))==null?void 0:l.object.contentHeight)==null?void 0:c.read(r))??this.viewModel.lastTemplateData.read(r).contentHeight}),this.maxScroll=derived(this,r=>{var l;return((l=this._templateRef.read(r))==null?void 0:l.object.maxScroll.read(r))??{maxScroll:0,scrollWidth:0}}),this.template=derived(this,r=>{var l;return(l=this._templateRef.read(r))==null?void 0:l.object}),this._isHidden=observableValue(this,!1),this._isFocused=derived(this,r=>{var l;return((l=this.template.read(r))==null?void 0:l.isFocused.read(r))??!1}),this.viewModel.setIsFocused(this._isFocused,void 0),this._register(autorun(r=>{var c;const l=this._scrollLeft.read(r);(c=this._templateRef.read(r))==null||c.object.setScrollLeft(l)})),this._register(autorun(r=>{const l=this._templateRef.read(r);!l||!this._isHidden.read(r)||l.object.isFocused.read(r)||this._clear()}))}dispose(){this._clear(),super.dispose()}toString(){var e;return`VirtualViewItem(${(e=this.viewModel.documentDiffItem.modified)==null?void 0:e.uri.toString()})`}getKey(){return this.viewModel.getKey()}setViewState(e,t){var l;this.viewModel.collapsed.set(e.collapsed,t),this._updateTemplateData(t);const s=this.viewModel.lastTemplateData.get(),o=(l=e.selections)==null?void 0:l.map(Selection$1.liftSelection);this.viewModel.lastTemplateData.set({...s,selections:o},t);const r=this._templateRef.get();r&&o&&r.object.editor.setSelections(o)}_updateTemplateData(e){const t=this._templateRef.get();t&&this.viewModel.lastTemplateData.set({contentHeight:t.object.contentHeight.get(),selections:t.object.editor.getSelections()??void 0},e)}_clear(){const e=this._templateRef.get();e&&transaction(t=>{this._updateTemplateData(t),e.object.hide(),this._templateRef.set(void 0,t)})}hide(){this._isHidden.set(!0,void 0)}render(e,t,s,o){this._isHidden.set(!1,void 0);let r=this._templateRef.get();if(!r){r=this._objectPool.getUnusedObj(new TemplateData(this.viewModel,this._deltaScrollVertical)),this._templateRef.set(r,void 0);const l=this.viewModel.lastTemplateData.get().selections;l&&r.object.editor.setSelections(l)}r.object.render(e,s,t,o)}}var __decorate=globalThis&&globalThis.__decorate||function(a,e,t,s){var o=arguments.length,r=o<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,s);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(r=(o<3?l(r):o>3?l(e,t,r):l(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},__param=globalThis&&globalThis.__param||function(a,e){return function(t,s){e(t,s,a)}};let MultiDiffEditorWidget=class extends Disposable{constructor(e,t,s){super(),this._element=e,this._workbenchUIElementFactory=t,this._instantiationService=s,this._dimension=observableValue(this,void 0),this._viewModel=observableValue(this,void 0),this._widgetImpl=derived(this,o=>o.store.add(this._instantiationService.createInstance(readHotReloadableExport(MultiDiffEditorWidgetImpl),this._element,this._dimension,this._viewModel,this._workbenchUIElementFactory))),this._register(recomputeInitiallyAndOnChange(this._widgetImpl))}};MultiDiffEditorWidget=__decorate([__param(2,IInstantiationService)],MultiDiffEditorWidget);function create(a,e,t){return StandaloneServices.initialize(t||{}).createInstance(StandaloneEditor,a,e)}function onDidCreateEditor(a){return StandaloneServices.get(ICodeEditorService).onCodeEditorAdd(t=>{a(t)})}function onDidCreateDiffEditor(a){return StandaloneServices.get(ICodeEditorService).onDiffEditorAdd(t=>{a(t)})}function getEditors(){return StandaloneServices.get(ICodeEditorService).listCodeEditors()}function getDiffEditors(){return StandaloneServices.get(ICodeEditorService).listDiffEditors()}function createDiffEditor(a,e,t){return StandaloneServices.initialize(t||{}).createInstance(StandaloneDiffEditor2,a,e)}function createMultiFileDiffEditor(a,e){const t=StandaloneServices.initialize(e||{});return new MultiDiffEditorWidget(a,{},t)}function addCommand(a){if(typeof a.id!="string"||typeof a.run!="function")throw new Error("Invalid command descriptor, `id` and `run` are required properties!");return CommandsRegistry.registerCommand(a.id,a.run)}function addEditorAction(a){if(typeof a.id!="string"||typeof a.label!="string"||typeof a.run!="function")throw new Error("Invalid action descriptor, `id`, `label` and `run` are required properties!");const e=ContextKeyExpr.deserialize(a.precondition),t=(o,...r)=>EditorCommand.runEditorCommand(o,r,e,(l,c,d)=>Promise.resolve(a.run(c,...d))),s=new DisposableStore;if(s.add(CommandsRegistry.registerCommand(a.id,t)),a.contextMenuGroupId){const o={command:{id:a.id,title:a.label},when:e,group:a.contextMenuGroupId,order:a.contextMenuOrder||0};s.add(MenuRegistry.appendMenuItem(MenuId.EditorContext,o))}if(Array.isArray(a.keybindings)){const o=StandaloneServices.get(IKeybindingService);if(!(o instanceof StandaloneKeybindingService))console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService");else{const r=ContextKeyExpr.and(e,ContextKeyExpr.deserialize(a.keybindingContext));s.add(o.addDynamicKeybindings(a.keybindings.map(l=>({keybinding:l,command:a.id,when:r}))))}}return s}function addKeybindingRule(a){return addKeybindingRules([a])}function addKeybindingRules(a){const e=StandaloneServices.get(IKeybindingService);return e instanceof StandaloneKeybindingService?e.addDynamicKeybindings(a.map(t=>({keybinding:t.keybinding,command:t.command,commandArgs:t.commandArgs,when:ContextKeyExpr.deserialize(t.when)}))):(console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService"),Disposable.None)}function createModel(a,e,t){const s=StandaloneServices.get(ILanguageService),o=s.getLanguageIdByMimeType(e)||e;return createTextModel(StandaloneServices.get(IModelService),s,a,o,t)}function setModelLanguage(a,e){const t=StandaloneServices.get(ILanguageService),s=t.getLanguageIdByMimeType(e)||e||PLAINTEXT_LANGUAGE_ID;a.setLanguage(t.createById(s))}function setModelMarkers(a,e,t){a&&StandaloneServices.get(IMarkerService).changeOne(e,a.uri,t)}function removeAllMarkers(a){StandaloneServices.get(IMarkerService).changeAll(a,[])}function getModelMarkers(a){return StandaloneServices.get(IMarkerService).read(a)}function onDidChangeMarkers(a){return StandaloneServices.get(IMarkerService).onMarkerChanged(a)}function getModel(a){return StandaloneServices.get(IModelService).getModel(a)}function getModels(){return StandaloneServices.get(IModelService).getModels()}function onDidCreateModel(a){return StandaloneServices.get(IModelService).onModelAdded(a)}function onWillDisposeModel(a){return StandaloneServices.get(IModelService).onModelRemoved(a)}function onDidChangeModelLanguage(a){return StandaloneServices.get(IModelService).onModelLanguageChanged(t=>{a({model:t.model,oldLanguage:t.oldLanguageId})})}function createWebWorker$1(a){return createWebWorker$2(StandaloneServices.get(IModelService),a)}function colorizeElement(a,e){const t=StandaloneServices.get(ILanguageService),s=StandaloneServices.get(IStandaloneThemeService);return Colorizer.colorizeElement(s,t,a,e).then(()=>{s.registerEditorContainer(a)})}function colorize(a,e,t){const s=StandaloneServices.get(ILanguageService);return StandaloneServices.get(IStandaloneThemeService).registerEditorContainer(mainWindow.document.body),Colorizer.colorize(s,a,e,t)}function colorizeModelLine(a,e,t=4){return StandaloneServices.get(IStandaloneThemeService).registerEditorContainer(mainWindow.document.body),Colorizer.colorizeModelLine(a,e,t)}function getSafeTokenizationSupport(a){const e=TokenizationRegistry.get(a);return e||{getInitialState:()=>NullState,tokenize:(t,s,o)=>nullTokenize(a,o)}}function tokenize(a,e){TokenizationRegistry.getOrCreate(e);const t=getSafeTokenizationSupport(e),s=splitLines(a),o=[];let r=t.getInitialState();for(let l=0,c=s.length;l<c;l++){const d=s[l],u=t.tokenize(d,!0,r);o[l]=u.tokens,r=u.endState}return o}function defineTheme(a,e){StandaloneServices.get(IStandaloneThemeService).defineTheme(a,e)}function setTheme(a){StandaloneServices.get(IStandaloneThemeService).setTheme(a)}function remeasureFonts(){FontMeasurements.clearAllFontInfos()}function registerCommand(a,e){return CommandsRegistry.registerCommand({id:a,handler:e})}function registerLinkOpener(a){return StandaloneServices.get(IOpenerService).registerOpener({async open(t){return typeof t=="string"&&(t=URI.parse(t)),a.open(t)}})}function registerEditorOpener(a){return StandaloneServices.get(ICodeEditorService).registerCodeEditorOpenHandler(async(t,s,o)=>{var c;if(!s)return null;const r=(c=t.options)==null?void 0:c.selection;let l;return r&&typeof r.endLineNumber=="number"&&typeof r.endColumn=="number"?l=r:r&&(l={lineNumber:r.startLineNumber,column:r.startColumn}),await a.openCodeEditor(s,t.resource,l)?s:null})}function createMonacoEditorAPI(){return{create,getEditors,getDiffEditors,onDidCreateEditor,onDidCreateDiffEditor,createDiffEditor,addCommand,addEditorAction,addKeybindingRule,addKeybindingRules,createModel,setModelLanguage,setModelMarkers,getModelMarkers,removeAllMarkers,onDidChangeMarkers,getModels,getModel,onDidCreateModel,onWillDisposeModel,onDidChangeModelLanguage,createWebWorker:createWebWorker$1,colorizeElement,colorize,colorizeModelLine,tokenize,defineTheme,setTheme,remeasureFonts,registerCommand,registerLinkOpener,registerEditorOpener,AccessibilitySupport,ContentWidgetPositionPreference,CursorChangeReason,DefaultEndOfLine,EditorAutoIndentStrategy,EditorOption,EndOfLinePreference,EndOfLineSequence,MinimapPosition,MinimapSectionHeaderStyle,MouseTargetType,OverlayWidgetPositionPreference,OverviewRulerLane,GlyphMarginLane,RenderLineNumbersType,RenderMinimap,ScrollbarVisibility,ScrollType,TextEditorCursorBlinkingStyle,TextEditorCursorStyle,TrackedRangeStickiness,WrappingIndent,InjectedTextCursorStops,PositionAffinity,ShowLightbulbIconMode,TextDirection,ConfigurationChangedEvent,BareFontInfo,FontInfo,TextModelResolvedOptions,FindMatch,ApplyUpdateResult,EditorZoom,createMultiFileDiffEditor,EditorType,EditorOptions}}function isArrayOf(a,e){if(!e||!Array.isArray(e))return!1;for(const t of e)if(!a(t))return!1;return!0}function bool(a,e){return typeof a=="boolean"?a:e}function string(a,e){return typeof a=="string"?a:e}function arrayToHash(a){const e={};for(const t of a)e[t]=!0;return e}function createKeywordMatcher(a,e=!1){e&&(a=a.map(function(s){return s.toLowerCase()}));const t=arrayToHash(a);return e?function(s){return t[s.toLowerCase()]!==void 0&&t.hasOwnProperty(s.toLowerCase())}:function(s){return t[s]!==void 0&&t.hasOwnProperty(s)}}function compileRegExp(a,e,t){e=e.replace(/@@/g,"");let s=0,o;do o=!1,e=e.replace(/@(\w+)/g,function(l,c){o=!0;let d="";if(typeof a[c]=="string")d=a[c];else if(a[c]&&a[c]instanceof RegExp)d=a[c].source;else throw a[c]===void 0?createError(a,"language definition does not contain attribute '"+c+"', used at: "+e):createError(a,"attribute reference '"+c+"' must be a string, used at: "+e);return empty(d)?"":"(?:"+d+")"}),s++;while(o&&s<5);e=e.replace(/\x01/g,"@");const r=(a.ignoreCase?"i":"")+(a.unicode?"u":"");if(t&&e.match(/\$[sS](\d\d?)/g)){let c=null,d=null;return u=>(d&&c===u||(c=u,d=new RegExp(substituteMatchesRe(a,e,u),r)),d)}return new RegExp(e,r)}function selectScrutinee(a,e,t,s){if(s<0)return a;if(s<e.length)return e[s];if(s>=100){s=s-100;const o=t.split(".");if(o.unshift(t),s<o.length)return o[s]}return null}function createGuard(a,e,t,s){let o=-1,r=t,l=t.match(/^\$(([sS]?)(\d\d?)|#)(.*)$/);l&&(l[3]&&(o=parseInt(l[3]),l[2]&&(o=o+100)),r=l[4]);let c="~",d=r;!r||r.length===0?(c="!=",d=""):/^\w*$/.test(d)?c="==":(l=r.match(/^(@|!@|~|!~|==|!=)(.*)$/),l&&(c=l[1],d=l[2]));let u;if((c==="~"||c==="!~")&&/^(\w|\|)*$/.test(d)){const g=createKeywordMatcher(d.split("|"),a.ignoreCase);u=function(f){return c==="~"?g(f):!g(f)}}else if(c==="@"||c==="!@"){const g=a[d];if(!g)throw createError(a,"the @ match target '"+d+"' is not defined, in rule: "+e);if(!isArrayOf(function(p){return typeof p=="string"},g))throw createError(a,"the @ match target '"+d+"' must be an array of strings, in rule: "+e);const f=createKeywordMatcher(g,a.ignoreCase);u=function(p){return c==="@"?f(p):!f(p)}}else if(c==="~"||c==="!~")if(d.indexOf("$")<0){const g=compileRegExp(a,"^"+d+"$",!1);u=function(f){return c==="~"?g.test(f):!g.test(f)}}else u=function(g,f,p,m){return compileRegExp(a,"^"+substituteMatches(a,d,f,p,m)+"$",!1).test(g)};else if(d.indexOf("$")<0){const g=fixCase(a,d);u=function(f){return c==="=="?f===g:f!==g}}else{const g=fixCase(a,d);u=function(f,p,m,_,C){const b=substituteMatches(a,g,p,m,_);return c==="=="?f===b:f!==b}}return o===-1?{name:t,value:s,test:function(g,f,p,m){return u(g,g,f,p,m)}}:{name:t,value:s,test:function(g,f,p,m){const _=selectScrutinee(g,f,p,o);return u(_||"",g,f,p,m)}}}function compileAction(a,e,t){if(t){if(typeof t=="string")return t;if(t.token||t.token===""){if(typeof t.token!="string")throw createError(a,"a 'token' attribute must be of type string, in rule: "+e);{const s={token:t.token};if(t.token.indexOf("$")>=0&&(s.tokenSubst=!0),typeof t.bracket=="string")if(t.bracket==="@open")s.bracket=1;else if(t.bracket==="@close")s.bracket=-1;else throw createError(a,"a 'bracket' attribute must be either '@open' or '@close', in rule: "+e);if(t.next){if(typeof t.next!="string")throw createError(a,"the next state must be a string value in rule: "+e);{let o=t.next;if(!/^(@pop|@push|@popall)$/.test(o)&&(o[0]==="@"&&(o=o.substr(1)),o.indexOf("$")<0&&!stateExists(a,substituteMatches(a,o,"",[],""))))throw createError(a,"the next state '"+t.next+"' is not defined in rule: "+e);s.next=o}}return typeof t.goBack=="number"&&(s.goBack=t.goBack),typeof t.switchTo=="string"&&(s.switchTo=t.switchTo),typeof t.log=="string"&&(s.log=t.log),typeof t.nextEmbedded=="string"&&(s.nextEmbedded=t.nextEmbedded,a.usesEmbedded=!0),s}}else if(Array.isArray(t)){const s=[];for(let o=0,r=t.length;o<r;o++)s[o]=compileAction(a,e,t[o]);return{group:s}}else if(t.cases){const s=[];let o=!1;for(const l in t.cases)if(t.cases.hasOwnProperty(l)){const c=compileAction(a,e,t.cases[l]);l==="@default"||l==="@"||l===""?s.push({test:void 0,value:c,name:l}):l==="@eos"?s.push({test:function(d,u,g,f){return f},value:c,name:l}):s.push(createGuard(a,e,l,c)),o||(o=!isString$1(c)&&(c.hasEmbeddedEndInCases||["@pop","@popall"].includes(c.nextEmbedded||"")))}const r=a.defaultToken;return{hasEmbeddedEndInCases:o,test:function(l,c,d,u){for(const g of s)if(!g.test||g.test(l,c,d,u))return g.value;return r}}}else throw createError(a,"an action must be a string, an object with a 'token' or 'cases' attribute, or an array of actions; in rule: "+e)}else return{token:""}}class Rule{constructor(e){this.regex=new RegExp(""),this.action={token:""},this.matchOnlyAtLineStart=!1,this.name="",this.name=e}setRegex(e,t){let s;if(typeof t=="string")s=t;else if(t instanceof RegExp)s=t.source;else throw createError(e,"rules must start with a match string or regular expression: "+this.name);this.matchOnlyAtLineStart=s.length>0&&s[0]==="^",this.name=this.name+": "+s,this.regex=compileRegExp(e,"^(?:"+(this.matchOnlyAtLineStart?s.substr(1):s)+")",!0)}setAction(e,t){this.action=compileAction(e,this.name,t)}resolveRegex(e){return this.regex instanceof RegExp?this.regex:this.regex(e)}}function compile(a,e){if(!e||typeof e!="object")throw new Error("Monarch: expecting a language definition object");const t={languageId:a,includeLF:bool(e.includeLF,!1),noThrow:!1,maxStack:100,start:typeof e.start=="string"?e.start:null,ignoreCase:bool(e.ignoreCase,!1),unicode:bool(e.unicode,!1),tokenPostfix:string(e.tokenPostfix,"."+a),defaultToken:string(e.defaultToken,"source"),usesEmbedded:!1,stateNames:{},tokenizer:{},brackets:[]},s=e;s.languageId=a,s.includeLF=t.includeLF,s.ignoreCase=t.ignoreCase,s.unicode=t.unicode,s.noThrow=t.noThrow,s.usesEmbedded=t.usesEmbedded,s.stateNames=e.tokenizer,s.defaultToken=t.defaultToken;function o(l,c,d){for(const u of d){let g=u.include;if(g){if(typeof g!="string")throw createError(t,"an 'include' attribute must be a string at: "+l);if(g[0]==="@"&&(g=g.substr(1)),!e.tokenizer[g])throw createError(t,"include target '"+g+"' is not defined at: "+l);o(l+"."+g,c,e.tokenizer[g])}else{const f=new Rule(l);if(Array.isArray(u)&&u.length>=1&&u.length<=3)if(f.setRegex(s,u[0]),u.length>=3)if(typeof u[1]=="string")f.setAction(s,{token:u[1],next:u[2]});else if(typeof u[1]=="object"){const p=u[1];p.next=u[2],f.setAction(s,p)}else throw createError(t,"a next state as the last element of a rule can only be given if the action is either an object or a string, at: "+l);else f.setAction(s,u[1]);else{if(!u.regex)throw createError(t,"a rule must either be an array, or an object with a 'regex' or 'include' field at: "+l);u.name&&typeof u.name=="string"&&(f.name=u.name),u.matchOnlyAtStart&&(f.matchOnlyAtLineStart=bool(u.matchOnlyAtLineStart,!1)),f.setRegex(s,u.regex),f.setAction(s,u.action)}c.push(f)}}}if(!e.tokenizer||typeof e.tokenizer!="object")throw createError(t,"a language definition must define the 'tokenizer' attribute as an object");t.tokenizer=[];for(const l in e.tokenizer)if(e.tokenizer.hasOwnProperty(l)){t.start||(t.start=l);const c=e.tokenizer[l];t.tokenizer[l]=new Array,o("tokenizer."+l,t.tokenizer[l],c)}if(t.usesEmbedded=s.usesEmbedded,e.brackets){if(!Array.isArray(e.brackets))throw createError(t,"the 'brackets' attribute must be defined as an array")}else e.brackets=[{open:"{",close:"}",token:"delimiter.curly"},{open:"[",close:"]",token:"delimiter.square"},{open:"(",close:")",token:"delimiter.parenthesis"},{open:"<",close:">",token:"delimiter.angle"}];const r=[];for(const l of e.brackets){let c=l;if(c&&Array.isArray(c)&&c.length===3&&(c={token:c[2],open:c[0],close:c[1]}),c.open===c.close)throw createError(t,"open and close brackets in a 'brackets' attribute must be different: "+c.open+`
 hint: use the 'bracket' attribute if matching on equal brackets is required.`);if(typeof c.open=="string"&&typeof c.token=="string"&&typeof c.close=="string")r.push({token:c.token+t.tokenPostfix,open:fixCase(t,c.open),close:fixCase(t,c.close)});else throw createError(t,"every element in the 'brackets' array must be a '{open,close,token}' object or array")}return t.brackets=r,t.noThrow=!0,t}function register(a){ModesRegistry.registerLanguage(a)}function getLanguages(){let a=[];return a=a.concat(ModesRegistry.getLanguages()),a}function getEncodedLanguageId(a){return StandaloneServices.get(ILanguageService).languageIdCodec.encodeLanguageId(a)}function onLanguage(a,e){return StandaloneServices.withServices(()=>{const s=StandaloneServices.get(ILanguageService).onDidRequestRichLanguageFeatures(o=>{o===a&&(s.dispose(),e())});return s})}function onLanguageEncountered(a,e){return StandaloneServices.withServices(()=>{const s=StandaloneServices.get(ILanguageService).onDidRequestBasicLanguageFeatures(o=>{o===a&&(s.dispose(),e())});return s})}function setLanguageConfiguration(a,e){if(!StandaloneServices.get(ILanguageService).isRegisteredLanguageId(a))throw new Error(`Cannot set configuration for unknown language ${a}`);return StandaloneServices.get(ILanguageConfigurationService).register(a,e,100)}class EncodedTokenizationSupportAdapter{constructor(e,t){this._languageId=e,this._actual=t}dispose(){}getInitialState(){return this._actual.getInitialState()}tokenize(e,t,s){if(typeof this._actual.tokenize=="function")return TokenizationSupportAdapter.adaptTokenize(this._languageId,this._actual,e,s);throw new Error("Not supported!")}tokenizeEncoded(e,t,s){const o=this._actual.tokenizeEncoded(e,s);return new EncodedTokenizationResult(o.tokens,o.endState)}}class TokenizationSupportAdapter{constructor(e,t,s,o){this._languageId=e,this._actual=t,this._languageService=s,this._standaloneThemeService=o}dispose(){}getInitialState(){return this._actual.getInitialState()}static _toClassicTokens(e,t){const s=[];let o=0;for(let r=0,l=e.length;r<l;r++){const c=e[r];let d=c.startIndex;r===0?d=0:d<o&&(d=o),s[r]=new Token$2(d,c.scopes,t),o=d}return s}static adaptTokenize(e,t,s,o){const r=t.tokenize(s,o),l=TokenizationSupportAdapter._toClassicTokens(r.tokens,e);let c;return r.endState.equals(o)?c=o:c=r.endState,new TokenizationResult(l,c)}tokenize(e,t,s){return TokenizationSupportAdapter.adaptTokenize(this._languageId,this._actual,e,s)}_toBinaryTokens(e,t){const s=e.encodeLanguageId(this._languageId),o=this._standaloneThemeService.getColorTheme().tokenTheme,r=[];let l=0,c=0;for(let u=0,g=t.length;u<g;u++){const f=t[u],p=o.match(s,f.scopes)|1024;if(l>0&&r[l-1]===p)continue;let m=f.startIndex;u===0?m=0:m<c&&(m=c),r[l++]=m,r[l++]=p,c=m}const d=new Uint32Array(l);for(let u=0;u<l;u++)d[u]=r[u];return d}tokenizeEncoded(e,t,s){const o=this._actual.tokenize(e,s),r=this._toBinaryTokens(this._languageService.languageIdCodec,o.tokens);let l;return o.endState.equals(s)?l=s:l=o.endState,new EncodedTokenizationResult(r,l)}}function isATokensProvider(a){return typeof a.getInitialState=="function"}function isEncodedTokensProvider(a){return"tokenizeEncoded"in a}function isThenable(a){return a&&typeof a.then=="function"}function setColorMap(a){const e=StandaloneServices.get(IStandaloneThemeService);if(a){const t=[null];for(let s=1,o=a.length;s<o;s++)t[s]=Color.fromHex(a[s]);e.setColorMapOverride(t)}else e.setColorMapOverride(null)}function createTokenizationSupportAdapter(a,e){return isEncodedTokensProvider(e)?new EncodedTokenizationSupportAdapter(a,e):new TokenizationSupportAdapter(a,e,StandaloneServices.get(ILanguageService),StandaloneServices.get(IStandaloneThemeService))}function registerTokensProviderFactory(a,e){const t=new LazyTokenizationSupport(async()=>{const s=await Promise.resolve(e.create());return s?isATokensProvider(s)?createTokenizationSupportAdapter(a,s):new MonarchTokenizer(StandaloneServices.get(ILanguageService),StandaloneServices.get(IStandaloneThemeService),a,compile(a,s),StandaloneServices.get(IConfigurationService)):null});return TokenizationRegistry.registerFactory(a,t)}function setTokensProvider(a,e){if(!StandaloneServices.get(ILanguageService).isRegisteredLanguageId(a))throw new Error(`Cannot set tokens provider for unknown language ${a}`);return isThenable(e)?registerTokensProviderFactory(a,{create:()=>e}):TokenizationRegistry.register(a,createTokenizationSupportAdapter(a,e))}function setMonarchTokensProvider(a,e){const t=s=>new MonarchTokenizer(StandaloneServices.get(ILanguageService),StandaloneServices.get(IStandaloneThemeService),a,compile(a,s),StandaloneServices.get(IConfigurationService));return isThenable(e)?registerTokensProviderFactory(a,{create:()=>e}):TokenizationRegistry.register(a,t(e))}function registerReferenceProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).referenceProvider.register(a,e)}function registerRenameProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).renameProvider.register(a,e)}function registerNewSymbolNameProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).newSymbolNamesProvider.register(a,e)}function registerSignatureHelpProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).signatureHelpProvider.register(a,e)}function registerHoverProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).hoverProvider.register(a,{provideHover:async(s,o,r,l)=>{const c=s.getWordAtPosition(o);return Promise.resolve(e.provideHover(s,o,r,l)).then(d=>{if(d)return!d.range&&c&&(d.range=new Range$2(o.lineNumber,c.startColumn,o.lineNumber,c.endColumn)),d.range||(d.range=new Range$2(o.lineNumber,o.column,o.lineNumber,o.column)),d})}})}function registerDocumentSymbolProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).documentSymbolProvider.register(a,e)}function registerDocumentHighlightProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).documentHighlightProvider.register(a,e)}function registerLinkedEditingRangeProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).linkedEditingRangeProvider.register(a,e)}function registerDefinitionProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).definitionProvider.register(a,e)}function registerImplementationProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).implementationProvider.register(a,e)}function registerTypeDefinitionProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).typeDefinitionProvider.register(a,e)}function registerCodeLensProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).codeLensProvider.register(a,e)}function registerCodeActionProvider(a,e,t){return StandaloneServices.get(ILanguageFeaturesService).codeActionProvider.register(a,{providedCodeActionKinds:t==null?void 0:t.providedCodeActionKinds,documentation:t==null?void 0:t.documentation,provideCodeActions:(o,r,l,c)=>{const u=StandaloneServices.get(IMarkerService).read({resource:o.uri}).filter(g=>Range$2.areIntersectingOrTouching(g,r));return e.provideCodeActions(o,r,{markers:u,only:l.only,trigger:l.trigger},c)},resolveCodeAction:e.resolveCodeAction})}function registerDocumentFormattingEditProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).documentFormattingEditProvider.register(a,e)}function registerDocumentRangeFormattingEditProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).documentRangeFormattingEditProvider.register(a,e)}function registerOnTypeFormattingEditProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).onTypeFormattingEditProvider.register(a,e)}function registerLinkProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).linkProvider.register(a,e)}function registerCompletionItemProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).completionProvider.register(a,e)}function registerColorProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).colorProvider.register(a,e)}function registerFoldingRangeProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).foldingRangeProvider.register(a,e)}function registerDeclarationProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).declarationProvider.register(a,e)}function registerSelectionRangeProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).selectionRangeProvider.register(a,e)}function registerDocumentSemanticTokensProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).documentSemanticTokensProvider.register(a,e)}function registerDocumentRangeSemanticTokensProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).documentRangeSemanticTokensProvider.register(a,e)}function registerInlineCompletionsProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).inlineCompletionsProvider.register(a,e)}function registerInlayHintsProvider(a,e){return StandaloneServices.get(ILanguageFeaturesService).inlayHintsProvider.register(a,e)}function createMonacoLanguagesAPI(){return{register,getLanguages,onLanguage,onLanguageEncountered,getEncodedLanguageId,setLanguageConfiguration,setColorMap,registerTokensProviderFactory,setTokensProvider,setMonarchTokensProvider,registerReferenceProvider,registerRenameProvider,registerNewSymbolNameProvider,registerCompletionItemProvider,registerSignatureHelpProvider,registerHoverProvider,registerDocumentSymbolProvider,registerDocumentHighlightProvider,registerLinkedEditingRangeProvider,registerDefinitionProvider,registerImplementationProvider,registerTypeDefinitionProvider,registerCodeLensProvider,registerCodeActionProvider,registerDocumentFormattingEditProvider,registerDocumentRangeFormattingEditProvider,registerOnTypeFormattingEditProvider,registerLinkProvider,registerColorProvider,registerFoldingRangeProvider,registerDeclarationProvider,registerSelectionRangeProvider,registerDocumentSemanticTokensProvider,registerDocumentRangeSemanticTokensProvider,registerInlineCompletionsProvider,registerInlayHintsProvider,DocumentHighlightKind,CompletionItemKind,CompletionItemTag,CompletionItemInsertTextRule,SymbolKind,SymbolTag,IndentAction,CompletionTriggerKind,SignatureHelpTriggerKind,InlayHintKind,InlineCompletionTriggerKind,CodeActionTriggerType,NewSymbolNameTag,NewSymbolNameTriggerKind,PartialAcceptTriggerKind,HoverVerbosityAction,InlineCompletionEndOfLifeReasonKind,InlineCompletionDisplayLocationKind,FoldingRangeKind,SelectedSuggestionInfo,EditDeltaInfo}}EditorOptions.wrappingIndent.defaultValue=0;EditorOptions.glyphMargin.defaultValue=!1;EditorOptions.autoIndent.defaultValue=3;EditorOptions.overviewRulerLanes.defaultValue=2;FormattingConflicts.setFormatterSelector((a,e,t)=>Promise.resolve(a[0]));const api=createMonacoBaseAPI();api.editor=createMonacoEditorAPI();api.languages=createMonacoLanguagesAPI();const CancellationTokenSource=api.CancellationTokenSource,Emitter=api.Emitter,KeyCode=api.KeyCode,KeyMod=api.KeyMod,Position=api.Position,Range=api.Range,Selection=api.Selection,SelectionDirection=api.SelectionDirection,MarkerSeverity=api.MarkerSeverity,MarkerTag=api.MarkerTag,Uri=api.Uri,Token=api.Token,editor=api.editor,languages=api.languages,monacoEnvironment=globalThis.MonacoEnvironment;(monacoEnvironment!=null&&monacoEnvironment.globalAPI||typeof globalThis.define=="function"&&globalThis.define.amd)&&(globalThis.monaco=api);typeof globalThis.require<"u"&&typeof globalThis.require.config=="function"&&globalThis.require.config({ignoreDuplicateModules:["vscode-languageserver-types","vscode-languageserver-types/main","vscode-languageserver-textdocument","vscode-languageserver-textdocument/main","vscode-nls","vscode-nls/vscode-nls","jsonc-parser","jsonc-parser/main","vscode-uri","vscode-uri/index","vs/basic-languages/typescript/typescript"]});const monaco_editor_core_star=Object.freeze(Object.defineProperty({__proto__:null,CancellationTokenSource,Emitter,KeyCode,KeyMod,MarkerSeverity,MarkerTag,Position,Range,Selection,SelectionDirection,Token,Uri,editor,languages},Symbol.toStringTag,{value:"Module"}));/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.54.0(7c2310116c57517348bbd868a21139f32454be22)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/var __defProp$2=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__getOwnPropNames$2=Object.getOwnPropertyNames,__hasOwnProp$2=Object.prototype.hasOwnProperty,__copyProps$2=(a,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of __getOwnPropNames$2(e))!__hasOwnProp$2.call(a,o)&&o!==t&&__defProp$2(a,o,{get:()=>e[o],enumerable:!(s=__getOwnPropDesc$2(e,o))||s.enumerable});return a},__reExport$2=(a,e,t)=>(__copyProps$2(a,e,"default"),t&&__copyProps$2(t,e,"default")),monaco_editor_core_exports$2={};__reExport$2(monaco_editor_core_exports$2,monaco_editor_core_star);var languageDefinitions={},lazyLanguageLoaders={},LazyLanguageLoader=class Dr{static getOrCreate(e){return lazyLanguageLoaders[e]||(lazyLanguageLoaders[e]=new Dr(e)),lazyLanguageLoaders[e]}constructor(e){this._languageId=e,this._loadingTriggered=!1,this._lazyLoadPromise=new Promise((t,s)=>{this._lazyLoadPromiseResolve=t,this._lazyLoadPromiseReject=s})}load(){return this._loadingTriggered||(this._loadingTriggered=!0,languageDefinitions[this._languageId].loader().then(e=>this._lazyLoadPromiseResolve(e),e=>this._lazyLoadPromiseReject(e))),this._lazyLoadPromise}};function registerLanguage(a){const e=a.id;languageDefinitions[e]=a,monaco_editor_core_exports$2.languages.register(a);const t=LazyLanguageLoader.getOrCreate(e);monaco_editor_core_exports$2.languages.registerTokensProviderFactory(e,{create:async()=>(await t.load()).language}),monaco_editor_core_exports$2.languages.onLanguageEncountered(e,async()=>{const s=await t.load();monaco_editor_core_exports$2.languages.setLanguageConfiguration(e,s.conf)})}registerLanguage({id:"javascript",extensions:[".js",".es6",".jsx",".mjs",".cjs"],firstLine:"^#!.*\\bnode",filenames:["jakefile"],aliases:["JavaScript","javascript","js"],mimetypes:["text/javascript"],loader:()=>__vitePreload(()=>import("./javascript-98c157d0.js"),[])});/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.54.0(7c2310116c57517348bbd868a21139f32454be22)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/var __defProp$1=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__getOwnPropNames$1=Object.getOwnPropertyNames,__hasOwnProp$1=Object.prototype.hasOwnProperty,__copyProps$1=(a,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of __getOwnPropNames$1(e))!__hasOwnProp$1.call(a,o)&&o!==t&&__defProp$1(a,o,{get:()=>e[o],enumerable:!(s=__getOwnPropDesc$1(e,o))||s.enumerable});return a},__reExport$1=(a,e,t)=>(__copyProps$1(a,e,"default"),t&&__copyProps$1(t,e,"default")),typescriptVersion="5.4.5",monaco_editor_core_exports$1={};__reExport$1(monaco_editor_core_exports$1,monaco_editor_core_star);var ModuleKind=(a=>(a[a.None=0]="None",a[a.CommonJS=1]="CommonJS",a[a.AMD=2]="AMD",a[a.UMD=3]="UMD",a[a.System=4]="System",a[a.ES2015=5]="ES2015",a[a.ESNext=99]="ESNext",a))(ModuleKind||{}),JsxEmit=(a=>(a[a.None=0]="None",a[a.Preserve=1]="Preserve",a[a.React=2]="React",a[a.ReactNative=3]="ReactNative",a[a.ReactJSX=4]="ReactJSX",a[a.ReactJSXDev=5]="ReactJSXDev",a))(JsxEmit||{}),NewLineKind=(a=>(a[a.CarriageReturnLineFeed=0]="CarriageReturnLineFeed",a[a.LineFeed=1]="LineFeed",a))(NewLineKind||{}),ScriptTarget=(a=>(a[a.ES3=0]="ES3",a[a.ES5=1]="ES5",a[a.ES2015=2]="ES2015",a[a.ES2016=3]="ES2016",a[a.ES2017=4]="ES2017",a[a.ES2018=5]="ES2018",a[a.ES2019=6]="ES2019",a[a.ES2020=7]="ES2020",a[a.ESNext=99]="ESNext",a[a.JSON=100]="JSON",a[a.Latest=99]="Latest",a))(ScriptTarget||{}),ModuleResolutionKind=(a=>(a[a.Classic=1]="Classic",a[a.NodeJs=2]="NodeJs",a))(ModuleResolutionKind||{}),LanguageServiceDefaultsImpl=class{constructor(a,e,t,s,o){this._onDidChange=new monaco_editor_core_exports$1.Emitter,this._onDidExtraLibsChange=new monaco_editor_core_exports$1.Emitter,this._extraLibs=Object.create(null),this._removedExtraLibs=Object.create(null),this._eagerModelSync=!1,this.setCompilerOptions(a),this.setDiagnosticsOptions(e),this.setWorkerOptions(t),this.setInlayHintsOptions(s),this.setModeConfiguration(o),this._onDidExtraLibsChangeTimeout=-1}get onDidChange(){return this._onDidChange.event}get onDidExtraLibsChange(){return this._onDidExtraLibsChange.event}get modeConfiguration(){return this._modeConfiguration}get workerOptions(){return this._workerOptions}get inlayHintsOptions(){return this._inlayHintsOptions}getExtraLibs(){return this._extraLibs}addExtraLib(a,e){let t;if(typeof e>"u"?t=`ts:extralib-${Math.random().toString(36).substring(2,15)}`:t=e,this._extraLibs[t]&&this._extraLibs[t].content===a)return{dispose:()=>{}};let s=1;return this._removedExtraLibs[t]&&(s=this._removedExtraLibs[t]+1),this._extraLibs[t]&&(s=this._extraLibs[t].version+1),this._extraLibs[t]={content:a,version:s},this._fireOnDidExtraLibsChangeSoon(),{dispose:()=>{let o=this._extraLibs[t];o&&o.version===s&&(delete this._extraLibs[t],this._removedExtraLibs[t]=s,this._fireOnDidExtraLibsChangeSoon())}}}setExtraLibs(a){for(const e in this._extraLibs)this._removedExtraLibs[e]=this._extraLibs[e].version;if(this._extraLibs=Object.create(null),a&&a.length>0)for(const e of a){const t=e.filePath||`ts:extralib-${Math.random().toString(36).substring(2,15)}`,s=e.content;let o=1;this._removedExtraLibs[t]&&(o=this._removedExtraLibs[t]+1),this._extraLibs[t]={content:s,version:o}}this._fireOnDidExtraLibsChangeSoon()}_fireOnDidExtraLibsChangeSoon(){this._onDidExtraLibsChangeTimeout===-1&&(this._onDidExtraLibsChangeTimeout=window.setTimeout(()=>{this._onDidExtraLibsChangeTimeout=-1,this._onDidExtraLibsChange.fire(void 0)},0))}getCompilerOptions(){return this._compilerOptions}setCompilerOptions(a){this._compilerOptions=a||Object.create(null),this._onDidChange.fire(void 0)}getDiagnosticsOptions(){return this._diagnosticsOptions}setDiagnosticsOptions(a){this._diagnosticsOptions=a||Object.create(null),this._onDidChange.fire(void 0)}setWorkerOptions(a){this._workerOptions=a||Object.create(null),this._onDidChange.fire(void 0)}setInlayHintsOptions(a){this._inlayHintsOptions=a||Object.create(null),this._onDidChange.fire(void 0)}setMaximumWorkerIdleTime(a){}setEagerModelSync(a){this._eagerModelSync=a}getEagerModelSync(){return this._eagerModelSync}setModeConfiguration(a){this._modeConfiguration=a||Object.create(null),this._onDidChange.fire(void 0)}},typescriptVersion2=typescriptVersion,modeConfigurationDefault={completionItems:!0,hovers:!0,documentSymbols:!0,definitions:!0,references:!0,documentHighlights:!0,rename:!0,diagnostics:!0,documentRangeFormattingEdits:!0,signatureHelp:!0,onTypeFormattingEdits:!0,codeActions:!0,inlayHints:!0},typescriptDefaults=new LanguageServiceDefaultsImpl({allowNonTsExtensions:!0,target:99},{noSemanticValidation:!1,noSyntaxValidation:!1,onlyVisible:!1},{},{},modeConfigurationDefault),javascriptDefaults=new LanguageServiceDefaultsImpl({allowNonTsExtensions:!0,allowJs:!0,target:99},{noSemanticValidation:!0,noSyntaxValidation:!1,onlyVisible:!1},{},{},modeConfigurationDefault),getTypeScriptWorker$1=()=>getMode().then(a=>a.getTypeScriptWorker()),getJavaScriptWorker$1=()=>getMode().then(a=>a.getJavaScriptWorker());monaco_editor_core_exports$1.languages.typescript={ModuleKind,JsxEmit,NewLineKind,ScriptTarget,ModuleResolutionKind,typescriptVersion:typescriptVersion2,typescriptDefaults,javascriptDefaults,getTypeScriptWorker:getTypeScriptWorker$1,getJavaScriptWorker:getJavaScriptWorker$1};function getMode(){return __vitePreload(()=>Promise.resolve().then(()=>tsMode),void 0)}monaco_editor_core_exports$1.languages.onLanguage("typescript",()=>getMode().then(a=>a.setupTypeScript(typescriptDefaults)));monaco_editor_core_exports$1.languages.onLanguage("javascript",()=>getMode().then(a=>a.setupJavaScript(javascriptDefaults)));/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.54.0(7c2310116c57517348bbd868a21139f32454be22)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__copyProps=(a,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of __getOwnPropNames(e))!__hasOwnProp.call(a,o)&&o!==t&&__defProp(a,o,{get:()=>e[o],enumerable:!(s=__getOwnPropDesc(e,o))||s.enumerable});return a},__reExport=(a,e,t)=>(__copyProps(a,e,"default"),t&&__copyProps(t,e,"default")),monaco_editor_core_exports={};__reExport(monaco_editor_core_exports,monaco_editor_core_star);function createTrustedTypesPolicy(a,e){var s;const t=globalThis.MonacoEnvironment;if(t!=null&&t.createTrustedTypesPolicy)try{return t.createTrustedTypesPolicy(a,e)}catch(o){console.error(o);return}try{return(s=globalThis.trustedTypes)==null?void 0:s.createPolicy(a,e)}catch(o){console.error(o);return}}var ttPolicy;typeof self=="object"&&self.constructor&&self.constructor.name==="DedicatedWorkerGlobalScope"&&globalThis.workerttPolicy!==void 0?ttPolicy=globalThis.workerttPolicy:ttPolicy=createTrustedTypesPolicy("defaultWorkerFactory",{createScriptURL:a=>a});function getWorker(a){const e=a.label,t=globalThis.MonacoEnvironment;if(t){if(typeof t.getWorker=="function")return t.getWorker("workerMain.js",e);if(typeof t.getWorkerUrl=="function"){const s=t.getWorkerUrl("workerMain.js",e);return new Worker(ttPolicy?ttPolicy.createScriptURL(s):s,{name:e,type:"module"})}}throw new Error("You must define a function MonacoEnvironment.getWorkerUrl or MonacoEnvironment.getWorker")}function createWebWorker(a){const e=Promise.resolve(getWorker({label:a.label??"monaco-editor-worker",moduleId:a.moduleId})).then(t=>(t.postMessage("ignore"),t.postMessage(a.createData),t));return monaco_editor_core_exports.editor.createWebWorker({worker:e,host:a.host,keepIdleModels:a.keepIdleModels})}var WorkerManager=class{constructor(a,e){this._modeId=a,this._defaults=e,this._worker=null,this._client=null,this._configChangeListener=this._defaults.onDidChange(()=>this._stopWorker()),this._updateExtraLibsToken=0,this._extraLibsChangeListener=this._defaults.onDidExtraLibsChange(()=>this._updateExtraLibs())}dispose(){this._configChangeListener.dispose(),this._extraLibsChangeListener.dispose(),this._stopWorker()}_stopWorker(){this._worker&&(this._worker.dispose(),this._worker=null),this._client=null}async _updateExtraLibs(){if(!this._worker)return;const a=++this._updateExtraLibsToken,e=await this._worker.getProxy();this._updateExtraLibsToken===a&&e.updateExtraLibs(this._defaults.getExtraLibs())}_getClient(){return this._client||(this._client=(async()=>(this._worker=createWebWorker({moduleId:"vs/language/typescript/tsWorker",label:this._modeId,keepIdleModels:!0,createData:{compilerOptions:this._defaults.getCompilerOptions(),extraLibs:this._defaults.getExtraLibs(),customWorkerPath:this._defaults.workerOptions.customWorkerPath,inlayHintsOptions:this._defaults.inlayHintsOptions}}),this._defaults.getEagerModelSync()?await this._worker.withSyncedResources(monaco_editor_core_exports.editor.getModels().filter(a=>a.getLanguageId()===this._modeId).map(a=>a.uri)):await this._worker.getProxy()))()),this._client}async getLanguageServiceWorker(...a){const e=await this._getClient();return this._worker&&await this._worker.withSyncedResources(a),e}},libFileSet={};libFileSet["lib.d.ts"]=!0;libFileSet["lib.decorators.d.ts"]=!0;libFileSet["lib.decorators.legacy.d.ts"]=!0;libFileSet["lib.dom.asynciterable.d.ts"]=!0;libFileSet["lib.dom.d.ts"]=!0;libFileSet["lib.dom.iterable.d.ts"]=!0;libFileSet["lib.es2015.collection.d.ts"]=!0;libFileSet["lib.es2015.core.d.ts"]=!0;libFileSet["lib.es2015.d.ts"]=!0;libFileSet["lib.es2015.generator.d.ts"]=!0;libFileSet["lib.es2015.iterable.d.ts"]=!0;libFileSet["lib.es2015.promise.d.ts"]=!0;libFileSet["lib.es2015.proxy.d.ts"]=!0;libFileSet["lib.es2015.reflect.d.ts"]=!0;libFileSet["lib.es2015.symbol.d.ts"]=!0;libFileSet["lib.es2015.symbol.wellknown.d.ts"]=!0;libFileSet["lib.es2016.array.include.d.ts"]=!0;libFileSet["lib.es2016.d.ts"]=!0;libFileSet["lib.es2016.full.d.ts"]=!0;libFileSet["lib.es2016.intl.d.ts"]=!0;libFileSet["lib.es2017.d.ts"]=!0;libFileSet["lib.es2017.date.d.ts"]=!0;libFileSet["lib.es2017.full.d.ts"]=!0;libFileSet["lib.es2017.intl.d.ts"]=!0;libFileSet["lib.es2017.object.d.ts"]=!0;libFileSet["lib.es2017.sharedmemory.d.ts"]=!0;libFileSet["lib.es2017.string.d.ts"]=!0;libFileSet["lib.es2017.typedarrays.d.ts"]=!0;libFileSet["lib.es2018.asyncgenerator.d.ts"]=!0;libFileSet["lib.es2018.asynciterable.d.ts"]=!0;libFileSet["lib.es2018.d.ts"]=!0;libFileSet["lib.es2018.full.d.ts"]=!0;libFileSet["lib.es2018.intl.d.ts"]=!0;libFileSet["lib.es2018.promise.d.ts"]=!0;libFileSet["lib.es2018.regexp.d.ts"]=!0;libFileSet["lib.es2019.array.d.ts"]=!0;libFileSet["lib.es2019.d.ts"]=!0;libFileSet["lib.es2019.full.d.ts"]=!0;libFileSet["lib.es2019.intl.d.ts"]=!0;libFileSet["lib.es2019.object.d.ts"]=!0;libFileSet["lib.es2019.string.d.ts"]=!0;libFileSet["lib.es2019.symbol.d.ts"]=!0;libFileSet["lib.es2020.bigint.d.ts"]=!0;libFileSet["lib.es2020.d.ts"]=!0;libFileSet["lib.es2020.date.d.ts"]=!0;libFileSet["lib.es2020.full.d.ts"]=!0;libFileSet["lib.es2020.intl.d.ts"]=!0;libFileSet["lib.es2020.number.d.ts"]=!0;libFileSet["lib.es2020.promise.d.ts"]=!0;libFileSet["lib.es2020.sharedmemory.d.ts"]=!0;libFileSet["lib.es2020.string.d.ts"]=!0;libFileSet["lib.es2020.symbol.wellknown.d.ts"]=!0;libFileSet["lib.es2021.d.ts"]=!0;libFileSet["lib.es2021.full.d.ts"]=!0;libFileSet["lib.es2021.intl.d.ts"]=!0;libFileSet["lib.es2021.promise.d.ts"]=!0;libFileSet["lib.es2021.string.d.ts"]=!0;libFileSet["lib.es2021.weakref.d.ts"]=!0;libFileSet["lib.es2022.array.d.ts"]=!0;libFileSet["lib.es2022.d.ts"]=!0;libFileSet["lib.es2022.error.d.ts"]=!0;libFileSet["lib.es2022.full.d.ts"]=!0;libFileSet["lib.es2022.intl.d.ts"]=!0;libFileSet["lib.es2022.object.d.ts"]=!0;libFileSet["lib.es2022.regexp.d.ts"]=!0;libFileSet["lib.es2022.sharedmemory.d.ts"]=!0;libFileSet["lib.es2022.string.d.ts"]=!0;libFileSet["lib.es2023.array.d.ts"]=!0;libFileSet["lib.es2023.collection.d.ts"]=!0;libFileSet["lib.es2023.d.ts"]=!0;libFileSet["lib.es2023.full.d.ts"]=!0;libFileSet["lib.es5.d.ts"]=!0;libFileSet["lib.es6.d.ts"]=!0;libFileSet["lib.esnext.collection.d.ts"]=!0;libFileSet["lib.esnext.d.ts"]=!0;libFileSet["lib.esnext.decorators.d.ts"]=!0;libFileSet["lib.esnext.disposable.d.ts"]=!0;libFileSet["lib.esnext.full.d.ts"]=!0;libFileSet["lib.esnext.intl.d.ts"]=!0;libFileSet["lib.esnext.object.d.ts"]=!0;libFileSet["lib.esnext.promise.d.ts"]=!0;libFileSet["lib.scripthost.d.ts"]=!0;libFileSet["lib.webworker.asynciterable.d.ts"]=!0;libFileSet["lib.webworker.d.ts"]=!0;libFileSet["lib.webworker.importscripts.d.ts"]=!0;libFileSet["lib.webworker.iterable.d.ts"]=!0;function flattenDiagnosticMessageText(a,e,t=0){if(typeof a=="string")return a;if(a===void 0)return"";let s="";if(t){s+=e;for(let o=0;o<t;o++)s+="  "}if(s+=a.messageText,t++,a.next)for(const o of a.next)s+=flattenDiagnosticMessageText(o,e,t);return s}function displayPartsToString(a){return a?a.map(e=>e.text).join(""):""}var Adapter=class{constructor(a){this._worker=a}_textSpanToRange(a,e){let t=a.getPositionAt(e.start),s=a.getPositionAt(e.start+e.length),{lineNumber:o,column:r}=t,{lineNumber:l,column:c}=s;return{startLineNumber:o,startColumn:r,endLineNumber:l,endColumn:c}}},LibFiles=class{constructor(a){this._worker=a,this._libFiles={},this._hasFetchedLibFiles=!1,this._fetchLibFilesPromise=null}isLibFile(a){return a&&a.path.indexOf("/lib.")===0?!!libFileSet[a.path.slice(1)]:!1}getOrCreateModel(a){const e=monaco_editor_core_exports.Uri.parse(a),t=monaco_editor_core_exports.editor.getModel(e);if(t)return t;if(this.isLibFile(e)&&this._hasFetchedLibFiles)return monaco_editor_core_exports.editor.createModel(this._libFiles[e.path.slice(1)],"typescript",e);const s=typescriptDefaults.getExtraLibs()[a];return s?monaco_editor_core_exports.editor.createModel(s.content,"typescript",e):null}_containsLibFile(a){for(let e of a)if(this.isLibFile(e))return!0;return!1}async fetchLibFilesIfNecessary(a){this._containsLibFile(a)&&await this._fetchLibFiles()}_fetchLibFiles(){return this._fetchLibFilesPromise||(this._fetchLibFilesPromise=this._worker().then(a=>a.getLibFiles()).then(a=>{this._hasFetchedLibFiles=!0,this._libFiles=a})),this._fetchLibFilesPromise}},DiagnosticsAdapter=class extends Adapter{constructor(a,e,t,s){super(s),this._libFiles=a,this._defaults=e,this._selector=t,this._disposables=[],this._listener=Object.create(null);const o=c=>{if(c.getLanguageId()!==t)return;const d=()=>{const{onlyVisible:p}=this._defaults.getDiagnosticsOptions();p?c.isAttachedToEditor()&&this._doValidate(c):this._doValidate(c)};let u;const g=c.onDidChangeContent(()=>{clearTimeout(u),u=window.setTimeout(d,500)}),f=c.onDidChangeAttached(()=>{const{onlyVisible:p}=this._defaults.getDiagnosticsOptions();p&&(c.isAttachedToEditor()?d():monaco_editor_core_exports.editor.setModelMarkers(c,this._selector,[]))});this._listener[c.uri.toString()]={dispose(){g.dispose(),f.dispose(),clearTimeout(u)}},d()},r=c=>{monaco_editor_core_exports.editor.setModelMarkers(c,this._selector,[]);const d=c.uri.toString();this._listener[d]&&(this._listener[d].dispose(),delete this._listener[d])};this._disposables.push(monaco_editor_core_exports.editor.onDidCreateModel(c=>o(c))),this._disposables.push(monaco_editor_core_exports.editor.onWillDisposeModel(r)),this._disposables.push(monaco_editor_core_exports.editor.onDidChangeModelLanguage(c=>{r(c.model),o(c.model)})),this._disposables.push({dispose(){for(const c of monaco_editor_core_exports.editor.getModels())r(c)}});const l=()=>{for(const c of monaco_editor_core_exports.editor.getModels())r(c),o(c)};this._disposables.push(this._defaults.onDidChange(l)),this._disposables.push(this._defaults.onDidExtraLibsChange(l)),monaco_editor_core_exports.editor.getModels().forEach(c=>o(c))}dispose(){this._disposables.forEach(a=>a&&a.dispose()),this._disposables=[]}async _doValidate(a){const e=await this._worker(a.uri);if(a.isDisposed())return;const t=[],{noSyntaxValidation:s,noSemanticValidation:o,noSuggestionDiagnostics:r}=this._defaults.getDiagnosticsOptions();s||t.push(e.getSyntacticDiagnostics(a.uri.toString())),o||t.push(e.getSemanticDiagnostics(a.uri.toString())),r||t.push(e.getSuggestionDiagnostics(a.uri.toString()));const l=await Promise.all(t);if(!l||a.isDisposed())return;const c=l.reduce((u,g)=>g.concat(u),[]).filter(u=>(this._defaults.getDiagnosticsOptions().diagnosticCodesToIgnore||[]).indexOf(u.code)===-1),d=c.map(u=>u.relatedInformation||[]).reduce((u,g)=>g.concat(u),[]).map(u=>u.file?monaco_editor_core_exports.Uri.parse(u.file.fileName):null);await this._libFiles.fetchLibFilesIfNecessary(d),!a.isDisposed()&&monaco_editor_core_exports.editor.setModelMarkers(a,this._selector,c.map(u=>this._convertDiagnostics(a,u)))}_convertDiagnostics(a,e){const t=e.start||0,s=e.length||1,{lineNumber:o,column:r}=a.getPositionAt(t),{lineNumber:l,column:c}=a.getPositionAt(t+s),d=[];return e.reportsUnnecessary&&d.push(monaco_editor_core_exports.MarkerTag.Unnecessary),e.reportsDeprecated&&d.push(monaco_editor_core_exports.MarkerTag.Deprecated),{severity:this._tsDiagnosticCategoryToMarkerSeverity(e.category),startLineNumber:o,startColumn:r,endLineNumber:l,endColumn:c,message:flattenDiagnosticMessageText(e.messageText,`
`),code:e.code.toString(),tags:d,relatedInformation:this._convertRelatedInformation(a,e.relatedInformation)}}_convertRelatedInformation(a,e){if(!e)return[];const t=[];return e.forEach(s=>{let o=a;if(s.file&&(o=this._libFiles.getOrCreateModel(s.file.fileName)),!o)return;const r=s.start||0,l=s.length||1,{lineNumber:c,column:d}=o.getPositionAt(r),{lineNumber:u,column:g}=o.getPositionAt(r+l);t.push({resource:o.uri,startLineNumber:c,startColumn:d,endLineNumber:u,endColumn:g,message:flattenDiagnosticMessageText(s.messageText,`
`)})}),t}_tsDiagnosticCategoryToMarkerSeverity(a){switch(a){case 1:return monaco_editor_core_exports.MarkerSeverity.Error;case 3:return monaco_editor_core_exports.MarkerSeverity.Info;case 0:return monaco_editor_core_exports.MarkerSeverity.Warning;case 2:return monaco_editor_core_exports.MarkerSeverity.Hint}return monaco_editor_core_exports.MarkerSeverity.Info}},SuggestAdapter=class qn extends Adapter{get triggerCharacters(){return["."]}async provideCompletionItems(e,t,s,o){const r=e.getWordUntilPosition(t),l=new monaco_editor_core_exports.Range(t.lineNumber,r.startColumn,t.lineNumber,r.endColumn),c=e.uri,d=e.getOffsetAt(t),u=await this._worker(c);if(e.isDisposed())return;const g=await u.getCompletionsAtPosition(c.toString(),d);return!g||e.isDisposed()?void 0:{suggestions:g.entries.map(p=>{let m=l;if(p.replacementSpan){const C=e.getPositionAt(p.replacementSpan.start),b=e.getPositionAt(p.replacementSpan.start+p.replacementSpan.length);m=new monaco_editor_core_exports.Range(C.lineNumber,C.column,b.lineNumber,b.column)}const _=[];return p.kindModifiers!==void 0&&p.kindModifiers.indexOf("deprecated")!==-1&&_.push(monaco_editor_core_exports.languages.CompletionItemTag.Deprecated),{uri:c,position:t,offset:d,range:m,label:p.name,insertText:p.name,sortText:p.sortText,kind:qn.convertKind(p.kind),tags:_}})}}async resolveCompletionItem(e,t){const s=e,o=s.uri,r=s.position,l=s.offset,d=await(await this._worker(o)).getCompletionEntryDetails(o.toString(),l,s.label);return d?{uri:o,position:r,label:d.name,kind:qn.convertKind(d.kind),detail:displayPartsToString(d.displayParts),documentation:{value:qn.createDocumentationString(d)}}:s}static convertKind(e){switch(e){case Kind.primitiveType:case Kind.keyword:return monaco_editor_core_exports.languages.CompletionItemKind.Keyword;case Kind.variable:case Kind.localVariable:return monaco_editor_core_exports.languages.CompletionItemKind.Variable;case Kind.memberVariable:case Kind.memberGetAccessor:case Kind.memberSetAccessor:return monaco_editor_core_exports.languages.CompletionItemKind.Field;case Kind.function:case Kind.memberFunction:case Kind.constructSignature:case Kind.callSignature:case Kind.indexSignature:return monaco_editor_core_exports.languages.CompletionItemKind.Function;case Kind.enum:return monaco_editor_core_exports.languages.CompletionItemKind.Enum;case Kind.module:return monaco_editor_core_exports.languages.CompletionItemKind.Module;case Kind.class:return monaco_editor_core_exports.languages.CompletionItemKind.Class;case Kind.interface:return monaco_editor_core_exports.languages.CompletionItemKind.Interface;case Kind.warning:return monaco_editor_core_exports.languages.CompletionItemKind.File}return monaco_editor_core_exports.languages.CompletionItemKind.Property}static createDocumentationString(e){let t=displayPartsToString(e.documentation);if(e.tags)for(const s of e.tags)t+=`

${tagToString(s)}`;return t}};function tagToString(a){let e=`*@${a.name}*`;if(a.name==="param"&&a.text){const[t,...s]=a.text;e+=`\`${t.text}\``,s.length>0&&(e+=` — ${s.map(o=>o.text).join(" ")}`)}else Array.isArray(a.text)?e+=` — ${a.text.map(t=>t.text).join(" ")}`:a.text&&(e+=` — ${a.text}`);return e}var SignatureHelpAdapter=class Tr extends Adapter{constructor(){super(...arguments),this.signatureHelpTriggerCharacters=["(",","]}static _toSignatureHelpTriggerReason(e){switch(e.triggerKind){case monaco_editor_core_exports.languages.SignatureHelpTriggerKind.TriggerCharacter:return e.triggerCharacter?e.isRetrigger?{kind:"retrigger",triggerCharacter:e.triggerCharacter}:{kind:"characterTyped",triggerCharacter:e.triggerCharacter}:{kind:"invoked"};case monaco_editor_core_exports.languages.SignatureHelpTriggerKind.ContentChange:return e.isRetrigger?{kind:"retrigger"}:{kind:"invoked"};case monaco_editor_core_exports.languages.SignatureHelpTriggerKind.Invoke:default:return{kind:"invoked"}}}async provideSignatureHelp(e,t,s,o){const r=e.uri,l=e.getOffsetAt(t),c=await this._worker(r);if(e.isDisposed())return;const d=await c.getSignatureHelpItems(r.toString(),l,{triggerReason:Tr._toSignatureHelpTriggerReason(o)});if(!d||e.isDisposed())return;const u={activeSignature:d.selectedItemIndex,activeParameter:d.argumentIndex,signatures:[]};return d.items.forEach(g=>{const f={label:"",parameters:[]};f.documentation={value:displayPartsToString(g.documentation)},f.label+=displayPartsToString(g.prefixDisplayParts),g.parameters.forEach((p,m,_)=>{const C=displayPartsToString(p.displayParts),b={label:C,documentation:{value:displayPartsToString(p.documentation)}};f.label+=C,f.parameters.push(b),m<_.length-1&&(f.label+=displayPartsToString(g.separatorDisplayParts))}),f.label+=displayPartsToString(g.suffixDisplayParts),u.signatures.push(f)}),{value:u,dispose(){}}}},QuickInfoAdapter=class extends Adapter{async provideHover(a,e,t){const s=a.uri,o=a.getOffsetAt(e),r=await this._worker(s);if(a.isDisposed())return;const l=await r.getQuickInfoAtPosition(s.toString(),o);if(!l||a.isDisposed())return;const c=displayPartsToString(l.documentation),d=l.tags?l.tags.map(g=>tagToString(g)).join(`  

`):"",u=displayPartsToString(l.displayParts);return{range:this._textSpanToRange(a,l.textSpan),contents:[{value:"```typescript\n"+u+"\n```\n"},{value:c+(d?`

`+d:"")}]}}},DocumentHighlightAdapter=class extends Adapter{async provideDocumentHighlights(a,e,t){const s=a.uri,o=a.getOffsetAt(e),r=await this._worker(s);if(a.isDisposed())return;const l=await r.getDocumentHighlights(s.toString(),o,[s.toString()]);if(!(!l||a.isDisposed()))return l.flatMap(c=>c.highlightSpans.map(d=>({range:this._textSpanToRange(a,d.textSpan),kind:d.kind==="writtenReference"?monaco_editor_core_exports.languages.DocumentHighlightKind.Write:monaco_editor_core_exports.languages.DocumentHighlightKind.Text})))}},DefinitionAdapter=class extends Adapter{constructor(a,e){super(e),this._libFiles=a}async provideDefinition(a,e,t){const s=a.uri,o=a.getOffsetAt(e),r=await this._worker(s);if(a.isDisposed())return;const l=await r.getDefinitionAtPosition(s.toString(),o);if(!l||a.isDisposed()||(await this._libFiles.fetchLibFilesIfNecessary(l.map(d=>monaco_editor_core_exports.Uri.parse(d.fileName))),a.isDisposed()))return;const c=[];for(let d of l){const u=this._libFiles.getOrCreateModel(d.fileName);u&&c.push({uri:u.uri,range:this._textSpanToRange(u,d.textSpan)})}return c}},ReferenceAdapter=class extends Adapter{constructor(a,e){super(e),this._libFiles=a}async provideReferences(a,e,t,s){const o=a.uri,r=a.getOffsetAt(e),l=await this._worker(o);if(a.isDisposed())return;const c=await l.getReferencesAtPosition(o.toString(),r);if(!c||a.isDisposed()||(await this._libFiles.fetchLibFilesIfNecessary(c.map(u=>monaco_editor_core_exports.Uri.parse(u.fileName))),a.isDisposed()))return;const d=[];for(let u of c){const g=this._libFiles.getOrCreateModel(u.fileName);g&&d.push({uri:g.uri,range:this._textSpanToRange(g,u.textSpan)})}return d}},OutlineAdapter=class extends Adapter{async provideDocumentSymbols(a,e){const t=a.uri,s=await this._worker(t);if(a.isDisposed())return;const o=await s.getNavigationTree(t.toString());if(!o||a.isDisposed())return;const r=(c,d)=>{var g;return{name:c.text,detail:"",kind:outlineTypeTable[c.kind]||monaco_editor_core_exports.languages.SymbolKind.Variable,range:this._textSpanToRange(a,c.spans[0]),selectionRange:this._textSpanToRange(a,c.spans[0]),tags:[],children:(g=c.childItems)==null?void 0:g.map(f=>r(f,c.text)),containerName:d}};return o.childItems?o.childItems.map(c=>r(c)):[]}},J,Kind=(J=class{},J.unknown="",J.keyword="keyword",J.script="script",J.module="module",J.class="class",J.interface="interface",J.type="type",J.enum="enum",J.variable="var",J.localVariable="local var",J.function="function",J.localFunction="local function",J.memberFunction="method",J.memberGetAccessor="getter",J.memberSetAccessor="setter",J.memberVariable="property",J.constructorImplementation="constructor",J.callSignature="call",J.indexSignature="index",J.constructSignature="construct",J.parameter="parameter",J.typeParameter="type parameter",J.primitiveType="primitive type",J.label="label",J.alias="alias",J.const="const",J.let="let",J.warning="warning",J),outlineTypeTable=Object.create(null);outlineTypeTable[Kind.module]=monaco_editor_core_exports.languages.SymbolKind.Module;outlineTypeTable[Kind.class]=monaco_editor_core_exports.languages.SymbolKind.Class;outlineTypeTable[Kind.enum]=monaco_editor_core_exports.languages.SymbolKind.Enum;outlineTypeTable[Kind.interface]=monaco_editor_core_exports.languages.SymbolKind.Interface;outlineTypeTable[Kind.memberFunction]=monaco_editor_core_exports.languages.SymbolKind.Method;outlineTypeTable[Kind.memberVariable]=monaco_editor_core_exports.languages.SymbolKind.Property;outlineTypeTable[Kind.memberGetAccessor]=monaco_editor_core_exports.languages.SymbolKind.Property;outlineTypeTable[Kind.memberSetAccessor]=monaco_editor_core_exports.languages.SymbolKind.Property;outlineTypeTable[Kind.variable]=monaco_editor_core_exports.languages.SymbolKind.Variable;outlineTypeTable[Kind.const]=monaco_editor_core_exports.languages.SymbolKind.Variable;outlineTypeTable[Kind.localVariable]=monaco_editor_core_exports.languages.SymbolKind.Variable;outlineTypeTable[Kind.variable]=monaco_editor_core_exports.languages.SymbolKind.Variable;outlineTypeTable[Kind.function]=monaco_editor_core_exports.languages.SymbolKind.Function;outlineTypeTable[Kind.localFunction]=monaco_editor_core_exports.languages.SymbolKind.Function;var FormatHelper=class extends Adapter{static _convertOptions(a){return{ConvertTabsToSpaces:a.insertSpaces,TabSize:a.tabSize,IndentSize:a.tabSize,IndentStyle:2,NewLineCharacter:`
`,InsertSpaceAfterCommaDelimiter:!0,InsertSpaceAfterSemicolonInForStatements:!0,InsertSpaceBeforeAndAfterBinaryOperators:!0,InsertSpaceAfterKeywordsInControlFlowStatements:!0,InsertSpaceAfterFunctionKeywordForAnonymousFunctions:!0,InsertSpaceAfterOpeningAndBeforeClosingNonemptyParenthesis:!1,InsertSpaceAfterOpeningAndBeforeClosingNonemptyBrackets:!1,InsertSpaceAfterOpeningAndBeforeClosingTemplateStringBraces:!1,PlaceOpenBraceOnNewLineForControlBlocks:!1,PlaceOpenBraceOnNewLineForFunctions:!1}}_convertTextChanges(a,e){return{text:e.newText,range:this._textSpanToRange(a,e.span)}}},FormatAdapter=class extends FormatHelper{constructor(){super(...arguments),this.canFormatMultipleRanges=!1}async provideDocumentRangeFormattingEdits(a,e,t,s){const o=a.uri,r=a.getOffsetAt({lineNumber:e.startLineNumber,column:e.startColumn}),l=a.getOffsetAt({lineNumber:e.endLineNumber,column:e.endColumn}),c=await this._worker(o);if(a.isDisposed())return;const d=await c.getFormattingEditsForRange(o.toString(),r,l,FormatHelper._convertOptions(t));if(!(!d||a.isDisposed()))return d.map(u=>this._convertTextChanges(a,u))}},FormatOnTypeAdapter=class extends FormatHelper{get autoFormatTriggerCharacters(){return[";","}",`
`]}async provideOnTypeFormattingEdits(a,e,t,s,o){const r=a.uri,l=a.getOffsetAt(e),c=await this._worker(r);if(a.isDisposed())return;const d=await c.getFormattingEditsAfterKeystroke(r.toString(),l,t,FormatHelper._convertOptions(s));if(!(!d||a.isDisposed()))return d.map(u=>this._convertTextChanges(a,u))}},CodeActionAdaptor=class extends FormatHelper{async provideCodeActions(a,e,t,s){const o=a.uri,r=a.getOffsetAt({lineNumber:e.startLineNumber,column:e.startColumn}),l=a.getOffsetAt({lineNumber:e.endLineNumber,column:e.endColumn}),c=FormatHelper._convertOptions(a.getOptions()),d=t.markers.filter(p=>p.code).map(p=>p.code).map(Number),u=await this._worker(o);if(a.isDisposed())return;const g=await u.getCodeFixesAtPosition(o.toString(),r,l,d,c);return!g||a.isDisposed()?{actions:[],dispose:()=>{}}:{actions:g.filter(p=>p.changes.filter(m=>m.isNewFile).length===0).map(p=>this._tsCodeFixActionToMonacoCodeAction(a,t,p)),dispose:()=>{}}}_tsCodeFixActionToMonacoCodeAction(a,e,t){const s=[];for(const r of t.changes)for(const l of r.textChanges)s.push({resource:a.uri,versionId:void 0,textEdit:{range:this._textSpanToRange(a,l.span),text:l.newText}});return{title:t.description,edit:{edits:s},diagnostics:e.markers,kind:"quickfix"}}},RenameAdapter=class extends Adapter{constructor(a,e){super(e),this._libFiles=a}async provideRenameEdits(a,e,t,s){const o=a.uri,r=o.toString(),l=a.getOffsetAt(e),c=await this._worker(o);if(a.isDisposed())return;const d=await c.getRenameInfo(r,l,{allowRenameOfImportPath:!1});if(d.canRename===!1)return{edits:[],rejectReason:d.localizedErrorMessage};if(d.fileToRename!==void 0)throw new Error("Renaming files is not supported.");const u=await c.findRenameLocations(r,l,!1,!1,!1);if(!u||a.isDisposed())return;const g=[];for(const f of u){const p=this._libFiles.getOrCreateModel(f.fileName);if(p)g.push({resource:p.uri,versionId:void 0,textEdit:{range:this._textSpanToRange(p,f.textSpan),text:t}});else throw new Error(`Unknown file ${f.fileName}.`)}return{edits:g}}},InlayHintsAdapter=class extends Adapter{async provideInlayHints(a,e,t){const s=a.uri,o=s.toString(),r=a.getOffsetAt({lineNumber:e.startLineNumber,column:e.startColumn}),l=a.getOffsetAt({lineNumber:e.endLineNumber,column:e.endColumn}),c=await this._worker(s);return a.isDisposed()?null:{hints:(await c.provideInlayHints(o,r,l)).map(g=>({...g,label:g.text,position:a.getPositionAt(g.position),kind:this._convertHintKind(g.kind)})),dispose:()=>{}}}_convertHintKind(a){switch(a){case"Parameter":return monaco_editor_core_exports.languages.InlayHintKind.Parameter;case"Type":return monaco_editor_core_exports.languages.InlayHintKind.Type;default:return monaco_editor_core_exports.languages.InlayHintKind.Type}}},javaScriptWorker,typeScriptWorker;function setupTypeScript(a){typeScriptWorker=setupMode(a,"typescript")}function setupJavaScript(a){javaScriptWorker=setupMode(a,"javascript")}function getJavaScriptWorker(){return new Promise((a,e)=>{if(!javaScriptWorker)return e("JavaScript not registered!");a(javaScriptWorker)})}function getTypeScriptWorker(){return new Promise((a,e)=>{if(!typeScriptWorker)return e("TypeScript not registered!");a(typeScriptWorker)})}function setupMode(a,e){const t=[],s=new WorkerManager(e,a),o=(...c)=>s.getLanguageServiceWorker(...c),r=new LibFiles(o);function l(){const{modeConfiguration:c}=a;disposeAll(t),c.completionItems&&t.push(monaco_editor_core_exports.languages.registerCompletionItemProvider(e,new SuggestAdapter(o))),c.signatureHelp&&t.push(monaco_editor_core_exports.languages.registerSignatureHelpProvider(e,new SignatureHelpAdapter(o))),c.hovers&&t.push(monaco_editor_core_exports.languages.registerHoverProvider(e,new QuickInfoAdapter(o))),c.documentHighlights&&t.push(monaco_editor_core_exports.languages.registerDocumentHighlightProvider(e,new DocumentHighlightAdapter(o))),c.definitions&&t.push(monaco_editor_core_exports.languages.registerDefinitionProvider(e,new DefinitionAdapter(r,o))),c.references&&t.push(monaco_editor_core_exports.languages.registerReferenceProvider(e,new ReferenceAdapter(r,o))),c.documentSymbols&&t.push(monaco_editor_core_exports.languages.registerDocumentSymbolProvider(e,new OutlineAdapter(o))),c.rename&&t.push(monaco_editor_core_exports.languages.registerRenameProvider(e,new RenameAdapter(r,o))),c.documentRangeFormattingEdits&&t.push(monaco_editor_core_exports.languages.registerDocumentRangeFormattingEditProvider(e,new FormatAdapter(o))),c.onTypeFormattingEdits&&t.push(monaco_editor_core_exports.languages.registerOnTypeFormattingEditProvider(e,new FormatOnTypeAdapter(o))),c.codeActions&&t.push(monaco_editor_core_exports.languages.registerCodeActionProvider(e,new CodeActionAdaptor(o))),c.inlayHints&&t.push(monaco_editor_core_exports.languages.registerInlayHintsProvider(e,new InlayHintsAdapter(o))),c.diagnostics&&t.push(new DiagnosticsAdapter(r,a,e,o))}return l(),o}function disposeAll(a){for(;a.length;)a.pop().dispose()}const tsMode=Object.freeze(Object.defineProperty({__proto__:null,Adapter,CodeActionAdaptor,DefinitionAdapter,DiagnosticsAdapter,DocumentHighlightAdapter,FormatAdapter,FormatHelper,FormatOnTypeAdapter,InlayHintsAdapter,Kind,LibFiles,OutlineAdapter,QuickInfoAdapter,ReferenceAdapter,RenameAdapter,SignatureHelpAdapter,SuggestAdapter,WorkerManager,flattenDiagnosticMessageText,getJavaScriptWorker,getTypeScriptWorker,setupJavaScript,setupTypeScript},Symbol.toStringTag,{value:"Module"}));function WorkerWrapper$1(){return new Worker("/assets/ts.worker-e64535ae.js")}function WorkerWrapper(){return new Worker("/assets/editor.worker-f3e6c8a9.js")}const Editor_svelte_svelte_type_style_lang="";function create_fragment$3(a){let e;return{c(){e=element("div"),attr(e,"class","svelte-nvn26r")},m(t,s){insert(t,e,s),a[2](e)},p:noop,i:noop,o:noop,d(t){t&&detach(e),a[2](null)}}}function instance$2(a,e,t){let s=null,{value:o=""}=e;onMount(async()=>{self.MonacoEnvironment={getWorker(c,d){return d==="typescript"||d==="javascript"?new WorkerWrapper$1:new WorkerWrapper}};let l=editor.create(s,{value:o,language:"javascript",theme:"vs-dark",automaticLayout:!0,wordWrap:"wordWrapColumn",wordWrapColumn:150,wrappingIndent:"indent",fontSize:16,quickSuggestions:!0,padding:{top:20,bottom:20}});return l.getModel().onDidChangeContent(c=>t(1,o=l.getValue())),()=>{l.dispose()}});function r(l){binding_callbacks[l?"unshift":"push"](()=>{s=l,t(0,s)})}return a.$$set=l=>{"value"in l&&t(1,o=l.value)},[s,o,r]}class Editor extends SvelteComponent{constructor(e){super(),init(this,e,instance$2,create_fragment$3,safe_not_equal,{value:1})}}const BookmarkletCode_svelte_svelte_type_style_lang="";function create_fragment$2(a){let e,t,s,o,r,l,c,d,u,g,f,p,m,_;return{c(){e=element("div"),t=element("pre"),s=element("code"),o=text$1(a[0]),r=space(),l=element("div"),c=element("button"),c.textContent="▶ Execute",d=space(),u=element("button"),u.textContent="📋 Copy to clipboard",g=space(),f=element("a"),p=text$1("💾 Save"),attr(t,"class","svelte-us7x7z"),attr(c,"class","svelte-us7x7z"),attr(u,"class","svelte-us7x7z"),attr(f,"class","button svelte-us7x7z"),attr(f,"href",a[0]),attr(l,"class","actions svelte-us7x7z"),attr(e,"class","wrapper")},m(C,b){insert(C,e,b),append$3(e,t),append$3(t,s),append$3(s,o),append$3(e,r),append$3(e,l),append$3(l,c),append$3(l,d),append$3(l,u),append$3(l,g),append$3(l,f),append$3(f,p),m||(_=[listen(c,"click",a[1]),listen(u,"click",a[2]),listen(f,"click",a[3])],m=!0)},p(C,[b]){b&1&&set_data(o,C[0]),b&1&&attr(f,"href",C[0])},i:noop,o:noop,d(C){C&&detach(e),m=!1,run_all(_)}}}function instance$1($$self,$$props,$$invalidate){let{code=""}=$$props,prefixedCode="";const updatePrefixedCode=()=>{const a=`(function() {
            ${code}
        })()`;$$invalidate(0,prefixedCode=`javascript:${encodeURI(a)}`)},execute=()=>eval(code),copyToClipboard=()=>navigator.clipboard.writeText(prefixedCode),addBookmark=()=>{alert(`1. Right click and copy link address
2. Create bookmark with URL`)};return $$self.$$set=a=>{"code"in a&&$$invalidate(4,code=a.code)},$$self.$$.update=()=>{$$self.$$.dirty&16&&updatePrefixedCode()},[prefixedCode,execute,copyToClipboard,addBookmark,code]}class BookmarkletCode extends SvelteComponent{constructor(e){super(),init(this,e,instance$1,create_fragment$2,safe_not_equal,{code:4})}}const ForkMeCorner_svelte_svelte_type_style_lang="";function create_fragment$1(a){let e;return{c(){e=element("a"),e.innerHTML='<img loading="lazy" width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_orange_ff7600.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"/>',attr(e,"href","https://github.com/timo-reymann/bookmarklet-generator"),attr(e,"class","svelte-dmc2zn")},m(t,s){insert(t,e,s)},p:noop,i:noop,o:noop,d(t){t&&detach(e)}}}class ForkMeCorner extends SvelteComponent{constructor(e){super(),init(this,e,null,create_fragment$1,safe_not_equal,{})}}const App_svelte_svelte_type_style_lang="";function create_fragment(a){let e,t,s,o,r,l,c,d,u,g,f,p;function m(v){a[1](v)}let _={};a[0]!==void 0&&(_.value=a[0]),r=new Editor({props:_}),binding_callbacks.push(()=>bind(r,"value",m));function C(v){a[2](v)}let b={};return a[0]!==void 0&&(b.code=a[0]),d=new BookmarkletCode({props:b}),binding_callbacks.push(()=>bind(d,"code",C)),f=new ForkMeCorner({}),{c(){e=element("header"),e.innerHTML="<h1>Bookmarklet Generator</h1>",t=space(),s=element("main"),o=element("div"),create_component(r.$$.fragment),c=space(),create_component(d.$$.fragment),g=space(),create_component(f.$$.fragment),attr(e,"class","svelte-3jolu5"),attr(o,"class","editor-wrapper svelte-3jolu5"),attr(s,"class","svelte-3jolu5")},m(v,S){insert(v,e,S),insert(v,t,S),insert(v,s,S),append$3(s,o),mount_component(r,o,null),append$3(s,c),mount_component(d,s,null),append$3(s,g),mount_component(f,s,null),p=!0},p(v,[S]){const y={};!l&&S&1&&(l=!0,y.value=v[0],add_flush_callback(()=>l=!1)),r.$set(y);const w={};!u&&S&1&&(u=!0,w.code=v[0],add_flush_callback(()=>u=!1)),d.$set(w)},i(v){p||(transition_in(r.$$.fragment,v),transition_in(d.$$.fragment,v),transition_in(f.$$.fragment,v),p=!0)},o(v){transition_out(r.$$.fragment,v),transition_out(d.$$.fragment,v),transition_out(f.$$.fragment,v),p=!1},d(v){v&&detach(e),v&&detach(t),v&&detach(s),destroy_component(r),destroy_component(d),destroy_component(f)}}}function instance(a,e,t){const s=()=>new URL(window.location),o=u=>{const g=s();g.searchParams.set("code",btoa(u)),history.replaceState(null,"",g.toString())};let l=(()=>{const u=s();return u.searchParams.has("code")?atob(u.searchParams.get("code")):`// Replace with your code 

alert('Hello World')
`})();function c(u){l=u,t(0,l)}function d(u){l=u,t(0,l)}return a.$$.update=()=>{a.$$.dirty&1&&o(l)},[l,c,d]}class App extends SvelteComponent{constructor(e){super(),init(this,e,instance,create_fragment,safe_not_equal,{})}}new App({target:document.body});export{monaco_editor_core_star as m};
